cscope 15 $HOME/1511/tools/setools3               0002738872
	@apol/apol_tcl.cc

27 
	~<cÚfig.h
>

29 
	~<ùy³.h
>

30 
	~<”ºo.h
>

31 
	~<lim™s.h
>

32 
	~<¡dio.h
>

33 
	~<¡dlib.h
>

34 
	~<¡ršg.h
>

35 
	~<tş.h
>

37 
	~<­Ş/pŞicy.h
>

38 
	~<£fs/db.hh
>

39 
	~<£fs/fesy¡em.hh
>

42 
	gmsg_Ëv–
 = 
INT_MAX
;

45 *
	gmes§ge
 = 
NULL
;

54 
	$­Ş_tş_commÚ_rou‹
(*
¬g
, 
Ëv–
, cÚ¡ *
fmt
, 
va_li¡
 
­
)

56 *
s
, *
t
;

57 
Tş_IÁ”p
 *
š‹½
 = 
¡©ic_ÿ¡
 < Tş_IÁ”°* >(
¬g
);

58 ià(
Ëv–
 =ğ
APOL_MSG_INFO
 && 
msg_Ëv–
 >= APOL_MSG_INFO)

61 
	`ä“
(
mes§ge
);

62 
mes§ge
 = 
NULL
;

63 ià(
	`va¥rštf
(&
s
, 
fmt
, 
­
) < 0)

65 
	`årštf
(
¡d”r
, "%s\n", 
	`¡»¼Ü
(
”ºo
));

68 
mes§ge
 = 
s
;

69 
msg_Ëv–
 = 
Ëv–
;

70 
	`Tş_Ev®
(
š‹½
, "Apol_Progress_Dialog::_update_message");

71 
	`Tş_DoOÃEv’t
(
TCL_IDLE_EVENTS
 | 
TCL_DONT_WAIT
)) ;

73 ià(
mes§ge
 =ğ
NULL
 || 
Ëv–
 < 
msg_Ëv–
)

77 
	`ä“
(
mes§ge
);

78 
mes§ge
 = 
NULL
;

79 ià(
	`va¥rštf
(&
s
, 
fmt
, 
­
) < 0)

81 
	`årštf
(
¡d”r
, "%s\n", 
	`¡»¼Ü
(
”ºo
));

84 
mes§ge
 = 
s
;

85 
msg_Ëv–
 = 
Ëv–
;

87 ià(
Ëv–
 =ğ
msg_Ëv–
)

90 ià(
	`va¥rštf
(&
s
, 
fmt
, 
­
) < 0)

92 
	`årštf
(
¡d”r
, "%s\n", 
	`¡»¼Ü
(
”ºo
));

95 ià(
	`a¥rštf
(&
t
, "%s\n%s", 
mes§ge
, 
s
) < 0)

97 
	`ä“
(
s
);

98 
	`årštf
(
¡d”r
, "%s\n", 
	`¡»¼Ü
(
”ºo
));

101 
	`ä“
(
s
);

102 
	`ä“
(
mes§ge
);

103 
mes§ge
 = 
t
;

105 
	}
}

107 
	$­Ş_tş_ş—r_šfo_¡ršg
()

109 ià(
mes§ge
 !ğ
NULL
)

111 
	`ä“
(
mes§ge
);

112 
mes§ge
 = 
NULL
;

114 
msg_Ëv–
 = 
INT_MAX
;

115 
	}
}

117 
­Ş_tş_rou‹_­Ş_to_¡ršg
(*
¬g
, cÚ¡ 
­Ş_pŞicy_t
 * 
p


118 
__©Œibu‹__
 ((
unu£d
)), 
Ëv–
, cÚ¡ *
fmt
, 
va_li¡
 
­
)

120 
­Ş_tş_commÚ_rou‹
(
¬g
, 
Ëv–
, 
fmt
, 
­
);

123 
­Ş_tş_rou‹_£fs_to_¡ršg
(*
¬g
, cÚ¡ 
£fs_fşi¡
 * 
s


124 
__©Œibu‹__
 ((
unu£d
)), 
Ëv–
, cÚ¡ *
fmt
, 
va_li¡
 
­
)

126 
­Ş_tş_commÚ_rou‹
(
¬g
, 
Ëv–
, 
fmt
, 
­
);

129 
	$­Ş_tş_g‘_šfo_Ëv–
()

131  
msg_Ëv–
;

132 
	}
}

134 *
	$­Ş_tş_g‘_šfo_¡ršg
()

136  
mes§ge
;

137 
	}
}

139 
	$­Ş_tş_£t_šfo_¡ršg
(
­Ş_pŞicy_t
 * 
p
, cÚ¡ *
s
)

141 
	`INFO
(
p
, "%s", 
s
);

142 
	}
}

	@libapol/include/apol/avrule-query.h

27 #iâdeà
APOL_AVRULE_QUERY_H


28 
	#APOL_AVRULE_QUERY_H


	)

30 #ifdef 
__ılu¥lus


35 
	~"pŞicy.h
"

36 
	~"veùÜ.h
"

37 
	~<qpŞ/pŞicy.h
>

39 
­Ş_avruË_qu”y
 
	t­Ş_avruË_qu”y_t
;

54 
­Ş_avruË_g‘_by_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
­Ş_avruË_qu”y_t
 * 
a
, 
­Ş_veùÜ_t
 ** 
v
);

71 
­Ş_syn_avruË_g‘_by_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
­Ş_avruË_qu”y_t
 * 
a
, 
­Ş_veùÜ_t
 ** 
v
);

81 
­Ş_avruË_qu”y_t
 *
­Ş_avruË_qu”y_ü—‹
();

90 
­Ş_avruË_qu”y_de¡roy
(
­Ş_avruË_qu”y_t
 ** 
a
);

105 
­Ş_avruË_qu”y_£t_ruËs
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_avruË_qu”y_t
 * 
a
, 
ruËs
);

124 
­Ş_avruË_qu”y_£t_sourû
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_avruË_qu”y_t
 * 
a
, cÚ¡ *
symbŞ
,

125 
is_šdœeù
);

140 
­Ş_avruË_qu”y_£t_sourû_compÚ’t
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_avruË_qu”y_t
 * 
a
, 
compÚ’t
);

159 
­Ş_avruË_qu”y_£t_rg‘
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_avruË_qu”y_t
 * 
a
, cÚ¡ *
symbŞ
,

160 
is_šdœeù
);

175 
­Ş_avruË_qu”y_£t_rg‘_compÚ’t
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_avruË_qu”y_t
 * 
a
, 
compÚ’t
);

192 
­Ş_avruË_qu”y_­³nd_şass
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_avruË_qu”y_t
 * 
a
, cÚ¡ *
obj_şass
);

212 
­Ş_avruË_qu”y_­³nd_³rm
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_avruË_qu”y_t
 * 
a
, cÚ¡ *
³rm
);

226 
­Ş_avruË_qu”y_£t_boŞ
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_avruË_qu”y_t
 * 
a
, cÚ¡ *
boŞ_Çme
);

240 
­Ş_avruË_qu”y_£t_’abËd
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_avruË_qu”y_t
 * 
a
, 
is_’abËd
);

273 
­Ş_avruË_qu”y_£t_®l_³rms
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_avruË_qu”y_t
 * 
a
, 
®l_³rms
);

287 
­Ş_avruË_qu”y_£t_sourû_ªy
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_avruË_qu”y_t
 * 
a
, 
is_ªy
);

301 
­Ş_avruË_qu”y_£t_»gex
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_avruË_qu”y_t
 * 
a
, 
is_»gex
);

320 
­Ş_veùÜ_t
 *
­Ş_avruË_to_syn_avruËs
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
qpŞ_avruË_t
 * 
ruË
,

321 cÚ¡ 
­Ş_veùÜ_t
 * 
³rms
);

342 
­Ş_veùÜ_t
 *
­Ş_avruË_li¡_to_syn_avruËs
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡‡pŞ_veùÜ_ˆ* 
ruËs
,

343 cÚ¡ 
­Ş_veùÜ_t
 * 
³rms
);

355 *
­Ş_avruË_»nd”
(cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_avruË_t
 * 
ruË
);

367 *
­Ş_syn_avruË_»nd”
(cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_syn_avruË_t
 * 
ruË
);

369 #ifdef 
__ılu¥lus


	@libapol/include/apol/bool-query.h

25 #iâdeà
APOL_BOOL_QUERY_H


26 
	#APOL_BOOL_QUERY_H


	)

28 #ifdef 
__ılu¥lus


33 
	~"pŞicy.h
"

34 
	~"veùÜ.h
"

35 
	~<qpŞ/pŞicy.h
>

37 
­Ş_boŞ_qu”y
 
	t­Ş_boŞ_qu”y_t
;

54 
­Ş_boŞ_g‘_by_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_boŞ_qu”y_t
 * 
b
, 
­Ş_veùÜ_t
 ** 
v
);

64 
­Ş_boŞ_qu”y_t
 *
­Ş_boŞ_qu”y_ü—‹
();

73 
­Ş_boŞ_qu”y_de¡roy
(
­Ş_boŞ_qu”y_t
 ** 
b
);

86 
­Ş_boŞ_qu”y_£t_boŞ
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_boŞ_qu”y_t
 * 
b
, cÚ¡ *
Çme
);

99 
­Ş_boŞ_qu”y_£t_»gex
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_boŞ_qu”y_t
 * 
b
, 
is_»gex
);

101 #ifdef 
__ılu¥lus


	@libapol/include/apol/bounds-query.h

25 #iâdeà
APOL_BOUNDS_QUERY_H


26 
	#APOL_BOUNDS_QUERY_H


	)

28 #ifdef 
__ılu¥lus


33 
	~"pŞicy.h
"

34 
	~"veùÜ.h
"

35 
	~<qpŞ/pŞicy.h
>

38 
­Ş_ty³bounds_qu”y
 
	t­Ş_ty³bounds_qu”y_t
;

52 
­Ş_ty³bounds_g‘_by_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_ty³bounds_qu”y_t
 * 
t
, 
­Ş_veùÜ_t
 ** 
v
);

62 
­Ş_ty³bounds_qu”y_t
 *
­Ş_ty³bounds_qu”y_ü—‹
();

71 
­Ş_ty³bounds_qu”y_de¡roy
(
­Ş_ty³bounds_qu”y_t
 ** 
t
);

84 
­Ş_ty³bounds_qu”y_£t_Çme
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_ty³bounds_qu”y_t
 * 
t
, cÚ¡ *
Çme
);

97 
­Ş_ty³bounds_qu”y_£t_»gex
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_ty³bounds_qu”y_t
 * 
t
, 
is_»gex
);

101 
­Ş_rŞebounds_qu”y
 
	t­Ş_rŞebounds_qu”y_t
;

115 
­Ş_rŞebounds_g‘_by_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_rŞebounds_qu”y_t
 * 
t
, 
­Ş_veùÜ_t
 ** 
v
);

125 
­Ş_rŞebounds_qu”y_t
 *
­Ş_rŞebounds_qu”y_ü—‹
();

134 
­Ş_rŞebounds_qu”y_de¡roy
(
­Ş_rŞebounds_qu”y_t
 ** 
t
);

137 
­Ş_u£rbounds_qu”y
 
	t­Ş_u£rbounds_qu”y_t
;

151 
­Ş_u£rbounds_g‘_by_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_u£rbounds_qu”y_t
 * 
t
, 
­Ş_veùÜ_t
 ** 
v
);

161 
­Ş_u£rbounds_qu”y_t
 *
­Ş_u£rbounds_qu”y_ü—‹
();

170 
­Ş_u£rbounds_qu”y_de¡roy
(
­Ş_u£rbounds_qu”y_t
 ** 
t
);

173 #ifdef 
__ılu¥lus


	@libapol/include/apol/bst.h

28 #iâdeà
APOL_BST_H


29 
	#APOL_BST_H


	)

31 #ifdef 
__ılu¥lus


36 
	~<¡dlib.h
>

38 
­Ş_b¡
 
	t­Ş_b¡_t
;

40 (
­Ş_b¡_comp_func
è(cÚ¡ *
	ta
, cÚ¡ *
	tb
, *
	td©a
);

41 (
­Ş_b¡_ä“_func
è(*
	t–em
);

43 
	~"veùÜ.h
"

64 
­Ş_b¡_t
 *
­Ş_b¡_ü—‹
(
­Ş_b¡_comp_func
 * 
cmp
, 
­Ş_b¡_ä“_func
 * 
ä
);

74 
­Ş_b¡_de¡roy
(
­Ş_b¡_t
 ** 
b
);

95 
­Ş_veùÜ_t
 *
­Ş_b¡_g‘_veùÜ
(
­Ş_b¡_t
 * 
b
, 
chªge_owÃr
);

106 
size_t
 
­Ş_b¡_g‘_size
(cÚ¡ 
­Ş_b¡_t
 * 
v
);

121 
­Ş_b¡_g‘_–em’t
(cÚ¡ 
­Ş_b¡_t
 * 
b
, cÚ¡ *
–em
, *
d©a
, **
»suÉ
);

136 
­Ş_b¡_š£¹
(
­Ş_b¡_t
 * 
b
, *
–em
, *
d©a
);

156 
­Ş_b¡_š£¹_ªd_g‘
(
­Ş_b¡_t
 * 
b
, **
–em
, *
d©a
);

173 
­Ş_b¡_šÜd”_m­
(cÚ¡ 
­Ş_b¡_t
 * 
b
, (*
â
è(*, *), *
d©a
);

174 #ifdef 
__ılu¥lus


	@libapol/include/apol/class-perm-query.h

26 #iâdeà
APOL_CLASS_PERM_QUERY_H


27 
	#APOL_CLASS_PERM_QUERY_H


	)

29 #ifdef 
__ılu¥lus


34 
	~"pŞicy.h
"

35 
	~"veùÜ.h
"

36 
	~<qpŞ/pŞicy.h
>

38 
­Ş_şass_qu”y
 
	t­Ş_şass_qu”y_t
;

39 
­Ş_commÚ_qu”y
 
	t­Ş_commÚ_qu”y_t
;

40 
­Ş_³rm_qu”y
 
	t­Ş_³rm_qu”y_t
;

58 
­Ş_şass_g‘_by_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_şass_qu”y_t
 * 
c
, 
­Ş_veùÜ_t
 ** 
v
);

68 
­Ş_şass_qu”y_t
 *
­Ş_şass_qu”y_ü—‹
();

77 
­Ş_şass_qu”y_de¡roy
(
­Ş_şass_qu”y_t
 ** 
c
);

90 
­Ş_şass_qu”y_£t_şass
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_şass_qu”y_t
 * 
c
, cÚ¡ *
Çme
);

105 
­Ş_şass_qu”y_£t_commÚ
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_şass_qu”y_t
 * 
c
, cÚ¡ *
Çme
);

118 
­Ş_şass_qu”y_£t_»gex
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_şass_qu”y_t
 * 
c
, 
is_»gex
);

136 
­Ş_commÚ_g‘_by_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_commÚ_qu”y_t
 * 
c
, 
­Ş_veùÜ_t
 ** 
v
);

146 
­Ş_commÚ_qu”y_t
 *
­Ş_commÚ_qu”y_ü—‹
();

155 
­Ş_commÚ_qu”y_de¡roy
(
­Ş_commÚ_qu”y_t
 ** 
c
);

168 
­Ş_commÚ_qu”y_£t_commÚ
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_commÚ_qu”y_t
 * 
c
, cÚ¡ *
Çme
);

181 
­Ş_commÚ_qu”y_£t_»gex
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_commÚ_qu”y_t
 * 
c
, 
is_»gex
);

203 
­Ş_³rm_g‘_by_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_³rm_qu”y_t
 * 
pq
, 
­Ş_veùÜ_t
 ** 
v
);

214 
­Ş_³rm_qu”y_t
 *
­Ş_³rm_qu”y_ü—‹
();

223 
­Ş_³rm_qu”y_de¡roy
(
­Ş_³rm_qu”y_t
 ** 
pq
);

236 
­Ş_³rm_qu”y_£t_³rm
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_³rm_qu”y_t
 * 
pq
, cÚ¡ *
Çme
);

249 
­Ş_³rm_qu”y_£t_»gex
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_³rm_qu”y_t
 * 
pq
, 
is_»gex
);

251 #ifdef 
__ılu¥lus


	@libapol/include/apol/condrule-query.h

27 #iâdeà
APOL_CONDRULE_QUERY_H


28 
	#APOL_CONDRULE_QUERY_H


	)

30 #ifdef 
__ılu¥lus


35 
	~"pŞicy.h
"

36 
	~"veùÜ.h
"

37 
	~<qpŞ/pŞicy.h
>

39 
­Ş_cÚd_qu”y
 
	t­Ş_cÚd_qu”y_t
;

55 
­Ş_cÚd_g‘_by_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_cÚd_qu”y_t
 * 
c
, 
­Ş_veùÜ_t
 ** 
v
);

66 
­Ş_cÚd_qu”y_t
 *
­Ş_cÚd_qu”y_ü—‹
();

75 
­Ş_cÚd_qu”y_de¡roy
(
­Ş_cÚd_qu”y_t
 ** 
c
);

88 
­Ş_cÚd_qu”y_£t_boŞ
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_cÚd_qu”y_t
 * 
c
, cÚ¡ *
Çme
);

100 
­Ş_cÚd_qu”y_£t_»gex
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_cÚd_qu”y_t
 * 
c
, 
is_»gex
);

113 *
­Ş_cÚd_ex´_»nd”
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
qpŞ_cÚd_t
 * 
cÚd
);

115 #ifdef 
__ılu¥lus


	@libapol/include/apol/constraint-query.h

26 #iâdeà
APOL_CONSTRAINT_QUERY_H


27 
	#APOL_CONSTRAINT_QUERY_H


	)

29 #ifdef 
__ılu¥lus


34 
	~"pŞicy.h
"

35 
	~"veùÜ.h
"

37 
­Ş_cÚ¡¿št_qu”y
 
	t­Ş_cÚ¡¿št_qu”y_t
;

38 
­Ş_v®id©‘¿ns_qu”y
 
	t­Ş_v®id©‘¿ns_qu”y_t
;

55 
­Ş_cÚ¡¿št_g‘_by_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_cÚ¡¿št_qu”y_t
 * 
c
, 
­Ş_veùÜ_t
 ** 
v
);

66 
­Ş_cÚ¡¿št_qu”y_t
 *
­Ş_cÚ¡¿št_qu”y_ü—‹
();

75 
­Ş_cÚ¡¿št_qu”y_de¡roy
(
­Ş_cÚ¡¿št_qu”y_t
 ** 
c
);

89 
­Ş_cÚ¡¿št_qu”y_£t_şass
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_cÚ¡¿št_qu”y_t
 * 
c
, cÚ¡ *
Çme
);

103 
­Ş_cÚ¡¿št_qu”y_£t_³rm
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_cÚ¡¿št_qu”y_t
 * 
c
, cÚ¡ *
Çme
);

116 
­Ş_cÚ¡¿št_qu”y_£t_»gex
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_cÚ¡¿št_qu”y_t
 * 
c
, 
is_»gex
);

134 
­Ş_v®id©‘¿ns_g‘_by_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_v®id©‘¿ns_qu”y_t
 * 
vt
, 
­Ş_veùÜ_t
 ** 
v
);

146 
­Ş_v®id©‘¿ns_qu”y_t
 *
­Ş_v®id©‘¿ns_qu”y_ü—‹
();

155 
­Ş_v®id©‘¿ns_qu”y_de¡roy
(
­Ş_v®id©‘¿ns_qu”y_t
 ** 
vt
);

169 
­Ş_v®id©‘¿ns_qu”y_£t_şass
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_v®id©‘¿ns_qu”y_t
 * 
vt
, cÚ¡ *
Çme
);

182 
­Ş_v®id©‘¿ns_qu”y_£t_»gex
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_v®id©‘¿ns_qu”y_t
 * 
vt
, 
is_»gex
);

184 #ifdef 
__ılu¥lus


	@libapol/include/apol/context-query.h

25 #iâdeà
APOL_CONTEXT_QUERY_H


26 
	#APOL_CONTEXT_QUERY_H


	)

28 #ifdef 
__ılu¥lus


33 
	~"pŞicy.h
"

34 
	~"mls-qu”y.h
"

35 
	~<qpŞ/pŞicy.h
>

37 
­Ş_cÚ‹xt
 
	t­Ş_cÚ‹xt_t
;

46 
­Ş_cÚ‹xt_t
 *
­Ş_cÚ‹xt_ü—‹
();

59 
­Ş_cÚ‹xt_t
 *
­Ş_cÚ‹xt_ü—‹_äom_qpŞ_cÚ‹xt
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
qpŞ_cÚ‹xt_t
 * 
cÚ‹xt
);

77 
­Ş_cÚ‹xt_t
 *
­Ş_cÚ‹xt_ü—‹_äom_l™”®
(cÚ¡ *
cÚ‹xt_¡ršg
);

86 
­Ş_cÚ‹xt_de¡roy
(
­Ş_cÚ‹xt_t
 ** 
cÚ‹xt
);

98 
­Ş_cÚ‹xt_£t_u£r
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_cÚ‹xt_t
 * 
cÚ‹xt
, cÚ¡ *
u£r
);

110 
­Ş_cÚ‹xt_£t_rŞe
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_cÚ‹xt_t
 * 
cÚ‹xt
, cÚ¡ *
rŞe
);

122 
­Ş_cÚ‹xt_£t_ty³
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_cÚ‹xt_t
 * 
cÚ‹xt
, cÚ¡ *
ty³
);

135 
­Ş_cÚ‹xt_£t_¿nge
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_cÚ‹xt_t
 * 
cÚ‹xt
, 
­Ş_mls_¿nge_t
 * 
¿nge
);

145 cÚ¡ *
­Ş_cÚ‹xt_g‘_u£r
(cÚ¡ 
­Ş_cÚ‹xt_t
 * 
cÚ‹xt
);

155 cÚ¡ *
­Ş_cÚ‹xt_g‘_rŞe
(cÚ¡ 
­Ş_cÚ‹xt_t
 * 
cÚ‹xt
);

165 cÚ¡ *
­Ş_cÚ‹xt_g‘_ty³
(cÚ¡ 
­Ş_cÚ‹xt_t
 * 
cÚ‹xt
);

175 cÚ¡ 
­Ş_mls_¿nge_t
 *
­Ş_cÚ‹xt_g‘_¿nge
(cÚ¡ 
­Ş_cÚ‹xt_t
 * 
cÚ‹xt
);

195 
­Ş_cÚ‹xt_com·»
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
,

196 cÚ¡ 
­Ş_cÚ‹xt_t
 * 
rg‘
, cÚ¡‡pŞ_cÚ‹xt_ˆ* 
£¬ch
,

197 
¿nge_com·»_ty³
);

211 
­Ş_cÚ‹xt_v®id©e
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
­Ş_cÚ‹xt_t
 * 
cÚ‹xt
);

226 
­Ş_cÚ‹xt_v®id©e_·¹Ÿl
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
­Ş_cÚ‹xt_t
 * 
cÚ‹xt
);

243 *
­Ş_cÚ‹xt_»nd”
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
­Ş_cÚ‹xt_t
 * 
cÚ‹xt
);

255 
­Ş_cÚ‹xt_cÚv”t
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_cÚ‹xt_t
 * 
cÚ‹xt
);

257 #ifdef 
__ılu¥lus


	@libapol/include/apol/default-object-query.h

25 #iâdeà
APOL_DEFAULT_OBJECT_QUERY_H


26 
	#APOL_DEFAULT_OBJECT_QUERY_H


	)

28 #ifdef 
__ılu¥lus


33 
	~"pŞicy.h
"

34 
	~"veùÜ.h
"

35 
	~<qpŞ/pŞicy.h
>

37 
­Ş_deçuÉ_objeù_qu”y
 
	t­Ş_deçuÉ_objeù_qu”y_t
;

51 
­Ş_deçuÉ_objeù_g‘_by_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_deçuÉ_objeù_qu”y_t
 * 
t
, 
­Ş_veùÜ_t
 ** 
v
);

61 
­Ş_deçuÉ_objeù_qu”y_t
 *
­Ş_deçuÉ_objeù_qu”y_ü—‹
();

70 
­Ş_deçuÉ_objeù_qu”y_de¡roy
(
­Ş_deçuÉ_objeù_qu”y_t
 ** 
t
);

74 #ifdef 
__ılu¥lus


	@libapol/include/apol/domain-trans-analysis.h

26 #iâdeà
APOL_DOMAIN_TRANS_ANALYSIS_H


27 
	#APOL_DOMAIN_TRANS_ANALYSIS_H


	)

29 #ifdef 
__ılu¥lus


34 
	~"pŞicy.h
"

35 
	~"veùÜ.h
"

36 
	~<qpŞ/pŞicy.h
>

38 
­Ş_domaš_Œªs_ª®ysis
 
	t­Ş_domaš_Œªs_ª®ysis_t
;

39 
­Ş_domaš_Œªs_»suÉ
 
	t­Ş_domaš_Œªs_»suÉ_t
;

41 
	#APOL_DOMAIN_TRANS_DIRECTION_FORWARD
 0x01

	)

42 
	#APOL_DOMAIN_TRANS_DIRECTION_REVERSE
 0x02

	)

44 
	#APOL_DOMAIN_TRANS_SEARCH_VALID
 0x01

	)

45 
	#APOL_DOMAIN_TRANS_SEARCH_INVALID
 0x02

	)

46 
	#APOL_DOMAIN_TRANS_SEARCH_BOTH
 (
APOL_DOMAIN_TRANS_SEARCH_VALID
|
APOL_DOMAIN_TRANS_SEARCH_INVALID
)

	)

57 
­Ş_pŞicy_bud_domaš_Œªs_bË
(
­Ş_pŞicy_t
 * 
pŞicy
);

62 
­Ş_pŞicy_domaš_Œªs_bË_bud
(
­Ş_pŞicy_t
 * 
pŞicy
è
__©Œibu‹__
 ((
d•»ÿ‹d
));

76 
­Ş_pŞicy_»£t_domaš_Œªs_bË
(
­Ş_pŞicy_t
 * 
pŞicy
);

81 
­Ş_domaš_Œªs_bË_»£t
(
­Ş_pŞicy_t
 * 
pŞicy
è
__©Œibu‹__
 ((
d•»ÿ‹d
));

93 
­Ş_domaš_Œªs_ª®ysis_t
 *
­Ş_domaš_Œªs_ª®ysis_ü—‹
();

101 
­Ş_domaš_Œªs_ª®ysis_de¡roy
(
­Ş_domaš_Œªs_ª®ysis_t
 ** 
d
);

113 
­Ş_domaš_Œªs_ª®ysis_£t_dœeùiÚ
(cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
, 
­Ş_domaš_Œªs_ª®ysis_t
 * 
d
,

114 
dœeùiÚ
);

127 
­Ş_domaš_Œªs_ª®ysis_£t_v®id
(cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
, 
­Ş_domaš_Œªs_ª®ysis_t
 * 
d
,

128 
v®id
);

141 
­Ş_domaš_Œªs_ª®ysis_£t_¡¬t_ty³
(cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
, 
­Ş_domaš_Œªs_ª®ysis_t
 * 
d
,

142 cÚ¡ *
ty³_Çme
);

154 
­Ş_domaš_Œªs_ª®ysis_£t_»suÉ_»gex
(cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
, 
­Ş_domaš_Œªs_ª®ysis_t
 * 
d
,

155 cÚ¡ *
»gex
);

173 
­Ş_domaš_Œªs_ª®ysis_­³nd_acûss_ty³
(cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
, 
­Ş_domaš_Œªs_ª®ysis_t
 * 
d
,

174 cÚ¡ *
ty³_Çme
);

200 
­Ş_domaš_Œªs_ª®ysis_­³nd_şass_³rm
(cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
, 
­Ş_domaš_Œªs_ª®ysis_t
 * 
d
,

201 cÚ¡ *
şass_Çme
, cÚ¡ *
³rm_Çme
)

202 
__©Œibu‹__
 ((
d•»ÿ‹d
));

220 
­Ş_domaš_Œªs_ª®ysis_­³nd_şass
(cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
, 
­Ş_domaš_Œªs_ª®ysis_t
 * 
d
,

221 cÚ¡ *
şass_Çme
);

239 
­Ş_domaš_Œªs_ª®ysis_­³nd_³rm
(cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
, 
­Ş_domaš_Œªs_ª®ysis_t
 * 
d
,

240 cÚ¡ *
³rm_Çme
);

255 
­Ş_domaš_Œªs_ª®ysis_do
(
­Ş_pŞicy_t
 * 
pŞicy
, 
­Ş_domaš_Œªs_ª®ysis_t
 * 
d
,

256 
­Ş_veùÜ_t
 ** 
»suÉs
);

268 cÚ¡ 
qpŞ_ty³_t
 *
­Ş_domaš_Œªs_»suÉ_g‘_¡¬t_ty³
(cÚ¡ 
­Ş_domaš_Œªs_»suÉ_t
 * 
dŒ
);

278 cÚ¡ 
qpŞ_ty³_t
 *
­Ş_domaš_Œªs_»suÉ_g‘_’Œypošt_ty³
(cÚ¡ 
­Ş_domaš_Œªs_»suÉ_t
 * 
dŒ
);

288 cÚ¡ 
qpŞ_ty³_t
 *
­Ş_domaš_Œªs_»suÉ_g‘_’d_ty³
(cÚ¡ 
­Ş_domaš_Œªs_»suÉ_t
 * 
dŒ
);

299 cÚ¡ 
­Ş_veùÜ_t
 *
­Ş_domaš_Œªs_»suÉ_g‘_´oc_Œªs_ruËs
(cÚ¡ 
­Ş_domaš_Œªs_»suÉ_t
 * 
dŒ
);

309 cÚ¡ 
­Ş_veùÜ_t
 *
­Ş_domaš_Œªs_»suÉ_g‘_’Œypošt_ruËs
(cÚ¡ 
­Ş_domaš_Œªs_»suÉ_t
 * 
dŒ
);

319 cÚ¡ 
­Ş_veùÜ_t
 *
­Ş_domaš_Œªs_»suÉ_g‘_exec_ruËs
(cÚ¡ 
­Ş_domaš_Œªs_»suÉ_t
 * 
dŒ
);

332 cÚ¡ 
­Ş_veùÜ_t
 *
­Ş_domaš_Œªs_»suÉ_g‘_£‹xec_ruËs
(cÚ¡ 
­Ş_domaš_Œªs_»suÉ_t
 * 
dŒ
);

345 cÚ¡ 
­Ş_veùÜ_t
 *
­Ş_domaš_Œªs_»suÉ_g‘_ty³_Œªs_ruËs
(cÚ¡ 
­Ş_domaš_Œªs_»suÉ_t
 * 
dŒ
);

352 
­Ş_domaš_Œªs_»suÉ_is_Œªs_v®id
(cÚ¡ 
­Ş_domaš_Œªs_»suÉ_t
 * 
dŒ
);

366 cÚ¡ 
­Ş_veùÜ_t
 *
­Ş_domaš_Œªs_»suÉ_g‘_acûss_ruËs
(cÚ¡ 
­Ş_domaš_Œªs_»suÉ_t
 * 
dŒ
);

378 
­Ş_domaš_Œªs_»suÉ_t
 *
­Ş_domaš_Œªs_»suÉ_ü—‹_äom_domaš_Œªs_»suÉ
(const‡pol_domain_trans_result_t

379 * 
š
);

390 
­Ş_domaš_Œªs_»suÉ_de¡roy
(
­Ş_domaš_Œªs_»suÉ_t
 ** 
»s
);

394 
	#APOL_DOMAIN_TRANS_RULE_PROC_TRANS
 0x01

	)

395 
	#APOL_DOMAIN_TRANS_RULE_EXEC
 0x02

	)

396 
	#APOL_DOMAIN_TRANS_RULE_EXEC_NO_TRANS
 0x04

	)

397 
	#APOL_DOMAIN_TRANS_RULE_ENTRYPOINT
 0x08

	)

398 
	#APOL_DOMAIN_TRANS_RULE_TYPE_TRANS
 0x10

	)

399 
	#APOL_DOMAIN_TRANS_RULE_SETEXEC
 0x20

	)

420 
­Ş_domaš_Œªs_bË_v”ify_Œªs
(
­Ş_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_ty³_t
 * 
¡¬t_dom
,

421 cÚ¡ 
qpŞ_ty³_t
 * 
•_ty³
, cÚ¡ qpŞ_ty³_ˆ* 
’d_dom
);

423 #ifdef 
__ılu¥lus


	@libapol/include/apol/fscon-query.h

25 #iâdeà
APOL_FSCON_QUERY_H


26 
	#APOL_FSCON_QUERY_H


	)

28 #ifdef 
__ılu¥lus


33 
	~"pŞicy.h
"

34 
	~"veùÜ.h
"

35 
	~"cÚ‹xt-qu”y.h
"

36 
	~<¡ršg.h
>

37 
	~<qpŞ/pŞicy.h
>

39 
­Ş_g’fscÚ_qu”y
 
	t­Ş_g’fscÚ_qu”y_t
;

40 
­Ş_fs_u£_qu”y
 
	t­Ş_fs_u£_qu”y_t
;

58 
­Ş_g’fscÚ_g‘_by_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
­Ş_g’fscÚ_qu”y_t
 * 
g
, 
­Ş_veùÜ_t
 ** 
v
);

69 
­Ş_g’fscÚ_qu”y_t
 *
­Ş_g’fscÚ_qu”y_ü—‹
();

78 
­Ş_g’fscÚ_qu”y_de¡roy
(
­Ş_g’fscÚ_qu”y_t
 ** 
g
);

91 
­Ş_g’fscÚ_qu”y_£t_fesy¡em
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_g’fscÚ_qu”y_t
 * 
g
, cÚ¡ *
fs
);

105 
­Ş_g’fscÚ_qu”y_£t_·th
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_g’fscÚ_qu”y_t
 * 
g
, cÚ¡ *
·th
);

119 
­Ş_g’fscÚ_qu”y_£t_objşass
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_g’fscÚ_qu”y_t
 * 
g
, 
objşass
);

136 
­Ş_g’fscÚ_qu”y_£t_cÚ‹xt
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
,

137 
­Ş_g’fscÚ_qu”y_t
 * 
g
, 
­Ş_cÚ‹xt_t
 * 
cÚ‹xt
, 
¿nge_m©ch
);

148 *
­Ş_g’fscÚ_»nd”
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
qpŞ_g’fscÚ_t
 * 
g’fscÚ
);

166 
­Ş_fs_u£_g‘_by_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
­Ş_fs_u£_qu”y_t
 * 
f
, 
­Ş_veùÜ_t
 ** 
v
);

176 
­Ş_fs_u£_qu”y_t
 *
­Ş_fs_u£_qu”y_ü—‹
();

185 
­Ş_fs_u£_qu”y_de¡roy
(
­Ş_fs_u£_qu”y_t
 ** 
f
);

198 
­Ş_fs_u£_qu”y_£t_fesy¡em
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_fs_u£_qu”y_t
 * 
f
, cÚ¡ *
fs
);

212 
­Ş_fs_u£_qu”y_£t_behaviÜ
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_fs_u£_qu”y_t
 * 
f
, 
behaviÜ
);

231 
­Ş_fs_u£_qu”y_£t_cÚ‹xt
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
,

232 
­Ş_fs_u£_qu”y_t
 * 
f
, 
­Ş_cÚ‹xt_t
 * 
cÚ‹xt
, 
¿nge_m©ch
);

243 *
­Ş_fs_u£_»nd”
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
qpŞ_fs_u£_t
 * 
fsu£
);

245 #ifdef 
__ılu¥lus


	@libapol/include/apol/ftrule-query.h

27 #iâdeà
APOL_FTRULE_QUERY_H


28 
	#APOL_FTRULE_QUERY_H


	)

30 #ifdef 
__ılu¥lus


35 
	~"pŞicy.h
"

36 
	~"veùÜ.h
"

37 
	~<qpŞ/pŞicy.h
>

39 
­Ş_f’ame_Œªs_qu”y
 
	t­Ş_f’ame_Œªs_qu”y_t
;

58 
­Ş_f’ame_Œªs_g‘_by_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
­Ş_f’ame_Œªs_qu”y_t
 * 
r
, 
­Ş_veùÜ_t
 ** 
v
);

70 
­Ş_f’ame_Œªs_qu”y_t
 *
­Ş_f’ame_Œªs_qu”y_ü—‹
();

79 
­Ş_f’ame_Œªs_qu”y_de¡roy
(
­Ş_f’ame_Œªs_qu”y_t
 ** 
r
);

98 
­Ş_f’ame_Œªs_qu”y_£t_sourû
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_f’ame_Œªs_qu”y_t
 * 
t
, cÚ¡ *
symbŞ
,

99 
is_šdœeù
);

118 
­Ş_f’ame_Œªs_qu”y_£t_rg‘
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_f’ame_Œªs_qu”y_t
 * 
r
, cÚ¡ *
symbŞ
,

119 
is_šdœeù
);

133 
­Ş_f’ame_Œªs_qu”y_£t_deçuÉ
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_f’ame_Œªs_qu”y_t
 * 
r
, cÚ¡ *
ty³
);

145 
­Ş_f’ame_Œªs_qu”y_£t_Çme
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_f’ame_Œªs_qu”y_t
 * 
t
, cÚ¡ *
f’ame
);

162 
­Ş_f’ame_Œªs_qu”y_­³nd_şass
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_f’ame_Œªs_qu”y_t
 * 
t
, cÚ¡ *
obj_şass
);

178 
­Ş_f’ame_Œªs_qu”y_£t_sourû_ªy
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_f’ame_Œªs_qu”y_t
 * 
r
, 
is_ªy
);

192 
­Ş_f’ame_Œªs_qu”y_£t_»gex
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_f’ame_Œªs_qu”y_t
 * 
r
, 
is_»gex
);

204 *
­Ş_f’ame_Œªs_»nd”
(cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_f’ame_Œªs_t
 * 
ruË
);

206 #ifdef 
__ılu¥lus


	@libapol/include/apol/infoflow-analysis.h

27 #iâdeà
APOL_INFOFLOW_ANALYSIS_H


28 
	#APOL_INFOFLOW_ANALYSIS_H


	)

30 #ifdef 
__ılu¥lus


35 
	~"pŞicy.h
"

36 
	~"veùÜ.h
"

37 
	~<qpŞ/pŞicy.h
>

43 
	#APOL_INFOFLOW_MODE_DIRECT
 0x01

	)

44 
	#APOL_INFOFLOW_MODE_TRANS
 0x02

	)

52 
	#APOL_INFOFLOW_IN
 0x01

	)

53 
	#APOL_INFOFLOW_OUT
 0x02

	)

54 
	#APOL_INFOFLOW_BOTH
 (
APOL_INFOFLOW_IN
|
APOL_INFOFLOW_OUT
)

	)

55 
	#APOL_INFOFLOW_EITHER
 0x04

	)

57 
­Ş_šfoæow_g¿ph
 
	t­Ş_šfoæow_g¿ph_t
;

58 
­Ş_šfoæow_ª®ysis
 
	t­Ş_šfoæow_ª®ysis_t
;

59 
­Ş_šfoæow_»suÉ
 
	t­Ş_šfoæow_»suÉ_t
;

60 
­Ş_šfoæow_¡•
 
	t­Ş_šfoæow_¡•_t
;

69 
­Ş_šfoæow_g¿ph_de¡roy
(
­Ş_šfoæow_g¿ph_t
 ** 
g
);

93 
­Ş_šfoæow_ª®ysis_do
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
,

94 cÚ¡ 
­Ş_šfoæow_ª®ysis_t
 * 
Ÿ
, 
­Ş_veùÜ_t
 ** 
v
, 
­Ş_šfoæow_g¿ph_t
 ** 
g
);

112 
­Ş_šfoæow_ª®ysis_do_mÜe
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_šfoæow_g¿ph_t
 * 
g
, cÚ¡ *
ty³
,

113 
­Ş_veùÜ_t
 ** 
v
);

131 
­Ş_šfoæow_ª®ysis_Œªs_fu¹h”_´•¬e
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
,

132 
­Ş_šfoæow_g¿ph_t
 * 
g
, cÚ¡ *
¡¬t_ty³
,

133 cÚ¡ *
’d_ty³
);

151 
­Ş_šfoæow_ª®ysis_Œªs_fu¹h”_Ãxt
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_šfoæow_g¿ph_t
 * 
g
,

152 
­Ş_veùÜ_t
 ** 
v
);

165 
­Ş_šfoæow_ª®ysis_t
 *
­Ş_šfoæow_ª®ysis_ü—‹
();

174 
­Ş_šfoæow_ª®ysis_de¡roy
(
­Ş_šfoæow_ª®ysis_t
 ** 
Ÿ
);

188 
­Ş_šfoæow_ª®ysis_£t_mode
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_šfoæow_ª®ysis_t
 * 
Ÿ
, 
mode
);

203 
­Ş_šfoæow_ª®ysis_£t_dœ
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_šfoæow_ª®ysis_t
 * 
Ÿ
, 
dœ
);

215 
­Ş_šfoæow_ª®ysis_£t_ty³
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_šfoæow_ª®ysis_t
 * 
Ÿ
, cÚ¡ *
Çme
);

231 
­Ş_šfoæow_ª®ysis_­³nd_š‹rmedŸ‹
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_šfoæow_ª®ysis_t
 * 
Ÿ
,

232 cÚ¡ *
ty³
);

249 
­Ş_šfoæow_ª®ysis_­³nd_şass_³rm
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
,

250 
­Ş_šfoæow_ª®ysis_t
 * 
Ÿ
, cÚ¡ *
şass_Çme
,

251 cÚ¡ *
³rm_Çme
);

266 
­Ş_šfoæow_ª®ysis_£t_mš_weight
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_šfoæow_ª®ysis_t
 * 
Ÿ
, 
mš_weight
);

280 
­Ş_šfoæow_ª®ysis_£t_»suÉ_»gex
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_šfoæow_ª®ysis_t
 * 
Ÿ
,

281 cÚ¡ *
»suÉ
);

292 
­Ş_šfoæow_»suÉ_g‘_dœ
(cÚ¡ 
­Ş_šfoæow_»suÉ_t
 * 
»suÉ
);

301 cÚ¡ 
qpŞ_ty³_t
 *
­Ş_šfoæow_»suÉ_g‘_¡¬t_ty³
(cÚ¡ 
­Ş_šfoæow_»suÉ_t
 * 
»suÉ
);

310 cÚ¡ 
qpŞ_ty³_t
 *
­Ş_šfoæow_»suÉ_g‘_’d_ty³
(cÚ¡ 
­Ş_šfoæow_»suÉ_t
 * 
»suÉ
);

321 
­Ş_šfoæow_»suÉ_g‘_Ëngth
(cÚ¡ 
­Ş_šfoæow_»suÉ_t
 * 
»suÉ
);

336 cÚ¡ 
­Ş_veùÜ_t
 *
­Ş_šfoæow_»suÉ_g‘_¡•s
(cÚ¡ 
­Ş_šfoæow_»suÉ_t
 * 
»suÉ
);

345 cÚ¡ 
qpŞ_ty³_t
 *
­Ş_šfoæow_¡•_g‘_¡¬t_ty³
(cÚ¡ 
­Ş_šfoæow_¡•_t
 * 
¡•
);

354 cÚ¡ 
qpŞ_ty³_t
 *
­Ş_šfoæow_¡•_g‘_’d_ty³
(cÚ¡ 
­Ş_šfoæow_¡•_t
 * 
¡•
);

368 
­Ş_šfoæow_¡•_g‘_weight
(cÚ¡ 
­Ş_šfoæow_¡•_t
 * 
¡•
);

381 cÚ¡ 
­Ş_veùÜ_t
 *
­Ş_šfoæow_¡•_g‘_ruËs
(cÚ¡ 
­Ş_šfoæow_¡•_t
 * 
¡•
);

383 #ifdef 
__ılu¥lus


	@libapol/include/apol/isid-query.h

25 #iâdeà
APOL_ISID_QUERY_H


26 
	#APOL_ISID_QUERY_H


	)

28 #ifdef 
__ılu¥lus


33 
	~"pŞicy.h
"

34 
	~"veùÜ.h
"

35 
	~"cÚ‹xt-qu”y.h
"

36 
	~<qpŞ/pŞicy.h
>

38 
­Ş_isid_qu”y
 
	t­Ş_isid_qu”y_t
;

56 
­Ş_isid_g‘_by_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
­Ş_isid_qu”y_t
 * 
i
, 
­Ş_veùÜ_t
 ** 
v
);

66 
­Ş_isid_qu”y_t
 *
­Ş_isid_qu”y_ü—‹
();

75 
­Ş_isid_qu”y_de¡roy
(
­Ş_isid_qu”y_t
 ** 
i
);

87 
­Ş_isid_qu”y_£t_Çme
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_isid_qu”y_t
 * 
i
, cÚ¡ *
Çme
);

104 
­Ş_isid_qu”y_£t_cÚ‹xt
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
,

105 
­Ş_isid_qu”y_t
 * 
i
, 
­Ş_cÚ‹xt_t
 * 
cÚ‹xt
, 
¿nge_m©ch
);

107 #ifdef 
__ılu¥lus


	@libapol/include/apol/mls-query.h

26 #iâdeà
APOL_MLS_QUERY_H


27 
	#APOL_MLS_QUERY_H


	)

29 #ifdef 
__ılu¥lus


34 
	~"pŞicy.h
"

35 
	~"mls_Ëv–.h
"

36 
	~"mls_¿nge.h
"

37 
	~"veùÜ.h
"

39 
­Ş_Ëv–_qu”y
 
	t­Ş_Ëv–_qu”y_t
;

40 
­Ş_ÿt_qu”y
 
	t­Ş_ÿt_qu”y_t
;

44 
	#APOL_MLS_EQ
 0

	)

45 
	#APOL_MLS_DOM
 1

	)

46 
	#APOL_MLS_DOMBY
 2

	)

47 
	#APOL_MLS_INCOMP
 3

	)

60 
­Ş_mls_£ns_com·»
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ *
£ns1
, cÚ¡ *
£ns2
);

73 
­Ş_mls_ÿts_com·»
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ *
ÿt1
, cÚ¡ *
ÿt2
);

93 
­Ş_Ëv–_g‘_by_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_Ëv–_qu”y_t
 * 
l
, 
­Ş_veùÜ_t
 ** 
v
);

103 
­Ş_Ëv–_qu”y_t
 *
­Ş_Ëv–_qu”y_ü—‹
();

112 
­Ş_Ëv–_qu”y_de¡roy
(
­Ş_Ëv–_qu”y_t
 ** 
l
);

126 
­Ş_Ëv–_qu”y_£t_£ns
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_Ëv–_qu”y_t
 * 
l
, cÚ¡ *
Çme
);

140 
­Ş_Ëv–_qu”y_£t_ÿt
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_Ëv–_qu”y_t
 * 
l
, cÚ¡ *
Çme
);

154 
­Ş_Ëv–_qu”y_£t_»gex
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_Ëv–_qu”y_t
 * 
l
, 
is_»gex
);

174 
­Ş_ÿt_g‘_by_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_ÿt_qu”y_t
 * 
c
, 
­Ş_veùÜ_t
 ** 
v
);

185 
­Ş_ÿt_qu”y_t
 *
­Ş_ÿt_qu”y_ü—‹
();

194 
­Ş_ÿt_qu”y_de¡roy
(
­Ş_ÿt_qu”y_t
 ** 
c
);

208 
­Ş_ÿt_qu”y_£t_ÿt
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_ÿt_qu”y_t
 * 
c
, cÚ¡ *
Çme
);

222 
­Ş_ÿt_qu”y_£t_»gex
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_ÿt_qu”y_t
 * 
c
, 
is_»gex
);

224 #ifdef 
__ılu¥lus


	@libapol/include/apol/mls_level.h

26 #iâdeà
APOL_MLS_LEVEL_H


27 
	#APOL_MLS_LEVEL_H


	)

29 #ifdef 
__ılu¥lus


34 
	~"pŞicy.h
"

35 
	~"veùÜ.h
"

36 
	~<qpŞ/pŞicy.h
>

38 
­Ş_mls_Ëv–
 
	t­Ş_mls_Ëv–_t
;

47 
­Ş_mls_Ëv–_t
 *
­Ş_mls_Ëv–_ü—‹
();

59 
­Ş_mls_Ëv–_t
 *
­Ş_mls_Ëv–_ü—‹_äom_mls_Ëv–
(cÚ¡‡pŞ_mls_Ëv–_ˆ* 
Ëv–
);

75 
­Ş_mls_Ëv–_t
 *
­Ş_mls_Ëv–_ü—‹_äom_¡ršg
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ *
mls_Ëv–_¡ršg
);

96 
­Ş_mls_Ëv–_t
 *
­Ş_mls_Ëv–_ü—‹_äom_l™”®
(cÚ¡ *
mls_Ëv–_¡ršg
);

110 
­Ş_mls_Ëv–_t
 *
­Ş_mls_Ëv–_ü—‹_äom_qpŞ_mls_Ëv–
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
,

111 cÚ¡ 
qpŞ_mls_Ëv–_t
 * 
qpŞ_Ëv–
);

125 
­Ş_mls_Ëv–_t
 *
­Ş_mls_Ëv–_ü—‹_äom_qpŞ_Ëv–_d©um
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
qpŞ_Ëv–_t
 * 
qpŞ_Ëv–
);

134 
­Ş_mls_Ëv–_de¡roy
(
­Ş_mls_Ëv–_t
 ** 
Ëv–
);

147 
­Ş_mls_Ëv–_£t_£ns
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_mls_Ëv–_t
 * 
Ëv–
, cÚ¡ *
£ns
);

157 cÚ¡ *
­Ş_mls_Ëv–_g‘_£ns
(cÚ¡ 
­Ş_mls_Ëv–_t
 * 
Ëv–
);

169 
­Ş_mls_Ëv–_­³nd_ÿts
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_mls_Ëv–_t
 * 
Ëv–
, cÚ¡ *
ÿts
);

181 cÚ¡ 
­Ş_veùÜ_t
 *
­Ş_mls_Ëv–_g‘_ÿts
(cÚ¡ 
­Ş_mls_Ëv–_t
 * 
Ëv–
);

198 
­Ş_mls_Ëv–_com·»
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
­Ş_mls_Ëv–_t
 * 
Ëv–1
,

199 cÚ¡ 
­Ş_mls_Ëv–_t
 * 
Ëv–2
);

214 
­Ş_mls_Ëv–_v®id©e
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
­Ş_mls_Ëv–_t
 * 
Ëv–
);

227 *
­Ş_mls_Ëv–_»nd”
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
­Ş_mls_Ëv–_t
 * 
Ëv–
);

242 
­Ş_mls_Ëv–_cÚv”t
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_mls_Ëv–_t
 * 
Ëv–
);

255 
­Ş_mls_Ëv–_is_l™”®
(cÚ¡ 
­Ş_mls_Ëv–_t
 * 
Ëv–
);

257 #ifdef 
__ılu¥lus


	@libapol/include/apol/mls_range.h

26 #iâdeà
APOL_MLS_RANGE_H


27 
	#APOL_MLS_RANGE_H


	)

29 #ifdef 
__ılu¥lus


34 
	~"mls_Ëv–.h
"

35 
	~"pŞicy.h
"

36 
	~"veùÜ.h
"

37 
	~<qpŞ/pŞicy.h
>

39 
­Ş_mls_¿nge
 
	t­Ş_mls_¿nge_t
;

48 
­Ş_mls_¿nge_t
 *
­Ş_mls_¿nge_ü—‹
();

60 
­Ş_mls_¿nge_t
 *
­Ş_mls_¿nge_ü—‹_äom_mls_¿nge
(cÚ¡‡pŞ_mls_¿nge_ˆ* 
¿nge
);

76 
­Ş_mls_¿nge_t
 *
­Ş_mls_¿nge_ü—‹_äom_¡ršg
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ *
mls_¿nge_¡ršg
);

97 
­Ş_mls_¿nge_t
 *
­Ş_mls_¿nge_ü—‹_äom_l™”®
(cÚ¡ *
mls_¿nge_¡ršg
);

111 
­Ş_mls_¿nge_t
 *
­Ş_mls_¿nge_ü—‹_äom_qpŞ_mls_¿nge
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
,

112 cÚ¡ 
qpŞ_mls_¿nge_t
 * 
qpŞ_¿nge
);

121 
­Ş_mls_¿nge_de¡roy
(
­Ş_mls_¿nge_t
 ** 
¿nge
);

135 
­Ş_mls_¿nge_£t_low
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_mls_¿nge_t
 * 
¿nge
, 
­Ş_mls_Ëv–_t
 * 
Ëv–
);

149 
­Ş_mls_¿nge_£t_high
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_mls_¿nge_t
 * 
¿nge
, 
­Ş_mls_Ëv–_t
 * 
Ëv–
);

159 cÚ¡ 
­Ş_mls_Ëv–_t
 *
­Ş_mls_¿nge_g‘_low
(cÚ¡ 
­Ş_mls_¿nge_t
 * 
¿nge
);

169 cÚ¡ 
­Ş_mls_Ëv–_t
 *
­Ş_mls_¿nge_g‘_high
(cÚ¡ 
­Ş_mls_¿nge_t
 * 
¿nge
);

187 
­Ş_mls_¿nge_com·»
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
,

188 cÚ¡ 
­Ş_mls_¿nge_t
 * 
rg‘
, cÚ¡‡pŞ_mls_¿nge_ˆ* 
£¬ch
,

189 
¿nge_com·»_ty³
);

202 
­Ş_mls_¿nge_cÚš_sub¿nge
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
­Ş_mls_¿nge_t
 * 
¿nge
,

203 cÚ¡ 
­Ş_mls_¿nge_t
 * 
sub¿nge
);

214 
­Ş_mls_¿nge_v®id©e
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
­Ş_mls_¿nge_t
 * 
¿nge
);

227 
­Ş_veùÜ_t
 *
­Ş_mls_¿nge_g‘_Ëv–s
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
­Ş_mls_¿nge_t
 * 
¿nge
);

241 *
­Ş_mls_¿nge_»nd”
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
­Ş_mls_¿nge_t
 * 
¿nge
);

253 
­Ş_mls_¿nge_cÚv”t
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_mls_¿nge_t
 * 
¿nge
);

264 
­Ş_mls_¿nge_is_l™”®
(cÚ¡ 
­Ş_mls_¿nge_t
 * 
¿nge
);

266 #ifdef 
__ılu¥lus


	@libapol/include/apol/netcon-query.h

26 #iâdeà
APOL_NETCON_QUERY_H


27 
	#APOL_NETCON_QUERY_H


	)

29 #ifdef 
__ılu¥lus


34 
	~"pŞicy.h
"

35 
	~"veùÜ.h
"

36 
	~"cÚ‹xt-qu”y.h
"

37 
	~<qpŞ/pŞicy.h
>

39 
­Ş_pÜtcÚ_qu”y
 
	t­Ş_pÜtcÚ_qu”y_t
;

40 
­Ş_ÃtifcÚ_qu”y
 
	t­Ş_ÃtifcÚ_qu”y_t
;

41 
­Ş_nodecÚ_qu”y
 
	t­Ş_nodecÚ_qu”y_t
;

59 
­Ş_pÜtcÚ_g‘_by_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
­Ş_pÜtcÚ_qu”y_t
 * 
po
, 
­Ş_veùÜ_t
 ** 
v
);

69 
­Ş_pÜtcÚ_qu”y_t
 *
­Ş_pÜtcÚ_qu”y_ü—‹
();

78 
­Ş_pÜtcÚ_qu”y_de¡roy
(
­Ş_pÜtcÚ_qu”y_t
 ** 
po
);

90 
­Ş_pÜtcÚ_qu”y_£t_´ÙocŞ
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_pÜtcÚ_qu”y_t
 * 
po
, 
´Ùo
);

103 
­Ş_pÜtcÚ_qu”y_£t_low
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_pÜtcÚ_qu”y_t
 * 
po
, 
low
);

116 
­Ş_pÜtcÚ_qu”y_£t_high
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_pÜtcÚ_qu”y_t
 * 
po
, 
high
);

133 
­Ş_pÜtcÚ_qu”y_£t_cÚ‹xt
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
,

134 
­Ş_pÜtcÚ_qu”y_t
 * 
po
, 
­Ş_cÚ‹xt_t
 * 
cÚ‹xt
, 
¿nge_m©ch
);

145 *
­Ş_pÜtcÚ_»nd”
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
qpŞ_pÜtcÚ_t
 * 
pÜtcÚ
);

163 
­Ş_ÃtifcÚ_g‘_by_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
­Ş_ÃtifcÚ_qu”y_t
 * 
n
, 
­Ş_veùÜ_t
 ** 
v
);

174 
­Ş_ÃtifcÚ_qu”y_t
 *
­Ş_ÃtifcÚ_qu”y_ü—‹
();

183 
­Ş_ÃtifcÚ_qu”y_de¡roy
(
­Ş_ÃtifcÚ_qu”y_t
 ** 
n
);

195 
­Ş_ÃtifcÚ_qu”y_£t_deviû
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_ÃtifcÚ_qu”y_t
 * 
n
, cÚ¡ *
dev
);

212 
­Ş_ÃtifcÚ_qu”y_£t_if_cÚ‹xt
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
,

213 
­Ş_ÃtifcÚ_qu”y_t
 * 
n
, 
­Ş_cÚ‹xt_t
 * 
cÚ‹xt
,

214 
¿nge_m©ch
);

231 
­Ş_ÃtifcÚ_qu”y_£t_msg_cÚ‹xt
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
,

232 
­Ş_ÃtifcÚ_qu”y_t
 * 
n
, 
­Ş_cÚ‹xt_t
 * 
cÚ‹xt
,

233 
¿nge_m©ch
);

244 *
­Ş_ÃtifcÚ_»nd”
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
qpŞ_ÃtifcÚ_t
 * 
ÃtifcÚ
);

262 
­Ş_nodecÚ_g‘_by_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
­Ş_nodecÚ_qu”y_t
 * 
n
, 
­Ş_veùÜ_t
 ** 
v
);

273 
­Ş_nodecÚ_qu”y_t
 *
­Ş_nodecÚ_qu”y_ü—‹
();

282 
­Ş_nodecÚ_qu”y_de¡roy
(
­Ş_nodecÚ_qu”y_t
 ** 
n
);

295 
­Ş_nodecÚ_qu”y_£t_´ÙocŞ
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_nodecÚ_qu”y_t
 * 
n
, 
´Ùo
);

312 
­Ş_nodecÚ_qu”y_£t_addr
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_nodecÚ_qu”y_t
 * 
n
, 
ušt32_t
 * 
addr
, 
´Ùo
);

329 
­Ş_nodecÚ_qu”y_£t_mask
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_nodecÚ_qu”y_t
 * 
n
, 
ušt32_t
 * 
mask
, 
´Ùo
);

346 
­Ş_nodecÚ_qu”y_£t_cÚ‹xt
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
,

347 
­Ş_nodecÚ_qu”y_t
 * 
n
, 
­Ş_cÚ‹xt_t
 * 
cÚ‹xt
, 
¿nge_m©ch
);

358 *
­Ş_nodecÚ_»nd”
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
qpŞ_nodecÚ_t
 * 
nodecÚ
);

360 #ifdef 
__ılu¥lus


	@libapol/include/apol/perm-map.h

29 #iâdeà
APOL_PERMMAP_H


30 
	#APOL_PERMMAP_H


	)

32 #ifdef 
__ılu¥lus


37 
	~"pŞicy.h
"

39 
	#APOL_PERMMAP_MAX_WEIGHT
 10

	)

40 
	#APOL_PERMMAP_MIN_WEIGHT
 1

	)

42 
	#APOL_PERMMAP_UNMAPPED
 0x00

	)

43 
	#APOL_PERMMAP_READ
 0x01

	)

44 
	#APOL_PERMMAP_WRITE
 0x02

	)

45 
	#APOL_PERMMAP_BOTH
 (
APOL_PERMMAP_READ
 | 
APOL_PERMMAP_WRITE
)

	)

46 
	#APOL_PERMMAP_NONE
 0x10

	)

62 
­Ş_pŞicy_İ’_³rmm­
(
­Ş_pŞicy_t
 * 
p
, cÚ¡ *
f’ame
);

67 
­Ş_³rmm­_lßd
(
­Ş_pŞicy_t
 * 
p
, cÚ¡ *
f’ame
è
__©Œibu‹__
 ((
d•»ÿ‹d
));

78 
­Ş_pŞicy_§ve_³rmm­
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ *
f’ame
);

83 
­Ş_³rmm­_§ve
(
­Ş_pŞicy_t
 * 
p
, cÚ¡ *
f’ame
è
__©Œibu‹__
 ((
d•»ÿ‹d
));

101 
­Ş_pŞicy_g‘_³rmm­
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ *
şass_Çme
, cÚ¡ *
³rm_Çme
, *
m­
,

102 *
weight
);

107 
­Ş_³rmm­_g‘
(
­Ş_pŞicy_t
 * 
p
, cÚ¡ *
şass_Çme
, cÚ¡ *
³rm_Çme
, *
m­
, *
weight
)

108 
__©Œibu‹__
 ((
d•»ÿ‹d
));

125 
­Ş_pŞicy_£t_³rmm­
(
­Ş_pŞicy_t
 * 
p
, cÚ¡ *
şass_Çme
, cÚ¡ *
³rm_Çme
, 
m­
, 
weight
);

130 
­Ş_³rmm­_£t
(
­Ş_pŞicy_t
 * 
p
, cÚ¡ *
şass_Çme
, cÚ¡ *
³rm_Çme
, 
m­
, 
weight
)

131 
__©Œibu‹__
 ((
d•»ÿ‹d
));

133 #ifdef 
__ılu¥lus


	@libapol/include/apol/permissive-query.h

25 #iâdeà
APOL_PERMISSIVE_QUERY_H


26 
	#APOL_PERMISSIVE_QUERY_H


	)

28 #ifdef 
__ılu¥lus


33 
	~"pŞicy.h
"

34 
	~"veùÜ.h
"

35 
	~<qpŞ/pŞicy.h
>

37 
­Ş_³rmissive_qu”y
 
	t­Ş_³rmissive_qu”y_t
;

53 
­Ş_³rmissive_g‘_by_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_³rmissive_qu”y_t
 * 
t
, 
­Ş_veùÜ_t
 ** 
v
);

63 
­Ş_³rmissive_qu”y_t
 *
­Ş_³rmissive_qu”y_ü—‹
();

72 
­Ş_³rmissive_qu”y_de¡roy
(
­Ş_³rmissive_qu”y_t
 ** 
t
);

85 
­Ş_³rmissive_qu”y_£t_Çme
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_³rmissive_qu”y_t
 * 
t
, cÚ¡ *
Çme
);

98 
­Ş_³rmissive_qu”y_£t_»gex
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_³rmissive_qu”y_t
 * 
t
, 
is_»gex
);

100 #ifdef 
__ılu¥lus


	@libapol/include/apol/polcap-query.h

25 #iâdeà
APOL_POLCAP_QUERY_H


26 
	#APOL_POLCAP_QUERY_H


	)

28 #ifdef 
__ılu¥lus


33 
	~"pŞicy.h
"

34 
	~"veùÜ.h
"

35 
	~<qpŞ/pŞicy.h
>

37 
­Ş_pŞÿp_qu”y
 
	t­Ş_pŞÿp_qu”y_t
;

52 
­Ş_pŞÿp_g‘_by_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_pŞÿp_qu”y_t
 * 
t
, 
­Ş_veùÜ_t
 ** 
v
);

62 
­Ş_pŞÿp_qu”y_t
 *
­Ş_pŞÿp_qu”y_ü—‹
();

71 
­Ş_pŞÿp_qu”y_de¡roy
(
­Ş_pŞÿp_qu”y_t
 ** 
t
);

84 
­Ş_pŞÿp_qu”y_£t_Çme
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_pŞÿp_qu”y_t
 * 
t
, cÚ¡ *
Çme
);

97 
­Ş_pŞÿp_qu”y_£t_»gex
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_pŞÿp_qu”y_t
 * 
t
, 
is_»gex
);

99 #ifdef 
__ılu¥lus


	@libapol/include/apol/policy-path.h

28 #iâdeà
APOL_POLICY_PATH_H


29 
	#APOL_POLICY_PATH_H


	)

31 #ifdef 
__ılu¥lus


36 
	~"veùÜ.h
"

38 
­Ş_pŞicy_·th
 
	t­Ş_pŞicy_·th_t
;

44 
	e­Ş_pŞicy_·th_ty³


46 
APOL_POLICY_PATH_TYPE_MONOLITHIC
 = 0,

47 
APOL_POLICY_PATH_TYPE_MODULAR


48 } 
	t­Ş_pŞicy_·th_ty³_e
;

64 
­Ş_pŞicy_·th_t
 *
­Ş_pŞicy_·th_ü—‹
(
­Ş_pŞicy_·th_ty³_e
 
·th_ty³
, cÚ¡ *
·th
,

65 cÚ¡ 
­Ş_veùÜ_t
 * 
moduËs
);

75 
­Ş_pŞicy_·th_t
 *
­Ş_pŞicy_·th_ü—‹_äom_pŞicy_·th
(cÚ¡‡pŞ_pŞicy_·th_ˆ* 
·th
);

86 
­Ş_pŞicy_·th_t
 *
­Ş_pŞicy_·th_ü—‹_äom_fe
(cÚ¡ *
f’ame
);

97 
­Ş_pŞicy_·th_t
 *
­Ş_pŞicy_·th_ü—‹_äom_¡ršg
(cÚ¡ *
·th_¡ršg
);

105 
­Ş_pŞicy_·th_de¡roy
(
­Ş_pŞicy_·th_t
 ** 
·th
);

119 
­Ş_pŞicy_·th_com·»
(cÚ¡ 
­Ş_pŞicy_·th_t
 * 
a
, cÚ¡‡pŞ_pŞicy_·th_ˆ* 
b
);

128 
­Ş_pŞicy_·th_ty³_e
 
­Ş_pŞicy_·th_g‘_ty³
(cÚ¡ 
­Ş_pŞicy_·th_t
 * 
·th
);

140 cÚ¡ *
­Ş_pŞicy_·th_g‘_´im¬y
(cÚ¡ 
­Ş_pŞicy_·th_t
 * 
·th
);

152 cÚ¡ 
­Ş_veùÜ_t
 *
­Ş_pŞicy_·th_g‘_moduËs
(cÚ¡ 
­Ş_pŞicy_·th_t
 * 
·th
);

165 
­Ş_pŞicy_·th_to_fe
(cÚ¡ 
­Ş_pŞicy_·th_t
 * 
·th
, cÚ¡ *
f’ame
);

178 *
­Ş_pŞicy_·th_to_¡ršg
(cÚ¡ 
­Ş_pŞicy_·th_t
 * 
·th
);

188 
­Ş_fe_is_pŞicy_·th_li¡
(cÚ¡ *
f’ame
);

190 #ifdef 
__ılu¥lus


	@libapol/include/apol/policy-query.h

28 #iâdeà
APOL_POLICY_QUERY_H


29 
	#APOL_POLICY_QUERY_H


	)

31 #ifdef 
__ılu¥lus


39 
	#APOL_QUERY_SUB
 0x02

	)

40 
	#APOL_QUERY_SUPER
 0x04

	)

41 
	#APOL_QUERY_EXACT
 (
APOL_QUERY_SUB
|
APOL_QUERY_SUPER
è

	)

42 
	#APOL_QUERY_INTERSECT
 0x08

	)

43 
	#APOL_QUERY_FLAGS
 \

44 (
APOL_QUERY_SUB
 | 
APOL_QUERY_SUPER
 | 
APOL_QUERY_EXACT
 | \

45 
APOL_QUERY_INTERSECT
)

	)

52 
	#APOL_QUERY_SYMBOL_IS_TYPE
 0x01

	)

53 
	#APOL_QUERY_SYMBOL_IS_ATTRIBUTE
 0x02

	)

55 
	~<qpŞ/pŞicy.h
>

57 
	~"ty³-qu”y.h
"

58 
	~"şass-³rm-qu”y.h
"

59 
	~"rŞe-qu”y.h
"

60 
	~"u£r-qu”y.h
"

61 
	~"boŞ-qu”y.h
"

62 
	~"isid-qu”y.h
"

63 
	~"mls-qu”y.h
"

64 
	~"ÃtcÚ-qu”y.h
"

65 
	~"fscÚ-qu”y.h
"

66 
	~"cÚ‹xt-qu”y.h
"

67 
	~"³rmissive-qu”y.h
"

68 
	~"pŞÿp-qu”y.h
"

69 
	~"bounds-qu”y.h
"

70 
	~"deçuÉ-objeù-qu”y.h
"

72 
	~"avruË-qu”y.h
"

73 
	~"‹ruË-qu”y.h
"

74 
	~"cÚdruË-qu”y.h
"

75 
	~"rbaüuË-qu”y.h
"

76 
	~"áruË-qu”y.h
"

77 
	~"¿nge_Œªs-qu”y.h
"

78 
	~"cÚ¡¿št-qu”y.h
"

80 
	~"domaš-Œªs-ª®ysis.h
"

81 
	~"šfoæow-ª®ysis.h
"

82 
	~"»Ïb–-ª®ysis.h
"

83 
	~"ty³s-»ÏtiÚ-ª®ysis.h
"

85 #ifdef 
__ılu¥lus


	@libapol/include/apol/policy.h

29 #iâdeà
APOL_POLICY_H


30 
	#APOL_POLICY_H


	)

32 #ifdef 
__ılu¥lus


37 
	~"pŞicy-·th.h
"

38 
	~<¡d¬g.h
>

39 
	~<qpŞ/pŞicy.h
>

41 
­Ş_pŞicy
 
	t­Ş_pŞicy_t
;

43 (*
­Ş_ÿÎback_â_t
è(*
	tv¬g
, cÚ¡ 
	t­Ş_pŞicy_t
 * 
	tp
, 
	tËv–
, cÚ¡ *
	tfmt
, 
	tva_li¡
 
	t¬gp
);

51 
	#APOL_POLICY_OPTION_NO_RULES
 
QPOL_POLICY_OPTION_NO_RULES


	)

69 
­Ş_pŞicy_t
 *
­Ş_pŞicy_ü—‹_äom_pŞicy_·th
(cÚ¡ 
­Ş_pŞicy_·th_t
 * 
·th
, cÚ¡ 
İtiÚs
,

70 
­Ş_ÿÎback_â_t
 
msg_ÿÎback
, *
v¬g
);

79 
­Ş_pŞicy_de¡roy
(
­Ş_pŞicy_t
 ** 
pŞicy
);

91 
­Ş_pŞicy_g‘_pŞicy_ty³
(cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
);

100 
­Ş_pŞicy_g‘_pŞicy_hªdË_unknown
(cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
);

112 
qpŞ_pŞicy_t
 *
­Ş_pŞicy_g‘_qpŞ
(cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
);

121 
­Ş_pŞicy_is_mls
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
);

131 *
­Ş_pŞicy_g‘_v”siÚ_ty³_mls_¡r
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
);

133 
	#APOL_MSG_ERR
 1

	)

134 
	#APOL_MSG_WARN
 2

	)

135 
	#APOL_MSG_INFO
 3

	)

148 
­Ş_hªdË_msg
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
Ëv–
, cÚ¡ *
fmt
, ...);

150 
__©Œibu‹__
 ((
fÜm©
(
´štf
, 3, 4))è
­Ş_hªdË_msg
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
Ëv–
, cÚ¡ *
fmt
,

157 
	#ERR
(
p
, 
fÜm©
, ...è
	`­Ş_hªdË_msg
Õ, 
APOL_MSG_ERR
, fÜm©, 
__VA_ARGS__
)

	)

163 
	#WARN
(
p
, 
fÜm©
, ...è
	`­Ş_hªdË_msg
Õ, 
APOL_MSG_WARN
, fÜm©, 
__VA_ARGS__
)

	)

169 
	#INFO
(
p
, 
fÜm©
, ...è
	`­Ş_hªdË_msg
Õ, 
APOL_MSG_INFO
, fÜm©, 
__VA_ARGS__
)

	)

171 #ifdef 
__ılu¥lus


	@libapol/include/apol/range_trans-query.h

26 #iâdeà
APOL_RANGE_TRANS_QUERY_H


27 
	#APOL_RANGE_TRANS_QUERY_H


	)

29 #ifdef 
__ılu¥lus


34 
	~"mls_¿nge.h
"

35 
	~"pŞicy.h
"

36 
	~"veùÜ.h
"

37 
	~<qpŞ/pŞicy.h
>

39 
­Ş_¿nge_Œªs_qu”y
 
	t­Ş_¿nge_Œªs_qu”y_t
;

55 
­Ş_¿nge_Œªs_g‘_by_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
­Ş_¿nge_Œªs_qu”y_t
 * 
r
, 
­Ş_veùÜ_t
 ** 
v
);

66 
­Ş_¿nge_Œªs_qu”y_t
 *
­Ş_¿nge_Œªs_qu”y_ü—‹
();

75 
­Ş_¿nge_Œªs_qu”y_de¡roy
(
­Ş_¿nge_Œªs_qu”y_t
 ** 
r
);

94 
­Ş_¿nge_Œªs_qu”y_£t_sourû
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_¿nge_Œªs_qu”y_t
 * 
r
, cÚ¡ *
symbŞ
,

95 
is_šdœeù
);

114 
­Ş_¿nge_Œªs_qu”y_£t_rg‘
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_¿nge_Œªs_qu”y_t
 * 
r
, cÚ¡ *
symbŞ
,

115 
is_šdœeù
);

132 
­Ş_¿nge_Œªs_qu”y_­³nd_şass
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_¿nge_Œªs_qu”y_t
 * 
r
,

133 cÚ¡ *
obj_şass
);

150 
­Ş_¿nge_Œªs_qu”y_£t_¿nge
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
,

151 
­Ş_¿nge_Œªs_qu”y_t
 * 
r
, 
­Ş_mls_¿nge_t
 * 
¿nge
,

152 
¿nge_m©ch
);

166 
­Ş_¿nge_Œªs_qu”y_£t_sourû_ªy
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_¿nge_Œªs_qu”y_t
 * 
r
, 
is_ªy
);

180 
­Ş_¿nge_Œªs_qu”y_£t_»gex
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_¿nge_Œªs_qu”y_t
 * 
t
, 
is_»gex
);

192 *
­Ş_¿nge_Œªs_»nd”
(cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_¿nge_Œªs_t
 * 
ruË
);

194 #ifdef 
__ılu¥lus


	@libapol/include/apol/rbacrule-query.h

28 #iâdeà
APOL_RBACRULE_QUERY_H


29 
	#APOL_RBACRULE_QUERY_H


	)

31 #ifdef 
__ılu¥lus


36 
	~"pŞicy.h
"

37 
	~"veùÜ.h
"

38 
	~<qpŞ/pŞicy.h
>

40 
­Ş_rŞe_®low_qu”y
 
	t­Ş_rŞe_®low_qu”y_t
;

41 
­Ş_rŞe_Œªs_qu”y
 
	t­Ş_rŞe_Œªs_qu”y_t
;

58 
­Ş_rŞe_®low_g‘_by_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
­Ş_rŞe_®low_qu”y_t
 * 
r
, 
­Ş_veùÜ_t
 ** 
v
);

70 
­Ş_rŞe_®low_qu”y_t
 *
­Ş_rŞe_®low_qu”y_ü—‹
();

79 
­Ş_rŞe_®low_qu”y_de¡roy
(
­Ş_rŞe_®low_qu”y_t
 ** 
r
);

92 
­Ş_rŞe_®low_qu”y_£t_sourû
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_rŞe_®low_qu”y_t
 * 
r
, cÚ¡ *
rŞe
);

106 
­Ş_rŞe_®low_qu”y_£t_rg‘
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_rŞe_®low_qu”y_t
 * 
r
, cÚ¡ *
rŞe
);

120 
­Ş_rŞe_®low_qu”y_£t_sourû_ªy
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_rŞe_®low_qu”y_t
 * 
r
, 
is_ªy
);

133 
­Ş_rŞe_®low_qu”y_£t_»gex
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_rŞe_®low_qu”y_t
 * 
r
, 
is_»gex
);

145 *
­Ş_rŞe_®low_»nd”
(cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_rŞe_®low_t
 * 
ruË
);

163 
­Ş_rŞe_Œªs_g‘_by_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
­Ş_rŞe_Œªs_qu”y_t
 * 
r
, 
­Ş_veùÜ_t
 ** 
v
);

175 
­Ş_rŞe_Œªs_qu”y_t
 *
­Ş_rŞe_Œªs_qu”y_ü—‹
();

184 
­Ş_rŞe_Œªs_qu”y_de¡roy
(
­Ş_rŞe_Œªs_qu”y_t
 ** 
r
);

197 
­Ş_rŞe_Œªs_qu”y_£t_sourû
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_rŞe_Œªs_qu”y_t
 * 
r
, cÚ¡ *
rŞe
);

216 
­Ş_rŞe_Œªs_qu”y_£t_rg‘
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_rŞe_Œªs_qu”y_t
 * 
r
, cÚ¡ *
symbŞ
,

217 
is_šdœeù
);

231 
­Ş_rŞe_Œªs_qu”y_£t_deçuÉ
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_rŞe_Œªs_qu”y_t
 * 
r
, cÚ¡ *
rŞe
);

247 
­Ş_rŞe_Œªs_qu”y_£t_sourû_ªy
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_rŞe_Œªs_qu”y_t
 * 
r
, 
is_ªy
);

261 
­Ş_rŞe_Œªs_qu”y_£t_»gex
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_rŞe_Œªs_qu”y_t
 * 
r
, 
is_»gex
);

273 *
­Ş_rŞe_Œªs_»nd”
(cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_rŞe_Œªs_t
 * 
ruË
);

275 #ifdef 
__ılu¥lus


	@libapol/include/apol/relabel-analysis.h

26 #iâdeà
APOL_RELABEL_ANALYSIS_H


27 
	#APOL_RELABEL_ANALYSIS_H


	)

29 #ifdef 
__ılu¥lus


34 
	~"pŞicy.h
"

35 
	~"veùÜ.h
"

36 
	~<qpŞ/pŞicy.h
>

39 
	#APOL_RELABEL_DIR_TO
 0x01

	)

40 
	#APOL_RELABEL_DIR_FROM
 0x02

	)

41 
	#APOL_RELABEL_DIR_BOTH
 (
APOL_RELABEL_DIR_TO
|
APOL_RELABEL_DIR_FROM
)

	)

42 
	#APOL_RELABEL_DIR_SUBJECT
 0x04

	)

44 
­Ş_»Ïb–_ª®ysis
 
	t­Ş_»Ïb–_ª®ysis_t
;

45 
­Ş_»Ïb–_»suÉ
 
	t­Ş_»Ïb–_»suÉ_t
;

46 
­Ş_»Ïb–_»suÉ_·œ
 
	t­Ş_»Ïb–_»suÉ_·œ_t
;

62 
­Ş_»Ïb–_ª®ysis_do
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_»Ïb–_ª®ysis_t
 * 
r
, 
­Ş_veùÜ_t
 ** 
v
);

73 
­Ş_»Ïb–_ª®ysis_t
 *
­Ş_»Ïb–_ª®ysis_ü—‹
();

82 
­Ş_»Ïb–_ª®ysis_de¡roy
(
­Ş_»Ïb–_ª®ysis_t
 ** 
r
);

96 
­Ş_»Ïb–_ª®ysis_£t_dœ
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_»Ïb–_ª®ysis_t
 * 
r
, 
dœ
);

108 
­Ş_»Ïb–_ª®ysis_£t_ty³
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_»Ïb–_ª®ysis_t
 * 
r
, cÚ¡ *
Çme
);

124 
­Ş_»Ïb–_ª®ysis_­³nd_şass
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_»Ïb–_ª®ysis_t
 * 
r
, cÚ¡ *
obj_şass
);

141 
­Ş_»Ïb–_ª®ysis_­³nd_subjeù
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_»Ïb–_ª®ysis_t
 * 
r
, cÚ¡ *
subjeù
);

154 
­Ş_»Ïb–_ª®ysis_£t_»suÉ_»gex
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_»Ïb–_ª®ysis_t
 * 
r
, cÚ¡ *
»suÉ
);

168 cÚ¡ 
­Ş_veùÜ_t
 *
­Ş_»Ïb–_»suÉ_g‘_to
(cÚ¡ 
­Ş_»Ïb–_»suÉ_t
 * 
r
);

181 cÚ¡ 
­Ş_veùÜ_t
 *
­Ş_»Ïb–_»suÉ_g‘_äom
(cÚ¡ 
­Ş_»Ïb–_»suÉ_t
 * 
r
);

194 cÚ¡ 
­Ş_veùÜ_t
 *
­Ş_»Ïb–_»suÉ_g‘_bÙh
(cÚ¡ 
­Ş_»Ïb–_»suÉ_t
 * 
r
);

203 cÚ¡ 
qpŞ_ty³_t
 *
­Ş_»Ïb–_»suÉ_g‘_»suÉ_ty³
(cÚ¡ 
­Ş_»Ïb–_»suÉ_t
 * 
r
);

220 cÚ¡ 
qpŞ_avruË_t
 *
­Ş_»Ïb–_»suÉ_·œ_g‘_ruËA
(cÚ¡ 
­Ş_»Ïb–_»suÉ_·œ_t
 * 
p
);

236 cÚ¡ 
qpŞ_avruË_t
 *
­Ş_»Ïb–_»suÉ_·œ_g‘_ruËB
(cÚ¡ 
­Ş_»Ïb–_»suÉ_·œ_t
 * 
p
);

252 cÚ¡ 
qpŞ_ty³_t
 *
­Ş_»Ïb–_»suÉ_·œ_g‘_š‹rmedŸ‹_ty³
(cÚ¡ 
­Ş_»Ïb–_»suÉ_·œ_t
 * 
p
);

254 #ifdef 
__ılu¥lus


	@libapol/include/apol/render.h

30 #iâdeà
APOL_RENDER_H


31 
	#APOL_RENDER_H


	)

33 #ifdef 
__ılu¥lus


38 
	~"pŞicy.h
"

39 
	~"mls-qu”y.h
"

40 
	~<qpŞ/pŞicy.h
>

41 
	~<¡dlib.h
>

53 *
­Ş_v4_addr_»nd”
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
ušt32_t
 
addr
[4]);

65 *
­Ş_v6_addr_»nd”
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
ušt32_t
 
addr
[4]);

76 *
­Ş_qpŞ_cÚ‹xt_»nd”
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
qpŞ_cÚ‹xt_t
 * 
cÚ‹xt
);

78 #ifdef 
__ılu¥lus


	@libapol/include/apol/role-query.h

25 #iâdeà
APOL_ROLE_QUERY_H


26 
	#APOL_ROLE_QUERY_H


	)

28 #ifdef 
__ılu¥lus


33 
	~"pŞicy.h
"

34 
	~"veùÜ.h
"

35 
	~<qpŞ/pŞicy.h
>

37 
­Ş_rŞe_qu”y
 
	t­Ş_rŞe_qu”y_t
;

54 
­Ş_rŞe_g‘_by_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_rŞe_qu”y_t
 * 
r
, 
­Ş_veùÜ_t
 ** 
v
);

64 
­Ş_rŞe_qu”y_t
 *
­Ş_rŞe_qu”y_ü—‹
();

73 
­Ş_rŞe_qu”y_de¡roy
(
­Ş_rŞe_qu”y_t
 ** 
r
);

86 
­Ş_rŞe_qu”y_£t_rŞe
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_rŞe_qu”y_t
 * 
r
, cÚ¡ *
Çme
);

99 
­Ş_rŞe_qu”y_£t_ty³
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_rŞe_qu”y_t
 * 
r
, cÚ¡ *
Çme
);

111 
­Ş_rŞe_qu”y_£t_»gex
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_rŞe_qu”y_t
 * 
r
, 
is_»gex
);

121 
­Ş_rŞe_has_ty³
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
qpŞ_rŞe_t
 * 
r
, cÚ¡ 
qpŞ_ty³_t
 * 
t
);

123 #ifdef 
__ılu¥lus


	@libapol/include/apol/terule-query.h

27 #iâdeà
APOL_TERULE_QUERY_H


28 
	#APOL_TERULE_QUERY_H


	)

30 #ifdef 
__ılu¥lus


35 
	~"pŞicy.h
"

36 
	~"veùÜ.h
"

37 
	~<qpŞ/pŞicy.h
>

39 
­Ş_‹ruË_qu”y
 
	t­Ş_‹ruË_qu”y_t
;

54 
­Ş_‹ruË_g‘_by_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
­Ş_‹ruË_qu”y_t
 * 
t
, 
­Ş_veùÜ_t
 ** 
v
);

72 
­Ş_syn_‹ruË_g‘_by_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
­Ş_‹ruË_qu”y_t
 * 
t
, 
­Ş_veùÜ_t
 ** 
v
);

82 
­Ş_‹ruË_qu”y_t
 *
­Ş_‹ruË_qu”y_ü—‹
();

91 
­Ş_‹ruË_qu”y_de¡roy
(
­Ş_‹ruË_qu”y_t
 ** 
t
);

106 
­Ş_‹ruË_qu”y_£t_ruËs
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_‹ruË_qu”y_t
 * 
t
, 
ruËs
);

125 
­Ş_‹ruË_qu”y_£t_sourû
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_‹ruË_qu”y_t
 * 
t
, cÚ¡ *
symbŞ
,

126 
is_šdœeù
);

141 
­Ş_‹ruË_qu”y_£t_sourû_compÚ’t
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_‹ruË_qu”y_t
 * 
t
, 
compÚ’t
);

160 
­Ş_‹ruË_qu”y_£t_rg‘
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_‹ruË_qu”y_t
 * 
t
, cÚ¡ *
symbŞ
,

161 
is_šdœeù
);

176 
­Ş_‹ruË_qu”y_£t_rg‘_compÚ’t
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_‹ruË_qu”y_t
 * 
t
, 
compÚ’t
);

189 
­Ş_‹ruË_qu”y_£t_deçuÉ
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_‹ruË_qu”y_t
 * 
t
, cÚ¡ *
ty³
);

206 
­Ş_‹ruË_qu”y_­³nd_şass
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_‹ruË_qu”y_t
 * 
t
, cÚ¡ *
obj_şass
);

220 
­Ş_‹ruË_qu”y_£t_boŞ
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_‹ruË_qu”y_t
 * 
t
, cÚ¡ *
boŞ_Çme
);

234 
­Ş_‹ruË_qu”y_£t_’abËd
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_‹ruË_qu”y_t
 * 
t
, 
is_’abËd
);

248 
­Ş_‹ruË_qu”y_£t_sourû_ªy
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_‹ruË_qu”y_t
 * 
t
, 
is_ªy
);

262 
­Ş_‹ruË_qu”y_£t_»gex
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_‹ruË_qu”y_t
 * 
t
, 
is_»gex
);

276 
­Ş_veùÜ_t
 *
­Ş_‹ruË_to_syn_‹ruËs
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
qpŞ_‹ruË_t
 * 
ruË
);

291 
­Ş_veùÜ_t
 *
­Ş_‹ruË_li¡_to_syn_‹ruËs
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡‡pŞ_veùÜ_ˆ* 
ruËs
);

303 *
­Ş_‹ruË_»nd”
(cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_‹ruË_t
 * 
ruË
);

315 *
­Ş_syn_‹ruË_»nd”
(cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_syn_‹ruË_t
 * 
ruË
);

317 #ifdef 
__ılu¥lus


	@libapol/include/apol/type-query.h

26 #iâdeà
APOL_TYPE_QUERY_H


27 
	#APOL_TYPE_QUERY_H


	)

29 #ifdef 
__ılu¥lus


34 
	~"pŞicy.h
"

35 
	~"veùÜ.h
"

36 
	~<qpŞ/pŞicy.h
>

38 
­Ş_ty³_qu”y
 
	t­Ş_ty³_qu”y_t
;

39 
­Ş_©Œ_qu”y
 
	t­Ş_©Œ_qu”y_t
;

57 
­Ş_ty³_g‘_by_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_ty³_qu”y_t
 * 
t
, 
­Ş_veùÜ_t
 ** 
v
);

67 
­Ş_ty³_qu”y_t
 *
­Ş_ty³_qu”y_ü—‹
();

76 
­Ş_ty³_qu”y_de¡roy
(
­Ş_ty³_qu”y_t
 ** 
t
);

90 
­Ş_ty³_qu”y_£t_ty³
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_ty³_qu”y_t
 * 
t
, cÚ¡ *
Çme
);

103 
­Ş_ty³_qu”y_£t_»gex
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_ty³_qu”y_t
 * 
t
, 
is_»gex
);

121 
­Ş_©Œ_g‘_by_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_©Œ_qu”y_t
 * 
a
, 
­Ş_veùÜ_t
 ** 
v
);

131 
­Ş_©Œ_qu”y_t
 *
­Ş_©Œ_qu”y_ü—‹
();

140 
­Ş_©Œ_qu”y_de¡roy
(
­Ş_©Œ_qu”y_t
 ** 
a
);

153 
­Ş_©Œ_qu”y_£t_©Œ
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_©Œ_qu”y_t
 * 
a
, cÚ¡ *
Çme
);

166 
­Ş_©Œ_qu”y_£t_»gex
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_©Œ_qu”y_t
 * 
a
, 
is_»gex
);

168 #ifdef 
__ılu¥lus


	@libapol/include/apol/types-relation-analysis.h

26 #iâdeà
APOL_TYPES_RELATION_ANALYSIS_H


27 
	#APOL_TYPES_RELATION_ANALYSIS_H


	)

29 #ifdef 
__ılu¥lus


34 
	~"pŞicy.h
"

35 
	~"veùÜ.h
"

36 
	~<qpŞ/pŞicy.h
>

41 
	#APOL_TYPES_RELATION_COMMON_ATTRIBS
 0x0001

	)

42 
	#APOL_TYPES_RELATION_COMMON_ROLES
 0x0002

	)

43 
	#APOL_TYPES_RELATION_COMMON_USERS
 0x0004

	)

44 
	#APOL_TYPES_RELATION_SIMILAR_ACCESS
 0x0010

	)

45 
	#APOL_TYPES_RELATION_DISSIMILAR_ACCESS
 0x0020

	)

46 
	#APOL_TYPES_RELATION_ALLOW_RULES
 0x0100

	)

47 
	#APOL_TYPES_RELATION_TYPE_RULES
 0x0200

	)

48 
	#APOL_TYPES_RELATION_DOMAIN_TRANS_AB
 0x0400

	)

49 
	#APOL_TYPES_RELATION_DOMAIN_TRANS_BA
 0x0800

	)

50 
	#APOL_TYPES_RELATION_DIRECT_FLOW
 0x1000

	)

51 
	#APOL_TYPES_RELATION_TRANS_FLOW_AB
 0x4000

	)

52 
	#APOL_TYPES_RELATION_TRANS_FLOW_BA
 0x8000

	)

54 
­Ş_ty³s_»ÏtiÚ_ª®ysis
 
	t­Ş_ty³s_»ÏtiÚ_ª®ysis_t
;

55 
­Ş_ty³s_»ÏtiÚ_»suÉ
 
	t­Ş_ty³s_»ÏtiÚ_»suÉ_t
;

56 
­Ş_ty³s_»ÏtiÚ_acûss
 
	t­Ş_ty³s_»ÏtiÚ_acûss_t
;

73 
­Ş_ty³s_»ÏtiÚ_ª®ysis_do
(
­Ş_pŞicy_t
 * 
p
,

74 cÚ¡ 
­Ş_ty³s_»ÏtiÚ_ª®ysis_t
 * 
Œ
, 
­Ş_ty³s_»ÏtiÚ_»suÉ_t
 ** 
r
);

86 
­Ş_ty³s_»ÏtiÚ_ª®ysis_t
 *
­Ş_ty³s_»ÏtiÚ_ª®ysis_ü—‹
();

96 
­Ş_ty³s_»ÏtiÚ_ª®ysis_de¡roy
(
­Ş_ty³s_»ÏtiÚ_ª®ysis_t
 ** 
Œ
);

108 
­Ş_ty³s_»ÏtiÚ_ª®ysis_£t_fœ¡_ty³
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_ty³s_»ÏtiÚ_ª®ysis_t
 * 
Œ
,

109 cÚ¡ *
Çme
);

121 
­Ş_ty³s_»ÏtiÚ_ª®ysis_£t_Ùh”_ty³
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_ty³s_»ÏtiÚ_ª®ysis_t
 * 
Œ
,

122 cÚ¡ *
Çme
);

137 
­Ş_ty³s_»ÏtiÚ_ª®ysis_£t_ª®y£s
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_ty³s_»ÏtiÚ_ª®ysis_t
 * 
Œ
,

138 
ª®y£s
);

150 
­Ş_ty³s_»ÏtiÚ_»suÉ_de¡roy
(
­Ş_ty³s_»ÏtiÚ_»suÉ_t
 ** 
»suÉ
);

164 cÚ¡ 
­Ş_veùÜ_t
 *
­Ş_ty³s_»ÏtiÚ_»suÉ_g‘_©Œibu‹s
(cÚ¡ 
­Ş_ty³s_»ÏtiÚ_»suÉ_t
 * 
»suÉ
);

176 cÚ¡ 
­Ş_veùÜ_t
 *
­Ş_ty³s_»ÏtiÚ_»suÉ_g‘_rŞes
(cÚ¡ 
­Ş_ty³s_»ÏtiÚ_»suÉ_t
 * 
»suÉ
);

188 cÚ¡ 
­Ş_veùÜ_t
 *
­Ş_ty³s_»ÏtiÚ_»suÉ_g‘_u£rs
(cÚ¡ 
­Ş_ty³s_»ÏtiÚ_»suÉ_t
 * 
»suÉ
);

204 cÚ¡ 
­Ş_veùÜ_t
 *
­Ş_ty³s_»ÏtiÚ_»suÉ_g‘_sim¬_fœ¡
(cÚ¡ 
­Ş_ty³s_»ÏtiÚ_»suÉ_t
 * 
»suÉ
);

220 cÚ¡ 
­Ş_veùÜ_t
 *
­Ş_ty³s_»ÏtiÚ_»suÉ_g‘_sim¬_Ùh”
(cÚ¡ 
­Ş_ty³s_»ÏtiÚ_»suÉ_t
 * 
»suÉ
);

236 cÚ¡ 
­Ş_veùÜ_t
 *
­Ş_ty³s_»ÏtiÚ_»suÉ_g‘_dissim¬_fœ¡
(cÚ¡ 
­Ş_ty³s_»ÏtiÚ_»suÉ_t
 * 
»suÉ
);

252 cÚ¡ 
­Ş_veùÜ_t
 *
­Ş_ty³s_»ÏtiÚ_»suÉ_g‘_dissim¬_Ùh”
(cÚ¡ 
­Ş_ty³s_»ÏtiÚ_»suÉ_t
 * 
»suÉ
);

265 cÚ¡ 
­Ş_veùÜ_t
 *
­Ş_ty³s_»ÏtiÚ_»suÉ_g‘_®lowruËs
(cÚ¡ 
­Ş_ty³s_»ÏtiÚ_»suÉ_t
 * 
»suÉ
);

279 cÚ¡ 
­Ş_veùÜ_t
 *
­Ş_ty³s_»ÏtiÚ_»suÉ_g‘_ty³ruËs
(cÚ¡ 
­Ş_ty³s_»ÏtiÚ_»suÉ_t
 * 
»suÉ
);

294 cÚ¡ 
­Ş_veùÜ_t
 *
­Ş_ty³s_»ÏtiÚ_»suÉ_g‘_dœeùæows
(cÚ¡ 
­Ş_ty³s_»ÏtiÚ_»suÉ_t
 * 
»suÉ
);

309 cÚ¡ 
­Ş_veùÜ_t
 *
­Ş_ty³s_»ÏtiÚ_»suÉ_g‘_ŒªsæowsAB
(cÚ¡ 
­Ş_ty³s_»ÏtiÚ_»suÉ_t
 * 
»suÉ
);

324 cÚ¡ 
­Ş_veùÜ_t
 *
­Ş_ty³s_»ÏtiÚ_»suÉ_g‘_ŒªsæowsBA
(cÚ¡ 
­Ş_ty³s_»ÏtiÚ_»suÉ_t
 * 
»suÉ
);

339 cÚ¡ 
­Ş_veùÜ_t
 *
­Ş_ty³s_»ÏtiÚ_»suÉ_g‘_domašsAB
(cÚ¡ 
­Ş_ty³s_»ÏtiÚ_»suÉ_t
 * 
»suÉ
);

354 cÚ¡ 
­Ş_veùÜ_t
 *
­Ş_ty³s_»ÏtiÚ_»suÉ_g‘_domašsBA
(cÚ¡ 
­Ş_ty³s_»ÏtiÚ_»suÉ_t
 * 
»suÉ
);

363 cÚ¡ 
qpŞ_ty³_t
 *
­Ş_ty³s_»ÏtiÚ_acûss_g‘_ty³
(cÚ¡ 
­Ş_ty³s_»ÏtiÚ_acûss_t
 * 
a
);

374 cÚ¡ 
­Ş_veùÜ_t
 *
­Ş_ty³s_»ÏtiÚ_acûss_g‘_ruËs
(cÚ¡ 
­Ş_ty³s_»ÏtiÚ_acûss_t
 * 
a
);

376 #ifdef 
__ılu¥lus


	@libapol/include/apol/user-query.h

25 #iâdeà
APOL_USER_QUERY_H


26 
	#APOL_USER_QUERY_H


	)

28 #ifdef 
__ılu¥lus


33 
	~"pŞicy.h
"

34 
	~"veùÜ.h
"

35 
	~"mls-qu”y.h
"

36 
	~<qpŞ/pŞicy.h
>

38 
­Ş_u£r_qu”y
 
	t­Ş_u£r_qu”y_t
;

55 
­Ş_u£r_g‘_by_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_u£r_qu”y_t
 * 
u
, 
­Ş_veùÜ_t
 ** 
v
);

65 
­Ş_u£r_qu”y_t
 *
­Ş_u£r_qu”y_ü—‹
();

74 
­Ş_u£r_qu”y_de¡roy
(
­Ş_u£r_qu”y_t
 ** 
u
);

87 
­Ş_u£r_qu”y_£t_u£r
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_u£r_qu”y_t
 * 
u
, cÚ¡ *
Çme
);

100 
­Ş_u£r_qu”y_£t_rŞe
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_u£r_qu”y_t
 * 
u
, cÚ¡ *
rŞe
);

114 
­Ş_u£r_qu”y_£t_deçuÉ_Ëv–
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_u£r_qu”y_t
 * 
u
, 
­Ş_mls_Ëv–_t
 * 
Ëv–
);

131 
­Ş_u£r_qu”y_£t_¿nge
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_u£r_qu”y_t
 * 
u
, 
­Ş_mls_¿nge_t
 * 
¿nge
,

132 
¿nge_m©ch
);

144 
­Ş_u£r_qu”y_£t_»gex
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_u£r_qu”y_t
 * 
u
, 
is_»gex
);

146 #ifdef 
__ılu¥lus


	@libapol/include/apol/util.h

26 #iâdeà
APOL_UTIL_H


27 
	#APOL_UTIL_H


	)

29 #ifdef 
__ılu¥lus


34 
	~"veùÜ.h
"

36 
	~<¡dšt.h
>

37 
	~<¡dio.h
>

38 
	~<¡dlib.h
>

45 cÚ¡ *
lib­Ş_g‘_v”siÚ
();

57 cÚ¡ *
­Ş_´ÙocŞ_to_¡r
(
ušt8_t
 
´ÙocŞ
);

67 
ušt8_t
 
­Ş_¡r_to_´ÙocŞ
(cÚ¡ *
´ÙocŞ_¡r
);

82 
­Ş_¡r_to_š‹º®_
(cÚ¡ *
¡r
, 
ušt32_t
 

[4]);

96 cÚ¡ *
­Ş_objşass_to_¡r
(
ušt32_t
 
objşass
);

109 
ušt32_t
 
­Ş_¡r_to_objşass
(cÚ¡ *
objşass
);

121 cÚ¡ *
­Ş_fs_u£_behaviÜ_to_¡r
(
ušt32_t
 
behaviÜ
);

133 
­Ş_¡r_to_fs_u£_behaviÜ
(cÚ¡ *
behaviÜ
);

145 cÚ¡ *
­Ş_ruË_ty³_to_¡r
(
ušt32_t
 
ruË_ty³
);

157 cÚ¡ *
­Ş_cÚd_ex´_ty³_to_¡r
(
ušt32_t
 
ex´_ty³
);

170 *
­Ş_fe_fšd
(cÚ¡ *
fe_Çme
);

183 *
­Ş_fe_fšd_·th
(cÚ¡ *
fe_Çme
);

194 *
­Ş_fe_fšd_u£r_cÚfig
(cÚ¡ *
fe_Çme
);

206 
­Ş_fe_»ad_to_bufãr
(cÚ¡ *
âame
, **
buf
, 
size_t
 * 
Ën
);

219 *
­Ş_cÚfig_g‘_v¬
(cÚ¡ *
v¬
, 
FILE
 * 
å
);

234 
­Ş_veùÜ_t
 *
­Ş_¡r_¥l™
(cÚ¡ *
s
, cÚ¡ *
d–im
);

248 *
­Ş_¡r_još
(cÚ¡ 
­Ş_veùÜ_t
 * 
li¡
, cÚ¡ *
d–im
);

256 
­Ş_¡r_Œim
(*
¡r
);

275 
­Ş_¡r_­³nd
(**
tgt
, 
size_t
 * 
tgt_sz
, cÚ¡ *
¡r
);

296 
­Ş_¡r_­³ndf
(**
tgt
, 
size_t
 * 
tgt_sz
, cÚ¡ *
fmt
, ...);

299 
­Ş_¡r_­³ndf
(**
tgt
, 
size_t
 * 
tgt_sz
, cÚ¡ *
fmt
, ...è
__©Œibu‹__
 ((
fÜm©
(
´štf
, 3, 4)));

307 
­Ş_¡r_is_Úly_wh™e_¥aû
(cÚ¡ *
¡r
);

320 
­Ş_¡r_¡rcmp
(cÚ¡ *
a
, cÚ¡ *
b
, *
unu£d
 
__©Œibu‹__
 ((unused)));

330 *
­Ş_¡r_¡rdup
(cÚ¡ *
–em
, *
unu£d
 
__©Œibu‹__
 ((unused)));

332 #ifdef 
__ılu¥lus


	@libapol/include/apol/vector.h

26 #iâdeà
APOL_VECTOR_H


27 
	#APOL_VECTOR_H


	)

29 #ifdef 
__ılu¥lus


34 
	~<¡dlib.h
>

35 
	~<qpŞ/™”©Ü.h
>

37 
­Ş_veùÜ
 
	t­Ş_veùÜ_t
;

39 (
­Ş_veùÜ_comp_func
è(cÚ¡ *
	ta
, cÚ¡ *
	tb
, *
	td©a
);

40 (
­Ş_veùÜ_ä“_func
è(*
	t–em
);

41 *(
	t­Ş_veùÜ_dup_func
è(cÚ¡ *
	t–em
, *
	td©a
);

56 
­Ş_veùÜ_t
 *
­Ş_veùÜ_ü—‹
(
­Ş_veùÜ_ä“_func
 * 
ä
);

73 
­Ş_veùÜ_t
 *
­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(
size_t
 
ÿp
, 
­Ş_veùÜ_ä“_func
 * 
ä
);

94 
­Ş_veùÜ_t
 *
­Ş_veùÜ_ü—‹_äom_™”
(
qpŞ_™”©Ü_t
 * 
™”
, 
­Ş_veùÜ_ä“_func
 * 
ä
);

115 
­Ş_veùÜ_t
 *
­Ş_veùÜ_ü—‹_äom_veùÜ
(cÚ¡‡pŞ_veùÜ_ˆ* 
v
, 
­Ş_veùÜ_dup_func
 * 
dup
, *
d©a
,

116 
­Ş_veùÜ_ä“_func
 * 
ä
);

142 
­Ş_veùÜ_t
 *
­Ş_veùÜ_ü—‹_äom_š‹r£ùiÚ
(cÚ¡‡pŞ_veùÜ_ˆ* 
v1
,

143 cÚ¡ 
­Ş_veùÜ_t
 * 
v2
, 
­Ş_veùÜ_comp_func
 * 
cmp
,

144 *
d©a
);

155 
­Ş_veùÜ_de¡roy
(
­Ş_veùÜ_t
 ** 
v
);

166 
size_t
 
­Ş_veùÜ_g‘_size
(cÚ¡ 
­Ş_veùÜ_t
 * 
v
);

178 
size_t
 
­Ş_veùÜ_g‘_ÿ·c™y
(cÚ¡ 
­Ş_veùÜ_t
 * 
v
);

189 *
­Ş_veùÜ_g‘_–em’t
(cÚ¡ 
­Ş_veùÜ_t
 * 
v
, 
size_t
 
idx
);

211 
­Ş_veùÜ_g‘_šdex
(cÚ¡ 
­Ş_veùÜ_t
 * 
v
, cÚ¡ *
–em
, 
­Ş_veùÜ_comp_func
 * 
cmp
, *
d©a
,

212 
size_t
 * 
i
);

224 
­Ş_veùÜ_­³nd
(
­Ş_veùÜ_t
 * 
v
, *
–em
);

246 
­Ş_veùÜ_­³nd_unique
(
­Ş_veùÜ_t
 * 
v
, *
–em
, 
­Ş_veùÜ_comp_func
 * 
cmp
, *
d©a
);

257 
­Ş_veùÜ_ÿt
(
­Ş_veùÜ_t
 * 
de¡
, cÚ¡‡pŞ_veùÜ_ˆ* 
¤c
);

269 
­Ş_veùÜ_»move
(
­Ş_veùÜ_t
 * 
v
, cÚ¡ 
size_t
 
idx
);

294 
­Ş_veùÜ_com·»
(cÚ¡ 
­Ş_veùÜ_t
 * 
a
, cÚ¡‡pŞ_veùÜ_ˆ* 
b
, 
­Ş_veùÜ_comp_func
 * 
cmp
, *
d©a
,

295 
size_t
 * 
i
);

311 
­Ş_veùÜ_sÜt
(
­Ş_veùÜ_t
 * 
v
, 
­Ş_veùÜ_comp_func
 * 
cmp
, *
d©a
);

329 
­Ş_veùÜ_sÜt_uniquify
(
­Ş_veùÜ_t
 * 
v
, 
­Ş_veùÜ_comp_func
 * 
cmp
, *
d©a
);

331 #ifdef 
__ılu¥lus


	@libapol/src/avrule-query.c

30 
	~"pŞicy-qu”y-š‹º®.h
"

31 
	~<­Ş/b¡.h
>

32 
	~<qpŞ/pŞicy_ex‹nd.h
>

33 
	~<”ºo.h
>

34 
	~<¡ršg.h
>

36 
	s­Ş_avruË_qu”y


38 *
	msourû
, *
	mrg‘
, *
	mboŞ_Çme
;

39 
­Ş_veùÜ_t
 *
	mşas£s
, *
	m³rms
;

40 
	mruËs
;

41 
	mæags
;

62 
	$ruË_£Ëù
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_veùÜ_t
 * 
v
, 
ušt32_t
 
ruË_ty³
, 
æags
,

63 cÚ¡ 
­Ş_veùÜ_t
 * 
sourû_li¡
, cÚ¡‡pŞ_veùÜ_ˆ* 
rg‘_li¡
, cÚ¡‡pŞ_veùÜ_ˆ* 
şass_li¡
,

64 cÚ¡ 
­Ş_veùÜ_t
 * 
³rm_li¡
, cÚ¡ *
boŞ_Çme
)

66 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
, *
³rm_™”
 = NULL;

67 cÚ¡ 
Úly_’abËd
 = 
æags
 & 
APOL_QUERY_ONLY_ENABLED
;

68 cÚ¡ 
is_»gex
 = 
æags
 & 
APOL_QUERY_REGEX
;

69 cÚ¡ 
sourû_as_ªy
 = 
æags
 & 
APOL_QUERY_SOURCE_AS_ANY
;

70 
size_t
 
num_³rms_to_m©ch
 = 1;

71 
»tv
 = -1;

72 
»gex_t
 *
boŞ_»gex
 = 
NULL
;

74 ià((
æags
 & 
APOL_QUERY_MATCH_ALL_PERMS
è&& 
³rm_li¡
 !ğ
NULL
) {

75 
num_³rms_to_m©ch
 = 
	`­Ş_veùÜ_g‘_size
(
³rm_li¡
);

77 ià(
	`qpŞ_pŞicy_g‘_avruË_™”
(
p
->p, 
ruË_ty³
, &
™”
) < 0) {

78 
ş—nup
;

80 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

81 
qpŞ_avruË_t
 *
ruË
;

82 
ušt32_t
 
is_’abËd
;

83 cÚ¡ 
qpŞ_cÚd_t
 *
cÚd
 = 
NULL
;

84 
m©ch_sourû
 = 0, 
m©ch_rg‘
 = 0, 
m©ch_boŞ
 = 0;

85 
size_t
 
m©ch_³rm
 = 0, 
i
;

86 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
ruË
) < 0) {

87 
ş—nup
;

90 ià(
	`qpŞ_avruË_g‘_is_’abËd
(
p
->p, 
ruË
, &
is_’abËd
) < 0) {

91 
ş—nup
;

93 ià(!
is_’abËd
 && 
Úly_’abËd
) {

97 ià(
boŞ_Çme
 !ğ
NULL
) {

98 ià(
	`qpŞ_avruË_g‘_cÚd
(
p
->p, 
ruË
, &
cÚd
) < 0) {

99 
ş—nup
;

101 ià(
cÚd
 =ğ
NULL
) {

104 
m©ch_boŞ
 = 
	`­Ş_com·»_cÚd_ex´
(
p
, 
cÚd
, 
boŞ_Çme
, 
is_»gex
, &
boŞ_»gex
);

105 ià(
m©ch_boŞ
 < 0) {

106 
ş—nup
;

107 } ià(
m©ch_boŞ
 == 0) {

112 ià(
sourû_li¡
 =ğ
NULL
) {

113 
m©ch_sourû
 = 1;

115 cÚ¡ 
qpŞ_ty³_t
 *
sourû_ty³
;

116 ià(
	`qpŞ_avruË_g‘_sourû_ty³
(
p
->p, 
ruË
, &
sourû_ty³
) < 0) {

117 
ş—nup
;

119 ià(
	`­Ş_veùÜ_g‘_šdex
(
sourû_li¡
, 
sourû_ty³
, 
NULL
, NULL, &
i
) == 0) {

120 
m©ch_sourû
 = 1;

127 ià(!
sourû_as_ªy
 && !
m©ch_sourû
) {

131 ià(
rg‘_li¡
 =ğ
NULL
 || (
sourû_as_ªy
 && 
m©ch_sourû
)) {

132 
m©ch_rg‘
 = 1;

134 cÚ¡ 
qpŞ_ty³_t
 *
rg‘_ty³
;

135 ià(
	`qpŞ_avruË_g‘_rg‘_ty³
(
p
->p, 
ruË
, &
rg‘_ty³
) < 0) {

136 
ş—nup
;

138 ià(
	`­Ş_veùÜ_g‘_šdex
(
rg‘_li¡
, 
rg‘_ty³
, 
NULL
, NULL, &
i
) == 0) {

139 
m©ch_rg‘
 = 1;

143 ià(!
m©ch_rg‘
) {

147 ià(
şass_li¡
 !ğ
NULL
) {

148 cÚ¡ 
qpŞ_şass_t
 *
obj_şass
;

149 ià(
	`qpŞ_avruË_g‘_objeù_şass
(
p
->p, 
ruË
, &
obj_şass
) < 0) {

150 
ş—nup
;

152 ià(
	`­Ş_veùÜ_g‘_šdex
(
şass_li¡
, 
obj_şass
, 
NULL
, NULL, &
i
) < 0) {

157 ià(
³rm_li¡
 !ğ
NULL
) {

158 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
³rm_li¡
è&& 
m©ch_³rm
 < 
num_³rms_to_m©ch
; i++) {

159 *
³rm
 = (*)
	`­Ş_veùÜ_g‘_–em’t
(
³rm_li¡
, 
i
);

160 ià(
	`qpŞ_avruË_g‘_³rm_™”
(
p
->p, 
ruË
, &
³rm_™”
) < 0) {

161 
ş—nup
;

163 
m©ch
 = 
	`­Ş_com·»_™”
(
p
, 
³rm_™”
, 
³rm
, 0, 
NULL
, 1);

164 ià(
m©ch
 < 0) {

165 
ş—nup
;

166 } ià(
m©ch
 > 0) {

167 
m©ch_³rm
++;

169 
	`qpŞ_™”©Ü_de¡roy
(&
³rm_™”
);

172 
m©ch_³rm
 = 
num_³rms_to_m©ch
;

174 ià(
m©ch_³rm
 < 
num_³rms_to_m©ch
) {

178 ià(
	`­Ş_veùÜ_­³nd
(
v
, 
ruË
)) {

179 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

180 
ş—nup
;

184 
»tv
 = 0;

185 
ş—nup
:

186 
	`­Ş_»gex_de¡roy
(&
boŞ_»gex
);

187 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

188 
	`qpŞ_™”©Ü_de¡roy
(&
³rm_™”
);

189  
»tv
;

190 
	}
}

192 
	$­Ş_avruË_g‘_by_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
­Ş_avruË_qu”y_t
 * 
a
, 
­Ş_veùÜ_t
 ** 
v
)

194 
­Ş_veùÜ_t
 *
sourû_li¡
 = 
NULL
, *
rg‘_li¡
 = NULL, *
şass_li¡
 = NULL, *
³rm_li¡
 = NULL;

195 
»tv®
 = -1, 
sourû_as_ªy
 = 0, 
is_»gex
 = 0;

196 *
boŞ_Çme
 = 
NULL
;

197 *
v
 = 
NULL
;

198 
æags
 = 0;

200 
ušt32_t
 
ruË_ty³
 = 
QPOL_RULE_ALLOW
 | 
QPOL_RULE_AUDITALLOW
 | 
QPOL_RULE_DONTAUDIT
;

202 
ruË_ty³
 |ğ
QPOL_RULE_NEVERALLOW
;

204 ià(
a
 !ğ
NULL
) {

205 ià(
a
->
ruËs
 != 0) {

206 
ruË_ty³
 &ğ
a
->
ruËs
;

208 
æags
 = 
a
->flags;

209 
is_»gex
 = 
a
->
æags
 & 
APOL_QUERY_REGEX
;

210 
boŞ_Çme
 = 
a
->bool_name;

211 ià(
a
->
sourû
 !ğ
NULL
 &&

212 (
sourû_li¡
 =

213 
	`­Ş_qu”y_ü—‹_ÿndid©e_ty³_li¡
(
p
, 
a
->
sourû
, 
is_»gex
,

214 
a
->
æags
 & 
APOL_QUERY_SOURCE_INDIRECT
,

215 ((
a
->
æags
 & (
APOL_QUERY_SOURCE_TYPE
 | 
APOL_QUERY_SOURCE_ATTRIBUTE
)) /

216 
APOL_QUERY_SOURCE_TYPE
))è=ğ
NULL
) {

217 
ş—nup
;

219 ià((
a
->
æags
 & 
APOL_QUERY_SOURCE_AS_ANY
è&&‡->
sourû
 !ğ
NULL
) {

220 
rg‘_li¡
 = 
sourû_li¡
;

221 
sourû_as_ªy
 = 1;

222 } ià(
a
->
rg‘
 !ğ
NULL
 &&

223 (
rg‘_li¡
 =

224 
	`­Ş_qu”y_ü—‹_ÿndid©e_ty³_li¡
(
p
, 
a
->
rg‘
, 
is_»gex
,

225 
a
->
æags
 & 
APOL_QUERY_TARGET_INDIRECT
,

226 ((
a
->

227 
æags
 & (
APOL_QUERY_TARGET_TYPE
 | 
APOL_QUERY_TARGET_ATTRIBUTE
))

228 / 
APOL_QUERY_TARGET_TYPE
))è=ğ
NULL
) {

229 
ş—nup
;

231 ià(
a
->
şas£s
 !ğ
NULL
 &&

232 
	`­Ş_veùÜ_g‘_size
(
a
->
şas£s
) > 0 &&

233 (
şass_li¡
 = 
	`­Ş_qu”y_ü—‹_ÿndid©e_şass_li¡
(
p
, 
a
->
şas£s
)è=ğ
NULL
) {

234 
ş—nup
;

236 ià(
a
->
³rms
 !ğ
NULL
 && 
	`­Ş_veùÜ_g‘_size
(a->perms) > 0) {

237 
³rm_li¡
 = 
a
->
³rms
;

241 ià((*
v
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)) == NULL) {

242 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

243 
ş—nup
;

246 ià(
	`ruË_£Ëù
(
p
, *
v
, 
ruË_ty³
, 
æags
, 
sourû_li¡
, 
rg‘_li¡
, 
şass_li¡
, 
³rm_li¡
, 
boŞ_Çme
)) {

247 
ş—nup
;

250 
»tv®
 = 0;

251 
ş—nup
:

252 ià(
»tv®
 != 0) {

253 
	`­Ş_veùÜ_de¡roy
(
v
);

255 
	`­Ş_veùÜ_de¡roy
(&
sourû_li¡
);

256 ià(!
sourû_as_ªy
) {

257 
	`­Ş_veùÜ_de¡roy
(&
rg‘_li¡
);

259 
	`­Ş_veùÜ_de¡roy
(&
şass_li¡
);

261  
»tv®
;

262 
	}
}

264 
	$­Ş_syn_avruË_g‘_by_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
­Ş_avruË_qu”y_t
 * 
a
, 
­Ş_veùÜ_t
 ** 
v
)

266 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
, *
³rm_™”
 = NULL;

267 
­Ş_veùÜ_t
 *
sourû_li¡
 = 
NULL
, *
rg‘_li¡
 = NULL, *
şass_li¡
 = NULL, *
³rm_li¡
 = NULL, *
syn_v
 = NULL;

268 
­Ş_veùÜ_t
 *
rg‘_ty³s_li¡
 = 
NULL
;

269 
»tv®
 = -1, 
sourû_as_ªy
 = 0, 
is_»gex
 = 0;

270 *
boŞ_Çme
 = 
NULL
;

271 
»gex_t
 *
boŞ_»gex
 = 
NULL
;

272 *
v
 = 
NULL
;

273 
size_t
 
i
;

274 
æags
 = 0;

276 ià(!
p
 || !
	`qpŞ_pŞicy_has_ÿ·b™y
(
	`­Ş_pŞicy_g‘_qpŞ
Õ), 
QPOL_CAP_SYN_RULES
)) {

277 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
EINVAL
));

278 
ş—nup
;

281 
ušt32_t
 
ruË_ty³
 = 
QPOL_RULE_ALLOW
 | 
QPOL_RULE_NEVERALLOW
 | 
QPOL_RULE_AUDITALLOW
 | 
QPOL_RULE_DONTAUDIT
;

282 ià(
a
 !ğ
NULL
) {

283 ià(
a
->
ruËs
 != 0) {

284 
ruË_ty³
 &ğ
a
->
ruËs
;

286 
æags
 = 
a
->flags;

287 
is_»gex
 = 
a
->
æags
 & 
APOL_QUERY_REGEX
;

288 
boŞ_Çme
 = 
a
->bool_name;

289 ià(
a
->
sourû
 !ğ
NULL
 &&

290 (
sourû_li¡
 =

291 
	`­Ş_qu”y_ü—‹_ÿndid©e_syn_ty³_li¡
(
p
, 
a
->
sourû
, 
is_»gex
,

292 
a
->
æags
 & 
APOL_QUERY_SOURCE_INDIRECT
,

293 ((
a
->
æags
 & (
APOL_QUERY_SOURCE_TYPE
 |

294 
APOL_QUERY_SOURCE_ATTRIBUTE
)) /

295 
APOL_QUERY_SOURCE_TYPE
))è=ğ
NULL
) {

296 
ş—nup
;

298 ià((
a
->
æags
 & 
APOL_QUERY_SOURCE_AS_ANY
è&&‡->
sourû
 !ğ
NULL
) {

299 
rg‘_li¡
 = 
sourû_li¡
;

300 
sourû_as_ªy
 = 1;

301 } ià(
a
->
rg‘
 !ğ
NULL
 &&

302 (
rg‘_li¡
 =

303 
	`­Ş_qu”y_ü—‹_ÿndid©e_syn_ty³_li¡
(
p
, 
a
->
rg‘
, 
is_»gex
,

304 
a
->
æags
 & 
APOL_QUERY_TARGET_INDIRECT
,

305 ((
a
->
æags
 & (
APOL_QUERY_TARGET_TYPE
 |

306 
APOL_QUERY_TARGET_ATTRIBUTE
))

307 / 
APOL_QUERY_TARGET_TYPE
))è=ğ
NULL
) {

308 
ş—nup
;

310 ià(
a
->
şas£s
 !ğ
NULL
 &&

311 
	`­Ş_veùÜ_g‘_size
(
a
->
şas£s
) > 0 &&

312 (
şass_li¡
 = 
	`­Ş_qu”y_ü—‹_ÿndid©e_şass_li¡
(
p
, 
a
->
şas£s
)è=ğ
NULL
) {

313 
ş—nup
;

315 ià(
a
->
³rms
 !ğ
NULL
 && 
	`­Ş_veùÜ_g‘_size
(a->perms) > 0) {

316 
³rm_li¡
 = 
a
->
³rms
;

320 ià((*
v
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)) == NULL) {

321 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

322 
ş—nup
;

325 ià(
	`ruË_£Ëù
(
p
, *
v
, 
ruË_ty³
, 
æags
, 
sourû_li¡
, 
rg‘_li¡
, 
şass_li¡
, 
³rm_li¡
, 
boŞ_Çme
)) {

326 
ş—nup
;

329 
syn_v
 = 
	`­Ş_avruË_li¡_to_syn_avruËs
(
p
, *
v
, 
³rm_li¡
);

330 ià(!
syn_v
) {

331 
ş—nup
;

333 
	`­Ş_veùÜ_de¡roy
(
v
);

334 *
v
 = 
syn_v
;

335 
syn_v
 = 
NULL
;

338 ià((
a
->
æags
 & 
APOL_QUERY_SOURCE_INDIRECT
è&& (a->æag & (
APOL_QUERY_TARGET_INDIRECT
 | 
APOL_QUERY_SOURCE_AS_ANY
))) {

339 
»tv®
 = 0;

340 
ş—nup
;

343 ià(!
sourû_li¡
 && !
rg‘_li¡
) {

344 
»tv®
 = 0;

345 
ş—nup
;

348 ià(
sourû_li¡
 && !(
a
->
æags
 & 
APOL_QUERY_SOURCE_INDIRECT
)) {

349 
	`­Ş_veùÜ_de¡roy
(&
sourû_li¡
);

350 
sourû_li¡
 =

351 
	`­Ş_qu”y_ü—‹_ÿndid©e_ty³_li¡
(
p
, 
a
->
sourû
, 
is_»gex
, 0,

352 ((
a
->
æags
 & (
APOL_QUERY_SOURCE_TYPE
 | 
APOL_QUERY_SOURCE_ATTRIBUTE
)) /

353 
APOL_QUERY_SOURCE_TYPE
));

354 ià(!
sourû_li¡
)

355 
ş—nup
;

357 ià(
rg‘_li¡
 && (
sourû_as_ªy
 || !(
a
->
æags
 & 
APOL_QUERY_TARGET_INDIRECT
))) {

358 ià(
sourû_as_ªy
) {

359 
rg‘_li¡
 = 
sourû_li¡
;

361 
	`­Ş_veùÜ_de¡roy
(&
rg‘_li¡
);

362 
rg‘_li¡
 =

363 
	`­Ş_qu”y_ü—‹_ÿndid©e_ty³_li¡
(
p
, 
a
->
rg‘
, 
is_»gex
, 0,

364 ((
a
->
æags
 & (
APOL_QUERY_SOURCE_TYPE
 |

365 
APOL_QUERY_SOURCE_ATTRIBUTE
)) /

366 
APOL_QUERY_SOURCE_TYPE
));

367 ià(!
rg‘_li¡
)

368 
ş—nup
;

371 ià(
rg‘_li¡
) {

372 
rg‘_ty³s_li¡
 = 
	`­Ş_veùÜ_ü—‹_äom_veùÜ
(
rg‘_li¡
, 
NULL
, NULL, NULL);

373 ià(!
rg‘_ty³s_li¡
) {

374 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

375 
ş—nup
;

377 
qpŞ_ty³_t
 *
ty³
 = 
NULL
;

378 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
rg‘_ty³s_li¡
); i++) {

379 
ty³
 = 
	`­Ş_veùÜ_g‘_–em’t
(
rg‘_ty³s_li¡
, 
i
);

380 
i§‰r
 = 0;

381 
	`qpŞ_ty³_g‘_i§‰r
(
p
->p, 
ty³
, &
i§‰r
);

382 ià(
i§‰r
) {

383 
	`­Ş_veùÜ_»move
(
rg‘_ty³s_li¡
, 
i
);

384 
i
--;

388 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(*
v
); i++) {

389 
qpŞ_syn_avruË_t
 *
¤uË
 = 
	`­Ş_veùÜ_g‘_–em’t
(*
v
, 
i
);

390 cÚ¡ 
qpŞ_ty³_£t_t
 *
¡y³s
 = 
NULL
, *
‰y³s
 = NULL;

391 
u£s_sourû
 = 0, 
u£s_rg‘
 = 0;

392 
ušt32_t
 
is_£lf
 = 0;

393 
	`qpŞ_syn_avruË_g‘_sourû_ty³_£t
(
p
->p, 
¤uË
, &
¡y³s
);

394 
	`qpŞ_syn_avruË_g‘_rg‘_ty³_£t
(
p
->p, 
¤uË
, &
‰y³s
);

395 
	`qpŞ_syn_avruË_g‘_is_rg‘_£lf
(
p
->p, 
¤uË
, &
is_£lf
);

396 ià(
sourû_li¡
 && !(
a
->
æags
 & 
APOL_QUERY_SOURCE_INDIRECT
)) {

397 
u£s_sourû
 = 
	`­Ş_qu”y_ty³_£t_u£s_ty³s_dœeùly
(
p
, 
¡y³s
, 
sourû_li¡
);

398 ià(
u£s_sourû
 < 0)

399 
ş—nup
;

400 } ià(
sourû_li¡
 && 
a
->
æags
 & 
APOL_QUERY_SOURCE_INDIRECT
) {

401 
u£s_sourû
 = 1;

402 } ià(!
sourû_li¡
) {

403 
u£s_sourû
 = 1;

406 ià(
rg‘_li¡


407 && !((
a
->
æags
 & 
APOL_QUERY_TARGET_INDIRECT
è|| (
sourû_as_ªy
 &&‡->æag & 
APOL_QUERY_SOURCE_INDIRECT
))) {

408 
u£s_rg‘
 = 
	`­Ş_qu”y_ty³_£t_u£s_ty³s_dœeùly
(
p
, 
‰y³s
, 
rg‘_li¡
);

409 ià(
u£s_rg‘
 < 0)

410 
ş—nup
;

411 ià(
is_£lf
) {

412 
u£s_rg‘
 |ğ
	`­Ş_qu”y_ty³_£t_u£s_ty³s_dœeùly
(
p
, 
¡y³s
, 
rg‘_ty³s_li¡
);

413 ià(
u£s_rg‘
 < 0)

414 
ş—nup
;

416 } ià(
rg‘_li¡
 && ((
a
->
æags
 & 
APOL_QUERY_TARGET_INDIRECT
)

417 || (
sourû_as_ªy
 && 
a
->
æags
 & 
APOL_QUERY_SOURCE_INDIRECT
))) {

418 
u£s_rg‘
 = 1;

419 } ià(!
rg‘_li¡
) {

420 
u£s_rg‘
 = 1;

423 ià(!((
u£s_sourû
 && 
u£s_rg‘
è|| (
sourû_as_ªy
 && (uses_source || uses_target)))) {

424 
	`­Ş_veùÜ_»move
(*
v
, 
i
);

425 
i
--;

429 
»tv®
 = 0;

430 
ş—nup
:

431 ià(
»tv®
 != 0) {

432 
	`­Ş_veùÜ_de¡roy
(
v
);

434 
	`­Ş_veùÜ_de¡roy
(&
syn_v
);

435 
	`­Ş_veùÜ_de¡roy
(&
sourû_li¡
);

436 
	`­Ş_veùÜ_de¡roy
(&
rg‘_ty³s_li¡
);

437 ià(!
sourû_as_ªy
) {

438 
	`­Ş_veùÜ_de¡roy
(&
rg‘_li¡
);

440 
	`­Ş_veùÜ_de¡roy
(&
şass_li¡
);

442 
	`­Ş_»gex_de¡roy
(&
boŞ_»gex
);

443 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

444 
	`qpŞ_™”©Ü_de¡roy
(&
³rm_™”
);

445  
»tv®
;

446 
	}
}

448 
­Ş_avruË_qu”y_t
 *
	$­Ş_avruË_qu”y_ü—‹
()

450 
­Ş_avruË_qu”y_t
 *
a
 = 
	`ÿÎoc
(1, (apol_avrule_query_t));

451 ià(
a
 !ğ
NULL
) {

452 
a
->
ruËs
 = ~0U;

453 
a
->
æags
 =

454 (
APOL_QUERY_SOURCE_TYPE
 | 
APOL_QUERY_SOURCE_ATTRIBUTE
 | 
APOL_QUERY_TARGET_TYPE
 |

455 
APOL_QUERY_TARGET_ATTRIBUTE
);

457  
a
;

458 
	}
}

460 
	$­Ş_avruË_qu”y_de¡roy
(
­Ş_avruË_qu”y_t
 ** 
a
)

462 ià(*
a
 !ğ
NULL
) {

463 
	`ä“
((*
a
)->
sourû
);

464 
	`ä“
((*
a
)->
rg‘
);

465 
	`ä“
((*
a
)->
boŞ_Çme
);

466 
	`­Ş_veùÜ_de¡roy
(&(*
a
)->
şas£s
);

467 
	`­Ş_veùÜ_de¡roy
(&(*
a
)->
³rms
);

468 
	`ä“
(*
a
);

469 *
a
 = 
NULL
;

471 
	}
}

473 
­Ş_avruË_qu”y_£t_ruËs
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
 
__©Œibu‹__
 ((
unu£d
)), 
­Ş_avruË_qu”y_t
 * 
a
, 
ruËs
)

475 ià(
	gruËs
 != 0) {

476 
a
->
ruËs
 =„ules;

478 
	ga
->
	gruËs
 = ~0U;

483 
	$­Ş_avruË_qu”y_£t_sourû
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_avruË_qu”y_t
 * 
a
, cÚ¡ *
symbŞ
, 
is_šdœeù
)

485 
	`­Ş_qu”y_£t_æag
(
p
, &
a
->
æags
, 
is_šdœeù
, 
APOL_QUERY_SOURCE_INDIRECT
);

486  
	`­Ş_qu”y_£t
(
p
, &
a
->
sourû
, 
NULL
, 
symbŞ
);

487 
	}
}

489 
	$­Ş_avruË_qu”y_£t_sourû_compÚ’t
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_avruË_qu”y_t
 * 
a
, 
compÚ’t
)

491 ià(!
a
 || !(
compÚ’t
 & 
APOL_QUERY_SYMBOL_IS_BOTH
)) {

492 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
EINVAL
));

493 
”ºo
 = 
EINVAL
;

496 
	`­Ş_qu”y_£t_æag
(
p
, &
a
->
æags
, 
compÚ’t
 & 
APOL_QUERY_SYMBOL_IS_TYPE
, 
APOL_QUERY_SOURCE_TYPE
);

497 
	`­Ş_qu”y_£t_æag
(
p
, &
a
->
æags
, 
compÚ’t
 & 
APOL_QUERY_SYMBOL_IS_ATTRIBUTE
, 
APOL_QUERY_SOURCE_ATTRIBUTE
);

499 
	}
}

501 
	$­Ş_avruË_qu”y_£t_rg‘
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_avruË_qu”y_t
 * 
a
, cÚ¡ *
symbŞ
, 
is_šdœeù
)

503 
	`­Ş_qu”y_£t_æag
(
p
, &
a
->
æags
, 
is_šdœeù
, 
APOL_QUERY_TARGET_INDIRECT
);

504  
	`­Ş_qu”y_£t
(
p
, &
a
->
rg‘
, 
NULL
, 
symbŞ
);

505 
	}
}

507 
	$­Ş_avruË_qu”y_£t_rg‘_compÚ’t
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_avruË_qu”y_t
 * 
a
, 
compÚ’t
)

509 ià(!
a
 || !(
compÚ’t
 && 
APOL_QUERY_SYMBOL_IS_BOTH
)) {

510 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
EINVAL
));

511 
”ºo
 = 
EINVAL
;

514 
	`­Ş_qu”y_£t_æag
(
p
, &
a
->
æags
, 
compÚ’t
 & 
APOL_QUERY_SYMBOL_IS_TYPE
, 
APOL_QUERY_TARGET_TYPE
);

515 
	`­Ş_qu”y_£t_æag
(
p
, &
a
->
æags
, 
compÚ’t
 & 
APOL_QUERY_SYMBOL_IS_ATTRIBUTE
, 
APOL_QUERY_TARGET_ATTRIBUTE
);

517 
	}
}

519 
	$­Ş_avruË_qu”y_­³nd_şass
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_avruË_qu”y_t
 * 
a
, cÚ¡ *
obj_şass
)

521 *
s
 = 
NULL
;

522 ià(
obj_şass
 =ğ
NULL
) {

523 
	`­Ş_veùÜ_de¡roy
(&
a
->
şas£s
);

524 } ià((
s
 = 
	`¡rdup
(
obj_şass
)è=ğ
NULL
 || (
a
->
şas£s
 =ğNULL && (a->şas£ ğ
	`­Ş_veùÜ_ü—‹
(
ä“
)) == NULL)

525 || 
	`­Ş_veùÜ_­³nd
(
a
->
şas£s
, 
s
) < 0) {

526 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

527 
	`ä“
(
s
);

531 
	}
}

533 
	$­Ş_avruË_qu”y_­³nd_³rm
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_avruË_qu”y_t
 * 
a
, cÚ¡ *
³rm
)

535 *
s
;

536 ià(
³rm
 =ğ
NULL
) {

537 
	`­Ş_veùÜ_de¡roy
(&
a
->
³rms
);

538 } ià((
s
 = 
	`¡rdup
(
³rm
)è=ğ
NULL
 ||

539 (
a
->
³rms
 =ğ
NULL
 && (a->³rm ğ
	`­Ş_veùÜ_ü—‹
(
ä“
)è=ğNULLè|| 
	`­Ş_veùÜ_­³nd
×->³rms, 
s
) < 0) {

540 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

544 
	}
}

546 
	$­Ş_avruË_qu”y_£t_boŞ
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_avruË_qu”y_t
 * 
a
, cÚ¡ *
boŞ_Çme
)

548  
	`­Ş_qu”y_£t
(
p
, &
a
->
boŞ_Çme
, 
NULL
, bool_name);

549 
	}
}

551 
	$­Ş_avruË_qu”y_£t_’abËd
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_avruË_qu”y_t
 * 
a
, 
is_’abËd
)

553  
	`­Ş_qu”y_£t_æag
(
p
, &
a
->
æags
, 
is_’abËd
, 
APOL_QUERY_ONLY_ENABLED
);

554 
	}
}

556 
	$­Ş_avruË_qu”y_£t_®l_³rms
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_avruË_qu”y_t
 * 
a
, 
m©ch_®l
)

558  
	`­Ş_qu”y_£t_æag
(
p
, &
a
->
æags
, 
m©ch_®l
, 
APOL_QUERY_MATCH_ALL_PERMS
);

559 
	}
}

561 
	$­Ş_avruË_qu”y_£t_sourû_ªy
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_avruË_qu”y_t
 * 
a
, 
is_ªy
)

563  
	`­Ş_qu”y_£t_æag
(
p
, &
a
->
æags
, 
is_ªy
, 
APOL_QUERY_SOURCE_AS_ANY
);

564 
	}
}

566 
	$­Ş_avruË_qu”y_£t_»gex
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_avruË_qu”y_t
 * 
a
, 
is_»gex
)

568  
	`­Ş_qu”y_£t_»gex
(
p
, &
a
->
æags
, 
is_»gex
);

569 
	}
}

575 
	$­Ş_syn_avruË_comp
(cÚ¡ *
a
, cÚ¡ *
b
, *
d©a
)

577 
qpŞ_syn_avruË_t
 *
r1
 = (qpŞ_syn_avruË_ˆ*è
a
;

578 
qpŞ_syn_avruË_t
 *
r2
 = (qpŞ_syn_avruË_ˆ*è
b
;

579 
­Ş_pŞicy_t
 *
p
 = (­Ş_pŞicy_ˆ*è
d©a
;

580 
num1
, 
num2
;

581 ià(
	`qpŞ_syn_avruË_g‘_lš’o
(
p
->p, 
r1
, &
num1
è< 0 || qpŞ_syn_avruË_g‘_lš’oÕ->p, 
r2
, &
num2
) < 0) {

584 ià(
num1
 !ğ
num2
) {

585  ()
num1
 - ()
num2
;

587  ()((*)
r1
 - (*)
r2
);

588 
	}
}

590 
­Ş_veùÜ_t
 *
	$­Ş_avruË_to_syn_avruËs
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
qpŞ_avruË_t
 * 
ruË
, cÚ¡ 
­Ş_veùÜ_t
 * 
³rms
)

592 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

593 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
, *
³rm_™”
 = NULL;

594 
qpŞ_syn_avruË_t
 *
syn_avruË
;

595 *
³rm
;

596 
size_t
 
i
;

597 
»tv®
 = -1, 
”rÜ
 = 0, 
found_³rm
 = 0;

598 ià(
	`qpŞ_avruË_g‘_syn_avruË_™”
(
p
->p, 
ruË
, &
™”
) < 0) {

599 
”rÜ
 = 
”ºo
;

600 
ş—nup
;

602 ià((
v
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)) == NULL) {

603 
”rÜ
 = 
”ºo
;

604 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”rÜ
));

605 
ş—nup
;

607 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

608 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
syn_avruË
) < 0) {

609 
”rÜ
 = 
”ºo
;

610 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”rÜ
));

611 
ş—nup
;

613 
found_³rm
 = 0;

614 ià(
³rms
 !ğ
NULL
 && 
	`­Ş_veùÜ_g‘_size
(perms) > 0) {

615 ià(
	`qpŞ_syn_avruË_g‘_³rm_™”
(
p
->p, 
syn_avruË
, &
³rm_™”
) < 0) {

616 
ş—nup
;

618 ; !
	`qpŞ_™”©Ü_’d
(
³rm_™”
); 
	`qpŞ_™”©Ü_Ãxt
(perm_iter)) {

619 ià(
	`qpŞ_™”©Ü_g‘_™em
(
³rm_™”
, (**)&
³rm
) < 0) {

620 
”rÜ
 = 
”ºo
;

621 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”rÜ
));

622 
ş—nup
;

624 ià(
	`­Ş_veùÜ_g‘_šdex
(
³rms
, 
³rm
, 
­Ş_¡r_¡rcmp
, 
NULL
, &
i
) == 0) {

625 
found_³rm
 = 1;

630 
found_³rm
 = 1;

632 ià(
found_³rm
 && 
	`­Ş_veùÜ_­³nd
(
v
, 
syn_avruË
) < 0) {

633 
”rÜ
 = 
”ºo
;

634 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”rÜ
));

635 
ş—nup
;

639 
	`­Ş_veùÜ_sÜt_uniquify
(
v
, 
­Ş_syn_avruË_comp
, (*)
p
);

640 
»tv®
 = 0;

641 
ş—nup
:

642 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

643 
	`qpŞ_™”©Ü_de¡roy
(&
³rm_™”
);

644 ià(
»tv®
 != 0) {

645 
	`­Ş_veùÜ_de¡roy
(&
v
);

646 
”ºo
 = 
”rÜ
;

647  
NULL
;

649  
v
;

650 
	}
}

652 
­Ş_veùÜ_t
 *
	$­Ş_avruË_li¡_to_syn_avruËs
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
­Ş_veùÜ_t
 * 
ruËs
, cÚ¡‡pŞ_veùÜ_ˆ* 
³rms
)

654 
­Ş_b¡_t
 *
b
 = 
NULL
;

655 
qpŞ_avruË_t
 *
ruË
;

656 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

657 
qpŞ_syn_avruË_t
 *
syn_avruË
;

658 *
³rm
;

659 
­Ş_veùÜ_t
 *
tmp_v
 = 
NULL
, *
v
 = NULL;

660 
size_t
 
i
, 
x
;

661 
»tv®
 = -1, 
”rÜ
 = 0, 
found_³rm
 = 0;

663 ià((
b
 = 
	`­Ş_b¡_ü—‹
(
­Ş_syn_avruË_comp
, 
NULL
)) == NULL) {

664 
”rÜ
 = 
”ºo
;

665 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”rÜ
));

666 
ş—nup
;

668 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
ruËs
); i++) {

669 
ruË
 = 
	`­Ş_veùÜ_g‘_–em’t
(
ruËs
, 
i
);

670 ià(
	`qpŞ_avruË_g‘_syn_avruË_™”
(
p
->p, 
ruË
, &
™”
) < 0) {

671 
”rÜ
 = 
”ºo
;

672 
ş—nup
;

674 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

675 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
syn_avruË
) < 0) {

676 
”rÜ
 = 
”ºo
;

677 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”rÜ
));

678 
ş—nup
;

681 ià(
	`­Ş_b¡_š£¹
(
b
, 
syn_avruË
, (*)
p
) < 0) {

682 
”rÜ
 = 
”ºo
;

683 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”rÜ
));

684 
ş—nup
;

687 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

689 ià((
tmp_v
 = 
	`­Ş_b¡_g‘_veùÜ
(
b
, 1)è=ğ
NULL
) {

690 
”rÜ
 = 
”ºo
;

691 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”rÜ
));

692 
ş—nup
;

694 ià(
³rms
 =ğ
NULL
 || 
	`­Ş_veùÜ_g‘_size
(perms) == 0) {

695 
v
 = 
tmp_v
;

696 
tmp_v
 = 
NULL
;

698 ià((
v
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)) == NULL) {

699 
”rÜ
 = 
”ºo
;

700 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”rÜ
));

701 
ş—nup
;

703 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
tmp_v
); i++) {

704 
syn_avruË
 = 
	`­Ş_veùÜ_g‘_–em’t
(
tmp_v
, 
i
);

705 
found_³rm
 = 0;

706 ià(
	`qpŞ_syn_avruË_g‘_³rm_™”
(
p
->p, 
syn_avruË
, &
™”
) < 0) {

707 
ş—nup
;

709 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

710 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
³rm
) < 0) {

711 
”rÜ
 = 
”ºo
;

712 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”rÜ
));

713 
ş—nup
;

715 ià(
	`­Ş_veùÜ_g‘_šdex
(
³rms
, 
³rm
, 
­Ş_¡r_¡rcmp
, 
NULL
, &
x
) == 0) {

716 
found_³rm
 = 1;

720 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

721 ià(
found_³rm
 && 
	`­Ş_veùÜ_­³nd
(
v
, 
syn_avruË
) < 0) {

722 
”rÜ
 = 
”ºo
;

723 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”rÜ
));

724 
ş—nup
;

728 
»tv®
 = 0;

729 
ş—nup
:

730 
	`­Ş_b¡_de¡roy
(&
b
);

731 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

732 
	`­Ş_veùÜ_de¡roy
(&
tmp_v
);

733 ià(
»tv®
 != 0) {

734 
	`­Ş_veùÜ_de¡roy
(&
v
);

735 
”ºo
 = 
”rÜ
;

736  
NULL
;

738  
v
;

739 
	}
}

741 *
	$­Ş_avruË_»nd”
(cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_avruË_t
 * 
ruË
)

743 *
tmp
 = 
NULL
;

744 cÚ¡ *
ruË_ty³_¡r
, *
tmp_Çme
 = 
NULL
;

745 
”rÜ
 = 0;

746 
ušt32_t
 
ruË_ty³
 = 0;

747 cÚ¡ 
qpŞ_ty³_t
 *
ty³
 = 
NULL
;

748 cÚ¡ 
qpŞ_şass_t
 *
obj_şass
 = 
NULL
;

749 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

750 
size_t
 
tmp_sz
 = 0, 
num_³rms
 = 0;

752 ià(!
pŞicy
 || !
ruË
) {

753 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

754 
”ºo
 = 
EINVAL
;

755  
NULL
;

759 ià(
	`qpŞ_avruË_g‘_ruË_ty³
(
pŞicy
->
p
, 
ruË
, &
ruË_ty³
)) {

760  
NULL
;

762 ià(!(
ruË_ty³
 &ğ(
QPOL_RULE_ALLOW
 | 
QPOL_RULE_NEVERALLOW
 | 
QPOL_RULE_AUDITALLOW
 | 
QPOL_RULE_DONTAUDIT
))) {

763 
	`ERR
(
pŞicy
, "%s", "Invalid AV„uleype");

764 
”ºo
 = 
EINVAL
;

765  
NULL
;

767 ià(!(
ruË_ty³_¡r
 = 
	`­Ş_ruË_ty³_to_¡r
(
ruË_ty³
))) {

768 
	`ERR
(
pŞicy
, "%s", "Could‚ot get AV„uleype's string");

769 
”ºo
 = 
EINVAL
;

770  
NULL
;

772 ià(
	`­Ş_¡r_­³ndf
(&
tmp
, &
tmp_sz
, "% ", 
ruË_ty³_¡r
)) {

773 
”rÜ
 = 
”ºo
;

774 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

775 
”r
;

779 ià(
	`qpŞ_avruË_g‘_sourû_ty³
(
pŞicy
->
p
, 
ruË
, &
ty³
)) {

780 
”rÜ
 = 
”ºo
;

781 
”r
;

783 ià(
	`qpŞ_ty³_g‘_Çme
(
pŞicy
->
p
, 
ty³
, &
tmp_Çme
)) {

784 
”rÜ
 = 
”ºo
;

785 
”r
;

787 ià(
	`­Ş_¡r_­³ndf
(&
tmp
, &
tmp_sz
, "% ", 
tmp_Çme
)) {

788 
”rÜ
 = 
”ºo
;

789 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

790 
”r
;

794 ià(
	`qpŞ_avruË_g‘_rg‘_ty³
(
pŞicy
->
p
, 
ruË
, &
ty³
)) {

795 
”rÜ
 = 
”ºo
;

796 
”r
;

798 ià(
	`qpŞ_ty³_g‘_Çme
(
pŞicy
->
p
, 
ty³
, &
tmp_Çme
)) {

799 
”rÜ
 = 
”ºo
;

800 
”r
;

802 ià(
	`­Ş_¡r_­³ndf
(&
tmp
, &
tmp_sz
, "% : ", 
tmp_Çme
)) {

803 
”rÜ
 = 
”ºo
;

804 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

805 
”r
;

809 ià(
	`qpŞ_avruË_g‘_objeù_şass
(
pŞicy
->
p
, 
ruË
, &
obj_şass
)) {

810 
”rÜ
 = 
”ºo
;

811 
”r
;

813 ià(
	`qpŞ_şass_g‘_Çme
(
pŞicy
->
p
, 
obj_şass
, &
tmp_Çme
)) {

814 
”rÜ
 = 
”ºo
;

815 
”r
;

817 ià(
	`­Ş_¡r_­³ndf
(&
tmp
, &
tmp_sz
, "% ", 
tmp_Çme
)) {

818 
”rÜ
 = 
”ºo
;

819 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

820 
”r
;

824 ià(
	`qpŞ_avruË_g‘_³rm_™”
(
pŞicy
->
p
, 
ruË
, &
™”
)) {

825 
”rÜ
 = 
”ºo
;

826 
”r
;

828 ià(
	`qpŞ_™”©Ü_g‘_size
(
™”
, &
num_³rms
)) {

829 
”rÜ
 = 
”ºo
;

830 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

831 
”r
;

833 ià(
num_³rms
 > 1) {

834 ià(
	`­Ş_¡r_­³nd
(&
tmp
, &
tmp_sz
, "{ ")) {

835 
”rÜ
 = 
”ºo
;

836 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

837 
”r
;

840 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

841 *
³rm_Çme
 = 
NULL
;

842 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
³rm_Çme
)) {

843 
”rÜ
 = 
”ºo
;

844 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

845 
”r
;

847 ià(
	`­Ş_¡r_­³ndf
(&
tmp
, &
tmp_sz
, "% ", 
³rm_Çme
)) {

848 
”rÜ
 = 
”ºo
;

849 
	`ä“
(
³rm_Çme
);

850 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

851 
”r
;

853 
	`ä“
(
³rm_Çme
);

854 
tmp_Çme
 = 
NULL
;

856 ià(
num_³rms
 > 1) {

857 ià(
	`­Ş_¡r_­³nd
(&
tmp
, &
tmp_sz
, "} ")) {

858 
”rÜ
 = 
”ºo
;

859 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

860 
”r
;

864 ià(
	`­Ş_¡r_­³nd
(&
tmp
, &
tmp_sz
, ";")) {

865 
”rÜ
 = 
”ºo
;

866 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

867 
”r
;

870 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

871  
tmp
;

873 
”r
:

874 
	`ä“
(
tmp
);

875 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

876 
”ºo
 = 
”rÜ
;

877  
NULL
;

878 
	}
}

880 *
	$­Ş_syn_avruË_»nd”
(cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_syn_avruË_t
 * 
ruË
)

882 *
tmp
 = 
NULL
;

883 cÚ¡ *
ruË_ty³_¡r
, *
tmp_Çme
 = 
NULL
;

884 
”rÜ
 = 0;

885 
ušt32_t
 
ruË_ty³
 = 0, 
¡¬
 = 0, 
comp
 = 0, 
£lf
 = 0;

886 cÚ¡ 
qpŞ_ty³_t
 *
ty³
 = 
NULL
;

887 cÚ¡ 
qpŞ_şass_t
 *
obj_şass
 = 
NULL
;

888 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
, *
™”2
 = NULL;

889 
size_t
 
tmp_sz
 = 0, 
™”_sz
 = 0, 
™”2_sz
 = 0;

890 cÚ¡ 
qpŞ_ty³_£t_t
 *
£t
 = 
NULL
;

892 ià(!
pŞicy
 || !
ruË
) {

893 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

894 
”ºo
 = 
EINVAL
;

895  
NULL
;

899 ià(
	`qpŞ_syn_avruË_g‘_ruË_ty³
(
pŞicy
->
p
, 
ruË
, &
ruË_ty³
)) {

900  
NULL
;

902 ià(!(
ruË_ty³
 &ğ(
QPOL_RULE_ALLOW
 | 
QPOL_RULE_NEVERALLOW
 | 
QPOL_RULE_AUDITALLOW
 | 
QPOL_RULE_DONTAUDIT
))) {

903 
	`ERR
(
pŞicy
, "%s", "Invalid AV„uleype");

904 
”ºo
 = 
EINVAL
;

905  
NULL
;

907 ià(!(
ruË_ty³_¡r
 = 
	`­Ş_ruË_ty³_to_¡r
(
ruË_ty³
))) {

908 
	`ERR
(
pŞicy
, "%s", "Could‚ot get AV„uleype's string");

909 
”ºo
 = 
EINVAL
;

910  
NULL
;

912 ià(
	`­Ş_¡r_­³ndf
(&
tmp
, &
tmp_sz
, "% ", 
ruË_ty³_¡r
)) {

913 
”rÜ
 = 
”ºo
;

914 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

915 
”r
;

919 ià(
	`qpŞ_syn_avruË_g‘_sourû_ty³_£t
(
pŞicy
->
p
, 
ruË
, &
£t
)) {

920 
”rÜ
 = 
”ºo
;

921 
”r
;

923 ià(
	`qpŞ_ty³_£t_g‘_is_¡¬
(
pŞicy
->
p
, 
£t
, &
¡¬
)) {

924 
”rÜ
 = 
”ºo
;

925 
”r
;

927 ià(
¡¬
) {

928 ià(
	`­Ş_¡r_­³nd
(&
tmp
, &
tmp_sz
, "* ")) {

929 
”rÜ
 = 
”ºo
;

930 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

931 
”r
;

934 ià(
	`qpŞ_ty³_£t_g‘_is_comp
(
pŞicy
->
p
, 
£t
, &
comp
)) {

935 
”rÜ
 = 
”ºo
;

936 
”r
;

938 ià(
comp
) {

939 ià(
	`­Ş_¡r_­³nd
(&
tmp
, &
tmp_sz
, "~")) {

940 
”rÜ
 = 
”ºo
;

941 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

942 
”r
;

945 ià(
	`qpŞ_ty³_£t_g‘_šşuded_ty³s_™”
(
pŞicy
->
p
, 
£t
, &
™”
)) {

946 
”rÜ
 = 
”ºo
;

947 
”r
;

949 ià(
	`qpŞ_ty³_£t_g‘_subŒaùed_ty³s_™”
(
pŞicy
->
p
, 
£t
, &
™”2
)) {

950 
”rÜ
 = 
”ºo
;

951 
”r
;

953 ià(
	`qpŞ_™”©Ü_g‘_size
(
™”
, &
™”_sz
è|| qpŞ_™”©Ü_g‘_size(
™”2
, &
™”2_sz
)) {

954 
”rÜ
 = 
”ºo
;

955 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

956 
”r
;

958 ià(
™”_sz
 + 
™”2_sz
 > 1) {

959 ià(
	`­Ş_¡r_­³nd
(&
tmp
, &
tmp_sz
, "{ ")) {

960 
”rÜ
 = 
”ºo
;

961 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

962 
”r
;

965 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

966 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
ty³
)) {

967 
”rÜ
 = 
”ºo
;

968 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

969 
”r
;

971 ià(
	`qpŞ_ty³_g‘_Çme
(
pŞicy
->
p
, 
ty³
, &
tmp_Çme
)) {

972 
”rÜ
 = 
”ºo
;

973 
”r
;

975 ià(
	`­Ş_¡r_­³ndf
(&
tmp
, &
tmp_sz
, "% ", 
tmp_Çme
)) {

976 
”rÜ
 = 
”ºo
;

977 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

978 
”r
;

981 ; !
	`qpŞ_™”©Ü_’d
(
™”2
); 
	`qpŞ_™”©Ü_Ãxt
(iter2)) {

982 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”2
, (**)&
ty³
)) {

983 
”rÜ
 = 
”ºo
;

984 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

985 
”r
;

987 ià(
	`qpŞ_ty³_g‘_Çme
(
pŞicy
->
p
, 
ty³
, &
tmp_Çme
)) {

988 
”rÜ
 = 
”ºo
;

989 
”r
;

991 ià(
	`­Ş_¡r_­³ndf
(&
tmp
, &
tmp_sz
, "-% ", 
tmp_Çme
)) {

992 
”rÜ
 = 
”ºo
;

993 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

994 
”r
;

997 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

998 
	`qpŞ_™”©Ü_de¡roy
(&
™”2
);

999 ià(
™”_sz
 + 
™”2_sz
 > 1) {

1000 ià(
	`­Ş_¡r_­³nd
(&
tmp
, &
tmp_sz
, "} ")) {

1001 
”rÜ
 = 
”ºo
;

1002 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1003 
”r
;

1009 ià(
	`qpŞ_syn_avruË_g‘_rg‘_ty³_£t
(
pŞicy
->
p
, 
ruË
, &
£t
)) {

1010 
”rÜ
 = 
”ºo
;

1011 
”r
;

1013 ià(
	`qpŞ_ty³_£t_g‘_is_¡¬
(
pŞicy
->
p
, 
£t
, &
¡¬
)) {

1014 
”rÜ
 = 
”ºo
;

1015 
”r
;

1017 ià(
¡¬
) {

1018 ià(
	`­Ş_¡r_­³nd
(&
tmp
, &
tmp_sz
, "* ")) {

1019 
”rÜ
 = 
”ºo
;

1020 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1021 
”r
;

1024 ià(
	`qpŞ_ty³_£t_g‘_is_comp
(
pŞicy
->
p
, 
£t
, &
comp
)) {

1025 
”rÜ
 = 
”ºo
;

1026 
”r
;

1028 ià(
comp
) {

1029 ià(
	`­Ş_¡r_­³nd
(&
tmp
, &
tmp_sz
, "~")) {

1030 
”rÜ
 = 
”ºo
;

1031 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1032 
”r
;

1035 ià(
	`qpŞ_ty³_£t_g‘_šşuded_ty³s_™”
(
pŞicy
->
p
, 
£t
, &
™”
)) {

1036 
”rÜ
 = 
”ºo
;

1037 
”r
;

1039 ià(
	`qpŞ_ty³_£t_g‘_subŒaùed_ty³s_™”
(
pŞicy
->
p
, 
£t
, &
™”2
)) {

1040 
”rÜ
 = 
”ºo
;

1041 
”r
;

1043 ià(
	`qpŞ_™”©Ü_g‘_size
(
™”
, &
™”_sz
è|| qpŞ_™”©Ü_g‘_size(
™”2
, &
™”2_sz
)) {

1044 
”rÜ
 = 
”ºo
;

1045 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1046 
”r
;

1048 ià(
	`qpŞ_syn_avruË_g‘_is_rg‘_£lf
(
pŞicy
->
p
, 
ruË
, &
£lf
)) {

1049 
”rÜ
 = 
”ºo
;

1050 
”r
;

1052 ià(
™”_sz
 + 
™”2_sz
 + 
£lf
 > 1) {

1053 ià(
	`­Ş_¡r_­³nd
(&
tmp
, &
tmp_sz
, "{ ")) {

1054 
”rÜ
 = 
”ºo
;

1055 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1056 
”r
;

1059 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

1060 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
ty³
)) {

1061 
”rÜ
 = 
”ºo
;

1062 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1063 
”r
;

1065 ià(
	`qpŞ_ty³_g‘_Çme
(
pŞicy
->
p
, 
ty³
, &
tmp_Çme
)) {

1066 
”rÜ
 = 
”ºo
;

1067 
”r
;

1069 ià(
	`­Ş_¡r_­³ndf
(&
tmp
, &
tmp_sz
, "% ", 
tmp_Çme
)) {

1070 
”rÜ
 = 
”ºo
;

1071 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1072 
”r
;

1075 ; !
	`qpŞ_™”©Ü_’d
(
™”2
); 
	`qpŞ_™”©Ü_Ãxt
(iter2)) {

1076 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”2
, (**)&
ty³
)) {

1077 
”rÜ
 = 
”ºo
;

1078 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1079 
”r
;

1081 ià(
	`qpŞ_ty³_g‘_Çme
(
pŞicy
->
p
, 
ty³
, &
tmp_Çme
)) {

1082 
”rÜ
 = 
”ºo
;

1083 
”r
;

1085 ià(
	`­Ş_¡r_­³ndf
(&
tmp
, &
tmp_sz
, "-% ", 
tmp_Çme
)) {

1086 
”rÜ
 = 
”ºo
;

1087 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1088 
”r
;

1091 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

1092 
	`qpŞ_™”©Ü_de¡roy
(&
™”2
);

1093 ià(
£lf
) {

1094 ià(
	`­Ş_¡r_­³nd
(&
tmp
, &
tmp_sz
, "self ")) {

1095 
”rÜ
 = 
”ºo
;

1096 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1097 
”r
;

1100 ià(
™”_sz
 + 
™”2_sz
 + 
£lf
 > 1) {

1101 ià(
	`­Ş_¡r_­³nd
(&
tmp
, &
tmp_sz
, "} ")) {

1102 
”rÜ
 = 
”ºo
;

1103 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1104 
”r
;

1109 ià(
	`­Ş_¡r_­³nd
(&
tmp
, &
tmp_sz
, ": ")) {

1110 
”rÜ
 = 
”ºo
;

1111 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1112 
”r
;

1116 ià(
	`qpŞ_syn_avruË_g‘_şass_™”
(
pŞicy
->
p
, 
ruË
, &
™”
)) {

1117 
”rÜ
 = 
”ºo
;

1118 
”r
;

1120 ià(
	`qpŞ_™”©Ü_g‘_size
(
™”
, &
™”_sz
)) {

1121 
”rÜ
 = 
”ºo
;

1122 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1123 
”r
;

1125 ià(
™”_sz
 > 1) {

1126 ià(
	`­Ş_¡r_­³nd
(&
tmp
, &
tmp_sz
, "{ ")) {

1127 
”rÜ
 = 
”ºo
;

1128 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1129 
”r
;

1132 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

1133 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
obj_şass
)) {

1134 
”rÜ
 = 
”ºo
;

1135 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1136 
”r
;

1138 ià(
	`qpŞ_şass_g‘_Çme
(
pŞicy
->
p
, 
obj_şass
, &
tmp_Çme
)) {

1139 
”rÜ
 = 
”ºo
;

1140 
”r
;

1142 ià(
	`­Ş_¡r_­³ndf
(&
tmp
, &
tmp_sz
, "% ", 
tmp_Çme
)) {

1143 
”rÜ
 = 
”ºo
;

1144 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1145 
”r
;

1148 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

1149 ià(
™”_sz
 > 1) {

1150 ià(
	`­Ş_¡r_­³nd
(&
tmp
, &
tmp_sz
, "} ")) {

1151 
”rÜ
 = 
”ºo
;

1152 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1153 
”r
;

1158 ià(
	`qpŞ_syn_avruË_g‘_³rm_™”
(
pŞicy
->
p
, 
ruË
, &
™”
)) {

1159 
”rÜ
 = 
”ºo
;

1160 
”r
;

1162 ià(
	`qpŞ_™”©Ü_g‘_size
(
™”
, &
™”_sz
)) {

1163 
”rÜ
 = 
”ºo
;

1164 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1165 
”r
;

1167 ià(
™”_sz
 > 1) {

1168 ià(
	`­Ş_¡r_­³nd
(&
tmp
, &
tmp_sz
, "{ ")) {

1169 
”rÜ
 = 
”ºo
;

1170 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1171 
”r
;

1174 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

1175 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
tmp_Çme
)) {

1176 
”rÜ
 = 
”ºo
;

1177 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1178 
”r
;

1180 ià(
	`­Ş_¡r_­³ndf
(&
tmp
, &
tmp_sz
, "% ", 
tmp_Çme
)) {

1181 
”rÜ
 = 
”ºo
;

1182 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1183 
”r
;

1186 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

1187 ià(
™”_sz
 > 1) {

1188 ià(
	`­Ş_¡r_­³nd
(&
tmp
, &
tmp_sz
, "} ")) {

1189 
”rÜ
 = 
”ºo
;

1190 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1191 
”r
;

1195 ià(
	`­Ş_¡r_­³nd
(&
tmp
, &
tmp_sz
, ";")) {

1196 
”rÜ
 = 
”ºo
;

1197 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1198 
”r
;

1201  
tmp
;

1203 
”r
:

1204 
	`ä“
(
tmp
);

1205 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

1206 
	`qpŞ_™”©Ü_de¡roy
(&
™”2
);

1207 
”ºo
 = 
”rÜ
;

1208  
NULL
;

1209 
	}
}

	@libapol/src/bool-query.c

30 
	~"pŞicy-qu”y-š‹º®.h
"

32 
	~<”ºo.h
>

34 
	s­Ş_boŞ_qu”y


36 *
	mboŞ_Çme
;

37 
	mæags
;

38 
»gex_t
 *
	m»gex
;

43 
	$­Ş_boŞ_g‘_by_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_boŞ_qu”y_t
 * 
b
, 
­Ş_veùÜ_t
 ** 
v
)

45 
qpŞ_™”©Ü_t
 *
™”
;

46 
»tv®
 = -1;

47 *
v
 = 
NULL
;

48 ià(
	`qpŞ_pŞicy_g‘_boŞ_™”
(
p
->p, &
™”
) < 0) {

51 ià((*
v
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)) == NULL) {

52 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

53 
ş—nup
;

55 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

56 
qpŞ_boŞ_t
 *
qboŞ
;

57 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
qboŞ
) < 0) {

58 
ş—nup
;

60 ià(
b
 !ğ
NULL
) {

61 cÚ¡ *
boŞ_Çme
;

62 
compv®
;

63 ià(
	`qpŞ_boŞ_g‘_Çme
(
p
->p, 
qboŞ
, &
boŞ_Çme
) < 0) {

64 
ş—nup
;

66 
compv®
 = 
	`­Ş_com·»
(
p
, 
boŞ_Çme
, 
b
->boŞ_Çme, b->
æags
, &(b->
»gex
));

67 ià(
compv®
 < 0) {

68 
ş—nup
;

69 } ià(
compv®
 == 0) {

73 ià(
	`­Ş_veùÜ_­³nd
(*
v
, 
qboŞ
)) {

74 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

75 
ş—nup
;

79 
»tv®
 = 0;

80 
ş—nup
:

81 ià(
»tv®
 != 0) {

82 
	`­Ş_veùÜ_de¡roy
(
v
);

84 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

85  
»tv®
;

86 
	}
}

88 
­Ş_boŞ_qu”y_t
 *
	$­Ş_boŞ_qu”y_ü—‹
()

90  
	`ÿÎoc
(1, (
­Ş_boŞ_qu”y_t
));

91 
	}
}

93 
	$­Ş_boŞ_qu”y_de¡roy
(
­Ş_boŞ_qu”y_t
 ** 
b
)

95 ià(*
b
 !ğ
NULL
) {

96 
	`ä“
((*
b
)->
boŞ_Çme
);

97 
	`­Ş_»gex_de¡roy
(&(*
b
)->
»gex
);

98 
	`ä“
(*
b
);

99 *
b
 = 
NULL
;

101 
	}
}

103 
	$­Ş_boŞ_qu”y_£t_boŞ
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_boŞ_qu”y_t
 * 
b
, cÚ¡ *
Çme
)

105  
	`­Ş_qu”y_£t
(
p
, &
b
->
boŞ_Çme
, &b->
»gex
, 
Çme
);

106 
	}
}

108 
	$­Ş_boŞ_qu”y_£t_»gex
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_boŞ_qu”y_t
 * 
b
, 
is_»gex
)

110  
	`­Ş_qu”y_£t_»gex
(
p
, &
b
->
æags
, 
is_»gex
);

111 
	}
}

	@libapol/src/bounds-query.c

30 
	~"pŞicy-qu”y-š‹º®.h
"

32 
	~<”ºo.h
>

35 
	s­Ş_ty³bounds_qu”y


37 *
	mÇme
;

38 
	mæags
;

39 
»gex_t
 *
	m»gex
;

42 
	$­Ş_ty³bounds_g‘_by_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_ty³bounds_qu”y_t
 * 
q
, 
­Ş_veùÜ_t
 ** 
v
)

44 
qpŞ_™”©Ü_t
 *
™”
;

45 
»tv®
 = -1;

47 *
v
 = 
NULL
;

48 ià(
	`qpŞ_pŞicy_g‘_ty³bounds_™”
(
p
->p, &
™”
) < 0) {

51 ià((*
v
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)) == NULL) {

52 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

53 
ş—nup
;

55 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

56 cÚ¡ 
qpŞ_ty³bounds_t
 *
ty³bounds
;

57 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
ty³bounds
) < 0) {

58 
ş—nup
;

60 ià(
q
 !ğ
NULL
) {

61 ià(
	`­Ş_com·»_ty³bounds
(
p
, 
ty³bounds
, 
q
->
Çme
,

62 
q
->
æags
, &(q->
»gex
)) == 1) {

63 ià(
	`­Ş_veùÜ_­³nd
(*
v
, (*)
ty³bounds
)) {

64 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

65 
ş—nup
;

71 
»tv®
 = 0;

72 
ş—nup
:

73 ià(
»tv®
 != 0) {

74 
	`­Ş_veùÜ_de¡roy
(
v
);

76 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

77  
»tv®
;

78 
	}
}

80 
­Ş_ty³bounds_qu”y_t
 *
	$­Ş_ty³bounds_qu”y_ü—‹
()

82  
	`ÿÎoc
(1, (
­Ş_ty³bounds_qu”y_t
));

83 
	}
}

85 
	$­Ş_ty³bounds_qu”y_de¡roy
(
­Ş_ty³bounds_qu”y_t
 ** 
q
)

87 ià(*
q
 !ğ
NULL
) {

88 
	`ä“
((*
q
)->
Çme
);

89 
	`­Ş_»gex_de¡roy
(&(*
q
)->
»gex
);

90 
	`ä“
(*
q
);

91 *
q
 = 
NULL
;

93 
	}
}

95 
	$­Ş_ty³bounds_qu”y_£t_Çme
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_ty³bounds_qu”y_t
 * 
q
, cÚ¡ *
Çme
)

97  
	`­Ş_qu”y_£t
(
p
, &
q
->
Çme
, &q->
»gex
,‚ame);

98 
	}
}

100 
	$­Ş_ty³bounds_qu”y_£t_»gex
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_ty³bounds_qu”y_t
 * 
q
, 
is_»gex
)

102  
	`­Ş_qu”y_£t_»gex
(
p
, &
q
->
æags
, 
is_»gex
);

103 
	}
}

107 
	s­Ş_rŞebounds_qu”y


109 *
	mÇme
;

112 
	$­Ş_rŞebounds_g‘_by_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_rŞebounds_qu”y_t
 * 
q
, 
­Ş_veùÜ_t
 ** 
v
)

114 
qpŞ_™”©Ü_t
 *
™”
;

115 
»tv®
 = -1;

117 *
v
 = 
NULL
;

118 ià(
	`qpŞ_pŞicy_g‘_rŞebounds_™”
(
p
->p, &
™”
) < 0) {

121 ià((*
v
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)) == NULL) {

122 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

123 
ş—nup
;

125 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

126 cÚ¡ 
qpŞ_rŞebounds_t
 *
rŞebounds
;

127 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
rŞebounds
) < 0) {

128 
ş—nup
;

130 ià(
q
 !ğ
NULL
) {

131 ià(
	`­Ş_veùÜ_­³nd
(*
v
, (*)
rŞebounds
)) {

132 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

133 
ş—nup
;

138 
»tv®
 = 0;

139 
ş—nup
:

140 ià(
»tv®
 != 0) {

141 
	`­Ş_veùÜ_de¡roy
(
v
);

143 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

144  
»tv®
;

145 
	}
}

147 
­Ş_rŞebounds_qu”y_t
 *
	$­Ş_rŞebounds_qu”y_ü—‹
()

149  
	`ÿÎoc
(1, (
­Ş_rŞebounds_qu”y_t
));

150 
	}
}

152 
	$­Ş_rŞebounds_qu”y_de¡roy
(
­Ş_rŞebounds_qu”y_t
 ** 
q
)

154 ià(*
q
 !ğ
NULL
) {

155 
	`ä“
((*
q
)->
Çme
);

156 
	`ä“
(*
q
);

157 *
q
 = 
NULL
;

159 
	}
}

163 
	s­Ş_u£rbounds_qu”y


165 *
	mÇme
;

168 
	$­Ş_u£rbounds_g‘_by_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_u£rbounds_qu”y_t
 * 
q
, 
­Ş_veùÜ_t
 ** 
v
)

170 
qpŞ_™”©Ü_t
 *
™”
;

171 
»tv®
 = -1;

173 *
v
 = 
NULL
;

174 ià(
	`qpŞ_pŞicy_g‘_u£rbounds_™”
(
p
->p, &
™”
) < 0) {

177 ià((*
v
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)) == NULL) {

178 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

179 
ş—nup
;

181 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

182 cÚ¡ 
qpŞ_u£rbounds_t
 *
u£rbounds
;

183 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
u£rbounds
) < 0) {

184 
ş—nup
;

186 ià(
q
 !ğ
NULL
) {

187 ià(
	`­Ş_veùÜ_­³nd
(*
v
, (*)
u£rbounds
)) {

188 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

189 
ş—nup
;

194 
»tv®
 = 0;

195 
ş—nup
:

196 ià(
»tv®
 != 0) {

197 
	`­Ş_veùÜ_de¡roy
(
v
);

199 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

200  
»tv®
;

201 
	}
}

203 
­Ş_u£rbounds_qu”y_t
 *
	$­Ş_u£rbounds_qu”y_ü—‹
()

205  
	`ÿÎoc
(1, (
­Ş_u£rbounds_qu”y_t
));

206 
	}
}

208 
	$­Ş_u£rbounds_qu”y_de¡roy
(
­Ş_u£rbounds_qu”y_t
 ** 
q
)

210 ià(*
q
 !ğ
NULL
) {

211 
	`ä“
((*
q
)->
Çme
);

212 
	`ä“
(*
q
);

213 *
q
 = 
NULL
;

215 
	}
}

	@libapol/src/bst.c

27 
	~<­Ş/b¡.h
>

28 
	~<­Ş/veùÜ.h
>

29 
	~<as£¹.h
>

30 
	~<”ºo.h
>

31 
	~<¡dlib.h
>

32 
	~<¡ršg.h
>

34 
	~"veùÜ-š‹º®.h
"

36 
	sb¡_node


38 *
	m–em
;

39 
	mis_»d
;

40 
b¡_node
 *
	mchd
[2];

41 } 
	tb¡_node_t
;

46 
	s­Ş_b¡


49 
­Ş_b¡_comp_func
 *
	mcmp
;

51 
­Ş_b¡_ä“_func
 *
	mä
;

53 
size_t
 
	msize
;

55 
b¡_node_t
 *
	mh—d
;

58 
­Ş_b¡_t
 *
	$­Ş_b¡_ü—‹
(
­Ş_b¡_comp_func
 * 
cmp
, 
­Ş_b¡_ä“_func
 * 
ä
)

60 
­Ş_b¡_t
 *
b
 = 
NULL
;

61 ià((
b
 = 
	`ÿÎoc
(1, (*b))è=ğ
NULL
) {

62  
NULL
;

64 
b
->
cmp
 = cmp;

65 
b
->
ä
 = fr;

66  
b
;

67 
	}
}

77 
	$b¡_node_ä“
(
b¡_node_t
 * 
node
, 
­Ş_b¡_ä“_func
 * 
ä
)

79 ià(
node
 !ğ
NULL
) {

80 ià(
ä
 !ğ
NULL
) {

81 
	`ä
(
node
->
–em
);

83 
	`b¡_node_ä“
(
node
->
chd
[0], 
ä
);

84 
	`b¡_node_ä“
(
node
->
chd
[1], 
ä
);

85 
	`ä“
(
node
);

87 
	}
}

89 
	$­Ş_b¡_de¡roy
(
­Ş_b¡_t
 ** 
b
)

91 ià(!
b
 || !(*b))

93 
	`b¡_node_ä“
((*
b
)->
h—d
, (*b)->
ä
);

94 (*
b
)->
h—d
 = 
NULL
;

95 
	`ä“
(*
b
);

96 *
b
 = 
NULL
;

97 
	}
}

108 
	$b¡_node_to_veùÜ
(
b¡_node_t
 * 
node
, 
­Ş_veùÜ_t
 * 
v
)

110 
»tv®
;

111 ià(
node
 =ğ
NULL
) {

114 ià((
»tv®
 = 
	`b¡_node_to_veùÜ
(
node
->
chd
[0], 
v
)) < 0) {

115  
»tv®
;

117 ià((
»tv®
 = 
	`­Ş_veùÜ_­³nd
(
v
, 
node
->
–em
)) < 0) {

118  
»tv®
;

120  
	`b¡_node_to_veùÜ
(
node
->
chd
[1], 
v
);

121 
	}
}

123 
­Ş_veùÜ_t
 *
	$­Ş_b¡_g‘_veùÜ
(
­Ş_b¡_t
 * 
b
, 
chªge_owÃr
)

125 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

126 ià(!
b
) {

127 
”ºo
 = 
EINVAL
;

128  
NULL
;

130 ià((
v
 = 
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(
b
->
size
, 
NULL
)) == NULL) {

131  
NULL
;

133 ià(
	`b¡_node_to_veùÜ
(
b
->
h—d
, 
v
) < 0) {

134 
”rÜ
 = 
”ºo
;

135 
	`­Ş_veùÜ_de¡roy
(&
v
);

136 
”ºo
 = 
”rÜ
;

137  
NULL
;

139 ià(
chªge_owÃr
) {

140 
	`veùÜ_£t_ä“_func
(
v
, 
b
->
ä
);

141 
b
->
ä
 = 
NULL
;

143  
v
;

144 
	}
}

146 
size_t
 
	$­Ş_b¡_g‘_size
(cÚ¡ 
­Ş_b¡_t
 * 
b
)

148 ià(!
b
) {

149 
”ºo
 = 
EINVAL
;

152  
b
->
size
;

154 
	}
}

156 
	$­Ş_b¡_g‘_–em’t
(cÚ¡ 
­Ş_b¡_t
 * 
b
, cÚ¡ *
–em
, *
d©a
, **
»suÉ
)

158 
b¡_node_t
 *
node
;

159 
compv®
;

160 ià(!
b
 || !
»suÉ
) {

161 
”ºo
 = 
EINVAL
;

164 
node
 = 
b
->
h—d
;

165 
node
 !ğ
NULL
) {

166 ià(
b
->
cmp
 !ğ
NULL
) {

167 
compv®
 = 
b
->
	`cmp
(
node
->
–em
,ƒËm, 
d©a
);

169 *
p1
 = (*)
node
->
–em
;

170 *
p2
 = (*)
–em
;

171 ià(
p1
 < 
p2
) {

172 
compv®
 = -1;

173 } ià(
p1
 > 
p2
) {

174 
compv®
 = 1;

176 
compv®
 = 0;

179 ià(
compv®
 == 0) {

180 *
»suÉ
 = 
node
->
–em
;

182 } ià(
compv®
 > 0) {

183 
node
 =‚ode->
chd
[0];

185 
node
 =‚ode->
chd
[1];

189 
	}
}

201 
b¡_node_t
 *
	$b¡_node_make
(
­Ş_b¡_t
 * 
b
, *
–em
)

203 
b¡_node_t
 *
Ãw_node
;

204 ià((
Ãw_node
 = 
	`ÿÎoc
(1, (*Ãw_node))è=ğ
NULL
) {

205  
NULL
;

207 
Ãw_node
->
–em
 =ƒlem;

208 
Ãw_node
->
is_»d
 = 1;

209 
b
->
size
++;

210  
Ãw_node
;

211 
	}
}

220 
	$b¡_node_is_»d
(
b¡_node_t
 * 
node
)

222  
node
 !ğ
NULL
 &&‚ode->
is_»d
;

223 
	}
}

225 
b¡_node_t
 *
	$b¡_rÙ©e_sšgË
(
b¡_node_t
 * 
roÙ
, 
dœ
)

227 
b¡_node_t
 *
§ve
 = 
roÙ
->
chd
[!
dœ
];

228 
roÙ
->
chd
[!
dœ
] = 
§ve
->child[dir];

229 
§ve
->
chd
[
dœ
] = 
roÙ
;

230 
roÙ
->
is_»d
 = 1;

231 
§ve
->
is_»d
 = 0;

232  
§ve
;

233 
	}
}

235 
b¡_node_t
 *
	$b¡_rÙ©e_doubË
(
b¡_node_t
 * 
roÙ
, 
dœ
)

237 
roÙ
->
chd
[!
dœ
] = 
	`b¡_rÙ©e_sšgË
(root->child[!dir], !dir);

238  
	`b¡_rÙ©e_sšgË
(
roÙ
, 
dœ
);

239 
	}
}

241 
b¡_node_t
 *
	$b¡_š£¹_»cursive
(
­Ş_b¡_t
 * 
b
, 
b¡_node_t
 * 
roÙ
, **
–em
, *
d©a
, 
­Ş_b¡_ä“_func
 * 
ä
,

242 *
nÙ_uniq
)

244 
compv®
, 
dœ
;

245 ià(
roÙ
 =ğ
NULL
) {

246 ià((
roÙ
 = 
	`b¡_node_make
(
b
, *
–em
)è=ğ
NULL
) {

247 *
nÙ_uniq
 = -1;

248  
NULL
;

250 *
nÙ_uniq
 = 0;

252 ià(
b
->
cmp
 !ğ
NULL
) {

253 
compv®
 = 
b
->
	`cmp
(
roÙ
->
–em
, *–em, 
d©a
);

255 *
p1
 = (*)
roÙ
->
–em
;

256 *
p2
 = (*)(*
–em
);

257 ià(
p1
 < 
p2
) {

258 
compv®
 = -1;

259 } ià(
p1
 > 
p2
) {

260 
compv®
 = 1;

262 
compv®
 = 0;

265 ià(
compv®
 == 0) {

267 ià(
ä
 !ğ
NULL
) {

268 
	`ä
(*
–em
);

270 *
–em
 = 
roÙ
->elem;

271 *
nÙ_uniq
 = 1;

272  
roÙ
;

273 } ià(
compv®
 > 0) {

274 
dœ
 = 0;

276 
dœ
 = 1;

278 
roÙ
->
chd
[
dœ
] = 
	`b¡_š£¹_»cursive
(
b
,„oÙ->chd[dœ], 
–em
, 
d©a
, 
ä
, 
nÙ_uniq
);

279 ià(*
nÙ_uniq
 != 0) {

280  
roÙ
;

284 ià(
	`b¡_node_is_»d
(
roÙ
->
chd
[
dœ
])) {

285 ià(
	`b¡_node_is_»d
(
roÙ
->
chd
[!
dœ
])) {

289 
roÙ
->
is_»d
 = 1;

290 
roÙ
->
chd
[0]->
is_»d
 = 0;

291 
roÙ
->
chd
[1]->
is_»d
 = 0;

293 ià(
	`b¡_node_is_»d
(
roÙ
->
chd
[
dœ
]->child[dir])) {

294 
roÙ
 = 
	`b¡_rÙ©e_sšgË
ÔoÙ, !
dœ
);

295 } ià(
	`b¡_node_is_»d
(
roÙ
->
chd
[
dœ
]->child[!dir])) {

296 
roÙ
 = 
	`b¡_rÙ©e_doubË
ÔoÙ, !
dœ
);

301  
roÙ
;

302 
	}
}

304 
	$­Ş_b¡_š£¹
(
­Ş_b¡_t
 * 
b
, *
–em
, *
d©a
)

306 
»tv®
 = -1;

307 ià(!
b
 || !
–em
) {

308 
”ºo
 = 
EINVAL
;

311 
b
->
h—d
 = 
	`b¡_š£¹_»cursive
(b, b->h—d, &
–em
, 
d©a
, 
NULL
, &
»tv®
);

312 ià(
»tv®
 >= 0) {

313 
b
->
h—d
->
is_»d
 = 0;

315  
»tv®
;

316 
	}
}

318 
	$­Ş_b¡_š£¹_ªd_g‘
(
­Ş_b¡_t
 * 
b
, **
–em
, *
d©a
)

320 
»tv®
 = -1;

321 ià(!
b
 || !
–em
) {

322 
”ºo
 = 
EINVAL
;

325 
b
->
h—d
 = 
	`b¡_š£¹_»cursive
(b, b->h—d, 
–em
, 
d©a
, b->
ä
, &
»tv®
);

326 ià(
»tv®
 >= 0) {

327 
b
->
h—d
->
is_»d
 = 0;

329  
»tv®
;

330 
	}
}

332 
b¡_šÜd”_m­
(cÚ¡ 
b¡_node_t
 * 
node
, (*
â
è(*, *), *
d©a
)

334 
»tv®
;

335 ià(
node
 =ğ
NULL
) {

338 ià((
»tv®
 = 
	`b¡_šÜd”_m­
(
node
->
chd
[0], 
â
, 
d©a
)) < 0) {

339  
»tv®
;

341 ià((
»tv®
 = 
	`â
(
node
->
–em
, 
d©a
)) < 0) {

342  
»tv®
;

344  
	`b¡_šÜd”_m­
(
node
->
chd
[1], 
â
, 
d©a
);

345 
	}
}

347 
­Ş_b¡_šÜd”_m­
(cÚ¡ 
­Ş_b¡_t
 * 
b
, (*
â
è(*, *), *
d©a
)

349 ià(
b
 =ğ
NULL
 || 
â
 == NULL)

351  
	`b¡_šÜd”_m­
(
b
->
h—d
, 
â
, 
d©a
);

352 
	}
}

	@libapol/src/class-perm-query.c

31 
	~"pŞicy-qu”y-š‹º®.h
"

32 
	~<”ºo.h
>

33 
	~<¡ršg.h
>

35 
	s­Ş_şass_qu”y


37 *
	mşass_Çme
, *
	mcommÚ_Çme
;

38 
	mæags
;

39 
»gex_t
 *
	mşass_»gex
, *
	mcommÚ_»gex
;

42 
	s­Ş_commÚ_qu”y


44 *
	mcommÚ_Çme
;

45 
	mæags
;

46 
»gex_t
 *
	m»gex
;

49 
	s­Ş_³rm_qu”y


51 *
	m³rm_Çme
;

52 
	mæags
;

53 
»gex_t
 *
	m»gex
;

58 
	$­Ş_şass_g‘_by_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_şass_qu”y_t
 * 
c
, 
­Ş_veùÜ_t
 ** 
v
)

60 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
, *
³rm_™”
 = NULL;

61 
»tv®
 = -1, 
­³nd_şass
;

62 *
v
 = 
NULL
;

63 ià(
	`qpŞ_pŞicy_g‘_şass_™”
(
p
->p, &
™”
) < 0) {

66 ià((*
v
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)) == NULL) {

67 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

68 
ş—nup
;

70 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

71 
qpŞ_şass_t
 *
şass_d©um
;

72 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
şass_d©um
) < 0) {

73 
ş—nup
;

75 
­³nd_şass
 = 1;

76 ià(
c
 !ğ
NULL
) {

77 cÚ¡ *
şass_Çme
, *
commÚ_Çme
 = 
NULL
;

78 cÚ¡ 
qpŞ_commÚ_t
 *
commÚ_d©um
;

79 
compv®
;

80 ià(
	`qpŞ_şass_g‘_Çme
(
p
->p, 
şass_d©um
, &
şass_Çme
) < 0) {

81 
ş—nup
;

83 
compv®
 = 
	`­Ş_com·»
(
p
, 
şass_Çme
, 
c
->şass_Çme, c->
æags
, &(c->
şass_»gex
));

84 ià(
compv®
 < 0) {

85 
ş—nup
;

86 } ià(
compv®
 == 0) {

89 ià(
	`qpŞ_şass_g‘_commÚ
(
p
->p, 
şass_d©um
, &
commÚ_d©um
) < 0) {

90 
ş—nup
;

92 ià(
commÚ_d©um
 =ğ
NULL
) {

93 ià(
c
->
commÚ_Çme
 !ğ
NULL
 && c->common_name[0] != '\0') {

97 ià(
	`qpŞ_commÚ_g‘_Çme
(
p
->p, 
commÚ_d©um
, &
commÚ_Çme
) < 0) {

98 
ş—nup
;

100 
compv®
 = 
	`­Ş_com·»
(
p
, 
commÚ_Çme
, 
c
->commÚ_Çme, c->
æags
, &(c->
commÚ_»gex
));

101 ià(
compv®
 < 0) {

102 
ş—nup
;

103 } ià(
compv®
 == 0) {

108 ià(
­³nd_şass
 && 
	`­Ş_veùÜ_­³nd
(*
v
, 
şass_d©um
)) {

109 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

110 
ş—nup
;

114 
»tv®
 = 0;

115 
ş—nup
:

116 ià(
»tv®
 != 0) {

117 
	`­Ş_veùÜ_de¡roy
(
v
);

119 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

120 
	`qpŞ_™”©Ü_de¡roy
(&
³rm_™”
);

121  
»tv®
;

122 
	}
}

124 
­Ş_şass_qu”y_t
 *
	$­Ş_şass_qu”y_ü—‹
()

126  
	`ÿÎoc
(1, (
­Ş_şass_qu”y_t
));

127 
	}
}

129 
	$­Ş_şass_qu”y_de¡roy
(
­Ş_şass_qu”y_t
 ** 
c
)

131 ià(*
c
 !ğ
NULL
) {

132 
	`ä“
((*
c
)->
şass_Çme
);

133 
	`ä“
((*
c
)->
commÚ_Çme
);

134 
	`­Ş_»gex_de¡roy
(&(*
c
)->
şass_»gex
);

135 
	`­Ş_»gex_de¡roy
(&(*
c
)->
commÚ_»gex
);

136 
	`ä“
(*
c
);

137 *
c
 = 
NULL
;

139 
	}
}

141 
	$­Ş_şass_qu”y_£t_şass
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_şass_qu”y_t
 * 
c
, cÚ¡ *
Çme
)

143  
	`­Ş_qu”y_£t
(
p
, &
c
->
şass_Çme
, &c->
şass_»gex
, 
Çme
);

144 
	}
}

146 
	$­Ş_şass_qu”y_£t_commÚ
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_şass_qu”y_t
 * 
c
, cÚ¡ *
Çme
)

148  
	`­Ş_qu”y_£t
(
p
, &
c
->
commÚ_Çme
, &c->
commÚ_»gex
, 
Çme
);

149 
	}
}

151 
	$­Ş_şass_qu”y_£t_»gex
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_şass_qu”y_t
 * 
c
, 
is_»gex
)

153  
	`­Ş_qu”y_£t_»gex
(
p
, &
c
->
æags
, 
is_»gex
);

154 
	}
}

158 
	$­Ş_commÚ_g‘_by_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_commÚ_qu”y_t
 * 
c
, 
­Ş_veùÜ_t
 ** 
v
)

160 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

161 
»tv®
 = -1;

162 *
v
 = 
NULL
;

163 ià(
	`qpŞ_pŞicy_g‘_commÚ_™”
(
p
->p, &
™”
) < 0) {

166 ià((*
v
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)) == NULL) {

167 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

168 
ş—nup
;

170 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

171 
qpŞ_commÚ_t
 *
commÚ_d©um
;

172 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
commÚ_d©um
) < 0) {

173 
ş—nup
;

175 ià(
c
 !ğ
NULL
) {

176 cÚ¡ *
commÚ_Çme
 = 
NULL
;

177 
compv®
;

178 ià(
	`qpŞ_commÚ_g‘_Çme
(
p
->p, 
commÚ_d©um
, &
commÚ_Çme
) < 0) {

179 
ş—nup
;

181 
compv®
 = 
	`­Ş_com·»
(
p
, 
commÚ_Çme
, 
c
->commÚ_Çme, c->
æags
, &(c->
»gex
));

182 ià(
compv®
 < 0) {

183 
ş—nup
;

184 } ià(
compv®
 == 0) {

188 ià(
	`­Ş_veùÜ_­³nd
(*
v
, 
commÚ_d©um
)) {

189 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

190 
ş—nup
;

194 
»tv®
 = 0;

195 
ş—nup
:

196 ià(
»tv®
 != 0) {

197 
	`­Ş_veùÜ_de¡roy
(
v
);

199 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

200  
»tv®
;

201 
	}
}

203 
­Ş_commÚ_qu”y_t
 *
	$­Ş_commÚ_qu”y_ü—‹
()

205  
	`ÿÎoc
(1, (
­Ş_commÚ_qu”y_t
));

206 
	}
}

208 
	$­Ş_commÚ_qu”y_de¡roy
(
­Ş_commÚ_qu”y_t
 ** 
c
)

210 ià(*
c
 !ğ
NULL
) {

211 
	`ä“
((*
c
)->
commÚ_Çme
);

212 
	`­Ş_»gex_de¡roy
(&(*
c
)->
»gex
);

213 
	`ä“
(*
c
);

214 *
c
 = 
NULL
;

216 
	}
}

218 
	$­Ş_commÚ_qu”y_£t_commÚ
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_commÚ_qu”y_t
 * 
c
, cÚ¡ *
Çme
)

220  
	`­Ş_qu”y_£t
(
p
, &
c
->
commÚ_Çme
, &c->
»gex
, 
Çme
);

221 
	}
}

223 
	$­Ş_commÚ_qu”y_£t_»gex
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_commÚ_qu”y_t
 * 
c
, 
is_»gex
)

225  
	`­Ş_qu”y_£t_»gex
(
p
, &
c
->
æags
, 
is_»gex
);

226 
	}
}

230 
	$­Ş_³rm_g‘_by_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_³rm_qu”y_t
 * 
pq
, 
­Ş_veùÜ_t
 ** 
v
)

232 
qpŞ_™”©Ü_t
 *
şass_™”
 = 
NULL
, *
commÚ_™”
 = NULL, *
³rm_™”
 = NULL;

233 
»tv®
 = -1, 
compv®
;

234 *
³rm_Çme
;

235 *
v
 = 
NULL
;

236 ià(
	`qpŞ_pŞicy_g‘_şass_™”
(
p
->p, &
şass_™”
è< 0 || 
	`qpŞ_pŞicy_g‘_commÚ_™”
Õ->p, &
commÚ_™”
) < 0) {

237 
ş—nup
;

239 ià((*
v
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)) == NULL) {

240 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

241 
ş—nup
;

243 ; !
	`qpŞ_™”©Ü_’d
(
şass_™”
); 
	`qpŞ_™”©Ü_Ãxt
(class_iter)) {

244 
qpŞ_şass_t
 *
şass_d©um
;

245 ià(
	`qpŞ_™”©Ü_g‘_™em
(
şass_™”
, (**)&
şass_d©um
) < 0 ||

246 
	`qpŞ_şass_g‘_³rm_™”
(
p
->p, 
şass_d©um
, &
³rm_™”
) < 0) {

247 
ş—nup
;

249 ; !
	`qpŞ_™”©Ü_’d
(
³rm_™”
); 
	`qpŞ_™”©Ü_Ãxt
(perm_iter)) {

250 ià(
	`qpŞ_™”©Ü_g‘_™em
(
³rm_™”
, (**)&
³rm_Çme
) < 0) {

251 
ş—nup
;

253 ià(
pq
 =ğ
NULL
) {

254 
compv®
 = 1;

256 
compv®
 = 
	`­Ş_com·»
(
p
, 
³rm_Çme
, 
pq
->³rm_Çme,…q->
æags
, &Õq->
»gex
));

258 ià(
compv®
 < 0) {

259 
ş—nup
;

260 } ià(
compv®
 =ğ1 && 
	`­Ş_veùÜ_­³nd_unique
(*
v
, 
³rm_Çme
, 
­Ş_¡r_¡rcmp
, 
NULL
) < 0) {

261 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

262 
ş—nup
;

265 
	`qpŞ_™”©Ü_de¡roy
(&
³rm_™”
);

268 ; !
	`qpŞ_™”©Ü_’d
(
commÚ_™”
); 
	`qpŞ_™”©Ü_Ãxt
(common_iter)) {

269 
qpŞ_commÚ_t
 *
commÚ_d©um
;

270 ià(
	`qpŞ_™”©Ü_g‘_™em
(
commÚ_™”
, (**)&
commÚ_d©um
) < 0 ||

271 
	`qpŞ_commÚ_g‘_³rm_™”
(
p
->p, 
commÚ_d©um
, &
³rm_™”
) < 0) {

272 
ş—nup
;

274 ; !
	`qpŞ_™”©Ü_’d
(
³rm_™”
); 
	`qpŞ_™”©Ü_Ãxt
(perm_iter)) {

275 ià(
	`qpŞ_™”©Ü_g‘_™em
(
³rm_™”
, (**)&
³rm_Çme
) < 0) {

276 
ş—nup
;

278 ià(
pq
 =ğ
NULL
) {

279 
compv®
 = 1;

281 
compv®
 = 
	`­Ş_com·»
(
p
, 
³rm_Çme
, 
pq
->³rm_Çme,…q->
æags
, &Õq->
»gex
));

283 ià(
compv®
 < 0) {

284 
ş—nup
;

285 } ià(
compv®
 =ğ1 && 
	`­Ş_veùÜ_­³nd_unique
(*
v
, 
³rm_Çme
, 
­Ş_¡r_¡rcmp
, 
NULL
) < 0) {

286 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

287 
ş—nup
;

290 
	`qpŞ_™”©Ü_de¡roy
(&
³rm_™”
);

293 
»tv®
 = 0;

294 
ş—nup
:

295 ià(
»tv®
 != 0) {

296 
	`­Ş_veùÜ_de¡roy
(
v
);

298 
	`qpŞ_™”©Ü_de¡roy
(&
şass_™”
);

299 
	`qpŞ_™”©Ü_de¡roy
(&
commÚ_™”
);

300 
	`qpŞ_™”©Ü_de¡roy
(&
³rm_™”
);

301  
»tv®
;

302 
	}
}

304 
­Ş_³rm_qu”y_t
 *
	$­Ş_³rm_qu”y_ü—‹
()

306  
	`ÿÎoc
(1, (
­Ş_³rm_qu”y_t
));

307 
	}
}

309 
	$­Ş_³rm_qu”y_de¡roy
(
­Ş_³rm_qu”y_t
 ** 
pq
)

311 ià(*
pq
 !ğ
NULL
) {

312 
	`ä“
((*
pq
)->
³rm_Çme
);

313 
	`­Ş_»gex_de¡roy
(&(*
pq
)->
»gex
);

314 
	`ä“
(*
pq
);

315 *
pq
 = 
NULL
;

317 
	}
}

319 
	$­Ş_³rm_qu”y_£t_³rm
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_³rm_qu”y_t
 * 
pq
, cÚ¡ *
Çme
)

321  
	`­Ş_qu”y_£t
(
p
, &
pq
->
³rm_Çme
, &pq->
»gex
, 
Çme
);

322 
	}
}

324 
	$­Ş_³rm_qu”y_£t_»gex
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_³rm_qu”y_t
 * 
pq
, 
is_»gex
)

326  
	`­Ş_qu”y_£t_»gex
(
p
, &
pq
->
æags
, 
is_»gex
);

327 
	}
}

	@libapol/src/condrule-query.c

31 
	~"pŞicy-qu”y-š‹º®.h
"

32 
	~<”ºo.h
>

34 
	s­Ş_cÚd_qu”y


36 *
	mboŞ_Çme
;

37 
	mæags
;

38 
»gex_t
 *
	m»gex
;

41 
	$­Ş_cÚd_g‘_by_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_cÚd_qu”y_t
 * 
c
, 
­Ş_veùÜ_t
 ** 
v
)

43 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

44 
»tv®
 = -1;

45 *
v
 = 
NULL
;

47 ià(
	`qpŞ_pŞicy_g‘_cÚd_™”
(
p
->p, &
™”
) < 0) {

48 
ş—nup
;

50 ià((*
v
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)) == NULL) {

51 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

52 
ş—nup
;

54 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

55 
qpŞ_cÚd_t
 *
cÚd
;

56 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
cÚd
) < 0) {

57 
ş—nup
;

59 ià(
c
 !ğ
NULL
) {

60 
k“p_cÚd
 = 
	`­Ş_com·»_cÚd_ex´
(
p
, 
cÚd
, 
c
->
boŞ_Çme
, c->
æags
, &c->
»gex
);

61 ià(
k“p_cÚd
 < 0) {

62 
ş—nup
;

63 } ià(
k“p_cÚd
 == 0) {

67 ià(
	`­Ş_veùÜ_­³nd
(*
v
, 
cÚd
)) {

68 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

69 
ş—nup
;

73 
»tv®
 = 0;

74 
ş—nup
:

75 ià(
»tv®
 != 0) {

76 
	`­Ş_veùÜ_de¡roy
(
v
);

78 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

79  
»tv®
;

80 
	}
}

82 
­Ş_cÚd_qu”y_t
 *
	$­Ş_cÚd_qu”y_ü—‹
()

84  
	`ÿÎoc
(1, (
­Ş_cÚd_qu”y_t
));

85 
	}
}

87 
	$­Ş_cÚd_qu”y_de¡roy
(
­Ş_cÚd_qu”y_t
 ** 
c
)

89 ià(*
c
 !ğ
NULL
) {

90 
	`ä“
((*
c
)->
boŞ_Çme
);

91 
	`­Ş_»gex_de¡roy
(&(*
c
)->
»gex
);

92 
	`ä“
(*
c
);

93 *
c
 = 
NULL
;

95 
	}
}

97 
	$­Ş_cÚd_qu”y_£t_boŞ
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_cÚd_qu”y_t
 * 
c
, cÚ¡ *
Çme
)

99  
	`­Ş_qu”y_£t
(
p
, &
c
->
boŞ_Çme
, &c->
»gex
, 
Çme
);

100 
	}
}

102 
	$­Ş_cÚd_qu”y_£t_»gex
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_cÚd_qu”y_t
 * 
c
, 
is_»gex
)

104  
	`­Ş_qu”y_£t_»gex
(
p
, &
c
->
æags
, 
is_»gex
);

105 
	}
}

107 *
	$­Ş_cÚd_ex´_»nd”
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
qpŞ_cÚd_t
 * 
cÚd
)

109 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

110 
qpŞ_cÚd_ex´_node_t
 *
ex´
 = 
NULL
;

111 *
tmp
 = 
NULL
;

112 cÚ¡ *
boŞ_Çme
 = 
NULL
;

113 
”rÜ
 = 0;

114 
size_t
 
tmp_sz
 = 0, 
i
;

115 
ušt32_t
 
ex´_ty³
 = 0;

116 
qpŞ_boŞ_t
 *
cÚd_boŞ
 = 
NULL
;

118 ià(!
p
 || !
cÚd
) {

119 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
EINVAL
));

120 
”ºo
 = 
EINVAL
;

121  
NULL
;

123 ià(
	`qpŞ_cÚd_g‘_ex´_node_™”
(
p
->p, 
cÚd
, &
™”
) < 0) {

124 
”rÜ
 = 
”ºo
;

125 
”r
;

128 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

129 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
ex´
)) {

130 
”rÜ
 = 
”ºo
;

131 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”rÜ
));

132 
”r
;

134 ià(
	`qpŞ_cÚd_ex´_node_g‘_ex´_ty³
(
p
->p, 
ex´
, &
ex´_ty³
)) {

135 
”rÜ
 = 
”ºo
;

136 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”rÜ
));

137 
”r
;

139 ià(
ex´_ty³
 !ğ
QPOL_COND_EXPR_BOOL
) {

140 ià(
	`­Ş_¡r_­³nd
(&
tmp
, &
tmp_sz
, 
	`­Ş_cÚd_ex´_ty³_to_¡r
(
ex´_ty³
))) {

141 
”rÜ
 = 
”ºo
;

142 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”rÜ
));

143 
”r
;

146 ià(
	`qpŞ_cÚd_ex´_node_g‘_boŞ
(
p
->p, 
ex´
, &
cÚd_boŞ
)) {

147 
”rÜ
 = 
”ºo
;

148 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”rÜ
));

149 
”r
;

151 ià(
	`qpŞ_boŞ_g‘_Çme
(
p
->p, 
cÚd_boŞ
, &
boŞ_Çme
)) {

152 
”rÜ
 = 
”ºo
;

153 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”rÜ
));

154 
”r
;

156 ià(
	`­Ş_¡r_­³nd
(&
tmp
, &
tmp_sz
, 
boŞ_Çme
)) {

157 
”rÜ
 = 
”ºo
;

158 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”rÜ
));

159 
”r
;

162 ià(
	`­Ş_¡r_­³nd
(&
tmp
, &
tmp_sz
, " ")) {

163 
”rÜ
 = 
”ºo
;

164 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”rÜ
));

165 
”r
;

170 
i
 = 
	`¡¾’
(
tmp
);

171 ià(
i
 > 1) {

172 
tmp
[
i
 - 1] = '\0';

174 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

175  
tmp
;

177 
”r
:

178 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

179 
	`ä“
(
tmp
);

180 
”ºo
 = 
”rÜ
;

181  
NULL
;

182 
	}
}

	@libapol/src/constraint-query.c

31 
	~"pŞicy-qu”y-š‹º®.h
"

32 
	~<”ºo.h
>

33 
	~<¡ršg.h
>

35 
	s­Ş_cÚ¡¿št_qu”y


37 *
	mşass_Çme
, *
	m³rm_Çme
;

38 
	mæags
;

39 
»gex_t
 *
	mşass_»gex
, *
	m³rm_»gex
;

42 
	s­Ş_v®id©‘¿ns_qu”y


44 *
	mşass_Çme
;

45 
	mæags
;

46 
»gex_t
 *
	m»gex
;

51 
	$­Ş_cÚ¡¿št_g‘_by_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_cÚ¡¿št_qu”y_t
 * 
c
, 
­Ş_veùÜ_t
 ** 
v
)

53 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
, *
³rm_™”
 = NULL;

54 
»tv®
 = -1;

55 *
v
 = 
NULL
;

56 ià(
	`qpŞ_pŞicy_g‘_cÚ¡¿št_™”
(
p
->p, &
™”
) < 0) {

59 ià((*
v
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)) == NULL) {

60 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

61 
ş—nup
;

63 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

64 
qpŞ_cÚ¡¿št_t
 *
cÚ¡¿št
;

65 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
cÚ¡¿št
) < 0) {

66 
ş—nup
;

68 ià(
c
 !ğ
NULL
) {

69 cÚ¡ 
qpŞ_şass_t
 *
şass_d©um
;

70 cÚ¡ *
şass_Çme
;

71 
compv®
;

72 ià(
	`qpŞ_cÚ¡¿št_g‘_şass
(
p
->p, 
cÚ¡¿št
, &
şass_d©um
) < 0 ||

73 
	`qpŞ_şass_g‘_Çme
(
p
->p, 
şass_d©um
, &
şass_Çme
) < 0) {

74 
ş—nup
;

76 
compv®
 = 
	`­Ş_com·»
(
p
, 
şass_Çme
, 
c
->şass_Çme, c->
æags
, &(c->
şass_»gex
));

77 ià(
compv®
 < 0) {

78 
ş—nup
;

79 } ià(
compv®
 == 0) {

80 
	`ä“
(
cÚ¡¿št
);

84 ià(
	`qpŞ_cÚ¡¿št_g‘_³rm_™”
(
p
->p, 
cÚ¡¿št
, &
³rm_™”
) < 0) {

85 
ş—nup
;

87 
compv®
 = 
	`­Ş_com·»_™”
(
p
, 
³rm_™”
, 
c
->
³rm_Çme
, c->
æags
, &(c->
³rm_»gex
), 1);

88 
	`qpŞ_™”©Ü_de¡roy
(&
³rm_™”
);

89 ià(
compv®
 < 0) {

90 
ş—nup
;

91 } ià(
compv®
 == 0) {

92 
	`ä“
(
cÚ¡¿št
);

96 ià(
	`­Ş_veùÜ_­³nd
(*
v
, 
cÚ¡¿št
)) {

97 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

98 
ş—nup
;

102 
»tv®
 = 0;

103 
ş—nup
:

104 ià(
»tv®
 != 0) {

105 
	`­Ş_veùÜ_de¡roy
(
v
);

107 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

108 
	`qpŞ_™”©Ü_de¡roy
(&
³rm_™”
);

109  
»tv®
;

110 
	}
}

112 
­Ş_cÚ¡¿št_qu”y_t
 *
	$­Ş_cÚ¡¿št_qu”y_ü—‹
()

114  
	`ÿÎoc
(1, (
­Ş_cÚ¡¿št_qu”y_t
));

115 
	}
}

117 
	$­Ş_cÚ¡¿št_qu”y_de¡roy
(
­Ş_cÚ¡¿št_qu”y_t
 ** 
c
)

119 ià(*
c
 !ğ
NULL
) {

120 
	`ä“
((*
c
)->
şass_Çme
);

121 
	`ä“
((*
c
)->
³rm_Çme
);

122 
	`­Ş_»gex_de¡roy
(&(*
c
)->
şass_»gex
);

123 
	`­Ş_»gex_de¡roy
(&(*
c
)->
³rm_»gex
);

124 
	`ä“
(*
c
);

125 *
c
 = 
NULL
;

127 
	}
}

129 
	$­Ş_cÚ¡¿št_qu”y_£t_şass
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_cÚ¡¿št_qu”y_t
 * 
c
, cÚ¡ *
Çme
)

131  
	`­Ş_qu”y_£t
(
p
, &
c
->
şass_Çme
, &c->
şass_»gex
, 
Çme
);

132 
	}
}

134 
	$­Ş_cÚ¡¿št_qu”y_£t_³rm
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_cÚ¡¿št_qu”y_t
 * 
c
, cÚ¡ *
Çme
)

136  
	`­Ş_qu”y_£t
(
p
, &
c
->
³rm_Çme
, &c->
³rm_»gex
, 
Çme
);

137 
	}
}

139 
	$­Ş_cÚ¡¿št_qu”y_£t_»gex
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_cÚ¡¿št_qu”y_t
 * 
c
, 
is_»gex
)

141  
	`­Ş_qu”y_£t_»gex
(
p
, &
c
->
æags
, 
is_»gex
);

142 
	}
}

146 
	$­Ş_v®id©‘¿ns_g‘_by_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_v®id©‘¿ns_qu”y_t
 * 
vt
, 
­Ş_veùÜ_t
 ** 
v
)

148 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

149 
»tv®
 = -1;

150 *
v
 = 
NULL
;

151 ià(
	`qpŞ_pŞicy_g‘_v®id©‘¿ns_™”
(
p
->p, &
™”
) < 0) {

154 ià((*
v
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)) == NULL) {

155 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

156 
ş—nup
;

158 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

159 
qpŞ_v®id©‘¿ns_t
 *
v®id©‘¿ns
;

160 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
v®id©‘¿ns
) < 0) {

161 
ş—nup
;

163 ià(
vt
 !ğ
NULL
) {

164 cÚ¡ 
qpŞ_şass_t
 *
şass_d©um
;

165 cÚ¡ *
şass_Çme
;

166 
compv®
;

167 ià(
	`qpŞ_v®id©‘¿ns_g‘_şass
(
p
->p, 
v®id©‘¿ns
, &
şass_d©um
) < 0 ||

168 
	`qpŞ_şass_g‘_Çme
(
p
->p, 
şass_d©um
, &
şass_Çme
) < 0) {

169 
ş—nup
;

171 
compv®
 = 
	`­Ş_com·»
(
p
, 
şass_Çme
, 
vt
->şass_Çme, vt->
æags
, &(vt->
»gex
));

172 ià(
compv®
 < 0) {

173 
ş—nup
;

174 } ià(
compv®
 == 0) {

175 
	`ä“
(
v®id©‘¿ns
);

179 ià(
	`­Ş_veùÜ_­³nd
(*
v
, 
v®id©‘¿ns
)) {

180 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

181 
ş—nup
;

185 
»tv®
 = 0;

186 
ş—nup
:

187 ià(
»tv®
 != 0) {

188 
	`­Ş_veùÜ_de¡roy
(
v
);

190 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

191  
»tv®
;

192 
	}
}

194 
­Ş_v®id©‘¿ns_qu”y_t
 *
	$­Ş_v®id©‘¿ns_qu”y_ü—‹
()

196  
	`ÿÎoc
(1, (
­Ş_v®id©‘¿ns_qu”y_t
));

197 
	}
}

199 
	$­Ş_v®id©‘¿ns_qu”y_de¡roy
(
­Ş_v®id©‘¿ns_qu”y_t
 ** 
vt
)

201 ià(*
vt
 !ğ
NULL
) {

202 
	`ä“
((*
vt
)->
şass_Çme
);

203 
	`­Ş_»gex_de¡roy
(&(*
vt
)->
»gex
);

204 
	`ä“
(*
vt
);

205 *
vt
 = 
NULL
;

207 
	}
}

209 
	$­Ş_v®id©‘¿ns_qu”y_£t_şass
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_v®id©‘¿ns_qu”y_t
 * 
vt
, cÚ¡ *
Çme
)

211  
	`­Ş_qu”y_£t
(
p
, &
vt
->
şass_Çme
, &vt->
»gex
, 
Çme
);

212 
	}
}

214 
	$­Ş_v®id©‘¿ns_qu”y_£t_»gex
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_v®id©‘¿ns_qu”y_t
 * 
vt
, 
is_»gex
)

216  
	`­Ş_qu”y_£t_»gex
(
p
, &
vt
->
æags
, 
is_»gex
);

217 
	}
}

	@libapol/src/context-query.c

25 
	~"pŞicy-qu”y-š‹º®.h
"

27 
	~<as£¹.h
>

28 
	~<”ºo.h
>

29 
	~<¡dboŞ.h
>

30 
	~<¡dlib.h
>

31 
	~<¡ršg.h
>

33 
	~<­Ş/»nd”.h
>

35 
	s­Ş_cÚ‹xt


37 *
	mu£r
, *
	mrŞe
, *
	mty³
;

38 
­Ş_mls_¿nge_t
 *
	m¿nge
;

41 
­Ş_cÚ‹xt_t
 *
	$­Ş_cÚ‹xt_ü—‹
()

43  
	`ÿÎoc
(1, (
­Ş_cÚ‹xt_t
));

44 
	}
}

46 
­Ş_cÚ‹xt_t
 *
	$­Ş_cÚ‹xt_ü—‹_äom_qpŞ_cÚ‹xt
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
qpŞ_cÚ‹xt_t
 * 
cÚ‹xt
)

48 
­Ş_cÚ‹xt_t
 *
c
 = 
NULL
;

49 cÚ¡ 
qpŞ_u£r_t
 *
u£r
;

50 cÚ¡ 
qpŞ_rŞe_t
 *
rŞe
;

51 cÚ¡ 
qpŞ_ty³_t
 *
ty³
;

52 cÚ¡ 
qpŞ_mls_¿nge_t
 *
¿nge
;

53 cÚ¡ *
u£r_Çme
, *
rŞe_Çme
, *
ty³_Çme
;

54 
­Ş_mls_¿nge_t
 *
­Ş_¿nge
 = 
NULL
;

55 ià((
c
 = 
	`­Ş_cÚ‹xt_ü—‹
()è=ğ
NULL
) {

56 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

57 
”r
;

59 ià(
	`qpŞ_cÚ‹xt_g‘_u£r
(
p
->p, 
cÚ‹xt
, &
u£r
) < 0 ||

60 
	`qpŞ_cÚ‹xt_g‘_rŞe
(
p
->p, 
cÚ‹xt
, &
rŞe
) < 0 ||

61 
	`qpŞ_cÚ‹xt_g‘_ty³
(
p
->p, 
cÚ‹xt
, &
ty³
è< 0 || 
	`qpŞ_cÚ‹xt_g‘_¿nge
Õ->p, cÚ‹xt, &
¿nge
) < 0) {

62 
”r
;

64 ià(
	`qpŞ_u£r_g‘_Çme
(
p
->p, 
u£r
, &
u£r_Çme
) < 0 ||

65 
	`qpŞ_rŞe_g‘_Çme
(
p
->p, 
rŞe
, &
rŞe_Çme
è< 0 || 
	`qpŞ_ty³_g‘_Çme
Õ->p, 
ty³
, &
ty³_Çme
) < 0) {

66 
”r
;

68 ià(
	`qpŞ_pŞicy_has_ÿ·b™y
(
p
->p, 
QPOL_CAP_MLS
)) {

71 ià((
­Ş_¿nge
 = 
	`­Ş_mls_¿nge_ü—‹_äom_qpŞ_mls_¿nge
(
p
, 
¿nge
)è=ğ
NULL
) {

72 
”r
;

75 ià(
	`­Ş_cÚ‹xt_£t_u£r
(
p
, 
c
, 
u£r_Çme
) < 0 ||

76 
	`­Ş_cÚ‹xt_£t_rŞe
(
p
, 
c
, 
rŞe_Çme
) < 0 ||

77 
	`­Ş_cÚ‹xt_£t_ty³
(
p
, 
c
, 
ty³_Çme
è< 0 || 
	`­Ş_cÚ‹xt_£t_¿nge
Õ, c, 
­Ş_¿nge
) < 0) {

78 
”r
;

80  
c
;

81 
”r
:

82 
	`­Ş_mls_¿nge_de¡roy
(&
­Ş_¿nge
);

83 
	`­Ş_cÚ‹xt_de¡roy
(&
c
);

84  
NULL
;

85 
	}
}

87 
­Ş_cÚ‹xt_t
 *
	$­Ş_cÚ‹xt_ü—‹_äom_l™”®
(cÚ¡ *
cÚ‹xt_¡ršg
)

89 
­Ş_cÚ‹xt_t
 *
c
 = 
NULL
;

90 
boŞ
 
is_cÚ‹xt_comped
 = 
çl£
;

91 
»gex_t
 
cÚ‹xt_»gex
;

92 cÚ¡ 
size_t
 
nm©ch
 = 5;

93 
»gm©ch_t
 
pm©ch
[
nm©ch
];

95 ià((
c
 = 
	`­Ş_cÚ‹xt_ü—‹
()è=ğ
NULL
) {

96 
”r
;

99 ià(
	`»gcomp
(&
cÚ‹xt_»gex
, "^([^:]*):([^:]*):([^:]*):?(.*)$", 
REG_EXTENDED
) != 0) {

100 
”r
;

102 
is_cÚ‹xt_comped
 = 
Œue
;

104 ià(
	`»gexec
(&
cÚ‹xt_»gex
, 
cÚ‹xt_¡ršg
, 
nm©ch
, 
pm©ch
, 0) != 0) {

105 
”ºo
 = 
EIO
;

106 
”r
;

109 cÚ¡ *
s
;

110 
size_t
 
Ën
;

112 
	`as£¹
(
pm©ch
[1].
rm_so
 == 0);

113 
s
 = 
cÚ‹xt_¡ršg
 + 
pm©ch
[1].
rm_so
;

114 
Ën
 = 
pm©ch
[1].
rm_eo
 -…m©ch[1].
rm_so
;

115 ià(
Ën
 !ğ0 && *
s
 !ğ'*' && (
c
->
u£r
 = 
	`¡ºdup
(s,†’)è=ğ
NULL
) {

116 
”r
;

119 
	`as£¹
(
pm©ch
[2].
rm_so
 != -1);

120 
s
 = 
cÚ‹xt_¡ršg
 + 
pm©ch
[2].
rm_so
;

121 
Ën
 = 
pm©ch
[2].
rm_eo
 -…m©ch[2].
rm_so
;

122 ià(
Ën
 !ğ0 && *
s
 !ğ'*' && (
c
->
rŞe
 = 
	`¡ºdup
(s,†’)è=ğ
NULL
) {

123 
”r
;

126 
	`as£¹
(
pm©ch
[3].
rm_so
 != -1);

127 
s
 = 
cÚ‹xt_¡ršg
 + 
pm©ch
[3].
rm_so
;

128 
Ën
 = 
pm©ch
[3].
rm_eo
 -…m©ch[3].
rm_so
;

129 ià(
Ën
 !ğ0 && *
s
 !ğ'*' && (
c
->
ty³
 = 
	`¡ºdup
(s,†’)è=ğ
NULL
) {

130 
”r
;

133 ià(
pm©ch
[4].
rm_so
 != -1) {

134 
s
 = 
cÚ‹xt_¡ršg
 + 
pm©ch
[4].
rm_so
;

135 
Ën
 = 
pm©ch
[4].
rm_eo
 -…m©ch[4].
rm_so
;

136 ià(
Ën
 !ğ0 && *
s
 !ğ'*' && (
c
->
¿nge
 = 
	`­Ş_mls_¿nge_ü—‹_äom_l™”®
(s)è=ğ
NULL
) {

137 
”r
;

141 
	`»gä“
(&
cÚ‹xt_»gex
);

142  
c
;

144 
”r
:

145 
	`­Ş_cÚ‹xt_de¡roy
(&
c
);

146 ià(
is_cÚ‹xt_comped
) {

147 
	`»gä“
(&
cÚ‹xt_»gex
);

149  
NULL
;

150 
	}
}

152 
	$­Ş_cÚ‹xt_de¡roy
(
­Ş_cÚ‹xt_t
 ** 
cÚ‹xt
)

154 ià(*
cÚ‹xt
 !ğ
NULL
) {

155 
	`ä“
((*
cÚ‹xt
)->
u£r
);

156 
	`ä“
((*
cÚ‹xt
)->
rŞe
);

157 
	`ä“
((*
cÚ‹xt
)->
ty³
);

158 
	`­Ş_mls_¿nge_de¡roy
(&((*
cÚ‹xt
)->
¿nge
));

159 
	`ä“
(*
cÚ‹xt
);

160 *
cÚ‹xt
 = 
NULL
;

162 
	}
}

164 
	$­Ş_cÚ‹xt_£t_u£r
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_cÚ‹xt_t
 * 
cÚ‹xt
, cÚ¡ *
u£r
)

166 ià(
cÚ‹xt
 =ğ
NULL
) {

167 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
EINVAL
));

168 
”ºo
 = 
EINVAL
;

171 ià(
u£r
 !ğ
cÚ‹xt
->user) {

172 
	`ä“
(
cÚ‹xt
->
u£r
);

173 
cÚ‹xt
->
u£r
 = 
NULL
;

174 ià(
u£r
 !ğ
NULL
 && (
cÚ‹xt
->u£¸ğ
	`¡rdup
(user)) == NULL) {

175 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

180 
	}
}

182 
	$­Ş_cÚ‹xt_£t_rŞe
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_cÚ‹xt_t
 * 
cÚ‹xt
, cÚ¡ *
rŞe
)

184 ià(
cÚ‹xt
 =ğ
NULL
) {

185 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
EINVAL
));

186 
”ºo
 = 
EINVAL
;

189 ià(
rŞe
 !ğ
cÚ‹xt
->role) {

190 
	`ä“
(
cÚ‹xt
->
rŞe
);

191 
cÚ‹xt
->
rŞe
 = 
NULL
;

192 ià(
rŞe
 !ğ
NULL
 && (
cÚ‹xt
->rŞğ
	`¡rdup
(role)) == NULL) {

193 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

198 
	}
}

200 
	$­Ş_cÚ‹xt_£t_ty³
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_cÚ‹xt_t
 * 
cÚ‹xt
, cÚ¡ *
ty³
)

202 ià(
cÚ‹xt
 =ğ
NULL
) {

203 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
EINVAL
));

204 
”ºo
 = 
EINVAL
;

207 ià(
ty³
 !ğ
cÚ‹xt
->type) {

208 
	`ä“
(
cÚ‹xt
->
ty³
);

209 
cÚ‹xt
->
ty³
 = 
NULL
;

210 ià(
ty³
 !ğ
NULL
 && (
cÚ‹xt
->ty³ = 
	`¡rdup
(type)) == NULL) {

211 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

216 
	}
}

218 
	$­Ş_cÚ‹xt_£t_¿nge
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_cÚ‹xt_t
 * 
cÚ‹xt
, 
­Ş_mls_¿nge_t
 * 
¿nge
)

220 ià(
cÚ‹xt
 =ğ
NULL
) {

221 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
EINVAL
));

222 
”ºo
 = 
EINVAL
;

225 ià(
¿nge
 !ğ
cÚ‹xt
->range) {

226 
	`­Ş_mls_¿nge_de¡roy
(&(
cÚ‹xt
->
¿nge
));

227 
cÚ‹xt
->
¿nge
 =„ange;

230 
	}
}

232 cÚ¡ *
	$­Ş_cÚ‹xt_g‘_u£r
(cÚ¡ 
­Ş_cÚ‹xt_t
 * 
cÚ‹xt
)

234 ià(
cÚ‹xt
 =ğ
NULL
) {

235 
”ºo
 = 
EINVAL
;

236  
NULL
;

238  
cÚ‹xt
->
u£r
;

239 
	}
}

241 cÚ¡ *
	$­Ş_cÚ‹xt_g‘_rŞe
(cÚ¡ 
­Ş_cÚ‹xt_t
 * 
cÚ‹xt
)

243 ià(
cÚ‹xt
 =ğ
NULL
) {

244 
”ºo
 = 
EINVAL
;

245  
NULL
;

247  
cÚ‹xt
->
rŞe
;

248 
	}
}

250 cÚ¡ *
	$­Ş_cÚ‹xt_g‘_ty³
(cÚ¡ 
­Ş_cÚ‹xt_t
 * 
cÚ‹xt
)

252 ià(
cÚ‹xt
 =ğ
NULL
) {

253 
”ºo
 = 
EINVAL
;

254  
NULL
;

256  
cÚ‹xt
->
ty³
;

257 
	}
}

259 cÚ¡ 
­Ş_mls_¿nge_t
 *
	$­Ş_cÚ‹xt_g‘_¿nge
(cÚ¡ 
­Ş_cÚ‹xt_t
 * 
cÚ‹xt
)

261 ià(
cÚ‹xt
 =ğ
NULL
) {

262 
”ºo
 = 
EINVAL
;

263  
NULL
;

265  
cÚ‹xt
->
¿nge
;

266 
	}
}

268 
	$­Ş_cÚ‹xt_com·»
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
­Ş_cÚ‹xt_t
 * 
rg‘
, cÚ¡‡pŞ_cÚ‹xt_ˆ* 
£¬ch
,

269 
¿nge_com·»_ty³
)

271 
ušt32_t
 
v®ue0
, 
v®ue1
;

272 ià(
p
 =ğ
NULL
 || 
rg‘
 =ğNULL || 
£¬ch
 == NULL) {

273 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
EINVAL
));

274 
”ºo
 = 
EINVAL
;

277 ià(
rg‘
->
u£r
 !ğ
NULL
 && 
£¬ch
->user != NULL) {

278 cÚ¡ 
qpŞ_u£r_t
 *
u£r0
, *
u£r1
;

279 ià(
	`qpŞ_pŞicy_g‘_u£r_by_Çme
(
p
->p,

280 
rg‘
->
u£r
, &
u£r0
) < 0 ||

281 
	`qpŞ_pŞicy_g‘_u£r_by_Çme
(
p
->p,

282 
£¬ch
->
u£r
, &
u£r1
) < 0 ||

283 
	`qpŞ_u£r_g‘_v®ue
(
p
->p, 
u£r0
, &
v®ue0
è< 0 || qpŞ_u£r_g‘_v®ueÕ->p, 
u£r1
, &
v®ue1
) < 0) {

286 ià(
v®ue0
 !ğ
v®ue1
) {

290 ià(
rg‘
->
rŞe
 !ğ
NULL
 && 
£¬ch
->role != NULL) {

291 cÚ¡ 
qpŞ_rŞe_t
 *
rŞe0
, *
rŞe1
;

292 ià(
	`qpŞ_pŞicy_g‘_rŞe_by_Çme
(
p
->p,

293 
rg‘
->
rŞe
, &
rŞe0
) < 0 ||

294 
	`qpŞ_pŞicy_g‘_rŞe_by_Çme
(
p
->p,

295 
£¬ch
->
rŞe
, &
rŞe1
) < 0 ||

296 
	`qpŞ_rŞe_g‘_v®ue
(
p
->p, 
rŞe0
, &
v®ue0
è< 0 || qpŞ_rŞe_g‘_v®ueÕ->p, 
rŞe1
, &
v®ue1
) < 0) {

299 ià(
v®ue0
 !ğ
v®ue1
) {

303 ià(
rg‘
->
ty³
 !ğ
NULL
 && 
£¬ch
->type != NULL) {

304 cÚ¡ 
qpŞ_ty³_t
 *
ty³0
, *
ty³1
;

305 ià(
	`qpŞ_pŞicy_g‘_ty³_by_Çme
(
p
->p,

306 
rg‘
->
ty³
, &
ty³0
) < 0 ||

307 
	`qpŞ_pŞicy_g‘_ty³_by_Çme
(
p
->p,

308 
£¬ch
->
ty³
, &
ty³1
) < 0 ||

309 
	`qpŞ_ty³_g‘_v®ue
(
p
->p, 
ty³0
, &
v®ue0
è< 0 || qpŞ_ty³_g‘_v®ueÕ->p, 
ty³1
, &
v®ue1
) < 0) {

312 ià(
v®ue0
 !ğ
v®ue1
) {

316 ià(
rg‘
->
¿nge
 !ğ
NULL
 && 
£¬ch
->range != NULL) {

317  
	`­Ş_mls_¿nge_com·»
(
p
, 
rg‘
->
¿nge
, 
£¬ch
->¿nge, 
¿nge_com·»_ty³
);

320 
	}
}

322 
	$­Ş_cÚ‹xt_v®id©e
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
­Ş_cÚ‹xt_t
 * 
cÚ‹xt
)

324 ià(
cÚ‹xt
 =ğ
NULL
 ||

325 
cÚ‹xt
->
u£r
 =ğ
NULL
 ||

326 
cÚ‹xt
->
rŞe
 =ğ
NULL
 || cÚ‹xt->
ty³
 =ğNULL || (
	`­Ş_pŞicy_is_mls
(
p
è&& cÚ‹xt->
¿nge
 == NULL)) {

327 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
EINVAL
));

328 
”ºo
 = 
EINVAL
;

331  
	`­Ş_cÚ‹xt_v®id©e_·¹Ÿl
(
p
, 
cÚ‹xt
);

332 
	}
}

334 
	$­Ş_cÚ‹xt_v®id©e_·¹Ÿl
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
­Ş_cÚ‹xt_t
 * 
cÚ‹xt
)

336 
­Ş_u£r_qu”y_t
 *
u£r_qu”y
 = 
NULL
;

337 
­Ş_rŞe_qu”y_t
 *
rŞe_qu”y
 = 
NULL
;

338 
­Ş_veùÜ_t
 *
u£r_v
 = 
NULL
, *
rŞe_v
 = NULL;

339 cÚ¡ 
qpŞ_u£r_t
 *
u£r
;

340 cÚ¡ 
qpŞ_ty³_t
 *
ty³
;

341 cÚ¡ 
qpŞ_mls_¿nge_t
 *
u£r_¿nge
;

342 
­Ş_mls_¿nge_t
 *
u£r_­Ş_¿nge
 = 
NULL
;

343 
»tv®
 = -1, 
»tv®2
;

345 ià(
cÚ‹xt
 =ğ
NULL
) {

348 ià(
cÚ‹xt
->
u£r
 !ğ
NULL
) {

349 ià((
u£r_qu”y
 = 
	`­Ş_u£r_qu”y_ü—‹
()è=ğ
NULL
) {

350 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

352 ià(
	`­Ş_u£r_qu”y_£t_u£r
(
p
, 
u£r_qu”y
, 
cÚ‹xt
->
u£r
) < 0 ||

353 (
cÚ‹xt
->
rŞe
 !ğ
NULL
 && 
	`­Ş_u£r_qu”y_£t_rŞe
(
p
, 
u£r_qu”y
, context->role) < 0) ||

354 
	`­Ş_u£r_g‘_by_qu”y
(
p
, 
u£r_qu”y
, &
u£r_v
) < 0) {

355 
ş—nup
;

357 ià(
	`­Ş_veùÜ_g‘_size
(
u£r_v
) == 0) {

358 
»tv®
 = 0;

359 
ş—nup
;

362 ià(
cÚ‹xt
->
rŞe
 !ğ
NULL
) {

363 ià((
rŞe_qu”y
 = 
	`­Ş_rŞe_qu”y_ü—‹
()è=ğ
NULL
) {

364 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

366 ià(
	`­Ş_rŞe_qu”y_£t_rŞe
(
p
, 
rŞe_qu”y
, 
cÚ‹xt
->
rŞe
) < 0 ||

367 (
cÚ‹xt
->
ty³
 !ğ
NULL
 && 
	`­Ş_rŞe_qu”y_£t_ty³
(
p
, 
rŞe_qu”y
, context->type) < 0) ||

368 
	`­Ş_rŞe_g‘_by_qu”y
(
p
, 
rŞe_qu”y
, &
rŞe_v
) < 0) {

369 
ş—nup
;

371 ià(
	`­Ş_veùÜ_g‘_size
(
rŞe_v
) == 0) {

372 
»tv®
 = 0;

373 
ş—nup
;

376 ià(
cÚ‹xt
->
ty³
 !ğ
NULL
) {

377 ià(
	`qpŞ_pŞicy_g‘_ty³_by_Çme
(
p
->p, 
cÚ‹xt
->
ty³
, &type) < 0) {

378 
»tv®
 = 0;

379 
ş—nup
;

382 ià(
	`­Ş_pŞicy_is_mls
(
p
è&& 
cÚ‹xt
->
¿nge
 !ğ
NULL
) {

383 
»tv®2
 = 
	`­Ş_mls_¿nge_v®id©e
(
p
, 
cÚ‹xt
->
¿nge
);

384 ià(
»tv®2
 != 1) {

385 
»tv®
 = 
»tv®2
;

386 
ş—nup
;

389 ià(
cÚ‹xt
->
u£r
 !ğ
NULL
) {

390 ià(
	`qpŞ_pŞicy_g‘_u£r_by_Çme
(
p
->p, 
cÚ‹xt
->
u£r
, &user) < 0 ||

391 
	`qpŞ_u£r_g‘_¿nge
(
p
->p, 
u£r
, &
u£r_¿nge
) < 0) {

392 
ş—nup
;

394 
u£r_­Ş_¿nge
 = 
	`­Ş_mls_¿nge_ü—‹_äom_qpŞ_mls_¿nge
(
p
, 
u£r_¿nge
);

395 ià(
u£r_­Ş_¿nge
 =ğ
NULL
) {

396 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

397 
ş—nup
;

399 
»tv®2
 = 
	`­Ş_mls_¿nge_com·»
(
p
, 
u£r_­Ş_¿nge
, 
cÚ‹xt
->
¿nge
, 
APOL_QUERY_SUB
);

400 ià(
»tv®2
 != 1) {

401 
»tv®
 = 
»tv®2
;

402 
ş—nup
;

406 
»tv®
 = 1;

407 
ş—nup
:

408 
	`­Ş_u£r_qu”y_de¡roy
(&
u£r_qu”y
);

409 
	`­Ş_rŞe_qu”y_de¡roy
(&
rŞe_qu”y
);

410 
	`­Ş_veùÜ_de¡roy
(&
u£r_v
);

411 
	`­Ş_veùÜ_de¡roy
(&
rŞe_v
);

412 
	`­Ş_mls_¿nge_de¡roy
(&
u£r_­Ş_¿nge
);

413  
»tv®
;

414 
	}
}

416 *
	$­Ş_cÚ‹xt_»nd”
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
­Ş_cÚ‹xt_t
 * 
cÚ‹xt
)

418 *
buf
 = 
NULL
, *
¿nge_¡r
 = NULL;

419 
size_t
 
buf_sz
 = 0;

421 ià(
cÚ‹xt
 =ğ
NULL
) {

422 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
EINVAL
));

423 
”ºo
 = 
EINVAL
;

424  
NULL
;

426 ià(
p
 =ğ
NULL
 && !
	`­Ş_mls_¿nge_is_l™”®
(
cÚ‹xt
->
¿nge
)) {

427 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
EINVAL
));

428 
”ºo
 = 
EINVAL
;

429  
NULL
;

431 ià(
	`­Ş_¡r_­³ndf
(&
buf
, &
buf_sz
, "%s:", (
cÚ‹xt
->
u£r
 !ğ
NULL
 ? context->user : "*")) != 0) {

432 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

433 
”r_»tuº
;

435 ià(
	`­Ş_¡r_­³ndf
(&
buf
, &
buf_sz
, "%s:", (
cÚ‹xt
->
rŞe
 !ğ
NULL
 ? context->role : "*")) != 0) {

436 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

437 
”r_»tuº
;

439 ià(
	`­Ş_¡r_­³nd
(&
buf
, &
buf_sz
, (
cÚ‹xt
->
ty³
 !ğ
NULL
 ? context->type : "*")) != 0) {

440 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

441 
”r_»tuº
;

443 ià((
p
 !ğ
NULL
 && 
	`­Ş_pŞicy_is_mls
(p)) || (p == NULL)) {

444 ià(
cÚ‹xt
->
¿nge
 =ğ
NULL
) {

445 
¿nge_¡r
 = 
	`¡rdup
("*");

447 
¿nge_¡r
 = 
	`­Ş_mls_¿nge_»nd”
(
p
, 
cÚ‹xt
->
¿nge
);

449 ià(
¿nge_¡r
 =ğ
NULL
) {

450 
”r_»tuº
;

452 ià(
	`­Ş_¡r_­³ndf
(&
buf
, &
buf_sz
, ":%s", 
¿nge_¡r
) != 0) {

453 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

454 
”r_»tuº
;

456 
	`ä“
(
¿nge_¡r
);

458  
buf
;

460 
”r_»tuº
:

461 
	`ä“
(
buf
);

462 
	`ä“
(
¿nge_¡r
);

463  
NULL
;

464 
	}
}

466 
	$­Ş_cÚ‹xt_cÚv”t
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_cÚ‹xt_t
 * 
cÚ‹xt
)

468 ià(
p
 =ğ
NULL
 || 
cÚ‹xt
 == NULL) {

469 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
EINVAL
));

470 
”ºo
 = 
EINVAL
;

473 ià(
cÚ‹xt
->
¿nge
 !ğ
NULL
) {

474  
	`­Ş_mls_¿nge_cÚv”t
(
p
, 
cÚ‹xt
->
¿nge
);

477 
	}
}

	@libapol/src/default-object-query.c

30 
	~"pŞicy-qu”y-š‹º®.h
"

32 
	~<”ºo.h
>

34 
	s­Ş_deçuÉ_objeù_qu”y


36 *
	mÇme
;

39 
	$­Ş_deçuÉ_objeù_g‘_by_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_deçuÉ_objeù_qu”y_t
 * 
q
, 
­Ş_veùÜ_t
 ** 
v
)

41 
qpŞ_™”©Ü_t
 *
™”
;

42 
»tv®
 = -1;

44 *
v
 = 
NULL
;

45 ià(
	`qpŞ_pŞicy_g‘_deçuÉ_objeù_™”
(
p
->p, &
™”
) < 0) {

48 ià((*
v
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)) == NULL) {

49 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

50 
ş—nup
;

52 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

53 cÚ¡ 
qpŞ_deçuÉ_objeù_t
 *
deçuÉ_objeù
;

54 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
deçuÉ_objeù
) < 0) {

55 
ş—nup
;

57 ià(
q
 !ğ
NULL
) {

58 ià(
	`­Ş_veùÜ_­³nd
(*
v
, (*)
deçuÉ_objeù
)) {

59 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

60 
ş—nup
;

65 
»tv®
 = 0;

66 
ş—nup
:

67 ià(
»tv®
 != 0) {

68 
	`­Ş_veùÜ_de¡roy
(
v
);

70 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

71  
»tv®
;

72 
	}
}

74 
­Ş_deçuÉ_objeù_qu”y_t
 *
	$­Ş_deçuÉ_objeù_qu”y_ü—‹
()

76  
	`ÿÎoc
(1, (
­Ş_deçuÉ_objeù_qu”y_t
));

77 
	}
}

79 
	$­Ş_deçuÉ_objeù_qu”y_de¡roy
(
­Ş_deçuÉ_objeù_qu”y_t
 ** 
q
)

81 ià(*
q
 !ğ
NULL
) {

82 
	`ä“
((*
q
)->
Çme
);

83 
	`ä“
(*
q
);

84 *
q
 = 
NULL
;

86 
	}
}

	@libapol/src/domain-trans-analysis-internal.h

26 #iâdeà
APOL_DOMAIN_TRANS_ANALYSIS_INTERNAL_H


27 
	#APOL_DOMAIN_TRANS_ANALYSIS_INTERNAL_H


	)

34 
domaš_Œªs_»suÉ_ä“
(*
dŒ
);

	@libapol/src/domain-trans-analysis.c

26 
	~"pŞicy-qu”y-š‹º®.h
"

27 
	~"domaš-Œªs-ª®ysis-š‹º®.h
"

28 
	~<­Ş/domaš-Œªs-ª®ysis.h
>

29 
	~<­Ş/b¡.h
>

31 
	~<¡dio.h
>

32 
	~<¡dlib.h
>

33 
	~<”ºo.h
>

34 
	~<¡ršg.h
>

35 
	~<¡dboŞ.h
>

38 
	s­Ş_domaš_Œªs_bË


40 
­Ş_b¡_t
 *
	mdomaš_bË
;

41 
­Ş_b¡_t
 *
	m’Œypošt_bË
;

44 
	sdom_node


46 cÚ¡ 
qpŞ_ty³_t
 *
	mty³
;

47 
­Ş_b¡_t
 *
	m´oûss_Œªs™iÚ_Œ“
;

48 
­Ş_b¡_t
 *
	m’Œypošt_Œ“
;

49 
­Ş_veùÜ_t
 *
	m£‹xec_ruËs
;

50 } 
	tdom_node_t
;

52 
	s•_node


54 cÚ¡ 
qpŞ_ty³_t
 *
	mty³
;

55 
­Ş_b¡_t
 *
	mexecu‹_Œ“
;

56 
­Ş_b¡_t
 *
	mty³_Œªs™iÚ_Œ“
;

57 } 
	t•_node_t
;

59 
	savruË_node


61 cÚ¡ 
qpŞ_ty³_t
 *
	mty³
;

62 cÚ¡ 
qpŞ_avruË_t
 *
	mruË
;

63 
boŞ
 
	mu£d
;

64 } 
	tavruË_node_t
;

66 
	s‹ruË_node


68 cÚ¡ 
qpŞ_ty³_t
 *
	m¤c
;

69 cÚ¡ 
qpŞ_ty³_t
 *
	mdæt
;

70 cÚ¡ 
qpŞ_‹ruË_t
 *
	mruË
;

71 
boŞ
 
	mu£d
;

72 } 
	t‹ruË_node_t
;

75 
	s­Ş_domaš_Œªs_ª®ysis


77 
	mdœeùiÚ
;

78 
	mv®id
;

79 *
	m¡¬t_ty³
;

80 *
	m»suÉ
;

81 
­Ş_veùÜ_t
 *
	macûss_ty³s
;

82 
­Ş_veùÜ_t
 *
	macûss_şas£s
;

83 
­Ş_veùÜ_t
 *
	macûss_³rms
;

84 
»gex_t
 *
	m»suÉ_»gex
;

87 
	s­Ş_domaš_Œªs_»suÉ


89 cÚ¡ 
qpŞ_ty³_t
 *
	m¡¬t_ty³
;

90 cÚ¡ 
qpŞ_ty³_t
 *
	m•_ty³
;

91 cÚ¡ 
qpŞ_ty³_t
 *
	m’d_ty³
;

92 
­Ş_veùÜ_t
 *
	m´oc_Œªs_ruËs
;

93 
­Ş_veùÜ_t
 *
	m•_ruËs
;

94 
­Ş_veùÜ_t
 *
	mexec_ruËs
;

95 
­Ş_veùÜ_t
 *
	m£‹xec_ruËs
;

96 
­Ş_veùÜ_t
 *
	mty³_Œªs_ruËs
;

97 
boŞ
 
	mv®id
;

100 
­Ş_veùÜ_t
 *
	macûss_ruËs
;

105 
avruË_node_cmp
(cÚ¡ *
a
, cÚ¡ *
b
, *
d©a
 
__©Œibu‹__
 ((
unu£d
)))

107 cÚ¡ 
avruË_node_t
 *
	gª
 = 
a
;

108 cÚ¡ 
avruË_node_t
 *
	gbn
 = 
b
;

109 
ssize_t
 
	g»tv
 = (cÚ¡ *)
ª
->
ty³
 - (cÚ¡ *)
bn
->type;

110 ià(
	g»tv
 > 0)

112 ià(
	g»tv
 < 0)

114 
	g»tv
 = (cÚ¡ *)
ª
->
ruË
 - (cÚ¡ *)
bn
->rule;

115 ià(
	g»tv
 > 0)

117 ià(
	g»tv
 < 0)

122 
avruË_node_»£t
(*
a
, *
b
 
__©Œibu‹__
 ((
unu£d
)))

124 
avruË_node_t
 *
	gª
 = 
a
;

125 ià(!
	ga
)

127 
	gª
->
	gu£d
 = 
çl£
;

131 
avruË_node_t
 *
	$avruË_node_ü—‹
(cÚ¡ 
qpŞ_ty³_t
 * 
ty³
, cÚ¡ 
qpŞ_avruË_t
 * 
ruË
)

133 
avruË_node_t
 *
n
 = 
	`ÿÎoc
(1, (*n));

134 ià(!
n
)

135  
NULL
;

137 
n
->
ty³
 =ype;

138 
n
->
ruË
 =„ule;

140  
n
;

141 
	}
}

144 
‹ruË_node_cmp
(cÚ¡ *
a
, cÚ¡ *
b
, *
d©a
 
__©Œibu‹__
 ((
unu£d
)))

146 cÚ¡ 
‹ruË_node_t
 *
	gª
 = 
a
;

147 cÚ¡ 
‹ruË_node_t
 *
	gbn
 = 
b
;

148 
ssize_t
 
	g»tv
 = (cÚ¡ *)
ª
->
¤c
 - (cÚ¡ *)
bn
->src;

149 ià(
	g»tv
 > 0)

151 ià(
	g»tv
 < 0)

153 
	g»tv
 = (cÚ¡ *)
ª
->
dæt
 - (cÚ¡ *)
bn
->dflt;

154 ià(
	g»tv
 > 0)

156 ià(
	g»tv
 < 0)

158 
	g»tv
 = (cÚ¡ *)
ª
->
ruË
 - (cÚ¡ *)
bn
->rule;

159 ià(
	g»tv
 > 0)

161 ià(
	g»tv
 < 0)

166 
‹ruË_node_»£t
(*
a
, *
b
 
__©Œibu‹__
 ((
unu£d
)))

168 
‹ruË_node_t
 *
	gª
 = 
a
;

169 ià(!
	ga
)

171 
	gª
->
	gu£d
 = 
çl£
;

175 
‹ruË_node_t
 *
	$‹ruË_node_ü—‹
(cÚ¡ 
qpŞ_ty³_t
 * 
¤c
, cÚ¡ qpŞ_ty³_ˆ* 
dæt
, cÚ¡ 
qpŞ_‹ruË_t
 * 
ruË
)

177 
‹ruË_node_t
 *
n
 = 
	`ÿÎoc
(1, (*n));

178 ià(!
n
)

179  
NULL
;

181 
n
->
¤c
 = src;

182 
n
->
dæt
 = dflt;

183 
n
->
ruË
 =„ule;

185  
n
;

186 
	}
}

189 
dom_node_cmp
(cÚ¡ *
a
, cÚ¡ *
b
, *
d©a
 
__©Œibu‹__
 ((
unu£d
)))

191 cÚ¡ 
dom_node_t
 *
	gª
 = 
a
;

192 cÚ¡ 
dom_node_t
 *
	gbn
 = 
b
;

194 ià((cÚ¡ *)(
	gª
->
	gty³
è< (cÚ¡ *)(
	gbn
->type))

196 ià((cÚ¡ *)(
	gª
->
	gty³
è> (cÚ¡ *)(
	gbn
->type))

201 
	$dom_node_ä“
(*
x
)

203 ià(!
x
)

205 
	`­Ş_b¡_de¡roy
(&(((
dom_node_t
 *è
x
)->
´oûss_Œªs™iÚ_Œ“
));

206 
	`­Ş_b¡_de¡roy
(&(((
dom_node_t
 *è
x
)->
’Œypošt_Œ“
));

207 
	`­Ş_veùÜ_de¡roy
(&(((
dom_node_t
 *è
x
)->
£‹xec_ruËs
));

208 
	`ä“
(
x
);

209 
	}
}

211 
dom_node_»£t
(*
a
, *
b
 
__©Œibu‹__
 ((
unu£d
)))

213 
dom_node_t
 *
	gª
 = 
a
;

214 ià(!
	ga
)

217 ià(
­Ş_b¡_šÜd”_m­
(
ª
->
´oûss_Œªs™iÚ_Œ“
, 
avruË_node_»£t
, 
NULL
) < 0)

219 ià(
­Ş_b¡_šÜd”_m­
(
ª
->
’Œypošt_Œ“
, 
avruË_node_»£t
, 
NULL
) < 0)

225 
dom_node_t
 *
	$dom_node_ü—‹
(cÚ¡ 
qpŞ_ty³_t
 * 
ty³
)

227 
dom_node_t
 *
n
 = 
	`ÿÎoc
(1, (*n));

228 ià(!
n
)

229  
NULL
;

231 
n
->
ty³
 =ype;

232 ià(!(
n
->
´oûss_Œªs™iÚ_Œ“
 = 
	`­Ş_b¡_ü—‹
(
avruË_node_cmp
, 
ä“
)) ||

233 !(
n
->
’Œypošt_Œ“
 = 
	`­Ş_b¡_ü—‹
(
avruË_node_cmp
, 
ä“
)è|| !Ò->
£‹xec_ruËs
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
))) {

234 
	`­Ş_b¡_de¡roy
(&
n
->
´oûss_Œªs™iÚ_Œ“
);

235 
	`­Ş_b¡_de¡roy
(&
n
->
’Œypošt_Œ“
);

236 
	`­Ş_veùÜ_de¡roy
(&
n
->
£‹xec_ruËs
);

237 
	`ä“
(
n
);

238  
NULL
;

241  
n
;

242 
	}
}

245 
•_node_cmp
(cÚ¡ *
a
, cÚ¡ *
b
, *
d©a
 
__©Œibu‹__
 ((
unu£d
)))

247 cÚ¡ 
•_node_t
 *
	gª
 = 
a
;

248 cÚ¡ 
•_node_t
 *
	gbn
 = 
b
;

250 ià((cÚ¡ *)(
	gª
->
	gty³
è< (cÚ¡ *)(
	gbn
->type))

252 ià((cÚ¡ *)(
	gª
->
	gty³
è> (cÚ¡ *)(
	gbn
->type))

257 
	$•_node_ä“
(*
x
)

259 ià(!
x
)

261 
	`­Ş_b¡_de¡roy
(&(((
•_node_t
 *è
x
)->
ty³_Œªs™iÚ_Œ“
));

262 
	`­Ş_b¡_de¡roy
(&(((
•_node_t
 *è
x
)->
execu‹_Œ“
));

263 
	`ä“
(
x
);

264 
	}
}

266 
•_node_»£t
(*
a
, *
b
 
__©Œibu‹__
 ((
unu£d
)))

268 
•_node_t
 *
	gª
 = 
a
;

269 ià(!
	ga
)

272 ià(
­Ş_b¡_šÜd”_m­
(
ª
->
execu‹_Œ“
, 
avruË_node_»£t
, 
NULL
) < 0)

274 ià(
­Ş_b¡_šÜd”_m­
(
ª
->
ty³_Œªs™iÚ_Œ“
, 
‹ruË_node_»£t
, 
NULL
) < 0)

279 
•_node_t
 *
	$•_node_ü—‹
(cÚ¡ 
qpŞ_ty³_t
 * 
ty³
)

281 
•_node_t
 *
n
 = 
	`ÿÎoc
(1, (*n));

282 ià(!
n
)

283  
NULL
;

285 
n
->
ty³
 =ype;

286 ià(!(
n
->
execu‹_Œ“
 = 
	`­Ş_b¡_ü—‹
(
avruË_node_cmp
, 
ä“
)) ||

287 !(
n
->
ty³_Œªs™iÚ_Œ“
 = 
	`­Ş_b¡_ü—‹
(
‹ruË_node_cmp
, 
ä“
))) {

288 
	`­Ş_b¡_de¡roy
(&
n
->
execu‹_Œ“
);

289 
	`­Ş_b¡_de¡roy
(&
n
->
ty³_Œªs™iÚ_Œ“
);

290 
	`ä“
(
n
);

291  
NULL
;

294  
n
;

295 
	}
}

298 
­Ş_domaš_Œªs_bË_t
 *
	$­Ş_domaš_Œªs_bË_Ãw
(
­Ş_pŞicy_t
 * 
pŞicy
)

300 
­Ş_domaš_Œªs_bË_t
 *
Ãw_bË
 = 
NULL
;

301 
”rÜ
;

303 ià(!
pŞicy
) {

304 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

305 
”ºo
 = 
EINVAL
;

306  
NULL
;

309 
Ãw_bË
 = (
­Ş_domaš_Œªs_bË_t
 *è
	`ÿÎoc
(1, (apol_domain_trans_table_t));

310 ià(!
Ãw_bË
) {

311 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

312 
”rÜ
 = 
ENOMEM
;

313 
ş—nup
;

316 ià(!(
Ãw_bË
->
domaš_bË
 = 
	`­Ş_b¡_ü—‹
(
dom_node_cmp
, 
dom_node_ä“
))) {

317 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

318 
”rÜ
 = 
ENOMEM
;

319 
ş—nup
;

321 ià(!(
Ãw_bË
->
’Œypošt_bË
 = 
	`­Ş_b¡_ü—‹
(
•_node_cmp
, 
•_node_ä“
))) {

322 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

323 
”rÜ
 = 
ENOMEM
;

324 
ş—nup
;

327  
Ãw_bË
;

328 
ş—nup
:

329 
	`domaš_Œªs_bË_de¡roy
(&
Ãw_bË
);

330 
”ºo
 = 
”rÜ
;

331  
NULL
;

332 
	}
}

334 
	$bË_add_avruË
(
­Ş_pŞicy_t
 * 
pŞicy
, 
­Ş_domaš_Œªs_bË_t
 * 
d_bË
, cÚ¡ 
qpŞ_avruË_t
 * 
ruË
)

336 
qpŞ_pŞicy_t
 *
qp
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicy
);

337 cÚ¡ 
qpŞ_ty³_t
 *
¤c
;

338 cÚ¡ 
qpŞ_ty³_t
 *
tgt
;

339 
	`qpŞ_avruË_g‘_sourû_ty³
(
qp
, 
ruË
, &
¤c
);

340 
	`qpŞ_avruË_g‘_rg‘_ty³
(
qp
, 
ruË
, &
tgt
);

341 
­Ş_veùÜ_t
 *
sourûs
 = 
	`­Ş_qu”y_ex·nd_ty³
(
pŞicy
, 
¤c
);

342 
­Ş_veùÜ_t
 *
rg‘s
 = 
	`­Ş_qu”y_ex·nd_ty³
(
pŞicy
, 
tgt
);

343 
boŞ
 
exec
 = 
çl£
, 
•
 = f®£, 
´oc_Œªs
 = f®£, 
£‹xec
 = false;

344 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

345 
”rÜ
 = 0;

346 
	`qpŞ_avruË_g‘_³rm_™”
(
qp
, 
ruË
, &
™”
);

347 ià(!
™”
 || !
sourûs
 || !
rg‘s
) {

348 
”rÜ
 = 
”ºo
;

349 
”r
;

352 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

353 *
x
;

354 
	`qpŞ_™”©Ü_g‘_™em
(
™”
, &
x
);

355 *
³rm
 = 
x
;

356 ià(!
	`¡rcmp
("execu‹", 
³rm
))

357 
exec
 = 
Œue
;

358 ià(!
	`¡rcmp
("’Œypošt", 
³rm
))

359 
•
 = 
Œue
;

360 ià(!
	`¡rcmp
("Œªs™iÚ", 
³rm
))

361 
´oc_Œªs
 = 
Œue
;

362 ià(!
	`¡rcmp
("£‹xec", 
³rm
))

363 
£‹xec
 = 
Œue
;

364 
	`ä“
(
x
);

366 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

368 ià(
´oc_Œªs
 || 
•
 || 
£‹xec
) {

369 
size_t
 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
sourûs
); i++) {

370 
dom_node_t
 *
dnode
 = 
NULL
;

371 
dom_node_t
 
dummy
 = { 
	`­Ş_veùÜ_g‘_–em’t
(
sourûs
, 
i
), 
NULL
, NULL, NULL };

372 ià(
	`­Ş_b¡_g‘_–em’t
(
d_bË
->
domaš_bË
, &
dummy
, 
NULL
, (**)&
dnode
)) {

373 
dom_node_t
 *
Ãw_dnode
 = 
NULL
;

374 ià(!(
Ãw_dnode
 = 
	`dom_node_ü—‹
(
dummy
.
ty³
)) ||

375 
	`­Ş_b¡_š£¹
(
d_bË
->
domaš_bË
, (*)
Ãw_dnode
, 
NULL
)) {

376 
”rÜ
 = 
”ºo
;

377 
	`dom_node_ä“
(
Ãw_dnode
);

378 
”r
;

380 
dnode
 = 
Ãw_dnode
;

382 ià(
£‹xec
) {

383 ià(
	`­Ş_veùÜ_­³nd_unique
(
dnode
->
£‹xec_ruËs
, (*)
ruË
, 
NULL
, NULL)) {

384 
”rÜ
 = 
”ºo
;

385 
”r
;

388 
size_t
 
j
 = 0; j < 
	`­Ş_veùÜ_g‘_size
(
rg‘s
); j++) {

389 ià(
´oc_Œªs
) {

390 
avruË_node_t
 *
Ãw_node
 =

391 
	`avruË_node_ü—‹
((cÚ¡ 
qpŞ_ty³_t
 *)
	`­Ş_veùÜ_g‘_–em’t
(
rg‘s
, 
j
), 
ruË
);

392 ià(!
Ãw_node
 ||

393 
	`­Ş_b¡_š£¹_ªd_g‘
(
dnode
->
´oûss_Œªs™iÚ_Œ“
, (**)&
Ãw_node
, 
NULL
) < 0) {

394 
”rÜ
 = 
”ºo
;

395 
	`ä“
(
Ãw_node
);

396 
”r
;

399 ià(
•
) {

400 
avruË_node_t
 *
Ãw_node
 =

401 
	`avruË_node_ü—‹
((cÚ¡ 
qpŞ_ty³_t
 *)
	`­Ş_veùÜ_g‘_–em’t
(
rg‘s
, 
j
), 
ruË
);

402 ià(!
Ãw_node
 ||

403 
	`­Ş_b¡_š£¹_ªd_g‘
(
dnode
->
’Œypošt_Œ“
, (**)&
Ãw_node
, 
NULL
) < 0) {

404 
”rÜ
 = 
”ºo
;

405 
	`ä“
(
Ãw_node
);

406 
”r
;

412 ià(
exec
) {

413 
size_t
 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
rg‘s
); i++) {

414 
•_node_t
 *
’ode
 = 
NULL
;

415 
•_node_t
 
dummy
 = { 
	`­Ş_veùÜ_g‘_–em’t
(
rg‘s
, 
i
), 
NULL
, NULL };

416 ià(
	`­Ş_b¡_g‘_–em’t
(
d_bË
->
’Œypošt_bË
, &
dummy
, 
NULL
, (**)&
’ode
)) {

417 
•_node_t
 *
Ãw_’ode
 = 
NULL
;

418 ià(!(
Ãw_’ode
 = 
	`•_node_ü—‹
(
dummy
.
ty³
)) ||

419 
	`­Ş_b¡_š£¹
(
d_bË
->
’Œypošt_bË
, (*)
Ãw_’ode
, 
NULL
)) {

420 
”rÜ
 = 
”ºo
;

421 
	`•_node_ä“
(
Ãw_’ode
);

422 
”r
;

424 
’ode
 = 
Ãw_’ode
;

426 
size_t
 
j
 = 0; j < 
	`­Ş_veùÜ_g‘_size
(
sourûs
); j++) {

427 
avruË_node_t
 *
Ãw_node
 =

428 
	`avruË_node_ü—‹
((cÚ¡ 
qpŞ_ty³_t
 *)
	`­Ş_veùÜ_g‘_–em’t
(
sourûs
, 
j
), 
ruË
);

429 ià(!
Ãw_node
 || 
	`­Ş_b¡_š£¹_ªd_g‘
(
’ode
->
execu‹_Œ“
, (**)&Ãw_node, 
NULL
) < 0) {

430 
”rÜ
 = 
”ºo
;

431 
	`ä“
(
Ãw_node
);

432 
”r
;

438 
	`­Ş_veùÜ_de¡roy
(&
sourûs
);

439 
	`­Ş_veùÜ_de¡roy
(&
rg‘s
);

442 
”r
:

443 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

444 
	`­Ş_veùÜ_de¡roy
(&
sourûs
);

445 
	`­Ş_veùÜ_de¡roy
(&
rg‘s
);

446 
”ºo
 = 
”rÜ
;

448 
	}
}

450 
	$bË_add_‹ruË
(
­Ş_pŞicy_t
 * 
pŞicy
, 
­Ş_domaš_Œªs_bË_t
 * 
d_bË
, cÚ¡ 
qpŞ_‹ruË_t
 * 
ruË
)

452 
qpŞ_pŞicy_t
 *
qp
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicy
);

453 cÚ¡ 
qpŞ_ty³_t
 *
¤c
;

454 cÚ¡ 
qpŞ_ty³_t
 *
tgt
;

455 cÚ¡ 
qpŞ_ty³_t
 *
dæt
;

456 
	`qpŞ_‹ruË_g‘_sourû_ty³
(
qp
, 
ruË
, &
¤c
);

457 
	`qpŞ_‹ruË_g‘_rg‘_ty³
(
qp
, 
ruË
, &
tgt
);

458 
	`qpŞ_‹ruË_g‘_deçuÉ_ty³
(
qp
, 
ruË
, &
dæt
);

459 
­Ş_veùÜ_t
 *
sourûs
 = 
	`­Ş_qu”y_ex·nd_ty³
(
pŞicy
, 
¤c
);

460 
­Ş_veùÜ_t
 *
rg‘s
 = 
	`­Ş_qu”y_ex·nd_ty³
(
pŞicy
, 
tgt
);

461 
”rÜ
 = 0;

462 
size_t
 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
rg‘s
); i++) {

463 
•_node_t
 *
’ode
 = 
NULL
;

464 
•_node_t
 
dummy
 = { 
	`­Ş_veùÜ_g‘_–em’t
(
rg‘s
, 
i
), 
NULL
, NULL };

465 ià(
	`­Ş_b¡_g‘_–em’t
(
d_bË
->
’Œypošt_bË
, &
dummy
, 
NULL
, (**)&
’ode
)) {

466 
•_node_t
 *
Ãw_’ode
 = 
NULL
;

467 ià(!(
Ãw_’ode
 = 
	`•_node_ü—‹
(
dummy
.
ty³
)) ||

468 
	`­Ş_b¡_š£¹
(
d_bË
->
’Œypošt_bË
, (*)
Ãw_’ode
, 
NULL
)) {

469 
”rÜ
 = 
”ºo
;

470 
	`•_node_ä“
(
Ãw_’ode
);

471 
”r
;

473 
’ode
 = 
Ãw_’ode
;

475 
size_t
 
j
 = 0; j < 
	`­Ş_veùÜ_g‘_size
(
sourûs
); j++) {

476 
‹ruË_node_t
 *
Ãw_node
 =

477 
	`‹ruË_node_ü—‹
((cÚ¡ 
qpŞ_ty³_t
 *)
	`­Ş_veùÜ_g‘_–em’t
(
sourûs
, 
j
), 
dæt
, 
ruË
);

478 ià(
	`­Ş_b¡_š£¹_ªd_g‘
(
’ode
->
ty³_Œªs™iÚ_Œ“
, (**)&
Ãw_node
, 
NULL
) < 0) {

479 
”rÜ
 = 
”ºo
;

480 
	`ä“
(
Ãw_node
);

481 
”r
;

486 
	`­Ş_veùÜ_de¡roy
(&
sourûs
);

487 
	`­Ş_veùÜ_de¡roy
(&
rg‘s
);

489 
”r
:

490 
	`­Ş_veùÜ_de¡roy
(&
sourûs
);

491 
	`­Ş_veùÜ_de¡roy
(&
rg‘s
);

492 
”ºo
 = 
”rÜ
;

494 
	}
}

497 
­Ş_domaš_Œªs_»suÉ_t
 *
	$domaš_Œªs_»suÉ_ü—‹
()

499 
­Ş_domaš_Œªs_»suÉ_t
 *
»s
 = 
	`ÿÎoc
(1, (*res));

500 ià(!
»s
)

501  
NULL
;

503 
”rÜ
 = 0;

504 ià(!(
»s
->
´oc_Œªs_ruËs
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)è|| !Ôes->
•_ruËs
 =‡pol_vector_create(NULL)) ||

505 !(
»s
->
exec_ruËs
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)è|| !Ôes->
£‹xec_ruËs
 =‡pol_vector_create(NULL)) ||

506 !(
»s
->
ty³_Œªs_ruËs
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
))) {

507 
”rÜ
 = 
”ºo
;

508 
”r
;

511  
»s
;

512 
”r
:

513 
	`­Ş_domaš_Œªs_»suÉ_de¡roy
(&
»s
);

514 
”ºo
 = 
”rÜ
;

515  
NULL
;

516 
	}
}

520 
	$­Ş_pŞicy_bud_domaš_Œªs_bË
(
­Ş_pŞicy_t
 * 
pŞicy
)

522 
”rÜ
 = 0;

523 
­Ş_avruË_qu”y_t
 *
avq
 = 
NULL
;

524 
­Ş_‹ruË_qu”y_t
 *
‹q
 = 
NULL
;

525 
­Ş_veùÜ_t
 *
avruËs
 = 
NULL
;

526 
­Ş_veùÜ_t
 *
‹ruËs
 = 
NULL
;

528 ià(!
pŞicy
) {

529 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

530 
”ºo
 = 
EINVAL
;

534 ià(
pŞicy
->
domaš_Œªs_bË
) {

538 
­Ş_domaš_Œªs_bË_t
 *
d_bË
 = 
pŞicy
->
domaš_Œªs_bË
 = 
	`­Ş_domaš_Œªs_bË_Ãw
(policy);

539 ià(!
pŞicy
->
domaš_Œªs_bË
) {

540 
”rÜ
 = 
”ºo
;

541 
”r
;

544 
avq
 = 
	`­Ş_avruË_qu”y_ü—‹
();

545 
	`­Ş_avruË_qu”y_£t_ruËs
(
pŞicy
, 
avq
, 
QPOL_RULE_ALLOW
);

546 
	`­Ş_avruË_qu”y_­³nd_şass
(
pŞicy
, 
avq
, "file");

547 
	`­Ş_avruË_qu”y_­³nd_şass
(
pŞicy
, 
avq
, "process");

548 
	`­Ş_avruË_qu”y_­³nd_³rm
(
pŞicy
, 
avq
, "execute");

549 
	`­Ş_avruË_qu”y_­³nd_³rm
(
pŞicy
, 
avq
, "entrypoint");

550 
	`­Ş_avruË_qu”y_­³nd_³rm
(
pŞicy
, 
avq
, "transition");

551 
	`­Ş_avruË_qu”y_­³nd_³rm
(
pŞicy
, 
avq
, "setexec");

552 ià(
	`­Ş_avruË_g‘_by_qu”y
(
pŞicy
, 
avq
, &
avruËs
)) {

553 
”rÜ
 = 
”ºo
;

554 
”r
;

556 
	`­Ş_avruË_qu”y_de¡roy
(&
avq
);

557 
size_t
 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
avruËs
); i++) {

558 ià(
	`bË_add_avruË
(
pŞicy
, 
d_bË
, (cÚ¡ 
qpŞ_avruË_t
 *)
	`­Ş_veùÜ_g‘_–em’t
(
avruËs
, 
i
))) {

559 
”rÜ
 = 
”ºo
;

560 
”r
;

563 
	`­Ş_veùÜ_de¡roy
(&
avruËs
);

565 
‹q
 = 
	`­Ş_‹ruË_qu”y_ü—‹
();

566 
	`­Ş_‹ruË_qu”y_£t_ruËs
(
pŞicy
, 
‹q
, 
QPOL_RULE_TYPE_TRANS
);

567 
	`­Ş_‹ruË_qu”y_­³nd_şass
(
pŞicy
, 
‹q
, "process");

568 ià(
	`­Ş_‹ruË_g‘_by_qu”y
(
pŞicy
, 
‹q
, &
‹ruËs
)) {

569 
”rÜ
 = 
”ºo
;

570 
”r
;

572 
	`­Ş_‹ruË_qu”y_de¡roy
(&
‹q
);

573 
size_t
 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
‹ruËs
); i++) {

574 ià(
	`bË_add_‹ruË
(
pŞicy
, 
d_bË
, (cÚ¡ 
qpŞ_‹ruË_t
 *)
	`­Ş_veùÜ_g‘_–em’t
(
‹ruËs
, 
i
))) {

575 
”rÜ
 = 
”ºo
;

576 
”r
;

579 
	`­Ş_veùÜ_de¡roy
(&
‹ruËs
);

583 
”r
:

584 
	`­Ş_avruË_qu”y_de¡roy
(&
avq
);

585 
	`­Ş_veùÜ_de¡roy
(&
avruËs
);

586 
	`­Ş_‹ruË_qu”y_de¡roy
(&
‹q
);

587 
	`­Ş_veùÜ_de¡roy
(&
‹ruËs
);

588 
	`domaš_Œªs_bË_de¡roy
(&
d_bË
);

589 
pŞicy
->
domaš_Œªs_bË
 = 
NULL
;

590 
”ºo
 = 
”rÜ
;

592 
	}
}

594 
	$­Ş_pŞicy_domaš_Œªs_bË_bud
(
­Ş_pŞicy_t
 * 
pŞicy
)

596  
	`­Ş_pŞicy_bud_domaš_Œªs_bË
(
pŞicy
);

597 
	}
}

599 
	$domaš_Œªs_bË_de¡roy
(
­Ş_domaš_Œªs_bË_t
 ** 
bË
)

601 ià(!
bË
 || !(*table))

604 
	`­Ş_b¡_de¡roy
(&(*
bË
)->
domaš_bË
);

605 
	`­Ş_b¡_de¡roy
(&(*
bË
)->
’Œypošt_bË
);

606 
	`ä“
(*
bË
);

607 *
bË
 = 
NULL
;

608 
	}
}

610 
	$­Ş_pŞicy_»£t_domaš_Œªs_bË
(
­Ş_pŞicy_t
 * 
pŞicy
)

612 ià(!
pŞicy
 || !pŞicy->
domaš_Œªs_bË
)

614 
	`­Ş_b¡_šÜd”_m­
(
pŞicy
->
domaš_Œªs_bË
->
domaš_bË
, 
dom_node_»£t
, 
NULL
);

615 
	`­Ş_b¡_šÜd”_m­
(
pŞicy
->
domaš_Œªs_bË
->
’Œypošt_bË
, 
•_node_»£t
, 
NULL
);

617 
	}
}

619 
	$­Ş_domaš_Œªs_bË_»£t
(
­Ş_pŞicy_t
 * 
pŞicy
)

621 
	`­Ş_pŞicy_»£t_domaš_Œªs_bË
(
pŞicy
);

622 
	}
}

625 
­Ş_domaš_Œªs_ª®ysis_t
 *
	$­Ş_domaš_Œªs_ª®ysis_ü—‹
()

627 
­Ş_domaš_Œªs_ª®ysis_t
 *
Ãw_d
 = 
NULL
;

628 
”rÜ
 = 0;

630 ià(!(
Ãw_d
 = 
	`ÿÎoc
(1, (
­Ş_domaš_Œªs_ª®ysis_t
)))) {

631 
”rÜ
 = 
”ºo
;

632 
”r
;

635 
Ãw_d
->
v®id
 = 
APOL_DOMAIN_TRANS_SEARCH_VALID
;

637  
Ãw_d
;

639 
”r
:

640 
	`­Ş_domaš_Œªs_ª®ysis_de¡roy
(&
Ãw_d
);

641 
”ºo
 = 
”rÜ
;

642  
NULL
;

643 
	}
}

645 
	$­Ş_domaš_Œªs_ª®ysis_de¡roy
(
­Ş_domaš_Œªs_ª®ysis_t
 ** 
d
)

647 ià(!
d
 || !(*dta))

650 
	`ä“
((*
d
)->
¡¬t_ty³
);

651 
	`ä“
((*
d
)->
»suÉ
);

652 
	`­Ş_veùÜ_de¡roy
(&((*
d
)->
acûss_ty³s
));

653 
	`­Ş_veùÜ_de¡roy
(&((*
d
)->
acûss_şas£s
));

654 
	`­Ş_veùÜ_de¡roy
(&((*
d
)->
acûss_³rms
));

655 
	`­Ş_»gex_de¡roy
(&((*
d
)->
»suÉ_»gex
));

656 
	`ä“
(*
d
);

657 *
d
 = 
NULL
;

658 
	}
}

660 
	$­Ş_domaš_Œªs_ª®ysis_£t_dœeùiÚ
(cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
, 
­Ş_domaš_Œªs_ª®ysis_t
 * 
d
,

661 
dœeùiÚ
)

663 ià(!
d
 || (
dœeùiÚ
 !ğ
APOL_DOMAIN_TRANS_DIRECTION_FORWARD
 && dœeùiÚ !ğ
APOL_DOMAIN_TRANS_DIRECTION_REVERSE
)) {

664 
	`ERR
(
pŞicy
, "E¼Ü s‘tšg‡Çlysi dœeùiÚ: %s", 
	`¡»¼Ü
(
EINVAL
));

665 
”ºo
 = 
EINVAL
;

669 
d
->
dœeùiÚ
 = direction;

672 
	}
}

674 
	$­Ş_domaš_Œªs_ª®ysis_£t_v®id
(cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
, 
­Ş_domaš_Œªs_ª®ysis_t
 * 
d
, 
v®id
)

676 ià(!
d
 || 
v®id
 & ~(
APOL_DOMAIN_TRANS_SEARCH_BOTH
)) {

677 
	`ERR
(
pŞicy
, "E¼Ü s‘tšg‡Çlysi v®id™y fÏg: %s", 
	`¡»¼Ü
(
EINVAL
));

678 
”ºo
 = 
EINVAL
;

682 
d
->
v®id
 = valid;

685 
	}
}

687 
	$­Ş_domaš_Œªs_ª®ysis_£t_¡¬t_ty³
(cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
, 
­Ş_domaš_Œªs_ª®ysis_t
 * 
d
,

688 cÚ¡ *
ty³_Çme
)

690 *
tmp
 = 
NULL
;

691 
”rÜ
 = 0;

693 ià(!
d
 || !
ty³_Çme
) {

694 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

695 
”ºo
 = 
EINVAL
;

699 ià(!(
tmp
 = 
	`¡rdup
(
ty³_Çme
))) {

700 
”rÜ
 = 
”ºo
;

701 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

702 
”ºo
 = 
”rÜ
;

706 
	`ä“
(
d
->
¡¬t_ty³
);

707 
d
->
¡¬t_ty³
 = 
tmp
;

710 
	}
}

712 
	$­Ş_domaš_Œªs_ª®ysis_£t_»suÉ_»gex
(cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
, 
­Ş_domaš_Œªs_ª®ysis_t
 * 
d
, cÚ¡ *
»gex
)

714 ià(!
d
) {

715 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

716 
”ºo
 = 
EINVAL
;

720 ià(!
»gex
) {

721 
	`­Ş_»gex_de¡roy
(&
d
->
»suÉ_»gex
);

725  
	`­Ş_qu”y_£t
(
pŞicy
, &
d
->
»suÉ
, &d->
»suÉ_»gex
, 
»gex
);

726 
	}
}

728 
	$­Ş_domaš_Œªs_ª®ysis_­³nd_acûss_ty³
(cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
, 
­Ş_domaš_Œªs_ª®ysis_t
 * 
d
,

729 cÚ¡ *
ty³_Çme
)

731 *
tmp
 = 
NULL
;

732 
”rÜ
 = 0;

734 ià(!
d
) {

735 
	`ERR
(
pŞicy
, "E¼Ü‡µ’dšgy³Øª®ysis: %s", 
	`¡»¼Ü
(
EINVAL
));

736 
”ºo
 = 
EINVAL
;

740 ià(!
ty³_Çme
) {

741 
	`­Ş_veùÜ_de¡roy
(&
d
->
acûss_ty³s
);

745 ià(!
d
->
acûss_ty³s
) {

746 ià(!(
d
->
acûss_ty³s
 = 
	`­Ş_veùÜ_ü—‹
(
ä“
))) {

747 
”rÜ
 = 
”ºo
;

748 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

749 
”ºo
 = 
”rÜ
;

754 ià(!(
tmp
 = 
	`¡rdup
(
ty³_Çme
))) {

755 
”rÜ
 = 
”ºo
;

756 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

757 
”ºo
 = 
”rÜ
;

761 ià(
	`­Ş_veùÜ_­³nd
(
d
->
acûss_ty³s
, 
tmp
)) {

762 
”rÜ
 = 
”ºo
;

763 
	`ä“
(
tmp
);

764 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

765 
”ºo
 = 
”rÜ
;

770 
	}
}

772 
	$­Ş_domaš_Œªs_ª®ysis_­³nd_şass_³rm
(cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
, 
­Ş_domaš_Œªs_ª®ysis_t
 * 
d
,

773 cÚ¡ *
şass_Çme
, cÚ¡ *
³rm_Çme
)

775 ià(
	`­Ş_domaš_Œªs_ª®ysis_­³nd_şass
(
pŞicy
, 
d
, 
şass_Çme
))

777  
	`­Ş_domaš_Œªs_ª®ysis_­³nd_³rm
(
pŞicy
, 
d
, 
³rm_Çme
);

778 
	}
}

780 
	$­Ş_domaš_Œªs_ª®ysis_­³nd_şass
(cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
, 
­Ş_domaš_Œªs_ª®ysis_t
 * 
d
,

781 cÚ¡ *
şass_Çme
)

783 *
tmp
 = 
NULL
;

784 
”rÜ
 = 0;

786 ià(!
d
) {

787 
	`ERR
(
pŞicy
, "E¼Ü‡µ’dšg cÏs tØª®ysis: %s", 
	`¡»¼Ü
(
EINVAL
));

788 
”ºo
 = 
EINVAL
;

792 ià(!
şass_Çme
) {

793 
	`­Ş_veùÜ_de¡roy
(&
d
->
acûss_şas£s
);

797 ià(!
d
->
acûss_şas£s
) {

798 ià(!(
d
->
acûss_şas£s
 = 
	`­Ş_veùÜ_ü—‹
(
ä“
))) {

799 
”rÜ
 = 
”ºo
;

800 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

801 
”ºo
 = 
”rÜ
;

806 ià(!(
tmp
 = 
	`¡rdup
(
şass_Çme
))) {

807 
”rÜ
 = 
”ºo
;

808 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

809 
”ºo
 = 
”rÜ
;

813 ià(
	`­Ş_veùÜ_­³nd
(
d
->
acûss_şas£s
, 
tmp
)) {

814 
”rÜ
 = 
”ºo
;

815 
	`ä“
(
tmp
);

816 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

817 
”ºo
 = 
”rÜ
;

822 
	}
}

824 
	$­Ş_domaš_Œªs_ª®ysis_­³nd_³rm
(cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
, 
­Ş_domaš_Œªs_ª®ysis_t
 * 
d
, cÚ¡ *
³rm_Çme
)

826 *
tmp
 = 
NULL
;

827 
”rÜ
 = 0;

829 ià(!
d
) {

830 
	`ERR
(
pŞicy
, "E¼Ü‡µ’dšg…”mØª®ysis: %s", 
	`¡»¼Ü
(
EINVAL
));

831 
”ºo
 = 
EINVAL
;

835 ià(!
³rm_Çme
) {

836 
	`­Ş_veùÜ_de¡roy
(&
d
->
acûss_³rms
);

840 ià(!
d
->
acûss_³rms
) {

841 ià(!(
d
->
acûss_³rms
 = 
	`­Ş_veùÜ_ü—‹
(
ä“
))) {

842 
”rÜ
 = 
”ºo
;

843 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

844 
”ºo
 = 
”rÜ
;

849 ià(!(
tmp
 = 
	`¡rdup
(
³rm_Çme
))) {

850 
”rÜ
 = 
”ºo
;

851 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

852 
”ºo
 = 
”rÜ
;

856 ià(
	`­Ş_veùÜ_­³nd
(
d
->
acûss_³rms
, 
tmp
)) {

857 
”rÜ
 = 
”ºo
;

858 
	`ä“
(
tmp
);

859 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

860 
”ºo
 = 
”rÜ
;

865 
	}
}

867 
boŞ
 
	$»quœes_£‹xec_Ü_ty³_Œªs
(
­Ş_pŞicy_t
 * 
pŞicy
)

869 cÚ¡ 
qpŞ_pŞicy_t
 *
qp
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicy
);

870 
pŞicy_v”siÚ
 = 0;

871 
	`qpŞ_pŞicy_g‘_pŞicy_v”siÚ
(
qp
, &
pŞicy_v”siÚ
);

872 
is_moduÏr
 = 
	`qpŞ_pŞicy_has_ÿ·b™y
(
pŞicy
->
p
, 
QPOL_CAP_MODULES
);

873  (
pŞicy_v”siÚ
 >ğ15 || 
is_moduÏr
);

874 
	}
}

876 
	sruË_m­_d©a


878 cÚ¡ 
qpŞ_ty³_t
 *
	m£¬ch
;

879 cÚ¡ 
qpŞ_ty³_t
 *
	mdæt
;

880 
­Ş_veùÜ_t
 *
	mnode_li¡
;

881 
boŞ
 
	mis_avnode
;

884 
	$node_li¡_m­_â
(*
node
, *
d©a
)

886 
ruË_m­_d©a
 *
rm
 = 
d©a
;

887 ià(
rm
->
is_avnode
) {

888 
avruË_node_t
 *
ªode
 = 
node
;

889 ià(
ªode
->
ty³
 =ğ
rm
->
£¬ch
 && !ªode->
u£d
)

890 ià(
	`­Ş_veùÜ_­³nd
(
rm
->
node_li¡
, 
node
))

894 
‹ruË_node_t
 *
Šode
 = 
node
;

895 ià((!
rm
->
£¬ch
 || (rm->£¬ch =ğ
Šode
->
¤c
)è&& (!rm->
dæt
 || (rm->dflt ==node->dflt)) &&

896 
rm
->
£¬ch
 !ğrm->
dæt
 && !
Šode
->
u£d
)

897 ià(
	`­Ş_veùÜ_­³nd
(
rm
->
node_li¡
, 
node
))

901 
	}
}

903 
­Ş_veùÜ_t
 *
	$fšd_avruËs_š_node
(*
node
, 
ruË_ty³
, cÚ¡ 
qpŞ_ty³_t
 * 
£¬ch
)

905 
”rÜ
 = 0;

906 
­Ş_veùÜ_t
 *
ruË_nodes
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
);

907 
ruË_m­_d©a
 
d©a
 = { 
£¬ch
, 
NULL
, 
ruË_nodes
, 
Œue
 };

908 
ruË_ty³
) {

909 
APOL_DOMAIN_TRANS_RULE_PROC_TRANS
:

911 
dom_node_t
 *
dnode
 = 
node
;

912 ià(
	`­Ş_b¡_šÜd”_m­
(
dnode
->
´oûss_Œªs™iÚ_Œ“
, 
node_li¡_m­_â
, (*)&
d©a
) < 0) {

913 
”rÜ
 = 
”ºo
;

914 
”r
;

918 
APOL_DOMAIN_TRANS_RULE_ENTRYPOINT
:

920 
dom_node_t
 *
dnode
 = 
node
;

921 ià(
	`­Ş_b¡_šÜd”_m­
(
dnode
->
’Œypošt_Œ“
, 
node_li¡_m­_â
, (*)&
d©a
) < 0) {

922 
”rÜ
 = 
”ºo
;

923 
”r
;

927 
APOL_DOMAIN_TRANS_RULE_EXEC
:

929 
•_node_t
 *
’ode
 = 
node
;

930 ià(
	`­Ş_b¡_šÜd”_m­
(
’ode
->
execu‹_Œ“
, 
node_li¡_m­_â
, (*)&
d©a
) < 0) {

931 
”rÜ
 = 
”ºo
;

932 
”r
;

938 
”rÜ
 = 
EINVAL
;

939 
”r
;

943  
ruË_nodes
;

945 
”r
:

946 
	`­Ş_veùÜ_de¡roy
(&
ruË_nodes
);

947 
”ºo
 = 
”rÜ
;

948  
NULL
;

949 
	}
}

951 
­Ş_veùÜ_t
 *
	$fšd_‹ruËs_š_node
(
•_node_t
 * 
node
, cÚ¡ 
qpŞ_ty³_t
 * 
£¬ch
, cÚ¡ qpŞ_ty³_ˆ* 
dæt
)

953 
”rÜ
 = 0;

954 
­Ş_veùÜ_t
 *
ruË_nodes
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
);

955 
ruË_m­_d©a
 
d©a
 = { 
£¬ch
, 
dæt
, 
ruË_nodes
, 
çl£
 };

956 ià(
	`­Ş_b¡_šÜd”_m­
(
node
->
ty³_Œªs™iÚ_Œ“
, 
node_li¡_m­_â
, (*)&
d©a
) < 0) {

957 
”rÜ
 = 
”ºo
;

958 
”r
;

961  
ruË_nodes
;

963 
”r
:

964 
	`­Ş_veùÜ_de¡roy
(&
ruË_nodes
);

965 
”ºo
 = 
”rÜ
;

966  
NULL
;

967 
	}
}

969 
­Ş_domaš_Œªs_»suÉ_t
 *
	$fšd_»suÉ
(
­Ş_veùÜ_t
 * 
loÿl_»suÉs
, cÚ¡ 
qpŞ_ty³_t
 * 
¤c
, cÚ¡ qpŞ_ty³_ˆ* 
tgt
,

970 cÚ¡ 
qpŞ_ty³_t
 * 
dæt
)

972 
size_t
 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
loÿl_»suÉs
); i++) {

973 
­Ş_domaš_Œªs_»suÉ_t
 *
»s
 = 
	`­Ş_veùÜ_g‘_–em’t
(
loÿl_»suÉs
, 
i
);

974 ià(
»s
->
¡¬t_ty³
 =ğ
¤c
 &&„es->
’d_ty³
 =ğ
dæt
 &&„es->
•_ty³
 =ğ
tgt
)

975  
»s
;

977  
NULL
;

978 
	}
}

980 
	$domaš_Œªs_bË_fšd_Üphª_ty³_Œªs™iÚs
(
­Ş_pŞicy_t
 * 
pŞicy
, 
­Ş_domaš_Œªs_ª®ysis_t
 * 
d
,

981 
­Ş_veùÜ_t
 * 
loÿl_»suÉs
)

983 
”rÜ
 = 0;

984 cÚ¡ 
qpŞ_ty³_t
 *
£¬ch
 = 
NULL
;

985 
	`qpŞ_pŞicy_g‘_ty³_by_Çme
(
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicy
), 
d
->
¡¬t_ty³
, &
£¬ch
);

986 
­Ş_domaš_Œªs_»suÉ_t
 *
tmp_»suÉ
 = 
NULL
;

988 
­Ş_veùÜ_t
 *
•nodes
 = 
	`­Ş_b¡_g‘_veùÜ
(
pŞicy
->
domaš_Œªs_bË
->
’Œypošt_bË
, 0);

989 ià(!
•nodes
)

991 
size_t
 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
•nodes
); i++) {

992 
•_node_t
 *
node
 = 
	`­Ş_veùÜ_g‘_–em’t
(
•nodes
, 
i
);

994 
­Ş_veùÜ_t
 *
‰nodes
 = 
NULL
;

995 ià(
d
->
dœeùiÚ
 =ğ
APOL_DOMAIN_TRANS_DIRECTION_FORWARD
)

996 
‰nodes
 = 
	`fšd_‹ruËs_š_node
(
node
, 
£¬ch
, 
NULL
);

998 
‰nodes
 = 
	`fšd_‹ruËs_š_node
(
node
, 
NULL
, 
£¬ch
);

999 
size_t
 
j
 = 0; j < 
	`­Ş_veùÜ_g‘_size
(
‰nodes
); j++) {

1000 
boŞ
 
add
 = 
çl£
;

1001 
‹ruË_node_t
 *
Š
 = 
	`­Ş_veùÜ_g‘_–em’t
(
‰nodes
, 
j
);

1002 
Š
->
u£d
 = 
Œue
;

1004 
tmp_»suÉ
 = 
	`fšd_»suÉ
(
loÿl_»suÉs
, 
Š
->
¤c
, 
node
->
ty³
,n->
dæt
);

1005 ià(!
tmp_»suÉ
) {

1006 
add
 = 
Œue
;

1007 
tmp_»suÉ
 = 
	`domaš_Œªs_»suÉ_ü—‹
();

1009 ià(!
tmp_»suÉ
) {

1010 
”rÜ
 = 
”ºo
;

1011 
	`­Ş_veùÜ_de¡roy
(&
‰nodes
);

1012 
”r
;

1014 
tmp_»suÉ
->
¡¬t_ty³
 = 
Š
->
¤c
;

1015 
tmp_»suÉ
->
’d_ty³
 = 
Š
->
dæt
;

1016 
tmp_»suÉ
->
•_ty³
 = 
node
->
ty³
;

1018 
­Ş_veùÜ_t
 *
exeüuËs
 =

1019 
	`fšd_avruËs_š_node
((*)
node
, 
APOL_DOMAIN_TRANS_RULE_EXEC
, 
tmp_»suÉ
->
¡¬t_ty³
);

1020 
size_t
 
k
 = 0; k < 
	`­Ş_veùÜ_g‘_size
(
exeüuËs
); k++) {

1021 
avruË_node_t
 *
n
 = 
	`­Ş_veùÜ_g‘_–em’t
(
exeüuËs
, 
k
);

1022 ià(
	`­Ş_veùÜ_­³nd
(
tmp_»suÉ
->
exec_ruËs
, (*)
n
->
ruË
)) {

1023 
”rÜ
 = 
”ºo
;

1024 
	`­Ş_veùÜ_de¡roy
(&
exeüuËs
);

1025 ià(!
add
)

1026 
tmp_»suÉ
 = 
NULL
;

1027 
”r
;

1030 
	`­Ş_veùÜ_de¡roy
(&
exeüuËs
);

1032 
dom_node_t
 
dummy
 = { 
tmp_»suÉ
->
¡¬t_ty³
, 
NULL
, NULL, NULL };

1033 
dom_node_t
 *
¡¬t_node
 = 
NULL
;

1034 
	`­Ş_b¡_g‘_–em’t
(
pŞicy
->
domaš_Œªs_bË
->
domaš_bË
, (*)&
dummy
, 
NULL
, (**)&
¡¬t_node
);

1035 ià(
¡¬t_node
) {

1037 ià(
add
 && 
	`­Ş_veùÜ_g‘_size
(
¡¬t_node
->
£‹xec_ruËs
)) {

1038 ià(
	`­Ş_veùÜ_ÿt
(
tmp_»suÉ
->
£‹xec_ruËs
, 
¡¬t_node
->setexec_rules)) {

1039 
”rÜ
 = 
”ºo
;

1040 
”r
;

1044 
­Ş_veùÜ_t
 *
´oc_Œªs_ruËs
 =

1045 
	`fšd_avruËs_š_node
((*)
¡¬t_node
, 
APOL_DOMAIN_TRANS_RULE_PROC_TRANS
,

1046 
tmp_»suÉ
->
’d_ty³
);

1047 
size_t
 
k
 = 0; k < 
	`­Ş_veùÜ_g‘_size
(
´oc_Œªs_ruËs
); k++) {

1048 
avruË_node_t
 *
avr
 = 
	`­Ş_veùÜ_g‘_–em’t
(
´oc_Œªs_ruËs
, 
k
);

1049 ià(
	`­Ş_veùÜ_­³nd
(
tmp_»suÉ
->
´oc_Œªs_ruËs
, (*)
avr
->
ruË
)) {

1050 
”rÜ
 = 
”ºo
;

1051 ià(!
add
)

1052 
tmp_»suÉ
 = 
NULL
;

1053 
	`­Ş_veùÜ_de¡roy
(&
´oc_Œªs_ruËs
);

1054 
”r
;

1057 
	`­Ş_veùÜ_de¡roy
(&
´oc_Œªs_ruËs
);

1058 
	`­Ş_veùÜ_sÜt_uniquify
(
tmp_»suÉ
->
´oc_Œªs_ruËs
, 
NULL
, NULL);

1060 ià(
add
) {

1061 ià(
	`­Ş_veùÜ_­³nd
(
loÿl_»suÉs
, (*)
tmp_»suÉ
)) {

1062 
”rÜ
 = 
”ºo
;

1063 
”r
;

1066 
tmp_»suÉ
 = 
NULL
;

1068 
	`­Ş_veùÜ_de¡roy
(&
‰nodes
);

1070 
	`­Ş_veùÜ_de¡roy
(&
•nodes
);

1074 
”r
:

1075 
	`­Ş_veùÜ_de¡roy
(&
•nodes
);

1076 
	`­Ş_domaš_Œªs_»suÉ_de¡roy
(&
tmp_»suÉ
);

1077 
”ºo
 = 
”rÜ
;

1079 
	}
}

1081 
	$domaš_Œªs_bË_g‘_®l_fÜw¬d_Œªs
(
­Ş_pŞicy_t
 * 
pŞicy
, 
­Ş_domaš_Œªs_ª®ysis_t
 * 
d
,

1082 
­Ş_veùÜ_t
 * 
loÿl_»suÉs
, cÚ¡ 
qpŞ_ty³_t
 * 
¡¬t_ty³
)

1084 
”rÜ
 = 0;

1086 
­Ş_domaš_Œªs_»suÉ_t
 *
tm¶_»suÉ
 = 
	`domaš_Œªs_»suÉ_ü—‹
();

1087 ià(!
tm¶_»suÉ
) {

1088 
”rÜ
 = 
”ºo
;

1089 
”r
;

1092 
dom_node_t
 
dummy
 = { 
¡¬t_ty³
, 
NULL
, NULL, NULL };

1093 
dom_node_t
 *
¡¬t_node
 = 
NULL
;

1094 
	`­Ş_b¡_g‘_–em’t
(
pŞicy
->
domaš_Œªs_bË
->
domaš_bË
, (*)&
dummy
, 
NULL
, (**)&
¡¬t_node
);

1095 ià(
¡¬t_node
) {

1096 
tm¶_»suÉ
->
¡¬t_ty³
 = start_type;

1098 ià(
	`»quœes_£‹xec_Ü_ty³_Œªs
(
pŞicy
è&& 
	`­Ş_veùÜ_g‘_size
(
¡¬t_node
->
£‹xec_ruËs
)) {

1099 ià(
	`­Ş_veùÜ_ÿt
(
tm¶_»suÉ
->
£‹xec_ruËs
, 
¡¬t_node
->setexec_rules)) {

1100 
”rÜ
 = 
”ºo
;

1101 
”r
;

1105 
­Ş_veùÜ_t
 *
´oc_Œªs_ruËs
 = 
	`­Ş_b¡_g‘_veùÜ
(
¡¬t_node
->
´oûss_Œªs™iÚ_Œ“
, 0);

1106 
­Ş_veùÜ_t
 *
pÙ’tŸl_’d_ty³s
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
);

1107 
size_t
 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
´oc_Œªs_ruËs
); i++) {

1108 
avruË_node_t
 *
±node
 = 
	`­Ş_veùÜ_g‘_–em’t
(
´oc_Œªs_ruËs
, 
i
);

1109 
	`­Ş_veùÜ_­³nd
(
pÙ’tŸl_’d_ty³s
, (*)
±node
->
ty³
);

1111 
	`­Ş_veùÜ_de¡roy
(&
´oc_Œªs_ruËs
);

1112 
	`­Ş_veùÜ_sÜt_uniquify
(
pÙ’tŸl_’d_ty³s
, 
NULL
, NULL);

1114 
size_t
 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
pÙ’tŸl_’d_ty³s
); i++) {

1115 
dummy
.
ty³
 = 
tm¶_»suÉ
->
’d_ty³
 = 
	`­Ş_veùÜ_g‘_–em’t
(
pÙ’tŸl_’d_ty³s
, 
i
);

1116 
dom_node_t
 *
’d_node
 = 
NULL
;

1117 
	`­Ş_b¡_g‘_–em’t
(
pŞicy
->
domaš_Œªs_bË
->
domaš_bË
, (*)&
dummy
, 
NULL
, (**)&
’d_node
);

1118 cÚ¡ 
qpŞ_ty³_t
 *
’d_ty³
 = 
dummy
.
ty³
;

1119 ià(
’d_ty³
 =ğ
¡¬t_ty³
)

1122 
­Ş_veùÜ_t
 *
±ruËs
 =

1123 
	`fšd_avruËs_š_node
((*)
¡¬t_node
, 
APOL_DOMAIN_TRANS_RULE_PROC_TRANS
, 
’d_ty³
);

1124 
	`­Ş_veùÜ_de¡roy
(&
tm¶_»suÉ
->
´oc_Œªs_ruËs
);

1125 
tm¶_»suÉ
->
´oc_Œªs_ruËs
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
);

1126 
size_t
 
j
 = 0; j < 
	`­Ş_veùÜ_g‘_size
(
±ruËs
); j++) {

1127 
avruË_node_t
 *
±_’t
 = 
	`­Ş_veùÜ_g‘_–em’t
(
±ruËs
, 
j
);

1128 
±_’t
->
u£d
 = 
Œue
;

1129 ià(
	`­Ş_veùÜ_­³nd
(
tm¶_»suÉ
->
´oc_Œªs_ruËs
, (*)
±_’t
->
ruË
)) {

1130 
”rÜ
 = 
”ºo
;

1131 
	`­Ş_veùÜ_de¡roy
(&
±ruËs
);

1132 
	`­Ş_veùÜ_de¡roy
(&
pÙ’tŸl_’d_ty³s
);

1133 
”r
;

1136 
	`­Ş_veùÜ_de¡roy
(&
±ruËs
);

1137 
	`­Ş_veùÜ_sÜt_uniquify
(
tm¶_»suÉ
->
´oc_Œªs_ruËs
, 
NULL
, NULL);

1138 ià(
’d_node
) {

1140 
­Ş_veùÜ_t
 *
•ruËs
 = 
	`­Ş_b¡_g‘_veùÜ
(
’d_node
->
’Œypošt_Œ“
, 0);

1141 
­Ş_veùÜ_t
 *
pÙ’tŸl_•_ty³s
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
);

1142 ià(!
•ruËs
 || !
pÙ’tŸl_•_ty³s
) {

1143 
”rÜ
 = 
”ºo
;

1144 
	`­Ş_veùÜ_de¡roy
(&
•ruËs
);

1145 
	`­Ş_veùÜ_de¡roy
(&
pÙ’tŸl_’d_ty³s
);

1146 
”r
;

1148 
size_t
 
j
 = 0; j < 
	`­Ş_veùÜ_g‘_size
(
•ruËs
); j++) {

1149 
avruË_node_t
 *
•r
 = 
	`­Ş_veùÜ_g‘_–em’t
(
•ruËs
, 
j
);

1150 ià(
	`­Ş_veùÜ_­³nd
(
pÙ’tŸl_•_ty³s
, (*)
•r
->
ty³
)) {

1151 
”rÜ
 = 
”ºo
;

1152 
	`­Ş_veùÜ_de¡roy
(&
•ruËs
);

1153 
	`­Ş_veùÜ_de¡roy
(&
pÙ’tŸl_’d_ty³s
);

1154 
	`­Ş_veùÜ_de¡roy
(&
pÙ’tŸl_•_ty³s
);

1155 
”r
;

1158 
	`­Ş_veùÜ_de¡roy
(&
•ruËs
);

1159 
	`­Ş_veùÜ_sÜt_uniquify
(
pÙ’tŸl_•_ty³s
, 
NULL
, NULL);

1161 
size_t
 
j
 = 0; j < 
	`­Ş_veùÜ_g‘_size
(
pÙ’tŸl_•_ty³s
); j++) {

1162 
tm¶_»suÉ
->
•_ty³
 = 
	`­Ş_veùÜ_g‘_–em’t
(
pÙ’tŸl_•_ty³s
, 
j
);

1163 
•_node_t
 
edummy
 =

1164 { (cÚ¡ 
qpŞ_ty³_t
 *)
	`­Ş_veùÜ_g‘_–em’t
(
pÙ’tŸl_•_ty³s
, 
j
), 
NULL
, NULL };

1165 
•_node_t
 *
•node
 = 
NULL
;

1166 
	`­Ş_b¡_g‘_–em’t
(
pŞicy
->
domaš_Œªs_bË
->
’Œypošt_bË
, (*)&
edummy
, 
NULL
,

1167 (**)&
•node
);

1169 
	`­Ş_veùÜ_de¡roy
(&
tm¶_»suÉ
->
•_ruËs
);

1170 
tm¶_»suÉ
->
•_ruËs
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
);

1171 ià(!
tm¶_»suÉ
->
•_ruËs
) {

1172 
”rÜ
 = 
”ºo
;

1173 
	`­Ş_veùÜ_de¡roy
(&
pÙ’tŸl_’d_ty³s
);

1174 
	`­Ş_veùÜ_de¡roy
(&
pÙ’tŸl_•_ty³s
);

1175 
”r
;

1177 
•ruËs
 = 
	`fšd_avruËs_š_node
((*)
’d_node
, 
APOL_DOMAIN_TRANS_RULE_ENTRYPOINT
,

1178 
tm¶_»suÉ
->
•_ty³
);

1179 
size_t
 
k
 = 0; k < 
	`­Ş_veùÜ_g‘_size
(
•ruËs
); k++) {

1180 
avruË_node_t
 *
•_’t
 = 
	`­Ş_veùÜ_g‘_–em’t
(
•ruËs
, 
k
);

1181 
•_’t
->
u£d
 = 
Œue
;

1182 ià(
	`­Ş_veùÜ_­³nd
(
tm¶_»suÉ
->
•_ruËs
, (*)
•_’t
->
ruË
)) {

1183 
”rÜ
 = 
”ºo
;

1184 
	`­Ş_veùÜ_de¡roy
(&
•ruËs
);

1185 
	`­Ş_veùÜ_de¡roy
(&
pÙ’tŸl_’d_ty³s
);

1186 
	`­Ş_veùÜ_de¡roy
(&
pÙ’tŸl_•_ty³s
);

1187 
”r
;

1190 
	`­Ş_veùÜ_de¡roy
(&
•ruËs
);

1191 
	`­Ş_veùÜ_sÜt_uniquify
(
tm¶_»suÉ
->
•_ruËs
, 
NULL
, NULL);

1192 ià(
•node
) {

1194 
	`­Ş_veùÜ_de¡roy
(&
tm¶_»suÉ
->
ty³_Œªs_ruËs
);

1195 
tm¶_»suÉ
->
ty³_Œªs_ruËs
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
);

1196 ià(!
tm¶_»suÉ
->
ty³_Œªs_ruËs
) {

1197 
”rÜ
 = 
”ºo
;

1198 
	`­Ş_veùÜ_de¡roy
(&
pÙ’tŸl_’d_ty³s
);

1199 
	`­Ş_veùÜ_de¡roy
(&
pÙ’tŸl_•_ty³s
);

1200 
”r
;

1202 
­Ş_veùÜ_t
 *
‰ruËs
 = 
	`fšd_‹ruËs_š_node
(
•node
, 
¡¬t_ty³
, 
’d_ty³
);

1203 
size_t
 
l
 = 0;† < 
	`­Ş_veùÜ_g‘_size
(
‰ruËs
);†++) {

1204 
‹ruË_node_t
 *
Š
 = 
	`­Ş_veùÜ_g‘_–em’t
(
‰ruËs
, 
l
);

1205 ià(
	`­Ş_veùÜ_­³nd
(
tm¶_»suÉ
->
ty³_Œªs_ruËs
, (*)
Š
->
ruË
)) {

1206 
”rÜ
 = 
”ºo
;

1207 
	`­Ş_veùÜ_de¡roy
(&
‰ruËs
);

1208 
	`­Ş_veùÜ_de¡roy
(&
pÙ’tŸl_’d_ty³s
);

1209 
	`­Ş_veùÜ_de¡roy
(&
pÙ’tŸl_•_ty³s
);

1210 
”r
;

1213 
	`­Ş_veùÜ_de¡roy
(&
‰ruËs
);

1214 
	`­Ş_veùÜ_sÜt_uniquify
(
tm¶_»suÉ
->
ty³_Œªs_ruËs
, 
NULL
, NULL);

1216 
	`­Ş_veùÜ_de¡roy
(&
tm¶_»suÉ
->
exec_ruËs
);

1217 
tm¶_»suÉ
->
exec_ruËs
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
);

1218 ià(!
tm¶_»suÉ
->
exec_ruËs
) {

1219 
”rÜ
 = 
”ºo
;

1220 
	`­Ş_veùÜ_de¡roy
(&
pÙ’tŸl_’d_ty³s
);

1221 
	`­Ş_veùÜ_de¡roy
(&
pÙ’tŸl_•_ty³s
);

1222 
”r
;

1224 
­Ş_veùÜ_t
 *
exeüuËs
 =

1225 
	`fšd_avruËs_š_node
(
•node
, 
APOL_DOMAIN_TRANS_RULE_EXEC
, 
¡¬t_ty³
);

1226 ià(
	`­Ş_veùÜ_g‘_size
(
exeüuËs
)) {

1227 
size_t
 
l
 = 0;† < 
	`­Ş_veùÜ_g‘_size
(
exeüuËs
);†++) {

1228 
avruË_node_t
 *
xnode
 = 
	`­Ş_veùÜ_g‘_–em’t
(
exeüuËs
, 
l
);

1230 ià(
­Ş_veùÜ_­³nd


1231 (
tm¶_»suÉ
->
exec_ruËs
, (*)
xnode
->
ruË
)) {

1232 
”rÜ
 = 
”ºo
;

1233 
	`­Ş_veùÜ_de¡roy
(&
exeüuËs
);

1234 
	`­Ş_veùÜ_de¡roy
(&
pÙ’tŸl_’d_ty³s
);

1235 
	`­Ş_veùÜ_de¡roy
(&
pÙ’tŸl_•_ty³s
);

1236 
”r
;

1239 
	`­Ş_veùÜ_de¡roy
(&
exeüuËs
);

1240 
	`­Ş_veùÜ_sÜt_uniquify
(
tm¶_»suÉ
->
exec_ruËs
, 
NULL
, NULL);

1242 
­Ş_domaš_Œªs_»suÉ_t
 *
tmp
 =

1243 
­Ş_domaš_Œªs_»suÉ_ü—‹_äom_domaš_Œªs_»suÉ


1244 (
tm¶_»suÉ
);

1245 ià(!
tmp
 || 
	`­Ş_veùÜ_­³nd
(
loÿl_»suÉs
, (*)tmp)) {

1246 
”rÜ
 = 
”ºo
;

1247 
	`­Ş_domaš_Œªs_»suÉ_de¡roy
(&
tmp
);

1248 
	`­Ş_veùÜ_de¡roy
(&
pÙ’tŸl_’d_ty³s
);

1249 
	`­Ş_veùÜ_de¡roy
(&
pÙ’tŸl_•_ty³s
);

1250 
”r
;

1253 
	`­Ş_veùÜ_de¡roy
(&
tm¶_»suÉ
->
exec_ruËs
);

1254 
tm¶_»suÉ
->
exec_ruËs
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
);

1255 ià(!
tm¶_»suÉ
->
exec_ruËs
) {

1256 
”rÜ
 = 
”ºo
;

1257 
	`­Ş_veùÜ_de¡roy
(&
pÙ’tŸl_’d_ty³s
);

1258 
	`­Ş_veùÜ_de¡roy
(&
pÙ’tŸl_•_ty³s
);

1259 
”r
;

1262 
	`­Ş_veùÜ_de¡roy
(&
tm¶_»suÉ
->
ty³_Œªs_ruËs
);

1263 
tm¶_»suÉ
->
ty³_Œªs_ruËs
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
);

1264 ià(!
tm¶_»suÉ
->
ty³_Œªs_ruËs
) {

1265 
”rÜ
 = 
”ºo
;

1266 
	`­Ş_veùÜ_de¡roy
(&
pÙ’tŸl_’d_ty³s
);

1267 
	`­Ş_veùÜ_de¡roy
(&
pÙ’tŸl_•_ty³s
);

1268 
”r
;

1272 
­Ş_domaš_Œªs_»suÉ_t
 *
tmp
 =

1273 
­Ş_domaš_Œªs_»suÉ_ü—‹_äom_domaš_Œªs_»suÉ


1274 (
tm¶_»suÉ
);

1275 ià(!
tmp
 || 
	`­Ş_veùÜ_­³nd
(
loÿl_»suÉs
, (*)tmp)) {

1276 
”rÜ
 = 
”ºo
;

1277 
	`­Ş_domaš_Œªs_»suÉ_de¡roy
(&
tmp
);

1278 
	`­Ş_veùÜ_de¡roy
(&
pÙ’tŸl_’d_ty³s
);

1279 
	`­Ş_veùÜ_de¡roy
(&
pÙ’tŸl_•_ty³s
);

1280 
”r
;

1283 
	`­Ş_veùÜ_de¡roy
(&
exeüuËs
);

1286 
­Ş_domaš_Œªs_»suÉ_t
 *
tmp
 =

1287 
	`­Ş_domaš_Œªs_»suÉ_ü—‹_äom_domaš_Œªs_»suÉ
(
tm¶_»suÉ
);

1288 ià(!
tmp
 || 
	`­Ş_veùÜ_­³nd
(
loÿl_»suÉs
, (*)tmp)) {

1289 
”rÜ
 = 
”ºo
;

1290 
	`­Ş_domaš_Œªs_»suÉ_de¡roy
(&
tmp
);

1291 
	`­Ş_veùÜ_de¡roy
(&
pÙ’tŸl_’d_ty³s
);

1292 
	`­Ş_veùÜ_de¡roy
(&
pÙ’tŸl_•_ty³s
);

1293 
”r
;

1297 
	`­Ş_veùÜ_de¡roy
(&
tm¶_»suÉ
->
•_ruËs
);

1298 
tm¶_»suÉ
->
•_ruËs
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
);

1299 ià(!
tm¶_»suÉ
->
•_ruËs
) {

1300 
”rÜ
 = 
”ºo
;

1301 
	`­Ş_veùÜ_de¡roy
(&
pÙ’tŸl_’d_ty³s
);

1302 
	`­Ş_veùÜ_de¡roy
(&
pÙ’tŸl_•_ty³s
);

1303 
”r
;

1306 
	`­Ş_veùÜ_de¡roy
(&
pÙ’tŸl_•_ty³s
);

1309 
­Ş_domaš_Œªs_»suÉ_t
 *
tmp
 =

1310 
	`­Ş_domaš_Œªs_»suÉ_ü—‹_äom_domaš_Œªs_»suÉ
(
tm¶_»suÉ
);

1311 ià(!
tmp
 || 
	`­Ş_veùÜ_­³nd
(
loÿl_»suÉs
, (*)tmp)) {

1312 
”rÜ
 = 
”ºo
;

1313 
	`­Ş_domaš_Œªs_»suÉ_de¡roy
(&
tmp
);

1314 
”r
;

1318 
	`­Ş_veùÜ_de¡roy
(&
pÙ’tŸl_’d_ty³s
);

1320 
size_t
 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
loÿl_»suÉs
); i++) {

1321 
­Ş_domaš_Œªs_»suÉ_t
 *
»s
 = 
	`­Ş_veùÜ_g‘_–em’t
(
loÿl_»suÉs
, 
i
);

1322 ià(
»s
->
¡¬t_ty³
 &&„es->
•_ty³
 &&„es->
’d_ty³
 && 
	`­Ş_veùÜ_g‘_size
Ôes->
´oc_Œªs_ruËs
) &&

1323 
	`­Ş_veùÜ_g‘_size
(
»s
->
•_ruËs
è&&‡pŞ_veùÜ_g‘_sizeÔes->
exec_ruËs
) &&

1324 (
	`»quœes_£‹xec_Ü_ty³_Œªs
(
pŞicy
)

1325 ? (
	`­Ş_veùÜ_g‘_size
(
»s
->
£‹xec_ruËs
è||‡pŞ_veùÜ_g‘_sizeÔes->
ty³_Œªs_ruËs
)è: 
Œue
)) {

1326 
»s
->
v®id
 = 
Œue
;

1331 ià(
d
->
v®id
 & 
APOL_DOMAIN_TRANS_SEARCH_INVALID
) {

1332 ià(
	`domaš_Œªs_bË_fšd_Üphª_ty³_Œªs™iÚs
(
pŞicy
, 
d
, 
loÿl_»suÉs
)) {

1333 
”rÜ
 = 
”ºo
;

1334 
”r
;

1337 
	`­Ş_domaš_Œªs_»suÉ_de¡roy
(&
tm¶_»suÉ
);

1340 
”r
:

1341 
	`­Ş_domaš_Œªs_»suÉ_de¡roy
(&
tm¶_»suÉ
);

1342 
”ºo
 = 
”rÜ
;

1344 
	}
}

1346 
	$domaš_Œªs_bË_g‘_®l_»v”£_Œªs
(
­Ş_pŞicy_t
 * 
pŞicy
, 
­Ş_domaš_Œªs_ª®ysis_t
 * 
d
,

1347 
­Ş_veùÜ_t
 * 
loÿl_»suÉs
, cÚ¡ 
qpŞ_ty³_t
 * 
’d_ty³
)

1349 
”rÜ
 = 0;

1351 
­Ş_domaš_Œªs_»suÉ_t
 *
tm¶_»suÉ
 = 
	`domaš_Œªs_»suÉ_ü—‹
();

1352 ià(!
tm¶_»suÉ
) {

1353 
”rÜ
 = 
”ºo
;

1354 
”r
;

1357 
dom_node_t
 
dummy
 = { 
’d_ty³
, 
NULL
, NULL, NULL };

1358 
dom_node_t
 *
’d_node
 = 
NULL
;

1359 
	`­Ş_b¡_g‘_–em’t
(
pŞicy
->
domaš_Œªs_bË
->
domaš_bË
, (*)&
dummy
, 
NULL
, (**)&
’d_node
);

1360 ià(
’d_node
) {

1361 
tm¶_»suÉ
->
’d_ty³
 =ƒnd_type;

1363 
­Ş_veùÜ_t
 *
•ruËs
 = 
	`­Ş_b¡_g‘_veùÜ
(
’d_node
->
’Œypošt_Œ“
, 0);

1364 
­Ş_veùÜ_t
 *
pÙ’tŸl_•_ty³s
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
);

1365 ià(!
•ruËs
 || !
pÙ’tŸl_•_ty³s
) {

1366 
”rÜ
 = 
”ºo
;

1367 
	`­Ş_veùÜ_de¡roy
(&
•ruËs
);

1368 
”r
;

1370 
size_t
 
j
 = 0; j < 
	`­Ş_veùÜ_g‘_size
(
•ruËs
); j++) {

1371 
avruË_node_t
 *
•r
 = 
	`­Ş_veùÜ_g‘_–em’t
(
•ruËs
, 
j
);

1372 ià(
	`­Ş_veùÜ_­³nd
(
pÙ’tŸl_•_ty³s
, (*)
•r
->
ty³
)) {

1373 
”rÜ
 = 
”ºo
;

1374 
	`­Ş_veùÜ_de¡roy
(&
•ruËs
);

1375 
	`­Ş_veùÜ_de¡roy
(&
pÙ’tŸl_•_ty³s
);

1376 
”r
;

1379 
	`­Ş_veùÜ_de¡roy
(&
•ruËs
);

1380 
	`­Ş_veùÜ_sÜt_uniquify
(
pÙ’tŸl_•_ty³s
, 
NULL
, NULL);

1381 
size_t
 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
pÙ’tŸl_•_ty³s
); i++) {

1382 
tm¶_»suÉ
->
•_ty³
 = 
	`­Ş_veùÜ_g‘_–em’t
(
pÙ’tŸl_•_ty³s
, 
i
);

1384 
•ruËs
 = 
	`fšd_avruËs_š_node
((*)
’d_node
, 
APOL_DOMAIN_TRANS_RULE_ENTRYPOINT
, 
tm¶_»suÉ
->
•_ty³
);

1385 
	`­Ş_veùÜ_de¡roy
(&
tm¶_»suÉ
->
•_ruËs
);

1386 
tm¶_»suÉ
->
•_ruËs
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
);

1387 
size_t
 
j
 = 0; j < 
	`­Ş_veùÜ_g‘_size
(
•ruËs
); j++) {

1388 
avruË_node_t
 *
•_’t
 = 
	`­Ş_veùÜ_g‘_–em’t
(
•ruËs
, 
j
);

1389 
•_’t
->
u£d
 = 
Œue
;

1390 ià(
	`­Ş_veùÜ_­³nd
(
tm¶_»suÉ
->
•_ruËs
, (*)
•_’t
->
ruË
)) {

1391 
”rÜ
 = 
”ºo
;

1392 
	`­Ş_veùÜ_de¡roy
(&
•ruËs
);

1393 
	`­Ş_veùÜ_de¡roy
(&
pÙ’tŸl_•_ty³s
);

1394 
”r
;

1397 
	`­Ş_veùÜ_de¡roy
(&
•ruËs
);

1398 
	`­Ş_veùÜ_sÜt_uniquify
(
tm¶_»suÉ
->
•_ruËs
, 
NULL
, NULL);

1399 
•_node_t
 
edummy
 = { 
tm¶_»suÉ
->
•_ty³
, 
NULL
, NULL };

1400 
•_node_t
 *
•node
 = 
NULL
;

1401 
	`­Ş_b¡_g‘_–em’t
(
pŞicy
->
domaš_Œªs_bË
->
’Œypošt_bË
, (*)&
edummy
, 
NULL
, (**)&
•node
);

1403 ià(
•node
) {

1404 
­Ş_veùÜ_t
 *
exeüuËs
 = 
	`­Ş_b¡_g‘_veùÜ
(
•node
->
execu‹_Œ“
, 0);

1405 
­Ş_veùÜ_t
 *
pÙ’tŸl_¡¬t_ty³s
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
);

1406 ià(!
exeüuËs
 || !
pÙ’tŸl_¡¬t_ty³s
) {

1407 
”rÜ
 = 
”ºo
;

1408 
	`­Ş_veùÜ_de¡roy
(&
exeüuËs
);

1409 
”r
;

1411 
size_t
 
k
 = 0; k < 
	`­Ş_veùÜ_g‘_size
(
exeüuËs
); k++) {

1412 
avruË_node_t
 *
n
 = 
	`­Ş_veùÜ_g‘_–em’t
(
exeüuËs
, 
k
);

1413 ià(
	`­Ş_veùÜ_­³nd
(
pÙ’tŸl_¡¬t_ty³s
, (*)
n
->
ty³
)) {

1414 
”rÜ
 = 
”ºo
;

1415 
	`­Ş_veùÜ_de¡roy
(&
exeüuËs
);

1416 
	`­Ş_veùÜ_de¡roy
(&
pÙ’tŸl_¡¬t_ty³s
);

1417 
	`­Ş_veùÜ_de¡roy
(&
pÙ’tŸl_•_ty³s
);

1418 
”r
;

1421 
	`­Ş_veùÜ_de¡roy
(&
exeüuËs
);

1422 
	`­Ş_veùÜ_sÜt_uniquify
(
pÙ’tŸl_¡¬t_ty³s
, 
NULL
, NULL);

1423 
size_t
 
k
 = 0; k < 
	`­Ş_veùÜ_g‘_size
(
pÙ’tŸl_¡¬t_ty³s
); k++) {

1424 
tm¶_»suÉ
->
¡¬t_ty³
 = 
	`­Ş_veùÜ_g‘_–em’t
(
pÙ’tŸl_¡¬t_ty³s
, 
k
);

1426 ià(
tm¶_»suÉ
->
’d_ty³
 =ğtm¶_»suÉ->
¡¬t_ty³
)

1429 
­Ş_veùÜ_t
 *
exec_ruËs
 =

1430 
	`fšd_avruËs_š_node
((*)
•node
, 
APOL_DOMAIN_TRANS_RULE_EXEC
,

1431 
tm¶_»suÉ
->
¡¬t_ty³
);

1432 
	`­Ş_veùÜ_de¡roy
(&
tm¶_»suÉ
->
exec_ruËs
);

1433 
tm¶_»suÉ
->
exec_ruËs
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
);

1434 
size_t
 
l
 = 0;† < 
	`­Ş_veùÜ_g‘_size
(
exec_ruËs
);†++) {

1435 
avruË_node_t
 *
n
 = 
	`­Ş_veùÜ_g‘_–em’t
(
exec_ruËs
, 
l
);

1436 
n
->
u£d
 = 
Œue
;

1437 ià(
	`­Ş_veùÜ_­³nd
(
tm¶_»suÉ
->
exec_ruËs
, (*)
n
->
ruË
)) {

1438 
”rÜ
 = 
”ºo
;

1439 
	`­Ş_veùÜ_de¡roy
(&
exec_ruËs
);

1440 
	`­Ş_veùÜ_de¡roy
(&
pÙ’tŸl_¡¬t_ty³s
);

1441 
	`­Ş_veùÜ_de¡roy
(&
pÙ’tŸl_•_ty³s
);

1442 
”r
;

1445 
	`­Ş_veùÜ_de¡roy
(&
exec_ruËs
);

1446 
	`­Ş_veùÜ_sÜt_uniquify
(
tm¶_»suÉ
->
exec_ruËs
, 
NULL
, NULL);

1448 
­Ş_veùÜ_t
 *
‰ruËs
 =

1449 
	`fšd_‹ruËs_š_node
(
•node
, 
tm¶_»suÉ
->
¡¬t_ty³
,m¶_»suÉ->
’d_ty³
);

1450 
	`­Ş_veùÜ_de¡roy
(&
tm¶_»suÉ
->
ty³_Œªs_ruËs
);

1451 
tm¶_»suÉ
->
ty³_Œªs_ruËs
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
);

1452 ià(!
tm¶_»suÉ
->
ty³_Œªs_ruËs
) {

1453 
”rÜ
 = 
”ºo
;

1454 
	`­Ş_veùÜ_de¡roy
(&
‰ruËs
);

1455 
	`­Ş_veùÜ_de¡roy
(&
pÙ’tŸl_¡¬t_ty³s
);

1456 
	`­Ş_veùÜ_de¡roy
(&
pÙ’tŸl_•_ty³s
);

1457 
”r
;

1459 
size_t
 
l
 = 0;† < 
	`­Ş_veùÜ_g‘_size
(
‰ruËs
);†++) {

1460 
‹ruË_node_t
 *
n
 = 
	`­Ş_veùÜ_g‘_–em’t
(
‰ruËs
, 
l
);

1461 
n
->
u£d
 = 
Œue
;

1462 ià(
	`­Ş_veùÜ_­³nd
(
tm¶_»suÉ
->
ty³_Œªs_ruËs
, (*)
n
->
ruË
)) {

1463 
”rÜ
 = 
”ºo
;

1464 
	`­Ş_veùÜ_de¡roy
(&
‰ruËs
);

1465 
	`­Ş_veùÜ_de¡roy
(&
pÙ’tŸl_¡¬t_ty³s
);

1466 
	`­Ş_veùÜ_de¡roy
(&
pÙ’tŸl_•_ty³s
);

1467 
”r
;

1470 
	`­Ş_veùÜ_de¡roy
(&
‰ruËs
);

1471 
	`­Ş_veùÜ_sÜt_uniquify
(
tm¶_»suÉ
->
ty³_Œªs_ruËs
, 
NULL
, NULL);

1472 
dummy
.
ty³
 = 
tm¶_»suÉ
->
¡¬t_ty³
;

1473 
dom_node_t
 *
¡¬t_node
 = 
NULL
;

1474 
	`­Ş_b¡_g‘_–em’t
(
pŞicy
->
domaš_Œªs_bË
->
domaš_bË
, (*)&
dummy
, 
NULL
,

1475 (**)&
¡¬t_node
);

1476 ià(
¡¬t_node
) {

1478 ià(
	`»quœes_£‹xec_Ü_ty³_Œªs
(
pŞicy
)) {

1479 
	`­Ş_veùÜ_de¡roy
(&
tm¶_»suÉ
->
£‹xec_ruËs
);

1480 
tm¶_»suÉ
->
£‹xec_ruËs
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
);

1481 ià(!
tm¶_»suÉ
->
£‹xec_ruËs
 ||

1482 
	`­Ş_veùÜ_ÿt
(
tm¶_»suÉ
->
£‹xec_ruËs
,

1483 
¡¬t_node
->
£‹xec_ruËs
)) {

1484 
”rÜ
 = 
”ºo
;

1485 
	`­Ş_veùÜ_de¡roy
(&
pÙ’tŸl_¡¬t_ty³s
);

1486 
	`­Ş_veùÜ_de¡roy
(&
pÙ’tŸl_•_ty³s
);

1487 
”r
;

1491 
	`­Ş_veùÜ_de¡roy
(&
tm¶_»suÉ
->
´oc_Œªs_ruËs
);

1492 
tm¶_»suÉ
->
´oc_Œªs_ruËs
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
);

1493 ià(!
tm¶_»suÉ
->
´oc_Œªs_ruËs
) {

1494 
”rÜ
 = 
”ºo
;

1495 
	`­Ş_veùÜ_de¡roy
(&
pÙ’tŸl_¡¬t_ty³s
);

1496 
	`­Ş_veùÜ_de¡roy
(&
pÙ’tŸl_•_ty³s
);

1497 
”r
;

1499 
­Ş_veùÜ_t
 *
±_ruËs
 = 
NULL
;

1500 
±_ruËs
 =

1501 
	`fšd_avruËs_š_node
(
¡¬t_node
, 
APOL_DOMAIN_TRANS_RULE_PROC_TRANS
,

1502 
tm¶_»suÉ
->
’d_ty³
);

1503 ià(
	`­Ş_veùÜ_g‘_size
(
±_ruËs
)) {

1504 
size_t
 
l
 = 0;† < 
	`­Ş_veùÜ_g‘_size
(
±_ruËs
);†++) {

1505 
avruË_node_t
 *
n
 = 
	`­Ş_veùÜ_g‘_–em’t
(
±_ruËs
, 
l
);

1506 
	`­Ş_veùÜ_­³nd
(
tm¶_»suÉ
->
´oc_Œªs_ruËs
, (*)
n
->
ruË
);

1508 
	`­Ş_veùÜ_de¡roy
(&
±_ruËs
);

1509 
	`­Ş_veùÜ_sÜt_uniquify
(
tm¶_»suÉ
->
´oc_Œªs_ruËs
, 
NULL
, NULL);

1511 
­Ş_domaš_Œªs_»suÉ_t
 *
tmp
 =

1512 
­Ş_domaš_Œªs_»suÉ_ü—‹_äom_domaš_Œªs_»suÉ


1513 (
tm¶_»suÉ
);

1514 ià(!
tmp
 || 
	`­Ş_veùÜ_­³nd
(
loÿl_»suÉs
, (*)tmp)) {

1515 
”rÜ
 = 
”ºo
;

1516 
	`­Ş_domaš_Œªs_»suÉ_de¡roy
(&
tmp
);

1517 
	`­Ş_veùÜ_de¡roy
(&
pÙ’tŸl_¡¬t_ty³s
);

1518 
	`­Ş_veùÜ_de¡roy
(&
pÙ’tŸl_•_ty³s
);

1519 
”r
;

1522 
	`­Ş_veùÜ_de¡roy
(&
tm¶_»suÉ
->
´oc_Œªs_ruËs
);

1523 
tm¶_»suÉ
->
´oc_Œªs_ruËs
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
);

1524 ià(!
tm¶_»suÉ
->
´oc_Œªs_ruËs
) {

1525 
”rÜ
 = 
”ºo
;

1526 
	`­Ş_veùÜ_de¡roy
(&
pÙ’tŸl_¡¬t_ty³s
);

1527 
	`­Ş_veùÜ_de¡roy
(&
pÙ’tŸl_•_ty³s
);

1528 
”r
;

1531 
	`­Ş_veùÜ_de¡roy
(&
tm¶_»suÉ
->
£‹xec_ruËs
);

1532 
tm¶_»suÉ
->
£‹xec_ruËs
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
);

1533 ià(!
tm¶_»suÉ
->
£‹xec_ruËs
) {

1534 
”rÜ
 = 
”ºo
;

1535 
	`­Ş_veùÜ_de¡roy
(&
pÙ’tŸl_¡¬t_ty³s
);

1536 
	`­Ş_veùÜ_de¡roy
(&
pÙ’tŸl_•_ty³s
);

1537 
”r
;

1541 
­Ş_domaš_Œªs_»suÉ_t
 *
tmp
 =

1542 
­Ş_domaš_Œªs_»suÉ_ü—‹_äom_domaš_Œªs_»suÉ


1543 (
tm¶_»suÉ
);

1544 ià(!
tmp
 || 
	`­Ş_veùÜ_­³nd
(
loÿl_»suÉs
, (*)tmp)) {

1545 
”rÜ
 = 
”ºo
;

1546 
	`­Ş_domaš_Œªs_»suÉ_de¡roy
(&
tmp
);

1547 
	`­Ş_veùÜ_de¡roy
(&
pÙ’tŸl_¡¬t_ty³s
);

1548 
	`­Ş_veùÜ_de¡roy
(&
pÙ’tŸl_•_ty³s
);

1549 
	`­Ş_veùÜ_de¡roy
(&
±_ruËs
);

1550 
”r
;

1553 
	`­Ş_veùÜ_de¡roy
(&
±_ruËs
);

1556 
­Ş_domaš_Œªs_»suÉ_t
 *
tmp
 =

1557 
	`­Ş_domaš_Œªs_»suÉ_ü—‹_äom_domaš_Œªs_»suÉ
(
tm¶_»suÉ
);

1558 ià(!
tmp
 || 
	`­Ş_veùÜ_­³nd
(
loÿl_»suÉs
, (*)tmp)) {

1559 
”rÜ
 = 
”ºo
;

1560 
	`­Ş_domaš_Œªs_»suÉ_de¡roy
(&
tmp
);

1561 
	`­Ş_veùÜ_de¡roy
(&
pÙ’tŸl_¡¬t_ty³s
);

1562 
	`­Ş_veùÜ_de¡roy
(&
pÙ’tŸl_•_ty³s
);

1563 
”r
;

1567 
	`­Ş_veùÜ_de¡roy
(&
tm¶_»suÉ
->
exec_ruËs
);

1568 
tm¶_»suÉ
->
exec_ruËs
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
);

1569 ià(!
tm¶_»suÉ
->
exec_ruËs
) {

1570 
”rÜ
 = 
”ºo
;

1571 
	`­Ş_veùÜ_de¡roy
(&
pÙ’tŸl_¡¬t_ty³s
);

1572 
	`­Ş_veùÜ_de¡roy
(&
pÙ’tŸl_•_ty³s
);

1573 
”r
;

1576 
	`­Ş_veùÜ_de¡roy
(&
tm¶_»suÉ
->
ty³_Œªs_ruËs
);

1577 
tm¶_»suÉ
->
ty³_Œªs_ruËs
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
);

1578 ià(!
tm¶_»suÉ
->
ty³_Œªs_ruËs
) {

1579 
”rÜ
 = 
”ºo
;

1580 
	`­Ş_veùÜ_de¡roy
(&
pÙ’tŸl_¡¬t_ty³s
);

1581 
	`­Ş_veùÜ_de¡roy
(&
pÙ’tŸl_•_ty³s
);

1582 
”r
;

1585 
	`­Ş_veùÜ_de¡roy
(&
pÙ’tŸl_¡¬t_ty³s
);

1588 
­Ş_domaš_Œªs_»suÉ_t
 *
tmp
 =

1589 
	`­Ş_domaš_Œªs_»suÉ_ü—‹_äom_domaš_Œªs_»suÉ
(
tm¶_»suÉ
);

1590 ià(!
tmp
 || 
	`­Ş_veùÜ_­³nd
(
loÿl_»suÉs
, (*)tmp)) {

1591 
”rÜ
 = 
”ºo
;

1592 
	`­Ş_domaš_Œªs_»suÉ_de¡roy
(&
tmp
);

1593 
”r
;

1597 
	`­Ş_veùÜ_de¡roy
(&
pÙ’tŸl_•_ty³s
);

1600 
size_t
 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
loÿl_»suÉs
); i++) {

1601 
­Ş_domaš_Œªs_»suÉ_t
 *
»s
 = 
	`­Ş_veùÜ_g‘_–em’t
(
loÿl_»suÉs
, 
i
);

1602 ià(
»s
->
¡¬t_ty³
 &&„es->
•_ty³
 &&„es->
’d_ty³
 && 
	`­Ş_veùÜ_g‘_size
Ôes->
´oc_Œªs_ruËs
) &&

1603 
	`­Ş_veùÜ_g‘_size
(
»s
->
•_ruËs
è&&‡pŞ_veùÜ_g‘_sizeÔes->
exec_ruËs
) &&

1604 (
	`»quœes_£‹xec_Ü_ty³_Œªs
(
pŞicy
)

1605 ? (
	`­Ş_veùÜ_g‘_size
(
»s
->
£‹xec_ruËs
è||‡pŞ_veùÜ_g‘_sizeÔes->
ty³_Œªs_ruËs
)è: 
Œue
)) {

1606 
»s
->
v®id
 = 
Œue
;

1611 ià(
d
->
v®id
 & 
APOL_DOMAIN_TRANS_SEARCH_INVALID
) {

1612 ià(
	`domaš_Œªs_bË_fšd_Üphª_ty³_Œªs™iÚs
(
pŞicy
, 
d
, 
loÿl_»suÉs
)) {

1613 
”rÜ
 = 
”ºo
;

1614 
”r
;

1618 
	`­Ş_domaš_Œªs_»suÉ_de¡roy
(&
tm¶_»suÉ
);

1621 
”r
:

1622 
	`­Ş_domaš_Œªs_»suÉ_de¡roy
(&
tm¶_»suÉ
);

1623 
”ºo
 = 
”rÜ
;

1625 
	}
}

1627 
	$­Ş_domaš_Œªs_ª®ysis_do
(
­Ş_pŞicy_t
 * 
pŞicy
, 
­Ş_domaš_Œªs_ª®ysis_t
 * 
d
, 
­Ş_veùÜ_t
 ** 
»suÉs
)

1629 
­Ş_veùÜ_t
 *
loÿl_»suÉs
 = 
NULL
;

1630 
­Ş_avruË_qu”y_t
 *
acûssq
 = 
NULL
;

1631 
”rÜ
 = 0;

1632 ià(!
»suÉs
)

1633 *
»suÉs
 = 
NULL
;

1634 ià(!
pŞicy
 || !
d
 || !
»suÉs
) {

1635 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

1636 
”ºo
 = 
EINVAL
;

1641 ià(!(
pŞicy
->
domaš_Œªs_bË
)) {

1642 ià(
	`­Ş_pŞicy_bud_domaš_Œªs_bË
(
pŞicy
))

1647 ià(
d
->
dœeùiÚ
 =ğ0 || d->
v®id
 & ~(
APOL_DOMAIN_TRANS_SEARCH_BOTH
è|| !(d->
¡¬t_ty³
)) {

1648 
”rÜ
 = 
EINVAL
;

1649 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

1650 
”r
;

1652 
size_t
 
num_©y³s
 = 
	`­Ş_veùÜ_g‘_size
(
d
->
acûss_ty³s
);

1653 
size_t
 
num_aşas£s
 = 
	`­Ş_veùÜ_g‘_size
(
d
->
acûss_şas£s
);

1654 
size_t
 
num_­»ms
 = 
	`­Ş_veùÜ_g‘_size
(
d
->
acûss_³rms
);

1655 ià((
num_©y³s
 =ğ0 && (
num_aşas£s
 !ğ0 || 
num_­»ms
 != 0)) ||

1656 (
num_aşas£s
 =ğ0 && (
num_©y³s
 !ğ0 || 
num_­»ms
 != 0)) ||

1657 (
num_­»ms
 =ğ0 && (
num_aşas£s
 !ğ0 || 
num_©y³s
 != 0))) {

1658 
”rÜ
 = 
EINVAL
;

1659 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

1660 
”r
;

1664 cÚ¡ 
qpŞ_ty³_t
 *
¡¬t_ty³
 = 
NULL
;

1665 ià(
	`qpŞ_pŞicy_g‘_ty³_by_Çme
(
pŞicy
->
p
, 
d
->
¡¬t_ty³
, &start_type)) {

1666 
”rÜ
 = 
”ºo
;

1667 
	`ERR
(
pŞicy
, "UÇbËØ³rfÜm‡Çlysis: Inv®id s¹šgy³ %s", 
d
->
¡¬t_ty³
);

1668 
”r
;

1670 
i§‰r
 = 0;

1671 
	`qpŞ_ty³_g‘_i§‰r
(
pŞicy
->
p
, 
¡¬t_ty³
, &
i§‰r
);

1672 ià(
i§‰r
) {

1673 
	`ERR
(
pŞicy
, "%s", "Attributes‡re‚ot valid here.");

1674 
”rÜ
 = 
EINVAL
;

1675 
”r
;

1678 
loÿl_»suÉs
 = 
	`­Ş_veùÜ_ü—‹
(
domaš_Œªs_»suÉ_ä“
);

1680 ià(
d
->
dœeùiÚ
 =ğ
APOL_DOMAIN_TRANS_DIRECTION_REVERSE
) {

1681 ià(
	`domaš_Œªs_bË_g‘_®l_»v”£_Œªs
(
pŞicy
, 
d
, 
loÿl_»suÉs
, 
¡¬t_ty³
)) {

1682 
”rÜ
 = 
”ºo
;

1683 
”r
;

1686 ià(
	`domaš_Œªs_bË_g‘_®l_fÜw¬d_Œªs
(
pŞicy
, 
d
, 
loÿl_»suÉs
, 
¡¬t_ty³
)) {

1687 
”rÜ
 = 
”ºo
;

1688 
”r
;

1693 ià(
d
->
v®id
 !ğ
APOL_DOMAIN_TRANS_SEARCH_BOTH
) {

1694 
size_t
 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
loÿl_»suÉs
); ) {

1695 
­Ş_domaš_Œªs_»suÉ_t
 *
»s
 = 
	`­Ş_veùÜ_g‘_–em’t
(
loÿl_»suÉs
, 
i
);

1696 ià(
»s
->
v®id
 !ğ(
d
->v®id =ğ
APOL_DOMAIN_TRANS_SEARCH_VALID
)) {

1697 
	`­Ş_veùÜ_»move
(
loÿl_»suÉs
, 
i
);

1698 
	`domaš_Œªs_»suÉ_ä“
(
»s
);

1700 
i
++;

1706 ià(
d
->
»suÉ
) {

1707 
size_t
 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
loÿl_»suÉs
); ) {

1708 
­Ş_domaš_Œªs_»suÉ_t
 *
»s
 = 
	`­Ş_veùÜ_g‘_–em’t
(
loÿl_»suÉs
, 
i
);

1709 cÚ¡ 
qpŞ_ty³_t
 *
ty³
 = 
NULL
;

1710 ià(
d
->
dœeùiÚ
 =ğ
APOL_DOMAIN_TRANS_DIRECTION_REVERSE
) {

1711 
ty³
 = 
»s
->
¡¬t_ty³
;

1713 
ty³
 = 
»s
->
’d_ty³
;

1715 
compv®
 = 
	`­Ş_com·»_ty³
(
pŞicy
, 
ty³
, 
d
->
»suÉ
, 
APOL_QUERY_REGEX
, &d->
»suÉ_»gex
);

1716 ià(
compv®
 < 0) {

1717 
”rÜ
 = 
”ºo
;

1718 
”r
;

1719 } ià(
compv®
 > 0) {

1720 
i
++;

1722 
	`­Ş_veùÜ_»move
(
loÿl_»suÉs
, 
i
);

1723 
	`domaš_Œªs_»suÉ_ä“
(
»s
);

1729 ià(
d
->
dœeùiÚ
 =ğ
APOL_DOMAIN_TRANS_DIRECTION_FORWARD
 && 
num_©y³s
 && 
num_aşas£s
 && 
num_­»ms
) {

1730 
acûssq
 = 
	`­Ş_avruË_qu”y_ü—‹
();

1731 
	`­Ş_avruË_qu”y_£t_ruËs
(
pŞicy
, 
acûssq
, 
QPOL_RULE_ALLOW
);

1732 
size_t
 
i
 = 0; i < 
num_aşas£s
; i++) {

1733 ià(
­Ş_avruË_qu”y_­³nd_şass


1734 (
pŞicy
, 
acûssq
, (*)
	`­Ş_veùÜ_g‘_–em’t
(
d
->
acûss_şas£s
, 
i
))) {

1735 
”rÜ
 = 
”ºo
;

1736 
”r
;

1739 
size_t
 
i
 = 0; i < 
num_­»ms
; i++) {

1740 ià(
	`­Ş_avruË_qu”y_­³nd_³rm
(
pŞicy
, 
acûssq
, (*)
	`­Ş_veùÜ_g‘_–em’t
(
d
->
acûss_³rms
, 
i
))) {

1741 
”rÜ
 = 
”ºo
;

1742 
”r
;

1745 
size_t
 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
loÿl_»suÉs
); ) {

1746 cÚ¡ *
’d_Çme
 = 
NULL
;

1747 
­Ş_domaš_Œªs_»suÉ_t
 *
»s
 = 
	`­Ş_veùÜ_g‘_–em’t
(
loÿl_»suÉs
, 
i
);

1748 ià(
	`qpŞ_ty³_g‘_Çme
(
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicy
), 
»s
->
’d_ty³
, &
’d_Çme
) ||

1749 
	`­Ş_avruË_qu”y_£t_sourû
(
pŞicy
, 
acûssq
, 
’d_Çme
, 1)) {

1750 
”rÜ
 = 
”ºo
;

1751 
”r
;

1753 
­Ş_veùÜ_t
 *
tmp_acûss
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
);

1754 
size_t
 
j
 = 0; j < 
num_©y³s
; j++) {

1755 ià(
­Ş_avruË_qu”y_£t_rg‘


1756 (
pŞicy
, 
acûssq
, (*)
	`­Ş_veùÜ_g‘_–em’t
(
d
->
acûss_ty³s
, 
j
), 1)) {

1757 
”rÜ
 = 
”ºo
;

1758 
	`­Ş_veùÜ_de¡roy
(&
tmp_acûss
);

1759 
”r
;

1761 
­Ş_veùÜ_t
 *
cur_tgt_v
 = 
NULL
;

1762 
	`­Ş_avruË_g‘_by_qu”y
(
pŞicy
, 
acûssq
, &
cur_tgt_v
);

1763 
	`­Ş_veùÜ_ÿt
(
tmp_acûss
, 
cur_tgt_v
);

1764 
	`­Ş_veùÜ_de¡roy
(&
cur_tgt_v
);

1766 ià(
	`­Ş_veùÜ_g‘_size
(
tmp_acûss
)) {

1767 
»s
->
acûss_ruËs
 = 
tmp_acûss
;

1768 
tmp_acûss
 = 
NULL
;

1769 
i
++;

1771 
	`­Ş_veùÜ_»move
(
loÿl_»suÉs
, 
i
);

1772 
	`domaš_Œªs_»suÉ_ä“
(
»s
);

1774 
	`­Ş_veùÜ_de¡roy
(&
tmp_acûss
);

1776 
	`­Ş_avruË_qu”y_de¡roy
(&
acûssq
);

1779 *
»suÉs
 = 
	`­Ş_veùÜ_ü—‹
(
domaš_Œªs_»suÉ_ä“
);

1780 ià(!(*
»suÉs
)) {

1781 
”rÜ
 = 
”ºo
;

1782 
”r
;

1784 
size_t
 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
loÿl_»suÉs
); i++) {

1785 
­Ş_domaš_Œªs_»suÉ_t
 *
»s
 =

1786 
	`­Ş_domaš_Œªs_»suÉ_ü—‹_äom_domaš_Œªs_»suÉ
((
­Ş_domaš_Œªs_»suÉ_t
 *)

1787 
	`­Ş_veùÜ_g‘_–em’t
(
loÿl_»suÉs
, 
i
));

1788 ià(!
»s
 || 
	`­Ş_veùÜ_­³nd
(*
»suÉs
, (*)res)) {

1789 
”rÜ
 = 
”ºo
;

1790 
	`domaš_Œªs_»suÉ_ä“
(
»s
);

1791 
”r
;

1794 
	`­Ş_veùÜ_de¡roy
(&
loÿl_»suÉs
);

1797 
”r
:

1798 
	`­Ş_veùÜ_de¡roy
(&
loÿl_»suÉs
);

1799 
	`­Ş_veùÜ_de¡roy
(
»suÉs
);

1800 
	`­Ş_avruË_qu”y_de¡roy
(&
acûssq
);

1801 
”ºo
 = 
”rÜ
;

1803 
	}
}

1807 cÚ¡ 
qpŞ_ty³_t
 *
	$­Ş_domaš_Œªs_»suÉ_g‘_¡¬t_ty³
(cÚ¡ 
­Ş_domaš_Œªs_»suÉ_t
 * 
dŒ
)

1809 ià(
dŒ
) {

1810  
dŒ
->
¡¬t_ty³
;

1812 
”ºo
 = 
EINVAL
;

1813  
NULL
;

1815 
	}
}

1817 cÚ¡ 
qpŞ_ty³_t
 *
	$­Ş_domaš_Œªs_»suÉ_g‘_’Œypošt_ty³
(cÚ¡ 
­Ş_domaš_Œªs_»suÉ_t
 * 
dŒ
)

1819 ià(
dŒ
) {

1820  
dŒ
->
•_ty³
;

1822 
”ºo
 = 
EINVAL
;

1823  
NULL
;

1825 
	}
}

1827 cÚ¡ 
qpŞ_ty³_t
 *
	$­Ş_domaš_Œªs_»suÉ_g‘_’d_ty³
(cÚ¡ 
­Ş_domaš_Œªs_»suÉ_t
 * 
dŒ
)

1829 ià(
dŒ
) {

1830  
dŒ
->
’d_ty³
;

1832 
”ºo
 = 
EINVAL
;

1833  
NULL
;

1835 
	}
}

1837 cÚ¡ 
­Ş_veùÜ_t
 *
	$­Ş_domaš_Œªs_»suÉ_g‘_´oc_Œªs_ruËs
(cÚ¡ 
­Ş_domaš_Œªs_»suÉ_t
 * 
dŒ
)

1839 ià(
dŒ
) {

1840  
dŒ
->
´oc_Œªs_ruËs
;

1842 
”ºo
 = 
EINVAL
;

1843  
NULL
;

1845 
	}
}

1847 cÚ¡ 
­Ş_veùÜ_t
 *
	$­Ş_domaš_Œªs_»suÉ_g‘_’Œypošt_ruËs
(cÚ¡ 
­Ş_domaš_Œªs_»suÉ_t
 * 
dŒ
)

1849 ià(
dŒ
) {

1850  
dŒ
->
•_ruËs
;

1852 
”ºo
 = 
EINVAL
;

1853  
NULL
;

1855 
	}
}

1857 cÚ¡ 
­Ş_veùÜ_t
 *
	$­Ş_domaš_Œªs_»suÉ_g‘_exec_ruËs
(cÚ¡ 
­Ş_domaš_Œªs_»suÉ_t
 * 
dŒ
)

1859 ià(
dŒ
) {

1860  
dŒ
->
exec_ruËs
;

1862 
”ºo
 = 
EINVAL
;

1863  
NULL
;

1865 
	}
}

1867 cÚ¡ 
­Ş_veùÜ_t
 *
	$­Ş_domaš_Œªs_»suÉ_g‘_£‹xec_ruËs
(cÚ¡ 
­Ş_domaš_Œªs_»suÉ_t
 * 
dŒ
)

1869 ià(
dŒ
) {

1870  
dŒ
->
£‹xec_ruËs
;

1872 
”ºo
 = 
EINVAL
;

1873  
NULL
;

1875 
	}
}

1877 cÚ¡ 
­Ş_veùÜ_t
 *
	$­Ş_domaš_Œªs_»suÉ_g‘_ty³_Œªs_ruËs
(cÚ¡ 
­Ş_domaš_Œªs_»suÉ_t
 * 
dŒ
)

1879 ià(
dŒ
) {

1880  
dŒ
->
ty³_Œªs_ruËs
;

1882 
”ºo
 = 
EINVAL
;

1883  
NULL
;

1885 
	}
}

1887 
	$­Ş_domaš_Œªs_»suÉ_is_Œªs_v®id
(cÚ¡ 
­Ş_domaš_Œªs_»suÉ_t
 * 
dŒ
)

1889 ià(
dŒ
) {

1890  
dŒ
->
v®id
;

1892 
”ºo
 = 
EINVAL
;

1895 
	}
}

1897 cÚ¡ 
­Ş_veùÜ_t
 *
	$­Ş_domaš_Œªs_»suÉ_g‘_acûss_ruËs
(cÚ¡ 
­Ş_domaš_Œªs_»suÉ_t
 * 
dŒ
)

1899 ià(
dŒ
) {

1900  
dŒ
->
acûss_ruËs
;

1902 
”ºo
 = 
EINVAL
;

1903  
NULL
;

1905 
	}
}

1907 
	$­Ş_domaš_Œªs_bË_v”ify_Œªs
(
­Ş_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_ty³_t
 * 
¡¬t_dom
, cÚ¡ qpŞ_ty³_ˆ* 
•_ty³
,

1908 cÚ¡ 
qpŞ_ty³_t
 * 
’d_dom
)

1910 
missšg_ruËs
 = 0;

1912 ià(!
pŞicy
 || !pŞicy->
domaš_Œªs_bË
) {

1913 
”ºo
 = 
EINVAL
;

1917 
	`­Ş_pŞicy_»£t_domaš_Œªs_bË
(
pŞicy
);

1919 
dom_node_t
 
¡¬t_dummy
 = { 
¡¬t_dom
, 
NULL
, NULL, NULL };

1920 
dom_node_t
 *
¡¬t_node
 = 
NULL
;

1921 ià(
¡¬t_dom
)

1922 
	`­Ş_b¡_g‘_–em’t
(
pŞicy
->
domaš_Œªs_bË
->
domaš_bË
, (*)&
¡¬t_dummy
, 
NULL
, (**)&
¡¬t_node
);

1923 
•_node_t
 
•_dummy
 = { 
•_ty³
, 
NULL
, NULL };

1924 
•_node_t
 *
•_node
 = 
NULL
;

1925 ià(
•_ty³
)

1926 
	`­Ş_b¡_g‘_–em’t
(
pŞicy
->
domaš_Œªs_bË
->
’Œypošt_bË
, (*)&
•_dummy
, 
NULL
, (**)&
•_node
);

1927 
dom_node_t
 
’d_dummy
 = { 
’d_dom
, 
NULL
, NULL, NULL };

1928 
dom_node_t
 *
’d_node
 = 
NULL
;

1929 ià(
’d_dom
)

1930 
	`­Ş_b¡_g‘_–em’t
(
pŞicy
->
domaš_Œªs_bË
->
domaš_bË
, (*)&
’d_dummy
, 
NULL
, (**)&
’d_node
);

1932 
boŞ
 
‰
 = 
çl£
, 
sx
 = f®£, 
ex
 = f®£, 
±
 = f®£, 
•
 = false;

1935 ià(
¡¬t_node
 && 
’d_dom
) {

1936 
­Ş_veùÜ_t
 *
v
 = 
	`fšd_avruËs_š_node
(
¡¬t_node
, 
APOL_DOMAIN_TRANS_RULE_PROC_TRANS
, 
’d_dom
);

1937 ià(
	`­Ş_veùÜ_g‘_size
(
v
))

1938 
±
 = 
Œue
;

1939 
	`­Ş_veùÜ_de¡roy
(&
v
);

1942 ià(
¡¬t_dom
 && 
•_node
) {

1943 
­Ş_veùÜ_t
 *
v
 = 
	`fšd_avruËs_š_node
(
•_node
, 
APOL_DOMAIN_TRANS_RULE_EXEC
, 
¡¬t_dom
);

1944 ià(
	`­Ş_veùÜ_g‘_size
(
v
))

1945 
ex
 = 
Œue
;

1946 
	`­Ş_veùÜ_de¡roy
(&
v
);

1949 ià(
’d_node
 && 
•_ty³
) {

1950 
­Ş_veùÜ_t
 *
v
 = 
	`fšd_avruËs_š_node
(
’d_node
, 
APOL_DOMAIN_TRANS_RULE_ENTRYPOINT
, 
•_ty³
);

1951 ià(
	`­Ş_veùÜ_g‘_size
(
v
))

1952 
•
 = 
Œue
;

1953 
	`­Ş_veùÜ_de¡roy
(&
v
);

1955 ià(
	`»quœes_£‹xec_Ü_ty³_Œªs
(
pŞicy
)) {

1957 ià(
¡¬t_node
)

1958 ià(
	`­Ş_veùÜ_g‘_size
(
¡¬t_node
->
£‹xec_ruËs
))

1959 
sx
 = 
Œue
;

1961 ià(
•_node
 && 
¡¬t_dom
 && 
’d_dom
) {

1962 
­Ş_veùÜ_t
 *
v
 = 
	`fšd_‹ruËs_š_node
(
•_node
, 
¡¬t_dom
, 
’d_dom
);

1963 ià(
	`­Ş_veùÜ_g‘_size
(
v
)) {

1964 
‰
 = 
Œue
;

1966 
	`­Ş_veùÜ_de¡roy
(&
v
);

1970 
‰
 = 
sx
 = 
Œue
;

1973 ià(!(
±
 && 
•
 && 
ex
 && (
‰
 || 
sx
))) {

1974 ià(!
±
)

1975 
missšg_ruËs
 |ğ
APOL_DOMAIN_TRANS_RULE_PROC_TRANS
;

1976 ià(!
•
)

1977 
missšg_ruËs
 |ğ
APOL_DOMAIN_TRANS_RULE_ENTRYPOINT
;

1978 ià(!
ex
)

1979 
missšg_ruËs
 |ğ
APOL_DOMAIN_TRANS_RULE_EXEC
;

1980 ià(!
‰
 && !
sx
) {

1981 
missšg_ruËs
 |ğ
APOL_DOMAIN_TRANS_RULE_SETEXEC
;

1983 cÚ¡ *
¡¬t_Çme
 = 
NULL
, *
’d_Çme
 = NULL;

1984 
	`qpŞ_ty³_g‘_Çme
(
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicy
), 
¡¬t_dom
, &
¡¬t_Çme
);

1985 
	`qpŞ_ty³_g‘_Çme
(
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicy
), 
’d_dom
, &
’d_Çme
);

1986 
­Ş_‹ruË_qu”y_t
 *
tq
 = 
NULL
;

1987 ià(!
¡¬t_Çme
 || !
’d_Çme
 || !(
tq
 = 
	`­Ş_‹ruË_qu”y_ü—‹
())) {

1990 
	`­Ş_‹ruË_qu”y_£t_ruËs
(
pŞicy
, 
tq
, 
QPOL_RULE_TYPE_TRANS
);

1991 
	`­Ş_‹ruË_qu”y_£t_sourû
(
pŞicy
, 
tq
, 
¡¬t_Çme
, 1);

1992 
	`­Ş_‹ruË_qu”y_£t_deçuÉ
(
pŞicy
, 
tq
, 
’d_Çme
);

1993 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

1994 ià(
	`­Ş_‹ruË_g‘_by_qu”y
(
pŞicy
, 
tq
, &
v
)) {

1995 
	`­Ş_‹ruË_qu”y_de¡roy
(&
tq
);

1998 
	`­Ş_‹ruË_qu”y_de¡roy
(&
tq
);

1999 ià(!
	`­Ş_veùÜ_g‘_size
(
v
))

2000 
missšg_ruËs
 |ğ
APOL_DOMAIN_TRANS_RULE_TYPE_TRANS
;

2001 
	`­Ş_veùÜ_de¡roy
(&
v
);

2005  
missšg_ruËs
;

2006 
	}
}

2008 
­Ş_domaš_Œªs_»suÉ_t
 *
	$­Ş_domaš_Œªs_»suÉ_ü—‹_äom_domaš_Œªs_»suÉ
(cÚ¡ 
­Ş_domaš_Œªs_»suÉ_t
 * 
»suÉ
)

2010 
­Ş_domaš_Œªs_»suÉ_t
 *
Ãw_r
 = 
NULL
;

2011 
»tv®
 = -1;

2012 ià((
Ãw_r
 = 
	`ÿÎoc
(1, (*Ãw_r))è=ğ
NULL
) {

2013 
ş—nup
;

2015 ià(
»suÉ
->
´oc_Œªs_ruËs
 !ğ
NULL
 &&

2016 (
Ãw_r
->
´oc_Œªs_ruËs
 = 
	`­Ş_veùÜ_ü—‹_äom_veùÜ
(
»suÉ
->´oc_Œªs_ruËs, 
NULL
, NULL, NULL)) == NULL) {

2017 
ş—nup
;

2019 ià(
»suÉ
->
•_ruËs
 !ğ
NULL


2020 && (
Ãw_r
->
•_ruËs
 = 
	`­Ş_veùÜ_ü—‹_äom_veùÜ
(
»suÉ
->•_ruËs, 
NULL
, NULL, NULL)) == NULL) {

2021 
ş—nup
;

2023 ià(
»suÉ
->
exec_ruËs
 !ğ
NULL


2024 && (
Ãw_r
->
exec_ruËs
 = 
	`­Ş_veùÜ_ü—‹_äom_veùÜ
(
»suÉ
->exec_ruËs, 
NULL
, NULL, NULL)) == NULL) {

2025 
ş—nup
;

2027 ià(
»suÉ
->
£‹xec_ruËs
 !ğ
NULL


2028 && (
Ãw_r
->
£‹xec_ruËs
 = 
	`­Ş_veùÜ_ü—‹_äom_veùÜ
(
»suÉ
->£‹xec_ruËs, 
NULL
, NULL, NULL)) == NULL) {

2029 
ş—nup
;

2031 ià(
»suÉ
->
ty³_Œªs_ruËs
 !ğ
NULL
 &&

2032 (
Ãw_r
->
ty³_Œªs_ruËs
 = 
	`­Ş_veùÜ_ü—‹_äom_veùÜ
(
»suÉ
->ty³_Œªs_ruËs, 
NULL
, NULL, NULL)) == NULL) {

2033 
ş—nup
;

2035 ià(
»suÉ
->
acûss_ruËs
 !ğ
NULL


2036 && (
Ãw_r
->
acûss_ruËs
 = 
	`­Ş_veùÜ_ü—‹_äom_veùÜ
(
»suÉ
->acûss_ruËs, 
NULL
, NULL, NULL)) == NULL) {

2037 
ş—nup
;

2039 
Ãw_r
->
¡¬t_ty³
 = 
»suÉ
->start_type;

2040 
Ãw_r
->
•_ty³
 = 
»suÉ
->ep_type;

2041 
Ãw_r
->
’d_ty³
 = 
»suÉ
->end_type;

2042 
Ãw_r
->
v®id
 = 
»suÉ
->valid;

2043 
»tv®
 = 0;

2044 
ş—nup
:

2045 ià(
»tv®
 != 0) {

2046 
	`domaš_Œªs_»suÉ_ä“
(
Ãw_r
);

2047  
NULL
;

2049  
Ãw_r
;

2050 
	}
}

2054 
	$domaš_Œªs_»suÉ_ä“
(*
dŒ
)

2056 
­Ş_domaš_Œªs_»suÉ_t
 *
»s
 = (­Ş_domaš_Œªs_»suÉ_ˆ*è
dŒ
;

2058 ià(!
»s
)

2061 
	`­Ş_veùÜ_de¡roy
(&
»s
->
´oc_Œªs_ruËs
);

2062 
	`­Ş_veùÜ_de¡roy
(&
»s
->
•_ruËs
);

2063 
	`­Ş_veùÜ_de¡roy
(&
»s
->
exec_ruËs
);

2064 
	`­Ş_veùÜ_de¡roy
(&
»s
->
£‹xec_ruËs
);

2065 
	`­Ş_veùÜ_de¡roy
(&
»s
->
ty³_Œªs_ruËs
);

2066 
	`­Ş_veùÜ_de¡roy
(&
»s
->
acûss_ruËs
);

2067 
	`ä“
(
»s
);

2068 
	}
}

2070 
	$­Ş_domaš_Œªs_»suÉ_de¡roy
(
­Ş_domaš_Œªs_»suÉ_t
 ** 
»s
)

2072 ià(!
»s
 || !(*res))

2074 
	`domaš_Œªs_»suÉ_ä“
((*)*
»s
);

2075 *
»s
 = 
NULL
;

2076 
	}
}

	@libapol/src/fscon-query.c

31 
	~"pŞicy-qu”y-š‹º®.h
"

32 
	~<­Ş/»nd”.h
>

34 
	~<”ºo.h
>

35 
	~<¡dio.h
>

36 
	~<¡dboŞ.h
>

38 
	s­Ş_g’fscÚ_qu”y


40 *
	mfs
, *
	m·th
;

41 
ušt32_t
 
	mobjşass
;

42 
boŞ
 
	mobjşass_£t
;

43 
­Ş_cÚ‹xt_t
 *
	mcÚ‹xt
;

44 
	mæags
;

47 
	s­Ş_fs_u£_qu”y


49 *
	mfs
;

50 
ušt32_t
 
	mbehaviÜ
;

51 
boŞ
 
	mbehaviÜ_£t
;

52 
­Ş_cÚ‹xt_t
 *
	mcÚ‹xt
;

53 
	mæags
;

58 
	$­Ş_g’fscÚ_g‘_by_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
­Ş_g’fscÚ_qu”y_t
 * 
g
, 
­Ş_veùÜ_t
 ** 
v
)

60 
qpŞ_™”©Ü_t
 *
™”
;

61 
»tv®
 = -1, 
»tv®2
;

62 
qpŞ_g’fscÚ_t
 *
g’fscÚ
 = 
NULL
;

63 *
v
 = 
NULL
;

64 ià(
	`qpŞ_pŞicy_g‘_g’fscÚ_™”
(
p
->p, &
™”
) < 0) {

67 ià((*
v
 = 
	`­Ş_veùÜ_ü—‹
(
ä“
)è=ğ
NULL
) {

68 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

69 
ş—nup
;

71 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

72 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
g’fscÚ
) < 0) {

73 
ş—nup
;

75 ià(
g
 !ğ
NULL
) {

76 cÚ¡ *
fs
, *
·th
;

77 
ušt32_t
 
objşass
;

78 cÚ¡ 
qpŞ_cÚ‹xt_t
 *
cÚ‹xt
;

79 ià(
	`qpŞ_g’fscÚ_g‘_Çme
(
p
->p, 
g’fscÚ
, &
fs
) < 0 ||

80 
	`qpŞ_g’fscÚ_g‘_·th
(
p
->p, 
g’fscÚ
, &
·th
) < 0 ||

81 
	`qpŞ_g’fscÚ_g‘_şass
(
p
->p, 
g’fscÚ
, &
objşass
) < 0 ||

82 
	`qpŞ_g’fscÚ_g‘_cÚ‹xt
(
p
->p, 
g’fscÚ
, &
cÚ‹xt
) < 0) {

83 
ş—nup
;

85 
»tv®2
 = 
	`­Ş_com·»
(
p
, 
fs
, 
g
->fs, 0, 
NULL
);

86 ià(
»tv®2
 < 0) {

87 
ş—nup
;

88 } ià(
»tv®2
 == 0) {

89 
	`ä“
(
g’fscÚ
);

92 
»tv®2
 = 
	`­Ş_com·»
(
p
, 
·th
, 
g
->·th, 0, 
NULL
);

93 ià(
»tv®2
 < 0) {

94 
ş—nup
;

95 } ià(
»tv®2
 == 0) {

96 
	`ä“
(
g’fscÚ
);

99 ià(
g
->
objşass_£t
 && g->
objşass
 != objclass) {

100 
	`ä“
(
g’fscÚ
);

103 
»tv®2
 = 
	`­Ş_com·»_cÚ‹xt
(
p
, 
cÚ‹xt
, 
g
->cÚ‹xt, g->
æags
);

104 ià(
»tv®2
 < 0) {

105 
ş—nup
;

106 } ià(
»tv®2
 == 0) {

107 
	`ä“
(
g’fscÚ
);

111 ià(
	`­Ş_veùÜ_­³nd
(*
v
, 
g’fscÚ
)) {

112 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
EINVAL
));

113 
ş—nup
;

117 
»tv®
 = 0;

118 
ş—nup
:

119 ià(
»tv®
 != 0) {

120 
	`­Ş_veùÜ_de¡roy
(
v
);

121 
	`ä“
(
g’fscÚ
);

123 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

124  
»tv®
;

125 
	}
}

127 
­Ş_g’fscÚ_qu”y_t
 *
	$­Ş_g’fscÚ_qu”y_ü—‹
()

129 
­Ş_g’fscÚ_qu”y_t
 *
g
 = 
	`ÿÎoc
(1, (apol_genfscon_query_t));

130 ià(
g
 !ğ
NULL
) {

131 
g
->
objşass
 = -1;

133  
g
;

134 
	}
}

136 
	$­Ş_g’fscÚ_qu”y_de¡roy
(
­Ş_g’fscÚ_qu”y_t
 ** 
g
)

138 ià(*
g
 !ğ
NULL
) {

139 
	`ä“
((*
g
)->
fs
);

140 
	`ä“
((*
g
)->
·th
);

141 
	`­Ş_cÚ‹xt_de¡roy
(&((*
g
)->
cÚ‹xt
));

142 
	`ä“
(*
g
);

143 *
g
 = 
NULL
;

145 
	}
}

147 
	$­Ş_g’fscÚ_qu”y_£t_fesy¡em
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_g’fscÚ_qu”y_t
 * 
g
, cÚ¡ *
fs
)

149  
	`­Ş_qu”y_£t
(
p
, &
g
->
fs
, 
NULL
, fs);

150 
	}
}

152 
	$­Ş_g’fscÚ_qu”y_£t_·th
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_g’fscÚ_qu”y_t
 * 
g
, cÚ¡ *
·th
)

154 
tmp
 = 
	`­Ş_qu”y_£t
(
p
, &
g
->
·th
, 
NULL
,…ath);

155 ià(!
tmp
 && 
g
->
·th
) {

156 ià(
	`¡¾’
(
g
->
·th
) > 1 && g->path[strlen(g->path) - 1] == '/')

157 
g
->
·th
[
	`¡¾’
(g->path) - 1] = 0;

159  
tmp
;

160 
	}
}

162 
	$­Ş_g’fscÚ_qu”y_£t_objşass
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_g’fscÚ_qu”y_t
 * 
g
, 
objşass
)

164 ià(
objşass
 < 0) {

165 
g
->
objşass
 = 0;

166 
g
->
objşass_£t
 = 
çl£
;

168 
objşass
) {

169 
QPOL_CLASS_BLK_FILE
:

170 
QPOL_CLASS_CHR_FILE
:

171 
QPOL_CLASS_DIR
:

172 
QPOL_CLASS_FIFO_FILE
:

173 
QPOL_CLASS_FILE
:

174 
QPOL_CLASS_LNK_FILE
:

175 
QPOL_CLASS_SOCK_FILE
:

176 
QPOL_CLASS_ALL
:

178 
g
->
objşass
 = objclass;

179 
g
->
objşass_£t
 = 
Œue
;

183 
	`ERR
(
p
, "%s", "Invalid object class given.");

188 
	}
}

190 
­Ş_g’fscÚ_qu”y_£t_cÚ‹xt
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
 
__©Œibu‹__
 ((
unu£d
)),

191 
­Ş_g’fscÚ_qu”y_t
 * 
g
, 
­Ş_cÚ‹xt_t
 * 
cÚ‹xt
, 
¿nge_m©ch
)

193 ià(
	gg
->
	gcÚ‹xt
 !ğ
NULL
) {

194 
­Ş_cÚ‹xt_de¡roy
(&
g
->
cÚ‹xt
);

196 
	gg
->
	gcÚ‹xt
 = 
cÚ‹xt
;

197 
	gg
->
	gæags
 = (
g
->
æags
 & ~
APOL_QUERY_FLAGS
è| 
¿nge_m©ch
;

201 *
	$­Ş_g’fscÚ_»nd”
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
qpŞ_g’fscÚ_t
 * 
g’fscÚ
)

203 *
lše
 = 
NULL
, *
»tv®
 = NULL;

204 cÚ¡ 
qpŞ_cÚ‹xt_t
 *
ùxt
 = 
NULL
;

205 *
cÚ‹xt_¡r
 = 
NULL
;

206 cÚ¡ *
ty³_¡r
 = 
NULL
;

207 cÚ¡ *
Çme
 = 
NULL
, *
·th
 = NULL;

208 
ušt32_t
 
fşass
;

210 ià(!
g’fscÚ
 || !
p
)

211 
ş—nup
;

213 ià(
	`qpŞ_g’fscÚ_g‘_Çme
(
p
->p, 
g’fscÚ
, &
Çme
))

214 
ş—nup
;

215 ià(
	`qpŞ_g’fscÚ_g‘_·th
(
p
->p, 
g’fscÚ
, &
·th
))

216 
ş—nup
;

217 ià(
	`qpŞ_g’fscÚ_g‘_şass
(
p
->p, 
g’fscÚ
, &
fşass
))

218  
NULL
;

219 ià(
	`qpŞ_g’fscÚ_g‘_cÚ‹xt
(
p
->p, 
g’fscÚ
, &
ùxt
))

220 
ş—nup
;

222 
fşass
) {

223 
QPOL_CLASS_DIR
:

224 
ty³_¡r
 = " -d ";

226 
QPOL_CLASS_CHR_FILE
:

227 
ty³_¡r
 = " -c ";

229 
QPOL_CLASS_BLK_FILE
:

230 
ty³_¡r
 = " -b ";

232 
QPOL_CLASS_FILE
:

233 
ty³_¡r
 = " -- ";

235 
QPOL_CLASS_FIFO_FILE
:

236 
ty³_¡r
 = " -p ";

238 
QPOL_CLASS_LNK_FILE
:

239 
ty³_¡r
 = " -l ";

241 
QPOL_CLASS_SOCK_FILE
:

242 
ty³_¡r
 = " -s ";

244 
QPOL_CLASS_ALL
:

245 
ty³_¡r
 = " ";

248 
ş—nup
;

251 
cÚ‹xt_¡r
 = 
	`­Ş_qpŞ_cÚ‹xt_»nd”
(
p
, 
ùxt
);

252 ià(!
cÚ‹xt_¡r
)

253 
ş—nup
;

255 ià(
	`a¥rštf
(&
lše
, "g’fscÚ % % % %s", 
Çme
, 
·th
, 
ty³_¡r
, 
cÚ‹xt_¡r
) < 0) {

256 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

257 
ş—nup
;

259 
»tv®
 = 
lše
;

260 
ş—nup
:

261 
	`ä“
(
cÚ‹xt_¡r
);

262 ià(
»tv®
 !ğ
lše
) {

263 
	`ä“
(
lše
);

265  
»tv®
;

266 
	}
}

270 
	$­Ş_fs_u£_g‘_by_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
­Ş_fs_u£_qu”y_t
 * 
f
, 
­Ş_veùÜ_t
 ** 
v
)

272 
qpŞ_™”©Ü_t
 *
™”
;

273 
»tv®
 = -1, 
»tv®2
;

274 cÚ¡ 
qpŞ_fs_u£_t
 *
fs_u£
 = 
NULL
;

275 *
v
 = 
NULL
;

276 ià(
	`qpŞ_pŞicy_g‘_fs_u£_™”
(
p
->p, &
™”
) < 0) {

279 ià((*
v
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)) == NULL) {

280 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

281 
ş—nup
;

283 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

284 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
fs_u£
) < 0) {

285 
ş—nup
;

287 ià(
f
 !ğ
NULL
) {

288 cÚ¡ *
fs
;

289 
ušt32_t
 
behaviÜ
;

290 cÚ¡ 
qpŞ_cÚ‹xt_t
 *
cÚ‹xt
 = 
NULL
;

291 ià(
	`qpŞ_fs_u£_g‘_Çme
(
p
->p, 
fs_u£
, &
fs
è< 0 || 
	`qpŞ_fs_u£_g‘_behaviÜ
Õ->p, fs_u£, &
behaviÜ
) < 0) {

292 
ş—nup
;

294 ià(
behaviÜ
 !ğ
QPOL_FS_USE_PSID
 && 
	`qpŞ_fs_u£_g‘_cÚ‹xt
(
p
->p, 
fs_u£
, &
cÚ‹xt
) < 0) {

295 
ş—nup
;

297 
»tv®2
 = 
	`­Ş_com·»
(
p
, 
fs
, 
f
->fs, 0, 
NULL
);

298 ià(
»tv®2
 < 0) {

299 
ş—nup
;

300 } ià(
»tv®2
 == 0) {

303 ià(
f
->
behaviÜ_£t
 && f->
behaviÜ
 != behavior) {

308 ià(
f
->
cÚ‹xt
 !ğ
NULL
 && 
behaviÜ
 =ğ
QPOL_FS_USE_PSID
) {

309 
»tv®2
 = 0;

311 
»tv®2
 = 
	`­Ş_com·»_cÚ‹xt
(
p
, 
cÚ‹xt
, 
f
->cÚ‹xt, f->
æags
);

312 ià(
»tv®2
 < 0) {

313 
ş—nup
;

316 ià(
»tv®2
 == 0) {

320 ià(
	`­Ş_veùÜ_­³nd
(*
v
, (*)
fs_u£
)) {

321 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
EINVAL
));

322 
ş—nup
;

326 
»tv®
 = 0;

327 
ş—nup
:

328 ià(
»tv®
 != 0) {

329 
	`­Ş_veùÜ_de¡roy
(
v
);

331 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

332  
»tv®
;

333 
	}
}

335 
­Ş_fs_u£_qu”y_t
 *
	$­Ş_fs_u£_qu”y_ü—‹
()

337 
­Ş_fs_u£_qu”y_t
 *
f
 = 
	`ÿÎoc
(1, (apol_fs_use_query_t));

338 ià(
f
 !ğ
NULL
) {

339 
f
->
behaviÜ
 = -1;

341  
f
;

342 
	}
}

344 
	$­Ş_fs_u£_qu”y_de¡roy
(
­Ş_fs_u£_qu”y_t
 ** 
f
)

346 ià(*
f
 !ğ
NULL
) {

347 
	`ä“
((*
f
)->
fs
);

348 
	`­Ş_cÚ‹xt_de¡roy
(&((*
f
)->
cÚ‹xt
));

349 
	`ä“
(*
f
);

350 *
f
 = 
NULL
;

352 
	}
}

354 
	$­Ş_fs_u£_qu”y_£t_fesy¡em
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_fs_u£_qu”y_t
 * 
f
, cÚ¡ *
fs
)

356  
	`­Ş_qu”y_£t
(
p
, &
f
->
fs
, 
NULL
, fs);

357 
	}
}

359 
	$­Ş_fs_u£_qu”y_£t_behaviÜ
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_fs_u£_qu”y_t
 * 
f
, 
behaviÜ
)

361 ià(
behaviÜ
 < 0) {

362 
f
->
behaviÜ
 = 0;

363 
f
->
behaviÜ_£t
 = 
çl£
;

365 
behaviÜ
) {

366 
QPOL_FS_USE_XATTR
:

367 
QPOL_FS_USE_TASK
:

368 
QPOL_FS_USE_TRANS
:

369 
QPOL_FS_USE_GENFS
:

370 
QPOL_FS_USE_NONE
:

371 
QPOL_FS_USE_PSID
:

373 
f
->
behaviÜ
 = behavior;

374 
f
->
behaviÜ_£t
 = 
Œue
;

378 
	`ERR
(
p
, "%s", "Invalid fs_use behavior given.");

383 
	}
}

385 
­Ş_fs_u£_qu”y_£t_cÚ‹xt
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
 
__©Œibu‹__
 ((
unu£d
)),

386 
­Ş_fs_u£_qu”y_t
 * 
f
, 
­Ş_cÚ‹xt_t
 * 
cÚ‹xt
, 
¿nge_m©ch
)

388 ià(
	gf
->
	gcÚ‹xt
 !ğ
NULL
) {

389 
­Ş_cÚ‹xt_de¡roy
(&
f
->
cÚ‹xt
);

391 
	gf
->
	gcÚ‹xt
 = 
cÚ‹xt
;

392 
	gf
->
	gæags
 = (
f
->
æags
 & ~
APOL_QUERY_FLAGS
è| 
¿nge_m©ch
;

396 *
	$­Ş_fs_u£_»nd”
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
qpŞ_fs_u£_t
 * 
fsu£
)

398 *
cÚ‹xt_¡r
 = 
NULL
;

399 *
lše
 = 
NULL
, *
»tv®
 = NULL;

400 cÚ¡ *
behaviÜ_¡r
 = 
NULL
;

401 cÚ¡ *
f¢ame
 = 
NULL
;

402 cÚ¡ 
qpŞ_cÚ‹xt_t
 *
ùxt
 = 
NULL
;

403 
ušt32_t
 
behaviÜ
;

405 ià(
	`qpŞ_fs_u£_g‘_behaviÜ
(
p
->p, 
fsu£
, &
behaviÜ
))

406 
ş—nup
;

407 ià((
behaviÜ_¡r
 = 
	`­Ş_fs_u£_behaviÜ_to_¡r
(
behaviÜ
)è=ğ
NULL
) {

408 
	`ERR
(
p
, "%s", "Could‚ot get behavior string.");

409 
ş—nup
;

412 ià(
	`qpŞ_fs_u£_g‘_Çme
(
p
->p, 
fsu£
, &
f¢ame
))

413 
ş—nup
;

415 ià(
behaviÜ
 =ğ
QPOL_FS_USE_PSID
) {

416 
cÚ‹xt_¡r
 = 
	`¡rdup
("");

418 ià(
	`qpŞ_fs_u£_g‘_cÚ‹xt
(
p
->p, 
fsu£
, &
ùxt
))

419 
ş—nup
;

420 
cÚ‹xt_¡r
 = 
	`­Ş_qpŞ_cÚ‹xt_»nd”
(
p
, 
ùxt
);

421 ià(!
cÚ‹xt_¡r
) {

422 
ş—nup
;

425 ià(
	`a¥rštf
(&
lše
, "% % %s", 
behaviÜ_¡r
, 
f¢ame
, 
cÚ‹xt_¡r
) < 0) {

426 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
EINVAL
));

427 
ş—nup
;

430 
»tv®
 = 
lše
;

431 
ş—nup
:

432 
	`ä“
(
cÚ‹xt_¡r
);

433 ià(
»tv®
 !ğ
lše
) {

434 
	`ä“
(
lše
);

436  
»tv®
;

437 
	}
}

	@libapol/src/ftrule-query.c

30 
	~"pŞicy-qu”y-š‹º®.h
"

32 
	~<”ºo.h
>

33 
	~<¡ršg.h
>

35 
	s­Ş_f’ame_Œªs_qu”y


37 *
	msourû
, *
	mrg‘
, *
	mdeçuÉ_ty³
, *
	mÇme
;

38 
­Ş_veùÜ_t
 *
	mşas£s
;

39 
	mæags
;

45 
	$­Ş_f’ame_Œªs_g‘_by_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
­Ş_f’ame_Œªs_qu”y_t
 * 
t
, 
­Ş_veùÜ_t
 ** 
v
)

47 
­Ş_veùÜ_t
 *
sourû_li¡
 = 
NULL
, *
rg‘_li¡
 = NULL, *
şass_li¡
 = NULL, *
deçuÉ_li¡
 = NULL;

48 
»tv®
 = -1, 
sourû_as_ªy
 = 0, 
is_»gex
 = 0;

49 *
v
 = 
NULL
;

50 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

52 ià(
t
 !ğ
NULL
) {

53 
is_»gex
 = 
t
->
æags
 & 
APOL_QUERY_REGEX
;

54 ià(
t
->
sourû
 !ğ
NULL
 &&

55 (
sourû_li¡
 =

56 
	`­Ş_qu”y_ü—‹_ÿndid©e_ty³_li¡
(
p
, 
t
->
sourû
, 
is_»gex
,

57 
t
->
æags
 & 
APOL_QUERY_SOURCE_INDIRECT
,

58 ((
t
->
æags
 & (
APOL_QUERY_SOURCE_TYPE
 | 
APOL_QUERY_SOURCE_ATTRIBUTE
)) /

59 
APOL_QUERY_SOURCE_TYPE
))è=ğ
NULL
) {

60 
ş—nup
;

63 ià((
t
->
æags
 & 
APOL_QUERY_SOURCE_AS_ANY
è&&->
sourû
 !ğ
NULL
) {

64 
deçuÉ_li¡
 = 
rg‘_li¡
 = 
sourû_li¡
;

65 
sourû_as_ªy
 = 1;

67 ià(
t
->
rg‘
 !ğ
NULL
 &&

68 (
rg‘_li¡
 =

69 
	`­Ş_qu”y_ü—‹_ÿndid©e_ty³_li¡
(
p
, 
t
->
rg‘
, 
is_»gex
,

70 
t
->
æags
 & 
APOL_QUERY_TARGET_INDIRECT
,

71 ((
t
->

72 
æags
 & (
APOL_QUERY_TARGET_TYPE
 | 
APOL_QUERY_TARGET_ATTRIBUTE
))

73 / 
APOL_QUERY_TARGET_TYPE
))è=ğ
NULL
) {

74 
ş—nup
;

76 ià(
t
->
deçuÉ_ty³
 !ğ
NULL
 &&

77 (
deçuÉ_li¡
 =

78 
	`­Ş_qu”y_ü—‹_ÿndid©e_ty³_li¡
(
p
, 
t
->
deçuÉ_ty³
, 
is_»gex
, 0,

79 
APOL_QUERY_SYMBOL_IS_TYPE
)è=ğ
NULL
) {

80 
ş—nup
;

83 ià(
t
->
şas£s
 !ğ
NULL
 &&

84 
	`­Ş_veùÜ_g‘_size
(
t
->
şas£s
) > 0 &&

85 (
şass_li¡
 = 
	`­Ş_qu”y_ü—‹_ÿndid©e_şass_li¡
(
p
, 
t
->
şas£s
)è=ğ
NULL
) {

86 
ş—nup
;

90 ià(
	`qpŞ_pŞicy_g‘_f’ame_Œªs_™”
(
p
->p, &
™”
) < 0) {

91 
ş—nup
;

94 ià((*
v
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)) == NULL) {

95 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

96 
ş—nup
;

99 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

100 
m©ch_sourû
 = 0, 
m©ch_rg‘
 = 0, 
m©ch_deçuÉ
 = 0;

101 
size_t
 
i
;

103 
qpŞ_f’ame_Œªs_t
 *
f’ame_Œªs
;

104 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
f’ame_Œªs
) < 0) {

105 
ş—nup
;

108 ià(
sourû_li¡
 =ğ
NULL
) {

109 
m©ch_sourû
 = 1;

111 cÚ¡ 
qpŞ_ty³_t
 *
sourû_ty³
;

112 ià(
	`qpŞ_f’ame_Œªs_g‘_sourû_ty³
(
p
->p, 
f’ame_Œªs
, &
sourû_ty³
) < 0) {

113 
ş—nup
;

115 ià(
	`­Ş_veùÜ_g‘_šdex
(
sourû_li¡
, 
sourû_ty³
, 
NULL
, NULL, &
i
) == 0) {

116 
m©ch_sourû
 = 1;

123 ià(!
sourû_as_ªy
 && !
m©ch_sourû
) {

127 ià(
rg‘_li¡
 =ğ
NULL
 || (
sourû_as_ªy
 && 
m©ch_sourû
)) {

128 
m©ch_rg‘
 = 1;

130 cÚ¡ 
qpŞ_ty³_t
 *
rg‘_ty³
;

131 ià(
	`qpŞ_f’ame_Œªs_g‘_rg‘_ty³
(
p
->p, 
f’ame_Œªs
, &
rg‘_ty³
) < 0) {

132 
ş—nup
;

134 ià(
	`­Ş_veùÜ_g‘_šdex
(
rg‘_li¡
, 
rg‘_ty³
, 
NULL
, NULL, &
i
) == 0) {

135 
m©ch_rg‘
 = 1;

139 ià(!
sourû_as_ªy
 && !
m©ch_rg‘
) {

143 ià(
deçuÉ_li¡
 =ğ
NULL
 || (
sourû_as_ªy
 && 
m©ch_sourû
è|| (sourû_as_ªy && 
m©ch_rg‘
)) {

144 
m©ch_deçuÉ
 = 1;

146 cÚ¡ 
qpŞ_ty³_t
 *
deçuÉ_ty³
;

147 ià(
	`qpŞ_f’ame_Œªs_g‘_deçuÉ_ty³
(
p
->p, 
f’ame_Œªs
, &
deçuÉ_ty³
) < 0) {

148 
ş—nup
;

150 ià(
	`­Ş_veùÜ_g‘_šdex
(
deçuÉ_li¡
, 
deçuÉ_ty³
, 
NULL
, NULL, &
i
) == 0) {

151 
m©ch_deçuÉ
 = 1;

155 ià(!
sourû_as_ªy
 && !
m©ch_deçuÉ
) {

159 ià(
sourû_as_ªy
 && (!
m©ch_sourû
 && !
m©ch_rg‘
 && !
m©ch_deçuÉ
)) {

163 ià(
şass_li¡
 !ğ
NULL
) {

164 cÚ¡ 
qpŞ_şass_t
 *
obj_şass
;

165 ià(
	`qpŞ_f’ame_Œªs_g‘_objeù_şass
(
p
->p, 
f’ame_Œªs
, &
obj_şass
) < 0) {

166 
ş—nup
;

168 ià(
	`­Ş_veùÜ_g‘_šdex
(
şass_li¡
, 
obj_şass
, 
NULL
, NULL, &
i
) < 0) {

173 ià(
	`­Ş_veùÜ_­³nd
(*
v
, 
f’ame_Œªs
)) {

174 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

175 
ş—nup
;

179 
»tv®
 = 0;

180 
ş—nup
:

181 ià(
»tv®
 != 0) {

182 
	`­Ş_veùÜ_de¡roy
(
v
);

184 
	`­Ş_veùÜ_de¡roy
(&
sourû_li¡
);

185 ià(!
sourû_as_ªy
) {

186 
	`­Ş_veùÜ_de¡roy
(&
rg‘_li¡
);

187 
	`­Ş_veùÜ_de¡roy
(&
deçuÉ_li¡
);

189 
	`­Ş_veùÜ_de¡roy
(&
şass_li¡
);

190 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

191  
»tv®
;

192 
	}
}

194 
­Ş_f’ame_Œªs_qu”y_t
 *
	$­Ş_f’ame_Œªs_qu”y_ü—‹
()

196 
­Ş_f’ame_Œªs_qu”y_t
 *
t
 = 
	`ÿÎoc
(1, (apol_filename_trans_query_t));

197 ià(
t
 !ğ
NULL
) {

198 
t
->
æags
 =

199 (
APOL_QUERY_SOURCE_TYPE
 | 
APOL_QUERY_SOURCE_ATTRIBUTE
 | 
APOL_QUERY_TARGET_TYPE
 |

200 
APOL_QUERY_TARGET_ATTRIBUTE
);

202  
t
;

203 
	}
}

205 
	$­Ş_f’ame_Œªs_qu”y_de¡roy
(
­Ş_f’ame_Œªs_qu”y_t
 ** 
t
)

207 ià(
t
 !ğ
NULL
 && *t != NULL) {

208 
	`ä“
((*
t
)->
sourû
);

209 
	`ä“
((*
t
)->
rg‘
);

210 
	`ä“
((*
t
)->
deçuÉ_ty³
);

211 
	`ä“
((*
t
)->
Çme
);

212 
	`­Ş_veùÜ_de¡roy
(&(*
t
)->
şas£s
);

213 
	`ä“
(*
t
);

214 *
t
 = 
NULL
;

216 
	}
}

218 
	$­Ş_f’ame_Œªs_qu”y_£t_sourû
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_f’ame_Œªs_qu”y_t
 * 
t
, cÚ¡ *
ty³
, 
is_šdœeù
)

220 
	`­Ş_qu”y_£t_æag
(
p
, &
t
->
æags
, 
is_šdœeù
, 
APOL_QUERY_SOURCE_INDIRECT
);

221  
	`­Ş_qu”y_£t
(
p
, &
t
->
sourû
, 
NULL
, 
ty³
);

222 
	}
}

226 
	$­Ş_f’ame_Œªs_qu”y_£t_rg‘
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_f’ame_Œªs_qu”y_t
 * 
t
, cÚ¡ *
ty³
, 
is_šdœeù
)

228 
	`­Ş_qu”y_£t_æag
(
p
, &
t
->
æags
, 
is_šdœeù
, 
APOL_QUERY_TARGET_INDIRECT
);

229  
	`­Ş_qu”y_£t
(
p
, &
t
->
rg‘
, 
NULL
, 
ty³
);

230 
	}
}

232 
	$­Ş_f’ame_Œªs_qu”y_£t_deçuÉ
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_f’ame_Œªs_qu”y_t
 * 
t
, cÚ¡ *
symbŞ
)

234  
	`­Ş_qu”y_£t
(
p
, &
t
->
deçuÉ_ty³
, 
NULL
, 
symbŞ
);

235 
	}
}

237 
	$­Ş_f’ame_Œªs_qu”y_­³nd_şass
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_f’ame_Œªs_qu”y_t
 * 
t
, cÚ¡ *
obj_şass
)

239 *
s
 = 
NULL
;

240 ià(
obj_şass
 =ğ
NULL
) {

241 
	`­Ş_veùÜ_de¡roy
(&
t
->
şas£s
);

242 } ià((
s
 = 
	`¡rdup
(
obj_şass
)è=ğ
NULL
 || (
t
->
şas£s
 =ğNULL && (t->şas£ ğ
	`­Ş_veùÜ_ü—‹
(
ä“
)) == NULL)

243 || 
	`­Ş_veùÜ_­³nd
(
t
->
şas£s
, 
s
) < 0) {

244 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

245 
	`ä“
(
s
);

249 
	}
}

251 
	$­Ş_f’ame_Œªs_qu”y_£t_Çme
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_f’ame_Œªs_qu”y_t
 * 
t
, cÚ¡ *
f’ame
)

253  
	`­Ş_qu”y_£t
(
p
, &
t
->
Çme
, 
NULL
, 
f’ame
);

254 
	}
}

256 
	$­Ş_f’ame_Œªs_qu”y_£t_sourû_ªy
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_f’ame_Œªs_qu”y_t
 * 
t
, 
is_ªy
)

258  
	`­Ş_qu”y_£t_æag
(
p
, &
t
->
æags
, 
is_ªy
, 
APOL_QUERY_SOURCE_AS_ANY
);

259 
	}
}

261 
	$­Ş_f’ame_Œªs_qu”y_£t_»gex
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_f’ame_Œªs_qu”y_t
 * 
t
, 
is_»gex
)

263  
	`­Ş_qu”y_£t_»gex
(
p
, &
t
->
æags
, 
is_»gex
);

264 
	}
}

266 *
	$­Ş_f’ame_Œªs_»nd”
(cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_f’ame_Œªs_t
 * 
f’ame_Œªs
)

268 *
tmp
 = 
NULL
;

269 cÚ¡ *
tmp_Çme
 = 
NULL
;

270 
”rÜ
 = 0;

271 
size_t
 
tmp_sz
 = 0;

272 cÚ¡ 
qpŞ_ty³_t
 *
ty³
 = 
NULL
;

273 cÚ¡ 
qpŞ_şass_t
 *
obj_şass
 = 
NULL
;

275 ià(!
pŞicy
 || !
f’ame_Œªs
) {

276 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

277 
”ºo
 = 
EINVAL
;

278  
NULL
;

282 ià(
	`qpŞ_f’ame_Œªs_g‘_sourû_ty³
(
pŞicy
->
p
, 
f’ame_Œªs
, &
ty³
)) {

283 
”rÜ
 = 
”ºo
;

284 
”r
;

286 ià(
	`qpŞ_ty³_g‘_Çme
(
pŞicy
->
p
, 
ty³
, &
tmp_Çme
)) {

287 
”rÜ
 = 
”ºo
;

288 
”r
;

290 ià(
	`­Ş_¡r_­³ndf
(&
tmp
, &
tmp_sz
, "ty³_Œªs™iÚ % ", 
tmp_Çme
)) {

291 
”rÜ
 = 
”ºo
;

292 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

293 
”r
;

297 ià(
	`qpŞ_f’ame_Œªs_g‘_rg‘_ty³
(
pŞicy
->
p
, 
f’ame_Œªs
, &
ty³
)) {

298 
”rÜ
 = 
”ºo
;

299 
”r
;

301 ià(
	`qpŞ_ty³_g‘_Çme
(
pŞicy
->
p
, 
ty³
, &
tmp_Çme
)) {

302 
”rÜ
 = 
”ºo
;

303 
”r
;

305 ià(
	`­Ş_¡r_­³ndf
(&
tmp
, &
tmp_sz
, "% : ", 
tmp_Çme
)) {

306 
”rÜ
 = 
”ºo
;

307 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

308 
”r
;

312 ià(
	`qpŞ_f’ame_Œªs_g‘_objeù_şass
(
pŞicy
->
p
, 
f’ame_Œªs
, &
obj_şass
)) {

313 
”rÜ
 = 
”ºo
;

314 
”r
;

316 ià(
	`qpŞ_şass_g‘_Çme
(
pŞicy
->
p
, 
obj_şass
, &
tmp_Çme
)) {

317 
”rÜ
 = 
”ºo
;

318 
”r
;

320 ià(
	`­Ş_¡r_­³ndf
(&
tmp
, &
tmp_sz
, "% ", 
tmp_Çme
)) {

321 
”rÜ
 = 
”ºo
;

322 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

323 
”r
;

327 ià(
	`qpŞ_f’ame_Œªs_g‘_deçuÉ_ty³
(
pŞicy
->
p
, 
f’ame_Œªs
, &
ty³
)) {

328 
”rÜ
 = 
”ºo
;

329 
”r
;

331 ià(
	`qpŞ_ty³_g‘_Çme
(
pŞicy
->
p
, 
ty³
, &
tmp_Çme
)) {

332 
”rÜ
 = 
”ºo
;

333 
”r
;

335 ià(
	`­Ş_¡r_­³ndf
(&
tmp
, &
tmp_sz
, "%s", 
tmp_Çme
)) {

336 
”rÜ
 = 
”ºo
;

337 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

338 
”r
;

342 ià(
	`qpŞ_f’ame_Œªs_g‘_f’ame
(
pŞicy
->
p
, 
f’ame_Œªs
, &
tmp_Çme
)) {

343 
”rÜ
 = 
”ºo
;

344 
”r
;

347 ià(
	`­Ş_¡r_­³ndf
(&
tmp
, &
tmp_sz
, " \"%s\";", 
tmp_Çme
)) {

348 
”rÜ
 = 
”ºo
;

349 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

350 
”r
;

353  
tmp
;

355 
”r
:

356 
	`ä“
(
tmp
);

357 
”ºo
 = 
”rÜ
;

358  
NULL
;

359 
	}
}

	@libapol/src/infoflow-analysis-internal.h

26 #iâdeà
APOL_INFOFLOW_ANALYSIS_INTERNAL_H


27 
	#APOL_INFOFLOW_ANALYSIS_INTERNAL_H


	)

38 
­Ş_šfoæow_»suÉ_t
 *
šfoæow_»suÉ_ü—‹_äom_šfoæow_»suÉ
(cÚ¡‡pŞ_šfoæow_»suÉ_ˆ* 
»suÉ
);

47 
šfoæow_»suÉ_ä“
(*
»suÉ
);

	@libapol/src/infoflow-analysis.c

25 
	~"pŞicy-qu”y-š‹º®.h
"

26 
	~"šfoæow-ª®ysis-š‹º®.h
"

27 
	~"queue.h
"

28 
	~<­Ş/b¡.h
>

29 
	~<­Ş/³rm-m­.h
>

31 
	~<as£¹.h
>

32 
	~<cÚfig.h
>

33 
	~<”ºo.h
>

34 
	~<lim™s.h
>

35 
	~<time.h
>

42 
	#APOL_INFOFLOW_NODE_SOURCE
 0x1

	)

43 
	#APOL_INFOFLOW_NODE_TARGET
 0x2

	)

48 
	#APOL_INFOFLOW_COLOR_WHITE
 0

	)

49 
	#APOL_INFOFLOW_COLOR_GREY
 1

	)

50 
	#APOL_INFOFLOW_COLOR_BLACK
 2

	)

51 
	#APOL_INFOFLOW_COLOR_RED
 3

	)

53 
­Ş_šfoæow_node
 
	t­Ş_šfoæow_node_t
;

54 
­Ş_šfoæow_edge
 
	t­Ş_šfoæow_edge_t
;

56 
	s­Ş_šfoæow_g¿ph


59 
­Ş_veùÜ_t
 *
	mnodes
;

61 
­Ş_veùÜ_t
 *
	medges
;

64 
­Ş_b¡_t
 *
	mnodes_b¡
;

66 
	mmode
, 
	mdœeùiÚ
;

67 
»gex_t
 *
	m»gex
;

71 
­Ş_veùÜ_t
 *
	mfu¹h”_¡¬t
;

74 
­Ş_veùÜ_t
 *
	mfu¹h”_’d
;

75 
size_t
 
	mcu¼’t_¡¬t
;

76 #ifdeà
HAVE_RAND_R


77 
	m£ed
;

81 
	s­Ş_šfoæow_node


83 cÚ¡ 
qpŞ_ty³_t
 *
	mty³
;

85 
	mnode_ty³
;

87 
­Ş_veùÜ_t
 *
	mš_edges
;

89 
­Ş_veùÜ_t
 *
	mout_edges
;

90 
	mcŞÜ
;

91 
­Ş_šfoæow_node_t
 *
	m·»Á
;

92 
	mdi¡ªû
;

95 
	s­Ş_šfoæow_edge


98 
­Ş_veùÜ_t
 *
	mruËs
;

100 
­Ş_šfoæow_node_t
 *
	m¡¬t_node
;

102 
­Ş_šfoæow_node_t
 *
	m’d_node
;

103 
	mËngth
;

118 
	s­Ş_šfoæow_ª®ysis


120 
	mmode
, 
	mdœeùiÚ
;

121 *
	mty³
, *
	m»suÉ
;

122 
­Ş_veùÜ_t
 *
	mš‹rmed
, *
	mşass_³rms
;

123 
	mmš_weight
;

131 
	s­Ş_šfoæow_»suÉ


133 cÚ¡ 
qpŞ_ty³_t
 *
	m¡¬t_ty³
, *
	m’d_ty³
;

135 
­Ş_veùÜ_t
 *
	m¡•s
;

136 
	mdœeùiÚ
;

137 
	mËngth
;

148 
	s­Ş_šfoæow_¡•


150 cÚ¡ 
qpŞ_ty³_t
 *
	m¡¬t_ty³
, *
	m’d_ty³
;

152 
­Ş_veùÜ_t
 *
	mruËs
;

153 
	mweight
;

163 
	$­Ş_šfoæow_¡•_ä“
(*
¡•
)

165 ià(
¡•
 !ğ
NULL
) {

166 
­Ş_šfoæow_¡•_t
 *
s
 = (­Ş_šfoæow_¡•_ˆ*è
¡•
;

167 
	`­Ş_veùÜ_de¡roy
(&
s
->
ruËs
);

168 
	`ä“
(
s
);

170 
	}
}

180 
	$­Ş_šfoæow_¤ªd
(
­Ş_šfoæow_g¿ph_t
 * 
g
)

182 #ifdeà
HAVE_RAND_R


183 
g
->
£ed
 = ()
	`time
(
NULL
);

185 
	`¤ªd
(()
	`time
(
NULL
));

187 
	}
}

199 
	$­Ş_šfoæow_¿nd
(
­Ş_šfoæow_g¿ph_t
 * 
g
)

201 #ifdeà
HAVE_RAND_R


202  
	`¿nd_r
(&
g
->
£ed
);

204  
	`¿nd
();

206 
	}
}

217 
	$­Ş_šfoæow_node_ä“
(*
d©a
)

219 
­Ş_šfoæow_node_t
 *
node
 = (­Ş_šfoæow_node_ˆ*è
d©a
;

220 ià(
node
 !ğ
NULL
) {

223 
	`­Ş_veùÜ_de¡roy
(&
node
->
š_edges
);

224 
	`­Ş_veùÜ_de¡roy
(&
node
->
out_edges
);

225 
	`ä“
(
node
);

227 
	}
}

229 
	s­Ş_šfoæow_node_key


231 cÚ¡ 
qpŞ_ty³_t
 *
	mty³
;

232 
	mnode_ty³
;

245 
­Ş_šfoæow_node_com·»
(cÚ¡ *
a
, cÚ¡ *
b
 
__©Œibu‹__
 ((
unu£d
)), *
d©a
)

247 
­Ş_šfoæow_node_t
 *
	gnode
 = (­Ş_šfoæow_node_ˆ*è
a
;

248 
­Ş_šfoæow_node_key
 *
	gkey
 = (­Ş_šfoæow_node_key *)
d©a
;

249 ià(
	gnode
->
	gty³
 !ğ
key
->
ty³
) {

250  ()((*)
node
->
ty³
 - (*)
key
->type);

252  
	gnode
->
	gnode_ty³
 - 
	gkey
->node_type;

269 
­Ş_šfoæow_node_t
 *
	$­Ş_šfoæow_g¿ph_ü—‹_node
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
,

270 
­Ş_šfoæow_g¿ph_t
 * 
g
, cÚ¡ 
qpŞ_ty³_t
 * 
ty³
, 
node_ty³
)

272 
­Ş_šfoæow_node_key
 
key
 = { 
ty³
, 
node_ty³
 };

273 
­Ş_šfoæow_node_t
 *
node
 = 
NULL
;

274 ià(
	`­Ş_b¡_g‘_–em’t
(
g
->
nodes_b¡
, 
NULL
, &
key
, (**)&
node
) == 0) {

275  
node
;

277 ià((
node
 = 
	`ÿÎoc
(1, (*node))è=ğ
NULL
 ||

278 (
node
->
š_edges
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)è=ğNULL || (node->
out_edges
 =‡pol_vector_create(NULL)) == NULL) {

279 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

280 
	`­Ş_šfoæow_node_ä“
(
node
);

281  
NULL
;

283 
node
->
ty³
 =ype;

284 
node
->
node_ty³
 =‚ode_type;

285 ià(
	`­Ş_b¡_š£¹
(
g
->
nodes_b¡
, 
node
, &
key
) != 0) {

286 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

287 
	`­Ş_šfoæow_node_ä“
(
node
);

288  
NULL
;

290  
node
;

291 
	}
}

311 
­Ş_veùÜ_t
 *
	$­Ş_šfoæow_g¿ph_ü—‹_nodes
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
,

312 
­Ş_šfoæow_g¿ph_t
 * 
g
, cÚ¡ 
qpŞ_ty³_t
 * 
ty³
, 
­Ş_b¡_t
 * 
ty³s
,

313 
node_ty³
)

315 
i§‰r
;

316 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

317 
­Ş_šfoæow_node_t
 *
node
 = 
NULL
;

318 ià(
	`qpŞ_ty³_g‘_i§‰r
(
p
->p, 
ty³
, &
i§‰r
) < 0) {

319  
NULL
;

321 ià(
i§‰r
 && 
g
->
mode
 !ğ
APOL_INFOFLOW_MODE_DIRECT
) {

322 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

323 
qpŞ_ty³_t
 *
t
;

324 
size_t
 
Ën
;

325 ià(
	`qpŞ_ty³_g‘_ty³_™”
(
p
->p, 
ty³
, &
™”
) < 0 ||

326 
	`qpŞ_™”©Ü_g‘_size
(
™”
, &
Ën
è< 0 || (
v
 = 
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
Ö’, 
NULL
)) == NULL) {

327 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

328 
	`­Ş_veùÜ_de¡roy
(&
v
);

329  
NULL
;

331 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

332 
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
t
);

333 *
»suÉ
;

334 ià(
ty³s
 !ğ
NULL
 && 
	`­Ş_b¡_g‘_–em’t
Ñy³s, 
t
, NULL, &
»suÉ
) < 0) {

337 ià((
node
 = 
	`­Ş_šfoæow_g¿ph_ü—‹_node
(
p
, 
g
, 
t
, 
node_ty³
)è=ğ
NULL
 || 
	`­Ş_veùÜ_­³nd
(
v
,‚ode) < 0) {

338 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

339 
	`­Ş_veùÜ_de¡roy
(&
v
);

340  
NULL
;

343 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

353 ià((
v
 = 
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(1, 
NULL
)) == NULL) {

354  
NULL
;

356 ià((
node
 = 
	`­Ş_šfoæow_g¿ph_ü—‹_node
(
p
, 
g
, 
ty³
, 
node_ty³
)è=ğ
NULL
 || 
	`­Ş_veùÜ_­³nd
(
v
,‚ode) < 0) {

357 
	`­Ş_veùÜ_de¡roy
(&
v
);

358  
NULL
;

361  
v
;

362 
	}
}

373 
	$­Ş_šfoæow_edge_ä“
(*
d©a
)

375 
­Ş_šfoæow_edge_t
 *
edge
 = (­Ş_šfoæow_edge_ˆ*è
d©a
;

376 ià(
edge
 !ğ
NULL
) {

377 
	`­Ş_veùÜ_de¡roy
(&
edge
->
ruËs
);

378 
	`ä“
(
edge
);

380 
	}
}

382 
	s­Ş_šfoæow_edge_key


384 
­Ş_šfoæow_node_t
 *
	m¡¬t_node
, *
	m’d_node
;

397 
­Ş_šfoæow_edge_com·»
(cÚ¡ *
a
, cÚ¡ *
b
 
__©Œibu‹__
 ((
unu£d
)), *
d©a
)

399 
­Ş_šfoæow_edge_t
 *
	gedge
 = (­Ş_šfoæow_edge_ˆ*è
a
;

400 
­Ş_šfoæow_edge_key
 *
	gkey
 = (­Ş_šfoæow_edge_key *)
d©a
;

401 ià(
	gkey
->
	g¡¬t_node
 !ğ
NULL
 && 
edge
->
¡¬t_node
 !ğ
key
->start_node) {

402  ()((*)
edge
->
¡¬t_node
 - (*)
key
->start_node);

404 ià(
	gkey
->
	g’d_node
 !ğ
NULL
 && 
edge
->
’d_node
 !ğ
key
->end_node) {

405  ()((*)
edge
->
’d_node
 - (*)
key
->end_node);

424 
­Ş_šfoæow_edge_t
 *
­Ş_šfoæow_g¿ph_ü—‹_edge
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
,

425 
­Ş_šfoæow_g¿ph_t
 * 
g
 
__©Œibu‹__
 ((
unu£d
)),

426 
­Ş_šfoæow_node_t
 * 
¡¬t_node
,

427 
­Ş_šfoæow_node_t
 * 
’d_node
, 
Ën
)

429 
­Ş_šfoæow_edge_key
 
	gkey
 = { 
NULL
, 
’d_node
 };

430 
size_t
 
	gi
;

431 
­Ş_šfoæow_edge_t
 *
	gedge
 = 
NULL
;

432 ià(
­Ş_veùÜ_g‘_šdex
(
¡¬t_node
->
out_edges
, 
NULL
, 
­Ş_šfoæow_edge_com·»
, &
key
, &
i
) == 0) {

433 
edge
 = (
­Ş_šfoæow_edge_t
 *è
­Ş_veùÜ_g‘_–em’t
(
¡¬t_node
->
out_edges
, 
i
);

434 ià(
	gedge
->
	gËngth
 < 
	gËn
) {

435 
	gedge
->
	gËngth
 = 
Ën
;

437  
	gedge
;

439 ià((
	gedge
 = 
ÿÎoc
(1, (*
edge
))è=ğ
NULL
 || (edge->
ruËs
 = 
­Ş_veùÜ_ü—‹
(NULL)) == NULL ||

440 
­Ş_veùÜ_­³nd
(
g
->
edges
, 
edge
) < 0) {

441 
ERR
(
p
, "%s", 
¡»¼Ü
(
”ºo
));

442 
­Ş_šfoæow_edge_ä“
(
edge
);

443  
	gNULL
;

445 
	gedge
->
	g¡¬t_node
 = 
¡¬t_node
;

446 
	gedge
->
	g’d_node
 = 
’d_node
;

447 
	gedge
->
	gËngth
 = 
Ën
;

448 ià(
­Ş_veùÜ_­³nd
(
¡¬t_node
->
out_edges
, 
edge
è< 0 ||‡pŞ_veùÜ_­³nd(
’d_node
->
š_edges
,ƒdge) < 0) {

450 
ERR
(
p
, "%s", 
¡»¼Ü
(
”ºo
));

451  
	gNULL
;

453  
	gedge
;

482 
	$­Ş_šfoæow_g¿ph_cÚÃù_nodes
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
,

483 
­Ş_šfoæow_g¿ph_t
 * 
g
,

484 cÚ¡ 
qpŞ_avruË_t
 * 
ruË
,

485 
­Ş_b¡_t
 * 
ty³s
, 
found_»ad
, 
»ad_Ën
, 
found_wr™e
, 
wr™e_Ën
)

487 cÚ¡ 
qpŞ_ty³_t
 *
¤c_ty³
, *
tgt_ty³
;

488 
­Ş_veùÜ_t
 *
¤c_nodes
 = 
NULL
, *
tgt_nodes
 = NULL;

489 
size_t
 
i
, 
j
;

490 
­Ş_šfoæow_node_t
 *
¤c_node
, *
tgt_node
;

491 
­Ş_šfoæow_edge_t
 *
edge
;

492 
»tv®
 = -1;

494 ià(
	`qpŞ_avruË_g‘_sourû_ty³
(
p
->p, 
ruË
, &
¤c_ty³
è< 0 || 
	`qpŞ_avruË_g‘_rg‘_ty³
Õ->p,„uË, &
tgt_ty³
) < 0) {

495 
ş—nup
;

498 ià((
¤c_nodes
 = 
	`­Ş_šfoæow_g¿ph_ü—‹_nodes
(
p
, 
g
, 
¤c_ty³
, 
ty³s
, 
APOL_INFOFLOW_NODE_SOURCE
)è=ğ
NULL
) {

499 
ş—nup
;

501 ià((
tgt_nodes
 = 
	`­Ş_šfoæow_g¿ph_ü—‹_nodes
(
p
, 
g
, 
tgt_ty³
, 
ty³s
, 
APOL_INFOFLOW_NODE_TARGET
)è=ğ
NULL
) {

502 
ş—nup
;

504 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
¤c_nodes
); i++) {

505 
¤c_node
 = 
	`­Ş_veùÜ_g‘_–em’t
(
¤c_nodes
, 
i
);

506 
j
 = 0; j < 
	`­Ş_veùÜ_g‘_size
(
tgt_nodes
); j++) {

507 
tgt_node
 = 
	`­Ş_veùÜ_g‘_–em’t
(
tgt_nodes
, 
j
);

508 ià(
found_»ad
) {

509 ià((
edge
 = 
	`­Ş_šfoæow_g¿ph_ü—‹_edge
(
p
, 
g
, 
tgt_node
, 
¤c_node
, 
»ad_Ën
)è=ğ
NULL
) {

510 
ş—nup
;

512 ià(
	`­Ş_veùÜ_­³nd
(
edge
->
ruËs
, (*)
ruË
) < 0) {

513 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

514 
ş—nup
;

517 ià(
found_wr™e
) {

518 ià((
edge
 = 
	`­Ş_šfoæow_g¿ph_ü—‹_edge
(
p
, 
g
, 
¤c_node
, 
tgt_node
, 
wr™e_Ën
)è=ğ
NULL
) {

519 
ş—nup
;

521 ià(
	`­Ş_veùÜ_­³nd
(
edge
->
ruËs
, (*)
ruË
) < 0) {

522 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

523 
ş—nup
;

528 
»tv®
 = 0;

529 
ş—nup
:

530 
	`­Ş_veùÜ_de¡roy
(&
¤c_nodes
);

531 
	`­Ş_veùÜ_de¡roy
(&
tgt_nodes
);

532  
»tv®
;

533 
	}
}

551 
	$­Ş_šfoæow_g¿ph_ü—‹_avruË
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_šfoæow_g¿ph_t
 * 
g
, cÚ¡ 
qpŞ_avruË_t
 * 
ruË
,

552 
­Ş_b¡_t
 * 
ty³s
, 
max_Ën
)

554 cÚ¡ 
qpŞ_şass_t
 *
obj_şass
;

555 
qpŞ_™”©Ü_t
 *
³rm_™”
 = 
NULL
;

556 cÚ¡ *
obj_şass_Çme
;

557 *
³rm_Çme
;

558 
found_»ad
 = 0, 
found_wr™e
 = 0, 
³rm_”rÜ
 = 0;

559 
»ad_Ën
 = 
INT_MAX
, 
wr™e_Ën
 = INT_MAX;

560 
»tv®
 = -1;

561 ià(
	`qpŞ_avruË_g‘_objeù_şass
(
p
->p, 
ruË
, &
obj_şass
) < 0 ||

562 
	`qpŞ_şass_g‘_Çme
(
p
->p, 
obj_şass
, &
obj_şass_Çme
è< 0 || 
	`qpŞ_avruË_g‘_³rm_™”
Õ->p, 
ruË
, &
³rm_™”
) < 0) {

563 
ş—nup
;

567 ; !
	`qpŞ_™”©Ü_’d
(
³rm_™”
); 
	`qpŞ_™”©Ü_Ãxt
(perm_iter)) {

568 
³rm_m­
, 
³rm_weight
, 
Ën
;

570 ià(
	`qpŞ_™”©Ü_g‘_™em
(
³rm_™”
, (**)&
³rm_Çme
) < 0) {

571 
ş—nup
;

573 ià(
	`­Ş_pŞicy_g‘_³rmm­
(
p
, 
obj_şass_Çme
, 
³rm_Çme
, &
³rm_m­
, &
³rm_weight
) < 0) {

574 
ş—nup
;

576 
	`ä“
(
³rm_Çme
);

577 ià(
³rm_m­
 =ğ
APOL_PERMMAP_UNMAPPED
) {

578 
³rm_”rÜ
 = 1;

581 
Ën
 = 
APOL_PERMMAP_MAX_WEIGHT
 - 
³rm_weight
 + 1;

582 ià(
Ën
 < 
APOL_PERMMAP_MIN_WEIGHT
) {

583 
Ën
 = 
APOL_PERMMAP_MIN_WEIGHT
;

584 } ià(
Ën
 > 
APOL_PERMMAP_MAX_WEIGHT
) {

585 
Ën
 = 
APOL_PERMMAP_MAX_WEIGHT
;

587 ià(
³rm_m­
 & 
APOL_PERMMAP_READ
) {

588 ià(
Ën
 < 
»ad_Ën
 &&†’ <ğ
max_Ën
) {

589 
found_»ad
 = 1;

590 
»ad_Ën
 = 
Ën
;

593 ià(
³rm_m­
 & 
APOL_PERMMAP_WRITE
) {

594 ià(
Ën
 < 
wr™e_Ën
 &&†’ <ğ
max_Ën
) {

595 
found_wr™e
 = 1;

596 
wr™e_Ën
 = 
Ën
;

602 ià((
found_»ad
 || 
found_wr™e
) &&

603 
	`­Ş_šfoæow_g¿ph_cÚÃù_nodes
(
p
, 
g
, 
ruË
, 
ty³s
, 
found_»ad
, 
»ad_Ën
, 
found_wr™e
, 
wr™e_Ën
) < 0) {

604 
ş—nup
;

606 ià(
³rm_”rÜ
) {

607 
	`WARN
(
p
, "%s", "Not‡ll ofhe…ermissions found had‡ssociated…ermission maps.");

610 
»tv®
 = 0;

611 
ş—nup
:

612 
	`qpŞ_™”©Ü_de¡roy
(&
³rm_™”
);

613  
»tv®
;

614 
	}
}

628 
­Ş_b¡_t
 *
	$­Ş_šfoæow_g¿ph_ü—‹_»quœed_ty³s
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
­Ş_veùÜ_t
 * 
v
)

630 
­Ş_b¡_t
 *
ty³s
 = 
NULL
;

631 
­Ş_veùÜ_t
 *
ex·nded_ty³s
 = 
NULL
;

632 
size_t
 
i
;

633 *
s
;

634 
»tv®
 = -1;

635 ià((
ty³s
 = 
	`­Ş_b¡_ü—‹
(
NULL
, NULL)) == NULL) {

636 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

637 
ş—nup
;

639 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v
); i++) {

640 
s
 = (*)
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

641 
ex·nded_ty³s
 = 
	`­Ş_qu”y_ü—‹_ÿndid©e_ty³_li¡
(
p
, 
s
, 0, 1, 
APOL_QUERY_SYMBOL_IS_BOTH
);

642 ià(
ex·nded_ty³s
 =ğ
NULL
) {

643 
ş—nup
;

645 
size_t
 
j
 = 0; j < 
	`­Ş_veùÜ_g‘_size
(
ex·nded_ty³s
); j++) {

646 
qpŞ_ty³_t
 *
t
 = (qpŞ_ty³_ˆ*è
	`­Ş_veùÜ_g‘_–em’t
(
ex·nded_ty³s
, 
j
);

647 ià(
	`­Ş_b¡_š£¹
(
ty³s
, 
t
, 
NULL
) < 0) {

648 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

649 
ş—nup
;

652 
	`­Ş_veùÜ_de¡roy
(&
ex·nded_ty³s
);

654 
»tv®
 = 0;

655 
ş—nup
:

656 
	`­Ş_veùÜ_de¡roy
(&
ex·nded_ty³s
);

657 ià(
»tv®
 != 0) {

658 
	`­Ş_b¡_de¡roy
(&
ty³s
);

660  
ty³s
;

661 
	}
}

674 
	$­Ş_šfoæow_g¿ph_check_ty³s
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
qpŞ_avruË_t
 * 
ruË
, cÚ¡ 
­Ş_b¡_t
 * 
ty³s
)

676 cÚ¡ 
qpŞ_ty³_t
 *
sourû
, *
rg‘
;

677 *
»suÉ
;

678 
»tv®
 = -1;

679 ià(
ty³s
 =ğ
NULL
) {

680 
»tv®
 = 1;

681 
ş—nup
;

683 ià(
	`qpŞ_avruË_g‘_sourû_ty³
(
p
->p, 
ruË
, &
sourû
è< 0 || 
	`qpŞ_avruË_g‘_rg‘_ty³
Õ->p,„uË, &
rg‘
) < 0) {

684 
ş—nup
;

686 ià(
	`­Ş_b¡_g‘_–em’t
(
ty³s
, 
sourû
, 
NULL
, &
»suÉ
è< 0 ||‡pŞ_b¡_g‘_–em’tÑy³s, 
rg‘
, NULL, &result) < 0) {

687 
»tv®
 = 0;

688 
ş—nup
;

690 
»tv®
 = 1;

691 
ş—nup
:

692  
»tv®
;

693 
	}
}

708 
	$­Ş_šfoæow_g¿ph_check_şass_³rms
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
qpŞ_avruË_t
 * 
ruË
,

709 cÚ¡ 
­Ş_veùÜ_t
 * 
şass_³rms
)

711 cÚ¡ 
qpŞ_şass_t
 *
obj_şass
;

712 cÚ¡ *
obj_Çme
;

713 *
³rm
;

714 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

715 
­Ş_obj_³rm_t
 *
obj_³rm
 = 
NULL
;

716 
­Ş_veùÜ_t
 *
obj_³rm_v
 = 
NULL
;

717 
size_t
 
i
;

718 
»tv®
 = -1;

720 ià(
şass_³rms
 =ğ
NULL
 || 
	`­Ş_veùÜ_g‘_size
(class_perms) == 0) {

721 
»tv®
 = 1;

722 
ş—nup
;

724 ià(
	`qpŞ_avruË_g‘_objeù_şass
(
p
->p, 
ruË
, &
obj_şass
è< 0 || 
	`qpŞ_şass_g‘_Çme
Õ->p, obj_şass, &
obj_Çme
) < 0) {

725 
ş—nup
;

727 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
şass_³rms
); i++) {

728 
obj_³rm
 = (
­Ş_obj_³rm_t
 *è
	`­Ş_veùÜ_g‘_–em’t
(
şass_³rms
, 
i
);

729 ià(
	`¡rcmp
(
	`­Ş_obj_³rm_g‘_obj_Çme
(
obj_³rm
), 
obj_Çme
) == 0) {

730 
obj_³rm_v
 = 
	`­Ş_obj_³rm_g‘_³rm_veùÜ
(
obj_³rm
);

734 ià(
i
 >ğ
	`­Ş_veùÜ_g‘_size
(
şass_³rms
)) {

735 
»tv®
 = 0;

736 
ş—nup
;

738 ià(
	`qpŞ_avruË_g‘_³rm_™”
(
p
->p, 
ruË
, &
™”
) < 0) {

739 
ş—nup
;

741 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

742 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
³rm
) < 0) {

743 
ş—nup
;

745 ià(
	`­Ş_veùÜ_g‘_šdex
(
obj_³rm_v
, 
³rm
, 
­Ş_¡r_¡rcmp
, 
NULL
, &
i
) == 0) {

746 
	`ä“
(
³rm
);

747 
»tv®
 = 1;

748 
ş—nup
;

750 
	`ä“
(
³rm
);

752 
»tv®
 = 0;

753 
ş—nup
:

754 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

755  
»tv®
;

756 
	}
}

771 
	$­Ş_šfoæow_g¿ph_ü—‹
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
­Ş_šfoæow_ª®ysis_t
 * 
Ÿ
, 
­Ş_šfoæow_g¿ph_t
 ** 
g
)

773 
­Ş_b¡_t
 *
ty³s
 = 
NULL
;

774 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

775 
max_Ën
 = 
APOL_PERMMAP_MAX_WEIGHT
 - 
Ÿ
->
mš_weight
 + 1;

776 
compv®
, 
»tv®
 = -1;

778 *
g
 = 
NULL
;

779 ià(
p
->
pm­
 =ğ
NULL
) {

780 
	`ERR
(
p
, "%s", "A…ermission map must be†oaded…rioro buildinghe infoflow graph.");

781 
ş—nup
;

784 
	`INFO
(
p
, "%s", "Generating information flow graph.");

785 ià(
Ÿ
->
mode
 =ğ
APOL_INFOFLOW_MODE_TRANS
 && ia->
š‹rmed
 !ğ
NULL
 &&

786 (
ty³s
 = 
	`­Ş_šfoæow_g¿ph_ü—‹_»quœed_ty³s
(
p
, 
Ÿ
->
š‹rmed
)è=ğ
NULL
) {

787 
ş—nup
;

790 ià((*
g
 = 
	`ÿÎoc
(1, (**g))è=ğ
NULL
 ||

791 ((*
g
)->
nodes_b¡
 = 
	`­Ş_b¡_ü—‹
(
­Ş_šfoæow_node_com·»
, 
­Ş_šfoæow_node_ä“
)è=ğ
NULL
) {

792 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

793 
ş—nup
;

795 (*
g
)->
mode
 = 
Ÿ
->mode;

796 (*
g
)->
dœeùiÚ
 = 
Ÿ
->direction;

797 ià(
Ÿ
->
»suÉ
 !ğ
NULL
 && ia->result[0] != '\0') {

798 ià(((*
g
)->
»gex
 = 
	`m®loc
((
»gex_t
))è=ğ
NULL
 || 
	`»gcomp
((*g)->»gex, 
Ÿ
->
»suÉ
, 
REG_EXTENDED
 | 
REG_NOSUB
)) {

799 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

800 
ş—nup
;

803 ià(((*
g
)->
edges
 = 
	`­Ş_veùÜ_ü—‹
(
­Ş_šfoæow_edge_ä“
)è=ğ
NULL
) {

804 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

805 
ş—nup
;

808 ià(
	`qpŞ_pŞicy_g‘_avruË_™”
(
p
->p, 
QPOL_RULE_ALLOW
, &
™”
) < 0) {

809 
ş—nup
;

812 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

813 
qpŞ_avruË_t
 *
ruË
;

814 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
ruË
) < 0) {

815 
ş—nup
;

817 
compv®
 = 
	`­Ş_šfoæow_g¿ph_check_ty³s
(
p
, 
ruË
, 
ty³s
);

818 ià(
compv®
 < 0) {

819 
ş—nup
;

820 } ià(
compv®
 == 0) {

823 
compv®
 = 
	`­Ş_šfoæow_g¿ph_check_şass_³rms
(
p
, 
ruË
, 
Ÿ
->
şass_³rms
);

824 ià(
compv®
 < 0) {

825 
ş—nup
;

826 } ià(
compv®
 == 0) {

829 ià(
	`­Ş_šfoæow_g¿ph_ü—‹_avruË
(
p
, *
g
, 
ruË
, 
ty³s
, 
max_Ën
) < 0) {

830 
ş—nup
;

834 ià(((*
g
)->
nodes
 = 
	`­Ş_b¡_g‘_veùÜ
((*g)->
nodes_b¡
, 1)è=ğ
NULL
) {

835 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

836 
ş—nup
;

838 
	`­Ş_b¡_de¡roy
(&(*
g
)->
nodes_b¡
);

839 
»tv®
 = 0;

840 
ş—nup
:

841 
	`­Ş_b¡_de¡roy
(&
ty³s
);

842 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

843 ià(
»tv®
 < 0) {

844 
	`­Ş_šfoæow_g¿ph_de¡roy
(
g
);

846  
»tv®
;

847 
	}
}

849 
	$­Ş_šfoæow_g¿ph_de¡roy
(
­Ş_šfoæow_g¿ph_t
 ** 
g
)

851 ià(
g
 !ğ
NULL
 && *g != NULL) {

852 
	`­Ş_b¡_de¡roy
(&(*
g
)->
nodes_b¡
);

853 
	`­Ş_veùÜ_de¡roy
(&(*
g
)->
nodes
);

854 
	`­Ş_veùÜ_de¡roy
(&(*
g
)->
edges
);

855 
	`­Ş_veùÜ_de¡roy
(&(*
g
)->
fu¹h”_¡¬t
);

856 
	`­Ş_veùÜ_de¡roy
(&(*
g
)->
fu¹h”_’d
);

857 
	`­Ş_»gex_de¡roy
(&(*
g
)->
»gex
);

858 
	`ä“
(*
g
);

859 *
g
 = 
NULL
;

861 
	}
}

878 
	$­Ş_šfoæow_g¿ph_g‘_nodes_fÜ_ty³
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
­Ş_šfoæow_g¿ph_t
 * 
g
, cÚ¡ *
ty³
,

879 
­Ş_veùÜ_t
 * 
v
)

881 
size_t
 
i
, 
j
;

882 
­Ş_veùÜ_t
 *
ÿnd_li¡
 = 
NULL
;

883 
»tv®
 = -1;

884 ià((
ÿnd_li¡
 = 
	`­Ş_qu”y_ü—‹_ÿndid©e_ty³_li¡
(
p
, 
ty³
, 0, 1, 
APOL_QUERY_SYMBOL_IS_BOTH
)è=ğ
NULL
) {

885 
ş—nup
;

887 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
g
->
nodes
); i++) {

888 
­Ş_šfoæow_node_t
 *
node
;

889 
node
 = (
­Ş_šfoæow_node_t
 *è
	`­Ş_veùÜ_g‘_–em’t
(
g
->
nodes
, 
i
);

890 ià(
	`­Ş_veùÜ_g‘_šdex
(
ÿnd_li¡
, 
node
->
ty³
, 
NULL
, NULL, &
j
è=ğ0 && 
	`­Ş_veùÜ_­³nd
(
v
,‚ode) < 0) {

891 
ş—nup
;

894 
»tv®
 = 0;

895 
ş—nup
:

896 
	`­Ş_veùÜ_de¡roy
(&
ÿnd_li¡
);

897  
»tv®
;

898 
	}
}

913 
­Ş_šfoæow_»suÉ_t
 *
	$­Ş_šfoæow_dœeù_g‘_»suÉ
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
,

914 
­Ş_veùÜ_t
 * 
v
, cÚ¡ 
qpŞ_ty³_t
 * 
¡¬t_ty³
,

915 cÚ¡ 
qpŞ_ty³_t
 * 
’d_ty³
)

917 
size_t
 
i
;

918 
­Ş_šfoæow_»suÉ_t
 *
r
;

919 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v
); i++) {

920 
r
 = (
­Ş_šfoæow_»suÉ_t
 *è
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

921 ià(
r
->
¡¬t_ty³
 =ğ¡¬t_ty³ &&„->
’d_ty³
 ==ƒnd_type) {

922  
r
;

925 ià((
r
 = 
	`ÿÎoc
(1, (*r))è=ğ
NULL
 || (r->
¡•s
 = 
	`­Ş_veùÜ_ü—‹
(
­Ş_šfoæow_¡•_ä“
)) == NULL

926 || 
	`­Ş_veùÜ_­³nd
(
v
, 
r
) < 0) {

927 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

928 
	`šfoæow_»suÉ_ä“
(
r
);

929  
NULL
;

931 
r
->
¡¬t_ty³
 = start_type;

932 
r
->
’d_ty³
 =ƒnd_type;

933 
r
->
Ëngth
 = 
INT_MAX
;

934  
r
;

935 
	}
}

947 
	$­Ş_šfoæow_dœeù_defše
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
,

948 cÚ¡ 
­Ş_šfoæow_edge_t
 * 
edge
, 
dœeùiÚ
, 
­Ş_šfoæow_»suÉ_t
 * 
»suÉ
)

950 
­Ş_šfoæow_¡•_t
 *
¡•
 = 
NULL
;

951 ià(
	`­Ş_veùÜ_g‘_size
(
»suÉ
->
¡•s
) == 0) {

952 ià((
¡•
 = 
	`ÿÎoc
(1, (*¡•))è=ğ
NULL
 ||

953 (
¡•
->
ruËs
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)è=ğNULL || 
	`­Ş_veùÜ_­³nd
(
»suÉ
->
¡•s
, step) < 0) {

954 
	`­Ş_šfoæow_¡•_ä“
(
¡•
);

955 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

958 
¡•
->
¡¬t_ty³
 = 
»suÉ
->start_type;

959 
¡•
->
’d_ty³
 = 
»suÉ
->end_type;

960 
¡•
->
weight
 = 0;

962 
¡•
 = (
­Ş_šfoæow_¡•_t
 *è
	`­Ş_veùÜ_g‘_–em’t
(
»suÉ
->
¡•s
, 0);

964 ià(
	`­Ş_veùÜ_ÿt
(
¡•
->
ruËs
, 
edge
->rules) < 0) {

965 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

968 
»suÉ
->
dœeùiÚ
 |= direction;

970 ià(
edge
->
Ëngth
 < ()
»suÉ
->length) {

971 
»suÉ
->
Ëngth
 = 
edge
->length;

974 
	}
}

987 
	$­Ş_šfoæow_g¿ph_com·»
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_šfoæow_g¿ph_t
 * 
g
, cÚ¡ 
qpŞ_ty³_t
 * 
ty³
)

989 cÚ¡ *
ty³_Çme
;

990 
qpŞ_™”©Ü_t
 *
®Ÿs_™”
 = 
NULL
;

991 
compv®
 = 0;

992 ià(
g
->
»gex
 =ğ
NULL
) {

995 ià(
	`qpŞ_ty³_g‘_Çme
(
p
->p, 
ty³
, &
ty³_Çme
) < 0) {

998 ià(
	`»gexec
(
g
->
»gex
, 
ty³_Çme
, 0, 
NULL
, 0) == 0) {

1002 ià(
	`qpŞ_ty³_g‘_®Ÿs_™”
(
p
->p, 
ty³
, &
®Ÿs_™”
) < 0) {

1005 ; !
	`qpŞ_™”©Ü_’d
(
®Ÿs_™”
); 
	`qpŞ_™”©Ü_Ãxt
(alias_iter)) {

1006 *
™”_Çme
;

1007 ià(
	`qpŞ_™”©Ü_g‘_™em
(
®Ÿs_™”
, (**)&
™”_Çme
) < 0) {

1008 
compv®
 = -1;

1011 ià(
	`»gexec
(
g
->
»gex
, 
™”_Çme
, 0, 
NULL
, 0) == 0) {

1012 
compv®
 = 1;

1016 
	`qpŞ_™”©Ü_de¡roy
(&
®Ÿs_™”
);

1017  
compv®
;

1018 
	}
}

1034 
	$­Ş_šfoæow_»suÉs_check_bÙh
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
,

1035 cÚ¡ 
­Ş_veùÜ_t
 * 
wÜkšg_»suÉs
, 
dœeùiÚ
,‡pŞ_veùÜ_ˆ* 
»suÉs
)

1037 
size_t
 
i
;

1038 
­Ş_šfoæow_»suÉ_t
 *
r
, *
Ãw_r
;

1039 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
wÜkšg_»suÉs
); i++) {

1040 
r
 = (
­Ş_šfoæow_»suÉ_t
 *è
	`­Ş_veùÜ_g‘_–em’t
(
wÜkšg_»suÉs
, 
i
);

1041 ià(
dœeùiÚ
 !ğ
APOL_INFOFLOW_BOTH
 || 
r
->direction == APOL_INFOFLOW_BOTH) {

1042 ià((
Ãw_r
 = 
	`ÿÎoc
(1, (*Ãw_r))è=ğ
NULL
) {

1043 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

1046 
	`memıy
(
Ãw_r
, 
r
, (*new_r));

1047 
r
->
¡•s
 = 
NULL
;

1048 ià(
	`­Ş_veùÜ_­³nd
(
»suÉs
, 
Ãw_r
) < 0) {

1049 
	`šfoæow_»suÉ_ä“
(
Ãw_r
);

1050 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

1056 
	}
}

1078 
	$­Ş_šfoæow_ª®ysis_dœeù_ex·nd
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
,

1079 
­Ş_šfoæow_g¿ph_t
 * 
g
,

1080 
­Ş_šfoæow_node_t
 * 
¡¬t_node
,

1081 
­Ş_šfoæow_edge_t
 * 
edge
, 
æow_dœ
, 
­Ş_veùÜ_t
 * 
»suÉs
)

1083 
­Ş_šfoæow_node_t
 *
’d_node
;

1084 
i§‰r
;

1085 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

1086 cÚ¡ 
qpŞ_ty³_t
 *
ty³
;

1087 
­Ş_šfoæow_»suÉ_t
 *
r
;

1088 
»tv®
 = -1, 
compv®
;

1090 ià(
edge
->
¡¬t_node
 == start_node) {

1091 
’d_node
 = 
edge
->end_node;

1093 
’d_node
 = 
edge
->
¡¬t_node
;

1095 ià(
	`qpŞ_ty³_g‘_i§‰r
(
p
->p, 
’d_node
->
ty³
, &
i§‰r
) < 0) {

1096 
ş—nup
;

1098 ià(
i§‰r
) {

1099 ià(
	`qpŞ_ty³_g‘_ty³_™”
(
p
->p, 
’d_node
->
ty³
, &
™”
) < 0) {

1100 
ş—nup
;

1102 ià(
	`qpŞ_™”©Ü_’d
(
™”
)) {

1103 
»tv®
 = 0;

1104 
ş—nup
;

1109 ià(
i§‰r
) {

1110 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
ty³
) < 0) {

1111 
ş—nup
;

1113 
	`qpŞ_™”©Ü_Ãxt
(
™”
);

1115 
ty³
 = 
’d_node
->type;

1117 
compv®
 = 
	`­Ş_šfoæow_g¿ph_com·»
(
p
, 
g
, 
ty³
);

1118 ià(
compv®
 < 0) {

1119 
ş—nup
;

1120 } ià(
compv®
 == 0) {

1123 ià((
r
 = 
	`­Ş_šfoæow_dœeù_g‘_»suÉ
(
p
, 
»suÉs
, 
¡¬t_node
->
ty³
,y³)è=ğ
NULL
 ||

1124 
	`­Ş_šfoæow_dœeù_defše
(
p
, 
edge
, 
æow_dœ
, 
r
) < 0) {

1125 
ş—nup
;

1127 } 
i§‰r
 && !
	`qpŞ_™”©Ü_’d
(
™”
));

1129 
»tv®
 = 0;

1130 
ş—nup
:

1131 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

1132  
»tv®
;

1133 
	}
}

1148 
	$­Ş_šfoæow_ª®ysis_dœeù
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
,

1149 
­Ş_šfoæow_g¿ph_t
 * 
g
, cÚ¡ *
¡¬t_ty³
, 
­Ş_veùÜ_t
 * 
»suÉs
)

1151 
­Ş_veùÜ_t
 *
nodes
 = 
NULL
;

1152 
size_t
 
i
, 
j
;

1153 
­Ş_šfoæow_node_t
 *
node
;

1154 
­Ş_šfoæow_edge_t
 *
edge
;

1155 
­Ş_veùÜ_t
 *
wÜkšg_»suÉs
 = 
NULL
;

1156 
»tv®
 = -1;

1158 ià((
nodes
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)è=ğNULL || (
wÜkšg_»suÉs
 =‡pŞ_veùÜ_ü—‹(
šfoæow_»suÉ_ä“
)) == NULL) {

1159 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

1160 
ş—nup
;

1162 ià(
	`­Ş_šfoæow_g¿ph_g‘_nodes_fÜ_ty³
(
p
, 
g
, 
¡¬t_ty³
, 
nodes
) < 0) {

1163 
ş—nup
;

1166 ià(
g
->
dœeùiÚ
 =ğ
APOL_INFOFLOW_IN
 || g->dœeùiÚ =ğ
APOL_INFOFLOW_EITHER
 || g->dœeùiÚ =ğ
APOL_INFOFLOW_BOTH
) {

1167 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
nodes
); i++) {

1168 
node
 = (
­Ş_šfoæow_node_t
 *è
	`­Ş_veùÜ_g‘_–em’t
(
nodes
, 
i
);

1169 
j
 = 0; j < 
	`­Ş_veùÜ_g‘_size
(
node
->
š_edges
); j++) {

1170 
edge
 = (
­Ş_šfoæow_edge_t
 *è
	`­Ş_veùÜ_g‘_–em’t
(
node
->
š_edges
, 
j
);

1171 ià(
	`­Ş_šfoæow_ª®ysis_dœeù_ex·nd
(
p
, 
g
, 
node
, 
edge
, 
APOL_INFOFLOW_IN
, 
wÜkšg_»suÉs
) < 0) {

1172 
ş—nup
;

1177 ià(
g
->
dœeùiÚ
 =ğ
APOL_INFOFLOW_OUT
 || g->dœeùiÚ =ğ
APOL_INFOFLOW_EITHER
 || g->dœeùiÚ =ğ
APOL_INFOFLOW_BOTH
) {

1178 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
nodes
); i++) {

1179 
node
 = (
­Ş_šfoæow_node_t
 *è
	`­Ş_veùÜ_g‘_–em’t
(
nodes
, 
i
);

1180 
j
 = 0; j < 
	`­Ş_veùÜ_g‘_size
(
node
->
out_edges
); j++) {

1181 
edge
 = (
­Ş_šfoæow_edge_t
 *è
	`­Ş_veùÜ_g‘_–em’t
(
node
->
out_edges
, 
j
);

1182 ià(
	`­Ş_šfoæow_ª®ysis_dœeù_ex·nd
(
p
, 
g
, 
node
, 
edge
, 
APOL_INFOFLOW_OUT
, 
wÜkšg_»suÉs
) < 0) {

1183 
ş—nup
;

1189 ià(
	`­Ş_šfoæow_»suÉs_check_bÙh
(
p
, 
wÜkšg_»suÉs
, 
g
->
dœeùiÚ
, 
»suÉs
) < 0) {

1190 
ş—nup
;

1193 
»tv®
 = 0;

1194 
ş—nup
:

1195 
	`­Ş_veùÜ_de¡roy
(&
nodes
);

1196 
	`­Ş_veùÜ_de¡roy
(&
wÜkšg_»suÉs
);

1197  
»tv®
;

1198 
	}
}

1214 
	$­Ş_šfoæow_g¿ph_Œªs_š™
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
,

1215 
­Ş_šfoæow_g¿ph_t
 * 
g
, 
­Ş_šfoæow_node_t
 * 
¡¬t
, 
­Ş_queue_t
 * 
q
)

1217 
size_t
 
i
;

1218 
­Ş_šfoæow_node_t
 *
node
;

1219 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
g
->
nodes
); i++) {

1220 
node
 = (
­Ş_šfoæow_node_t
 *è
	`­Ş_veùÜ_g‘_–em’t
(
g
->
nodes
, 
i
);

1221 
node
->
·»Á
 = 
NULL
;

1222 ià(
node
 =ğ
¡¬t
) {

1223 
node
->
cŞÜ
 = 
APOL_INFOFLOW_COLOR_RED
;

1224 
node
->
di¡ªû
 = 0;

1225 ià(
	`­Ş_queue_š£¹
(
q
, 
node
) < 0) {

1226 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

1230 
node
->
cŞÜ
 = 
APOL_INFOFLOW_COLOR_WHITE
;

1231 
node
->
di¡ªû
 = 
INT_MAX
;

1235 
	}
}

1249 
	$­Ş_šfoæow_g¿ph_Œªs_fu¹h”_š™
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
,

1250 
­Ş_šfoæow_g¿ph_t
 * 
g
, 
­Ş_šfoæow_node_t
 * 
¡¬t
, 
­Ş_queue_t
 * 
q
)

1252 
size_t
 
i
;

1253 
­Ş_šfoæow_node_t
 *
node
;

1254 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
g
->
nodes
); i++) {

1255 
node
 = (
­Ş_šfoæow_node_t
 *è
	`­Ş_veùÜ_g‘_–em’t
(
g
->
nodes
, 
i
);

1256 
node
->
·»Á
 = 
NULL
;

1257 ià(
node
 =ğ
¡¬t
) {

1258 
node
->
cŞÜ
 = 
APOL_INFOFLOW_COLOR_GREY
;

1259 
node
->
di¡ªû
 = 0;

1260 ià(
	`­Ş_queue_š£¹
(
q
, 
node
) < 0) {

1261 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

1265 
node
->
cŞÜ
 = 
APOL_INFOFLOW_COLOR_WHITE
;

1266 
node
->
di¡ªû
 = -1;

1270 
	}
}

1289 
	$­Ş_šfoæow_Œªs_·th
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
,

1290 
­Ş_šfoæow_g¿ph_t
 * 
g
,

1291 
­Ş_šfoæow_node_t
 * 
¡¬t_node
,‡pŞ_šfoæow_node_ˆ* 
’d_node
, 
­Ş_veùÜ_t
 ** 
·th
)

1293 
»tv®
 = -1;

1294 
­Ş_šfoæow_node_t
 *
Ãxt_node
 = 
’d_node
;

1295 ià((*
·th
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)) == NULL) {

1296 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

1297 
ş—nup
;

1300 ià(
	`­Ş_veùÜ_­³nd
(*
·th
, 
Ãxt_node
) < 0) {

1301 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

1302 
ş—nup
;

1304 ià(
Ãxt_node
 =ğ
¡¬t_node
) {

1307 ià(
Ãxt_node
 =ğ
NULL
 || 
	`­Ş_veùÜ_g‘_size
(*
·th
è>ğ­Ş_veùÜ_g‘_size(
g
->
nodes
)) {

1308 
	`ERR
(
p
, "%s", "Infinite†oop inrans_path.");

1309 
”ºo
 = 
EPERM
;

1310 
ş—nup
;

1312 
Ãxt_node
 =‚ext_node->
·»Á
;

1314 
»tv®
 = 0;

1315 
ş—nup
:

1316 ià(
»tv®
 != 0) {

1317 
	`­Ş_veùÜ_de¡roy
(
·th
);

1319  
»tv®
;

1320 
	}
}

1333 
­Ş_šfoæow_edge_t
 *
	$­Ş_šfoæow_Œªs_fšd_edge
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
,

1334 
­Ş_šfoæow_g¿ph_t
 * 
g
,

1335 
­Ş_šfoæow_node_t
 * 
node
,‡pŞ_šfoæow_node_ˆ* 
Ãxt_node
)

1337 
­Ş_veùÜ_t
 *
v
;

1338 
­Ş_šfoæow_edge_t
 *
edge
;

1339 
size_t
 
i
;

1341 ià(
g
->
dœeùiÚ
 =ğ
APOL_INFOFLOW_OUT
) {

1342 
v
 = 
node
->
out_edges
;

1344 
v
 = 
node
->
š_edges
;

1346 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v
); i++) {

1347 
edge
 = (
­Ş_šfoæow_edge_t
 *è
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

1348 ià(
g
->
dœeùiÚ
 =ğ
APOL_INFOFLOW_OUT
) {

1349 ià(
edge
->
¡¬t_node
 =ğ
node
 &&ƒdge->
’d_node
 =ğ
Ãxt_node
) {

1350  
edge
;

1353 ià(
edge
->
’d_node
 =ğ
node
 &&ƒdge->
¡¬t_node
 =ğ
Ãxt_node
) {

1354  
edge
;

1359 
	`ERR
(
p
, "%s", "Did‚ot find‡nƒdge.");

1360  
NULL
;

1361 
	}
}

1380 
	$­Ş_šfoæow_Œªs_defše
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
,

1381 
­Ş_šfoæow_g¿ph_t
 * 
g
,

1382 
­Ş_veùÜ_t
 * 
·th
, cÚ¡ 
qpŞ_ty³_t
 * 
’d_ty³
, 
­Ş_šfoæow_»suÉ_t
 ** 
»suÉ
)

1384 
­Ş_šfoæow_¡•_t
 *
¡•
 = 
NULL
;

1385 
size_t
 
·th_Ën
 = 
	`­Ş_veùÜ_g‘_size
(
·th
), 
i
;

1386 
­Ş_šfoæow_node_t
 *
node
, *
Ãxt_node
;

1387 
­Ş_šfoæow_edge_t
 *
edge
;

1388 
»tv®
 = -1, 
Ëngth
 = 0;

1389 *
»suÉ
 = 
NULL
;

1391 ià(((*
»suÉ
èğ
	`ÿÎoc
(1, (**»suÉ))è=ğ
NULL
 ||

1392 ((*
»suÉ
)->
¡•s
 = 
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(
·th_Ën
, 
­Ş_šfoæow_¡•_ä“
)è=ğ
NULL
) {

1393 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

1394 
ş—nup
;

1396 (*
»suÉ
)->
’d_ty³
 =ƒnd_type;

1399 
node
 = (
­Ş_šfoæow_node_t
 *è
	`­Ş_veùÜ_g‘_–em’t
(
·th
, 
·th_Ën
 - 1);

1400 (*
»suÉ
)->
¡¬t_ty³
 = 
node
->
ty³
;

1401 (*
»suÉ
)->
dœeùiÚ
 = 
g
->direction;

1402 
i
 = 
·th_Ën
 - 1; i > 0; i--, 
node
 = 
Ãxt_node
) {

1403 
Ãxt_node
 = (
­Ş_šfoæow_node_t
 *è
	`­Ş_veùÜ_g‘_–em’t
(
·th
, 
i
 - 1);

1404 
edge
 = 
	`­Ş_šfoæow_Œªs_fšd_edge
(
p
, 
g
, 
node
, 
Ãxt_node
);

1405 ià(
edge
 =ğ
NULL
) {

1406 
ş—nup
;

1408 
Ëngth
 +ğ
edge
->length;

1409 ià((
¡•
 = 
	`ÿÎoc
(1, (*¡•))è=ğ
NULL
 ||

1410 (
¡•
->
ruËs
 = 
	`­Ş_veùÜ_ü—‹_äom_veùÜ
(
edge
->ruËs, 
NULL
, NULL, NULL)) == NULL ||

1411 
	`­Ş_veùÜ_­³nd
((*
»suÉ
)->
¡•s
, 
¡•
) < 0) {

1412 
	`­Ş_šfoæow_¡•_ä“
(
¡•
);

1413 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

1416 
¡•
->
¡¬t_ty³
 = 
edge
->
¡¬t_node
->
ty³
;

1417 
¡•
->
’d_ty³
 = 
edge
->
’d_node
->
ty³
;

1418 
¡•
->
weight
 = 
APOL_PERMMAP_MAX_WEIGHT
 - 
edge
->
Ëngth
 + 1;

1420 (*
»suÉ
)->
Ëngth
 =†ength;

1421 
»tv®
 = 0;

1422 
ş—nup
:

1423 ià(
»tv®
 != 0) {

1424 
	`šfoæow_»suÉ_ä“
(*
»suÉ
);

1425 *
»suÉ
 = 
NULL
;

1427  
»tv®
;

1428 
	}
}

1441 
­Ş_šfoæow_Œªs_¡•_comp
(cÚ¡ *
a
, cÚ¡ *
b
, *
d©a
 
__©Œibu‹__
 ((
unu£d
)))

1443 cÚ¡ 
­Ş_šfoæow_¡•_t
 *
	g¡•_a
 = (cÚ¡‡pŞ_šfoæow_¡•_ˆ*)
a
;

1444 cÚ¡ 
­Ş_šfoæow_¡•_t
 *
	g¡•_b
 = (cÚ¡‡pŞ_šfoæow_¡•_ˆ*)
b
;

1445 
size_t
 
	gi
;

1446 ià(
	g¡•_a
->
	g¡¬t_ty³
 !ğ
¡•_b
->
¡¬t_ty³
) {

1447  ()((*)
¡•_a
->
¡¬t_ty³
 - (*)
¡•_b
->start_type);

1449 ià(
	g¡•_a
->
	g’d_ty³
 !ğ
¡•_b
->
’d_ty³
) {

1450  ()((*)
¡•_a
->
’d_ty³
 - (*)
¡•_b
->end_type);

1452  
­Ş_veùÜ_com·»
(
¡•_a
->
ruËs
, 
¡•_b
->ruËs, 
NULL
, NULL, &
i
);

1470 
	$­Ş_šfoæow_Œªs_­³nd
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
,

1471 
­Ş_šfoæow_g¿ph_t
 * 
g
,

1472 
­Ş_veùÜ_t
 * 
·th
, cÚ¡ 
qpŞ_ty³_t
 * 
’d_ty³
,‡pŞ_veùÜ_ˆ* 
»suÉs
)

1474 
­Ş_šfoæow_»suÉ_t
 *
Ãw_r
 = 
NULL
, *
r
;

1475 
size_t
 
i
, 
j
;

1476 
compv®
, 
»tv®
 = -1;

1478 ià(
	`­Ş_šfoæow_Œªs_defše
(
p
, 
g
, 
·th
, 
’d_ty³
, &
Ãw_r
) < 0) {

1479 
ş—nup
;

1483 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
»suÉs
); i++) {

1484 
r
 = (
­Ş_šfoæow_»suÉ_t
 *è
	`­Ş_veùÜ_g‘_–em’t
(
»suÉs
, 
i
);

1485 ià(
r
->
’d_ty³
 !=ƒnd_type ||

1486 
r
->
dœeùiÚ
 !ğ
Ãw_r
->dœeùiÚ || 
	`­Ş_veùÜ_g‘_size
Ô->
¡•s
) !=‡pol_vector_get_size(new_r->steps)) {

1489 
compv®
 = 
	`­Ş_veùÜ_com·»
(
r
->
¡•s
, 
Ãw_r
->¡•s, 
­Ş_šfoæow_Œªs_¡•_comp
, 
NULL
, &
j
);

1492 ià(
compv®
 == 0) {

1493 
	`šfoæow_»suÉ_ä“
(
Ãw_r
);

1494 
Ãw_r
 = 
NULL
;

1495 
»tv®
 = 0;

1496 
ş—nup
;

1501 ià(
	`­Ş_veùÜ_­³nd
(
»suÉs
, 
Ãw_r
) < 0) {

1502 
ş—nup
;

1504 
»tv®
 = 0;

1505 
ş—nup
:

1506 ià(
»tv®
 != 0) {

1507 
	`šfoæow_»suÉ_ä“
(
Ãw_r
);

1509  
»tv®
;

1510 
	}
}

1529 
	$­Ş_šfoæow_ª®ysis_Œªs_ex·nd
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
,

1530 
­Ş_šfoæow_g¿ph_t
 * 
g
,

1531 
­Ş_šfoæow_node_t
 * 
¡¬t_node
,

1532 
­Ş_šfoæow_node_t
 * 
’d_node
, 
­Ş_veùÜ_t
 * 
»suÉs
)

1534 
i§‰r
;

1535 
­Ş_veùÜ_t
 *
·th
 = 
NULL
;

1536 
»tv®
 = -1, 
compv®
;

1538 ià(
	`qpŞ_ty³_g‘_i§‰r
(
p
->p, 
’d_node
->
ty³
, &
i§‰r
) < 0) {

1539 
ş—nup
;

1541 
	`as£¹
(
i§‰r
 == 0);

1542 ià(
¡¬t_node
->
ty³
 =ğ
’d_node
->type) {

1545 
compv®
 = 
	`­Ş_šfoæow_g¿ph_com·»
(
p
, 
g
, 
’d_node
->
ty³
);

1546 ià(
compv®
 < 0) {

1547 
ş—nup
;

1548 } ià(
compv®
 == 0) {

1551 ià(
	`­Ş_šfoæow_Œªs_·th
(
p
, 
g
, 
¡¬t_node
, 
’d_node
, &
·th
) < 0 ||

1552 
	`­Ş_šfoæow_Œªs_­³nd
(
p
, 
g
, 
·th
, 
’d_node
->
ty³
, 
»suÉs
) < 0) {

1553 
ş—nup
;

1555 
»tv®
 = 0;

1556 
ş—nup
:

1557 
	`­Ş_veùÜ_de¡roy
(&
·th
);

1558  
»tv®
;

1559 
	}
}

1593 
	$­Ş_šfoæow_ª®ysis_Œªs_shÜ‹¡_·th
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
,

1594 
­Ş_šfoæow_g¿ph_t
 * 
g
,

1595 
­Ş_šfoæow_node_t
 * 
¡¬t
, 
­Ş_veùÜ_t
 * 
»suÉs
)

1597 
­Ş_veùÜ_t
 *
edge_li¡
;

1598 
­Ş_queue_t
 *
queue
 = 
NULL
;

1599 
­Ş_šfoæow_node_t
 *
node
, *
cur_node
;

1600 
­Ş_šfoæow_edge_t
 *
edge
;

1601 
size_t
 
i
;

1602 
»tv®
 = -1;

1604 ià((
queue
 = 
	`­Ş_queue_ü—‹
()è=ğ
NULL
) {

1605 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

1606 
ş—nup
;

1608 ià(
	`­Ş_šfoæow_g¿ph_Œªs_š™
(
p
, 
g
, 
¡¬t
, 
queue
) < 0) {

1609 
ş—nup
;

1612 (
cur_node
 = 
	`­Ş_queue_»move
(
queue
)è!ğ
NULL
) {

1613 
cur_node
->
cŞÜ
 = 
APOL_INFOFLOW_COLOR_GREY
;

1614 ià(
g
->
dœeùiÚ
 =ğ
APOL_INFOFLOW_OUT
) {

1615 
edge_li¡
 = 
cur_node
->
out_edges
;

1617 
edge_li¡
 = 
cur_node
->
š_edges
;

1619 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
edge_li¡
); i++) {

1620 
edge
 = (
­Ş_šfoæow_edge_t
 *è
	`­Ş_veùÜ_g‘_–em’t
(
edge_li¡
, 
i
);

1621 ià(
g
->
dœeùiÚ
 =ğ
APOL_INFOFLOW_OUT
) {

1622 
node
 = 
edge
->
’d_node
;

1624 
node
 = 
edge
->
¡¬t_node
;

1626 ià(
node
 =ğ
¡¬t
) {

1630 ià(
node
->
di¡ªû
 > 
cur_node
->di¡ªû + 
edge
->
Ëngth
) {

1631 
node
->
di¡ªû
 = 
cur_node
->di¡ªû + 
edge
->
Ëngth
;

1632 
node
->
·»Á
 = 
cur_node
;

1639 ià(
node
->
cŞÜ
 !ğ
APOL_INFOFLOW_COLOR_RED
) {

1640 ià(
node
->
cŞÜ
 =ğ
APOL_INFOFLOW_COLOR_GREY
) {

1641 ià(
	`­Ş_queue_push
(
queue
, 
node
) < 0) {

1642 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

1643 
ş—nup
;

1646 ià(
	`­Ş_queue_š£¹
(
queue
, 
node
) < 0) {

1647 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

1648 
ş—nup
;

1651 
node
->
cŞÜ
 = 
APOL_INFOFLOW_COLOR_RED
;

1658 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
g
->
nodes
); i++) {

1659 
cur_node
 = (
­Ş_šfoæow_node_t
 *è
	`­Ş_veùÜ_g‘_–em’t
(
g
->
nodes
, 
i
);

1660 ià(
cur_node
->
·»Á
 =ğ
NULL
 || cur_nod=ğ
¡¬t
) {

1663 ià(
	`­Ş_šfoæow_ª®ysis_Œªs_ex·nd
(
p
, 
g
, 
¡¬t
, 
cur_node
, 
»suÉs
) < 0) {

1664 
ş—nup
;

1668 
»tv®
 = 0;

1669 
ş—nup
:

1670 
	`­Ş_queue_de¡roy
(&
queue
);

1671  
»tv®
;

1672 
	}
}

1687 
	$­Ş_šfoæow_ª®ysis_Œªs
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
,

1688 
­Ş_šfoæow_g¿ph_t
 * 
g
, cÚ¡ *
¡¬t_ty³
, 
­Ş_veùÜ_t
 * 
»suÉs
)

1690 
­Ş_veùÜ_t
 *
¡¬t_nodes
 = 
NULL
;

1691 
­Ş_šfoæow_node_t
 *
¡¬t_node
;

1692 
size_t
 
i
;

1693 
»tv®
 = -1;

1695 ià(
g
->
dœeùiÚ
 !ğ
APOL_INFOFLOW_IN
 && g->dœeùiÚ !ğ
APOL_INFOFLOW_OUT
) {

1696 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
EINVAL
));

1697 
ş—nup
;

1699 ià((
¡¬t_nodes
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)) == NULL) {

1700 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

1701 
ş—nup
;

1703 ià(
	`­Ş_šfoæow_g¿ph_g‘_nodes_fÜ_ty³
(
p
, 
g
, 
¡¬t_ty³
, 
¡¬t_nodes
) < 0) {

1704 
ş—nup
;

1706 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
¡¬t_nodes
); i++) {

1707 
¡¬t_node
 = (
­Ş_šfoæow_node_t
 *è
	`­Ş_veùÜ_g‘_–em’t
(
¡¬t_nodes
, 
i
);

1708 ià(
	`­Ş_šfoæow_ª®ysis_Œªs_shÜ‹¡_·th
(
p
, 
g
, 
¡¬t_node
, 
»suÉs
) < 0) {

1709 
ş—nup
;

1712 
»tv®
 = 0;

1713 
ş—nup
:

1714 
	`­Ş_veùÜ_de¡roy
(&
¡¬t_nodes
);

1715  
»tv®
;

1716 
	}
}

1731 
­Ş_veùÜ_t
 *
	$­Ş_šfoæow_Œªs_fu¹h”_shufæe
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_šfoæow_g¿ph_t
 * 
g
, 
­Ş_veùÜ_t
 * 
v
)

1733 
size_t
 
i
, 
j
, 
size
;

1734 **
deck
 = 
NULL
, *
tmp
;

1735 
­Ş_veùÜ_t
 *
Ãw_v
 = 
NULL
;

1736 
»tv®
 = -1;

1737 
size
 = 
	`­Ş_veùÜ_g‘_size
(
v
);

1738 ià((
Ãw_v
 = 
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(
size
, 
NULL
)) == NULL) {

1739 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

1740 
ş—nup
;

1742 ià(
size
 == 0) {

1743 
»tv®
 = 0;

1744 
ş—nup
;

1746 ià((
deck
 = 
	`m®loc
(
size
 * (*deck))è=ğ
NULL
) {

1747 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

1748 
ş—nup
;

1750 
i
 = 0; i < 
size
; i++) {

1751 
deck
[
i
] = 
	`­Ş_veùÜ_g‘_–em’t
(
v
, i);

1753 
i
 = 
size
 - 1; i > 0; i--) {

1754 
j
 = (
size_t
è((
	`­Ş_šfoæow_¿nd
(
g
è/ (
RAND_MAX
 + 1.0)è* 
i
);

1755 
tmp
 = 
deck
[
i
];

1756 
deck
[
i
] = deck[
j
];

1757 
deck
[
j
] = 
tmp
;

1759 
i
 = 0; i < 
size
; i++) {

1760 ià(
	`­Ş_veùÜ_­³nd
(
Ãw_v
, 
deck
[
i
]) < 0) {

1761 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

1762 
ş—nup
;

1765 
»tv®
 = 0;

1766 
ş—nup
:

1767 
	`ä“
(
deck
);

1768 ià(
»tv®
 != 0) {

1769 
	`­Ş_veùÜ_de¡roy
(&
Ãw_v
);

1771  
Ãw_v
;

1772 
	}
}

1774 
	$­Ş_šfoæow_ª®ysis_Œªs_fu¹h”
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
,

1775 
­Ş_šfoæow_g¿ph_t
 * 
g
, 
­Ş_šfoæow_node_t
 * 
¡¬t
, 
­Ş_veùÜ_t
 * 
»suÉs
)

1777 
­Ş_veùÜ_t
 *
edge_li¡
 = 
NULL
;

1778 
­Ş_queue_t
 *
queue
 = 
NULL
;

1779 
­Ş_šfoæow_node_t
 *
node
, *
cur_node
;

1780 
­Ş_šfoæow_edge_t
 *
edge
;

1781 
size_t
 
i
;

1782 
»tv®
 = -1;

1784 ià((
queue
 = 
	`­Ş_queue_ü—‹
()è=ğ
NULL
) {

1785 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

1786 
ş—nup
;

1788 ià(
	`­Ş_šfoæow_g¿ph_Œªs_fu¹h”_š™
(
p
, 
g
, 
¡¬t
, 
queue
) < 0) {

1789 
ş—nup
;

1792 (
cur_node
 = 
	`­Ş_queue_»move
(
queue
)è!ğ
NULL
) {

1793 ià(
cur_node
 !ğ
¡¬t
 &&

1794 
	`­Ş_veùÜ_g‘_šdex
(
g
->
fu¹h”_’d
, 
cur_node
, 
NULL
, NULL, &
i
) == 0 &&

1795 
	`­Ş_šfoæow_ª®ysis_Œªs_ex·nd
(
p
, 
g
, 
¡¬t
, 
cur_node
, 
»suÉs
) < 0) {

1796 
ş—nup
;

1798 
cur_node
->
cŞÜ
 = 
APOL_INFOFLOW_COLOR_BLACK
;

1799 ià(
g
->
dœeùiÚ
 =ğ
APOL_INFOFLOW_OUT
) {

1800 
edge_li¡
 = 
cur_node
->
out_edges
;

1802 
edge_li¡
 = 
cur_node
->
š_edges
;

1804 
edge_li¡
 = 
	`­Ş_šfoæow_Œªs_fu¹h”_shufæe
(
p
, 
g
,ƒdge_list);

1805 ià(
edge_li¡
 =ğ
NULL
) {

1806 
ş—nup
;

1808 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
edge_li¡
); i++) {

1809 
edge
 = (
­Ş_šfoæow_edge_t
 *è
	`­Ş_veùÜ_g‘_–em’t
(
edge_li¡
, 
i
);

1810 ià(
g
->
dœeùiÚ
 =ğ
APOL_INFOFLOW_OUT
) {

1811 
node
 = 
edge
->
’d_node
;

1813 
node
 = 
edge
->
¡¬t_node
;

1815 ià(
node
->
cŞÜ
 =ğ
APOL_INFOFLOW_COLOR_WHITE
) {

1816 
node
->
cŞÜ
 = 
APOL_INFOFLOW_COLOR_GREY
;

1817 
node
->
di¡ªû
 = 
cur_node
->distance + 1;

1818 
node
->
·»Á
 = 
cur_node
;

1819 ià(
	`­Ş_queue_push
(
queue
, 
node
) < 0) {

1820 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

1821 
ş—nup
;

1825 
	`­Ş_veùÜ_de¡roy
(&
edge_li¡
);

1827 
»tv®
 = 0;

1828 
ş—nup
:

1829 
	`­Ş_veùÜ_de¡roy
(&
edge_li¡
);

1830 
	`­Ş_queue_de¡roy
(&
queue
);

1831  
»tv®
;

1832 
	}
}

1836 
	$­Ş_šfoæow_ª®ysis_do
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
­Ş_šfoæow_ª®ysis_t
 * 
Ÿ
, 
­Ş_veùÜ_t
 ** 
v
,

1837 
­Ş_šfoæow_g¿ph_t
 ** 
g
)

1839 
»tv®
 = -1;

1840 ià(
v
 !ğ
NULL
) {

1841 *
v
 = 
NULL
;

1843 ià(
g
 !ğ
NULL
) {

1844 *
g
 = 
NULL
;

1846 ià(
p
 =ğ
NULL
 || 
Ÿ
 =ğNULL || 
v
 =ğNULL || 
g
 =ğNULL || ia->
mode
 =ğ0 || ia->
dœeùiÚ
 == 0) {

1847 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
EINVAL
));

1848 
ş—nup
;

1850 ià(
	`­Ş_šfoæow_g¿ph_ü—‹
(
p
, 
Ÿ
, 
g
) < 0) {

1851 
ş—nup
;

1853 
	`INFO
(
p
, "%s", "Searching information flow graph.");

1854 
»tv®
 = 
	`­Ş_šfoæow_ª®ysis_do_mÜe
(
p
, *
g
, 
Ÿ
->
ty³
, 
v
);

1855 
ş—nup
:

1856 ià(
»tv®
 != 0) {

1857 
	`­Ş_šfoæow_g¿ph_de¡roy
(
g
);

1859  
»tv®
;

1860 
	}
}

1862 
	$­Ş_šfoæow_ª®ysis_do_mÜe
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_šfoæow_g¿ph_t
 * 
g
, cÚ¡ *
ty³
, 
­Ş_veùÜ_t
 ** 
v
)

1864 cÚ¡ 
qpŞ_ty³_t
 *
¡¬t_ty³
;

1865 
»tv®
 = -1;

1866 ià(
v
 !ğ
NULL
) {

1867 *
v
 = 
NULL
;

1869 ià(
p
 =ğ
NULL
 || 
g
 =ğNULL || 
ty³
 =ğNULL || 
v
 == NULL) {

1870 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
EINVAL
));

1871 
ş—nup
;

1874 ià(
	`­Ş_qu”y_g‘_ty³
(
p
, 
ty³
, &
¡¬t_ty³
) < 0) {

1875 
ş—nup
;

1878 ià((*
v
 = 
	`­Ş_veùÜ_ü—‹
(
šfoæow_»suÉ_ä“
)è=ğ
NULL
) {

1879 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

1880 
ş—nup
;

1883 ià((
g
->
mode
 =ğ
APOL_INFOFLOW_MODE_DIRECT
 &&

1884 
	`­Ş_šfoæow_ª®ysis_dœeù
(
p
, 
g
, 
ty³
, *
v
) < 0) ||

1885 (
g
->
mode
 =ğ
APOL_INFOFLOW_MODE_TRANS
 && 
	`­Ş_šfoæow_ª®ysis_Œªs
(
p
, g, 
ty³
, *
v
) < 0)) {

1886 
ş—nup
;

1889 
»tv®
 = 0;

1890 
ş—nup
:

1891 ià(
»tv®
 != 0) {

1892 
	`­Ş_veùÜ_de¡roy
(
v
);

1894  
»tv®
;

1895 
	}
}

1897 
	$­Ş_šfoæow_ª®ysis_Œªs_fu¹h”_´•¬e
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
,

1898 
­Ş_šfoæow_g¿ph_t
 * 
g
, cÚ¡ *
¡¬t_ty³
, cÚ¡ *
’d_ty³
)

1900 cÚ¡ 
qpŞ_ty³_t
 *
¡y³
, *
‘y³
;

1901 
»tv®
 = -1;

1903 
	`­Ş_šfoæow_¤ªd
(
g
);

1904 ià(
	`­Ş_qu”y_g‘_ty³
(
p
, 
¡¬t_ty³
, &
¡y³
è< 0 ||‡pŞ_qu”y_g‘_ty³Õ, 
’d_ty³
, &
‘y³
) < 0) {

1905 
ş—nup
;

1907 ià(
g
->
mode
 !ğ
APOL_INFOFLOW_MODE_TRANS
) {

1908 
	`ERR
(
p
, "%s", "May only…erform further infoflow‡nalysis whenhe graph isransitive.");

1909 
ş—nup
;

1911 
	`­Ş_veùÜ_de¡roy
(&
g
->
fu¹h”_¡¬t
);

1912 
	`­Ş_veùÜ_de¡roy
(&
g
->
fu¹h”_’d
);

1913 ià((
g
->
fu¹h”_¡¬t
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)è=ğNULL || (g->
fu¹h”_’d
 =‡pol_vector_create(NULL)) == NULL) {

1914 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

1915 
ş—nup
;

1917 ià(
	`­Ş_šfoæow_g¿ph_g‘_nodes_fÜ_ty³
(
p
, 
g
, 
¡¬t_ty³
, g->
fu¹h”_¡¬t
) < 0 ||

1918 
	`­Ş_šfoæow_g¿ph_g‘_nodes_fÜ_ty³
(
p
, 
g
, 
’d_ty³
, g->
fu¹h”_’d
) < 0) {

1919 
ş—nup
;

1921 
g
->
cu¼’t_¡¬t
 = 0;

1922 
»tv®
 = 0;

1923 
ş—nup
:

1924  
»tv®
;

1925 
	}
}

1927 
	$­Ş_šfoæow_ª®ysis_Œªs_fu¹h”_Ãxt
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_šfoæow_g¿ph_t
 * 
g
, 
­Ş_veùÜ_t
 ** 
v
)

1929 
­Ş_šfoæow_node_t
 *
¡¬t_node
;

1930 
»tv®
 = -1;

1931 ià(
p
 =ğ
NULL
 || 
g
 =ğNULL || 
v
 == NULL) {

1932 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
EINVAL
));

1933 
”ºo
 = 
EINVAL
;

1936 ià(*
v
 =ğ
NULL
) {

1937 *
v
 = 
	`­Ş_veùÜ_ü—‹
(
šfoæow_»suÉ_ä“
);

1939 ià(
g
->
fu¹h”_¡¬t
 =ğ
NULL
) {

1940 
	`ERR
(
p
, "%s", "Infoflow graph was‚ot…repared yet.");

1941 
ş—nup
;

1943 
¡¬t_node
 = 
	`­Ş_veùÜ_g‘_–em’t
(
g
->
fu¹h”_¡¬t
, g->
cu¼’t_¡¬t
);

1944 ià(
	`­Ş_šfoæow_ª®ysis_Œªs_fu¹h”
(
p
, 
g
, 
¡¬t_node
, *
v
) < 0) {

1945 
ş—nup
;

1947 
g
->
cu¼’t_¡¬t
++;

1948 ià(
g
->
cu¼’t_¡¬t
 >ğ
	`­Ş_veùÜ_g‘_size
(g->
fu¹h”_¡¬t
)) {

1949 
g
->
cu¼’t_¡¬t
 = 0;

1951 
»tv®
 = 0;

1952 
ş—nup
:

1953  
»tv®
;

1954 
	}
}

1956 
­Ş_šfoæow_ª®ysis_t
 *
	$­Ş_šfoæow_ª®ysis_ü—‹
()

1958  
	`ÿÎoc
(1, (
­Ş_šfoæow_ª®ysis_t
));

1959 
	}
}

1961 
	$­Ş_šfoæow_ª®ysis_de¡roy
(
­Ş_šfoæow_ª®ysis_t
 ** 
Ÿ
)

1963 ià(*
Ÿ
 !ğ
NULL
) {

1964 
	`ä“
((*
Ÿ
)->
ty³
);

1965 
	`ä“
((*
Ÿ
)->
»suÉ
);

1966 
	`­Ş_veùÜ_de¡roy
(&(*
Ÿ
)->
š‹rmed
);

1967 
	`­Ş_veùÜ_de¡roy
(&(*
Ÿ
)->
şass_³rms
);

1968 
	`ä“
(*
Ÿ
);

1969 *
Ÿ
 = 
NULL
;

1971 
	}
}

1973 
	$­Ş_šfoæow_ª®ysis_£t_mode
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_šfoæow_ª®ysis_t
 * 
Ÿ
, 
mode
)

1975 
mode
) {

1976 
APOL_INFOFLOW_MODE_DIRECT
:

1977 
APOL_INFOFLOW_MODE_TRANS
:

1979 
Ÿ
->
mode
 = mode;

1984 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
EINVAL
));

1989 
	}
}

1991 
	$­Ş_šfoæow_ª®ysis_£t_dœ
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_šfoæow_ª®ysis_t
 * 
Ÿ
, 
dœ
)

1993 
dœ
) {

1994 
APOL_INFOFLOW_IN
:

1995 
APOL_INFOFLOW_OUT
:

1996 
APOL_INFOFLOW_BOTH
:

1997 
APOL_INFOFLOW_EITHER
:

1999 
Ÿ
->
dœeùiÚ
 = 
dœ
;

2004 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
EINVAL
));

2009 
	}
}

2011 
	$­Ş_šfoæow_ª®ysis_£t_ty³
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_šfoæow_ª®ysis_t
 * 
Ÿ
, cÚ¡ *
Çme
)

2013 ià(
Çme
 =ğ
NULL
) {

2014 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
EINVAL
));

2017  
	`­Ş_qu”y_£t
(
p
, &
Ÿ
->
ty³
, 
NULL
, 
Çme
);

2018 
	}
}

2020 
com·»_şass_³rm_by_şass_Çme
(cÚ¡ *
š_İ
, cÚ¡ *
şass_Çme
, *
unu£d
 
__©Œibu‹__
 ((unused)))

2022 cÚ¡ 
­Ş_obj_³rm_t
 *
	gİ
 = (cÚ¡‡pŞ_obj_³rm_ˆ*)
š_İ
;

2023 cÚ¡ *
	gÇme
 = (cÚ¡ *)
şass_Çme
;

2025  
¡rcmp
(
­Ş_obj_³rm_g‘_obj_Çme
(
İ
), 
Çme
);

2028 
	$­Ş_šfoæow_ª®ysis_­³nd_š‹rmedŸ‹
(cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
, 
­Ş_šfoæow_ª®ysis_t
 * 
Ÿ
, cÚ¡ *
ty³
)

2030 *
tmp
 = 
NULL
;

2031 ià(
ty³
 =ğ
NULL
) {

2032 
	`­Ş_veùÜ_de¡roy
(&
Ÿ
->
š‹rmed
);

2035 ià(
Ÿ
->
š‹rmed
 =ğ
NULL
 && (Ÿ->š‹rmed = 
	`­Ş_veùÜ_ü—‹
(
ä“
)) == NULL) {

2036 
	`ERR
(
pŞicy
, "E¼Ü‡µ’dšgy³Øª®ysis: %s", 
	`¡»¼Ü
(
ENOMEM
));

2039 ià((
tmp
 = 
	`¡rdup
(
ty³
)è=ğ
NULL
 || 
	`­Ş_veùÜ_­³nd
(
Ÿ
->
š‹rmed
,mp) < 0) {

2040 
	`ä“
(
tmp
);

2041 
	`ERR
(
pŞicy
, "E¼Ü‡µ’dšgy³Øª®ysis: %s", 
	`¡»¼Ü
(
ENOMEM
));

2045 
	}
}

2047 
	$­Ş_šfoæow_ª®ysis_­³nd_şass_³rm
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
,

2048 
­Ş_šfoæow_ª®ysis_t
 * 
Ÿ
, cÚ¡ *
şass_Çme
, cÚ¡ *
³rm_Çme
)

2050 
­Ş_obj_³rm_t
 *
İ
 = 
NULL
;

2051 
size_t
 
i
;

2053 ià(
p
 =ğ
NULL
 || 
Ÿ
 == NULL) {

2054 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
EINVAL
));

2055 
”ºo
 = 
EINVAL
;

2058 ià(
şass_Çme
 =ğ
NULL
) {

2059 
	`­Ş_veùÜ_de¡roy
(&
Ÿ
->
şass_³rms
);

2062 ià(
³rm_Çme
 =ğ
NULL
) {

2063 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
EINVAL
));

2064 
”ºo
 = 
EINVAL
;

2067 ià(
Ÿ
->
şass_³rms
 =ğ
NULL
 && (Ÿ->şass_³rm ğ
	`­Ş_veùÜ_ü—‹
(
­Ş_obj_³rm_ä“
)) == NULL) {

2068 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

2072 ià(
	`­Ş_veùÜ_g‘_šdex
(
Ÿ
->
şass_³rms
, (*)
şass_Çme
, 
com·»_şass_³rm_by_şass_Çme
, 
NULL
, &
i
) < 0) {

2073 ià(
³rm_Çme
) {

2074 ià((
İ
 = 
	`­Ş_obj_³rm_ü—‹
()è=ğ
NULL
) {

2075 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

2078 ià(
	`­Ş_obj_³rm_£t_obj_Çme
(
İ
, 
şass_Çme
) ||

2079 
	`­Ş_obj_³rm_­³nd_³rm
(
İ
, 
³rm_Çme
è|| 
	`­Ş_veùÜ_­³nd
(
Ÿ
->
şass_³rms
, op)) {

2080 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

2081 
	`­Ş_obj_³rm_ä“
(
İ
);

2088 
İ
 = 
	`­Ş_veùÜ_g‘_–em’t
(
Ÿ
->
şass_³rms
, 
i
);

2089 ià(
	`­Ş_obj_³rm_­³nd_³rm
(
İ
, 
³rm_Çme
)) {

2090 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

2095 
	}
}

2097 
­Ş_šfoæow_ª®ysis_£t_mš_weight
(cÚ¡ 
­Ş_pŞicy_t
 * 
p


2098 
__©Œibu‹__
 ((
unu£d
)), 
­Ş_šfoæow_ª®ysis_t
 * 
Ÿ
, 
mš_weight
)

2100 ià(
	gmš_weight
 <= 0) {

2101 
Ÿ
->
mš_weight
 = 0;

2102 } ià(
	gmš_weight
 >ğ
APOL_PERMMAP_MAX_WEIGHT
) {

2103 
Ÿ
->
mš_weight
 = 
APOL_PERMMAP_MAX_WEIGHT
;

2105 
	gŸ
->
	gmš_weight
 = 
mš_weight
;

2110 
	$­Ş_šfoæow_ª®ysis_£t_»suÉ_»gex
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_šfoæow_ª®ysis_t
 * 
Ÿ
, cÚ¡ *
»suÉ
)

2112  
	`­Ş_qu”y_£t
(
p
, &
Ÿ
->
»suÉ
, 
NULL
,„esult);

2113 
	}
}

2117 
	$­Ş_šfoæow_»suÉ_g‘_dœ
(cÚ¡ 
­Ş_šfoæow_»suÉ_t
 * 
»suÉ
)

2119 ià(!
»suÉ
) {

2120 
”ºo
 = 
EINVAL
;

2123  
»suÉ
->
dœeùiÚ
;

2124 
	}
}

2126 cÚ¡ 
qpŞ_ty³_t
 *
	$­Ş_šfoæow_»suÉ_g‘_¡¬t_ty³
(cÚ¡ 
­Ş_šfoæow_»suÉ_t
 * 
»suÉ
)

2128 ià(!
»suÉ
) {

2129 
”ºo
 = 
EINVAL
;

2130  
NULL
;

2132  
»suÉ
->
¡¬t_ty³
;

2133 
	}
}

2135 cÚ¡ 
qpŞ_ty³_t
 *
	$­Ş_šfoæow_»suÉ_g‘_’d_ty³
(cÚ¡ 
­Ş_šfoæow_»suÉ_t
 * 
»suÉ
)

2137 ià(!
»suÉ
) {

2138 
”ºo
 = 
EINVAL
;

2139  
NULL
;

2141  
»suÉ
->
’d_ty³
;

2142 
	}
}

2144 
	$­Ş_šfoæow_»suÉ_g‘_Ëngth
(cÚ¡ 
­Ş_šfoæow_»suÉ_t
 * 
»suÉ
)

2146 ià(!
»suÉ
) {

2147 
”ºo
 = 
EINVAL
;

2150 
	`as£¹
(
»suÉ
->
Ëngth
 != 0);

2151  
»suÉ
->
Ëngth
;

2152 
	}
}

2154 cÚ¡ 
­Ş_veùÜ_t
 *
	$­Ş_šfoæow_»suÉ_g‘_¡•s
(cÚ¡ 
­Ş_šfoæow_»suÉ_t
 * 
»suÉ
)

2156 ià(!
»suÉ
) {

2157 
”ºo
 = 
EINVAL
;

2158  
NULL
;

2160  
»suÉ
->
¡•s
;

2161 
	}
}

2163 cÚ¡ 
qpŞ_ty³_t
 *
	$­Ş_šfoæow_¡•_g‘_¡¬t_ty³
(cÚ¡ 
­Ş_šfoæow_¡•_t
 * 
¡•
)

2165 ià(!
¡•
) {

2166 
”ºo
 = 
EINVAL
;

2167  
NULL
;

2169  
¡•
->
¡¬t_ty³
;

2170 
	}
}

2172 cÚ¡ 
qpŞ_ty³_t
 *
	$­Ş_šfoæow_¡•_g‘_’d_ty³
(cÚ¡ 
­Ş_šfoæow_¡•_t
 * 
¡•
)

2174 ià(!
¡•
) {

2175 
”ºo
 = 
EINVAL
;

2176  
NULL
;

2178  
¡•
->
’d_ty³
;

2179 
	}
}

2181 
	$­Ş_šfoæow_¡•_g‘_weight
(cÚ¡ 
­Ş_šfoæow_¡•_t
 * 
¡•
)

2183 ià(!
¡•
) {

2184 
”ºo
 = 
EINVAL
;

2187  
¡•
->
weight
;

2188 
	}
}

2190 cÚ¡ 
­Ş_veùÜ_t
 *
	$­Ş_šfoæow_¡•_g‘_ruËs
(cÚ¡ 
­Ş_šfoæow_¡•_t
 * 
¡•
)

2192 ià(!
¡•
) {

2193 
”ºo
 = 
EINVAL
;

2194  
NULL
;

2196  
¡•
->
ruËs
;

2197 
	}
}

2201 
­Ş_šfoæow_»suÉ_t
 *
	$šfoæow_»suÉ_ü—‹_äom_šfoæow_»suÉ
(cÚ¡ 
­Ş_šfoæow_»suÉ_t
 * 
»suÉ
)

2203 
­Ş_šfoæow_»suÉ_t
 *
Ãw_r
 = 
NULL
;

2204 
­Ş_šfoæow_¡•_t
 *
¡•
, *
Ãw_¡•
;

2205 
size_t
 
i
;

2206 
»tv®
 = -1;

2208 ià((
Ãw_r
 = 
	`ÿÎoc
(1, (*Ãw_r))è=ğ
NULL
 ||

2209 (
Ãw_r
->
¡•s
 = 
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(
	`­Ş_veùÜ_g‘_size
(
»suÉ
->¡•s), 
­Ş_šfoæow_¡•_ä“
)è=ğ
NULL
)

2211 
ş—nup
;

2213 
Ãw_r
->
¡¬t_ty³
 = 
»suÉ
->start_type;

2214 
Ãw_r
->
’d_ty³
 = 
»suÉ
->end_type;

2215 
Ãw_r
->
dœeùiÚ
 = 
»suÉ
->direction;

2216 
Ãw_r
->
Ëngth
 = 
»suÉ
->length;

2217 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
»suÉ
->
¡•s
); i++) {

2218 
¡•
 = (
­Ş_šfoæow_¡•_t
 *è
	`­Ş_veùÜ_g‘_–em’t
(
»suÉ
->
¡•s
, 
i
);

2219 ià((
Ãw_¡•
 = 
	`ÿÎoc
(1, (*Ãw_¡•))è=ğ
NULL
 ||

2220 (
Ãw_¡•
->
ruËs
 = 
	`­Ş_veùÜ_ü—‹_äom_veùÜ
(
¡•
->ruËs, 
NULL
, NULL, NULL)) == NULL ||

2221 
	`­Ş_veùÜ_­³nd
(
Ãw_r
->
¡•s
, 
Ãw_¡•
) < 0) {

2222 
	`­Ş_šfoæow_¡•_ä“
(
Ãw_¡•
);

2223 
ş—nup
;

2225 
Ãw_¡•
->
¡¬t_ty³
 = 
¡•
->start_type;

2226 
Ãw_¡•
->
’d_ty³
 = 
¡•
->end_type;

2227 
Ãw_¡•
->
weight
 = 
¡•
->weight;

2229 
»tv®
 = 0;

2230 
ş—nup
:

2231 ià(
»tv®
 != 0) {

2232 
	`šfoæow_»suÉ_ä“
(
Ãw_r
);

2233  
NULL
;

2235  
Ãw_r
;

2236 
	}
}

2238 
	$šfoæow_»suÉ_ä“
(*
»suÉ
)

2240 ià(
»suÉ
 !ğ
NULL
) {

2241 
­Ş_šfoæow_»suÉ_t
 *
r
 = (­Ş_šfoæow_»suÉ_ˆ*è
»suÉ
;

2242 
	`­Ş_veùÜ_de¡roy
(&
r
->
¡•s
);

2243 
	`ä“
(
r
);

2245 
	}
}

	@libapol/src/isid-query.c

30 
	~"pŞicy-qu”y-š‹º®.h
"

32 
	~<”ºo.h
>

34 
	s­Ş_isid_qu”y


36 *
	mÇme
;

37 
­Ş_cÚ‹xt_t
 *
	mcÚ‹xt
;

38 
	mæags
;

43 
	$­Ş_isid_g‘_by_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
­Ş_isid_qu”y_t
 * 
i
, 
­Ş_veùÜ_t
 ** 
v
)

45 
qpŞ_™”©Ü_t
 *
™”
;

46 
»tv®
 = -1, 
»tv®2
;

47 cÚ¡ 
qpŞ_isid_t
 *
isid
 = 
NULL
;

48 *
v
 = 
NULL
;

49 ià(
	`qpŞ_pŞicy_g‘_isid_™”
(
p
->p, &
™”
) < 0) {

52 ià((*
v
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)) == NULL) {

53 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

54 
ş—nup
;

56 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

57 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
isid
) < 0) {

58 
ş—nup
;

60 ià(
i
 !ğ
NULL
) {

61 cÚ¡ *
Çme
;

62 cÚ¡ 
qpŞ_cÚ‹xt_t
 *
cÚ‹xt
;

63 ià(
	`qpŞ_isid_g‘_Çme
(
p
->p, 
isid
, &
Çme
è< 0 || 
	`qpŞ_isid_g‘_cÚ‹xt
Õ->p, isid, &
cÚ‹xt
) < 0) {

64 
ş—nup
;

66 
»tv®2
 = 
	`­Ş_com·»
(
p
, 
Çme
, 
i
->Çme, 0, 
NULL
);

67 ià(
»tv®2
 < 0) {

68 
ş—nup
;

69 } ià(
»tv®2
 == 0) {

72 
»tv®2
 = 
	`­Ş_com·»_cÚ‹xt
(
p
, 
cÚ‹xt
, 
i
->cÚ‹xt, i->
æags
);

73 ià(
»tv®2
 < 0) {

74 
ş—nup
;

75 } ià(
»tv®2
 == 0) {

79 ià(
	`­Ş_veùÜ_­³nd
(*
v
, (*)
isid
)) {

80 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

81 
ş—nup
;

85 
»tv®
 = 0;

86 
ş—nup
:

87 ià(
»tv®
 != 0) {

88 
	`­Ş_veùÜ_de¡roy
(
v
);

90 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

91  
»tv®
;

92 
	}
}

94 
­Ş_isid_qu”y_t
 *
	$­Ş_isid_qu”y_ü—‹
()

96  
	`ÿÎoc
(1, (
­Ş_isid_qu”y_t
));

97 
	}
}

99 
	$­Ş_isid_qu”y_de¡roy
(
­Ş_isid_qu”y_t
 ** 
i
)

101 ià(*
i
 !ğ
NULL
) {

102 
	`ä“
((*
i
)->
Çme
);

103 
	`­Ş_cÚ‹xt_de¡roy
(&((*
i
)->
cÚ‹xt
));

104 
	`ä“
(*
i
);

105 *
i
 = 
NULL
;

107 
	}
}

109 
	$­Ş_isid_qu”y_£t_Çme
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_isid_qu”y_t
 * 
i
, cÚ¡ *
Çme
)

111  
	`­Ş_qu”y_£t
(
p
, &
i
->
Çme
, 
NULL
,‚ame);

112 
	}
}

114 
­Ş_isid_qu”y_£t_cÚ‹xt
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
 
__©Œibu‹__
 ((
unu£d
)),

115 
­Ş_isid_qu”y_t
 * 
i
, 
­Ş_cÚ‹xt_t
 * 
cÚ‹xt
, 
¿nge_m©ch
)

117 ià(
	gi
->
	gcÚ‹xt
 !ğ
NULL
) {

118 
­Ş_cÚ‹xt_de¡roy
(&
i
->
cÚ‹xt
);

120 
	gi
->
	gcÚ‹xt
 = 
cÚ‹xt
;

121 
	gi
->
	gæags
 = (
i
->
æags
 & ~
APOL_QUERY_FLAGS
è| 
¿nge_m©ch
;

	@libapol/src/mls-query.c

25 
	~<cÚfig.h
>

27 
	~<as£¹.h
>

28 
	~<”ºo.h
>

29 
	~<»gex.h
>

30 
	~<¡dlib.h
>

31 
	~<¡ršg.h
>

33 
	~<qpŞ/™”©Ü.h
>

35 
	~"pŞicy-qu”y-š‹º®.h
"

36 
	~<­Ş/veùÜ.h
>

38 
	s­Ş_Ëv–_qu”y


40 *
	m£ns_Çme
, *
	mÿt_Çme
;

41 
	mæags
;

42 
»gex_t
 *
	m£ns_»gex
, *
	mÿt_»gex
;

45 
	s­Ş_ÿt_qu”y


47 *
	mÿt_Çme
;

48 
	mæags
;

49 
»gex_t
 *
	m»gex
;

52 
	$­Ş_mls_£ns_com·»
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ *
£ns1
, cÚ¡ *
£ns2
)

54 cÚ¡ 
qpŞ_Ëv–_t
 *
Ëv–_d©um1
, *
Ëv–_d©um2
;

55 ià(
	`qpŞ_pŞicy_g‘_Ëv–_by_Çme
(
p
->p, 
£ns1
, &
Ëv–_d©um1
) < 0 ||

56 
	`qpŞ_pŞicy_g‘_Ëv–_by_Çme
(
p
->p, 
£ns2
, &
Ëv–_d©um2
) < 0) {

59 ià(
Ëv–_d©um1
 =ğ
Ëv–_d©um2
) {

63 
	}
}

65 
	$­Ş_mls_ÿts_com·»
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ *
ÿt1
, cÚ¡ *
ÿt2
)

67 cÚ¡ 
qpŞ_ÿt_t
 *
qÿt1
, *
qÿt2
;

68 ià(
	`qpŞ_pŞicy_g‘_ÿt_by_Çme
(
p
->p, 
ÿt1
, &
qÿt1
è< 0 || qpŞ_pŞicy_g‘_ÿt_by_ÇmeÕ->p, 
ÿt2
, &
qÿt2
) < 0) {

71 ià(
qÿt1
 =ğ
qÿt2
) {

75 
	}
}

79 
	$­Ş_Ëv–_g‘_by_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_Ëv–_qu”y_t
 * 
l
, 
­Ş_veùÜ_t
 ** 
v
)

81 
qpŞ_™”©Ü_t
 *
™”
, *
ÿt_™”
 = 
NULL
;

82 
»tv®
 = -1, 
­³nd_Ëv–
;

83 *
v
 = 
NULL
;

84 ià(
	`qpŞ_pŞicy_g‘_Ëv–_™”
(
p
->p, &
™”
) < 0) {

87 ià((*
v
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)) == NULL) {

88 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

89 
ş—nup
;

91 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

92 
qpŞ_Ëv–_t
 *
Ëv–
;

93 
i§lŸs
;

94 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
Ëv–
è< 0 || 
	`qpŞ_Ëv–_g‘_i§lŸs
(
p
->p,†ev–, &
i§lŸs
) < 0) {

95 
ş—nup
;

97 ià(
i§lŸs
) {

100 
­³nd_Ëv–
 = 1;

101 ià(
l
 !ğ
NULL
) {

102 
compv®
 = 
	`­Ş_com·»_Ëv–
(
p
,

103 
Ëv–
, 
l
->
£ns_Çme
,

104 
l
->
æags
, &Ö->
£ns_»gex
));

105 ià(
compv®
 < 0) {

106 
ş—nup
;

107 } ià(
compv®
 == 0) {

110 ià(
	`qpŞ_Ëv–_g‘_ÿt_™”
(
p
->p, 
Ëv–
, &
ÿt_™”
) < 0) {

111 
ş—nup
;

113 
­³nd_Ëv–
 = 0;

114 ; !
	`qpŞ_™”©Ü_’d
(
ÿt_™”
); 
	`qpŞ_™”©Ü_Ãxt
(cat_iter)) {

115 
qpŞ_ÿt_t
 *
ÿt
;

116 ià(
	`qpŞ_™”©Ü_g‘_™em
(
ÿt_™”
, (**)&
ÿt
) < 0) {

117 
ş—nup
;

119 
compv®
 = 
	`­Ş_com·»_ÿt
(
p
, 
ÿt
, 
l
->
ÿt_Çme
,†->
æags
, &Ö->
ÿt_»gex
));

120 ià(
compv®
 < 0) {

121 
ş—nup
;

122 } ià(
compv®
 == 1) {

123 
­³nd_Ëv–
 = 1;

127 
	`qpŞ_™”©Ü_de¡roy
(&
ÿt_™”
);

129 ià(
­³nd_Ëv–
 && 
	`­Ş_veùÜ_­³nd
(*
v
, 
Ëv–
)) {

130 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

131 
ş—nup
;

135 
»tv®
 = 0;

136 
ş—nup
:

137 ià(
»tv®
 != 0) {

138 
	`­Ş_veùÜ_de¡roy
(
v
);

140 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

141 
	`qpŞ_™”©Ü_de¡roy
(&
ÿt_™”
);

142  
»tv®
;

143 
	}
}

145 
­Ş_Ëv–_qu”y_t
 *
	$­Ş_Ëv–_qu”y_ü—‹
()

147  
	`ÿÎoc
(1, (
­Ş_Ëv–_qu”y_t
));

148 
	}
}

150 
	$­Ş_Ëv–_qu”y_de¡roy
(
­Ş_Ëv–_qu”y_t
 ** 
l
)

152 ià(*
l
 !ğ
NULL
) {

153 
	`ä“
((*
l
)->
£ns_Çme
);

154 
	`ä“
((*
l
)->
ÿt_Çme
);

155 
	`­Ş_»gex_de¡roy
(&(*
l
)->
£ns_»gex
);

156 
	`­Ş_»gex_de¡roy
(&(*
l
)->
ÿt_»gex
);

157 
	`ä“
(*
l
);

158 *
l
 = 
NULL
;

160 
	}
}

162 
	$­Ş_Ëv–_qu”y_£t_£ns
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_Ëv–_qu”y_t
 * 
l
, cÚ¡ *
Çme
)

164  
	`­Ş_qu”y_£t
(
p
, &
l
->
£ns_Çme
, &l->
£ns_»gex
, 
Çme
);

165 
	}
}

167 
	$­Ş_Ëv–_qu”y_£t_ÿt
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_Ëv–_qu”y_t
 * 
l
, cÚ¡ *
Çme
)

169  
	`­Ş_qu”y_£t
(
p
, &
l
->
ÿt_Çme
, &l->
ÿt_»gex
, 
Çme
);

170 
	}
}

172 
	$­Ş_Ëv–_qu”y_£t_»gex
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_Ëv–_qu”y_t
 * 
l
, 
is_»gex
)

174  
	`­Ş_qu”y_£t_»gex
(
p
, &
l
->
æags
, 
is_»gex
);

175 
	}
}

179 
	$­Ş_ÿt_g‘_by_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_ÿt_qu”y_t
 * 
c
, 
­Ş_veùÜ_t
 ** 
v
)

181 
qpŞ_™”©Ü_t
 *
™”
;

182 
»tv®
 = -1;

183 *
v
 = 
NULL
;

184 ià(
	`qpŞ_pŞicy_g‘_ÿt_™”
(
p
->p, &
™”
) < 0) {

187 ià((*
v
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)) == NULL) {

188 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

189 
ş—nup
;

191 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

192 
qpŞ_ÿt_t
 *
ÿt
;

193 
i§lŸs
;

194 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
ÿt
è< 0 || 
	`qpŞ_ÿt_g‘_i§lŸs
(
p
->p, c©, &
i§lŸs
) < 0) {

195 
ş—nup
;

197 ià(
i§lŸs
) {

200 ià(
c
 !ğ
NULL
) {

201 
compv®
 = 
	`­Ş_com·»_ÿt
(
p
,

202 
ÿt
, 
c
->
ÿt_Çme
,

203 
c
->
æags
, &(c->
»gex
));

204 ià(
compv®
 < 0) {

205 
ş—nup
;

206 } ià(
compv®
 == 0) {

210 ià(
	`­Ş_veùÜ_­³nd
(*
v
, 
ÿt
)) {

211 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

212 
ş—nup
;

216 
»tv®
 = 0;

217 
ş—nup
:

218 ià(
»tv®
 != 0) {

219 
	`­Ş_veùÜ_de¡roy
(
v
);

221 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

222  
»tv®
;

223 
	}
}

225 
­Ş_ÿt_qu”y_t
 *
	$­Ş_ÿt_qu”y_ü—‹
()

227  
	`ÿÎoc
(1, (
­Ş_ÿt_qu”y_t
));

228 
	}
}

230 
	$­Ş_ÿt_qu”y_de¡roy
(
­Ş_ÿt_qu”y_t
 ** 
c
)

232 ià(*
c
 !ğ
NULL
) {

233 
	`ä“
((*
c
)->
ÿt_Çme
);

234 
	`­Ş_»gex_de¡roy
(&(*
c
)->
»gex
);

235 
	`ä“
(*
c
);

236 *
c
 = 
NULL
;

238 
	}
}

240 
	$­Ş_ÿt_qu”y_£t_ÿt
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_ÿt_qu”y_t
 * 
c
, cÚ¡ *
Çme
)

242  
	`­Ş_qu”y_£t
(
p
, &
c
->
ÿt_Çme
, &c->
»gex
, 
Çme
);

243 
	}
}

245 
	$­Ş_ÿt_qu”y_£t_»gex
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_ÿt_qu”y_t
 * 
c
, 
is_»gex
)

247  
	`­Ş_qu”y_£t_»gex
(
p
, &
c
->
æags
, 
is_»gex
);

248 
	}
}

	@libapol/src/mls_level.c

25 
	~<cÚfig.h
>

27 
	~<­Ş/mls_Ëv–.h
>

29 
	~<as£¹.h
>

30 
	~<ùy³.h
>

31 
	~<”ºo.h
>

32 
	~<¡dlib.h
>

33 
	~<¡ršg.h
>

35 
	~"pŞicy-qu”y-š‹º®.h
"

37 
	~<qpŞ/™”©Ü.h
>

38 
	~<­Ş/veùÜ.h
>

40 
	s­Ş_mls_Ëv–


42 *
	m£ns
;

43 
­Ş_veùÜ_t
 *
	mÿts
;

44 *
	ml™”®_ÿts
;

53 
	$­Ş_mls_ÿt_veùÜ_com·»
(cÚ¡ *
a
, cÚ¡ *
b
, *
d©a
)

55 cÚ¡ 
qpŞ_ÿt_t
 *
ÿt1
 = 
a
;

56 cÚ¡ *
ÿt2_Çme
 = 
b
;

57 
­Ş_pŞicy_t
 *
p
 = (­Ş_pŞicy_ˆ*è
d©a
;

58 cÚ¡ 
qpŞ_ÿt_t
 *
ÿt2
;

59 
ušt32_t
 
ÿt_v®ue1
, 
ÿt_v®ue2
;

60 ià(
	`qpŞ_pŞicy_g‘_ÿt_by_Çme
(
p
->p, 
ÿt2_Çme
, &
ÿt2
) < 0) {

63 ià(
	`qpŞ_ÿt_g‘_v®ue
(
p
->p, 
ÿt1
, &
ÿt_v®ue1
è< 0 || qpŞ_ÿt_g‘_v®ueÕ->p, 
ÿt2
, &
ÿt_v®ue2
) < 0) {

66  (
ÿt_v®ue2
 - 
ÿt_v®ue1
);

67 
	}
}

82 
	$­Ş_mls_ÿt_Çme_com·»
(cÚ¡ *
a
, cÚ¡ *
b
, *
d©a
)

84 cÚ¡ *
ÿt1
 = 
a
;

85 cÚ¡ *
ÿt2
 = 
b
;

86 
­Ş_pŞicy_t
 *
p
 = (­Ş_pŞicy_ˆ*è
d©a
;

87 cÚ¡ 
qpŞ_ÿt_t
 *
qÿt1
, *
qÿt2
;

88 
ušt32_t
 
ÿt_v®ue1
, 
ÿt_v®ue2
;

89 ià(
	`qpŞ_pŞicy_g‘_ÿt_by_Çme
(
p
->p, 
ÿt1
, &
qÿt1
è< 0 || qpŞ_pŞicy_g‘_ÿt_by_ÇmeÕ->p, 
ÿt2
, &
qÿt2
) < 0) {

92 ià(
	`qpŞ_ÿt_g‘_v®ue
(
p
->p, 
qÿt1
, &
ÿt_v®ue1
è< 0 || qpŞ_ÿt_g‘_v®ueÕ->p, 
qÿt2
, &
ÿt_v®ue2
) < 0) {

95  (
ÿt_v®ue1
 - 
ÿt_v®ue2
);

96 
	}
}

100 
­Ş_mls_Ëv–_t
 *
	$­Ş_mls_Ëv–_ü—‹
()

102 
­Ş_mls_Ëv–_t
 *
l
;

103 ià((
l
 = 
	`ÿÎoc
(1, (*l))è=ğ
NULL
 || (l->
ÿts
 = 
	`­Ş_veùÜ_ü—‹
(
ä“
)) == NULL) {

104 
	`­Ş_mls_Ëv–_de¡roy
(&
l
);

105  
NULL
;

107  
l
;

108 
	}
}

110 
­Ş_mls_Ëv–_t
 *
	$­Ş_mls_Ëv–_ü—‹_äom_mls_Ëv–
(cÚ¡ 
­Ş_mls_Ëv–_t
 * 
Ëv–
)

112 
­Ş_mls_Ëv–_t
 *
l
;

113 ià((
l
 = 
	`ÿÎoc
(1, (*l))è=ğ
NULL
) {

114  
NULL
;

116 ià(
Ëv–
 !ğ
NULL
) {

117 ià((
Ëv–
->
£ns
 !ğ
NULL
è&& (
l
->£n ğ
	`¡rdup
(level->sens)) == NULL) {

118 
	`­Ş_mls_Ëv–_de¡roy
(&
l
);

119  
NULL
;

121 ià((
Ëv–
->
ÿts
 !ğ
NULL
) &&

122 (
l
->
ÿts
 = 
	`­Ş_veùÜ_ü—‹_äom_veùÜ
(
Ëv–
->ÿts, 
­Ş_¡r_¡rdup
, 
NULL
, 
ä“
)) == NULL) {

123 
	`­Ş_mls_Ëv–_de¡roy
(&
l
);

124  
NULL
;

126 ià((
Ëv–
->
l™”®_ÿts
 !ğ
NULL
è&& (
l
->l™”®_ÿt ğ
	`¡rdup
(level->literal_cats)) == NULL) {

127 
	`­Ş_mls_Ëv–_de¡roy
(&
l
);

128  
NULL
;

131  
l
;

132 
	}
}

134 
­Ş_mls_Ëv–_t
 *
	$­Ş_mls_Ëv–_ü—‹_äom_¡ršg
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ *
mls_Ëv–_¡ršg
)

136 ià(
p
 =ğ
NULL
 || 
mls_Ëv–_¡ršg
 == NULL) {

137 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
EINVAL
));

138 
”ºo
 = 
EINVAL
;

139  
NULL
;

142 
­Ş_mls_Ëv–_t
 *
l
 = 
	`­Ş_mls_Ëv–_ü—‹_äom_l™”®
(
mls_Ëv–_¡ršg
);

143 ià(
l
 =ğ
NULL
) {

144 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

145  
NULL
;

148 ià(
	`­Ş_mls_Ëv–_cÚv”t
(
p
, 
l
) < 0) {

149 
	`­Ş_mls_Ëv–_de¡roy
(&
l
);

150  
NULL
;

152 
	`ä“
(
l
->
l™”®_ÿts
);

153 
l
->
l™”®_ÿts
 = 
NULL
;

154  
l
;

155 
	}
}

157 
­Ş_mls_Ëv–_t
 *
	$­Ş_mls_Ëv–_ü—‹_äom_l™”®
(cÚ¡ *
mls_Ëv–_¡ršg
)

159 
­Ş_mls_Ëv–_t
 *
l
;

160 *
cŞÚ
;

161 ià(
mls_Ëv–_¡ršg
 =ğ
NULL
) {

162 
”ºo
 = 
EINVAL
;

163  
NULL
;

165 ià((
l
 = 
	`ÿÎoc
(1, (*l))è=ğ
NULL
) {

166  
NULL
;

168 ià((
cŞÚ
 = 
	`¡rchr
(
mls_Ëv–_¡ršg
, ':')è!ğ
NULL
) {

170 ià(
cŞÚ
 =ğ
mls_Ëv–_¡ršg
) {

171 
	`­Ş_mls_Ëv–_de¡roy
(&
l
);

172 
”ºo
 = 
EINVAL
;

173  
NULL
;

175 ià((
l
->
£ns
 = 
	`¡ºdup
(
mls_Ëv–_¡ršg
, 
cŞÚ
 - mls_Ëv–_¡ršg)è=ğ
NULL
) {

176 
	`­Ş_mls_Ëv–_de¡roy
(&
l
);

177  
NULL
;

180 ià((
l
->
l™”®_ÿts
 = 
	`¡rdup
(
cŞÚ
 + 1)è=ğ
NULL
) {

181 
	`­Ş_mls_Ëv–_de¡roy
(&
l
);

182  
NULL
;

184 
	`­Ş_¡r_Œim
(
l
->
l™”®_ÿts
);

187 ià((
l
->
£ns
 = 
	`¡rdup
(
mls_Ëv–_¡ršg
)è=ğ
NULL
 || (l->
l™”®_ÿts
 = strdup("")) == NULL) {

188 
	`­Ş_mls_Ëv–_de¡roy
(&
l
);

189  
NULL
;

192 
	`­Ş_¡r_Œim
(
l
->
£ns
);

193  
l
;

194 
	}
}

196 
­Ş_mls_Ëv–_t
 *
	$­Ş_mls_Ëv–_ü—‹_äom_qpŞ_mls_Ëv–
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
qpŞ_mls_Ëv–_t
 * 
qpŞ_Ëv–
)

198 
­Ş_mls_Ëv–_t
 *
lvl
 = 
NULL
;

199 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

200 cÚ¡ 
qpŞ_ÿt_t
 *
tmp_ÿt
 = 
NULL
;

201 cÚ¡ *
tmp
 = 
NULL
;

202 
”rÜ
 = 0;

204 ià(!
p
 || !
qpŞ_Ëv–
) {

205 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
EINVAL
));

206 
”ºo
 = 
EINVAL
;

207 
”r
;

210 ià((
lvl
 = 
	`­Ş_mls_Ëv–_ü—‹
()è=ğ
NULL
) {

211 
”rÜ
 = 
”ºo
;

212 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”rÜ
));

213 
”r
;

215 ià(
	`qpŞ_mls_Ëv–_g‘_£ns_Çme
(
p
->p, 
qpŞ_Ëv–
, &
tmp
è|| 
	`qpŞ_mls_Ëv–_g‘_ÿt_™”
Õ->p, qpŞ_Ëv–, &
™”
)) {

216 
”rÜ
 = 
”ºo
;

217 
”r
;

219 ià(
	`­Ş_mls_Ëv–_£t_£ns
(
p
, 
lvl
, 
tmp
) < 0) {

220 
”rÜ
 = 
”ºo
;

221 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”rÜ
));

222 
”r
;

224 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

225 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
tmp_ÿt
è< 0 || 
	`qpŞ_ÿt_g‘_Çme
(
p
->p,mp_ÿt, &
tmp
) < 0) {

226 
”rÜ
 = 
”ºo
;

227 
”r
;

229 ià(
	`­Ş_mls_Ëv–_­³nd_ÿts
(
p
, 
lvl
, 
tmp
) < 0) {

230 
”rÜ
 = 
”ºo
;

231 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”rÜ
));

232 
”r
;

236 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

237  
lvl
;

239 
”r
:

240 
	`­Ş_mls_Ëv–_de¡roy
(&
lvl
);

241 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

242 
”ºo
 = 
”rÜ
;

243  
NULL
;

244 
	}
}

246 
­Ş_mls_Ëv–_t
 *
	$­Ş_mls_Ëv–_ü—‹_äom_qpŞ_Ëv–_d©um
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
qpŞ_Ëv–_t
 * 
qpŞ_Ëv–
)

248 
­Ş_mls_Ëv–_t
 *
lvl
 = 
NULL
;

249 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

250 cÚ¡ 
qpŞ_ÿt_t
 *
tmp_ÿt
 = 
NULL
;

251 cÚ¡ *
tmp
 = 
NULL
;

252 
”rÜ
 = 0;

254 ià(!
p
 || !
qpŞ_Ëv–
) {

255 
”ºo
 = 
EINVAL
;

256  
NULL
;

259 ià((
lvl
 = 
	`­Ş_mls_Ëv–_ü—‹
()è=ğ
NULL
) {

260 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”rÜ
));

261  
NULL
;

263 ià(
	`qpŞ_Ëv–_g‘_Çme
(
p
->p, 
qpŞ_Ëv–
, &
tmp
)) {

264 
”rÜ
 = 
”ºo
;

265 
”r
;

267 ià((
lvl
->
£ns
 = 
	`¡rdup
(
tmp
)è=ğ
NULL
) {

268 
”rÜ
 = 
”ºo
;

269 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”rÜ
));

270 
”r
;

273 ià(
	`qpŞ_Ëv–_g‘_ÿt_™”
(
p
->p, 
qpŞ_Ëv–
, &
™”
)) {

274 
”rÜ
 = 
”ºo
;

275 
”r
;

278 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

279 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
tmp_ÿt
)) {

280 
”rÜ
 = 
”ºo
;

281 
”r
;

283 ià(
	`qpŞ_ÿt_g‘_Çme
(
p
->p, 
tmp_ÿt
, &
tmp
)) {

284 
”rÜ
 = 
”ºo
;

285 
”r
;

287 ià(
	`­Ş_mls_Ëv–_­³nd_ÿts
(
p
, 
lvl
, 
tmp
)) {

288 
”rÜ
 = 
”ºo
;

289 
”r
;

292 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

293  
lvl
;

295 
”r
:

296 
	`­Ş_mls_Ëv–_de¡roy
(&
lvl
);

297 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

298 
”ºo
 = 
”rÜ
;

299  
NULL
;

300 
	}
}

302 
	$mls_Ëv–_ä“
(*
Ëv–
)

304 ià(
Ëv–
 !ğ
NULL
) {

305 
­Ş_mls_Ëv–_t
 *
l
 = 
Ëv–
;

306 
	`ä“
(
l
->
£ns
);

307 
	`­Ş_veùÜ_de¡roy
(&
l
->
ÿts
);

308 
	`ä“
(
l
->
l™”®_ÿts
);

309 
	`ä“
(
l
);

311 
	}
}

313 
	$­Ş_mls_Ëv–_de¡roy
(
­Ş_mls_Ëv–_t
 ** 
Ëv–
)

315 ià(!
Ëv–
 || !(*level))

317 
	`mls_Ëv–_ä“
(*
Ëv–
);

318 *
Ëv–
 = 
NULL
;

319 
	}
}

321 
	$­Ş_mls_Ëv–_£t_£ns
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_mls_Ëv–_t
 * 
Ëv–
, cÚ¡ *
£ns
)

323 ià(!
Ëv–
) {

324 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
EINVAL
));

325 
”ºo
 = 
EINVAL
;

328  
	`­Ş_qu”y_£t
(
p
, &
Ëv–
->
£ns
, 
NULL
, sens);

329 
	}
}

331 cÚ¡ *
	$­Ş_mls_Ëv–_g‘_£ns
(cÚ¡ 
­Ş_mls_Ëv–_t
 * 
Ëv–
)

333 ià(!
Ëv–
) {

334 
”ºo
 = 
EINVAL
;

335  
NULL
;

337  
Ëv–
->
£ns
;

338 
	}
}

340 
	$­Ş_mls_Ëv–_­³nd_ÿts
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_mls_Ëv–_t
 * 
Ëv–
, cÚ¡ *
ÿts
)

342 *
Ãw_ÿt
 = 
NULL
;

343 ià(!
Ëv–
 || !
ÿts
 ||†ev–->ÿt =ğ
NULL
) {

344 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
EINVAL
));

345 
”ºo
 = 
EINVAL
;

349 ià(
Ëv–
->
ÿts
 =ğ
NULL
 && (Ëv–->ÿt ğ
	`­Ş_veùÜ_ü—‹
(
ä“
)) == NULL) {

350 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

353 ià((
Ãw_ÿt
 = 
	`¡rdup
(
ÿts
)è=ğ
NULL
 || 
	`­Ş_veùÜ_­³nd
(
Ëv–
->cats, (*)new_cat) < 0) {

354 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

355 
	`ä“
(
Ãw_ÿt
);

358 
	`­Ş_veùÜ_sÜt
(
Ëv–
->
ÿts
, 
­Ş_¡r_¡rcmp
, 
NULL
);

360 
	}
}

362 cÚ¡ 
­Ş_veùÜ_t
 *
	$­Ş_mls_Ëv–_g‘_ÿts
(cÚ¡ 
­Ş_mls_Ëv–_t
 * 
Ëv–
)

364 ià(!
Ëv–
 ||†ev–->
ÿts
 =ğ
NULL
) {

365 
”ºo
 = 
EINVAL
;

366  
NULL
;

368  
Ëv–
->
ÿts
;

369 
	}
}

371 
	$­Ş_mls_Ëv–_com·»
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
­Ş_mls_Ëv–_t
 * 
l1
, cÚ¡‡pŞ_mls_Ëv–_ˆ* 
l2
)

373 cÚ¡ 
qpŞ_Ëv–_t
 *
Ëv–_d©um1
, *
Ëv–_d©um2
;

374 
Ëv–1_£ns
, 
Ëv–2_£ns
, 
£ns_cmp
;

375 
size_t
 
l1_size
, 
l2_size
, 
i
, 
j
;

376 
m_li¡
, 
uÿt
 = 0;

377 
­Ş_veùÜ_t
 *
ÿt_li¡_ma¡”
, *
ÿt_li¡_sub£t
;

378 ià(
l2
 =ğ
NULL
) {

379  
APOL_MLS_EQ
;

381 ià((
l1
 !ğ
NULL
 &&†1->
ÿts
 =ğNULLè|| (
l2
->cats == NULL)) {

382 
”ºo
 = 
EINVAL
;

385 ià(
	`qpŞ_pŞicy_g‘_Ëv–_by_Çme
(
p
->p, 
l1
->
£ns
, &
Ëv–_d©um1
) < 0 ||

386 
	`qpŞ_pŞicy_g‘_Ëv–_by_Çme
(
p
->p, 
l2
->
£ns
, &
Ëv–_d©um2
) < 0) {

391 ià(
	`qpŞ_Ëv–_g‘_v®ue
(
p
->p, 
Ëv–_d©um1
, (
ušt32_t
 *è(&
Ëv–1_£ns
)) < 0 ||

392 
	`qpŞ_Ëv–_g‘_v®ue
(
p
->p, 
Ëv–_d©um2
, (
ušt32_t
 *è(&
Ëv–2_£ns
)) < 0) {

395 
£ns_cmp
 = 
Ëv–1_£ns
 - 
Ëv–2_£ns
;

398 
l1_size
 = 
	`­Ş_veùÜ_g‘_size
(
l1
->
ÿts
);

399 
l2_size
 = 
	`­Ş_veùÜ_g‘_size
(
l2
->
ÿts
);

400 ià(
l1_size
 < 
l2_size
) {

401 
m_li¡
 = 2;

402 
ÿt_li¡_ma¡”
 = 
l2
->
ÿts
;

403 
ÿt_li¡_sub£t
 = 
l1
->
ÿts
;

405 
m_li¡
 = 1;

406 
ÿt_li¡_ma¡”
 = 
l1
->
ÿts
;

407 
ÿt_li¡_sub£t
 = 
l2
->
ÿts
;

409 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
ÿt_li¡_sub£t
); i++) {

410 *
ÿt
 = (*)
	`­Ş_veùÜ_g‘_–em’t
(
ÿt_li¡_sub£t
, 
i
);

411 ià(
	`­Ş_veùÜ_g‘_šdex
(
ÿt_li¡_ma¡”
, 
ÿt
, 
­Ş_mls_ÿt_Çme_com·»
, (*)
p
, &
j
) < 0) {

412 
uÿt
 = 1;

417 ià(!
£ns_cmp
 && !
uÿt
 && 
l1_size
 =ğ
l2_size
)

418  
APOL_MLS_EQ
;

419 ià(
£ns_cmp
 >ğ0 && 
m_li¡
 =ğ1 && !
uÿt
)

420  
APOL_MLS_DOM
;

421 ià(
£ns_cmp
 <ğ0 && (
m_li¡
 =ğ2 || 
l1_size
 =ğ
l2_size
è&& !
uÿt
)

422  
APOL_MLS_DOMBY
;

423  
APOL_MLS_INCOMP
;

424 
	}
}

426 
	$­Ş_mls_Ëv–_v®id©e
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
­Ş_mls_Ëv–_t
 * 
Ëv–
)

428 cÚ¡ 
qpŞ_Ëv–_t
 *
Ëv–_d©um
;

429 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

430 
­Ş_veùÜ_t
 *
ÿt_veùÜ
;

431 
»tv®
 = -1;

432 
size_t
 
i
, 
j
;

434 ià(
p
 =ğ
NULL
 || 
Ëv–
 =ğNULL ||†ev–->
ÿts
 == NULL) {

435 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
EINVAL
));

436 
”ºo
 = 
EINVAL
;

439 ià(
Ëv–
->
£ns
 =ğ
NULL
) {

442 ià(
	`qpŞ_pŞicy_g‘_Ëv–_by_Çme
(
p
->p, 
Ëv–
->
£ns
, &
Ëv–_d©um
) < 0 ||

443 
	`qpŞ_Ëv–_g‘_ÿt_™”
(
p
->p, 
Ëv–_d©um
, &
™”
) < 0) {

446 ià((
ÿt_veùÜ
 = 
	`­Ş_veùÜ_ü—‹_äom_™”
(
™”
, 
NULL
)) == NULL) {

447 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

448 
ş—nup
;

451 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
Ëv–
->
ÿts
); i++) {

452 *
ÿt_Çme
 = (*)
	`­Ş_veùÜ_g‘_–em’t
(
Ëv–
->
ÿts
, 
i
);

453 ià(
	`­Ş_veùÜ_g‘_šdex
(
ÿt_veùÜ
, 
ÿt_Çme
, 
­Ş_mls_ÿt_veùÜ_com·»
, (*)
p
, &
j
) < 0) {

454 
»tv®
 = 0;

455 
ş—nup
;

459 
»tv®
 = 1;

460 
ş—nup
:

461 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

462 
	`­Ş_veùÜ_de¡roy
(&
ÿt_veùÜ
);

463  
»tv®
;

464 
	}
}

466 *
	$­Ş_mls_Ëv–_»nd”
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
­Ş_mls_Ëv–_t
 * 
Ëv–
)

468 *
¹
 = 
NULL
;

469 cÚ¡ *
Çme
 = 
NULL
, *
£ns_Çme
 = NULL, *
ÿt_Çme
 = NULL;

470 *
»tv®
 = 
NULL
;

471 
cur
;

472 cÚ¡ 
qpŞ_ÿt_t
 *
cur_ÿt
 = 
NULL
, *
Ãxt_ÿt
 = NULL;

473 
ušt32_t
 
cur_ÿt_v®
, 
Ãxt_ÿt_v®
, 
çr_ÿt_v®
;

474 
­Ş_veùÜ_t
 *
ÿts
 = 
NULL
;

475 
size_t
 
sz
 = 0, 
n_ÿts
 = 0, 
i
;

477 ià(!
Ëv–
 || (
p
 =ğ
NULL
 &&†ev–->
ÿts
 != NULL)) {

478 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
EINVAL
));

479 
”ºo
 = 
EINVAL
;

480 
ş—nup
;

483 
£ns_Çme
 = 
Ëv–
->
£ns
;

484 ià(!
£ns_Çme
)

485 
ş—nup
;

486 ià(
	`­Ş_¡r_­³nd
(&
¹
, &
sz
, 
£ns_Çme
)) {

487 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

488 
ş—nup
;

491 ià(
Ëv–
->
ÿts
 !ğ
NULL
) {

492 ià((
ÿts
 = 
	`­Ş_veùÜ_ü—‹_äom_veùÜ
(
Ëv–
->ÿts, 
­Ş_¡r_¡rdup
, 
NULL
, 
ä“
)) == NULL) {

493 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

494 
ş—nup
;

496 
n_ÿts
 = 
	`­Ş_veùÜ_g‘_size
(
ÿts
);

498 ià(
n_ÿts
 == 0) {

499 ià(
Ëv–
->
l™”®_ÿts
 !ğ
NULL
 &&†evel->literal_cats[0] != '\0') {

500 ià(
	`­Ş_¡r_­³ndf
(&
¹
, &
sz
, ":%s", 
Ëv–
->
l™”®_ÿts
)) {

501 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

502 
ş—nup
;

506 
»tv®
 = 
¹
;

507 
ş—nup
;

509 
	`­Ş_veùÜ_sÜt
(
ÿts
, 
­Ş_mls_ÿt_Çme_com·»
, (*)
p
);

511 
ÿt_Çme
 = (*)
	`­Ş_veùÜ_g‘_–em’t
(
ÿts
, 0);

512 ià(!
ÿt_Çme
)

513 
ş—nup
;

515 ià(
	`­Ş_¡r_­³ndf
(&
¹
, &
sz
, ":%s", 
ÿt_Çme
)) {

516 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

517 
ş—nup
;

519 
cur
 = 0;

520 
i
 = 1; i < 
n_ÿts
; i++) {

522 
ÿt_Çme
 = (*)
	`­Ş_veùÜ_g‘_–em’t
(
ÿts
, 
cur
);

523 ià(
	`qpŞ_pŞicy_g‘_ÿt_by_Çme
(
p
->p, 
ÿt_Çme
, &
cur_ÿt
))

524 
ş—nup
;

525 ià(
	`qpŞ_ÿt_g‘_v®ue
(
p
->p, 
cur_ÿt
, &
cur_ÿt_v®
))

526 
ş—nup
;

529 
ÿt_Çme
 = (*)
	`­Ş_veùÜ_g‘_–em’t
(
ÿts
, 
i
);

530 ià(
	`qpŞ_pŞicy_g‘_ÿt_by_Çme
(
p
->p, 
ÿt_Çme
, &
Ãxt_ÿt
))

531 
ş—nup
;

532 ià(
	`qpŞ_ÿt_g‘_v®ue
(
p
->p, 
Ãxt_ÿt
, &
Ãxt_ÿt_v®
))

533 
ş—nup
;

535 ià(
Ãxt_ÿt_v®
 =ğ
cur_ÿt_v®
 + 1) {

536 ià(
i
 + 1 =ğ
n_ÿts
) {

537 ià(
	`qpŞ_ÿt_g‘_Çme
(
p
->p, 
Ãxt_ÿt
, &
Çme
))

538 
ş—nup
;

539 ià(
	`­Ş_¡r_­³ndf
(&
¹
, &
sz
, ".%s", 
Çme
)) {

540 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

541 
ş—nup
;

543 
cur
 = 
i
;

545 cÚ¡ 
qpŞ_ÿt_t
 *
çr_ÿt
 = 
NULL
;

546 
ÿt_Çme
 = (*)
	`­Ş_veùÜ_g‘_–em’t
(
ÿts
, 
i
 + 1);

547 ià(
	`qpŞ_pŞicy_g‘_ÿt_by_Çme
(
p
->p, 
ÿt_Çme
, &
çr_ÿt
))

548 
ş—nup
;

549 ià(
	`qpŞ_ÿt_g‘_v®ue
(
p
->p, 
çr_ÿt
, &
çr_ÿt_v®
))

550 
ş—nup
;

551 ià(
çr_ÿt_v®
 =ğ
cur_ÿt_v®
 + 2) {

552 
cur
++;

554 ià(
	`qpŞ_ÿt_g‘_Çme
(
p
->p, 
Ãxt_ÿt
, &
Çme
))

555 
ş—nup
;

556 ià(
	`­Ş_¡r_­³ndf
(&
¹
, &
sz
, ".%s", 
Çme
)) {

557 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

558 
ş—nup
;

560 
cur
 = 
i
;

564 ià(
	`qpŞ_ÿt_g‘_Çme
(
p
->p, 
Ãxt_ÿt
, &
Çme
))

565 
ş—nup
;

566 ià(
	`­Ş_¡r_­³ndf
(&
¹
, &
sz
, ", %s", 
Çme
)) {

567 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

568 
ş—nup
;

570 
cur
 = 
i
;

574 
»tv®
 = 
¹
;

575 
ş—nup
:

576 
	`­Ş_veùÜ_de¡roy
(&
ÿts
);

577 ià(
»tv®
 !ğ
¹
) {

578 
	`ä“
(
¹
);

580  
»tv®
;

581 
	}
}

583 
	$­Ş_mls_Ëv–_cÚv”t
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_mls_Ëv–_t
 * 
Ëv–
)

585 cÚ¡ *
tmp
, *
ÿt_Çme
;

586 **
tok’s
 = 
NULL
, *
Ãxt
 = NULL;

587 
size_t
 
num_tok’s
 = 1, 
i
;

588 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

589 cÚ¡ 
qpŞ_Ëv–_t
 *
£ns
 = 
NULL
;

590 cÚ¡ 
qpŞ_ÿt_t
 *
ÿt1
 = 
NULL
, *
ÿt2
 = NULL, *
tmp_ÿt
 = NULL;

591 
ušt32_t
 
v®1
 = 0, 
v®2
 = 0, 
tmp_v®
 = 0;

592 
tmp_i§lŸs
 = 0;

594 
”rÜ
 = 0;

595 ià(
p
 =ğ
NULL
 || 
Ëv–
 =ğNULL ||†ev–->
l™”®_ÿts
 == NULL) {

596 
”rÜ
 = 
EINVAL
;

597 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”rÜ
));

598 
”r
;

601 
	`­Ş_veùÜ_de¡roy
(&
Ëv–
->
ÿts
);

602 ià(
Ëv–
->
l™”®_ÿts
[0] == '\0') {

603 ià((
Ëv–
->
ÿts
 = 
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(1, 
ä“
)è=ğ
NULL
) {

604 
”rÜ
 = 
”ºo
;

605 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”rÜ
));

606 
”r
;

611 
tmp
 = 
Ëv–
->
l™”®_ÿts
; *tmp;mp++) {

612 ià((
Ãxt
 = 
	`¡rchr
(
tmp
, ','))) {

613 
tmp
 = 
Ãxt
;

614 
num_tok’s
++;

617 
tok’s
 = 
	`ÿÎoc
(
num_tok’s
, (*));

618 ià(!
tok’s
) {

619 
”rÜ
 = 
”ºo
;

620 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

621 
”r
;

623 ià((
Ëv–
->
ÿts
 = 
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(
num_tok’s
, 
ä“
)è=ğ
NULL
) {

624 
”rÜ
 = 
”ºo
;

625 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”rÜ
));

626 
”r
;

629 
tmp
 = 
Ëv–
->
l™”®_ÿts
, 
i
 = 0; *tm°&& i < 
num_tok’s
;mp++) {

630 ià(
	`is¥aû
(*
tmp
))

632 
Ãxt
 = 
	`¡rchr
(
tmp
, ',');

633 ià(
Ãxt
) {

634 
tok’s
[
i
] = 
	`¡ºdup
(
tmp
, 
Ãxt
 -mp);

635 ià(!
tok’s
[
i
]) {

636 
”rÜ
 = 
”ºo
;

637 
”r
;

639 
tmp
 = 
Ãxt
;

640 
Ãxt
 = 
NULL
;

641 
i
++;

643 
tok’s
[
i
] = 
	`¡rdup
(
tmp
);

644 ià(!
tok’s
[
i
]) {

645 
”rÜ
 = 
”ºo
;

646 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

647 
”r
;

649 
i
++;

650 ià(
i
 !ğ
num_tok’s
) {

651 
”rÜ
 = 
EIO
;

652 
”r
;

657 ià(
	`qpŞ_pŞicy_g‘_Ëv–_by_Çme
(
p
->p, 
Ëv–
->
£ns
, &sens)) {

658 
”rÜ
 = 
”ºo
;

659 
”r
;

662 
i
 = 0; i < 
num_tok’s
; i++) {

663 
Ãxt
 = 
	`¡rchr
(
tok’s
[
i
], '.');

664 ià(
Ãxt
) {

665 *
Ãxt
 = '\0';

666 
Ãxt
++;

669 ià(
	`qpŞ_pŞicy_g‘_ÿt_by_Çme
(
p
->p, 
tok’s
[
i
], &
ÿt1
)) {

670 
”rÜ
 = 
”ºo
;

671 
”r
;

673 ià(
	`qpŞ_pŞicy_g‘_ÿt_by_Çme
(
p
->p, 
Ãxt
, &
ÿt2
)) {

674 
”rÜ
 = 
”ºo
;

675 
”r
;

679 ià(
	`qpŞ_ÿt_g‘_v®ue
(
p
->p, 
ÿt1
, &
v®1
)) {

680 
”rÜ
 = 
”ºo
;

681 
”r
;

683 ià(
	`qpŞ_ÿt_g‘_v®ue
(
p
->p, 
ÿt2
, &
v®2
)) {

684 
”rÜ
 = 
”ºo
;

685 
”r
;

687 ià(
v®1
 >ğ
v®2
) {

688 
”rÜ
 = 
EINVAL
;

689 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”rÜ
));

690 
”r
;

692 ià(
	`­Ş_mls_Ëv–_­³nd_ÿts
(
p
, 
Ëv–
, 
tok’s
[
i
])) {

693 
”rÜ
 = 
”ºo
;

694 
”r
;

696 ià(
	`qpŞ_pŞicy_g‘_ÿt_™”
(
p
->p, &
™”
)) {

697 
”rÜ
 = 
”ºo
;

698 
”r
;

700 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

701 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
tmp_ÿt
)) {

702 
”rÜ
 = 
”ºo
;

703 
”r
;

705 ià(
	`qpŞ_ÿt_g‘_i§lŸs
(
p
->p, 
tmp_ÿt
, &
tmp_i§lŸs
)) {

706 
”rÜ
 = 
”ºo
;

707 
”r
;

709 ià(
tmp_i§lŸs
)

711 ià(
	`qpŞ_ÿt_g‘_v®ue
(
p
->p, 
tmp_ÿt
, &
tmp_v®
)) {

712 
”rÜ
 = 
”ºo
;

713 
”r
;

715 ià(
tmp_v®
 > 
v®1
 &&mp_v® < 
v®2
) {

716 ià(
	`qpŞ_ÿt_g‘_Çme
(
p
->p, 
tmp_ÿt
, &
ÿt_Çme
)) {

717 
”rÜ
 = 
”ºo
;

718 
”r
;

720 ià(
	`­Ş_mls_Ëv–_­³nd_ÿts
(
p
, 
Ëv–
, 
ÿt_Çme
)) {

721 
”rÜ
 = 
”ºo
;

722 
”r
;

726 ià(
	`­Ş_mls_Ëv–_­³nd_ÿts
(
p
, 
Ëv–
, 
Ãxt
)) {

727 
”rÜ
 = 
”ºo
;

728 
”r
;

731 ià(
	`qpŞ_pŞicy_g‘_ÿt_by_Çme
(
p
->p, 
tok’s
[
i
], &
ÿt1
)) {

732 
”rÜ
 = 
”ºo
;

733 
”r
;

735 ià(
	`­Ş_mls_Ëv–_­³nd_ÿts
(
p
, 
Ëv–
, 
tok’s
[
i
])) {

736 
”rÜ
 = 
”ºo
;

737 
”r
;

742 ià(
tok’s
) {

743 
i
 = 0; i < 
num_tok’s
; i++)

744 
	`ä“
(
tok’s
[
i
]);

745 
	`ä“
(
tok’s
);

748 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

751 
”r
:

752 ià(
tok’s
) {

753 
i
 = 0; i < 
num_tok’s
; i++)

754 
	`ä“
(
tok’s
[
i
]);

755 
	`ä“
(
tok’s
);

757 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

758 
”ºo
 = 
”rÜ
;

760 
	}
}

762 
	$­Ş_mls_Ëv–_is_l™”®
(cÚ¡ 
­Ş_mls_Ëv–_t
 * 
Ëv–
)

764 ià(
Ëv–
 =ğ
NULL
) {

767 ià(
Ëv–
->
l™”®_ÿts
 !ğ
NULL
) {

771 
	}
}

	@libapol/src/mls_range.c

25 
	~<cÚfig.h
>

27 
	~<­Ş/mls_¿nge.h
>

29 
	~<as£¹.h
>

30 
	~<”ºo.h
>

31 
	~<¡dlib.h
>

32 
	~<¡ršg.h
>

34 
	~"pŞicy-qu”y-š‹º®.h
"

36 
	~<qpŞ/™”©Ü.h
>

37 
	~<­Ş/veùÜ.h
>

39 
	s­Ş_mls_¿nge


41 
­Ş_mls_Ëv–_t
 *
	mlow
, *
	mhigh
;

44 
­Ş_mls_¿nge_t
 *
	$­Ş_mls_¿nge_ü—‹
()

46  
	`ÿÎoc
(1, (
­Ş_mls_¿nge_t
));

47 
	}
}

49 
­Ş_mls_¿nge_t
 *
	$­Ş_mls_¿nge_ü—‹_äom_mls_¿nge
(cÚ¡ 
­Ş_mls_¿nge_t
 * 
¿nge
)

51 
­Ş_mls_¿nge_t
 *
r
;

52 ià((
r
 = 
	`­Ş_mls_¿nge_ü—‹
()è=ğ
NULL
) {

53  
NULL
;

55 ià(
¿nge
 !ğ
NULL
 &&

56 ((
r
->
low
 = 
	`­Ş_mls_Ëv–_ü—‹_äom_mls_Ëv–
(
¿nge
->low)è=ğ
NULL
 ||

57 (
r
->
high
 = 
	`­Ş_mls_Ëv–_ü—‹_äom_mls_Ëv–
(
¿nge
->high)è=ğ
NULL
)) {

58 
	`­Ş_mls_¿nge_de¡roy
(&
r
);

59  
NULL
;

61  
r
;

62 
	}
}

64 
­Ş_mls_¿nge_t
 *
	$­Ş_mls_¿nge_ü—‹_äom_¡ršg
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ *
mls_¿nge_¡ršg
)

66 ià(
p
 =ğ
NULL
 || 
mls_¿nge_¡ršg
 == NULL) {

67 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
EINVAL
));

68 
”ºo
 = 
EINVAL
;

69  
NULL
;

72 
­Ş_mls_¿nge_t
 *
r
 = 
	`­Ş_mls_¿nge_ü—‹
();

73 ià(
r
 =ğ
NULL
) {

74 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

75  
NULL
;

77 *
dash
;

78 ià((
dash
 = 
	`¡rchr
(
mls_¿nge_¡ršg
, '-')è=ğ
NULL
) {

80 
­Ş_mls_Ëv–_t
 *
l
 = 
	`­Ş_mls_Ëv–_ü—‹_äom_¡ršg
(
p
, 
mls_¿nge_¡ršg
);

81 ià(
l
 =ğ
NULL
) {

82 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

83 
	`­Ş_mls_¿nge_de¡roy
(&
r
);

84  
NULL
;

86 
r
->
low
 = 
l
;

89 ià(
dash
 =ğ
mls_¿nge_¡ršg
) {

90 
	`­Ş_mls_¿nge_de¡roy
(&
r
);

91 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
EINVAL
));

92 
”ºo
 = 
EINVAL
;

93  
NULL
;

95 *
s
 = 
	`¡ºdup
(
mls_¿nge_¡ršg
, 
dash
 - mls_range_string);

96 ià(
s
 =ğ
NULL
) {

97 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

98 
	`­Ş_mls_¿nge_de¡roy
(&
r
);

99  
NULL
;

101 
­Ş_mls_Ëv–_t
 *
l
 = 
	`­Ş_mls_Ëv–_ü—‹_äom_¡ršg
(
p
, 
s
);

102 ià(
l
 =ğ
NULL
) {

103 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

104 
	`­Ş_mls_¿nge_de¡roy
(&
r
);

105 
	`ä“
(
s
);

106  
NULL
;

108 
r
->
low
 = 
l
;

109 
	`ä“
(
s
);

110 
l
 = 
NULL
;

112 ià((
l
 = 
	`­Ş_mls_Ëv–_ü—‹_äom_¡ršg
(
p
, 
dash
 + 1)è=ğ
NULL
) {

113 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

114 
	`­Ş_mls_¿nge_de¡roy
(&
r
);

115  
NULL
;

117 
r
->
high
 = 
l
;

120 ià(
	`­Ş_mls_¿nge_v®id©e
(
p
, 
r
) <= 0) {

121 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
EINVAL
));

122 
”ºo
 = 
EINVAL
;

123 
	`­Ş_mls_¿nge_de¡roy
(&
r
);

124  
NULL
;

126  
r
;

127 
	}
}

129 
­Ş_mls_¿nge_t
 *
	$­Ş_mls_¿nge_ü—‹_äom_l™”®
(cÚ¡ *
mls_¿nge_¡ršg
)

131 ià(
mls_¿nge_¡ršg
 =ğ
NULL
) {

132 
”ºo
 = 
EINVAL
;

133  
NULL
;

136 
­Ş_mls_¿nge_t
 *
r
 = 
	`­Ş_mls_¿nge_ü—‹
();

137 ià(
r
 =ğ
NULL
) {

138  
NULL
;

140 *
dash
;

141 ià((
dash
 = 
	`¡rchr
(
mls_¿nge_¡ršg
, '-')è=ğ
NULL
) {

143 
­Ş_mls_Ëv–_t
 *
l
 = 
	`­Ş_mls_Ëv–_ü—‹_äom_l™”®
(
mls_¿nge_¡ršg
);

144 ià(
l
 =ğ
NULL
) {

145 
	`­Ş_mls_¿nge_de¡roy
(&
r
);

146  
NULL
;

148 
r
->
low
 = 
l
;

151 ià(
dash
 =ğ
mls_¿nge_¡ršg
) {

152 
	`­Ş_mls_¿nge_de¡roy
(&
r
);

153 
”ºo
 = 
EINVAL
;

154  
NULL
;

156 *
s
 = 
	`¡ºdup
(
mls_¿nge_¡ršg
, 
dash
 - mls_range_string);

157 ià(
s
 =ğ
NULL
) {

158 
	`­Ş_mls_¿nge_de¡roy
(&
r
);

159  
NULL
;

161 
­Ş_mls_Ëv–_t
 *
l
 = 
	`­Ş_mls_Ëv–_ü—‹_äom_l™”®
(
s
);

162 ià(
l
 =ğ
NULL
) {

163 
	`­Ş_mls_¿nge_de¡roy
(&
r
);

164 
	`ä“
(
s
);

165  
NULL
;

167 
r
->
low
 = 
l
;

168 
	`ä“
(
s
);

169 
l
 = 
NULL
;

171 ià((
l
 = 
	`­Ş_mls_Ëv–_ü—‹_äom_l™”®
(
dash
 + 1)è=ğ
NULL
) {

172 
	`­Ş_mls_¿nge_de¡roy
(&
r
);

173  
NULL
;

175 
r
->
high
 = 
l
;

177  
r
;

178 
	}
}

180 
­Ş_mls_¿nge_t
 *
	$­Ş_mls_¿nge_ü—‹_äom_qpŞ_mls_¿nge
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
qpŞ_mls_¿nge_t
 * 
qpŞ_¿nge
)

182 
­Ş_mls_¿nge_t
 *
­Ş_¿nge
 = 
NULL
;

183 cÚ¡ 
qpŞ_mls_Ëv–_t
 *
tmp
 = 
NULL
;

184 
­Ş_mls_Ëv–_t
 *
tmp_lvl
 = 
NULL
;

185 
”rÜ
 = 0;

187 ià(!
p
 || !
qpŞ_¿nge
) {

188 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
EINVAL
));

189 
”ºo
 = 
EINVAL
;

190  
NULL
;

193 
­Ş_¿nge
 = 
	`ÿÎoc
(1, (
­Ş_mls_¿nge_t
));

194 ià(!
­Ş_¿nge
) {

195 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

196  
NULL
;

200 ià(
	`qpŞ_mls_¿nge_g‘_low_Ëv–
(
p
->p, 
qpŞ_¿nge
, &
tmp
) ||

201 !(
tmp_lvl
 = 
	`­Ş_mls_Ëv–_ü—‹_äom_qpŞ_mls_Ëv–
(
p
, 
tmp
)è|| 
	`­Ş_mls_¿nge_£t_low
Õ, 
­Ş_¿nge
,mp_lvl)) {

202 
”rÜ
 = 
”ºo
;

203 
	`­Ş_mls_Ëv–_de¡roy
(&
tmp_lvl
);

204 
”r
;

206 
tmp_lvl
 = 
NULL
;

209 ià(
	`qpŞ_mls_¿nge_g‘_high_Ëv–
(
p
->p, 
qpŞ_¿nge
, &
tmp
) ||

210 !(
tmp_lvl
 = 
	`­Ş_mls_Ëv–_ü—‹_äom_qpŞ_mls_Ëv–
(
p
, 
tmp
)è|| 
	`­Ş_mls_¿nge_£t_high
Õ, 
­Ş_¿nge
,mp_lvl)) {

211 
”rÜ
 = 
”ºo
;

212 
	`­Ş_mls_Ëv–_de¡roy
(&
tmp_lvl
);

213 
”r
;

216  
­Ş_¿nge
;

218 
”r
:

219 
	`­Ş_mls_¿nge_de¡roy
(&
­Ş_¿nge
);

220 
”ºo
 = 
”rÜ
;

221  
NULL
;

222 
	}
}

224 
	$­Ş_mls_¿nge_de¡roy
(
­Ş_mls_¿nge_t
 ** 
¿nge
)

226 ià(!
¿nge
 || !(*range))

229 ià((*
¿nge
)->
low
 !ğ(*¿nge)->
high
) {

230 
	`­Ş_mls_Ëv–_de¡roy
(&((*
¿nge
)->
high
));

232 
	`­Ş_mls_Ëv–_de¡roy
(&((*
¿nge
)->
low
));

233 
	`ä“
(*
¿nge
);

234 *
¿nge
 = 
NULL
;

235 
	}
}

237 
	$­Ş_mls_¿nge_£t_low
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_mls_¿nge_t
 * 
¿nge
, 
­Ş_mls_Ëv–_t
 * 
Ëv–
)

239 ià(!
¿nge
) {

240 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
EINVAL
));

241 
”ºo
 = 
EINVAL
;

244 ià(
¿nge
->
low
 !ğ
Ëv–
) {

245 
	`­Ş_mls_Ëv–_de¡roy
(&(
¿nge
->
low
));

246 
¿nge
->
low
 = 
Ëv–
;

249 
	}
}

251 
	$­Ş_mls_¿nge_£t_high
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_mls_¿nge_t
 * 
¿nge
, 
­Ş_mls_Ëv–_t
 * 
Ëv–
)

253 ià(!
¿nge
) {

254 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
EINVAL
));

255 
”ºo
 = 
EINVAL
;

259 ià(
¿nge
->
high
 !ğ
Ëv–
) {

260 ià(
¿nge
->
low
 !ğ¿nge->
high
) {

261 
	`­Ş_mls_Ëv–_de¡roy
(&(
¿nge
->
high
));

263 
¿nge
->
high
 = 
Ëv–
;

266 
	}
}

268 cÚ¡ 
­Ş_mls_Ëv–_t
 *
	$­Ş_mls_¿nge_g‘_low
(cÚ¡ 
­Ş_mls_¿nge_t
 * 
¿nge
)

270 ià(!
¿nge
) {

271 
”ºo
 = 
EINVAL
;

272  
NULL
;

274  
¿nge
->
low
;

275 
	}
}

277 cÚ¡ 
­Ş_mls_Ëv–_t
 *
	$­Ş_mls_¿nge_g‘_high
(cÚ¡ 
­Ş_mls_¿nge_t
 * 
¿nge
)

279 ià(!
¿nge
) {

280 
”ºo
 = 
EINVAL
;

281  
NULL
;

283  
¿nge
->
high
;

284 
	}
}

286 
	$­Ş_mls_¿nge_com·»
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
­Ş_mls_¿nge_t
 * 
rg‘
, cÚ¡‡pŞ_mls_¿nge_ˆ* 
£¬ch
,

287 
¿nge_com·»_ty³
)

289 
ªs1
 = -1, 
ªs2
 = -1;

290 ià(
£¬ch
 =ğ
NULL
) {

293 ià(
p
 =ğ
NULL
 || 
rg‘
 =ğNULL ||¬g‘->
low
 =ğNULL || 
£¬ch
->low == NULL) {

294 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
EINVAL
));

295 
”ºo
 = 
EINVAL
;

299 ià((
¿nge_com·»_ty³
 & 
APOL_QUERY_SUB
è|| (¿nge_com·»_ty³ & 
APOL_QUERY_INTERSECT
)) {

300 
ªs1
 = 
	`­Ş_mls_¿nge_cÚš_sub¿nge
(
p
, 
rg‘
, 
£¬ch
);

301 ià(
ªs1
 < 0) {

305 ià((
¿nge_com·»_ty³
 & 
APOL_QUERY_SUPER
è|| (¿nge_com·»_ty³ & 
APOL_QUERY_INTERSECT
)) {

306 
ªs2
 = 
	`­Ş_mls_¿nge_cÚš_sub¿nge
(
p
, 
£¬ch
, 
rg‘
);

307 ià(
ªs2
 < 0) {

312 ià((
¿nge_com·»_ty³
 & 
APOL_QUERY_EXACT
) == APOL_QUERY_EXACT) {

313  (
ªs1
 && 
ªs2
);

314 } ià(
¿nge_com·»_ty³
 & 
APOL_QUERY_SUB
) {

315  
ªs1
;

316 } ià(
¿nge_com·»_ty³
 & 
APOL_QUERY_SUPER
) {

317  
ªs2
;

318 } ià(
¿nge_com·»_ty³
 & 
APOL_QUERY_INTERSECT
) {

319  (
ªs1
 || 
ªs2
);

321 
	`ERR
(
p
, "%s", "Invalid„ange compareype‡rgument.");

322 
”ºo
 = 
EINVAL
;

324 
	}
}

326 
	$­Ş_mls_¿nge_dÛs_šşude_Ëv–
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
­Ş_mls_¿nge_t
 * 
¿nge
,

327 cÚ¡ 
­Ş_mls_Ëv–_t
 * 
Ëv–
)

329 
high_cmp
 = -1, 
low_cmp
 = -1;

331 ià(
¿nge
->
low
 !ğ¿nge->
high
) {

332 
low_cmp
 = 
	`­Ş_mls_Ëv–_com·»
(
p
, 
¿nge
->
low
, 
Ëv–
);

333 ià(
low_cmp
 < 0) {

337 cÚ¡ 
­Ş_mls_Ëv–_t
 *
high_Ëv–
 = (
¿nge
->
high
 !ğ
NULL
 ?„ªge->high :„ªge->
low
);

338 
high_cmp
 = 
	`­Ş_mls_Ëv–_com·»
(
p
, 
high_Ëv–
, 
Ëv–
);

339 ià(
high_cmp
 < 0) {

343 ià(
high_cmp
 =ğ
APOL_MLS_EQ
 || high_cm°=ğ
APOL_MLS_DOM
) {

344 ià((
low_cmp
 =ğ
APOL_MLS_EQ
 ||†ow_cm°=ğ
APOL_MLS_DOMBY
è&& 
¿nge
->
low
 !ğ
high_Ëv–
) {

346 } ià(
¿nge
->
low
 =ğ
high_Ëv–
) {

347  
	`­Ş_mls_£ns_com·»
(
p
, 
	`­Ş_mls_Ëv–_g‘_£ns
(
¿nge
->
low
),‡pŞ_mls_Ëv–_g‘_£ns(
Ëv–
));

352 
	}
}

354 
	$­Ş_mls_¿nge_cÚš_sub¿nge
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
­Ş_mls_¿nge_t
 * 
¿nge
, cÚ¡‡pŞ_mls_¿nge_ˆ* 
sub¿nge
)

356 ià(
p
 =ğ
NULL
 || 
	`­Ş_mls_¿nge_v®id©e
Õ, 
sub¿nge
) != 1) {

357 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
EINVAL
));

363 ià(
	`­Ş_mls_¿nge_dÛs_šşude_Ëv–
(
p
, 
¿nge
, 
sub¿nge
->
low
)) {

364 ià(
sub¿nge
->
high
 =ğ
NULL
 || 
	`­Ş_mls_¿nge_dÛs_šşude_Ëv–
(
p
, 
¿nge
, subrange->high)) {

369 
	}
}

371 
	$­Ş_mls_¿nge_v®id©e
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
­Ş_mls_¿nge_t
 * 
¿nge
)

373 
»tv
;

375 ià(
p
 =ğ
NULL
 || 
¿nge
 =ğNULL ||„ªge->
low
 == NULL) {

376 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
EINVAL
));

377 
”ºo
 = 
EINVAL
;

381 ià((
»tv
 = 
	`­Ş_mls_Ëv–_v®id©e
(
p
, 
¿nge
->
low
)) != 1) {

382  
»tv
;

385 ià(
¿nge
->
high
 =ğ
NULL
) {

386  
»tv
;

388 ià(
¿nge
->
high
 !ğ¿nge->
low
 && (
»tv
 = 
	`­Ş_mls_Ëv–_v®id©e
(
p
,„ange->high)) != 1) {

389  
»tv
;

394 
»tv
 = 
	`­Ş_mls_Ëv–_com·»
(
p
, 
¿nge
->
low
,„ªge->
high
);

395 ià(
»tv
 < 0) {

397 } ià(
»tv
 !ğ
APOL_MLS_EQ
 &&„‘v !ğ
APOL_MLS_DOMBY
) {

402 
	}
}

404 
	$mls_¿nge_comp
(cÚ¡ *
a
, cÚ¡ *
b
, *
d©a
)

406 cÚ¡ 
­Ş_mls_Ëv–_t
 *
l1
 = 
a
;

407 cÚ¡ 
­Ş_mls_Ëv–_t
 *
l2
 = 
b
;

408 
qpŞ_pŞicy_t
 *
q
 = (qpŞ_pŞicy_ˆ*è
d©a
;

409 cÚ¡ 
qpŞ_Ëv–_t
 *
l
;

410 
ušt32_t
 
low_v®ue
, 
high_v®ue
;

411 
	`qpŞ_pŞicy_g‘_Ëv–_by_Çme
(
q
, 
	`­Ş_mls_Ëv–_g‘_£ns
(
l1
), &
l
);

412 
	`qpŞ_Ëv–_g‘_v®ue
(
q
, 
l
, &
low_v®ue
);

413 
	`qpŞ_pŞicy_g‘_Ëv–_by_Çme
(
q
, 
	`­Ş_mls_Ëv–_g‘_£ns
(
l2
), &
l
);

414 
	`qpŞ_Ëv–_g‘_v®ue
(
q
, 
l
, &
high_v®ue
);

415 
	`as£¹
(
low_v®ue
 !ğ0 && 
high_v®ue
 != 0);

416  
low_v®ue
 - 
high_v®ue
;

417 
	}
}

419 
	$mls_Ëv–_Çme_to_ÿt_comp
(cÚ¡ *
a
, cÚ¡ *
b
, *
d©a
)

421 cÚ¡ 
qpŞ_ÿt_t
 *
ÿt
 = 
a
;

422 cÚ¡ *
Çme
 = (cÚ¡ *)
b
;

423 
qpŞ_pŞicy_t
 *
q
 = (qpŞ_pŞicy_ˆ*è
d©a
;

424 cÚ¡ *
ÿt_Çme
 = "";

425 
	`qpŞ_ÿt_g‘_Çme
(
q
, 
ÿt
, &
ÿt_Çme
);

426  
	`¡rcmp
(
Çme
, 
ÿt_Çme
);

427 
	}
}

429 
	$mls_Ëv–_ä“
(*
–em
)

431 
­Ş_mls_Ëv–_t
 *
Ëv–
 = 
–em
;

432 
	`­Ş_mls_Ëv–_de¡roy
(&
Ëv–
);

433 
	}
}

435 
­Ş_veùÜ_t
 *
	$­Ş_mls_¿nge_g‘_Ëv–s
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
­Ş_mls_¿nge_t
 * 
¿nge
)

437 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
p
);

438 
­Ş_veùÜ_t
 *
v
 = 
NULL
, *
ÿtv
 = NULL;

439 cÚ¡ 
qpŞ_Ëv–_t
 *
l
;

440 
ušt32_t
 
low_v®ue
, 
high_v®ue
, 
v®ue
;

441 
”rÜ
 = 0;

442 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
, *
ÿt™”
 = NULL;

444 ià(
p
 =ğ
NULL
 || 
¿nge
 =ğNULL ||„ªge->
low
 == NULL) {

445 
”rÜ
 = 
EINVAL
;

446 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”rÜ
));

447 
”r
;

449 
­Ş_mls_Ëv–_t
 *
low_Ëv–
, *
high_Ëv–
;

450 
low_Ëv–
 = 
¿nge
->
low
;

451 ià(
¿nge
->
high
 =ğ
NULL
) {

452 
high_Ëv–
 = 
low_Ëv–
;

454 
high_Ëv–
 = 
¿nge
->
high
;

456 ià(
	`qpŞ_pŞicy_g‘_Ëv–_by_Çme
(
q
, 
	`­Ş_mls_Ëv–_g‘_£ns
(
low_Ëv–
), &
l
) < 0 ||

457 
	`qpŞ_Ëv–_g‘_v®ue
(
q
, 
l
, &
low_v®ue
) < 0) {

458 
”rÜ
 = 
”ºo
;

459 
”r
;

461 ià(
	`qpŞ_pŞicy_g‘_Ëv–_by_Çme
(
q
, 
	`­Ş_mls_Ëv–_g‘_£ns
(
high_Ëv–
), &
l
) < 0 ||

462 
	`qpŞ_Ëv–_g‘_v®ue
(
q
, 
l
, &
high_v®ue
) < 0) {

463 
”rÜ
 = 
”ºo
;

464 
”r
;

466 
	`as£¹
(
low_v®ue
 <ğ
high_v®ue
);

467 ià((
v
 = 
	`­Ş_veùÜ_ü—‹
(
mls_Ëv–_ä“
)è=ğ
NULL
) {

468 
”rÜ
 = 
”ºo
;

469 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”rÜ
));

470 
”r
;

472 ià(
	`qpŞ_pŞicy_g‘_Ëv–_™”
(
q
, &
™”
) < 0) {

473 
”rÜ
 = 
”ºo
;

474 
”r
;

476 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

477 cÚ¡ *
Çme
;

478 
­Ş_mls_Ëv–_t
 *
ml
;

479 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
l
) < 0 ||

480 
	`qpŞ_Ëv–_g‘_v®ue
(
q
, 
l
, &
v®ue
è< 0 || 
	`qpŞ_Ëv–_g‘_Çme
(q,†, &
Çme
) < 0) {

481 
”rÜ
 = 
”ºo
;

482 
”r
;

484 ià(
v®ue
 < 
low_v®ue
 || v®u> 
high_v®ue
) {

487 ià((
ml
 = 
	`­Ş_mls_Ëv–_ü—‹
()è=ğ
NULL
 || (
	`­Ş_mls_Ëv–_£t_£ns
(
p
, ml, 
Çme
) < 0)) {

488 
”rÜ
 = 
”ºo
;

489 
	`­Ş_mls_Ëv–_de¡roy
(&
ml
);

490 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”rÜ
));

491 
”r
;

494 ià(
	`qpŞ_Ëv–_g‘_ÿt_™”
(
q
, 
l
, &
ÿt™”
è< 0 || (
ÿtv
 = 
	`­Ş_veùÜ_ü—‹_äom_™”
(ÿt™”, 
NULL
)) == NULL) {

495 
”rÜ
 = 
”ºo
;

496 
”r
;

499 cÚ¡ 
­Ş_veùÜ_t
 *
high_ÿts
 = 
	`­Ş_mls_Ëv–_g‘_ÿts
(
high_Ëv–
);

500 
size_t
 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
high_ÿts
); i++) {

501 *
ÿt_Çme
 = 
	`­Ş_veùÜ_g‘_–em’t
(
high_ÿts
, 
i
);

503 
size_t
 
j
;

506 ià(
	`­Ş_veùÜ_g‘_šdex
(
ÿtv
, 
ÿt_Çme
, 
mls_Ëv–_Çme_to_ÿt_comp
, 
q
, &
j
) < 0) {

510 ià(
	`­Ş_mls_Ëv–_­³nd_ÿts
(
p
, 
ml
, 
ÿt_Çme
) < 0) {

511 
”rÜ
 = 
”ºo
;

512 
	`­Ş_mls_Ëv–_de¡roy
(&
ml
);

513 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”rÜ
));

514 
”r
;

518 
	`qpŞ_™”©Ü_de¡roy
(&
ÿt™”
);

519 
	`­Ş_veùÜ_de¡roy
(&
ÿtv
);

521 ià(
	`­Ş_veùÜ_­³nd
(
v
, 
ml
) < 0) {

522 
”rÜ
 = 
”ºo
;

523 
	`­Ş_mls_Ëv–_de¡roy
(&
ml
);

524 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”rÜ
));

525 
”r
;

528 
	`­Ş_veùÜ_sÜt
(
v
, 
mls_¿nge_comp
, 
q
);

529 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

530 
	`qpŞ_™”©Ü_de¡roy
(&
ÿt™”
);

531 
	`­Ş_veùÜ_de¡roy
(&
ÿtv
);

532  
v
;

533 
”r
:

534 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

535 
	`qpŞ_™”©Ü_de¡roy
(&
ÿt™”
);

536 
	`­Ş_veùÜ_de¡roy
(&
v
);

537 
	`­Ş_veùÜ_de¡roy
(&
ÿtv
);

538 
”ºo
 = 
”rÜ
;

539  
NULL
;

540 
	}
}

542 *
	$­Ş_mls_¿nge_»nd”
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
­Ş_mls_¿nge_t
 * 
¿nge
)

544 *
¹
 = 
NULL
, *
»tv®
 = NULL;

545 *
sub_¡r
 = 
NULL
;

546 
»tv
;

547 
size_t
 
sz
 = 0;

549 ià(!
¿nge
 ||„ªge->
low
 =ğ
NULL
) {

550 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
EINVAL
));

551 
”ºo
 = 
EINVAL
;

552 
ş—nup
;

554 ià(
p
 =ğ
NULL
 && 
	`­Ş_mls_¿nge_is_l™”®
(
¿nge
) != 1) {

555 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
EINVAL
));

556 
”ºo
 = 
EINVAL
;

557 
ş—nup
;

560 ià((
sub_¡r
 = 
	`­Ş_mls_Ëv–_»nd”
(
p
, 
¿nge
->
low
)è=ğ
NULL
) {

561 
ş—nup
;

563 ià(
	`­Ş_¡r_­³nd
(&
¹
, &
sz
, 
sub_¡r
)) {

564 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

565 
ş—nup
;

567 
	`ä“
(
sub_¡r
);

568 
sub_¡r
 = 
NULL
;

569 ià(
¿nge
->
high
 =ğ
NULL
) {

572 
»tv®
 = 
¹
;

573 
ş—nup
;

575 ià(
p
 =ğ
NULL
) {

577 
»tv
 = 
APOL_MLS_DOM
;

579 
»tv
 = 
	`­Ş_mls_Ëv–_com·»
(
p
, 
¿nge
->
low
,„ªge->
high
);

580 ià(
»tv
 < 0) {

581 
ş—nup
;

585 ià((
»tv
 =ğ
APOL_MLS_DOM
 ||„‘v =ğ
APOL_MLS_DOMBY
è&& 
¿nge
->
high
 !ğ
NULL
) {

586 
sub_¡r
 = 
	`­Ş_mls_Ëv–_»nd”
(
p
, 
¿nge
->
high
);

587 ià(!
sub_¡r
)

588 
ş—nup
;

589 ià(
	`­Ş_¡r_­³ndf
(&
¹
, &
sz
, " - %s", 
sub_¡r
)) {

590 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

591 
ş—nup
;

594 
»tv®
 = 
¹
;

595 
ş—nup
:

596 ià(
»tv®
 !ğ
¹
) {

597 
	`ä“
(
¹
);

599 
	`ä“
(
sub_¡r
);

600  
»tv®
;

601 
	}
}

603 
	$­Ş_mls_¿nge_cÚv”t
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_mls_¿nge_t
 * 
¿nge
)

605 ià(
p
 =ğ
NULL
 || 
¿nge
 == NULL) {

606 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
EINVAL
));

607 
”ºo
 = 
EINVAL
;

610 
­Ş_mls_Ëv–_t
 *
low
 = 
¿nge
->low;

611 
­Ş_mls_Ëv–_t
 *
high
 = 
¿nge
->high;

612 
»tv®
;

613 ià(
low
 !ğ
NULL
) {

614 
»tv®
 = 
	`­Ş_mls_Ëv–_cÚv”t
(
p
, 
low
);

615 ià(
»tv®
 < 0) {

616  
»tv®
;

619 ià(
high
 !ğ
NULL
 && high !ğ
low
) {

620 
»tv®
 = 
	`­Ş_mls_Ëv–_cÚv”t
(
p
, 
high
);

621 ià(
»tv®
 < 0) {

622  
»tv®
;

626 
	}
}

628 
	$­Ş_mls_¿nge_is_l™”®
(cÚ¡ 
­Ş_mls_¿nge_t
 * 
¿nge
)

630 ià(
¿nge
 =ğ
NULL
) {

633 
»t
;

634 ià((
»t
 = 
	`­Ş_mls_Ëv–_is_l™”®
(
¿nge
->
low
)) != 0) {

635  
»t
;

637 ià(
¿nge
->
high
 !ğ
NULL
) {

638 
»t
 = 
	`­Ş_mls_Ëv–_is_l™”®
(
¿nge
->
high
);

640  
»t
;

641 
	}
}

	@libapol/src/netcon-query.c

31 
	~"pŞicy-qu”y-š‹º®.h
"

32 
	~<­Ş/»nd”.h
>

34 
	~<”ºo.h
>

35 
	~<¡ršg.h
>

37 
	s­Ş_pÜtcÚ_qu”y


39 
	m´Ùo
;

40 
	mlow
, 
	mhigh
;

41 
­Ş_cÚ‹xt_t
 *
	mcÚ‹xt
;

42 
	mæags
;

45 
	s­Ş_ÃtifcÚ_qu”y


47 *
	mdev
;

48 
­Ş_cÚ‹xt_t
 *
	mif_cÚ‹xt
, *
	mmsg_cÚ‹xt
;

49 
	mif_æags
, 
	mmsg_æags
;

52 
	s­Ş_nodecÚ_qu”y


54 
	m´Ùo
, 
	maddr_´Ùo
, 
	mmask_´Ùo
;

55 
ušt32_t
 
	maddr
[4], 
	mmask
[4];

56 
­Ş_cÚ‹xt_t
 *
	mcÚ‹xt
;

57 
	mæags
;

62 
	$­Ş_pÜtcÚ_g‘_by_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
­Ş_pÜtcÚ_qu”y_t
 * 
po
, 
­Ş_veùÜ_t
 ** 
v
)

64 
qpŞ_™”©Ü_t
 *
™”
;

65 
»tv®
 = -1, 
»tv®2
;

66 *
v
 = 
NULL
;

67 ià(
	`qpŞ_pŞicy_g‘_pÜtcÚ_™”
(
p
->p, &
™”
) < 0) {

70 ià((*
v
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)) == NULL) {

71 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

72 
ş—nup
;

74 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

75 
qpŞ_pÜtcÚ_t
 *
pÜtcÚ
;

76 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
pÜtcÚ
) < 0) {

77 
ş—nup
;

79 ià(
po
 !ğ
NULL
) {

80 
ušt16_t
 
low
, 
high
;

81 
ušt8_t
 
´Ùo
;

82 cÚ¡ 
qpŞ_cÚ‹xt_t
 *
cÚ‹xt
;

83 ià(
	`qpŞ_pÜtcÚ_g‘_low_pÜt
(
p
->p,

84 
pÜtcÚ
, &
low
) < 0 ||

85 
	`qpŞ_pÜtcÚ_g‘_high_pÜt
(
p
->p,

86 
pÜtcÚ
, &
high
) < 0 ||

87 
	`qpŞ_pÜtcÚ_g‘_´ÙocŞ
(
p
->p,

88 
pÜtcÚ
, &
´Ùo
è< 0 || 
	`qpŞ_pÜtcÚ_g‘_cÚ‹xt
(
p
->p,…ÜtcÚ, &
cÚ‹xt
) < 0)

90 
ş—nup
;

92 ià((
po
->
low
 >ğ0 && ((
ušt16_t
)…o->low) !=†ow) ||

93 (
po
->
high
 >ğ0 && ((
ušt16_t
èpo->highè!ğhighè|| (po->
´Ùo
 >ğ0 && ((
ušt8_t
)…o->proto) !=…roto))

97 
»tv®2
 = 
	`­Ş_com·»_cÚ‹xt
(
p
, 
cÚ‹xt
, 
po
->cÚ‹xt,…o->
æags
);

98 ià(
»tv®2
 < 0) {

99 
ş—nup
;

100 } ià(
»tv®2
 == 0) {

104 ià(
	`­Ş_veùÜ_­³nd
(*
v
, 
pÜtcÚ
)) {

105 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

106 
ş—nup
;

110 
»tv®
 = 0;

111 
ş—nup
:

112 ià(
»tv®
 != 0) {

113 
	`­Ş_veùÜ_de¡roy
(
v
);

115 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

116  
»tv®
;

117 
	}
}

119 
­Ş_pÜtcÚ_qu”y_t
 *
	$­Ş_pÜtcÚ_qu”y_ü—‹
()

121 
­Ş_pÜtcÚ_qu”y_t
 *
po
 = 
	`ÿÎoc
(1, (*po));

122 ià(
po
 =ğ
NULL
) {

123  
NULL
;

125 
po
->
´Ùo
 =…o->
low
 =…o->
high
 = -1;

126  
po
;

127 
	}
}

129 
	$­Ş_pÜtcÚ_qu”y_de¡roy
(
­Ş_pÜtcÚ_qu”y_t
 ** 
po
)

131 ià(*
po
 !ğ
NULL
) {

132 
	`­Ş_cÚ‹xt_de¡roy
(&((*
po
)->
cÚ‹xt
));

133 
	`ä“
(*
po
);

134 *
po
 = 
NULL
;

136 
	}
}

138 
­Ş_pÜtcÚ_qu”y_£t_´ÙocŞ
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
 
__©Œibu‹__
 ((
unu£d
)), 
­Ş_pÜtcÚ_qu”y_t
 * 
po
, 
´Ùo
)

140 
	gpo
->
	g´Ùo
 = 
´Ùo
;

147 
	$­Ş_pÜtcÚ_qu”y_£t_´Ùo
(
­Ş_pŞicy_t
 * 
p
, 
­Ş_pÜtcÚ_qu”y_t
 * 
po
, 
´Ùo
)

149  
	`­Ş_pÜtcÚ_qu”y_£t_´ÙocŞ
(
p
, 
po
, 
´Ùo
);

150 
	}
}

151 
	$­Ş_pÜtcÚ_qu”y_£t_´Ùo
(
­Ş_pŞicy_t
 * 
p
, 
­Ş_pÜtcÚ_qu”y_t
 * 
po
, 
´Ùo
è
	`__©Œibu‹__
 ((
d•»ÿ‹d
));

153 
	`­Ş_pÜtcÚ_qu”y_£t_low
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
 
	`__©Œibu‹__
 ((
unu£d
)), 
­Ş_pÜtcÚ_qu”y_t
 * 
po
, 
low
)

155 
po
->
low
 =†ow;

157 
	}
}

159 
­Ş_pÜtcÚ_qu”y_£t_high
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
 
__©Œibu‹__
 ((
unu£d
)), 
­Ş_pÜtcÚ_qu”y_t
 * 
po
, 
high
)

161 
	gpo
->
	ghigh
 = 
high
;

165 
­Ş_pÜtcÚ_qu”y_£t_cÚ‹xt
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
 
__©Œibu‹__
 ((
unu£d
)),

166 
­Ş_pÜtcÚ_qu”y_t
 * 
po
, 
­Ş_cÚ‹xt_t
 * 
cÚ‹xt
, 
¿nge_m©ch
)

168 ià(
	gpo
->
	gcÚ‹xt
 !ğ
NULL
) {

169 
­Ş_cÚ‹xt_de¡roy
(&
po
->
cÚ‹xt
);

171 
	gpo
->
	gcÚ‹xt
 = 
cÚ‹xt
;

172 
	gpo
->
	gæags
 = (
po
->
æags
 & ~
APOL_QUERY_FLAGS
è| 
¿nge_m©ch
;

176 *
	$­Ş_pÜtcÚ_»nd”
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
qpŞ_pÜtcÚ_t
 * 
pÜtcÚ
)

178 *
lše
 = 
NULL
, *
»tv®
 = NULL;

179 *
buff
 = 
NULL
;

180 cÚ¡ *
´Ùo_¡r
 = 
NULL
;

181 *
cÚ‹xt_¡r
 = 
NULL
;

182 cÚ¡ 
qpŞ_cÚ‹xt_t
 *
ùxt
 = 
NULL
;

183 
ušt16_t
 
low_pÜt
, 
high_pÜt
;

184 
ušt8_t
 
´Ùo
;

186 cÚ¡ 
size_t
 
bufæ’
 = 50;

187 ià(!
pÜtcÚ
 || !
p
)

188 
ş—nup
;

190 
buff
 = (*)
	`ÿÎoc
(
bufæ’
 + 1, ());

191 ià(!
buff
) {

192 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

193 
ş—nup
;

196 ià(
	`qpŞ_pÜtcÚ_g‘_´ÙocŞ
(
p
->p, 
pÜtcÚ
, &
´Ùo
))

197 
ş—nup
;

199 ià((
´Ùo_¡r
 = 
	`­Ş_´ÙocŞ_to_¡r
(
´Ùo
)è=ğ
NULL
) {

200 
	`ERR
(
p
, "%s", "Could‚ot get…rotocol string.");

201 
ş—nup
;

203 ià(
	`qpŞ_pÜtcÚ_g‘_low_pÜt
(
p
->p, 
pÜtcÚ
, &
low_pÜt
))

204 
ş—nup
;

205 ià(
	`qpŞ_pÜtcÚ_g‘_high_pÜt
(
p
->p, 
pÜtcÚ
, &
high_pÜt
))

206 
ş—nup
;

207 ià(
low_pÜt
 =ğ
high_pÜt
)

208 
	`¢´štf
(
buff
, 
bufæ’
, "%d", 
low_pÜt
);

210 
	`¢´štf
(
buff
, 
bufæ’
, "%d-%d", 
low_pÜt
, 
high_pÜt
);

212 ià(
	`qpŞ_pÜtcÚ_g‘_cÚ‹xt
(
p
->p, 
pÜtcÚ
, &
ùxt
))

213 
ş—nup
;

214 
cÚ‹xt_¡r
 = 
	`­Ş_qpŞ_cÚ‹xt_»nd”
(
p
, 
ùxt
);

215 ià(!
cÚ‹xt_¡r
)

216 
ş—nup
;

218 
lše
 = (*)
	`ÿÎoc
(4 + 
	`¡¾’
("pÜtcÚ"è+ sŒËn(
´Ùo_¡r
è+ sŒËn(
buff
è+ sŒËn(
cÚ‹xt_¡r
), ());

219 ià(!
lše
) {

220 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

221 
ş—nup
;

224 
	`¥rštf
(
lše
, "pÜtcÚ % % %s", 
´Ùo_¡r
, 
buff
, 
cÚ‹xt_¡r
);

226 
»tv®
 = 
lše
;

227 
ş—nup
:

228 
	`ä“
(
buff
);

229 
	`ä“
(
cÚ‹xt_¡r
);

230 ià(
»tv®
 !ğ
lše
) {

231 
	`ä“
(
lše
);

233  
»tv®
;

234 
	}
}

238 
	$­Ş_ÃtifcÚ_g‘_by_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
­Ş_ÃtifcÚ_qu”y_t
 * 
n
, 
­Ş_veùÜ_t
 ** 
v
)

240 
qpŞ_™”©Ü_t
 *
™”
;

241 
»tv®
 = -1, 
»tv®2
;

242 *
v
 = 
NULL
;

243 ià(
	`qpŞ_pŞicy_g‘_ÃtifcÚ_™”
(
p
->p, &
™”
) < 0) {

246 ià((*
v
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)) == NULL) {

247 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

248 
ş—nup
;

250 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

251 cÚ¡ 
qpŞ_ÃtifcÚ_t
 *
ÃtifcÚ
;

252 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
ÃtifcÚ
) < 0) {

253 
ş—nup
;

255 ià(
n
 !ğ
NULL
) {

256 cÚ¡ *
Çme
;

257 cÚ¡ 
qpŞ_cÚ‹xt_t
 *
ifcÚ
, *
msgcÚ
;

258 ià(
	`qpŞ_ÃtifcÚ_g‘_Çme
(
p
->p, 
ÃtifcÚ
, &
Çme
) < 0 ||

259 
	`qpŞ_ÃtifcÚ_g‘_if_cÚ
(
p
->p, 
ÃtifcÚ
, &
ifcÚ
) < 0 ||

260 
	`qpŞ_ÃtifcÚ_g‘_msg_cÚ
(
p
->p, 
ÃtifcÚ
, &
msgcÚ
) < 0) {

261 
ş—nup
;

263 
»tv®2
 = 
	`­Ş_com·»
(
p
, 
Çme
, 
n
->
dev
, 0, 
NULL
);

264 ià(
»tv®2
 < 0) {

265 
ş—nup
;

266 } ià(
»tv®2
 == 0) {

269 
»tv®2
 = 
	`­Ş_com·»_cÚ‹xt
(
p
, 
ifcÚ
, 
n
->
if_cÚ‹xt
,‚->
if_æags
);

270 ià(
»tv®2
 < 0) {

271 
ş—nup
;

272 } ià(
»tv®2
 == 0) {

275 
»tv®2
 = 
	`­Ş_com·»_cÚ‹xt
(
p
, 
msgcÚ
, 
n
->
msg_cÚ‹xt
,‚->
msg_æags
);

276 ià(
»tv®2
 < 0) {

277 
ş—nup
;

278 } ià(
»tv®2
 == 0) {

282 ià(
	`­Ş_veùÜ_­³nd
(*
v
, (*)
ÃtifcÚ
)) {

283 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

284 
ş—nup
;

288 
»tv®
 = 0;

289 
ş—nup
:

290 ià(
»tv®
 != 0) {

291 
	`­Ş_veùÜ_de¡roy
(
v
);

293 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

294  
»tv®
;

295 
	}
}

297 
­Ş_ÃtifcÚ_qu”y_t
 *
	$­Ş_ÃtifcÚ_qu”y_ü—‹
()

299  
	`ÿÎoc
(1, (
­Ş_ÃtifcÚ_qu”y_t
));

300 
	}
}

302 
	$­Ş_ÃtifcÚ_qu”y_de¡roy
(
­Ş_ÃtifcÚ_qu”y_t
 ** 
n
)

304 ià(*
n
 !ğ
NULL
) {

305 
	`ä“
((*
n
)->
dev
);

306 
	`­Ş_cÚ‹xt_de¡roy
(&((*
n
)->
if_cÚ‹xt
));

307 
	`­Ş_cÚ‹xt_de¡roy
(&((*
n
)->
msg_cÚ‹xt
));

308 
	`ä“
(*
n
);

309 *
n
 = 
NULL
;

311 
	}
}

313 
	$­Ş_ÃtifcÚ_qu”y_£t_deviû
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_ÃtifcÚ_qu”y_t
 * 
n
, cÚ¡ *
dev
)

315  
	`­Ş_qu”y_£t
(
p
, &
n
->
dev
, 
NULL
, dev);

316 
	}
}

318 
­Ş_ÃtifcÚ_qu”y_£t_if_cÚ‹xt
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
 
__©Œibu‹__
 ((
unu£d
)),

319 
­Ş_ÃtifcÚ_qu”y_t
 * 
n
, 
­Ş_cÚ‹xt_t
 * 
cÚ‹xt
, 
¿nge_m©ch
)

321 ià(
	gn
->
	gif_cÚ‹xt
 !ğ
NULL
) {

322 
­Ş_cÚ‹xt_de¡roy
(&
n
->
if_cÚ‹xt
);

324 
	gn
->
	gif_cÚ‹xt
 = 
cÚ‹xt
;

325 
	gn
->
	gif_æags
 = (
n
->
if_æags
 & ~
APOL_QUERY_FLAGS
è| 
¿nge_m©ch
;

329 
­Ş_ÃtifcÚ_qu”y_£t_msg_cÚ‹xt
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
 
__©Œibu‹__
 ((
unu£d
)),

330 
­Ş_ÃtifcÚ_qu”y_t
 * 
n
, 
­Ş_cÚ‹xt_t
 * 
cÚ‹xt
, 
¿nge_m©ch
)

332 ià(
	gn
->
	gmsg_cÚ‹xt
 !ğ
NULL
) {

333 
­Ş_cÚ‹xt_de¡roy
(&
n
->
msg_cÚ‹xt
);

335 
	gn
->
	gmsg_cÚ‹xt
 = 
cÚ‹xt
;

336 
	gn
->
	gmsg_æags
 = (
n
->
msg_æags
 & ~
APOL_QUERY_FLAGS
è| 
¿nge_m©ch
;

340 *
	$­Ş_ÃtifcÚ_»nd”
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
qpŞ_ÃtifcÚ_t
 * 
ÃtifcÚ
)

342 *
lše
 = 
NULL
, *
»tv®
 = NULL;

343 *
devcÚ_¡r
 = 
NULL
;

344 *
pktcÚ_¡r
 = 
NULL
;

345 cÚ¡ *
içû_¡r
 = 
NULL
;

346 cÚ¡ 
qpŞ_cÚ‹xt_t
 *
ùxt
 = 
NULL
;

348 ià(!
ÃtifcÚ
 || !
p
)

349 
ş—nup
;

351 ià(
	`qpŞ_ÃtifcÚ_g‘_if_cÚ
(
p
->p, 
ÃtifcÚ
, &
ùxt
))

352 
ş—nup
;

353 
devcÚ_¡r
 = 
	`­Ş_qpŞ_cÚ‹xt_»nd”
(
p
, 
ùxt
);

354 ià(!
devcÚ_¡r
)

355 
ş—nup
;

357 ià(
	`qpŞ_ÃtifcÚ_g‘_msg_cÚ
(
p
->p, 
ÃtifcÚ
, &
ùxt
))

358 
ş—nup
;

359 
pktcÚ_¡r
 = 
	`­Ş_qpŞ_cÚ‹xt_»nd”
(
p
, 
ùxt
);

360 ià(!
pktcÚ_¡r
) {

361 
ş—nup
;

364 ià(
	`qpŞ_ÃtifcÚ_g‘_Çme
(
p
->p, 
ÃtifcÚ
, &
içû_¡r
))

365  
NULL
;

366 
lše
 = (*)
	`ÿÎoc
(4 + 
	`¡¾’
(
içû_¡r
è+ sŒËn(
devcÚ_¡r
è+ sŒËn(
pktcÚ_¡r
) + strlen("netifcon"), ());

367 ià(!
lše
) {

368 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

369 
ş—nup
;

371 
	`¥rštf
(
lše
, "ÃtifcÚ % % %s", 
içû_¡r
, 
devcÚ_¡r
, 
pktcÚ_¡r
);

373 
»tv®
 = 
lše
;

374 
ş—nup
:

375 
	`ä“
(
devcÚ_¡r
);

376 
	`ä“
(
pktcÚ_¡r
);

377  
»tv®
;

378 
	}
}

382 
	$­Ş_nodecÚ_g‘_by_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
­Ş_nodecÚ_qu”y_t
 * 
n
, 
­Ş_veùÜ_t
 ** 
v
)

384 
qpŞ_™”©Ü_t
 *
™”
;

385 
»tv®
 = -1, 
»tv®2
;

386 
qpŞ_nodecÚ_t
 *
nodecÚ
 = 
NULL
;

387 *
v
 = 
NULL
;

388 ià(
	`qpŞ_pŞicy_g‘_nodecÚ_™”
(
p
->p, &
™”
) < 0) {

391 ià((*
v
 = 
	`­Ş_veùÜ_ü—‹
(
ä“
)è=ğ
NULL
) {

392 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

393 
ş—nup
;

395 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

396 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
nodecÚ
) < 0) {

397 
ş—nup
;

399 ià(
n
 !ğ
NULL
) {

400 
´Ùo
, 
´Ùo_a
, 
´Ùo_m
;

401 
ušt32_t
 *
addr
, *
mask
;

402 cÚ¡ 
qpŞ_cÚ‹xt_t
 *
cÚ
;

403 ià(
	`qpŞ_nodecÚ_g‘_´ÙocŞ
(
p
->p, 
nodecÚ
, &
´Ùo
) < 0 ||

404 
	`qpŞ_nodecÚ_g‘_addr
(
p
->p, 
nodecÚ
, &
addr
, &
´Ùo_a
) < 0 ||

405 
	`qpŞ_nodecÚ_g‘_mask
(
p
->p, 
nodecÚ
, &
mask
, &
´Ùo_m
) < 0 ||

406 
	`qpŞ_nodecÚ_g‘_cÚ‹xt
(
p
->p, 
nodecÚ
, &
cÚ
) < 0) {

407 
ş—nup
;

409 ià(
n
->
´Ùo
 >= 0 &&‚->proto !=…roto) {

410 
	`ä“
(
nodecÚ
);

413 ià(
n
->
addr_´Ùo
 >= 0 &&

414 (
n
->
addr_´Ùo
 !ğ
´Ùo_a
 ||

415 (
´Ùo_a
 =ğ
QPOL_IPV4
 && 
	`memcmp
(
n
->
addr
,‡ddr, 1 * (
ušt32_t
)) != 0) ||

416 (
´Ùo_a
 =ğ
QPOL_IPV6
 && 
	`memcmp
(
n
->
addr
,‡ddr, 4 * (
ušt32_t
)) != 0))) {

417 
	`ä“
(
nodecÚ
);

420 ià(
n
->
mask_´Ùo
 >= 0 &&

421 (
n
->
mask_´Ùo
 !ğ
´Ùo_m
 ||

422 (
´Ùo_m
 =ğ
QPOL_IPV4
 && 
	`memcmp
(
n
->
mask
, mask, 1 * (
ušt32_t
)) != 0) ||

423 (
´Ùo_m
 =ğ
QPOL_IPV6
 && 
	`memcmp
(
n
->
mask
, mask, 4 * (
ušt32_t
)) != 0))) {

424 
	`ä“
(
nodecÚ
);

427 
»tv®2
 = 
	`­Ş_com·»_cÚ‹xt
(
p
, 
cÚ
, 
n
->
cÚ‹xt
,‚->
æags
);

428 ià(
»tv®2
 < 0) {

429 
ş—nup
;

430 } ià(
»tv®2
 == 0) {

431 
	`ä“
(
nodecÚ
);

435 ià(
	`­Ş_veùÜ_­³nd
(*
v
, 
nodecÚ
)) {

436 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

437 
ş—nup
;

441 
»tv®
 = 0;

442 
ş—nup
:

443 ià(
»tv®
 != 0) {

444 
	`­Ş_veùÜ_de¡roy
(
v
);

445 
	`ä“
(
nodecÚ
);

447 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

448  
»tv®
;

449 
	}
}

451 
­Ş_nodecÚ_qu”y_t
 *
	$­Ş_nodecÚ_qu”y_ü—‹
()

453 
­Ş_nodecÚ_qu”y_t
 *
n
 = 
	`ÿÎoc
(1, (apol_nodecon_query_t));

454 ià(
n
 !ğ
NULL
) {

455 
n
->
´Ùo
 =‚->
addr_´Ùo
 =‚->
mask_´Ùo
 = -1;

457  
n
;

458 
	}
}

460 
	$­Ş_nodecÚ_qu”y_de¡roy
(
­Ş_nodecÚ_qu”y_t
 ** 
n
)

462 ià(*
n
 !ğ
NULL
) {

463 
	`­Ş_cÚ‹xt_de¡roy
(&((*
n
)->
cÚ‹xt
));

464 
	`ä“
(*
n
);

465 *
n
 = 
NULL
;

467 
	}
}

469 
	$­Ş_nodecÚ_qu”y_£t_´ÙocŞ
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_nodecÚ_qu”y_t
 * 
n
, 
´Ùo
)

471 ià(
´Ùo
 =ğ
QPOL_IPV4
 ||…rÙØ=ğ
QPOL_IPV6
) {

472 
n
->
´Ùo
 = ()proto;

473 } ià(
´Ùo
 < 0) {

474 
n
->
´Ùo
 = -1;

476 
	`ERR
(
p
, "Inv®id…rÙocŞ v®u%d.", 
´Ùo
);

480 
	}
}

485 
	$­Ş_nodecÚ_qu”y_£t_´Ùo
(
­Ş_pŞicy_t
 * 
p
, 
­Ş_nodecÚ_qu”y_t
 * 
n
, 
´Ùo
)

487  
	`­Ş_nodecÚ_qu”y_£t_´ÙocŞ
(
p
, 
n
, 
´Ùo
);

488 
	}
}

489 
	$­Ş_nodecÚ_qu”y_£t_´Ùo
(
­Ş_pŞicy_t
 * 
p
, 
­Ş_nodecÚ_qu”y_t
 * 
n
, 
´Ùo
è
	`__©Œibu‹__
 ((
d•»ÿ‹d
));

491 
	$­Ş_nodecÚ_qu”y_£t_addr
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_nodecÚ_qu”y_t
 * 
n
, 
ušt32_t
 * 
addr
, 
´Ùo
)

493 ià(
addr
 =ğ
NULL
) {

494 
n
->
addr_´Ùo
 = -1;

496 ià(
´Ùo
 =ğ
QPOL_IPV4
) {

497 
	`memıy
(
n
->
addr
,‡ddr, 1 * (
ušt32_t
));

498 } ià(
´Ùo
 =ğ
QPOL_IPV6
) {

499 
	`memıy
(
n
->
addr
,‡ddr, 4 * (
ušt32_t
));

501 
	`ERR
(
p
, "Inv®id…rÙocŞ v®u%d.", 
´Ùo
);

504 
n
->
addr_´Ùo
 = ()
´Ùo
;

507 
	}
}

509 
	$­Ş_nodecÚ_qu”y_£t_mask
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_nodecÚ_qu”y_t
 * 
n
, 
ušt32_t
 * 
mask
, 
´Ùo
)

511 ià(
mask
 =ğ
NULL
) {

512 
n
->
mask_´Ùo
 = -1;

514 ià(
´Ùo
 =ğ
QPOL_IPV4
) {

515 
	`memıy
(
n
->
mask
, mask, 1 * (
ušt32_t
));

516 } ià(
´Ùo
 =ğ
QPOL_IPV6
) {

517 
	`memıy
(
n
->
mask
, mask, 4 * (
ušt32_t
));

519 
	`ERR
(
p
, "Inv®id…rÙocŞ v®u%d.", 
´Ùo
);

522 
n
->
mask_´Ùo
 = ()
´Ùo
;

525 
	}
}

527 
­Ş_nodecÚ_qu”y_£t_cÚ‹xt
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
 
__©Œibu‹__
 ((
unu£d
)),

528 
­Ş_nodecÚ_qu”y_t
 * 
n
, 
­Ş_cÚ‹xt_t
 * 
cÚ‹xt
, 
¿nge_m©ch
)

530 ià(
	gn
->
	gcÚ‹xt
 !ğ
NULL
) {

531 
­Ş_cÚ‹xt_de¡roy
(&
n
->
cÚ‹xt
);

533 
	gn
->
	gcÚ‹xt
 = 
cÚ‹xt
;

534 
	gn
->
	gæags
 = (
n
->
æags
 & ~
APOL_QUERY_FLAGS
è| 
¿nge_m©ch
;

538 *
	$­Ş_nodecÚ_»nd”
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
qpŞ_nodecÚ_t
 * 
nodecÚ
)

540 *
lše
 = 
NULL
, *
»tv®
 = NULL;

541 *
cÚ‹xt_¡r
 = 
NULL
;

542 *
addr_¡r
 = 
NULL
;

543 *
mask_¡r
 = 
NULL
;

544 cÚ¡ 
qpŞ_cÚ‹xt_t
 *
ùxt
 = 
NULL
;

545 
´ÙocŞ
, 
addr_´Ùo
, 
mask_´Ùo
;

546 
ušt32_t
 *
addr
 = 
NULL
, *
mask
 = NULL;

548 ià(!
nodecÚ
 || !
p
)

549 
ş—nup
;

551 ià(
	`qpŞ_nodecÚ_g‘_´ÙocŞ
(
p
->p, 
nodecÚ
, &
´ÙocŞ
))

552 
ş—nup
;

553 ià(
	`qpŞ_nodecÚ_g‘_addr
(
p
->p, 
nodecÚ
, &
addr
, &
addr_´Ùo
))

554 
ş—nup
;

555 ià(
	`qpŞ_nodecÚ_g‘_mask
(
p
->p, 
nodecÚ
, &
mask
, &
mask_´Ùo
))

556 
ş—nup
;

557 
´ÙocŞ
) {

558 
QPOL_IPV4
:

559 ià((
addr_¡r
 = 
	`­Ş_v4_addr_»nd”
(
p
, 
addr
)è=ğ
NULL
 || (
mask_¡r
 =‡pŞ_v4_addr_»nd”Õ, 
mask
)) == NULL) {

560 
ş—nup
;

563 
QPOL_IPV6
:

564 ià((
addr_¡r
 = 
	`­Ş_v6_addr_»nd”
(
p
, 
addr
)è=ğ
NULL
 || (
mask_¡r
 =‡pŞ_v6_addr_»nd”Õ, 
mask
)) == NULL) {

565 
ş—nup
;

572 ià(
	`qpŞ_nodecÚ_g‘_cÚ‹xt
(
p
->p, 
nodecÚ
, &
ùxt
))

573 
ş—nup
;

574 
cÚ‹xt_¡r
 = 
	`­Ş_qpŞ_cÚ‹xt_»nd”
(
p
, 
ùxt
);

575 ià(!
cÚ‹xt_¡r
)

576 
ş—nup
;

578 
lše
 = (*)
	`ÿÎoc
(4 + 
	`¡¾’
("nodecÚ"è+ sŒËn(
addr_¡r
è+ sŒËn(
mask_¡r
è+ sŒËn(
cÚ‹xt_¡r
), ());

579 ià(!
lše
) {

580 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

581 
ş—nup
;

584 
	`¥rštf
(
lše
, "nodecÚ % % %s", 
addr_¡r
, 
mask_¡r
, 
cÚ‹xt_¡r
);

586 
»tv®
 = 
lše
;

587 
ş—nup
:

588 
	`ä“
(
addr_¡r
);

589 
	`ä“
(
mask_¡r
);

590 
	`ä“
(
cÚ‹xt_¡r
);

591  
»tv®
;

592 
	}
}

	@libapol/src/perm-map.c

26 
	~"pŞicy-qu”y-š‹º®.h
"

28 
	~<­Ş/³rm-m­.h
>

30 
	~<”ºo.h
>

31 
	~<¡dio.h
>

32 
	~<¡ršg.h
>

33 
	~<time.h
>

36 
	#APOL_LINE_SZ
 8192

	)

38 
	s­Ş_³rmm­


40 
	mm­³d
;

43 
­Ş_veùÜ_t
 *
	mşas£s
;

47 
	s­Ş_³rmm­_şass


49 
	mm­³d
;

51 cÚ¡ 
qpŞ_şass_t
 *
	mc
;

53 
­Ş_veùÜ_t
 *
	m³rms
;

54 } 
	t­Ş_³rmm­_şass_t
;

62 
	s­Ş_³rmm­_³rm


65 *
	mÇme
;

67 
	mm­
;

69 
	mweight
;

70 } 
	t­Ş_³rmm­_³rm_t
;

73 
	#APOL_PERMMAP_RET_UNMAPPED_PERM
 0x01

	)

75 
	#APOL_PERMMAP_RET_UNMAPPED_OBJ
 0x02

	)

77 
	#APOL_PERMMAP_RET_UNKNOWN_PERM
 0x04

	)

79 
	#APOL_PERMMAP_RET_UNKNOWN_OBJ
 0x08

	)

81 
	#APOL_PERMMAP_RET_NOT_ENOUGH
 0x10

	)

89 
	$³rmm­_³rm_ä“
(*
–em
)

91 ià(
–em
 !ğ
NULL
) {

92 
­Ş_³rmm­_³rm_t
 *
p
 = (­Ş_³rmm­_³rm_ˆ*è
–em
;

93 
	`ä“
(
p
->
Çme
);

94 
	`ä“
(
p
);

96 
	}
}

104 
	$³rmm­_şass_ä“
(*
–em
)

106 ià(
–em
 !ğ
NULL
) {

107 
­Ş_³rmm­_şass_t
 *
c
 = (­Ş_³rmm­_şass_ˆ*è
–em
;

108 
	`­Ş_veùÜ_de¡roy
(&
c
->
³rms
);

109 
	`ä“
(
c
);

111 
	}
}

127 
­Ş_³rmm­_³rm_t
 *
	$­Ş_³rmm­_³rm_ü—‹
(cÚ¡ *
Çme
, 
m­
, 
weight
)

129 
­Ş_³rmm­_³rm_t
 *
µ
;

130 ià((
µ
 = 
	`ÿÎoc
(1, (*µ))è=ğ
NULL
) {

131  
NULL
;

133 ià((
µ
->
Çme
 = 
	`¡rdup
Òame)è=ğ
NULL
) {

134 
	`ä“
(
µ
);

135  
NULL
;

137 
µ
->
m­
 = map;

138 
µ
->
weight
 = weight;

139  
µ
;

140 
	}
}

151 
­Ş_³rmm­_t
 *
	$­Ş_³rmm­_ü—‹_äom_pŞicy
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
)

153 
­Ş_³rmm­_t
 *
t
 = 
NULL
;

154 
qpŞ_™”©Ü_t
 *
şass_™”
 = 
NULL
, *
³rm_™”
 = NULL, *
commÚ_™”
 = NULL;

155 
size_t
 
num_obj_şas£s
;

156 
»tv®
 = -1;

158 ià(
p
 =ğ
NULL
) {

159 
ş—nup
;

162 ià((
t
 = (
­Ş_³rmm­_t
 *è
	`ÿÎoc
(1, (*t))è=ğ
NULL
) {

163 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

164 
ş—nup
;

166 ià(
	`qpŞ_pŞicy_g‘_şass_™”
(
p
->p, &
şass_™”
è< 0 || 
	`qpŞ_™”©Ü_g‘_size
(şass_™”, &
num_obj_şas£s
) < 0) {

167 
ş—nup
;

169 
t
->
m­³d
 = 0;

170 ià((
t
->
şas£s
 = 
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(
num_obj_şas£s
, 
³rmm­_şass_ä“
)è=ğ
NULL
) {

171 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

172 
ş—nup
;

174 ; !
	`qpŞ_™”©Ü_’d
(
şass_™”
); 
	`qpŞ_™”©Ü_Ãxt
(class_iter)) {

175 cÚ¡ 
qpŞ_şass_t
 *
c
;

176 cÚ¡ 
qpŞ_commÚ_t
 *
commÚ
;

177 
­Ş_³rmm­_şass_t
 *
pc
 = 
NULL
;

178 
­Ş_³rmm­_³rm_t
 *
µ
 = 
NULL
;

179 
size_t
 
num_unique_³rms
, 
num_commÚ_³rms
 = 0;

180 *
Çme
;

181 ià(
	`qpŞ_™”©Ü_g‘_™em
(
şass_™”
, (**)&
c
) < 0 ||

182 
	`qpŞ_şass_g‘_³rm_™”
(
p
->p, 
c
, &
³rm_™”
) < 0 ||

183 
	`qpŞ_™”©Ü_g‘_size
(
³rm_™”
, &
num_unique_³rms
è< 0 || 
	`qpŞ_şass_g‘_commÚ
(
p
->p, 
c
, &
commÚ
) < 0) {

184 
ş—nup
;

186 ià(
commÚ
 !ğ
NULL
 &&

187 (
	`qpŞ_commÚ_g‘_³rm_™”
(
p
->p, 
commÚ
, &
commÚ_™”
) < 0 ||

188 
	`qpŞ_™”©Ü_g‘_size
(
commÚ_™”
, &
num_commÚ_³rms
) < 0)) {

189 
ş—nup
;

191 ià((
pc
 = 
	`ÿÎoc
(1, (*pc))è=ğ
NULL
 || 
	`­Ş_veùÜ_­³nd
(
t
->
şas£s
,…c) < 0) {

192 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

193 
	`³rmm­_şass_ä“
(
pc
);

194 
ş—nup
;

196 
pc
->
m­³d
 = 0;

197 
pc
->
c
 = c;

198 ià((
pc
->
³rms
 = 
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(
num_unique_³rms
 + 
num_commÚ_³rms
, 
³rmm­_³rm_ä“
)è=ğ
NULL
) {

199 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

200 
ş—nup
;

204 ; !
	`qpŞ_™”©Ü_’d
(
³rm_™”
); 
	`qpŞ_™”©Ü_Ãxt
(perm_iter)) {

205 ià(
	`qpŞ_™”©Ü_g‘_™em
(
³rm_™”
, (**)&
Çme
) < 0) {

206 
ş—nup
;

208 ià((
µ
 = 
	`­Ş_³rmm­_³rm_ü—‹
(
Çme
, 0, ()
APOL_PERMMAP_MIN_WEIGHT
)è=ğ
NULL
 ||

209 
	`­Ş_veùÜ_­³nd
(
pc
->
³rms
, 
µ
) < 0) {

210 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

211 
	`³rmm­_³rm_ä“
(
µ
);

212 
ş—nup
;

216 ; 
commÚ_™”
 !ğ
NULL
 && !
	`qpŞ_™”©Ü_’d
(commÚ_™”); 
	`qpŞ_™”©Ü_Ãxt
(common_iter)) {

217 ià(
	`qpŞ_™”©Ü_g‘_™em
(
commÚ_™”
, (**)&
Çme
) < 0) {

218 
ş—nup
;

220 ià((
µ
 = 
	`­Ş_³rmm­_³rm_ü—‹
(
Çme
, 0, ()
APOL_PERMMAP_MIN_WEIGHT
)è=ğ
NULL
 ||

221 
	`­Ş_veùÜ_­³nd
(
pc
->
³rms
, 
µ
) < 0) {

222 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

223 
	`³rmm­_³rm_ä“
(
µ
);

224 
ş—nup
;

227 
	`qpŞ_™”©Ü_de¡roy
(&
³rm_™”
);

228 
	`qpŞ_™”©Ü_de¡roy
(&
commÚ_™”
);

231 
»tv®
 = 0;

232 
ş—nup
:

233 
	`qpŞ_™”©Ü_de¡roy
(&
şass_™”
);

234 
	`qpŞ_™”©Ü_de¡roy
(&
³rm_™”
);

235 
	`qpŞ_™”©Ü_de¡roy
(&
commÚ_™”
);

236 ià(
»tv®
 < 0) {

237 
	`³rmm­_de¡roy
(&
t
);

239  
t
;

240 
	}
}

242 
	$³rmm­_de¡roy
(
­Ş_³rmm­_t
 ** 
p
)

244 ià(
p
 =ğ
NULL
 || *p == NULL)

246 
	`­Ş_veùÜ_de¡roy
(&(*
p
)->
şas£s
);

247 
	`ä“
(*
p
);

248 *
p
 = 
NULL
;

249 
	}
}

261 
­Ş_³rmm­_şass_t
 *
	$fšd_³rmm­_şass
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ *
rg‘
)

263 
size_t
 
i
;

264 cÚ¡ 
qpŞ_şass_t
 *
rg‘_şass
;

265 ià(
	`qpŞ_pŞicy_g‘_şass_by_Çme
(
p
->p, 
rg‘
, &
rg‘_şass
) < 0) {

266  
NULL
;

268 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
p
->
pm­
->
şas£s
); i++) {

269 
­Ş_³rmm­_şass_t
 *
pc
 = 
	`­Ş_veùÜ_g‘_–em’t
(
p
->
pm­
->
şas£s
, 
i
);

270 ià(
pc
->
c
 =ğ
rg‘_şass
) {

271  
pc
;

274  
NULL
;

275 
	}
}

288 
­Ş_³rmm­_³rm_t
 *
fšd_³rmm­_³rm
(cÚ¡ 
­Ş_pŞicy_t
 * 
p


289 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
­Ş_³rmm­_şass_t
 * 
pc
, cÚ¡ *
rg‘
)

291 
size_t
 
	gi
;

292 
	gi
 = 0; i < 
­Ş_veùÜ_g‘_size
(
pc
->
³rms
); i++) {

293 
­Ş_³rmm­_³rm_t
 *
	gµ
 = 
­Ş_veùÜ_g‘_–em’t
(
pc
->
³rms
, 
i
);

294 ià(
¡rcmp
(
µ
->
Çme
, 
rg‘
) == 0) {

295  
µ
;

298  
	gNULL
;

311 
	$cÚv”t_m­_ch¬
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ *
³rm_Çme
, 
m­id
)

313 
m­id
) {

316  
APOL_PERMMAP_READ
;

319  
APOL_PERMMAP_WRITE
;

322  
APOL_PERMMAP_BOTH
;

325  
APOL_PERMMAP_NONE
;

327 
	`ERR
(
p
, "Inv®id m­ ch¬aù” '%c' fÜ…”missiÚ %s;…”missiÚ wÈbunm­³d.", 
m­id
, 
³rm_Çme
);

328  
APOL_PERMMAP_UNMAPPED
;

330 
	}
}

340 
	$¬e_®l_şas£s_m­³d
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
)

342 
size_t
 
i
;

343 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
p
->
pm­
->
şas£s
); i++) {

344 
­Ş_³rmm­_şass_t
 *
pc
 = 
	`­Ş_veùÜ_g‘_–em’t
(
p
->
pm­
->
şas£s
, 
i
);

345 ià(
pc
->
m­³d
 == 0) {

346 cÚ¡ *
şass_Çme
;

347 ià(
	`qpŞ_şass_g‘_Çme
(
p
->p, 
pc
->
c
, &
şass_Çme
) < 0) {

350 
	`WARN
(
p
, "Som³rmissiÚ w”unm­³d fÜ cÏs %s.", 
şass_Çme
);

355 
	}
}

366 
	$¬e_®l_³rms_m­³d
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
­Ş_³rmm­_şass_t
 * 
pc
)

368 
size_t
 
i
;

369 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
pc
->
³rms
); i++) {

370 
­Ş_³rmm­_³rm_t
 *
µ
 = 
	`­Ş_veùÜ_g‘_–em’t
(
pc
->
³rms
, 
i
);

371 ià(
µ
->
m­
 == 0) {

372 cÚ¡ *
şass_Çme
;

373 ià(
	`qpŞ_şass_g‘_Çme
(
p
->p, 
pc
->
c
, &
şass_Çme
) < 0) {

376 
	`WARN
(
p
, "P”missiÚ % wa unm­³d fÜ cÏs %s.", 
µ
->
Çme
, 
şass_Çme
);

381 
	}
}

399 
	$·r£_³rmm­_şass
(
­Ş_pŞicy_t
 * 
p
, 
FILE
 * 
å
, 
size_t
 
num_³rms
, 
­Ş_³rmm­_şass_t
 * 
pc
)

401 
lše
[
APOL_LINE_SZ
], 
³rm_Çme
[APOL_LINE_SZ], *
lše_±r
 = 
NULL
;

402 
size_t
 
³rms_»ad
 = 0;

403 
»tv®
 = 0;

405 
	`fg‘s
(
lše
, Öše), 
å
è!ğ
NULL
 && 
³rms_»ad
 < 
num_³rms
) {

406 
m­id
;

407 
³rm_weight
, 
Ãw_weight
;

408 
­Ş_³rmm­_³rm_t
 *
µ
;

410 
lše_±r
 = 
lše
;

411 
	`­Ş_¡r_Œim
(
lše_±r
);

412 ià(
lše_±r
[0] =ğ'#' || 
	`­Ş_¡r_is_Úly_wh™e_¥aû
(line_ptr))

414 
³rms_»ad
++;

415 ià(
	`ssÿnf
(
lše_±r
, "% %ø%d", 
³rm_Çme
, &
m­id
, &
³rm_weight
) != 3) {

417 ià(
	`ssÿnf
(
lše_±r
, "% %c", 
³rm_Çme
, &
m­id
) != 2) {

418 
	`ERR
(
p
, "P”missiÚ m­ ha ª inv®id†še: \"%s\"", 
lše_±r
);

421 
³rm_weight
 = 
APOL_PERMMAP_MAX_WEIGHT
;

423 ià(
	`¡rcmp
(
³rm_Çme
, "class") == 0) {

424 
	`ERR
(
p
, "Th”w”suµo£dØb%zu…”missiÚs, buˆÚly %zu w”found.", 
num_³rms
, 
³rms_»ad
);

427 
Ãw_weight
 = 
³rm_weight
;

428 ià(
³rm_weight
 > 
APOL_PERMMAP_MAX_WEIGHT
) {

429 
Ãw_weight
 = 
APOL_PERMMAP_MAX_WEIGHT
;

430 } ià(
³rm_weight
 < 
APOL_PERMMAP_MIN_WEIGHT
) {

431 
Ãw_weight
 = 
APOL_PERMMAP_MIN_WEIGHT
;

433 ià(
Ãw_weight
 !ğ
³rm_weight
) {

434 
	`WARN
(
p
, "P”missiÚ %s' weighˆ%d i šv®id. S‘tšg iˆtØ%d in¡—d.", 
³rm_Çme
, 
³rm_weight
,

435 
Ãw_weight
);

436 
³rm_weight
 = 
Ãw_weight
;

438 ià(
pc
 !ğ
NULL
) {

439 ià((
µ
 = 
	`fšd_³rmm­_³rm
(
p
, 
pc
, 
³rm_Çme
)è=ğ
NULL
) {

440 
	`WARN
(
p
,

442 
³rm_Çme
);

443 
»tv®
 |ğ
APOL_PERMMAP_RET_UNKNOWN_PERM
;

445 
µ
->
weight
 = 
³rm_weight
;

446 
µ
->
m­
 = 
	`cÚv”t_m­_ch¬
(
p
, 
³rm_Çme
, 
m­id
);

450 ià(
³rms_»ad
 !ğ
num_³rms
) {

451 
	`WARN
(
p
, "Th”w”suµo£dØb%zu…”missiÚs, buˆÚly %zu w”found.", 
num_³rms
, 
³rms_»ad
);

452 
»tv®
 |ğ
APOL_PERMMAP_RET_NOT_ENOUGH
;

454 ià(
pc
 !ğ
NULL
 && !
	`¬e_®l_³rms_m­³d
(
p
,…c)) {

455 
»tv®
 |ğ
APOL_PERMMAP_RET_UNMAPPED_PERM
;

457  
»tv®
;

458 
	}
}

473 
	$·r£_³rmm­
(
­Ş_pŞicy_t
 * 
p
, 
FILE
 * 
å
)

475 
lše
[
APOL_LINE_SZ
], 
şass_Çme
[APOL_LINE_SZ], *
lše_±r
 = 
NULL
;

476 
size_t
 
num_şas£s
 = 0, 
num_³rms
 = 0;

477 
size_t
 
i
;

478 
»tv®
 = 0;

481 
	`fg‘s
(
lše
, Öše), 
å
è!ğ
NULL
) {

482 
lše_±r
 = 
lše
;;

483 
	`­Ş_¡r_Œim
(
lše_±r
);

484 ià(
lše_±r
[0] !ğ'#' && (
	`ssÿnf
Öše_±r, "%zu", &
num_şas£s
) == 1)) {

488 ià(
num_şas£s
 == 0) {

489 
	`ERR
(
p
, "%s", "No object classes were defined inhe…ermission map file.");

494 
i
 = 0; i < 
num_şas£s
; i++) {

495 
­Ş_³rmm­_şass_t
 *
pc
;

496 
found_şass_deş
 = 0, 
¹
;

497 
	`fg‘s
(
lše
, 
APOL_LINE_SZ
, 
å
è!ğ
NULL
) {

498 
lše_±r
 = 
lše
;

499 
	`­Ş_¡r_Œim
(
lše_±r
);

500 ià(
lše_±r
[0] !ğ'#' && (
	`ssÿnf
Öše_±r, "%* % %zu", 
şass_Çme
, &
num_³rms
) == 2)) {

501 
found_şass_deş
 = 1;

505 ià(!
found_şass_deş
) {

506 
	`WARN
(
p
, "P”missiÚ m­ fwa suµo£dØhav%zu cÏs£s, buˆÚly %zu w”found.", 
num_şas£s
, 
i
);

507  
APOL_PERMMAP_RET_NOT_ENOUGH
;

509 ià((
pc
 = 
	`fšd_³rmm­_şass
(
p
, 
şass_Çme
)è=ğ
NULL
) {

510 
	`WARN
(
p
,

512 
şass_Çme
);

514 
	`·r£_³rmm­_şass
(
p
, 
å
, 
num_³rms
, 
NULL
);

515 
»tv®
 |ğ
APOL_PERMMAP_RET_UNKNOWN_OBJ
;

517 ià((
¹
 = 
	`·r£_³rmm­_şass
(
p
, 
å
, 
num_³rms
, 
pc
)) < 0) {

520 
pc
->
m­³d
 = 1;

521 
»tv®
 |ğ
¹
;

524  
»tv®
;

525 
	}
}

527 
	$­Ş_pŞicy_İ’_³rmm­
(
­Ş_pŞicy_t
 * 
p
, cÚ¡ *
f’ame
)

529 
FILE
 *
outfe
 = 
NULL
;

530 
»tv®
 = -1, 
¹
 = 0;

532 ià(
p
 =ğ
NULL
 || 
f’ame
 == NULL) {

533 
ş—nup
;

535 
	`³rmm­_de¡roy
(&
p
->
pm­
);

536 ià((
p
->
pm­
 = 
	`­Ş_³rmm­_ü—‹_äom_pŞicy
Õ)è=ğ
NULL
) {

537 
ş—nup
;

540 ià((
outfe
 = 
	`fİ’
(
f’ame
, "r")è=ğ
NULL
) {

541 
	`ERR
(
p
, "Could‚Ù o³À³rmissiÚ m­ % fÜ„—dšg: %s", 
f’ame
, 
	`¡»¼Ü
(
”ºo
));

542 
ş—nup
;

545 ià((
¹
 = 
	`·r£_³rmm­
(
p
, 
outfe
)) < 0) {

546 
ş—nup
;

550 ià(
¹
 =ğ0 && !
	`¬e_®l_şas£s_m­³d
(
p
)) {

551 
¹
 = 
APOL_PERMMAP_RET_UNMAPPED_OBJ
;

553 
p
->
pm­
->
m­³d
 = 1;

555 
»tv®
 = 
¹
;

556 
ş—nup
:

557 ià(
outfe
 !ğ
NULL
) {

558 
	`fşo£
(
outfe
);

560  
»tv®
;

561 
	}
}

563 
	$­Ş_³rmm­_lßd
(
­Ş_pŞicy_t
 * 
p
, cÚ¡ *
f’ame
)

565  
	`­Ş_pŞicy_İ’_³rmm­
(
p
, 
f’ame
);

566 
	}
}

568 
	$­Ş_pŞicy_§ve_³rmm­
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ *
f’ame
)

570 
time_t
 
Éime
;

571 
size_t
 
i
, 
j
;

572 
FILE
 *
outfe
 = 
NULL
;

573 
»tv®
 = -1;

575 ià(
p
 =ğ
NULL
 ||…->
pm­
 =ğNULL || 
f’ame
 == NULL)

576 
ş—nup
;

578 ià((
outfe
 = 
	`fİ’
(
f’ame
, "w")è=ğ
NULL
) {

579 
	`ERR
(
p
, "Could‚Ù o³À³rmissiÚ m­ % fÜ wr™šg: %s", 
f’ame
, 
	`¡»¼Ü
(
”ºo
));

580 
ş—nup
;

583 ià(
	`time
(&
Éime
è=ğ(
time_t
) - 1) {

584 
	`ERR
(
p
, "Could‚Ù g‘ime: %s", 
	`¡»¼Ü
(
”ºo
));

585 
ş—nup
;

587 ià(
	`årštf
(
outfe
, "# Auto-g’”©ed by‡pŞ oÀ%s\n", 
	`ùime
(&
Éime
)) < 0 ||

588 
	`årštf
(
outfe
, "#\n#…ermission map file\n\n\n") < 0 ||

589 
	`årštf
(
outfe
, "Numb” oàşas£ (m­³d?: %s):\n", (
p
->
pm­
->
m­³d
 ? "yes" : "no")) < 0 ||

590 
	`årštf
(
outfe
, "%zu\n", 
	`­Ş_veùÜ_g‘_size
(
p
->
pm­
->
şas£s
)) < 0) {

591 
	`ERR
(
p
, "Wr™”rÜ: %s", 
	`¡»¼Ü
(
”ºo
));

592 
ş—nup
;

595 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
p
->
pm­
->
şas£s
); i++) {

596 
­Ş_³rmm­_şass_t
 *
pc
 = 
	`­Ş_veùÜ_g‘_–em’t
(
p
->
pm­
->
şas£s
, 
i
);

597 cÚ¡ *
şass_Çme
;

598 ià(
	`qpŞ_şass_g‘_Çme
(
p
->p, 
pc
->
c
, &
şass_Çme
) < 0) {

599 
ş—nup
;

601 ià(
	`årštf
(
outfe
, "\nşas % %zu\n", 
şass_Çme
, 
	`­Ş_veùÜ_g‘_size
(
pc
->
³rms
)) < 0) {

602 
	`ERR
(
p
, "Wr™”rÜ: %s", 
	`¡»¼Ü
(
”ºo
));

603 
ş—nup
;

606 
j
 = 0; j < 
	`­Ş_veùÜ_g‘_size
(
pc
->
³rms
); j++) {

607 
­Ş_³rmm­_³rm_t
 *
µ
 = 
	`­Ş_veùÜ_g‘_–em’t
(
pc
->
³rms
, 
j
);

608 *
s
;

609 ià(
	`årštf
(
outfe
, "%s%18s ", 
µ
->
m­
 & 
APOL_PERMMAP_UNMAPPED
 ? "#" : "",…p->
Çme
) < 0) {

610 
	`ERR
(
p
, "Wr™”rÜ: %s", 
	`¡»¼Ü
(
”ºo
));

611 
ş—nup
;

613 
µ
->
m­
) {

614 
APOL_PERMMAP_READ
:

615 
s
 = "r";

617 
APOL_PERMMAP_WRITE
:

618 
s
 = "w";

620 
APOL_PERMMAP_BOTH
:

621 
s
 = "b";

623 
APOL_PERMMAP_NONE
:

624 
s
 = "n";

626 
APOL_PERMMAP_UNMAPPED
:

627 
s
 = "u";

630 
s
 = "?";

632 ià(
	`årštf
(
outfe
, "%  %10d\n", 
s
, 
µ
->
weight
) < 0) {

633 
	`ERR
(
p
, "Wr™”rÜ: %s", 
	`¡»¼Ü
(
”ºo
));

634 
ş—nup
;

639 
»tv®
 = 0;

640 
ş—nup
:

641 ià(
outfe
 !ğ
NULL
) {

642 
	`fşo£
(
outfe
);

644  
»tv®
;

645 
	}
}

647 
	$­Ş_³rmm­_§ve
(
­Ş_pŞicy_t
 * 
p
, cÚ¡ *
f’ame
)

649  
	`­Ş_pŞicy_§ve_³rmm­
(
p
, 
f’ame
);

650 
	}
}

652 
	$­Ş_pŞicy_g‘_³rmm­
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ *
şass_Çme
, cÚ¡ *
³rm_Çme
, *
m­
, *
weight
)

654 
­Ş_³rmm­_şass_t
 *
pc
;

655 
­Ş_³rmm­_³rm_t
 *
µ
;

656 ià(
p
 =ğ
NULL
 ||…->
pm­
 == NULL) {

659 ià((
pc
 = 
	`fšd_³rmm­_şass
(
p
, 
şass_Çme
)è=ğ
NULL
 || (
µ
 = 
	`fšd_³rmm­_³rm
Õ,…c, 
³rm_Çme
)) == NULL) {

660 
	`ERR
(
p
, "Could‚Ù fšd…”missiÚ % š cÏs %s.", 
³rm_Çme
, 
şass_Çme
);

663 *
m­
 = 
µ
->map;

664 *
weight
 = 
µ
->weight;

666 
	}
}

668 
	$­Ş_³rmm­_g‘
(
­Ş_pŞicy_t
 * 
p
, cÚ¡ *
şass_Çme
, cÚ¡ *
³rm_Çme
, *
m­
, *
weight
)

670  
	`­Ş_pŞicy_g‘_³rmm­
(
p
, 
şass_Çme
, 
³rm_Çme
, 
m­
, 
weight
);

671 
	}
}

673 
	$­Ş_pŞicy_£t_³rmm­
(
­Ş_pŞicy_t
 * 
p
, cÚ¡ *
şass_Çme
, cÚ¡ *
³rm_Çme
, 
m­
, 
weight
)

675 
­Ş_³rmm­_şass_t
 *
pc
;

676 
­Ş_³rmm­_³rm_t
 *
µ
;

677 ià(
p
 =ğ
NULL
 ||…->
pm­
 == NULL) {

680 ià((
pc
 = 
	`fšd_³rmm­_şass
(
p
, 
şass_Çme
)è=ğ
NULL
 || (
µ
 = 
	`fšd_³rmm­_³rm
Õ,…c, 
³rm_Çme
)) == NULL) {

681 
	`ERR
(
p
, "Could‚Ù fšd…”missiÚ % š cÏs %s.", 
³rm_Çme
, 
şass_Çme
);

684 
µ
->
m­
 = map;

685 ià(
weight
 > 
APOL_PERMMAP_MAX_WEIGHT
) {

686 
weight
 = 
APOL_PERMMAP_MAX_WEIGHT
;

687 } ià(
weight
 < 
APOL_PERMMAP_MIN_WEIGHT
) {

688 
weight
 = 
APOL_PERMMAP_MIN_WEIGHT
;

690 
µ
->
weight
 = weight;

692 
	}
}

694 
	$­Ş_³rmm­_£t
(
­Ş_pŞicy_t
 * 
p
, cÚ¡ *
şass_Çme
, cÚ¡ *
³rm_Çme
, 
m­
, 
weight
)

696  
	`­Ş_pŞicy_£t_³rmm­
(
p
, 
şass_Çme
, 
³rm_Çme
, 
m­
, 
weight
);

697 
	}
}

	@libapol/src/permissive-query.c

30 
	~"pŞicy-qu”y-š‹º®.h
"

32 
	~<”ºo.h
>

34 
	s­Ş_³rmissive_qu”y


36 *
	m³rmissive_Çme
;

37 
	mæags
;

38 
»gex_t
 *
	m»gex
;

41 
	$­Ş_³rmissive_g‘_by_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_³rmissive_qu”y_t
 * 
q
, 
­Ş_veùÜ_t
 ** 
v
)

43 
qpŞ_™”©Ü_t
 *
™”
;

44 
»tv®
 = -1;

45 *
v
 = 
NULL
;

46 ià(
	`qpŞ_pŞicy_g‘_³rmissive_™”
(
p
->p, &
™”
) < 0) {

49 ià((*
v
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)) == NULL) {

50 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

51 
ş—nup
;

53 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

54 cÚ¡ 
qpŞ_³rmissive_t
 *
³rmissive
;

55 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
³rmissive
) < 0) {

56 
ş—nup
;

58 ià(
q
 !ğ
NULL
) {

59 
compv®
 = 
	`­Ş_com·»_³rmissive
(
p
,

60 
³rmissive
, 
q
->
³rmissive_Çme
,

61 
q
->
æags
, &(q->
»gex
));

62 ià(
compv®
 < 0) {

63 
ş—nup
;

64 } ià(
compv®
 == 0) {

68 ià(
	`­Ş_veùÜ_­³nd
(*
v
, (*)
³rmissive
)) {

69 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

70 
ş—nup
;

74 
»tv®
 = 0;

75 
ş—nup
:

76 ià(
»tv®
 != 0) {

77 
	`­Ş_veùÜ_de¡roy
(
v
);

79 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

80  
»tv®
;

81 
	}
}

83 
­Ş_³rmissive_qu”y_t
 *
	$­Ş_³rmissive_qu”y_ü—‹
()

85  
	`ÿÎoc
(1, (
­Ş_³rmissive_qu”y_t
));

86 
	}
}

88 
	$­Ş_³rmissive_qu”y_de¡roy
(
­Ş_³rmissive_qu”y_t
 ** 
q
)

90 ià(*
q
 !ğ
NULL
) {

91 
	`ä“
((*
q
)->
³rmissive_Çme
);

92 
	`­Ş_»gex_de¡roy
(&(*
q
)->
»gex
);

93 
	`ä“
(*
q
);

94 *
q
 = 
NULL
;

96 
	}
}

98 
	$­Ş_³rmissive_qu”y_£t_Çme
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_³rmissive_qu”y_t
 * 
q
, cÚ¡ *
Çme
)

100  
	`­Ş_qu”y_£t
(
p
, &
q
->
³rmissive_Çme
, &q->
»gex
, 
Çme
);

101 
	}
}

103 
	$­Ş_³rmissive_qu”y_£t_»gex
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_³rmissive_qu”y_t
 * 
q
, 
is_»gex
)

105  
	`­Ş_qu”y_£t_»gex
(
p
, &
q
->
æags
, 
is_»gex
);

106 
	}
}

	@libapol/src/polcap-query.c

30 
	~"pŞicy-qu”y-š‹º®.h
"

32 
	~<”ºo.h
>

34 
	s­Ş_pŞÿp_qu”y


36 *
	mpŞÿp_Çme
;

37 
	mæags
;

38 
»gex_t
 *
	m»gex
;

41 
	$­Ş_pŞÿp_g‘_by_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_pŞÿp_qu”y_t
 * 
q
, 
­Ş_veùÜ_t
 ** 
v
)

43 
qpŞ_™”©Ü_t
 *
™”
;

44 
»tv®
 = -1;

45 *
v
 = 
NULL
;

46 ià(
	`qpŞ_pŞicy_g‘_pŞÿp_™”
(
p
->p, &
™”
) < 0) {

49 ià((*
v
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)) == NULL) {

50 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

51 
ş—nup
;

53 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

54 cÚ¡ 
qpŞ_pŞÿp_t
 *
pŞÿp
;

55 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
pŞÿp
) < 0) {

56 
ş—nup
;

58 ià(
q
 !ğ
NULL
) {

59 
compv®
 = 
	`­Ş_com·»_pŞÿp
(
p
,

60 
pŞÿp
, 
q
->
pŞÿp_Çme
,

61 
q
->
æags
, &(q->
»gex
));

62 ià(
compv®
 < 0) {

63 
ş—nup
;

64 } ià(
compv®
 == 0) {

68 ià(
	`­Ş_veùÜ_­³nd
(*
v
, (*)
pŞÿp
)) {

69 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

70 
ş—nup
;

74 
»tv®
 = 0;

75 
ş—nup
:

76 ià(
»tv®
 != 0) {

77 
	`­Ş_veùÜ_de¡roy
(
v
);

79 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

80  
»tv®
;

81 
	}
}

83 
­Ş_pŞÿp_qu”y_t
 *
	$­Ş_pŞÿp_qu”y_ü—‹
()

85  
	`ÿÎoc
(1, (
­Ş_pŞÿp_qu”y_t
));

86 
	}
}

88 
	$­Ş_pŞÿp_qu”y_de¡roy
(
­Ş_pŞÿp_qu”y_t
 ** 
q
)

90 ià(*
q
 !ğ
NULL
) {

91 
	`ä“
((*
q
)->
pŞÿp_Çme
);

92 
	`­Ş_»gex_de¡roy
(&(*
q
)->
»gex
);

93 
	`ä“
(*
q
);

94 *
q
 = 
NULL
;

96 
	}
}

98 
	$­Ş_pŞÿp_qu”y_£t_Çme
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_pŞÿp_qu”y_t
 * 
q
, cÚ¡ *
Çme
)

100  
	`­Ş_qu”y_£t
(
p
, &
q
->
pŞÿp_Çme
, &q->
»gex
, 
Çme
);

101 
	}
}

103 
	$­Ş_pŞÿp_qu”y_£t_»gex
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_pŞÿp_qu”y_t
 * 
q
, 
is_»gex
)

105  
	`­Ş_qu”y_£t_»gex
(
p
, &
q
->
æags
, 
is_»gex
);

106 
	}
}

	@libapol/src/policy-path.c

26 
	~<cÚfig.h
>

28 
	~<­Ş/pŞicy-·th.h
>

29 
	~<­Ş/ut.h
>

31 
	~<”ºo.h
>

32 
	~<¡dlib.h
>

33 
	~<¡ršg.h
>

35 cÚ¡ *
	gPOLICY_PATH_MAGIC
 = "policy_list";

36 cÚ¡ 
	gPOLICY_PATH_MAX_VERSION
 = 1;

38 
	s­Ş_pŞicy_·th


40 
­Ş_pŞicy_·th_ty³_e
 
	m·th_ty³
;

41 *
	mba£
;

42 
­Ş_veùÜ_t
 *
	mmoduËs
;

45 
­Ş_pŞicy_·th_t
 *
	$­Ş_pŞicy_·th_ü—‹
(
­Ş_pŞicy_·th_ty³_e
 
·th_ty³
, cÚ¡ *
·th
, cÚ¡ 
­Ş_veùÜ_t
 * 
moduËs
)

47 
­Ş_pŞicy_·th_t
 *
p
 = 
NULL
;

49 ià(
·th
 =ğ
NULL
) {

50 
”ºo
 = 
EINVAL
;

51  
NULL
;

53 ià((
p
 = 
	`ÿÎoc
(1, (*p))è=ğ
NULL
) {

54  
NULL
;

56 
p
->
·th_ty³
 =…ath_type;

57 ià((
p
->
ba£
 = 
	`¡rdup
(
·th
)è=ğ
NULL
) {

58 
	`­Ş_pŞicy_·th_de¡roy
(&
p
);

59  
NULL
;

61 ià(
p
->
·th_ty³
 =ğ
APOL_POLICY_PATH_TYPE_MODULAR
) {

62 ià(
moduËs
 =ğ
NULL
) {

63 
p
->
moduËs
 = 
	`­Ş_veùÜ_ü—‹
(
ä“
);

65 
p
->
moduËs
 = 
	`­Ş_veùÜ_ü—‹_äom_veùÜ
(moduËs, 
­Ş_¡r_¡rdup
, 
NULL
, 
ä“
);

67 ià(
p
->
moduËs
 =ğ
NULL
) {

68 
	`­Ş_pŞicy_·th_de¡roy
(&
p
);

69  
NULL
;

71 
	`­Ş_veùÜ_sÜt_uniquify
(
p
->
moduËs
, 
­Ş_¡r_¡rcmp
, 
NULL
);

73  
p
;

74 
	}
}

76 
­Ş_pŞicy_·th_t
 *
	$­Ş_pŞicy_·th_ü—‹_äom_pŞicy_·th
(cÚ¡ 
­Ş_pŞicy_·th_t
 * 
·th
)

78 
­Ş_pŞicy_·th_t
 *
p
;

79 ià(
·th
 =ğ
NULL
) {

80 
”ºo
 = 
EINVAL
;

81  
NULL
;

83 
p
 = 
	`­Ş_pŞicy_·th_ü—‹
(
·th
->
·th_ty³
,…©h->
ba£
,…©h->
moduËs
);

84  
p
;

85 
	}
}

87 
­Ş_pŞicy_·th_t
 *
	$­Ş_pŞicy_·th_ü—‹_äom_fe
(cÚ¡ *
f’ame
)

89 
FILE
 *
f
 = 
NULL
;

90 
­Ş_pŞicy_·th_t
 *
·th
 = 
NULL
;

91 
­Ş_pŞicy_·th_ty³_e
 
·th_ty³
;

92 *
lše
 = 
NULL
, *
s
;

93 
­Ş_veùÜ_t
 *
h—d”_tok’s
 = 
NULL
;

94 
size_t
 
Ën
;

95 
»ad_ba£
 = 0, 
»tv®
 = -1, 
”rÜ
 = 0;

97 ià(
f’ame
 =ğ
NULL
) {

98 
”rÜ
 = 
EINVAL
;

99 
ş—nup
;

101 ià((
f
 = 
	`fİ’
(
f’ame
, "r")è=ğ
NULL
) {

102 
”rÜ
 = 
”ºo
;

103 
ş—nup
;

106 ià(
	`g‘lše
(&
lše
, &
Ën
, 
f
) < 0) {

107 
”rÜ
 = 
EIO
;

108 
ş—nup
;

110 
	`­Ş_¡r_Œim
(
lše
);

111 ià(
	`¡ºcmp
(
lše
, 
POLICY_PATH_MAGIC
, 
	`¡¾’
(POLICY_PATH_MAGIC)) != 0) {

112 
”rÜ
 = 
EIO
;

113 
ş—nup
;

116 
	`­Ş_¡r_Œim
(
lše
);

117 ià((
h—d”_tok’s
 = 
	`­Ş_¡r_¥l™
(
lše
, " ")è=ğ
NULL
) {

118 
”rÜ
 = 
”ºo
;

119 
ş—nup
;

121 ià(
	`­Ş_veùÜ_g‘_size
(
h—d”_tok’s
) < 3) {

122 
”rÜ
 = 
EIO
;

123 
ş—nup
;

125 
s
 = 
	`­Ş_veùÜ_g‘_–em’t
(
h—d”_tok’s
, 1);

126 ià(
	`©oi
(
s
è=ğ0 ||‡toi(sè> 
POLICY_PATH_MAX_VERSION
) {

127 
”rÜ
 = 
ENOTSUP
;

128 
ş—nup
;

130 
s
 = 
	`­Ş_veùÜ_g‘_–em’t
(
h—d”_tok’s
, 2);

131 ià(
	`¡rcmp
(
s
, "monolithic") == 0) {

132 
·th_ty³
 = 
APOL_POLICY_PATH_TYPE_MONOLITHIC
;

133 } ià(
	`¡rcmp
(
s
, "modular") == 0) {

134 
·th_ty³
 = 
APOL_POLICY_PATH_TYPE_MODULAR
;

136 
”rÜ
 = 
EIO
;

137 
ş—nup
;

140 
	`g‘lše
(&
lše
, &
Ën
, 
f
) >= 0) {

141 
	`­Ş_¡r_Œim
(
lše
);

142 ià(
lše
[0] == '#') {

145 ià(!
»ad_ba£
) {

147 ià((
·th
 = 
	`­Ş_pŞicy_·th_ü—‹
(
·th_ty³
, 
lše
, 
NULL
)) == NULL) {

148 
”rÜ
 = 
”ºo
;

149 
ş—nup
;

151 
»ad_ba£
 = 1;

154 ià(
·th_ty³
 =ğ
APOL_POLICY_PATH_TYPE_MONOLITHIC
) {

155 
”rÜ
 = 
EIO
;

156 
ş—nup
;

158 ià((
s
 = 
	`¡rdup
(
lše
)è=ğ
NULL
 || 
	`­Ş_veùÜ_­³nd
(
·th
->
moduËs
, s) < 0) {

159 
”rÜ
 = 
”ºo
;

160 
	`ä“
(
s
);

161 
ş—nup
;

166 ià(
»ad_ba£
 == 0) {

167 
”rÜ
 = 
EIO
;

168 
ş—nup
;

170 
»tv®
 = 0;

171 
ş—nup
:

172 ià(
f
 !ğ
NULL
) {

173 
	`fşo£
(
f
);

175 
	`ä“
(
lše
);

176 
	`­Ş_veùÜ_de¡roy
(&
h—d”_tok’s
);

177 ià(
»tv®
 != 0) {

178 
	`­Ş_pŞicy_·th_de¡roy
(&
·th
);

179 
”ºo
 = 
”rÜ
;

181  
·th
;

182 
	}
}

184 
­Ş_pŞicy_·th_t
 *
	$­Ş_pŞicy_·th_ü—‹_äom_¡ršg
(cÚ¡ *
·th_¡ršg
)

186 
­Ş_pŞicy_·th_t
 *
p
 = 
NULL
;

187 
­Ş_veùÜ_t
 *
tok’s
 = 
NULL
;

188 
­Ş_pŞicy_·th_ty³_e
 
·th_ty³
;

189 *
s
;

190 
size_t
 
i
;

191 ià(
·th_¡ršg
 =ğ
NULL
) {

192 
”ºo
 = 
EINVAL
;

193  
NULL
;

195 ià((
tok’s
 = 
	`­Ş_¡r_¥l™
(
·th_¡ršg
, ":")è=ğ
NULL
) {

196  
NULL
;

200 ià(
	`­Ş_veùÜ_g‘_size
(
tok’s
) < 2) {

201 
	`­Ş_veùÜ_de¡roy
(&
tok’s
);

202  
NULL
;

204 
s
 = 
	`­Ş_veùÜ_g‘_–em’t
(
tok’s
, 0);

205 ià(
	`¡rcmp
(
s
, "monolithic") == 0) {

206 
·th_ty³
 = 
APOL_POLICY_PATH_TYPE_MONOLITHIC
;

207 } ià(
	`¡rcmp
(
s
, "modular") == 0) {

208 
·th_ty³
 = 
APOL_POLICY_PATH_TYPE_MODULAR
;

210 
	`­Ş_veùÜ_de¡roy
(&
tok’s
);

211 
”ºo
 = 
EINVAL
;

212  
NULL
;

216 
s
 = 
	`­Ş_veùÜ_g‘_–em’t
(
tok’s
, 1);

217 ià((
p
 = 
	`­Ş_pŞicy_·th_ü—‹
(
·th_ty³
, 
s
, 
NULL
)) == NULL) {

218 
	`­Ş_veùÜ_de¡roy
(&
tok’s
);

219  
NULL
;

222 ià(
·th_ty³
 =ğ
APOL_POLICY_PATH_TYPE_MODULAR
) {

224 
i
 = 2; i < 
	`­Ş_veùÜ_g‘_size
(
tok’s
); i++) {

225 
s
 = 
	`­Ş_veùÜ_g‘_–em’t
(
tok’s
, 
i
);

226 ià((
s
 = 
	`¡rdup
(s)è=ğ
NULL
 || 
	`­Ş_veùÜ_­³nd
(
p
->
moduËs
, s) < 0) {

227 
	`ä“
(
s
);

228 
	`­Ş_veùÜ_de¡roy
(&
tok’s
);

229 
	`­Ş_pŞicy_·th_de¡roy
(&
p
);

230  
NULL
;

233 
	`­Ş_veùÜ_sÜt_uniquify
(
p
->
moduËs
, 
­Ş_¡r_¡rcmp
, 
NULL
);

235  
p
;

236 
	}
}

238 
	$­Ş_pŞicy_·th_de¡roy
(
­Ş_pŞicy_·th_t
 ** 
·th
)

240 ià(
·th
 !ğ
NULL
 && *path != NULL) {

241 
	`ä“
((*
·th
)->
ba£
);

242 
	`­Ş_veùÜ_de¡roy
(&(*
·th
)->
moduËs
);

243 
	`ä“
(*
·th
);

244 *
·th
 = 
NULL
;

246 
	}
}

248 
	$­Ş_pŞicy_·th_com·»
(cÚ¡ 
­Ş_pŞicy_·th_t
 * 
a
, cÚ¡‡pŞ_pŞicy_·th_ˆ* 
b
)

250 
cmp
;

251 ià(
a
 =ğ
NULL
 || 
b
 == NULL) {

252 
”ºo
 = 
EINVAL
;

255 ià((
cmp
 = 
a
->
·th_ty³
 - 
b
->path_type) != 0) {

256  
cmp
;

258 ià((
cmp
 = 
	`¡rcmp
(
a
->
ba£
, 
b
->base)) != 0) {

259  
cmp
;

261 ià(
a
->
·th_ty³
 =ğ
APOL_POLICY_PATH_TYPE_MODULAR
) {

263 
size_t
 
i
;

264 
cmp
 = 
	`­Ş_veùÜ_com·»
(
a
->
moduËs
, 
b
->moduËs, 
­Ş_¡r_¡rcmp
, 
NULL
, &
i
);

265 ià(
cmp
 != 0) {

266  
cmp
;

270 
	}
}

272 
­Ş_pŞicy_·th_ty³_e
 
	$­Ş_pŞicy_·th_g‘_ty³
(cÚ¡ 
­Ş_pŞicy_·th_t
 * 
·th
)

274 ià(
·th
 =ğ
NULL
) {

275 
”ºo
 = 
EINVAL
;

276  
APOL_POLICY_PATH_TYPE_MONOLITHIC
;

278  
·th
->
·th_ty³
;

279 
	}
}

281 cÚ¡ *
	$­Ş_pŞicy_·th_g‘_´im¬y
(cÚ¡ 
­Ş_pŞicy_·th_t
 * 
·th
)

283 ià(
·th
 =ğ
NULL
) {

284 
”ºo
 = 
EINVAL
;

285  
NULL
;

287  
·th
->
ba£
;

288 
	}
}

290 cÚ¡ 
­Ş_veùÜ_t
 *
	$­Ş_pŞicy_·th_g‘_moduËs
(cÚ¡ 
­Ş_pŞicy_·th_t
 * 
·th
)

292 ià(
·th
 =ğ
NULL
 ||…©h->
·th_ty³
 !ğ
APOL_POLICY_PATH_TYPE_MODULAR
) {

293 
”ºo
 = 
EINVAL
;

294  
NULL
;

296  
·th
->
moduËs
;

297 
	}
}

299 
	$­Ş_pŞicy_·th_to_fe
(cÚ¡ 
­Ş_pŞicy_·th_t
 * 
·th
, cÚ¡ *
f’ame
)

301 
FILE
 *
f
 = 
NULL
;

302 *
·th_ty³
;

303 
size_t
 
i
;

304 
»tv®
 = -1, 
”rÜ
 = 0;

305 ià(
·th
 =ğ
NULL
 || 
f’ame
 == NULL) {

306 
”ºo
 = 
EINVAL
;

307 
ş—nup
;

309 ià((
f
 = 
	`fİ’
(
f’ame
, "w")è=ğ
NULL
) {

310 
”rÜ
 = 
”ºo
;

311 
ş—nup
;

313 ià(
·th
->
·th_ty³
 =ğ
APOL_POLICY_PATH_TYPE_MODULAR
) {

314 
·th_ty³
 = "modular";

316 
·th_ty³
 = "monolithic";

318 ià(
	`årštf
(
f
, "% %d %s\n", 
POLICY_PATH_MAGIC
, 
POLICY_PATH_MAX_VERSION
, 
·th_ty³
) < 0) {

319 
”rÜ
 = 
”ºo
;

320 
ş—nup
;

322 ià(
	`årštf
(
f
, "%s\n", 
·th
->
ba£
) < 0) {

323 
”rÜ
 = 
”ºo
;

324 
ş—nup
;

326 ià(
·th
->
·th_ty³
 =ğ
APOL_POLICY_PATH_TYPE_MODULAR
) {

327 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
·th
->
moduËs
); i++) {

328 *
m
 = 
	`­Ş_veùÜ_g‘_–em’t
(
·th
->
moduËs
, 
i
);

329 ià(
	`årštf
(
f
, "%s\n", 
m
) < 0) {

330 
”rÜ
 = 
”ºo
;

331 
ş—nup
;

336 
»tv®
 = 0;

337 
ş—nup
:

338 ià(
f
 !ğ
NULL
) {

339 
	`fşo£
(
f
);

341 ià(
»tv®
 != 0) {

342 
”rÜ
 = 
”ºo
;

344  
»tv®
;

345 
	}
}

347 *
	$­Ş_pŞicy_·th_to_¡ršg
(cÚ¡ 
­Ş_pŞicy_·th_t
 * 
·th
)

349 *
·th_ty³
;

350 *
s
 = 
NULL
;

351 
size_t
 
Ën
 = 0, 
i
;

352 ià(
·th
 =ğ
NULL
) {

353 
”ºo
 = 
EINVAL
;

354  
NULL
;

356 ià(
·th
->
·th_ty³
 =ğ
APOL_POLICY_PATH_TYPE_MODULAR
) {

357 
·th_ty³
 = "modular";

359 
·th_ty³
 = "monolithic";

361 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "%s:%s", 
·th_ty³
, 
·th
->
ba£
) < 0) {

362  
NULL
;

364 ià(
·th
->
·th_ty³
 =ğ
APOL_POLICY_PATH_TYPE_MODULAR
) {

365 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
·th
->
moduËs
); i++) {

366 *
m
 = 
	`­Ş_veùÜ_g‘_–em’t
(
·th
->
moduËs
, 
i
);

367 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, ":%s", 
m
) < 0) {

368  
NULL
;

372  
s
;

373 
	}
}

375 
	$­Ş_fe_is_pŞicy_·th_li¡
(cÚ¡ *
f’ame
)

377 
FILE
 *
f
 = 
NULL
;

378 *
lše
 = 
NULL
;

379 
size_t
 
Ën
 = 0;

380 
»tv®
 = -1, 
”rÜ
 = 0;

382 ià(
f’ame
 =ğ
NULL
) {

383 
”rÜ
 = 
EINVAL
;

384 
ş—nup
;

386 ià((
f
 = 
	`fİ’
(
f’ame
, "r")è=ğ
NULL
) {

387 
”rÜ
 = 
”ºo
;

388 
ş—nup
;

391 ià(
	`g‘lše
(&
lše
, &
Ën
, 
f
) < 0) {

392 
”rÜ
 = 
EIO
;

393 
ş—nup
;

395 
	`­Ş_¡r_Œim
(
lše
);

396 ià(
	`¡ºcmp
(
lše
, 
POLICY_PATH_MAGIC
, 
	`¡¾’
(POLICY_PATH_MAGIC)) != 0) {

397 
»tv®
 = 0;

398 
ş—nup
;

400 
»tv®
 = 1;

402 
ş—nup
:

403 ià(
f
)

404 
	`fşo£
(
f
);

405 
	`ä“
(
lše
);

406 ià(
»tv®
 < 0)

407 
”ºo
 = 
”rÜ
;

408  
»tv®
;

409 
	}
}

	@libapol/src/policy-query-internal.h

28 #iâdeà
APOL_POLICY_QUERY_INTERNAL_H


29 
	#APOL_POLICY_QUERY_INTERNAL_H


	)

31 #ifdef 
__ılu¥lus


36 
	~<cÚfig.h
>

38 
	~<­Ş/pŞicy.h
>

39 
	~<­Ş/pŞicy-qu”y.h
>

40 
	~<­Ş/ut.h
>

41 
	~<­Ş/veùÜ.h
>

43 
	~<»gex.h
>

44 
	~<¡dlib.h
>

45 
	~<qpŞ/pŞicy.h
>

48 
­Ş_³rmm­
;

51 
­Ş_domaš_Œªs_bË
 
	t­Ş_domaš_Œªs_bË_t
;

54 
­Ş_³rmm­
 
	t­Ş_³rmm­_t
;

56 
	s­Ş_pŞicy


58 
qpŞ_pŞicy_t
 *
p
;

59 
­Ş_ÿÎback_â_t
 
msg_ÿÎback
;

60 *
msg_ÿÎback_¬g
;

61 
pŞicy_ty³
;

63 
­Ş_³rmm­
 *
pm­
;

65 
­Ş_domaš_Œªs_bË
 *
domaš_Œªs_bË
;

71 
	#APOL_QUERY_REGEX
 0x01

	)

73 
	#APOL_QUERY_ONLY_ENABLED
 0x10

	)

74 
	#APOL_QUERY_SOURCE_AS_ANY
 0x20

	)

75 
	#APOL_QUERY_SOURCE_INDIRECT
 0x40

	)

76 
	#APOL_QUERY_TARGET_INDIRECT
 0x80

	)

78 
	#APOL_QUERY_SYMBOL_IS_BOTH
 (
APOL_QUERY_SYMBOL_IS_TYPE
|
APOL_QUERY_SYMBOL_IS_ATTRIBUTE
)

	)

79 
	#APOL_QUERY_SOURCE_TYPE
 0x100

	)

80 
	#APOL_QUERY_SOURCE_ATTRIBUTE
 0x200

	)

81 
	#APOL_QUERY_TARGET_TYPE
 0x400

	)

82 
	#APOL_QUERY_TARGET_ATTRIBUTE
 0x800

	)

84 
	#APOL_QUERY_MATCH_ALL_PERMS
 0x1000

	)

91 
­Ş_»gex_de¡roy
(
»gex_t
 ** 
»gex
);

105 
­Ş_qu”y_£t
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, **
qu”y_Çme
, 
»gex_t
 ** 
»gex
, cÚ¡ *
Çme
);

117 
­Ş_qu”y_£t_æag
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, *
æags
, cÚ¡ 
is_æag
, 
æag_v®ue
);

128 
­Ş_qu”y_£t_»gex
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, *
æags
, cÚ¡ 
is_»gex
);

150 
­Ş_com·»
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ *
rg‘
, cÚ¡ *
Çme
, 
æags
, 
»gex_t
 ** 
»gex
);

170 
­Ş_com·»_™”
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
qpŞ_™”©Ü_t
 * 
™”
, cÚ¡ *
Çme
,

171 
æags
, 
»gex_t
 ** 
»gex
, 
do_ä“
);

189 
­Ş_com·»_ty³
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
qpŞ_ty³_t
 * 
ty³
, cÚ¡ *
Çme
, 
æags
,

190 
»gex_t
 ** 
ty³_»gex
);

208 
­Ş_com·»_³rmissive
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
qpŞ_³rmissive_t
 * 
³rmissive
, cÚ¡ *
Çme
, 
æags
,

209 
»gex_t
 ** 
ty³_»gex
);

227 
­Ş_com·»_pŞÿp
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
qpŞ_pŞÿp_t
 * 
pŞÿp
, cÚ¡ *
Çme
, 
æags
,

228 
»gex_t
 ** 
ty³_»gex
);

246 
­Ş_com·»_ty³bounds
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
qpŞ_ty³bounds_t
 * 
ty³bounds
, cÚ¡ *
Çme
, 
æags
,

247 
»gex_t
 ** 
ty³_»gex
);

264 
­Ş_com·»_cÚd_ex´
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
qpŞ_cÚd_t
 * 
cÚd
, cÚ¡ *
Çme
, 
æags
,

265 
»gex_t
 ** 
boŞ_»gex
);

283 
­Ş_com·»_Ëv–
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
qpŞ_Ëv–_t
 * 
Ëv–
, cÚ¡ *
Çme
, 
æags
,

284 
»gex_t
 ** 
Ëv–_»gex
);

302 
­Ş_com·»_ÿt
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
qpŞ_ÿt_t
 * 
ÿt
, cÚ¡ *
Çme
, 
æags
,

303 
»gex_t
 ** 
ÿt_»gex
);

317 
­Ş_com·»_cÚ‹xt
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
qpŞ_cÚ‹xt_t
 * 
rg‘
, cÚ¡ 
­Ş_cÚ‹xt_t
 * 
£¬ch
,

318 
æags
);

331 
­Ş_qu”y_g‘_ty³
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ *
ty³_Çme
, cÚ¡ 
qpŞ_ty³_t
 ** 
ty³
);

356 
­Ş_veùÜ_t
 *
­Ş_qu”y_ü—‹_ÿndid©e_ty³_li¡
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ *
symbŞ
, 
do_»gex
,

357 
do_šdœeù
, 
_æag
);

383 
­Ş_veùÜ_t
 *
­Ş_qu”y_ü—‹_ÿndid©e_syn_ty³_li¡
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ *
symbŞ
, 
do_»gex
,

384 
do_šdœeù
, 
_æag
);

400 
­Ş_veùÜ_t
 *
­Ş_qu”y_ü—‹_ÿndid©e_rŞe_li¡
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, *
symbŞ
, 
do_»gex
);

415 
­Ş_veùÜ_t
 *
­Ş_qu”y_ü—‹_ÿndid©e_şass_li¡
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
,‡pŞ_veùÜ_ˆ* 
şas£s
);

430 
­Ş_veùÜ_t
 *
­Ş_qu”y_ex·nd_ty³
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
qpŞ_ty³_t
 * 
t
);

438 
­Ş_obj_³rm
 
	t­Ş_obj_³rm_t
;

446 
­Ş_obj_³rm_t
 *
­Ş_obj_³rm_ü—‹
();

452 
­Ş_obj_³rm_ä“
(*
İ
);

463 
­Ş_obj_³rm_£t_obj_Çme
(
­Ş_obj_³rm_t
 * 
İ
, cÚ¡ *
obj_Çme
);

471 *
­Ş_obj_³rm_g‘_obj_Çme
(cÚ¡ 
­Ş_obj_³rm_t
 * 
İ
);

482 
­Ş_obj_³rm_­³nd_³rm
(
­Ş_obj_³rm_t
 * 
İ
, cÚ¡ *
³rm
);

490 
­Ş_veùÜ_t
 *
­Ş_obj_³rm_g‘_³rm_veùÜ
(cÚ¡ 
­Ş_obj_³rm_t
 * 
İ
);

500 
­Ş_obj_³rm_com·»_şass
(cÚ¡ *
a
, cÚ¡ *
b
, *
pŞicy
);

510 
­Ş_qu”y_ty³_£t_u£s_ty³s_dœeùly
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
qpŞ_ty³_£t_t
 * 
£t
, cÚ¡ 
­Ş_veùÜ_t
 * 
v
);

518 
³rmm­_de¡roy
(
­Ş_³rmm­_t
 ** 
p
);

524 
domaš_Œªs_bË_de¡roy
(
­Ş_domaš_Œªs_bË_t
 ** 
bË
);

526 #ifdef 
__ılu¥lus


	@libapol/src/policy-query.c

30 
	~"pŞicy-qu”y-š‹º®.h
"

32 
	~<”ºo.h
>

33 
	~<»gex.h
>

34 
	~<¡dlib.h
>

35 
	~<¡ršg.h
>

39 
	$­Ş_»gex_de¡roy
(
»gex_t
 ** 
»gex
)

41 ià(*
»gex
 !ğ
NULL
) {

42 
	`»gä“
(*
»gex
);

43 
	`ä“
(*
»gex
);

44 *
»gex
 = 
NULL
;

46 
	}
}

48 
	$­Ş_qu”y_£t
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, **
qu”y_Çme
, 
»gex_t
 ** 
»gex
, cÚ¡ *
Çme
)

50 ià(*
qu”y_Çme
 !ğ
Çme
) {

51 ià(
»gex
 !ğ
NULL
) {

52 
	`­Ş_»gex_de¡roy
(
»gex
);

54 
	`ä“
(*
qu”y_Çme
);

55 *
qu”y_Çme
 = 
NULL
;

56 ià(
Çme
 !ğ
NULL
 &&‚ame[0] !ğ'\0' && ((*
qu”y_Çme
èğ
	`¡rdup
(name)) == NULL) {

57 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

62 
	}
}

64 
­Ş_qu”y_£t_æag
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
 
__©Œibu‹__
 ((
unu£d
)), *
æags
, cÚ¡ 
is_æag
, 
æag_v®ue
)

66 ià(
	gis_æag
) {

67 *
	gæags
 |ğ
æag_v®ue
;

69 *
	gæags
 &ğ~
æag_v®ue
;

74 
	$­Ş_qu”y_£t_»gex
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, *
æags
, cÚ¡ 
is_»gex
)

76  
	`­Ş_qu”y_£t_æag
(
p
, 
æags
, 
is_»gex
, 
APOL_QUERY_REGEX
);

77 
	}
}

81 
	$­Ş_com·»
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ *
rg‘
, cÚ¡ *
Çme
, 
æags
, 
»gex_t
 ** 
»gex
)

83 ià(
Çme
 =ğ
NULL
 || *name == '\0') {

86 
”rbuf
[1024] = { '\0' };

87 ià((
æags
 & 
APOL_QUERY_REGEX
è&& 
»gex
 !ğ
NULL
) {

88 ià(*
»gex
 =ğ
NULL
) {

89 ià((*
»gex
 = 
	`m®loc
((**»gex))è=ğ
NULL
) {

90 
	`ä“
(*
»gex
);

91 *
»gex
 = 
NULL
;

92 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

95 
»g»tv
 = 
	`»gcomp
(*
»gex
, 
Çme
, 
REG_EXTENDED
 | 
REG_NOSUB
);

96 ià(
»g»tv
) {

97 
	`»g”rÜ
(
»g»tv
, *
»gex
, 
”rbuf
, 1024);

98 
	`ä“
(*
»gex
);

99 *
»gex
 = 
NULL
;

100 
	`ERR
(
p
, "%s", 
”rbuf
);

104 ià(
	`»gexec
(*
»gex
, 
rg‘
, 0, 
NULL
, 0) == 0) {

109 ià(
	`¡rcmp
(
rg‘
, 
Çme
) == 0) {

114 
	}
}

116 
	$­Ş_com·»_™”
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
qpŞ_™”©Ü_t
 * 
™”
,

117 cÚ¡ *
Çme
, 
æags
, 
»gex_t
 ** 
»gex
, 
do_ä“
)

119 
compv®
;

120 ià(
Çme
 =ğ
NULL
 || *name == '\0') {

123 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

124 *
™”_Çme
;

125 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
™”_Çme
) < 0) {

128 
compv®
 = 
	`­Ş_com·»
(
p
, 
™”_Çme
, 
Çme
, 
æags
, 
»gex
);

129 ià(
do_ä“
)

130 
	`ä“
(
™”_Çme
);

131 ià(
compv®
 != 0) {

133  
compv®
;

138 
	}
}

140 
	$­Ş_com·»_ty³
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
qpŞ_ty³_t
 * 
ty³
, cÚ¡ *
Çme
, 
æags
,

141 
»gex_t
 ** 
ty³_»gex
)

143 cÚ¡ *
ty³_Çme
;

144 
compv®
;

145 
qpŞ_™”©Ü_t
 *
®Ÿs_™”
 = 
NULL
;

146 ià(
	`qpŞ_ty³_g‘_Çme
(
p
->p, 
ty³
, &
ty³_Çme
) < 0) {

149 
compv®
 = 
	`­Ş_com·»
(
p
, 
ty³_Çme
, 
Çme
, 
æags
, 
ty³_»gex
);

150 ià(
compv®
 != 0) {

151  
compv®
;

155 ià(
	`qpŞ_ty³_g‘_®Ÿs_™”
(
p
->p, 
ty³
, &
®Ÿs_™”
) < 0) {

158 
compv®
 = 
	`­Ş_com·»_™”
(
p
, 
®Ÿs_™”
, 
Çme
, 
æags
, 
ty³_»gex
, 0);

159 
	`qpŞ_™”©Ü_de¡roy
(&
®Ÿs_™”
);

160  
compv®
;

161 
	}
}

163 
	$­Ş_com·»_³rmissive
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
qpŞ_³rmissive_t
 * 
³rmissive
, cÚ¡ *
Çme
, 
æags
,

164 
»gex_t
 ** 
³rmissive_»gex
)

166 cÚ¡ *
³rmissive_Çme
;

167 
compv®
;

169 ià(
	`qpŞ_³rmissive_g‘_Çme
(
p
->p, 
³rmissive
, &
³rmissive_Çme
) < 0) {

172 
compv®
 = 
	`­Ş_com·»
(
p
, 
³rmissive_Çme
, 
Çme
, 
æags
, 
³rmissive_»gex
);

174  
compv®
;

175 
	}
}

177 
	$­Ş_com·»_pŞÿp
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
qpŞ_pŞÿp_t
 * 
pŞÿp
, cÚ¡ *
Çme
, 
æags
,

178 
»gex_t
 ** 
pŞÿp_»gex
)

180 cÚ¡ *
pŞÿp_Çme
;

181 
compv®
;

183 ià(
	`qpŞ_pŞÿp_g‘_Çme
(
p
->p, 
pŞÿp
, &
pŞÿp_Çme
) < 0) {

186 
compv®
 = 
	`­Ş_com·»
(
p
, 
pŞÿp_Çme
, 
Çme
, 
æags
, 
pŞÿp_»gex
);

188  
compv®
;

189 
	}
}

191 
	$­Ş_com·»_ty³bounds
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
qpŞ_ty³bounds_t
 * 
ty³bounds
, cÚ¡ *
Çme
, 
æags
,

192 
»gex_t
 ** 
ty³bounds_»gex
)

194 cÚ¡ *
ty³bounds_·»Á_Çme
 = 
NULL
;

195 cÚ¡ *
ty³bounds_chd_Çme
 = 
NULL
;

197 
compv®
 = 0;

199 
	`qpŞ_ty³bounds_g‘_·»Á_Çme
(
p
->p, 
ty³bounds
, &
ty³bounds_·»Á_Çme
);

200 
	`qpŞ_ty³bounds_g‘_chd_Çme
(
p
->p, 
ty³bounds
, &
ty³bounds_chd_Çme
);

202 ià(
ty³bounds_·»Á_Çme
 !ğ
NULL
) {

203 
compv®
 = 
	`­Ş_com·»
(
p
, 
ty³bounds_·»Á_Çme
, 
Çme
, 
æags
, 
ty³bounds_»gex
);

205 ià(
ty³bounds_chd_Çme
 !ğ
NULL
 && 
compv®
 == 0) {

206 
compv®
 = 
	`­Ş_com·»
(
p
, 
ty³bounds_chd_Çme
, 
Çme
, 
æags
, 
ty³bounds_»gex
);

207  
compv®
;

209  
compv®
;

212 
	}
}

214 
	$­Ş_com·»_cÚd_ex´
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
qpŞ_cÚd_t
 * 
cÚd
, cÚ¡ *
Çme
, 
æags
,

215 
»gex_t
 ** 
boŞ_»gex
)

217 
qpŞ_™”©Ü_t
 *
ex´_™”
 = 
NULL
;

218 
compv®
 = -1;

219 ià(
	`qpŞ_cÚd_g‘_ex´_node_™”
(
p
->p, 
cÚd
, &
ex´_™”
) < 0) {

220 
ş—nup
;

222 ; !
	`qpŞ_™”©Ü_’d
(
ex´_™”
); 
	`qpŞ_™”©Ü_Ãxt
(expr_iter)) {

223 
qpŞ_cÚd_ex´_node_t
 *
ex´
;

224 
ušt32_t
 
ex´_ty³
;

225 
qpŞ_boŞ_t
 *
qboŞ
;

226 cÚ¡ *
boŞ_Çme
;

227 ià(
	`qpŞ_™”©Ü_g‘_™em
(
ex´_™”
, (**)&
ex´
) < 0 ||

228 
	`qpŞ_cÚd_ex´_node_g‘_ex´_ty³
(
p
->p, 
ex´
, &
ex´_ty³
) < 0) {

229 
ş—nup
;

231 ià(
ex´_ty³
 !ğ
QPOL_COND_EXPR_BOOL
) {

234 ià(
	`qpŞ_cÚd_ex´_node_g‘_boŞ
(
p
->p, 
ex´
, &
qboŞ
è< 0 || 
	`qpŞ_boŞ_g‘_Çme
Õ->p, qboŞ, &
boŞ_Çme
) < 0) {

235 
ş—nup
;

237 
compv®
 = 
	`­Ş_com·»
(
p
, 
boŞ_Çme
, 
Çme
, 
æags
, 
boŞ_»gex
);

238 ià(
compv®
 != 0) {

239 
ş—nup
;

242 
compv®
 = 0;

243 
ş—nup
:

244 
	`qpŞ_™”©Ü_de¡roy
(&
ex´_™”
);

245  
compv®
;

246 
	}
}

248 
	$­Ş_com·»_Ëv–
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
qpŞ_Ëv–_t
 * 
Ëv–
, cÚ¡ *
Çme
, 
æags
,

249 
»gex_t
 ** 
Ëv–_»gex
)

251 cÚ¡ *
Ëv–_Çme
;

252 
compv®
;

253 
qpŞ_™”©Ü_t
 *
®Ÿs_™”
 = 
NULL
;

254 ià(
	`qpŞ_Ëv–_g‘_Çme
(
p
->p, 
Ëv–
, &
Ëv–_Çme
) < 0) {

257 
compv®
 = 
	`­Ş_com·»
(
p
, 
Ëv–_Çme
, 
Çme
, 
æags
, 
Ëv–_»gex
);

258 ià(
compv®
 != 0) {

259  
compv®
;

263 ià(
	`qpŞ_Ëv–_g‘_®Ÿs_™”
(
p
->p, 
Ëv–
, &
®Ÿs_™”
) < 0) {

266 
compv®
 = 
	`­Ş_com·»_™”
(
p
, 
®Ÿs_™”
, 
Çme
, 
æags
, 
Ëv–_»gex
, 0);

267 
	`qpŞ_™”©Ü_de¡roy
(&
®Ÿs_™”
);

268  
compv®
;

269 
	}
}

271 
	$­Ş_com·»_ÿt
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
qpŞ_ÿt_t
 * 
ÿt
, cÚ¡ *
Çme
, 
æags
, 
»gex_t
 ** 
ÿt_»gex
)

273 cÚ¡ *
ÿt_Çme
;

274 
compv®
;

275 
qpŞ_™”©Ü_t
 *
®Ÿs_™”
 = 
NULL
;

276 ià(
	`qpŞ_ÿt_g‘_Çme
(
p
->p, 
ÿt
, &
ÿt_Çme
) < 0) {

279 
compv®
 = 
	`­Ş_com·»
(
p
, 
ÿt_Çme
, 
Çme
, 
æags
, 
ÿt_»gex
);

280 ià(
compv®
 != 0) {

281  
compv®
;

285 ià(
	`qpŞ_ÿt_g‘_®Ÿs_™”
(
p
->p, 
ÿt
, &
®Ÿs_™”
) < 0) {

288 
compv®
 = 
	`­Ş_com·»_™”
(
p
, 
®Ÿs_™”
, 
Çme
, 
æags
, 
ÿt_»gex
, 0);

289 
	`qpŞ_™”©Ü_de¡roy
(&
®Ÿs_™”
);

290  
compv®
;

291 
	}
}

293 
	$­Ş_com·»_cÚ‹xt
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
qpŞ_cÚ‹xt_t
 * 
rg‘
, cÚ¡ 
­Ş_cÚ‹xt_t
 * 
£¬ch
, 
æags
)

295 
­Ş_cÚ‹xt_t
 *
­Ş_cÚ‹xt
;

296 
»tv®
;

297 ià(
£¬ch
 =ğ
NULL
) {

300 
­Ş_cÚ‹xt
 = 
	`­Ş_cÚ‹xt_ü—‹_äom_qpŞ_cÚ‹xt
(
p
, 
rg‘
);

301 
»tv®
 = 
	`­Ş_cÚ‹xt_com·»
(
p
, 
­Ş_cÚ‹xt
, 
£¬ch
, 
æags
);

302 
	`­Ş_cÚ‹xt_de¡roy
(&
­Ş_cÚ‹xt
);

303  
»tv®
;

304 
	}
}

308 
	$­Ş_qu”y_g‘_ty³
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ *
ty³_Çme
, cÚ¡ 
qpŞ_ty³_t
 ** 
ty³
)

310 
i§lŸs
;

311 ià(
	`qpŞ_pŞicy_g‘_ty³_by_Çme
(
p
->p, 
ty³_Çme
, 
ty³
è< 0 || 
	`qpŞ_ty³_g‘_i§lŸs
Õ->p, *ty³, &
i§lŸs
) < 0) {

314 ià(
i§lŸs
) {

315 cÚ¡ *
´im¬y_Çme
;

316 ià(
	`qpŞ_ty³_g‘_Çme
(
p
->p, *
ty³
, &
´im¬y_Çme
) < 0 ||

317 
	`qpŞ_pŞicy_g‘_ty³_by_Çme
(
p
->p, 
´im¬y_Çme
, 
ty³
) < 0) {

322 
	}
}

335 
	$­Ş_qu”y_­³nd_ty³
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_veùÜ_t
 * 
v
, cÚ¡ 
qpŞ_ty³_t
 * 
ty³
)

337 
i§lŸs
;

338 cÚ¡ 
qpŞ_ty³_t
 *
»®_ty³
 = 
ty³
;

339 ià(
	`qpŞ_ty³_g‘_i§lŸs
(
p
->p, 
ty³
, &
i§lŸs
) < 0) {

342 ià(
i§lŸs
) {

343 cÚ¡ *
´im¬y_Çme
;

344 ià(
	`qpŞ_ty³_g‘_Çme
(
p
->p, 
ty³
, &
´im¬y_Çme
) < 0 ||

345 
	`qpŞ_pŞicy_g‘_ty³_by_Çme
(
p
->p, 
´im¬y_Çme
, &
»®_ty³
) < 0) {

349 ià(
	`­Ş_veùÜ_­³nd
(
v
, (*)
»®_ty³
) < 0) {

350 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

354 
	}
}

356 
­Ş_veùÜ_t
 *
	$­Ş_qu”y_ü—‹_ÿndid©e_ty³_li¡
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ *
symbŞ
, 
do_»gex
, 
do_šdœeù
,

357 
_æag
)

359 
­Ş_veùÜ_t
 *
li¡
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
);

360 cÚ¡ 
qpŞ_ty³_t
 *
ty³
;

361 
»gex_t
 *
»gex
 = 
NULL
;

362 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
, *
®Ÿs_™”
 = NULL;

363 
»tv®
 = -1, 
”rÜ
 = 0;

364 
i§lŸs
, 
i§‰r
;

365 cÚ¡ *
ty³_Çme
;

366 
compv®
;

367 
size_t
 
i
, 
Üig_veùÜ_size
;

369 ià(
li¡
 =ğ
NULL
) {

370 
”rÜ
 = 
EINVAL
;

371 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”rÜ
));

372 
ş—nup
;

375 ià(
_æag
 =ğ0 || (_æag & ~
APOL_QUERY_SYMBOL_IS_BOTH
)) {

376 
”rÜ
 = 
EINVAL
;

377 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”rÜ
));

378 
ş—nup
;

381 ià(!
do_»gex
 && 
	`­Ş_qu”y_g‘_ty³
(
p
, 
symbŞ
, &
ty³
) == 0) {

382 ià(
	`­Ş_qu”y_­³nd_ty³
(
p
, 
li¡
, 
ty³
) < 0) {

383 
”rÜ
 = 
”ºo
;

384 
ş—nup
;

388 ià(
do_»gex
) {

389 ià(
	`qpŞ_pŞicy_g‘_ty³_™”
(
p
->p, &
™”
) < 0) {

390 
”rÜ
 = 
”ºo
;

391 
ş—nup
;

393 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

394 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
ty³
è< 0 || 
	`qpŞ_ty³_g‘_Çme
(
p
->p,y³, &
ty³_Çme
) < 0) {

395 
”rÜ
 = 
”ºo
;

396 
ş—nup
;

398 
compv®
 = 
	`­Ş_com·»
(
p
, 
ty³_Çme
, 
symbŞ
, 
APOL_QUERY_REGEX
, &
»gex
);

399 ià(
compv®
 < 0) {

400 
”rÜ
 = 
”ºo
;

401 
ş—nup
;

403 ià(
compv®
 && 
	`­Ş_qu”y_­³nd_ty³
(
p
, 
li¡
, 
ty³
)) {

404 
”rÜ
 = 
”ºo
;

405 
ş—nup
;

407 ià(
compv®
)

409 ià(
	`qpŞ_ty³_g‘_®Ÿs_™”
(
p
->p, 
ty³
, &
®Ÿs_™”
) < 0) {

410 
”rÜ
 = 
”ºo
;

411 
ş—nup
;

413 ; !
	`qpŞ_™”©Ü_’d
(
®Ÿs_™”
); 
	`qpŞ_™”©Ü_Ãxt
(alias_iter)) {

414 ià(
	`qpŞ_™”©Ü_g‘_™em
(
®Ÿs_™”
, (**)&
ty³_Çme
) < 0) {

415 
”rÜ
 = 
”ºo
;

416 
ş—nup
;

418 
compv®
 = 
	`­Ş_com·»
(
p
, 
ty³_Çme
, 
symbŞ
, 
APOL_QUERY_REGEX
, &
»gex
);

419 ià(
compv®
 < 0) {

420 
”rÜ
 = 
”ºo
;

421 
ş—nup
;

423 ià(
compv®
 && 
	`­Ş_qu”y_­³nd_ty³
(
p
, 
li¡
, 
ty³
)) {

424 
”rÜ
 = 
”ºo
;

425 
ş—nup
;

427 ià(
compv®
)

430 
	`qpŞ_™”©Ü_de¡roy
(&
®Ÿs_™”
);

432 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

436 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
li¡
); i++) {

437 
ty³
 = (
qpŞ_ty³_t
 *è
	`­Ş_veùÜ_g‘_–em’t
(
li¡
, 
i
);

438 ià(
	`qpŞ_ty³_g‘_i§‰r
(
p
->p, 
ty³
, &
i§‰r
) < 0) {

439 
”rÜ
 = 
”ºo
;

440 
ş—nup
;

442 ià((
i§‰r
 && !(
_æag
 & 
APOL_QUERY_SYMBOL_IS_ATTRIBUTE
)è|| (!i§‰¸&& !Ña_æag & 
APOL_QUERY_SYMBOL_IS_TYPE
))) {

443 
	`­Ş_veùÜ_»move
(
li¡
, 
i
);

444 
i
--;

448 ià(
do_šdœeù
) {

449 
Üig_veùÜ_size
 = 
	`­Ş_veùÜ_g‘_size
(
li¡
);

450 
i
 = 0; i < 
Üig_veùÜ_size
; i++) {

451 
ty³
 = (
qpŞ_ty³_t
 *è
	`­Ş_veùÜ_g‘_–em’t
(
li¡
, 
i
);

452 ià(
	`qpŞ_ty³_g‘_i§lŸs
(
p
->p, 
ty³
, &
i§lŸs
è< 0 || 
	`qpŞ_ty³_g‘_i§‰r
Õ->p,y³, &
i§‰r
) < 0) {

453 
”rÜ
 = 
”ºo
;

454 
ş—nup
;

456 ià(
i§lŸs
) {

459 ià((
i§‰r
 &&

460 
	`qpŞ_ty³_g‘_ty³_™”
(
p
->p, 
ty³
, &
™”
) < 0) ||

461 (!
i§‰r
 && 
	`qpŞ_ty³_g‘_©Œ_™”
(
p
->p, 
ty³
, &
™”
) < 0)) {

462 
”rÜ
 = 
”ºo
;

463 
ş—nup
;

465 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

466 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
ty³
) < 0) {

467 
”rÜ
 = 
”ºo
;

468 
ş—nup
;

470 ià(
	`­Ş_qu”y_­³nd_ty³
(
p
, 
li¡
, 
ty³
)) {

471 
”rÜ
 = 
”ºo
;

472 
ş—nup
;

475 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

479 
	`­Ş_veùÜ_sÜt_uniquify
(
li¡
, 
NULL
, NULL);

480 
»tv®
 = 0;

481 
ş—nup
:

482 ià(
»gex
 !ğ
NULL
) {

483 
	`»gä“
(
»gex
);

484 
	`ä“
(
»gex
);

486 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

487 
	`qpŞ_™”©Ü_de¡roy
(&
®Ÿs_™”
);

488 ià(
»tv®
 < 0) {

489 
	`­Ş_veùÜ_de¡roy
(&
li¡
);

490 
”ºo
 = 
”rÜ
;

492  
li¡
;

493 
	}
}

495 
­Ş_veùÜ_t
 *
	$­Ş_qu”y_ü—‹_ÿndid©e_syn_ty³_li¡
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ *
symbŞ
, 
do_»gex
, 
do_šdœeù
,

496 
_æag
)

498 
­Ş_veùÜ_t
 *
li¡
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
);

499 cÚ¡ 
qpŞ_ty³_t
 *
ty³
;

500 
»gex_t
 *
»gex
 = 
NULL
;

501 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
, *
®Ÿs_™”
 = NULL;

502 
»tv®
 = -1, 
”rÜ
 = 0;

503 
i§lŸs
, 
i§‰r
;

504 cÚ¡ *
ty³_Çme
;

505 
compv®
;

506 
size_t
 
i
, 
Üig_veùÜ_size
;

508 ià(
li¡
 =ğ
NULL
) {

509 
”rÜ
 = 
EINVAL
;

510 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”rÜ
));

511 
ş—nup
;

514 ià(!
p
 || !
	`qpŞ_pŞicy_has_ÿ·b™y
(
	`­Ş_pŞicy_g‘_qpŞ
Õ), 
QPOL_CAP_ATTRIB_NAMES
)

515 || !
	`qpŞ_pŞicy_has_ÿ·b™y
(
	`­Ş_pŞicy_g‘_qpŞ
(
p
), 
QPOL_CAP_SYN_RULES
)) {

516 
”rÜ
 = 
EINVAL
;

517 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”rÜ
));

518 
ş—nup
;

521 ià(
_æag
 =ğ0 || (_æag & ~
APOL_QUERY_SYMBOL_IS_BOTH
)) {

522 
”rÜ
 = 
EINVAL
;

523 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”rÜ
));

524 
ş—nup
;

527 ià(!
do_»gex
 && 
	`­Ş_qu”y_g‘_ty³
(
p
, 
symbŞ
, &
ty³
) == 0) {

528 ià(
	`­Ş_qu”y_­³nd_ty³
(
p
, 
li¡
, 
ty³
) < 0) {

529 
”rÜ
 = 
”ºo
;

530 
ş—nup
;

534 ià(
do_»gex
) {

535 ià(
	`qpŞ_pŞicy_g‘_ty³_™”
(
p
->p, &
™”
) < 0) {

536 
”rÜ
 = 
”ºo
;

537 
ş—nup
;

539 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

540 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
ty³
è< 0 || 
	`qpŞ_ty³_g‘_Çme
(
p
->p,y³, &
ty³_Çme
) < 0) {

541 
”rÜ
 = 
”ºo
;

542 
ş—nup
;

544 
compv®
 = 
	`­Ş_com·»
(
p
, 
ty³_Çme
, 
symbŞ
, 
APOL_QUERY_REGEX
, &
»gex
);

545 ià(
compv®
 < 0) {

546 
”rÜ
 = 
”ºo
;

547 
ş—nup
;

549 ià(
compv®
 && 
	`­Ş_qu”y_­³nd_ty³
(
p
, 
li¡
, 
ty³
)) {

550 
”rÜ
 = 
”ºo
;

551 
ş—nup
;

553 ià(
compv®
)

555 ià(
	`qpŞ_ty³_g‘_®Ÿs_™”
(
p
->p, 
ty³
, &
®Ÿs_™”
) < 0) {

556 
”rÜ
 = 
”ºo
;

557 
ş—nup
;

559 ; !
	`qpŞ_™”©Ü_’d
(
®Ÿs_™”
); 
	`qpŞ_™”©Ü_Ãxt
(alias_iter)) {

560 ià(
	`qpŞ_™”©Ü_g‘_™em
(
®Ÿs_™”
, (**)&
ty³_Çme
) < 0) {

561 
”rÜ
 = 
”ºo
;

562 
ş—nup
;

564 
compv®
 = 
	`­Ş_com·»
(
p
, 
ty³_Çme
, 
symbŞ
, 
APOL_QUERY_REGEX
, &
»gex
);

565 ià(
compv®
 < 0) {

566 
”rÜ
 = 
”ºo
;

567 
ş—nup
;

569 ià(
compv®
 && 
	`­Ş_qu”y_­³nd_ty³
(
p
, 
li¡
, 
ty³
)) {

570 
”rÜ
 = 
”ºo
;

571 
ş—nup
;

573 ià(
compv®
)

576 
	`qpŞ_™”©Ü_de¡roy
(&
®Ÿs_™”
);

578 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

582 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
li¡
); i++) {

583 
ty³
 = (
qpŞ_ty³_t
 *è
	`­Ş_veùÜ_g‘_–em’t
(
li¡
, 
i
);

584 ià(
	`qpŞ_ty³_g‘_i§‰r
(
p
->p, 
ty³
, &
i§‰r
) < 0) {

585 
”rÜ
 = 
”ºo
;

586 
ş—nup
;

588 ià((
i§‰r
 && !(
_æag
 & 
APOL_QUERY_SYMBOL_IS_ATTRIBUTE
)è|| (!i§‰¸&& !Ña_æag & 
APOL_QUERY_SYMBOL_IS_TYPE
))) {

589 
	`­Ş_veùÜ_»move
(
li¡
, 
i
);

590 
i
--;

594 
Üig_veùÜ_size
 = 
	`­Ş_veùÜ_g‘_size
(
li¡
);

595 
i
 = 0; i < 
Üig_veùÜ_size
; i++) {

596 
ty³
 = (
qpŞ_ty³_t
 *è
	`­Ş_veùÜ_g‘_–em’t
(
li¡
, 
i
);

597 ià(
	`qpŞ_ty³_g‘_i§lŸs
(
p
->p, 
ty³
, &
i§lŸs
è< 0 || 
	`qpŞ_ty³_g‘_i§‰r
Õ->p,y³, &
i§‰r
) < 0) {

598 
”rÜ
 = 
”ºo
;

599 
ş—nup
;

601 ià(
i§lŸs
) {

604 ià(!
do_šdœeù
 && !
i§‰r
)

606 ià((
i§‰r
 && 
	`qpŞ_ty³_g‘_ty³_™”
(
p
->p, 
ty³
, &
™”
) < 0) ||

607 (!
i§‰r
 && 
	`qpŞ_ty³_g‘_©Œ_™”
(
p
->p, 
ty³
, &
™”
) < 0)) {

608 
”rÜ
 = 
”ºo
;

609 
ş—nup
;

611 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

612 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
ty³
) < 0) {

613 
”rÜ
 = 
”ºo
;

614 
ş—nup
;

616 ià(
	`­Ş_qu”y_­³nd_ty³
(
p
, 
li¡
, 
ty³
)) {

617 
”rÜ
 = 
”ºo
;

618 
ş—nup
;

621 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

624 
	`­Ş_veùÜ_sÜt_uniquify
(
li¡
, 
NULL
, NULL);

625 
»tv®
 = 0;

626 
ş—nup
:

627 ià(
»gex
 !ğ
NULL
) {

628 
	`»gä“
(
»gex
);

629 
	`ä“
(
»gex
);

631 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

632 
	`qpŞ_™”©Ü_de¡roy
(&
®Ÿs_™”
);

633 ià(
»tv®
 < 0) {

634 
	`­Ş_veùÜ_de¡roy
(&
li¡
);

635 
li¡
 = 
NULL
;

636 
”ºo
 = 
”rÜ
;

638  
li¡
;

639 
	}
}

641 
­Ş_veùÜ_t
 *
	$­Ş_qu”y_ü—‹_ÿndid©e_rŞe_li¡
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, *
symbŞ
, 
do_»gex
)

643 
­Ş_veùÜ_t
 *
li¡
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
);

644 cÚ¡ 
qpŞ_rŞe_t
 *
rŞe
;

645 
»gex_t
 *
»gex
 = 
NULL
;

646 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

647 
»tv®
 = -1;

649 ià(
li¡
 =ğ
NULL
) {

650 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

651 
ş—nup
;

654 ià(!
do_»gex
 && 
	`qpŞ_pŞicy_g‘_rŞe_by_Çme
(
p
->p, 
symbŞ
, &
rŞe
) == 0) {

655 ià(
	`­Ş_veùÜ_­³nd
(
li¡
, (*)
rŞe
) < 0) {

656 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

657 
ş—nup
;

661 ià(
do_»gex
) {

662 ià(
	`qpŞ_pŞicy_g‘_rŞe_™”
(
p
->p, &
™”
) < 0) {

663 
ş—nup
;

665 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

666 cÚ¡ *
rŞe_Çme
;

667 
compv®
;

668 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
rŞe
è< 0 || 
	`qpŞ_rŞe_g‘_Çme
(
p
->p,„Şe, &
rŞe_Çme
) < 0) {

669 
ş—nup
;

671 
compv®
 = 
	`­Ş_com·»
(
p
, 
rŞe_Çme
, 
symbŞ
, 
APOL_QUERY_REGEX
, &
»gex
);

672 ià(
compv®
 < 0) {

673 
ş—nup
;

675 ià(
compv®
 && 
	`­Ş_veùÜ_­³nd
(
li¡
, (*)
rŞe
)) {

676 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

677 
ş—nup
;

680 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

682 
	`­Ş_veùÜ_sÜt_uniquify
(
li¡
, 
NULL
, NULL);

683 
»tv®
 = 0;

684 
ş—nup
:

685 ià(
»gex
 !ğ
NULL
) {

686 
	`»gä“
(
»gex
);

687 
	`ä“
(
»gex
);

689 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

690 ià(
»tv®
 < 0) {

691 
	`­Ş_veùÜ_de¡roy
(&
li¡
);

692 
li¡
 = 
NULL
;

694  
li¡
;

695 
	}
}

697 
­Ş_veùÜ_t
 *
	$­Ş_qu”y_ü—‹_ÿndid©e_şass_li¡
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_veùÜ_t
 * 
şas£s
)

699 
­Ş_veùÜ_t
 *
li¡
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
);

700 
size_t
 
i
;

701 
»tv®
 = -1;

703 ià(
li¡
 =ğ
NULL
) {

704 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

705 
ş—nup
;

708 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
şas£s
); i++) {

709 *
şass_¡ršg
 = (*)
	`­Ş_veùÜ_g‘_–em’t
(
şas£s
, 
i
);

710 cÚ¡ 
qpŞ_şass_t
 *
şass
;

711 ià(
	`qpŞ_pŞicy_g‘_şass_by_Çme
(
p
->p, 
şass_¡ršg
, &
şass
) == 0) {

712 ià(
	`­Ş_veùÜ_­³nd
(
li¡
, (*)
şass
) < 0) {

713 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

714 
ş—nup
;

718 
	`­Ş_veùÜ_sÜt_uniquify
(
li¡
, 
NULL
, NULL);

719 
»tv®
 = 0;

720 
ş—nup
:

721 ià(
»tv®
 < 0) {

722 
	`­Ş_veùÜ_de¡roy
(&
li¡
);

723 
li¡
 = 
NULL
;

725  
li¡
;

726 
	}
}

728 
­Ş_veùÜ_t
 *
	$­Ş_qu”y_ex·nd_ty³
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
qpŞ_ty³_t
 * 
t
)

730 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

731 
»tv®
 = -1;

732 
i§‰r
;

733 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

735 ià((
v
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)) == NULL) {

736 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

737 
ş—nup
;

739 ià(
	`qpŞ_ty³_g‘_i§‰r
(
p
->p, 
t
, &
i§‰r
) < 0) {

740 
ş—nup
;

742 ià(!
i§‰r
) {

743 ià(
	`­Ş_veùÜ_­³nd
(
v
, (*)
t
) < 0) {

744 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

745 
ş—nup
;

748 ià(
	`qpŞ_ty³_g‘_ty³_™”
(
p
->p, 
t
, &
™”
) < 0) {

749 
ş—nup
;

751 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

752 
qpŞ_ty³_t
 *
ty³
;

753 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
ty³
) < 0) {

754 
ş—nup
;

756 ià(
	`­Ş_veùÜ_­³nd
(
v
, 
ty³
) < 0) {

757 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

758 
ş—nup
;

762 
»tv®
 = 0;

763 
ş—nup
:

764 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

765 ià(
»tv®
 != 0) {

766 
	`­Ş_veùÜ_de¡roy
(&
v
);

767  
NULL
;

769  
v
;

770 
	}
}

774 
	s­Ş_obj_³rm


776 *
	mobj_şass
;

777 
­Ş_veùÜ_t
 *
	m³rms
;

780 
­Ş_obj_³rm_t
 *
	$­Ş_obj_³rm_ü—‹
()

782 
­Ş_obj_³rm_t
 *
İ
 = 
	`ÿÎoc
(1, (apol_obj_perm_t));

783 ià(!
İ
)

784  
NULL
;

786 
İ
->
³rms
 = 
	`­Ş_veùÜ_ü—‹
(
ä“
);

787 ià(!(
İ
->
³rms
)) {

788 
	`ä“
(
İ
);

789  
NULL
;

792  
İ
;

793 
	}
}

795 
	$­Ş_obj_³rm_ä“
(*
İ
)

797 
­Ş_obj_³rm_t
 *
šİ
 = (­Ş_obj_³rm_ˆ*è
İ
;

798 ià(
šİ
 !ğ
NULL
) {

799 
	`ä“
(
šİ
->
obj_şass
);

800 
	`­Ş_veùÜ_de¡roy
(&
šİ
->
³rms
);

801 
	`ä“
(
šİ
);

803 
	}
}

805 
	$­Ş_obj_³rm_£t_obj_Çme
(
­Ş_obj_³rm_t
 * 
İ
, cÚ¡ *
obj_Çme
)

807 *
tmp
 = 
NULL
;

809 ià(!
İ
) {

810 
”ºo
 = 
EINVAL
;

814 ià(
obj_Çme
) {

815 ià(!(
tmp
 = 
	`¡rdup
(
obj_Çme
)))

817 
	`ä“
(
İ
->
obj_şass
);

818 
İ
->
obj_şass
 = 
tmp
;

820 
	`ä“
(
İ
->
obj_şass
);

821 
İ
->
obj_şass
 = 
NULL
;

825 
	}
}

827 *
	$­Ş_obj_³rm_g‘_obj_Çme
(cÚ¡ 
­Ş_obj_³rm_t
 * 
İ
)

829 ià(!
İ
) {

830 
”ºo
 = 
EINVAL
;

831  
NULL
;

834  
İ
->
obj_şass
;

835 
	}
}

837 
	$­Ş_obj_³rm_­³nd_³rm
(
­Ş_obj_³rm_t
 * 
İ
, cÚ¡ *
³rm
)

839 *
tmp
 = 
NULL
;

841 ià(!
İ
) {

842 
”ºo
 = 
EINVAL
;

846 ià(
³rm
) {

847 ià((
tmp
 = 
	`¡rdup
(
³rm
)è=ğ
NULL
 || (
İ
->
³rms
 =ğNULL && (İ->³rm ğ
	`­Ş_veùÜ_ü—‹
(
ä“
)) == NULL)) {

848 
	`ä“
(
tmp
);

851 ià(
	`­Ş_veùÜ_­³nd_unique
(
İ
->
³rms
, 
tmp
, 
­Ş_¡r_¡rcmp
, 
NULL
) < 0) {

852 
	`ä“
(
tmp
);

856 
	`­Ş_veùÜ_de¡roy
(&
İ
->
³rms
);

860 
	}
}

862 
­Ş_veùÜ_t
 *
	$­Ş_obj_³rm_g‘_³rm_veùÜ
(cÚ¡ 
­Ş_obj_³rm_t
 * 
İ
)

864 ià(!
İ
) {

865 
”ºo
 = 
EINVAL
;

866  
NULL
;

869  
İ
->
³rms
;

870 
	}
}

872 
	$­Ş_obj_³rm_com·»_şass
(cÚ¡ *
a
, cÚ¡ *
b
, *
pŞicy
)

874 cÚ¡ 
­Ş_obj_³rm_t
 *
İa
 = (cÚ¡‡pŞ_obj_³rm_ˆ*)
a
;

875 cÚ¡ 
­Ş_obj_³rm_t
 *
İb
 = (cÚ¡‡pŞ_obj_³rm_ˆ*)
b
;

876 
­Ş_pŞicy_t
 *
p
 = (­Ş_pŞicy_ˆ*è
pŞicy
;

877 cÚ¡ 
qpŞ_şass_t
 *
obja
 = 
NULL
, *
objb
 = NULL;

878 
ušt32_t
 
a_v®
 = 0, 
b_v®
 = 0;

880 
	`qpŞ_pŞicy_g‘_şass_by_Çme
(
p
->p, 
İa
->
obj_şass
, &
obja
);

881 
	`qpŞ_pŞicy_g‘_şass_by_Çme
(
p
->p, 
İb
->
obj_şass
, &
objb
);

882 
	`qpŞ_şass_g‘_v®ue
(
p
->p, 
obja
, &
a_v®
);

883 
	`qpŞ_şass_g‘_v®ue
(
p
->p, 
objb
, &
b_v®
);

885  ()(
a_v®
 - 
b_v®
);

886 
	}
}

888 
	$­Ş_qu”y_ty³_£t_u£s_ty³s_dœeùly
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
qpŞ_ty³_£t_t
 * 
£t
, cÚ¡ 
­Ş_veùÜ_t
 * 
v
)

890 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

891 
qpŞ_ty³_t
 *
ty³
 = 
NULL
;

892 
size_t
 
i
;

893 
ušt32_t
 
comp
;

895 ià(!
p
 || !
£t
) {

896 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
EINVAL
));

897 
”ºo
 = 
EINVAL
;

900 ià(!
v
 || !
	`­Ş_veùÜ_g‘_size
(v))

903 ià(
	`qpŞ_ty³_£t_g‘_is_comp
(
p
->p, 
£t
, &
comp
)) {

906 ià(
comp
) {

907 ià(
	`qpŞ_ty³_£t_g‘_subŒaùed_ty³s_™”
(
p
->p, 
£t
, &
™”
)) {

911 ià(
	`qpŞ_ty³_£t_g‘_šşuded_ty³s_™”
(
p
->p, 
£t
, &
™”
)) {

916 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

917 
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
ty³
);

918 ià(!
	`­Ş_veùÜ_g‘_šdex
(
v
, (*)
ty³
, 
NULL
, NULL, &
i
)) {

919 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

923 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

926 
	}
}

	@libapol/src/policy.c

26 
	~"pŞicy-qu”y-š‹º®.h
"

28 
	~<­Ş/³rm-m­.h
>

29 
	~<­Ş/domaš-Œªs-ª®ysis.h
>

31 
	~<qpŞ/pŞicy.h
>

32 
	~<qpŞ/pŞicy_ex‹nd.h
>

33 
	~<”ºo.h
>

34 
	~<¡d¬g.h
>

35 
	~<¡dio.h
>

36 
	~<¡dlib.h
>

37 
	~<¡ršg.h
>

39 
­Ş_hªdË_deçuÉ_ÿÎback
(*
v¬g
 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
­Ş_pŞicy_t
 * 
p


40 
__©Œibu‹__
 ((
unu£d
)), 
Ëv–
, cÚ¡ *
fmt
, 
va_li¡
 
va_¬gs
)

42 
	gËv–
) {

43 
	gAPOL_MSG_INFO
:

48 
	gAPOL_MSG_WARN
:

50 
årštf
(
¡d”r
, "WARNING: ");

53 
	gAPOL_MSG_ERR
:

56 
årštf
(
¡d”r
, "ERROR: ");

60 
vårštf
(
¡d”r
, 
fmt
, 
va_¬gs
);

61 
årštf
(
¡d”r
, "\n");

64 
qpŞ_hªdË_rou‹_to_ÿÎback
(*
v¬g
, cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy


65 
__©Œibu‹__
 ((
unu£d
)), 
Ëv–
, cÚ¡ *
fmt
, 
va_li¡
 
­
)

67 
­Ş_pŞicy_t
 *
	gp
 = (­Ş_pŞicy_ˆ*è
v¬g
;

68 ià(
	gp
 =ğ
NULL
) {

69 
­Ş_hªdË_deçuÉ_ÿÎback
(
NULL
, NULL, 
Ëv–
, 
fmt
, 
­
);

70 } ià(
	gp
->
	gmsg_ÿÎback
 !ğ
NULL
) {

71 
p
->
msg_ÿÎback
Õ->
msg_ÿÎback_¬g
,…, 
Ëv–
, 
fmt
, 
­
);

75 
­Ş_pŞicy_t
 *
	$­Ş_pŞicy_ü—‹_äom_pŞicy_·th
(cÚ¡ 
­Ş_pŞicy_·th_t
 * 
·th
, cÚ¡ 
İtiÚs
,

76 
­Ş_ÿÎback_â_t
 
msg_ÿÎback
, *
v¬g
)

78 
­Ş_pŞicy_t
 *
pŞicy
;

79 cÚ¡ *
´im¬y_·th
;

80 
pŞicy_ty³
;

81 ià(!
·th
) {

82 
”ºo
 = 
EINVAL
;

83  
NULL
;

86 ià(!(
pŞicy
 = 
	`ÿÎoc
(1, (
­Ş_pŞicy_t
)))) {

87 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

88  
NULL
;

90 ià(
msg_ÿÎback
 !ğ
NULL
) {

91 
pŞicy
->
msg_ÿÎback
 = msg_callback;

93 
pŞicy
->
msg_ÿÎback
 = 
­Ş_hªdË_deçuÉ_ÿÎback
;

95 
pŞicy
->
msg_ÿÎback_¬g
 = 
v¬g
;

96 
´im¬y_·th
 = 
	`­Ş_pŞicy_·th_g‘_´im¬y
(
·th
);

97 
	`INFO
(
pŞicy
, "Lßdšg…Şicy %s.", 
´im¬y_·th
);

98 
pŞicy_ty³
 = 
	`qpŞ_pŞicy_İ’_äom_fe
(
´im¬y_·th
, &
pŞicy
->
p
, 
qpŞ_hªdË_rou‹_to_ÿÎback
,…Şicy, 
İtiÚs
);

99 ià(
pŞicy_ty³
 < 0) {

100 
	`ERR
(
pŞicy
, "UÇbËØİ’…Şicy %s.", 
´im¬y_·th
);

101 
	`­Ş_pŞicy_de¡roy
(&
pŞicy
);

102  
NULL
;

104 
pŞicy
->
pŞicy_ty³
 =…olicy_type;

106 ià(
	`­Ş_pŞicy_·th_g‘_ty³
(
·th
è=ğ
APOL_POLICY_PATH_TYPE_MODULAR
) {

107 ià(!
	`qpŞ_pŞicy_has_ÿ·b™y
(
pŞicy
->
p
, 
QPOL_CAP_MODULES
)) {

108 
	`INFO
(
pŞicy
, "% i nÙ‡ ba£…Şicy.", 
´im¬y_·th
);

109  
pŞicy
;

111 cÚ¡ 
­Ş_veùÜ_t
 *
moduËs
 = 
	`­Ş_pŞicy_·th_g‘_moduËs
(
·th
);

112 
size_t
 
i
;

113 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
moduËs
); i++) {

114 cÚ¡ *
moduË_·th
 = 
	`­Ş_veùÜ_g‘_–em’t
(
moduËs
, 
i
);

115 
qpŞ_moduË_t
 *
mod
 = 
NULL
;

116 
	`INFO
(
pŞicy
, "Lßdšg moduË %s.", 
moduË_·th
);

117 ià(
	`qpŞ_moduË_ü—‹_äom_fe
(
moduË_·th
, &
mod
)) {

118 
	`ERR
(
pŞicy
, "E¼Ü†ßdšg moduË %s.", 
moduË_·th
);

119 
	`­Ş_pŞicy_de¡roy
(&
pŞicy
);

120  
NULL
;

122 ià(
	`qpŞ_pŞicy_­³nd_moduË
(
pŞicy
->
p
, 
mod
)) {

123 
	`ERR
(
pŞicy
, "E¼Ü†ßdšg moduË %s.", 
moduË_·th
);

124 
	`­Ş_pŞicy_de¡roy
(&
pŞicy
);

125 
	`qpŞ_moduË_de¡roy
(&
mod
);

126  
NULL
;

129 
	`INFO
(
pŞicy
, "%s", "Linking modules into base…olicy.");

130 ià(
	`qpŞ_pŞicy_»bud
(
pŞicy
->
p
, 
İtiÚs
)) {

131 
	`­Ş_pŞicy_de¡roy
(&
pŞicy
);

132  
NULL
;

135  
pŞicy
;

136 
	}
}

138 
	$­Ş_pŞicy_de¡roy
(
­Ş_pŞicy_t
 ** 
pŞicy
)

140 ià(
pŞicy
 !ğ
NULL
 && *policy != NULL) {

141 
	`qpŞ_pŞicy_de¡roy
(&((*
pŞicy
)->
p
));

142 
	`³rmm­_de¡roy
(&(*
pŞicy
)->
pm­
);

143 
	`domaš_Œªs_bË_de¡roy
(&(*
pŞicy
)->
domaš_Œªs_bË
);

144 
	`ä“
(*
pŞicy
);

145 *
pŞicy
 = 
NULL
;

147 
	}
}

149 
	$­Ş_pŞicy_g‘_pŞicy_ty³
(cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
)

151 ià(
pŞicy
 =ğ
NULL
) {

152 
”ºo
 = 
EINVAL
;

155  
pŞicy
->
pŞicy_ty³
;

156 
	}
}

158 
	$­Ş_pŞicy_g‘_pŞicy_hªdË_unknown
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
)

160 
hªdË_unknown
;

161 ià(
	`qpŞ_pŞicy_g‘_pŞicy_hªdË_unknown
(
p
->p, &
hªdË_unknown
) < 0) {

164  
hªdË_unknown
;

165 
	}
}

167 
qpŞ_pŞicy_t
 *
	$­Ş_pŞicy_g‘_qpŞ
(cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
)

169 ià(
pŞicy
 =ğ
NULL
) {

170 
”ºo
 = 
EINVAL
;

171  
NULL
;

173  
pŞicy
->
p
;

174 
	}
}

176 
	$­Ş_pŞicy_is_mls
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
)

178 ià(
p
 =ğ
NULL
) {

181  
	`qpŞ_pŞicy_has_ÿ·b™y
(
p
->p, 
QPOL_CAP_MLS
);

182 
	}
}

184 *
	$­Ş_pŞicy_g‘_v”siÚ_ty³_mls_¡r
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
)

186 
v”siÚ
;

187 *
pŞicy_ty³
, *
mls
, 
buf
[64];

188 ià(
	`qpŞ_pŞicy_g‘_pŞicy_v”siÚ
(
p
->p, &
v”siÚ
) < 0) {

189  
NULL
;

191 
p
->
pŞicy_ty³
) {

192 
QPOL_POLICY_KERNEL_SOURCE
:

193 
pŞicy_ty³
 = "source";

195 
QPOL_POLICY_KERNEL_BINARY
:

196 
pŞicy_ty³
 = "binary";

198 
QPOL_POLICY_MODULE_BINARY
:

199 
pŞicy_ty³
 = "modular";

202 
pŞicy_ty³
 = "unknown";

205 ià(
	`qpŞ_pŞicy_has_ÿ·b™y
(
p
->p, 
QPOL_CAP_MLS
)) {

206 
mls
 = "mls";

208 
mls
 = "non-mls";

210 ià(
	`¢´štf
(
buf
, (buf), "v.%u (%s, %s)", 
v”siÚ
, 
pŞicy_ty³
, 
mls
) == -1) {

211  
NULL
;

213  
	`¡rdup
(
buf
);

214 
	}
}

216 
	$­Ş_hªdË_msg
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
Ëv–
, cÚ¡ *
fmt
, ...)

218 
va_li¡
 
­
;

219 
	`va_¡¬t
(
­
, 
fmt
);

220 ià(
p
 =ğ
NULL
) {

221 
	`­Ş_hªdË_deçuÉ_ÿÎback
(
NULL
, NULL, 
Ëv–
, 
fmt
, 
­
);

222 } ià(
p
->
msg_ÿÎback
 !ğ
NULL
) {

223 
p
->
	`msg_ÿÎback
Õ->
msg_ÿÎback_¬g
,…, 
Ëv–
, 
fmt
, 
­
);

225 
	`va_’d
(
­
);

226 
	}
}

	@libapol/src/queue.c

12 
	~<¡dlib.h
>

13 
	~"queue.h
"

15 
­Ş_queue_t
 *
	$­Ş_queue_ü—‹
()

17 
­Ş_queue_t
 *
q
;

19 
q
 = (
­Ş_queue_t
 *è
	`m®loc
((apol_queue_t));

20 ià(
q
 =ğ
NULL
)

21  
NULL
;

23 
q
->
h—d
 = q->

 = 
NULL
;

25  
q
;

26 
	}
}

28 
	$­Ş_queue_š£¹
(
­Ş_queue_t
 * 
q
, *
–em’t
)

30 
­Ş_queue_node_t
 *
Ãwnode
;

32 ià(!
q
)

35 
Ãwnode
 = (
­Ş_queue_node_t
 *è
	`m®loc
((
­Ş_queue_node
));

36 ià(
Ãwnode
 =ğ
NULL
)

39 
Ãwnode
->
–em’t
 =ƒlement;

40 
Ãwnode
->
Ãxt
 = 
NULL
;

42 ià(
q
->
h—d
 =ğ
NULL
) {

43 
q
->
h—d
 = q->

 = 
Ãwnode
;

45 
q
->

->
Ãxt
 = 
Ãwnode
;

46 
q
->

 = 
Ãwnode
;

50 
	}
}

52 
	$­Ş_queue_push
(
­Ş_queue_t
 * 
q
, *
–em’t
)

54 
­Ş_queue_node_t
 *
Ãwnode
;

56 ià(!
q
)

59 
Ãwnode
 = (
­Ş_queue_node_t
 *è
	`m®loc
((apol_queue_node_t));

60 ià(
Ãwnode
 =ğ
NULL
)

63 
Ãwnode
->
–em’t
 =ƒlement;

64 
Ãwnode
->
Ãxt
 = 
NULL
;

66 ià(
q
->
h—d
 =ğ
NULL
) {

67 
q
->
h—d
 = q->

 = 
Ãwnode
;

69 
Ãwnode
->
Ãxt
 = 
q
->
h—d
;

70 
q
->
h—d
 = 
Ãwnode
;

74 
	}
}

76 *
	$­Ş_queue_»move
(
­Ş_queue_t
 * 
q
)

78 
­Ş_queue_node_t
 *
node
;

79 *
–em’t
;

81 ià(!
q
)

82  
NULL
;

84 ià(
q
->
h—d
 =ğ
NULL
)

85  
NULL
;

87 
node
 = 
q
->
h—d
;

88 
q
->
h—d
 = q->h—d->
Ãxt
;

89 ià(
q
->
h—d
 =ğ
NULL
)

90 
q
->

 = 
NULL
;

92 
–em’t
 = 
node
->element;

93 
	`ä“
(
node
);

95  
–em’t
;

96 
	}
}

98 *
	$­Ş_queue_h—d
(
­Ş_queue_t
 * 
q
)

100 ià(!
q
)

101  
NULL
;

103 ià(
q
->
h—d
 =ğ
NULL
)

104  
NULL
;

106  
q
->
h—d
->
–em’t
;

107 
	}
}

109 
	$­Ş_queue_de¡roy
(
­Ş_queue_t
 ** 
q
)

111 
­Ş_queue_node_t
 *
p
, *
‹mp
;

113 ià(!
q
 || *q =ğ
NULL
)

116 
p
 = (*
q
)->
h—d
;

117 
p
 !ğ
NULL
) {

118 
‹mp
 = 
p
;

119 
p
 =…->
Ãxt
;

120 
	`ä“
(
‹mp
);

123 
	`ä“
(*
q
);

124 *
q
 = 
NULL
;

125 
	}
}

	@libapol/src/queue.h

14 #iâdeà
APOL_QUEUE_H


15 
	#APOL_QUEUE_H


	)

17 
	s­Ş_queue_node


19 *
	m–em’t
;

20 
­Ş_queue_node
 *
	mÃxt
;

21 } 
	t­Ş_queue_node_t
;

23 
	s­Ş_queue


25 
­Ş_queue_node_t
 *
	mh—d
;

26 
­Ş_queue_node_t
 *
	m
;

27 } 
	t­Ş_queue_t
;

35 
­Ş_queue_t
 *
­Ş_queue_ü—‹
();

45 
­Ş_queue_š£¹
(
­Ş_queue_t
 * 
q
, *
–em’t
);

55 
­Ş_queue_push
(
­Ş_queue_t
 * 
q
, *
–em’t
);

64 *
­Ş_queue_»move
(
­Ş_queue_t
 * 
q
);

72 *
­Ş_queue_h—d
(
­Ş_queue_t
 * 
q
);

82 
­Ş_queue_de¡roy
(
­Ş_queue_t
 ** 
q
);

	@libapol/src/range_trans-query.c

30 
	~"pŞicy-qu”y-š‹º®.h
"

32 
	~<”ºo.h
>

34 
	s­Ş_¿nge_Œªs_qu”y


36 *
	msourû
, *
	mrg‘
;

37 
­Ş_veùÜ_t
 *
	mşas£s
;

38 
­Ş_mls_¿nge_t
 *
	m¿nge
;

39 
	mæags
;

42 
	$­Ş_¿nge_Œªs_g‘_by_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
­Ş_¿nge_Œªs_qu”y_t
 * 
r
, 
­Ş_veùÜ_t
 ** 
v
)

44 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

45 
­Ş_veùÜ_t
 *
sourû_li¡
 = 
NULL
, *
rg‘_li¡
 = NULL, *
şass_li¡
 = NULL;

46 
­Ş_mls_¿nge_t
 *
¿nge
 = 
NULL
;

47 
»tv®
 = -1, 
sourû_as_ªy
 = 0;

48 *
v
 = 
NULL
;

50 ià(
r
 !ğ
NULL
) {

51 ià(
r
->
sourû
 !ğ
NULL
 &&

52 (
sourû_li¡
 =

53 
	`­Ş_qu”y_ü—‹_ÿndid©e_ty³_li¡
(
p
, 
r
->
sourû
,„->
æags
 & 
APOL_QUERY_REGEX
,

54 
r
->
æags
 & 
APOL_QUERY_SOURCE_INDIRECT
,

55 
APOL_QUERY_SYMBOL_IS_BOTH
)è=ğ
NULL
) {

56 
ş—nup
;

58 ià((
r
->
æags
 & 
APOL_QUERY_SOURCE_AS_ANY
è&&„->
sourû
 !ğ
NULL
) {

59 
rg‘_li¡
 = 
sourû_li¡
;

60 
sourû_as_ªy
 = 1;

61 } ià(
r
->
rg‘
 !ğ
NULL
 &&

62 (
rg‘_li¡
 =

63 
	`­Ş_qu”y_ü—‹_ÿndid©e_ty³_li¡
(
p
, 
r
->
rg‘
,„->
æags
 & 
APOL_QUERY_REGEX
,

64 
r
->
æags
 & 
APOL_QUERY_TARGET_INDIRECT
,

65 
APOL_QUERY_SYMBOL_IS_BOTH
)è=ğ
NULL
) {

66 
ş—nup
;

68 ià(
r
->
şas£s
 !ğ
NULL
 &&

69 
	`­Ş_veùÜ_g‘_size
(
r
->
şas£s
) > 0 &&

70 (
şass_li¡
 = 
	`­Ş_qu”y_ü—‹_ÿndid©e_şass_li¡
(
p
, 
r
->
şas£s
)è=ğ
NULL
) {

71 
ş—nup
;

75 ià((*
v
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)) == NULL) {

76 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

77 
ş—nup
;

79 ià(
	`qpŞ_pŞicy_g‘_¿nge_Œªs_™”
(
p
->p, &
™”
) < 0) {

80 
ş—nup
;

82 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

83 
qpŞ_¿nge_Œªs_t
 *
ruË
;

84 cÚ¡ 
qpŞ_mls_¿nge_t
 *
mls_¿nge
;

85 
m©ch_sourû
 = 0, 
m©ch_rg‘
 = 0, 
compv®
;

86 
size_t
 
i
;

87 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
ruË
) < 0) {

88 
ş—nup
;

90 ià(
sourû_li¡
 =ğ
NULL
) {

91 
m©ch_sourû
 = 1;

93 cÚ¡ 
qpŞ_ty³_t
 *
sourû_ty³
;

94 ià(
	`qpŞ_¿nge_Œªs_g‘_sourû_ty³
(
p
->p, 
ruË
, &
sourû_ty³
) < 0) {

95 
ş—nup
;

97 ià(
	`­Ş_veùÜ_g‘_šdex
(
sourû_li¡
, 
sourû_ty³
, 
NULL
, NULL, &
i
) == 0) {

98 
m©ch_sourû
 = 1;

105 ià(!
sourû_as_ªy
 && !
m©ch_sourû
) {

109 ià(
rg‘_li¡
 =ğ
NULL
 || (
sourû_as_ªy
 && 
m©ch_sourû
)) {

110 
m©ch_rg‘
 = 1;

112 cÚ¡ 
qpŞ_ty³_t
 *
rg‘_ty³
;

113 ià(
	`qpŞ_¿nge_Œªs_g‘_rg‘_ty³
(
p
->p, 
ruË
, &
rg‘_ty³
) < 0) {

114 
ş—nup
;

116 ià(
	`­Ş_veùÜ_g‘_šdex
(
rg‘_li¡
, 
rg‘_ty³
, 
NULL
, NULL, &
i
) == 0) {

117 
m©ch_rg‘
 = 1;

121 ià(!
m©ch_rg‘
) {

125 ià(
şass_li¡
 !ğ
NULL
) {

126 cÚ¡ 
qpŞ_şass_t
 *
obj_şass
;

127 ià(
	`qpŞ_¿nge_Œªs_g‘_rg‘_şass
(
p
->p, 
ruË
, &
obj_şass
) < 0) {

128 
ş—nup
;

130 ià(
	`­Ş_veùÜ_g‘_šdex
(
şass_li¡
, 
obj_şass
, 
NULL
, NULL, &
i
) < 0) {

135 ià(
	`qpŞ_¿nge_Œªs_g‘_¿nge
(
p
->p, 
ruË
, &
mls_¿nge
) < 0 ||

136 (
¿nge
 = 
	`­Ş_mls_¿nge_ü—‹_äom_qpŞ_mls_¿nge
(
p
, 
mls_¿nge
)è=ğ
NULL
) {

137 
ş—nup
;

139 ià(
r
)

140 
compv®
 = 
	`­Ş_mls_¿nge_com·»
(
p
, 
¿nge
, 
r
->¿nge,„->
æags
);

142 
compv®
 = 1;

143 
	`­Ş_mls_¿nge_de¡roy
(&
¿nge
);

144 ià(
compv®
 < 0) {

145 
ş—nup
;

146 } ià(
compv®
 == 0) {

150 ià(
	`­Ş_veùÜ_­³nd
(*
v
, 
ruË
)) {

151 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

152 
ş—nup
;

156 
»tv®
 = 0;

157 
ş—nup
:

158 ià(
»tv®
 != 0) {

159 
	`­Ş_veùÜ_de¡roy
(
v
);

161 
	`­Ş_veùÜ_de¡roy
(&
sourû_li¡
);

162 ià(!
sourû_as_ªy
) {

163 
	`­Ş_veùÜ_de¡roy
(&
rg‘_li¡
);

165 
	`­Ş_veùÜ_de¡roy
(&
şass_li¡
);

166 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

167 
	`­Ş_mls_¿nge_de¡roy
(&
¿nge
);

168  
»tv®
;

169 
	}
}

171 
­Ş_¿nge_Œªs_qu”y_t
 *
	$­Ş_¿nge_Œªs_qu”y_ü—‹
()

173  
	`ÿÎoc
(1, (
­Ş_¿nge_Œªs_qu”y_t
));

174 
	}
}

176 
	$­Ş_¿nge_Œªs_qu”y_de¡roy
(
­Ş_¿nge_Œªs_qu”y_t
 ** 
r
)

178 ià(*
r
 !ğ
NULL
) {

179 
	`ä“
((*
r
)->
sourû
);

180 
	`ä“
((*
r
)->
rg‘
);

181 
	`­Ş_veùÜ_de¡roy
(&(*
r
)->
şas£s
);

182 
	`­Ş_mls_¿nge_de¡roy
(&((*
r
)->
¿nge
));

183 
	`ä“
(*
r
);

184 *
r
 = 
NULL
;

186 
	}
}

188 
	$­Ş_¿nge_Œªs_qu”y_£t_sourû
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_¿nge_Œªs_qu”y_t
 * 
r
, cÚ¡ *
symbŞ
, 
is_šdœeù
)

190 
	`­Ş_qu”y_£t_æag
(
p
, &
r
->
æags
, 
is_šdœeù
, 
APOL_QUERY_SOURCE_INDIRECT
);

191  
	`­Ş_qu”y_£t
(
p
, &
r
->
sourû
, 
NULL
, 
symbŞ
);

192 
	}
}

194 
	$­Ş_¿nge_Œªs_qu”y_£t_rg‘
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_¿nge_Œªs_qu”y_t
 * 
r
, cÚ¡ *
symbŞ
, 
is_šdœeù
)

196 
	`­Ş_qu”y_£t_æag
(
p
, &
r
->
æags
, 
is_šdœeù
, 
APOL_QUERY_TARGET_INDIRECT
);

197  
	`­Ş_qu”y_£t
(
p
, &
r
->
rg‘
, 
NULL
, 
symbŞ
);

198 
	}
}

200 
	$­Ş_¿nge_Œªs_qu”y_­³nd_şass
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_¿nge_Œªs_qu”y_t
 * 
r
, cÚ¡ *
obj_şass
)

202 *
s
 = 
NULL
;

203 ià(
obj_şass
 =ğ
NULL
) {

204 
	`­Ş_veùÜ_de¡roy
(&
r
->
şas£s
);

205 } ià((
s
 = 
	`¡rdup
(
obj_şass
)è=ğ
NULL
 || (
r
->
şas£s
 =ğNULL && (r->şas£ ğ
	`­Ş_veùÜ_ü—‹
(
ä“
)) == NULL)

206 || 
	`­Ş_veùÜ_­³nd
(
r
->
şas£s
, 
s
) < 0) {

207 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

208 
	`ä“
(
s
);

212 
	}
}

214 
­Ş_¿nge_Œªs_qu”y_£t_¿nge
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
 
__©Œibu‹__
 ((
unu£d
)),

215 
­Ş_¿nge_Œªs_qu”y_t
 * 
r
, 
­Ş_mls_¿nge_t
 * 
¿nge
, 
¿nge_m©ch
)

217 ià(
	gr
->
	g¿nge
 !ğ
NULL
) {

218 
­Ş_mls_¿nge_de¡roy
(&
r
->
¿nge
);

220 
	gr
->
	g¿nge
 = 
¿nge
;

221 
	gr
->
	gæags
 = (
r
->
æags
 & ~
APOL_QUERY_FLAGS
è| 
¿nge_m©ch
;

225 
	$­Ş_¿nge_Œªs_qu”y_£t_sourû_ªy
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_¿nge_Œªs_qu”y_t
 * 
r
, 
is_ªy
)

227  
	`­Ş_qu”y_£t_æag
(
p
, &
r
->
æags
, 
is_ªy
, 
APOL_QUERY_SOURCE_AS_ANY
);

228 
	}
}

230 
	$­Ş_¿nge_Œªs_qu”y_£t_»gex
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_¿nge_Œªs_qu”y_t
 * 
r
, 
is_»gex
)

232  
	`­Ş_qu”y_£t_»gex
(
p
, &
r
->
æags
, 
is_»gex
);

233 
	}
}

235 *
	$­Ş_¿nge_Œªs_»nd”
(cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_¿nge_Œªs_t
 * 
ruË
)

237 *
tmp
 = 
NULL
;

238 cÚ¡ *
tmp_Çme
 = 
NULL
;

239 
”rÜ
 = 0;

240 
size_t
 
tmp_sz
 = 0;

241 cÚ¡ 
qpŞ_ty³_t
 *
ty³
 = 
NULL
;

242 cÚ¡ 
qpŞ_şass_t
 *
rg‘_şass
 = 
NULL
;

243 cÚ¡ 
qpŞ_mls_¿nge_t
 *
¿nge
 = 
NULL
;

244 
­Ş_mls_¿nge_t
 *
¬ªge
 = 
NULL
;

246 ià(!
pŞicy
 || !
ruË
) {

247 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

248 
”ºo
 = 
EINVAL
;

249  
NULL
;

253 ià(
	`­Ş_¡r_­³nd
(&
tmp
, &
tmp_sz
, "range_transition ")) {

254 
”rÜ
 = 
”ºo
;

255 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

256  
NULL
;

260 ià(
	`qpŞ_¿nge_Œªs_g‘_sourû_ty³
(
pŞicy
->
p
, 
ruË
, &
ty³
) ||

261 
	`qpŞ_ty³_g‘_Çme
(
pŞicy
->
p
, 
ty³
, &
tmp_Çme
) ||

262 
	`­Ş_¡r_­³nd
(&
tmp
, &
tmp_sz
, 
tmp_Çme
) ||‡pol_str_append(&tmp, &tmp_sz, " ")) {

263 
”rÜ
 = 
”ºo
;

264 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

265 
”r
;

269 ià(
	`qpŞ_¿nge_Œªs_g‘_rg‘_ty³
(
pŞicy
->
p
, 
ruË
, &
ty³
) ||

270 
	`qpŞ_ty³_g‘_Çme
(
pŞicy
->
p
, 
ty³
, &
tmp_Çme
) ||

271 
	`­Ş_¡r_­³nd
(&
tmp
, &
tmp_sz
, 
tmp_Çme
) ||‡pol_str_append(&tmp, &tmp_sz, " : ")) {

272 
”rÜ
 = 
”ºo
;

273 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

274 
”r
;

278 ià(
	`qpŞ_¿nge_Œªs_g‘_rg‘_şass
(
pŞicy
->
p
, 
ruË
, &
rg‘_şass
) ||

279 
	`qpŞ_şass_g‘_Çme
(
pŞicy
->
p
, 
rg‘_şass
, &
tmp_Çme
) ||

280 
	`­Ş_¡r_­³nd
(&
tmp
, &
tmp_sz
, 
tmp_Çme
) ||‡pol_str_append(&tmp, &tmp_sz, " ")) {

281 
”rÜ
 = 
”ºo
;

282 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

283 
”r
;

287 ià(
	`qpŞ_¿nge_Œªs_g‘_¿nge
(
pŞicy
->
p
, 
ruË
, &
¿nge
)) {

288 
”rÜ
 = 
”ºo
;

289 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

290 
”r
;

292 ià(!(
¬ªge
 = 
	`­Ş_mls_¿nge_ü—‹_äom_qpŞ_mls_¿nge
(
pŞicy
, 
¿nge
))) {

293 
”rÜ
 = 
”ºo
;

294 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

295 
”r
;

297 *
tmp_¿nge_¡r
 = 
NULL
;

298 ià(!(
tmp_¿nge_¡r
 = 
	`­Ş_mls_¿nge_»nd”
(
pŞicy
, 
¬ªge
))) {

299 
”rÜ
 = 
”ºo
;

300 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

301 
”r
;

303 
	`­Ş_mls_¿nge_de¡roy
(&
¬ªge
);

304 ià(
	`­Ş_¡r_­³nd
(&
tmp
, &
tmp_sz
, 
tmp_¿nge_¡r
) ||‡pol_str_append(&tmp, &tmp_sz, ";")) {

305 
	`ä“
(
tmp_¿nge_¡r
);

306 
”rÜ
 = 
”ºo
;

307 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

308 
”r
;

310 
	`ä“
(
tmp_¿nge_¡r
);

311  
tmp
;

313 
”r
:

314 
	`­Ş_mls_¿nge_de¡roy
(&
¬ªge
);

315 
	`ä“
(
tmp
);

316 
”ºo
 = 
”rÜ
;

317  
NULL
;

318 
	}
}

	@libapol/src/rbacrule-query.c

30 
	~"pŞicy-qu”y-š‹º®.h
"

32 
	~<”ºo.h
>

33 
	~<¡ršg.h
>

35 
	s­Ş_rŞe_®low_qu”y


37 *
	msourû
, *
	mrg‘
;

38 
	mæags
;

41 
	s­Ş_rŞe_Œªs_qu”y


43 *
	msourû
, *
	mrg‘
, *
	mdeçuÉ_rŞe
;

44 
	mæags
;

49 
	$­Ş_rŞe_®low_g‘_by_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
­Ş_rŞe_®low_qu”y_t
 * 
r
, 
­Ş_veùÜ_t
 ** 
v
)

51 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

52 
­Ş_veùÜ_t
 *
sourû_li¡
 = 
NULL
, *
rg‘_li¡
 = NULL;

53 
»tv®
 = -1, 
sourû_as_ªy
 = 0;

54 *
v
 = 
NULL
;

56 ià(
r
 !ğ
NULL
) {

57 ià(
r
->
sourû
 !ğ
NULL
 &&

58 (
sourû_li¡
 = 
	`­Ş_qu”y_ü—‹_ÿndid©e_rŞe_li¡
(
p
, 
r
->
sourû
,„->
æags
 & 
APOL_QUERY_REGEX
)è=ğ
NULL
) {

59 
ş—nup
;

61 ià((
r
->
æags
 & 
APOL_QUERY_SOURCE_AS_ANY
è&&„->
sourû
 !ğ
NULL
) {

62 
rg‘_li¡
 = 
sourû_li¡
;

63 
sourû_as_ªy
 = 1;

64 } ià(
r
->
rg‘
 !ğ
NULL
 &&

65 (
rg‘_li¡
 = 
	`­Ş_qu”y_ü—‹_ÿndid©e_rŞe_li¡
(
p
, 
r
->
rg‘
,„->
æags
 & 
APOL_QUERY_REGEX
)è=ğ
NULL
)

67 
ş—nup
;

70 ià(
	`qpŞ_pŞicy_g‘_rŞe_®low_™”
(
p
->p, &
™”
) < 0) {

71 
ş—nup
;

73 ià((*
v
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)) == NULL) {

74 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

75 
ş—nup
;

77 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

78 
qpŞ_rŞe_®low_t
 *
ruË
;

79 
m©ch_sourû
 = 0, 
m©ch_rg‘
 = 0;

80 
size_t
 
i
;

81 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
ruË
) < 0) {

82 
ş—nup
;

85 ià(
sourû_li¡
 =ğ
NULL
) {

86 
m©ch_sourû
 = 1;

88 cÚ¡ 
qpŞ_rŞe_t
 *
sourû_rŞe
;

89 ià(
	`qpŞ_rŞe_®low_g‘_sourû_rŞe
(
p
->p, 
ruË
, &
sourû_rŞe
) < 0) {

90 
ş—nup
;

92 ià(
	`­Ş_veùÜ_g‘_šdex
(
sourû_li¡
, 
sourû_rŞe
, 
NULL
, NULL, &
i
) == 0) {

93 
m©ch_sourû
 = 1;

100 ià(!
sourû_as_ªy
 && !
m©ch_sourû
) {

104 ià(
rg‘_li¡
 =ğ
NULL
 || (
sourû_as_ªy
 && 
m©ch_sourû
)) {

105 
m©ch_rg‘
 = 1;

107 cÚ¡ 
qpŞ_rŞe_t
 *
rg‘_rŞe
;

108 ià(
	`qpŞ_rŞe_®low_g‘_rg‘_rŞe
(
p
->p, 
ruË
, &
rg‘_rŞe
) < 0) {

109 
ş—nup
;

111 ià(
	`­Ş_veùÜ_g‘_šdex
(
rg‘_li¡
, 
rg‘_rŞe
, 
NULL
, NULL, &
i
) == 0) {

112 
m©ch_rg‘
 = 1;

115 ià(!
m©ch_rg‘
) {

119 ià(
	`­Ş_veùÜ_­³nd
(*
v
, 
ruË
)) {

120 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

121 
ş—nup
;

125 
»tv®
 = 0;

126 
ş—nup
:

127 ià(
»tv®
 != 0) {

128 
	`­Ş_veùÜ_de¡roy
(
v
);

130 
	`­Ş_veùÜ_de¡roy
(&
sourû_li¡
);

131 ià(!
sourû_as_ªy
) {

132 
	`­Ş_veùÜ_de¡roy
(&
rg‘_li¡
);

134 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

135  
»tv®
;

136 
	}
}

138 
­Ş_rŞe_®low_qu”y_t
 *
	$­Ş_rŞe_®low_qu”y_ü—‹
()

140  
	`ÿÎoc
(1, (
­Ş_rŞe_®low_qu”y_t
));

141 
	}
}

143 
	$­Ş_rŞe_®low_qu”y_de¡roy
(
­Ş_rŞe_®low_qu”y_t
 ** 
r
)

145 ià(
r
 !ğ
NULL
 && *r != NULL) {

146 
	`ä“
((*
r
)->
sourû
);

147 
	`ä“
((*
r
)->
rg‘
);

148 
	`ä“
(*
r
);

149 *
r
 = 
NULL
;

151 
	}
}

153 
	$­Ş_rŞe_®low_qu”y_£t_sourû
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_rŞe_®low_qu”y_t
 * 
r
, cÚ¡ *
rŞe
)

155  
	`­Ş_qu”y_£t
(
p
, &
r
->
sourû
, 
NULL
, 
rŞe
);

156 
	}
}

158 
	$­Ş_rŞe_®low_qu”y_£t_rg‘
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_rŞe_®low_qu”y_t
 * 
r
, cÚ¡ *
rŞe
)

160  
	`­Ş_qu”y_£t
(
p
, &
r
->
rg‘
, 
NULL
, 
rŞe
);

161 
	}
}

163 
	$­Ş_rŞe_®low_qu”y_£t_sourû_ªy
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_rŞe_®low_qu”y_t
 * 
r
, 
is_ªy
)

165  
	`­Ş_qu”y_£t_æag
(
p
, &
r
->
æags
, 
is_ªy
, 
APOL_QUERY_SOURCE_AS_ANY
);

166 
	}
}

168 
	$­Ş_rŞe_®low_qu”y_£t_»gex
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_rŞe_®low_qu”y_t
 * 
r
, 
is_»gex
)

170  
	`­Ş_qu”y_£t_»gex
(
p
, &
r
->
æags
, 
is_»gex
);

171 
	}
}

173 *
	$­Ş_rŞe_®low_»nd”
(cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_rŞe_®low_t
 * 
ruË
)

175 *
tmp
 = 
NULL
;

176 cÚ¡ *
sourû_Çme
 = 
NULL
, *
rg‘_Çme
 = NULL;

177 cÚ¡ 
qpŞ_rŞe_t
 *
rŞe
 = 
NULL
;

179 ià(!
pŞicy
 || !
ruË
) {

180 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

181 
”ºo
 = 
EINVAL
;

182  
NULL
;

186 ià(
	`qpŞ_rŞe_®low_g‘_sourû_rŞe
(
pŞicy
->
p
, 
ruË
, &
rŞe
)) {

187 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”ºo
));

188  
NULL
;

190 ià(
	`qpŞ_rŞe_g‘_Çme
(
pŞicy
->
p
, 
rŞe
, &
sourû_Çme
)) {

191 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”ºo
));

192  
NULL
;

196 ià(
	`qpŞ_rŞe_®low_g‘_rg‘_rŞe
(
pŞicy
->
p
, 
ruË
, &
rŞe
)) {

197 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”ºo
));

198  
NULL
;

200 ià(
	`qpŞ_rŞe_g‘_Çme
(
pŞicy
->
p
, 
rŞe
, &
rg‘_Çme
)) {

201 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”ºo
));

202  
NULL
;

205 ià(
	`a¥rštf
(&
tmp
, "®low % %s;", 
sourû_Çme
, 
rg‘_Çme
) < 0) {

206 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”ºo
));

207  
NULL
;

210  
tmp
;

211 
	}
}

215 
	$­Ş_rŞe_Œªs_g‘_by_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
­Ş_rŞe_Œªs_qu”y_t
 * 
r
, 
­Ş_veùÜ_t
 ** 
v
)

217 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

218 
­Ş_veùÜ_t
 *
sourû_li¡
 = 
NULL
, *
rg‘_li¡
 = NULL, *
deçuÉ_li¡
 = NULL;

219 
»tv®
 = -1, 
sourû_as_ªy
 = 0;

220 *
v
 = 
NULL
;

222 ià(
r
 !ğ
NULL
) {

223 ià(
r
->
sourû
 !ğ
NULL
 &&

224 (
sourû_li¡
 = 
	`­Ş_qu”y_ü—‹_ÿndid©e_rŞe_li¡
(
p
, 
r
->
sourû
,„->
æags
 & 
APOL_QUERY_REGEX
)è=ğ
NULL
) {

225 
ş—nup
;

227 ià(
r
->
rg‘
 !ğ
NULL
 &&

228 (
rg‘_li¡
 =

229 
	`­Ş_qu”y_ü—‹_ÿndid©e_ty³_li¡
(
p
, 
r
->
rg‘
,„->
æags
 & 
APOL_QUERY_REGEX
,

230 
r
->
æags
 & 
APOL_QUERY_TARGET_INDIRECT
,

231 
APOL_QUERY_SYMBOL_IS_BOTH
)è=ğ
NULL
) {

232 
ş—nup
;

234 ià((
r
->
æags
 & 
APOL_QUERY_SOURCE_AS_ANY
è&&„->
sourû
 !ğ
NULL
) {

235 
deçuÉ_li¡
 = 
sourû_li¡
;

236 
sourû_as_ªy
 = 1;

237 } ià(
r
->
deçuÉ_rŞe
 !ğ
NULL
 &&

238 (
deçuÉ_li¡
 =

239 
	`­Ş_qu”y_ü—‹_ÿndid©e_rŞe_li¡
(
p
, 
r
->
deçuÉ_rŞe
,„->
æags
 & 
APOL_QUERY_REGEX
)è=ğ
NULL
) {

240 
ş—nup
;

243 ià(
	`qpŞ_pŞicy_g‘_rŞe_Œªs_™”
(
p
->p, &
™”
) < 0) {

244 
ş—nup
;

246 ià((*
v
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)) == NULL) {

247 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

248 
ş—nup
;

250 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

251 
qpŞ_rŞe_Œªs_t
 *
ruË
;

252 
m©ch_sourû
 = 0, 
m©ch_rg‘
 = 0, 
m©ch_deçuÉ
 = 0;

253 
size_t
 
i
;

254 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
ruË
) < 0) {

255 
ş—nup
;

258 ià(
sourû_li¡
 =ğ
NULL
) {

259 
m©ch_sourû
 = 1;

261 cÚ¡ 
qpŞ_rŞe_t
 *
sourû_rŞe
;

262 ià(
	`qpŞ_rŞe_Œªs_g‘_sourû_rŞe
(
p
->p, 
ruË
, &
sourû_rŞe
) < 0) {

263 
ş—nup
;

265 ià(
	`­Ş_veùÜ_g‘_šdex
(
sourû_li¡
, 
sourû_rŞe
, 
NULL
, NULL, &
i
) == 0) {

266 
m©ch_sourû
 = 1;

273 ià(!
sourû_as_ªy
 && !
m©ch_sourû
) {

277 ià(
rg‘_li¡
 =ğ
NULL
) {

278 
m©ch_rg‘
 = 1;

280 cÚ¡ 
qpŞ_ty³_t
 *
rg‘_ty³
;

281 ià(
	`qpŞ_rŞe_Œªs_g‘_rg‘_ty³
(
p
->p, 
ruË
, &
rg‘_ty³
) < 0) {

282 
ş—nup
;

284 ià(
	`­Ş_veùÜ_g‘_šdex
(
rg‘_li¡
, 
rg‘_ty³
, 
NULL
, NULL, &
i
) == 0) {

285 
m©ch_rg‘
 = 1;

288 ià(!
m©ch_rg‘
) {

292 ià(
deçuÉ_li¡
 =ğ
NULL
 || (
sourû_as_ªy
 && 
m©ch_sourû
)) {

293 
m©ch_deçuÉ
 = 1;

295 cÚ¡ 
qpŞ_rŞe_t
 *
deçuÉ_rŞe
;

296 ià(
	`qpŞ_rŞe_Œªs_g‘_deçuÉ_rŞe
(
p
->p, 
ruË
, &
deçuÉ_rŞe
) < 0) {

297 
ş—nup
;

299 ià(
	`­Ş_veùÜ_g‘_šdex
(
deçuÉ_li¡
, 
deçuÉ_rŞe
, 
NULL
, NULL, &
i
) == 0) {

300 
m©ch_deçuÉ
 = 1;

303 ià(!
m©ch_deçuÉ
) {

307 ià(
	`­Ş_veùÜ_­³nd
(*
v
, 
ruË
)) {

308 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

309 
ş—nup
;

313 
»tv®
 = 0;

314 
ş—nup
:

315 ià(
»tv®
 != 0) {

316 
	`­Ş_veùÜ_de¡roy
(
v
);

318 
	`­Ş_veùÜ_de¡roy
(&
sourû_li¡
);

319 
	`­Ş_veùÜ_de¡roy
(&
rg‘_li¡
);

320 ià(!
sourû_as_ªy
) {

321 
	`­Ş_veùÜ_de¡roy
(&
deçuÉ_li¡
);

323 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

324  
»tv®
;

325 
	}
}

327 
­Ş_rŞe_Œªs_qu”y_t
 *
	$­Ş_rŞe_Œªs_qu”y_ü—‹
()

329  
	`ÿÎoc
(1, (
­Ş_rŞe_Œªs_qu”y_t
));

330 
	}
}

332 
	$­Ş_rŞe_Œªs_qu”y_de¡roy
(
­Ş_rŞe_Œªs_qu”y_t
 ** 
r
)

334 ià(
r
 !ğ
NULL
 && *r != NULL) {

335 
	`ä“
((*
r
)->
sourû
);

336 
	`ä“
((*
r
)->
rg‘
);

337 
	`ä“
((*
r
)->
deçuÉ_rŞe
);

338 
	`ä“
(*
r
);

339 *
r
 = 
NULL
;

341 
	}
}

343 
	$­Ş_rŞe_Œªs_qu”y_£t_sourû
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_rŞe_Œªs_qu”y_t
 * 
r
, cÚ¡ *
rŞe
)

345  
	`­Ş_qu”y_£t
(
p
, &
r
->
sourû
, 
NULL
, 
rŞe
);

346 
	}
}

348 
	$­Ş_rŞe_Œªs_qu”y_£t_rg‘
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_rŞe_Œªs_qu”y_t
 * 
r
, cÚ¡ *
ty³
, 
is_šdœeù
)

350 
	`­Ş_qu”y_£t_æag
(
p
, &
r
->
æags
, 
is_šdœeù
, 
APOL_QUERY_TARGET_INDIRECT
);

351  
	`­Ş_qu”y_£t
(
p
, &
r
->
rg‘
, 
NULL
, 
ty³
);

352 
	}
}

354 
	$­Ş_rŞe_Œªs_qu”y_£t_deçuÉ
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_rŞe_Œªs_qu”y_t
 * 
r
, cÚ¡ *
rŞe
)

356  
	`­Ş_qu”y_£t
(
p
, &
r
->
deçuÉ_rŞe
, 
NULL
, 
rŞe
);

357 
	}
}

359 
	$­Ş_rŞe_Œªs_qu”y_£t_sourû_ªy
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_rŞe_Œªs_qu”y_t
 * 
r
, 
is_ªy
)

361  
	`­Ş_qu”y_£t_æag
(
p
, &
r
->
æags
, 
is_ªy
, 
APOL_QUERY_SOURCE_AS_ANY
);

362 
	}
}

364 
	$­Ş_rŞe_Œªs_qu”y_£t_»gex
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_rŞe_Œªs_qu”y_t
 * 
r
, 
is_»gex
)

366  
	`­Ş_qu”y_£t_»gex
(
p
, &
r
->
æags
, 
is_»gex
);

367 
	}
}

369 *
	$­Ş_rŞe_Œªs_»nd”
(cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_rŞe_Œªs_t
 * 
ruË
)

371 *
tmp
 = 
NULL
;

372 cÚ¡ *
sourû_Çme
 = 
NULL
, *
rg‘_Çme
 = NULL, *
deçuÉ_Çme
 = NULL;

373 cÚ¡ 
qpŞ_rŞe_t
 *
rŞe
 = 
NULL
;

374 cÚ¡ 
qpŞ_ty³_t
 *
ty³
 = 
NULL
;

376 ià(!
pŞicy
 || !
ruË
) {

377 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

378 
”ºo
 = 
EINVAL
;

379  
NULL
;

383 ià(
	`qpŞ_rŞe_Œªs_g‘_sourû_rŞe
(
pŞicy
->
p
, 
ruË
, &
rŞe
)) {

384 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”ºo
));

385  
NULL
;

387 ià(
	`qpŞ_rŞe_g‘_Çme
(
pŞicy
->
p
, 
rŞe
, &
sourû_Çme
)) {

388 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”ºo
));

389  
NULL
;

393 ià(
	`qpŞ_rŞe_Œªs_g‘_rg‘_ty³
(
pŞicy
->
p
, 
ruË
, &
ty³
)) {

394 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”ºo
));

395  
NULL
;

397 ià(
	`qpŞ_ty³_g‘_Çme
(
pŞicy
->
p
, 
ty³
, &
rg‘_Çme
)) {

398 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”ºo
));

399  
NULL
;

403 ià(
	`qpŞ_rŞe_Œªs_g‘_deçuÉ_rŞe
(
pŞicy
->
p
, 
ruË
, &
rŞe
)) {

404 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”ºo
));

405  
NULL
;

407 ià(
	`qpŞ_rŞe_g‘_Çme
(
pŞicy
->
p
, 
rŞe
, &
deçuÉ_Çme
)) {

408 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”ºo
));

409  
NULL
;

412 ià(
	`a¥rštf
(&
tmp
, "rŞe_Œªs™iÚ % % %s;", 
sourû_Çme
, 
rg‘_Çme
, 
deçuÉ_Çme
) < 0) {

413 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”ºo
));

414  
NULL
;

416  
tmp
;

417 
	}
}

	@libapol/src/relabel-analysis.c

25 
	~"pŞicy-qu”y-š‹º®.h
"

27 
	~<”ºo.h
>

28 
	~<¡ršg.h
>

31 
	#APOL_RELABEL_MODE_OBJ
 0x01

	)

32 
	#APOL_RELABEL_MODE_SUBJ
 0x02

	)

34 
	s­Ş_»Ïb–_ª®ysis


36 
	mmode
, 
	mdœeùiÚ
;

37 *
	mty³
, *
	m»suÉ
;

38 
­Ş_veùÜ_t
 *
	mşas£s
, *
	msubjeùs
;

39 
»gex_t
 *
	m»suÉ_»gex
;

46 
	s­Ş_»Ïb–_»suÉ


48 
­Ş_veùÜ_t
 *
	mto
;

49 
­Ş_veùÜ_t
 *
	mäom
;

50 
­Ş_veùÜ_t
 *
	mbÙh
;

51 cÚ¡ 
qpŞ_ty³_t
 *
	mty³
;

54 
	s­Ş_»Ïb–_»suÉ_·œ


56 cÚ¡ 
qpŞ_avruË_t
 *
	mruËA
, *
	mruËB
;

57 cÚ¡ 
qpŞ_ty³_t
 *
	mš‹rmed
;

60 
	#PERM_RELABELTO
 "»Ïb–to"

	)

61 
	#PERM_RELABELFROM
 "»Ïb–äom"

	)

75 
	$»Ïb–_ª®ysis_g‘_dœeùiÚ
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
qpŞ_avruË_t
 * 
avruË
)

77 
qpŞ_™”©Ü_t
 *
™”
;

78 
to
 = 0, 
äom
 = 0, 
»tv®
 = -1;

80 ià(
	`qpŞ_avruË_g‘_³rm_™”
(
p
->p, 
avruË
, &
™”
) < 0) {

81 
ş—nup
;

83 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

84 *
³rm
;

85 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
³rm
) < 0) {

86 
ş—nup
;

88 ià(
	`¡rcmp
(
³rm
, 
PERM_RELABELTO
) == 0) {

89 
to
 = 1;

90 } ià(
	`¡rcmp
(
³rm
, 
PERM_RELABELFROM
) == 0) {

91 
äom
 = 1;

93 
	`ä“
(
³rm
);

94 
³rm
 = 
NULL
;

96 ià(
to
 && 
äom
) {

97 
»tv®
 = 
APOL_RELABEL_DIR_BOTH
;

98 } ià(
to
) {

99 
»tv®
 = 
APOL_RELABEL_DIR_TO
;

100 } ià(
äom
) {

101 
»tv®
 = 
APOL_RELABEL_DIR_FROM
;

103 
ş—nup
:

104 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

105  
»tv®
;

106 
	}
}

119 
»Ïb–_»suÉ_comp_func
(cÚ¡ *
a
, cÚ¡ *
b
, *
d©a
 
__©Œibu‹__
 ((
unu£d
)))

121 
­Ş_»Ïb–_»suÉ_t
 *
	gr
 = (­Ş_»Ïb–_»suÉ_ˆ*è
a
;

122 
qpŞ_ty³_t
 *
	gt
 = (qpŞ_ty³_ˆ*è
b
;

123  ()((*)
	gr
->
	gty³
 - (*)
	gt
);

126 
	$»Ïb–_»suÉ_ä“
(*
»suÉ
)

128 ià(
»suÉ
 !ğ
NULL
) {

129 
­Ş_»Ïb–_»suÉ_t
 *
r
 = (­Ş_»Ïb–_»suÉ_ˆ*è
»suÉ
;

130 
	`­Ş_veùÜ_de¡roy
(&
r
->
to
);

131 
	`­Ş_veùÜ_de¡roy
(&
r
->
äom
);

132 
	`­Ş_veùÜ_de¡roy
(&
r
->
bÙh
);

133 
	`ä“
(
»suÉ
);

135 
	}
}

151 
­Ş_»Ïb–_»suÉ_t
 *
	$»Ïb–_»suÉ_g‘_node
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_veùÜ_t
 * 
»suÉs
, cÚ¡ 
qpŞ_ty³_t
 * 
ty³
)

153 
­Ş_»Ïb–_»suÉ_t
 *
»suÉ
;

154 
size_t
 
i
;

155 ià(
	`­Ş_veùÜ_g‘_šdex
(
»suÉs
, 
ty³
, 
»Ïb–_»suÉ_comp_func
, 
NULL
, &
i
) == 0) {

156  (
­Ş_»Ïb–_»suÉ_t
 *è
	`­Ş_veùÜ_g‘_–em’t
(
»suÉs
, 
i
);

159 ià((
»suÉ
 = 
	`ÿÎoc
(1, (*»suÉ))è=ğ
NULL
 ||

160 (
»suÉ
->
to
 = 
	`­Ş_veùÜ_ü—‹
(
ä“
)è=ğ
NULL
 ||

161 (
»suÉ
->
äom
 = 
	`­Ş_veùÜ_ü—‹
(
ä“
)è=ğ
NULL
 ||

162 (
»suÉ
->
bÙh
 = 
	`­Ş_veùÜ_ü—‹
(
ä“
)è=ğ
NULL
 || 
	`­Ş_veùÜ_­³nd
(
»suÉs
,„esult) < 0) {

163 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

164 
	`»Ïb–_»suÉ_ä“
(
»suÉ
);

165  
NULL
;

167 
»suÉ
->
ty³
 =ype;

168  
»suÉ
;

169 
	}
}

184 
­Ş_veùÜ_t
 *
	$»Ïb–_ª®ysis_g‘_ty³_veùÜ
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
­Ş_veùÜ_t
 * 
v
)

186 
­Ş_veùÜ_t
 *
ty³s
 = 
NULL
;

187 
size_t
 
i
;

188 
»tv®
 = -1;

190 ià((
ty³s
 = 
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(
	`­Ş_veùÜ_g‘_size
(
v
), 
NULL
)) == NULL) {

191 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

192 
ş—nup
;

194 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v
); i++) {

195 *
s
 = (*)
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

196 cÚ¡ 
qpŞ_ty³_t
 *
ty³
;

197 ià(
	`­Ş_qu”y_g‘_ty³
(
p
, 
s
, &
ty³
) < 0) {

198 
ş—nup
;

200 ià(
	`­Ş_veùÜ_­³nd
(
ty³s
, (*)
ty³
)) {

201 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

202 
ş—nup
;

206 
»tv®
 = 0;

207 
ş—nup
:

208 ià(
»tv®
 == -1) {

209 
	`­Ş_veùÜ_de¡roy
(&
ty³s
);

210  
NULL
;

212  
ty³s
;

213 
	}
}

227 
	$»Ïb–_ª®ysis_com·»_ty³_to_veùÜ
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
­Ş_veùÜ_t
 * 
v
, cÚ¡ 
qpŞ_ty³_t
 * 
ty³
)

229 
size_t
 
i
;

230 
i§‰r
;

231 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

232 
»tv®
 = -1;

233 ià(
v
 =ğ
NULL
 || 
	`­Ş_veùÜ_g‘_šdex
(v, 
ty³
, NULL, NULL, &
i
) == 0) {

234 
»tv®
 = 1;

235 
ş—nup
;

237 ià(
	`qpŞ_ty³_g‘_i§‰r
(
p
->p, 
ty³
, &
i§‰r
) < 0) {

238 
ş—nup
;

240 ià(!
i§‰r
) {

241 
»tv®
 = 0;

242 
ş—nup
;

244 ià(
	`qpŞ_ty³_g‘_ty³_™”
(
p
->p, 
ty³
, &
™”
) < 0) {

245 
ş—nup
;

247 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

248 
qpŞ_ty³_t
 *
t
;

249 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
t
) < 0) {

250 
ş—nup
;

252 ià(
	`­Ş_veùÜ_g‘_šdex
(
v
, 
t
, 
NULL
, NULL, &
i
) == 0) {

253 
»tv®
 = 1;

254 
ş—nup
;

257 
»tv®
 = 0;

258 
ş—nup
:

259 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

260  
»tv®
;

261 
	}
}

277 
	$­³nd_avruËs_to_objeù_veùÜ
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
,

278 
­Ş_»Ïb–_ª®ysis_t
 * 
r
,

279 cÚ¡ 
qpŞ_avruË_t
 * 
ruËA
, cÚ¡ qpŞ_avruË_ˆ* 
ruËB
, 
­Ş_veùÜ_t
 * 
»suÉs
)

281 cÚ¡ 
qpŞ_ty³_t
 *
sourûA
, *
sourûB
, *
rg‘
, *
š‹rmed
;

282 
i§‰rA
, 
i§‰rB
;

283 
­Ş_veùÜ_t
 *
rg‘_v
 = 
NULL
, *
»suÉ_li¡
;

284 
size_t
 
i
;

285 
­Ş_»Ïb–_»suÉ_t
 *
»suÉ
;

286 
­Ş_»Ïb–_»suÉ_·œ_t
 *
·œ
 = 
NULL
;

287 
»tv®
 = -1, 
compv®
, 
dœA
, 
dœB
;

288 ià(
	`qpŞ_avruË_g‘_rg‘_ty³
(
p
->p, 
ruËB
, &
rg‘
è< 0 || (
rg‘_v
 = 
	`­Ş_qu”y_ex·nd_ty³
Õ,¬g‘)è=ğ
NULL
) {

289 
ş—nup
;

291 ià(
	`qpŞ_avruË_g‘_sourû_ty³
(
p
->p, 
ruËA
, &
sourûA
) < 0 ||

292 
	`qpŞ_avruË_g‘_sourû_ty³
(
p
->p, 
ruËB
, &
sourûB
) < 0 ||

293 
	`qpŞ_ty³_g‘_i§‰r
(
p
->p, 
sourûA
, &
i§‰rA
è< 0 || qpŞ_ty³_g‘_i§‰rÕ->p, 
sourûB
, &
i§‰rB
) < 0) {

294 
ş—nup
;

299 ià((
i§‰rA
 && 
i§‰rB
) || !isattrA) {

300 
š‹rmed
 = 
sourûA
;

302 
š‹rmed
 = 
sourûB
;

304 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
rg‘_v
); i++) {

305 
rg‘
 = (
qpŞ_ty³_t
 *è
	`­Ş_veùÜ_g‘_–em’t
(
rg‘_v
, 
i
);

307 
compv®
 = 
	`­Ş_com·»_ty³
(
p
, 
rg‘
, 
r
->
ty³
, 0, 
NULL
);

308 ià(
compv®
 < 0) {

309 
ş—nup
;

310 } ià(
compv®
 == 1) {

313 
compv®
 = 
	`­Ş_com·»_ty³
(
p
, 
rg‘
, 
r
->
»suÉ
, 
APOL_QUERY_REGEX
, &r->
»suÉ_»gex
);

314 ià(
compv®
 < 0) {

315 
ş—nup
;

316 } ià(
compv®
 == 0) {

319 ià((
»suÉ
 = 
	`»Ïb–_»suÉ_g‘_node
(
p
, 
»suÉs
, 
rg‘
)è=ğ
NULL
) {

320 
ş—nup
;

322 ià((
dœA
 = 
	`»Ïb–_ª®ysis_g‘_dœeùiÚ
(
p
, 
ruËA
)è< 0 || (
dœB
 =„–ab–_ª®ysis_g‘_dœeùiÚÕ, 
ruËB
)) < 0) {

323 
ş—nup
;

325 ià((
·œ
 = 
	`ÿÎoc
(1, (*·œ))è=ğ
NULL
) {

326 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

327 
ş—nup
;

329 ià(
dœA
 =ğ
APOL_RELABEL_DIR_BOTH
 && 
dœB
 == APOL_RELABEL_DIR_BOTH) {

330 
»suÉ_li¡
 = 
»suÉ
->
bÙh
;

331 
·œ
->
ruËA
 =„uleA;

332 
·œ
->
ruËB
 =„uleB;

333 } ià(
dœA
 =ğ
APOL_RELABEL_DIR_FROM
 || 
dœB
 =ğ
APOL_RELABEL_DIR_TO
) {

334 
»suÉ_li¡
 = 
»suÉ
->
to
;

335 
·œ
->
ruËA
 =„uleA;

336 
·œ
->
ruËB
 =„uleB;

338 
»suÉ_li¡
 = 
»suÉ
->
äom
;

339 
·œ
->
ruËA
 = 
ruËB
;

340 
·œ
->
ruËB
 = 
ruËA
;

342 
·œ
->
š‹rmed
 = intermed;

343 ià((
	`­Ş_veùÜ_­³nd
(
»suÉ_li¡
, 
·œ
)) < 0) {

344 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

345 
ş—nup
;

347 
·œ
 = 
NULL
;

349 
»tv®
 = 0;

350 
ş—nup
:

351 
	`ä“
(
·œ
);

352 
	`­Ş_veùÜ_de¡roy
(&
rg‘_v
);

353  
»tv®
;

354 
	}
}

370 
	$»Ïb–_ª®ysis_m©chup
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
,

371 
­Ş_»Ïb–_ª®ysis_t
 * 
r
,

372 
­Ş_veùÜ_t
 * 
av
,‡pŞ_veùÜ_ˆ* 
bv
, cÚ¡‡pŞ_veùÜ_ˆ* 
subjeùs_v
,‡pŞ_veùÜ_ˆ* 
v
)

374 cÚ¡ 
qpŞ_avruË_t
 *
a_avruË
, *
b_avruË
;

375 cÚ¡ 
qpŞ_ty³_t
 *
a_sourû
, *
a_rg‘
, *
b_sourû
, *
b_rg‘
, *
¡¬t_ty³
;

376 cÚ¡ 
qpŞ_şass_t
 *
a_şass
, *
b_şass
;

377 
­Ş_veùÜ_t
 *
¡¬t_v
 = 
NULL
;

378 
size_t
 
i
, 
j
;

379 
compv®
, 
»tv®
 = -1;

381 ià(
	`­Ş_qu”y_g‘_ty³
(
p
, 
r
->
ty³
, &
¡¬t_ty³
) < 0) {

382 
ş—nup
;

384 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
av
); i++) {

385 
a_avruË
 = 
	`­Ş_veùÜ_g‘_–em’t
(
av
, 
i
);

386 ià(
	`qpŞ_avruË_g‘_sourû_ty³
(
p
->p, 
a_avruË
, &
a_sourû
) < 0 ||

387 
	`qpŞ_avruË_g‘_rg‘_ty³
(
p
->p, 
a_avruË
, &
a_rg‘
) < 0 ||

388 
	`qpŞ_avruË_g‘_objeù_şass
(
p
->p, 
a_avruË
, &
a_şass
) < 0) {

389 
ş—nup
;

391 
compv®
 = 
	`»Ïb–_ª®ysis_com·»_ty³_to_veùÜ
(
p
, 
subjeùs_v
, 
a_sourû
);

392 ià(
compv®
 < 0) {

393 
ş—nup
;

394 } ià(
compv®
 == 0) {

397 ià((
¡¬t_v
 = 
	`­Ş_qu”y_ex·nd_ty³
(
p
, 
a_sourû
)è=ğ
NULL
) {

398 
ş—nup
;

403 
j
 = 0; j < 
	`­Ş_veùÜ_g‘_size
(
bv
); j++) {

404 
b_avruË
 = 
	`­Ş_veùÜ_g‘_–em’t
(
bv
, 
j
);

405 ià(
	`qpŞ_avruË_g‘_sourû_ty³
(
p
->p, 
b_avruË
, &
b_sourû
) < 0 ||

406 
	`qpŞ_avruË_g‘_rg‘_ty³
(
p
->p, 
b_avruË
, &
b_rg‘
) < 0 ||

407 
	`qpŞ_avruË_g‘_objeù_şass
(
p
->p, 
b_avruË
, &
b_şass
) < 0) {

408 
ş—nup
;

410 ià(
	`»Ïb–_ª®ysis_com·»_ty³_to_veùÜ
(
p
, 
¡¬t_v
, 
b_sourû
) != 1 ||

411 
b_rg‘
 =ğ
¡¬t_ty³
 || 
a_şass
 !ğ
b_şass
) {

414 ià(
	`­³nd_avruËs_to_objeù_veùÜ
(
p
, 
r
, 
a_avruË
, 
b_avruË
, 
v
) < 0) {

415 
ş—nup
;

418 
	`­Ş_veùÜ_de¡roy
(&
¡¬t_v
);

421 
»tv®
 = 0;

422 
ş—nup
:

423 
	`­Ş_veùÜ_de¡roy
(&
¡¬t_v
);

424  
»tv®
;

425 
	}
}

441 
	$»Ïb–_ª®ysis_objeù
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
,

442 
­Ş_»Ïb–_ª®ysis_t
 * 
r
,

443 
­Ş_veùÜ_t
 * 
v
, 
dœeùiÚ
, cÚ¡‡pŞ_veùÜ_ˆ* 
subjeùs_v
)

445 
­Ş_avruË_qu”y_t
 *
a
 = 
NULL
, *
b
 = NULL;

446 
­Ş_veùÜ_t
 *
a_ruËs
 = 
NULL
, *
b_ruËs
 = NULL;

447 *
³rm1
, *
³rm2
;

448 
size_t
 
i
;

449 
»tv®
 = -1;

451 ià(
dœeùiÚ
 =ğ
APOL_RELABEL_DIR_TO
) {

452 
³rm1
 = 
PERM_RELABELFROM
;

453 
³rm2
 = 
PERM_RELABELTO
;

455 
³rm1
 = 
PERM_RELABELTO
;

456 
³rm2
 = 
PERM_RELABELFROM
;

459 ià((
a
 = 
	`­Ş_avruË_qu”y_ü—‹
()è=ğ
NULL
) {

460 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

461 
ş—nup
;

463 ià(
	`­Ş_avruË_qu”y_£t_ruËs
(
p
, 
a
, 
QPOL_RULE_ALLOW
) < 0 ||

464 
	`­Ş_avruË_qu”y_£t_rg‘
(
p
, 
a
, 
r
->
ty³
, 1è< 0 || 
	`­Ş_avruË_qu”y_­³nd_³rm
Õ,‡, 
³rm1
) < 0) {

465 
ş—nup
;

467 
i
 = 0; 
r
->
şas£s
 !ğ
NULL
 && i < 
	`­Ş_veùÜ_g‘_size
(r->classes); i++) {

468 ià(
	`­Ş_avruË_qu”y_­³nd_şass
(
p
, 
a
, 
	`­Ş_veùÜ_g‘_–em’t
(
r
->
şas£s
, 
i
)) < 0) {

469 
ş—nup
;

472 ià(
	`­Ş_avruË_g‘_by_qu”y
(
p
, 
a
, &
a_ruËs
) < 0) {

473 
ş—nup
;

476 ià((
b
 = 
	`­Ş_avruË_qu”y_ü—‹
()è=ğ
NULL
) {

477 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

478 
ş—nup
;

480 ià(
	`­Ş_avruË_qu”y_£t_ruËs
(
p
, 
b
, 
QPOL_RULE_ALLOW
è< 0 || 
	`­Ş_avruË_qu”y_­³nd_³rm
Õ, b, 
³rm2
) < 0) {

481 
ş—nup
;

483 
i
 = 0; 
r
->
şas£s
 !ğ
NULL
 && i < 
	`­Ş_veùÜ_g‘_size
(r->classes); i++) {

484 ià(
	`­Ş_avruË_qu”y_­³nd_şass
(
p
, 
b
, 
	`­Ş_veùÜ_g‘_–em’t
(
r
->
şas£s
, 
i
)) < 0) {

485 
ş—nup
;

488 ià(
	`­Ş_avruË_g‘_by_qu”y
(
p
, 
b
, &
b_ruËs
) < 0) {

489 
ş—nup
;

492 ià(
	`»Ïb–_ª®ysis_m©chup
(
p
, 
r
, 
a_ruËs
, 
b_ruËs
, 
subjeùs_v
, 
v
) < 0) {

493 
ş—nup
;

495 
»tv®
 = 0;

496 
ş—nup
:

497 
	`­Ş_avruË_qu”y_de¡roy
(&
a
);

498 
	`­Ş_veùÜ_de¡roy
(&
a_ruËs
);

499 
	`­Ş_avruË_qu”y_de¡roy
(&
b
);

500 
	`­Ş_veùÜ_de¡roy
(&
b_ruËs
);

501  
»tv®
;

502 
	}
}

517 
	$­³nd_avruË_to_subjeù_veùÜ
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
,

518 
­Ş_»Ïb–_ª®ysis_t
 * 
r
, cÚ¡ 
qpŞ_avruË_t
 * 
avruË
, 
­Ş_veùÜ_t
 * 
»suÉs
)

520 cÚ¡ 
qpŞ_ty³_t
 *
rg‘
;

521 
­Ş_veùÜ_t
 *
rg‘_v
 = 
NULL
, *
»suÉ_li¡
 = NULL;

522 
size_t
 
i
;

523 
­Ş_»Ïb–_»suÉ_t
 *
»suÉ
;

524 
­Ş_»Ïb–_»suÉ_·œ_t
 *
·œ
 = 
NULL
;

525 
»tv®
 = -1, 
dœ
, 
compv®
;

526 ià((
dœ
 = 
	`»Ïb–_ª®ysis_g‘_dœeùiÚ
(
p
, 
avruË
)) < 0) {

527 
ş—nup
;

529 ià(
	`qpŞ_avruË_g‘_rg‘_ty³
(
p
->p, 
avruË
, &
rg‘
è< 0 || (
rg‘_v
 = 
	`­Ş_qu”y_ex·nd_ty³
Õ,¬g‘)è=ğ
NULL
) {

530 
ş—nup
;

532 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
rg‘_v
); i++) {

533 
rg‘
 = (
qpŞ_ty³_t
 *è
	`­Ş_veùÜ_g‘_–em’t
(
rg‘_v
, 
i
);

534 
compv®
 = 
	`­Ş_com·»_ty³
(
p
, 
rg‘
, 
r
->
ty³
, 0, 
NULL
);

535 ià(
compv®
 < 0) {

536 
ş—nup
;

537 } ià(
compv®
 == 1) {

540 
compv®
 = 
	`­Ş_com·»_ty³
(
p
, 
rg‘
, 
r
->
»suÉ
, 
APOL_QUERY_REGEX
, &r->
»suÉ_»gex
);

541 ià(
compv®
 < 0) {

542 
ş—nup
;

543 } ià(
compv®
 == 0) {

546 ià((
»suÉ
 = 
	`»Ïb–_»suÉ_g‘_node
(
p
, 
»suÉs
, 
rg‘
)è=ğ
NULL
) {

547 
ş—nup
;

549 ià((
·œ
 = 
	`ÿÎoc
(1, (*·œ))è=ğ
NULL
) {

550 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

551 
ş—nup
;

553 
·œ
->
ruËA
 = 
avruË
;

554 
·œ
->
ruËB
 = 
NULL
;

555 
·œ
->
š‹rmed
 = 
NULL
;

556 
dœ
) {

557 
APOL_RELABEL_DIR_TO
:

558 
»suÉ_li¡
 = 
»suÉ
->
to
;

560 
APOL_RELABEL_DIR_FROM
:

561 
»suÉ_li¡
 = 
»suÉ
->
äom
;

563 
APOL_RELABEL_DIR_BOTH
:

564 
»suÉ_li¡
 = 
»suÉ
->
bÙh
;

567 ià((
	`­Ş_veùÜ_­³nd
(
»suÉ_li¡
, 
·œ
)) < 0) {

568 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

569 
ş—nup
;

571 
·œ
 = 
NULL
;

573 
»tv®
 = 0;

574 
ş—nup
:

575 
	`­Ş_veùÜ_de¡roy
(&
rg‘_v
);

576 
	`ä“
(
·œ
);

577  
»tv®
;

578 
	}
}

592 
	$»Ïb–_ª®ysis_subjeù
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_»Ïb–_ª®ysis_t
 * 
r
, 
­Ş_veùÜ_t
 * 
v
)

594 
­Ş_avruË_qu”y_t
 *
a
 = 
NULL
;

595 
­Ş_veùÜ_t
 *
avruËs_v
 = 
NULL
;

596 cÚ¡ 
qpŞ_avruË_t
 *
avruË
;

597 
size_t
 
i
;

598 
»tv®
 = -1;

600 ià((
a
 = 
	`­Ş_avruË_qu”y_ü—‹
()è=ğ
NULL
) {

601 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

602 
ş—nup
;

604 ià(
	`­Ş_avruË_qu”y_£t_ruËs
(
p
, 
a
, 
QPOL_RULE_ALLOW
) < 0 ||

605 
	`­Ş_avruË_qu”y_£t_sourû
(
p
, 
a
, 
r
->
ty³
, 1) < 0 ||

606 
	`­Ş_avruË_qu”y_­³nd_³rm
(
p
, 
a
, 
PERM_RELABELTO
è< 0 ||‡pŞ_avruË_qu”y_­³nd_³rmÕ,‡, 
PERM_RELABELFROM
) < 0) {

607 
ş—nup
;

609 
i
 = 0; 
r
->
şas£s
 !ğ
NULL
 && i < 
	`­Ş_veùÜ_g‘_size
(r->classes); i++) {

610 ià(
	`­Ş_avruË_qu”y_­³nd_şass
(
p
, 
a
, 
	`­Ş_veùÜ_g‘_–em’t
(
r
->
şas£s
, 
i
)) < 0) {

611 
ş—nup
;

614 ià(
	`­Ş_avruË_g‘_by_qu”y
(
p
, 
a
, &
avruËs_v
) < 0) {

615 
ş—nup
;

618 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
avruËs_v
); i++) {

619 
avruË
 = (
qpŞ_avruË_t
 *è
	`­Ş_veùÜ_g‘_–em’t
(
avruËs_v
, 
i
);

620 ià(
	`­³nd_avruË_to_subjeù_veùÜ
(
p
, 
r
, 
avruË
, 
v
) < 0) {

621 
ş—nup
;

625 
»tv®
 = 0;

626 
ş—nup
:

627 
	`­Ş_avruË_qu”y_de¡roy
(&
a
);

628 
	`­Ş_veùÜ_de¡roy
(&
avruËs_v
);

629  
»tv®
;

630 
	}
}

634 
	$­Ş_»Ïb–_ª®ysis_do
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_»Ïb–_ª®ysis_t
 * 
r
, 
­Ş_veùÜ_t
 ** 
v
)

636 
­Ş_veùÜ_t
 *
subjeùs_v
 = 
NULL
;

637 cÚ¡ 
qpŞ_ty³_t
 *
¡¬t_ty³
;

638 
»tv®
 = -1;

639 *
v
 = 
NULL
;

641 ià(
r
->
mode
 =ğ0 ||„->
ty³
 =ğ
NULL
) {

642 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
EINVAL
));

643 
ş—nup
;

645 ià(
	`­Ş_qu”y_g‘_ty³
(
p
, 
r
->
ty³
, &
¡¬t_ty³
) < 0) {

646 
ş—nup
;

649 ià((*
v
 = 
	`­Ş_veùÜ_ü—‹
(
»Ïb–_»suÉ_ä“
)è=ğ
NULL
) {

650 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

651 
ş—nup
;

654 ià(
r
->
mode
 =ğ
APOL_RELABEL_MODE_OBJ
) {

655 ià(
r
->
subjeùs
 !ğ
NULL
 && (
subjeùs_v
 = 
	`»Ïb–_ª®ysis_g‘_ty³_veùÜ
(
p
,„->subjects)) == NULL) {

656 
ş—nup
;

658 ià((
r
->
dœeùiÚ
 & 
APOL_RELABEL_DIR_TO
è&& 
	`»Ïb–_ª®ysis_objeù
(
p
,„, *
v
, APOL_RELABEL_DIR_TO, 
subjeùs_v
) < 0) {

659 
ş—nup
;

661 ià((
r
->
dœeùiÚ
 & 
APOL_RELABEL_DIR_FROM
) &&

662 
	`»Ïb–_ª®ysis_objeù
(
p
, 
r
, *
v
, 
APOL_RELABEL_DIR_FROM
, 
subjeùs_v
) < 0) {

663 
ş—nup
;

666 ià(
	`»Ïb–_ª®ysis_subjeù
(
p
, 
r
, *
v
) < 0) {

667 
ş—nup
;

671 
»tv®
 = 0;

672 
ş—nup
:

673 
	`­Ş_veùÜ_de¡roy
(&
subjeùs_v
);

674 ià(
»tv®
 != 0) {

675 
	`­Ş_veùÜ_de¡roy
(
v
);

677  
»tv®
;

678 
	}
}

680 
­Ş_»Ïb–_ª®ysis_t
 *
	$­Ş_»Ïb–_ª®ysis_ü—‹
()

682  
	`ÿÎoc
(1, (
­Ş_»Ïb–_ª®ysis_t
));

683 
	}
}

685 
	$­Ş_»Ïb–_ª®ysis_de¡roy
(
­Ş_»Ïb–_ª®ysis_t
 ** 
r
)

687 ià(
r
 !ğ
NULL
 && *r != NULL) {

688 
	`ä“
((*
r
)->
ty³
);

689 
	`ä“
((*
r
)->
»suÉ
);

690 
	`­Ş_veùÜ_de¡roy
(&(*
r
)->
şas£s
);

691 
	`­Ş_veùÜ_de¡roy
(&(*
r
)->
subjeùs
);

692 
	`­Ş_»gex_de¡roy
(&(*
r
)->
»suÉ_»gex
);

693 
	`ä“
(*
r
);

694 *
r
 = 
NULL
;

696 
	}
}

698 
	$­Ş_»Ïb–_ª®ysis_£t_dœ
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_»Ïb–_ª®ysis_t
 * 
r
, 
dœ
)

700 ià(
p
 =ğ
NULL
 || 
r
 == NULL) {

701 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
EINVAL
));

705 
dœ
) {

706 
APOL_RELABEL_DIR_BOTH
:

707 
APOL_RELABEL_DIR_TO
:

708 
APOL_RELABEL_DIR_FROM
:

710 
r
->
mode
 = 
APOL_RELABEL_MODE_OBJ
;

711 
r
->
dœeùiÚ
 = 
dœ
;

714 
APOL_RELABEL_DIR_SUBJECT
:

716 
r
->
mode
 = 
APOL_RELABEL_MODE_SUBJ
;

717 
r
->
dœeùiÚ
 = 
APOL_RELABEL_DIR_BOTH
;

722 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
EINVAL
));

727 
	}
}

729 
	$­Ş_»Ïb–_ª®ysis_£t_ty³
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_»Ïb–_ª®ysis_t
 * 
r
, cÚ¡ *
Çme
)

731 ià(
p
 =ğ
NULL
 || 
r
 =ğNULL || 
Çme
 == NULL) {

732 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
EINVAL
));

735  
	`­Ş_qu”y_£t
(
p
, &
r
->
ty³
, 
NULL
, 
Çme
);

736 
	}
}

738 
	$­Ş_»Ïb–_ª®ysis_­³nd_şass
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_»Ïb–_ª®ysis_t
 * 
r
, cÚ¡ *
obj_şass
)

740 *
s
;

741 ià(
p
 =ğ
NULL
 || 
r
 == NULL) {

742 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
EINVAL
));

745 ià(
obj_şass
 =ğ
NULL
) {

746 
	`­Ş_veùÜ_de¡roy
(&
r
->
şas£s
);

747 } ià((
s
 = 
	`¡rdup
(
obj_şass
)è=ğ
NULL
 || (
r
->
şas£s
 =ğNULL && (r->şas£ ğ
	`­Ş_veùÜ_ü—‹
(
ä“
)) == NULL)

748 || 
	`­Ş_veùÜ_­³nd
(
r
->
şas£s
, 
s
) < 0) {

749 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

753 
	}
}

755 
	$­Ş_»Ïb–_ª®ysis_­³nd_subjeù
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_»Ïb–_ª®ysis_t
 * 
r
, cÚ¡ *
subjeù
)

757 *
s
;

758 ià(
p
 =ğ
NULL
 || 
r
 == NULL) {

759 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
EINVAL
));

762 ià(
subjeù
 =ğ
NULL
) {

763 
	`­Ş_veùÜ_de¡roy
(&
r
->
subjeùs
);

764 } ià((
s
 = 
	`¡rdup
(
subjeù
)è=ğ
NULL
 ||

765 (
r
->
subjeùs
 =ğ
NULL
 && (r->subjeù ğ
	`­Ş_veùÜ_ü—‹
(
ä“
)) == NULL) ||

766 
	`­Ş_veùÜ_­³nd
(
r
->
subjeùs
, 
s
) < 0) {

767 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

771 
	}
}

773 
	$­Ş_»Ïb–_ª®ysis_£t_»suÉ_»gex
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_»Ïb–_ª®ysis_t
 * 
r
, cÚ¡ *
»suÉ
)

775  
	`­Ş_qu”y_£t
(
p
, &
r
->
»suÉ
, &r->
»suÉ_»gex
,„esult);

776 
	}
}

780 cÚ¡ 
­Ş_veùÜ_t
 *
	$­Ş_»Ïb–_»suÉ_g‘_to
(cÚ¡ 
­Ş_»Ïb–_»suÉ_t
 * 
r
)

782  
r
->
to
;

783 
	}
}

785 cÚ¡ 
­Ş_veùÜ_t
 *
	$­Ş_»Ïb–_»suÉ_g‘_äom
(cÚ¡ 
­Ş_»Ïb–_»suÉ_t
 * 
r
)

787  
r
->
äom
;

788 
	}
}

790 cÚ¡ 
­Ş_veùÜ_t
 *
	$­Ş_»Ïb–_»suÉ_g‘_bÙh
(cÚ¡ 
­Ş_»Ïb–_»suÉ_t
 * 
r
)

792  
r
->
bÙh
;

793 
	}
}

795 cÚ¡ 
qpŞ_ty³_t
 *
	$­Ş_»Ïb–_»suÉ_g‘_»suÉ_ty³
(cÚ¡ 
­Ş_»Ïb–_»suÉ_t
 * 
r
)

797  
r
->
ty³
;

798 
	}
}

800 cÚ¡ 
qpŞ_avruË_t
 *
	$­Ş_»Ïb–_»suÉ_·œ_g‘_ruËA
(cÚ¡ 
­Ş_»Ïb–_»suÉ_·œ_t
 * 
p
)

802  
p
->
ruËA
;

803 
	}
}

805 cÚ¡ 
qpŞ_avruË_t
 *
	$­Ş_»Ïb–_»suÉ_·œ_g‘_ruËB
(cÚ¡ 
­Ş_»Ïb–_»suÉ_·œ_t
 * 
p
)

807  
p
->
ruËB
;

808 
	}
}

810 cÚ¡ 
qpŞ_ty³_t
 *
	$­Ş_»Ïb–_»suÉ_·œ_g‘_š‹rmedŸ‹_ty³
(cÚ¡ 
­Ş_»Ïb–_»suÉ_·œ_t
 * 
p
)

812  
p
->
š‹rmed
;

813 
	}
}

	@libapol/src/render.c

27 
	~<cÚfig.h
>

29 
	~<­Ş/cÚ‹xt-qu”y.h
>

30 
	~<­Ş/pŞicy.h
>

31 
	~<­Ş/»nd”.h
>

33 
	~<”ºo.h
>

34 
	~<¡dio.h
>

35 
	~<¡ršg.h
>

37 #iâdeà
WORDS_BIGENDIAN


38 
swab
(cÚ¡ *
äom
, *
to
, 
ssize_t
 
n
);

41 #ià
LINK_SHARED
 == 1

42 
__asm__
(".symver‡pol_ipv4_addr_render_old,apol_ipv4_addr_render@");

43 
__asm__
(".symver‡pol_ipv4_addr_render_new,apol_ipv4_addr_render@@VERS_4.1");

52 *
	$­Ş_v4_addr_»nd”_Ãw
(cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicydb
, 
ušt32_t
 
addr
[4])

54 
buf
[40], *
b
;

55 *
p
 = (*)&(
addr
[0]);

56 
	`¢´štf
(
buf
, (buf), "%d.%d.%d.%d", 
p
[0],…[1],…[2],…[3]);

57 ià((
b
 = 
	`¡rdup
(
buf
)è=ğ
NULL
) {

58 
	`ERR
(
pŞicydb
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

60  
b
;

61 
	}
}

63 #ià
LINK_SHARED
 == 0

64 *
	$­Ş_v4_addr_»nd”
(cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicydb
, 
ušt32_t
 
addr
[4])

66  
	`­Ş_v4_addr_»nd”_Ãw
(
pŞicydb
, 
addr
);

67 
	}
}

75 *
	$­Ş_v4_addr_»nd”_Şd
(
­Ş_pŞicy_t
 * 
pŞicydb
, 
ušt32_t
 
addr
)

77 
buf
[40], *
b
;

78 *
p
 = (*)&
addr
;

79 
	`¢´štf
(
buf
, (buf), "%d.%d.%d.%d", 
p
[0],…[1],…[2],…[3]);

80 ià((
b
 = 
	`¡rdup
(
buf
)è=ğ
NULL
) {

81 
	`ERR
(
pŞicydb
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

83  
b
;

84 
	}
}

86 *
	$­Ş_v6_addr_»nd”
(cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicydb
, 
ušt32_t
 
addr
[4])

88 
ušt16_t
 
tmp
[8] = { 0, 0, 0, 0, 0, 0, 0, 0 };

89 
i
, 
sz
 = 0, 
»tv
;

90 
buf
[40], *
b
;

91 
cÚŒaù
 = 0, 
´ev_cÚŒ
 = 0, 
cÚŒ_idx_’d
 = -1;

92 
i
 = 0; i < 4; i++) {

93 
ušt32_t
 
a
;

94 #ifdeà
WORDS_BIGENDIAN


95 
a
 = 
addr
[
i
];

97 
	`swab
(
addr
 + 
i
, &
a
, (a));

101 
tmp
[2 * 
i
] = 
a
 % (1 << 16);

102 
tmp
[2 * 
i
 + 1] = 
a
 / (1 << 16);

105 
i
 = 0; i < 8; i++) {

106 ià(
tmp
[
i
] == 0) {

107 
cÚŒaù
++;

108 ià(
i
 =ğ7 && 
cÚŒ_idx_’d
 == -1)

109 
cÚŒ_idx_’d
 = 8;

111 ià(
cÚŒaù
 > 
´ev_cÚŒ
) {

112 
cÚŒ_idx_’d
 = 
i
;

114 
´ev_cÚŒ
 = 
cÚŒaù
;

115 
cÚŒaù
 = 0;

119 ià(
´ev_cÚŒ
 > 
cÚŒaù
)

120 
cÚŒaù
 = 
´ev_cÚŒ
;

122 
i
 = 0; i < 8; i++) {

123 ià(
i
 =ğ
cÚŒ_idx_’d
 - 
cÚŒaù
) {

124 
»tv
 = 
	`¢´štf
(
buf
 + 
sz
, 40 - sz, 
i
 ? ":" : "::");

125 
sz
 +ğ
»tv
;

126 } ià(
i
 > 
cÚŒ_idx_’d
 - 
cÚŒaù
 && i < contr_idx_end) {

129 
»tv
 = 
	`¢´štf
(
buf
 + 
sz
, 40 - sz, 
i
 =ğ7 ? "%04x" : "%04x:", 
tmp
[i]);

130 
sz
 +ğ
»tv
;

134 
buf
[
sz
] = '\0';

135 ià((
b
 = 
	`¡rdup
(
buf
)è=ğ
NULL
) {

136 
	`ERR
(
pŞicydb
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

138  
b
;

139 
	}
}

141 *
	$­Ş_qpŞ_cÚ‹xt_»nd”
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
qpŞ_cÚ‹xt_t
 * 
cÚ‹xt
)

143 
­Ş_cÚ‹xt_t
 *
c
 = 
NULL
;

144 *
»nd”ed_cÚ‹xt
;

146 ià(
p
 =ğ
NULL
 || 
cÚ‹xt
 == NULL) {

147 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
EINVAL
));

148 
”ºo
 = 
EINVAL
;

149  
NULL
;

152 ià((
c
 = 
	`­Ş_cÚ‹xt_ü—‹_äom_qpŞ_cÚ‹xt
(
p
, 
cÚ‹xt
)è=ğ
NULL
) {

153  
NULL
;

155 
»nd”ed_cÚ‹xt
 = 
	`­Ş_cÚ‹xt_»nd”
(
p
, 
c
);

156 
	`­Ş_cÚ‹xt_de¡roy
(&
c
);

157  
»nd”ed_cÚ‹xt
;

158 
	}
}

	@libapol/src/role-query.c

30 
	~"pŞicy-qu”y-š‹º®.h
"

32 
	~<”ºo.h
>

34 
	s­Ş_rŞe_qu”y


36 *
	mrŞe_Çme
, *
	mty³_Çme
;

37 
	mæags
;

38 
»gex_t
 *
	mrŞe_»gex
, *
	mty³_»gex
;

43 
	$­Ş_rŞe_g‘_by_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_rŞe_qu”y_t
 * 
r
, 
­Ş_veùÜ_t
 ** 
v
)

45 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
, *
ty³_™”
 = NULL;

46 
»tv®
 = -1, 
­³nd_rŞe
;

47 *
v
 = 
NULL
;

48 ià(
	`qpŞ_pŞicy_g‘_rŞe_™”
(
p
->p, &
™”
) < 0) {

51 ià((*
v
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)) == NULL) {

52 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

53 
ş—nup
;

55 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

56 
qpŞ_rŞe_t
 *
rŞe
;

57 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
rŞe
) < 0) {

58 
ş—nup
;

60 
­³nd_rŞe
 = 1;

61 ià(
r
 !ğ
NULL
) {

62 cÚ¡ *
rŞe_Çme
;

63 
compv®
;

64 ià(
	`qpŞ_rŞe_g‘_Çme
(
p
->p, 
rŞe
, &
rŞe_Çme
) < 0) {

65 
ş—nup
;

67 
compv®
 = 
	`­Ş_com·»
(
p
, 
rŞe_Çme
, 
r
->rŞe_Çme,„->
æags
, &Ô->
rŞe_»gex
));

68 ià(
compv®
 < 0) {

69 
ş—nup
;

70 } ià(
compv®
 == 0) {

73 ià(
r
->
ty³_Çme
 =ğ
NULL
 ||„->type_name[0] == '\0') {

74 
’d_of_qu”y
;

76 ià(
	`qpŞ_rŞe_g‘_ty³_™”
(
p
->p, 
rŞe
, &
ty³_™”
) < 0) {

77 
ş—nup
;

79 
­³nd_rŞe
 = 0;

80 ; !
	`qpŞ_™”©Ü_’d
(
ty³_™”
); 
	`qpŞ_™”©Ü_Ãxt
(type_iter)) {

81 
qpŞ_ty³_t
 *
ty³
;

82 ià(
	`qpŞ_™”©Ü_g‘_™em
(
ty³_™”
, (**)&
ty³
) < 0) {

83 
ş—nup
;

85 
compv®
 = 
	`­Ş_com·»_ty³
(
p
, 
ty³
, 
r
->
ty³_Çme
,„->
æags
, &Ô->
ty³_»gex
));

86 ià(
compv®
 < 0) {

87 
ş—nup
;

88 } ià(
compv®
 == 1) {

89 
­³nd_rŞe
 = 1;

93 
	`qpŞ_™”©Ü_de¡roy
(&
ty³_™”
);

95 
’d_of_qu”y
:

96 ià(
­³nd_rŞe
 && 
	`­Ş_veùÜ_­³nd
(*
v
, 
rŞe
)) {

97 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

98 
ş—nup
;

102 
»tv®
 = 0;

103 
ş—nup
:

104 ià(
»tv®
 != 0) {

105 
	`­Ş_veùÜ_de¡roy
(
v
);

107 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

108 
	`qpŞ_™”©Ü_de¡roy
(&
ty³_™”
);

109  
»tv®
;

110 
	}
}

112 
­Ş_rŞe_qu”y_t
 *
	$­Ş_rŞe_qu”y_ü—‹
()

114  
	`ÿÎoc
(1, (
­Ş_rŞe_qu”y_t
));

115 
	}
}

117 
	$­Ş_rŞe_qu”y_de¡roy
(
­Ş_rŞe_qu”y_t
 ** 
r
)

119 ià(*
r
 !ğ
NULL
) {

120 
	`ä“
((*
r
)->
rŞe_Çme
);

121 
	`ä“
((*
r
)->
ty³_Çme
);

122 
	`­Ş_»gex_de¡roy
(&(*
r
)->
rŞe_»gex
);

123 
	`­Ş_»gex_de¡roy
(&(*
r
)->
ty³_»gex
);

124 
	`ä“
(*
r
);

125 *
r
 = 
NULL
;

127 
	}
}

129 
	$­Ş_rŞe_qu”y_£t_rŞe
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_rŞe_qu”y_t
 * 
r
, cÚ¡ *
Çme
)

131  
	`­Ş_qu”y_£t
(
p
, &
r
->
rŞe_Çme
, &r->
rŞe_»gex
, 
Çme
);

132 
	}
}

134 
	$­Ş_rŞe_qu”y_£t_ty³
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_rŞe_qu”y_t
 * 
r
, cÚ¡ *
Çme
)

136  
	`­Ş_qu”y_£t
(
p
, &
r
->
ty³_Çme
, &r->
ty³_»gex
, 
Çme
);

137 
	}
}

139 
	$­Ş_rŞe_qu”y_£t_»gex
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_rŞe_qu”y_t
 * 
r
, 
is_»gex
)

141  
	`­Ş_qu”y_£t_»gex
(
p
, &
r
->
æags
, 
is_»gex
);

142 
	}
}

144 
	$­Ş_rŞe_has_ty³
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
qpŞ_rŞe_t
 * 
r
, cÚ¡ 
qpŞ_ty³_t
 * 
t
)

146 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

147 
qpŞ_ty³_t
 *
tmp_ty³
;

148 
ušt32_t
 
ty³_v®ue
, 
t_ty³_v®ue
;

149 
»tv®
 = -1;

151 ià(
	`qpŞ_ty³_g‘_v®ue
(
p
->p, 
t
, &
t_ty³_v®ue
è< 0 || 
	`qpŞ_rŞe_g‘_ty³_™”
Õ->p, 
r
, &
™”
) < 0) {

152 
ş—nup
;

155 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

156 
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)(&
tmp_ty³
));

157 
	`qpŞ_ty³_g‘_v®ue
(
p
->p, 
tmp_ty³
, &
ty³_v®ue
);

158 ià(
t_ty³_v®ue
 =ğ
ty³_v®ue
) {

159 
»tv®
 = 1;

160 
ş—nup
;

163 
»tv®
 = 0;

164 
ş—nup
:

165 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

166  
»tv®
;

167 
	}
}

	@libapol/src/terule-query.c

30 
	~"pŞicy-qu”y-š‹º®.h
"

31 
	~<­Ş/b¡.h
>

32 
	~<qpŞ/pŞicy_ex‹nd.h
>

33 
	~<”ºo.h
>

34 
	~<¡ršg.h
>

36 
	s­Ş_‹ruË_qu”y


38 *
	msourû
, *
	mrg‘
, *
	mdeçuÉ_ty³
, *
	mboŞ_Çme
;

39 
­Ş_veùÜ_t
 *
	mşas£s
;

40 
	mruËs
;

41 
	mæags
;

62 
	$ruË_£Ëù
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_veùÜ_t
 * 
v
, 
ušt32_t
 
ruË_ty³
, 
æags
,

63 cÚ¡ 
­Ş_veùÜ_t
 * 
sourû_li¡
, cÚ¡‡pŞ_veùÜ_ˆ* 
rg‘_li¡
, cÚ¡‡pŞ_veùÜ_ˆ* 
şass_li¡
,

64 cÚ¡ 
­Ş_veùÜ_t
 * 
deçuÉ_li¡
, cÚ¡ *
boŞ_Çme
)

66 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

67 
Úly_’abËd
 = 
æags
 & 
APOL_QUERY_ONLY_ENABLED
;

68 
is_»gex
 = 
æags
 & 
APOL_QUERY_REGEX
;

69 
sourû_as_ªy
 = 
æags
 & 
APOL_QUERY_SOURCE_AS_ANY
;

70 
»tv
 = -1;

71 
»gex_t
 *
boŞ_»gex
 = 
NULL
;

73 ià(
	`qpŞ_pŞicy_g‘_‹ruË_™”
(
p
->p, 
ruË_ty³
, &
™”
) < 0) {

74 
ş—nup
;

77 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

78 
qpŞ_‹ruË_t
 *
ruË
;

79 
ušt32_t
 
is_’abËd
;

80 cÚ¡ 
qpŞ_cÚd_t
 *
cÚd
 = 
NULL
;

81 
m©ch_sourû
 = 0, 
m©ch_rg‘
 = 0, 
m©ch_deçuÉ
 = 0, 
m©ch_boŞ
 = 0;

82 
size_t
 
i
;

83 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
ruË
) < 0) {

84 
ş—nup
;

87 ià(
	`qpŞ_‹ruË_g‘_is_’abËd
(
p
->p, 
ruË
, &
is_’abËd
) < 0) {

88 
ş—nup
;

90 ià(!
is_’abËd
 && 
Úly_’abËd
) {

94 ià(
boŞ_Çme
 !ğ
NULL
) {

95 ià(
	`qpŞ_‹ruË_g‘_cÚd
(
p
->p, 
ruË
, &
cÚd
) < 0) {

96 
ş—nup
;

98 ià(
cÚd
 =ğ
NULL
) {

101 
m©ch_boŞ
 = 
	`­Ş_com·»_cÚd_ex´
(
p
, 
cÚd
, 
boŞ_Çme
, 
is_»gex
, &
boŞ_»gex
);

102 ià(
m©ch_boŞ
 < 0) {

103 
ş—nup
;

104 } ià(
m©ch_boŞ
 == 0) {

109 ià(
sourû_li¡
 =ğ
NULL
) {

110 
m©ch_sourû
 = 1;

112 cÚ¡ 
qpŞ_ty³_t
 *
sourû_ty³
;

113 ià(
	`qpŞ_‹ruË_g‘_sourû_ty³
(
p
->p, 
ruË
, &
sourû_ty³
) < 0) {

114 
ş—nup
;

116 ià(
	`­Ş_veùÜ_g‘_šdex
(
sourû_li¡
, 
sourû_ty³
, 
NULL
, NULL, &
i
) == 0) {

117 
m©ch_sourû
 = 1;

124 ià(!
sourû_as_ªy
 && !
m©ch_sourû
) {

128 ià(
rg‘_li¡
 =ğ
NULL
 || (
sourû_as_ªy
 && 
m©ch_sourû
)) {

129 
m©ch_rg‘
 = 1;

131 cÚ¡ 
qpŞ_ty³_t
 *
rg‘_ty³
;

132 ià(
	`qpŞ_‹ruË_g‘_rg‘_ty³
(
p
->p, 
ruË
, &
rg‘_ty³
) < 0) {

133 
ş—nup
;

135 ià(
	`­Ş_veùÜ_g‘_šdex
(
rg‘_li¡
, 
rg‘_ty³
, 
NULL
, NULL, &
i
) == 0) {

136 
m©ch_rg‘
 = 1;

140 ià(!
sourû_as_ªy
 && !
m©ch_rg‘
) {

144 ià(
deçuÉ_li¡
 =ğ
NULL
 || (
sourû_as_ªy
 && 
m©ch_sourû
è|| (sourû_as_ªy && 
m©ch_rg‘
)) {

145 
m©ch_deçuÉ
 = 1;

147 cÚ¡ 
qpŞ_ty³_t
 *
deçuÉ_ty³
;

148 ià(
	`qpŞ_‹ruË_g‘_deçuÉ_ty³
(
p
->p, 
ruË
, &
deçuÉ_ty³
) < 0) {

149 
ş—nup
;

151 ià(
	`­Ş_veùÜ_g‘_šdex
(
deçuÉ_li¡
, 
deçuÉ_ty³
, 
NULL
, NULL, &
i
) == 0) {

152 
m©ch_deçuÉ
 = 1;

156 ià(!
sourû_as_ªy
 && !
m©ch_deçuÉ
) {

160 ià(
sourû_as_ªy
 && (!
m©ch_sourû
 && !
m©ch_rg‘
 && !
m©ch_deçuÉ
)) {

164 ià(
şass_li¡
 !ğ
NULL
) {

165 cÚ¡ 
qpŞ_şass_t
 *
obj_şass
;

166 ià(
	`qpŞ_‹ruË_g‘_objeù_şass
(
p
->p, 
ruË
, &
obj_şass
) < 0) {

167 
ş—nup
;

169 ià(
	`­Ş_veùÜ_g‘_šdex
(
şass_li¡
, 
obj_şass
, 
NULL
, NULL, &
i
) < 0) {

174 ià(
	`­Ş_veùÜ_­³nd
(
v
, 
ruË
)) {

175 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

176 
ş—nup
;

180 
»tv
 = 0;

182 
ş—nup
:

183 
	`­Ş_»gex_de¡roy
(&
boŞ_»gex
);

184 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

185  
»tv
;

186 
	}
}

188 
	$­Ş_‹ruË_g‘_by_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
­Ş_‹ruË_qu”y_t
 * 
t
, 
­Ş_veùÜ_t
 ** 
v
)

190 
­Ş_veùÜ_t
 *
sourû_li¡
 = 
NULL
, *
rg‘_li¡
 = NULL, *
şass_li¡
 = NULL, *
deçuÉ_li¡
 = NULL;

191 
»tv®
 = -1, 
sourû_as_ªy
 = 0, 
is_»gex
 = 0;

192 *
boŞ_Çme
 = 
NULL
;

193 *
v
 = 
NULL
;

194 
æags
 = 0;

196 
ušt32_t
 
ruË_ty³
 = 
QPOL_RULE_TYPE_TRANS
 | 
QPOL_RULE_TYPE_MEMBER
 | 
QPOL_RULE_TYPE_CHANGE
;

197 ià(
t
 !ğ
NULL
) {

198 ià(
t
->
ruËs
 != 0) {

199 
ruË_ty³
 &ğ
t
->
ruËs
;

201 
æags
 = 
t
->flags;

202 
is_»gex
 = 
t
->
æags
 & 
APOL_QUERY_REGEX
;

203 
boŞ_Çme
 = 
t
->bool_name;

204 ià(
t
->
sourû
 !ğ
NULL
 &&

205 (
sourû_li¡
 =

206 
	`­Ş_qu”y_ü—‹_ÿndid©e_ty³_li¡
(
p
, 
t
->
sourû
, 
is_»gex
,

207 
t
->
æags
 & 
APOL_QUERY_SOURCE_INDIRECT
,

208 ((
t
->
æags
 & (
APOL_QUERY_SOURCE_TYPE
 | 
APOL_QUERY_SOURCE_ATTRIBUTE
)) /

209 
APOL_QUERY_SOURCE_TYPE
))è=ğ
NULL
) {

210 
ş—nup
;

212 ià((
t
->
æags
 & 
APOL_QUERY_SOURCE_AS_ANY
è&&->
sourû
 !ğ
NULL
) {

213 
deçuÉ_li¡
 = 
rg‘_li¡
 = 
sourû_li¡
;

214 
sourû_as_ªy
 = 1;

216 ià(
t
->
rg‘
 !ğ
NULL
 &&

217 (
rg‘_li¡
 =

218 
	`­Ş_qu”y_ü—‹_ÿndid©e_ty³_li¡
(
p
, 
t
->
rg‘
, 
is_»gex
,

219 
t
->
æags
 & 
APOL_QUERY_TARGET_INDIRECT
,

220 ((
t
->

221 
æags
 & (
APOL_QUERY_TARGET_TYPE
 | 
APOL_QUERY_TARGET_ATTRIBUTE
))

222 / 
APOL_QUERY_TARGET_TYPE
))è=ğ
NULL
) {

223 
ş—nup
;

225 ià(
t
->
deçuÉ_ty³
 !ğ
NULL
 &&

226 (
deçuÉ_li¡
 =

227 
	`­Ş_qu”y_ü—‹_ÿndid©e_ty³_li¡
(
p
, 
t
->
deçuÉ_ty³
, 
is_»gex
, 0,

228 
APOL_QUERY_SYMBOL_IS_TYPE
)è=ğ
NULL
) {

229 
ş—nup
;

232 ià(
t
->
şas£s
 !ğ
NULL
 &&

233 
	`­Ş_veùÜ_g‘_size
(
t
->
şas£s
) > 0 &&

234 (
şass_li¡
 = 
	`­Ş_qu”y_ü—‹_ÿndid©e_şass_li¡
(
p
, 
t
->
şas£s
)è=ğ
NULL
) {

235 
ş—nup
;

239 ià((*
v
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)) == NULL) {

240 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

241 
ş—nup
;

244 ià(
	`ruË_£Ëù
(
p
, *
v
, 
ruË_ty³
, 
æags
, 
sourû_li¡
, 
rg‘_li¡
, 
şass_li¡
, 
deçuÉ_li¡
, 
boŞ_Çme
)) {

245 
ş—nup
;

248 
»tv®
 = 0;

249 
ş—nup
:

250 ià(
»tv®
 != 0) {

251 
	`­Ş_veùÜ_de¡roy
(
v
);

253 
	`­Ş_veùÜ_de¡roy
(&
sourû_li¡
);

254 ià(!
sourû_as_ªy
) {

255 
	`­Ş_veùÜ_de¡roy
(&
rg‘_li¡
);

256 
	`­Ş_veùÜ_de¡roy
(&
deçuÉ_li¡
);

258 
	`­Ş_veùÜ_de¡roy
(&
şass_li¡
);

259  
»tv®
;

260 
	}
}

262 
	$­Ş_syn_‹ruË_g‘_by_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
­Ş_‹ruË_qu”y_t
 * 
t
, 
­Ş_veùÜ_t
 ** 
v
)

264 
­Ş_veùÜ_t
 *
sourû_li¡
 = 
NULL
, *
rg‘_li¡
 = NULL, *
şass_li¡
 = NULL, *
deçuÉ_li¡
 = NULL, *
syn_v
 = NULL;

265 
»tv®
 = -1, 
sourû_as_ªy
 = 0, 
is_»gex
 = 0;

266 *
boŞ_Çme
 = 
NULL
;

267 *
v
 = 
NULL
;

268 
size_t
 
i
;

269 
æags
 = 0;

271 ià(!
p
 || !
	`qpŞ_pŞicy_has_ÿ·b™y
(
	`­Ş_pŞicy_g‘_qpŞ
Õ), 
QPOL_CAP_SYN_RULES
)) {

272 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
EINVAL
));

273 
ş—nup
;

276 
ušt32_t
 
ruË_ty³
 = 
QPOL_RULE_TYPE_TRANS
 | 
QPOL_RULE_TYPE_MEMBER
 | 
QPOL_RULE_TYPE_CHANGE
;

277 ià(
t
 !ğ
NULL
) {

278 ià(
t
->
ruËs
 != 0) {

279 
ruË_ty³
 &ğ
t
->
ruËs
;

281 
æags
 = 
t
->flags;

282 
is_»gex
 = 
t
->
æags
 & 
APOL_QUERY_REGEX
;

283 
boŞ_Çme
 = 
t
->bool_name;

284 ià(
t
->
sourû
 !ğ
NULL
 &&

285 (
sourû_li¡
 =

286 
	`­Ş_qu”y_ü—‹_ÿndid©e_syn_ty³_li¡
(
p
, 
t
->
sourû
, 
is_»gex
,

287 
t
->
æags
 & 
APOL_QUERY_SOURCE_INDIRECT
,

288 ((
t
->
æags
 & (
APOL_QUERY_SOURCE_TYPE
 |

289 
APOL_QUERY_SOURCE_ATTRIBUTE
)) /

290 
APOL_QUERY_SOURCE_TYPE
))è=ğ
NULL
) {

291 
ş—nup
;

293 ià((
t
->
æags
 & 
APOL_QUERY_SOURCE_AS_ANY
è&&->
sourû
 !ğ
NULL
) {

294 
deçuÉ_li¡
 = 
rg‘_li¡
 = 
sourû_li¡
;

295 
sourû_as_ªy
 = 1;

297 ià(
t
->
rg‘
 !ğ
NULL
 &&

298 (
rg‘_li¡
 =

299 
	`­Ş_qu”y_ü—‹_ÿndid©e_syn_ty³_li¡
(
p
, 
t
->
rg‘
, 
is_»gex
,

300 
t
->
æags
 & 
APOL_QUERY_TARGET_INDIRECT
,

301 ((
t
->
æags
 & (
APOL_QUERY_TARGET_TYPE
 |

302 
APOL_QUERY_TARGET_ATTRIBUTE
))

303 / 
APOL_QUERY_TARGET_TYPE
))è=ğ
NULL
) {

304 
ş—nup
;

306 ià(
t
->
deçuÉ_ty³
 !ğ
NULL
 &&

307 (
deçuÉ_li¡
 =

308 
	`­Ş_qu”y_ü—‹_ÿndid©e_ty³_li¡
(
p
, 
t
->
deçuÉ_ty³
, 
is_»gex
, 0,

309 
APOL_QUERY_SYMBOL_IS_TYPE
)è=ğ
NULL
) {

310 
ş—nup
;

313 ià(
t
->
şas£s
 !ğ
NULL
 &&

314 
	`­Ş_veùÜ_g‘_size
(
t
->
şas£s
) > 0 &&

315 (
şass_li¡
 = 
	`­Ş_qu”y_ü—‹_ÿndid©e_şass_li¡
(
p
, 
t
->
şas£s
)è=ğ
NULL
) {

316 
ş—nup
;

320 ià((*
v
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)) == NULL) {

321 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

322 
ş—nup
;

325 ià(
	`ruË_£Ëù
(
p
, *
v
, 
ruË_ty³
, 
æags
, 
sourû_li¡
, 
rg‘_li¡
, 
şass_li¡
, 
deçuÉ_li¡
, 
boŞ_Çme
)) {

326 
ş—nup
;

329 
syn_v
 = 
	`­Ş_‹ruË_li¡_to_syn_‹ruËs
(
p
, *
v
);

330 ià(!
syn_v
) {

331 
ş—nup
;

333 
	`­Ş_veùÜ_de¡roy
(
v
);

334 *
v
 = 
syn_v
;

335 
syn_v
 = 
NULL
;

338 ià((
t
->
æags
 & 
APOL_QUERY_SOURCE_INDIRECT
è&& (t->æag & (
APOL_QUERY_TARGET_INDIRECT
 | 
APOL_QUERY_SOURCE_AS_ANY
))) {

339 
»tv®
 = 0;

340 
ş—nup
;

343 ià(!
sourû_li¡
 && !
rg‘_li¡
 && !
deçuÉ_li¡
) {

344 
»tv®
 = 0;

345 
ş—nup
;

348 ià(
sourû_li¡
 && !(
t
->
æags
 & 
APOL_QUERY_SOURCE_INDIRECT
)) {

349 
	`­Ş_veùÜ_de¡roy
(&
sourû_li¡
);

350 
sourû_li¡
 =

351 
	`­Ş_qu”y_ü—‹_ÿndid©e_ty³_li¡
(
p
, 
t
->
sourû
, 
is_»gex
, 0,

352 ((
t
->
æags
 & (
APOL_QUERY_SOURCE_TYPE
 | 
APOL_QUERY_SOURCE_ATTRIBUTE
)) /

353 
APOL_QUERY_SOURCE_TYPE
));

354 ià(!
sourû_li¡
)

355 
ş—nup
;

357 ià(
rg‘_li¡
 && (
sourû_as_ªy
 || !(
t
->
æags
 & 
APOL_QUERY_TARGET_INDIRECT
))) {

358 ià(
sourû_as_ªy
) {

359 
rg‘_li¡
 = 
sourû_li¡
;

361 
	`­Ş_veùÜ_de¡roy
(&
rg‘_li¡
);

362 
rg‘_li¡
 =

363 
	`­Ş_qu”y_ü—‹_ÿndid©e_ty³_li¡
(
p
, 
t
->
rg‘
, 
is_»gex
, 0,

364 ((
t
->
æags
 & (
APOL_QUERY_SOURCE_TYPE
 |

365 
APOL_QUERY_SOURCE_ATTRIBUTE
)) /

366 
APOL_QUERY_SOURCE_TYPE
));

367 ià(!
rg‘_li¡
)

368 
ş—nup
;

371 ià(
sourû_as_ªy
) {

372 
deçuÉ_li¡
 = 
sourû_li¡
;

375 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(*
v
); i++) {

376 
qpŞ_syn_‹ruË_t
 *
¤uË
 = 
	`­Ş_veùÜ_g‘_–em’t
(*
v
, 
i
);

377 cÚ¡ 
qpŞ_ty³_£t_t
 *
¡y³s
 = 
NULL
, *
‰y³s
 = NULL;

378 cÚ¡ 
qpŞ_ty³_t
 *
dæt
 = 
NULL
;

379 
size_t
 
j
;

380 
u£s_sourû
 = 0, 
u£s_rg‘
 = 0, 
u£s_deçuÉ
 = 0;

381 
	`qpŞ_syn_‹ruË_g‘_sourû_ty³_£t
(
p
->p, 
¤uË
, &
¡y³s
);

382 
	`qpŞ_syn_‹ruË_g‘_rg‘_ty³_£t
(
p
->p, 
¤uË
, &
‰y³s
);

383 ià(
sourû_li¡
 && !(
t
->
æags
 & 
APOL_QUERY_SOURCE_INDIRECT
)) {

384 
u£s_sourû
 = 
	`­Ş_qu”y_ty³_£t_u£s_ty³s_dœeùly
(
p
, 
¡y³s
, 
sourû_li¡
);

385 ià(
u£s_sourû
 < 0)

386 
ş—nup
;

387 } ià(
sourû_li¡
 && (
t
->
æags
 & 
APOL_QUERY_SOURCE_INDIRECT
)) {

388 
u£s_sourû
 = 1;

389 } ià(!
sourû_li¡
) {

390 
u£s_sourû
 = 1;

393 ià(
rg‘_li¡


394 && !(
t
->
æags
 & 
APOL_QUERY_TARGET_INDIRECT
 || (
sourû_as_ªy
 &&->æag & 
APOL_QUERY_SOURCE_INDIRECT
))) {

395 
u£s_rg‘
 = 
	`­Ş_qu”y_ty³_£t_u£s_ty³s_dœeùly
(
p
, 
‰y³s
, 
rg‘_li¡
);

396 ià(
u£s_rg‘
 < 0)

397 
ş—nup
;

398 } ià(
rg‘_li¡


399 && (
t
->
æags
 & 
APOL_QUERY_TARGET_INDIRECT
 || (
sourû_as_ªy
 &&->æag & 
APOL_QUERY_SOURCE_INDIRECT
))) {

400 
u£s_rg‘
 = 1;

401 } ià(!
rg‘_li¡
) {

402 
u£s_rg‘
 = 1;

405 ià(
deçuÉ_li¡
) {

406 
	`qpŞ_syn_‹ruË_g‘_deçuÉ_ty³
(
p
->p, 
¤uË
, &
dæt
);

407 ià(!
	`­Ş_veùÜ_g‘_šdex
(
deçuÉ_li¡
, (*)
dæt
, 
NULL
, NULL, &
j
))

408 
u£s_deçuÉ
 = 1;

409 } ià(!
deçuÉ_li¡
) {

410 
u£s_deçuÉ
 = 1;

413 ià(!((
u£s_sourû
 && 
u£s_rg‘
 && 
u£s_deçuÉ
)

414 || (
sourû_as_ªy
 && (
u£s_sourû
 || 
u£s_rg‘
 || 
u£s_deçuÉ
)))) {

415 
	`­Ş_veùÜ_»move
(*
v
, 
i
);

416 
i
--;

420 
»tv®
 = 0;

421 
ş—nup
:

422 ià(
»tv®
 != 0) {

423 
	`­Ş_veùÜ_de¡roy
(
v
);

425 
	`­Ş_veùÜ_de¡roy
(&
syn_v
);

426 
	`­Ş_veùÜ_de¡roy
(&
sourû_li¡
);

427 ià(!
sourû_as_ªy
) {

428 
	`­Ş_veùÜ_de¡roy
(&
rg‘_li¡
);

429 
	`­Ş_veùÜ_de¡roy
(&
deçuÉ_li¡
);

431 
	`­Ş_veùÜ_de¡roy
(&
şass_li¡
);

432  
»tv®
;

433 
	}
}

435 
­Ş_‹ruË_qu”y_t
 *
	$­Ş_‹ruË_qu”y_ü—‹
()

437 
­Ş_‹ruË_qu”y_t
 *
t
 = 
	`ÿÎoc
(1, (apol_terule_query_t));

438 ià(
t
 !ğ
NULL
) {

439 
t
->
ruËs
 = ~0U;

440 
t
->
æags
 =

441 (
APOL_QUERY_SOURCE_TYPE
 | 
APOL_QUERY_SOURCE_ATTRIBUTE
 | 
APOL_QUERY_TARGET_TYPE
 |

442 
APOL_QUERY_TARGET_ATTRIBUTE
);

444  
t
;

445 
	}
}

447 
	$­Ş_‹ruË_qu”y_de¡roy
(
­Ş_‹ruË_qu”y_t
 ** 
t
)

449 ià(*
t
 !ğ
NULL
) {

450 
	`ä“
((*
t
)->
sourû
);

451 
	`ä“
((*
t
)->
rg‘
);

452 
	`ä“
((*
t
)->
deçuÉ_ty³
);

453 
	`ä“
((*
t
)->
boŞ_Çme
);

454 
	`­Ş_veùÜ_de¡roy
(&(*
t
)->
şas£s
);

455 
	`ä“
(*
t
);

456 *
t
 = 
NULL
;

458 
	}
}

460 
­Ş_‹ruË_qu”y_£t_ruËs
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
 
__©Œibu‹__
 ((
unu£d
)), 
­Ş_‹ruË_qu”y_t
 * 
t
, 
ruËs
)

462 ià(
	gruËs
 != 0) {

463 
t
->
ruËs
 =„ules;

465 
	gt
->
	gruËs
 = ~0U;

470 
	$­Ş_‹ruË_qu”y_£t_sourû
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_‹ruË_qu”y_t
 * 
t
, cÚ¡ *
symbŞ
, 
is_šdœeù
)

472 
	`­Ş_qu”y_£t_æag
(
p
, &
t
->
æags
, 
is_šdœeù
, 
APOL_QUERY_SOURCE_INDIRECT
);

473  
	`­Ş_qu”y_£t
(
p
, &
t
->
sourû
, 
NULL
, 
symbŞ
);

474 
	}
}

476 
	$­Ş_‹ruË_qu”y_£t_sourû_compÚ’t
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_‹ruË_qu”y_t
 * 
t
, 
compÚ’t
)

478 ià(!
t
 || !(
compÚ’t
 & 
APOL_QUERY_SYMBOL_IS_BOTH
)) {

479 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
EINVAL
));

480 
”ºo
 = 
EINVAL
;

483 
	`­Ş_qu”y_£t_æag
(
p
, &
t
->
æags
, 
compÚ’t
 & 
APOL_QUERY_SYMBOL_IS_TYPE
, 
APOL_QUERY_SOURCE_TYPE
);

484 
	`­Ş_qu”y_£t_æag
(
p
, &
t
->
æags
, 
compÚ’t
 & 
APOL_QUERY_SYMBOL_IS_ATTRIBUTE
, 
APOL_QUERY_SOURCE_ATTRIBUTE
);

486 
	}
}

488 
	$­Ş_‹ruË_qu”y_£t_rg‘
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_‹ruË_qu”y_t
 * 
t
, cÚ¡ *
symbŞ
, 
is_šdœeù
)

490 
	`­Ş_qu”y_£t_æag
(
p
, &
t
->
æags
, 
is_šdœeù
, 
APOL_QUERY_TARGET_INDIRECT
);

491  
	`­Ş_qu”y_£t
(
p
, &
t
->
rg‘
, 
NULL
, 
symbŞ
);

492 
	}
}

494 
	$­Ş_‹ruË_qu”y_£t_rg‘_compÚ’t
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_‹ruË_qu”y_t
 * 
t
, 
compÚ’t
)

496 ià(!
t
 || !(
compÚ’t
 & 
APOL_QUERY_SYMBOL_IS_BOTH
)) {

497 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
EINVAL
));

498 
”ºo
 = 
EINVAL
;

501 
	`­Ş_qu”y_£t_æag
(
p
, &
t
->
æags
, 
compÚ’t
 & 
APOL_QUERY_SYMBOL_IS_TYPE
, 
APOL_QUERY_TARGET_TYPE
);

502 
	`­Ş_qu”y_£t_æag
(
p
, &
t
->
æags
, 
compÚ’t
 & 
APOL_QUERY_SYMBOL_IS_ATTRIBUTE
, 
APOL_QUERY_TARGET_ATTRIBUTE
);

504 
	}
}

506 
	$­Ş_‹ruË_qu”y_£t_deçuÉ
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_‹ruË_qu”y_t
 * 
t
, cÚ¡ *
symbŞ
)

508  
	`­Ş_qu”y_£t
(
p
, &
t
->
deçuÉ_ty³
, 
NULL
, 
symbŞ
);

509 
	}
}

511 
	$­Ş_‹ruË_qu”y_­³nd_şass
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_‹ruË_qu”y_t
 * 
t
, cÚ¡ *
obj_şass
)

513 *
s
 = 
NULL
;

514 ià(
obj_şass
 =ğ
NULL
) {

515 
	`­Ş_veùÜ_de¡roy
(&
t
->
şas£s
);

516 } ià((
s
 = 
	`¡rdup
(
obj_şass
)è=ğ
NULL
 || (
t
->
şas£s
 =ğNULL && (t->şas£ ğ
	`­Ş_veùÜ_ü—‹
(
ä“
)) == NULL)

517 || 
	`­Ş_veùÜ_­³nd
(
t
->
şas£s
, 
s
) < 0) {

518 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

519 
	`ä“
(
s
);

523 
	}
}

525 
	$­Ş_‹ruË_qu”y_£t_boŞ
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_‹ruË_qu”y_t
 * 
t
, cÚ¡ *
boŞ_Çme
)

527  
	`­Ş_qu”y_£t
(
p
, &
t
->
boŞ_Çme
, 
NULL
, bool_name);

528 
	}
}

530 
	$­Ş_‹ruË_qu”y_£t_’abËd
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_‹ruË_qu”y_t
 * 
t
, 
is_’abËd
)

532  
	`­Ş_qu”y_£t_æag
(
p
, &
t
->
æags
, 
is_’abËd
, 
APOL_QUERY_ONLY_ENABLED
);

533 
	}
}

535 
	$­Ş_‹ruË_qu”y_£t_sourû_ªy
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_‹ruË_qu”y_t
 * 
t
, 
is_ªy
)

537  
	`­Ş_qu”y_£t_æag
(
p
, &
t
->
æags
, 
is_ªy
, 
APOL_QUERY_SOURCE_AS_ANY
);

538 
	}
}

540 
	$­Ş_‹ruË_qu”y_£t_»gex
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_‹ruË_qu”y_t
 * 
t
, 
is_»gex
)

542  
	`­Ş_qu”y_£t_»gex
(
p
, &
t
->
æags
, 
is_»gex
);

543 
	}
}

549 
	$­Ş_syn_‹ruË_comp
(cÚ¡ *
a
, cÚ¡ *
b
, *
d©a
)

551 
qpŞ_syn_‹ruË_t
 *
r1
 = (qpŞ_syn_‹ruË_ˆ*è
a
;

552 
qpŞ_syn_‹ruË_t
 *
r2
 = (qpŞ_syn_‹ruË_ˆ*è
b
;

553 
­Ş_pŞicy_t
 *
p
 = (­Ş_pŞicy_ˆ*è
d©a
;

554 
num1
, 
num2
;

555 ià(
	`qpŞ_syn_‹ruË_g‘_lš’o
(
p
->p, 
r1
, &
num1
è< 0 || qpŞ_syn_‹ruË_g‘_lš’oÕ->p, 
r2
, &
num2
) < 0) {

558 ià(
num1
 !ğ
num2
) {

559  ()
num1
 - ()
num2
;

561  ()((*)
r1
 - (*)
r2
);

562 
	}
}

564 
­Ş_veùÜ_t
 *
	$­Ş_‹ruË_to_syn_‹ruËs
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
qpŞ_‹ruË_t
 * 
ruË
)

566 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

567 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

568 
qpŞ_syn_‹ruË_t
 *
syn_‹ruË
;

569 
»tv®
 = -1, 
”rÜ
 = 0;

570 ià(
	`qpŞ_‹ruË_g‘_syn_‹ruË_™”
(
p
->p, 
ruË
, &
™”
) < 0) {

571 
”rÜ
 = 
”ºo
;

572 
ş—nup
;

574 ià((
v
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)) == NULL) {

575 
”rÜ
 = 
”ºo
;

576 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”rÜ
));

577 
ş—nup
;

579 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

580 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
syn_‹ruË
) < 0) {

581 
”rÜ
 = 
”ºo
;

582 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”rÜ
));

583 
ş—nup
;

585 ià(
	`­Ş_veùÜ_­³nd
(
v
, 
syn_‹ruË
) < 0) {

586 
”rÜ
 = 
”ºo
;

587 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”rÜ
));

588 
ş—nup
;

591 
	`­Ş_veùÜ_sÜt_uniquify
(
v
, 
­Ş_syn_‹ruË_comp
, (*)
p
);

592 
»tv®
 = 0;

593 
ş—nup
:

594 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

595 ià(
»tv®
 != 0) {

596 
	`­Ş_veùÜ_de¡roy
(&
v
);

597 
”ºo
 = 
”rÜ
;

598  
NULL
;

600  
v
;

601 
	}
}

603 
­Ş_veùÜ_t
 *
	$­Ş_‹ruË_li¡_to_syn_‹ruËs
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
­Ş_veùÜ_t
 * 
ruËs
)

605 
­Ş_b¡_t
 *
b
 = 
NULL
;

606 
qpŞ_‹ruË_t
 *
ruË
;

607 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

608 
qpŞ_syn_‹ruË_t
 *
syn_‹ruË
;

609 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

610 
size_t
 
i
;

611 
»tv®
 = -1, 
”rÜ
 = 0;

613 ià((
b
 = 
	`­Ş_b¡_ü—‹
(
­Ş_syn_‹ruË_comp
, 
NULL
)) == NULL) {

614 
”rÜ
 = 
”ºo
;

615 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”rÜ
));

616 
ş—nup
;

618 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
ruËs
); i++) {

619 
ruË
 = 
	`­Ş_veùÜ_g‘_–em’t
(
ruËs
, 
i
);

620 ià(
	`qpŞ_‹ruË_g‘_syn_‹ruË_™”
(
p
->p, 
ruË
, &
™”
) < 0) {

621 
”rÜ
 = 
”ºo
;

622 
ş—nup
;

624 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

625 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
syn_‹ruË
) < 0) {

626 
”rÜ
 = 
”ºo
;

627 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”rÜ
));

628 
ş—nup
;

630 ià(
	`­Ş_b¡_š£¹
(
b
, 
syn_‹ruË
, (*)
p
) < 0) {

631 
”rÜ
 = 
”ºo
;

632 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”rÜ
));

633 
ş—nup
;

636 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

638 ià((
v
 = 
	`­Ş_b¡_g‘_veùÜ
(
b
, 1)è=ğ
NULL
) {

639 
”rÜ
 = 
”ºo
;

640 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”rÜ
));

641 
ş—nup
;

643 
»tv®
 = 0;

644 
ş—nup
:

645 
	`­Ş_b¡_de¡roy
(&
b
);

646 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

647 ià(
»tv®
 != 0) {

648 
”ºo
 = 
”rÜ
;

649  
NULL
;

651  
v
;

652 
	}
}

654 *
	$­Ş_‹ruË_»nd”
(cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_‹ruË_t
 * 
ruË
)

656 *
tmp
 = 
NULL
;

657 cÚ¡ *
tmp_Çme
 = 
NULL
;

658 cÚ¡ *
ruË_ty³_¡r
;

659 
”rÜ
 = 0;

660 
size_t
 
tmp_sz
 = 0;

661 
ušt32_t
 
ruË_ty³
 = 0;

662 cÚ¡ 
qpŞ_ty³_t
 *
ty³
 = 
NULL
;

663 cÚ¡ 
qpŞ_şass_t
 *
obj_şass
 = 
NULL
;

665 ià(!
pŞicy
 || !
ruË
) {

666 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

667 
”ºo
 = 
EINVAL
;

668  
NULL
;

672 ià(
	`qpŞ_‹ruË_g‘_ruË_ty³
(
pŞicy
->
p
, 
ruË
, &
ruË_ty³
)) {

673  
NULL
;

675 ià(!(
ruË_ty³
 &ğ(
QPOL_RULE_TYPE_TRANS
 | 
QPOL_RULE_TYPE_CHANGE
 | 
QPOL_RULE_TYPE_MEMBER
))) {

676 
	`ERR
(
pŞicy
, "%s", "Invalid TE„uleype");

677 
”ºo
 = 
EINVAL
;

678  
NULL
;

680 ià(!(
ruË_ty³_¡r
 = 
	`­Ş_ruË_ty³_to_¡r
(
ruË_ty³
))) {

681 
	`ERR
(
pŞicy
, "%s", "Could‚ot get TE„uleype's string");

682 
”ºo
 = 
EINVAL
;

683  
NULL
;

685 ià(
	`­Ş_¡r_­³ndf
(&
tmp
, &
tmp_sz
, "% ", 
ruË_ty³_¡r
)) {

686 
”rÜ
 = 
”ºo
;

687 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

688 
”r
;

692 ià(
	`qpŞ_‹ruË_g‘_sourû_ty³
(
pŞicy
->
p
, 
ruË
, &
ty³
)) {

693 
”rÜ
 = 
”ºo
;

694 
”r
;

696 ià(
	`qpŞ_ty³_g‘_Çme
(
pŞicy
->
p
, 
ty³
, &
tmp_Çme
)) {

697 
”rÜ
 = 
”ºo
;

698 
”r
;

700 ià(
	`­Ş_¡r_­³ndf
(&
tmp
, &
tmp_sz
, "% ", 
tmp_Çme
)) {

701 
”rÜ
 = 
”ºo
;

702 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

703 
”r
;

707 ià(
	`qpŞ_‹ruË_g‘_rg‘_ty³
(
pŞicy
->
p
, 
ruË
, &
ty³
)) {

708 
”rÜ
 = 
”ºo
;

709 
”r
;

711 ià(
	`qpŞ_ty³_g‘_Çme
(
pŞicy
->
p
, 
ty³
, &
tmp_Çme
)) {

712 
”rÜ
 = 
”ºo
;

713 
”r
;

715 ià(
	`­Ş_¡r_­³ndf
(&
tmp
, &
tmp_sz
, "% : ", 
tmp_Çme
)) {

716 
”rÜ
 = 
”ºo
;

717 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

718 
”r
;

722 ià(
	`qpŞ_‹ruË_g‘_objeù_şass
(
pŞicy
->
p
, 
ruË
, &
obj_şass
)) {

723 
”rÜ
 = 
”ºo
;

724 
”r
;

726 ià(
	`qpŞ_şass_g‘_Çme
(
pŞicy
->
p
, 
obj_şass
, &
tmp_Çme
)) {

727 
”rÜ
 = 
”ºo
;

728 
”r
;

730 ià(
	`­Ş_¡r_­³ndf
(&
tmp
, &
tmp_sz
, "% ", 
tmp_Çme
)) {

731 
”rÜ
 = 
”ºo
;

732 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

733 
”r
;

737 ià(
	`qpŞ_‹ruË_g‘_deçuÉ_ty³
(
pŞicy
->
p
, 
ruË
, &
ty³
)) {

738 
”rÜ
 = 
”ºo
;

739 
”r
;

741 ià(
	`qpŞ_ty³_g‘_Çme
(
pŞicy
->
p
, 
ty³
, &
tmp_Çme
)) {

742 
”rÜ
 = 
”ºo
;

743 
”r
;

745 ià(
	`­Ş_¡r_­³ndf
(&
tmp
, &
tmp_sz
, "%s;", 
tmp_Çme
)) {

746 
”rÜ
 = 
”ºo
;

747 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

748 
”r
;

751  
tmp
;

753 
”r
:

754 
	`ä“
(
tmp
);

755 
”ºo
 = 
”rÜ
;

756  
NULL
;

757 
	}
}

759 *
	$­Ş_syn_‹ruË_»nd”
(cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_syn_‹ruË_t
 * 
ruË
)

761 *
tmp
 = 
NULL
;

762 cÚ¡ *
tmp_Çme
 = 
NULL
;

763 cÚ¡ *
ruË_ty³_¡r
;

764 
”rÜ
 = 0;

765 
ušt32_t
 
ruË_ty³
 = 0, 
¡¬
 = 0, 
comp
 = 0;

766 cÚ¡ 
qpŞ_ty³_t
 *
ty³
 = 
NULL
;

767 cÚ¡ 
qpŞ_şass_t
 *
obj_şass
 = 
NULL
;

768 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
, *
™”2
 = NULL;

769 
size_t
 
tmp_sz
 = 0, 
™”_sz
 = 0, 
™”2_sz
 = 0;

770 cÚ¡ 
qpŞ_ty³_£t_t
 *
£t
 = 
NULL
;

772 ià(!
pŞicy
 || !
ruË
) {

773 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

774 
”ºo
 = 
EINVAL
;

775  
NULL
;

779 ià(
	`qpŞ_syn_‹ruË_g‘_ruË_ty³
(
pŞicy
->
p
, 
ruË
, &
ruË_ty³
)) {

780  
NULL
;

782 ià(!(
ruË_ty³
 &ğ(
QPOL_RULE_TYPE_TRANS
 | 
QPOL_RULE_TYPE_CHANGE
 | 
QPOL_RULE_TYPE_MEMBER
))) {

783 
	`ERR
(
pŞicy
, "%s", "Invalid TE„uleype");

784 
”ºo
 = 
EINVAL
;

785  
NULL
;

787 ià(!(
ruË_ty³_¡r
 = 
	`­Ş_ruË_ty³_to_¡r
(
ruË_ty³
))) {

788 
	`ERR
(
pŞicy
, "%s", "Could‚ot get TE„uleype's string");

789 
”ºo
 = 
EINVAL
;

790  
NULL
;

792 ià(
	`­Ş_¡r_­³ndf
(&
tmp
, &
tmp_sz
, "% ", 
ruË_ty³_¡r
)) {

793 
”rÜ
 = 
”ºo
;

794 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

795 
”r
;

799 ià(
	`qpŞ_syn_‹ruË_g‘_sourû_ty³_£t
(
pŞicy
->
p
, 
ruË
, &
£t
)) {

800 
”rÜ
 = 
”ºo
;

801 
”r
;

803 ià(
	`qpŞ_ty³_£t_g‘_is_¡¬
(
pŞicy
->
p
, 
£t
, &
¡¬
)) {

804 
”rÜ
 = 
”ºo
;

805 
”r
;

807 ià(
¡¬
) {

808 ià(
	`­Ş_¡r_­³nd
(&
tmp
, &
tmp_sz
, "* ")) {

809 
”rÜ
 = 
”ºo
;

810 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

811 
”r
;

814 ià(
	`qpŞ_ty³_£t_g‘_is_comp
(
pŞicy
->
p
, 
£t
, &
comp
)) {

815 
”rÜ
 = 
”ºo
;

816 
”r
;

818 ià(
comp
) {

819 ià(
	`­Ş_¡r_­³nd
(&
tmp
, &
tmp_sz
, "~")) {

820 
”rÜ
 = 
”ºo
;

821 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

822 
”r
;

825 ià(
	`qpŞ_ty³_£t_g‘_šşuded_ty³s_™”
(
pŞicy
->
p
, 
£t
, &
™”
)) {

826 
”rÜ
 = 
”ºo
;

827 
”r
;

829 ià(
	`qpŞ_ty³_£t_g‘_subŒaùed_ty³s_™”
(
pŞicy
->
p
, 
£t
, &
™”2
)) {

830 
”rÜ
 = 
”ºo
;

831 
”r
;

833 ià(
	`qpŞ_™”©Ü_g‘_size
(
™”
, &
™”_sz
è|| qpŞ_™”©Ü_g‘_size(
™”2
, &
™”2_sz
)) {

834 
”rÜ
 = 
”ºo
;

835 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

836 
”r
;

838 ià(
™”_sz
 + 
™”2_sz
 > 1) {

839 ià(
	`­Ş_¡r_­³nd
(&
tmp
, &
tmp_sz
, "{ ")) {

840 
”rÜ
 = 
”ºo
;

841 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

842 
”r
;

845 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

846 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
ty³
)) {

847 
”rÜ
 = 
”ºo
;

848 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

849 
”r
;

851 ià(
	`qpŞ_ty³_g‘_Çme
(
pŞicy
->
p
, 
ty³
, &
tmp_Çme
)) {

852 
”rÜ
 = 
”ºo
;

853 
”r
;

855 ià(
	`­Ş_¡r_­³ndf
(&
tmp
, &
tmp_sz
, "% ", 
tmp_Çme
)) {

856 
”rÜ
 = 
”ºo
;

857 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

858 
”r
;

861 ; !
	`qpŞ_™”©Ü_’d
(
™”2
); 
	`qpŞ_™”©Ü_Ãxt
(iter2)) {

862 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”2
, (**)&
ty³
)) {

863 
”rÜ
 = 
”ºo
;

864 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

865 
”r
;

867 ià(
	`qpŞ_ty³_g‘_Çme
(
pŞicy
->
p
, 
ty³
, &
tmp_Çme
)) {

868 
”rÜ
 = 
”ºo
;

869 
”r
;

871 ià(
	`­Ş_¡r_­³ndf
(&
tmp
, &
tmp_sz
, "-% ", 
tmp_Çme
)) {

872 
”rÜ
 = 
”ºo
;

873 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

874 
”r
;

877 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

878 
	`qpŞ_™”©Ü_de¡roy
(&
™”2
);

879 ià(
™”_sz
 + 
™”2_sz
 > 1) {

880 ià(
	`­Ş_¡r_­³nd
(&
tmp
, &
tmp_sz
, "} ")) {

881 
”rÜ
 = 
”ºo
;

882 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

883 
”r
;

889 ià(
	`qpŞ_syn_‹ruË_g‘_rg‘_ty³_£t
(
pŞicy
->
p
, 
ruË
, &
£t
)) {

890 
”rÜ
 = 
”ºo
;

891 
”r
;

893 ià(
	`qpŞ_ty³_£t_g‘_is_¡¬
(
pŞicy
->
p
, 
£t
, &
¡¬
)) {

894 
”rÜ
 = 
”ºo
;

895 
”r
;

897 ià(
¡¬
) {

898 ià(
	`­Ş_¡r_­³nd
(&
tmp
, &
tmp_sz
, "* ")) {

899 
”rÜ
 = 
”ºo
;

900 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

901 
”r
;

904 ià(
	`qpŞ_ty³_£t_g‘_is_comp
(
pŞicy
->
p
, 
£t
, &
comp
)) {

905 
”rÜ
 = 
”ºo
;

906 
”r
;

908 ià(
comp
) {

909 ià(
	`­Ş_¡r_­³nd
(&
tmp
, &
tmp_sz
, "~")) {

910 
”rÜ
 = 
”ºo
;

911 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

912 
”r
;

915 ià(
	`qpŞ_ty³_£t_g‘_šşuded_ty³s_™”
(
pŞicy
->
p
, 
£t
, &
™”
)) {

916 
”rÜ
 = 
”ºo
;

917 
”r
;

919 ià(
	`qpŞ_ty³_£t_g‘_subŒaùed_ty³s_™”
(
pŞicy
->
p
, 
£t
, &
™”2
)) {

920 
”rÜ
 = 
”ºo
;

921 
”r
;

923 ià(
	`qpŞ_™”©Ü_g‘_size
(
™”
, &
™”_sz
è|| qpŞ_™”©Ü_g‘_size(
™”2
, &
™”2_sz
)) {

924 
”rÜ
 = 
”ºo
;

925 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

926 
”r
;

928 ià(
™”_sz
 + 
™”2_sz
 > 1) {

929 ià(
	`­Ş_¡r_­³nd
(&
tmp
, &
tmp_sz
, "{ ")) {

930 
”rÜ
 = 
”ºo
;

931 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

932 
”r
;

935 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

936 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
ty³
)) {

937 
”rÜ
 = 
”ºo
;

938 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

939 
”r
;

941 ià(
	`qpŞ_ty³_g‘_Çme
(
pŞicy
->
p
, 
ty³
, &
tmp_Çme
)) {

942 
”rÜ
 = 
”ºo
;

943 
”r
;

945 ià(
	`­Ş_¡r_­³ndf
(&
tmp
, &
tmp_sz
, "% ", 
tmp_Çme
)) {

946 
”rÜ
 = 
”ºo
;

947 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

948 
”r
;

951 ; !
	`qpŞ_™”©Ü_’d
(
™”2
); 
	`qpŞ_™”©Ü_Ãxt
(iter2)) {

952 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”2
, (**)&
ty³
)) {

953 
”rÜ
 = 
”ºo
;

954 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

955 
”r
;

957 ià(
	`qpŞ_ty³_g‘_Çme
(
pŞicy
->
p
, 
ty³
, &
tmp_Çme
)) {

958 
”rÜ
 = 
”ºo
;

959 
”r
;

961 ià(
	`­Ş_¡r_­³ndf
(&
tmp
, &
tmp_sz
, "-% ", 
tmp_Çme
)) {

962 
”rÜ
 = 
”ºo
;

963 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

964 
”r
;

967 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

968 
	`qpŞ_™”©Ü_de¡roy
(&
™”2
);

969 ià(
™”_sz
 + 
™”2_sz
 > 1) {

970 ià(
	`­Ş_¡r_­³nd
(&
tmp
, &
tmp_sz
, "} ")) {

971 
”rÜ
 = 
”ºo
;

972 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

973 
”r
;

978 ià(
	`­Ş_¡r_­³nd
(&
tmp
, &
tmp_sz
, ": ")) {

979 
”rÜ
 = 
”ºo
;

980 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

981 
”r
;

985 ià(
	`qpŞ_syn_‹ruË_g‘_şass_™”
(
pŞicy
->
p
, 
ruË
, &
™”
)) {

986 
”rÜ
 = 
”ºo
;

987 
”r
;

989 ià(
	`qpŞ_™”©Ü_g‘_size
(
™”
, &
™”_sz
)) {

990 
”rÜ
 = 
”ºo
;

991 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

992 
”r
;

994 ià(
™”_sz
 > 1) {

995 ià(
	`­Ş_¡r_­³nd
(&
tmp
, &
tmp_sz
, "{ ")) {

996 
”rÜ
 = 
”ºo
;

997 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

998 
”r
;

1001 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

1002 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
obj_şass
)) {

1003 
”rÜ
 = 
”ºo
;

1004 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1005 
”r
;

1007 ià(
	`qpŞ_şass_g‘_Çme
(
pŞicy
->
p
, 
obj_şass
, &
tmp_Çme
)) {

1008 
”rÜ
 = 
”ºo
;

1009 
”r
;

1011 ià(
	`­Ş_¡r_­³ndf
(&
tmp
, &
tmp_sz
, "% ", 
tmp_Çme
)) {

1012 
”rÜ
 = 
”ºo
;

1013 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1014 
”r
;

1017 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

1018 ià(
™”_sz
 > 1) {

1019 ià(
	`­Ş_¡r_­³nd
(&
tmp
, &
tmp_sz
, "} ")) {

1020 
”rÜ
 = 
”ºo
;

1021 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1022 
”r
;

1027 ià(
	`qpŞ_syn_‹ruË_g‘_deçuÉ_ty³
(
pŞicy
->
p
, 
ruË
, &
ty³
)) {

1028 
”rÜ
 = 
”ºo
;

1029 
”r
;

1031 ià(
	`qpŞ_ty³_g‘_Çme
(
pŞicy
->
p
, 
ty³
, &
tmp_Çme
)) {

1032 
”rÜ
 = 
”ºo
;

1033 
”r
;

1035 ià(
	`­Ş_¡r_­³ndf
(&
tmp
, &
tmp_sz
, "%s;", 
tmp_Çme
)) {

1036 
”rÜ
 = 
”ºo
;

1037 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1038 
”r
;

1041  
tmp
;

1043 
”r
:

1044 
	`ä“
(
tmp
);

1045 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

1046 
	`qpŞ_™”©Ü_de¡roy
(&
™”2
);

1047 
”ºo
 = 
”rÜ
;

1048  
NULL
;

1049 
	}
}

	@libapol/src/type-query.c

31 
	~"pŞicy-qu”y-š‹º®.h
"

33 
	~<”ºo.h
>

35 
	s­Ş_ty³_qu”y


37 *
	mty³_Çme
;

38 
	mæags
;

39 
»gex_t
 *
	m»gex
;

42 
	s­Ş_©Œ_qu”y


44 *
	m©Œ_Çme
;

45 
	mæags
;

46 
»gex_t
 *
	m»gex
;

51 
	$­Ş_ty³_g‘_by_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_ty³_qu”y_t
 * 
t
, 
­Ş_veùÜ_t
 ** 
v
)

53 
qpŞ_™”©Ü_t
 *
™”
;

54 
»tv®
 = -1;

55 *
v
 = 
NULL
;

56 ià(
	`qpŞ_pŞicy_g‘_ty³_™”
(
p
->p, &
™”
) < 0) {

59 ià((*
v
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)) == NULL) {

60 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

61 
ş—nup
;

63 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

64 cÚ¡ 
qpŞ_ty³_t
 *
ty³
;

65 
i§‰r
, 
i§lŸs
;

66 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
ty³
) < 0) {

67 
ş—nup
;

69 ià(
	`qpŞ_ty³_g‘_i§‰r
(
p
->p, 
ty³
, &
i§‰r
è< 0 || 
	`qpŞ_ty³_g‘_i§lŸs
Õ->p,y³, &
i§lŸs
) < 0) {

70 
ş—nup
;

72 ià(
i§‰r
 || 
i§lŸs
) {

75 ià(
t
 !ğ
NULL
) {

76 
compv®
 = 
	`­Ş_com·»_ty³
(
p
,

77 
ty³
, 
t
->
ty³_Çme
,

78 
t
->
æags
, &Ñ->
»gex
));

79 ià(
compv®
 < 0) {

80 
ş—nup
;

81 } ià(
compv®
 == 0) {

85 ià(
	`­Ş_veùÜ_­³nd
(*
v
, (*)
ty³
)) {

86 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

87 
ş—nup
;

91 
»tv®
 = 0;

92 
ş—nup
:

93 ià(
»tv®
 != 0) {

94 
	`­Ş_veùÜ_de¡roy
(
v
);

96 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

97  
»tv®
;

98 
	}
}

100 
­Ş_ty³_qu”y_t
 *
	$­Ş_ty³_qu”y_ü—‹
()

102  
	`ÿÎoc
(1, (
­Ş_ty³_qu”y_t
));

103 
	}
}

105 
	$­Ş_ty³_qu”y_de¡roy
(
­Ş_ty³_qu”y_t
 ** 
t
)

107 ià(*
t
 !ğ
NULL
) {

108 
	`ä“
((*
t
)->
ty³_Çme
);

109 
	`­Ş_»gex_de¡roy
(&(*
t
)->
»gex
);

110 
	`ä“
(*
t
);

111 *
t
 = 
NULL
;

113 
	}
}

115 
	$­Ş_ty³_qu”y_£t_ty³
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_ty³_qu”y_t
 * 
t
, cÚ¡ *
Çme
)

117  
	`­Ş_qu”y_£t
(
p
, &
t
->
ty³_Çme
, &t->
»gex
, 
Çme
);

118 
	}
}

120 
	$­Ş_ty³_qu”y_£t_»gex
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_ty³_qu”y_t
 * 
t
, 
is_»gex
)

122  
	`­Ş_qu”y_£t_»gex
(
p
, &
t
->
æags
, 
is_»gex
);

123 
	}
}

127 
	$­Ş_©Œ_g‘_by_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_©Œ_qu”y_t
 * 
a
, 
­Ş_veùÜ_t
 ** 
v
)

129 
qpŞ_™”©Ü_t
 *
™”
;

130 
»tv®
 = -1;

131 *
v
 = 
NULL
;

132 ià(
	`qpŞ_pŞicy_g‘_ty³_™”
(
p
->p, &
™”
) < 0) {

135 ià((*
v
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)) == NULL) {

136 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

137 
ş—nup
;

139 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

140 
qpŞ_ty³_t
 *
ty³
;

141 
i§‰r
, 
i§lŸs
;

142 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
ty³
) < 0) {

143 
ş—nup
;

145 ià(
	`qpŞ_ty³_g‘_i§‰r
(
p
->p, 
ty³
, &
i§‰r
è< 0 || 
	`qpŞ_ty³_g‘_i§lŸs
Õ->p,y³, &
i§lŸs
) < 0) {

146 
ş—nup
;

148 ià(!
i§‰r
 || 
i§lŸs
) {

151 ià(
a
 !ğ
NULL
) {

152 cÚ¡ *
©Œ_Çme
;

153 
compv®
;

154 ià(
	`qpŞ_ty³_g‘_Çme
(
p
->p, 
ty³
, &
©Œ_Çme
) < 0) {

155 
ş—nup
;

157 
compv®
 = 
	`­Ş_com·»
(
p
, 
©Œ_Çme
, 
a
->©Œ_Çme,‡->
æags
, &×->
»gex
));

158 ià(
compv®
 < 0) {

159 
ş—nup
;

160 } ià(
compv®
 == 0) {

164 ià(
	`­Ş_veùÜ_­³nd
(*
v
, 
ty³
)) {

165 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

166 
ş—nup
;

170 
»tv®
 = 0;

171 
ş—nup
:

172 ià(
»tv®
 != 0) {

173 
	`­Ş_veùÜ_de¡roy
(
v
);

175 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

176  
»tv®
;

177 
	}
}

179 
­Ş_©Œ_qu”y_t
 *
	$­Ş_©Œ_qu”y_ü—‹
()

181  
	`ÿÎoc
(1, (
­Ş_©Œ_qu”y_t
));

182 
	}
}

184 
	$­Ş_©Œ_qu”y_de¡roy
(
­Ş_©Œ_qu”y_t
 ** 
a
)

186 ià(*
a
 !ğ
NULL
) {

187 
	`ä“
((*
a
)->
©Œ_Çme
);

188 
	`­Ş_»gex_de¡roy
(&(*
a
)->
»gex
);

189 
	`ä“
(*
a
);

190 *
a
 = 
NULL
;

192 
	}
}

194 
	$­Ş_©Œ_qu”y_£t_©Œ
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_©Œ_qu”y_t
 * 
a
, cÚ¡ *
Çme
)

196  
	`­Ş_qu”y_£t
(
p
, &
a
->
©Œ_Çme
, &a->
»gex
, 
Çme
);

197 
	}
}

199 
	$­Ş_©Œ_qu”y_£t_»gex
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_©Œ_qu”y_t
 * 
a
, 
is_»gex
)

201  
	`­Ş_qu”y_£t_»gex
(
p
, &
a
->
æags
, 
is_»gex
);

202 
	}
}

	@libapol/src/types-relation-analysis.c

25 
	~"pŞicy-qu”y-š‹º®.h
"

26 
	~"domaš-Œªs-ª®ysis-š‹º®.h
"

27 
	~"šfoæow-ª®ysis-š‹º®.h
"

29 
	~<”ºo.h
>

30 
	~<¡ršg.h
>

32 
	s­Ş_ty³s_»ÏtiÚ_ª®ysis


34 *
	mty³A
, *
	mty³B
;

35 
	mª®y£s
;

38 
	s­Ş_ty³s_»ÏtiÚ_»suÉ


41 
­Ş_veùÜ_t
 *
	m©Œibs
;

43 
­Ş_veùÜ_t
 *
	mrŞes
;

45 
­Ş_veùÜ_t
 *
	mu£rs
;

47 
­Ş_veùÜ_t
 *
	msimA
;

49 
­Ş_veùÜ_t
 *
	msimB
;

51 
­Ş_veùÜ_t
 *
	mdisA
;

53 
­Ş_veùÜ_t
 *
	mdisB
;

55 
­Ş_veùÜ_t
 *
	m®lows
;

57 
­Ş_veùÜ_t
 *
	mty³s
;

59 
­Ş_veùÜ_t
 *
	mdœæows
;

61 
­Ş_veùÜ_t
 *
	mŒªsAB
;

63 
­Ş_veùÜ_t
 *
	mŒªsBA
;

65 
­Ş_veùÜ_t
 *
	mdomsAB
;

67 
­Ş_veùÜ_t
 *
	mdomsBA
;

70 
	s­Ş_ty³s_»ÏtiÚ_acûss


72 cÚ¡ 
qpŞ_ty³_t
 *
	mty³
;

74 
­Ş_veùÜ_t
 *
	mruËs
;

91 
	$­Ş_ty³s_»ÏtiÚ_commÚ_©Œibs
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
,

92 cÚ¡ 
qpŞ_ty³_t
 * 
ty³A
, cÚ¡ qpŞ_ty³_ˆ* 
ty³B
,

93 
­Ş_ty³s_»ÏtiÚ_»suÉ_t
 * 
r
)

95 
qpŞ_™”©Ü_t
 *
iA
 = 
NULL
, *
iB
 = NULL;

96 
­Ş_veùÜ_t
 *
vA
 = 
NULL
, *
vB
 = NULL;

97 
»tv®
 = -1;

99 ià(
	`qpŞ_ty³_g‘_©Œ_™”
(
p
->p, 
ty³A
, &
iA
è< 0 || qpŞ_ty³_g‘_©Œ_™”Õ->p, 
ty³B
, &
iB
) < 0) {

100 
ş—nup
;

102 ià((
vA
 = 
	`­Ş_veùÜ_ü—‹_äom_™”
(
iA
, 
NULL
)) == NULL ||

103 (
vB
 = 
	`­Ş_veùÜ_ü—‹_äom_™”
(
iB
, 
NULL
)) == NULL ||

104 (
r
->
©Œibs
 = 
	`­Ş_veùÜ_ü—‹_äom_š‹r£ùiÚ
(
vA
, 
vB
, 
NULL
, NULL)) == NULL) {

105 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

108 
»tv®
 = 0;

109 
ş—nup
:

110 
	`qpŞ_™”©Ü_de¡roy
(&
iA
);

111 
	`qpŞ_™”©Ü_de¡roy
(&
iB
);

112 
	`­Ş_veùÜ_de¡roy
(&
vA
);

113 
	`­Ş_veùÜ_de¡roy
(&
vB
);

114  
»tv®
;

115 
	}
}

130 
	$­Ş_ty³s_»ÏtiÚ_commÚ_rŞes
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
,

131 cÚ¡ 
qpŞ_ty³_t
 * 
ty³A
, cÚ¡ qpŞ_ty³_ˆ* 
ty³B
, 
­Ş_ty³s_»ÏtiÚ_»suÉ_t
 * 
r
)

133 cÚ¡ *
ÇmeA
, *
ÇmeB
;

134 
­Ş_rŞe_qu”y_t
 *
rq
 = 
NULL
;

135 
­Ş_veùÜ_t
 *
vA
 = 
NULL
, *
vB
 = NULL;

136 
»tv®
 = -1;

138 ià(
	`qpŞ_ty³_g‘_Çme
(
p
->p, 
ty³A
, &
ÇmeA
è< 0 || qpŞ_ty³_g‘_ÇmeÕ->p, 
ty³B
, &
ÇmeB
) < 0) {

139 
ş—nup
;

141 ià((
rq
 = 
	`­Ş_rŞe_qu”y_ü—‹
()è=ğ
NULL
) {

142 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

143 
ş—nup
;

145 ià(
	`­Ş_rŞe_qu”y_£t_ty³
(
p
, 
rq
, 
ÇmeA
) < 0 ||

146 
	`­Ş_rŞe_g‘_by_qu”y
(
p
, 
rq
, &
vA
) < 0 ||

147 
	`­Ş_rŞe_qu”y_£t_ty³
(
p
, 
rq
, 
ÇmeB
è< 0 || 
	`­Ş_rŞe_g‘_by_qu”y
Õ,„q, &
vB
) < 0) {

148 
ş—nup
;

150 ià((
r
->
rŞes
 = 
	`­Ş_veùÜ_ü—‹_äom_š‹r£ùiÚ
(
vA
, 
vB
, 
NULL
, NULL)) == NULL) {

151 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

154 
»tv®
 = 0;

155 
ş—nup
:

156 
	`­Ş_rŞe_qu”y_de¡roy
(&
rq
);

157 
	`­Ş_veùÜ_de¡roy
(&
vA
);

158 
	`­Ş_veùÜ_de¡roy
(&
vB
);

159  
»tv®
;

160 
	}
}

175 
	$­Ş_ty³s_»ÏtiÚ_commÚ_u£rs
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
,

176 cÚ¡ 
qpŞ_ty³_t
 * 
ty³A
, cÚ¡ qpŞ_ty³_ˆ* 
ty³B
, 
­Ş_ty³s_»ÏtiÚ_»suÉ_t
 * 
r
)

178 cÚ¡ *
ÇmeA
, *
ÇmeB
;

179 
­Ş_rŞe_qu”y_t
 *
rq
 = 
NULL
;

180 
­Ş_veùÜ_t
 *
vA
 = 
NULL
, *
vB
 = NULL;

181 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
, *
r™”
 = NULL;

182 
»tv®
 = -1;

184 ià(
	`qpŞ_ty³_g‘_Çme
(
p
->p, 
ty³A
, &
ÇmeA
è< 0 || qpŞ_ty³_g‘_ÇmeÕ->p, 
ty³B
, &
ÇmeB
) < 0) {

185 
ş—nup
;

187 ià((
rq
 = 
	`­Ş_rŞe_qu”y_ü—‹
()è=ğ
NULL
) {

188 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

189 
ş—nup
;

191 ià(
	`­Ş_rŞe_qu”y_£t_ty³
(
p
, 
rq
, 
ÇmeA
) < 0 ||

192 
	`­Ş_rŞe_g‘_by_qu”y
(
p
, 
rq
, &
vA
) < 0 ||

193 
	`­Ş_rŞe_qu”y_£t_ty³
(
p
, 
rq
, 
ÇmeB
è< 0 || 
	`­Ş_rŞe_g‘_by_qu”y
Õ,„q, &
vB
) < 0) {

194 
ş—nup
;

197 ià((
r
->
u£rs
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)) == NULL) {

198 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

199 
ş—nup
;

201 ià(
	`qpŞ_pŞicy_g‘_u£r_™”
(
p
->p, &
™”
) < 0) {

202 
ş—nup
;

204 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

205 
qpŞ_u£r_t
 *
u£r
;

206 
size_t
 
i
;

207 
šA
 = 0, 
šB
 = 0;

208 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
u£r
) < 0) {

209 
ş—nup
;

211 ià(
	`qpŞ_u£r_g‘_rŞe_™”
(
p
->p, 
u£r
, &
r™”
) < 0) {

212 
ş—nup
;

214 ; (!
šA
 || !
šB
è&& !
	`qpŞ_™”©Ü_’d
(
r™”
); 
	`qpŞ_™”©Ü_Ãxt
(riter)) {

215 
qpŞ_rŞe_t
 *
rŞe
;

216 ià(
	`qpŞ_™”©Ü_g‘_™em
(
r™”
, (**)&
rŞe
) < 0) {

217 
ş—nup
;

219 ià(!
šA
 && 
	`­Ş_veùÜ_g‘_šdex
(
vA
, 
rŞe
, 
NULL
, NULL, &
i
) == 0) {

220 
šA
 = 1;

222 ià(!
šB
 && 
	`­Ş_veùÜ_g‘_šdex
(
vB
, 
rŞe
, 
NULL
, NULL, &
i
) == 0) {

223 
šB
 = 1;

226 
	`qpŞ_™”©Ü_de¡roy
(&
r™”
);

227 ià(
šA
 && 
šB
 && 
	`­Ş_veùÜ_­³nd
(
r
->
u£rs
, 
u£r
) < 0) {

228 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

229 
ş—nup
;

233 
»tv®
 = 0;

234 
ş—nup
:

235 
	`­Ş_rŞe_qu”y_de¡roy
(&
rq
);

236 
	`­Ş_veùÜ_de¡roy
(&
vA
);

237 
	`­Ş_veùÜ_de¡roy
(&
vB
);

238 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

239 
	`qpŞ_™”©Ü_de¡roy
(&
r™”
);

240  
»tv®
;

241 
	}
}

253 
­Ş_ty³s_»ÏtiÚ_acûss_compfunc
(cÚ¡ *
a
, cÚ¡ *
b
, *
d©a
 
__©Œibu‹__
 ((
unu£d
)))

255 
­Ş_ty³s_»ÏtiÚ_acûss_t
 *
	gacûss
 = (­Ş_ty³s_»ÏtiÚ_acûss_ˆ*è
a
;

256 
qpŞ_ty³_t
 *
	gt
 = (qpŞ_ty³_ˆ*è
b
;

257  ()((*)
	gacûss
->
	gty³
 - (*)
	gt
);

270 
­Ş_ty³s_»ÏtiÚ_acûss_compfunc2
(cÚ¡ *
a
, cÚ¡ *
b
, *
d©a
 
__©Œibu‹__
 ((
unu£d
)))

272 
­Ş_ty³s_»ÏtiÚ_acûss_t
 *
	gacûssA
 = (­Ş_ty³s_»ÏtiÚ_acûss_ˆ*è
a
;

273 
­Ş_ty³s_»ÏtiÚ_acûss_t
 *
	gacûssB
 = (­Ş_ty³s_»ÏtiÚ_acûss_ˆ*è
b
;

274  ()((*)
	gacûssA
->
	gty³
 - (*)
	gacûssB
->type);

284 
	$­Ş_ty³s_»ÏtiÚ_acûss_ä“
(*
d©a
)

286 
­Ş_ty³s_»ÏtiÚ_acûss_t
 *
a
 = (­Ş_ty³s_»ÏtiÚ_acûss_ˆ*è
d©a
;

287 ià(
a
 !ğ
NULL
) {

288 
	`­Ş_veùÜ_de¡roy
(&
a
->
ruËs
);

289 
	`ä“
(
a
);

291 
	}
}

303 
	$­Ş_ty³s_»ÏtiÚ_acûss_­³nd_ruË
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
qpŞ_avruË_t
 * 
r
, 
­Ş_veùÜ_t
 * 
acûss
)

305 cÚ¡ 
qpŞ_ty³_t
 *
t
;

306 
­Ş_veùÜ_t
 *
ex·nded
 = 
NULL
;

307 
size_t
 
i
, 
j
;

308 
­Ş_ty³s_»ÏtiÚ_acûss_t
 *
a
;

309 
»tv®
 = -1;

310 ià(
	`qpŞ_avruË_g‘_rg‘_ty³
(
p
->p, 
r
, &
t
è< 0 || (
ex·nded
 = 
	`­Ş_qu”y_ex·nd_ty³
Õ,)è=ğ
NULL
) {

311 
ş—nup
;

313 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
ex·nded
); i++) {

314 
t
 = 
	`­Ş_veùÜ_g‘_–em’t
(
ex·nded
, 
i
);

315 ià(
	`­Ş_veùÜ_g‘_šdex
(
acûss
, 
t
, 
­Ş_ty³s_»ÏtiÚ_acûss_compfunc
, 
NULL
, &
j
) == 0) {

316 
a
 = (
­Ş_ty³s_»ÏtiÚ_acûss_t
 *è
	`­Ş_veùÜ_g‘_–em’t
(
acûss
, 
j
);

318 ià((
a
 = 
	`ÿÎoc
(1, (*a))è=ğ
NULL
 ||

319 (
a
->
ruËs
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)è=ğNULL || 
	`­Ş_veùÜ_­³nd
(
acûss
,‡) < 0) {

320 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

321 
	`­Ş_ty³s_»ÏtiÚ_acûss_ä“
(
a
);

322 
ş—nup
;

324 
a
->
ty³
 = 
t
;

326 ià(
	`­Ş_veùÜ_­³nd
(
a
->
ruËs
, (*)
r
) < 0) {

327 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

328 
ş—nup
;

331 
»tv®
 = 0;

332 
ş—nup
:

333 
	`­Ş_veùÜ_de¡roy
(&
ex·nded
);

334  
»tv®
;

335 
	}
}

352 
	$­Ş_ty³s_»ÏtiÚ_ü—‹_acûss_poŞs
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
,

353 cÚ¡ 
qpŞ_ty³_t
 * 
ty³A
,

354 cÚ¡ 
qpŞ_ty³_t
 * 
ty³B
, 
­Ş_veùÜ_t
 * 
acûs£sA
,‡pŞ_veùÜ_ˆ* 
acûs£sB
)

356 cÚ¡ *
ÇmeA
, *
ÇmeB
;

357 
­Ş_avruË_qu”y_t
 *
aq
 = 
NULL
;

358 
­Ş_veùÜ_t
 *
vA
 = 
NULL
, *
vB
 = NULL;

359 
size_t
 
i
;

360 
»tv®
 = -1;

362 ià(
	`qpŞ_ty³_g‘_Çme
(
p
->p, 
ty³A
, &
ÇmeA
è< 0 || qpŞ_ty³_g‘_ÇmeÕ->p, 
ty³B
, &
ÇmeB
) < 0) {

363 
ş—nup
;

365 ià((
aq
 = 
	`­Ş_avruË_qu”y_ü—‹
()è=ğ
NULL
) {

366 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

367 
ş—nup
;

369 ià(
	`­Ş_avruË_qu”y_£t_ruËs
(
p
, 
aq
, 
QPOL_RULE_ALLOW
) < 0 ||

370 
	`­Ş_avruË_qu”y_£t_sourû
(
p
, 
aq
, 
ÇmeA
, 1) < 0 ||

371 
	`­Ş_avruË_g‘_by_qu”y
(
p
, 
aq
, &
vA
) < 0 ||

372 
	`­Ş_avruË_qu”y_£t_sourû
(
p
, 
aq
, 
ÇmeB
, 1è< 0 || 
	`­Ş_avruË_g‘_by_qu”y
Õ,‡q, &
vB
) < 0) {

373 
ş—nup
;

375 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
vA
); i++) {

376 
qpŞ_avruË_t
 *
r
 = (qpŞ_avruË_ˆ*è
	`­Ş_veùÜ_g‘_–em’t
(
vA
, 
i
);

377 ià(
	`­Ş_ty³s_»ÏtiÚ_acûss_­³nd_ruË
(
p
, 
r
, 
acûs£sA
) < 0) {

378 
ş—nup
;

381 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
vB
); i++) {

382 
qpŞ_avruË_t
 *
r
 = (qpŞ_avruË_ˆ*è
	`­Ş_veùÜ_g‘_–em’t
(
vB
, 
i
);

383 ià(
	`­Ş_ty³s_»ÏtiÚ_acûss_­³nd_ruË
(
p
, 
r
, 
acûs£sB
) < 0) {

384 
ş—nup
;

388 
»tv®
 = 0;

389 
ş—nup
:

390 
	`­Ş_avruË_qu”y_de¡roy
(&
aq
);

391 
	`­Ş_veùÜ_de¡roy
(&
vA
);

392 
	`­Ş_veùÜ_de¡roy
(&
vB
);

393  
»tv®
;

394 
	}
}

407 
	$­Ş_ty³s_»ÏtiÚ_acûss_­³nd
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
­Ş_ty³s_»ÏtiÚ_acûss_t
 * 
a
,

408 
­Ş_veùÜ_t
 * 
acûss
)

410 
­Ş_ty³s_»ÏtiÚ_acûss_t
 *
Ãw_a
;

411 
»tv®
 = -1;

412 ià((
Ãw_a
 = 
	`ÿÎoc
(1, (*Ãw_a))è=ğ
NULL


413 || (
Ãw_a
->
ruËs
 = 
	`­Ş_veùÜ_ü—‹_äom_veùÜ
(
a
->ruËs, 
NULL
, NULL, NULL)) == NULL) {

414 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

415 
ş—nup
;

417 
Ãw_a
->
ty³
 = 
a
->type;

418 ià(
	`­Ş_veùÜ_­³nd
(
acûss
, 
Ãw_a
) < 0) {

419 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

420 
ş—nup
;

422 
»tv®
 = 0;

423 
ş—nup
:

424 ià(
»tv®
 != 0) {

425 
	`­Ş_ty³s_»ÏtiÚ_acûss_ä“
(
Ãw_a
);

427  
»tv®
;

428 
	}
}

443 
	$­Ş_ty³s_»ÏtiÚ_acûs£s
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
,

444 cÚ¡ 
qpŞ_ty³_t
 * 
ty³A
,

445 cÚ¡ 
qpŞ_ty³_t
 * 
ty³B
, 
do_sim¬
, 
do_dissim¬
,

446 
­Ş_ty³s_»ÏtiÚ_»suÉ_t
 * 
r
)

448 
­Ş_veùÜ_t
 *
acûs£sA
 = 
NULL
, *
acûs£sB
 = NULL;

449 
­Ş_ty³s_»ÏtiÚ_acûss_t
 *
a
, *
b
;

450 
size_t
 
i
, 
j
;

451 
»tv®
 = -1;

453 ià((
acûs£sA
 = 
	`­Ş_veùÜ_ü—‹
(
­Ş_ty³s_»ÏtiÚ_acûss_ä“
)è=ğ
NULL


454 || (
acûs£sB
 = 
	`­Ş_veùÜ_ü—‹
(
­Ş_ty³s_»ÏtiÚ_acûss_ä“
)è=ğ
NULL
) {

455 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

456 
ş—nup
;

458 ià(
	`­Ş_ty³s_»ÏtiÚ_ü—‹_acûss_poŞs
(
p
, 
ty³A
, 
ty³B
, 
acûs£sA
, 
acûs£sB
) < 0) {

459 
ş—nup
;

461 
	`­Ş_veùÜ_sÜt
(
acûs£sA
, 
­Ş_ty³s_»ÏtiÚ_acûss_compfunc2
, 
NULL
);

462 
	`­Ş_veùÜ_sÜt
(
acûs£sB
, 
­Ş_ty³s_»ÏtiÚ_acûss_compfunc2
, 
NULL
);

464 ià(
do_sim¬
) {

465 ià((
r
->
simA
 = 
	`­Ş_veùÜ_ü—‹
(
­Ş_ty³s_»ÏtiÚ_acûss_ä“
)è=ğ
NULL


466 || (
r
->
simB
 = 
	`­Ş_veùÜ_ü—‹
(
­Ş_ty³s_»ÏtiÚ_acûss_ä“
)è=ğ
NULL
) {

467 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

468 
ş—nup
;

471 ià(
do_dissim¬
) {

472 ià((
r
->
disA
 = 
	`­Ş_veùÜ_ü—‹
(
­Ş_ty³s_»ÏtiÚ_acûss_ä“
)è=ğ
NULL


473 || (
r
->
disB
 = 
	`­Ş_veùÜ_ü—‹
(
­Ş_ty³s_»ÏtiÚ_acûss_ä“
)è=ğ
NULL
) {

474 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

475 
ş—nup
;

484 
i
 = 
j
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
acûs£sA
è&& j <‡pŞ_veùÜ_g‘_size(
acûs£sB
);) {

485 
a
 = (
­Ş_ty³s_»ÏtiÚ_acûss_t
 *è
	`­Ş_veùÜ_g‘_–em’t
(
acûs£sA
, 
i
);

486 
b
 = (
­Ş_ty³s_»ÏtiÚ_acûss_t
 *è
	`­Ş_veùÜ_g‘_–em’t
(
acûs£sB
, 
j
);

487 ià(
a
->
ty³
 =ğ
b
->type) {

488 ià(
do_sim¬
 &&

489 (
	`­Ş_ty³s_»ÏtiÚ_acûss_­³nd
(
p
, 
a
, 
r
->
simA
) < 0 ||

490 
	`­Ş_ty³s_»ÏtiÚ_acûss_­³nd
(
p
, 
b
, 
r
->
simB
) < 0)) {

491 
ş—nup
;

493 
i
++;

494 
j
++;

496 ià(
a
->
ty³
 < 
b
->type) {

497 ià(
do_dissim¬
 && 
	`­Ş_ty³s_»ÏtiÚ_acûss_­³nd
(
p
, 
a
, 
r
->
disA
) < 0) {

498 
ş—nup
;

500 
i
++;

502 ià(
do_dissim¬
 && 
	`­Ş_ty³s_»ÏtiÚ_acûss_­³nd
(
p
, 
b
, 
r
->
disB
) < 0) {

503 
ş—nup
;

505 
j
++;

509 ; 
do_dissim¬
 && 
i
 < 
	`­Ş_veùÜ_g‘_size
(
acûs£sA
); i++) {

510 
a
 = (
­Ş_ty³s_»ÏtiÚ_acûss_t
 *è
	`­Ş_veùÜ_g‘_–em’t
(
acûs£sA
, 
i
);

511 ià(
	`­Ş_ty³s_»ÏtiÚ_acûss_­³nd
(
p
, 
a
, 
r
->
disA
) < 0) {

512 
ş—nup
;

515 ; 
do_dissim¬
 && 
j
 < 
	`­Ş_veùÜ_g‘_size
(
acûs£sB
); j++) {

516 
b
 = (
­Ş_ty³s_»ÏtiÚ_acûss_t
 *è
	`­Ş_veùÜ_g‘_–em’t
(
acûs£sB
, 
j
);

517 ià(
	`­Ş_ty³s_»ÏtiÚ_acûss_­³nd
(
p
, 
b
, 
r
->
disB
) < 0) {

518 
ş—nup
;

522 
»tv®
 = 0;

523 
ş—nup
:

524 
	`­Ş_veùÜ_de¡roy
(&
acûs£sA
);

525 
	`­Ş_veùÜ_de¡roy
(&
acûs£sB
);

526  
»tv®
;

527 
	}
}

541 
	$­Ş_ty³s_»ÏtiÚ_®lows
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
qpŞ_ty³_t
 * 
ty³A
, cÚ¡ qpŞ_ty³_ˆ* 
ty³B
,

542 
­Ş_ty³s_»ÏtiÚ_»suÉ_t
 * 
r
)

544 cÚ¡ *
ÇmeA
, *
ÇmeB
;

545 
­Ş_avruË_qu”y_t
 *
aq
 = 
NULL
;

546 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

547 
»tv®
 = -1;

549 ià(
	`qpŞ_ty³_g‘_Çme
(
p
->p, 
ty³A
, &
ÇmeA
è< 0 || qpŞ_ty³_g‘_ÇmeÕ->p, 
ty³B
, &
ÇmeB
) < 0) {

550 
ş—nup
;

552 ià((
aq
 = 
	`­Ş_avruË_qu”y_ü—‹
()è=ğ
NULL
) {

553 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

554 
ş—nup
;

556 ià(
	`­Ş_avruË_qu”y_£t_ruËs
(
p
, 
aq
, 
QPOL_RULE_ALLOW
) < 0 ||

557 
	`­Ş_avruË_qu”y_£t_sourû
(
p
, 
aq
, 
ÇmeA
, 1) < 0 ||

558 
	`­Ş_avruË_qu”y_£t_rg‘
(
p
, 
aq
, 
ÇmeB
, 1è< 0 || 
	`­Ş_avruË_g‘_by_qu”y
Õ,‡q, &
r
->
®lows
) < 0) {

559 
ş—nup
;

561 ià(
	`­Ş_avruË_qu”y_£t_sourû
(
p
, 
aq
, 
ÇmeB
, 1) < 0 ||

562 
	`­Ş_avruË_qu”y_£t_rg‘
(
p
, 
aq
, 
ÇmeA
, 1è< 0 || 
	`­Ş_avruË_g‘_by_qu”y
Õ,‡q, &
v
) < 0) {

563 
ş—nup
;

565 ià(
	`­Ş_veùÜ_ÿt
(
r
->
®lows
, 
v
) < 0) {

566 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

567 
ş—nup
;

569 
»tv®
 = 0;

570 
ş—nup
:

571 
	`­Ş_avruË_qu”y_de¡roy
(&
aq
);

572 
	`­Ş_veùÜ_de¡roy
(&
v
);

573  
»tv®
;

574 
	}
}

589 
	$­Ş_ty³s_»ÏtiÚ_ty³s
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
qpŞ_ty³_t
 * 
ty³A
, cÚ¡ qpŞ_ty³_ˆ* 
ty³B
,

590 
­Ş_ty³s_»ÏtiÚ_»suÉ_t
 * 
r
)

592 cÚ¡ *
ÇmeA
, *
ÇmeB
;

593 
­Ş_‹ruË_qu”y_t
 *
tq
 = 
NULL
;

594 
­Ş_veùÜ_t
 *
v
 = 
NULL
, *
ÿndid©e_ty³s
 = NULL;

595 cÚ¡ 
qpŞ_‹ruË_t
 *
ruË
;

596 cÚ¡ 
qpŞ_ty³_t
 *
rg‘
, *
deçuÉ_ty³
;

597 
size_t
 
i
, 
j
;

598 
»tv®
 = -1;

600 ià(
	`qpŞ_ty³_g‘_Çme
(
p
->p, 
ty³A
, &
ÇmeA
è< 0 || qpŞ_ty³_g‘_ÇmeÕ->p, 
ty³B
, &
ÇmeB
) < 0) {

601 
ş—nup
;

603 ià((
r
->
ty³s
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)è=ğNULL || (
tq
 = 
	`­Ş_‹ruË_qu”y_ü—‹
()) == NULL) {

604 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

605 
ş—nup
;

607 ià(
	`­Ş_‹ruË_qu”y_£t_ruËs
(
p
, 
tq
, 
QPOL_RULE_TYPE_TRANS
 | 
QPOL_RULE_TYPE_CHANGE
) < 0 ||

608 
	`­Ş_‹ruË_qu”y_£t_sourû
(
p
, 
tq
, 
ÇmeA
, 1) < 0 ||

609 
	`­Ş_‹ruË_g‘_by_qu”y
(
p
, 
tq
, &
v
) < 0 ||

610 (
ÿndid©e_ty³s
 = 
	`­Ş_qu”y_ü—‹_ÿndid©e_ty³_li¡
(
p
, 
ÇmeB
, 0, 1, 
APOL_QUERY_SYMBOL_IS_BOTH
)è=ğ
NULL
) {

611 
ş—nup
;

613 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v
); i++) {

614 
ruË
 = (
qpŞ_‹ruË_t
 *è
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

615 ià(
	`qpŞ_‹ruË_g‘_rg‘_ty³
(
p
->p, 
ruË
, &
rg‘
) < 0 ||

616 
	`qpŞ_‹ruË_g‘_deçuÉ_ty³
(
p
->p, 
ruË
, &
deçuÉ_ty³
) < 0) {

617 
ş—nup
;

619 ià((
	`­Ş_veùÜ_g‘_šdex
(
ÿndid©e_ty³s
, 
rg‘
, 
NULL
, NULL, &
j
) == 0 ||

620 
	`­Ş_veùÜ_g‘_šdex
(
ÿndid©e_ty³s
, 
deçuÉ_ty³
, 
NULL
, NULL, &
j
) == 0) &&

621 
	`­Ş_veùÜ_­³nd
(
r
->
ty³s
, (*)
ruË
) < 0) {

622 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

623 
ş—nup
;

627 
	`­Ş_veùÜ_de¡roy
(&
v
);

628 
	`­Ş_veùÜ_de¡roy
(&
ÿndid©e_ty³s
);

629 ià(
	`­Ş_‹ruË_qu”y_£t_sourû
(
p
, 
tq
, 
ÇmeB
, 1) < 0 ||

630 
	`­Ş_‹ruË_g‘_by_qu”y
(
p
, 
tq
, &
v
) < 0 ||

631 (
ÿndid©e_ty³s
 = 
	`­Ş_qu”y_ü—‹_ÿndid©e_ty³_li¡
(
p
, 
ÇmeA
, 0, 1, 
APOL_QUERY_SYMBOL_IS_BOTH
)è=ğ
NULL
) {

632 
ş—nup
;

634 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v
); i++) {

635 
ruË
 = (
qpŞ_‹ruË_t
 *è
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

636 ià(
	`qpŞ_‹ruË_g‘_rg‘_ty³
(
p
->p, 
ruË
, &
rg‘
) < 0 ||

637 
	`qpŞ_‹ruË_g‘_deçuÉ_ty³
(
p
->p, 
ruË
, &
deçuÉ_ty³
) < 0) {

638 
ş—nup
;

640 ià((
	`­Ş_veùÜ_g‘_šdex
(
ÿndid©e_ty³s
, 
rg‘
, 
NULL
, NULL, &
j
) == 0 ||

641 
	`­Ş_veùÜ_g‘_šdex
(
ÿndid©e_ty³s
, 
deçuÉ_ty³
, 
NULL
, NULL, &
j
) == 0) &&

642 
	`­Ş_veùÜ_­³nd
(
r
->
ty³s
, (*)
ruË
) < 0) {

643 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

644 
ş—nup
;

648 
»tv®
 = 0;

649 
ş—nup
:

650 
	`­Ş_‹ruË_qu”y_de¡roy
(&
tq
);

651 
	`­Ş_veùÜ_de¡roy
(&
v
);

652 
	`­Ş_veùÜ_de¡roy
(&
ÿndid©e_ty³s
);

653  
»tv®
;

654 
	}
}

668 
	$­Ş_ty³s_»ÏtiÚ_şÚe_šfoæow
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
­Ş_veùÜ_t
 * 
v
, cÚ¡ *
rg‘_Çme
,

669 
­Ş_veùÜ_t
 * 
»suÉs
)

671 
­Ş_veùÜ_t
 *
ÿndid©e_ty³s
 = 
NULL
;

672 cÚ¡ 
qpŞ_ty³_t
 *
rg‘
;

673 
­Ş_šfoæow_»suÉ_t
 *
»s
, *
Ãw_»s
;

674 
size_t
 
i
, 
j
;

675 
»tv®
 = -1;

676 ià((
ÿndid©e_ty³s
 = 
	`­Ş_qu”y_ü—‹_ÿndid©e_ty³_li¡
(
p
, 
rg‘_Çme
, 0, 1, 
APOL_QUERY_SYMBOL_IS_BOTH
)è=ğ
NULL
) {

677 
ş—nup
;

679 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v
); i++) {

680 
»s
 = (
­Ş_šfoæow_»suÉ_t
 *è
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

681 
rg‘
 = 
	`­Ş_šfoæow_»suÉ_g‘_’d_ty³
(
»s
);

682 ià(
	`­Ş_veùÜ_g‘_šdex
(
ÿndid©e_ty³s
, 
rg‘
, 
NULL
, NULL, &
j
) == 0) {

683 ià((
Ãw_»s
 = 
	`šfoæow_»suÉ_ü—‹_äom_šfoæow_»suÉ
(
»s
)è=ğ
NULL
 ||

684 
	`­Ş_veùÜ_­³nd
(
»suÉs
, 
Ãw_»s
) < 0) {

685 
	`šfoæow_»suÉ_ä“
(
Ãw_»s
);

686 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

687 
ş—nup
;

691 
»tv®
 = 0;

692 
ş—nup
:

693 
	`­Ş_veùÜ_de¡roy
(&
ÿndid©e_ty³s
);

694  
»tv®
;

695 
	}
}

708 
	$­Ş_ty³s_»ÏtiÚ_dœeùæow
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
,

709 cÚ¡ 
qpŞ_ty³_t
 * 
ty³A
, cÚ¡ qpŞ_ty³_ˆ* 
ty³B
, 
­Ş_ty³s_»ÏtiÚ_»suÉ_t
 * 
r
)

711 cÚ¡ *
ÇmeA
, *
ÇmeB
;

712 
­Ş_šfoæow_ª®ysis_t
 *
Ÿ
 = 
NULL
;

713 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

714 
­Ş_šfoæow_g¿ph_t
 *
g
 = 
NULL
;

715 
»tv®
 = -1;

717 ià(
	`qpŞ_ty³_g‘_Çme
(
p
->p, 
ty³A
, &
ÇmeA
è< 0 || qpŞ_ty³_g‘_ÇmeÕ->p, 
ty³B
, &
ÇmeB
) < 0) {

718 
ş—nup
;

720 ià((
r
->
dœæows
 = 
	`­Ş_veùÜ_ü—‹
(
šfoæow_»suÉ_ä“
)è=ğ
NULL
 || (
Ÿ
 = 
	`­Ş_šfoæow_ª®ysis_ü—‹
()) == NULL) {

721 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

722 
ş—nup
;

724 ià(
	`­Ş_šfoæow_ª®ysis_£t_mode
(
p
, 
Ÿ
, 
APOL_INFOFLOW_MODE_DIRECT
) < 0 ||

725 
	`­Ş_šfoæow_ª®ysis_£t_dœ
(
p
, 
Ÿ
, 
APOL_INFOFLOW_EITHER
) < 0 ||

726 
	`­Ş_šfoæow_ª®ysis_£t_ty³
(
p
, 
Ÿ
, 
ÇmeA
è< 0 || 
	`­Ş_šfoæow_ª®ysis_do
Õ, ia, &
v
, &
g
) < 0) {

727 
ş—nup
;

729 ià(
	`­Ş_ty³s_»ÏtiÚ_şÚe_šfoæow
(
p
, 
v
, 
ÇmeB
, 
r
->
dœæows
) < 0) {

730 
ş—nup
;

733 
»tv®
 = 0;

734 
ş—nup
:

735 
	`­Ş_veùÜ_de¡roy
(&
v
);

736 
	`­Ş_šfoæow_ª®ysis_de¡roy
(&
Ÿ
);

737 
	`­Ş_šfoæow_g¿ph_de¡roy
(&
g
);

738  
»tv®
;

739 
	}
}

753 
	$­Ş_ty³s_»ÏtiÚ_Œªsæow
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
,

754 cÚ¡ 
qpŞ_ty³_t
 * 
ty³A
,

755 cÚ¡ 
qpŞ_ty³_t
 * 
ty³B
,

756 
do_ŒªsAB
, 
do_ŒªsBA
, 
­Ş_ty³s_»ÏtiÚ_»suÉ_t
 * 
r
)

758 cÚ¡ *
ÇmeA
, *
ÇmeB
;

759 
­Ş_šfoæow_ª®ysis_t
 *
Ÿ
 = 
NULL
;

760 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

761 
­Ş_šfoæow_g¿ph_t
 *
g
 = 
NULL
;

762 
»tv®
 = -1;

764 ià(
	`qpŞ_ty³_g‘_Çme
(
p
->p, 
ty³A
, &
ÇmeA
è< 0 || qpŞ_ty³_g‘_ÇmeÕ->p, 
ty³B
, &
ÇmeB
) < 0) {

765 
ş—nup
;

767 ià((
Ÿ
 = 
	`­Ş_šfoæow_ª®ysis_ü—‹
()è=ğ
NULL
) {

768 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

769 
ş—nup
;

771 ià(
	`­Ş_šfoæow_ª®ysis_£t_mode
(
p
, 
Ÿ
, 
APOL_INFOFLOW_MODE_TRANS
) < 0 ||

772 
	`­Ş_šfoæow_ª®ysis_£t_dœ
(
p
, 
Ÿ
, 
APOL_INFOFLOW_OUT
) < 0) {

773 
ş—nup
;

775 ià(
do_ŒªsAB
) {

776 ià(
	`­Ş_šfoæow_ª®ysis_£t_ty³
(
p
, 
Ÿ
, 
ÇmeA
è< 0 || 
	`­Ş_šfoæow_ª®ysis_do
Õ, ia, &
v
, &
g
) < 0) {

777 
ş—nup
;

779 ià((
r
->
ŒªsAB
 = 
	`­Ş_veùÜ_ü—‹
(
šfoæow_»suÉ_ä“
)è=ğ
NULL
) {

780 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

781 
ş—nup
;

783 ià(
	`­Ş_ty³s_»ÏtiÚ_şÚe_šfoæow
(
p
, 
v
, 
ÇmeB
, 
r
->
ŒªsAB
) < 0) {

784 
ş—nup
;

787 ià(
do_ŒªsBA
) {

788 
	`­Ş_veùÜ_de¡roy
(&
v
);

789 ià((
do_ŒªsAB
 &&

790 
	`­Ş_šfoæow_ª®ysis_do_mÜe
(
p
, 
g
, 
ÇmeB
, &
v
) < 0) ||

791 (!
do_ŒªsAB
 &&

792 (
	`­Ş_šfoæow_ª®ysis_£t_ty³
(
p
, 
Ÿ
, 
ÇmeB
è< 0 || 
	`­Ş_šfoæow_ª®ysis_do
Õ, ia, &
v
, &
g
) < 0))) {

793 
ş—nup
;

795 ià((
r
->
ŒªsBA
 = 
	`­Ş_veùÜ_ü—‹
(
šfoæow_»suÉ_ä“
)è=ğ
NULL
) {

796 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

797 
ş—nup
;

799 ià(
	`­Ş_ty³s_»ÏtiÚ_şÚe_šfoæow
(
p
, 
v
, 
ÇmeA
, 
r
->
ŒªsBA
) < 0) {

800 
ş—nup
;

803 
»tv®
 = 0;

804 
ş—nup
:

805 
	`­Ş_veùÜ_de¡roy
(&
v
);

806 
	`­Ş_šfoæow_ª®ysis_de¡roy
(&
Ÿ
);

807 
	`­Ş_šfoæow_g¿ph_de¡roy
(&
g
);

808  
»tv®
;

809 
	}
}

825 
	$­Ş_ty³s_»ÏtiÚ_şÚe_domašŒªs
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
­Ş_veùÜ_t
 * 
v
, cÚ¡ *
rg‘_Çme
,

826 
­Ş_veùÜ_t
 * 
»suÉs
)

828 
­Ş_veùÜ_t
 *
ÿndid©e_ty³s
 = 
NULL
;

829 cÚ¡ 
qpŞ_ty³_t
 *
rg‘
;

830 
­Ş_domaš_Œªs_»suÉ_t
 *
»s
, *
Ãw_»s
;

831 
size_t
 
i
, 
j
;

832 
»tv®
 = -1;

833 ià((
ÿndid©e_ty³s
 = 
	`­Ş_qu”y_ü—‹_ÿndid©e_ty³_li¡
(
p
, 
rg‘_Çme
, 0, 1, 
APOL_QUERY_SYMBOL_IS_BOTH
)è=ğ
NULL
) {

834 
ş—nup
;

836 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v
); i++) {

837 
»s
 = (
­Ş_domaš_Œªs_»suÉ_t
 *è
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

838 
rg‘
 = 
	`­Ş_domaš_Œªs_»suÉ_g‘_’d_ty³
(
»s
);

839 ià(
	`­Ş_veùÜ_g‘_šdex
(
ÿndid©e_ty³s
, 
rg‘
, 
NULL
, NULL, &
j
) == 0) {

840 ià((
Ãw_»s
 = 
	`­Ş_domaš_Œªs_»suÉ_ü—‹_äom_domaš_Œªs_»suÉ
(
»s
)è=ğ
NULL
 ||

841 
	`­Ş_veùÜ_­³nd
(
»suÉs
, 
Ãw_»s
) < 0) {

842 
	`domaš_Œªs_»suÉ_ä“
(
Ãw_»s
);

843 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

844 
ş—nup
;

848 
»tv®
 = 0;

849 
ş—nup
:

850 
	`­Ş_veùÜ_de¡roy
(&
ÿndid©e_ty³s
);

851  
»tv®
;

852 
	}
}

866 
	$­Ş_ty³s_»ÏtiÚ_domaš
(
­Ş_pŞicy_t
 * 
p
,

867 cÚ¡ 
qpŞ_ty³_t
 * 
ty³A
,

868 cÚ¡ 
qpŞ_ty³_t
 * 
ty³B
,

869 
do_domašsAB
, 
do_domašsBA
, 
­Ş_ty³s_»ÏtiÚ_»suÉ_t
 * 
r
)

871 cÚ¡ *
ÇmeA
, *
ÇmeB
;

872 
­Ş_domaš_Œªs_ª®ysis_t
 *
d
 = 
NULL
;

873 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

874 
»tv®
 = -1;

876 ià(
	`qpŞ_ty³_g‘_Çme
(
p
->p, 
ty³A
, &
ÇmeA
è< 0 || qpŞ_ty³_g‘_ÇmeÕ->p, 
ty³B
, &
ÇmeB
) < 0) {

877 
ş—nup
;

879 ià((
d
 = 
	`­Ş_domaš_Œªs_ª®ysis_ü—‹
()è=ğ
NULL
) {

880 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

881 
ş—nup
;

883 ià(
	`­Ş_pŞicy_bud_domaš_Œªs_bË
(
p
) < 0 ||

884 
	`­Ş_domaš_Œªs_ª®ysis_£t_dœeùiÚ
(
p
, 
d
, 
APOL_DOMAIN_TRANS_DIRECTION_FORWARD
) < 0) {

885 
ş—nup
;

887 ià(
do_domašsAB
) {

888 
	`­Ş_pŞicy_»£t_domaš_Œªs_bË
(
p
);

889 ià(
	`­Ş_domaš_Œªs_ª®ysis_£t_¡¬t_ty³
(
p
, 
d
, 
ÇmeA
è< 0 || 
	`­Ş_domaš_Œªs_ª®ysis_do
Õ, d, &
v
) < 0) {

890 
ş—nup
;

892 ià((
r
->
domsAB
 = 
	`­Ş_veùÜ_ü—‹
(
domaš_Œªs_»suÉ_ä“
)è=ğ
NULL
) {

893 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

894 
ş—nup
;

896 ià(
	`­Ş_ty³s_»ÏtiÚ_şÚe_domašŒªs
(
p
, 
v
, 
ÇmeB
, 
r
->
domsAB
) < 0) {

897 
ş—nup
;

900 ià(
do_domašsBA
) {

901 
	`­Ş_veùÜ_de¡roy
(&
v
);

902 
	`­Ş_pŞicy_»£t_domaš_Œªs_bË
(
p
);

903 ià(
	`­Ş_domaš_Œªs_ª®ysis_£t_¡¬t_ty³
(
p
, 
d
, 
ÇmeB
è< 0 || 
	`­Ş_domaš_Œªs_ª®ysis_do
Õ, d, &
v
) < 0) {

904 
ş—nup
;

906 ià((
r
->
domsBA
 = 
	`­Ş_veùÜ_ü—‹
(
domaš_Œªs_»suÉ_ä“
)è=ğ
NULL
) {

907 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

908 
ş—nup
;

910 ià(
	`­Ş_ty³s_»ÏtiÚ_şÚe_domašŒªs
(
p
, 
v
, 
ÇmeA
, 
r
->
domsBA
) < 0) {

911 
ş—nup
;

914 
»tv®
 = 0;

915 
ş—nup
:

916 
	`­Ş_veùÜ_de¡roy
(&
v
);

917 
	`­Ş_domaš_Œªs_ª®ysis_de¡roy
(&
d
);

918  
»tv®
;

919 
	}
}

923 
	$­Ş_ty³s_»ÏtiÚ_ª®ysis_do
(
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
­Ş_ty³s_»ÏtiÚ_ª®ysis_t
 * 
Œ
, 
­Ş_ty³s_»ÏtiÚ_»suÉ_t
 ** 
r
)

925 cÚ¡ 
qpŞ_ty³_t
 *
ty³A
, *
ty³B
;

926 
i§‰rA
, 
i§‰rB
;

927 
do_sim¬_acûss
, 
do_dissim¬_acûss
;

928 
do_ŒªsAB
, 
do_ŒªsBA
;

929 
do_domašAB
, 
do_domašBA
;

930 
»tv®
 = -1;

931 *
r
 = 
NULL
;

933 ià(
Œ
->
ty³A
 =ğ
NULL
 ||r->
ty³B
 == NULL) {

934 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
EINVAL
));

935 
ş—nup
;

937 ià(
	`­Ş_qu”y_g‘_ty³
(
p
, 
Œ
->
ty³A
, &typeA) < 0 ||

938 
	`­Ş_qu”y_g‘_ty³
(
p
, 
Œ
->
ty³B
, &typeB) < 0 ||

939 
	`qpŞ_ty³_g‘_i§‰r
(
p
->p, 
ty³A
, &
i§‰rA
è< 0 || qpŞ_ty³_g‘_i§‰rÕ->p, 
ty³B
, &
i§‰rB
) < 0) {

940 
ş—nup
;

942 ià(
i§‰rA
) {

943 
	`ERR
(
p
, "SymbŞ % i ª‡‰ribu‹.", 
Œ
->
ty³A
);

944 
ş—nup
;

946 ià(
i§‰rB
) {

947 
	`ERR
(
p
, "SymbŞ % i ª‡‰ribu‹.", 
Œ
->
ty³B
);

948 
ş—nup
;

950 ià((*
r
 = 
	`ÿÎoc
(1, (**r))è=ğ
NULL
) {

951 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

952 
ş—nup
;

954 ià((
Œ
->
ª®y£s
 & 
APOL_TYPES_RELATION_COMMON_ATTRIBS
è&& 
	`­Ş_ty³s_»ÏtiÚ_commÚ_©Œibs
(
p
, 
ty³A
, 
ty³B
, *
r
) < 0) {

955 
ş—nup
;

957 ià((
Œ
->
ª®y£s
 & 
APOL_TYPES_RELATION_COMMON_ROLES
è&& 
	`­Ş_ty³s_»ÏtiÚ_commÚ_rŞes
(
p
, 
ty³A
, 
ty³B
, *
r
) < 0) {

958 
ş—nup
;

960 ià((
Œ
->
ª®y£s
 & 
APOL_TYPES_RELATION_COMMON_USERS
è&& 
	`­Ş_ty³s_»ÏtiÚ_commÚ_u£rs
(
p
, 
ty³A
, 
ty³B
, *
r
) < 0) {

961 
ş—nup
;

963 
do_sim¬_acûss
 = 
Œ
->
ª®y£s
 & 
APOL_TYPES_RELATION_SIMILAR_ACCESS
;

964 
do_dissim¬_acûss
 = 
Œ
->
ª®y£s
 & 
APOL_TYPES_RELATION_DISSIMILAR_ACCESS
;

965 ià((
do_sim¬_acûss
 || 
do_dissim¬_acûss
) &&

966 
	`­Ş_ty³s_»ÏtiÚ_acûs£s
(
p
, 
ty³A
, 
ty³B
, 
do_sim¬_acûss
, 
do_dissim¬_acûss
, *
r
) < 0) {

967 
ş—nup
;

969 ià((
Œ
->
ª®y£s
 & 
APOL_TYPES_RELATION_ALLOW_RULES
è&& 
	`­Ş_ty³s_»ÏtiÚ_®lows
(
p
, 
ty³A
, 
ty³B
, *
r
) < 0) {

970 
ş—nup
;

972 ià((
Œ
->
ª®y£s
 & 
APOL_TYPES_RELATION_TYPE_RULES
è&& 
	`­Ş_ty³s_»ÏtiÚ_ty³s
(
p
, 
ty³A
, 
ty³B
, *
r
) < 0) {

973 
ş—nup
;

975 ià((
Œ
->
ª®y£s
 & 
APOL_TYPES_RELATION_DIRECT_FLOW
è&& 
	`­Ş_ty³s_»ÏtiÚ_dœeùæow
(
p
, 
ty³A
, 
ty³B
, *
r
) < 0) {

976 
ş—nup
;

978 
do_ŒªsAB
 = 
Œ
->
ª®y£s
 & 
APOL_TYPES_RELATION_TRANS_FLOW_AB
;

979 
do_ŒªsBA
 = 
Œ
->
ª®y£s
 & 
APOL_TYPES_RELATION_TRANS_FLOW_BA
;

980 ià((
do_ŒªsAB
 || 
do_ŒªsBA
è&& 
	`­Ş_ty³s_»ÏtiÚ_Œªsæow
(
p
, 
ty³A
, 
ty³B
, do_ŒªsAB, do_ŒªsBA, *
r
) < 0) {

981 
ş—nup
;

983 
do_domašAB
 = 
Œ
->
ª®y£s
 & 
APOL_TYPES_RELATION_DOMAIN_TRANS_AB
;

984 
do_domašBA
 = 
Œ
->
ª®y£s
 & 
APOL_TYPES_RELATION_DOMAIN_TRANS_BA
;

985 ià((
do_domašAB
 || 
do_domašBA
è&& 
	`­Ş_ty³s_»ÏtiÚ_domaš
(
p
, 
ty³A
, 
ty³B
, do_domašAB, do_domašBA, *
r
) < 0) {

986 
ş—nup
;

989 
»tv®
 = 0;

990 
ş—nup
:

991 ià(
»tv®
 != 0) {

992 
	`­Ş_ty³s_»ÏtiÚ_»suÉ_de¡roy
(
r
);

994  
»tv®
;

995 
	}
}

997 
­Ş_ty³s_»ÏtiÚ_ª®ysis_t
 *
	$­Ş_ty³s_»ÏtiÚ_ª®ysis_ü—‹
()

999  
	`ÿÎoc
(1, (
­Ş_ty³s_»ÏtiÚ_ª®ysis_t
));

1000 
	}
}

1002 
	$­Ş_ty³s_»ÏtiÚ_ª®ysis_de¡roy
(
­Ş_ty³s_»ÏtiÚ_ª®ysis_t
 ** 
Œ
)

1004 ià(*
Œ
 !ğ
NULL
) {

1005 
	`ä“
((*
Œ
)->
ty³A
);

1006 
	`ä“
((*
Œ
)->
ty³B
);

1007 
	`ä“
(*
Œ
);

1008 *
Œ
 = 
NULL
;

1010 
	}
}

1012 
	$­Ş_ty³s_»ÏtiÚ_ª®ysis_£t_fœ¡_ty³
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_ty³s_»ÏtiÚ_ª®ysis_t
 * 
Œ
, cÚ¡ *
Çme
)

1014 ià(
Çme
 =ğ
NULL
) {

1015 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
EINVAL
));

1018  
	`­Ş_qu”y_£t
(
p
, &
Œ
->
ty³A
, 
NULL
, 
Çme
);

1019 
	}
}

1021 
	$­Ş_ty³s_»ÏtiÚ_ª®ysis_£t_Ùh”_ty³
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_ty³s_»ÏtiÚ_ª®ysis_t
 * 
Œ
, cÚ¡ *
Çme
)

1023 ià(
Çme
 =ğ
NULL
) {

1024 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
EINVAL
));

1027  
	`­Ş_qu”y_£t
(
p
, &
Œ
->
ty³B
, 
NULL
, 
Çme
);

1028 
	}
}

1030 
­Ş_ty³s_»ÏtiÚ_ª®ysis_£t_ª®y£s
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
 
__©Œibu‹__
 ((
unu£d
)),

1031 
­Ş_ty³s_»ÏtiÚ_ª®ysis_t
 * 
Œ
, 
ª®y£s
)

1033 ià(
	gª®y£s
 != 0) {

1034 
Œ
->
ª®y£s
 =‡nalyses;

1036 
	gŒ
->
	gª®y£s
 = ~0U;

1043 
	$­Ş_ty³s_»ÏtiÚ_»suÉ_de¡roy
(
­Ş_ty³s_»ÏtiÚ_»suÉ_t
 ** 
»suÉ
)

1045 ià(*
»suÉ
 !ğ
NULL
) {

1046 
	`­Ş_veùÜ_de¡roy
(&(*
»suÉ
)->
©Œibs
);

1047 
	`­Ş_veùÜ_de¡roy
(&(*
»suÉ
)->
rŞes
);

1048 
	`­Ş_veùÜ_de¡roy
(&(*
»suÉ
)->
u£rs
);

1049 
	`­Ş_veùÜ_de¡roy
(&(*
»suÉ
)->
simA
);

1050 
	`­Ş_veùÜ_de¡roy
(&(*
»suÉ
)->
simB
);

1051 
	`­Ş_veùÜ_de¡roy
(&(*
»suÉ
)->
disA
);

1052 
	`­Ş_veùÜ_de¡roy
(&(*
»suÉ
)->
disB
);

1053 
	`­Ş_veùÜ_de¡roy
(&(*
»suÉ
)->
®lows
);

1054 
	`­Ş_veùÜ_de¡roy
(&(*
»suÉ
)->
ty³s
);

1055 
	`­Ş_veùÜ_de¡roy
(&(*
»suÉ
)->
dœæows
);

1056 
	`­Ş_veùÜ_de¡roy
(&(*
»suÉ
)->
ŒªsAB
);

1057 
	`­Ş_veùÜ_de¡roy
(&(*
»suÉ
)->
ŒªsBA
);

1058 
	`­Ş_veùÜ_de¡roy
(&(*
»suÉ
)->
domsAB
);

1059 
	`­Ş_veùÜ_de¡roy
(&(*
»suÉ
)->
domsBA
);

1060 
	`ä“
(*
»suÉ
);

1061 *
»suÉ
 = 
NULL
;

1063 
	}
}

1065 cÚ¡ 
­Ş_veùÜ_t
 *
	$­Ş_ty³s_»ÏtiÚ_»suÉ_g‘_©Œibu‹s
(cÚ¡ 
­Ş_ty³s_»ÏtiÚ_»suÉ_t
 * 
»suÉ
)

1067  
»suÉ
->
©Œibs
;

1068 
	}
}

1070 cÚ¡ 
­Ş_veùÜ_t
 *
	$­Ş_ty³s_»ÏtiÚ_»suÉ_g‘_rŞes
(cÚ¡ 
­Ş_ty³s_»ÏtiÚ_»suÉ_t
 * 
»suÉ
)

1072  
»suÉ
->
rŞes
;

1073 
	}
}

1075 cÚ¡ 
­Ş_veùÜ_t
 *
	$­Ş_ty³s_»ÏtiÚ_»suÉ_g‘_u£rs
(cÚ¡ 
­Ş_ty³s_»ÏtiÚ_»suÉ_t
 * 
»suÉ
)

1077  
»suÉ
->
u£rs
;

1078 
	}
}

1080 cÚ¡ 
­Ş_veùÜ_t
 *
	$­Ş_ty³s_»ÏtiÚ_»suÉ_g‘_sim¬_fœ¡
(cÚ¡ 
­Ş_ty³s_»ÏtiÚ_»suÉ_t
 * 
»suÉ
)

1082  
»suÉ
->
simA
;

1083 
	}
}

1085 cÚ¡ 
­Ş_veùÜ_t
 *
	$­Ş_ty³s_»ÏtiÚ_»suÉ_g‘_sim¬_Ùh”
(cÚ¡ 
­Ş_ty³s_»ÏtiÚ_»suÉ_t
 * 
»suÉ
)

1087  
»suÉ
->
simB
;

1088 
	}
}

1090 cÚ¡ 
­Ş_veùÜ_t
 *
	$­Ş_ty³s_»ÏtiÚ_»suÉ_g‘_dissim¬_fœ¡
(cÚ¡ 
­Ş_ty³s_»ÏtiÚ_»suÉ_t
 * 
»suÉ
)

1092  
»suÉ
->
disA
;

1093 
	}
}

1095 cÚ¡ 
­Ş_veùÜ_t
 *
	$­Ş_ty³s_»ÏtiÚ_»suÉ_g‘_dissim¬_Ùh”
(cÚ¡ 
­Ş_ty³s_»ÏtiÚ_»suÉ_t
 * 
»suÉ
)

1097  
»suÉ
->
disB
;

1098 
	}
}

1100 cÚ¡ 
­Ş_veùÜ_t
 *
	$­Ş_ty³s_»ÏtiÚ_»suÉ_g‘_®lowruËs
(cÚ¡ 
­Ş_ty³s_»ÏtiÚ_»suÉ_t
 * 
»suÉ
)

1102  
»suÉ
->
®lows
;

1103 
	}
}

1105 cÚ¡ 
­Ş_veùÜ_t
 *
	$­Ş_ty³s_»ÏtiÚ_»suÉ_g‘_ty³ruËs
(cÚ¡ 
­Ş_ty³s_»ÏtiÚ_»suÉ_t
 * 
»suÉ
)

1107  
»suÉ
->
ty³s
;

1108 
	}
}

1110 cÚ¡ 
­Ş_veùÜ_t
 *
	$­Ş_ty³s_»ÏtiÚ_»suÉ_g‘_dœeùæows
(cÚ¡ 
­Ş_ty³s_»ÏtiÚ_»suÉ_t
 * 
»suÉ
)

1112  
»suÉ
->
dœæows
;

1113 
	}
}

1115 cÚ¡ 
­Ş_veùÜ_t
 *
	$­Ş_ty³s_»ÏtiÚ_»suÉ_g‘_ŒªsæowsAB
(cÚ¡ 
­Ş_ty³s_»ÏtiÚ_»suÉ_t
 * 
»suÉ
)

1117  
»suÉ
->
ŒªsAB
;

1118 
	}
}

1120 cÚ¡ 
­Ş_veùÜ_t
 *
	$­Ş_ty³s_»ÏtiÚ_»suÉ_g‘_ŒªsæowsBA
(cÚ¡ 
­Ş_ty³s_»ÏtiÚ_»suÉ_t
 * 
»suÉ
)

1122  
»suÉ
->
ŒªsBA
;

1123 
	}
}

1125 cÚ¡ 
­Ş_veùÜ_t
 *
	$­Ş_ty³s_»ÏtiÚ_»suÉ_g‘_domašsAB
(cÚ¡ 
­Ş_ty³s_»ÏtiÚ_»suÉ_t
 * 
»suÉ
)

1127  
»suÉ
->
domsAB
;

1128 
	}
}

1130 cÚ¡ 
­Ş_veùÜ_t
 *
	$­Ş_ty³s_»ÏtiÚ_»suÉ_g‘_domašsBA
(cÚ¡ 
­Ş_ty³s_»ÏtiÚ_»suÉ_t
 * 
»suÉ
)

1132  
»suÉ
->
domsBA
;

1133 
	}
}

1135 cÚ¡ 
qpŞ_ty³_t
 *
	$­Ş_ty³s_»ÏtiÚ_acûss_g‘_ty³
(cÚ¡ 
­Ş_ty³s_»ÏtiÚ_acûss_t
 * 
a
)

1137  
a
->
ty³
;

1138 
	}
}

1140 cÚ¡ 
­Ş_veùÜ_t
 *
	$­Ş_ty³s_»ÏtiÚ_acûss_g‘_ruËs
(cÚ¡ 
­Ş_ty³s_»ÏtiÚ_acûss_t
 * 
a
)

1142  
a
->
ruËs
;

1143 
	}
}

	@libapol/src/user-query.c

30 
	~"pŞicy-qu”y-š‹º®.h
"

32 
	~<”ºo.h
>

34 
	s­Ş_u£r_qu”y


36 *
	mu£r_Çme
, *
	mrŞe_Çme
;

37 
­Ş_mls_Ëv–_t
 *
	mdeçuÉ_Ëv–
;

38 
­Ş_mls_¿nge_t
 *
	m¿nge
;

39 
	mæags
;

40 
»gex_t
 *
	mu£r_»gex
, *
	mrŞe_»gex
;

45 
	$­Ş_u£r_g‘_by_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_u£r_qu”y_t
 * 
u
, 
­Ş_veùÜ_t
 ** 
v
)

47 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
, *
rŞe_™”
 = NULL;

48 
­Ş_mls_Ëv–_t
 *
deçuÉ_Ëv–
 = 
NULL
;

49 
­Ş_mls_¿nge_t
 *
¿nge
 = 
NULL
;

50 
»tv®
 = -1, 
­³nd_u£r
;

51 *
v
 = 
NULL
;

52 ià(
	`qpŞ_pŞicy_g‘_u£r_™”
(
p
->p, &
™”
) < 0) {

55 ià((*
v
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)) == NULL) {

56 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
”ºo
));

57 
ş—nup
;

59 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

60 
qpŞ_u£r_t
 *
u£r
;

61 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
u£r
) < 0) {

62 
ş—nup
;

64 
­³nd_u£r
 = 1;

65 ià(
u
 !ğ
NULL
) {

66 cÚ¡ *
u£r_Çme
;

67 
compv®
;

68 cÚ¡ 
qpŞ_mls_Ëv–_t
 *
mls_deçuÉ_Ëv–
;

69 cÚ¡ 
qpŞ_mls_¿nge_t
 *
mls_¿nge
;

71 
	`qpŞ_™”©Ü_de¡roy
(&
rŞe_™”
);

72 
	`­Ş_mls_Ëv–_de¡roy
(&
deçuÉ_Ëv–
);

73 
	`­Ş_mls_¿nge_de¡roy
(&
¿nge
);

75 ià(
	`qpŞ_u£r_g‘_Çme
(
p
->p, 
u£r
, &
u£r_Çme
) < 0) {

76 
ş—nup
;

78 
compv®
 = 
	`­Ş_com·»
(
p
, 
u£r_Çme
, 
u
->u£r_Çme, u->
æags
, &(u->
u£r_»gex
));

79 ià(
compv®
 < 0) {

80 
ş—nup
;

81 } ià(
compv®
 == 0) {

84 ià(
	`qpŞ_u£r_g‘_rŞe_™”
(
p
->p, 
u£r
, &
rŞe_™”
) < 0) {

85 
ş—nup
;

87 ià(
u
->
rŞe_Çme
 !ğ
NULL
 && u->role_name[0] != '\0') {

88 
­³nd_u£r
 = 0;

89 ; !
	`qpŞ_™”©Ü_’d
(
rŞe_™”
); 
	`qpŞ_™”©Ü_Ãxt
(role_iter)) {

90 
qpŞ_rŞe_t
 *
rŞe
;

91 cÚ¡ *
rŞe_Çme
;

92 ià(
	`qpŞ_™”©Ü_g‘_™em
(
rŞe_™”
, (**)&
rŞe
) < 0 ||

93 
	`qpŞ_rŞe_g‘_Çme
(
p
->p, 
rŞe
, &
rŞe_Çme
) < 0) {

94 
ş—nup
;

96 
compv®
 = 
	`­Ş_com·»
(
p
, 
rŞe_Çme
, 
u
->rŞe_Çme, u->
æags
, &(u->
rŞe_»gex
));

97 ià(
compv®
 < 0) {

98 
ş—nup
;

99 } ià(
compv®
 == 1) {

100 
­³nd_u£r
 = 1;

105 ià(
	`­Ş_pŞicy_is_mls
(
p
)) {

106 ià(
	`qpŞ_u£r_g‘_dæev–
(
p
->p, 
u£r
, &
mls_deçuÉ_Ëv–
) < 0 ||

107 (
deçuÉ_Ëv–
 = 
	`­Ş_mls_Ëv–_ü—‹_äom_qpŞ_mls_Ëv–
(
p
, 
mls_deçuÉ_Ëv–
)è=ğ
NULL
) {

108 
ş—nup
;

110 
compv®
 = 
	`­Ş_mls_Ëv–_com·»
(
p
, 
deçuÉ_Ëv–
, 
u
->default_level);

111 
	`­Ş_mls_Ëv–_de¡roy
(&
deçuÉ_Ëv–
);

112 ià(
compv®
 < 0) {

113 
ş—nup
;

114 } ià(
compv®
 !ğ
APOL_MLS_EQ
) {

118 ià(
	`qpŞ_u£r_g‘_¿nge
(
p
->p, 
u£r
, &
mls_¿nge
) < 0 ||

119 (
¿nge
 = 
	`­Ş_mls_¿nge_ü—‹_äom_qpŞ_mls_¿nge
(
p
, 
mls_¿nge
)è=ğ
NULL
) {

120 
ş—nup
;

122 
compv®
 = 
	`­Ş_mls_¿nge_com·»
(
p
, 
¿nge
, 
u
->¿nge, u->
æags
);

123 
	`­Ş_mls_¿nge_de¡roy
(&
¿nge
);

124 ià(
compv®
 < 0) {

125 
ş—nup
;

126 } ià(
compv®
 == 0) {

131 ià(
­³nd_u£r
 && 
	`­Ş_veùÜ_­³nd
(*
v
, 
u£r
)) {

132 
	`ERR
(
p
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

133 
ş—nup
;

136 
»tv®
 = 0;

137 
ş—nup
:

138 ià(
»tv®
 != 0) {

139 
	`­Ş_veùÜ_de¡roy
(
v
);

141 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

142 
	`qpŞ_™”©Ü_de¡roy
(&
rŞe_™”
);

143 
	`­Ş_mls_Ëv–_de¡roy
(&
deçuÉ_Ëv–
);

144 
	`­Ş_mls_¿nge_de¡roy
(&
¿nge
);

145  
»tv®
;

146 
	}
}

148 
­Ş_u£r_qu”y_t
 *
	$­Ş_u£r_qu”y_ü—‹
()

150  
	`ÿÎoc
(1, (
­Ş_u£r_qu”y_t
));

151 
	}
}

153 
	$­Ş_u£r_qu”y_de¡roy
(
­Ş_u£r_qu”y_t
 ** 
u
)

155 ià(*
u
 !ğ
NULL
) {

156 
	`ä“
((*
u
)->
u£r_Çme
);

157 
	`ä“
((*
u
)->
rŞe_Çme
);

158 
	`­Ş_mls_Ëv–_de¡roy
(&((*
u
)->
deçuÉ_Ëv–
));

159 
	`­Ş_mls_¿nge_de¡roy
(&((*
u
)->
¿nge
));

160 
	`­Ş_»gex_de¡roy
(&(*
u
)->
u£r_»gex
);

161 
	`­Ş_»gex_de¡roy
(&(*
u
)->
rŞe_»gex
);

162 
	`ä“
(*
u
);

163 *
u
 = 
NULL
;

165 
	}
}

167 
	$­Ş_u£r_qu”y_£t_u£r
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_u£r_qu”y_t
 * 
u
, cÚ¡ *
Çme
)

169  
	`­Ş_qu”y_£t
(
p
, &
u
->
u£r_Çme
, &u->
u£r_»gex
, 
Çme
);

170 
	}
}

172 
	$­Ş_u£r_qu”y_£t_rŞe
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_u£r_qu”y_t
 * 
u
, cÚ¡ *
rŞe
)

174  
	`­Ş_qu”y_£t
(
p
, &
u
->
rŞe_Çme
, &u->
rŞe_»gex
, 
rŞe
);

175 
	}
}

177 
­Ş_u£r_qu”y_£t_deçuÉ_Ëv–
(cÚ¡ 
­Ş_pŞicy_t
 * 
p


178 
__©Œibu‹__
 ((
unu£d
)), 
­Ş_u£r_qu”y_t
 * 
u
, 
­Ş_mls_Ëv–_t
 * 
Ëv–
)

180 
	gu
->
	gdeçuÉ_Ëv–
 = 
Ëv–
;

184 
­Ş_u£r_qu”y_£t_¿nge
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
 
__©Œibu‹__
 ((
unu£d
)),

185 
­Ş_u£r_qu”y_t
 * 
u
, 
­Ş_mls_¿nge_t
 * 
¿nge
, 
¿nge_m©ch
)

187 ià(
	gu
->
	g¿nge
 !ğ
NULL
) {

188 
­Ş_mls_¿nge_de¡roy
(&
u
->
¿nge
);

190 
	gu
->
	g¿nge
 = 
¿nge
;

191 
	gu
->
	gæags
 = (
u
->
æags
 & ~
APOL_QUERY_FLAGS
è| 
¿nge_m©ch
;

195 
	$­Ş_u£r_qu”y_£t_»gex
(cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
­Ş_u£r_qu”y_t
 * 
u
, 
is_»gex
)

197  
	`­Ş_qu”y_£t_»gex
(
p
, &
u
->
æags
, 
is_»gex
);

198 
	}
}

	@libapol/src/util.c

26 
	~<cÚfig.h
>

28 
	~<­Ş/ut.h
>

30 
	~<as£¹.h
>

31 
	~<ùy³.h
>

32 
	~<”ºo.h
>

33 
	~<¡dio.h
>

34 
	~<¡ršg.h
>

35 
	~<uni¡d.h
>

36 
	~<¡dboŞ.h
>

39 
	~<qpŞ/nodecÚ_qu”y.h
>

40 
	~<sys/ty³s.h
>

41 
	~<sys/sock‘.h
>

42 
	~<¬·/š‘.h
>

43 
	~<Ãtš‘/š.h
>

46 
	#APOL_LINE_SZ
 8192

	)

47 
	#APOL_ENVIRON_VAR_NAME
 "APOL_INSTALL_DIR"

	)

49 cÚ¡ *
	$lib­Ş_g‘_v”siÚ
()

51  
LIBAPOL_VERSION_STRING
;

52 
	}
}

54 
	$­Ş_¡r_to_š‹º®_
(cÚ¡ *
¡r
, 
ušt32_t
 

[4])

56 
boŞ
 
v4
 = 
çl£
;

57 
boŞ
 
v6
 = 
çl£
;

59 ià(!
¡r
 || !

) {

60 
”ºo
 = 
EINVAL
;

64 

[0] = ip[1] = ip[2] = ip[3] = 0;

66 ià(
	`¡rchr
(
¡r
, '.'))

67 
v4
 = 
Œue
;

69 ià(
	`¡rchr
(
¡r
, ':'))

70 
v6
 = 
Œue
;

72 ià(
v4
 =ğ
v6
) {

73 
”ºo
 = 
EINVAL
;

77 ià(
v4
) {

78 *
p
 = (*)&(

[0]);

79 
£g
 = 0;

80 
ušt32_t
 
v®
 = 0;

81 
size_t
 
Ën
 = 
	`¡¾’
(
¡r
), 
i
;

82 
i
 = 0; i <ğ
Ën
; i++) {

83 ià(
¡r
[
i
] == '.' || str[i] == '\0') {

84 ià(
v®
 > 255) {

85 
”ºo
 = 
EINVAL
;

89 
p
[
£g
] = ()(0xfà& 
v®
);

90 
£g
++;

91 
v®
 = 0;

92 ià(
£g
 == 4)

94 } ià(
	`isdig™
(
¡r
[
i
])) {

95 
tmp
[2] = { 
¡r
[
i
], 0 };

96 
v®
 = v® * 10 + 
	`©oi
(
tmp
);

98 
”ºo
 = 
EINVAL
;

103 
š6_addr
 
addr
;

104 ià(
	`š‘_±Ú
(
AF_INET6
, 
¡r
, &
addr
) <= 0) {

107 
	`memıy
(

, 
addr
.
s6_addr32
, 16);

110  
v4
 ? 
QPOL_IPV4
 : 
QPOL_IPV6
;

111 
	}
}

113 cÚ¡ *
	$­Ş_objşass_to_¡r
(
ušt32_t
 
objşass
)

115 
objşass
) {

116 
QPOL_CLASS_BLK_FILE
:

118 
QPOL_CLASS_CHR_FILE
:

120 
QPOL_CLASS_DIR
:

122 
QPOL_CLASS_FIFO_FILE
:

124 
QPOL_CLASS_FILE
:

126 
QPOL_CLASS_LNK_FILE
:

128 
QPOL_CLASS_SOCK_FILE
:

130 
QPOL_CLASS_ALL
:

133  
NULL
;

134 
	}
}

136 
ušt32_t
 
	$­Ş_¡r_to_objşass
(cÚ¡ *
objşass
)

138 ià(
objşass
 =ğ
NULL
) {

139 
”ºo
 = 
EINVAL
;

142 ià(
	`¡rcmp
(
objşass
, "block") == 0) {

143  
QPOL_CLASS_BLK_FILE
;

145 ià(
	`¡rcmp
(
objşass
, "char") == 0) {

146  
QPOL_CLASS_CHR_FILE
;

148 ià(
	`¡rcmp
(
objşass
, "dir") == 0) {

149  
QPOL_CLASS_DIR
;

151 ià(
	`¡rcmp
(
objşass
, "fifo") == 0) {

152  
QPOL_CLASS_FIFO_FILE
;

154 ià(
	`¡rcmp
(
objşass
, "file") == 0) {

155  
QPOL_CLASS_FILE
;

157 ià(
	`¡rcmp
(
objşass
, "link") == 0) {

158  
QPOL_CLASS_LNK_FILE
;

160 ià(
	`¡rcmp
(
objşass
, "sock") == 0) {

161  
QPOL_CLASS_SOCK_FILE
;

163 ià(
	`¡rcmp
(
objşass
, "any") == 0) {

164  
QPOL_CLASS_ALL
;

167 
	}
}

169 cÚ¡ *
	$­Ş_´ÙocŞ_to_¡r
(
ušt8_t
 
´ÙocŞ
)

171 
´ÙocŞ
) {

172 
IPPROTO_TCP
:

174 
IPPROTO_UDP
:

177 
”ºo
 = 
EPROTONOSUPPORT
;

178  
NULL
;

180 
	}
}

182 
ušt8_t
 
	$­Ş_¡r_to_´ÙocŞ
(cÚ¡ *
´ÙocŞ_¡r
)

184 ià(
´ÙocŞ_¡r
 =ğ
NULL
) {

185 
”ºo
 = 
EINVAL
;

188 ià(
	`¡rcmp
(
´ÙocŞ_¡r
, "tcp") == 0 || strcmp(protocol_str, "TCP") == 0) {

189  
IPPROTO_TCP
;

191 ià(
	`¡rcmp
(
´ÙocŞ_¡r
, "udp") == 0 || strcmp(protocol_str, "UDP") == 0) {

192  
IPPROTO_UDP
;

194 
”ºo
 = 
EPROTONOSUPPORT
;

196 
	}
}

198 cÚ¡ *
	$­Ş_fs_u£_behaviÜ_to_¡r
(
ušt32_t
 
behaviÜ
)

200 
behaviÜ
) {

201 
QPOL_FS_USE_XATTR
:

203 
QPOL_FS_USE_TASK
:

205 
QPOL_FS_USE_TRANS
:

207 
QPOL_FS_USE_GENFS
:

209 
QPOL_FS_USE_NONE
:

211 
QPOL_FS_USE_PSID
:

214  
NULL
;

215 
	}
}

217 
	$­Ş_¡r_to_fs_u£_behaviÜ
(cÚ¡ *
behaviÜ
)

219 ià(
	`¡rcmp
(
behaviÜ
, "fs_use_xattr") == 0) {

220  
QPOL_FS_USE_XATTR
;

221 } ià(
	`¡rcmp
(
behaviÜ
, "fs_use_task") == 0) {

222  
QPOL_FS_USE_TASK
;

223 } ià(
	`¡rcmp
(
behaviÜ
, "fs_use_trans") == 0) {

224  
QPOL_FS_USE_TRANS
;

225 } ià(
	`¡rcmp
(
behaviÜ
, "fs_use_genfs") == 0) {

226  
QPOL_FS_USE_GENFS
;

227 } ià(
	`¡rcmp
(
behaviÜ
, "fs_use_none") == 0) {

228  
QPOL_FS_USE_NONE
;

229 } ià(
	`¡rcmp
(
behaviÜ
, "fs_use_psid") == 0) {

230  
QPOL_FS_USE_PSID
;

233 
	}
}

235 cÚ¡ *
	$­Ş_ruË_ty³_to_¡r
(
ušt32_t
 
ruË_ty³
)

237 
ruË_ty³
) {

238 
QPOL_RULE_ALLOW
:

240 
QPOL_RULE_NEVERALLOW
:

242 
QPOL_RULE_AUDITALLOW
:

244 
QPOL_RULE_DONTAUDIT
:

246 
QPOL_RULE_TYPE_TRANS
:

248 
QPOL_RULE_TYPE_CHANGE
:

250 
QPOL_RULE_TYPE_MEMBER
:

253  
NULL
;

254 
	}
}

256 cÚ¡ *
	$­Ş_cÚd_ex´_ty³_to_¡r
(
ušt32_t
 
ex´_ty³
)

258 
ex´_ty³
) {

259 
QPOL_COND_EXPR_BOOL
:

261 
QPOL_COND_EXPR_NOT
:

263 
QPOL_COND_EXPR_OR
:

265 
QPOL_COND_EXPR_AND
:

267 
QPOL_COND_EXPR_XOR
:

269 
QPOL_COND_EXPR_EQ
:

271 
QPOL_COND_EXPR_NEQ
:

274  
NULL
;

275 
	}
}

277 *
	$­Ş_fe_fšd
(cÚ¡ *
fe_Çme
)

279 *
fe
 = 
NULL
, *
v¬
 = NULL, *
dœs
[3];

280 
size_t
 
i
;

281 
¹
;

283 ià(
fe_Çme
 =ğ
NULL
) {

284 
”ºo
 = 
EINVAL
;

285  
NULL
;

290 
dœs
[0] = ".";

291 
dœs
[1] = 
	`g‘’v
(
APOL_ENVIRON_VAR_NAME
);

292 
dœs
[2] = 
APOL_INSTALL_DIR
;

293 
i
 = 0; i < 3; i++) {

294 ià((
v¬
 = 
dœs
[
i
]è!ğ
NULL
) {

295 ià(
	`a¥rštf
(&
fe
, "%s/%s", 
v¬
, 
fe_Çme
) < 0) {

296  
NULL
;

298 
¹
 = 
	`acûss
(
fe
, 
R_OK
);

299 
	`ä“
(
fe
);

300 ià(
¹
 == 0) {

301  
	`¡rdup
(
v¬
);

307  
NULL
;

308 
	}
}

310 *
	$­Ş_fe_fšd_·th
(cÚ¡ *
fe_Çme
)

312 *
fe
 = 
NULL
, *
v¬
 = NULL, *
dœs
[3];

313 
size_t
 
i
;

314 
¹
;

316 ià(
fe_Çme
 =ğ
NULL
) {

317 
”ºo
 = 
EINVAL
;

318  
NULL
;

323 
dœs
[0] = ".";

324 
dœs
[1] = 
	`g‘’v
(
APOL_ENVIRON_VAR_NAME
);

325 
dœs
[2] = 
APOL_INSTALL_DIR
;

326 
i
 = 0; i < 3; i++) {

327 ià((
v¬
 = 
dœs
[
i
]è!ğ
NULL
) {

328 ià(
	`a¥rštf
(&
fe
, "%s/%s", 
v¬
, 
fe_Çme
) < 0) {

329  
NULL
;

331 
¹
 = 
	`acûss
(
fe
, 
R_OK
);

332 ià(
¹
 == 0) {

333  
fe
;

335 
	`ä“
(
fe
);

340  
NULL
;

341 
	}
}

343 *
	$­Ş_fe_fšd_u£r_cÚfig
(cÚ¡ *
fe_Çme
)

345 *
fe
, *
v¬
;

346 
¹
;

348 ià(
fe_Çme
 =ğ
NULL
) {

349 
”ºo
 = 
EINVAL
;

350  
NULL
;

352 
v¬
 = 
	`g‘’v
("HOME");

353 ià(
v¬
) {

354 ià(
	`a¥rštf
(&
fe
, "%s/%s", 
v¬
, 
fe_Çme
) < 0) {

355  
NULL
;

357 
¹
 = 
	`acûss
(
fe
, 
R_OK
);

358 ià(
¹
 == 0) {

359  
fe
;

361 
	`ä“
(
fe
);

362  
NULL
;

365  
NULL
;

366 
	}
}

368 
	$­Ş_fe_»ad_to_bufãr
(cÚ¡ *
âame
, **
buf
, 
size_t
 * 
Ën
)

370 
FILE
 *
fe
 = 
NULL
;

371 cÚ¡ 
size_t
 
BUF_SIZE
 = 1024;

372 
size_t
 
size
 = 0, 
r
;

373 *
buå
, *
b
;

375 
	`as£¹
(*
buf
 =ğ
NULL
);

376 
	`as£¹
(
Ën
);

377 *
Ën
 = 0;

379 
size
 +ğ
BUF_SIZE
;

380 
r
 = 0;

381 
b
 = (*)
	`»®loc
(*
buf
, 
size
 * ());

382 ià(
b
 =ğ
NULL
) {

383 
	`ä“
(*
buf
);

384 *
buf
 = 
NULL
;

385 *
Ën
 = 0;

386 ià(
fe
)

387 
	`fşo£
(
fe
);

390 *
buf
 = 
b
;

391 ià(!
fe
) {

392 
fe
 = 
	`fİ’
(
âame
, "rb");

393 ià(!
fe
) {

394 
	`ä“
(*
buf
);

395 *
buf
 = 
NULL
;

396 *
Ën
 = 0;

400 
buå
 = &((*
buf
)[
size
 - 
BUF_SIZE
]);

401 
r
 = 
	`ä—d
(
buå
, (), 
BUF_SIZE
, 
fe
);

402 *
Ën
 +ğ
r
;

403 ià(
r
 < 
BUF_SIZE
) {

404 ià(
	`ãof
(
fe
)) {

405 
	`fşo£
(
fe
);

408 
	`ä“
(*
buf
);

409 *
buf
 = 
NULL
;

410 *
Ën
 = 0;

411 
	`fşo£
(
fe
);

417 
	}
}

419 *
	$­Ş_cÚfig_g‘_v¬
(cÚ¡ *
v¬
, 
FILE
 * 
å
)

421 
lše
[
APOL_LINE_SZ
], 
t1
[APOL_LINE_SZ], 
t2
[APOL_LINE_SZ];

422 *
lše_±r
 = 
NULL
;

424 ià(
v¬
 =ğ
NULL
 || 
å
 == NULL) {

425 
”ºo
 = 
EINVAL
;

426  
NULL
;

429 
	`»wšd
(
å
);

430 
	`fg‘s
(
lše
, 
APOL_LINE_SZ
, 
å
è!ğ
NULL
) {

431 ià((
lše_±r
 = 
	`¡rdup
(
lše
)è=ğ
NULL
) {

432  
NULL
;

434 
	`­Ş_¡r_Œim
(
lše_±r
);

435 ià(
lše_±r
[0] =ğ'#' || 
	`ssÿnf
Öše_±r, "% %[^\n]", 
t1
, 
t2
è!ğ2 || 
	`¡rÿ£cmp
(
v¬
,1) != 0) {

436 
	`ä“
(
lše_±r
);

439 
	`ä“
(
lše_±r
);

440  
	`¡rdup
(
t2
);

443  
NULL
;

444 
	}
}

446 
­Ş_veùÜ_t
 *
	$­Ş_¡r_¥l™
(cÚ¡ *
s
, cÚ¡ *
d–im
)

448 *
Üig_s
 = 
NULL
, *
dup_s
 = NULL, *
v
, *
tok’
;

449 
­Ş_veùÜ_t
 *
li¡
 = 
NULL
;

450 
”rÜ
 = 0;

452 ià(
s
 =ğ
NULL
 || 
d–im
 == NULL) {

453 
”rÜ
 = 
EINVAL
;

454 
ş—nup
;

456 ià((
li¡
 = 
	`­Ş_veùÜ_ü—‹
(
ä“
)è=ğ
NULL
 || (
Üig_s
 = 
	`¡rdup
(
s
)) == NULL) {

457 
”rÜ
 = 
”ºo
;

458 
ş—nup
;

460 
v
 = 
Üig_s
;

461 (
tok’
 = 
	`¡r£p
(&
v
, 
d–im
)è!ğ
NULL
) {

462 ià(
	`¡rcmp
(
tok’
, ""è!ğ0 && !
	`­Ş_¡r_is_Úly_wh™e_¥aû
(token)) {

463 ià((
dup_s
 = 
	`¡rdup
(
tok’
)è=ğ
NULL
 || 
	`­Ş_veùÜ_­³nd
(
li¡
, dup_s) < 0) {

464 
”rÜ
 = 
”ºo
;

465 
	`ä“
(
dup_s
);

466 
ş—nup
;

470 
ş—nup
:

471 
	`ä“
(
Üig_s
);

472 ià(
”rÜ
 != 0) {

473 
	`­Ş_veùÜ_de¡roy
(&
li¡
);

474 
”ºo
 = 
”rÜ
;

475  
NULL
;

477  
li¡
;

478 
	}
}

480 *
	$­Ş_¡r_još
(cÚ¡ 
­Ş_veùÜ_t
 * 
li¡
, cÚ¡ *
d–im
)

482 *
v®
, *
s
;

483 
size_t
 
i
, 
Ën
;

485 ià(
li¡
 =ğ
NULL
 || 
d–im
 == NULL) {

486 
”ºo
 = 
EINVAL
;

487  
NULL
;

489 ià(
	`­Ş_veùÜ_g‘_size
(
li¡
) == 0) {

490  
	`¡rdup
("");

492 
s
 = 
	`­Ş_veùÜ_g‘_–em’t
(
li¡
, 0);

493 ià((
v®
 = 
	`¡rdup
(
s
)è=ğ
NULL
) {

494  
NULL
;

496 
Ën
 = 
	`¡¾’
(
v®
) + 1;

497 
i
 = 1; i < 
	`­Ş_veùÜ_g‘_size
(
li¡
); i++) {

498 
s
 = 
	`­Ş_veùÜ_g‘_–em’t
(
li¡
, 
i
);

499 ià(
	`­Ş_¡r_­³ndf
(&
v®
, &
Ën
, "%s%s", 
d–im
, 
s
) < 0) {

500  
NULL
;

503  
v®
;

504 
	}
}

512 
	$Œim_Ëadšg_wh™e¥aû
(*
¡r
)

514 
size_t
 
i
, 
Ën
;

515 
i
 = 0; 
¡r
[i] !ğ'\0' && 
	`is¥aû
(str[i]); i++) ;

516 
Ën
 = 
	`¡¾’
(
¡r
 + 
i
);

517 
	`memmove
(
¡r
, sŒ + 
i
, 
Ën
 + 1);

518 
	}
}

526 
	$Œim_Œašg_wh™e¥aû
(*
¡r
)

528 
size_t
 
Ëngth
;

529 
Ëngth
 = 
	`¡¾’
(
¡r
);

530 
Ëngth
 > 0 && 
	`is¥aû
(
¡r
[length - 1])) {

531 
¡r
[
Ëngth
 - 1] = '\0';

532 
Ëngth
--;

534 
	}
}

536 
	$­Ş_¡r_Œim
(*
¡r
)

538 ià(
¡r
 =ğ
NULL
) {

539 
”ºo
 = 
EINVAL
;

542 
	`Œim_Ëadšg_wh™e¥aû
(
¡r
);

543 
	`Œim_Œašg_wh™e¥aû
(
¡r
);

544 
	}
}

546 
	$­Ş_¡r_­³nd
(**
tgt
, 
size_t
 * 
tgt_sz
, cÚ¡ *
¡r
)

548 
size_t
 
¡r_Ën
;

549 ià(
¡r
 =ğ
NULL
 || (
¡r_Ën
 = 
	`¡¾’
(str)) == 0)

551 ià(
tgt
 =ğ
NULL
) {

552 
”ºo
 = 
EINVAL
;

555 
¡r_Ën
++;

557 ià(*
tgt
 =ğ
NULL
 || *
tgt_sz
 == 0) {

558 *
tgt
 = (*)
	`m®loc
(
¡r_Ën
);

559 ià(*
tgt
 =ğ
NULL
) {

560 *
tgt_sz
 = 0;

563 *
tgt_sz
 = 
¡r_Ën
;

564 
	`¡rıy
(*
tgt
, 
¡r
);

568 *
t
 = (*)
	`»®loc
(*
tgt
, *
tgt_sz
 + 
¡r_Ën
);

569 ià(
t
 =ğ
NULL
) {

570 
”rÜ
 = 
”ºo
;

571 
	`ä“
(*
tgt
);

572 *
tgt
 = 
NULL
;

573 *
tgt_sz
 = 0;

574 
”ºo
 = 
”rÜ
;

577 *
tgt
 = 
t
;

578 *
tgt_sz
 +ğ
¡r_Ën
;

579 
	`¡rÿt
(*
tgt
, 
¡r
);

582 
	}
}

584 
	$­Ş_¡r_­³ndf
(**
tgt
, 
size_t
 * 
tgt_sz
, cÚ¡ *
fmt
, ...)

586 
va_li¡
 
­
;

587 
”rÜ
;

588 ià(
fmt
 =ğ
NULL
 || 
	`¡¾’
(fmt) == 0)

590 ià(
tgt
 =ğ
NULL
) {

591 
”ºo
 = 
EINVAL
;

594 
	`va_¡¬t
(
­
, 
fmt
);

596 ià(*
tgt
 =ğ
NULL
 || *
tgt_sz
 == 0) {

597 ià(
	`va¥rštf
(
tgt
, 
fmt
, 
­
) < 0) {

598 
”rÜ
 = 
”ºo
;

599 *
tgt
 = 
NULL
;

600 *
tgt_sz
 = 0;

601 
	`va_’d
(
­
);

602 
”ºo
 = 
”rÜ
;

605 *
tgt_sz
 = 
	`¡¾’
(*
tgt
) + 1;

606 
	`va_’d
(
­
);

610 *
t
, *
u
;

611 
size_t
 
¡r_Ën
;

612 ià(
	`va¥rštf
(&
t
, 
fmt
, 
­
) < 0) {

613 
”rÜ
 = 
”ºo
;

614 
	`ä“
(*
tgt
);

615 *
tgt_sz
 = 0;

616 
	`va_’d
(
­
);

617 
”ºo
 = 
”rÜ
;

620 
	`va_’d
(
­
);

621 
¡r_Ën
 = 
	`¡¾’
(
t
);

622 ià((
u
 = (*)
	`»®loc
(*
tgt
, *
tgt_sz
 + 
¡r_Ën
)è=ğ
NULL
) {

623 
”rÜ
 = 
”ºo
;

624 
	`ä“
(
t
);

625 
	`ä“
(*
tgt
);

626 *
tgt_sz
 = 0;

627 
”ºo
 = 
”rÜ
;

630 *
tgt
 = 
u
;

631 *
tgt_sz
 +ğ
¡r_Ën
;

632 
	`¡rÿt
(*
tgt
, 
t
);

633 
	`ä“
(
t
);

636 
	}
}

638 
	$­Ş_¡r_is_Úly_wh™e_¥aû
(cÚ¡ *
¡r
)

640 
size_t
 
Ën
, 
i
;

641 ià(
¡r
 =ğ
NULL
)

643 
Ën
 = 
	`¡¾’
(
¡r
);

644 
i
 = 0; i < 
Ën
; i++) {

645 ià(!
	`is¥aû
(
¡r
[
i
]))

649 
	}
}

651 
­Ş_¡r_¡rcmp
(cÚ¡ *
a
, cÚ¡ *
b
, *
unu£d
 
__©Œibu‹__
 ((unused)))

653  
¡rcmp
((cÚ¡ *)
a
, (cÚ¡ *)
b
);

656 *
­Ş_¡r_¡rdup
(cÚ¡ *
–em
, *
unu£d
 
__©Œibu‹__
 ((unused)))

658  
¡rdup
((cÚ¡ *)
–em
);

	@libapol/src/vector-internal.h

26 #iâdeà
APOL_VECTOR_INTERNAL_H


27 
	#APOL_VECTOR_INTERNAL_H


	)

34 
veùÜ_£t_ä“_func
(
­Ş_veùÜ_t
 * 
v
, 
­Ş_veùÜ_ä“_func
 * 
ä
);

	@libapol/src/vector.c

25 
	~<­Ş/veùÜ.h
>

26 
	~"veùÜ-š‹º®.h
"

27 
	~<¡dlib.h
>

28 
	~<¡ršg.h
>

29 
	~<”ºo.h
>

32 
	#APOL_VECTOR_DFLT_INIT_CAP
 10

	)

37 
	s­Ş_veùÜ


40 **
	m¬¿y
;

42 
size_t
 
	msize
;

45 
size_t
 
	mÿ·c™y
;

46 
­Ş_veùÜ_ä“_func
 *
	mä
;

49 
­Ş_veùÜ_t
 *
	$­Ş_veùÜ_ü—‹
(
­Ş_veùÜ_ä“_func
 * 
ä
)

51  
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(
APOL_VECTOR_DFLT_INIT_CAP
, 
ä
);

52 
	}
}

54 
­Ş_veùÜ_t
 *
	$­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(
size_t
 
ÿp
, 
­Ş_veùÜ_ä“_func
 * 
ä
)

56 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

57 
”rÜ
;

59 ià(
ÿp
 < 1) {

60 
ÿp
 = 1;

62 
v
 = 
	`ÿÎoc
(1, (
­Ş_veùÜ_t
));

63 ià(!
v
)

64  
NULL
;

65 
v
->
¬¿y
 = 
	`ÿÎoc
((v->
ÿ·c™y
 = 
ÿp
), (*));

66 ià(!(
v
->
¬¿y
)) {

67 
”rÜ
 = 
”ºo
;

68 
	`ä“
(
v
);

69 
”ºo
 = 
”rÜ
;

70  
NULL
;

72 
v
->
ä
 = fr;

73  
v
;

74 
	}
}

76 
­Ş_veùÜ_t
 *
	$­Ş_veùÜ_ü—‹_äom_™”
(
qpŞ_™”©Ü_t
 * 
™”
, 
­Ş_veùÜ_ä“_func
 * 
ä
)

78 
size_t
 
™”_size
;

79 
­Ş_veùÜ_t
 *
v
;

80 *
™em
;

81 
”rÜ
;

82 ià(
	`qpŞ_™”©Ü_g‘_size
(
™”
, &
™”_size
è< 0 || (
v
 = 
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(™”_size, 
ä
)è=ğ
NULL
) {

83  
NULL
;

85 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

86 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, &
™em
)) {

87 
”rÜ
 = 
”ºo
;

88 
	`ä“
(
v
);

89 
”ºo
 = 
”rÜ
;

90  
NULL
;

92 
	`­Ş_veùÜ_­³nd
(
v
, 
™em
);

94  
v
;

95 
	}
}

97 
­Ş_veùÜ_t
 *
	$­Ş_veùÜ_ü—‹_äom_veùÜ
(cÚ¡ 
­Ş_veùÜ_t
 * 
v
, 
­Ş_veùÜ_dup_func
 * 
dup
, *
d©a
,

98 
­Ş_veùÜ_ä“_func
 * 
ä
)

100 
­Ş_veùÜ_t
 *
Ãw_v
;

101 
size_t
 
i
;

102 ià(
v
 =ğ
NULL
) {

103 
”ºo
 = 
EINVAL
;

104  
NULL
;

106 ià((
Ãw_v
 = 
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(
v
->
ÿ·c™y
, 
ä
)è=ğ
NULL
) {

107  
NULL
;

109 ià(
dup
 =ğ
NULL
) {

110 
	`memıy
(
Ãw_v
->
¬¿y
, 
v
->¬¿y, v->
size
 * (*));

112 
i
 = 0; i < 
v
->
size
; i++) {

113 
Ãw_v
->
¬¿y
[
i
] = 
	`dup
(
v
->¬¿y[i], 
d©a
);

116 
Ãw_v
->
size
 = 
v
->size;

117  
Ãw_v
;

118 
	}
}

120 
­Ş_veùÜ_t
 *
	$­Ş_veùÜ_ü—‹_äom_š‹r£ùiÚ
(cÚ¡ 
­Ş_veùÜ_t
 * 
v1
,

121 cÚ¡ 
­Ş_veùÜ_t
 * 
v2
, 
­Ş_veùÜ_comp_func
 * 
cmp
, *
d©a
)

123 
­Ş_veùÜ_t
 *
Ãw_v
;

124 
size_t
 
i
, 
j
;

125 ià(
v1
 =ğ
NULL
 || 
v2
 == NULL) {

126 
”ºo
 = 
EINVAL
;

127  
NULL
;

129 ià((
Ãw_v
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)) == NULL) {

130  
NULL
;

132 
i
 = 0; i < 
v1
->
size
; i++) {

133 
j
 = 0; j < 
v2
->
size
; j++) {

134 ià((
cmp
 !ğ
NULL
 && 
	`cmp
(
v1
->
¬¿y
[
i
], 
v2
->¬¿y[
j
], 
d©a
) == 0) ||

135 (
cmp
 =ğ
NULL
 && 
v1
->
¬¿y
[
i
] =ğ
v2
->¬¿y[
j
])) {

136 ià(
	`­Ş_veùÜ_­³nd
(
Ãw_v
, 
v1
->
¬¿y
[
i
]) < 0) {

137 
	`­Ş_veùÜ_de¡roy
(&
Ãw_v
);

138  
NULL
;

144  
Ãw_v
;

145 
	}
}

147 
	$­Ş_veùÜ_de¡roy
(
­Ş_veùÜ_t
 ** 
v
)

149 
size_t
 
i
 = 0;

151 ià(!
v
 || !(*v))

154 ià((*
v
)->
ä
) {

155 
i
 = 0; i < (*
v
)->
size
; i++) {

156 (*
v
)->
	`ä
((*v)->
¬¿y
[
i
]);

159 
	`ä“
((*
v
)->
¬¿y
);

160 (*
v
)->
¬¿y
 = 
NULL
;

161 
	`ä“
(*
v
);

162 *
v
 = 
NULL
;

163 
	}
}

165 
size_t
 
	$­Ş_veùÜ_g‘_size
(cÚ¡ 
­Ş_veùÜ_t
 * 
v
)

167 ià(!
v
) {

168 
”ºo
 = 
EINVAL
;

171  
v
->
size
;

173 
	}
}

175 
size_t
 
	$­Ş_veùÜ_g‘_ÿ·c™y
(cÚ¡ 
­Ş_veùÜ_t
 * 
v
)

177 ià(!
v
) {

178 
”ºo
 = 
EINVAL
;

181  
v
->
ÿ·c™y
;

183 
	}
}

185 *
	$­Ş_veùÜ_g‘_–em’t
(cÚ¡ 
­Ş_veùÜ_t
 * 
v
, 
size_t
 
idx
)

187 ià(!
v
 || !(v->
¬¿y
)) {

188 
”ºo
 = 
EINVAL
;

189  
NULL
;

192 ià(
idx
 >ğ
v
->
size
) {

193 
”ºo
 = 
ERANGE
;

194  
NULL
;

197  
v
->
¬¿y
[
idx
];

198 
	}
}

207 
	$­Ş_veùÜ_grow
(
­Ş_veùÜ_t
 * 
v
)

209 **
tmp
;

210 
size_t
 
Ãw_ÿ·c™y
 = 
v
->
ÿ·c™y
;

211 ià(
Ãw_ÿ·c™y
 >= 128) {

212 
Ãw_ÿ·c™y
 += 128;

214 
Ãw_ÿ·c™y
 *= 2;

216 
tmp
 = 
	`»®loc
(
v
->
¬¿y
, 
Ãw_ÿ·c™y
 * (*));

217 ià(!
tmp
) {

220 
v
->
ÿ·c™y
 = 
Ãw_ÿ·c™y
;

221 
v
->
¬¿y
 = 
tmp
;

223 
	}
}

225 
	$­Ş_veùÜ_g‘_šdex
(cÚ¡ 
­Ş_veùÜ_t
 * 
v
, cÚ¡ *
–em
, 
­Ş_veùÜ_comp_func
 * 
cmp
, *
d©a
, 
size_t
 * 
i
)

227 ià(!
v
 || !
i
) {

228 
”ºo
 = 
EINVAL
;

232 *
i
 = 0; *˜< 
v
->
size
; (*i)++) {

233 ià((
cmp
 !ğ
NULL
 && 
	`cmp
(
v
->
¬¿y
[*
i
], 
–em
, 
d©a
) == 0) || (cmp == NULL &&ƒlem == v->array[*i])) {

238 
	}
}

240 
	$­Ş_veùÜ_­³nd
(
­Ş_veùÜ_t
 * 
v
, *
–em
)

242 ià(!
v
) {

243 
”ºo
 = 
EINVAL
;

247 ià(
v
->
size
 >ğv->
ÿ·c™y
 && 
	`­Ş_veùÜ_grow
(v)) {

251 
v
->
¬¿y
[v->
size
] = 
–em
;

252 
v
->
size
++;

255 
	}
}

257 
	$­Ş_veùÜ_­³nd_unique
(
­Ş_veùÜ_t
 * 
v
, *
–em
, 
­Ş_veùÜ_comp_func
 * 
cmp
, *
d©a
)

259 
size_t
 
i
;

260 ià(
	`­Ş_veùÜ_g‘_šdex
(
v
, 
–em
, 
cmp
, 
d©a
, &
i
) < 0) {

261  
	`­Ş_veùÜ_­³nd
(
v
, 
–em
);

263 
”ºo
 = 
EEXIST
;

265 
	}
}

267 
	$­Ş_veùÜ_com·»
(cÚ¡ 
­Ş_veùÜ_t
 * 
a
, cÚ¡‡pŞ_veùÜ_ˆ* 
b
, 
­Ş_veùÜ_comp_func
 * 
cmp
, *
d©a
, 
size_t
 * 
i
)

269 
compv®
;

270 ià(
a
 =ğ
NULL
 || 
b
 =ğNULL || 
i
 == NULL) {

271 
”ºo
 = 
EINVAL
;

274 
size_t
 
a_Ën
 = 
	`­Ş_veùÜ_g‘_size
(
a
);

275 
size_t
 
b_Ën
 = 
	`­Ş_veùÜ_g‘_size
(
b
);

276 *
i
 = 0; *˜< 
a_Ën
 && *˜< 
b_Ën
; (*i)++) {

277 ià(
cmp
 !ğ
NULL
) {

278 
compv®
 = 
	`cmp
(
a
->
¬¿y
[*
i
], 
b
->¬¿y[*i], 
d©a
);

280 
compv®
 = ()((*)
a
->
¬¿y
[*
i
] - (*)
b
->array[*i]);

282 ià(
compv®
 != 0) {

283  
compv®
;

286 ià(
a_Ën
 =ğ
b_Ën
) {

288 } ià(
a_Ën
 < 
b_Ën
) {

293 
	}
}

295 
size_t
 
	$veùÜ_qsÜt_·¹™iÚ
(**
d©a
, 
size_t
 
fœ¡
, size_ˆ
Ï¡
, 
­Ş_veùÜ_comp_func
 * 
cmp
, *
¬g
)

297 *
pivÙ
 = 
d©a
[
Ï¡
];

298 
size_t
 
i
 = 
fœ¡
, 
j
 = 
Ï¡
;

299 
i
 < 
j
) {

300 ià(
	`cmp
(
d©a
[
i
], 
pivÙ
, 
¬g
) <= 0) {

301 
i
++;

303 
d©a
[
j
] = d©a[
i
];

304 
d©a
[
i
] = d©a[
j
 - 1];

305 
j
--;

308 
d©a
[
j
] = 
pivÙ
;

309  
j
;

310 
	}
}

312 
	$veùÜ_qsÜt
(**
d©a
, 
size_t
 
fœ¡
, size_ˆ
Ï¡
, 
­Ş_veùÜ_comp_func
 * 
cmp
, *
¬g
)

314 ià(
fœ¡
 < 
Ï¡
) {

315 
size_t
 
i
 = 
	`veùÜ_qsÜt_·¹™iÚ
(
d©a
, 
fœ¡
, 
Ï¡
, 
cmp
, 
¬g
);

319 ià(
i
 > 0) {

320 
	`veùÜ_qsÜt
(
d©a
, 
fœ¡
, 
i
 - 1, 
cmp
, 
¬g
);

322 
	`veùÜ_qsÜt
(
d©a
, 
i
 + 1, 
Ï¡
, 
cmp
, 
¬g
);

324 
	}
}

330 
veùÜ_št_comp
(cÚ¡ *
a
, cÚ¡ *
b
, *
d©a
 
__©Œibu‹__
 ((
unu£d
)))

332 *
	gi
 = (*)
a
;

333 *
	gj
 = (*)
b
;

334 ià(
	gi
 < 
	gj
) {

336 } ià(
	gi
 > 
	gj
) {

343 
	$­Ş_veùÜ_sÜt
(
­Ş_veùÜ_t
 * 
v
, 
­Ş_veùÜ_comp_func
 * 
cmp
, *
d©a
)

345 ià(!
v
) {

346 
”ºo
 = 
EINVAL
;

349 ià(
cmp
 =ğ
NULL
) {

350 
cmp
 = 
veùÜ_št_comp
;

352 ià(
v
->
size
 > 1) {

353 
	`veùÜ_qsÜt
(
v
->
¬¿y
, 0, v->
size
 - 1, 
cmp
, 
d©a
);

355 
	}
}

357 
	$­Ş_veùÜ_sÜt_uniquify
(
­Ş_veùÜ_t
 * 
v
, 
­Ş_veùÜ_comp_func
 * 
cmp
, *
d©a
)

359 ià(!
v
) {

360 
”ºo
 = 
EINVAL
;

363 ià(
cmp
 =ğ
NULL
) {

364 
cmp
 = 
veùÜ_št_comp
;

366 ià(
v
->
size
 > 1) {

367 
size_t
 
i
, 
j
 = 0;

368 **
Ãw_¬¿y
;

371 
i
 = 1; i < 
v
->
size
; i++) {

372 ià(
	`cmp
(
v
->
¬¿y
[
i
], v->¬¿y[
j
], 
d©a
) != 0) {

374 
j
++;

375 
v
->
¬¿y
[
j
] = v->¬¿y[
i
];

378 ià(
v
->
ä
 !ğ
NULL
) {

379 
v
->
	`ä
(v->
¬¿y
[
i
]);

383 
v
->
size
 = 
j
 + 1;

385 
	`­Ş_veùÜ_sÜt
(
v
, 
cmp
, 
d©a
);

386 
j
 = 0;

387 
i
 = 1; i < 
v
->
size
; i++) {

388 ià(
	`cmp
(
v
->
¬¿y
[
i
], v->¬¿y[
j
], 
d©a
) != 0) {

390 
j
++;

391 
v
->
¬¿y
[
j
] = v->¬¿y[
i
];

394 ià(
v
->
ä
 !ğ
NULL
) {

395 
v
->
	`ä
(v->
¬¿y
[
i
]);

400 
v
->
size
 = 
j
 + 1;

401 ià((
Ãw_¬¿y
 = 
	`»®loc
(
v
->
¬¿y
, v->
size
 * (*))è!ğ
NULL
) {

402 
v
->
¬¿y
 = 
Ãw_¬¿y
;

403 
v
->
ÿ·c™y
 = v->
size
;

406 
	}
}

408 
	$­Ş_veùÜ_ÿt
(
­Ş_veùÜ_t
 * 
de¡
, cÚ¡‡pŞ_veùÜ_ˆ* 
¤c
)

410 
size_t
 
i
, 
Üig_size
, 
ÿp
;

411 **
a
;

412 ià(!
¤c
 || !
	`­Ş_veùÜ_g‘_size
(src)) {

416 ià(!
de¡
) {

417 
”ºo
 = 
EINVAL
;

420 
Üig_size
 = 
	`­Ş_veùÜ_g‘_size
(
de¡
);

421 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
¤c
); i++)

422 ià(
	`­Ş_veùÜ_­³nd
(
de¡
, 
	`­Ş_veùÜ_g‘_–em’t
(
¤c
, 
i
))) {

424 ià(
Üig_size
 == 0) {

425 
ÿp
 = 1;

427 
ÿp
 = 
Üig_size
;

429 
a
 = 
	`»®loc
(
de¡
->
¬¿y
, 
ÿp
 * (*a));

430 ià(
a
 !ğ
NULL
) {

431 
de¡
->
¬¿y
 = 
a
;

433 
de¡
->
size
 = 
Üig_size
;

434 
de¡
->
ÿ·c™y
 = 
ÿp
;

439 
	}
}

441 
	$­Ş_veùÜ_»move
(
­Ş_veùÜ_t
 * 
v
, cÚ¡ 
size_t
 
idx
)

443 ià(
v
 =ğ
NULL
 || 
idx
 >ğv->
size
) {

444 
”ºo
 = 
EINVAL
;

447 
	`memmove
(
v
->
¬¿y
 + 
idx
, v->¬¿y + idx + 1, (v->¬¿y[0]è* (v->
size
 - idx - 1));

448 
v
->
size
--;

450 
	}
}

454 
	$veùÜ_£t_ä“_func
(
­Ş_veùÜ_t
 * 
v
, 
­Ş_veùÜ_ä“_func
 * 
ä
)

456 
v
->
ä
 = fr;

457 
	}
}

	@libapol/tests/avrule-tests.c

26 
	~<cÚfig.h
>

28 
	~<CUn™/CUn™.h
>

29 
	~<­Ş/avruË-qu”y.h
>

30 
	~<­Ş/pŞicy.h
>

31 
	~<­Ş/pŞicy-·th.h
>

32 
	~<qpŞ/pŞicy_ex‹nd.h
>

33 
	~<¡dboŞ.h
>

35 
	#BIN_POLICY
 
TEST_POLICIES
 "/£toŞs-3.3/ruËs/ruËs-mls.21"

	)

36 
	#SOURCE_POLICY
 
TEST_POLICIES
 "/£toŞs-3.3/ruËs/ruËs-mls.cÚf"

	)

38 
­Ş_pŞicy_t
 *
	gbp
 = 
NULL
;

39 
­Ş_pŞicy_t
 *
	g¥
 = 
NULL
;

41 
	$avruË_basic_syn
()

43 
­Ş_avruË_qu”y_t
 *
aq
 = 
	`­Ş_avruË_qu”y_ü—‹
();

44 
	`CU_ASSERT_PTR_NOT_NULL_FATAL
(
aq
);

46 
»tv®
;

47 
»tv®
 = 
	`­Ş_avruË_qu”y_£t_ruËs
(
¥
, 
aq
, 
QPOL_RULE_AUDITALLOW
 | 
QPOL_RULE_DONTAUDIT
);

48 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

50 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

51 
»tv®
 = 
	`­Ş_syn_avruË_g‘_by_qu”y
(
¥
, 
aq
, &
v
);

52 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

53 
	`CU_ASSERT_PTR_NOT_NULL
(
v
);

55 
size_t
 
num_aud™®lows
 = 0, 
num_dÚud™s
 = 0;

57 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
¥
);

58 
size_t
 
i
;

59 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v
); i++) {

60 cÚ¡ 
qpŞ_syn_avruË_t
 *
syn
 = (cÚ¡ qpŞ_syn_avruË_ˆ*)
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

61 
ušt32_t
 
ruË_ty³
;

62 
»tv®
 = 
	`qpŞ_syn_avruË_g‘_ruË_ty³
(
q
, 
syn
, &
ruË_ty³
);

63 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

65 
	`CU_ASSERT
(
ruË_ty³
 =ğ
QPOL_RULE_AUDITALLOW
 ||„uË_ty³ =ğ
QPOL_RULE_DONTAUDIT
);

66 ià(
ruË_ty³
 =ğ
QPOL_RULE_AUDITALLOW
) {

67 
num_aud™®lows
++;

68 } ià(
ruË_ty³
 =ğ
QPOL_RULE_DONTAUDIT
) {

69 
num_dÚud™s
++;

72 
	`CU_ASSERT
(
num_aud™®lows
 =ğ4 && 
num_dÚud™s
 == 1);

73 
	`­Ş_veùÜ_de¡roy
(&
v
);

75 
»tv®
 = 
	`­Ş_avruË_qu”y_­³nd_şass
(
¥
, 
aq
, "unknown class");

76 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

78 
»tv®
 = 
	`­Ş_syn_avruË_g‘_by_qu”y
(
¥
, 
aq
, &
v
);

79 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

80 
	`CU_ASSERT
(
v
 !ğ
NULL
 && 
	`­Ş_veùÜ_g‘_size
(v) == 0);

81 
	`­Ş_veùÜ_de¡roy
(&
v
);

82 
	`­Ş_avruË_qu”y_de¡roy
(&
aq
);

83 
	}
}

85 
	$avruË_deçuÉ
()

87 
­Ş_avruË_qu”y_t
 *
aq
 = 
	`­Ş_avruË_qu”y_ü—‹
();

88 
	`CU_ASSERT_PTR_NOT_NULL_FATAL
(
aq
);

90 
»tv®
;

91 
qpŞ_pŞicy_t
 *
sq
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
¥
);

93 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

95 
»tv®
 = 
	`­Ş_avruË_g‘_by_qu”y
(
¥
, 
aq
, &
v
);

96 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

97 
	`CU_ASSERT_PTR_NOT_NULL
(
v
);

98 
	`CU_ASSERT
(
	`­Ş_veùÜ_g‘_size
(
v
) == 396);

99 
	`­Ş_veùÜ_de¡roy
(&
v
);

101 
	`qpŞ_pŞicy_»bud
(
sq
, 
QPOL_POLICY_OPTION_NO_NEVERALLOWS
);

102 
»tv®
 = 
	`­Ş_avruË_g‘_by_qu”y
(
¥
, 
aq
, &
v
);

103 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

104 
	`CU_ASSERT_PTR_NOT_NULL
(
v
);

105 
	`CU_ASSERT
(
	`­Ş_veùÜ_g‘_size
(
v
) == 21);

106 
	`­Ş_veùÜ_de¡roy
(&
v
);

108 
»tv®
 = 
	`­Ş_avruË_g‘_by_qu”y
(
bp
, 
aq
, &
v
);

109 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

110 
	`CU_ASSERT_PTR_NOT_NULL
(
v
);

111 
	`CU_ASSERT
(
	`­Ş_veùÜ_g‘_size
(
v
) == 21);

112 
	`­Ş_veùÜ_de¡roy
(&
v
);

114 
	`­Ş_avruË_qu”y_de¡roy
(&
aq
);

115 
	}
}

117 
CU_Te¡Info
 
	gavruË_‹¡s
[] = {

118 {"basiøsyÁaùiø£¬ch", 
avruË_basic_syn
}

120 {"deçuÉ qu”y", 
avruË_deçuÉ
}

122 
CU_TEST_INFO_NULL


125 
	$avruË_š™
()

127 
­Ş_pŞicy_·th_t
 *
µ©h
 = 
	`­Ş_pŞicy_·th_ü—‹
(
APOL_POLICY_PATH_TYPE_MONOLITHIC
, 
BIN_POLICY
, 
NULL
);

128 ià(
µ©h
 =ğ
NULL
) {

132 ià((
bp
 = 
	`­Ş_pŞicy_ü—‹_äom_pŞicy_·th
(
µ©h
, 0, 
NULL
, NULL)) == NULL) {

133 
	`­Ş_pŞicy_·th_de¡roy
(&
µ©h
);

136 
	`­Ş_pŞicy_·th_de¡roy
(&
µ©h
);

138 
µ©h
 = 
	`­Ş_pŞicy_·th_ü—‹
(
APOL_POLICY_PATH_TYPE_MONOLITHIC
, 
SOURCE_POLICY
, 
NULL
);

139 ià(
µ©h
 =ğ
NULL
) {

143 ià((
¥
 = 
	`­Ş_pŞicy_ü—‹_äom_pŞicy_·th
(
µ©h
, 0, 
NULL
, NULL)) == NULL) {

144 
	`­Ş_pŞicy_·th_de¡roy
(&
µ©h
);

147 
	`­Ş_pŞicy_·th_de¡roy
(&
µ©h
);

149 ià(
	`qpŞ_pŞicy_bud_syn_ruË_bË
(
	`­Ş_pŞicy_g‘_qpŞ
(
¥
)) != 0) {

154 
	}
}

156 
	$avruË_ş—nup
()

158 
	`­Ş_pŞicy_de¡roy
(&
bp
);

159 
	`­Ş_pŞicy_de¡roy
(&
¥
);

161 
	}
}

	@libapol/tests/avrule-tests.h

26 #iâdeà
AVRULE_TESTS_H


27 
	#AVRULE_TESTS_H


	)

29 
	~<CUn™/CUn™.h
>

31 
CU_Te¡Info
 
avruË_‹¡s
[];

32 
avruË_š™
();

33 
avruË_ş—nup
();

	@libapol/tests/constrain-tests.c

24 
	~<¡dio.h
>

25 
	~<cÚfig.h
>

27 
	~<CUn™/CUn™.h
>

28 
	~<­Ş/³rm-m­.h
>

29 
	~<­Ş/pŞicy.h
>

30 
	~<­Ş/pŞicy-·th.h
>

31 
	~<¡dboŞ.h
>

32 
	~<¡ršg.h
>

33 
	~<­Ş/cÚ¡¿št-qu”y.h
>

34 
	~<£pŞ/pŞicydb/pŞicydb.h
>

35 
	~<£pŞ/pŞicydb/cÚ¡¿št.h
>

36 
	~<libqpŞ/¤c/queue.h
>

38 
	#CONSTR_SOURCE
 
TEST_POLICIES
 "/£toŞs-3.3/­Ş/cÚ¡¿š_‹¡_pŞicy.cÚf"

	)

39 
	#CONSTR_BINARY
 
TEST_POLICIES
 "/£toŞs-3.3/­Ş/cÚ¡¿š_‹¡_pŞicy.21"

	)

41 
	#CONSTR_MODULAR
 
TEST_POLICIES
 "/£toŞs-3.1/moduËs/*.µ"

	)

73 
	sloÿl_ex´
 {

74 
ušt32_t
 
	mex´_ty³
;

75 
ušt32_t
 
	m©Œ
;

76 
ušt32_t
 
	mİ
;

77 
size_t
 
	mÇme_couÁ
;

78 **
	mÇm–i¡
;

79 } 
	tloÿl_ex´_t
;

81 
	scÚ¡¿š_‹¡_li¡
 {

82 **
	mşass
;

83 **
	m³rmissiÚs
;

84 
	m‹¡_found
;

85 
	mex´_couÁ
;

86 
loÿl_ex´_t
 **
	mex´_li¡
;

87 } 
	tcÚ¡¿š_‹¡_li¡_t
;

92 *
	gşass0
 = "file";

93 *
	g³rm0
[] = { "ü—‹", "»Ïb–to", 
NULL
 };

94 
loÿl_ex´_t
 
	gex´00
 = { 
CEXPR_ATTR
, 
CEXPR_L2H2
, 
CEXPR_EQ
, 0, 
NULL
 };

95 
loÿl_ex´_t
 *
	gex´0
[] = { &
ex´00
, 
NULL
 };

97 *
	gşass1
 = "lnk_file";

98 *
	g³rm1
[10] = { "ü—‹", "»Ïb–to", 
NULL
 };

99 
loÿl_ex´_t
 
	gex´10
 = { 
CEXPR_ATTR
, 
CEXPR_L2H2
, 
CEXPR_NEQ
, 0, 
NULL
 };

100 
loÿl_ex´_t
 *
	gex´1
[] = { &
ex´10
, 
NULL
 };

103 *
	gşass2
 = "fifo_file";

104 *
	g³rm2
[] = { "ü—‹", "»Ïb–to", 
NULL
 };

105 
loÿl_ex´_t
 
	gex´20
 = { 
CEXPR_ATTR
, 
CEXPR_L2H2
, 
CEXPR_DOM
, 0, 
NULL
 };

106 
loÿl_ex´_t
 *
	gex´2
[] = { &
ex´20
, 
NULL
 };

108 *
	gşass3
 = "node";

109 *
	g³rm3
[] = { "udp_£nd", 
NULL
 };

110 
loÿl_ex´_t
 
	gex´30
 = { 
CEXPR_ATTR
, 
CEXPR_L1L2
, 
CEXPR_DOM
, 0, 
NULL
 };

111 
loÿl_ex´_t
 
	gex´31
 = { 
CEXPR_ATTR
, 
CEXPR_L1H2
, 
CEXPR_DOMBY
, 0, 
NULL
 };

112 
loÿl_ex´_t
 
	gex´32
 = { 
CEXPR_AND
, 0, 0, 0, 
NULL
 };

113 
loÿl_ex´_t
 *
	gex´3
[] = { &
ex´30
, &
ex´31
, &
ex´32
, 
NULL
 };

115 *
	gşass4
 = "netif";

116 *
	g³rm4
[] = { "tı_£nd", 
NULL
 };

117 
loÿl_ex´_t
 
	gex´40
 = { 
CEXPR_ATTR
, 
CEXPR_L1L2
, 
CEXPR_DOM
, 0, 
NULL
 };

118 
loÿl_ex´_t
 
	gex´41
 = { 
CEXPR_ATTR
, 
CEXPR_L1H2
, 
CEXPR_DOMBY
, 0, 
NULL
 };

119 
loÿl_ex´_t
 
	gex´42
 = { 
CEXPR_OR
, 0, 0, 0, 
NULL
 };

120 
loÿl_ex´_t
 *
	gex´4
[] = { &
ex´40
, &
ex´41
, &
ex´42
, 
NULL
 };

122 *
	gşass5
 = "dir";

123 *
	g³rm5
[] = { "»ad", 
NULL
 };

124 *
	gÇme50
[] = { "sy§dm_t", "£ÿdm_t", 
NULL
 };

125 
loÿl_ex´_t
 
	gex´50
 = { 
CEXPR_NAMES
, 
CEXPR_TYPE
, 
CEXPR_EQ
, 2, 
Çme50
 };

126 
loÿl_ex´_t
 *
	gex´5
[] = { &
ex´50
, 
NULL
 };

128 
cÚ¡¿š_‹¡_li¡_t
 
	g‹¡_li¡
[] = {

129 { &
şass0
, 
³rm0
, 0, 1, 
ex´0
 },

130 { &
şass1
, 
³rm1
, 0, 1, 
ex´1
 },

131 { &
şass2
, 
³rm2
, 0, 1, 
ex´2
 },

132 { &
şass3
, 
³rm3
, 0, 3, 
ex´3
 },

133 { &
şass4
, 
³rm4
, 0, 3, 
ex´4
 },

134 { &
şass5
, 
³rm5
, 0, 3, 
ex´5
 }

137 
	scom·»_³rm_¡r
 {

138 
	mli¡_Ëngth
;

139 
	mli¡_found
;

140 
	mq_–em’ts_com·»d
;

141 **
	mli¡
;

142 } 
	tcom·»_³rm_¡r_t
;

144 
	scom·»_ex´_¡r
 {

145 
	mli¡_Ëngth
;

146 
	mli¡_found
;

147 
loÿl_ex´_t
 **
	mli¡
;

148 } 
	tcom·»_ex´_¡r_t
;

151 
­Ş_pŞicy_t
 *
	gps
 = 
NULL
;

152 
­Ş_pŞicy_t
 *
	gpb
 = 
NULL
;

153 
­Ş_pŞicy_t
 *
	gpm
 = 
NULL
;

157 
com·»_™em_to_li¡
(*
e
, *
v
);

162 
	$dİršt¡r
 (
queue_–em’t_t
 
e
, *
p
)

164 *
s
 = (*)
e
;

167 
	`´štf
 ("% ", 
s
);

169 
	}
}

171 
	$com·»_ex´_li¡
(
qpŞ_pŞicy_t
 *
q
, 
qpŞ_™”©Ü_t
 *
ex´_™”
, 
ex´_couÁ
, 
loÿl_ex´_t
 **
Ë
)

173 cÚ¡ 
qpŞ_cÚ¡¿št_ex´_node_t
 *
ex´
;

174 
sym_ty³
;

175 
İ
;

176 
ex´_ty³
;

177 
i
;

178 
”r
;

180 
i
=0; 
	`qpŞ_™”©Ü_’d
(
ex´_™”
è=ğ0; i++, 
	`qpŞ_™”©Ü_Ãxt
(expr_iter))

182 
ex´_ty³
 = 
İ
 = 
sym_ty³
 = 0;

183 ià(
i
 >ğ
ex´_couÁ
)

186 
”r
 = 
	`qpŞ_™”©Ü_g‘_™em
(
ex´_™”
, (**)&
ex´
);

187 
	`CU_ASSERT_EQUAL_FATAL
(
”r
, 0);

189 
”r
 = 
	`qpŞ_cÚ¡¿št_ex´_node_g‘_sym_ty³
(
q
, 
ex´
, &
sym_ty³
);

190 
	`CU_ASSERT_EQUAL_FATAL
(
”r
, 0);

192 
”r
 = 
	`qpŞ_cÚ¡¿št_ex´_node_g‘_İ
(
q
, 
ex´
, &
İ
);

193 
	`CU_ASSERT_EQUAL_FATAL
(
”r
, 0);

195 
”r
 = 
	`qpŞ_cÚ¡¿št_ex´_node_g‘_ex´_ty³
(
q
, 
ex´
, &
ex´_ty³
);

196 
	`CU_ASSERT_EQUAL_FATAL
(
”r
, 0);

198 #ifdeà
DEBUGTRACE


199 
	`´štf
 ("Ex´ com·»: PŞicy:©Œ:%d, op:%d,ƒx´_ty³:%d\n", 
sym_ty³
, 
İ
, 
ex´_ty³
);

200 
	`´štf
 ("Ex´ com·»: Te¡:©Œ:%d, op:%d,ƒx´_ty³:%d\n", 
Ë
[
i
]->
©Œ
,†e[i]->
İ
,†e[i]->
ex´_ty³
);

202 ià(
sym_ty³
 !ğ
Ë
[
i
]->
©Œ
)

206 ià(
İ
 !ğ
Ë
[
i
]->op)

210 ià(
ex´_ty³
 !ğ
Ë
[
i
]->expr_type)

215 ià(
ex´_ty³
 =ğ
CEXPR_NAMES
)

217 
qpŞ_™”©Ü_t
 *
Çmes_™”
=
NULL
;

218 
size_t
 
Çme_size
=0;

219 
com·»_³rm_¡r_t
 
x
;

221 #ifdeà
DEBUGTRACE


222 
	`´štf
 ("Found CEXPR_NAMESƒxpression\n");

224 
x
.
li¡_Ëngth
 = 
Ë
[
i
]->
Çme_couÁ
;

225 
x
.
li¡
 = 
Ë
[
i
]->
Çm–i¡
;

226 
x
.
li¡_found
 = 0;

227 
x
.
q_–em’ts_com·»d
 = 0;

229 
”r
 = 
	`qpŞ_cÚ¡¿št_ex´_node_g‘_Çmes_™”
 (
q
, 
ex´
, &
Çmes_™”
);

230 
	`CU_ASSERT_EQUAL_FATAL
(
”r
, 0);

232 
”r
 = 
	`qpŞ_™”©Ü_g‘_size
(
Çmes_™”
, &
Çme_size
);

233 
	`CU_ASSERT_EQUAL_FATAL
(
”r
, 0);

234 
	`CU_ASSERT_TRUE_FATAL
(
Çme_size
 > 0);

236 ià(
Çme_size
 !ğ
x
.
li¡_Ëngth
)

238 
	`qpŞ_™”©Ü_de¡roy
(&
Çmes_™”
);

242 ; 
	`qpŞ_™”©Ü_’d
(
Çmes_™”
è=ğ0; 
	`qpŞ_™”©Ü_Ãxt
(names_iter))

244 *
Êame
 = 
NULL
;

246 
”r
 = 
	`qpŞ_™”©Ü_g‘_™em
 (
Çmes_™”
, (**)&
Êame
);

247 
	`CU_ASSERT_EQUAL_FATAL
(
”r
, 0);

249 
	`com·»_™em_to_li¡
 (
Êame
, &
x
);

250 
	`ä“
 (
Êame
);

253 #ifdeà
DEBUGTRACE


254 
	`´štf
 ("Çmli¡†’gth=%d,†i¡_found=%d, q_–em’ts_com·»d=%d\n", 
x
.
li¡_Ëngth
, x.
li¡_found
, x.
q_–em’ts_com·»d
);

256 ià((
x
.
li¡_Ëngth
 !ğx.
li¡_found
è|| (x.li¡_Ëngth !ğx.
q_–em’ts_com·»d
))

261 
	}
}

263 
	$com·»_™em_to_li¡
(*
e
, *
v
)

265 *
³
 = (*)
e
;

266 
com·»_³rm_¡r_t
 *
x
 = (com·»_³rm_¡r_ˆ*)
v
;

267 **
³rmli¡
 = 
x
->
li¡
;

268 *
³rm
;

270 
	`CU_ASSERT_PTR_NOT_NULL
(
³rmli¡
);

271 
	`CU_ASSERT_PTR_NOT_NULL
(
³
);

273 (
³rm
=*
³rmli¡
++è!ğ
NULL
)

275 #ifdeà
DEBUGTRACE


276 
	`´štf
 ("³ = %s\n", 
³
);

277 
	`´štf
 ("³rm = %s\n", 
³rm
);

279 ià(
	`¡rcmp
(
³
, 
³rm
) == 0)

280 
x
->
li¡_found
++;

282 
x
->
q_–em’ts_com·»d
++;

284 
	}
}

286 
	$com·»_³rm_li¡
(
queue_t
 
³rm_q
, **
³rmissiÚs
)

288 
com·»_³rm_¡r_t
 
x
;

290 
x
.
li¡_Ëngth
 = 0;

291 
x
.
li¡_found
 = 0;

292 
x
.
q_–em’ts_com·»d
 = 0;

293 
x
.
li¡
 = 
³rmissiÚs
;

295 *
³rmissiÚs
++ !ğ
NULL
)

296 
x
.
li¡_Ëngth
++;

298 #ifdeà
DEBUGTRACE


299 
	`´štf
 ("li¡_Ëngth = %d\n", 
x
.
li¡_Ëngth
);

301 ià(
	`queue_m­
(
³rm_q
, 
com·»_™em_to_li¡
, &
x
) != 0)

304 #ifdeà
DEBUGTRACE


305 
	`´štf
 ("li¡†’gth=%d,†i¡_found=%d, q_–em’ts_com·»d=%d\n", 
x
.
li¡_Ëngth
, x.
li¡_found
, x.
q_–em’ts_com·»d
);

307 ià((
x
.
li¡_Ëngth
 !ğx.
li¡_found
è|| (x.li¡_Ëngth !ğx.
q_–em’ts_com·»d
))

311 
	}
}

313 
	$cÚ¡¿š_‹¡
(
­Ş_pŞicy_t
 *
­
)

315 
i
;

316 
”r
=0;

317 cÚ¡ *
şass_Çme
 = 
NULL
;

318 cÚ¡ *
cÚ¡¿š_ty³
 = "?constrain";

319 *
³rm_li¡
 = "No Perms Extracted";

320 cÚ¡ 
qpŞ_cÚ¡¿št_ex´_node_t
 *
ex´
 = 
NULL
;

321 
qpŞ_™”©Ü_t
 *
pŞicy_™”
 = 
NULL
;

322 
qpŞ_™”©Ü_t
 *
³rm_™”
 = 
NULL
;

323 
qpŞ_™”©Ü_t
 *
ex´_™”
 = 
NULL
;

324 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
­
);

325 
qpŞ_cÚ¡¿št_t
 *
cÚ¡¿št
 = 
NULL
;

326 cÚ¡ 
qpŞ_şass_t
 *
şass
;

327 
size_t
 
n_cÚ¡¿šts
 = 0;

328 
size_t
 
couÁed_cÚ¡¿šts
 = 0;

329 
size_t
 
‹¡s_nÙ_found
 = 0;

330 
‹¡_couÁ
 = (
‹¡_li¡
è/ (
cÚ¡¿š_‹¡_li¡_t
);

331 
‹¡s_m©ched
 = 0;

332 
cÚ¡¿šs_m©ched
 = 0;

334 
queue_t
 
³rm_q
;

336 
”r
 = 
	`qpŞ_pŞicy_g‘_cÚ¡¿št_™”
(
q
, &
pŞicy_™”
);

337 ià(
”r
 != 0)

339 
	`CU_FAIL
("Policy iterator‚ot‡ccessible");

340 
ş—nup
;

342 
”r
 = 
	`qpŞ_™”©Ü_g‘_size
(
pŞicy_™”
, &
n_cÚ¡¿šts
);

343 ià(
”r
 != 0)

345 
	`CU_FAIL
("Policy size computation failed");

346 
ş—nup
;

349 
	`CU_ASSERT_EQUAL
(
n_cÚ¡¿šts
, 7);

351 
couÁed_cÚ¡¿šts
=0;

352 
i
=0; i<
‹¡_couÁ
; i++)

354 
‹¡_li¡
[
i
].
‹¡_found
 = 0;

358 ; 
	`qpŞ_™”©Ü_’d
(
pŞicy_™”
è=ğ0; 
	`qpŞ_™”©Ü_Ãxt
(policy_iter))

360 
couÁed_cÚ¡¿šts
++;

370 
”r
 = 
	`qpŞ_™”©Ü_g‘_™em
(
pŞicy_™”
, (**)&
cÚ¡¿št
);

371 
	`CU_ASSERT_EQUAL_FATAL
(
”r
, 0);

373 
”r
 = 
	`qpŞ_cÚ¡¿št_g‘_şass
(
q
, 
cÚ¡¿št
, &
şass
);

374 
	`CU_ASSERT_EQUAL_FATAL
(
”r
, 0);

375 
”r
 = 
	`qpŞ_şass_g‘_Çme
(
q
, 
şass
, &
şass_Çme
);

376 
	`CU_ASSERT_EQUAL_FATAL
(
”r
, 0);

378 #ifdeà
DEBUGTRACE


379 
	`´štf
 ("Found cÏs %s\n", 
şass_Çme
);

382 
”r
 = 
	`qpŞ_cÚ¡¿št_g‘_³rm_™”
 (
q
, 
cÚ¡¿št
, &
³rm_™”
);

383 
	`CU_ASSERT_EQUAL_FATAL
(
”r
, 0);

385 
³rm_q
 = 
	`queue_ü—‹
();

386 ; 
	`qpŞ_™”©Ü_’d
(
³rm_™”
è=ğ0; 
	`qpŞ_™”©Ü_Ãxt
(perm_iter))

388 
”r
 = 
	`qpŞ_™”©Ü_g‘_™em
(
³rm_™”
, (**)&
³rm_li¡
);

389 
	`CU_ASSERT_EQUAL_FATAL
(
”r
,0)

391 
”r
 = 
	`queue_š£¹
 (
³rm_q
, 
³rm_li¡
);

392 
	`CU_ASSERT_EQUAL_FATAL
(
”r
,0)

394 #ifdeà
DEBUGTRACE


395 
	`´štf
 ("perms: ");

396 
	`queue_m­
(
³rm_q
, 
dİršt¡r
, 
NULL
);

397 
	`´štf
 ("\n");

401 
”r
 = 
	`qpŞ_cÚ¡¿št_g‘_ex´_™”
 (
q
, 
cÚ¡¿št
, &
ex´_™”
);

402 
	`CU_ASSERT_EQUAL_FATAL
(
”r
, 0);

408 
i
=0; i<
‹¡_couÁ
; i++)

410 ià(
	`¡rcmp
(*(
‹¡_li¡
[
i
].
şass
), 
şass_Çme
) == 0)

412 ià(
	`com·»_³rm_li¡
(
³rm_q
, 
‹¡_li¡
[
i
].
³rmissiÚs
) == 0)

414 ià(
	`com·»_ex´_li¡
(
q
, 
ex´_™”
, 
‹¡_li¡
[
i
].
ex´_couÁ
,e¡_li¡[i].
ex´_li¡
) == 0)

416 
‹¡_li¡
[
i
].
‹¡_found
 = 1;

417 
cÚ¡¿šs_m©ched
++;

420 #ifdeà
DEBUGTRACE


423 
	`´štf
 ("Mismatch comparingƒxpression†ist\n");

427 #ifdeà
DEBUGTRACE


430 
	`´štf
 ("Mismatch comparing…ermission†ist\n");

434 #ifdeà
DEBUGTRACE


437 
	`´štf
 ("Mism©ch com·ršg cÏs£ %s,%s\n", *(
‹¡_li¡
[
i
].
şass
),
şass_Çme
);

441 
	`queue_de¡roy
(
³rm_q
);

443 
i
=0; i<
‹¡_couÁ
; i++)

445 ià(
‹¡_li¡
[
i
].
‹¡_found
 == 0)

447 
	`CU_ASSERT_EQUAL
(
i
, 2);

450 
‹¡s_m©ched
++;

452 #ifdeà
DEBUGTRACE


453 
	`´štf
 ("‹¡s_m©ched: %d, cÚ¡¿šs_m©ched: %d, couÁed_cÚ¡¿šts: %d,‚_cÚ¡¿šts: %d\n", 
‹¡s_m©ched
, 
cÚ¡¿šs_m©ched
, 
couÁed_cÚ¡¿šts
, 
n_cÚ¡¿šts
);

455 
	`CU_ASSERT_EQUAL
(
‹¡s_m©ched
, 5);

456 
	`CU_ASSERT_EQUAL
(
cÚ¡¿šs_m©ched
, 5);

457 
	`CU_ASSERT_EQUAL
(
couÁed_cÚ¡¿šts
, 7);

458 
	`CU_ASSERT_EQUAL
(
n_cÚ¡¿šts
, 7);

460 
	`CU_PASS
();

462 
ş—nup
:

465 
	}
}

467 
	$cÚ¡¿š_sourû
()

469 
	`cÚ¡¿š_‹¡
(
ps
);

470 
	}
}

472 
	$cÚ¡¿š_bš¬y
()

474 
	`cÚ¡¿š_‹¡
(
pb
);

476 
	}
}

479 
	$cÚ¡¿š_moduÏr
()

481 
	`CU_PASS
("Not yet implemented")

482 
	}
}

484 
CU_Te¡Info
 
	gcÚ¡¿š_‹¡s
[] = {

485 {"cÚ¡¿š from sourû…Şicy", 
cÚ¡¿š_sourû
},

486 {"cÚ¡¿š from bš¬y…Şicy", 
cÚ¡¿š_bš¬y
},

488 
CU_TEST_INFO_NULL


491 
	$cÚ¡¿š_š™
()

494 
­Ş_pŞicy_·th_t
 *
µ©h
 = 
	`­Ş_pŞicy_·th_ü—‹
(
APOL_POLICY_PATH_TYPE_MONOLITHIC
, 
CONSTR_SOURCE
, 
NULL
);

495 ià(
µ©h
 =ğ
NULL
) {

499 ià((
ps
 = 
	`­Ş_pŞicy_ü—‹_äom_pŞicy_·th
(
µ©h
, 
QPOL_POLICY_OPTION_NO_NEVERALLOWS
, 
NULL
, NULL)) == NULL) {

500 
	`­Ş_pŞicy_·th_de¡roy
(&
µ©h
);

503 
	`­Ş_pŞicy_·th_de¡roy
(&
µ©h
);

505 
µ©h
 = 
	`­Ş_pŞicy_·th_ü—‹
(
APOL_POLICY_PATH_TYPE_MONOLITHIC
, 
CONSTR_BINARY
, 
NULL
);

506 ià(
µ©h
 =ğ
NULL
) {

510 ià((
pb
 = 
	`­Ş_pŞicy_ü—‹_äom_pŞicy_·th
(
µ©h
, 
QPOL_POLICY_OPTION_NO_NEVERALLOWS
, 
NULL
, NULL)) == NULL) {

511 
	`­Ş_pŞicy_·th_de¡roy
(&
µ©h
);

514 
	`­Ş_pŞicy_·th_de¡roy
(&
µ©h
);

517 
	}
}

519 
	$cÚ¡¿š_ş—nup
()

521 
	`­Ş_pŞicy_de¡roy
(&
ps
);

523 
	}
}

	@libapol/tests/constrain-tests.h

24 #iâdeà
CONSTRAIN_TESTS_H


25 
	#CONSTRAIN_TESTS_H


	)

27 
	~<CUn™/CUn™.h
>

29 
CU_Te¡Info
 
cÚ¡¿š_‹¡s
[];

30 
cÚ¡¿š_š™
();

31 
cÚ¡¿š_ş—nup
();

	@libapol/tests/dta-tests.c

27 
	~<cÚfig.h
>

29 
	~<CUn™/CUn™.h
>

30 
	~<­Ş/avruË-qu”y.h
>

31 
	~<­Ş/domaš-Œªs-ª®ysis.h
>

32 
	~<­Ş/pŞicy.h
>

33 
	~<­Ş/pŞicy-·th.h
>

34 
	~<¡dboŞ.h
>

35 
	~<¡ršg.h
>

37 
	#POLICY
 
TEST_POLICIES
 "/£toŞs-3.3/­Ş/d_‹¡.pŞicy.cÚf"

	)

39 
­Ş_pŞicy_t
 *
	gp
 = 
NULL
;

41 
	$d_fÜw¬d
()

43 
	`­Ş_pŞicy_»£t_domaš_Œªs_bË
(
p
);

44 
­Ş_domaš_Œªs_ª®ysis_t
 *
d
 = 
	`­Ş_domaš_Œªs_ª®ysis_ü—‹
();

45 
	`CU_ASSERT_PTR_NOT_NULL_FATAL
(
d
);

46 
»tv®
 = 
	`­Ş_domaš_Œªs_ª®ysis_£t_dœeùiÚ
(
p
, 
d
, 
APOL_DOMAIN_TRANS_DIRECTION_FORWARD
);

47 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

48 
»tv®
 = 
	`­Ş_domaš_Œªs_ª®ysis_£t_¡¬t_ty³
(
p
, 
d
, "tuna_t");

49 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

51 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

52 
»tv®
 = 
	`­Ş_domaš_Œªs_ª®ysis_do
(
p
, 
d
, &
v
);

53 
	`­Ş_domaš_Œªs_ª®ysis_de¡roy
(&
d
);

54 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

55 
	`CU_ASSERT_PTR_NOT_NULL
(
v
);

57 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
p
);

58 
size_t
 
i
;

59 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v
); i++) {

60 cÚ¡ 
­Ş_domaš_Œªs_»suÉ_t
 *
dŒ
 = (cÚ¡‡pŞ_domaš_Œªs_»suÉ_ˆ*)
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

62 cÚ¡ 
qpŞ_ty³_t
 *
qt
 = 
	`­Ş_domaš_Œªs_»suÉ_g‘_¡¬t_ty³
(
dŒ
);

63 
	`CU_ASSERT_PTR_NOT_NULL
(
qt
);

64 cÚ¡ *
Çme
, *
•_Çme
;

65 
»tv®
 = 
	`qpŞ_ty³_g‘_Çme
(
q
, 
qt
, &
Çme
);

66 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

67 
	`CU_ASSERT_STRING_EQUAL
(
Çme
, "tuna_t");

69 
qt
 = 
	`­Ş_domaš_Œªs_»suÉ_g‘_’d_ty³
(
dŒ
);

70 
	`CU_ASSERT_PTR_NOT_NULL
(
qt
);

71 
»tv®
 = 
	`qpŞ_ty³_g‘_Çme
(
q
, 
qt
, &
Çme
);

72 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

73 
	`CU_ASSERT
(
	`¡rcmp
(
Çme
, "boat_t") == 0 || strcmp(name, "sand_t") == 0);

75 
qt
 = 
	`­Ş_domaš_Œªs_»suÉ_g‘_’Œypošt_ty³
(
dŒ
);

76 
	`CU_ASSERT_PTR_NOT_NULL
(
qt
);

77 
»tv®
 = 
	`qpŞ_ty³_g‘_Çme
(
q
, 
qt
, &
•_Çme
);

78 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

80 ià(
	`¡rcmp
(
Çme
, "boat_t") == 0) {

81 
	`CU_ASSERT_STRING_EQUAL
(
•_Çme
, "net_t");

82 } ià(
	`¡rcmp
(
Çme
, "sand_t") == 0) {

83 
	`CU_ASSERT
(
	`¡rcmp
(
•_Çme
, "reel_t") == 0 || strcmp(ep_name, "wave_t") == 0);

87 
	`­Ş_veùÜ_de¡roy
(&
v
);

88 
	}
}

90 
	$d_fÜw¬d_muÉi_’d
()

92 
	`­Ş_pŞicy_»£t_domaš_Œªs_bË
(
p
);

93 
­Ş_domaš_Œªs_ª®ysis_t
 *
d
 = 
	`­Ş_domaš_Œªs_ª®ysis_ü—‹
();

94 
	`CU_ASSERT_PTR_NOT_NULL_FATAL
(
d
);

95 
»tv®
 = 
	`­Ş_domaš_Œªs_ª®ysis_£t_dœeùiÚ
(
p
, 
d
, 
APOL_DOMAIN_TRANS_DIRECTION_FORWARD
);

96 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

97 
»tv®
 = 
	`­Ş_domaš_Œªs_ª®ysis_£t_¡¬t_ty³
(
p
, 
d
, "shark_t");

98 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

100 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

101 
»tv®
 = 
	`­Ş_domaš_Œªs_ª®ysis_do
(
p
, 
d
, &
v
);

102 
	`­Ş_domaš_Œªs_ª®ysis_de¡roy
(&
d
);

103 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

104 
	`CU_ASSERT_PTR_NOT_NULL
(
v
);

105 
	`CU_ASSERT
(
	`­Ş_veùÜ_g‘_size
(
v
) == 2);

107 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
p
);

108 
size_t
 
i
;

109 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v
); i++) {

110 cÚ¡ 
­Ş_domaš_Œªs_»suÉ_t
 *
dŒ
 = (cÚ¡‡pŞ_domaš_Œªs_»suÉ_ˆ*)
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

112 cÚ¡ 
qpŞ_ty³_t
 *
qt
 = 
	`­Ş_domaš_Œªs_»suÉ_g‘_¡¬t_ty³
(
dŒ
);

113 
	`CU_ASSERT_PTR_NOT_NULL
(
qt
);

114 cÚ¡ *
Çme
, *
•_Çme
;

115 
»tv®
 = 
	`qpŞ_ty³_g‘_Çme
(
q
, 
qt
, &
Çme
);

116 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

117 
	`CU_ASSERT_STRING_EQUAL
(
Çme
, "shark_t");

119 
qt
 = 
	`­Ş_domaš_Œªs_»suÉ_g‘_’d_ty³
(
dŒ
);

120 
	`CU_ASSERT_PTR_NOT_NULL
(
qt
);

121 
»tv®
 = 
	`qpŞ_ty³_g‘_Çme
(
q
, 
qt
, &
Çme
);

122 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

123 
	`CU_ASSERT
(
	`¡rcmp
(
Çme
, "surf_t") == 0 || strcmp(name, "sand_t") == 0);

125 
qt
 = 
	`­Ş_domaš_Œªs_»suÉ_g‘_’Œypošt_ty³
(
dŒ
);

126 
	`CU_ASSERT_PTR_NOT_NULL
(
qt
);

127 
»tv®
 = 
	`qpŞ_ty³_g‘_Çme
(
q
, 
qt
, &
•_Çme
);

128 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

130 
	`CU_ASSERT_STRING_EQUAL
(
•_Çme
, "wave_t");

133 
	`­Ş_veùÜ_de¡roy
(&
v
);

134 
	}
}

136 
	$d_fÜw¬d_acûss
()

138 
	`­Ş_pŞicy_»£t_domaš_Œªs_bË
(
p
);

139 
­Ş_domaš_Œªs_ª®ysis_t
 *
d
 = 
	`­Ş_domaš_Œªs_ª®ysis_ü—‹
();

140 
	`CU_ASSERT_PTR_NOT_NULL_FATAL
(
d
);

141 
»tv®
 = 
	`­Ş_domaš_Œªs_ª®ysis_£t_dœeùiÚ
(
p
, 
d
, 
APOL_DOMAIN_TRANS_DIRECTION_FORWARD
);

142 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

143 
»tv®
 = 
	`­Ş_domaš_Œªs_ª®ysis_£t_¡¬t_ty³
(
p
, 
d
, "tuna_t");

144 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

145 
»tv®
 = 
	`­Ş_domaš_Œªs_ª®ysis_­³nd_acûss_ty³
(
p
, 
d
, "boat_t");

146 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

147 
»tv®
 = 
	`­Ş_domaš_Œªs_ª®ysis_­³nd_acûss_ty³
(
p
, 
d
, "sand_t");

148 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

149 
»tv®
 = 
	`­Ş_domaš_Œªs_ª®ysis_­³nd_acûss_ty³
(
p
, 
d
, "wave_t");

150 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

151 
»tv®
 = 
	`­Ş_domaš_Œªs_ª®ysis_­³nd_şass
(
p
, 
d
, "file");

152 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

153 
»tv®
 = 
	`­Ş_domaš_Œªs_ª®ysis_­³nd_³rm
(
p
, 
d
, "write");

154 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

156 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

157 
»tv®
 = 
	`­Ş_domaš_Œªs_ª®ysis_do
(
p
, 
d
, &
v
);

158 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

159 
	`CU_ASSERT
(
v
 !ğ
NULL
 && 
	`­Ş_veùÜ_g‘_size
(v) > 0);

161 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
p
);

162 
size_t
 
i
;

163 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v
); i++) {

164 cÚ¡ 
­Ş_domaš_Œªs_»suÉ_t
 *
dŒ
 = (cÚ¡‡pŞ_domaš_Œªs_»suÉ_ˆ*)
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

166 cÚ¡ 
qpŞ_ty³_t
 *
qt
 = 
	`­Ş_domaš_Œªs_»suÉ_g‘_¡¬t_ty³
(
dŒ
);

167 
	`CU_ASSERT_PTR_NOT_NULL
(
qt
);

168 cÚ¡ *
Çme
;

169 
»tv®
 = 
	`qpŞ_ty³_g‘_Çme
(
q
, 
qt
, &
Çme
);

170 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

171 
	`CU_ASSERT_STRING_EQUAL
(
Çme
, "tuna_t");

173 
qt
 = 
	`­Ş_domaš_Œªs_»suÉ_g‘_’d_ty³
(
dŒ
);

174 
	`CU_ASSERT_PTR_NOT_NULL
(
qt
);

175 
»tv®
 = 
	`qpŞ_ty³_g‘_Çme
(
q
, 
qt
, &
Çme
);

176 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

177 
	`CU_ASSERT_STRING_EQUAL
(
Çme
, "boat_t");

179 cÚ¡ 
­Ş_veùÜ_t
 *
ruËs_v
 = 
	`­Ş_domaš_Œªs_»suÉ_g‘_acûss_ruËs
(
dŒ
);

180 
	`CU_ASSERT_FATAL
(
ruËs_v
 !ğ
NULL
 && 
	`­Ş_veùÜ_g‘_size
(rules_v) > 0);

181 
size_t
 
j
;

182 
j
 = 0; j < 
	`­Ş_veùÜ_g‘_size
(
ruËs_v
); j++) {

183 cÚ¡ 
qpŞ_avruË_t
 *
qa
 = (cÚ¡ qpŞ_avruË_ˆ*)
	`­Ş_veùÜ_g‘_–em’t
(
ruËs_v
, 
j
);

184 *
»nd”
 = 
	`­Ş_avruË_»nd”
(
p
, 
qa
);

185 
	`CU_ASSERT_PTR_NOT_NULL_FATAL
(
»nd”
);

186 
	`CU_ASSERT_STRING_EQUAL
(
»nd”
, "allow boat_t wave_t : file { write getattrƒxecute } ;");

187 
	`ä“
(
»nd”
);

191 
	`­Ş_veùÜ_de¡roy
(&
v
);

193 
»tv®
 = 
	`­Ş_domaš_Œªs_ª®ysis_£t_¡¬t_ty³
(
p
, 
d
, "boat_t");

194 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

195 
»tv®
 = 
	`­Ş_domaš_Œªs_ª®ysis_­³nd_acûss_ty³
(
p
, 
d
, 
NULL
);

196 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

197 
»tv®
 = 
	`­Ş_domaš_Œªs_ª®ysis_­³nd_şass
(
p
, 
d
, 
NULL
);

198 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

199 
»tv®
 = 
	`­Ş_domaš_Œªs_ª®ysis_­³nd_³rm
(
p
, 
d
, 
NULL
);

200 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

202 
	`­Ş_pŞicy_»£t_domaš_Œªs_bË
(
p
);

203 
»tv®
 = 
	`­Ş_domaš_Œªs_ª®ysis_do
(
p
, 
d
, &
v
);

204 
	`­Ş_domaš_Œªs_ª®ysis_de¡roy
(&
d
);

205 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

206 
	`CU_ASSERT
(
v
 !ğ
NULL
 && 
	`­Ş_veùÜ_g‘_size
(v) > 0);

208 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v
); i++) {

209 cÚ¡ 
­Ş_domaš_Œªs_»suÉ_t
 *
dŒ
 = (cÚ¡‡pŞ_domaš_Œªs_»suÉ_ˆ*)
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

211 cÚ¡ 
qpŞ_ty³_t
 *
qt
 = 
	`­Ş_domaš_Œªs_»suÉ_g‘_¡¬t_ty³
(
dŒ
);

212 
	`CU_ASSERT_PTR_NOT_NULL
(
qt
);

213 cÚ¡ *
Çme
;

214 
»tv®
 = 
	`qpŞ_ty³_g‘_Çme
(
q
, 
qt
, &
Çme
);

215 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

216 
	`CU_ASSERT_STRING_EQUAL
(
Çme
, "boat_t");

218 
qt
 = 
	`­Ş_domaš_Œªs_»suÉ_g‘_’d_ty³
(
dŒ
);

219 
	`CU_ASSERT_PTR_NOT_NULL
(
qt
);

220 
»tv®
 = 
	`qpŞ_ty³_g‘_Çme
(
q
, 
qt
, &
Çme
);

221 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

222 
	`CU_ASSERT
(
	`¡rcmp
(
Çme
, "sand_t") == 0 || strcmp(name, "dock_t") == 0);

224 
	`­Ş_veùÜ_de¡roy
(&
v
);

225 
	}
}

227 
	$d_»v”£
()

229 
	`­Ş_pŞicy_»£t_domaš_Œªs_bË
(
p
);

230 
­Ş_domaš_Œªs_ª®ysis_t
 *
d
 = 
	`­Ş_domaš_Œªs_ª®ysis_ü—‹
();

231 
	`CU_ASSERT_PTR_NOT_NULL_FATAL
(
d
);

232 
»tv®
;

233 
»tv®
 = 
	`­Ş_domaš_Œªs_ª®ysis_£t_¡¬t_ty³
(
p
, 
d
, "sand_t");

234 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

235 
»tv®
 = 
	`­Ş_domaš_Œªs_ª®ysis_£t_dœeùiÚ
(
p
, 
d
, 
APOL_DOMAIN_TRANS_DIRECTION_REVERSE
);

236 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

238 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

239 
»tv®
 = 
	`­Ş_domaš_Œªs_ª®ysis_do
(
p
, 
d
, &
v
);

240 
	`­Ş_domaš_Œªs_ª®ysis_de¡roy
(&
d
);

241 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

242 
	`CU_ASSERT
(
v
 !ğ
NULL
 && 
	`­Ş_veùÜ_g‘_size
(v) > 0);

244 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
p
);

245 
size_t
 
i
;

246 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v
); i++) {

247 cÚ¡ 
­Ş_domaš_Œªs_»suÉ_t
 *
dŒ
 = (cÚ¡‡pŞ_domaš_Œªs_»suÉ_ˆ*)
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

249 cÚ¡ 
qpŞ_ty³_t
 *
qt
 = 
	`­Ş_domaš_Œªs_»suÉ_g‘_’d_ty³
(
dŒ
);

250 
	`CU_ASSERT_PTR_NOT_NULL
(
qt
);

251 cÚ¡ *
Çme
;

252 
»tv®
 = 
	`qpŞ_ty³_g‘_Çme
(
q
, 
qt
, &
Çme
);

253 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

254 
	`CU_ASSERT_STRING_EQUAL
(
Çme
, "sand_t");

256 
qt
 = 
	`­Ş_domaš_Œªs_»suÉ_g‘_¡¬t_ty³
(
dŒ
);

257 
	`CU_ASSERT_PTR_NOT_NULL
(
qt
);

258 
»tv®
 = 
	`qpŞ_ty³_g‘_Çme
(
q
, 
qt
, &
Çme
);

259 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

260 
	`CU_ASSERT
(
	`¡rcmp
(
Çme
, "boat_t") == 0 || strcmp(name, "grouper_t") == 0 || strcmp(name, "shark_t") == 0 ||

261 
	`¡rcmp
(
Çme
, "tuna_t") == 0);

264 
	`­Ş_veùÜ_de¡roy
(&
v
);

265 
	}
}

267 
	$d_»v”£_»gexp
()

269 
	`­Ş_pŞicy_»£t_domaš_Œªs_bË
(
p
);

270 
­Ş_domaš_Œªs_ª®ysis_t
 *
d
 = 
	`­Ş_domaš_Œªs_ª®ysis_ü—‹
();

271 
	`CU_ASSERT_PTR_NOT_NULL_FATAL
(
d
);

272 
»tv®
;

273 
»tv®
 = 
	`­Ş_domaš_Œªs_ª®ysis_£t_¡¬t_ty³
(
p
, 
d
, "sand_t");

274 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

275 
»tv®
 = 
	`­Ş_domaš_Œªs_ª®ysis_£t_dœeùiÚ
(
p
, 
d
, 
APOL_DOMAIN_TRANS_DIRECTION_REVERSE
);

276 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

277 
»tv®
 = 
	`­Ş_domaš_Œªs_ª®ysis_£t_»suÉ_»gex
(
p
, 
d
, "u");

278 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

280 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

281 
»tv®
 = 
	`­Ş_domaš_Œªs_ª®ysis_do
(
p
, 
d
, &
v
);

282 
	`­Ş_domaš_Œªs_ª®ysis_de¡roy
(&
d
);

283 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

284 
	`CU_ASSERT
(
v
 !ğ
NULL
 && 
	`­Ş_veùÜ_g‘_size
(v) > 0);

286 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
p
);

287 
size_t
 
i
;

288 
boŞ
 
found_tuÇ_wave
 = 
çl£
, 
found_grou³r_»–
 = f®£, 
found_grou³r_wave
 = false;

289 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v
); i++) {

290 cÚ¡ 
­Ş_domaš_Œªs_»suÉ_t
 *
dŒ
 = (cÚ¡‡pŞ_domaš_Œªs_»suÉ_ˆ*)
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

292 cÚ¡ 
qpŞ_ty³_t
 *
qt
 = 
	`­Ş_domaš_Œªs_»suÉ_g‘_’d_ty³
(
dŒ
);

293 
	`CU_ASSERT_PTR_NOT_NULL
(
qt
);

294 cÚ¡ *
Çme
, *
•_Çme
;

295 
»tv®
 = 
	`qpŞ_ty³_g‘_Çme
(
q
, 
qt
, &
Çme
);

296 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

297 
	`CU_ASSERT_STRING_EQUAL
(
Çme
, "sand_t");

299 
qt
 = 
	`­Ş_domaš_Œªs_»suÉ_g‘_¡¬t_ty³
(
dŒ
);

300 
	`CU_ASSERT_PTR_NOT_NULL
(
qt
);

301 
»tv®
 = 
	`qpŞ_ty³_g‘_Çme
(
q
, 
qt
, &
Çme
);

302 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

303 
	`CU_ASSERT
(
	`¡rcmp
(
Çme
, "tuna_t") == 0 || strcmp(name, "grouper_t") == 0);

305 
qt
 = 
	`­Ş_domaš_Œªs_»suÉ_g‘_’Œypošt_ty³
(
dŒ
);

306 
	`CU_ASSERT_PTR_NOT_NULL
(
qt
);

307 
»tv®
 = 
	`qpŞ_ty³_g‘_Çme
(
q
, 
qt
, &
•_Çme
);

308 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

310 ià(
	`¡rcmp
(
Çme
, "tuna_t") == 0) {

311 ià(
	`¡rcmp
(
•_Çme
, "wave_t") == 0) {

312 
found_tuÇ_wave
 = 
Œue
;

314 } ià(
	`¡rcmp
(
Çme
, "grouper_t") == 0) {

315 ià(
	`¡rcmp
(
•_Çme
, "reel_t") == 0) {

316 
found_grou³r_»–
 = 
Œue
;

317 } ià(
	`¡rcmp
(
•_Çme
, "wave_t") == 0) {

318 
found_grou³r_wave
 = 
Œue
;

322 
	`CU_ASSERT
(
found_tuÇ_wave
 && 
found_grou³r_»–
 && 
found_grou³r_wave
);

324 
	`­Ş_veùÜ_de¡roy
(&
v
);

325 
	}
}

327 
	$d_»æexive
()

329 
	`­Ş_pŞicy_»£t_domaš_Œªs_bË
(
p
);

330 
­Ş_domaš_Œªs_ª®ysis_t
 *
d
 = 
	`­Ş_domaš_Œªs_ª®ysis_ü—‹
();

331 
	`CU_ASSERT_PTR_NOT_NULL_FATAL
(
d
);

332 
»tv®
 = 
	`­Ş_domaš_Œªs_ª®ysis_£t_dœeùiÚ
(
p
, 
d
, 
APOL_DOMAIN_TRANS_DIRECTION_FORWARD
);

333 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

334 
»tv®
 = 
	`­Ş_domaš_Œªs_ª®ysis_£t_¡¬t_ty³
(
p
, 
d
, "sand_t");

335 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

337 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

338 
»tv®
 = 
	`­Ş_domaš_Œªs_ª®ysis_do
(
p
, 
d
, &
v
);

339 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

340 
	`CU_ASSERT
(
v
 !ğ
NULL
 && 
	`­Ş_veùÜ_g‘_size
(v) == 0);

341 
	`­Ş_veùÜ_de¡roy
(&
v
);

343 
»tv®
 = 
	`­Ş_domaš_Œªs_ª®ysis_£t_dœeùiÚ
(
p
, 
d
, 
APOL_DOMAIN_TRANS_DIRECTION_REVERSE
);

344 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

346 
»tv®
 = 
	`­Ş_domaš_Œªs_ª®ysis_do
(
p
, 
d
, &
v
);

347 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

348 
	`CU_ASSERT
(
v
 !ğ
NULL
 && 
	`­Ş_veùÜ_g‘_size
(v) > 0);

349 
size_t
 
i
;

350 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
p
);

351 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v
); i++) {

352 cÚ¡ 
­Ş_domaš_Œªs_»suÉ_t
 *
dŒ
 = (cÚ¡‡pŞ_domaš_Œªs_»suÉ_ˆ*)
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

354 cÚ¡ 
qpŞ_ty³_t
 *
qt
 = 
	`­Ş_domaš_Œªs_»suÉ_g‘_¡¬t_ty³
(
dŒ
);

355 
	`CU_ASSERT_PTR_NOT_NULL
(
qt
);

356 cÚ¡ *
Çme
;

357 
»tv®
 = 
	`qpŞ_ty³_g‘_Çme
(
q
, 
qt
, &
Çme
);

358 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

359 
	`CU_ASSERT_STRING_NOT_EQUAL
(
Çme
, "sand_t");

361 
	`­Ş_veùÜ_de¡roy
(&
v
);

363 
	`­Ş_domaš_Œªs_ª®ysis_de¡roy
(&
d
);

364 
	}
}

366 
	sd_šv®id_™em


368 cÚ¡ *
	m¡¬t_ty³
;

369 cÚ¡ *
	m’d_ty³
;

370 cÚ¡ *
	m’Œypošt_ty³
;

371 cÚ¡ 
boŞ
 
	mmissšg_´oc_Œªs
;

372 cÚ¡ 
boŞ
 
	mmissšg_’Œypošt
;

373 cÚ¡ 
boŞ
 
	mmissšg_exec
;

374 cÚ¡ 
boŞ
 
	mmissšg_£‹xec
;

375 cÚ¡ 
boŞ
 
	mmissšg_ty³_Œªs
;

376 
boŞ
 
	mu£d
;

379 
	$d_šv®id
()

381 
d_šv®id_™em
 
™ems
[] = {

382 {"bßt_t", "dock_t", "Ãt_t", 
çl£
, f®£, 
Œue
, false, false, false},

383 {"bßt_t", "§nd_t", "»–_t", 
çl£
, f®£, 
Œue
, false, false, false},

384 {"üab_t", "dock_t", "Ãt_t", 
çl£
, f®£, f®£, 
Œue
, false, false},

385 {"üab_t", "dock_t", "rİe_t", 
çl£
, f®£, 
Œue
,rue, false, false},

386 {"üab_t", "dock_t", "wave_t", 
çl£
, 
Œue
,rue, false, false, false},

387 {"guÎ_t", "dock_t", "Ãt_t", 
çl£
, f®£, f®£, 
Œue
,rue, false},

388 {"guÎ_t", "dock_t", "rİe_t", 
çl£
, f®£, 
Œue
,rue,rue, false},

389 {"guÎ_t", "§nd_t", "Ãt_t", 
Œue
,rue, 
çl£
, false, false, false},

390 {"m¬lš_t", "bßt_t", "lše_t", 
çl£
, f®£, 
Œue
, false, false, false},

391 {"m¬lš_t", "bßt_t", "Ãt_t", 
çl£
, f®£, 
Œue
, false, false, false},

392 {"¿y_t", "bßt_t", "lše_t", 
Œue
, 
çl£
,rue, false, false, false},

393 {"¿y_t", "§nd_t", "wave_t", 
Œue
, 
çl£
, false, false, false, false},

394 {"sh¬k_t", "§nd_t", "»–_t", 
çl£
, f®£, 
Œue
, false, false, false},

395 {"tuÇ_t", "bßt_t", "lše_t", 
çl£
, f®£, 
Œue
, false, false, false},

396 {"tuÇ_t", "bßt_t", "»–_t", 
çl£
, 
Œue
, false, false, false, false},

397 {
NULL
, NULL, NULL, 
çl£
, false, false, false, false, false}

399 cÚ¡ *
¡¬t_ty³s
[] = {

400 "bßt_t", "üab_t", "guÎ_t", "m¬lš_t", "¿y_t", "sh¬k_t", "tuÇ_t", 
NULL


402 
­Ş_domaš_Œªs_ª®ysis_t
 *
d
 = 
	`­Ş_domaš_Œªs_ª®ysis_ü—‹
();

403 
	`CU_ASSERT_PTR_NOT_NULL_FATAL
(
d
);

404 
»tv®
 = 
	`­Ş_domaš_Œªs_ª®ysis_£t_dœeùiÚ
(
p
, 
d
, 
APOL_DOMAIN_TRANS_DIRECTION_FORWARD
);

405 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

406 
»tv®
 = 
	`­Ş_domaš_Œªs_ª®ysis_£t_v®id
(
p
, 
d
, 
APOL_DOMAIN_TRANS_SEARCH_INVALID
);

407 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

409 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
p
);

410 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

411 
d_šv®id_™em
 *
™em
;

412 cÚ¡ **
¡¬t
 = 
¡¬t_ty³s
; *¡¬ˆ!ğ
NULL
; start++) {

413 
	`­Ş_pŞicy_»£t_domaš_Œªs_bË
(
p
);

414 
»tv®
 = 
	`­Ş_domaš_Œªs_ª®ysis_£t_¡¬t_ty³
(
p
, 
d
, *
¡¬t
);

415 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

417 
»tv®
 = 
	`­Ş_domaš_Œªs_ª®ysis_do
(
p
, 
d
, &
v
);

418 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

419 
	`CU_ASSERT
(
v
 !ğ
NULL
 && 
	`­Ş_veùÜ_g‘_size
(v) > 0);

421 
size_t
 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v
); i++) {

422 cÚ¡ 
­Ş_domaš_Œªs_»suÉ_t
 *
dŒ
 = (cÚ¡‡pŞ_domaš_Œªs_»suÉ_ˆ*)
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

424 cÚ¡ *
»suÉ_¡¬t
, *
»suÉ_’d
, *
»suÉ_’Œy
;

426 cÚ¡ 
qpŞ_ty³_t
 *
qt
 = 
	`­Ş_domaš_Œªs_»suÉ_g‘_¡¬t_ty³
(
dŒ
);

427 
	`CU_ASSERT_PTR_NOT_NULL
(
qt
);

428 
»tv®
 = 
	`qpŞ_ty³_g‘_Çme
(
q
, 
qt
, &
»suÉ_¡¬t
);

429 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

430 
	`CU_ASSERT_STRING_EQUAL
(
»suÉ_¡¬t
, *
¡¬t
);

432 
qt
 = 
	`­Ş_domaš_Œªs_»suÉ_g‘_’d_ty³
(
dŒ
);

433 
	`CU_ASSERT_PTR_NOT_NULL
(
qt
);

434 
»tv®
 = 
	`qpŞ_ty³_g‘_Çme
(
q
, 
qt
, &
»suÉ_’d
);

435 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

437 
qt
 = 
	`­Ş_domaš_Œªs_»suÉ_g‘_’Œypošt_ty³
(
dŒ
);

438 
	`CU_ASSERT_PTR_NOT_NULL
(
qt
);

439 
»tv®
 = 
	`qpŞ_ty³_g‘_Çme
(
q
, 
qt
, &
»suÉ_’Œy
);

440 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

442 
	`CU_ASSERT
(
	`­Ş_domaš_Œªs_»suÉ_is_Œªs_v®id
(
dŒ
) == 0);

444 
™em
 = 
™ems
 + 0; i‹m->
¡¬t_ty³
 !ğ
NULL
; item++) {

445 ià(
	`¡rcmp
(
»suÉ_¡¬t
, 
™em
->
¡¬t_ty³
) == 0 &&

446 
	`¡rcmp
(
»suÉ_’d
, 
™em
->
’d_ty³
) == 0 &&

447 
	`¡rcmp
(
»suÉ_’Œy
, 
™em
->
’Œypošt_ty³
è=ğ0 && !™em->
u£d
) {

448 
™em
->
u£d
 = 
Œue
;

450 cÚ¡ 
­Ş_veùÜ_t
 *
cv
;

451 ià(
™em
->
missšg_´oc_Œªs
) {

452 
cv
 = 
	`­Ş_domaš_Œªs_»suÉ_g‘_´oc_Œªs_ruËs
(
dŒ
);

453 
	`CU_ASSERT
(
cv
 !ğ
NULL
 && 
	`­Ş_veùÜ_g‘_size
(cv) == 0);

455 ià(
™em
->
missšg_’Œypošt
) {

456 
cv
 = 
	`­Ş_domaš_Œªs_»suÉ_g‘_’Œypošt_ruËs
(
dŒ
);

457 
	`CU_ASSERT
(
cv
 !ğ
NULL
 && 
	`­Ş_veùÜ_g‘_size
(cv) == 0);

459 ià(
™em
->
missšg_exec
) {

460 
cv
 = 
	`­Ş_domaš_Œªs_»suÉ_g‘_exec_ruËs
(
dŒ
);

461 
	`CU_ASSERT
(
cv
 !ğ
NULL
 && 
	`­Ş_veùÜ_g‘_size
(cv) == 0);

463 ià(
™em
->
missšg_£‹xec
) {

464 
cv
 = 
	`­Ş_domaš_Œªs_»suÉ_g‘_£‹xec_ruËs
(
dŒ
);

465 
	`CU_ASSERT
(
cv
 !ğ
NULL
 && 
	`­Ş_veùÜ_g‘_size
(cv) == 0);

467 ià(
™em
->
missšg_ty³_Œªs
) {

468 
cv
 = 
	`­Ş_domaš_Œªs_»suÉ_g‘_ty³_Œªs_ruËs
(
dŒ
);

469 
	`CU_ASSERT
(
cv
 !ğ
NULL
 && 
	`­Ş_veùÜ_g‘_size
(cv) == 0);

474 ià(
™em
->
¡¬t_ty³
 =ğ
NULL
) {

475 
	`CU_FAIL
();

478 
	`­Ş_veùÜ_de¡roy
(&
v
);

481 
™em
 = 
™ems
 + 0; i‹m->
¡¬t_ty³
 !ğ
NULL
; item++) {

482 
	`CU_ASSERT
(
™em
->
u£d
);

484 
	`­Ş_domaš_Œªs_ª®ysis_de¡roy
(&
d
);

485 
	}
}

487 
CU_Te¡Info
 
	gd_‹¡s
[] = {

488 {"d fÜw¬d", 
d_fÜw¬d
}

490 {"d fÜw¬d +‡cûss", 
d_fÜw¬d_acûss
}

492 {"d fÜw¬d w™h muÉËƒndpošt fÜ sam’Œypošt", 
d_fÜw¬d_muÉi_’d
}

494 {"d„ev”£", 
d_»v”£
}

496 {"d„ev”£ +„egexp", 
d_»v”£_»gexp
}

498 {"d„eæexive", 
d_»æexive
}

500 {"d inv®id¿ns™iÚs", 
d_šv®id
}

502 
CU_TEST_INFO_NULL


505 
	$d_š™
()

507 
­Ş_pŞicy_·th_t
 *
µ©h
 = 
	`­Ş_pŞicy_·th_ü—‹
(
APOL_POLICY_PATH_TYPE_MONOLITHIC
, 
POLICY
, 
NULL
);

508 ià(
µ©h
 =ğ
NULL
) {

512 ià((
p
 = 
	`­Ş_pŞicy_ü—‹_äom_pŞicy_·th
(
µ©h
, 
QPOL_POLICY_OPTION_NO_NEVERALLOWS
, 
NULL
, NULL)) == NULL) {

513 
	`­Ş_pŞicy_·th_de¡roy
(&
µ©h
);

516 
	`­Ş_pŞicy_·th_de¡roy
(&
µ©h
);

518 
»tv®
 = 
	`­Ş_pŞicy_bud_domaš_Œªs_bË
(
p
);

519 ià(
»tv®
 != 0) {

523 
	}
}

525 
	$d_ş—nup
()

527 
	`­Ş_pŞicy_de¡roy
(&
p
);

529 
	}
}

	@libapol/tests/dta-tests.h

26 #iâdeà
DTA_TESTS_H


27 
	#DTA_TESTS_H


	)

29 
	~<CUn™/CUn™.h
>

31 
CU_Te¡Info
 
d_‹¡s
[];

32 
d_š™
();

33 
d_ş—nup
();

	@libapol/tests/infoflow-tests.c

26 
	~<cÚfig.h
>

28 
	~<CUn™/CUn™.h
>

29 
	~<­Ş/šfoæow-ª®ysis.h
>

30 
	~<­Ş/³rm-m­.h
>

31 
	~<­Ş/pŞicy.h
>

32 
	~<­Ş/pŞicy-·th.h
>

33 
	~<¡dboŞ.h
>

34 
	~<¡ršg.h
>

36 
	#BIG_POLICY
 
TEST_POLICIES
 "/¢­shÙs/fc4_rg‘ed.pŞicy.cÚf"

	)

37 
	#PERMMAP
 
TOP_SRCDIR
 "/­Ş/³rm_m­s/­Ş_³rm_m­pšg_v”19"

	)

39 
­Ş_pŞicy_t
 *
	gp
 = 
NULL
;

41 
	$šfoæow_dœeù_ov”v›w
()

43 
­Ş_šfoæow_ª®ysis_t
 *
Ÿ
 = 
	`­Ş_šfoæow_ª®ysis_ü—‹
();

44 
	`CU_ASSERT_PTR_NOT_NULL_FATAL
(
Ÿ
);

45 
»tv®
;

46 
»tv®
 = 
	`­Ş_šfoæow_ª®ysis_£t_mode
(
p
, 
Ÿ
, 
APOL_INFOFLOW_MODE_DIRECT
);

47 
	`CU_ASSERT
(
»tv®
 == 0);

48 
»tv®
 = 
	`­Ş_šfoæow_ª®ysis_£t_dœ
(
p
, 
Ÿ
, 
APOL_INFOFLOW_IN
);

49 
	`CU_ASSERT
(
»tv®
 == 0);

50 
»tv®
 = 
	`­Ş_šfoæow_ª®ysis_£t_ty³
(
p
, 
Ÿ
, "agp_device_t");

51 
	`CU_ASSERT
(
»tv®
 == 0);

53 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

54 
­Ş_šfoæow_g¿ph_t
 *
g
 = 
NULL
;

56 
»tv®
 = 
	`­Ş_šfoæow_ª®ysis_do
(
p
, 
Ÿ
, &
v
, &
g
);

57 
	`CU_ASSERT
(
»tv®
 < 0);

59 
»tv®
 = 
	`­Ş_pŞicy_İ’_³rmm­
(
p
, 
PERMMAP
);

60 
	`CU_ASSERT
(
»tv®
 == 0);

62 
»tv®
 = 
	`­Ş_šfoæow_ª®ysis_do
(
p
, 
Ÿ
, &
v
, &
g
);

63 
	`CU_ASSERT
(
»tv®
 == 0);

64 
	`CU_ASSERT_PTR_NOT_NULL
(
v
);

65 
	`CU_ASSERT
(
	`­Ş_veùÜ_g‘_size
(
v
) > 0);

66 
	`CU_ASSERT_PTR_NOT_NULL
(
g
);

68 
	`­Ş_šfoæow_ª®ysis_de¡roy
(&
Ÿ
);

69 
	`­Ş_veùÜ_de¡roy
(&
v
);

70 
	`­Ş_šfoæow_g¿ph_de¡roy
(&
g
);

71 
	}
}

73 
	$šfoæow_Œªs_ov”v›w
()

75 
­Ş_šfoæow_ª®ysis_t
 *
Ÿ
 = 
	`­Ş_šfoæow_ª®ysis_ü—‹
();

76 
	`CU_ASSERT_PTR_NOT_NULL_FATAL
(
Ÿ
);

77 
»tv®
;

78 
»tv®
 = 
	`­Ş_šfoæow_ª®ysis_£t_mode
(
p
, 
Ÿ
, 
APOL_INFOFLOW_MODE_DIRECT
);

79 
	`CU_ASSERT
(
»tv®
 == 0);

80 
»tv®
 = 
	`­Ş_šfoæow_ª®ysis_£t_dœ
(
p
, 
Ÿ
, 
APOL_INFOFLOW_IN
);

81 
	`CU_ASSERT
(
»tv®
 == 0);

82 
»tv®
 = 
	`­Ş_šfoæow_ª®ysis_£t_ty³
(
p
, 
Ÿ
, "local_login_t");

83 
	`CU_ASSERT
(
»tv®
 == 0);

85 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

86 
­Ş_šfoæow_g¿ph_t
 *
g
 = 
NULL
;

88 
»tv®
 = 
	`­Ş_šfoæow_ª®ysis_do
(
p
, 
Ÿ
, &
v
, &
g
);

89 
	`CU_ASSERT
(
»tv®
 == 0);

90 
	`CU_ASSERT_PTR_NOT_NULL
(
v
);

91 
	`CU_ASSERT
(
	`­Ş_veùÜ_g‘_size
(
v
) > 0);

92 
	`CU_ASSERT_PTR_NOT_NULL
(
g
);

94 
	`­Ş_šfoæow_ª®ysis_de¡roy
(&
Ÿ
);

95 
	`­Ş_veùÜ_de¡roy
(&
v
);

96 
	`­Ş_šfoæow_g¿ph_de¡roy
(&
g
);

97 
	}
}

99 
CU_Te¡Info
 
	gšfoæow_‹¡s
[] = {

100 {"šfoæow dœeù ov”v›w", 
šfoæow_dœeù_ov”v›w
}

102 {"šfoæow¿n ov”v›w", 
šfoæow_Œªs_ov”v›w
}

104 
CU_TEST_INFO_NULL


107 
	$šfoæow_š™
()

109 
­Ş_pŞicy_·th_t
 *
µ©h
 = 
	`­Ş_pŞicy_·th_ü—‹
(
APOL_POLICY_PATH_TYPE_MONOLITHIC
, 
BIG_POLICY
, 
NULL
);

110 ià(
µ©h
 =ğ
NULL
) {

114 ià((
p
 = 
	`­Ş_pŞicy_ü—‹_äom_pŞicy_·th
(
µ©h
, 
QPOL_POLICY_OPTION_NO_NEVERALLOWS
, 
NULL
, NULL)) == NULL) {

115 
	`­Ş_pŞicy_·th_de¡roy
(&
µ©h
);

118 
	`­Ş_pŞicy_·th_de¡roy
(&
µ©h
);

121 
	}
}

123 
	$šfoæow_ş—nup
()

125 
	`­Ş_pŞicy_de¡roy
(&
p
);

127 
	}
}

	@libapol/tests/infoflow-tests.h

27 #iâdeà
INFOFLOW_TESTS_H


28 
	#INFOFLOW_TESTS_H


	)

30 
	~<CUn™/CUn™.h
>

32 
CU_Te¡Info
 
šfoæow_‹¡s
[];

33 
šfoæow_š™
();

34 
šfoæow_ş—nup
();

	@libapol/tests/libapol-tests.c

26 
	~<cÚfig.h
>

28 
	~<CUn™/CUn™.h
>

29 
	~<CUn™/Basic.h
>

31 
	~"avruË-‹¡s.h
"

32 
	~"d-‹¡s.h
"

33 
	~"šfoæow-‹¡s.h
"

34 
	~"pŞicy-21-‹¡s.h
"

35 
	~"rŞe-‹¡s.h
"

36 
	~"‹ruË-‹¡s.h
"

37 
	~"cÚ¡¿š-‹¡s.h
"

38 
	~"u£r-‹¡s.h
"

40 
	$maš
()

42 ià(
	`CU_š™Ÿlize_»gi¡ry
(è!ğ
CUE_SUCCESS
) {

43  
	`CU_g‘_”rÜ
();

46 
CU_Su™eInfo
 
su™es
[] = {

47 {"PŞicy V”siÚ 21", 
pŞicy_21_š™
, 
pŞicy_21_ş—nup
, 
pŞicy_21_‹¡s
},

48 {"AV RuË Qu”y", 
avruË_š™
, 
avruË_ş—nup
, 
avruË_‹¡s
},

49 {"Domaš T¿ns™iÚ AÇlysis", 
d_š™
, 
d_ş—nup
, 
d_‹¡s
},

50 {"Infoæow AÇlysis", 
šfoæow_š™
, 
šfoæow_ş—nup
, 
šfoæow_‹¡s
},

51 {"RŞQu”y", 
rŞe_š™
, 
rŞe_ş—nup
, 
rŞe_‹¡s
},

52 {"TE RuË Qu”y", 
‹ruË_š™
, 
‹ruË_ş—nup
, 
‹ruË_‹¡s
},

53 {"U£¸Qu”y", 
u£r_š™
, 
u£r_ş—nup
, 
u£r_‹¡s
},

54 {"CÚ¡¿š qu”y", 
cÚ¡¿š_š™
, 
cÚ¡¿š_ş—nup
, 
cÚ¡¿š_‹¡s
},

55 
CU_SUITE_INFO_NULL


58 
	`CU_»gi¡”_su™es
(
su™es
);

59 
	`CU_basic_£t_mode
(
CU_BRM_VERBOSE
);

60 
	`CU_basic_run_‹¡s
();

61 
num_çu»s
 = 
	`CU_g‘_numb”_of_çu»_»cÜds
();

62 
	`CU_ş—nup_»gi¡ry
();

63  ()
num_çu»s
;

64 
	}
}

	@libapol/tests/policy-21-tests.c

27 
	~<cÚfig.h
>

29 
	~<CUn™/CUn™.h
>

30 
	~<­Ş/pŞicy.h
>

31 
	~<­Ş/pŞicy-·th.h
>

32 
	~<­Ş/¿nge_Œªs-qu”y.h
>

34 
	#POLICY
 
TEST_POLICIES
 "/£toŞs-3.2/­Ş/¿ng‘¿ns_‹¡šg_pŞicy.cÚf"

	)

36 
­Ş_pŞicy_t
 *
	gp
 = 
NULL
;

38 
	$pŞicy_21_¿nge_Œªs_®l
()

40 
­Ş_¿nge_Œªs_qu”y_t
 *
¹
 = 
	`­Ş_¿nge_Œªs_qu”y_ü—‹
();

41 
	`CU_ASSERT_PTR_NOT_NULL_FATAL
(
¹
);

43 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

44 
»tv®
 = 
	`­Ş_¿nge_Œªs_g‘_by_qu”y
(
p
, 
¹
, &
v
);

45 
	`­Ş_¿nge_Œªs_qu”y_de¡roy
(&
¹
);

46 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

47 
	`CU_ASSERT
(
v
 !ğ
NULL
 && 
	`­Ş_veùÜ_g‘_size
(v) == 17);

48 
	`­Ş_veùÜ_de¡roy
(&
v
);

49 
	}
}

51 
	$pŞicy_21_¿nge_Œªs_´oûss
()

53 
­Ş_¿nge_Œªs_qu”y_t
 *
¹
 = 
	`­Ş_¿nge_Œªs_qu”y_ü—‹
();

54 
	`CU_ASSERT_PTR_NOT_NULL_FATAL
(
¹
);

55 
»tv®
;

56 
»tv®
 = 
	`­Ş_¿nge_Œªs_qu”y_­³nd_şass
(
p
, 
¹
, "process");

57 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

59 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

60 
»tv®
 = 
	`­Ş_¿nge_Œªs_g‘_by_qu”y
(
p
, 
¹
, &
v
);

61 
	`­Ş_¿nge_Œªs_qu”y_de¡roy
(&
¹
);

62 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

63 
	`CU_ASSERT
(
v
 !ğ
NULL
 && 
	`­Ş_veùÜ_g‘_size
(v) == 10);

64 
size_t
 
i
;

65 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
p
);

66 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v
); i++) {

67 cÚ¡ 
qpŞ_¿nge_Œªs_t
 *
q¹
 = (cÚ¡ qpŞ_¿nge_Œªs_ˆ*)
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

68 cÚ¡ 
qpŞ_şass_t
 *
c
;

69 
»tv®
 = 
	`qpŞ_¿nge_Œªs_g‘_rg‘_şass
(
q
, 
q¹
, &
c
);

70 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

71 cÚ¡ *
şass_Çme
;

72 
»tv®
 = 
	`qpŞ_şass_g‘_Çme
(
q
, 
c
, &
şass_Çme
);

73 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

74 
	`CU_ASSERT_STRING_EQUAL
(
şass_Çme
, "process");

76 
	`­Ş_veùÜ_de¡roy
(&
v
);

77 
	}
}

79 
	$pŞicy_21_¿nge_Œªs_Êk_fe
()

81 
­Ş_¿nge_Œªs_qu”y_t
 *
¹
 = 
	`­Ş_¿nge_Œªs_qu”y_ü—‹
();

82 
	`CU_ASSERT_PTR_NOT_NULL_FATAL
(
¹
);

83 
»tv®
;

84 
»tv®
 = 
	`­Ş_¿nge_Œªs_qu”y_­³nd_şass
(
p
, 
¹
, "lnk_file");

85 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

87 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

88 
»tv®
 = 
	`­Ş_¿nge_Œªs_g‘_by_qu”y
(
p
, 
¹
, &
v
);

89 
	`­Ş_¿nge_Œªs_qu”y_de¡roy
(&
¹
);

90 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

91 
	`CU_ASSERT
(
v
 !ğ
NULL
 && 
	`­Ş_veùÜ_g‘_size
(v) == 2);

92 
size_t
 
i
;

93 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
p
);

94 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v
); i++) {

95 cÚ¡ 
qpŞ_¿nge_Œªs_t
 *
q¹
 = (cÚ¡ qpŞ_¿nge_Œªs_ˆ*)
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

96 cÚ¡ 
qpŞ_şass_t
 *
c
;

97 
»tv®
 = 
	`qpŞ_¿nge_Œªs_g‘_rg‘_şass
(
q
, 
q¹
, &
c
);

98 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

99 cÚ¡ *
şass_Çme
;

100 
»tv®
 = 
	`qpŞ_şass_g‘_Çme
(
q
, 
c
, &
şass_Çme
);

101 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

102 
	`CU_ASSERT_STRING_EQUAL
(
şass_Çme
, "lnk_file");

104 
	`­Ş_veùÜ_de¡roy
(&
v
);

105 
	}
}

107 
	$pŞicy_21_¿nge_Œªs_e™h”
()

109 
­Ş_¿nge_Œªs_qu”y_t
 *
¹
 = 
	`­Ş_¿nge_Œªs_qu”y_ü—‹
();

110 
	`CU_ASSERT_PTR_NOT_NULL_FATAL
(
¹
);

111 
»tv®
;

112 
»tv®
 = 
	`­Ş_¿nge_Œªs_qu”y_­³nd_şass
(
p
, 
¹
, "process");

113 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

114 
»tv®
 = 
	`­Ş_¿nge_Œªs_qu”y_­³nd_şass
(
p
, 
¹
, "lnk_file");

115 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

117 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

118 
»tv®
 = 
	`­Ş_¿nge_Œªs_g‘_by_qu”y
(
p
, 
¹
, &
v
);

119 
	`­Ş_¿nge_Œªs_qu”y_de¡roy
(&
¹
);

120 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

121 
	`CU_ASSERT
(
v
 !ğ
NULL
 && 
	`­Ş_veùÜ_g‘_size
(v) == 12);

122 
size_t
 
i
;

123 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
p
);

124 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v
); i++) {

125 cÚ¡ 
qpŞ_¿nge_Œªs_t
 *
q¹
 = (cÚ¡ qpŞ_¿nge_Œªs_ˆ*)
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

126 cÚ¡ 
qpŞ_şass_t
 *
c
;

127 
»tv®
 = 
	`qpŞ_¿nge_Œªs_g‘_rg‘_şass
(
q
, 
q¹
, &
c
);

128 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

129 cÚ¡ *
şass_Çme
;

130 
»tv®
 = 
	`qpŞ_şass_g‘_Çme
(
q
, 
c
, &
şass_Çme
);

131 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

132 
	`CU_ASSERT
(
	`¡rcmp
(
şass_Çme
, "process") == 0 || strcmp(class_name, "lnk_file") == 0);

134 
	`­Ş_veùÜ_de¡roy
(&
v
);

135 
	}
}

137 
	$pŞicy_21_¿nge_Œªs_sock‘
()

139 
­Ş_¿nge_Œªs_qu”y_t
 *
¹
 = 
	`­Ş_¿nge_Œªs_qu”y_ü—‹
();

140 
	`CU_ASSERT_PTR_NOT_NULL_FATAL
(
¹
);

141 
»tv®
;

142 
»tv®
 = 
	`­Ş_¿nge_Œªs_qu”y_­³nd_şass
(
p
, 
¹
, "socket");

143 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

145 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

146 
»tv®
 = 
	`­Ş_¿nge_Œªs_g‘_by_qu”y
(
p
, 
¹
, &
v
);

147 
	`­Ş_¿nge_Œªs_qu”y_de¡roy
(&
¹
);

148 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

149 
	`CU_ASSERT
(
v
 !ğ
NULL
 && 
	`­Ş_veùÜ_g‘_size
(v) == 0);

150 
	`­Ş_veùÜ_de¡roy
(&
v
);

151 
	}
}

153 
CU_Te¡Info
 
	gpŞicy_21_‹¡s
[] = {

154 {"¿nge_Œª ®l", 
pŞicy_21_¿nge_Œªs_®l
},

155 {"¿nge_Œª ´oûss", 
pŞicy_21_¿nge_Œªs_´oûss
},

156 {"¿nge_Œª Êk_fe", 
pŞicy_21_¿nge_Œªs_Êk_fe
},

157 {"¿nge_Œª ´oûs Ü†nk_fe", 
pŞicy_21_¿nge_Œªs_e™h”
},

158 {"¿nge_Œª sock‘", 
pŞicy_21_¿nge_Œªs_sock‘
},

159 
CU_TEST_INFO_NULL


162 
	$pŞicy_21_š™
()

164 
­Ş_pŞicy_·th_t
 *
µ©h
 = 
	`­Ş_pŞicy_·th_ü—‹
(
APOL_POLICY_PATH_TYPE_MONOLITHIC
, 
POLICY
, 
NULL
);

165 ià(
µ©h
 =ğ
NULL
) {

169 ià((
p
 = 
	`­Ş_pŞicy_ü—‹_äom_pŞicy_·th
(
µ©h
, 
QPOL_POLICY_OPTION_NO_RULES
, 
NULL
, NULL)) == NULL) {

170 
	`­Ş_pŞicy_·th_de¡roy
(&
µ©h
);

173 
	`­Ş_pŞicy_·th_de¡roy
(&
µ©h
);

175 
	}
}

177 
	$pŞicy_21_ş—nup
()

179 
	`­Ş_pŞicy_de¡roy
(&
p
);

181 
	}
}

	@libapol/tests/policy-21-tests.h

26 #iâdeà
POLICY_21_TESTS_H


27 
	#POLICY_21_TESTS_H


	)

29 
	~<CUn™/CUn™.h
>

31 
CU_Te¡Info
 
pŞicy_21_‹¡s
[];

32 
pŞicy_21_š™
();

33 
pŞicy_21_ş—nup
();

	@libapol/tests/role-tests.c

26 
	~<cÚfig.h
>

28 
	~<CUn™/CUn™.h
>

29 
	~<­Ş/rŞe-qu”y.h
>

30 
	~<­Ş/pŞicy.h
>

31 
	~<­Ş/pŞicy-·th.h
>

32 
	~<¡dboŞ.h
>

34 
	#SOURCE_POLICY
 
TEST_POLICIES
 "/£toŞs/­Ş/rŞe_dom.cÚf"

	)

36 
­Ş_pŞicy_t
 *
	g¥
 = 
NULL
;

37 
qpŞ_pŞicy_t
 *
	gqp
 = 
NULL
;

39 
	$rŞe_basic
()

41 
­Ş_rŞe_qu”y_t
 *
q
 = 
	`­Ş_rŞe_qu”y_ü—‹
();

42 
	`CU_ASSERT_PTR_NOT_NULL_FATAL
(
q
);

44 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

45 
	`CU_ASSERT
(
	`­Ş_rŞe_g‘_by_qu”y
(
¥
, 
q
, &
v
) == 0);

46 
	`CU_ASSERT
(
v
 !ğ
NULL
 && 
	`­Ş_veùÜ_g‘_size
(v) == 26);

47 
	`­Ş_veùÜ_de¡roy
(&
v
);

49 
	`­Ş_rŞe_qu”y_£t_rŞe
(
¥
, 
q
, "sh");

50 
	`CU_ASSERT
(
	`­Ş_rŞe_g‘_by_qu”y
(
¥
, 
q
, &
v
) == 0);

51 
	`CU_ASSERT
(
v
 !ğ
NULL
 && 
	`­Ş_veùÜ_g‘_size
(v) == 0);

52 
	`­Ş_veùÜ_de¡roy
(&
v
);

54 
	`­Ş_rŞe_qu”y_£t_rŞe
(
¥
, 
q
, 
NULL
);

55 
	`­Ş_rŞe_qu”y_£t_ty³
(
¥
, 
q
, "silly_t");

56 
	`CU_ASSERT
(
	`­Ş_rŞe_g‘_by_qu”y
(
¥
, 
q
, &
v
) == 0);

57 
	`CU_ASSERT
(
v
 !ğ
NULL
 && 
	`­Ş_veùÜ_g‘_size
(v) == 2);

58 
boŞ
 
found_sly
 = 
çl£
, 
found_objeù
 = false;

59 
size_t
 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v
); i++) {

60 
qpŞ_rŞe_t
 *
r
 = (qpŞ_rŞe_ˆ*è
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

61 cÚ¡ *
Çme
;

62 
	`qpŞ_rŞe_g‘_Çme
(
qp
, 
r
, &
Çme
);

63 ià(
	`¡rcmp
(
Çme
, "silly_r") == 0) {

64 
found_sly
 = 
Œue
;

65 } ià(
	`¡rcmp
(
Çme
, "object_r") == 0) {

66 
found_objeù
 = 
Œue
;

68 
	`CU_ASSERT
(0);

71 
	`CU_ASSERT
(
found_sly
 && 
found_objeù
);

72 
	`­Ş_veùÜ_de¡roy
(&
v
);

74 
	`­Ş_rŞe_qu”y_£t_ty³
(
¥
, 
q
, "not_in_the_policy_t");

75 
	`CU_ASSERT
(
	`­Ş_rŞe_g‘_by_qu”y
(
¥
, 
q
, &
v
) == 0);

76 
	`CU_ASSERT
(
v
 !ğ
NULL
 && 
	`­Ş_veùÜ_g‘_size
(v) == 0);

77 
	`­Ş_veùÜ_de¡roy
(&
v
);

79 
	`­Ş_rŞe_qu”y_de¡roy
(&
q
);

80 
	}
}

82 
	$rŞe_»gex
()

84 
­Ş_rŞe_qu”y_t
 *
q
 = 
	`­Ş_rŞe_qu”y_ü—‹
();

85 
	`CU_ASSERT_PTR_NOT_NULL_FATAL
(
q
);

86 
	`­Ş_rŞe_qu”y_£t_»gex
(
¥
, 
q
, 1);

88 
	`­Ş_rŞe_qu”y_£t_rŞe
(
¥
, 
q
, "*");

89 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

90 
	`CU_ASSERT
(
	`­Ş_rŞe_g‘_by_qu”y
(
¥
, 
q
, &
v
è< 0 && v =ğ
NULL
);

92 
	`­Ş_rŞe_qu”y_£t_rŞe
(
¥
, 
q
, "^sh");

93 
	`CU_ASSERT
(
	`­Ş_rŞe_g‘_by_qu”y
(
¥
, 
q
, &
v
) == 0);

94 
	`CU_ASSERT
(
v
 !ğ
NULL
 && 
	`­Ş_veùÜ_g‘_size
(v) == 2);

95 
boŞ
 
found_shœt
 = 
çl£
, 
found_shÛ
 = false;

96 
size_t
 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v
); i++) {

97 
qpŞ_rŞe_t
 *
r
 = (qpŞ_rŞe_ˆ*è
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

98 cÚ¡ *
Çme
;

99 
	`qpŞ_rŞe_g‘_Çme
(
qp
, 
r
, &
Çme
);

100 ià(
	`¡rcmp
(
Çme
, "shirt_r") == 0) {

101 
found_shœt
 = 
Œue
;

102 } ià(
	`¡rcmp
(
Çme
, "shoe_r") == 0) {

103 
found_shÛ
 = 
Œue
;

105 
	`CU_ASSERT
(0);

108 
	`CU_ASSERT
(
found_shœt
 && 
found_shÛ
);

109 
	`­Ş_veùÜ_de¡roy
(&
v
);

111 
	`­Ş_rŞe_qu”y_£t_rŞe
(
¥
, 
q
, 
NULL
);

112 
	`­Ş_rŞe_qu”y_£t_ty³
(
¥
, 
q
, "file");

113 
	`CU_ASSERT
(
	`­Ş_rŞe_g‘_by_qu”y
(
¥
, 
q
, &
v
) == 0);

114 
	`CU_ASSERT
(
v
 !ğ
NULL
 && 
	`­Ş_veùÜ_g‘_size
(v) == 1);

115 
qpŞ_rŞe_t
 *
r
 = (qpŞ_rŞe_ˆ*è
	`­Ş_veùÜ_g‘_–em’t
(
v
, 0);

116 cÚ¡ *
Çme
;

117 
	`qpŞ_rŞe_g‘_Çme
(
qp
, 
r
, &
Çme
);

118 
	`CU_ASSERT_STRING_EQUAL
(
Çme
, "object_r");

119 
	`­Ş_veùÜ_de¡roy
(&
v
);

121 
	`­Ş_rŞe_qu”y_de¡roy
(&
q
);

122 
	}
}

124 
CU_Te¡Info
 
	grŞe_‹¡s
[] = {

125 {"basiøqu”y", 
rŞe_basic
}

127 {"»gex qu”y", 
rŞe_»gex
}

129 
CU_TEST_INFO_NULL


132 
	$rŞe_š™
()

134 
­Ş_pŞicy_·th_t
 *
µ©h
 = 
	`­Ş_pŞicy_·th_ü—‹
(
APOL_POLICY_PATH_TYPE_MONOLITHIC
, 
SOURCE_POLICY
, 
NULL
);

135 ià(
µ©h
 =ğ
NULL
) {

139 ià((
¥
 = 
	`­Ş_pŞicy_ü—‹_äom_pŞicy_·th
(
µ©h
, 0, 
NULL
, NULL)) == NULL) {

140 
	`­Ş_pŞicy_·th_de¡roy
(&
µ©h
);

143 
	`­Ş_pŞicy_·th_de¡roy
(&
µ©h
);

145 
qp
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
¥
);

148 
	}
}

150 
	$rŞe_ş—nup
()

152 
	`­Ş_pŞicy_de¡roy
(&
¥
);

154 
	}
}

	@libapol/tests/role-tests.h

26 #iâdeà
ROLE_TESTS_H


27 
	#ROLE_TESTS_H


	)

29 
	~<CUn™/CUn™.h
>

31 
CU_Te¡Info
 
rŞe_‹¡s
[];

32 
rŞe_š™
();

33 
rŞe_ş—nup
();

	@libapol/tests/terule-tests.c

26 
	~<cÚfig.h
>

28 
	~<CUn™/CUn™.h
>

29 
	~<­Ş/pŞicy.h
>

30 
	~<­Ş/pŞicy-·th.h
>

31 
	~<­Ş/‹ruË-qu”y.h
>

32 
	~<qpŞ/pŞicy_ex‹nd.h
>

33 
	~<¡dboŞ.h
>

35 
	#BIN_POLICY
 
TEST_POLICIES
 "/£toŞs-3.3/ruËs/ruËs-mls.21"

	)

36 
	#SOURCE_POLICY
 
TEST_POLICIES
 "/£toŞs-3.3/ruËs/ruËs-mls.cÚf"

	)

38 
­Ş_pŞicy_t
 *
	gbp
 = 
NULL
;

39 
­Ş_pŞicy_t
 *
	g¥
 = 
NULL
;

41 
	$‹ruË_basic_syn
()

43 
­Ş_‹ruË_qu”y_t
 *
tq
 = 
	`­Ş_‹ruË_qu”y_ü—‹
();

44 
	`CU_ASSERT_PTR_NOT_NULL_FATAL
(
tq
);

46 
»tv®
;

47 
»tv®
 = 
	`­Ş_‹ruË_qu”y_£t_ruËs
(
¥
, 
tq
, 
QPOL_RULE_TYPE_TRANS
 | 
QPOL_RULE_TYPE_CHANGE
 | 
QPOL_RULE_TYPE_MEMBER
);

48 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

50 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

51 
»tv®
 = 
	`­Ş_syn_‹ruË_g‘_by_qu”y
(
¥
, 
tq
, &
v
);

52 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

53 
	`CU_ASSERT_PTR_NOT_NULL
(
v
);

55 
size_t
 
num_Œªs
 = 0, 
num_chªges
 = 0, 
num_memb”s
 = 0;

57 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
¥
);

58 
size_t
 
i
;

59 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v
); i++) {

60 cÚ¡ 
qpŞ_syn_‹ruË_t
 *
syn
 = (cÚ¡ qpŞ_syn_‹ruË_ˆ*)
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

61 
ušt32_t
 
ruË_ty³
;

62 
»tv®
 = 
	`qpŞ_syn_‹ruË_g‘_ruË_ty³
(
q
, 
syn
, &
ruË_ty³
);

63 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

64 
	`CU_ASSERT
(
ruË_ty³
 =ğ
QPOL_RULE_TYPE_TRANS
 ||„uË_ty³ =ğ
QPOL_RULE_TYPE_CHANGE
 ||

65 
ruË_ty³
 =ğ
QPOL_RULE_TYPE_MEMBER
);

67 ià(
ruË_ty³
 =ğ
QPOL_RULE_TYPE_TRANS
) {

68 
num_Œªs
++;

69 } ià(
ruË_ty³
 =ğ
QPOL_RULE_TYPE_CHANGE
) {

70 
num_chªges
++;

71 } ià(
ruË_ty³
 =ğ
QPOL_RULE_TYPE_MEMBER
) {

72 
num_memb”s
++;

75 
	`CU_ASSERT
(
num_Œªs
 =ğ6 && 
num_chªges
 =ğ3 && 
num_memb”s
 == 4);

76 
	`­Ş_veùÜ_de¡roy
(&
v
);

78 
»tv®
 = 
	`­Ş_‹ruË_qu”y_­³nd_şass
(
¥
, 
tq
, "cursor");

79 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

81 
»tv®
 = 
	`­Ş_syn_‹ruË_g‘_by_qu”y
(
¥
, 
tq
, &
v
);

82 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

83 
	`CU_ASSERT
(
v
 !ğ
NULL
 && 
	`­Ş_veùÜ_g‘_size
(v) == 0);

84 
	`­Ş_veùÜ_de¡roy
(&
v
);

85 
	`­Ş_‹ruË_qu”y_de¡roy
(&
tq
);

86 
	}
}

88 
CU_Te¡Info
 
	g‹ruË_‹¡s
[] = {

89 {"basiøsyÁaùiø£¬ch", 
‹ruË_basic_syn
}

91 
CU_TEST_INFO_NULL


94 
	$‹ruË_š™
()

96 
­Ş_pŞicy_·th_t
 *
µ©h
 = 
	`­Ş_pŞicy_·th_ü—‹
(
APOL_POLICY_PATH_TYPE_MONOLITHIC
, 
BIN_POLICY
, 
NULL
);

97 ià(
µ©h
 =ğ
NULL
) {

101 ià((
bp
 = 
	`­Ş_pŞicy_ü—‹_äom_pŞicy_·th
(
µ©h
, 0, 
NULL
, NULL)) == NULL) {

102 
	`­Ş_pŞicy_·th_de¡roy
(&
µ©h
);

105 
	`­Ş_pŞicy_·th_de¡roy
(&
µ©h
);

107 
µ©h
 = 
	`­Ş_pŞicy_·th_ü—‹
(
APOL_POLICY_PATH_TYPE_MONOLITHIC
, 
SOURCE_POLICY
, 
NULL
);

108 ià(
µ©h
 =ğ
NULL
) {

112 ià((
¥
 = 
	`­Ş_pŞicy_ü—‹_äom_pŞicy_·th
(
µ©h
, 0, 
NULL
, NULL)) == NULL) {

113 
	`­Ş_pŞicy_·th_de¡roy
(&
µ©h
);

116 
	`­Ş_pŞicy_·th_de¡roy
(&
µ©h
);

118 ià(
	`qpŞ_pŞicy_bud_syn_ruË_bË
(
	`­Ş_pŞicy_g‘_qpŞ
(
¥
)) != 0) {

123 
	}
}

125 
	$‹ruË_ş—nup
()

127 
	`­Ş_pŞicy_de¡roy
(&
bp
);

128 
	`­Ş_pŞicy_de¡roy
(&
¥
);

130 
	}
}

	@libapol/tests/terule-tests.h

26 #iâdeà
TERULE_TESTS_H


27 
	#TERULE_TESTS_H


	)

29 
	~<CUn™/CUn™.h
>

31 
CU_Te¡Info
 
‹ruË_‹¡s
[];

32 
‹ruË_š™
();

33 
‹ruË_ş—nup
();

	@libapol/tests/user-tests.c

26 
	~<cÚfig.h
>

28 
	~<CUn™/CUn™.h
>

29 
	~<­Ş/u£r-qu”y.h
>

30 
	~<­Ş/pŞicy.h
>

31 
	~<­Ş/pŞicy-·th.h
>

32 
	~<¡dboŞ.h
>

34 
	#SOURCE_POLICY
 
TEST_POLICIES
 "/£toŞs/­Ş/u£r_mls_‹¡šg_pŞicy.cÚf"

	)

36 
­Ş_pŞicy_t
 *
	g¥
 = 
NULL
;

37 
qpŞ_pŞicy_t
 *
	gqp
 = 
NULL
;

39 
	$u£r_basic
()

41 
­Ş_u£r_qu”y_t
 *
q
 = 
	`­Ş_u£r_qu”y_ü—‹
();

42 
	`CU_ASSERT_PTR_NOT_NULL_FATAL
(
q
);

44 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

45 
	`CU_ASSERT
(
	`­Ş_u£r_g‘_by_qu”y
(
¥
, 
q
, &
v
) == 0);

46 
	`CU_ASSERT
(
v
 !ğ
NULL
 && 
	`­Ş_veùÜ_g‘_size
(v) == 10);

47 
	`­Ş_veùÜ_de¡roy
(&
v
);

49 
	`­Ş_u£r_qu”y_£t_rŞe
(
¥
, 
q
, "object_r");

50 
	`CU_ASSERT
(
	`­Ş_u£r_g‘_by_qu”y
(
¥
, 
q
, &
v
) == 0);

51 
	`CU_ASSERT
(
v
 !ğ
NULL
 && 
	`­Ş_veùÜ_g‘_size
(v) == 10);

52 
	`­Ş_veùÜ_de¡roy
(&
v
);

54 
	`­Ş_u£r_qu”y_£t_u£r
(
¥
, 
q
, "sys");

55 
	`CU_ASSERT
(
	`­Ş_u£r_g‘_by_qu”y
(
¥
, 
q
, &
v
) == 0);

56 
	`CU_ASSERT
(
v
 !ğ
NULL
 && 
	`­Ş_veùÜ_g‘_size
(v) == 0);

57 
	`­Ş_veùÜ_de¡roy
(&
v
);

59 
	`­Ş_u£r_qu”y_£t_u£r
(
¥
, 
q
, 
NULL
);

60 
	`­Ş_u£r_qu”y_£t_rŞe
(
¥
, 
q
, "staff_r");

61 
	`CU_ASSERT
(
	`­Ş_u£r_g‘_by_qu”y
(
¥
, 
q
, &
v
) == 0);

62 
	`CU_ASSERT
(
v
 !ğ
NULL
 && 
	`­Ş_veùÜ_g‘_size
(v) == 3);

63 
boŞ
 
found_¡aff
 = 
çl£
, 
found_rick
 = f®£, 
found_sim¶e
 = false;

64 
size_t
 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v
); i++) {

65 
qpŞ_u£r_t
 *
u
 = (qpŞ_u£r_ˆ*è
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

66 cÚ¡ *
Çme
;

67 
	`qpŞ_u£r_g‘_Çme
(
qp
, 
u
, &
Çme
);

68 ià(
	`¡rcmp
(
Çme
, "staff_u") == 0) {

69 
found_¡aff
 = 
Œue
;

70 } ià(
	`¡rcmp
(
Çme
, "rick_u") == 0) {

71 
found_rick
 = 
Œue
;

72 } ià(
	`¡rcmp
(
Çme
, "simple_u") == 0) {

73 
found_sim¶e
 = 
Œue
;

75 
	`CU_ASSERT
(0);

78 
	`CU_ASSERT
(
found_¡aff
 && 
found_rick
 && 
found_sim¶e
);

79 
	`­Ş_veùÜ_de¡roy
(&
v
);

81 
	`­Ş_u£r_qu”y_£t_rŞe
(
¥
, 
q
, "not_in_the_policy_r");

82 
	`CU_ASSERT
(
	`­Ş_u£r_g‘_by_qu”y
(
¥
, 
q
, &
v
) == 0);

83 
	`CU_ASSERT
(
v
 !ğ
NULL
 && 
	`­Ş_veùÜ_g‘_size
(v) == 0);

84 
	`­Ş_veùÜ_de¡roy
(&
v
);

86 
	`­Ş_u£r_qu”y_de¡roy
(&
q
);

87 
	}
}

89 
	$u£r_»gex
()

91 
­Ş_u£r_qu”y_t
 *
q
 = 
	`­Ş_u£r_qu”y_ü—‹
();

92 
	`CU_ASSERT_PTR_NOT_NULL_FATAL
(
q
);

93 
	`­Ş_u£r_qu”y_£t_»gex
(
¥
, 
q
, 1);

95 
	`­Ş_u£r_qu”y_£t_u£r
(
¥
, 
q
, "*");

96 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

97 
	`CU_ASSERT
(
	`­Ş_u£r_g‘_by_qu”y
(
¥
, 
q
, &
v
è< 0 && v =ğ
NULL
);

99 
	`­Ş_u£r_qu”y_£t_u£r
(
¥
, 
q
, "st");

100 
	`CU_ASSERT
(
	`­Ş_u£r_g‘_by_qu”y
(
¥
, 
q
, &
v
) == 0);

101 
	`CU_ASSERT
(
v
 !ğ
NULL
 && 
	`­Ş_veùÜ_g‘_size
(v) == 3);

102 
boŞ
 
found_¡aff
 = 
çl£
, 
found_sy¡em
 = f®£, 
found_gue¡
 = false;

103 
size_t
 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v
); i++) {

104 
qpŞ_u£r_t
 *
u
 = (qpŞ_u£r_ˆ*è
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

105 cÚ¡ *
Çme
;

106 
	`qpŞ_u£r_g‘_Çme
(
qp
, 
u
, &
Çme
);

107 ià(
	`¡rcmp
(
Çme
, "staff_u") == 0) {

108 
found_¡aff
 = 
Œue
;

109 } ià(
	`¡rcmp
(
Çme
, "system_u") == 0) {

110 
found_sy¡em
 = 
Œue
;

111 } ià(
	`¡rcmp
(
Çme
, "guest_u") == 0) {

112 
found_gue¡
 = 
Œue
;

114 
	`CU_ASSERT
(0);

117 
	`CU_ASSERT
(
found_¡aff
 && 
found_sy¡em
 && 
found_gue¡
);

118 
	`­Ş_veùÜ_de¡roy
(&
v
);

120 
	`­Ş_u£r_qu”y_£t_u£r
(
¥
, 
q
, 
NULL
);

121 
	`­Ş_u£r_qu”y_£t_rŞe
(
¥
, 
q
, "user_r");

122 
	`CU_ASSERT
(
	`­Ş_u£r_g‘_by_qu”y
(
¥
, 
q
, &
v
) == 0);

123 
	`CU_ASSERT
(
v
 !ğ
NULL
 && 
	`­Ş_veùÜ_g‘_size
(v) == 3);

124 
	`­Ş_veùÜ_de¡roy
(&
v
);

126 
	`­Ş_u£r_qu”y_de¡roy
(&
q
);

127 
	}
}

129 
CU_Te¡Info
 
	gu£r_‹¡s
[] = {

130 {"basiøqu”y", 
u£r_basic
}

132 {"»gex qu”y", 
u£r_»gex
}

134 
CU_TEST_INFO_NULL


137 
	$u£r_š™
()

139 
­Ş_pŞicy_·th_t
 *
µ©h
 = 
	`­Ş_pŞicy_·th_ü—‹
(
APOL_POLICY_PATH_TYPE_MONOLITHIC
, 
SOURCE_POLICY
, 
NULL
);

140 ià(
µ©h
 =ğ
NULL
) {

144 ià((
¥
 = 
	`­Ş_pŞicy_ü—‹_äom_pŞicy_·th
(
µ©h
, 0, 
NULL
, NULL)) == NULL) {

145 
	`­Ş_pŞicy_·th_de¡roy
(&
µ©h
);

148 
	`­Ş_pŞicy_·th_de¡roy
(&
µ©h
);

150 
qp
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
¥
);

153 
	}
}

155 
	$u£r_ş—nup
()

157 
	`­Ş_pŞicy_de¡roy
(&
¥
);

159 
	}
}

	@libapol/tests/user-tests.h

26 #iâdeà
USER_TESTS_H


27 
	#USER_TESTS_H


	)

29 
	~<CUn™/CUn™.h
>

31 
CU_Te¡Info
 
u£r_‹¡s
[];

32 
u£r_š™
();

33 
u£r_ş—nup
();

	@libpoldiff/include/poldiff/attrib_diff.h

25 #iâdeà
POLDIFF_ATTRIB_DIFF_H


26 
	#POLDIFF_ATTRIB_DIFF_H


	)

28 #ifdef 
__ılu¥lus


33 
	~<­Ş/veùÜ.h
>

34 
	~<pŞdiff/pŞdiff.h
>

36 
pŞdiff_©Œib
 
	tpŞdiff_©Œib_t
;

50 
pŞdiff_©Œib_g‘_¡©s
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
size_t
 
¡©s
[5]);

63 cÚ¡ 
­Ş_veùÜ_t
 *
pŞdiff_g‘_©Œib_veùÜ
(cÚ¡ 
pŞdiff_t
 * 
diff
);

77 *
pŞdiff_©Œib_to_¡ršg
(cÚ¡ 
pŞdiff_t
 * 
diff
, cÚ¡ *
©Œib
);

88 cÚ¡ *
pŞdiff_©Œib_g‘_Çme
(cÚ¡ 
pŞdiff_©Œib_t
 * 
©Œib
);

98 
pŞdiff_fÜm_e
 
pŞdiff_©Œib_g‘_fÜm
(cÚ¡ *
©Œib
);

111 cÚ¡ 
­Ş_veùÜ_t
 *
pŞdiff_©Œib_g‘_added_ty³s
(cÚ¡ 
pŞdiff_©Œib_t
 * 
©Œib
);

124 cÚ¡ 
­Ş_veùÜ_t
 *
pŞdiff_©Œib_g‘_»moved_ty³s
(cÚ¡ 
pŞdiff_©Œib_t
 * 
©Œib
);

126 #ifdef 
__ılu¥lus


	@libpoldiff/include/poldiff/avrule_diff.h

26 #iâdeà
POLDIFF_AVRULE_DIFF_H


27 
	#POLDIFF_AVRULE_DIFF_H


	)

29 #ifdef 
__ılu¥lus


34 
	~<­Ş/veùÜ.h
>

35 
	~<pŞdiff/pŞdiff.h
>

37 
pŞdiff_avruË
 
	tpŞdiff_avruË_t
;

51 
pŞdiff_avruË_g‘_¡©s_®low
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
size_t
 
¡©s
[5]);

65 
pŞdiff_avruË_g‘_¡©s_aud™®low
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
size_t
 
¡©s
[5]);

79 
pŞdiff_avruË_g‘_¡©s_dÚud™
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
size_t
 
¡©s
[5]);

93 
pŞdiff_avruË_g‘_¡©s_Ãv”®low
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
size_t
 
¡©s
[5]);

106 cÚ¡ 
­Ş_veùÜ_t
 *
pŞdiff_g‘_avruË_veùÜ_®low
(cÚ¡ 
pŞdiff_t
 * 
diff
);

119 cÚ¡ 
­Ş_veùÜ_t
 *
pŞdiff_g‘_avruË_veùÜ_aud™®low
(cÚ¡ 
pŞdiff_t
 * 
diff
);

132 cÚ¡ 
­Ş_veùÜ_t
 *
pŞdiff_g‘_avruË_veùÜ_dÚud™
(cÚ¡ 
pŞdiff_t
 * 
diff
);

145 cÚ¡ 
­Ş_veùÜ_t
 *
pŞdiff_g‘_avruË_veùÜ_Ãv”®low
(cÚ¡ 
pŞdiff_t
 * 
diff
);

159 *
pŞdiff_avruË_to_¡ršg
(cÚ¡ 
pŞdiff_t
 * 
diff
, cÚ¡ *
avruË
);

169 
pŞdiff_fÜm_e
 
pŞdiff_avruË_g‘_fÜm
(cÚ¡ *
avruË
);

179 
ušt32_t
 
pŞdiff_avruË_g‘_ruË_ty³
(cÚ¡ 
pŞdiff_avruË_t
 * 
avruË
);

188 cÚ¡ *
pŞdiff_avruË_g‘_sourû_ty³
(cÚ¡ 
pŞdiff_avruË_t
 * 
avruË
);

197 cÚ¡ *
pŞdiff_avruË_g‘_rg‘_ty³
(cÚ¡ 
pŞdiff_avruË_t
 * 
avruË
);

206 cÚ¡ *
pŞdiff_avruË_g‘_objeù_şass
(cÚ¡ 
pŞdiff_avruË_t
 * 
avruË
);

225 
pŞdiff_avruË_g‘_cÚd
(cÚ¡ 
pŞdiff_t
 * 
diff
, cÚ¡ 
pŞdiff_avruË_t
 * 
avruË
,

226 cÚ¡ 
qpŞ_cÚd_t
 ** 
cÚd
, 
ušt32_t
 * 
which_li¡
, cÚ¡ 
­Ş_pŞicy_t
 ** 
p
);

241 cÚ¡ 
­Ş_veùÜ_t
 *
pŞdiff_avruË_g‘_unmodif›d_³rms
(cÚ¡ 
pŞdiff_avruË_t
 * 
avruË
);

256 cÚ¡ 
­Ş_veùÜ_t
 *
pŞdiff_avruË_g‘_added_³rms
(cÚ¡ 
pŞdiff_avruË_t
 * 
avruË
);

271 cÚ¡ 
­Ş_veùÜ_t
 *
pŞdiff_avruË_g‘_»moved_³rms
(cÚ¡ 
pŞdiff_avruË_t
 * 
avruË
);

287 cÚ¡ 
­Ş_veùÜ_t
 *
pŞdiff_avruË_g‘_Üig_lše_numb”s
(cÚ¡ 
pŞdiff_avruË_t
 * 
avruË
);

303 cÚ¡ 
­Ş_veùÜ_t
 *
pŞdiff_avruË_g‘_mod_lše_numb”s
(cÚ¡ 
pŞdiff_avruË_t
 * 
avruË
);

328 
­Ş_veùÜ_t
 *
pŞdiff_avruË_g‘_Üig_lše_numb”s_fÜ_³rm
(cÚ¡ 
pŞdiff_t
 * 
diff
, cÚ¡ 
pŞdiff_avruË_t
 * 
avruË
,

329 cÚ¡ *
³rm
);

354 
­Ş_veùÜ_t
 *
pŞdiff_avruË_g‘_mod_lše_numb”s_fÜ_³rm
(cÚ¡ 
pŞdiff_t
 * 
diff
, cÚ¡ 
pŞdiff_avruË_t
 * 
avruË
,

355 cÚ¡ *
³rm
);

357 #ifdef 
__ılu¥lus


	@libpoldiff/include/poldiff/bool_diff.h

26 #iâdeà
POLDIFF_BOOL_DIFF_H


27 
	#POLDIFF_BOOL_DIFF_H


	)

29 #ifdef 
__ılu¥lus


34 
	~<­Ş/veùÜ.h
>

35 
	~<pŞdiff/pŞdiff.h
>

37 
pŞdiff_boŞ
 
	tpŞdiff_boŞ_t
;

52 
pŞdiff_boŞ_g‘_¡©s
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
size_t
 
¡©s
[5]);

65 cÚ¡ 
­Ş_veùÜ_t
 *
pŞdiff_g‘_boŞ_veùÜ
(cÚ¡ 
pŞdiff_t
 * 
diff
);

78 *
pŞdiff_boŞ_to_¡ršg
(cÚ¡ 
pŞdiff_t
 * 
diff
, cÚ¡ *
boŞ—n
);

90 
size_t
 
pŞdiff_g‘_num_added_boŞs
(cÚ¡ 
pŞdiff_t
 * 
diff
);

102 
size_t
 
pŞdiff_g‘_num_»moved_boŞs
(cÚ¡ 
pŞdiff_t
 * 
diff
);

114 
size_t
 
pŞdiff_g‘_num_modif›d_boŞs
(cÚ¡ 
pŞdiff_t
 * 
diff
);

127 cÚ¡ *
pŞdiff_boŞ_g‘_Çme
(cÚ¡ 
pŞdiff_boŞ_t
 * 
boŞ—n
);

140 
pŞdiff_fÜm_e
 
pŞdiff_boŞ_g‘_fÜm
(cÚ¡ *
boŞ—n
);

142 #ifdef 
__ılu¥lus


	@libpoldiff/include/poldiff/cat_diff.h

25 #iâdeà
POLDIFF_CAT_DIFF_H


26 
	#POLDIFF_CAT_DIFF_H


	)

28 #ifdef 
__ılu¥lus


33 
	~<­Ş/veùÜ.h
>

34 
	~<pŞdiff/pŞdiff.h
>

36 
pŞdiff_ÿt
 
	tpŞdiff_ÿt_t
;

50 
pŞdiff_ÿt_g‘_¡©s
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
size_t
 
¡©s
[5]);

63 cÚ¡ 
­Ş_veùÜ_t
 *
pŞdiff_g‘_ÿt_veùÜ
(cÚ¡ 
pŞdiff_t
 * 
diff
);

76 *
pŞdiff_ÿt_to_¡ršg
(cÚ¡ 
pŞdiff_t
 * 
diff
, cÚ¡ *
ÿt
);

87 cÚ¡ *
pŞdiff_ÿt_g‘_Çme
(cÚ¡ 
pŞdiff_ÿt_t
 * 
ÿt
);

97 
pŞdiff_fÜm_e
 
pŞdiff_ÿt_g‘_fÜm
(cÚ¡ *
ÿt
);

99 #ifdef 
__ılu¥lus


	@libpoldiff/include/poldiff/class_diff.h

26 #iâdeà
POLDIFF_CLASS_DIFF_H


27 
	#POLDIFF_CLASS_DIFF_H


	)

29 #ifdef 
__ılu¥lus


34 
	~<­Ş/veùÜ.h
>

35 
	~<pŞdiff/pŞdiff.h
>

39 
pŞdiff_şass
 
	tpŞdiff_şass_t
;

53 
pŞdiff_şass_g‘_¡©s
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
size_t
 
¡©s
[5]);

66 cÚ¡ 
­Ş_veùÜ_t
 *
pŞdiff_g‘_şass_veùÜ
(cÚ¡ 
pŞdiff_t
 * 
diff
);

79 *
pŞdiff_şass_to_¡ršg
(cÚ¡ 
pŞdiff_t
 * 
diff
, cÚ¡ *
şs
);

90 cÚ¡ *
pŞdiff_şass_g‘_Çme
(cÚ¡ 
pŞdiff_şass_t
 * 
şs
);

100 
pŞdiff_fÜm_e
 
pŞdiff_şass_g‘_fÜm
(cÚ¡ *
şs
);

112 cÚ¡ 
­Ş_veùÜ_t
 *
pŞdiff_şass_g‘_added_³rms
(cÚ¡ 
pŞdiff_şass_t
 * 
şs
);

124 cÚ¡ 
­Ş_veùÜ_t
 *
pŞdiff_şass_g‘_»moved_³rms
(cÚ¡ 
pŞdiff_şass_t
 * 
şs
);

128 
pŞdiff_commÚ
 
	tpŞdiff_commÚ_t
;

142 
pŞdiff_commÚ_g‘_¡©s
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
size_t
 
¡©s
[5]);

155 cÚ¡ 
­Ş_veùÜ_t
 *
pŞdiff_g‘_commÚ_veùÜ
(cÚ¡ 
pŞdiff_t
 * 
diff
);

169 *
pŞdiff_commÚ_to_¡ršg
(cÚ¡ 
pŞdiff_t
 * 
diff
, cÚ¡ *
commÚ
);

180 cÚ¡ *
pŞdiff_commÚ_g‘_Çme
(cÚ¡ 
pŞdiff_commÚ_t
 * 
commÚ
);

190 
pŞdiff_fÜm_e
 
pŞdiff_commÚ_g‘_fÜm
(cÚ¡ *
commÚ
);

203 cÚ¡ 
­Ş_veùÜ_t
 *
pŞdiff_commÚ_g‘_added_³rms
(cÚ¡ 
pŞdiff_commÚ_t
 * 
commÚ
);

216 cÚ¡ 
­Ş_veùÜ_t
 *
pŞdiff_commÚ_g‘_»moved_³rms
(cÚ¡ 
pŞdiff_commÚ_t
 * 
commÚ
);

218 #ifdef 
__ılu¥lus


	@libpoldiff/include/poldiff/component_record.h

32 #iâdeà
POLDIFF_COMPONENT_RECORD_H


33 
	#POLDIFF_COMPONENT_RECORD_H


	)

35 #ifdef 
__ılu¥lus


50 (*
pŞdiff_g‘_™em_¡©s_â_t
è(cÚ¡ 
	tpŞdiff_t
 * 
	tdiff
, 
	tsize_t
 
	t¡©s
[5]);

59 cÚ¡ 
	t­Ş_veùÜ_t
 *(*
	tpŞdiff_g‘_»suÉ_™ems_â_t
è(cÚ¡ 
	tpŞdiff_t
 * 
	tdiff
);

68 
pŞdiff_fÜm_e
(*
	tpŞdiff_™em_g‘_fÜm_â_t
è(cÚ¡ *
	t™em
);

79 *(*
	tpŞdiff_™em_to_¡ršg_â_t
è(cÚ¡ 
	tpŞdiff_t
 * 
	tdiff
, cÚ¡ *
	t™em
);

81 
pŞdiff_compÚ’t_»cÜd
 
	tpŞdiff_compÚ’t_»cÜd_t
;

93 cÚ¡ 
pŞdiff_compÚ’t_»cÜd_t
 *
pŞdiff_g‘_compÚ’t_»cÜd
(
ušt32_t
 
which
);

105 
pŞdiff_™em_g‘_fÜm_â_t
 
pŞdiff_compÚ’t_»cÜd_g‘_fÜm_â
(cÚ¡ 
pŞdiff_compÚ’t_»cÜd_t
 * 
comp
);

117 
pŞdiff_™em_to_¡ršg_â_t
 
pŞdiff_compÚ’t_»cÜd_g‘_to_¡ršg_â
(cÚ¡ 
pŞdiff_compÚ’t_»cÜd_t
 * 
diff
);

129 
pŞdiff_g‘_™em_¡©s_â_t
 
pŞdiff_compÚ’t_»cÜd_g‘_¡©s_â
(cÚ¡ 
pŞdiff_compÚ’t_»cÜd_t
 * 
diff
);

141 
pŞdiff_g‘_»suÉ_™ems_â_t
 
pŞdiff_compÚ’t_»cÜd_g‘_»suÉs_â
(cÚ¡ 
pŞdiff_compÚ’t_»cÜd_t
 * 
diff
);

153 cÚ¡ *
pŞdiff_compÚ’t_»cÜd_g‘_Ïb–
(cÚ¡ 
pŞdiff_compÚ’t_»cÜd_t
 * 
diff
);

155 #ifdef 
__ılu¥lus


	@libpoldiff/include/poldiff/level_diff.h

25 #iâdeà
POLDIFF_LEVEL_DIFF_H


26 
	#POLDIFF_LEVEL_DIFF_H


	)

28 #ifdef 
__ılu¥lus


33 
	~<­Ş/veùÜ.h
>

34 
	~<pŞdiff/pŞdiff.h
>

36 
pŞdiff_Ëv–
 
	tpŞdiff_Ëv–_t
;

50 
pŞdiff_Ëv–_g‘_¡©s
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
size_t
 
¡©s
[5]);

63 cÚ¡ 
­Ş_veùÜ_t
 *
pŞdiff_g‘_Ëv–_veùÜ
(cÚ¡ 
pŞdiff_t
 * 
diff
);

76 *
pŞdiff_Ëv–_to_¡ršg
(cÚ¡ 
pŞdiff_t
 * 
diff
, cÚ¡ *
Ëv–
);

89 *
pŞdiff_Ëv–_to_¡ršg_br›f
(cÚ¡ 
pŞdiff_t
 * 
diff
, cÚ¡ 
pŞdiff_Ëv–_t
 * 
Ëv–
);

100 cÚ¡ *
pŞdiff_Ëv–_g‘_Çme
(cÚ¡ 
pŞdiff_Ëv–_t
 * 
Ëv–
);

110 
pŞdiff_fÜm_e
 
pŞdiff_Ëv–_g‘_fÜm
(cÚ¡ *
Ëv–
);

123 cÚ¡ 
­Ş_veùÜ_t
 *
pŞdiff_Ëv–_g‘_unmodif›d_ÿts
(cÚ¡ 
pŞdiff_Ëv–_t
 * 
Ëv–
);

138 cÚ¡ 
­Ş_veùÜ_t
 *
pŞdiff_Ëv–_g‘_added_ÿts
(cÚ¡ 
pŞdiff_Ëv–_t
 * 
Ëv–
);

153 cÚ¡ 
­Ş_veùÜ_t
 *
pŞdiff_Ëv–_g‘_»moved_ÿts
(cÚ¡ 
pŞdiff_Ëv–_t
 * 
Ëv–
);

155 #ifdef 
__ılu¥lus


	@libpoldiff/include/poldiff/poldiff.h

31 #iâdeà
POLDIFF_POLDIFF_H


32 
	#POLDIFF_POLDIFF_H


	)

34 #ifdef 
__ılu¥lus


39 
	~<­Ş/pŞicy.h
>

40 
	~<­Ş/pŞicy-qu”y.h
>

41 
	~<­Ş/veùÜ.h
>

42 
	~<¡d¬g.h
>

43 
	~<¡dšt.h
>

45 
pŞdiff
 
	tpŞdiff_t
;

57 
	epŞdiff_fÜm


60 
POLDIFF_FORM_NONE
,

62 
POLDIFF_FORM_ADDED
,

64 
POLDIFF_FORM_REMOVED
,

66 
POLDIFF_FORM_MODIFIED
,

68 
POLDIFF_FORM_ADD_TYPE
,

70 
POLDIFF_FORM_REMOVE_TYPE


71 } 
	tpŞdiff_fÜm_e
;

73 (*
pŞdiff_hªdË_â_t
è(*
	t¬g
, cÚ¡ 
	tpŞdiff_t
 * 
	tdiff
, 
	tËv–
, cÚ¡ *
	tfmt
, 
	tva_li¡
 
	tva_¬gs
);

75 
	~<pŞdiff/©Œib_diff.h
>

76 
	~<pŞdiff/avruË_diff.h
>

77 
	~<pŞdiff/ÿt_diff.h
>

78 
	~<pŞdiff/boŞ_diff.h
>

79 
	~<pŞdiff/şass_diff.h
>

80 
	~<pŞdiff/Ëv–_diff.h
>

81 
	~<pŞdiff/¿nge_diff.h
>

82 
	~<pŞdiff/¿nge_Œªs_diff.h
>

83 
	~<pŞdiff/rbac_diff.h
>

84 
	~<pŞdiff/rŞe_diff.h
>

85 
	~<pŞdiff/‹ruË_diff.h
>

86 
	~<pŞdiff/ty³_diff.h
>

87 
	~<pŞdiff/u£r_diff.h
>

88 
	~<pŞdiff/ty³_m­.h
>

89 
	~<pŞdiff/ut.h
>

92 
	#POLDIFF_DIFF_CLASSES
 0x00000001U

	)

93 
	#POLDIFF_DIFF_COMMONS
 0x00000002U

	)

94 
	#POLDIFF_DIFF_TYPES
 0x00000004U

	)

95 
	#POLDIFF_DIFF_ATTRIBS
 0x00000008U

	)

96 
	#POLDIFF_DIFF_ROLES
 0x00000010U

	)

97 
	#POLDIFF_DIFF_USERS
 0x00000020U

	)

98 
	#POLDIFF_DIFF_BOOLS
 0x00000040U

	)

99 
	#POLDIFF_DIFF_LEVELS
 0x00000080U

	)

100 
	#POLDIFF_DIFF_CATS
 0x00000100U

	)

101 
	#POLDIFF_DIFF_ROLE_ALLOWS
 0x00000800U

	)

102 
	#POLDIFF_DIFF_ROLE_TRANS
 0x00001000U

	)

103 
	#POLDIFF_DIFF_RANGE_TRANS
 0x00002000U

	)

104 
	#POLDIFF_DIFF_AVALLOW
 0x10000000U

	)

105 
	#POLDIFF_DIFF_AVAUDITALLOW
 0x20000000U

	)

106 
	#POLDIFF_DIFF_AVDONTAUDIT
 0x40000000U

	)

107 
	#POLDIFF_DIFF_AVNEVERALLOW
 0x80000000U

	)

108 
	#POLDIFF_DIFF_TECHANGE
 0x01000000U

	)

109 
	#POLDIFF_DIFF_TEMEMBER
 0x02000000U

	)

110 
	#POLDIFF_DIFF_TETRANS
 0x04000000U

	)

112 
	#POLDIFF_DIFF_TERULES_COMPAT
 0x00000400U

	)

113 
	#POLDIFF_DIFF_AVRULES_COMPAT
 0x00000200U

	)

115 
	#POLDIFF_DIFF_AVRULES
 (
POLDIFF_DIFF_AVALLOW
 | 
POLDIFF_DIFF_AVNEVERALLOW
 | 
POLDIFF_DIFF_AVAUDITALLOW
 | 
POLDIFF_DIFF_AVDONTAUDIT
)

	)

116 
	#POLDIFF_DIFF_TERULES
 (
POLDIFF_DIFF_TEMEMBER
 | 
POLDIFF_DIFF_TECHANGE
 | 
POLDIFF_DIFF_TETRANS
)

	)

121 
	#POLDIFF_DIFF_SYMBOLS
 (
POLDIFF_DIFF_CLASSES
|
POLDIFF_DIFF_COMMONS
|
POLDIFF_DIFF_TYPES
|
POLDIFF_DIFF_ATTRIBS
|
POLDIFF_DIFF_ROLES
|
POLDIFF_DIFF_USERS
|
POLDIFF_DIFF_BOOLS
)

	)

122 
	#POLDIFF_DIFF_RULES
 (
POLDIFF_DIFF_AVRULES
|
POLDIFF_DIFF_TERULES
|
POLDIFF_DIFF_ROLE_ALLOWS
|
POLDIFF_DIFF_ROLE_TRANS
)

	)

123 
	#POLDIFF_DIFF_RBAC
 (
POLDIFF_DIFF_ROLES
|
POLDIFF_DIFF_ROLE_ALLOWS
|
POLDIFF_DIFF_ROLE_TRANS
)

	)

124 
	#POLDIFF_DIFF_MLS
 (
POLDIFF_DIFF_LEVELS
|
POLDIFF_DIFF_CATS
|
POLDIFF_DIFF_RANGE_TRANS
)

	)

125 
	#POLDIFF_DIFF_OCONS
 0

	)

126 
	#POLDIFF_DIFF_REMAPPED
 (
POLDIFF_DIFF_TYPES
|
POLDIFF_DIFF_ATTRIBS
|
POLDIFF_DIFF_AVRULES
|
POLDIFF_DIFF_TERULES
|
POLDIFF_DIFF_ROLES
|
POLDIFF_DIFF_ROLE_TRANS
|
POLDIFF_DIFF_RANGE_TRANS
|
POLDIFF_DIFF_OCONS
)

	)

127 
	#POLDIFF_DIFF_ALL
 (
POLDIFF_DIFF_SYMBOLS
|
POLDIFF_DIFF_RULES
|
POLDIFF_DIFF_MLS
|
POLDIFF_DIFF_OCONS
)

	)

147 
pŞdiff_t
 *
pŞdiff_ü—‹
(
­Ş_pŞicy_t
 * 
Üig_pŞicy
,

148 
­Ş_pŞicy_t
 * 
mod_pŞicy
, 
pŞdiff_hªdË_â_t
 
â
, *
ÿÎback_¬g
);

155 
pŞdiff_de¡roy
(
pŞdiff_t
 ** 
diff
);

168 
pŞdiff_run
(
pŞdiff_t
 * 
diff
, 
ušt32_t
 
æags
);

180 
pŞdiff_is_run
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
ušt32_t
 
æags
);

196 
pŞdiff_g‘_¡©s
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
ušt32_t
 
æags
, 
size_t
 
¡©s
[5]);

212 
pŞdiff_’abË_lše_numb”s
(
pŞdiff_t
 * 
diff
);

214 #ifdef 
__ılu¥lus


	@libpoldiff/include/poldiff/range_diff.h

28 #iâdeà
POLDIFF_RANGE_DIFF_H


29 
	#POLDIFF_RANGE_DIFF_H


	)

31 #ifdef 
__ılu¥lus


36 
	~<­Ş/mls-qu”y.h
>

37 
	~<­Ş/veùÜ.h
>

38 
	~<pŞdiff/pŞdiff.h
>

40 
pŞdiff_¿nge
 
	tpŞdiff_¿nge_t
;

53 *
pŞdiff_¿nge_to_¡ršg_br›f
(cÚ¡ 
pŞdiff_t
 * 
diff
, cÚ¡ 
pŞdiff_¿nge_t
 * 
¿nge
);

63 
­Ş_veùÜ_t
 *
pŞdiff_¿nge_g‘_Ëv–s
(cÚ¡ 
pŞdiff_¿nge_t
 * 
¿nge
);

76 cÚ¡ 
­Ş_mls_¿nge_t
 *
pŞdiff_¿nge_g‘_Üigš®_¿nge
(cÚ¡ 
pŞdiff_¿nge_t
 * 
¿nge
);

89 cÚ¡ 
­Ş_mls_¿nge_t
 *
pŞdiff_¿nge_g‘_modif›d_¿nge
(cÚ¡ 
pŞdiff_¿nge_t
 * 
¿nge
);

101 
­Ş_veùÜ_t
 *
pŞdiff_¿nge_g‘_mš_added_ÿts
(cÚ¡ 
pŞdiff_¿nge_t
 * 
¿nge
);

112 
­Ş_veùÜ_t
 *
pŞdiff_¿nge_g‘_mš_»moved_ÿts
(cÚ¡ 
pŞdiff_¿nge_t
 * 
¿nge
);

123 
­Ş_veùÜ_t
 *
pŞdiff_¿nge_g‘_mš_unmodif›d_ÿts
(cÚ¡ 
pŞdiff_¿nge_t
 * 
¿nge
);

125 #ifdef 
__ılu¥lus


	@libpoldiff/include/poldiff/range_trans_diff.h

26 #iâdeà
POLDIFF_RANGETRANS_DIFF_H


27 
	#POLDIFF_RANGETRANS_DIFF_H


	)

29 #ifdef 
__ılu¥lus


34 
	~<­Ş/mls-qu”y.h
>

35 
	~<­Ş/veùÜ.h
>

36 
	~<pŞdiff/pŞdiff.h
>

38 
pŞdiff_¿nge_Œªs
 
	tpŞdiff_¿nge_Œªs_t
;

52 
pŞdiff_¿nge_Œªs_g‘_¡©s
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
size_t
 
¡©s
[5]);

65 cÚ¡ 
­Ş_veùÜ_t
 *
pŞdiff_g‘_¿nge_Œªs_veùÜ
(cÚ¡ 
pŞdiff_t
 * 
diff
);

79 *
pŞdiff_¿nge_Œªs_to_¡ršg
(cÚ¡ 
pŞdiff_t
 * 
diff
, cÚ¡ *
¿nge_Œªs
);

90 cÚ¡ *
pŞdiff_¿nge_Œªs_g‘_sourû_ty³
(cÚ¡ 
pŞdiff_¿nge_Œªs_t
 * 
¿nge_Œªs
);

101 cÚ¡ *
pŞdiff_¿nge_Œªs_g‘_rg‘_ty³
(cÚ¡ 
pŞdiff_¿nge_Œªs_t
 * 
¿nge_Œªs
);

113 cÚ¡ *
pŞdiff_¿nge_Œªs_g‘_rg‘_şass
(cÚ¡ 
pŞdiff_¿nge_Œªs_t
 * 
¿nge_Œªs
);

123 cÚ¡ 
pŞdiff_¿nge_t
 *
pŞdiff_¿nge_Œªs_g‘_¿nge
(cÚ¡ 
pŞdiff_¿nge_Œªs_t
 * 
¿nge_Œªs
);

134 
pŞdiff_fÜm_e
 
pŞdiff_¿nge_Œªs_g‘_fÜm
(cÚ¡ *
¿nge_Œªs
);

136 #ifdef 
__ılu¥lus


	@libpoldiff/include/poldiff/rbac_diff.h

26 #iâdeà
POLDIFF_RBAC_DIFF_H


27 
	#POLDIFF_RBAC_DIFF_H


	)

29 #ifdef 
__ılu¥lus


34 
	~<­Ş/veùÜ.h
>

35 
	~<pŞdiff/pŞdiff.h
>

37 
pŞdiff_rŞe_®low
 
	tpŞdiff_rŞe_®low_t
;

38 
pŞdiff_rŞe_Œªs
 
	tpŞdiff_rŞe_Œªs_t
;

52 
pŞdiff_rŞe_®low_g‘_¡©s
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
size_t
 
¡©s
[5]);

65 cÚ¡ 
­Ş_veùÜ_t
 *
pŞdiff_g‘_rŞe_®low_veùÜ
(cÚ¡ 
pŞdiff_t
 * 
diff
);

78 *
pŞdiff_rŞe_®low_to_¡ršg
(cÚ¡ 
pŞdiff_t
 * 
diff
, cÚ¡ *
rŞe_®low
);

89 cÚ¡ *
pŞdiff_rŞe_®low_g‘_Çme
(cÚ¡ 
pŞdiff_rŞe_®low_t
 * 
rŞe_®low
);

99 
pŞdiff_fÜm_e
 
pŞdiff_rŞe_®low_g‘_fÜm
(cÚ¡ *
rŞe_®low
);

114 cÚ¡ 
­Ş_veùÜ_t
 *
pŞdiff_rŞe_®low_g‘_unmodif›d_rŞes
(cÚ¡ 
pŞdiff_rŞe_®low_t
 * 
rŞe_®low
);

129 cÚ¡ 
­Ş_veùÜ_t
 *
pŞdiff_rŞe_®low_g‘_added_rŞes
(cÚ¡ 
pŞdiff_rŞe_®low_t
 * 
rŞe_®low
);

144 cÚ¡ 
­Ş_veùÜ_t
 *
pŞdiff_rŞe_®low_g‘_»moved_rŞes
(cÚ¡ 
pŞdiff_rŞe_®low_t
 * 
rŞe_®low
);

158 
pŞdiff_rŞe_Œªs_g‘_¡©s
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
size_t
 
¡©s
[5]);

171 cÚ¡ 
­Ş_veùÜ_t
 *
pŞdiff_g‘_rŞe_Œªs_veùÜ
(cÚ¡ 
pŞdiff_t
 * 
diff
);

184 *
pŞdiff_rŞe_Œªs_to_¡ršg
(cÚ¡ 
pŞdiff_t
 * 
diff
, cÚ¡ *
rŞe_Œªs
);

195 cÚ¡ *
pŞdiff_rŞe_Œªs_g‘_sourû_rŞe
(cÚ¡ 
pŞdiff_rŞe_Œªs_t
 * 
rŞe_Œªs
);

206 cÚ¡ *
pŞdiff_rŞe_Œªs_g‘_rg‘_ty³
(cÚ¡ 
pŞdiff_rŞe_Œªs_t
 * 
rŞe_Œªs
);

217 
pŞdiff_fÜm_e
 
pŞdiff_rŞe_Œªs_g‘_fÜm
(cÚ¡ *
rŞe_Œªs
);

231 cÚ¡ *
pŞdiff_rŞe_Œªs_g‘_Üigš®_deçuÉ
(cÚ¡ 
pŞdiff_rŞe_Œªs_t
 * 
rŞe_Œªs
);

245 cÚ¡ *
pŞdiff_rŞe_Œªs_g‘_modif›d_deçuÉ
(cÚ¡ 
pŞdiff_rŞe_Œªs_t
 * 
rŞe_Œªs
);

247 #ifdef 
__ılu¥lus


	@libpoldiff/include/poldiff/role_diff.h

25 #iâdeà
POLDIFF_ROLE_DIFF_H


26 
	#POLDIFF_ROLE_DIFF_H


	)

28 #ifdef 
__ılu¥lus


33 
	~<­Ş/veùÜ.h
>

34 
	~<pŞdiff/pŞdiff.h
>

36 
pŞdiff_rŞe
 
	tpŞdiff_rŞe_t
;

50 
pŞdiff_rŞe_g‘_¡©s
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
size_t
 
¡©s
[5]);

63 cÚ¡ 
­Ş_veùÜ_t
 *
pŞdiff_g‘_rŞe_veùÜ
(cÚ¡ 
pŞdiff_t
 * 
diff
);

76 *
pŞdiff_rŞe_to_¡ršg
(cÚ¡ 
pŞdiff_t
 * 
diff
, cÚ¡ *
rŞe
);

87 cÚ¡ *
pŞdiff_rŞe_g‘_Çme
(cÚ¡ 
pŞdiff_rŞe_t
 * 
rŞe
);

97 
pŞdiff_fÜm_e
 
pŞdiff_rŞe_g‘_fÜm
(cÚ¡ *
rŞe
);

109 cÚ¡ 
­Ş_veùÜ_t
 *
pŞdiff_rŞe_g‘_added_ty³s
(cÚ¡ 
pŞdiff_rŞe_t
 * 
rŞe
);

121 cÚ¡ 
­Ş_veùÜ_t
 *
pŞdiff_rŞe_g‘_»moved_ty³s
(cÚ¡ 
pŞdiff_rŞe_t
 * 
rŞe
);

123 #ifdef 
__ılu¥lus


	@libpoldiff/include/poldiff/terule_diff.h

26 #iâdeà
POLDIFF_TERULE_DIFF_H


27 
	#POLDIFF_TERULE_DIFF_H


	)

29 #ifdef 
__ılu¥lus


34 
	~<­Ş/veùÜ.h
>

35 
	~<pŞdiff/pŞdiff.h
>

37 
pŞdiff_‹ruË
 
	tpŞdiff_‹ruË_t
;

51 
pŞdiff_‹ruË_g‘_¡©s_chªge
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
size_t
 
¡©s
[5]);

65 
pŞdiff_‹ruË_g‘_¡©s_memb”
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
size_t
 
¡©s
[5]);

79 
pŞdiff_‹ruË_g‘_¡©s_Œªs
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
size_t
 
¡©s
[5]);

92 cÚ¡ 
­Ş_veùÜ_t
 *
pŞdiff_g‘_‹ruË_veùÜ_chªge
(cÚ¡ 
pŞdiff_t
 * 
diff
);

105 cÚ¡ 
­Ş_veùÜ_t
 *
pŞdiff_g‘_‹ruË_veùÜ_memb”
(cÚ¡ 
pŞdiff_t
 * 
diff
);

118 cÚ¡ 
­Ş_veùÜ_t
 *
pŞdiff_g‘_‹ruË_veùÜ_Œªs
(cÚ¡ 
pŞdiff_t
 * 
diff
);

132 *
pŞdiff_‹ruË_to_¡ršg
(cÚ¡ 
pŞdiff_t
 * 
diff
, cÚ¡ *
‹ruË
);

142 
pŞdiff_fÜm_e
 
pŞdiff_‹ruË_g‘_fÜm
(cÚ¡ *
‹ruË
);

152 
ušt32_t
 
pŞdiff_‹ruË_g‘_ruË_ty³
(cÚ¡ 
pŞdiff_‹ruË_t
 * 
‹ruË
);

161 cÚ¡ *
pŞdiff_‹ruË_g‘_sourû_ty³
(cÚ¡ 
pŞdiff_‹ruË_t
 * 
‹ruË
);

170 cÚ¡ *
pŞdiff_‹ruË_g‘_rg‘_ty³
(cÚ¡ 
pŞdiff_‹ruË_t
 * 
‹ruË
);

179 cÚ¡ *
pŞdiff_‹ruË_g‘_objeù_şass
(cÚ¡ 
pŞdiff_‹ruË_t
 * 
‹ruË
);

199 
pŞdiff_‹ruË_g‘_cÚd
(cÚ¡ 
pŞdiff_t
 * 
diff
, cÚ¡ 
pŞdiff_‹ruË_t
 * 
‹ruË
,

200 cÚ¡ 
qpŞ_cÚd_t
 ** 
cÚd
, 
ušt32_t
 * 
which_li¡
, cÚ¡ 
­Ş_pŞicy_t
 ** 
p
);

213 cÚ¡ *
pŞdiff_‹ruË_g‘_Üigš®_deçuÉ
(cÚ¡ 
pŞdiff_‹ruË_t
 * 
‹ruË
);

226 cÚ¡ *
pŞdiff_‹ruË_g‘_modif›d_deçuÉ
(cÚ¡ 
pŞdiff_‹ruË_t
 * 
‹ruË
);

241 
­Ş_veùÜ_t
 *
pŞdiff_‹ruË_g‘_Üig_lše_numb”s
(cÚ¡ 
pŞdiff_‹ruË_t
 * 
‹ruË
);

256 
­Ş_veùÜ_t
 *
pŞdiff_‹ruË_g‘_mod_lše_numb”s
(cÚ¡ 
pŞdiff_‹ruË_t
 * 
‹ruË
);

258 #ifdef 
__ılu¥lus


	@libpoldiff/include/poldiff/type_diff.h

28 #iâdeà
POLDIFF_TYPE_DIFF_H


29 
	#POLDIFF_TYPE_DIFF_H


	)

31 #ifdef 
__ılu¥lus


36 
	~<­Ş/veùÜ.h
>

37 
	~<pŞdiff/pŞdiff.h
>

39 
pŞdiff_ty³
 
	tpŞdiff_ty³_t
;

53 
pŞdiff_ty³_g‘_¡©s
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
size_t
 
¡©s
[5]);

66 cÚ¡ 
­Ş_veùÜ_t
 *
pŞdiff_g‘_ty³_veùÜ
(cÚ¡ 
pŞdiff_t
 * 
diff
);

79 *
pŞdiff_ty³_to_¡ršg
(cÚ¡ 
pŞdiff_t
 * 
diff
, cÚ¡ *
ty³
);

90 cÚ¡ *
pŞdiff_ty³_g‘_Çme
(cÚ¡ 
pŞdiff_ty³_t
 * 
ty³
);

100 
pŞdiff_fÜm_e
 
pŞdiff_ty³_g‘_fÜm
(cÚ¡ *
ty³
);

113 cÚ¡ 
­Ş_veùÜ_t
 *
pŞdiff_ty³_g‘_added_©Œibs
(cÚ¡ 
pŞdiff_ty³_t
 * 
ty³
);

126 cÚ¡ 
­Ş_veùÜ_t
 *
pŞdiff_ty³_g‘_»moved_©Œibs
(cÚ¡ 
pŞdiff_ty³_t
 * 
ty³
);

128 #ifdef 
__ılu¥lus


	@libpoldiff/include/poldiff/type_map.h

26 #iâdeà
POLDIFF_TYPE_MAP_H


27 
	#POLDIFF_TYPE_MAP_H


	)

29 #ifdef 
__ılu¥lus


34 
	~<pŞdiff/pŞdiff.h
>

35 
	~<­Ş/veùÜ.h
>

37 
pŞdiff_ty³_»m­_’Œy
 
	tpŞdiff_ty³_»m­_’Œy_t
;

62 
pŞdiff_ty³_»m­_ü—‹
(
pŞdiff_t
 * 
diff
, cÚ¡ 
­Ş_veùÜ_t
 * 
Üig_Çmes
, cÚ¡‡pŞ_veùÜ_ˆ* 
mod_Çmes
);

75 
­Ş_veùÜ_t
 *
pŞdiff_ty³_»m­_g‘_’Œ›s
(cÚ¡ 
pŞdiff_t
 * 
diff
);

85 
pŞdiff_ty³_»m­_’Œy_»move
(
pŞdiff_t
 * 
diff
, 
pŞdiff_ty³_»m­_’Œy_t
 * 
’Œy
);

101 
­Ş_veùÜ_t
 *
pŞdiff_ty³_»m­_’Œy_g‘_Üigš®_ty³s
(cÚ¡ 
pŞdiff_t
 * 
diff
,

102 cÚ¡ 
pŞdiff_ty³_»m­_’Œy_t
 * 
’Œy
);

118 
­Ş_veùÜ_t
 *
pŞdiff_ty³_»m­_’Œy_g‘_modif›d_ty³s
(cÚ¡ 
pŞdiff_t
 * 
diff
,

119 cÚ¡ 
pŞdiff_ty³_»m­_’Œy_t
 * 
’Œy
);

129 
pŞdiff_ty³_»m­_’Œy_g‘_is_šã¼ed
(cÚ¡ 
pŞdiff_ty³_»m­_’Œy_t
 * 
’Œy
);

139 
pŞdiff_ty³_»m­_’Œy_g‘_is_’abËd
(cÚ¡ 
pŞdiff_ty³_»m­_’Œy_t
 * 
’Œy
);

147 
pŞdiff_ty³_»m­_’Œy_£t_’abËd
(
pŞdiff_ty³_»m­_’Œy_t
 * 
’Œy
, 
’abËd
);

149 #ifdef 
__ılu¥lus


	@libpoldiff/include/poldiff/user_diff.h

25 #iâdeà
POLDIFF_USER_DIFF_H


26 
	#POLDIFF_USER_DIFF_H


	)

28 #ifdef 
__ılu¥lus


33 
	~<­Ş/veùÜ.h
>

34 
	~<pŞdiff/pŞdiff.h
>

36 
pŞdiff_u£r
 
	tpŞdiff_u£r_t
;

50 
pŞdiff_u£r_g‘_¡©s
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
size_t
 
¡©s
[5]);

63 cÚ¡ 
­Ş_veùÜ_t
 *
pŞdiff_g‘_u£r_veùÜ
(cÚ¡ 
pŞdiff_t
 * 
diff
);

76 *
pŞdiff_u£r_to_¡ršg
(cÚ¡ 
pŞdiff_t
 * 
diff
, cÚ¡ *
u£r
);

87 cÚ¡ *
pŞdiff_u£r_g‘_Çme
(cÚ¡ 
pŞdiff_u£r_t
 * 
u£r
);

97 
pŞdiff_fÜm_e
 
pŞdiff_u£r_g‘_fÜm
(cÚ¡ *
u£r
);

109 cÚ¡ 
­Ş_veùÜ_t
 *
pŞdiff_u£r_g‘_unmodif›d_rŞes
(cÚ¡ 
pŞdiff_u£r_t
 * 
u£r
);

122 cÚ¡ 
­Ş_veùÜ_t
 *
pŞdiff_u£r_g‘_added_rŞes
(cÚ¡ 
pŞdiff_u£r_t
 * 
u£r
);

136 cÚ¡ 
­Ş_veùÜ_t
 *
pŞdiff_u£r_g‘_»moved_rŞes
(cÚ¡ 
pŞdiff_u£r_t
 * 
u£r
);

153 cÚ¡ 
pŞdiff_Ëv–_t
 *
pŞdiff_u£r_g‘_Üigš®_dæev–
(cÚ¡ 
pŞdiff_u£r_t
 * 
u£r
);

171 cÚ¡ 
pŞdiff_Ëv–_t
 *
pŞdiff_u£r_g‘_modif›d_dæev–
(cÚ¡ 
pŞdiff_u£r_t
 * 
u£r
);

185 cÚ¡ 
pŞdiff_¿nge_t
 *
pŞdiff_u£r_g‘_¿nge
(cÚ¡ 
pŞdiff_u£r_t
 * 
u£r
);

187 #ifdef 
__ılu¥lus


	@libpoldiff/include/poldiff/util.h

26 #iâdeà
POLDIFF_UTIL_H


27 
	#POLDIFF_UTIL_H


	)

29 #ifdef 
__ılu¥lus


39 cÚ¡ *
libpŞdiff_g‘_v”siÚ
();

41 #ifdef 
__ılu¥lus


	@libpoldiff/src/attrib_diff.c

25 
	~<cÚfig.h
>

27 
	~"pŞdiff_š‹º®.h
"

29 
	~<­Ş/ut.h
>

30 
	~<”ºo.h
>

31 
	~<¡dio.h
>

32 
	~<¡ršg.h
>

34 
	spŞdiff_©Œib_summ¬y


36 
size_t
 
	mnum_added
;

37 
size_t
 
	mnum_»moved
;

38 
size_t
 
	mnum_modif›d
;

39 
­Ş_veùÜ_t
 *
	mdiffs
;

42 
	spŞdiff_©Œib


44 *
	mÇme
;

45 
pŞdiff_fÜm_e
 
	mfÜm
;

46 
­Ş_veùÜ_t
 *
	madded_ty³s
;

47 
­Ş_veùÜ_t
 *
	m»moved_ty³s
;

50 
	$pŞdiff_©Œib_g‘_¡©s
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
size_t
 
¡©s
[5])

52 ià(
diff
 =ğ
NULL
 || 
¡©s
 == NULL) {

53 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
EINVAL
));

54 
”ºo
 = 
EINVAL
;

57 
¡©s
[0] = 
diff
->
©Œib_diffs
->
num_added
;

58 
¡©s
[1] = 
diff
->
©Œib_diffs
->
num_»moved
;

59 
¡©s
[2] = 
diff
->
©Œib_diffs
->
num_modif›d
;

60 
¡©s
[3] = 0;

61 
¡©s
[4] = 0;

62 
	}
}

64 *
	$pŞdiff_©Œib_to_¡ršg
(cÚ¡ 
pŞdiff_t
 * 
diff
, cÚ¡ *
©Œib
)

66 
pŞdiff_©Œib_t
 *
©
 = (pŞdiff_©Œib_ˆ*è
©Œib
;

67 
size_t
 
num_added
, 
num_»moved
, 
Ën
 = 0, 
i
;

68 *
s
 = 
NULL
, *
ty³
;

69 ià(
diff
 =ğ
NULL
 || 
©Œib
 == NULL) {

70 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
EINVAL
));

71 
”ºo
 = 
EINVAL
;

72  
NULL
;

74 
num_added
 = 
	`­Ş_veùÜ_g‘_size
(
©
->
added_ty³s
);

75 
num_»moved
 = 
	`­Ş_veùÜ_g‘_size
(
©
->
»moved_ty³s
);

76 
©
->
fÜm
) {

77 
POLDIFF_FORM_ADDED
:

79 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "+ %s", 
©
->
Çme
) < 0) {

82  
s
;

84 
POLDIFF_FORM_REMOVED
:

86 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "- %s", 
©
->
Çme
) < 0) {

89  
s
;

91 
POLDIFF_FORM_MODIFIED
:

93 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "* % (", 
©
->
Çme
) < 0) {

96 ià(
num_added
 > 0 && 
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "%zd Added Type%s",‚um_added, (num_added == 1 ? "" : "s")) < 0) {

99 ià(
num_»moved
 > 0

100 && 
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "%s%zd Removed Ty³%s", (
num_added
 > 0 ? ", " : ""), 
num_»moved
,

101 (
num_»moved
 == 1 ? "" : "s")) < 0) {

104 ià(
	`­Ş_¡r_­³nd
(&
s
, &
Ën
, ")\n") < 0) {

107 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
©
->
added_ty³s
); i++) {

108 
ty³
 = (*)
	`­Ş_veùÜ_g‘_–em’t
(
©
->
added_ty³s
, 
i
);

109 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "\t+ %s\n", 
ty³
) < 0) {

110 
”r
;

113 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
©
->
»moved_ty³s
); i++) {

114 
ty³
 = (*)
	`­Ş_veùÜ_g‘_–em’t
(
©
->
»moved_ty³s
, 
i
);

115 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "\t- %s\n", 
ty³
) < 0) {

116 
”r
;

119  
s
;

123 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
ENOTSUP
));

124 
”ºo
 = 
ENOTSUP
;

125  
NULL
;

128 
”r
:

130 
	`ä“
(
s
);

131 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

132 
”ºo
 = 
ENOMEM
;

133  
NULL
;

134 
	}
}

136 cÚ¡ 
­Ş_veùÜ_t
 *
	$pŞdiff_g‘_©Œib_veùÜ
(cÚ¡ 
pŞdiff_t
 * 
diff
)

138 ià(
diff
 =ğ
NULL
) {

139 
”ºo
 = 
EINVAL
;

140  
NULL
;

142  
diff
->
©Œib_diffs
->
diffs
;

143 
	}
}

145 cÚ¡ *
	$pŞdiff_©Œib_g‘_Çme
(cÚ¡ 
pŞdiff_©Œib_t
 * 
©Œib
)

147 ià(
©Œib
 =ğ
NULL
) {

148 
”ºo
 = 
EINVAL
;

149  
NULL
;

151  
©Œib
->
Çme
;

152 
	}
}

154 
pŞdiff_fÜm_e
 
	$pŞdiff_©Œib_g‘_fÜm
(cÚ¡ *
©Œib
)

156 ià(
©Œib
 =ğ
NULL
) {

157 
”ºo
 = 
EINVAL
;

160  ((cÚ¡ 
pŞdiff_©Œib_t
 *)
©Œib
)->
fÜm
;

161 
	}
}

163 cÚ¡ 
­Ş_veùÜ_t
 *
	$pŞdiff_©Œib_g‘_added_ty³s
(cÚ¡ 
pŞdiff_©Œib_t
 * 
©Œib
)

165 ià(
©Œib
 =ğ
NULL
) {

166 
”ºo
 = 
EINVAL
;

167  
NULL
;

169  
©Œib
->
added_ty³s
;

170 
	}
}

172 cÚ¡ 
­Ş_veùÜ_t
 *
	$pŞdiff_©Œib_g‘_»moved_ty³s
(cÚ¡ 
pŞdiff_©Œib_t
 * 
©Œib
)

174 ià(
©Œib
 =ğ
NULL
) {

175 
”ºo
 = 
EINVAL
;

176  
NULL
;

178  
©Œib
->
»moved_ty³s
;

179 
	}
}

183 
	$©Œib_ä“
(*
–em
)

185 ià(
–em
 !ğ
NULL
) {

186 
pŞdiff_©Œib_t
 *
t
 = (pŞdiff_©Œib_ˆ*è
–em
;

187 
	`ä“
(
t
->
Çme
);

188 
	`­Ş_veùÜ_de¡roy
(&
t
->
added_ty³s
);

189 
	`­Ş_veùÜ_de¡roy
(&
t
->
»moved_ty³s
);

190 
	`ä“
(
t
);

192 
	}
}

194 
pŞdiff_©Œib_summ¬y_t
 *
	$©Œib_summ¬y_ü—‹
()

196 
pŞdiff_©Œib_summ¬y_t
 *
rs
 = 
	`ÿÎoc
(1, (*rs));

197 ià(
rs
 =ğ
NULL
) {

198  
NULL
;

200 ià((
rs
->
diffs
 = 
	`­Ş_veùÜ_ü—‹
(
©Œib_ä“
)è=ğ
NULL
) {

201 
	`©Œib_summ¬y_de¡roy
(&
rs
);

202  
NULL
;

204  
rs
;

205 
	}
}

207 
	$©Œib_summ¬y_de¡roy
(
pŞdiff_©Œib_summ¬y_t
 ** 
rs
)

209 ià(
rs
 !ğ
NULL
 && *rs != NULL) {

210 
	`­Ş_veùÜ_de¡roy
(&(*
rs
)->
diffs
);

211 
	`ä“
(*
rs
);

212 *
rs
 = 
NULL
;

214 
	}
}

216 
	$©Œib_»£t
(
pŞdiff_t
 * 
diff
)

218 
”rÜ
 = 0;

220 ià(
diff
 =ğ
NULL
) {

221 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
EINVAL
));

222 
”ºo
 = 
EINVAL
;

226 
	`©Œib_summ¬y_de¡roy
(&
diff
->
©Œib_diffs
);

227 
diff
->
©Œib_diffs
 = 
	`©Œib_summ¬y_ü—‹
();

228 ià(
diff
->
©Œib_diffs
 =ğ
NULL
) {

229 
”rÜ
 = 
”ºo
;

230 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

231 
”ºo
 = 
”rÜ
;

236 
	}
}

241 
	$©Œib_Çme_comp
(cÚ¡ *
x
, cÚ¡ *
y
, *
¬g
)

243 cÚ¡ 
qpŞ_ty³_t
 *
r1
 = 
x
;

244 cÚ¡ 
qpŞ_ty³_t
 *
r2
 = 
y
;

245 
­Ş_pŞicy_t
 *
p
 = (­Ş_pŞicy_ˆ*è
¬g
;

246 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
p
);

247 cÚ¡ *
Çme1
, *
Çme2
;

248 ià(
	`qpŞ_ty³_g‘_Çme
(
q
, 
r1
, &
Çme1
è< 0 || qpŞ_ty³_g‘_Çme(q, 
r2
, &
Çme2
) < 0) {

251  
	`¡rcmp
(
Çme1
, 
Çme2
);

252 
	}
}

254 
­Ş_veùÜ_t
 *
	$©Œib_g‘_™ems
(
pŞdiff_t
 * 
diff
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
)

256 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

257 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

258 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicy
);

259 
”rÜ
 = 0;

260 ià(
	`qpŞ_pŞicy_g‘_ty³_™”
(
q
, &
™”
) < 0) {

261  
NULL
;

263 
v
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
);

264 ià(
v
 =ğ
NULL
) {

265 
”rÜ
 = 
”ºo
;

266 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

267 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

268 
”ºo
 = 
”rÜ
;

269  
NULL
;

271 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

272 
i§‰r
;

273 
qpŞ_ty³_t
 *
ty³
;

274 
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
ty³
);

275 
	`qpŞ_ty³_g‘_i§‰r
(
q
, 
ty³
, &
i§‰r
);

276 ià(
i§‰r
) {

277 
	`­Ş_veùÜ_­³nd
(
v
, 
ty³
);

280 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

281 
	`­Ş_veùÜ_sÜt
(
v
, 
©Œib_Çme_comp
, (*)
pŞicy
);

282  
v
;

283 
	}
}

285 
	$©Œib_comp
(cÚ¡ *
x
, cÚ¡ *
y
, cÚ¡ 
pŞdiff_t
 * 
diff
)

287 cÚ¡ 
qpŞ_ty³_t
 *
r1
 = 
x
;

288 cÚ¡ 
qpŞ_ty³_t
 *
r2
 = 
y
;

289 cÚ¡ *
Çme1
, *
Çme2
;

290 ià(
	`qpŞ_ty³_g‘_Çme
(
diff
->
Üig_qpŞ
, 
r1
, &
Çme1
è< 0 || qpŞ_ty³_g‘_Çme(diff->
mod_qpŞ
, 
r2
, &
Çme2
) < 0) {

293  
	`¡rcmp
(
Çme1
, 
Çme2
);

294 
	}
}

307 
pŞdiff_©Œib_t
 *
	$make_diff
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
pŞdiff_fÜm_e
 
fÜm
, cÚ¡ *
Çme
)

309 
pŞdiff_©Œib_t
 *
´
;

310 
”rÜ
;

311 ià((
´
 = 
	`ÿÎoc
(1, (*´))è=ğ
NULL
 ||

312 (
´
->
Çme
 = 
	`¡rdup
Òame)è=ğ
NULL
 ||

313 (
´
->
added_ty³s
 = 
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(1, 
ä“
)è=ğ
NULL
 ||

314 (
´
->
»moved_ty³s
 = 
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(1, 
ä“
)è=ğ
NULL
) {

315 
”rÜ
 = 
”ºo
;

316 
	`©Œib_ä“
(
´
);

317 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

318 
”ºo
 = 
”rÜ
;

319  
NULL
;

321 
´
->
fÜm
 = form;

322  
´
;

323 
	}
}

325 
	$©Œib_Ãw_diff
(
pŞdiff_t
 * 
diff
, 
pŞdiff_fÜm_e
 
fÜm
, cÚ¡ *
™em
)

327 cÚ¡ 
qpŞ_ty³_t
 *
r
 = 
™em
;

328 cÚ¡ *
Çme
 = 
NULL
;

329 
pŞdiff_©Œib_t
 *
´
;

330 
”rÜ
;

331 ià((
fÜm
 =ğ
POLDIFF_FORM_ADDED
 &&

332 
	`qpŞ_ty³_g‘_Çme
(
diff
->
mod_qpŞ
, 
r
, &
Çme
) < 0) ||

333 ((
fÜm
 =ğ
POLDIFF_FORM_REMOVED
 || fÜm =ğ
POLDIFF_FORM_MODIFIED
è&& 
	`qpŞ_ty³_g‘_Çme
(
diff
->
Üig_qpŞ
, 
r
, &
Çme
) < 0))

337 
´
 = 
	`make_diff
(
diff
, 
fÜm
, 
Çme
);

338 ià(
´
 =ğ
NULL
) {

341 ià(
	`­Ş_veùÜ_­³nd
(
diff
->
©Œib_diffs
->
diffs
, 
´
) < 0) {

342 
”rÜ
 = 
”ºo
;

343 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

344 
	`©Œib_ä“
(
´
);

345 
”ºo
 = 
”rÜ
;

348 ià(
fÜm
 =ğ
POLDIFF_FORM_ADDED
) {

349 
diff
->
©Œib_diffs
->
num_added
++;

351 
diff
->
©Œib_diffs
->
num_»moved
++;

354 
	}
}

368 
­Ş_veùÜ_t
 *
	$©Œib_g‘_ty³s
(cÚ¡ 
pŞdiff_t
 * 
diff
, cÚ¡ 
qpŞ_ty³_t
 * 
©Œib
, 
which
)

370 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

371 cÚ¡ 
qpŞ_ty³_t
 *
ty³
;

372 
ušt32_t
 
Ãw_v®
;

373 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

374 
»tv®
 = -1, 
”rÜ
 = 0;

376 ià((
v
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)) == NULL) {

377 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”ºo
));

378 
ş—nup
;

380 ià(
which
 =ğ
POLDIFF_POLICY_ORIG
) {

381 ià(
	`qpŞ_ty³_g‘_ty³_™”
(
diff
->
Üig_qpŞ
, 
©Œib
, &
™”
) < 0) {

382 
ş—nup
;

385 ià(
	`qpŞ_ty³_g‘_ty³_™”
(
diff
->
mod_qpŞ
, 
©Œib
, &
™”
) < 0) {

386 
ş—nup
;

389 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

390 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
ty³
è< 0 || (
Ãw_v®
 = 
	`ty³_m­_lookup
(
diff
,y³, 
which
)) == 0) {

391 
”rÜ
 = 
”ºo
;

392 
ş—nup
;

394 ià(
	`­Ş_veùÜ_­³nd
(
v
, (*)((
size_t
è
Ãw_v®
)) < 0) {

395 
”rÜ
 = 
”ºo
;

396 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

397 
ş—nup
;

401 
»tv®
 = 0;

402 
ş—nup
:

403 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

404 ià(
»tv®
 < 0) {

405 
	`­Ş_veùÜ_de¡roy
(&
v
);

406 
”ºo
 = 
”rÜ
;

407  
NULL
;

409  
v
;

410 
	}
}

412 
	$©Œib_d“p_diff
(
pŞdiff_t
 * 
diff
, cÚ¡ *
x
, cÚ¡ *
y
)

414 cÚ¡ 
qpŞ_ty³_t
 *
r1
 = 
x
;

415 cÚ¡ 
qpŞ_ty³_t
 *
r2
 = 
y
;

416 
­Ş_veùÜ_t
 *
v1
 = 
NULL
, *
v2
 = NULL;

417 
­Ş_veùÜ_t
 *
added_ty³s
 = 
NULL
, *
»moved_ty³s
 = NULL;

418 cÚ¡ 
­Ş_veùÜ_t
 *
»v”£_v
;

419 cÚ¡ *
Çme
;

420 *
Ãw_Çme
;

421 
ušt32_t
 
t1
, 
t2
;

422 
pŞdiff_©Œib_t
 *
r
 = 
NULL
;

423 
qpŞ_ty³_t
 *
t
;

424 
size_t
 
i
, 
j
;

425 
»tv®
 = -1, 
”rÜ
 = 0;

426 ià(
	`qpŞ_ty³_g‘_Çme
(
diff
->
Üig_qpŞ
, 
r1
, &
Çme
) < 0 ||

427 (
v1
 = 
	`©Œib_g‘_ty³s
(
diff
, 
r1
, 
POLDIFF_POLICY_ORIG
)è=ğ
NULL
 ||

428 (
v2
 = 
	`©Œib_g‘_ty³s
(
diff
, 
r2
, 
POLDIFF_POLICY_MOD
)è=ğ
NULL
) {

429 
”rÜ
 = 
”ºo
;

430 
ş—nup
;

432 
	`­Ş_veùÜ_sÜt_uniquify
(
v1
, 
NULL
, NULL);

433 
	`­Ş_veùÜ_sÜt_uniquify
(
v2
, 
NULL
, NULL);

434 ià((
added_ty³s
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)è=ğNULL || (
»moved_ty³s
 =‡pol_vector_create(NULL)) == NULL) {

435 
”rÜ
 = 
”ºo
;

436 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

437 
ş—nup
;

439 
i
 = 
j
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v1
);) {

440 ià(
j
 >ğ
	`­Ş_veùÜ_g‘_size
(
v2
))

442 
t1
 = (
ušt32_t
è((
size_t
è
	`­Ş_veùÜ_g‘_–em’t
(
v1
, 
i
));

443 
t2
 = (
ušt32_t
è((
size_t
è
	`­Ş_veùÜ_g‘_–em’t
(
v2
, 
j
));

444 ià(
t2
 > 
t1
) {

445 ià(
	`­Ş_veùÜ_­³nd
(
»moved_ty³s
, (*)((
size_t
è
t1
)) < 0) {

446 
”rÜ
 = 
”ºo
;

447 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

448 
ş—nup
;

450 
i
++;

451 } ià(
t1
 > 
t2
) {

452 ià(
	`­Ş_veùÜ_­³nd
(
added_ty³s
, (*)((
size_t
è
t2
)) < 0) {

453 
”rÜ
 = 
”ºo
;

454 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

455 
ş—nup
;

457 
j
++;

459 
i
++;

460 
j
++;

463 ; 
i
 < 
	`­Ş_veùÜ_g‘_size
(
v1
); i++) {

464 
t1
 = (
ušt32_t
è((
size_t
è
	`­Ş_veùÜ_g‘_–em’t
(
v1
, 
i
));

465 ià(
	`­Ş_veùÜ_­³nd
(
»moved_ty³s
, (*)((
size_t
è
t1
)) < 0) {

466 
”rÜ
 = 
”ºo
;

467 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

468 
ş—nup
;

471 ; 
j
 < 
	`­Ş_veùÜ_g‘_size
(
v2
); j++) {

472 
t2
 = (
ušt32_t
è((
size_t
è
	`­Ş_veùÜ_g‘_–em’t
(
v2
, 
j
));

473 ià(
	`­Ş_veùÜ_­³nd
(
added_ty³s
, (*)((
size_t
è
t2
)) < 0) {

474 
”rÜ
 = 
”ºo
;

475 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

476 
ş—nup
;

479 ià(
	`­Ş_veùÜ_g‘_size
(
added_ty³s
è> 0 ||‡pŞ_veùÜ_g‘_size(
»moved_ty³s
) > 0) {

480 ià((
r
 = 
	`make_diff
(
diff
, 
POLDIFF_FORM_MODIFIED
, 
Çme
)è=ğ
NULL
) {

481 
”rÜ
 = 
”ºo
;

482 
ş—nup
;

484 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
»moved_ty³s
); i++) {

485 
t1
 = (
ušt32_t
è((
size_t
è
	`­Ş_veùÜ_g‘_–em’t
(
»moved_ty³s
, 
i
));

486 ià((
»v”£_v
 = 
	`ty³_m­_lookup_»v”£
(
diff
, 
t1
, 
POLDIFF_POLICY_ORIG
)è=ğ
NULL
) {

487 
”rÜ
 = 
”ºo
;

488 
ş—nup
;

490 
j
 = 0; j < 
	`­Ş_veùÜ_g‘_size
(
»v”£_v
); j++) {

491 
t
 = (
qpŞ_ty³_t
 *è
	`­Ş_veùÜ_g‘_–em’t
(
»v”£_v
, 
j
);

492 ià(
	`qpŞ_ty³_g‘_Çme
(
diff
->
Üig_qpŞ
, 
t
, &
Çme
) < 0) {

493 
”rÜ
 = 
”ºo
;

494 
ş—nup
;

496 ià((
Ãw_Çme
 = 
	`¡rdup
(
Çme
)è=ğ
NULL
 || 
	`­Ş_veùÜ_­³nd
(
r
->
»moved_ty³s
,‚ew_name) < 0) {

497 
”rÜ
 = 
”ºo
;

498 
	`ä“
(
Ãw_Çme
);

499 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

500 
ş—nup
;

504 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
added_ty³s
); i++) {

505 
t2
 = (
ušt32_t
è((
size_t
è
	`­Ş_veùÜ_g‘_–em’t
(
added_ty³s
, 
i
));

506 ià((
»v”£_v
 = 
	`ty³_m­_lookup_»v”£
(
diff
, 
t2
, 
POLDIFF_POLICY_MOD
)è=ğ
NULL
) {

507 
”rÜ
 = 
”ºo
;

508 
ş—nup
;

510 
j
 = 0; j < 
	`­Ş_veùÜ_g‘_size
(
»v”£_v
); j++) {

511 
t
 = (
qpŞ_ty³_t
 *è
	`­Ş_veùÜ_g‘_–em’t
(
»v”£_v
, 
j
);

512 ià(
	`qpŞ_ty³_g‘_Çme
(
diff
->
mod_qpŞ
, 
t
, &
Çme
) < 0) {

513 
”rÜ
 = 
”ºo
;

514 
ş—nup
;

516 ià((
Ãw_Çme
 = 
	`¡rdup
(
Çme
)è=ğ
NULL
 || 
	`­Ş_veùÜ_­³nd
(
r
->
added_ty³s
,‚ew_name) < 0) {

517 
”rÜ
 = 
”ºo
;

518 
	`ä“
(
Ãw_Çme
);

519 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

520 
ş—nup
;

524 
	`­Ş_veùÜ_sÜt
(
r
->
»moved_ty³s
, 
­Ş_¡r_¡rcmp
, 
NULL
);

525 
	`­Ş_veùÜ_sÜt
(
r
->
added_ty³s
, 
­Ş_¡r_¡rcmp
, 
NULL
);

526 ià(
	`­Ş_veùÜ_­³nd
(
diff
->
©Œib_diffs
->
diffs
, 
r
) < 0) {

527 
”rÜ
 = 
”ºo
;

528 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

529 
ş—nup
;

531 
diff
->
©Œib_diffs
->
num_modif›d
++;

533 
»tv®
 = 0;

534 
ş—nup
:

535 
	`­Ş_veùÜ_de¡roy
(&
v1
);

536 
	`­Ş_veùÜ_de¡roy
(&
v2
);

537 
	`­Ş_veùÜ_de¡roy
(&
added_ty³s
);

538 
	`­Ş_veùÜ_de¡roy
(&
»moved_ty³s
);

539 ià(
»tv®
 != 0) {

540 
	`©Œib_ä“
(
r
);

542 
”ºo
 = 
”rÜ
;

543  
»tv®
;

544 
	}
}

	@libpoldiff/src/attrib_internal.h

25 #iâdeà
POLDIFF_ATTRIB_INTERNAL_H


26 
	#POLDIFF_ATTRIB_INTERNAL_H


	)

28 #ifdef 
__ılu¥lus


33 
pŞdiff_©Œib_summ¬y
 
	tpŞdiff_©Œib_summ¬y_t
;

41 
pŞdiff_©Œib_summ¬y_t
 *
©Œib_summ¬y_ü—‹
();

51 
©Œib_summ¬y_de¡roy
(
pŞdiff_©Œib_summ¬y_t
 ** 
us
);

60 
©Œib_»£t
(
pŞdiff_t
 * 
diff
);

72 
­Ş_veùÜ_t
 *
©Œib_g‘_™ems
(
pŞdiff_t
 * 
diff
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
);

86 
©Œib_comp
(cÚ¡ *
x
, cÚ¡ *
y
, cÚ¡ 
pŞdiff_t
 * 
diff
);

99 
©Œib_Ãw_diff
(
pŞdiff_t
 * 
diff
, 
pŞdiff_fÜm_e
 
fÜm
, cÚ¡ *
™em
);

115 
©Œib_d“p_diff
(
pŞdiff_t
 * 
diff
, cÚ¡ *
x
, cÚ¡ *
y
);

117 #ifdef 
__ılu¥lus


	@libpoldiff/src/avrule_diff.c

26 
	~<cÚfig.h
>

28 
	~"pŞdiff_š‹º®.h
"

30 
	~<­Ş/pŞicy-qu”y.h
>

31 
	~<­Ş/ut.h
>

32 
	~<qpŞ/pŞicy_ex‹nd.h
>

33 
	~<as£¹.h
>

34 
	~<”ºo.h
>

35 
	~<¡dio.h
>

36 
	~<¡ršg.h
>

38 
	spŞdiff_avruË_summ¬y


40 
size_t
 
	mnum_added
;

41 
size_t
 
	mnum_»moved
;

42 
size_t
 
	mnum_modif›d
;

43 
size_t
 
	mnum_added_ty³
;

44 
size_t
 
	mnum_»moved_ty³
;

45 
	mdiffs_sÜ‹d
;

47 
­Ş_veùÜ_t
 *
	mdiffs
;

50 
	spŞdiff_avruË


52 
ušt32_t
 
	m¥ec
;

54 cÚ¡ *
	msourû
, *
	mrg‘
;

56 *
	mşs
;

57 
pŞdiff_fÜm_e
 
	mfÜm
;

59 
­Ş_veùÜ_t
 *
	munmodif›d_³rms
;

61 
­Ş_veùÜ_t
 *
	madded_³rms
;

63 
­Ş_veùÜ_t
 *
	m»moved_³rms
;

66 cÚ¡ 
qpŞ_cÚd_t
 *
	mcÚd
;

67 
ušt32_t
 
	mb¿nch
;

69 
­Ş_veùÜ_t
 *
	mÜig_lš’os
;

71 
­Ş_veùÜ_t
 *
	mmod_lš’os
;

73 
qpŞ_avruË_t
 **
	mÜig_ruËs
;

74 
size_t
 
	mnum_Üig_ruËs
;

76 
qpŞ_avruË_t
 **
	mmod_ruËs
;

77 
size_t
 
	mnum_mod_ruËs
;

80 
	sp£udo_avruË


82 
ušt32_t
 
	m¥ec
;

84 
ušt32_t
 
	msourû
, 
	mrg‘
;

86 *
	mşs
;

89 **
	m³rms
;

90 
size_t
 
	mnum_³rms
;

92 *
	mboŞs
[5];

93 
ušt32_t
 
	mboŞ_v®
;

94 
ušt32_t
 
	mb¿nch
;

97 cÚ¡ 
qpŞ_cÚd_t
 *
	mcÚd
;

99 cÚ¡ 
qpŞ_avruË_t
 **
	mruËs
;

100 
size_t
 
	mnum_ruËs
;

101 } 
	tp£udo_avruË_t
;

119 
	$pŞdiff_avruË_g‘_¡©s
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
size_t
 
¡©s
[5], 
avruË_off£t_e
 
idx
)

121 ià(
diff
 =ğ
NULL
 || 
¡©s
 == NULL) {

122 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
EINVAL
));

123 
”ºo
 = 
EINVAL
;

126 
¡©s
[0] = 
diff
->
avruË_diffs
[
idx
]->
num_added
;

127 
¡©s
[1] = 
diff
->
avruË_diffs
[
idx
]->
num_»moved
;

128 
¡©s
[2] = 
diff
->
avruË_diffs
[
idx
]->
num_modif›d
;

129 
¡©s
[3] = 
diff
->
avruË_diffs
[
idx
]->
num_added_ty³
;

130 
¡©s
[4] = 
diff
->
avruË_diffs
[
idx
]->
num_»moved_ty³
;

131 
	}
}

133 
	$pŞdiff_avruË_g‘_¡©s_®low
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
size_t
 
¡©s
[5])

135 
	`pŞdiff_avruË_g‘_¡©s
(
diff
, 
¡©s
, 
AVRULE_OFFSET_ALLOW
);

136 
	}
}

138 
	$pŞdiff_avruË_g‘_¡©s_Ãv”®low
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
size_t
 
¡©s
[5])

140 
	`pŞdiff_avruË_g‘_¡©s
(
diff
, 
¡©s
, 
AVRULE_OFFSET_NEVERALLOW
);

141 
	}
}

143 
	$pŞdiff_avruË_g‘_¡©s_dÚud™
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
size_t
 
¡©s
[5])

145 
	`pŞdiff_avruË_g‘_¡©s
(
diff
, 
¡©s
, 
AVRULE_OFFSET_DONTAUDIT
);

146 
	}
}

148 
	$pŞdiff_avruË_g‘_¡©s_aud™®low
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
size_t
 
¡©s
[5])

150 
	`pŞdiff_avruË_g‘_¡©s
(
diff
, 
¡©s
, 
AVRULE_OFFSET_AUDITALLOW
);

151 
	}
}

153 *
	$pŞdiff_avruË_to_¡ršg
(cÚ¡ 
pŞdiff_t
 * 
diff
, cÚ¡ *
avruË
)

155 cÚ¡ 
pŞdiff_avruË_t
 *
·
 = (cÚ¡…Şdiff_avruË_ˆ*)
avruË
;

156 
­Ş_pŞicy_t
 *
p
;

157 cÚ¡ *
ruË_ty³
;

158 *
diff_ch¬
 = "", *
s
 = 
NULL
, *
³rm_Çme
, *
cÚd_ex´
 = NULL;

159 
size_t
 
i
, 
Ën
 = 0;

160 
show_³rm_sym
 = 0, 
”rÜ
;

161 ià(
diff
 =ğ
NULL
 || 
avruË
 == NULL) {

162 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
EINVAL
));

163 
”ºo
 = 
EINVAL
;

164  
NULL
;

166 
·
->
fÜm
) {

167 
POLDIFF_FORM_ADDED
:

168 
POLDIFF_FORM_ADD_TYPE
:

170 
diff_ch¬
 = "+";

171 
p
 = 
diff
->
mod_pŞ
;

174 
POLDIFF_FORM_REMOVED
:

175 
POLDIFF_FORM_REMOVE_TYPE
:

177 
diff_ch¬
 = "-";

178 
p
 = 
diff
->
Üig_pŞ
;

181 
POLDIFF_FORM_MODIFIED
:

183 
diff_ch¬
 = "*";

184 
p
 = 
diff
->
Üig_pŞ
;

185 
show_³rm_sym
 = 1;

190 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
ENOTSUP
));

191 
”ºo
 = 
ENOTSUP
;

192  
NULL
;

195 
ruË_ty³
 = 
	`­Ş_ruË_ty³_to_¡r
(
·
->
¥ec
);

196 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "% % % % : % {", 
diff_ch¬
, 
ruË_ty³
, 
·
->
sourû
,…a->
rg‘
,…a->
şs
) < 0) {

197 
”rÜ
 = 
”ºo
;

198 
”r
;

200 
i
 = 0; 
·
->
unmodif›d_³rms
 !ğ
NULL
 && i < 
	`­Ş_veùÜ_g‘_size
(pa->unmodified_perms); i++) {

201 
³rm_Çme
 = (*)
	`­Ş_veùÜ_g‘_–em’t
(
·
->
unmodif›d_³rms
, 
i
);

202 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, " %s", 
³rm_Çme
) < 0) {

203 
”rÜ
 = 
”ºo
;

204 
”r
;

207 
i
 = 0; 
·
->
added_³rms
 !ğ
NULL
 && i < 
	`­Ş_veùÜ_g‘_size
(pa->added_perms); i++) {

208 
³rm_Çme
 = (*)
	`­Ş_veùÜ_g‘_–em’t
(
·
->
added_³rms
, 
i
);

209 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, " %s%s", (
show_³rm_sym
 ? "+" : ""), 
³rm_Çme
) < 0) {

210 
”rÜ
 = 
”ºo
;

211 
”r
;

214 
i
 = 0; 
·
->
»moved_³rms
 !ğ
NULL
 && i < 
	`­Ş_veùÜ_g‘_size
(pa->removed_perms); i++) {

215 
³rm_Çme
 = (*)
	`­Ş_veùÜ_g‘_–em’t
(
·
->
»moved_³rms
, 
i
);

216 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, " %s%s", (
show_³rm_sym
 ? "-" : ""), 
³rm_Çme
) < 0) {

217 
”rÜ
 = 
”ºo
;

218 
”r
;

221 ià(
	`­Ş_¡r_­³nd
(&
s
, &
Ën
, " };") < 0) {

222 
”rÜ
 = 
”ºo
;

223 
”r
;

225 ià(
·
->
cÚd
 !ğ
NULL
) {

226 ià((
cÚd_ex´
 = 
	`­Ş_cÚd_ex´_»nd”
(
p
, 
·
->
cÚd
)è=ğ
NULL
) {

227 
”rÜ
 = 
”ºo
;

228 
”r
;

230 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, " [%s]:%s", 
cÚd_ex´
, (
·
->
b¿nch
 ? "TRUE" : "FALSE")) < 0) {

231 
”rÜ
 = 
”ºo
;

232 
”r
;

234 
	`ä“
(
cÚd_ex´
);

236  
s
;

237 
”r
:

238 
	`ä“
(
s
);

239 
	`ä“
(
cÚd_ex´
);

240 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

241 
”ºo
 = 
”rÜ
;

242  
NULL
;

243 
	}
}

248 
pŞdiff_avruË_cmp
(cÚ¡ *
x
, cÚ¡ *
y
, *
d©a
 
__©Œibu‹__
 ((
unu£d
)))

250 cÚ¡ 
pŞdiff_avruË_t
 *
	ga
 = (cÚ¡…Şdiff_avruË_ˆ*)
x
;

251 cÚ¡ 
pŞdiff_avruË_t
 *
	gb
 = (cÚ¡…Şdiff_avruË_ˆ*)
y
;

252 
	gcompv®
;

253 ià(
	ga
->
	g¥ec
 !ğ
b
->
¥ec
) {

254 cÚ¡ *
ruË_ty³1
 = 
­Ş_ruË_ty³_to_¡r
(
a
->
¥ec
);

255 cÚ¡ *
	gruË_ty³2
 = 
­Ş_ruË_ty³_to_¡r
(
b
->
¥ec
);

256 
	gcompv®
 = 
¡rcmp
(
ruË_ty³1
, 
ruË_ty³2
);

257 ià(
	gcompv®
 != 0) {

258  
compv®
;

261 ià((
	gcompv®
 = 
¡rcmp
(
a
->
sourû
, 
b
->source)) != 0) {

262  
compv®
;

264 ià((
	gcompv®
 = 
¡rcmp
(
a
->
rg‘
, 
b
->target)) != 0) {

265  
compv®
;

267 ià((
	gcompv®
 = 
¡rcmp
(
a
->
şs
, 
b
->cls)) != 0) {

268  
compv®
;

270 ià(
	ga
->
	gcÚd
 !ğ
b
->
cÚd
) {

271  (*)
a
->
cÚd
 - (*)
b
->cond;

274  
	gb
->
	gb¿nch
 - 
	ga
->branch;

290 cÚ¡ 
­Ş_veùÜ_t
 *
	$pŞdiff_g‘_avruË_veùÜ
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
avruË_off£t_e
 
idx
)

292 ià(
diff
 =ğ
NULL
) {

293 
”ºo
 = 
EINVAL
;

294  
NULL
;

296 ià(
diff
->
avruË_diffs
[
idx
]->
diffs_sÜ‹d
 == 0) {

297 
	`­Ş_veùÜ_sÜt
(
diff
->
avruË_diffs
[
idx
]->
diffs
, 
pŞdiff_avruË_cmp
, 
NULL
);

298 
diff
->
avruË_diffs
[
idx
]->
diffs_sÜ‹d
 = 1;

300  
diff
->
avruË_diffs
[
idx
]->
diffs
;

301 
	}
}

303 cÚ¡ 
­Ş_veùÜ_t
 *
	$pŞdiff_g‘_avruË_veùÜ_®low
(cÚ¡ 
pŞdiff_t
 * 
diff
)

305  
	`pŞdiff_g‘_avruË_veùÜ
(
diff
, 
AVRULE_OFFSET_ALLOW
);

306 
	}
}

308 cÚ¡ 
­Ş_veùÜ_t
 *
	$pŞdiff_g‘_avruË_veùÜ_aud™®low
(cÚ¡ 
pŞdiff_t
 * 
diff
)

310  
	`pŞdiff_g‘_avruË_veùÜ
(
diff
, 
AVRULE_OFFSET_AUDITALLOW
);

311 
	}
}

313 cÚ¡ 
­Ş_veùÜ_t
 *
	$pŞdiff_g‘_avruË_veùÜ_dÚud™
(cÚ¡ 
pŞdiff_t
 * 
diff
)

315  
	`pŞdiff_g‘_avruË_veùÜ
(
diff
, 
AVRULE_OFFSET_DONTAUDIT
);

316 
	}
}

318 cÚ¡ 
­Ş_veùÜ_t
 *
	$pŞdiff_g‘_avruË_veùÜ_Ãv”®low
(cÚ¡ 
pŞdiff_t
 * 
diff
)

320  
	`pŞdiff_g‘_avruË_veùÜ
(
diff
, 
AVRULE_OFFSET_NEVERALLOW
);

321 
	}
}

323 
pŞdiff_fÜm_e
 
	$pŞdiff_avruË_g‘_fÜm
(cÚ¡ *
avruË
)

325 ià(
avruË
 =ğ
NULL
) {

326 
”ºo
 = 
EINVAL
;

329  ((cÚ¡ 
pŞdiff_avruË_t
 *)
avruË
)->
fÜm
;

330 
	}
}

332 
ušt32_t
 
	$pŞdiff_avruË_g‘_ruË_ty³
(cÚ¡ 
pŞdiff_avruË_t
 * 
avruË
)

334 ià(
avruË
 =ğ
NULL
) {

335 
”ºo
 = 
EINVAL
;

338  
avruË
->
¥ec
;

339 
	}
}

341 cÚ¡ *
	$pŞdiff_avruË_g‘_sourû_ty³
(cÚ¡ 
pŞdiff_avruË_t
 * 
avruË
)

343 ià(
avruË
 =ğ
NULL
) {

344 
”ºo
 = 
EINVAL
;

347  
avruË
->
sourû
;

348 
	}
}

350 cÚ¡ *
	$pŞdiff_avruË_g‘_rg‘_ty³
(cÚ¡ 
pŞdiff_avruË_t
 * 
avruË
)

352 ià(
avruË
 =ğ
NULL
) {

353 
”ºo
 = 
EINVAL
;

356  
avruË
->
rg‘
;

357 
	}
}

359 cÚ¡ *
	$pŞdiff_avruË_g‘_objeù_şass
(cÚ¡ 
pŞdiff_avruË_t
 * 
avruË
)

361 ià(
avruË
 =ğ
NULL
) {

362 
”ºo
 = 
EINVAL
;

365  
avruË
->
şs
;

366 
	}
}

368 
	$pŞdiff_avruË_g‘_cÚd
(cÚ¡ 
pŞdiff_t
 * 
diff
, cÚ¡ 
pŞdiff_avruË_t
 * 
avruË
,

369 cÚ¡ 
qpŞ_cÚd_t
 ** 
cÚd
, 
ušt32_t
 * 
which_li¡
, cÚ¡ 
­Ş_pŞicy_t
 ** 
p
)

371 ià(
diff
 =ğ
NULL
 || 
avruË
 =ğNULL || 
cÚd
 =ğNULL || 
p
 == NULL) {

372 
”ºo
 = 
EINVAL
;

375 *
cÚd
 = 
avruË
->cond;

376 ià(*
cÚd
 =ğ
NULL
) {

377 *
which_li¡
 = 1;

378 *
p
 = 
NULL
;

379 } ià(
avruË
->
fÜm
 =ğ
POLDIFF_FORM_ADDED
 ||‡vruË->fÜm =ğ
POLDIFF_FORM_ADD_TYPE
) {

380 *
which_li¡
 = 
avruË
->
b¿nch
;

381 *
p
 = 
diff
->
mod_pŞ
;

383 *
which_li¡
 = 
avruË
->
b¿nch
;

384 *
p
 = 
diff
->
Üig_pŞ
;

386 
	}
}

388 cÚ¡ 
­Ş_veùÜ_t
 *
	$pŞdiff_avruË_g‘_unmodif›d_³rms
(cÚ¡ 
pŞdiff_avruË_t
 * 
avruË
)

390 ià(
avruË
 =ğ
NULL
) {

391 
”ºo
 = 
EINVAL
;

392  
NULL
;

394  
avruË
->
unmodif›d_³rms
;

395 
	}
}

397 cÚ¡ 
­Ş_veùÜ_t
 *
	$pŞdiff_avruË_g‘_added_³rms
(cÚ¡ 
pŞdiff_avruË_t
 * 
avruË
)

399 ià(
avruË
 =ğ
NULL
) {

400 
”ºo
 = 
EINVAL
;

401  
NULL
;

403  
avruË
->
added_³rms
;

404 
	}
}

406 cÚ¡ 
­Ş_veùÜ_t
 *
	$pŞdiff_avruË_g‘_»moved_³rms
(cÚ¡ 
pŞdiff_avruË_t
 * 
avruË
)

408 ià(
avruË
 =ğ
NULL
) {

409 
”ºo
 = 
EINVAL
;

410  
NULL
;

412  
avruË
->
»moved_³rms
;

413 
	}
}

415 cÚ¡ 
­Ş_veùÜ_t
 *
	$pŞdiff_avruË_g‘_Üig_lše_numb”s
(cÚ¡ 
pŞdiff_avruË_t
 * 
avruË
)

417 ià(
avruË
 =ğ
NULL
) {

418 
”ºo
 = 
EINVAL
;

419  
NULL
;

421  
avruË
->
Üig_lš’os
;

422 
	}
}

424 cÚ¡ 
­Ş_veùÜ_t
 *
	$pŞdiff_avruË_g‘_mod_lše_numb”s
(cÚ¡ 
pŞdiff_avruË_t
 * 
avruË
)

426 ià(
avruË
 =ğ
NULL
) {

427 
”ºo
 = 
EINVAL
;

428  
NULL
;

430  
avruË
->
mod_lš’os
;

431 
	}
}

437 
­Ş_veùÜ_t
 *
	$avruË_g‘_lše_numb”s_fÜ_³rm
(cÚ¡ 
pŞdiff_t
 * 
diff
, cÚ¡ *
³rm
, cÚ¡ 
qpŞ_pŞicy_t
 * 
q
,

438 
qpŞ_avruË_t
 ** 
ruËs
, cÚ¡ 
size_t
 
num_ruËs
)

440 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

441 
qpŞ_™”©Ü_t
 *
syn_™”
 = 
NULL
, *
³rm_™”
 = NULL;

442 
size_t
 
i
;

443 
”rÜ
 = 0;

445 ià((
v
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)) == NULL) {

446 
”rÜ
 = 
”ºo
;

447 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”ºo
));

448 
ş—nup
;

450 
i
 = 0; i < 
num_ruËs
; i++) {

451 ià(
	`qpŞ_avruË_g‘_syn_avruË_™”
(
q
, 
ruËs
[
i
], &
syn_™”
) < 0) {

452 
”rÜ
 = 
”ºo
;

453 
ş—nup
;

455 ; !
	`qpŞ_™”©Ü_’d
(
syn_™”
); 
	`qpŞ_™”©Ü_Ãxt
(syn_iter)) {

456 
qpŞ_syn_avruË_t
 *
syn_ruË
;

457 
	`qpŞ_™”©Ü_g‘_™em
(
syn_™”
, (**)&
syn_ruË
);

458 ià(
	`qpŞ_syn_avruË_g‘_³rm_™”
(
q
, 
syn_ruË
, &
³rm_™”
) < 0) {

459 
”rÜ
 = 
”ºo
;

460 
ş—nup
;

462 ; !
	`qpŞ_™”©Ü_’d
(
³rm_™”
); 
	`qpŞ_™”©Ü_Ãxt
(perm_iter)) {

463 *
syn_³rm
;

464 
	`qpŞ_™”©Ü_g‘_™em
(
³rm_™”
, (**)&
syn_³rm
);

465 ià(
	`¡rcmp
(
³rm
, 
syn_³rm
) == 0) {

466 
lš’o
;

467 
	`qpŞ_syn_avruË_g‘_lš’o
(
q
, 
syn_ruË
, &
lš’o
);

468 ià(
	`­Ş_veùÜ_­³nd
(
v
, (*)
lš’o
) < 0) {

469 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”ºo
));

474 
	`qpŞ_™”©Ü_de¡roy
(&
³rm_™”
);

476 
	`qpŞ_™”©Ü_de¡roy
(&
syn_™”
);

478 
	`­Ş_veùÜ_sÜt_uniquify
(
v
, 
NULL
, NULL);

479 
ş—nup
:

480 
	`qpŞ_™”©Ü_de¡roy
(&
syn_™”
);

481 
	`qpŞ_™”©Ü_de¡roy
(&
³rm_™”
);

482 ià(
”rÜ
 != 0) {

483 
	`­Ş_veùÜ_de¡roy
(&
v
);

484 
”ºo
 = 
”rÜ
;

485  
NULL
;

487  
v
;

488 
	}
}

490 
­Ş_veùÜ_t
 *
	$pŞdiff_avruË_g‘_Üig_lše_numb”s_fÜ_³rm
(cÚ¡ 
pŞdiff_t
 * 
diff
, cÚ¡ 
pŞdiff_avruË_t
 * 
avruË
,

491 cÚ¡ *
³rm
)

493 ià(
diff
 =ğ
NULL
 || 
avruË
 =ğNULL || 
³rm
 == NULL) {

494 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
EINVAL
));

495 
”ºo
 = 
EINVAL
;

496  
NULL
;

498 ià(!
diff
->
lše_numb”s_’abËd
 || 
avruË
->
fÜm
 =ğ
POLDIFF_FORM_ADDED
 ||‡vruË->fÜm =ğ
POLDIFF_FORM_ADD_TYPE
) {

499  
NULL
;

501 ià(
avruË
->
num_Üig_ruËs
 == 0) {

502  
NULL
;

504  
	`avruË_g‘_lše_numb”s_fÜ_³rm
(
diff
, 
³rm
, diff->
Üig_qpŞ
, 
avruË
->
Üig_ruËs
,‡vruË->
num_Üig_ruËs
);

505 
	}
}

507 
­Ş_veùÜ_t
 *
	$pŞdiff_avruË_g‘_mod_lše_numb”s_fÜ_³rm
(cÚ¡ 
pŞdiff_t
 * 
diff
, cÚ¡ 
pŞdiff_avruË_t
 * 
avruË
,

508 cÚ¡ *
³rm
)

510 ià(
diff
 =ğ
NULL
 || 
avruË
 =ğNULL || 
³rm
 == NULL) {

511 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
EINVAL
));

512 
”ºo
 = 
EINVAL
;

513  
NULL
;

515 ià(!
diff
->
lše_numb”s_’abËd
 || 
avruË
->
fÜm
 =ğ
POLDIFF_FORM_REMOVED
 ||‡vruË->fÜm =ğ
POLDIFF_FORM_REMOVE_TYPE
) {

516  
NULL
;

518 ià(
avruË
->
num_mod_ruËs
 == 0) {

519  
NULL
;

521  
	`avruË_g‘_lše_numb”s_fÜ_³rm
(
diff
, 
³rm
, diff->
mod_qpŞ
, 
avruË
->
mod_ruËs
,‡vruË->
num_mod_ruËs
);

522 
	}
}

532 
	$pŞdiff_avruË_ä“
(*
–em
)

534 ià(
–em
 !ğ
NULL
) {

535 
pŞdiff_avruË_t
 *
a
 = (pŞdiff_avruË_ˆ*è
–em
;

536 
	`­Ş_veùÜ_de¡roy
(&
a
->
unmodif›d_³rms
);

537 
	`­Ş_veùÜ_de¡roy
(&
a
->
added_³rms
);

538 
	`­Ş_veùÜ_de¡roy
(&
a
->
»moved_³rms
);

539 
	`­Ş_veùÜ_de¡roy
(&
a
->
Üig_lš’os
);

540 
	`­Ş_veùÜ_de¡roy
(&
a
->
mod_lš’os
);

541 
	`ä“
(
a
->
Üig_ruËs
);

542 
	`ä“
(
a
->
mod_ruËs
);

543 
	`ä“
(
a
);

545 
	}
}

547 
pŞdiff_avruË_summ¬y_t
 *
	$avruË_ü—‹
()

549 
pŞdiff_avruË_summ¬y_t
 *
rs
 = 
	`ÿÎoc
(1, (*rs));

550 ià(
rs
 =ğ
NULL
) {

551  
NULL
;

553 ià((
rs
->
diffs
 = 
	`­Ş_veùÜ_ü—‹
(
pŞdiff_avruË_ä“
)è=ğ
NULL
) {

554 
	`avruË_de¡roy
(&
rs
);

555  
NULL
;

557  
rs
;

558 
	}
}

560 
	$avruË_de¡roy
(
pŞdiff_avruË_summ¬y_t
 ** 
rs
)

562 ià(
rs
 !ğ
NULL
 && *rs != NULL) {

563 
	`­Ş_veùÜ_de¡roy
(&(*
rs
)->
diffs
);

564 
	`ä“
(*
rs
);

565 *
rs
 = 
NULL
;

567 
	}
}

578 
	$avruË_»£t
(
pŞdiff_t
 * 
diff
, 
avruË_off£t_e
 
idx
)

580 
”rÜ
 = 0;

582 
	`avruË_de¡roy
(&
diff
->
avruË_diffs
[
idx
]);

583 
diff
->
avruË_diffs
[
idx
] = 
	`avruË_ü—‹
();

584 ià(
diff
->
avruË_diffs
[
idx
] =ğ
NULL
) {

585 
”rÜ
 = 
”ºo
;

586 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

587 
”ºo
 = 
”rÜ
;

592 
	}
}

594 
	$avruË_»£t_®low
(
pŞdiff_t
 * 
diff
)

596  
	`avruË_»£t
(
diff
, 
AVRULE_OFFSET_ALLOW
);

597 
	}
}

599 
	$avruË_»£t_aud™®low
(
pŞdiff_t
 * 
diff
)

601  
	`avruË_»£t
(
diff
, 
AVRULE_OFFSET_AUDITALLOW
);

602 
	}
}

604 
	$avruË_»£t_dÚud™
(
pŞdiff_t
 * 
diff
)

606  
	`avruË_»£t
(
diff
, 
AVRULE_OFFSET_DONTAUDIT
);

607 
	}
}

609 
	$avruË_»£t_Ãv”®low
(
pŞdiff_t
 * 
diff
)

611  
	`avruË_»£t
(
diff
, 
AVRULE_OFFSET_NEVERALLOW
);

612 
	}
}

614 
	$avruË_ä“_™em
(*
™em
)

616 
p£udo_avruË_t
 *
a
 = (p£udo_avruË_ˆ*è
™em
;

617 ià(
™em
 !ğ
NULL
) {

618 
	`ä“
(
a
->
³rms
);

619 
	`ä“
(
a
->
ruËs
);

620 
	`ä“
(
a
);

622 
	}
}

642 
	$p£udo_avruË_comp
(cÚ¡ 
p£udo_avruË_t
 * 
ruË1
, cÚ¡…£udo_avruË_ˆ* 
ruË2
, 
is_sÜtšg
)

644 
size_t
 
i
;

645 
ušt32_t
 
boŞ_v®
;

646 ià(
ruË1
->
rg‘
 !ğ
ruË2
->target) {

647  
ruË1
->
rg‘
 - 
ruË2
->target;

649 ià(
ruË1
->
sourû
 !ğ
ruË2
->source) {

650  
ruË1
->
sourû
 - 
ruË2
->source;

652 ià(
ruË1
->
şs
 !ğ
ruË2
->cls) {

653  ()(
ruË1
->
şs
 - 
ruË2
->cls);

655 ià(
ruË1
->
¥ec
 !ğ
ruË2
->spec) {

656  
ruË1
->
¥ec
 - 
ruË2
->spec;

658 ià(
ruË1
->
boŞs
[0] =ğ
NULL
 && 
ruË2
->bools[0] == NULL) {

661 } ià(
ruË1
->
boŞs
[0] =ğ
NULL
 && 
ruË2
->bools[0] != NULL) {

664 } ià(
ruË1
->
boŞs
[0] !ğ
NULL
 && 
ruË2
->bools[0] == NULL) {

668 
i
 = 0; i < ((
ruË1
->
boŞs
) / (rule1->bools[0])); i++) {

669 ià(
ruË1
->
boŞs
[
i
] !ğ
ruË2
->bools[i]) {

670  ()(
ruË1
->
boŞs
[
i
] - 
ruË2
->bools[i]);

673 ià(
is_sÜtšg
) {

674 ià(
ruË1
->
b¿nch
 !ğ
ruË2
->branch) {

675  
ruË1
->
b¿nch
 - 
ruË2
->branch;

677  ()
ruË1
->
boŞ_v®
 - ()
ruË2
->bool_val;

679 ià(
ruË1
->
b¿nch
 =ğ
ruË2
->branch) {

680 
boŞ_v®
 = 
ruË2
->bool_val;

682 
boŞ_v®
 = ~
ruË2
->bool_val;

684 ià(
ruË1
->
boŞ_v®
 < bool_val) {

686 } ià(
ruË1
->
boŞ_v®
 > bool_val) {

691 
	}
}

693 
avruË_b¡_comp
(cÚ¡ *
x
, cÚ¡ *
y
, *
d©a
 
__©Œibu‹__
 ((
unu£d
)))

695 cÚ¡ 
p£udo_avruË_t
 *
	gr1
 = (cÚ¡…£udo_avruË_ˆ*)
x
;

696 cÚ¡ 
p£udo_avruË_t
 *
	gr2
 = (cÚ¡…£udo_avruË_ˆ*)
y
;

697  
p£udo_avruË_comp
(
r1
, 
r2
, 1);

710 
	$avruË_bud_cÚd
(
pŞdiff_t
 * 
diff
, cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
qpŞ_cÚd_t
 * 
cÚd
, 
p£udo_avruË_t
 * 
key
)

712 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

713 
qpŞ_cÚd_ex´_node_t
 *
node
;

714 
ušt32_t
 
ex´_ty³
, 
Œuthšess
;

715 
qpŞ_boŞ_t
 *
boŞs
[5] = { 
NULL
, NULL, NULL, NULL, NULL }, *
qboŞ
;

716 
size_t
 
i
, 
j
;

717 
size_t
 
num_boŞs
 = 0;

718 cÚ¡ *
boŞ_Çme
;

719 *
p£udo_boŞ
, *
t
;

720 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
p
);

721 
»tv®
 = -1, 
”rÜ
 = 0, 
compv®
;

722 ià(
	`qpŞ_cÚd_g‘_ex´_node_™”
(
q
, 
cÚd
, &
™”
) < 0) {

723 
”rÜ
 = 
”ºo
;

724 
ş—nup
;

726 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

727 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
node
è< 0 || 
	`qpŞ_cÚd_ex´_node_g‘_ex´_ty³
(
q
,‚ode, &
ex´_ty³
) < 0) {

728 
”rÜ
 = 
”ºo
;

729 
ş—nup
;

731 ià(
ex´_ty³
 !ğ
QPOL_COND_EXPR_BOOL
) {

734 ià(
	`qpŞ_cÚd_ex´_node_g‘_boŞ
(
q
, 
node
, &
qboŞ
) < 0) {

735 
”rÜ
 = 
”ºo
;

736 
ş—nup
;

738 
i
 = 0; i < 
num_boŞs
; i++) {

739 ià(
boŞs
[
i
] =ğ
qboŞ
) {

743 ià(
i
 >ğ
num_boŞs
) {

744 
	`as£¹
(
i
 < 5);

745 
boŞs
[
i
] = 
qboŞ
;

746 
num_boŞs
++;

749 
i
 = 0; i < 
num_boŞs
; i++) {

750 ià(
	`qpŞ_boŞ_g‘_Çme
(
q
, 
boŞs
[
i
], &
boŞ_Çme
) < 0) {

751 
”rÜ
 = 
”ºo
;

752 
ş—nup
;

754 ià(
	`­Ş_b¡_g‘_–em’t
(
diff
->
boŞ_b¡
, (*)
boŞ_Çme
, 
NULL
, (**)&
p£udo_boŞ
) < 0) {

755 
”rÜ
 = 
EBADRQC
;

756 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

757 
	`as£¹
(0);

758 
ş—nup
;

760 
key
->
boŞs
[
i
] = 
p£udo_boŞ
;

765 
i
 = 
num_boŞs
; i > 1; i--) {

766 
j
 = 1; j < 
i
; j++) {

767 
compv®
 = 
	`¡rcmp
(
key
->
boŞs
[
j
 - 1], key->bools[j]);

768 ià(
compv®
 > 0) {

769 
t
 = 
key
->
boŞs
[
j
];

770 
key
->
boŞs
[
j
] = key->bools[j - 1];

771 
key
->
boŞs
[
j
 - 1] = 
t
;

772 
qboŞ
 = 
boŞs
[
j
];

773 
boŞs
[
j
] = bools[j - 1];

774 
boŞs
[
j
 - 1] = 
qboŞ
;

780 
key
->
boŞ_v®
 = 0;

781 
i
 = 0; i < 32; i++) {

782 
j
 = 0; j < 
num_boŞs
; j++) {

783 
¡©e
 = ((
i
 & (1 << 
j
)) ? 1 : 0);

784 ià(
	`qpŞ_boŞ_£t_¡©e_no_ev®
(
q
, 
boŞs
[
j
], 
¡©e
) < 0) {

785 
”rÜ
 = 
”ºo
;

786 
ş—nup
;

789 ià(
	`qpŞ_cÚd_ev®
(
q
, 
cÚd
, &
Œuthšess
) < 0) {

790 
”rÜ
 = 
”ºo
;

791 
ş—nup
;

793 
key
->
boŞ_v®
 = (key->boŞ_v® << 1è| 
Œuthšess
;

796 
key
->
cÚd
 = cond;

797 
»tv®
 = 0;

798 
ş—nup
:

799 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

800  
»tv®
;

801 
	}
}

810 
	$sÜt_ªd_uniquify_³rms
(
p£udo_avruË_t
 * 
key
)

812 
size_t
 
i
, 
j
;

813 *
t
;

814 
i
 = 
key
->
num_³rms
; i > 1; i--) {

815 
j
 = 1; j < 
i
; j++) {

816 ià(
key
->
³rms
[
j
 - 1] > key->perms[j]) {

817 
t
 = 
key
->
³rms
[
j
];

818 
key
->
³rms
[
j
] = key->perms[j - 1];

819 
key
->
³rms
[
j
 - 1] = 
t
;

823 
i
 = 1; i < 
key
->
num_³rms
; i++) {

824 ià(
key
->
³rms
[
i
] == key->perms[i - 1]) {

825 
	`memmove
(
key
->
³rms
 + 
i
, key->³rm + i + 1, (key->
num_³rms
 - i - 1) * (key->perms[0]));

826 
key
->
num_³rms
--;

829 
	}
}

844 
	$avruË_add_to_b¡
(
pŞdiff_t
 * 
diff
, cÚ¡ 
­Ş_pŞicy_t
 * 
p
,

845 cÚ¡ 
qpŞ_avruË_t
 * 
ruË
, 
ušt32_t
 
sourû
, ušt32_ˆ
rg‘
, 
­Ş_b¡_t
 * 
b
)

847 
p£udo_avruË_t
 *
key
, *
š£¹ed_key
;

848 cÚ¡ 
qpŞ_şass_t
 *
obj_şass
;

849 
qpŞ_™”©Ü_t
 *
³rm_™”
 = 
NULL
;

850 cÚ¡ *
şass_Çme
;

851 *
³rm_Çme
, *
p£udo_³rm
, **
t
;

852 
size_t
 
num_³rms
;

853 cÚ¡ 
qpŞ_cÚd_t
 *
cÚd
;

854 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
p
);

855 
»tv®
 = -1, 
”rÜ
 = 0, 
compv®
;

856 ià((
key
 = 
	`ÿÎoc
(1, (*key))è=ğ
NULL
) {

857 
”rÜ
 = 
”ºo
;

858 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

859 
ş—nup
;

861 ià(
	`qpŞ_avruË_g‘_ruË_ty³
(
q
, 
ruË
, &(
key
->
¥ec
)) < 0 ||

862 
	`qpŞ_avruË_g‘_objeù_şass
(
q
, 
ruË
, &
obj_şass
) < 0 ||

863 
	`qpŞ_avruË_g‘_³rm_™”
(
q
, 
ruË
, &
³rm_™”
è< 0 || 
	`qpŞ_avruË_g‘_cÚd
(q,„uË, &
cÚd
) < 0) {

864 
”rÜ
 = 
”ºo
;

865 
ş—nup
;

867 ià(
	`qpŞ_şass_g‘_Çme
(
q
, 
obj_şass
, &
şass_Çme
) < 0) {

868 
”rÜ
 = 
”ºo
;

869 
ş—nup
;

871 ià(
	`­Ş_b¡_g‘_–em’t
(
diff
->
şass_b¡
, (*)
şass_Çme
, 
NULL
, (**)&
key
->
şs
) < 0) {

872 
”rÜ
 = 
EBADRQC
;

873 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

874 
	`as£¹
(0);

875 
ş—nup
;

877 
key
->
sourû
 = source;

878 
key
->
rg‘
 =arget;

879 ià(
cÚd
 !ğ
NULL
 && (
	`qpŞ_avruË_g‘_which_li¡
(
q
, 
ruË
, &(
key
->
b¿nch
)è< 0 || 
	`avruË_bud_cÚd
(
diff
, 
p
, cond, key) < 0)) {

880 
”rÜ
 = 
”ºo
;

881 
ş—nup
;

885 ià((
compv®
 = 
	`­Ş_b¡_š£¹_ªd_g‘
(
b
, (**)&
key
, 
NULL
)) < 0) {

886 
”rÜ
 = 
”ºo
;

887 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

888 
ş—nup
;

890 
š£¹ed_key
 = 
key
;

891 
key
 = 
NULL
;

894 ià(
	`qpŞ_™”©Ü_g‘_size
(
³rm_™”
, &
num_³rms
) < 0) {

895 
”rÜ
 = 
”ºo
;

896 
ş—nup
;

898 ià((
t
 = 
	`»®loc
(
š£¹ed_key
->
³rms
, (š£¹ed_key->
num_³rms
 +‚um_³rmsè* (*t))è=ğ
NULL
) {

899 
”rÜ
 = 
”ºo
;

900 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

901 
ş—nup
;

903 
š£¹ed_key
->
³rms
 = 
t
;

904 ; !
	`qpŞ_™”©Ü_’d
(
³rm_™”
); 
	`qpŞ_™”©Ü_Ãxt
(perm_iter)) {

905 ià(
	`qpŞ_™”©Ü_g‘_™em
(
³rm_™”
, (*)&
³rm_Çme
) < 0) {

906 
”rÜ
 = 
”ºo
;

907 
ş—nup
;

909 ià(
	`­Ş_b¡_g‘_–em’t
(
diff
->
³rm_b¡
, 
³rm_Çme
, 
NULL
, (**)&
p£udo_³rm
) < 0) {

910 
”rÜ
 = 
EBADRQC
;

911 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

912 
	`as£¹
(0);

913 
	`ä“
(
³rm_Çme
);

914 
ş—nup
;

916 
	`ä“
(
³rm_Çme
);

917 
š£¹ed_key
->
³rms
[(š£¹ed_key->
num_³rms
)++] = 
p£udo_³rm
;

919 
	`sÜt_ªd_uniquify_³rms
(
š£¹ed_key
);

922 ià(
	`qpŞ_pŞicy_has_ÿ·b™y
(
q
, 
QPOL_CAP_LINE_NUMBERS
)) {

923 cÚ¡ 
qpŞ_avruË_t
 **
a
 = 
	`»®loc
(
š£¹ed_key
->
ruËs
,

924 (
š£¹ed_key
->
num_ruËs
 + 1è* (*
a
));

925 ià(
a
 =ğ
NULL
) {

926 
”rÜ
 = 
”ºo
;

927 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

928 
ş—nup
;

930 
š£¹ed_key
->
ruËs
 = 
a
;

931 
š£¹ed_key
->
ruËs
[š£¹ed_key->
num_ruËs
++] = 
ruË
;

934 
»tv®
 = 0;

935 
ş—nup
:

936 
	`qpŞ_™”©Ü_de¡roy
(&
³rm_™”
);

937 ià(
»tv®
 < 0) {

938 
	`avruË_ä“_™em
(
key
);

940 
”ºo
 = 
”rÜ
;

941  
»tv®
;

942 
	}
}

956 
	$avruË_ex·nd
(
pŞdiff_t
 * 
diff
, cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
qpŞ_avruË_t
 * 
ruË
, 
­Ş_b¡_t
 * 
b
)

958 cÚ¡ 
qpŞ_ty³_t
 *
sourû
, *
Üig_rg‘
, *
rg‘
;

959 
sourû_©Œ
, 
rg‘_©Œ
;

960 
qpŞ_™”©Ü_t
 *
sourû_™”
 = 
NULL
, *
rg‘_™”
 = NULL;

961 
ušt32_t
 
sourû_v®
, 
rg‘_v®
;

962 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
p
);

963 
which
 = (
p
 =ğ
diff
->
Üig_pŞ
 ? 
POLDIFF_POLICY_ORIG
 : 
POLDIFF_POLICY_MOD
);

964 
»tv®
 = -1, 
”rÜ
 = 0;

965 ià(
	`qpŞ_avruË_g‘_sourû_ty³
(
q
, 
ruË
, &
sourû
) < 0 ||

966 
	`qpŞ_avruË_g‘_rg‘_ty³
(
q
, 
ruË
, &
Üig_rg‘
) < 0 ||

967 
	`qpŞ_ty³_g‘_i§‰r
(
q
, 
sourû
, &
sourû_©Œ
è< 0 || qpŞ_ty³_g‘_i§‰r(q, 
Üig_rg‘
, &
rg‘_©Œ
)) {

968 
”rÜ
 = 
”ºo
;

969 
ş—nup
;

971 #ifdeà
SETOOLS_DEBUG


972 cÚ¡ *
Üig_sourû_Çme
, *
Üig_rg‘_Çme
;

973 
	`qpŞ_ty³_g‘_Çme
(
q
, 
sourû
, &
Üig_sourû_Çme
);

974 
	`qpŞ_ty³_g‘_Çme
(
q
, 
Üig_rg‘
, &
Üig_rg‘_Çme
);

977 ià(
sourû_©Œ
) {

978 ià(
	`qpŞ_ty³_g‘_ty³_™”
(
q
, 
sourû
, &
sourû_™”
) < 0) {

979 
”rÜ
 = 
”ºo
;

980 
ş—nup
;

984 ià(
	`qpŞ_™”©Ü_’d
(
sourû_™”
)) {

985 
»tv®
 = 0;

986 
ş—nup
;

990 ià(
sourû_©Œ
) {

991 ià(
	`qpŞ_™”©Ü_g‘_™em
(
sourû_™”
, (**)&
sourû
) < 0) {

992 
”rÜ
 = 
”ºo
;

993 
ş—nup
;

995 
	`qpŞ_™”©Ü_Ãxt
(
sourû_™”
);

997 ià(
rg‘_©Œ
) {

998 ià(
	`qpŞ_ty³_g‘_ty³_™”
(
q
, 
Üig_rg‘
, &
rg‘_™”
) < 0) {

999 
”rÜ
 = 
”ºo
;

1000 
ş—nup
;

1004 ià(
	`qpŞ_™”©Ü_’d
(
rg‘_™”
)) {

1005 
»tv®
 = 0;

1006 
ş—nup
;

1009 
rg‘
 = 
Üig_rg‘
;

1012 ià(
rg‘_©Œ
) {

1013 ià(
	`qpŞ_™”©Ü_g‘_™em
(
rg‘_™”
, (**)&
rg‘
) < 0) {

1014 
”rÜ
 = 
”ºo
;

1015 
ş—nup
;

1017 
	`qpŞ_™”©Ü_Ãxt
(
rg‘_™”
);

1019 #ifdeà
SETOOLS_DEBUG


1020 cÚ¡ *
n1
, *
n2
;

1021 
	`qpŞ_ty³_g‘_Çme
(
q
, 
sourû
, &
n1
);

1022 
	`qpŞ_ty³_g‘_Çme
(
q
, 
rg‘
, &
n2
);

1024 ià((
sourû_v®
 = 
	`ty³_m­_lookup
(
diff
, 
sourû
, 
which
)) == 0 ||

1025 (
rg‘_v®
 = 
	`ty³_m­_lookup
(
diff
, 
rg‘
, 
which
)) == 0 ||

1026 
	`avruË_add_to_b¡
(
diff
, 
p
, 
ruË
, 
sourû_v®
, 
rg‘_v®
, 
b
) < 0) {

1027 
”rÜ
 = 
”ºo
;

1028 
ş—nup
;

1030 } 
rg‘_©Œ
 && !
	`qpŞ_™”©Ü_’d
(
rg‘_™”
));

1031 
	`qpŞ_™”©Ü_de¡roy
(&
rg‘_™”
);

1032 } 
sourû_©Œ
 && !
	`qpŞ_™”©Ü_’d
(
sourû_™”
));

1033 
»tv®
 = 0;

1034 
ş—nup
:

1035 
	`qpŞ_™”©Ü_de¡roy
(&
sourû_™”
);

1036 
	`qpŞ_™”©Ü_de¡roy
(&
rg‘_™”
);

1037 
”ºo
 = 
”rÜ
;

1038  
»tv®
;

1039 
	}
}

1055 
­Ş_veùÜ_t
 *
	$avruË_g‘_™ems
(
pŞdiff_t
 * 
diff
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
, cÚ¡ 
which
)

1057 
­Ş_veùÜ_t
 *
boŞs
 = 
NULL
, *
boŞ_¡©es
 = NULL;

1058 
size_t
 
i
, 
num_ruËs
, 
j
;

1059 
­Ş_b¡_t
 *
b
 = 
NULL
;

1060 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

1061 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

1062 cÚ¡ 
qpŞ_avruË_t
 *
ruË
;

1063 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicy
);

1064 
»tv®
 = -1, 
”rÜ
 = 0;

1068 ià(
which
 =ğ
QPOL_RULE_NEVERALLOW
 && !
	`qpŞ_pŞicy_has_ÿ·b™y
(
q
, 
QPOL_CAP_NEVERALLOW
)) {

1069 
v
 = 
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(1, 
avruË_ä“_™em
);

1070 ià(
v
 =ğ
NULL
) {

1071 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1073  
v
;

1076 ià(
	`pŞdiff_bud_b¡s
(
diff
) < 0) {

1077 
”rÜ
 = 
”ºo
;

1078 
ş—nup
;

1082 ià(
	`­Ş_boŞ_g‘_by_qu”y
(
pŞicy
, 
NULL
, &
boŞs
) < 0) {

1083 
”rÜ
 = 
”ºo
;

1084 
ş—nup
;

1086 ià((
boŞ_¡©es
 = 
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(
	`­Ş_veùÜ_g‘_size
(
boŞs
), 
NULL
)) == NULL) {

1087 
”rÜ
 = 
”ºo
;

1088 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1089 
ş—nup
;

1091 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
boŞs
); i++) {

1092 
qpŞ_boŞ_t
 *
qboŞ
 = 
	`­Ş_veùÜ_g‘_–em’t
(
boŞs
, 
i
);

1093 
¡©e
;

1094 ià(
	`qpŞ_boŞ_g‘_¡©e
(
q
, 
qboŞ
, &
¡©e
) < 0) {

1095 
”rÜ
 = 
”ºo
;

1096 
ş—nup
;

1098 ià(
	`­Ş_veùÜ_­³nd
(
boŞ_¡©es
, (*)((
size_t
è
¡©e
)) < 0) {

1099 
”rÜ
 = 
”ºo
;

1100 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1101 
ş—nup
;

1104 ià((
b
 = 
	`­Ş_b¡_ü—‹
(
avruË_b¡_comp
, 
avruË_ä“_™em
)è=ğ
NULL
) {

1105 
”rÜ
 = 
”ºo
;

1106 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1107 
ş—nup
;

1109 ià(
	`qpŞ_pŞicy_g‘_avruË_™”
(
q
, 
which
, &
™”
) < 0) {

1111 
”rÜ
 = 
”ºo
;

1112 
ş—nup
;

1114 
	`qpŞ_™”©Ü_g‘_size
(
™”
, &
num_ruËs
);

1115 
j
 = 0; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter), j++) {

1116 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
ruË
è< 0 || 
	`avruË_ex·nd
(
diff
, 
pŞicy
,„uË, 
b
) < 0) {

1117 
”rÜ
 = 
”ºo
;

1118 
ş—nup
;

1120 ià(!(
j
 % 1024)) {

1121 
³rûÁ
 = 50 * 
j
 / 
num_ruËs
 + (
pŞicy
 =ğ
diff
->
mod_pŞ
 ? 50 : 0);

1122 
	`INFO
(
diff
, "Computšg AV„uË difã»nû: %02d%% com¶‘e", 
³rûÁ
);

1125 ià((
v
 = 
	`­Ş_b¡_g‘_veùÜ
(
b
, 1)è=ğ
NULL
) {

1126 
”rÜ
 = 
”ºo
;

1127 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1128 
ş—nup
;

1130 
»tv®
 = 0;

1131 
ş—nup
:

1133 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
boŞs
); i++) {

1134 
qpŞ_boŞ_t
 *
qboŞ
 = 
	`­Ş_veùÜ_g‘_–em’t
(
boŞs
, 
i
);

1135 
¡©e
 = ()((
size_t
è
	`­Ş_veùÜ_g‘_–em’t
(
boŞ_¡©es
, 
i
));

1136 
	`qpŞ_boŞ_£t_¡©e_no_ev®
(
q
, 
qboŞ
, 
¡©e
);

1138 
	`qpŞ_pŞicy_»ev®u©e_cÚds
(
q
);

1139 
	`­Ş_veùÜ_de¡roy
(&
boŞs
);

1140 
	`­Ş_veùÜ_de¡roy
(&
boŞ_¡©es
);

1141 
	`­Ş_b¡_de¡roy
(&
b
);

1142 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

1143 ià(
»tv®
 < 0) {

1144 
	`­Ş_veùÜ_de¡roy
(&
v
);

1145 
”ºo
 = 
”rÜ
;

1146  
NULL
;

1148  
v
;

1149 
	}
}

1151 
­Ş_veùÜ_t
 *
	$avruË_g‘_™ems_®low
(
pŞdiff_t
 * 
diff
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
)

1153  
	`avruË_g‘_™ems
(
diff
, 
pŞicy
, 
QPOL_RULE_ALLOW
);

1154 
	}
}

1156 
­Ş_veùÜ_t
 *
	$avruË_g‘_™ems_aud™®low
(
pŞdiff_t
 * 
diff
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
)

1158  
	`avruË_g‘_™ems
(
diff
, 
pŞicy
, 
QPOL_RULE_AUDITALLOW
);

1159 
	}
}

1161 
­Ş_veùÜ_t
 *
	$avruË_g‘_™ems_dÚud™
(
pŞdiff_t
 * 
diff
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
)

1163  
	`avruË_g‘_™ems
(
diff
, 
pŞicy
, 
QPOL_RULE_DONTAUDIT
);

1164 
	}
}

1166 
­Ş_veùÜ_t
 *
	$avruË_g‘_™ems_Ãv”®low
(
pŞdiff_t
 * 
diff
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
)

1168  
	`avruË_g‘_™ems
(
diff
, 
pŞicy
, 
QPOL_RULE_NEVERALLOW
);

1169 
	}
}

1171 
avruË_comp
(cÚ¡ *
x
, cÚ¡ *
y
, cÚ¡ 
pŞdiff_t
 * 
diff
 
__©Œibu‹__
 ((
unu£d
)))

1173 cÚ¡ 
p£udo_avruË_t
 *
	gr1
 = (cÚ¡…£udo_avruË_ˆ*)
x
;

1174 cÚ¡ 
p£udo_avruË_t
 *
	gr2
 = (cÚ¡…£udo_avruË_ˆ*)
y
;

1175  
p£udo_avruË_comp
(
r1
, 
r2
, 0);

1191 
pŞdiff_avruË_t
 *
	$make_avdiff
(
pŞdiff_t
 * 
diff
, 
pŞdiff_fÜm_e
 
fÜm
, 
p£udo_avruË_t
 * 
ruË
)

1193 
pŞdiff_avruË_t
 *
·
 = 
NULL
;

1194 cÚ¡ *
n1
, *
n2
;

1195 
”rÜ
 = 0;

1196 ià(
fÜm
 =ğ
POLDIFF_FORM_ADDED
 || fÜm =ğ
POLDIFF_FORM_ADD_TYPE
) {

1197 
n1
 = 
	`ty³_m­_g‘_Çme
(
diff
, 
ruË
->
sourû
, 
POLDIFF_POLICY_MOD
);

1198 
n2
 = 
	`ty³_m­_g‘_Çme
(
diff
, 
ruË
->
rg‘
, 
POLDIFF_POLICY_MOD
);

1200 
n1
 = 
	`ty³_m­_g‘_Çme
(
diff
, 
ruË
->
sourû
, 
POLDIFF_POLICY_ORIG
);

1201 
n2
 = 
	`ty³_m­_g‘_Çme
(
diff
, 
ruË
->
rg‘
, 
POLDIFF_POLICY_ORIG
);

1203 
	`as£¹
(
n1
 !ğ
NULL
 && 
n2
 != NULL);

1204 ià((
·
 = 
	`ÿÎoc
(1, (*·))è=ğ
NULL
) {

1205 
”rÜ
 = 
”ºo
;

1206 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1207 
ş—nup
;

1209 
·
->
¥ec
 = 
ruË
->spec;

1210 
·
->
sourû
 = 
n1
;

1211 
·
->
rg‘
 = 
n2
;

1212 
·
->
şs
 = 
ruË
->cls;

1213 
·
->
fÜm
 = form;

1214 
·
->
cÚd
 = 
ruË
->cond;

1215 
·
->
b¿nch
 = 
ruË
->branch;

1216 
ş—nup
:

1217 ià(
”rÜ
 != 0) {

1218 
	`pŞdiff_avruË_ä“
(
·
);

1219 
”ºo
 = 
”rÜ
;

1220  
NULL
;

1222  
·
;

1223 
	}
}

1238 
	$avruË_Ãw_diff
(
pŞdiff_t
 * 
diff
, 
pŞdiff_fÜm_e
 
fÜm
, cÚ¡ *
™em
, 
avruË_off£t_e
 
idx
)

1240 
p£udo_avruË_t
 *
ruË
 = (p£udo_avruË_ˆ*è
™em
;

1241 
pŞdiff_avruË_t
 *
·
 = 
NULL
;

1242 cÚ¡ 
­Ş_veùÜ_t
 *
v1
, *
v2
;

1243 
­Ş_veùÜ_t
 **
rg‘
;

1244 
­Ş_pŞicy_t
 *
p
;

1245 
size_t
 
i
;

1246 
»tv®
 = -1, 
”rÜ
 = 
”ºo
;

1251 ià(
fÜm
 =ğ
POLDIFF_FORM_ADDED
) {

1252 ià((
v1
 = 
	`ty³_m­_lookup_»v”£
(
diff
, 
ruË
->
sourû
, 
POLDIFF_POLICY_ORIG
)è=ğ
NULL
 ||

1253 (
v2
 = 
	`ty³_m­_lookup_»v”£
(
diff
, 
ruË
->
rg‘
, 
POLDIFF_POLICY_ORIG
)è=ğ
NULL
) {

1254 
”rÜ
 = 
”ºo
;

1255 
ş—nup
;

1257 ià(
	`­Ş_veùÜ_g‘_size
(
v1
è=ğ0 ||‡pŞ_veùÜ_g‘_size(
v2
) == 0) {

1258 
fÜm
 = 
POLDIFF_FORM_ADD_TYPE
;

1260 
p
 = 
diff
->
mod_pŞ
;

1262 ià((
v1
 = 
	`ty³_m­_lookup_»v”£
(
diff
, 
ruË
->
sourû
, 
POLDIFF_POLICY_MOD
)è=ğ
NULL
 ||

1263 (
v2
 = 
	`ty³_m­_lookup_»v”£
(
diff
, 
ruË
->
rg‘
, 
POLDIFF_POLICY_MOD
)è=ğ
NULL
) {

1264 
”rÜ
 = 
”ºo
;

1265 
ş—nup
;

1267 ià(
	`­Ş_veùÜ_g‘_size
(
v1
è=ğ0 ||‡pŞ_veùÜ_g‘_size(
v2
) == 0) {

1268 
fÜm
 = 
POLDIFF_FORM_REMOVE_TYPE
;

1270 
p
 = 
diff
->
Üig_pŞ
;

1273 
·
 = 
	`make_avdiff
(
diff
, 
fÜm
, 
ruË
);

1274 ià(
·
 =ğ
NULL
) {

1278 ià(
fÜm
 =ğ
POLDIFF_FORM_ADDED
 || fÜm =ğ
POLDIFF_FORM_ADD_TYPE
) {

1279 ià((
·
->
»moved_³rms
 = 
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(1, 
NULL
)) == NULL ||

1280 (
·
->
unmodif›d_³rms
 = 
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(1, 
NULL
)) == NULL) {

1281 
”rÜ
 = 
”ºo
;

1282 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1283 
ş—nup
;

1285 
rg‘
 = &
·
->
added_³rms
;

1287 ià((
·
->
added_³rms
 = 
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(1, 
NULL
)) == NULL ||

1288 (
·
->
unmodif›d_³rms
 = 
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(1, 
NULL
)) == NULL) {

1289 
”rÜ
 = 
”ºo
;

1290 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1291 
ş—nup
;

1293 
rg‘
 = &
·
->
»moved_³rms
;

1295 ià((*
rg‘
 = 
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(
ruË
->
num_³rms
, 
NULL
)) == NULL) {

1296 
”rÜ
 = 
”ºo
;

1297 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1298 
ş—nup
;

1300 
i
 = 0; i < 
ruË
->
num_³rms
; i++) {

1301 ià(
	`­Ş_veùÜ_­³nd
(*
rg‘
, 
ruË
->
³rms
[
i
]) < 0) {

1302 
”rÜ
 = 
”ºo
;

1303 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1304 
ş—nup
;

1307 
	`­Ş_veùÜ_sÜt
(*
rg‘
, 
­Ş_¡r_¡rcmp
, 
NULL
);

1309 ià(
	`qpŞ_pŞicy_has_ÿ·b™y
(
	`­Ş_pŞicy_g‘_qpŞ
(
p
), 
QPOL_CAP_LINE_NUMBERS
)) {

1311 
­Ş_veùÜ_t
 *
vl
 = 
NULL
;

1312 ià((
vl
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)) == NULL) {

1313 
”rÜ
 = 
”ºo
;

1314 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1315 
ş—nup
;

1317 ià(
fÜm
 =ğ
POLDIFF_FORM_ADDED
 || fÜm =ğ
POLDIFF_FORM_ADD_TYPE
) {

1318 
·
->
mod_lš’os
 = 
vl
;

1320 
·
->
Üig_lš’os
 = 
vl
;

1324 ià(
fÜm
 =ğ
POLDIFF_FORM_ADDED
 || fÜm =ğ
POLDIFF_FORM_ADD_TYPE
) {

1325 
·
->
num_mod_ruËs
 = 
ruË
->
num_ruËs
;

1326 
·
->
mod_ruËs
 = 
	`ÿÎoc
(
ruË
->
num_ruËs
, (
qpŞ_avruË_t
 *));

1327 ià(!
·
->
mod_ruËs
) {

1328 
”rÜ
 = 
”ºo
;

1329 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1330 
ş—nup
;

1332 
	`memıy
(
·
->
mod_ruËs
, 
ruË
->
ruËs
,„uË->
num_ruËs
 * (
qpŞ_avruË_t
 *));

1334 
·
->
num_Üig_ruËs
 = 
ruË
->
num_ruËs
;

1335 
·
->
Üig_ruËs
 = 
	`ÿÎoc
(
ruË
->
num_ruËs
, (
qpŞ_avruË_t
 *));

1336 ià(!
·
->
Üig_ruËs
) {

1337 
”rÜ
 = 
”ºo
;

1338 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1339 
ş—nup
;

1341 
	`memıy
(
·
->
Üig_ruËs
, 
ruË
->
ruËs
,„uË->
num_ruËs
 * (
qpŞ_avruË_t
 *));

1345 ià(
	`­Ş_veùÜ_­³nd
(
diff
->
avruË_diffs
[
idx
]->
diffs
, 
·
) < 0) {

1346 
”rÜ
 = 
”ºo
;

1347 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1348 
ş—nup
;

1350 
fÜm
) {

1351 
POLDIFF_FORM_ADDED
:

1352 
diff
->
avruË_diffs
[
idx
]->
num_added
++;

1354 
POLDIFF_FORM_ADD_TYPE
:

1355 
diff
->
avruË_diffs
[
idx
]->
num_added_ty³
++;

1357 
POLDIFF_FORM_REMOVED
:

1358 
diff
->
avruË_diffs
[
idx
]->
num_»moved
++;

1360 
POLDIFF_FORM_REMOVE_TYPE
:

1361 
diff
->
avruË_diffs
[
idx
]->
num_»moved_ty³
++;

1364 
”rÜ
 = 
EBADRQC
;

1365 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1366 
	`as£¹
(0);

1367 
ş—nup
;

1369 
diff
->
avruË_diffs
[
idx
]->
diffs_sÜ‹d
 = 0;

1370 
»tv®
 = 0;

1371 
ş—nup
:

1372 ià(
»tv®
 < 0) {

1373 
	`pŞdiff_avruË_ä“
(
·
);

1375 
”ºo
 = 
”rÜ
;

1376  
»tv®
;

1377 
	}
}

1379 
	$avruË_Ãw_diff_®low
(
pŞdiff_t
 * 
diff
, 
pŞdiff_fÜm_e
 
fÜm
, cÚ¡ *
™em
)

1381  
	`avruË_Ãw_diff
(
diff
, 
fÜm
, 
™em
, 
AVRULE_OFFSET_ALLOW
);

1382 
	}
}

1384 
	$avruË_Ãw_diff_aud™®low
(
pŞdiff_t
 * 
diff
, 
pŞdiff_fÜm_e
 
fÜm
, cÚ¡ *
™em
)

1386  
	`avruË_Ãw_diff
(
diff
, 
fÜm
, 
™em
, 
AVRULE_OFFSET_AUDITALLOW
);

1387 
	}
}

1389 
	$avruË_Ãw_diff_dÚud™
(
pŞdiff_t
 * 
diff
, 
pŞdiff_fÜm_e
 
fÜm
, cÚ¡ *
™em
)

1391  
	`avruË_Ãw_diff
(
diff
, 
fÜm
, 
™em
, 
AVRULE_OFFSET_DONTAUDIT
);

1392 
	}
}

1394 
	$avruË_Ãw_diff_Ãv”®low
(
pŞdiff_t
 * 
diff
, 
pŞdiff_fÜm_e
 
fÜm
, cÚ¡ *
™em
)

1396  
	`avruË_Ãw_diff
(
diff
, 
fÜm
, 
™em
, 
AVRULE_OFFSET_NEVERALLOW
);

1397 
	}
}

1415 
	$avruË_d“p_diff
(
pŞdiff_t
 * 
diff
, cÚ¡ *
x
, cÚ¡ *
y
, 
avruË_off£t_e
 
idx
)

1417 
p£udo_avruË_t
 *
r1
 = (p£udo_avruË_ˆ*è
x
;

1418 
p£udo_avruË_t
 *
r2
 = (p£udo_avruË_ˆ*è
y
;

1419 
­Ş_veùÜ_t
 *
unmodif›d_³rms
 = 
NULL
, *
added_³rms
 = NULL, *
»moved_³rms
 = NULL;

1420 
size_t
 
i
, 
j
;

1421 *
³rm1
, *
³rm2
;

1422 
pŞdiff_avruË_t
 *
·
 = 
NULL
;

1423 
»tv®
 = -1, 
”rÜ
 = 0;

1425 ià((
unmodif›d_³rms
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)) == NULL ||

1426 (
added_³rms
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)è=ğNULL || (
»moved_³rms
 =‡pol_vector_create(NULL)) == NULL) {

1427 
”rÜ
 = 
”ºo
;

1428 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1429 
ş—nup
;

1431 
i
 = 
j
 = 0; i < 
r1
->
num_³rms
;) {

1432 ià(
j
 >ğ
r2
->
num_³rms
)

1434 
³rm1
 = 
r1
->
³rms
[
i
];

1435 
³rm2
 = 
r2
->
³rms
[
j
];

1436 ià(
³rm2
 > 
³rm1
) {

1437 ià(
	`­Ş_veùÜ_­³nd
(
»moved_³rms
, 
³rm1
) < 0) {

1438 
”rÜ
 = 
”ºo
;

1439 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1440 
ş—nup
;

1442 
i
++;

1443 } ià(
³rm1
 > 
³rm2
) {

1444 ià(
	`­Ş_veùÜ_­³nd
(
added_³rms
, 
³rm2
) < 0) {

1445 
”rÜ
 = 
”ºo
;

1446 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1447 
ş—nup
;

1449 
j
++;

1451 ià(
	`­Ş_veùÜ_­³nd
(
unmodif›d_³rms
, 
³rm1
) < 0) {

1452 
”rÜ
 = 
”ºo
;

1453 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1454 
ş—nup
;

1456 
i
++;

1457 
j
++;

1461 ; 
i
 < 
r1
->
num_³rms
; i++) {

1462 
³rm1
 = 
r1
->
³rms
[
i
];

1463 ià(
	`­Ş_veùÜ_­³nd
(
»moved_³rms
, 
³rm1
) < 0) {

1464 
”rÜ
 = 
”ºo
;

1465 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1466 
ş—nup
;

1469 ; 
j
 < 
r2
->
num_³rms
; j++) {

1470 
³rm2
 = 
r2
->
³rms
[
j
];

1471 ià(
	`­Ş_veùÜ_­³nd
(
added_³rms
, 
³rm2
) < 0) {

1472 
”rÜ
 = 
”ºo
;

1473 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1474 
ş—nup
;

1477 ià(
	`­Ş_veùÜ_g‘_size
(
added_³rms
è> 0 ||‡pŞ_veùÜ_g‘_size(
»moved_³rms
) > 0) {

1478 ià((
·
 = 
	`make_avdiff
(
diff
, 
POLDIFF_FORM_MODIFIED
, 
r1
)è=ğ
NULL
) {

1479 
”rÜ
 = 
”ºo
;

1480 
ş—nup
;

1482 
·
->
unmodif›d_³rms
 = unmodified_perms;

1483 
·
->
added_³rms
 =‡dded_perms;

1484 
·
->
»moved_³rms
 =„emoved_perms;

1485 
unmodif›d_³rms
 = 
NULL
;

1486 
added_³rms
 = 
NULL
;

1487 
»moved_³rms
 = 
NULL
;

1488 
	`­Ş_veùÜ_sÜt
(
·
->
unmodif›d_³rms
, 
­Ş_¡r_¡rcmp
, 
NULL
);

1489 
	`­Ş_veùÜ_sÜt
(
·
->
added_³rms
, 
­Ş_¡r_¡rcmp
, 
NULL
);

1490 
	`­Ş_veùÜ_sÜt
(
·
->
»moved_³rms
, 
­Ş_¡r_¡rcmp
, 
NULL
);

1493 ià(
	`qpŞ_pŞicy_has_ÿ·b™y
(
	`­Ş_pŞicy_g‘_qpŞ
(
diff
->
Üig_pŞ
), 
QPOL_CAP_LINE_NUMBERS
)) {

1494 ià((
·
->
Üig_lš’os
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)) == NULL) {

1495 
”rÜ
 = 
”ºo
;

1496 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1497 
ş—nup
;

1501 
·
->
num_Üig_ruËs
 = 
r1
->
num_ruËs
;

1502 
·
->
Üig_ruËs
 = 
	`ÿÎoc
(
r1
->
num_ruËs
, (
qpŞ_avruË_t
 *));

1503 ià(!
·
->
Üig_ruËs
) {

1504 
”rÜ
 = 
”ºo
;

1505 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1506 
ş—nup
;

1508 
	`memıy
(
·
->
Üig_ruËs
, 
r1
->
ruËs
,„1->
num_ruËs
 * (
qpŞ_avruË_t
 *));

1510 ià(
	`qpŞ_pŞicy_has_ÿ·b™y
(
	`­Ş_pŞicy_g‘_qpŞ
(
diff
->
mod_pŞ
), 
QPOL_CAP_LINE_NUMBERS
)) {

1511 ià((
·
->
mod_lš’os
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)) == NULL) {

1512 
”rÜ
 = 
”ºo
;

1513 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1514 
ş—nup
;

1518 
·
->
num_mod_ruËs
 = 
r2
->
num_ruËs
;

1519 
·
->
mod_ruËs
 = 
	`ÿÎoc
(
r2
->
num_ruËs
, (
qpŞ_avruË_t
 *));

1520 ià(!
·
->
mod_ruËs
) {

1521 
”rÜ
 = 
”ºo
;

1522 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1523 
ş—nup
;

1525 
	`memıy
(
·
->
mod_ruËs
, 
r2
->
ruËs
,„2->
num_ruËs
 * (
qpŞ_avruË_t
 *));

1527 ià(
	`­Ş_veùÜ_­³nd
(
diff
->
avruË_diffs
[
idx
]->
diffs
, 
·
) < 0) {

1528 
”rÜ
 = 
”ºo
;

1529 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1530 
ş—nup
;

1532 
diff
->
avruË_diffs
[
idx
]->
num_modif›d
++;

1533 
diff
->
avruË_diffs
[
idx
]->
diffs_sÜ‹d
 = 0;

1535 
»tv®
 = 0;

1536 
ş—nup
:

1537 
	`­Ş_veùÜ_de¡roy
(&
unmodif›d_³rms
);

1538 
	`­Ş_veùÜ_de¡roy
(&
added_³rms
);

1539 
	`­Ş_veùÜ_de¡roy
(&
»moved_³rms
);

1540 ià(
»tv®
 != 0) {

1541 
	`pŞdiff_avruË_ä“
(
·
);

1543 
”ºo
 = 
”rÜ
;

1544  
»tv®
;

1545 
	}
}

1547 
	$avruË_d“p_diff_®low
(
pŞdiff_t
 * 
diff
, cÚ¡ *
x
, cÚ¡ *
y
)

1549  
	`avruË_d“p_diff
(
diff
, 
x
, 
y
, 
AVRULE_OFFSET_ALLOW
);

1550 
	}
}

1552 
	$avruË_d“p_diff_aud™®low
(
pŞdiff_t
 * 
diff
, cÚ¡ *
x
, cÚ¡ *
y
)

1554  
	`avruË_d“p_diff
(
diff
, 
x
, 
y
, 
AVRULE_OFFSET_AUDITALLOW
);

1555 
	}
}

1557 
	$avruË_d“p_diff_dÚud™
(
pŞdiff_t
 * 
diff
, cÚ¡ *
x
, cÚ¡ *
y
)

1559  
	`avruË_d“p_diff
(
diff
, 
x
, 
y
, 
AVRULE_OFFSET_DONTAUDIT
);

1560 
	}
}

1562 
	$avruË_d“p_diff_Ãv”®low
(
pŞdiff_t
 * 
diff
, cÚ¡ *
x
, cÚ¡ *
y
)

1564  
	`avruË_d“p_diff
(
diff
, 
x
, 
y
, 
AVRULE_OFFSET_NEVERALLOW
);

1565 
	}
}

1567 
	$avruË_’abË_lše_numb”s
(
pŞdiff_t
 * 
diff
, 
avruË_off£t_e
 
idx
)

1569 cÚ¡ 
­Ş_veùÜ_t
 *
av
 = 
NULL
;

1570 
pŞdiff_avruË_t
 *
avruË
 = 
NULL
;

1571 
size_t
 
i
, 
j
;

1572 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

1573 
qpŞ_syn_avruË_t
 *
§v
 = 
NULL
;

1574 
”rÜ
 = 0;

1575 
lš’o
 = 0;

1577 
av
 = 
	`pŞdiff_g‘_avruË_veùÜ
(
diff
, 
idx
);

1579 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
av
); i++) {

1580 
avruË
 = 
	`­Ş_veùÜ_g‘_–em’t
(
av
, 
i
);

1581 ià(
	`­Ş_veùÜ_g‘_size
(
avruË
->
mod_lš’os
è||‡pŞ_veùÜ_g‘_size×vruË->
Üig_lš’os
))

1583 
j
 = 0; j < 
avruË
->
num_Üig_ruËs
; j++) {

1584 ià(
	`qpŞ_avruË_g‘_syn_avruË_™”
(
diff
->
Üig_qpŞ
, 
avruË
->
Üig_ruËs
[
j
], &
™”
)) {

1585 
”rÜ
 = 
”ºo
;

1586 
”r
;

1588 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

1589 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
§v
) < 0) {

1590 
”rÜ
 = 
”ºo
;

1591 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1592 
”r
;

1594 ià(
	`qpŞ_syn_avruË_g‘_lš’o
(
diff
->
Üig_qpŞ
, 
§v
, &
lš’o
) < 0) {

1595 
”rÜ
 = 
”ºo
;

1596 
”r
;

1598 ià(
	`­Ş_veùÜ_­³nd
(
avruË
->
Üig_lš’os
, (*)
lš’o
) < 0) {

1599 
”rÜ
 = 
”ºo
;

1600 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1601 
”r
;

1604 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

1606 
	`­Ş_veùÜ_sÜt_uniquify
(
avruË
->
Üig_lš’os
, 
NULL
, NULL);

1607 
j
 = 0; j < 
avruË
->
num_mod_ruËs
; j++) {

1608 ià(
	`qpŞ_avruË_g‘_syn_avruË_™”
(
diff
->
mod_qpŞ
, 
avruË
->
mod_ruËs
[
j
], &
™”
)) {

1609 
”rÜ
 = 
”ºo
;

1610 
”r
;

1612 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

1613 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
§v
) < 0) {

1614 
”rÜ
 = 
”ºo
;

1615 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1616 
”r
;

1618 ià(
	`qpŞ_syn_avruË_g‘_lš’o
(
diff
->
mod_qpŞ
, 
§v
, &
lš’o
) < 0) {

1619 
”rÜ
 = 
”ºo
;

1620 
”r
;

1622 ià(
	`­Ş_veùÜ_­³nd
(
avruË
->
mod_lš’os
, (*)
lš’o
) < 0) {

1623 
”rÜ
 = 
”ºo
;

1624 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1625 
”r
;

1628 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

1630 
	`­Ş_veùÜ_sÜt_uniquify
(
avruË
->
mod_lš’os
, 
NULL
, NULL);

1633 
”r
:

1634 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

1636 
	}
}

	@libpoldiff/src/avrule_internal.h

25 #iâdeà
POLDIFF_AVRULE_INTERNAL_H


26 
	#POLDIFF_AVRULE_INTERNAL_H


	)

28 #ifdef 
__ılu¥lus


33 
pŞdiff_avruË_summ¬y
 
	tpŞdiff_avruË_summ¬y_t
;

42 
pŞdiff_avruË_summ¬y_t
 *
avruË_ü—‹
();

52 
avruË_de¡roy
(
pŞdiff_avruË_summ¬y_t
 ** 
rs
);

61 
avruË_»£t_®low
(
pŞdiff_t
 * 
diff
);

70 
avruË_»£t_aud™®low
(
pŞdiff_t
 * 
diff
);

79 
avruË_»£t_dÚud™
(
pŞdiff_t
 * 
diff
);

88 
avruË_»£t_Ãv”®low
(
pŞdiff_t
 * 
diff
);

103 
­Ş_veùÜ_t
 *
avruË_g‘_™ems_®low
(
pŞdiff_t
 * 
diff
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
);

118 
­Ş_veùÜ_t
 *
avruË_g‘_™ems_aud™®low
(
pŞdiff_t
 * 
diff
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
);

133 
­Ş_veùÜ_t
 *
avruË_g‘_™ems_dÚud™
(
pŞdiff_t
 * 
diff
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
);

148 
­Ş_veùÜ_t
 *
avruË_g‘_™ems_Ãv”®low
(
pŞdiff_t
 * 
diff
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
);

163 
avruË_comp
(cÚ¡ *
x
, cÚ¡ *
y
, cÚ¡ 
pŞdiff_t
 * 
diff
);

176 
avruË_Ãw_diff_®low
(
pŞdiff_t
 * 
diff
, 
pŞdiff_fÜm_e
 
fÜm
, cÚ¡ *
™em
);

189 
avruË_Ãw_diff_aud™®low
(
pŞdiff_t
 * 
diff
, 
pŞdiff_fÜm_e
 
fÜm
, cÚ¡ *
™em
);

202 
avruË_Ãw_diff_dÚud™
(
pŞdiff_t
 * 
diff
, 
pŞdiff_fÜm_e
 
fÜm
, cÚ¡ *
™em
);

215 
avruË_Ãw_diff_Ãv”®low
(
pŞdiff_t
 * 
diff
, 
pŞdiff_fÜm_e
 
fÜm
, cÚ¡ *
™em
);

231 
avruË_d“p_diff_®low
(
pŞdiff_t
 * 
diff
, cÚ¡ *
x
, cÚ¡ *
y
);

247 
avruË_d“p_diff_aud™®low
(
pŞdiff_t
 * 
diff
, cÚ¡ *
x
, cÚ¡ *
y
);

263 
avruË_d“p_diff_dÚud™
(
pŞdiff_t
 * 
diff
, cÚ¡ *
x
, cÚ¡ *
y
);

279 
avruË_d“p_diff_Ãv”®low
(
pŞdiff_t
 * 
diff
, cÚ¡ *
x
, cÚ¡ *
y
);

290 
avruË_’abË_lše_numb”s
(
pŞdiff_t
 * 
diff
, 
avruË_off£t_e
 
idx
);

292 #ifdef 
__ılu¥lus


	@libpoldiff/src/bool_diff.c

26 
	~<cÚfig.h
>

28 
	~"pŞdiff_š‹º®.h
"

30 
	~<­Ş/ut.h
>

31 
	~<­Ş/veùÜ.h
>

32 
	~<”ºo.h
>

33 
	~<¡dio.h
>

34 
	~<¡ršg.h
>

35 
	~<¡dboŞ.h
>

37 
	spŞdiff_boŞ_summ¬y


39 
size_t
 
	mnum_added
;

40 
size_t
 
	mnum_»moved
;

41 
size_t
 
	mnum_modif›d
;

42 
­Ş_veùÜ_t
 *
	mdiffs
;

45 
	spŞdiff_boŞ


47 *
	mÇme
;

48 
pŞdiff_fÜm_e
 
	mfÜm
;

49 
boŞ
 
	m¡©e
;

52 
	$pŞdiff_boŞ_g‘_¡©s
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
size_t
 
¡©s
[5])

54 ià(
diff
 =ğ
NULL
 || 
¡©s
 == NULL) {

55 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
EINVAL
));

56 
”ºo
 = 
EINVAL
;

59 
¡©s
[0] = 
diff
->
boŞ_diffs
->
num_added
;

60 
¡©s
[1] = 
diff
->
boŞ_diffs
->
num_»moved
;

61 
¡©s
[2] = 
diff
->
boŞ_diffs
->
num_modif›d
;

62 
¡©s
[3] = 0;

63 
¡©s
[4] = 0;

64 
	}
}

66 *
	$pŞdiff_boŞ_to_¡ršg
(cÚ¡ 
pŞdiff_t
 * 
diff
, cÚ¡ *
boŞ—n
)

68 
pŞdiff_boŞ_t
 *
b
 = (pŞdiff_boŞ_ˆ*è
boŞ—n
;

69 
size_t
 
Ën
 = 0;

70 *
s
 = 
NULL
;

71 ià(
diff
 =ğ
NULL
 || 
boŞ—n
 == NULL) {

72 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
EINVAL
));

73 
”ºo
 = 
EINVAL
;

74  
NULL
;

76 
b
->
fÜm
) {

77 
POLDIFF_FORM_ADDED
:

79 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "+ %s", 
b
->
Çme
) < 0) {

82  
s
;

84 
POLDIFF_FORM_REMOVED
:

86 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "- %s", 
b
->
Çme
) < 0) {

89  
s
;

91 
POLDIFF_FORM_MODIFIED
:

93 ià(
­Ş_¡r_­³ndf


94 (&
s
, &
Ën
, "* % (chªged from %s)", 
b
->
Çme
, (b->
¡©e
 ? "falseorue" : "trueo false")) < 0) {

97  
s
;

101 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
ENOTSUP
));

102 
”ºo
 = 
ENOTSUP
;

103  
NULL
;

106 
”ºo
 = 
ENOMEM
;

107  
NULL
;

108 
	}
}

110 cÚ¡ 
­Ş_veùÜ_t
 *
	$pŞdiff_g‘_boŞ_veùÜ
(cÚ¡ 
pŞdiff_t
 * 
diff
)

112 ià(
diff
 =ğ
NULL
) {

113 
”ºo
 = 
EINVAL
;

114  
NULL
;

116  
diff
->
boŞ_diffs
->
diffs
;

117 
	}
}

119 cÚ¡ *
	$pŞdiff_boŞ_g‘_Çme
(cÚ¡ 
pŞdiff_boŞ_t
 * 
boŞ—n
)

121 ià(
boŞ—n
 =ğ
NULL
) {

122 
”ºo
 = 
EINVAL
;

123  
NULL
;

125  
boŞ—n
->
Çme
;

126 
	}
}

128 
pŞdiff_fÜm_e
 
	$pŞdiff_boŞ_g‘_fÜm
(cÚ¡ *
boŞ—n
)

130 ià(
boŞ—n
 =ğ
NULL
) {

131 
”ºo
 = 
EINVAL
;

134  ((cÚ¡ 
pŞdiff_boŞ_t
 *)
boŞ—n
)->
fÜm
;

135 
	}
}

139 
	$boŞ_ä“
(*
–em
)

141 ià(
–em
 !ğ
NULL
) {

142 
pŞdiff_boŞ_t
 *
b
 = (pŞdiff_boŞ_ˆ*è
–em
;

143 
	`ä“
(
b
->
Çme
);

144 
	`ä“
(
b
);

146 
	}
}

148 
pŞdiff_boŞ_summ¬y_t
 *
	$boŞ_ü—‹
()

150 
pŞdiff_boŞ_summ¬y_t
 *
bs
 = 
	`ÿÎoc
(1, (*bs));

151 ià(
bs
 =ğ
NULL
) {

152  
NULL
;

154 ià((
bs
->
diffs
 = 
	`­Ş_veùÜ_ü—‹
(
boŞ_ä“
)è=ğ
NULL
) {

155 
	`boŞ_de¡roy
(&
bs
);

156  
NULL
;

158  
bs
;

159 
	}
}

161 
	$boŞ_de¡roy
(
pŞdiff_boŞ_summ¬y_t
 ** 
bs
)

163 ià(
bs
 !ğ
NULL
 && *bs != NULL) {

164 
	`­Ş_veùÜ_de¡roy
(&(*
bs
)->
diffs
);

165 
	`ä“
(*
bs
);

166 *
bs
 = 
NULL
;

168 
	}
}

170 
	$boŞ_»£t
(
pŞdiff_t
 * 
diff
)

172 
”rÜ
 = 0;

174 ià(
diff
 =ğ
NULL
) {

175 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
EINVAL
));

176 
”ºo
 = 
EINVAL
;

180 
	`boŞ_de¡roy
(&
diff
->
boŞ_diffs
);

181 
diff
->
boŞ_diffs
 = 
	`boŞ_ü—‹
();

182 ià(
diff
->
boŞ_diffs
 =ğ
NULL
) {

183 
”rÜ
 = 
”ºo
;

184 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

185 
”ºo
 = 
”rÜ
;

190 
	}
}

195 
	$boŞ_Çme_comp
(cÚ¡ *
x
, cÚ¡ *
y
, *
¬g
)

197 
qpŞ_boŞ_t
 *
c1
 = (qpŞ_boŞ_ˆ*è
x
;

198 
qpŞ_boŞ_t
 *
c2
 = (qpŞ_boŞ_ˆ*è
y
;

199 
­Ş_pŞicy_t
 *
p
 = (­Ş_pŞicy_ˆ*è
¬g
;

200 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
p
);

201 cÚ¡ *
Çme1
, *
Çme2
;

202 ià(
	`qpŞ_boŞ_g‘_Çme
(
q
, 
c1
, &
Çme1
è< 0 || qpŞ_boŞ_g‘_Çme(q, 
c2
, &
Çme2
) < 0) {

205  
	`¡rcmp
(
Çme1
, 
Çme2
);

206 
	}
}

208 
­Ş_veùÜ_t
 *
	$boŞ_g‘_™ems
(
pŞdiff_t
 * 
diff
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
)

210 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

211 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

212 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicy
);

213 
”rÜ
 = 0;

214 ià(
	`qpŞ_pŞicy_g‘_boŞ_™”
(
q
, &
™”
) < 0) {

215  
NULL
;

217 
v
 = 
	`­Ş_veùÜ_ü—‹_äom_™”
(
™”
, 
NULL
);

218 ià(
v
 =ğ
NULL
) {

219 
”rÜ
 = 
”ºo
;

220 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

221 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

222 
”ºo
 = 
”rÜ
;

223  
NULL
;

225 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

226 
	`­Ş_veùÜ_sÜt
(
v
, 
boŞ_Çme_comp
, (*)
pŞicy
);

227  
v
;

228 
	}
}

230 
	$boŞ_comp
(cÚ¡ *
x
, cÚ¡ *
y
, cÚ¡ 
pŞdiff_t
 * 
diff
)

232 
qpŞ_boŞ_t
 *
c1
 = (qpŞ_boŞ_ˆ*è
x
;

233 
qpŞ_boŞ_t
 *
c2
 = (qpŞ_boŞ_ˆ*è
y
;

234 cÚ¡ *
Çme1
, *
Çme2
;

235 ià(
	`qpŞ_boŞ_g‘_Çme
(
diff
->
Üig_qpŞ
, 
c1
, &
Çme1
è< 0 || qpŞ_boŞ_g‘_Çme(diff->
mod_qpŞ
, 
c2
, &
Çme2
) < 0) {

238  
	`¡rcmp
(
Çme1
, 
Çme2
);

239 
	}
}

252 
pŞdiff_boŞ_t
 *
	$make_diff
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
pŞdiff_fÜm_e
 
fÜm
, cÚ¡ *
Çme
)

254 
pŞdiff_boŞ_t
 *
pb
;

255 
”rÜ
;

256 ià((
pb
 = 
	`ÿÎoc
(1, (*pb))è=ğ
NULL
 || (pb->
Çme
 = 
	`¡rdup
(name)) == NULL) {

257 
”rÜ
 = 
”ºo
;

258 
	`boŞ_ä“
(
pb
);

259 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

260 
”ºo
 = 
”rÜ
;

261  
NULL
;

263 
pb
->
fÜm
 = form;

264  
pb
;

265 
	}
}

267 
	$boŞ_Ãw_diff
(
pŞdiff_t
 * 
diff
, 
pŞdiff_fÜm_e
 
fÜm
, cÚ¡ *
™em
)

269 
qpŞ_boŞ_t
 *
c
 = (qpŞ_boŞ_ˆ*è
™em
;

270 cÚ¡ *
Çme
 = 
NULL
;

271 
pŞdiff_boŞ_t
 *
pb
;

272 
”rÜ
;

273 ià((
fÜm
 =ğ
POLDIFF_FORM_ADDED
 &&

274 
	`qpŞ_boŞ_g‘_Çme
(
diff
->
mod_qpŞ
, 
c
, &
Çme
) < 0) ||

275 ((
fÜm
 =ğ
POLDIFF_FORM_REMOVED
 || fÜm =ğ
POLDIFF_FORM_MODIFIED
è&& 
	`qpŞ_boŞ_g‘_Çme
(
diff
->
Üig_qpŞ
, 
c
, &
Çme
) < 0))

279 
pb
 = 
	`make_diff
(
diff
, 
fÜm
, 
Çme
);

280 ià(
pb
 =ğ
NULL
) {

283 ià(
	`­Ş_veùÜ_­³nd
(
diff
->
boŞ_diffs
->
diffs
, 
pb
) < 0) {

284 
”rÜ
 = 
”ºo
;

285 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

286 
	`boŞ_ä“
(
pb
);

287 
”ºo
 = 
”rÜ
;

290 ià(
fÜm
 =ğ
POLDIFF_FORM_ADDED
)

291 
diff
->
boŞ_diffs
->
num_added
++;

293 
diff
->
boŞ_diffs
->
num_»moved
++;

295 
	}
}

297 
	$boŞ_d“p_diff
(
pŞdiff_t
 * 
diff
, cÚ¡ *
x
, cÚ¡ *
y
)

299 
qpŞ_boŞ_t
 *
b1
 = (qpŞ_boŞ_ˆ*è
x
;

300 
qpŞ_boŞ_t
 *
b2
 = (qpŞ_boŞ_ˆ*è
y
;

301 cÚ¡ *
Çme
;

302 
s1
, 
s2
;

303 
pŞdiff_boŞ_t
 *
b
 = 
NULL
;

304 
»tv®
 = -1, 
”rÜ
 = 0;

306 ià(
	`qpŞ_boŞ_g‘_Çme
(
diff
->
Üig_qpŞ
, 
b1
, &
Çme
) < 0 ||

307 
	`qpŞ_boŞ_g‘_¡©e
(
diff
->
Üig_qpŞ
, 
b1
, &
s1
è< 0 || qpŞ_boŞ_g‘_¡©e(diff->
mod_qpŞ
, 
b2
, &
s2
) < 0) {

308 
”rÜ
 = 
”ºo
;

309 
ş—nup
;

311 ià(
s1
 !ğ
s2
) {

312 ià((
b
 = 
	`make_diff
(
diff
, 
POLDIFF_FORM_MODIFIED
, 
Çme
)è=ğ
NULL
) {

313 
”rÜ
 = 
”ºo
;

314 
ş—nup
;

316 ià(
s2
)

317 
b
->
¡©e
 = 
Œue
;

319 
b
->
¡©e
 = 
çl£
;

321 ià(
b
 !ğ
NULL
) {

322 ià(
	`­Ş_veùÜ_­³nd
(
diff
->
boŞ_diffs
->
diffs
, 
b
) < 0) {

323 
”rÜ
 = 
”ºo
;

324 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

325 
ş—nup
;

327 
diff
->
boŞ_diffs
->
num_modif›d
++;

329 
»tv®
 = 0;

330 
ş—nup
:

331 
”ºo
 = 
”rÜ
;

332  
»tv®
;

333 
	}
}

	@libpoldiff/src/bool_internal.h

26 #iâdeà
POLDIFF_BOOL_INTERNAL_H


27 
	#POLDIFF_BOOL_INTERNAL_H


	)

29 #ifdef 
__ılu¥lus


34 
pŞdiff_boŞ_summ¬y
 
	tpŞdiff_boŞ_summ¬y_t
;

42 
pŞdiff_boŞ_summ¬y_t
 *
boŞ_ü—‹
();

52 
boŞ_de¡roy
(
pŞdiff_boŞ_summ¬y_t
 ** 
bs
);

61 
boŞ_»£t
(
pŞdiff_t
 * 
diff
);

73 
­Ş_veùÜ_t
 *
boŞ_g‘_™ems
(
pŞdiff_t
 * 
diff
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
);

87 
boŞ_comp
(cÚ¡ *
x
, cÚ¡ *
y
, cÚ¡ 
pŞdiff_t
 * 
diff
);

100 
boŞ_Ãw_diff
(
pŞdiff_t
 * 
diff
, 
pŞdiff_fÜm_e
 
fÜm
, cÚ¡ *
™em
);

116 
boŞ_d“p_diff
(
pŞdiff_t
 * 
diff
, cÚ¡ *
x
, cÚ¡ *
y
);

118 #ifdef 
__ılu¥lus


	@libpoldiff/src/cat_diff.c

25 
	~<cÚfig.h
>

27 
	~"pŞdiff_š‹º®.h
"

29 
	~<­Ş/ut.h
>

30 
	~<”ºo.h
>

31 
	~<¡dio.h
>

32 
	~<¡ršg.h
>

34 
	spŞdiff_ÿt_summ¬y


36 
size_t
 
	mnum_added
;

37 
size_t
 
	mnum_»moved
;

38 
­Ş_veùÜ_t
 *
	mdiffs
;

41 
	spŞdiff_ÿt


43 *
	mÇme
;

44 
pŞdiff_fÜm_e
 
	mfÜm
;

47 
	$pŞdiff_ÿt_g‘_¡©s
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
size_t
 
¡©s
[5])

49 ià(
diff
 =ğ
NULL
 || 
¡©s
 == NULL) {

50 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
EINVAL
));

51 
”ºo
 = 
EINVAL
;

54 
¡©s
[0] = 
diff
->
ÿt_diffs
->
num_added
;

55 
¡©s
[1] = 
diff
->
ÿt_diffs
->
num_»moved
;

56 
¡©s
[2] = 0;

57 
¡©s
[3] = 0;

58 
¡©s
[4] = 0;

59 
	}
}

61 cÚ¡ 
­Ş_veùÜ_t
 *
	$pŞdiff_g‘_ÿt_veùÜ
(cÚ¡ 
pŞdiff_t
 * 
diff
)

63 ià(
diff
 =ğ
NULL
) {

64 
”ºo
 = 
EINVAL
;

65  
NULL
;

67  
diff
->
ÿt_diffs
->
diffs
;

68 
	}
}

70 *
	$pŞdiff_ÿt_to_¡ršg
(cÚ¡ 
pŞdiff_t
 * 
diff
, cÚ¡ *
ÿt
)

72 
pŞdiff_ÿt_t
 *
c
 = (pŞdiff_ÿt_ˆ*è
ÿt
;

73 
size_t
 
Ën
 = 0;

74 *
s
 = 
NULL
;

75 ià(
diff
 =ğ
NULL
 || 
ÿt
 == NULL) {

76 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
EINVAL
));

77 
”ºo
 = 
EINVAL
;

78  
NULL
;

80 
c
->
fÜm
) {

81 
POLDIFF_FORM_ADDED
:

83 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "+ %s", 
c
->
Çme
) < 0) {

86  
s
;

88 
POLDIFF_FORM_REMOVED
:

90 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "- %s", 
c
->
Çme
) < 0) {

93  
s
;

95 
POLDIFF_FORM_MODIFIED
:

98 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
ENOTSUP
));

99 
”ºo
 = 
ENOTSUP
;

100  
NULL
;

103  
NULL
;

104 
	}
}

106 cÚ¡ *
	$pŞdiff_ÿt_g‘_Çme
(cÚ¡ 
pŞdiff_ÿt_t
 * 
ÿt
)

108 ià(
ÿt
 =ğ
NULL
) {

109 
”ºo
 = 
EINVAL
;

110  
NULL
;

113  
ÿt
->
Çme
;

114 
	}
}

116 
pŞdiff_fÜm_e
 
	$pŞdiff_ÿt_g‘_fÜm
(cÚ¡ *
ÿt
)

118 ià(
ÿt
 =ğ
NULL
) {

119 
”ºo
 = 
EINVAL
;

120  
POLDIFF_FORM_NONE
;

123  ((cÚ¡ 
pŞdiff_ÿt_t
 *)
ÿt
)->
fÜm
;

124 
	}
}

126 
	$ÿt_ä“
(*
–em
)

128 
pŞdiff_ÿt_t
 *
s
 = 
–em
;

129 ià(!
–em
)

131 
	`ä“
(
s
->
Çme
);

132 
	`ä“
(
s
);

133 
	}
}

135 
pŞdiff_ÿt_summ¬y_t
 *
	$ÿt_ü—‹
()

137 
pŞdiff_ÿt_summ¬y_t
 *
cs
 = 
	`ÿÎoc
(1, (poldiff_cat_summary_t));

138 ià(
cs
 =ğ
NULL
)

139  
NULL
;

140 ià((
cs
->
diffs
 = 
	`­Ş_veùÜ_ü—‹
(
ÿt_ä“
)è=ğ
NULL
) {

141 
	`ÿt_de¡roy
(&
cs
);

142  
NULL
;

144  
cs
;

145 
	}
}

147 
	$ÿt_de¡roy
(
pŞdiff_ÿt_summ¬y_t
 ** 
cs
)

149 ià(
cs
 =ğ
NULL
 || *cs == NULL)

151 
	`­Ş_veùÜ_de¡roy
(&(*
cs
)->
diffs
);

152 
	`ä“
(*
cs
);

153 *
cs
 = 
NULL
;

154 
	}
}

156 
	$ÿt_»£t
(
pŞdiff_t
 * 
diff
)

158 
”rÜ
 = 0;

160 ià(
diff
 =ğ
NULL
) {

161 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
EINVAL
));

162 
”ºo
 = 
EINVAL
;

166 
	`ÿt_de¡roy
(&
diff
->
ÿt_diffs
);

167 
diff
->
ÿt_diffs
 = 
	`ÿt_ü—‹
();

168 ià(
diff
->
ÿt_diffs
 =ğ
NULL
) {

169 
”rÜ
 = 
”ºo
;

170 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

171 
”ºo
 = 
”rÜ
;

176 
	}
}

181 
	$ÿt_Çme_comp
(cÚ¡ *
x
, cÚ¡ *
y
, *
¬g
)

183 cÚ¡ 
qpŞ_ÿt_t
 *
c1
 = 
x
;

184 cÚ¡ 
qpŞ_ÿt_t
 *
c2
 = 
y
;

185 
­Ş_pŞicy_t
 *
p
 = 
¬g
;

186 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
p
);

187 cÚ¡ *
Çme1
, *
Çme2
;

189 ià(
	`qpŞ_ÿt_g‘_Çme
(
q
, 
c1
, &
Çme1
è< 0 || qpŞ_ÿt_g‘_Çme(q, 
c2
, &
Çme2
) < 0)

191  
	`¡rcmp
(
Çme1
, 
Çme2
);

192 
	}
}

194 
­Ş_veùÜ_t
 *
	$ÿt_g‘_™ems
(
pŞdiff_t
 * 
diff
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
)

196 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

197 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

198 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicy
);

199 
”rÜ
 = 0;

200 ià(
	`qpŞ_pŞicy_g‘_ÿt_™”
(
q
, &
™”
) < 0) {

201  
NULL
;

203 
v
 = 
	`­Ş_veùÜ_ü—‹_äom_™”
(
™”
, 
NULL
);

204 ià(
v
 =ğ
NULL
) {

205 
”rÜ
 = 
”ºo
;

206 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

207 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

208 
”ºo
 = 
”rÜ
;

209  
NULL
;

211 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

212 
	`­Ş_veùÜ_sÜt
(
v
, 
ÿt_Çme_comp
, (*)
pŞicy
);

213  
v
;

214 
	}
}

216 
	$ÿt_comp
(cÚ¡ *
x
, cÚ¡ *
y
, cÚ¡ 
pŞdiff_t
 * 
diff
)

218 cÚ¡ 
qpŞ_ÿt_t
 *
c1
 = 
x
;

219 cÚ¡ 
qpŞ_ÿt_t
 *
c2
 = 
y
;

220 cÚ¡ *
Çme1
, *
Çme2
;

221 ià(
	`qpŞ_ÿt_g‘_Çme
(
diff
->
Üig_qpŞ
, 
c1
, &
Çme1
è< 0 || qpŞ_ÿt_g‘_Çme(diff->
mod_qpŞ
, 
c2
, &
Çme2
) < 0) {

224  
	`¡rcmp
(
Çme1
, 
Çme2
);

225 
	}
}

238 
pŞdiff_ÿt_t
 *
	$make_diff
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
pŞdiff_fÜm_e
 
fÜm
, cÚ¡ *
Çme
)

240 
pŞdiff_ÿt_t
 *
¶
;

241 
”rÜ
;

242 ià((
¶
 = 
	`ÿÎoc
(1, (*¶))è=ğ
NULL
 || (¶->
Çme
 = 
	`¡rdup
(name)) == NULL) {

243 
”rÜ
 = 
”ºo
;

244 
	`ÿt_ä“
(
¶
);

245 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

246 
”ºo
 = 
”rÜ
;

247  
NULL
;

249 
¶
->
fÜm
 = form;

250  
¶
;

251 
	}
}

253 
	$ÿt_Ãw_diff
(
pŞdiff_t
 * 
diff
, 
pŞdiff_fÜm_e
 
fÜm
, cÚ¡ *
™em
)

255 cÚ¡ 
qpŞ_ÿt_t
 *
c
 = 
™em
;

256 cÚ¡ *
Çme
 = 
NULL
;

257 
pŞdiff_ÿt_t
 *
¶
;

258 
”rÜ
;

259 ià((
fÜm
 =ğ
POLDIFF_FORM_ADDED
 &&

260 
	`qpŞ_ÿt_g‘_Çme
(
diff
->
mod_qpŞ
, 
c
, &
Çme
) < 0) ||

261 ((
fÜm
 =ğ
POLDIFF_FORM_REMOVED
 || fÜm =ğ
POLDIFF_FORM_MODIFIED
è&& 
	`qpŞ_ÿt_g‘_Çme
(
diff
->
Üig_qpŞ
, 
c
, &
Çme
) < 0)) {

264 
¶
 = 
	`make_diff
(
diff
, 
fÜm
, 
Çme
);

265 ià(
¶
 =ğ
NULL
) {

268 ià(
	`­Ş_veùÜ_­³nd
(
diff
->
ÿt_diffs
->
diffs
, 
¶
) < 0) {

269 
”rÜ
 = 
”ºo
;

270 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

271 
	`ÿt_ä“
(
¶
);

272 
”ºo
 = 
”rÜ
;

275 ià(
fÜm
 =ğ
POLDIFF_FORM_ADDED
) {

276 
diff
->
ÿt_diffs
->
num_added
++;

278 
diff
->
ÿt_diffs
->
num_»moved
++;

281 
	}
}

283 
ÿt_d“p_diff
(
pŞdiff_t
 * 
diff
 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ *
x
 __©Œibu‹__ ((unu£d)), cÚ¡ *
y


284 
__©Œibu‹__
 ((
unu£d
)))

	@libpoldiff/src/cat_internal.h

26 #iâdeà
POLDIFF_CAT_INTERNAL_H


27 
	#POLDIFF_CAT_INTERNAL_H


	)

29 #ifdef 
__ılu¥lus


34 
pŞdiff_ÿt_summ¬y
 
	tpŞdiff_ÿt_summ¬y_t
;

42 
pŞdiff_ÿt_summ¬y_t
 *
ÿt_ü—‹
();

52 
ÿt_de¡roy
(
pŞdiff_ÿt_summ¬y_t
 ** 
cs
);

61 
ÿt_»£t
(
pŞdiff_t
 * 
diff
);

73 
­Ş_veùÜ_t
 *
ÿt_g‘_™ems
(
pŞdiff_t
 * 
diff
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
);

87 
ÿt_comp
(cÚ¡ *
x
, cÚ¡ *
y
, cÚ¡ 
pŞdiff_t
 * 
diff
);

100 
ÿt_Ãw_diff
(
pŞdiff_t
 * 
diff
, 
pŞdiff_fÜm_e
 
fÜm
, cÚ¡ *
™em
);

114 
ÿt_d“p_diff
(
pŞdiff_t
 * 
diff
, cÚ¡ *
x
, cÚ¡ *
y
);

116 #ifdef 
__ılu¥lus


	@libpoldiff/src/class_diff.c

26 
	~<cÚfig.h
>

28 
	~"pŞdiff_š‹º®.h
"

30 
	~<­Ş/ut.h
>

31 
	~<”ºo.h
>

32 
	~<¡dio.h
>

33 
	~<¡ršg.h
>

37 
	spŞdiff_şass_summ¬y


39 
size_t
 
	mnum_added
;

40 
size_t
 
	mnum_»moved
;

41 
size_t
 
	mnum_modif›d
;

42 
­Ş_veùÜ_t
 *
	mdiffs
;

45 
	spŞdiff_şass


47 *
	mÇme
;

48 
pŞdiff_fÜm_e
 
	mfÜm
;

49 
­Ş_veùÜ_t
 *
	madded_³rms
;

50 
­Ş_veùÜ_t
 *
	m»moved_³rms
;

53 
	$pŞdiff_şass_g‘_¡©s
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
size_t
 
¡©s
[5])

55 ià(
diff
 =ğ
NULL
 || 
¡©s
 == NULL) {

56 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
EINVAL
));

57 
”ºo
 = 
EINVAL
;

60 
¡©s
[0] = 
diff
->
şass_diffs
->
num_added
;

61 
¡©s
[1] = 
diff
->
şass_diffs
->
num_»moved
;

62 
¡©s
[2] = 
diff
->
şass_diffs
->
num_modif›d
;

63 
¡©s
[3] = 0;

64 
¡©s
[4] = 0;

65 
	}
}

67 *
	$pŞdiff_şass_to_¡ršg
(cÚ¡ 
pŞdiff_t
 * 
diff
, cÚ¡ *
şs
)

69 
pŞdiff_şass_t
 *
c
 = (pŞdiff_şass_ˆ*è
şs
;

70 
size_t
 
num_added
, 
num_»moved
, 
Ën
 = 0, 
i
;

71 *
s
 = 
NULL
, *
³rm
;

72 ià(
diff
 =ğ
NULL
 || 
şs
 == NULL) {

73 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
EINVAL
));

74 
”ºo
 = 
EINVAL
;

75  
NULL
;

77 
num_added
 = 
	`­Ş_veùÜ_g‘_size
(
c
->
added_³rms
);

78 
num_»moved
 = 
	`­Ş_veùÜ_g‘_size
(
c
->
»moved_³rms
);

79 
c
->
fÜm
) {

80 
POLDIFF_FORM_ADDED
:

82 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "+ %s", 
c
->
Çme
) < 0) {

85  
s
;

87 
POLDIFF_FORM_REMOVED
:

89 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "- %s", 
c
->
Çme
) < 0) {

92  
s
;

94 
POLDIFF_FORM_MODIFIED
:

96 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "* % (", 
c
->
Çme
) < 0) {

97 
s
 = 
NULL
;

100 ià(
num_added
 > 0) {

101 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "%zd Added P”missiÚ%s", 
num_added
, (num_added == 1 ? "" : "s")) < 0) {

105 ià(
num_»moved
 > 0) {

106 ià(
­Ş_¡r_­³ndf


107 (&
s
, &
Ën
, "%s%zd Removed P”missiÚ%s", (
num_added
 > 0 ? ", " : ""), 
num_»moved
,

108 (
num_»moved
 == 1 ? "" : "s")) < 0) {

112 ià(
	`­Ş_¡r_­³nd
(&
s
, &
Ën
, ")\n") < 0) {

115 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
c
->
added_³rms
); i++) {

116 
³rm
 = (*)
	`­Ş_veùÜ_g‘_–em’t
(
c
->
added_³rms
, 
i
);

117 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "\t+ %s\n", 
³rm
) < 0) {

118 
”r
;

121 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
c
->
»moved_³rms
); i++) {

122 
³rm
 = (*)
	`­Ş_veùÜ_g‘_–em’t
(
c
->
»moved_³rms
, 
i
);

123 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "\t- %s\n", 
³rm
) < 0) {

124 
”r
;

127  
s
;

131 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
ENOTSUP
));

132 
”ºo
 = 
ENOTSUP
;

133  
NULL
;

136 
”r
:

138 
	`ä“
(
s
);

139 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

140 
”ºo
 = 
ENOMEM
;

141  
NULL
;

142 
	}
}

144 cÚ¡ 
­Ş_veùÜ_t
 *
	$pŞdiff_g‘_şass_veùÜ
(cÚ¡ 
pŞdiff_t
 * 
diff
)

146 ià(
diff
 =ğ
NULL
) {

147 
”ºo
 = 
EINVAL
;

148  
NULL
;

150  
diff
->
şass_diffs
->
diffs
;

151 
	}
}

153 cÚ¡ *
	$pŞdiff_şass_g‘_Çme
(cÚ¡ 
pŞdiff_şass_t
 * 
şs
)

155 ià(
şs
 =ğ
NULL
) {

156 
”ºo
 = 
EINVAL
;

157  
NULL
;

159  
şs
->
Çme
;

160 
	}
}

162 
pŞdiff_fÜm_e
 
	$pŞdiff_şass_g‘_fÜm
(cÚ¡ *
şs
)

164 ià(
şs
 =ğ
NULL
) {

165 
”ºo
 = 
EINVAL
;

168  ((cÚ¡ 
pŞdiff_şass_t
 *)
şs
)->
fÜm
;

169 
	}
}

171 cÚ¡ 
­Ş_veùÜ_t
 *
	$pŞdiff_şass_g‘_added_³rms
(cÚ¡ 
pŞdiff_şass_t
 * 
şs
)

173 ià(
şs
 =ğ
NULL
) {

174 
”ºo
 = 
EINVAL
;

175  
NULL
;

177  
şs
->
added_³rms
;

178 
	}
}

180 cÚ¡ 
­Ş_veùÜ_t
 *
	$pŞdiff_şass_g‘_»moved_³rms
(cÚ¡ 
pŞdiff_şass_t
 * 
şs
)

182 ià(
şs
 =ğ
NULL
) {

183 
”ºo
 = 
EINVAL
;

184  
NULL
;

186  
şs
->
»moved_³rms
;

187 
	}
}

191 
	$şass_ä“
(*
–em
)

193 ià(
–em
 !ğ
NULL
) {

194 
pŞdiff_şass_t
 *
c
 = (pŞdiff_şass_ˆ*è
–em
;

195 
	`ä“
(
c
->
Çme
);

196 
	`­Ş_veùÜ_de¡roy
(&
c
->
added_³rms
);

197 
	`­Ş_veùÜ_de¡roy
(&
c
->
»moved_³rms
);

198 
	`ä“
(
c
);

200 
	}
}

202 
pŞdiff_şass_summ¬y_t
 *
	$şass_ü—‹
()

204 
pŞdiff_şass_summ¬y_t
 *
cs
 = 
	`ÿÎoc
(1, (*cs));

205 ià(
cs
 =ğ
NULL
) {

206  
NULL
;

208 ià((
cs
->
diffs
 = 
	`­Ş_veùÜ_ü—‹
(
şass_ä“
)è=ğ
NULL
) {

209 
	`şass_de¡roy
(&
cs
);

210  
NULL
;

212  
cs
;

213 
	}
}

215 
	$şass_de¡roy
(
pŞdiff_şass_summ¬y_t
 ** 
cs
)

217 ià(
cs
 !ğ
NULL
 && *cs != NULL) {

218 
	`­Ş_veùÜ_de¡roy
(&(*
cs
)->
diffs
);

219 
	`ä“
(*
cs
);

220 *
cs
 = 
NULL
;

222 
	}
}

224 
	$şass_»£t
(
pŞdiff_t
 * 
diff
)

226 
”rÜ
 = 0;

228 ià(
diff
 =ğ
NULL
) {

229 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
EINVAL
));

230 
”ºo
 = 
EINVAL
;

234 
	`şass_de¡roy
(&
diff
->
şass_diffs
);

235 
diff
->
şass_diffs
 = 
	`şass_ü—‹
();

236 ià(
diff
->
şass_diffs
 =ğ
NULL
) {

237 
”rÜ
 = 
”ºo
;

238 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

239 
”ºo
 = 
”rÜ
;

244 
	}
}

249 
	$şass_Çme_comp
(cÚ¡ *
x
, cÚ¡ *
y
, *
¬g
)

251 cÚ¡ 
qpŞ_şass_t
 *
c1
 = 
x
;

252 cÚ¡ 
qpŞ_şass_t
 *
c2
 = 
y
;

253 
­Ş_pŞicy_t
 *
p
 = (­Ş_pŞicy_ˆ*è
¬g
;

254 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
p
);

255 cÚ¡ *
Çme1
, *
Çme2
;

256 ià(
	`qpŞ_şass_g‘_Çme
(
q
, 
c1
, &
Çme1
è< 0 || qpŞ_şass_g‘_Çme(q, 
c2
, &
Çme2
) < 0) {

259  
	`¡rcmp
(
Çme1
, 
Çme2
);

260 
	}
}

262 
­Ş_veùÜ_t
 *
	$şass_g‘_™ems
(
pŞdiff_t
 * 
diff
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
)

264 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

265 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

266 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicy
);

267 
”rÜ
 = 0;

268 ià(
	`qpŞ_pŞicy_g‘_şass_™”
(
q
, &
™”
) < 0) {

269  
NULL
;

271 
v
 = 
	`­Ş_veùÜ_ü—‹_äom_™”
(
™”
, 
NULL
);

272 ià(
v
 =ğ
NULL
) {

273 
”rÜ
 = 
”ºo
;

274 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

275 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

276 
”ºo
 = 
”rÜ
;

277  
NULL
;

279 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

280 
	`­Ş_veùÜ_sÜt
(
v
, 
şass_Çme_comp
, (*)
pŞicy
);

281  
v
;

282 
	}
}

284 
	$şass_comp
(cÚ¡ *
x
, cÚ¡ *
y
, cÚ¡ 
pŞdiff_t
 * 
diff
)

286 cÚ¡ 
qpŞ_şass_t
 *
c1
 = 
x
;

287 cÚ¡ 
qpŞ_şass_t
 *
c2
 = 
y
;

288 cÚ¡ *
Çme1
, *
Çme2
;

289 ià(
	`qpŞ_şass_g‘_Çme
(
diff
->
Üig_qpŞ
, 
c1
, &
Çme1
è< 0 || qpŞ_şass_g‘_Çme(diff->
mod_qpŞ
, 
c2
, &
Çme2
) < 0) {

292  
	`¡rcmp
(
Çme1
, 
Çme2
);

293 
	}
}

306 
pŞdiff_şass_t
 *
	$make_diff
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
pŞdiff_fÜm_e
 
fÜm
, cÚ¡ *
Çme
)

308 
pŞdiff_şass_t
 *
pc
;

309 
”rÜ
;

310 ià((
pc
 = 
	`ÿÎoc
(1, (*pc))è=ğ
NULL
 ||

311 (
pc
->
Çme
 = 
	`¡rdup
Òame)è=ğ
NULL
 ||

312 (
pc
->
added_³rms
 = 
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(1, 
ä“
)è=ğ
NULL
 ||

313 (
pc
->
»moved_³rms
 = 
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(1, 
ä“
)è=ğ
NULL
) {

314 
”rÜ
 = 
”ºo
;

315 
	`şass_ä“
(
pc
);

316 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

317 
”ºo
 = 
”rÜ
;

318  
NULL
;

320 
pc
->
fÜm
 = form;

321  
pc
;

322 
	}
}

324 
	$şass_Ãw_diff
(
pŞdiff_t
 * 
diff
, 
pŞdiff_fÜm_e
 
fÜm
, cÚ¡ *
™em
)

326 cÚ¡ 
qpŞ_şass_t
 *
c
 = 
™em
;

327 cÚ¡ *
Çme
 = 
NULL
;

328 
pŞdiff_şass_t
 *
pc
;

329 
”rÜ
;

330 ià((
fÜm
 =ğ
POLDIFF_FORM_ADDED
 &&

331 
	`qpŞ_şass_g‘_Çme
(
diff
->
mod_qpŞ
, 
c
, &
Çme
) < 0) ||

332 ((
fÜm
 =ğ
POLDIFF_FORM_REMOVED
 || fÜm =ğ
POLDIFF_FORM_MODIFIED
è&& 
	`qpŞ_şass_g‘_Çme
(
diff
->
Üig_qpŞ
, 
c
, &
Çme
) < 0))

336 
pc
 = 
	`make_diff
(
diff
, 
fÜm
, 
Çme
);

337 ià(
pc
 =ğ
NULL
) {

340 ià(
	`­Ş_veùÜ_­³nd
(
diff
->
şass_diffs
->
diffs
, 
pc
) < 0) {

341 
”rÜ
 = 
”ºo
;

342 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

343 
	`şass_ä“
(
pc
);

344 
”ºo
 = 
”rÜ
;

347 ià(
fÜm
 =ğ
POLDIFF_FORM_ADDED
) {

348 
diff
->
şass_diffs
->
num_added
++;

350 
diff
->
şass_diffs
->
num_»moved
++;

353 
	}
}

368 
­Ş_veùÜ_t
 *
	$şass_g‘_³rms
(cÚ¡ 
pŞdiff_t
 * 
diff
, cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
qpŞ_şass_t
 * 
şass
)

370 cÚ¡ 
qpŞ_commÚ_t
 *
commÚ
;

371 
qpŞ_™”©Ü_t
 *
³rm_™”
 = 
NULL
, *
commÚ_™”
 = NULL;

372 *
³rm
;

373 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

374 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
p
);

375 
»tv®
 = -1;

377 ià((
v
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)) == NULL) {

378 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”ºo
));

379 
ş—nup
;

381 ià(
	`qpŞ_şass_g‘_commÚ
(
q
, 
şass
, &
commÚ
è< 0 || 
	`qpŞ_şass_g‘_³rm_™”
(q, cÏss, &
³rm_™”
) < 0) {

382 
ş—nup
;

384 ; !
	`qpŞ_™”©Ü_’d
(
³rm_™”
); 
	`qpŞ_™”©Ü_Ãxt
(perm_iter)) {

385 ià(
	`qpŞ_™”©Ü_g‘_™em
(
³rm_™”
, (**)&
³rm
) < 0) {

386 
ş—nup
;

388 ià(
	`­Ş_veùÜ_­³nd
(
v
, 
³rm
) < 0) {

389 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”ºo
));

390 
ş—nup
;

393 ià(
commÚ
 !ğ
NULL
) {

394 ià(
	`qpŞ_commÚ_g‘_³rm_™”
(
q
, 
commÚ
, &
commÚ_™”
) < 0) {

395 
ş—nup
;

397 ; !
	`qpŞ_™”©Ü_’d
(
commÚ_™”
); 
	`qpŞ_™”©Ü_Ãxt
(common_iter)) {

398 ià(
	`qpŞ_™”©Ü_g‘_™em
(
commÚ_™”
, (**)&
³rm
) < 0) {

399 
ş—nup
;

401 ià(
	`­Ş_veùÜ_­³nd
(
v
, 
³rm
) < 0) {

402 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”ºo
));

403 
ş—nup
;

408 
»tv®
 = 0;

409 
ş—nup
:

410 
	`qpŞ_™”©Ü_de¡roy
(&
³rm_™”
);

411 
	`qpŞ_™”©Ü_de¡roy
(&
commÚ_™”
);

412 ià(
»tv®
 < 0) {

413 
	`­Ş_veùÜ_de¡roy
(&
v
);

414  
NULL
;

416  
v
;

417 
	}
}

419 
	$şass_d“p_diff
(
pŞdiff_t
 * 
diff
, cÚ¡ *
x
, cÚ¡ *
y
)

421 cÚ¡ 
qpŞ_şass_t
 *
c1
 = 
x
;

422 cÚ¡ 
qpŞ_şass_t
 *
c2
 = 
y
;

423 
­Ş_veùÜ_t
 *
v1
 = 
NULL
, *
v2
 = NULL;

424 *
³rm1
 = 
NULL
, *
³rm2
 = NULL;

425 cÚ¡ *
Çme
;

426 
pŞdiff_şass_t
 *
c
 = 
NULL
;

427 
size_t
 
i
, 
j
;

428 
»tv®
 = -1, 
”rÜ
 = 0, 
compv®
;

430 ià(
	`qpŞ_şass_g‘_Çme
(
diff
->
Üig_qpŞ
, 
c1
, &
Çme
) < 0 ||

431 (
v1
 = 
	`şass_g‘_³rms
(
diff
, diff->
Üig_pŞ
, 
c1
)è=ğ
NULL
 || (
v2
 = cÏss_g‘_³rms(diff, diff->
mod_pŞ
, 
c2
)) == NULL) {

432 
”rÜ
 = 
”ºo
;

433 
ş—nup
;

435 
	`­Ş_veùÜ_sÜt
(
v1
, 
­Ş_¡r_¡rcmp
, 
NULL
);

436 
	`­Ş_veùÜ_sÜt
(
v2
, 
­Ş_¡r_¡rcmp
, 
NULL
);

437 
i
 = 
j
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v1
);) {

438 ià(
j
 >ğ
	`­Ş_veùÜ_g‘_size
(
v2
))

440 
³rm1
 = (*)
	`­Ş_veùÜ_g‘_–em’t
(
v1
, 
i
);

441 
³rm2
 = (*)
	`­Ş_veùÜ_g‘_–em’t
(
v2
, 
j
);

442 
compv®
 = 
	`¡rcmp
(
³rm1
, 
³rm2
);

443 ià(
compv®
 !ğ0 && 
c
 =ğ
NULL
) {

444 ià((
c
 = 
	`make_diff
(
diff
, 
POLDIFF_FORM_MODIFIED
, 
Çme
)è=ğ
NULL
) {

445 
”rÜ
 = 
”ºo
;

446 
ş—nup
;

449 ià(
compv®
 < 0) {

450 ià((
³rm1
 = 
	`¡rdup
Õ”m1)è=ğ
NULL
 || 
	`­Ş_veùÜ_­³nd
(
c
->
»moved_³rms
,…erm1) < 0) {

451 
”rÜ
 = 
”ºo
;

452 
	`ä“
(
³rm1
);

453 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

454 
ş—nup
;

456 
i
++;

457 } ià(
compv®
 > 0) {

458 ià((
³rm2
 = 
	`¡rdup
Õ”m2)è=ğ
NULL
 || 
	`­Ş_veùÜ_­³nd
(
c
->
added_³rms
,…erm2) < 0) {

459 
”rÜ
 = 
”ºo
;

460 
	`ä“
(
³rm2
);

461 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

462 
ş—nup
;

464 
j
++;

466 
i
++;

467 
j
++;

470 ; 
i
 < 
	`­Ş_veùÜ_g‘_size
(
v1
); i++) {

471 
³rm1
 = (*)
	`­Ş_veùÜ_g‘_–em’t
(
v1
, 
i
);

472 ià(
c
 =ğ
NULL
) {

473 ià((
c
 = 
	`make_diff
(
diff
, 
POLDIFF_FORM_MODIFIED
, 
Çme
)è=ğ
NULL
) {

474 
”rÜ
 = 
”ºo
;

475 
ş—nup
;

478 ià((
³rm1
 = 
	`¡rdup
Õ”m1)è=ğ
NULL
 || 
	`­Ş_veùÜ_­³nd
(
c
->
»moved_³rms
,…erm1) < 0) {

479 
”rÜ
 = 
”ºo
;

480 
	`ä“
(
³rm1
);

481 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

482 
ş—nup
;

485 ; 
j
 < 
	`­Ş_veùÜ_g‘_size
(
v2
); j++) {

486 
³rm2
 = (*)
	`­Ş_veùÜ_g‘_–em’t
(
v2
, 
j
);

487 ià(
c
 =ğ
NULL
) {

488 ià((
c
 = 
	`make_diff
(
diff
, 
POLDIFF_FORM_MODIFIED
, 
Çme
)è=ğ
NULL
) {

489 
”rÜ
 = 
”ºo
;

490 
ş—nup
;

493 ià((
³rm2
 = 
	`¡rdup
Õ”m2)è=ğ
NULL
 || 
	`­Ş_veùÜ_­³nd
(
c
->
added_³rms
,…erm2) < 0) {

494 
”rÜ
 = 
”ºo
;

495 
	`ä“
(
³rm2
);

496 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

497 
ş—nup
;

500 ià(
c
 !ğ
NULL
) {

501 
	`­Ş_veùÜ_sÜt
(
c
->
»moved_³rms
, 
­Ş_¡r_¡rcmp
, 
NULL
);

502 
	`­Ş_veùÜ_sÜt
(
c
->
added_³rms
, 
­Ş_¡r_¡rcmp
, 
NULL
);

503 ià(
	`­Ş_veùÜ_­³nd
(
diff
->
şass_diffs
->
diffs
, 
c
) < 0) {

504 
”rÜ
 = 
”ºo
;

505 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

506 
ş—nup
;

508 
diff
->
şass_diffs
->
num_modif›d
++;

510 
»tv®
 = 0;

511 
ş—nup
:

512 
	`­Ş_veùÜ_de¡roy
(&
v1
);

513 
	`­Ş_veùÜ_de¡roy
(&
v2
);

514 ià(
»tv®
 != 0) {

515 
	`şass_ä“
(
c
);

517 
”ºo
 = 
”rÜ
;

518  
»tv®
;

519 
	}
}

523 
	spŞdiff_commÚ_summ¬y


525 
size_t
 
	mnum_added
;

526 
size_t
 
	mnum_»moved
;

527 
size_t
 
	mnum_modif›d
;

528 
­Ş_veùÜ_t
 *
	mdiffs
;

531 
	spŞdiff_commÚ


533 *
	mÇme
;

534 
pŞdiff_fÜm_e
 
	mfÜm
;

535 
­Ş_veùÜ_t
 *
	madded_³rms
;

536 
­Ş_veùÜ_t
 *
	m»moved_³rms
;

539 
	$pŞdiff_commÚ_g‘_¡©s
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
size_t
 
¡©s
[5])

541 ià(
diff
 =ğ
NULL
 || 
¡©s
 == NULL) {

542 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
EINVAL
));

543 
”ºo
 = 
EINVAL
;

546 
¡©s
[0] = 
diff
->
commÚ_diffs
->
num_added
;

547 
¡©s
[1] = 
diff
->
commÚ_diffs
->
num_»moved
;

548 
¡©s
[2] = 
diff
->
commÚ_diffs
->
num_modif›d
;

549 
¡©s
[3] = 0;

550 
¡©s
[4] = 0;

551 
	}
}

553 *
	$pŞdiff_commÚ_to_¡ršg
(cÚ¡ 
pŞdiff_t
 * 
diff
, cÚ¡ *
şs
)

555 
pŞdiff_commÚ_t
 *
c
 = (pŞdiff_commÚ_ˆ*è
şs
;

556 
size_t
 
num_added
, 
num_»moved
, 
Ën
 = 0, 
i
;

557 *
s
 = 
NULL
, *
³rm
;

558 ià(
diff
 =ğ
NULL
 || 
şs
 == NULL) {

559 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
EINVAL
));

560 
”ºo
 = 
EINVAL
;

561  
NULL
;

563 
num_added
 = 
	`­Ş_veùÜ_g‘_size
(
c
->
added_³rms
);

564 
num_»moved
 = 
	`­Ş_veùÜ_g‘_size
(
c
->
»moved_³rms
);

565 
c
->
fÜm
) {

566 
POLDIFF_FORM_ADDED
:

568 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "+ %s", 
c
->
Çme
) < 0) {

569 
s
 = 
NULL
;

572  
s
;

574 
POLDIFF_FORM_REMOVED
:

576 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "- %s", 
c
->
Çme
) < 0) {

577 
s
 = 
NULL
;

580  
s
;

582 
POLDIFF_FORM_MODIFIED
:

584 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "* % (", 
c
->
Çme
) < 0) {

585 
s
 = 
NULL
;

588 ià(
num_added
 > 0) {

589 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "%zd Added P”missiÚ%s", 
num_added
, (num_added == 1 ? "" : "s")) < 0) {

593 ià(
num_»moved
 > 0) {

594 ià(
­Ş_¡r_­³ndf


595 (&
s
, &
Ën
, "%s%zd Removed P”missiÚ%s", (
num_added
 > 0 ? ", " : ""), 
num_»moved
,

596 (
num_»moved
 == 1 ? "" : "s")) < 0) {

600 ià(
	`­Ş_¡r_­³nd
(&
s
, &
Ën
, ")\n") < 0) {

603 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
c
->
added_³rms
); i++) {

604 
³rm
 = (*)
	`­Ş_veùÜ_g‘_–em’t
(
c
->
added_³rms
, 
i
);

605 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "\t+ %s\n", 
³rm
) < 0) {

606 
”r
;

609 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
c
->
»moved_³rms
); i++) {

610 
³rm
 = (*)
	`­Ş_veùÜ_g‘_–em’t
(
c
->
»moved_³rms
, 
i
);

611 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "\t- %s\n", 
³rm
) < 0) {

612 
”r
;

615  
s
;

619 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
ENOTSUP
));

620 
”ºo
 = 
ENOTSUP
;

621  
NULL
;

624 
”r
:

626 
	`ä“
(
s
);

627 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

628 
”ºo
 = 
ENOMEM
;

629  
NULL
;

630 
	}
}

632 cÚ¡ 
­Ş_veùÜ_t
 *
	$pŞdiff_g‘_commÚ_veùÜ
(cÚ¡ 
pŞdiff_t
 * 
diff
)

634 ià(
diff
 =ğ
NULL
) {

635 
”ºo
 = 
EINVAL
;

636  
NULL
;

638  
diff
->
commÚ_diffs
->
diffs
;

639 
	}
}

641 cÚ¡ *
	$pŞdiff_commÚ_g‘_Çme
(cÚ¡ 
pŞdiff_commÚ_t
 * 
şs
)

643 ià(
şs
 =ğ
NULL
) {

644 
”ºo
 = 
EINVAL
;

645  
NULL
;

647  
şs
->
Çme
;

648 
	}
}

650 
pŞdiff_fÜm_e
 
	$pŞdiff_commÚ_g‘_fÜm
(cÚ¡ *
şs
)

652 ià(
şs
 =ğ
NULL
) {

653 
”ºo
 = 
EINVAL
;

656  ((cÚ¡ 
pŞdiff_commÚ_t
 *)
şs
)->
fÜm
;

657 
	}
}

659 cÚ¡ 
­Ş_veùÜ_t
 *
	$pŞdiff_commÚ_g‘_added_³rms
(cÚ¡ 
pŞdiff_commÚ_t
 * 
şs
)

661 ià(
şs
 =ğ
NULL
) {

662 
”ºo
 = 
EINVAL
;

663  
NULL
;

665  
şs
->
added_³rms
;

666 
	}
}

668 cÚ¡ 
­Ş_veùÜ_t
 *
	$pŞdiff_commÚ_g‘_»moved_³rms
(cÚ¡ 
pŞdiff_commÚ_t
 * 
şs
)

670 ià(
şs
 =ğ
NULL
) {

671 
”ºo
 = 
EINVAL
;

672  
NULL
;

674  
şs
->
»moved_³rms
;

675 
	}
}

679 
	$commÚ_ä“
(*
–em
)

681 ià(
–em
 !ğ
NULL
) {

682 
pŞdiff_commÚ_t
 *
c
 = (pŞdiff_commÚ_ˆ*è
–em
;

683 
	`ä“
(
c
->
Çme
);

684 
	`­Ş_veùÜ_de¡roy
(&
c
->
added_³rms
);

685 
	`­Ş_veùÜ_de¡roy
(&
c
->
»moved_³rms
);

686 
	`ä“
(
c
);

688 
	}
}

690 
pŞdiff_commÚ_summ¬y_t
 *
	$commÚ_ü—‹
()

692 
pŞdiff_commÚ_summ¬y_t
 *
cs
 = 
	`ÿÎoc
(1, (*cs));

693 ià(
cs
 =ğ
NULL
) {

694  
NULL
;

696 ià((
cs
->
diffs
 = 
	`­Ş_veùÜ_ü—‹
(
commÚ_ä“
)è=ğ
NULL
) {

697 
	`commÚ_de¡roy
(&
cs
);

698  
NULL
;

700  
cs
;

701 
	}
}

703 
	$commÚ_de¡roy
(
pŞdiff_commÚ_summ¬y_t
 ** 
cs
)

705 ià(
cs
 !ğ
NULL
 && *cs != NULL) {

706 
	`­Ş_veùÜ_de¡roy
(&(*
cs
)->
diffs
);

707 
	`ä“
(*
cs
);

708 *
cs
 = 
NULL
;

710 
	}
}

712 
	$commÚ_»£t
(
pŞdiff_t
 * 
diff
)

714 
”rÜ
 = 0;

716 ià(
diff
 =ğ
NULL
) {

717 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
EINVAL
));

718 
”ºo
 = 
EINVAL
;

722 
	`commÚ_de¡roy
(&
diff
->
commÚ_diffs
);

723 
diff
->
commÚ_diffs
 = 
	`commÚ_ü—‹
();

724 ià(
diff
->
commÚ_diffs
 =ğ
NULL
) {

725 
”rÜ
 = 
”ºo
;

726 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

727 
”ºo
 = 
”rÜ
;

732 
	}
}

737 
	$commÚ_Çme_comp
(cÚ¡ *
x
, cÚ¡ *
y
, *
¬g
)

739 cÚ¡ 
qpŞ_commÚ_t
 *
c1
 = 
x
;

740 cÚ¡ 
qpŞ_commÚ_t
 *
c2
 = 
y
;

741 
­Ş_pŞicy_t
 *
p
 = (­Ş_pŞicy_ˆ*è
¬g
;

742 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
p
);

743 cÚ¡ *
Çme1
, *
Çme2
;

744 ià(
	`qpŞ_commÚ_g‘_Çme
(
q
, 
c1
, &
Çme1
è< 0 || qpŞ_commÚ_g‘_Çme(q, 
c2
, &
Çme2
) < 0) {

747  
	`¡rcmp
(
Çme1
, 
Çme2
);

748 
	}
}

750 
­Ş_veùÜ_t
 *
	$commÚ_g‘_™ems
(
pŞdiff_t
 * 
diff
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
)

752 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

753 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

754 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicy
);

755 
”rÜ
 = 0;

756 ià(
	`qpŞ_pŞicy_g‘_commÚ_™”
(
q
, &
™”
) < 0) {

757  
NULL
;

759 
v
 = 
	`­Ş_veùÜ_ü—‹_äom_™”
(
™”
, 
NULL
);

760 ià(
v
 =ğ
NULL
) {

761 
”rÜ
 = 
”ºo
;

762 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

763 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

764 
”ºo
 = 
”rÜ
;

765  
NULL
;

767 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

768 
	`­Ş_veùÜ_sÜt
(
v
, 
commÚ_Çme_comp
, (*)
pŞicy
);

769  
v
;

770 
	}
}

772 
	$commÚ_comp
(cÚ¡ *
x
, cÚ¡ *
y
, cÚ¡ 
pŞdiff_t
 * 
diff
)

774 cÚ¡ 
qpŞ_commÚ_t
 *
c1
 = 
x
;

775 cÚ¡ 
qpŞ_commÚ_t
 *
c2
 = 
y
;

776 cÚ¡ *
Çme1
, *
Çme2
;

777 ià(
	`qpŞ_commÚ_g‘_Çme
(
diff
->
Üig_qpŞ
, 
c1
, &
Çme1
è< 0 || qpŞ_commÚ_g‘_Çme(diff->
mod_qpŞ
, 
c2
, &
Çme2
) < 0) {

780  
	`¡rcmp
(
Çme1
, 
Çme2
);

781 
	}
}

794 
pŞdiff_commÚ_t
 *
	$make_commÚ_diff
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
pŞdiff_fÜm_e
 
fÜm
, cÚ¡ *
Çme
)

796 
pŞdiff_commÚ_t
 *
pc
;

797 
”rÜ
;

798 ià((
pc
 = 
	`ÿÎoc
(1, (*pc))è=ğ
NULL
 ||

799 (
pc
->
Çme
 = 
	`¡rdup
Òame)è=ğ
NULL
 ||

800 (
pc
->
added_³rms
 = 
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(1, 
ä“
)è=ğ
NULL
 ||

801 (
pc
->
»moved_³rms
 = 
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(1, 
ä“
)è=ğ
NULL
) {

802 
”rÜ
 = 
”ºo
;

803 
	`commÚ_ä“
(
pc
);

804 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

805 
”ºo
 = 
”rÜ
;

806  
NULL
;

808 
pc
->
fÜm
 = form;

809  
pc
;

810 
	}
}

812 
	$commÚ_Ãw_diff
(
pŞdiff_t
 * 
diff
, 
pŞdiff_fÜm_e
 
fÜm
, cÚ¡ *
™em
)

814 cÚ¡ 
qpŞ_commÚ_t
 *
c
 = 
™em
;

815 cÚ¡ *
Çme
 = 
NULL
;

816 
pŞdiff_commÚ_t
 *
pc
;

817 
”rÜ
;

818 ià((
fÜm
 =ğ
POLDIFF_FORM_ADDED
 &&

819 
	`qpŞ_commÚ_g‘_Çme
(
diff
->
mod_qpŞ
, 
c
, &
Çme
) < 0) ||

820 ((
fÜm
 =ğ
POLDIFF_FORM_REMOVED
 || fÜm =ğ
POLDIFF_FORM_MODIFIED
) &&

821 
	`qpŞ_commÚ_g‘_Çme
(
diff
->
Üig_qpŞ
, 
c
, &
Çme
) < 0)) {

824 
pc
 = 
	`make_commÚ_diff
(
diff
, 
fÜm
, 
Çme
);

825 ià(
pc
 =ğ
NULL
) {

828 ià(
	`­Ş_veùÜ_­³nd
(
diff
->
commÚ_diffs
->
diffs
, 
pc
) < 0) {

829 
”rÜ
 = 
”ºo
;

830 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

831 
	`commÚ_ä“
(
pc
);

832 
”ºo
 = 
”rÜ
;

835 ià(
fÜm
 =ğ
POLDIFF_FORM_ADDED
) {

836 
diff
->
commÚ_diffs
->
num_added
++;

838 
diff
->
commÚ_diffs
->
num_»moved
++;

841 
	}
}

855 
­Ş_veùÜ_t
 *
	$commÚ_g‘_³rms
(cÚ¡ 
pŞdiff_t
 * 
diff
, cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
qpŞ_commÚ_t
 * 
commÚ
)

857 
qpŞ_™”©Ü_t
 *
³rm_™”
 = 
NULL
;

858 *
³rm
;

859 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

860 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
p
);

861 
»tv®
 = -1;

863 ià((
v
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)) == NULL) {

864 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”ºo
));

865 
ş—nup
;

867 ià(
	`qpŞ_commÚ_g‘_³rm_™”
(
q
, 
commÚ
, &
³rm_™”
) < 0) {

868 
ş—nup
;

870 ; !
	`qpŞ_™”©Ü_’d
(
³rm_™”
); 
	`qpŞ_™”©Ü_Ãxt
(perm_iter)) {

871 ià(
	`qpŞ_™”©Ü_g‘_™em
(
³rm_™”
, (**)&
³rm
) < 0) {

872 
ş—nup
;

874 ià(
	`­Ş_veùÜ_­³nd
(
v
, 
³rm
) < 0) {

875 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”ºo
));

876 
ş—nup
;

880 
»tv®
 = 0;

881 
ş—nup
:

882 
	`qpŞ_™”©Ü_de¡roy
(&
³rm_™”
);

883 ià(
»tv®
 < 0) {

884 
	`­Ş_veùÜ_de¡roy
(&
v
);

885  
NULL
;

887  
v
;

888 
	}
}

890 
	$commÚ_d“p_diff
(
pŞdiff_t
 * 
diff
, cÚ¡ *
x
, cÚ¡ *
y
)

892 cÚ¡ 
qpŞ_commÚ_t
 *
c1
 = 
x
;

893 cÚ¡ 
qpŞ_commÚ_t
 *
c2
 = 
y
;

894 
­Ş_veùÜ_t
 *
v1
 = 
NULL
, *
v2
 = NULL;

895 *
³rm1
 = 
NULL
, *
³rm2
 = NULL;

896 cÚ¡ *
Çme
;

897 
pŞdiff_commÚ_t
 *
c
 = 
NULL
;

898 
size_t
 
i
, 
j
;

899 
»tv®
 = -1, 
”rÜ
 = 0, 
compv®
;

901 ià(
	`qpŞ_commÚ_g‘_Çme
(
diff
->
Üig_qpŞ
, 
c1
, &
Çme
) < 0 ||

902 (
v1
 = 
	`commÚ_g‘_³rms
(
diff
, diff->
Üig_pŞ
, 
c1
)è=ğ
NULL
 || (
v2
 = commÚ_g‘_³rms(diff, diff->
mod_pŞ
, 
c2
)) == NULL) {

903 
”rÜ
 = 
”ºo
;

904 
ş—nup
;

906 
	`­Ş_veùÜ_sÜt
(
v1
, 
­Ş_¡r_¡rcmp
, 
NULL
);

907 
	`­Ş_veùÜ_sÜt
(
v2
, 
­Ş_¡r_¡rcmp
, 
NULL
);

908 
i
 = 
j
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v1
);) {

909 ià(
j
 >ğ
	`­Ş_veùÜ_g‘_size
(
v2
))

911 
³rm1
 = (*)
	`­Ş_veùÜ_g‘_–em’t
(
v1
, 
i
);

912 
³rm2
 = (*)
	`­Ş_veùÜ_g‘_–em’t
(
v2
, 
j
);

913 
compv®
 = 
	`¡rcmp
(
³rm1
, 
³rm2
);

914 ià(
compv®
 !ğ0 && 
c
 =ğ
NULL
) {

915 ià((
c
 = 
	`make_commÚ_diff
(
diff
, 
POLDIFF_FORM_MODIFIED
, 
Çme
)è=ğ
NULL
) {

916 
”rÜ
 = 
”ºo
;

917 
ş—nup
;

920 ià(
compv®
 < 0) {

921 ià((
³rm1
 = 
	`¡rdup
Õ”m1)è=ğ
NULL
 || 
	`­Ş_veùÜ_­³nd
(
c
->
»moved_³rms
,…erm1) < 0) {

922 
”rÜ
 = 
”ºo
;

923 
	`ä“
(
³rm1
);

924 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

925 
ş—nup
;

927 
i
++;

928 } ià(
compv®
 > 0) {

929 ià((
³rm2
 = 
	`¡rdup
Õ”m2)è=ğ
NULL
 || 
	`­Ş_veùÜ_­³nd
(
c
->
added_³rms
,…erm2) < 0) {

930 
”rÜ
 = 
”ºo
;

931 
	`ä“
(
³rm2
);

932 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

933 
ş—nup
;

935 
j
++;

937 
i
++;

938 
j
++;

941 ; 
i
 < 
	`­Ş_veùÜ_g‘_size
(
v1
); i++) {

942 
³rm1
 = (*)
	`­Ş_veùÜ_g‘_–em’t
(
v1
, 
i
);

943 ià(
c
 =ğ
NULL
) {

944 ià((
c
 = 
	`make_commÚ_diff
(
diff
, 
POLDIFF_FORM_MODIFIED
, 
Çme
)è=ğ
NULL
) {

945 
”rÜ
 = 
”ºo
;

946 
ş—nup
;

949 ià((
³rm1
 = 
	`¡rdup
Õ”m1)è=ğ
NULL
 || 
	`­Ş_veùÜ_­³nd
(
c
->
»moved_³rms
,…erm1) < 0) {

950 
”rÜ
 = 
”ºo
;

951 
	`ä“
(
³rm1
);

952 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

953 
ş—nup
;

956 ; 
j
 < 
	`­Ş_veùÜ_g‘_size
(
v2
); j++) {

957 
³rm2
 = (*)
	`­Ş_veùÜ_g‘_–em’t
(
v2
, 
j
);

958 ià(
c
 =ğ
NULL
) {

959 ià((
c
 = 
	`make_commÚ_diff
(
diff
, 
POLDIFF_FORM_MODIFIED
, 
Çme
)è=ğ
NULL
) {

960 
”rÜ
 = 
”ºo
;

961 
ş—nup
;

964 ià((
³rm2
 = 
	`¡rdup
Õ”m2)è=ğ
NULL
 || 
	`­Ş_veùÜ_­³nd
(
c
->
added_³rms
,…erm2) < 0) {

965 
”rÜ
 = 
”ºo
;

966 
	`ä“
(
³rm2
);

967 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

968 
ş—nup
;

971 ià(
c
 !ğ
NULL
) {

972 
	`­Ş_veùÜ_sÜt
(
c
->
»moved_³rms
, 
­Ş_¡r_¡rcmp
, 
NULL
);

973 
	`­Ş_veùÜ_sÜt
(
c
->
added_³rms
, 
­Ş_¡r_¡rcmp
, 
NULL
);

974 ià(
	`­Ş_veùÜ_­³nd
(
diff
->
commÚ_diffs
->
diffs
, 
c
) < 0) {

975 
”rÜ
 = 
”ºo
;

976 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

977 
ş—nup
;

979 
diff
->
commÚ_diffs
->
num_modif›d
++;

981 
»tv®
 = 0;

982 
ş—nup
:

983 
	`­Ş_veùÜ_de¡roy
(&
v1
);

984 
	`­Ş_veùÜ_de¡roy
(&
v2
);

985 ià(
»tv®
 != 0) {

986 
	`commÚ_ä“
(
c
);

988 
”ºo
 = 
”rÜ
;

989  
»tv®
;

990 
	}
}

	@libpoldiff/src/class_internal.h

25 #iâdeà
POLDIFF_CLASS_INTERNAL_H


26 
	#POLDIFF_CLASS_INTERNAL_H


	)

28 #ifdef 
__ılu¥lus


35 
pŞdiff_şass_summ¬y
 
	tpŞdiff_şass_summ¬y_t
;

43 
pŞdiff_şass_summ¬y_t
 *
şass_ü—‹
();

53 
şass_de¡roy
(
pŞdiff_şass_summ¬y_t
 ** 
cs
);

62 
şass_»£t
(
pŞdiff_t
 * 
diff
);

75 
­Ş_veùÜ_t
 *
şass_g‘_™ems
(
pŞdiff_t
 * 
diff
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
);

89 
şass_comp
(cÚ¡ *
x
, cÚ¡ *
y
, cÚ¡ 
pŞdiff_t
 * 
diff
);

102 
şass_Ãw_diff
(
pŞdiff_t
 * 
diff
, 
pŞdiff_fÜm_e
 
fÜm
, cÚ¡ *
™em
);

118 
şass_d“p_diff
(
pŞdiff_t
 * 
diff
, cÚ¡ *
x
, cÚ¡ *
y
);

122 
pŞdiff_commÚ_summ¬y
 
	tpŞdiff_commÚ_summ¬y_t
;

130 
pŞdiff_commÚ_summ¬y_t
 *
commÚ_ü—‹
();

140 
commÚ_de¡roy
(
pŞdiff_commÚ_summ¬y_t
 ** 
cs
);

149 
commÚ_»£t
(
pŞdiff_t
 * 
diff
);

162 
­Ş_veùÜ_t
 *
commÚ_g‘_™ems
(
pŞdiff_t
 * 
diff
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
);

176 
commÚ_comp
(cÚ¡ *
x
, cÚ¡ *
y
, cÚ¡ 
pŞdiff_t
 * 
diff
);

190 
commÚ_Ãw_diff
(
pŞdiff_t
 * 
diff
, 
pŞdiff_fÜm_e
 
fÜm
, cÚ¡ *
™em
);

206 
commÚ_d“p_diff
(
pŞdiff_t
 * 
diff
, cÚ¡ *
x
, cÚ¡ *
y
);

208 #ifdef 
__ılu¥lus


	@libpoldiff/src/level_diff.c

25 
	~<cÚfig.h
>

27 
	~"pŞdiff_š‹º®.h
"

29 
	~<­Ş/ut.h
>

30 
	~<as£¹.h
>

31 
	~<”ºo.h
>

32 
	~<¡dio.h
>

33 
	~<¡ršg.h
>

35 
	spŞdiff_Ëv–_summ¬y


37 
size_t
 
	mnum_added
;

38 
size_t
 
	mnum_»moved
;

39 
size_t
 
	mnum_modif›d
;

40 
­Ş_veùÜ_t
 *
	mdiffs
;

43 
	$pŞdiff_Ëv–_g‘_¡©s
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
size_t
 
¡©s
[5])

45 ià(
diff
 =ğ
NULL
 || 
¡©s
 == NULL) {

46 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
EINVAL
));

47 
”ºo
 = 
EINVAL
;

50 
¡©s
[0] = 
diff
->
Ëv–_diffs
->
num_added
;

51 
¡©s
[1] = 
diff
->
Ëv–_diffs
->
num_»moved
;

52 
¡©s
[2] = 
diff
->
Ëv–_diffs
->
num_modif›d
;

53 
¡©s
[3] = 0;

54 
¡©s
[4] = 0;

55 
	}
}

57 cÚ¡ 
­Ş_veùÜ_t
 *
	$pŞdiff_g‘_Ëv–_veùÜ
(cÚ¡ 
pŞdiff_t
 * 
diff
)

59 ià(
diff
 =ğ
NULL
) {

60 
”ºo
 = 
EINVAL
;

61  
NULL
;

63  
diff
->
Ëv–_diffs
->
diffs
;

64 
	}
}

66 *
	$pŞdiff_Ëv–_to_¡ršg
(cÚ¡ 
pŞdiff_t
 * 
diff
, cÚ¡ *
Ëv–
)

68 
pŞdiff_Ëv–_t
 *
l
 = (pŞdiff_Ëv–_ˆ*è
Ëv–
;

69 
size_t
 
num_added
, 
num_»moved
, 
Ën
 = 0, 
i
;

70 *
s
 = 
NULL
, *
ÿt
;

71 ià(
diff
 =ğ
NULL
 || 
Ëv–
 == NULL) {

72 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
EINVAL
));

73 
”ºo
 = 
EINVAL
;

74  
NULL
;

76 
num_added
 = 
	`­Ş_veùÜ_g‘_size
(
l
->
added_ÿts
);

77 
num_»moved
 = 
	`­Ş_veùÜ_g‘_size
(
l
->
»moved_ÿts
);

78 
l
->
fÜm
) {

79 
POLDIFF_FORM_ADDED
:

81 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "+ %s", 
l
->
Çme
) < 0) {

84  
s
;

86 
POLDIFF_FORM_REMOVED
:

88 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "- %s", 
l
->
Çme
) < 0) {

91  
s
;

93 
POLDIFF_FORM_MODIFIED
:

95 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "* % (", 
l
->
Çme
) < 0) {

98 ià(
num_added
 > 0) {

99 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "%zd Added %s", 
num_added
, (num_added == 1 ? "Category" : "Categories")) < 0) {

103 ià(
num_»moved
 > 0) {

104 ià(
­Ş_¡r_­³ndf


105 (&
s
, &
Ën
, "%s%zd Removed %s", (
num_added
 > 0 ? ", " : ""), 
num_»moved
,

106 (
num_»moved
 == 1 ? "Category" : "Categories")) < 0) {

110 ià(
	`­Ş_¡r_­³nd
(&
s
, &
Ën
, ")\n") < 0) {

113 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
l
->
added_ÿts
); i++) {

114 
ÿt
 = (*)
	`­Ş_veùÜ_g‘_–em’t
(
l
->
added_ÿts
, 
i
);

115 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "\t+ %s\n", 
ÿt
) < 0) {

116 
”r
;

119 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
l
->
»moved_ÿts
); i++) {

120 
ÿt
 = (*)
	`­Ş_veùÜ_g‘_–em’t
(
l
->
»moved_ÿts
, 
i
);

121 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "\t- %s\n", 
ÿt
) < 0) {

122 
”r
;

125  
s
;

129 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
ENOTSUP
));

130 
”ºo
 = 
ENOTSUP
;

131  
NULL
;

134 
”r
:

136 
	`ä“
(
s
);

137 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

138 
”ºo
 = 
ENOMEM
;

139  
NULL
;

140 
	}
}

142 *
	$pŞdiff_Ëv–_to_¡ršg_br›f
(cÚ¡ 
pŞdiff_t
 * 
diff
, cÚ¡ 
pŞdiff_Ëv–_t
 * 
Ëv–
)

144 *
s
 = 
NULL
, 
t
, *
ÿt
, *
£p
 = "";

145 
show_ÿt_sym
 = 0;

146 
size_t
 
Ën
 = 0, 
i
;

147 
Ëv–
->
fÜm
) {

148 
POLDIFF_FORM_ADDED
:

149 
t
 = '+';

151 
POLDIFF_FORM_REMOVED
:

152 
t
 = '-';

154 
POLDIFF_FORM_MODIFIED
:

155 
t
 = '*';

156 
show_ÿt_sym
 = 1;

160 ià((
s
 = 
	`¡rdup
("")è=ğ
NULL
) {

161 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”ºo
));

162  
NULL
;

164  
s
;

166 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "%ø%s", 
t
, 
Ëv–
->
Çme
) < 0) {

167 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”ºo
));

168  
NULL
;

170 ià((
Ëv–
->
unmodif›d_ÿts
 !ğ
NULL
 && 
	`­Ş_veùÜ_g‘_size
(level->unmodified_cats) > 0) ||

171 (
Ëv–
->
added_ÿts
 !ğ
NULL
 && 
	`­Ş_veùÜ_g‘_size
(level->added_cats) > 0) ||

172 (
Ëv–
->
»moved_ÿts
 !ğ
NULL
 && 
	`­Ş_veùÜ_g‘_size
(level->removed_cats) > 0)) {

173 ià(
	`­Ş_¡r_­³nd
(&
s
, &
Ën
, " : ") < 0) {

174 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”ºo
));

175  
NULL
;

177 
i
 = 0; 
Ëv–
->
unmodif›d_ÿts
 !ğ
NULL
 && i < 
	`­Ş_veùÜ_g‘_size
(level->unmodified_cats); i++) {

178 
ÿt
 = 
	`­Ş_veùÜ_g‘_–em’t
(
Ëv–
->
unmodif›d_ÿts
, 
i
);

179 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "%s%s", 
£p
, 
ÿt
) < 0) {

180 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”ºo
));

181  
NULL
;

183 
£p
 = ",";

185 
i
 = 0; 
Ëv–
->
added_ÿts
 !ğ
NULL
 && i < 
	`­Ş_veùÜ_g‘_size
(level->added_cats); i++) {

186 
ÿt
 = 
	`­Ş_veùÜ_g‘_–em’t
(
Ëv–
->
added_ÿts
, 
i
);

187 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "%s%s%s", 
£p
, (
show_ÿt_sym
 ? "+" : ""), 
ÿt
) < 0) {

188 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”ºo
));

189  
NULL
;

191 
£p
 = ",";

193 
i
 = 0; 
Ëv–
->
»moved_ÿts
 !ğ
NULL
 && i < 
	`­Ş_veùÜ_g‘_size
(level->removed_cats); i++) {

194 
ÿt
 = 
	`­Ş_veùÜ_g‘_–em’t
(
Ëv–
->
»moved_ÿts
, 
i
);

195 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "%s%s%s", 
£p
, (
show_ÿt_sym
 ? "-" : ""), 
ÿt
) < 0) {

196 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”ºo
));

197  
NULL
;

199 
£p
 = ",";

202 ià(
	`­Ş_¡r_­³nd
(&
s
, &
Ën
, "\n") < 0) {

203 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”ºo
));

204  
NULL
;

206  
s
;

207 
	}
}

209 cÚ¡ *
	$pŞdiff_Ëv–_g‘_Çme
(cÚ¡ 
pŞdiff_Ëv–_t
 * 
Ëv–
)

211 ià(
Ëv–
 =ğ
NULL
) {

212 
”ºo
 = 
EINVAL
;

213  
NULL
;

216  
Ëv–
->
Çme
;

217 
	}
}

219 
pŞdiff_fÜm_e
 
	$pŞdiff_Ëv–_g‘_fÜm
(cÚ¡ *
Ëv–
)

221 ià(
Ëv–
 =ğ
NULL
) {

222 
”ºo
 = 
EINVAL
;

223  
POLDIFF_FORM_NONE
;

226  ((cÚ¡ 
pŞdiff_Ëv–_t
 *)
Ëv–
)->
fÜm
;

227 
	}
}

229 cÚ¡ 
­Ş_veùÜ_t
 *
	$pŞdiff_Ëv–_g‘_added_ÿts
(cÚ¡ 
pŞdiff_Ëv–_t
 * 
Ëv–
)

231 ià(
Ëv–
 =ğ
NULL
) {

232 
”ºo
 = 
EINVAL
;

233  
NULL
;

235  
Ëv–
->
added_ÿts
;

236 
	}
}

238 cÚ¡ 
­Ş_veùÜ_t
 *
	$pŞdiff_Ëv–_g‘_»moved_ÿts
(cÚ¡ 
pŞdiff_Ëv–_t
 * 
Ëv–
)

240 ià(
Ëv–
 =ğ
NULL
) {

241 
”ºo
 = 
EINVAL
;

242  
NULL
;

245  
Ëv–
->
»moved_ÿts
;

246 
	}
}

248 cÚ¡ 
­Ş_veùÜ_t
 *
	$pŞdiff_Ëv–_g‘_unmodif›d_ÿts
(cÚ¡ 
pŞdiff_Ëv–_t
 * 
Ëv–
)

250 ià(
Ëv–
 =ğ
NULL
) {

251 
”ºo
 = 
EINVAL
;

252  
NULL
;

255  
Ëv–
->
unmodif›d_ÿts
;

256 
	}
}

258 
pŞdiff_Ëv–_summ¬y_t
 *
	$Ëv–_ü—‹
()

260 
pŞdiff_Ëv–_summ¬y_t
 *
ls
 = 
	`ÿÎoc
(1, (poldiff_level_summary_t));

261 ià(
ls
 =ğ
NULL
)

262  
NULL
;

263 ià((
ls
->
diffs
 = 
	`­Ş_veùÜ_ü—‹
(
Ëv–_ä“
)è=ğ
NULL
) {

264 
	`Ëv–_de¡roy
(&
ls
);

265  
NULL
;

267  
ls
;

268 
	}
}

270 
	$Ëv–_de¡roy
(
pŞdiff_Ëv–_summ¬y_t
 ** 
ls
)

272 ià(
ls
 =ğ
NULL
 || *ls == NULL)

274 
	`­Ş_veùÜ_de¡roy
(&(*
ls
)->
diffs
);

275 
	`ä“
(*
ls
);

276 *
ls
 = 
NULL
;

277 
	}
}

279 
	$Ëv–_»£t
(
pŞdiff_t
 * 
diff
)

281 
”rÜ
 = 0;

283 ià(
diff
 =ğ
NULL
) {

284 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
EINVAL
));

285 
”ºo
 = 
EINVAL
;

289 
	`Ëv–_de¡roy
(&
diff
->
Ëv–_diffs
);

290 
diff
->
Ëv–_diffs
 = 
	`Ëv–_ü—‹
();

291 ià(
diff
->
Ëv–_diffs
 =ğ
NULL
) {

292 
”rÜ
 = 
”ºo
;

293 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

294 
”ºo
 = 
”rÜ
;

299 
	}
}

304 
	$Ëv–_Çme_comp
(cÚ¡ *
x
, cÚ¡ *
y
, *
¬g
)

306 cÚ¡ 
qpŞ_Ëv–_t
 *
s1
 = 
x
;

307 cÚ¡ 
qpŞ_Ëv–_t
 *
s2
 = 
y
;

308 
­Ş_pŞicy_t
 *
p
 = 
¬g
;

309 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
p
);

310 cÚ¡ *
Çme1
, *
Çme2
;

312 ià(
	`qpŞ_Ëv–_g‘_Çme
(
q
, 
s1
, &
Çme1
è< 0 || qpŞ_Ëv–_g‘_Çme(q, 
s2
, &
Çme2
) < 0)

314  
	`¡rcmp
(
Çme1
, 
Çme2
);

315 
	}
}

317 
­Ş_veùÜ_t
 *
	$Ëv–_g‘_™ems
(
pŞdiff_t
 * 
diff
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
)

319 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

320 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

321 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicy
);

322 
”rÜ
 = 0;

323 ià(
	`qpŞ_pŞicy_g‘_Ëv–_™”
(
q
, &
™”
) < 0) {

324  
NULL
;

326 
v
 = 
	`­Ş_veùÜ_ü—‹_äom_™”
(
™”
, 
NULL
);

327 ià(
v
 =ğ
NULL
) {

328 
”rÜ
 = 
”ºo
;

329 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

330 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

331 
”ºo
 = 
”rÜ
;

332  
NULL
;

334 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

335 
	`­Ş_veùÜ_sÜt
(
v
, 
Ëv–_Çme_comp
, (*)
pŞicy
);

336  
v
;

337 
	}
}

339 
	$Ëv–_comp
(cÚ¡ *
x
, cÚ¡ *
y
, cÚ¡ 
pŞdiff_t
 * 
diff
)

341 cÚ¡ 
qpŞ_Ëv–_t
 *
l1
 = 
x
;

342 cÚ¡ 
qpŞ_Ëv–_t
 *
l2
 = 
y
;

343 cÚ¡ *
Çme1
, *
Çme2
;

344 ià(
	`qpŞ_Ëv–_g‘_Çme
(
diff
->
Üig_qpŞ
, 
l1
, &
Çme1
è< 0 || qpŞ_Ëv–_g‘_Çme(diff->
mod_qpŞ
, 
l2
, &
Çme2
) < 0) {

347  
	`¡rcmp
(
Çme1
, 
Çme2
);

348 
	}
}

361 
pŞdiff_Ëv–_t
 *
	$make_diff
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
pŞdiff_fÜm_e
 
fÜm
, cÚ¡ *
Çme
)

363 
pŞdiff_Ëv–_t
 *
¶
;

364 
”rÜ
;

365 ià((
¶
 = 
	`ÿÎoc
(1, (*¶))è=ğ
NULL
 || (¶->
Çme
 = 
	`¡rdup
(name)) == NULL ||

366 (
¶
->
added_ÿts
 = 
	`­Ş_veùÜ_ü—‹
(
ä“
)è=ğ
NULL
 ||

367 (
¶
->
»moved_ÿts
 = 
	`­Ş_veùÜ_ü—‹
(
ä“
)è=ğ
NULL
 || (¶->
unmodif›d_ÿts
 =‡pol_vector_create(free)) == NULL) {

368 
”rÜ
 = 
”ºo
;

369 
	`Ëv–_ä“
(
¶
);

370 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

371 
”ºo
 = 
”rÜ
;

372  
NULL
;

374 
¶
->
fÜm
 = form;

375  
¶
;

376 
	}
}

390 
­Ş_veùÜ_t
 *
	$Ëv–_g‘_ÿts
(cÚ¡ 
pŞdiff_t
 * 
diff
, cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
qpŞ_Ëv–_t
 * 
Ëv–
)

392 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

393 cÚ¡ 
qpŞ_ÿt_t
 *
ÿt
;

394 cÚ¡ *
ÿt_Çme
;

395 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

396 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
p
);

397 
»tv®
 = -1, 
”rÜ
 = 0;

399 ià((
v
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)) == NULL) {

400 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”ºo
));

401 
ş—nup
;

403 ià(
	`qpŞ_Ëv–_g‘_ÿt_™”
(
q
, 
Ëv–
, &
™”
) < 0) {

404 
ş—nup
;

406 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

407 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
ÿt
è< 0 || 
	`qpŞ_ÿt_g‘_Çme
(
q
, c©, &
ÿt_Çme
)) {

408 
”rÜ
 = 
”ºo
;

409 
ş—nup
;

411 ià(
	`­Ş_veùÜ_­³nd
(
v
, (*)
ÿt_Çme
) < 0) {

412 
”rÜ
 = 
”ºo
;

413 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

414 
ş—nup
;

418 
»tv®
 = 0;

419 
ş—nup
:

420 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

421 ià(
»tv®
 < 0) {

422 
	`­Ş_veùÜ_de¡roy
(&
v
);

423 
”ºo
 = 
”rÜ
;

424  
NULL
;

426  
v
;

427 
	}
}

429 
	$Ëv–_Ãw_diff
(
pŞdiff_t
 * 
diff
, 
pŞdiff_fÜm_e
 
fÜm
, cÚ¡ *
™em
)

431 cÚ¡ 
qpŞ_Ëv–_t
 *
l
 = 
™em
;

432 cÚ¡ *
Çme
 = 
NULL
;

433 
pŞdiff_Ëv–_t
 *
¶
 = 
NULL
;

434 
­Ş_pŞicy_t
 *
p
;

435 
qpŞ_pŞicy_t
 *
q
;

436 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

437 
”rÜ
 = 0, 
»tv®
 = -1;

438 ià(
fÜm
 =ğ
POLDIFF_FORM_ADDED
) {

439 
p
 = 
diff
->
mod_pŞ
;

440 
q
 = 
diff
->
mod_qpŞ
;

442 
p
 = 
diff
->
Üig_pŞ
;

443 
q
 = 
diff
->
Üig_qpŞ
;

445 ià(
	`qpŞ_Ëv–_g‘_Çme
(
q
, 
l
, &
Çme
è< 0 || (
¶
 = 
	`make_diff
(
diff
, 
fÜm
,‚ame)è=ğ
NULL
) {

446 
”rÜ
 = 
”ºo
;

447 
ş—nup
;

449 ià((
v
 = 
	`Ëv–_g‘_ÿts
(
diff
, 
p
, 
l
)è=ğ
NULL
) {

450 
”rÜ
 = 
”ºo
;

451 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

452 
ş—nup
;

454 ià(
fÜm
 =ğ
POLDIFF_FORM_ADDED
) {

455 
	`­Ş_veùÜ_de¡roy
(&
¶
->
added_ÿts
);

456 ià((
¶
->
added_ÿts
 = 
	`­Ş_veùÜ_ü—‹_äom_veùÜ
(
v
, 
­Ş_¡r_¡rdup
, 
NULL
, 
ä“
)) == NULL) {

457 
”rÜ
 = 
”ºo
;

458 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

459 
ş—nup
;

461 } ià(
fÜm
 =ğ
POLDIFF_FORM_REMOVED
) {

462 
	`­Ş_veùÜ_de¡roy
(&
¶
->
»moved_ÿts
);

463 ià((
¶
->
»moved_ÿts
 = 
	`­Ş_veùÜ_ü—‹_äom_veùÜ
(
v
, 
­Ş_¡r_¡rdup
, 
NULL
, 
ä“
)) == NULL) {

464 
”rÜ
 = 
”ºo
;

465 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

466 
ş—nup
;

469 ià(
	`­Ş_veùÜ_­³nd
(
diff
->
Ëv–_diffs
->
diffs
, 
¶
) < 0) {

470 
”rÜ
 = 
”ºo
;

471 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

472 
ş—nup
;

474 ià(
fÜm
 =ğ
POLDIFF_FORM_ADDED
) {

475 
diff
->
Ëv–_diffs
->
num_added
++;

477 
diff
->
Ëv–_diffs
->
num_»moved
++;

479 
»tv®
 = 0;

480 
ş—nup
:

481 
	`­Ş_veùÜ_de¡roy
(&
v
);

482 ià(
»tv®
 < 0) {

483 
	`Ëv–_ä“
(
¶
);

484 
”ºo
 = 
”rÜ
;

486  
»tv®
;

487 
	}
}

499 
	$Ëv–_ÿt_comp
(cÚ¡ *
a
, cÚ¡ *
b
, *
d©a
)

501 cÚ¡ *
Çme1
 = (cÚ¡ *)
a
;

502 cÚ¡ *
Çme2
 = (cÚ¡ *)
b
;

503 
qpŞ_pŞicy_t
 *
q
 = (qpŞ_pŞicy_ˆ*è
d©a
;

504 cÚ¡ 
qpŞ_ÿt_t
 *
ÿt1
, *
ÿt2
;

505 
	`qpŞ_pŞicy_g‘_ÿt_by_Çme
(
q
, 
Çme1
, &
ÿt1
);

506 
	`qpŞ_pŞicy_g‘_ÿt_by_Çme
(
q
, 
Çme2
, &
ÿt2
);

507 
	`as£¹
(
ÿt1
 !ğ
NULL
 && 
ÿt2
 != NULL);

508 
ušt32_t
 
v®1
, 
v®2
;

509 
	`qpŞ_ÿt_g‘_v®ue
(
q
, 
ÿt1
, &
v®1
);

510 
	`qpŞ_ÿt_g‘_v®ue
(
q
, 
ÿt2
, &
v®2
);

511  
v®1
 - 
v®2
;

512 
	}
}

514 
	$Ëv–_d“p_diff
(
pŞdiff_t
 * 
diff
, cÚ¡ *
x
, cÚ¡ *
y
)

516 cÚ¡ 
qpŞ_Ëv–_t
 *
l1
 = 
x
;

517 cÚ¡ 
qpŞ_Ëv–_t
 *
l2
 = 
y
;

518 
­Ş_veùÜ_t
 *
v1
 = 
NULL
, *
v2
 = NULL;

519 
­Ş_veùÜ_t
 *
added
 = 
NULL
, *
»moved
 = NULL, *
unmodif›d
 = NULL;

520 cÚ¡ *
Çme
;

521 
pŞdiff_Ëv–_t
 *
l
 = 
NULL
;

522 
»tv®
 = -1, 
”rÜ
 = 0, 
compv®
;

524 ià(
	`qpŞ_Ëv–_g‘_Çme
(
diff
->
Üig_qpŞ
, 
l1
, &
Çme
) < 0 ||

525 (
v1
 = 
	`Ëv–_g‘_ÿts
(
diff
, diff->
Üig_pŞ
, 
l1
)è=ğ
NULL
 || (
v2
 =†ev–_g‘_ÿts(diff, diff->
mod_pŞ
, 
l2
)) == NULL) {

526 
”rÜ
 = 
”ºo
;

527 
ş—nup
;

529 
	`­Ş_veùÜ_sÜt
(
v1
, 
­Ş_¡r_¡rcmp
, 
NULL
);

530 
	`­Ş_veùÜ_sÜt
(
v2
, 
­Ş_¡r_¡rcmp
, 
NULL
);

531 
compv®
 = 
	`Ëv–_d“p_diff_ÿts
(
diff
, 
v1
, 
v2
, &
added
, &
»moved
, &
unmodif›d
);

532 ià(
compv®
 < 0) {

533 
”rÜ
 = 
”ºo
;

534 
ş—nup
;

535 } ià(
compv®
 > 0) {

536 ià((
l
 = 
	`make_diff
(
diff
, 
POLDIFF_FORM_MODIFIED
, 
Çme
)è=ğ
NULL
) {

537 
”rÜ
 = 
”ºo
;

538 
ş—nup
;

540 
	`­Ş_veùÜ_de¡roy
(&
l
->
added_ÿts
);

541 
	`­Ş_veùÜ_de¡roy
(&
l
->
»moved_ÿts
);

542 
	`­Ş_veùÜ_de¡roy
(&
l
->
unmodif›d_ÿts
);

543 ià((
l
->
added_ÿts
 = 
	`­Ş_veùÜ_ü—‹_äom_veùÜ
(
added
, 
­Ş_¡r_¡rdup
, 
NULL
, 
ä“
)) == NULL ||

544 (
l
->
»moved_ÿts
 = 
	`­Ş_veùÜ_ü—‹_äom_veùÜ
(
»moved
, 
­Ş_¡r_¡rdup
, 
NULL
, 
ä“
)) == NULL ||

545 (
l
->
unmodif›d_ÿts
 = 
	`­Ş_veùÜ_ü—‹_äom_veùÜ
(
unmodif›d
, 
­Ş_¡r_¡rdup
, 
NULL
, 
ä“
)) == NULL) {

546 
”rÜ
 = 
”ºo
;

547 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

548 
ş—nup
;

550 
	`­Ş_veùÜ_sÜt
(
l
->
»moved_ÿts
, 
Ëv–_ÿt_comp
, 
diff
->
Üig_qpŞ
);

551 
	`­Ş_veùÜ_sÜt
(
l
->
added_ÿts
, 
Ëv–_ÿt_comp
, 
diff
->
mod_qpŞ
);

552 
	`­Ş_veùÜ_sÜt
(
l
->
unmodif›d_ÿts
, 
Ëv–_ÿt_comp
, 
diff
->
Üig_qpŞ
);

553 ià(
	`­Ş_veùÜ_­³nd
(
diff
->
Ëv–_diffs
->
diffs
, 
l
) < 0) {

554 
”rÜ
 = 
”ºo
;

555 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

556 
ş—nup
;

558 
diff
->
Ëv–_diffs
->
num_modif›d
++;

560 
»tv®
 = 0;

561 
ş—nup
:

562 
	`­Ş_veùÜ_de¡roy
(&
v1
);

563 
	`­Ş_veùÜ_de¡roy
(&
v2
);

564 
	`­Ş_veùÜ_de¡roy
(&
added
);

565 
	`­Ş_veùÜ_de¡roy
(&
»moved
);

566 
	`­Ş_veùÜ_de¡roy
(&
unmodif›d
);

567 ià(
»tv®
 != 0) {

568 
	`Ëv–_ä“
(
l
);

570 
”ºo
 = 
”rÜ
;

571  
»tv®
;

572 
	}
}

574 
pŞdiff_Ëv–_t
 *
	$Ëv–_ü—‹_äom_­Ş_mls_Ëv–
(cÚ¡ 
­Ş_mls_Ëv–_t
 * 
Ëv–
, 
pŞdiff_fÜm_e
 
fÜm
)

576 cÚ¡ *
£ns
 = 
	`­Ş_mls_Ëv–_g‘_£ns
(
Ëv–
);

577 cÚ¡ 
­Ş_veùÜ_t
 *
ÿts
 = 
	`­Ş_mls_Ëv–_g‘_ÿts
(
Ëv–
);

578 
pŞdiff_Ëv–_t
 *
¶
 = 
NULL
;

579 
­Ş_veùÜ_t
 **
rg‘
;

580 ià((
¶
 = 
	`ÿÎoc
(1, (*¶))è=ğ
NULL
 ||

581 (
¶
->
Çme
 = 
	`¡rdup
(
£ns
)è=ğ
NULL
 || (¶->
unmodif›d_ÿts
 = 
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(1, 
ä“
)) == NULL) {

582 
	`Ëv–_ä“
(
¶
);

583  
NULL
;;

585 
¶
->
fÜm
 = form;

586 ià(
fÜm
 =ğ
POLDIFF_FORM_ADDED
) {

587 ià((
¶
->
»moved_ÿts
 = 
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(1, 
ä“
)è=ğ
NULL
) {

588 
	`Ëv–_ä“
(
¶
);

589  
NULL
;

591 
rg‘
 = &
¶
->
added_ÿts
;

592 } ià(
fÜm
 =ğ
POLDIFF_FORM_REMOVED
) {

593 ià((
¶
->
added_ÿts
 = 
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(1, 
ä“
)è=ğ
NULL
) {

594 
	`Ëv–_ä“
(
¶
);

595  
NULL
;

597 
rg‘
 = &
¶
->
»moved_ÿts
;

599 ià((
¶
->
added_ÿts
 = 
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(1, 
ä“
)è=ğ
NULL
 ||

600 (
¶
->
»moved_ÿts
 = 
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(1, 
ä“
)è=ğ
NULL
) {

601 
	`Ëv–_ä“
(
¶
);

602  
NULL
;

604  
¶
;

606 ià((*
rg‘
 = 
	`­Ş_veùÜ_ü—‹_äom_veùÜ
(
ÿts
, 
­Ş_¡r_¡rdup
, 
NULL
, 
ä“
)) == NULL) {

607 
	`Ëv–_ä“
(
¶
);

608  
NULL
;

610  
¶
;

611 
	}
}

613 
	$Ëv–_ä“
(*
–em
)

615 
pŞdiff_Ëv–_t
 *
s
 = 
–em
;

616 ià(!
–em
)

618 
	`ä“
(
s
->
Çme
);

619 
	`­Ş_veùÜ_de¡roy
(&
s
->
added_ÿts
);

620 
	`­Ş_veùÜ_de¡roy
(&
s
->
»moved_ÿts
);

621 
	`­Ş_veùÜ_de¡roy
(&
s
->
unmodif›d_ÿts
);

622 
	`ä“
(
s
);

623 
	}
}

625 
	$Ëv–_d“p_diff_­Ş_mls_Ëv–s
(
pŞdiff_t
 * 
diff
, cÚ¡ 
­Ş_mls_Ëv–_t
 * 
Ëv–1
, cÚ¡‡pŞ_mls_Ëv–_ˆ* 
Ëv–2
,

626 
pŞdiff_Ëv–_t
 ** 
Üig_¶
,…Şdiff_Ëv–_ˆ** 
mod_¶
)

628 
pŞdiff_Ëv–_t
 *
u1
 = 
NULL
, *
u2
 = NULL;

629 
­Ş_veùÜ_t
 *
added
 = 
NULL
, *
»moved
 = NULL, *
unmodif›d
 = NULL;

630 cÚ¡ *
£ns1
 = 
	`­Ş_mls_Ëv–_g‘_£ns
(
Ëv–1
);

631 cÚ¡ 
­Ş_veùÜ_t
 *
ÿts1
 = 
	`­Ş_mls_Ëv–_g‘_ÿts
(
Ëv–1
);

632 cÚ¡ *
£ns2
 = 
	`­Ş_mls_Ëv–_g‘_£ns
(
Ëv–2
);

633 cÚ¡ 
­Ş_veùÜ_t
 *
ÿts2
 = 
	`­Ş_mls_Ëv–_g‘_ÿts
(
Ëv–2
);

634 
»tv®
 = -1, 
compv®
;

636 *
Üig_¶
 = *
mod_¶
 = 
NULL
;

637 ià(
	`¡rcmp
(
£ns1
, 
£ns2
) != 0) {

639 ià((
u1
 = 
	`make_diff
(
diff
, 
POLDIFF_FORM_REMOVED
, 
£ns1
)è=ğ
NULL
 ||

640 (
u2
 = 
	`make_diff
(
diff
, 
POLDIFF_FORM_ADDED
, 
£ns2
)è=ğ
NULL
) {

641 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”ºo
));

642 
	`Ëv–_ä“
(
u1
);

643 
	`Ëv–_ä“
(
u2
);

646 
	`­Ş_veùÜ_de¡roy
(&
u1
->
»moved_ÿts
);

647 
	`­Ş_veùÜ_de¡roy
(&
u2
->
added_ÿts
);

648 ià((
u1
->
»moved_ÿts
 = 
	`­Ş_veùÜ_ü—‹_äom_veùÜ
(
ÿts1
, 
­Ş_¡r_¡rdup
, 
NULL
, 
ä“
)) == NULL ||

649 (
u2
->
added_ÿts
 = 
	`­Ş_veùÜ_ü—‹_äom_veùÜ
(
ÿts2
, 
­Ş_¡r_¡rdup
, 
NULL
, 
ä“
)) == NULL) {

650 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”ºo
));

651 
	`Ëv–_ä“
(
u1
);

652 
	`Ëv–_ä“
(
u2
);

655 
	`­Ş_veùÜ_sÜt
(
u1
->
»moved_ÿts
, 
Ëv–_ÿt_comp
, 
diff
->
Üig_qpŞ
);

656 
	`­Ş_veùÜ_sÜt
(
u2
->
added_ÿts
, 
Ëv–_ÿt_comp
, 
diff
->
mod_qpŞ
);

657 *
Üig_¶
 = 
u1
;

658 *
mod_¶
 = 
u2
;

662 
compv®
 = 
	`Ëv–_d“p_diff_ÿts
(
diff
, 
ÿts1
, 
ÿts2
, &
added
, &
»moved
, &
unmodif›d
);

663 ià(
compv®
 < 0) {

664 
ş—nup
;

665 } ià(
compv®
 > 0) {

666 ià((
u1
 = 
	`ÿÎoc
(1, (*u1))è=ğ
NULL
 || (u1->
Çme
 = 
	`¡rdup
(
£ns1
)) == NULL ||

667 (
u1
->
added_ÿts
 = 
	`­Ş_veùÜ_ü—‹_äom_veùÜ
(
added
, 
­Ş_¡r_¡rdup
, 
NULL
, 
ä“
)) == NULL ||

668 (
u1
->
»moved_ÿts
 = 
	`­Ş_veùÜ_ü—‹_äom_veùÜ
(
»moved
, 
­Ş_¡r_¡rdup
, 
NULL
, 
ä“
)) == NULL ||

669 (
u1
->
unmodif›d_ÿts
 = 
	`­Ş_veùÜ_ü—‹_äom_veùÜ
(
unmodif›d
, 
­Ş_¡r_¡rdup
, 
NULL
, 
ä“
)) == NULL) {

670 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”ºo
));

671 
	`Ëv–_ä“
(
u1
);

672 
ş—nup
;

674 
	`­Ş_veùÜ_sÜt
(
u1
->
added_ÿts
, 
Ëv–_ÿt_comp
, 
diff
->
mod_qpŞ
);

675 
	`­Ş_veùÜ_sÜt
(
u1
->
»moved_ÿts
, 
Ëv–_ÿt_comp
, 
diff
->
Üig_qpŞ
);

676 
	`­Ş_veùÜ_sÜt
(
u1
->
unmodif›d_ÿts
, 
Ëv–_ÿt_comp
, 
diff
->
Üig_qpŞ
);

677 
u1
->
fÜm
 = 
POLDIFF_FORM_MODIFIED
;

678 *
Üig_¶
 = 
u1
;

680 
»tv®
 = 0;

681 
ş—nup
:

682 
	`­Ş_veùÜ_de¡roy
(&
added
);

683 
	`­Ş_veùÜ_de¡roy
(&
»moved
);

684 
	`­Ş_veùÜ_de¡roy
(&
unmodif›d
);

685  
»tv®
;

686 
	}
}

688 
	$Ëv–_d“p_diff_ÿts
(
pŞdiff_t
 * 
diff
, cÚ¡ 
­Ş_veùÜ_t
 * 
v1
, cÚ¡‡pŞ_veùÜ_ˆ* 
v2
,‡pŞ_veùÜ_ˆ** 
added
,

689 
­Ş_veùÜ_t
 ** 
»moved
,‡pŞ_veùÜ_ˆ** 
unmodif›d
)

691 
size_t
 
i
, 
j
;

692 *
ÿt1
, *
ÿt2
;

693 
compv®
, 
»tv®
 = -1, 
”rÜ
 = 0;

694 *
added
 = *
»moved
 = *
unmodif›d
 = 
NULL
;

695 ià((*
added
 = 
	`­Ş_veùÜ_ü—‹
(
ä“
)è=ğ
NULL
 ||

696 (*
»moved
 = 
	`­Ş_veùÜ_ü—‹
(
ä“
)è=ğ
NULL
 || (*
unmodif›d
 =‡pol_vector_create(free)) == NULL) {

697 
”rÜ
 = 
”ºo
;

698 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

699 
ş—nup
;

701 
i
 = 
j
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v1
);) {

702 ià(
j
 >ğ
	`­Ş_veùÜ_g‘_size
(
v2
)) {

705 
ÿt1
 = (*)
	`­Ş_veùÜ_g‘_–em’t
(
v1
, 
i
);

706 
ÿt2
 = (*)
	`­Ş_veùÜ_g‘_–em’t
(
v2
, 
j
);

707 
compv®
 = 
	`¡rcmp
(
ÿt1
, 
ÿt2
);

708 ià(
compv®
 < 0) {

709 ià((
ÿt1
 = 
	`¡rdup
(ÿt1)è=ğ
NULL
 || 
	`­Ş_veùÜ_­³nd
(*
»moved
, cat1) < 0) {

710 
”rÜ
 = 
”ºo
;

711 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

712 
	`ä“
(
ÿt1
);

713 
ş—nup
;

715 
i
++;

716 } ià(
compv®
 > 0) {

717 ià((
ÿt2
 = 
	`¡rdup
(ÿt2)è=ğ
NULL
 || 
	`­Ş_veùÜ_­³nd
(*
added
, cat2) < 0) {

718 
”rÜ
 = 
”ºo
;

719 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

720 
	`ä“
(
ÿt2
);

721 
ş—nup
;

723 
j
++;

725 ià((
ÿt1
 = 
	`¡rdup
(ÿt1)è=ğ
NULL
 || 
	`­Ş_veùÜ_­³nd
(*
unmodif›d
, cat1) < 0) {

726 
”rÜ
 = 
”ºo
;

727 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

728 
	`ä“
(
ÿt1
);

729 
ş—nup
;

731 
i
++;

732 
j
++;

735 ; 
i
 < 
	`­Ş_veùÜ_g‘_size
(
v1
); i++) {

736 
ÿt1
 = (*)
	`­Ş_veùÜ_g‘_–em’t
(
v1
, 
i
);

737 ià((
ÿt1
 = 
	`¡rdup
(ÿt1)è=ğ
NULL
 || 
	`­Ş_veùÜ_­³nd
(*
»moved
, cat1) < 0) {

738 
”rÜ
 = 
”ºo
;

739 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

740 
	`ä“
(
ÿt1
);

741 
ş—nup
;

744 ; 
j
 < 
	`­Ş_veùÜ_g‘_size
(
v2
); j++) {

745 
ÿt2
 = (*)
	`­Ş_veùÜ_g‘_–em’t
(
v2
, 
j
);

746 ià((
ÿt2
 = 
	`¡rdup
(ÿt2)è=ğ
NULL
 || 
	`­Ş_veùÜ_­³nd
(*
added
, cat2) < 0) {

747 
”rÜ
 = 
”ºo
;

748 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

749 
	`ä“
(
ÿt2
);

750 
ş—nup
;

753 ià(
	`­Ş_veùÜ_g‘_size
(*
added
è> 0 ||‡pŞ_veùÜ_g‘_size(*
»moved
) > 0) {

754 
»tv®
 = 1;

756 
»tv®
 = 0;

758 
ş—nup
:

759 ià(
»tv®
 <= 0) {

761 
	`­Ş_veùÜ_de¡roy
(
added
);

762 
	`­Ş_veùÜ_de¡roy
(
»moved
);

763 
	`­Ş_veùÜ_de¡roy
(
unmodif›d
);

765 ià(
»tv®
 < 0) {

766 
”rÜ
 = 
”ºo
;

768  
»tv®
;

769 
	}
}

	@libpoldiff/src/level_internal.h

27 #iâdeà
POLDIFF_LEVEL_INTERNAL_H


28 
	#POLDIFF_LEVEL_INTERNAL_H


	)

30 #ifdef 
__ılu¥lus


35 
pŞdiff_Ëv–_summ¬y
 
	tpŞdiff_Ëv–_summ¬y_t
;

37 
	spŞdiff_Ëv–


39 *
Çme
;

40 
pŞdiff_fÜm_e
 
fÜm
;

41 
­Ş_veùÜ_t
 *
added_ÿts
;

42 
­Ş_veùÜ_t
 *
»moved_ÿts
;

43 
­Ş_veùÜ_t
 *
unmodif›d_ÿts
;

52 
pŞdiff_Ëv–_summ¬y_t
 *
Ëv–_ü—‹
();

62 
Ëv–_de¡roy
(
pŞdiff_Ëv–_summ¬y_t
 ** 
ls
);

71 
Ëv–_»£t
(
pŞdiff_t
 * 
diff
);

83 
­Ş_veùÜ_t
 *
Ëv–_g‘_™ems
(
pŞdiff_t
 * 
diff
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
);

97 
Ëv–_comp
(cÚ¡ *
x
, cÚ¡ *
y
, cÚ¡ 
pŞdiff_t
 * 
diff
);

110 
Ëv–_Ãw_diff
(
pŞdiff_t
 * 
diff
, 
pŞdiff_fÜm_e
 
fÜm
, cÚ¡ *
™em
);

126 
Ëv–_d“p_diff
(
pŞdiff_t
 * 
diff
, cÚ¡ *
x
, cÚ¡ *
y
);

145 
pŞdiff_Ëv–_t
 *
Ëv–_ü—‹_äom_­Ş_mls_Ëv–
(cÚ¡ 
­Ş_mls_Ëv–_t
 * 
Ëv–
, 
pŞdiff_fÜm_e
 
fÜm
);

154 
Ëv–_ä“
(*
–em
);

175 
Ëv–_d“p_diff_­Ş_mls_Ëv–s
(
pŞdiff_t
 * 
diff
, cÚ¡ 
­Ş_mls_Ëv–_t
 * 
Ëv–1
, cÚ¡‡pŞ_mls_Ëv–_ˆ* 
Ëv–2
,

176 
pŞdiff_Ëv–_t
 ** 
Üig_¶
,…Şdiff_Ëv–_ˆ** 
mod_¶
);

201 
Ëv–_d“p_diff_ÿts
(
pŞdiff_t
 * 
diff
, cÚ¡ 
­Ş_veùÜ_t
 * 
v1
, cÚ¡‡pŞ_veùÜ_ˆ* 
v2
,‡pŞ_veùÜ_ˆ** 
added
,

202 
­Ş_veùÜ_t
 ** 
»moved
,‡pŞ_veùÜ_ˆ** 
unmodif›d
);

204 #ifdef 
__ılu¥lus


	@libpoldiff/src/poldiff.c

25 
	~<cÚfig.h
>

27 
	~"pŞdiff_š‹º®.h
"

28 
	~<pŞdiff/compÚ’t_»cÜd.h
>

30 
	~<­Ş/ut.h
>

31 
	~<qpŞ/pŞicy_ex‹nd.h
>

32 
	~<”ºo.h
>

33 
	~<¡dio.h
>

34 
	~<¡ršg.h
>

41 
	spŞdiff_compÚ’t_»cÜd


43 cÚ¡ *
	m™em_Çme
;

44 
ušt32_t
 
	mæag_b™
;

45 
pŞdiff_g‘_™em_¡©s_â_t
 
	mg‘_¡©s
;

46 
pŞdiff_g‘_»suÉ_™ems_â_t
 
	mg‘_»suÉs
;

47 
pŞdiff_™em_g‘_fÜm_â_t
 
	mg‘_fÜm
;

48 
pŞdiff_™em_to_¡ršg_â_t
 
	mto_¡ršg
;

49 
pŞdiff_»£t_â_t
 
	m»£t
;

50 
pŞdiff_g‘_™ems_â_t
 
	mg‘_™ems
;

51 
pŞdiff_™em_comp_â_t
 
	mcomp
;

52 
pŞdiff_Ãw_diff_â_t
 
	mÃw_diff
;

53 
pŞdiff_d“p_diff_â_t
 
	md“p_diff
;

56 cÚ¡ 
pŞdiff_compÚ’t_»cÜd_t
 
	gcompÚ’t_»cÜds
[] = {

59 
POLDIFF_DIFF_ATTRIBS
,

60 
pŞdiff_©Œib_g‘_¡©s
,

61 
pŞdiff_g‘_©Œib_veùÜ
,

62 
pŞdiff_©Œib_g‘_fÜm
,

63 
pŞdiff_©Œib_to_¡ršg
,

64 
©Œib_»£t
,

65 
©Œib_g‘_™ems
,

66 
©Œib_comp
,

67 
©Œib_Ãw_diff
,

68 
©Œib_d“p_diff
,

72 
POLDIFF_DIFF_AVALLOW
,

73 
pŞdiff_avruË_g‘_¡©s_®low
,

74 
pŞdiff_g‘_avruË_veùÜ_®low
,

75 
pŞdiff_avruË_g‘_fÜm
,

76 
pŞdiff_avruË_to_¡ršg
,

77 
avruË_»£t_®low
,

78 
avruË_g‘_™ems_®low
,

79 
avruË_comp
,

80 
avruË_Ãw_diff_®low
,

81 
avruË_d“p_diff_®low
,

85 
POLDIFF_DIFF_AVAUDITALLOW
,

86 
pŞdiff_avruË_g‘_¡©s_aud™®low
,

87 
pŞdiff_g‘_avruË_veùÜ_aud™®low
,

88 
pŞdiff_avruË_g‘_fÜm
,

89 
pŞdiff_avruË_to_¡ršg
,

90 
avruË_»£t_aud™®low
,

91 
avruË_g‘_™ems_aud™®low
,

92 
avruË_comp
,

93 
avruË_Ãw_diff_aud™®low
,

94 
avruË_d“p_diff_aud™®low
,

98 
POLDIFF_DIFF_AVDONTAUDIT
,

99 
pŞdiff_avruË_g‘_¡©s_dÚud™
,

100 
pŞdiff_g‘_avruË_veùÜ_dÚud™
,

101 
pŞdiff_avruË_g‘_fÜm
,

102 
pŞdiff_avruË_to_¡ršg
,

103 
avruË_»£t_dÚud™
,

104 
avruË_g‘_™ems_dÚud™
,

105 
avruË_comp
,

106 
avruË_Ãw_diff_dÚud™
,

107 
avruË_d“p_diff_dÚud™
,

111 
POLDIFF_DIFF_AVNEVERALLOW
,

112 
pŞdiff_avruË_g‘_¡©s_Ãv”®low
,

113 
pŞdiff_g‘_avruË_veùÜ_Ãv”®low
,

114 
pŞdiff_avruË_g‘_fÜm
,

115 
pŞdiff_avruË_to_¡ršg
,

116 
avruË_»£t_Ãv”®low
,

117 
avruË_g‘_™ems_Ãv”®low
,

118 
avruË_comp
,

119 
avruË_Ãw_diff_Ãv”®low
,

120 
avruË_d“p_diff_Ãv”®low
,

124 
POLDIFF_DIFF_BOOLS
,

125 
pŞdiff_boŞ_g‘_¡©s
,

126 
pŞdiff_g‘_boŞ_veùÜ
,

127 
pŞdiff_boŞ_g‘_fÜm
,

128 
pŞdiff_boŞ_to_¡ršg
,

129 
boŞ_»£t
,

130 
boŞ_g‘_™ems
,

131 
boŞ_comp
,

132 
boŞ_Ãw_diff
,

133 
boŞ_d“p_diff
,

137 
POLDIFF_DIFF_CATS
,

138 
pŞdiff_ÿt_g‘_¡©s
,

139 
pŞdiff_g‘_ÿt_veùÜ
,

140 
pŞdiff_ÿt_g‘_fÜm
,

141 
pŞdiff_ÿt_to_¡ršg
,

142 
ÿt_»£t
,

143 
ÿt_g‘_™ems
,

144 
ÿt_comp
,

145 
ÿt_Ãw_diff
,

146 
ÿt_d“p_diff
,

150 
POLDIFF_DIFF_CLASSES
,

151 
pŞdiff_şass_g‘_¡©s
,

152 
pŞdiff_g‘_şass_veùÜ
,

153 
pŞdiff_şass_g‘_fÜm
,

154 
pŞdiff_şass_to_¡ršg
,

155 
şass_»£t
,

156 
şass_g‘_™ems
,

157 
şass_comp
,

158 
şass_Ãw_diff
,

159 
şass_d“p_diff
,

163 
POLDIFF_DIFF_COMMONS
,

164 
pŞdiff_commÚ_g‘_¡©s
,

165 
pŞdiff_g‘_commÚ_veùÜ
,

166 
pŞdiff_commÚ_g‘_fÜm
,

167 
pŞdiff_commÚ_to_¡ršg
,

168 
commÚ_»£t
,

169 
commÚ_g‘_™ems
,

170 
commÚ_comp
,

171 
commÚ_Ãw_diff
,

172 
commÚ_d“p_diff
,

176 
POLDIFF_DIFF_LEVELS
,

177 
pŞdiff_Ëv–_g‘_¡©s
,

178 
pŞdiff_g‘_Ëv–_veùÜ
,

179 
pŞdiff_Ëv–_g‘_fÜm
,

180 
pŞdiff_Ëv–_to_¡ršg
,

181 
Ëv–_»£t
,

182 
Ëv–_g‘_™ems
,

183 
Ëv–_comp
,

184 
Ëv–_Ãw_diff
,

185 
Ëv–_d“p_diff
,

189 
POLDIFF_DIFF_RANGE_TRANS
,

190 
pŞdiff_¿nge_Œªs_g‘_¡©s
,

191 
pŞdiff_g‘_¿nge_Œªs_veùÜ
,

192 
pŞdiff_¿nge_Œªs_g‘_fÜm
,

193 
pŞdiff_¿nge_Œªs_to_¡ršg
,

194 
¿nge_Œªs_»£t
,

195 
¿nge_Œªs_g‘_™ems
,

196 
¿nge_Œªs_comp
,

197 
¿nge_Œªs_Ãw_diff
,

198 
¿nge_Œªs_d“p_diff
,

202 
POLDIFF_DIFF_ROLES
,

203 
pŞdiff_rŞe_g‘_¡©s
,

204 
pŞdiff_g‘_rŞe_veùÜ
,

205 
pŞdiff_rŞe_g‘_fÜm
,

206 
pŞdiff_rŞe_to_¡ršg
,

207 
rŞe_»£t
,

208 
rŞe_g‘_™ems
,

209 
rŞe_comp
,

210 
rŞe_Ãw_diff
,

211 
rŞe_d“p_diff
,

215 
POLDIFF_DIFF_ROLE_ALLOWS
,

216 
pŞdiff_rŞe_®low_g‘_¡©s
,

217 
pŞdiff_g‘_rŞe_®low_veùÜ
,

218 
pŞdiff_rŞe_®low_g‘_fÜm
,

219 
pŞdiff_rŞe_®low_to_¡ršg
,

220 
rŞe_®low_»£t
,

221 
rŞe_®low_g‘_™ems
,

222 
rŞe_®low_comp
,

223 
rŞe_®low_Ãw_diff
,

224 
rŞe_®low_d“p_diff
,

228 
POLDIFF_DIFF_ROLE_TRANS
,

229 
pŞdiff_rŞe_Œªs_g‘_¡©s
,

230 
pŞdiff_g‘_rŞe_Œªs_veùÜ
,

231 
pŞdiff_rŞe_Œªs_g‘_fÜm
,

232 
pŞdiff_rŞe_Œªs_to_¡ršg
,

233 
rŞe_Œªs_»£t
,

234 
rŞe_Œªs_g‘_™ems
,

235 
rŞe_Œªs_comp
,

236 
rŞe_Œªs_Ãw_diff
,

237 
rŞe_Œªs_d“p_diff
,

241 
POLDIFF_DIFF_TECHANGE
,

242 
pŞdiff_‹ruË_g‘_¡©s_chªge
,

243 
pŞdiff_g‘_‹ruË_veùÜ_chªge
,

244 
pŞdiff_‹ruË_g‘_fÜm
,

245 
pŞdiff_‹ruË_to_¡ršg
,

246 
‹ruË_»£t_chªge
,

247 
‹ruË_g‘_™ems_chªge
,

248 
‹ruË_comp
,

249 
‹ruË_Ãw_diff_chªge
,

250 
‹ruË_d“p_diff_chªge
,

254 
POLDIFF_DIFF_TEMEMBER
,

255 
pŞdiff_‹ruË_g‘_¡©s_memb”
,

256 
pŞdiff_g‘_‹ruË_veùÜ_memb”
,

257 
pŞdiff_‹ruË_g‘_fÜm
,

258 
pŞdiff_‹ruË_to_¡ršg
,

259 
‹ruË_»£t_memb”
,

260 
‹ruË_g‘_™ems_memb”
,

261 
‹ruË_comp
,

262 
‹ruË_Ãw_diff_memb”
,

263 
‹ruË_d“p_diff_memb”
,

267 
POLDIFF_DIFF_TETRANS
,

268 
pŞdiff_‹ruË_g‘_¡©s_Œªs
,

269 
pŞdiff_g‘_‹ruË_veùÜ_Œªs
,

270 
pŞdiff_‹ruË_g‘_fÜm
,

271 
pŞdiff_‹ruË_to_¡ršg
,

272 
‹ruË_»£t_Œªs
,

273 
‹ruË_g‘_™ems_Œªs
,

274 
‹ruË_comp
,

275 
‹ruË_Ãw_diff_Œªs
,

276 
‹ruË_d“p_diff_Œªs
,

280 
POLDIFF_DIFF_TYPES
,

281 
pŞdiff_ty³_g‘_¡©s
,

282 
pŞdiff_g‘_ty³_veùÜ
,

283 
pŞdiff_ty³_g‘_fÜm
,

284 
pŞdiff_ty³_to_¡ršg
,

285 
ty³_»£t
,

286 
ty³_g‘_™ems
,

287 
ty³_comp
,

288 
ty³_Ãw_diff
,

289 
ty³_d“p_diff
,

293 
POLDIFF_DIFF_USERS
,

294 
pŞdiff_u£r_g‘_¡©s
,

295 
pŞdiff_g‘_u£r_veùÜ
,

296 
pŞdiff_u£r_g‘_fÜm
,

297 
pŞdiff_u£r_to_¡ršg
,

298 
u£r_»£t
,

299 
u£r_g‘_™ems
,

300 
u£r_comp
,

301 
u£r_Ãw_diff
,

302 
u£r_d“p_diff
,

306 cÚ¡ 
pŞdiff_compÚ’t_»cÜd_t
 *
	$pŞdiff_g‘_compÚ’t_»cÜd
(
ušt32_t
 
which
)

308 
size_t
 
i
 = 0;

309 
size_t
 
num_™ems
;

311 
num_™ems
 = (
compÚ’t_»cÜds
è/ (
pŞdiff_compÚ’t_»cÜd_t
);

312 
i
 = 0; i < 
num_™ems
; i++) {

313 ià(
compÚ’t_»cÜds
[
i
].
æag_b™
 =ğ
which
)

314  &
compÚ’t_»cÜds
[
i
];

316  
NULL
;

317 
	}
}

319 
pŞdiff_t
 *
	$pŞdiff_ü—‹
(
­Ş_pŞicy_t
 * 
Üig_pŞicy
,‡pŞ_pŞicy_ˆ* 
mod_pŞicy
, 
pŞdiff_hªdË_â_t
 
â
, *
ÿÎback_¬g
)

321 
pŞdiff_t
 *
diff
 = 
NULL
;

322 
”rÜ
;

324 ià(!
Üig_pŞicy
 || !
mod_pŞicy
) {

325 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
EINVAL
));

326 
”ºo
 = 
EINVAL
;

327  
NULL
;

330 ià(!(
diff
 = 
	`ÿÎoc
(1, (
pŞdiff_t
)))) {

331 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

332 
”ºo
 = 
ENOMEM
;

333  
NULL
;

335 
diff
->
Üig_pŞ
 = 
Üig_pŞicy
;

336 
diff
->
mod_pŞ
 = 
mod_pŞicy
;

337 
diff
->
Üig_qpŞ
 = 
	`­Ş_pŞicy_g‘_qpŞ
(diff->
Üig_pŞ
);

338 
diff
->
mod_qpŞ
 = 
	`­Ş_pŞicy_g‘_qpŞ
(diff->
mod_pŞ
);

339 
diff
->
â
 = fn;

340 
diff
->
hªdË_¬g
 = 
ÿÎback_¬g
;

341 ià((
diff
->
ty³_m­
 = 
	`ty³_m­_ü—‹
()è=ğ
NULL
) {

342 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

343 
	`pŞdiff_de¡roy
(&
diff
);

344 
”ºo
 = 
ENOMEM
;

345  
NULL
;

347 ià(
	`ty³_m­_šãr
(
diff
) < 0) {

348 
”rÜ
 = 
”ºo
;

349 
	`pŞdiff_de¡roy
(&
diff
);

350 
”ºo
 = 
”rÜ
;

351  
NULL
;

354 ià((
diff
->
©Œib_diffs
 = 
	`©Œib_summ¬y_ü—‹
()è=ğ
NULL
 ||

355 (
diff
->
avruË_diffs
[
AVRULE_OFFSET_ALLOW
] = 
	`avruË_ü—‹
()è=ğ
NULL
 ||

356 (
diff
->
avruË_diffs
[
AVRULE_OFFSET_AUDITALLOW
] = 
	`avruË_ü—‹
()è=ğ
NULL
 ||

357 (
diff
->
avruË_diffs
[
AVRULE_OFFSET_DONTAUDIT
] = 
	`avruË_ü—‹
()è=ğ
NULL
 ||

358 (
diff
->
avruË_diffs
[
AVRULE_OFFSET_NEVERALLOW
] = 
	`avruË_ü—‹
()è=ğ
NULL
 ||

359 (
diff
->
boŞ_diffs
 = 
	`boŞ_ü—‹
()è=ğ
NULL
 ||

360 (
diff
->
ÿt_diffs
 = 
	`ÿt_ü—‹
()è=ğ
NULL
 ||

361 (
diff
->
şass_diffs
 = 
	`şass_ü—‹
()è=ğ
NULL
 ||

362 (
diff
->
commÚ_diffs
 = 
	`commÚ_ü—‹
()è=ğ
NULL
 ||

363 (
diff
->
Ëv–_diffs
 = 
	`Ëv–_ü—‹
()è=ğ
NULL
 ||

364 (
diff
->
¿nge_Œªs_diffs
 = 
	`¿nge_Œªs_ü—‹
()è=ğ
NULL
 ||

365 (
diff
->
rŞe_diffs
 = 
	`rŞe_ü—‹
()è=ğ
NULL
 ||

366 (
diff
->
rŞe_®low_diffs
 = 
	`rŞe_®low_ü—‹
()è=ğ
NULL
 ||

367 (
diff
->
rŞe_Œªs_diffs
 = 
	`rŞe_Œªs_ü—‹
()è=ğ
NULL
 ||

368 (
diff
->
‹ruË_diffs
[
TERULE_OFFSET_CHANGE
] = 
	`‹ruË_ü—‹
()è=ğ
NULL
 ||

369 (
diff
->
‹ruË_diffs
[
TERULE_OFFSET_MEMBER
] = 
	`‹ruË_ü—‹
()è=ğ
NULL
 ||

370 (
diff
->
‹ruË_diffs
[
TERULE_OFFSET_TRANS
] = 
	`‹ruË_ü—‹
()è=ğ
NULL
 ||

371 (
diff
->
ty³_diffs
 = 
	`ty³_summ¬y_ü—‹
()è=ğ
NULL
 || (diff->
u£r_diffs
 = 
	`u£r_ü—‹
()) == NULL) {

372 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

373 
	`pŞdiff_de¡roy
(&
diff
);

374 
”ºo
 = 
ENOMEM
;

375  
NULL
;

378 
diff
->
pŞicy_İts
 = 
QPOL_POLICY_OPTION_NO_RULES
 | 
QPOL_POLICY_OPTION_NO_NEVERALLOWS
;

379  
diff
;

380 
	}
}

382 
	$pŞdiff_de¡roy
(
pŞdiff_t
 ** 
diff
)

384 ià(!
diff
 || !(*diff))

386 
	`­Ş_pŞicy_de¡roy
(&(*
diff
)->
Üig_pŞ
);

387 
	`­Ş_pŞicy_de¡roy
(&(*
diff
)->
mod_pŞ
);

388 
	`­Ş_b¡_de¡roy
(&(*
diff
)->
şass_b¡
);

389 
	`­Ş_b¡_de¡roy
(&(*
diff
)->
³rm_b¡
);

390 
	`­Ş_b¡_de¡roy
(&(*
diff
)->
boŞ_b¡
);

392 
	`ty³_m­_de¡roy
(&(*
diff
)->
ty³_m­
);

393 
	`©Œib_summ¬y_de¡roy
(&(*
diff
)->
©Œib_diffs
);

394 
	`avruË_de¡roy
(&(*
diff
)->
avruË_diffs
[
AVRULE_OFFSET_ALLOW
]);

395 
	`avruË_de¡roy
(&(*
diff
)->
avruË_diffs
[
AVRULE_OFFSET_AUDITALLOW
]);

396 
	`avruË_de¡roy
(&(*
diff
)->
avruË_diffs
[
AVRULE_OFFSET_DONTAUDIT
]);

397 
	`avruË_de¡roy
(&(*
diff
)->
avruË_diffs
[
AVRULE_OFFSET_NEVERALLOW
]);

398 
	`boŞ_de¡roy
(&(*
diff
)->
boŞ_diffs
);

399 
	`ÿt_de¡roy
(&(*
diff
)->
ÿt_diffs
);

400 
	`şass_de¡roy
(&(*
diff
)->
şass_diffs
);

401 
	`commÚ_de¡roy
(&(*
diff
)->
commÚ_diffs
);

402 
	`Ëv–_de¡roy
(&(*
diff
)->
Ëv–_diffs
);

403 
	`¿nge_Œªs_de¡roy
(&(*
diff
)->
¿nge_Œªs_diffs
);

404 
	`rŞe_de¡roy
(&(*
diff
)->
rŞe_diffs
);

405 
	`rŞe_®low_de¡roy
(&(*
diff
)->
rŞe_®low_diffs
);

406 
	`rŞe_Œªs_de¡roy
(&(*
diff
)->
rŞe_Œªs_diffs
);

407 
	`u£r_de¡roy
(&(*
diff
)->
u£r_diffs
);

408 
	`‹ruË_de¡roy
(&(*
diff
)->
‹ruË_diffs
[
TERULE_OFFSET_CHANGE
]);

409 
	`‹ruË_de¡roy
(&(*
diff
)->
‹ruË_diffs
[
TERULE_OFFSET_MEMBER
]);

410 
	`‹ruË_de¡roy
(&(*
diff
)->
‹ruË_diffs
[
TERULE_OFFSET_TRANS
]);

411 
	`ty³_summ¬y_de¡roy
(&(*
diff
)->
ty³_diffs
);

412 
	`ä“
(*
diff
);

413 *
diff
 = 
NULL
;

414 
	}
}

431 
	$pŞdiff_do_™em_diff
(
pŞdiff_t
 * 
diff
, cÚ¡ 
pŞdiff_compÚ’t_»cÜd_t
 * 
compÚ’t_»cÜd
)

433 
­Ş_veùÜ_t
 *
p1_v
 = 
NULL
, *
p2_v
 = NULL;

434 
”rÜ
 = 0, 
»tv
;

435 
size_t
 
x
 = 0, 
y
 = 0;

436 *
™em_x
 = 
NULL
, *
™em_y
 = NULL;

438 ià(!
diff
 || !
compÚ’t_»cÜd
) {

439 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
EINVAL
));

440 
”ºo
 = 
EINVAL
;

443 
diff
->
diff_¡©us
 &ğ(~
compÚ’t_»cÜd
->
æag_b™
);

445 
	`INFO
(
diff
, "G‘tšg % ™em äom origš®…Şicy.", 
compÚ’t_»cÜd
->
™em_Çme
);

446 
p1_v
 = 
compÚ’t_»cÜd
->
	`g‘_™ems
(
diff
, diff->
Üig_pŞ
);

447 ià(!
p1_v
) {

448 
”rÜ
 = 
”ºo
;

449 
”r
;

452 
	`INFO
(
diff
, "G‘tšg % ™em äom modif›d…Şicy.", 
compÚ’t_»cÜd
->
™em_Çme
);

453 
p2_v
 = 
compÚ’t_»cÜd
->
	`g‘_™ems
(
diff
, diff->
mod_pŞ
);

454 ià(!
p2_v
) {

455 
”rÜ
 = 
”ºo
;

456 
”r
;

459 
	`INFO
(
diff
, "Fšdšg difã»nû š %s.", 
compÚ’t_»cÜd
->
™em_Çme
);

460 
x
 = 0, 
y
 = 0; x < 
	`­Ş_veùÜ_g‘_size
(
p1_v
);) {

461 ià(
y
 >ğ
	`­Ş_veùÜ_g‘_size
(
p2_v
))

463 
™em_x
 = 
	`­Ş_veùÜ_g‘_–em’t
(
p1_v
, 
x
);

464 
™em_y
 = 
	`­Ş_veùÜ_g‘_–em’t
(
p2_v
, 
y
);

465 
»tv
 = 
compÚ’t_»cÜd
->
	`comp
(
™em_x
, 
™em_y
, 
diff
);

466 ià(
»tv
 < 0) {

467 ià(
compÚ’t_»cÜd
->
	`Ãw_diff
(
diff
, 
POLDIFF_FORM_REMOVED
, 
™em_x
)) {

468 
”rÜ
 = 
”ºo
;

469 
”r
;

471 
x
++;

472 } ià(
»tv
 > 0) {

473 ià(
compÚ’t_»cÜd
->
	`Ãw_diff
(
diff
, 
POLDIFF_FORM_ADDED
, 
™em_y
)) {

474 
”rÜ
 = 
”ºo
;

475 
”r
;

477 
y
++;

479 ià(
compÚ’t_»cÜd
->
	`d“p_diff
(
diff
, 
™em_x
, 
™em_y
)) {

480 
”rÜ
 = 
”ºo
;

481 
”r
;

483 
x
++;

484 
y
++;

487 ; 
x
 < 
	`­Ş_veùÜ_g‘_size
(
p1_v
); x++) {

488 
™em_x
 = 
	`­Ş_veùÜ_g‘_–em’t
(
p1_v
, 
x
);

489 ià(
compÚ’t_»cÜd
->
	`Ãw_diff
(
diff
, 
POLDIFF_FORM_REMOVED
, 
™em_x
)) {

490 
”rÜ
 = 
”ºo
;

491 
”r
;

494 ; 
y
 < 
	`­Ş_veùÜ_g‘_size
(
p2_v
); y++) {

495 
™em_y
 = 
	`­Ş_veùÜ_g‘_–em’t
(
p2_v
, 
y
);

496 ià(
compÚ’t_»cÜd
->
	`Ãw_diff
(
diff
, 
POLDIFF_FORM_ADDED
, 
™em_y
)) {

497 
”rÜ
 = 
”ºo
;

498 
”r
;

502 
	`­Ş_veùÜ_de¡roy
(&
p1_v
);

503 
	`­Ş_veùÜ_de¡roy
(&
p2_v
);

504 
diff
->
diff_¡©us
 |ğ
compÚ’t_»cÜd
->
æag_b™
;

506 
”r
:

507 
	`­Ş_veùÜ_de¡roy
(&
p1_v
);

508 
	`­Ş_veùÜ_de¡roy
(&
p2_v
);

509 
”ºo
 = 
”rÜ
;

511 
	}
}

513 
	$pŞdiff_run
(
pŞdiff_t
 * 
diff
, 
ušt32_t
 
æags
)

515 
size_t
 
i
, 
num_™ems
;

517 ià(!
æags
)

520 ià(!
diff
) {

521 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
EINVAL
));

522 
”ºo
 = 
EINVAL
;

526 
pŞicy_İts
 = 
diff
->policy_opts;

527 ià(
æags
 & (
POLDIFF_DIFF_AVRULES
 | 
POLDIFF_DIFF_TERULES
)) {

528 
pŞicy_İts
 &ğ~(
QPOL_POLICY_OPTION_NO_RULES
);

530 ià(
æags
 & 
POLDIFF_DIFF_AVNEVERALLOW
) {

531 
pŞicy_İts
 &ğ~(
QPOL_POLICY_OPTION_NO_NEVERALLOWS
);

533 ià(
pŞicy_İts
 !ğ
diff
->policy_opts) {

534 
	`INFO
(
diff
, "%s", "Loading„ules from original…olicy.");

535 ià(
	`qpŞ_pŞicy_»bud
(
diff
->
Üig_qpŞ
, 
pŞicy_İts
)) {

538 
	`INFO
(
diff
, "%s", "Loading„ules from modified…olicy.");

539 ià(
	`qpŞ_pŞicy_»bud
(
diff
->
mod_qpŞ
, 
pŞicy_İts
)) {

543 
diff
->
»m­³d
 = 1;

544 
diff
->
pŞicy_İts
 =…olicy_opts;

547 
num_™ems
 = (
compÚ’t_»cÜds
è/ (
pŞdiff_compÚ’t_»cÜd_t
);

548 ià(
diff
->
»m­³d
) {

549 
i
 = 0; i < 
num_™ems
; i++) {

550 ià(
compÚ’t_»cÜds
[
i
].
æag_b™
 & 
POLDIFF_DIFF_REMAPPED
) {

551 
	`INFO
(
diff
, "Re£‰šg % diff.", 
compÚ’t_»cÜds
[
i
].
™em_Çme
);

552 ià(
compÚ’t_»cÜds
[
i
].
	`»£t
(
diff
))

556 
diff
->
diff_¡©us
 &ğ~(
POLDIFF_DIFF_REMAPPED
);

557 
diff
->
»m­³d
 = 0;

560 
	`INFO
(
diff
, "%s", "Buildingype map.");

561 ià(
	`ty³_m­_bud
(
diff
)) {

565 
diff
->
lše_numb”s_’abËd
 = 0;

566 
i
 = 0; i < 
num_™ems
; i++) {

568 ià((
æags
 & 
compÚ’t_»cÜds
[
i
].
æag_b™
è&& !(compÚ’t_»cÜds[i].æag_b™ & 
diff
->
diff_¡©us
)) {

569 
	`INFO
(
diff
, "RuÂšg % diff.", 
compÚ’t_»cÜds
[
i
].
™em_Çme
);

570 ià(
	`pŞdiff_do_™em_diff
(
diff
, &(
compÚ’t_»cÜds
[
i
]))) {

577 
	}
}

579 
	$pŞdiff_is_run
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
ušt32_t
 
æags
)

581 ià(!
æags
)

584 ià(!
diff
) {

585 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
EINVAL
));

586 
”ºo
 = 
EINVAL
;

589 ià((
diff
->
diff_¡©us
 & 
æags
) == flags) {

593 
	}
}

595 
	$pŞdiff_g‘_¡©s
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
ušt32_t
 
æags
, 
size_t
 
¡©s
[5])

597 
size_t
 
i
, 
j
, 
num_™ems
, 
tmp_¡©s
[5] = { 0, 0, 0, 0, 0 };

599 ià(!
diff
 || !
æags
) {

600 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
EINVAL
));

601 
”ºo
 = 
EINVAL
;

605 
¡©s
[0] = stats[1] = stats[2] = stats[3] = stats[4] = 0;

607 
num_™ems
 = (
compÚ’t_»cÜds
è/ (
pŞdiff_compÚ’t_»cÜd_t
);

608 
i
 = 0; i < 
num_™ems
; i++) {

609 ià(
æags
 & 
compÚ’t_»cÜds
[
i
].
æag_b™
) {

610 
compÚ’t_»cÜds
[
i
].
	`g‘_¡©s
(
diff
, 
tmp_¡©s
);

611 
j
 = 0; j < 5; j++)

612 
¡©s
[
j
] +ğ
tmp_¡©s
[j];

617 
	}
}

619 
	$pŞdiff_’abË_lše_numb”s
(
pŞdiff_t
 * 
diff
)

621 
»tv®
;

622 ià(
diff
 =ğ
NULL
) {

623 
”ºo
 = 
EINVAL
;

626 ià(!
diff
->
lše_numb”s_’abËd
) {

627 ià(
	`qpŞ_pŞicy_bud_syn_ruË_bË
(
diff
->
Üig_qpŞ
))

629 ià(
	`qpŞ_pŞicy_bud_syn_ruË_bË
(
diff
->
mod_qpŞ
))

631 ià((
»tv®
 = 
	`avruË_’abË_lše_numb”s
(
diff
, 
AVRULE_OFFSET_ALLOW
)) < 0) {

632  
»tv®
;

634 ià((
»tv®
 = 
	`avruË_’abË_lše_numb”s
(
diff
, 
AVRULE_OFFSET_AUDITALLOW
)) < 0) {

635  
»tv®
;

637 ià((
»tv®
 = 
	`avruË_’abË_lše_numb”s
(
diff
, 
AVRULE_OFFSET_DONTAUDIT
)) < 0) {

638  
»tv®
;

640 ià((
»tv®
 = 
	`avruË_’abË_lše_numb”s
(
diff
, 
AVRULE_OFFSET_NEVERALLOW
)) < 0) {

641  
»tv®
;

643 ià((
»tv®
 = 
	`‹ruË_’abË_lše_numb”s
(
diff
, 
TERULE_OFFSET_CHANGE
)) < 0) {

644  
»tv®
;

646 ià((
»tv®
 = 
	`‹ruË_’abË_lše_numb”s
(
diff
, 
TERULE_OFFSET_MEMBER
)) < 0) {

647  
»tv®
;

649 ià((
»tv®
 = 
	`‹ruË_’abË_lše_numb”s
(
diff
, 
TERULE_OFFSET_TRANS
)) < 0) {

650  
»tv®
;

652 
diff
->
lše_numb”s_’abËd
 = 1;

655 
	}
}

657 
	$pŞdiff_bud_b¡s
(
pŞdiff_t
 * 
diff
)

659 
­Ş_veùÜ_t
 *
şas£s
[2] = { 
NULL
, NULL };

660 
­Ş_veùÜ_t
 *
³rms
[2] = { 
NULL
, NULL };

661 
­Ş_veùÜ_t
 *
boŞs
[2] = { 
NULL
, NULL };

662 
size_t
 
i
, 
j
;

663 cÚ¡ 
qpŞ_şass_t
 *
şs
;

664 
qpŞ_boŞ_t
 *
qboŞ
;

665 cÚ¡ *
Çme
;

666 *
Ãw_Çme
;

667 
»tv®
 = -1, 
”rÜ
 = 0;

668 ià(
diff
->
şass_b¡
 !ğ
NULL
) {

671 ià((
diff
->
şass_b¡
 = 
	`­Ş_b¡_ü—‹
(
­Ş_¡r_¡rcmp
, 
ä“
)è=ğ
NULL
 ||

672 (
diff
->
³rm_b¡
 = 
	`­Ş_b¡_ü—‹
(
­Ş_¡r_¡rcmp
, 
ä“
)è=ğ
NULL
 ||

673 (
diff
->
boŞ_b¡
 = 
	`­Ş_b¡_ü—‹
(
­Ş_¡r_¡rcmp
, 
ä“
)è=ğ
NULL
) {

674 
”rÜ
 = 
”ºo
;

675 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

676 
ş—nup
;

678 
i
 = 0; i < 2; i++) {

679 
­Ş_pŞicy_t
 *
p
 = (
i
 =ğ0 ? 
diff
->
Üig_pŞ
 : diff->
mod_pŞ
);

680 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
p
);

681 ià(
	`­Ş_şass_g‘_by_qu”y
(
p
, 
NULL
, &
şas£s
[
i
]) < 0 ||

682 
	`­Ş_³rm_g‘_by_qu”y
(
p
, 
NULL
, &
³rms
[
i
]è< 0 || 
	`­Ş_boŞ_g‘_by_qu”y
Õ, NULL, &
boŞs
[i]) < 0) {

683 
”rÜ
 = 
”ºo
;

684 
ş—nup
;

686 
j
 = 0; j < 
	`­Ş_veùÜ_g‘_size
(
şas£s
[
i
]); j++) {

687 
şs
 = 
	`­Ş_veùÜ_g‘_–em’t
(
şas£s
[
i
], 
j
);

688 ià(
	`qpŞ_şass_g‘_Çme
(
q
, 
şs
, &
Çme
) < 0) {

689 
”rÜ
 = 
”ºo
;

690 
ş—nup
;

692 ià((
Ãw_Çme
 = 
	`¡rdup
(
Çme
)è=ğ
NULL
 ||

693 
	`­Ş_b¡_š£¹_ªd_g‘
(
diff
->
şass_b¡
, (**)&
Ãw_Çme
, 
NULL
) < 0) {

694 
”rÜ
 = 
”ºo
;

695 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

696 
ş—nup
;

699 
j
 = 0; j < 
	`­Ş_veùÜ_g‘_size
(
³rms
[
i
]); j++) {

700 
Çme
 = (*)
	`­Ş_veùÜ_g‘_–em’t
(
³rms
[
i
], 
j
);

701 ià((
Ãw_Çme
 = 
	`¡rdup
(
Çme
)è=ğ
NULL
 ||

702 
	`­Ş_b¡_š£¹_ªd_g‘
(
diff
->
³rm_b¡
, (**)&
Ãw_Çme
, 
NULL
) < 0) {

703 
”rÜ
 = 
”ºo
;

704 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

705 
ş—nup
;

708 
j
 = 0; j < 
	`­Ş_veùÜ_g‘_size
(
boŞs
[
i
]); j++) {

709 
qboŞ
 = (
qpŞ_boŞ_t
 *è
	`­Ş_veùÜ_g‘_–em’t
(
boŞs
[
i
], 
j
);

710 ià(
	`qpŞ_boŞ_g‘_Çme
(
q
, 
qboŞ
, &
Çme
) < 0) {

711 
”rÜ
 = 
”ºo
;

712 
ş—nup
;

714 ià((
Ãw_Çme
 = 
	`¡rdup
(
Çme
)è=ğ
NULL
 ||

715 
	`­Ş_b¡_š£¹_ªd_g‘
(
diff
->
boŞ_b¡
, (**)&
Ãw_Çme
, 
NULL
) < 0) {

716 
”rÜ
 = 
”ºo
;

717 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

718 
ş—nup
;

722 
»tv®
 = 0;

723 
ş—nup
:

724 
	`­Ş_veùÜ_de¡roy
(&
şas£s
[0]);

725 
	`­Ş_veùÜ_de¡roy
(&
şas£s
[1]);

726 
	`­Ş_veùÜ_de¡roy
(&
³rms
[0]);

727 
	`­Ş_veùÜ_de¡roy
(&
³rms
[1]);

728 
	`­Ş_veùÜ_de¡roy
(&
boŞs
[0]);

729 
	`­Ş_veùÜ_de¡roy
(&
boŞs
[1]);

730 
”ºo
 = 
”rÜ
;

731  
»tv®
;

732 
	}
}

734 
pŞdiff_hªdË_deçuÉ_ÿÎback
(*
¬g
 
__©Œibu‹__
 ((
unu£d
)),

735 
pŞdiff_t
 * 
p
 
__©Œibu‹__
 ((
unu£d
)), 
Ëv–
, cÚ¡ *
fmt
, 
va_li¡
 
va_¬gs
)

737 
	gËv–
) {

738 
	gPOLDIFF_MSG_INFO
:

743 
	gPOLDIFF_MSG_WARN
:

745 
årštf
(
¡d”r
, "WARNING: ");

748 
	gPOLDIFF_MSG_ERR
:

751 
årštf
(
¡d”r
, "ERROR: ");

755 
vårštf
(
¡d”r
, 
fmt
, 
va_¬gs
);

756 
årštf
(
¡d”r
, "\n");

759 
	$pŞdiff_hªdË_msg
(cÚ¡ 
pŞdiff_t
 * 
p
, 
Ëv–
, cÚ¡ *
fmt
, ...)

761 
va_li¡
 
­
;

762 
	`va_¡¬t
(
­
, 
fmt
);

763 ià(
p
 =ğ
NULL
 ||…->
â
 == NULL) {

764 
	`pŞdiff_hªdË_deçuÉ_ÿÎback
(
NULL
, NULL, 
Ëv–
, 
fmt
, 
­
);

766 
p
->
	`â
Õ->
hªdË_¬g
,…, 
Ëv–
, 
fmt
, 
­
);

768 
	`va_’d
(
­
);

769 
	}
}

771 
pŞdiff_™em_g‘_fÜm_â_t
 
	$pŞdiff_compÚ’t_»cÜd_g‘_fÜm_â
(cÚ¡ 
pŞdiff_compÚ’t_»cÜd_t
 * 
diff
)

773 ià(!
diff
) {

774 
”ºo
 = 
EINVAL
;

775  
NULL
;

777  
diff
->
g‘_fÜm
;

778 
	}
}

780 
pŞdiff_™em_to_¡ršg_â_t
 
	$pŞdiff_compÚ’t_»cÜd_g‘_to_¡ršg_â
(cÚ¡ 
pŞdiff_compÚ’t_»cÜd_t
 * 
diff
)

782 ià(!
diff
) {

783 
”ºo
 = 
EINVAL
;

784  
NULL
;

786  
diff
->
to_¡ršg
;

787 
	}
}

789 
pŞdiff_g‘_™em_¡©s_â_t
 
	$pŞdiff_compÚ’t_»cÜd_g‘_¡©s_â
(cÚ¡ 
pŞdiff_compÚ’t_»cÜd_t
 * 
diff
)

791 ià(!
diff
) {

792 
”ºo
 = 
EINVAL
;

793  
NULL
;

795  
diff
->
g‘_¡©s
;

796 
	}
}

798 
pŞdiff_g‘_»suÉ_™ems_â_t
 
	$pŞdiff_compÚ’t_»cÜd_g‘_»suÉs_â
(cÚ¡ 
pŞdiff_compÚ’t_»cÜd_t
 * 
diff
)

800 ià(!
diff
) {

801 
”ºo
 = 
EINVAL
;

802  
NULL
;

804  
diff
->
g‘_»suÉs
;

805 
	}
}

807 cÚ¡ *
	$pŞdiff_compÚ’t_»cÜd_g‘_Ïb–
(cÚ¡ 
pŞdiff_compÚ’t_»cÜd_t
 * 
diff
)

809 ià(!
diff
) {

810 
”ºo
 = 
EINVAL
;

811  
NULL
;

813  
diff
->
™em_Çme
;

814 
	}
}

	@libpoldiff/src/poldiff_internal.h

25 #iâdeà
POLDIFF_POLDIFF_INTERNAL_H


26 
	#POLDIFF_POLDIFF_INTERNAL_H


	)

28 #ifdef 
__ılu¥lus


33 
	~<pŞdiff/pŞdiff.h
>

34 
	~<­Ş/b¡.h
>

38 
AVRULE_OFFSET_ALLOW
 = 0, 
AVRULE_OFFSET_AUDITALLOW
,

39 
AVRULE_OFFSET_DONTAUDIT
, 
AVRULE_OFFSET_NEVERALLOW
,

40 
AVRULE_OFFSET_MAX


41 } 
	tavruË_off£t_e
;

45 
TERULE_OFFSET_CHANGE
 = 0, 
TERULE_OFFSET_MEMBER
,

46 
TERULE_OFFSET_TRANS
,

47 
TERULE_OFFSET_MAX


48 } 
	t‹ruË_off£t_e
;

50 
	~"©Œib_š‹º®.h
"

51 
	~"avruË_š‹º®.h
"

52 
	~"boŞ_š‹º®.h
"

53 
	~"ÿt_š‹º®.h
"

54 
	~"şass_š‹º®.h
"

55 
	~"Ëv–_š‹º®.h
"

56 
	~"¿nge_š‹º®.h
"

57 
	~"¿nge_Œªs_š‹º®.h
"

58 
	~"rbac_š‹º®.h
"

59 
	~"rŞe_š‹º®.h
"

60 
	~"‹ruË_š‹º®.h
"

61 
	~"u£r_š‹º®.h
"

62 
	~"ty³_š‹º®.h
"

64 
	~"ty³_m­_š‹º®.h
"

67 
pŞdiff_©Œib_summ¬y
;

68 
pŞdiff_avruË_summ¬y
;

69 
pŞdiff_boŞ_summ¬y
;

70 
pŞdiff_ÿt_summ¬y
;

71 
pŞdiff_şass_summ¬y
;

72 
pŞdiff_commÚ_summ¬y
;

73 
pŞdiff_Ëv–_summ¬y
;

74 
pŞdiff_¿nge_Œªs_summ¬y
;

75 
pŞdiff_rŞe_summ¬y
;

76 
pŞdiff_rŞe_®low_summ¬y
;

77 
pŞdiff_rŞe_Œªs_summ¬y
;

78 
pŞdiff_‹ruË_summ¬y
;

79 
pŞdiff_ty³_summ¬y
;

80 
pŞdiff_u£r_summ¬y
;

83 
	spŞdiff


86 
­Ş_pŞicy_t
 *
Üig_pŞ
;

88 
­Ş_pŞicy_t
 *
mod_pŞ
;

90 
qpŞ_pŞicy_t
 *
Üig_qpŞ
;

92 
qpŞ_pŞicy_t
 *
mod_qpŞ
;

94 
lše_numb”s_’abËd
;

96 
­Ş_b¡_t
 *
şass_b¡
;

98 
­Ş_b¡_t
 *
³rm_b¡
;

100 
­Ş_b¡_t
 *
boŞ_b¡
;

101 
pŞdiff_hªdË_â_t
 
â
;

102 *
hªdË_¬g
;

104 
ušt32_t
 
diff_¡©us
;

105 
pŞdiff_©Œib_summ¬y
 *
©Œib_diffs
;

106 
pŞdiff_avruË_summ¬y
 *
avruË_diffs
[
AVRULE_OFFSET_MAX
];

107 
pŞdiff_boŞ_summ¬y
 *
boŞ_diffs
;

108 
pŞdiff_ÿt_summ¬y
 *
ÿt_diffs
;

109 
pŞdiff_şass_summ¬y
 *
şass_diffs
;

110 
pŞdiff_commÚ_summ¬y
 *
commÚ_diffs
;

111 
pŞdiff_Ëv–_summ¬y
 *
Ëv–_diffs
;

112 
pŞdiff_¿nge_Œªs_summ¬y
 *
¿nge_Œªs_diffs
;

113 
pŞdiff_rŞe_summ¬y
 *
rŞe_diffs
;

114 
pŞdiff_rŞe_®low_summ¬y
 *
rŞe_®low_diffs
;

115 
pŞdiff_rŞe_Œªs_summ¬y
 *
rŞe_Œªs_diffs
;

116 
pŞdiff_‹ruË_summ¬y
 *
‹ruË_diffs
[
TERULE_OFFSET_MAX
];

117 
pŞdiff_ty³_summ¬y
 *
ty³_diffs
;

118 
pŞdiff_u£r_summ¬y
 *
u£r_diffs
;

120 
ty³_m­_t
 *
ty³_m­
;

122 
pŞicy_İts
;

124 
»m­³d
;

138 
­Ş_veùÜ_t
 *(*
	tpŞdiff_g‘_™ems_â_t
è(
	tpŞdiff_t
 * 
	tdiff
, cÚ¡ 
	t­Ş_pŞicy_t
 * 
	tpŞicy
);

156 (*
pŞdiff_™em_comp_â_t
è(cÚ¡ *
	tx
, cÚ¡ *
	ty
, cÚ¡ 
	tpŞdiff_t
 * 
	tdiff
);

169 (*
pŞdiff_Ãw_diff_â_t
è(
	tpŞdiff_t
 * 
	tdiff
, 
	tpŞdiff_fÜm_e
 
	tfÜm
, cÚ¡ *
	t™em
);

185 (*
pŞdiff_d“p_diff_â_t
è(
	tpŞdiff_t
 * 
	tdiff
, cÚ¡ *
	tx
, cÚ¡ *
	ty
);

195 (*
pŞdiff_»£t_â_t
è(
	tpŞdiff_t
 * 
	tdiff
);

199 
	#POLDIFF_MSG_ERR
 1

	)

200 
	#POLDIFF_MSG_WARN
 2

	)

201 
	#POLDIFF_MSG_INFO
 3

	)

214 
__©Œibu‹__
 ((
fÜm©
(
´štf
, 3, 4))è
pŞdiff_hªdË_msg
(cÚ¡ 
pŞdiff_t
 * 
p
, 
Ëv–
, cÚ¡ *
fmt
, ...);

216 #undeà
ERR


217 #undeà
WARN


218 #undeà
INFO


220 
	#ERR
(
hªdË
, 
fÜm©
, ...è
	`pŞdiff_hªdË_msg
(hªdË, 
POLDIFF_MSG_ERR
, fÜm©, 
__VA_ARGS__
)

	)

221 
	#WARN
(
hªdË
, 
fÜm©
, ...è
	`pŞdiff_hªdË_msg
(hªdË, 
POLDIFF_MSG_WARN
, fÜm©, 
__VA_ARGS__
)

	)

222 
	#INFO
(
hªdË
, 
fÜm©
, ...è
	`pŞdiff_hªdË_msg
(hªdË, 
POLDIFF_MSG_INFO
, fÜm©, 
__VA_ARGS__
)

	)

233 
pŞdiff_bud_b¡s
(
pŞdiff_t
 * 
diff
);

235 #ifdef 
__ılu¥lus


	@libpoldiff/src/range_diff.c

25 
	~<cÚfig.h
>

27 
	~"pŞdiff_š‹º®.h
"

29 
	~<­Ş/ut.h
>

30 
	~<as£¹.h
>

31 
	~<”ºo.h
>

33 
	spŞdiff_¿nge


35 
­Ş_mls_¿nge_t
 *
	mÜig_¿nge
;

36 
­Ş_mls_¿nge_t
 *
	mmod_¿nge
;

38 
­Ş_veùÜ_t
 *
	mËv–s
;

39 
­Ş_veùÜ_t
 *
	mmš_added_ÿts
;

40 
­Ş_veùÜ_t
 *
	mmš_»moved_ÿts
;

41 
­Ş_veùÜ_t
 *
	mmš_unmodif›d_ÿts
;

44 
­Ş_veùÜ_t
 *
	$pŞdiff_¿nge_g‘_Ëv–s
(cÚ¡ 
pŞdiff_¿nge_t
 * 
¿nge
)

46 ià(
¿nge
 =ğ
NULL
) {

47 
”ºo
 = 
EINVAL
;

48  
NULL
;

50  
¿nge
->
Ëv–s
;

51 
	}
}

53 cÚ¡ 
­Ş_mls_¿nge_t
 *
	$pŞdiff_¿nge_g‘_Üigš®_¿nge
(cÚ¡ 
pŞdiff_¿nge_t
 * 
¿nge
)

55 ià(
¿nge
 =ğ
NULL
) {

56 
”ºo
 = 
EINVAL
;

57  
NULL
;

59  
¿nge
->
Üig_¿nge
;

60 
	}
}

62 cÚ¡ 
­Ş_mls_¿nge_t
 *
	$pŞdiff_¿nge_g‘_modif›d_¿nge
(cÚ¡ 
pŞdiff_¿nge_t
 * 
¿nge
)

64 ià(
¿nge
 =ğ
NULL
) {

65 
”ºo
 = 
EINVAL
;

66  
NULL
;

68  
¿nge
->
mod_¿nge
;

69 
	}
}

71 
­Ş_veùÜ_t
 *
	$pŞdiff_¿nge_g‘_mš_added_ÿts
(cÚ¡ 
pŞdiff_¿nge_t
 * 
¿nge
)

73 ià(
¿nge
 =ğ
NULL
) {

74 
”ºo
 = 
EINVAL
;

75  
NULL
;

77  
¿nge
->
mš_added_ÿts
;

78 
	}
}

80 
­Ş_veùÜ_t
 *
	$pŞdiff_¿nge_g‘_mš_»moved_ÿts
(cÚ¡ 
pŞdiff_¿nge_t
 * 
¿nge
)

82 ià(
¿nge
 =ğ
NULL
) {

83 
”ºo
 = 
EINVAL
;

84  
NULL
;

86  
¿nge
->
mš_»moved_ÿts
;

87 
	}
}

89 
­Ş_veùÜ_t
 *
	$pŞdiff_¿nge_g‘_mš_unmodif›d_ÿts
(cÚ¡ 
pŞdiff_¿nge_t
 * 
¿nge
)

91 ià(
¿nge
 =ğ
NULL
) {

92 
”ºo
 = 
EINVAL
;

93  
NULL
;

95  
¿nge
->
mš_unmodif›d_ÿts
;

96 
	}
}

98 *
	$pŞdiff_¿nge_to_¡ršg_br›f
(cÚ¡ 
pŞdiff_t
 * 
diff
, cÚ¡ 
pŞdiff_¿nge_t
 * 
¿nge
)

100 *
r1
 = 
NULL
, *
r2
 = NULL;

101 *
s
 = 
NULL
, *
t
 = NULL, *
£p
 = "", *
ÿt
;

102 
size_t
 
Ën
 = 0, 
i
;

103 ià(
¿nge
->
Üig_¿nge
 !ğ
NULL
 && (
r1
 = 
	`­Ş_mls_¿nge_»nd”
(
diff
->
Üig_pŞ
,„ange->orig_range)) == NULL) {

104 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”ºo
));

105 
ş—nup
;

107 ià(
¿nge
->
mod_¿nge
 !ğ
NULL
 && (
r2
 = 
	`­Ş_mls_¿nge_»nd”
(
diff
->
mod_pŞ
,„ange->mod_range)) == NULL) {

108 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”ºo
));

109 
ş—nup
;

111 
	`as£¹
(
r1
 !ğ
NULL
 || 
r2
 != NULL);

112 ià(
r1
 =ğ
NULL
) {

113 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "„ªge: %s\n", 
r2
) < 0) {

114 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”ºo
));

115 
ş—nup
;

117 } ià(
r2
 =ğ
NULL
) {

118 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "„ªge: %s\n", 
r1
) < 0) {

119 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”ºo
));

120 
ş—nup
;

123 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "„ªge: %  --> %s\n", 
r1
, 
r2
) < 0) {

124 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”ºo
));

125 
ş—nup
;

128 ià((
¿nge
->
mš_added_ÿts
 !ğ
NULL
 && 
	`­Ş_veùÜ_g‘_size
(range->min_added_cats) > 0) ||

129 (
¿nge
->
mš_»moved_ÿts
 !ğ
NULL
 && 
	`­Ş_veùÜ_g‘_size
(range->min_removed_cats) > 0) ||

130 (
¿nge
->
mš_unmodif›d_ÿts
 !ğ
NULL
 && 
	`­Ş_veùÜ_g‘_size
(range->min_unmodified_cats) > 0)) {

131 ià(
	`­Ş_¡r_­³nd
(&
s
, &
Ën
, " minimum categories: ") < 0) {

132 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”ºo
));

133 
ş—nup
;

135 
i
 = 0; 
¿nge
->
mš_unmodif›d_ÿts
 !ğ
NULL
 && i < 
	`­Ş_veùÜ_g‘_size
(range->min_unmodified_cats); i++) {

136 
ÿt
 = 
	`­Ş_veùÜ_g‘_–em’t
(
¿nge
->
mš_unmodif›d_ÿts
, 
i
);

137 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "%s%s", 
£p
, 
ÿt
) < 0) {

138 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”ºo
));

139  
NULL
;

141 
£p
 = ",";

143 
i
 = 0; 
¿nge
->
mš_added_ÿts
 !ğ
NULL
 && i < 
	`­Ş_veùÜ_g‘_size
(range->min_added_cats); i++) {

144 
ÿt
 = 
	`­Ş_veùÜ_g‘_–em’t
(
¿nge
->
mš_added_ÿts
, 
i
);

145 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "%s+%s", 
£p
, 
ÿt
) < 0) {

146 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”ºo
));

147  
NULL
;

149 
£p
 = ",";

151 
i
 = 0; 
¿nge
->
mš_»moved_ÿts
 !ğ
NULL
 && i < 
	`­Ş_veùÜ_g‘_size
(range->min_removed_cats); i++) {

152 
ÿt
 = 
	`­Ş_veùÜ_g‘_–em’t
(
¿nge
->
mš_»moved_ÿts
, 
i
);

153 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "%s-%s", 
£p
, 
ÿt
) < 0) {

154 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”ºo
));

155  
NULL
;

157 
£p
 = ",";

159 ià(
	`­Ş_¡r_­³nd
(&
s
, &
Ën
, "\n") < 0) {

160 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”ºo
));

161  
NULL
;

164 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
¿nge
->
Ëv–s
); i++) {

165 
pŞdiff_Ëv–_t
 *
Ëv–
 = 
	`­Ş_veùÜ_g‘_–em’t
(
¿nge
->
Ëv–s
, 
i
);

166 ià((
t
 = 
	`pŞdiff_Ëv–_to_¡ršg_br›f
(
diff
, 
Ëv–
)è=ğ
NULL
) {

167 
ş—nup
;

169 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, " %s", 
t
) < 0) {

170 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”ºo
));

171 
ş—nup
;

173 
	`ä“
(
t
);

174 
t
 = 
NULL
;

176 
ş—nup
:

177 
	`ä“
(
r1
);

178 
	`ä“
(
r2
);

179 
	`ä“
(
t
);

180  
s
;

181 
	}
}

183 
pŞdiff_¿nge_t
 *
	$¿nge_ü—‹
(cÚ¡ 
pŞdiff_t
 * 
diff
, cÚ¡ 
qpŞ_mls_¿nge_t
 * 
Üig_¿nge
, cÚ¡ qpŞ_mls_¿nge_ˆ* 
mod_¿nge
,

184 
pŞdiff_fÜm_e
 
fÜm
)

186 
pŞdiff_¿nge_t
 *
´
 = 
NULL
;

187 
­Ş_pŞicy_t
 *
p
;

188 
­Ş_mls_¿nge_t
 *
¿nge
;

189 
­Ş_veùÜ_t
 *
Ëv–s
 = 
NULL
;

190 
pŞdiff_Ëv–_t
 *
¶
 = 
NULL
;

191 
size_t
 
i
;

192 
»tv®
 = -1;

193 ià((
´
 = 
	`ÿÎoc
(1, (*´))è=ğ
NULL
 || (´->
Ëv–s
 = 
	`­Ş_veùÜ_ü—‹
(
Ëv–_ä“
)) == NULL) {

194 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”ºo
));

195 
ş—nup
;

197 ià(
Üig_¿nge
 !ğ
NULL
 && (
´
->Üig_¿ngğ
	`­Ş_mls_¿nge_ü—‹_äom_qpŞ_mls_¿nge
(
diff
->
Üig_pŞ
, orig_range)) == NULL) {

198 
ş—nup
;

200 ià(
mod_¿nge
 !ğ
NULL
 && (
´
->mod_¿ngğ
	`­Ş_mls_¿nge_ü—‹_äom_qpŞ_mls_¿nge
(
diff
->
mod_pŞ
, mod_range)) == NULL) {

201 
ş—nup
;

203 ià(
fÜm
 =ğ
POLDIFF_FORM_ADDED
 || fÜm =ğ
POLDIFF_FORM_ADD_TYPE
) {

204 
p
 = 
diff
->
mod_pŞ
;

205 
¿nge
 = 
´
->
mod_¿nge
;

206 } ià(
fÜm
 =ğ
POLDIFF_FORM_REMOVED
 || fÜm =ğ
POLDIFF_FORM_REMOVE_TYPE
) {

207 
p
 = 
diff
->
Üig_pŞ
;

208 
¿nge
 = 
´
->
Üig_¿nge
;

209 } ià(
fÜm
 =ğ
POLDIFF_FORM_MODIFIED
) {

211  
´
;

214 
	`as£¹
(0);

215  
´
;

217 ià((
Ëv–s
 = 
	`­Ş_mls_¿nge_g‘_Ëv–s
(
p
, 
¿nge
)è=ğ
NULL
) {

218 
ş—nup
;

220 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
Ëv–s
); i++) {

221 
­Ş_mls_Ëv–_t
 *
l
 = 
	`­Ş_veùÜ_g‘_–em’t
(
Ëv–s
, 
i
);

222 cÚ¡ *
£ns
 = 
	`­Ş_mls_Ëv–_g‘_£ns
(
l
);

223 cÚ¡ 
­Ş_veùÜ_t
 *
ÿts
 = 
	`­Ş_mls_Ëv–_g‘_ÿts
(
l
);

224 ià((
¶
 = 
	`ÿÎoc
(1, (*¶))è=ğ
NULL
 ||

225 (
¶
->
Çme
 = 
	`¡rdup
(
£ns
)è=ğ
NULL
 || (¶->
unmodif›d_ÿts
 = 
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(1, 
ä“
)) == NULL)

227 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”ºo
));

228 
ş—nup
;

230 ià(
fÜm
 =ğ
POLDIFF_FORM_ADDED
) {

231 ià((
¶
->
added_ÿts
 = 
	`­Ş_veùÜ_ü—‹_äom_veùÜ
(
ÿts
, 
­Ş_¡r_¡rdup
, 
NULL
, 
ä“
)) == NULL ||

232 (
¶
->
»moved_ÿts
 = 
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(1, 
ä“
)è=ğ
NULL
) {

233 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”ºo
));

234 
ş—nup
;

236 } ià(
fÜm
 =ğ
POLDIFF_FORM_REMOVED
) {

237 ià((
¶
->
added_ÿts
 = 
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(1, 
ä“
)è=ğ
NULL
 ||

238 (
¶
->
»moved_ÿts
 = 
	`­Ş_veùÜ_ü—‹_äom_veùÜ
(
ÿts
, 
­Ş_¡r_¡rdup
, 
NULL
, 
ä“
)) == NULL) {

239 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”ºo
));

240 
ş—nup
;

243 ià(
	`­Ş_veùÜ_­³nd
(
´
->
Ëv–s
, 
¶
) < 0) {

244 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”ºo
));

245 
ş—nup
;

247 
¶
 = 
NULL
;

249 
»tv®
 = 0;

250 
ş—nup
:

251 
	`­Ş_veùÜ_de¡roy
(&
Ëv–s
);

252 ià(
»tv®
 != 0) {

253 
	`Ëv–_ä“
(
¶
);

254 
	`¿nge_de¡roy
(&
´
);

255  
NULL
;

257  
´
;

258 
	}
}

260 
	$¿nge_de¡roy
(
pŞdiff_¿nge_t
 ** 
¿nge
)

262 ià(
¿nge
 !ğ
NULL
 && *range != NULL) {

263 
	`­Ş_mls_¿nge_de¡roy
(&(*
¿nge
)->
Üig_¿nge
);

264 
	`­Ş_mls_¿nge_de¡roy
(&(*
¿nge
)->
mod_¿nge
);

265 
	`­Ş_veùÜ_de¡roy
(&(*
¿nge
)->
Ëv–s
);

266 
	`­Ş_veùÜ_de¡roy
(&(*
¿nge
)->
mš_added_ÿts
);

267 
	`­Ş_veùÜ_de¡roy
(&(*
¿nge
)->
mš_»moved_ÿts
);

268 
	`­Ş_veùÜ_de¡roy
(&(*
¿nge
)->
mš_unmodif›d_ÿts
);

269 
	`ä“
(*
¿nge
);

270 *
¿nge
 = 
NULL
;

272 
	}
}

279 
¿nge_comp_®phab‘ize
(cÚ¡ *
a
, cÚ¡ *
b
, *
d©a
 
__©Œibu‹__
 ((
unu£d
)))

281 cÚ¡ 
­Ş_mls_Ëv–_t
 *
	gl1
 = 
a
;

282 cÚ¡ 
­Ş_mls_Ëv–_t
 *
	gl2
 = 
b
;

283 cÚ¡ *
	g£ns1
 = 
­Ş_mls_Ëv–_g‘_£ns
(
l1
);

284 cÚ¡ *
	g£ns2
 = 
­Ş_mls_Ëv–_g‘_£ns
(
l2
);

285  
¡rcmp
(
£ns1
, 
£ns2
);

293 
	$¿nge_comp
(cÚ¡ *
a
, cÚ¡ *
b
, *
d©a
)

295 cÚ¡ 
pŞdiff_Ëv–_t
 *
l1
 = 
a
;

296 cÚ¡ 
pŞdiff_Ëv–_t
 *
l2
 = 
b
;

297 
pŞdiff_t
 *
diff
 = 
d©a
;

298 
qpŞ_pŞicy_t
 *
q
;

299 cÚ¡ 
qpŞ_Ëv–_t
 *
ql1
, *
ql2
;

300 
ušt32_t
 
v1
, 
v2
;

301 ià(
l1
->
fÜm
 !ğ
l2
->form) {

302  
l1
->
fÜm
 - 
l2
->form;

304 ià(
l1
->
fÜm
 =ğ
POLDIFF_FORM_ADDED
) {

305 
q
 = 
diff
->
mod_qpŞ
;

307 
q
 = 
diff
->
Üig_qpŞ
;

309 
	`qpŞ_pŞicy_g‘_Ëv–_by_Çme
(
q
, 
l1
->
Çme
, &
ql1
);

310 
	`qpŞ_pŞicy_g‘_Ëv–_by_Çme
(
q
, 
l2
->
Çme
, &
ql2
);

311 
	`qpŞ_Ëv–_g‘_v®ue
(
q
, 
ql1
, &
v1
);

312 
	`qpŞ_Ëv–_g‘_v®ue
(
q
, 
ql2
, &
v2
);

313 
	`as£¹
(
v1
 !ğ0 && 
v2
 != 0);

314  
v1
 - 
v2
;

315 
	}
}

317 
	$¿nge_d“p_diff
(
pŞdiff_t
 * 
diff
, 
pŞdiff_¿nge_t
 * 
¿nge
)

319 
­Ş_veùÜ_t
 *
Üig_Ëv–s
 = 
NULL
, *
mod_Ëv–s
 = NULL;

320 
­Ş_veùÜ_t
 *
added
 = 
NULL
, *
»moved
 = NULL, *
unmodif›d
 = NULL;

321 
­Ş_mls_Ëv–_t
 *
l1
, *
l2
;

322 
pŞdiff_Ëv–_t
 *
¶1
, *
¶2
;

323 
size_t
 
i
, 
j
;

324 
»tv®
 = -1, 
difã»nûs_found
 = 0, 
compv®
;

325 ià((
Üig_Ëv–s
 = 
	`­Ş_mls_¿nge_g‘_Ëv–s
(
diff
->
Üig_pŞ
, 
¿nge
->
Üig_¿nge
)è=ğ
NULL
 ||

326 (
mod_Ëv–s
 = 
	`­Ş_mls_¿nge_g‘_Ëv–s
(
diff
->
mod_pŞ
, 
¿nge
->
mod_¿nge
)è=ğ
NULL
) {

327 
ş—nup
;

329 
	`­Ş_veùÜ_sÜt
(
Üig_Ëv–s
, 
¿nge_comp_®phab‘ize
, 
NULL
);

330 
	`­Ş_veùÜ_sÜt
(
mod_Ëv–s
, 
¿nge_comp_®phab‘ize
, 
NULL
);

331 
i
 = 
j
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
Üig_Ëv–s
);) {

332 ià(
j
 >ğ
	`­Ş_veùÜ_g‘_size
(
mod_Ëv–s
))

334 
l1
 = (
­Ş_mls_Ëv–_t
 *è
	`­Ş_veùÜ_g‘_–em’t
(
Üig_Ëv–s
, 
i
);

335 
l2
 = (
­Ş_mls_Ëv–_t
 *è
	`­Ş_veùÜ_g‘_–em’t
(
mod_Ëv–s
, 
j
);

336 
¶1
 = 
¶2
 = 
NULL
;

337 cÚ¡ *
£ns1
 = 
	`­Ş_mls_Ëv–_g‘_£ns
(
l1
);

338 cÚ¡ *
£ns2
 = 
	`­Ş_mls_Ëv–_g‘_£ns
(
l2
);

339 
compv®
 = 
	`¡rcmp
(
£ns1
, 
£ns2
);

340 ià(
compv®
 < 0) {

341 ià((
¶1
 = 
	`Ëv–_ü—‹_äom_­Ş_mls_Ëv–
(
l1
, 
POLDIFF_FORM_REMOVED
)è=ğ
NULL


342 || 
	`­Ş_veùÜ_­³nd
(
¿nge
->
Ëv–s
, 
¶1
) < 0) {

343 
	`Ëv–_ä“
(
¶1
);

344 
ş—nup
;

346 
difã»nûs_found
 = 1;

347 
i
++;

348 } ià(
compv®
 > 0) {

349 ià((
¶2
 = 
	`Ëv–_ü—‹_äom_­Ş_mls_Ëv–
(
l2
, 
POLDIFF_FORM_ADDED
)è=ğ
NULL


350 || 
	`­Ş_veùÜ_­³nd
(
¿nge
->
Ëv–s
, 
¶2
) < 0) {

351 
	`Ëv–_ä“
(
¶2
);

352 
ş—nup
;

354 
difã»nûs_found
 = 1;

355 
j
++;

357 ià(
	`Ëv–_d“p_diff_­Ş_mls_Ëv–s
(
diff
, 
l1
, 
l2
, &
¶1
, &
¶2
) < 0) {

358 
ş—nup
;

360 
	`as£¹
(
¶2
 =ğ
NULL
);

361 ià(
¶1
 !ğ
NULL
) {

362 ià(
	`­Ş_veùÜ_­³nd
(
¿nge
->
Ëv–s
, 
¶1
) < 0) {

363 
	`Ëv–_ä“
(
¶1
);

364 
ş—nup
;

366 
difã»nûs_found
 = 1;

368 
i
++;

369 
j
++;

372 ; 
i
 < 
	`­Ş_veùÜ_g‘_size
(
Üig_Ëv–s
); i++) {

373 
l1
 = (
­Ş_mls_Ëv–_t
 *è
	`­Ş_veùÜ_g‘_–em’t
(
Üig_Ëv–s
, 
i
);

374 ià((
¶1
 = 
	`Ëv–_ü—‹_äom_­Ş_mls_Ëv–
(
l1
, 
POLDIFF_FORM_REMOVED
)è=ğ
NULL


375 || 
	`­Ş_veùÜ_­³nd
(
¿nge
->
Ëv–s
, 
¶1
) < 0) {

376 
	`Ëv–_ä“
(
¶1
);

377 
ş—nup
;

379 
difã»nûs_found
 = 1;

381 ; 
j
 < 
	`­Ş_veùÜ_g‘_size
(
mod_Ëv–s
); j++) {

382 
l2
 = (
­Ş_mls_Ëv–_t
 *è
	`­Ş_veùÜ_g‘_–em’t
(
mod_Ëv–s
, 
j
);

383 ià((
¶2
 = 
	`Ëv–_ü—‹_äom_­Ş_mls_Ëv–
(
l2
, 
POLDIFF_FORM_ADDED
)è=ğ
NULL


384 || 
	`­Ş_veùÜ_­³nd
(
¿nge
->
Ëv–s
, 
¶2
) < 0) {

385 
	`Ëv–_ä“
(
¶2
);

386 
ş—nup
;

388 
difã»nûs_found
 = 1;

391 cÚ¡ 
­Ş_mls_Ëv–_t
 *
low1
 = 
	`­Ş_mls_¿nge_g‘_low
(
¿nge
->
Üig_¿nge
);

392 cÚ¡ 
­Ş_veùÜ_t
 *
ÿts1
 = 
	`­Ş_mls_Ëv–_g‘_ÿts
(
low1
);

393 cÚ¡ 
­Ş_mls_Ëv–_t
 *
low2
 = 
	`­Ş_mls_¿nge_g‘_low
(
¿nge
->
mod_¿nge
);

394 cÚ¡ 
­Ş_veùÜ_t
 *
ÿts2
 = 
	`­Ş_mls_Ëv–_g‘_ÿts
(
low2
);

395 
compv®
 = 
	`Ëv–_d“p_diff_ÿts
(
diff
, 
ÿts1
, 
ÿts2
, &
added
, &
»moved
, &
unmodif›d
);

396 ià(
compv®
 < 0) {

397 
ş—nup
;

398 } ià(
compv®
 > 0) {

399 
difã»nûs_found
 = 1;

400 
¿nge
->
mš_added_ÿts
 = 
added
;

401 
¿nge
->
mš_»moved_ÿts
 = 
»moved
;

402 
¿nge
->
mš_unmodif›d_ÿts
 = 
unmodif›d
;

403 
added
 = 
NULL
;

404 
»moved
 = 
NULL
;

405 
unmodif›d
 = 
NULL
;

407 ià(
difã»nûs_found
) {

408 
	`­Ş_veùÜ_sÜt
(
¿nge
->
Ëv–s
, 
¿nge_comp
, 
diff
);

409 
»tv®
 = 1;

411 
»tv®
 = 0;

413 
ş—nup
:

414 
	`­Ş_veùÜ_de¡roy
(&
Üig_Ëv–s
);

415 
	`­Ş_veùÜ_de¡roy
(&
mod_Ëv–s
);

416 
	`­Ş_veùÜ_de¡roy
(&
added
);

417 
	`­Ş_veùÜ_de¡roy
(&
»moved
);

418 
	`­Ş_veùÜ_de¡roy
(&
unmodif›d
);

419  
»tv®
;

420 
	}
}

	@libpoldiff/src/range_internal.h

25 #iâdeà
POLDIFF_RANGE_INTERNAL_H


26 
	#POLDIFF_RANGE_INTERNAL_H


	)

28 #ifdef 
__ılu¥lus


50 
pŞdiff_¿nge_t
 *
¿nge_ü—‹
(cÚ¡ 
pŞdiff_t
 * 
diff
, cÚ¡ 
qpŞ_mls_¿nge_t
 * 
Üig_¿nge
,

51 cÚ¡ 
qpŞ_mls_¿nge_t
 * 
mod_¿nge
, 
pŞdiff_fÜm_e
 
fÜm
);

59 
¿nge_de¡roy
(
pŞdiff_¿nge_t
 ** 
¿nge
);

74 
¿nge_d“p_diff
(
pŞdiff_t
 * 
diff
, 
pŞdiff_¿nge_t
 * 
¿nge
);

76 #ifdef 
__ılu¥lus


	@libpoldiff/src/range_trans_diff.c

26 
	~<cÚfig.h
>

28 
	~"pŞdiff_š‹º®.h
"

30 
	~<­Ş/mls-qu”y.h
>

31 
	~<­Ş/ut.h
>

32 
	~<as£¹.h
>

33 
	~<”ºo.h
>

34 
	~<¡dio.h
>

35 
	~<¡ršg.h
>

37 
	spŞdiff_¿nge_Œªs_summ¬y


39 
size_t
 
	mnum_added
;

40 
size_t
 
	mnum_»moved
;

41 
size_t
 
	mnum_modif›d
;

42 
size_t
 
	mnum_added_ty³
;

43 
size_t
 
	mnum_»moved_ty³
;

44 
­Ş_veùÜ_t
 *
	mdiffs
;

47 
	spŞdiff_¿nge_Œªs


49 *
	msourû
;

50 *
	mrg‘
;

51 *
	mrg‘_şass
;

52 
pŞdiff_fÜm_e
 
	mfÜm
;

53 
pŞdiff_¿nge_t
 *
	m¿nge
;

56 
	$pŞdiff_¿nge_Œªs_g‘_¡©s
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
size_t
 
¡©s
[5])

58 ià(
diff
 =ğ
NULL
 || 
¡©s
 == NULL) {

59 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
EINVAL
));

60 
”ºo
 = 
EINVAL
;

63 
¡©s
[0] = 
diff
->
¿nge_Œªs_diffs
->
num_added
;

64 
¡©s
[1] = 
diff
->
¿nge_Œªs_diffs
->
num_»moved
;

65 
¡©s
[2] = 
diff
->
¿nge_Œªs_diffs
->
num_modif›d
;

66 
¡©s
[3] = 
diff
->
¿nge_Œªs_diffs
->
num_added_ty³
;

67 
¡©s
[4] = 
diff
->
¿nge_Œªs_diffs
->
num_»moved_ty³
;

68 
	}
}

70 *
	$pŞdiff_¿nge_Œªs_to_¡ršg
(cÚ¡ 
pŞdiff_t
 * 
diff
, cÚ¡ *
¿nge_Œªs
)

72 cÚ¡ 
pŞdiff_¿nge_Œªs_t
 *
¹
 = 
¿nge_Œªs
;

73 cÚ¡ 
pŞdiff_¿nge_t
 *
¿nge
 = 
	`pŞdiff_¿nge_Œªs_g‘_¿nge
(
¹
);

74 cÚ¡ 
­Ş_mls_¿nge_t
 *
Üig_¿nge
 = 
	`pŞdiff_¿nge_g‘_Üigš®_¿nge
(
¿nge
);

75 cÚ¡ 
­Ş_mls_¿nge_t
 *
mod_¿nge
 = 
	`pŞdiff_¿nge_g‘_modif›d_¿nge
(
¿nge
);

76 
size_t
 
Ën
 = 0;

77 *
s
 = 
NULL
;

78 ià(
diff
 =ğ
NULL
 || 
¿nge_Œªs
 == NULL) {

79 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
EINVAL
));

80 
”ºo
 = 
EINVAL
;

81  
NULL
;

83 
¹
->
fÜm
) {

84 
POLDIFF_FORM_ADDED
:

85 
POLDIFF_FORM_ADD_TYPE
:

87 *
t
 = 
NULL
;

88 ià((
t
 = 
	`­Ş_mls_¿nge_»nd”
(
diff
->
mod_pŞ
, 
mod_¿nge
)è=ğ
NULL
 ||

89 
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "+„ªge_Œªs™iÚ % % : % %s;", 
¹
->
sourû
,„t->
rg‘
,

90 
¹
->
rg‘_şass
, 
t
) < 0) {

91 
	`ä“
(
t
);

92 
ş—nup
;

94 
	`ä“
(
t
);

95  
s
;

97 
POLDIFF_FORM_REMOVED
:

98 
POLDIFF_FORM_REMOVE_TYPE
:

100 *
t
 = 
NULL
;

101 ià((
t
 = 
	`­Ş_mls_¿nge_»nd”
(
diff
->
Üig_pŞ
, 
Üig_¿nge
)è=ğ
NULL
 ||

102 
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "-„ªge_Œªs™iÚ % % : % %s;", 
¹
->
sourû
,„t->
rg‘
,

103 
¹
->
rg‘_şass
, 
t
) < 0) {

104 
	`ä“
(
t
);

105 
ş—nup
;

107 
	`ä“
(
t
);

108  
s
;

110 
POLDIFF_FORM_MODIFIED
:

112 *
t
;

113 ià((
t
 = 
	`pŞdiff_¿nge_to_¡ršg_br›f
(
diff
, 
¿nge
)è=ğ
NULL
 ||

114 
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "*„ªge_Œªs™iÚ % % : %s\n%s", 
¹
->
sourû
,„t->
rg‘
,

115 
¹
->
rg‘_şass
, 
t
) < 0) {

116 
	`ä“
(
t
);

117 
ş—nup
;

119 
	`ä“
(
t
);

120  
s
;

124 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
ENOTSUP
));

125 
”ºo
 = 
ENOTSUP
;

126  
NULL
;

129 
ş—nup
:

131 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

132 
	`ä“
(
s
);

133 
”ºo
 = 
ENOMEM
;

134  
NULL
;

135 
	}
}

137 cÚ¡ 
­Ş_veùÜ_t
 *
	$pŞdiff_g‘_¿nge_Œªs_veùÜ
(cÚ¡ 
pŞdiff_t
 * 
diff
)

139 ià(
diff
 =ğ
NULL
) {

140 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
EINVAL
));

141 
”ºo
 = 
EINVAL
;

142  
NULL
;

144  
diff
->
¿nge_Œªs_diffs
->
diffs
;

145 
	}
}

147 cÚ¡ *
	$pŞdiff_¿nge_Œªs_g‘_sourû_ty³
(cÚ¡ 
pŞdiff_¿nge_Œªs_t
 * 
¿nge_Œªs
)

149 ià(
¿nge_Œªs
 =ğ
NULL
) {

150 
”ºo
 = 
EINVAL
;

151  
NULL
;

153  
¿nge_Œªs
->
sourû
;

154 
	}
}

156 cÚ¡ *
	$pŞdiff_¿nge_Œªs_g‘_rg‘_ty³
(cÚ¡ 
pŞdiff_¿nge_Œªs_t
 * 
¿nge_Œªs
)

158 ià(
¿nge_Œªs
 =ğ
NULL
) {

159 
”ºo
 = 
EINVAL
;

160  
NULL
;

162  
¿nge_Œªs
->
rg‘
;

163 
	}
}

165 cÚ¡ *
	$pŞdiff_¿nge_Œªs_g‘_rg‘_şass
(cÚ¡ 
pŞdiff_¿nge_Œªs_t
 * 
¿nge_Œªs
)

167 ià(
¿nge_Œªs
 =ğ
NULL
) {

168 
”ºo
 = 
EINVAL
;

169  
NULL
;

171  
¿nge_Œªs
->
rg‘_şass
;

172 
	}
}

174 cÚ¡ 
pŞdiff_¿nge_t
 *
	$pŞdiff_¿nge_Œªs_g‘_¿nge
(cÚ¡ 
pŞdiff_¿nge_Œªs_t
 * 
¿nge_Œªs
)

176 ià(
¿nge_Œªs
 =ğ
NULL
) {

177 
”ºo
 = 
EINVAL
;

178  
NULL
;

180  
¿nge_Œªs
->
¿nge
;

181 
	}
}

183 
pŞdiff_fÜm_e
 
	$pŞdiff_¿nge_Œªs_g‘_fÜm
(cÚ¡ *
¿nge_Œªs
)

185 ià(
¿nge_Œªs
 =ğ
NULL
) {

186 
”ºo
 = 
EINVAL
;

187  
POLDIFF_FORM_NONE
;

189  ((cÚ¡ 
pŞdiff_¿nge_Œªs_t
 *)
¿nge_Œªs
)->
fÜm
;

190 
	}
}

196 
	$¿nge_Œªs_ä“
(*
–em
)

198 ià(
–em
 !ğ
NULL
) {

199 
pŞdiff_¿nge_Œªs_t
 *
¹
 = (pŞdiff_¿nge_Œªs_ˆ*è
–em
;

200 
	`ä“
(
¹
->
sourû
);

201 
	`ä“
(
¹
->
rg‘
);

202 
	`ä“
(
¹
->
rg‘_şass
);

203 
	`¿nge_de¡roy
(&
¹
->
¿nge
);

204 
	`ä“
(
¹
);

206 
	}
}

208 
pŞdiff_¿nge_Œªs_summ¬y_t
 *
	$¿nge_Œªs_ü—‹
()

210 
pŞdiff_¿nge_Œªs_summ¬y_t
 *
¹s
 = 
	`ÿÎoc
(1, (*rts));

211 ià(
¹s
 =ğ
NULL
) {

212  
NULL
;

214 ià((
¹s
->
diffs
 = 
	`­Ş_veùÜ_ü—‹
(
¿nge_Œªs_ä“
)è=ğ
NULL
) {

215 
	`¿nge_Œªs_de¡roy
(&
¹s
);

216  
NULL
;

218  
¹s
;

219 
	}
}

221 
	$¿nge_Œªs_de¡roy
(
pŞdiff_¿nge_Œªs_summ¬y_t
 ** 
¹s
)

223 ià(
¹s
 !ğ
NULL
 && *rts != NULL) {

224 
	`­Ş_veùÜ_de¡roy
(&(*
¹s
)->
diffs
);

225 
	`ä“
(*
¹s
);

226 *
¹s
 = 
NULL
;

228 
	}
}

230 
	sp£udo_¿nge_Œªs


232 
ušt32_t
 
	msourû_ty³
, 
	mrg‘_ty³
;

234 cÚ¡ *
	mrg‘_şass
;

235 cÚ¡ 
qpŞ_mls_¿nge_t
 *
	m¿nge
;

236 } 
	tp£udo_¿nge_Œªs_t
;

238 
	$¿nge_Œªs_ä“_™em
(*
™em
)

240 ià(
™em
 !ğ
NULL
) {

241 
p£udo_¿nge_Œªs_t
 *
´t
 = 
™em
;

242 
	`ä“
(
´t
);

244 
	}
}

246 
¿nge_Œªs_comp
(cÚ¡ *
x
, cÚ¡ *
y
, cÚ¡ 
pŞdiff_t
 * 
diff
 
__©Œibu‹__
 ((
unu£d
)))

248 cÚ¡ 
p£udo_¿nge_Œªs_t
 *
	gp1
 = 
x
;

249 cÚ¡ 
p£udo_¿nge_Œªs_t
 *
	gp2
 = 
y
;

251 ià(
	gp1
->
	gsourû_ty³
 !ğ
p2
->
sourû_ty³
) {

252  
p1
->
sourû_ty³
 - 
p2
->source_type;

254 ià(
	gp1
->
	grg‘_ty³
 !ğ
p2
->
rg‘_ty³
) {

255  
p1
->
rg‘_ty³
 - 
p2
->target_type;

257  
¡rcmp
(
p1
->
rg‘_şass
, 
p2
->target_class);

260 
	$¿nge_Œªs_»£t
(
pŞdiff_t
 * 
diff
)

262 
”rÜ
 = 0;

264 ià(
diff
 =ğ
NULL
) {

265 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
EINVAL
));

266 
”ºo
 = 
EINVAL
;

270 
	`¿nge_Œªs_de¡roy
(&
diff
->
¿nge_Œªs_diffs
);

271 
diff
->
¿nge_Œªs_diffs
 = 
	`¿nge_Œªs_ü—‹
();

272 ià(
diff
->
¿nge_Œªs_diffs
 =ğ
NULL
) {

273 
”rÜ
 = 
”ºo
;

274 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

275 
”ºo
 = 
”rÜ
;

280 
	}
}

287 
pŞdiff_¿nge_Œªs_t
 *
	$make_¿nge_Œªs_diff
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
pŞdiff_fÜm_e
 
fÜm
, cÚ¡ 
p£udo_¿nge_Œªs_t
 * 
´t
)

289 
pŞdiff_¿nge_Œªs_t
 *
¹
 = 
NULL
;

290 cÚ¡ *
n1
, *
n2
;

291 
”rÜ
;

292 ià(
fÜm
 =ğ
POLDIFF_FORM_ADDED
 || fÜm =ğ
POLDIFF_FORM_ADD_TYPE
) {

293 
n1
 = 
	`ty³_m­_g‘_Çme
(
diff
, 
´t
->
sourû_ty³
, 
POLDIFF_POLICY_MOD
);

294 
n2
 = 
	`ty³_m­_g‘_Çme
(
diff
, 
´t
->
rg‘_ty³
, 
POLDIFF_POLICY_MOD
);

296 
n1
 = 
	`ty³_m­_g‘_Çme
(
diff
, 
´t
->
sourû_ty³
, 
POLDIFF_POLICY_ORIG
);

297 
n2
 = 
	`ty³_m­_g‘_Çme
(
diff
, 
´t
->
rg‘_ty³
, 
POLDIFF_POLICY_ORIG
);

299 
	`as£¹
(
n1
 !ğ
NULL
 && 
n2
 != NULL);

300 ià((
¹
 = 
	`ÿÎoc
(1, (*¹))è=ğ
NULL
) {

301 
”rÜ
 = 
”ºo
;

302 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

303 
”ºo
 = 
”rÜ
;

304  
NULL
;

306 ià((
¹
->
sourû
 = 
	`¡rdup
(
n1
)è=ğ
NULL
 ||

307 (
¹
->
rg‘
 = 
	`¡rdup
(
n2
)è=ğ
NULL
 || (¹->
rg‘_şass
 = sŒdup(
´t
->target_class)) == NULL) {

308 
”rÜ
 = 
”ºo
;

309 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”ºo
));

310 
	`¿nge_Œªs_ä“
(
¹
);

311 
”ºo
 = 
”rÜ
;

312  
NULL
;

314 
¹
->
fÜm
 = form;

315  
¹
;

316 
	}
}

318 
	$¿nge_Œªs_Ãw_diff
(
pŞdiff_t
 * 
diff
, 
pŞdiff_fÜm_e
 
fÜm
, cÚ¡ *
™em
)

320 cÚ¡ 
p£udo_¿nge_Œªs_t
 *
´t
 = (cÚ¡…£udo_¿nge_Œªs_ˆ*)
™em
;

321 cÚ¡ 
­Ş_veùÜ_t
 *
v1
, *
v2
;

322 cÚ¡ 
qpŞ_mls_¿nge_t
 *
Üig_¿nge
 = 
NULL
, *
mod_¿nge
 = NULL;

323 
pŞdiff_¿nge_Œªs_t
 *
¹
 = 
NULL
;

324 
”rÜ
;

329 ià(
fÜm
 =ğ
POLDIFF_FORM_ADDED
) {

330 ià((
v1
 = 
	`ty³_m­_lookup_»v”£
(
diff
, 
´t
->
sourû_ty³
, 
POLDIFF_POLICY_ORIG
)è=ğ
NULL
 ||

331 (
v2
 = 
	`ty³_m­_lookup_»v”£
(
diff
, 
´t
->
rg‘_ty³
, 
POLDIFF_POLICY_ORIG
)è=ğ
NULL
) {

332 
”rÜ
 = 
”ºo
;

333 
ş—nup
;

335 ià(
	`­Ş_veùÜ_g‘_size
(
v1
è=ğ0 ||‡pŞ_veùÜ_g‘_size(
v2
) == 0) {

336 
fÜm
 = 
POLDIFF_FORM_ADD_TYPE
;

338 
mod_¿nge
 = 
´t
->
¿nge
;

340 ià((
v1
 = 
	`ty³_m­_lookup_»v”£
(
diff
, 
´t
->
sourû_ty³
, 
POLDIFF_POLICY_MOD
)è=ğ
NULL
 ||

341 (
v2
 = 
	`ty³_m­_lookup_»v”£
(
diff
, 
´t
->
rg‘_ty³
, 
POLDIFF_POLICY_MOD
)è=ğ
NULL
) {

342 
”rÜ
 = 
”ºo
;

343 
ş—nup
;

345 ià(
	`­Ş_veùÜ_g‘_size
(
v1
è=ğ0 ||‡pŞ_veùÜ_g‘_size(
v2
) == 0) {

346 
fÜm
 = 
POLDIFF_FORM_REMOVE_TYPE
;

348 
Üig_¿nge
 = 
´t
->
¿nge
;

350 ià((
¹
 = 
	`make_¿nge_Œªs_diff
(
diff
, 
fÜm
, 
´t
)è=ğ
NULL
 ||

351 (
¹
->
¿nge
 = 
	`¿nge_ü—‹
(
diff
, 
Üig_¿nge
, 
mod_¿nge
, 
fÜm
)è=ğ
NULL
) {

352 
”rÜ
 = 
”ºo
;

353 
ş—nup
;

355 ià(
	`­Ş_veùÜ_­³nd
(
diff
->
¿nge_Œªs_diffs
->
diffs
, 
¹
) < 0) {

356 
”rÜ
 = 
”ºo
;

357 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

358 
ş—nup
;

361 
fÜm
) {

362 
POLDIFF_FORM_ADDED
:

364 
diff
->
¿nge_Œªs_diffs
->
num_added
++;

367 
POLDIFF_FORM_ADD_TYPE
:

369 
diff
->
¿nge_Œªs_diffs
->
num_added_ty³
++;

372 
POLDIFF_FORM_REMOVED
:

374 
diff
->
¿nge_Œªs_diffs
->
num_»moved
++;

377 
POLDIFF_FORM_REMOVE_TYPE
:

379 
diff
->
¿nge_Œªs_diffs
->
num_»moved_ty³
++;

385 
	`as£¹
(0);

389 
ş—nup
:

390 
	`¿nge_Œªs_ä“
(
¹
);

391 
”ºo
 = 
”rÜ
;

393 
	}
}

408 
	$p£udo_¿nge_Œªs_comp
(cÚ¡ *
x
, cÚ¡ *
y
, *
¬g
)

410 cÚ¡ 
p£udo_¿nge_Œªs_t
 *
a
 = 
x
;

411 cÚ¡ 
p£udo_¿nge_Œªs_t
 *
b
 = 
y
;

412 
pŞdiff_t
 *
diff
 = 
¬g
;

413 
»tv®
 = 
	`¿nge_Œªs_comp
(
a
, 
b
, 
diff
);

414  
»tv®
;

415 
	}
}

417 
­Ş_veùÜ_t
 *
	$¿nge_Œªs_g‘_™ems
(
pŞdiff_t
 * 
diff
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
)

419 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

420 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

421 cÚ¡ 
qpŞ_¿nge_Œªs_t
 *
q¹
 = 
NULL
;

422 cÚ¡ 
qpŞ_ty³_t
 *
sourû_ty³
, *
rg‘_ty³
;

423 cÚ¡ 
qpŞ_şass_t
 *
rg‘_şass
;

424 cÚ¡ *
şass_Çme
;

425 cÚ¡ 
qpŞ_mls_¿nge_t
 *
¿nge
;

426 
p£udo_¿nge_Œªs_t
 *
´t
 = 
NULL
;

427 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicy
);

428 
”rÜ
 = 0, 
which_pŞ
;

430 
which_pŞ
 = (
pŞicy
 =ğ
diff
->
Üig_pŞ
 ? 
POLDIFF_POLICY_ORIG
 : 
POLDIFF_POLICY_MOD
);

431 ià(
	`qpŞ_pŞicy_g‘_¿nge_Œªs_™”
(
q
, &
™”
)) {

432 
”rÜ
 = 
”ºo
;

433 
”r
;

435 ià((
v
 = 
	`­Ş_veùÜ_ü—‹
(
¿nge_Œªs_ä“_™em
)è=ğ
NULL
) {

436 
”rÜ
 = 
”ºo
;

437 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

438 
”r
;

440 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

441 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
q¹
) < 0) {

442 
”rÜ
 = 
”ºo
;

443 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

444 
”r
;

446 ià(
	`qpŞ_¿nge_Œªs_g‘_sourû_ty³
(
q
, 
q¹
, &
sourû_ty³
) < 0 ||

447 
	`qpŞ_¿nge_Œªs_g‘_rg‘_ty³
(
q
, 
q¹
, &
rg‘_ty³
) < 0 ||

448 
	`qpŞ_¿nge_Œªs_g‘_rg‘_şass
(
q
, 
q¹
, &
rg‘_şass
) < 0 ||

449 
	`qpŞ_şass_g‘_Çme
(
q
, 
rg‘_şass
, &
şass_Çme
è< 0 || 
	`qpŞ_¿nge_Œªs_g‘_¿nge
(q, 
q¹
, &
¿nge
) < 0) {

450 
”rÜ
 = 
”ºo
;

451 
”r
;

453 ià(!(
´t
 = 
	`ÿÎoc
(1, (*prt)))) {

454 
”rÜ
 = 
”ºo
;

455 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

456 
”r
;

458 
´t
->
sourû_ty³
 = 
	`ty³_m­_lookup
(
diff
, sourû_ty³, 
which_pŞ
);

459 
´t
->
rg‘_ty³
 = 
	`ty³_m­_lookup
(
diff
,¬g‘_ty³, 
which_pŞ
);

460 
´t
->
rg‘_şass
 = 
şass_Çme
;

461 
´t
->
¿nge
 =„ange;

462 ià(
	`­Ş_veùÜ_­³nd
(
v
, 
´t
)) {

463 
”rÜ
 = 
”ºo
;

464 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

465 
”r
;

467 
´t
 = 
NULL
;

469 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

470 
	`­Ş_veùÜ_sÜt_uniquify
(
v
, 
p£udo_¿nge_Œªs_comp
, 
diff
);

471  
v
;

473 
”r
:

474 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

475 
	`­Ş_veùÜ_de¡roy
(&
v
);

476 
	`ä“
(
´t
);

477 
”ºo
 = 
”rÜ
;

478  
NULL
;

479 
	}
}

481 
	$¿nge_Œªs_d“p_diff
(
pŞdiff_t
 * 
diff
, cÚ¡ *
x
, cÚ¡ *
y
)

483 cÚ¡ 
p£udo_¿nge_Œªs_t
 *
´t1
 = 
x
;

484 cÚ¡ 
p£udo_¿nge_Œªs_t
 *
´t2
 = 
y
;

485 
pŞdiff_¿nge_t
 *
¿nge
 = 
NULL
;

486 
pŞdiff_¿nge_Œªs_t
 *
¹
 = 
NULL
;

487 
”rÜ
 = 0, 
»tv®
 = -1;

489 ià((
¿nge
 = 
	`¿nge_ü—‹
(
diff
, 
´t1
->¿nge, 
´t2
->¿nge, 
POLDIFF_FORM_MODIFIED
)è=ğ
NULL
) {

490 
”rÜ
 = 
”ºo
;

491 
ş—nup
;

493 ià((
»tv®
 = 
	`¿nge_d“p_diff
(
diff
, 
¿nge
)) < 0) {

494 
”rÜ
 = 
”ºo
;

495 
ş—nup
;

497 ià(
»tv®
 > 0) {

498 ià((
¹
 = 
	`make_¿nge_Œªs_diff
(
diff
, 
POLDIFF_FORM_MODIFIED
, 
´t1
)è=ğ
NULL
) {

499 
”rÜ
 = 
”ºo
;

500 
ş—nup
;

502 
¹
->
¿nge
 =„ange;

503 
¿nge
 = 
NULL
;

504 ià(
	`­Ş_veùÜ_­³nd
(
diff
->
¿nge_Œªs_diffs
->
diffs
, 
¹
) < 0) {

505 
”rÜ
 = 
”ºo
;

506 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

507 
ş—nup
;

509 
diff
->
¿nge_Œªs_diffs
->
num_modif›d
++;

510 
¹
 = 
NULL
;

512 
»tv®
 = 0;

513 
ş—nup
:

514 
	`¿nge_de¡roy
(&
¿nge
);

515 
	`¿nge_Œªs_ä“
(
¹
);

516 ià(
»tv®
 != 0) {

517 
”ºo
 = 
”rÜ
;

519  
»tv®
;

520 
	}
}

	@libpoldiff/src/range_trans_internal.h

25 #iâdeà
POLDIFF_RANGE_TRANS_INTERNAL_H


26 
	#POLDIFF_RANGE_TRANS_INTERNAL_H


	)

28 #ifdef 
__ılu¥lus


33 
pŞdiff_¿nge_Œªs_summ¬y
 
	tpŞdiff_¿nge_Œªs_summ¬y_t
;

42 
pŞdiff_¿nge_Œªs_summ¬y_t
 *
¿nge_Œªs_ü—‹
();

52 
¿nge_Œªs_de¡roy
(
pŞdiff_¿nge_Œªs_summ¬y_t
 ** 
¹s
);

61 
¿nge_Œªs_»£t
(
pŞdiff_t
 * 
diff
);

75 
­Ş_veùÜ_t
 *
¿nge_Œªs_g‘_™ems
(
pŞdiff_t
 * 
diff
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
);

89 
¿nge_Œªs_comp
(cÚ¡ *
x
, cÚ¡ *
y
, cÚ¡ 
pŞdiff_t
 * 
diff
);

102 
¿nge_Œªs_Ãw_diff
(
pŞdiff_t
 * 
diff
, 
pŞdiff_fÜm_e
 
fÜm
, cÚ¡ *
™em
);

118 
¿nge_Œªs_d“p_diff
(
pŞdiff_t
 * 
diff
, cÚ¡ *
x
, cÚ¡ *
y
);

120 #ifdef 
__ılu¥lus


	@libpoldiff/src/rbac_diff.c

26 
	~<cÚfig.h
>

28 
	~"pŞdiff_š‹º®.h
"

30 
	~<­Ş/b¡.h
>

31 
	~<­Ş/ut.h
>

32 
	~<as£¹.h
>

33 
	~<”ºo.h
>

34 
	~<¡dio.h
>

35 
	~<¡ršg.h
>

37 
	spŞdiff_rŞe_®low_summ¬y


39 
size_t
 
	mnum_added
;

40 
size_t
 
	mnum_»moved
;

41 
size_t
 
	mnum_modif›d
;

42 
­Ş_veùÜ_t
 *
	mdiffs
;

45 
	spŞdiff_rŞe_Œªs_summ¬y


47 
size_t
 
	mnum_added
;

48 
size_t
 
	mnum_»moved
;

49 
size_t
 
	mnum_modif›d
;

50 
size_t
 
	mnum_added_ty³
;

51 
size_t
 
	mnum_»moved_ty³
;

52 
­Ş_veùÜ_t
 *
	mdiffs
;

55 
	spŞdiff_rŞe_®low


57 cÚ¡ *
	msourû_rŞe
;

58 
pŞdiff_fÜm_e
 
	mfÜm
;

59 
­Ş_veùÜ_t
 *
	mÜig_rŞes
;

60 
­Ş_veùÜ_t
 *
	madded_rŞes
;

61 
­Ş_veùÜ_t
 *
	m»moved_rŞes
;

64 
	spŞdiff_rŞe_Œªs


66 cÚ¡ *
	msourû_rŞe
;

67 *
	mrg‘_ty³
;

68 cÚ¡ *
	mÜig_deçuÉ
;

69 cÚ¡ *
	mmod_deçuÉ
;

70 
pŞdiff_fÜm_e
 
	mfÜm
;

75 
	$pŞdiff_rŞe_®low_g‘_¡©s
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
size_t
 
¡©s
[5])

77 ià(
diff
 =ğ
NULL
 || 
¡©s
 == NULL) {

78 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
EINVAL
));

79 
”ºo
 = 
EINVAL
;

82 
¡©s
[0] = 
diff
->
rŞe_®low_diffs
->
num_added
;

83 
¡©s
[1] = 
diff
->
rŞe_®low_diffs
->
num_»moved
;

84 
¡©s
[2] = 
diff
->
rŞe_®low_diffs
->
num_modif›d
;

85 
¡©s
[3] = 0;

86 
¡©s
[4] = 0;

87 
	}
}

89 *
	$pŞdiff_rŞe_®low_to_¡ršg
(cÚ¡ 
pŞdiff_t
 * 
diff
, cÚ¡ *
rŞe_®low
)

91 cÚ¡ 
pŞdiff_rŞe_®low_t
 *
¿
 = 
rŞe_®low
;

92 
size_t
 
Ën
 = 0, 
i
;

93 *
s
 = 
NULL
, *
rŞe
;

94 ià(
diff
 =ğ
NULL
 || 
rŞe_®low
 == NULL) {

95 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
EINVAL
));

96 
”ºo
 = 
EINVAL
;

97  
NULL
;

99 
¿
->
fÜm
) {

100 
POLDIFF_FORM_ADDED
:

102 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "+‡Îow % { ", 
¿
->
sourû_rŞe
) < 0) {

103 
s
 = 
NULL
;

106 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
¿
->
added_rŞes
); i++) {

107 
rŞe
 = 
	`­Ş_veùÜ_g‘_–em’t
(
¿
->
added_rŞes
, 
i
);

108 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "% ", 
rŞe
) < 0) {

109 
”r
;

112 ià(
	`­Ş_¡r_­³nd
(&
s
, &
Ën
, "};") < 0) {

115  
s
;

117 
POLDIFF_FORM_REMOVED
:

119 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "-‡Îow % { ", 
¿
->
sourû_rŞe
) < 0) {

122 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
¿
->
»moved_rŞes
); i++) {

123 
rŞe
 = 
	`­Ş_veùÜ_g‘_–em’t
(
¿
->
»moved_rŞes
, 
i
);

124 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "% ", 
rŞe
) < 0) {

125 
”r
;

128 ià(
	`­Ş_¡r_­³nd
(&
s
, &
Ën
, "};") < 0) {

131  
s
;

133 
POLDIFF_FORM_MODIFIED
:

135 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "*‡Îow % { ", 
¿
->
sourû_rŞe
) < 0) {

136 
s
 = 
NULL
;

139 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
¿
->
Üig_rŞes
); i++) {

140 
rŞe
 = 
	`­Ş_veùÜ_g‘_–em’t
(
¿
->
Üig_rŞes
, 
i
);

141 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "% ", 
rŞe
) < 0) {

142 
”r
;

145 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
¿
->
added_rŞes
); i++) {

146 
rŞe
 = 
	`­Ş_veùÜ_g‘_–em’t
(
¿
->
added_rŞes
, 
i
);

147 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "+% ", 
rŞe
) < 0) {

148 
”r
;

151 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
¿
->
»moved_rŞes
); i++) {

152 
rŞe
 = 
	`­Ş_veùÜ_g‘_–em’t
(
¿
->
»moved_rŞes
, 
i
);

153 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "-% ", 
rŞe
) < 0) {

154 
”r
;

157 ià(
	`­Ş_¡r_­³nd
(&
s
, &
Ën
, "};") < 0) {

160  
s
;

164 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
ENOTSUP
));

165 
”ºo
 = 
ENOTSUP
;

166  
NULL
;

170 
”r
:

171 
	`ä“
(
s
);

172 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

173 
”ºo
 = 
ENOMEM
;

174  
NULL
;

175 
	}
}

177 cÚ¡ 
­Ş_veùÜ_t
 *
	$pŞdiff_g‘_rŞe_®low_veùÜ
(cÚ¡ 
pŞdiff_t
 * 
diff
)

179 ià(
diff
 =ğ
NULL
) {

180 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
EINVAL
));

181 
”ºo
 = 
EINVAL
;

182  
NULL
;

184  
diff
->
rŞe_®low_diffs
->
diffs
;

185 
	}
}

187 cÚ¡ *
	$pŞdiff_rŞe_®low_g‘_Çme
(cÚ¡ 
pŞdiff_rŞe_®low_t
 * 
rŞe_®low
)

189 ià(
rŞe_®low
 =ğ
NULL
) {

190 
”ºo
 = 
EINVAL
;

191  
NULL
;

193  
rŞe_®low
->
sourû_rŞe
;

194 
	}
}

196 
pŞdiff_fÜm_e
 
	$pŞdiff_rŞe_®low_g‘_fÜm
(cÚ¡ *
rŞe_®low
)

198 ià(
rŞe_®low
 =ğ
NULL
) {

199 
”ºo
 = 
EINVAL
;

200  
POLDIFF_FORM_NONE
;

202  ((cÚ¡ 
pŞdiff_rŞe_®low_t
 *)
rŞe_®low
)->
fÜm
;

203 
	}
}

205 cÚ¡ 
­Ş_veùÜ_t
 *
	$pŞdiff_rŞe_®low_g‘_unmodif›d_rŞes
(cÚ¡ 
pŞdiff_rŞe_®low_t
 * 
rŞe_®low
)

207 ià(
rŞe_®low
 =ğ
NULL
) {

208 
”ºo
 = 
EINVAL
;

209  
NULL
;

211  
rŞe_®low
->
Üig_rŞes
;

212 
	}
}

214 cÚ¡ 
­Ş_veùÜ_t
 *
	$pŞdiff_rŞe_®low_g‘_added_rŞes
(cÚ¡ 
pŞdiff_rŞe_®low_t
 * 
rŞe_®low
)

216 ià(
rŞe_®low
 =ğ
NULL
) {

217 
”ºo
 = 
EINVAL
;

218  
NULL
;

220  
rŞe_®low
->
added_rŞes
;

221 
	}
}

223 cÚ¡ 
­Ş_veùÜ_t
 *
	$pŞdiff_rŞe_®low_g‘_»moved_rŞes
(cÚ¡ 
pŞdiff_rŞe_®low_t
 * 
rŞe_®low
)

225 ià(
rŞe_®low
 =ğ
NULL
) {

226 
”ºo
 = 
EINVAL
;

227  
NULL
;

229  
rŞe_®low
->
»moved_rŞes
;

230 
	}
}

232 
	$rŞe_®low_ä“
(*
–em
)

234 ià(
–em
 !ğ
NULL
) {

235 
pŞdiff_rŞe_®low_t
 *
r
 = (pŞdiff_rŞe_®low_ˆ*è
–em
;

236 
	`­Ş_veùÜ_de¡roy
(&
r
->
Üig_rŞes
);

237 
	`­Ş_veùÜ_de¡roy
(&
r
->
added_rŞes
);

238 
	`­Ş_veùÜ_de¡roy
(&
r
->
»moved_rŞes
);

239 
	`ä“
(
r
);

241 
	}
}

243 
pŞdiff_rŞe_®low_summ¬y_t
 *
	$rŞe_®low_ü—‹
()

245 
pŞdiff_rŞe_®low_summ¬y_t
 *
¿s
 = 
	`ÿÎoc
(1, (*ras));

246 ià(
¿s
 =ğ
NULL
) {

247  
NULL
;

249 ià((
¿s
->
diffs
 = 
	`­Ş_veùÜ_ü—‹
(
rŞe_®low_ä“
)è=ğ
NULL
) {

250 
	`rŞe_®low_de¡roy
(&
¿s
);

251  
NULL
;

253  
¿s
;

254 
	}
}

256 
	$rŞe_®low_de¡roy
(
pŞdiff_rŞe_®low_summ¬y_t
 ** 
¿s
)

258 ià(
¿s
 !ğ
NULL
 && *ras != NULL) {

259 
	`­Ş_veùÜ_de¡roy
(&(*
¿s
)->
diffs
);

260 
	`ä“
(*
¿s
);

261 *
¿s
 = 
NULL
;

263 
	}
}

265 
	sp£udo_rŞe_®low


267 cÚ¡ *
	msourû_rŞe
;

268 
­Ş_veùÜ_t
 *
	mrg‘_rŞes
;

269 } 
	tp£udo_rŞe_®low_t
;

271 
	$rŞe_®low_ä“_™em
(*
™em
)

273 
p£udo_rŞe_®low_t
 *
´a
 = 
™em
;

275 ià(!
™em
)

279 
	`­Ş_veùÜ_de¡roy
(&
´a
->
rg‘_rŞes
);

280 
	`ä“
(
™em
);

281 
	}
}

283 
rŞe_®low_sourû_comp
(cÚ¡ *
x
, cÚ¡ *
y
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

285 cÚ¡ 
p£udo_rŞe_®low_t
 *
	gp1
 = 
x
;

286 cÚ¡ 
p£udo_rŞe_®low_t
 *
	gp2
 = 
y
;

288  
¡rcmp
(
p1
->
sourû_rŞe
, 
p2
->source_role);

291 
­Ş_veùÜ_t
 *
	$rŞe_®low_g‘_™ems
(
pŞdiff_t
 * 
diff
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
)

293 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

294 
­Ş_veùÜ_t
 *
tmp
 = 
NULL
, *
v
 = NULL;

295 
”rÜ
 = 0, 
»tv
;

296 
size_t
 
i
;

297 
­Ş_b¡_t
 *
b¡
 = 
NULL
;

298 
p£udo_rŞe_®low_t
 *
´a
 = 
NULL
;

299 cÚ¡ 
qpŞ_rŞe_t
 *
¤
 = 
NULL
, *
Œ
 = NULL;

300 cÚ¡ *
¤_Çme
 = 
NULL
, *
Œ_Çme
 = NULL;

301 cÚ¡ 
qpŞ_rŞe_®low_t
 *
q¿
 = 
NULL
;

302 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicy
);

304 ià(
	`qpŞ_pŞicy_g‘_rŞe_®low_™”
(
q
, &
™”
) < 0) {

305  
NULL
;

308 
tmp
 = 
	`­Ş_veùÜ_ü—‹_äom_™”
(
™”
, 
NULL
);

309 ià(
tmp
 =ğ
NULL
) {

310 
”rÜ
 = 
”ºo
;

311 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

312 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

313 
”ºo
 = 
”rÜ
;

314  
NULL
;

316 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

318 
b¡
 = 
	`­Ş_b¡_ü—‹
(
rŞe_®low_sourû_comp
, 
rŞe_®low_ä“_™em
);

320 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
tmp
); i++) {

321 
q¿
 = 
	`­Ş_veùÜ_g‘_–em’t
(
tmp
, 
i
);

322 ià(!(
´a
 = 
	`ÿÎoc
(1, (*´a))è|| (!Õ¿->
rg‘_rŞes
 = 
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(1, 
NULL
)))) {

323 
”rÜ
 = 
”ºo
;

324 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

325 
”r
;

327 ià(
	`qpŞ_rŞe_®low_g‘_sourû_rŞe
(
q
, 
q¿
, &
¤
è|| 
	`qpŞ_rŞe_g‘_Çme
(q, sr, &
¤_Çme
)) {

328 
”rÜ
 = 
”ºo
;

329 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

330 
”r
;

332 
¤
 = 
NULL
;

333 ià(
	`qpŞ_rŞe_®low_g‘_rg‘_rŞe
(
q
, 
q¿
, &
Œ
è|| 
	`qpŞ_rŞe_g‘_Çme
(q,r, &
Œ_Çme
)) {

334 
”rÜ
 = 
”ºo
;

335 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

336 
”r
;

338 
Œ
 = 
NULL
;

339 
´a
->
sourû_rŞe
 = 
¤_Çme
;

340 
»tv
 = 
	`­Ş_b¡_š£¹_ªd_g‘
(
b¡
, (**)&
´a
, 
NULL
);

341 ià(
»tv
 < 0) {

342 
”rÜ
 = 
”ºo
;

343 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

344 
”r
;

346 
	`­Ş_veùÜ_­³nd_unique
(
´a
->
rg‘_rŞes
, (*)
Œ_Çme
, 
­Ş_¡r_¡rcmp
, 
NULL
);

347 
´a
 = 
NULL
;

349 
	`­Ş_veùÜ_de¡roy
(&
tmp
);

351 
v
 = 
	`­Ş_b¡_g‘_veùÜ
(
b¡
, 1);

352 ià(!
v
) {

353 
”rÜ
 = 
”ºo
;

354 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

355 
”r
;

357 
	`­Ş_b¡_de¡roy
(&
b¡
);

359  
v
;

361 
”r
:

362 
	`rŞe_®low_ä“_™em
(
´a
);

363 
	`­Ş_b¡_de¡roy
(&
b¡
);

364 
”ºo
 = 
”rÜ
;

365  
NULL
;

366 
	}
}

368 
rŞe_®low_comp
(cÚ¡ *
x
, cÚ¡ *
y
, cÚ¡ 
pŞdiff_t
 * 
diff
 
__©Œibu‹__
 ((
unu£d
)))

370 cÚ¡ 
p£udo_rŞe_®low_t
 *
	gp1
 = 
x
;

371 cÚ¡ 
p£udo_rŞe_®low_t
 *
	gp2
 = 
y
;

373  
¡rcmp
(
p1
->
sourû_rŞe
, 
p2
->source_role);

376 
	$rŞe_®low_»£t
(
pŞdiff_t
 * 
diff
)

378 
”rÜ
 = 0;

380 ià(
diff
 =ğ
NULL
) {

381 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
EINVAL
));

382 
”ºo
 = 
EINVAL
;

386 
	`rŞe_®low_de¡roy
(&
diff
->
rŞe_®low_diffs
);

387 
diff
->
rŞe_®low_diffs
 = 
	`rŞe_®low_ü—‹
();

388 ià(
diff
->
rŞe_®low_diffs
 =ğ
NULL
) {

389 
”rÜ
 = 
”ºo
;

390 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

391 
”ºo
 = 
”rÜ
;

396 
	}
}

409 
pŞdiff_rŞe_®low_t
 *
	$make_¿_diff
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
pŞdiff_fÜm_e
 
fÜm
, cÚ¡ *
sourû_rŞe
)

411 
pŞdiff_rŞe_®low_t
 *
¿
 = 
NULL
;

412 
”rÜ
 = 0;

413 ià((
¿
 = 
	`ÿÎoc
(1, (*¿))è=ğ
NULL
 ||

414 (
¿
->
sourû_rŞe
 = sourû_rŞeè=ğ
NULL
 ||

415 (
¿
->
added_rŞes
 = 
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(1, 
NULL
)) == NULL ||

416 (
¿
->
Üig_rŞes
 = 
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(1, 
NULL
)) == NULL ||

417 (
¿
->
»moved_rŞes
 = 
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(1, 
NULL
)) == NULL) {

418 
”rÜ
 = 
”ºo
;

419 
	`rŞe_®low_ä“
(
¿
);

420 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

421 
”ºo
 = 
”rÜ
;

422  
NULL
;

424 
¿
->
fÜm
 = form;

425  
¿
;

426 
	}
}

428 
	$rŞe_®low_Ãw_diff
(
pŞdiff_t
 * 
diff
, 
pŞdiff_fÜm_e
 
fÜm
, cÚ¡ *
™em
)

430 
p£udo_rŞe_®low_t
 *
¿
 = (p£udo_rŞe_®low_ˆ*è
™em
;

431 
pŞdiff_rŞe_®low_t
 *
´a
;

432 
”rÜ
;

434 
´a
 = 
	`make_¿_diff
(
diff
, 
fÜm
, 
¿
->
sourû_rŞe
);

435 ià(
´a
 =ğ
NULL
) {

438 
¹
;

439 ià(
fÜm
 =ğ
POLDIFF_FORM_ADDED
) {

440 
¹
 = 
	`­Ş_veùÜ_ÿt
(
´a
->
added_rŞes
, 
¿
->
rg‘_rŞes
);

442 
¹
 = 
	`­Ş_veùÜ_ÿt
(
´a
->
»moved_rŞes
, 
¿
->
rg‘_rŞes
);

444 ià(
¹
 < 0) {

445 
”rÜ
 = 
”ºo
;

446 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

447 
	`rŞe_®low_ä“
(
´a
);

448 
”ºo
 = 
”rÜ
;

451 ià(
	`­Ş_veùÜ_­³nd
(
diff
->
rŞe_®low_diffs
->
diffs
, 
´a
) < 0) {

452 
”rÜ
 = 
”ºo
;

453 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

454 
	`rŞe_®low_ä“
(
´a
);

455 
”ºo
 = 
”rÜ
;

458 ià(
fÜm
 =ğ
POLDIFF_FORM_ADDED
) {

459 
diff
->
rŞe_®low_diffs
->
num_added
++;

461 
diff
->
rŞe_®low_diffs
->
num_»moved
++;

464 
	}
}

466 
	$rŞe_®low_d“p_diff
(
pŞdiff_t
 * 
diff
, cÚ¡ *
x
, cÚ¡ *
y
)

468 cÚ¡ 
p£udo_rŞe_®low_t
 *
p1
 = 
x
;

469 cÚ¡ 
p£udo_rŞe_®low_t
 *
p2
 = 
y
;

470 
­Ş_veùÜ_t
 *
v1
 = 
NULL
, *
v2
 = NULL;

471 *
rŞe1
, *
rŞe2
;

472 
pŞdiff_rŞe_®low_t
 *
´a
 = 
NULL
;

473 
size_t
 
i
, 
j
;

474 
»tv®
 = -1, 
”rÜ
 = 0, 
compv®
;

476 
v1
 = 
p1
->
rg‘_rŞes
;

477 
v2
 = 
p2
->
rg‘_rŞes
;

479 
	`­Ş_veùÜ_sÜt
(
v1
, 
­Ş_¡r_¡rcmp
, 
NULL
);

480 
	`­Ş_veùÜ_sÜt
(
v2
, 
­Ş_¡r_¡rcmp
, 
NULL
);

481 
i
 = 
j
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v1
);) {

482 ià(
j
 >ğ
	`­Ş_veùÜ_g‘_size
(
v2
))

484 
rŞe1
 = (*)
	`­Ş_veùÜ_g‘_–em’t
(
v1
, 
i
);

485 
rŞe2
 = (*)
	`­Ş_veùÜ_g‘_–em’t
(
v2
, 
j
);

486 
compv®
 = 
	`¡rcmp
(
rŞe1
, 
rŞe2
);

487 ià(
´a
 =ğ
NULL
) {

488 ià((
´a
 = 
	`make_¿_diff
(
diff
, 
POLDIFF_FORM_MODIFIED
, 
p1
->
sourû_rŞe
)è=ğ
NULL
) {

489 
”rÜ
 = 
”ºo
;

490 
ş—nup
;

493 ià(
compv®
 < 0) {

494 ià(
	`­Ş_veùÜ_­³nd
(
´a
->
»moved_rŞes
, 
rŞe1
) < 0) {

495 
”rÜ
 = 
”ºo
;

496 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

497 
ş—nup
;

499 
i
++;

500 } ià(
compv®
 > 0) {

501 ià(
	`­Ş_veùÜ_­³nd
(
´a
->
added_rŞes
, 
rŞe2
) < 0) {

502 
”rÜ
 = 
”ºo
;

503 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

504 
ş—nup
;

506 
j
++;

508 ià(
	`­Ş_veùÜ_­³nd
(
´a
->
Üig_rŞes
, 
rŞe1
) < 0) {

509 
”rÜ
 = 
”ºo
;

510 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

511 
ş—nup
;

513 
i
++;

514 
j
++;

517 ; 
i
 < 
	`­Ş_veùÜ_g‘_size
(
v1
); i++) {

518 
rŞe1
 = (*)
	`­Ş_veùÜ_g‘_–em’t
(
v1
, 
i
);

519 ià(
´a
 =ğ
NULL
) {

520 ià((
´a
 = 
	`make_¿_diff
(
diff
, 
POLDIFF_FORM_MODIFIED
, 
p1
->
sourû_rŞe
)è=ğ
NULL
) {

521 
”rÜ
 = 
”ºo
;

522 
ş—nup
;

525 ià(
	`­Ş_veùÜ_­³nd
(
´a
->
»moved_rŞes
, 
rŞe1
) < 0) {

526 
”rÜ
 = 
”ºo
;

527 
	`ä“
(
rŞe1
);

528 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

529 
ş—nup
;

532 ; 
j
 < 
	`­Ş_veùÜ_g‘_size
(
v2
); j++) {

533 
rŞe2
 = (*)
	`­Ş_veùÜ_g‘_–em’t
(
v2
, 
j
);

534 ià(
´a
 =ğ
NULL
) {

535 ià((
´a
 = 
	`make_¿_diff
(
diff
, 
POLDIFF_FORM_MODIFIED
, 
p1
->
sourû_rŞe
)è=ğ
NULL
) {

536 
”rÜ
 = 
”ºo
;

537 
ş—nup
;

540 ià(
	`­Ş_veùÜ_­³nd
(
´a
->
added_rŞes
, 
rŞe2
) < 0) {

541 
”rÜ
 = 
”ºo
;

542 
	`ä“
(
rŞe2
);

543 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

544 
ş—nup
;

547 ià(
	`­Ş_veùÜ_g‘_size
(
´a
->
added_rŞes
è||‡pŞ_veùÜ_g‘_sizeÕ¿->
»moved_rŞes
)) {

548 
	`­Ş_veùÜ_sÜt
(
´a
->
»moved_rŞes
, 
­Ş_¡r_¡rcmp
, 
NULL
);

549 
	`­Ş_veùÜ_sÜt
(
´a
->
added_rŞes
, 
­Ş_¡r_¡rcmp
, 
NULL
);

550 
	`­Ş_veùÜ_sÜt
(
´a
->
Üig_rŞes
, 
­Ş_¡r_¡rcmp
, 
NULL
);

551 ià(
	`­Ş_veùÜ_­³nd
(
diff
->
rŞe_®low_diffs
->
diffs
, 
´a
) < 0) {

552 
”rÜ
 = 
”ºo
;

553 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

554 
ş—nup
;

556 
diff
->
rŞe_®low_diffs
->
num_modif›d
++;

558 
	`rŞe_®low_ä“
(
´a
);

559 
´a
 = 
NULL
;

561 
»tv®
 = 0;

562 
ş—nup
:

563 ià(
»tv®
 != 0) {

564 
	`rŞe_®low_ä“
(
´a
);

566 
”ºo
 = 
”rÜ
;

567  
»tv®
;

568 
	}
}

572 
	$pŞdiff_rŞe_Œªs_g‘_¡©s
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
size_t
 
¡©s
[5])

574 ià(
diff
 =ğ
NULL
 || 
¡©s
 == NULL) {

575 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
EINVAL
));

576 
”ºo
 = 
EINVAL
;

579 
¡©s
[0] = 
diff
->
rŞe_Œªs_diffs
->
num_added
;

580 
¡©s
[1] = 
diff
->
rŞe_Œªs_diffs
->
num_»moved
;

581 
¡©s
[2] = 
diff
->
rŞe_Œªs_diffs
->
num_modif›d
;

582 
¡©s
[3] = 
diff
->
rŞe_Œªs_diffs
->
num_added_ty³
;

583 
¡©s
[4] = 
diff
->
rŞe_Œªs_diffs
->
num_»moved_ty³
;

584 
	}
}

586 *
	$pŞdiff_rŞe_Œªs_to_¡ršg
(cÚ¡ 
pŞdiff_t
 * 
diff
, cÚ¡ *
rŞe_Œªs
)

588 cÚ¡ 
pŞdiff_rŞe_Œªs_t
 *
¹
 = 
rŞe_Œªs
;

589 *
s
 = 
NULL
;

591 ià(
diff
 =ğ
NULL
 || 
rŞe_Œªs
 == NULL) {

592 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
EINVAL
));

593 
”ºo
 = 
EINVAL
;

594  
NULL
;

596 
¹
->
fÜm
) {

597 
POLDIFF_FORM_ADDED
:

598 
POLDIFF_FORM_ADD_TYPE
:

600 ià(
	`a¥rštf
(&
s
, "+„Şe_Œªs™iÚ % % %s;", 
¹
->
sourû_rŞe
,„t->
rg‘_ty³
,„t->
mod_deçuÉ
) < 0)

602  
s
;

604 
POLDIFF_FORM_REMOVED
:

605 
POLDIFF_FORM_REMOVE_TYPE
:

607 ià(
	`a¥rštf
(&
s
, "-„Şe_Œªs™iÚ % % %s;", 
¹
->
sourû_rŞe
,„t->
rg‘_ty³
,„t->
Üig_deçuÉ
) < 0)

609  
s
;

611 
POLDIFF_FORM_MODIFIED
:

613 ià(
a¥rštf


614 (&
s
, "*„Şe_Œªs™iÚ % % { +% -% };", 
¹
->
sourû_rŞe
,„t->
rg‘_ty³
,„t->
mod_deçuÉ
,

615 
¹
->
Üig_deçuÉ
) < 0)

617  
s
;

619 
POLDIFF_FORM_NONE
:

622 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
ENOTSUP
));

623 
”ºo
 = 
ENOTSUP
;

624  
NULL
;

628 
	`ä“
(
s
);

629 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

630 
”ºo
 = 
ENOMEM
;

631  
NULL
;

632 
	}
}

634 cÚ¡ 
­Ş_veùÜ_t
 *
	$pŞdiff_g‘_rŞe_Œªs_veùÜ
(cÚ¡ 
pŞdiff_t
 * 
diff
)

636 ià(
diff
 =ğ
NULL
) {

637 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
EINVAL
));

638 
”ºo
 = 
EINVAL
;

639  
NULL
;

641  
diff
->
rŞe_Œªs_diffs
->
diffs
;

642 
	}
}

644 cÚ¡ *
	$pŞdiff_rŞe_Œªs_g‘_sourû_rŞe
(cÚ¡ 
pŞdiff_rŞe_Œªs_t
 * 
rŞe_Œªs
)

646 ià(
rŞe_Œªs
 =ğ
NULL
) {

647 
”ºo
 = 
EINVAL
;

648  
NULL
;

650  
rŞe_Œªs
->
sourû_rŞe
;

651 
	}
}

653 cÚ¡ *
	$pŞdiff_rŞe_Œªs_g‘_rg‘_ty³
(cÚ¡ 
pŞdiff_rŞe_Œªs_t
 * 
rŞe_Œªs
)

655 ià(
rŞe_Œªs
 =ğ
NULL
) {

656 
”ºo
 = 
EINVAL
;

657  
NULL
;

659  
rŞe_Œªs
->
rg‘_ty³
;

660 
	}
}

662 
pŞdiff_fÜm_e
 
	$pŞdiff_rŞe_Œªs_g‘_fÜm
(cÚ¡ *
rŞe_Œªs
)

664 ià(
rŞe_Œªs
 =ğ
NULL
) {

665 
”ºo
 = 
EINVAL
;

666  
POLDIFF_FORM_NONE
;

668  ((cÚ¡ 
pŞdiff_rŞe_Œªs_t
 *)
rŞe_Œªs
)->
fÜm
;

669 
	}
}

671 cÚ¡ *
	$pŞdiff_rŞe_Œªs_g‘_Üigš®_deçuÉ
(cÚ¡ 
pŞdiff_rŞe_Œªs_t
 * 
rŞe_Œªs
)

673 ià(
rŞe_Œªs
 =ğ
NULL
) {

674 
”ºo
 = 
EINVAL
;

675  
NULL
;

677  
rŞe_Œªs
->
Üig_deçuÉ
;

678 
	}
}

680 cÚ¡ *
	$pŞdiff_rŞe_Œªs_g‘_modif›d_deçuÉ
(cÚ¡ 
pŞdiff_rŞe_Œªs_t
 * 
rŞe_Œªs
)

682 ià(
rŞe_Œªs
 =ğ
NULL
) {

683 
”ºo
 = 
EINVAL
;

684  
NULL
;

686  
rŞe_Œªs
->
mod_deçuÉ
;

687 
	}
}

689 
	$rŞe_Œªs_ä“
(*
–em
)

691 ià(
–em
 !ğ
NULL
) {

692 
pŞdiff_rŞe_Œªs_t
 *
¹
 = 
–em
;

693 
	`ä“
(
¹
->
rg‘_ty³
);

694 
	`ä“
(
¹
);

696 
	}
}

698 
pŞdiff_rŞe_Œªs_summ¬y_t
 *
	$rŞe_Œªs_ü—‹
()

700 
pŞdiff_rŞe_Œªs_summ¬y_t
 *
¹s
 = 
	`ÿÎoc
(1, (*rts));

701 ià(
¹s
 =ğ
NULL
) {

702  
NULL
;

704 ià((
¹s
->
diffs
 = 
	`­Ş_veùÜ_ü—‹
(
rŞe_Œªs_ä“
)è=ğ
NULL
) {

705 
	`rŞe_Œªs_de¡roy
(&
¹s
);

706  
NULL
;

708  
¹s
;

709 
	}
}

711 
	$rŞe_Œªs_de¡roy
(
pŞdiff_rŞe_Œªs_summ¬y_t
 ** 
¹s
)

713 ià(
¹s
 !ğ
NULL
 && *rts != NULL) {

714 
	`­Ş_veùÜ_de¡roy
(&(*
¹s
)->
diffs
);

715 
	`ä“
(*
¹s
);

716 *
¹s
 = 
NULL
;

718 
	}
}

720 
	$rŞe_Œªs_»£t
(
pŞdiff_t
 * 
diff
)

722 
”rÜ
 = 0;

724 ià(
diff
 =ğ
NULL
) {

725 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
EINVAL
));

726 
”ºo
 = 
EINVAL
;

730 
	`rŞe_Œªs_de¡roy
(&
diff
->
rŞe_Œªs_diffs
);

731 
diff
->
rŞe_Œªs_diffs
 = 
	`rŞe_Œªs_ü—‹
();

732 ià(
diff
->
rŞe_Œªs_diffs
 =ğ
NULL
) {

733 
”rÜ
 = 
”ºo
;

734 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

735 
”ºo
 = 
”rÜ
;

740 
	}
}

742 
	sp£udo_rŞe_Œªs


744 cÚ¡ *
sourû_rŞe
;

745 
ušt32_t
 
p£udo_rg‘
;

746 cÚ¡ *
deçuÉ_rŞe
;

747 } 
	tp£udo_rŞe_Œªs_t
;

761 
	$p£udo_rŞe_Œªs_comp
(cÚ¡ *
x
, cÚ¡ *
y
, *
¬g
)

763 
»tv
 = 0;

764 cÚ¡ 
p£udo_rŞe_Œªs_t
 *
a
 = 
x
;

765 cÚ¡ 
p£udo_rŞe_Œªs_t
 *
b
 = 
y
;

766 
pŞdiff_t
 *
diff
 = 
¬g
;

768 
»tv
 = 
	`¡rcmp
(
a
->
sourû_rŞe
, 
b
->source_role);

769 ià(!
»tv
)

770 
»tv
 = 
a
->
p£udo_rg‘
 - 
b
->pseudo_target;

772  
»tv
;

773 ià(!
»tv
 && 
	`¡rcmp
(
a
->
deçuÉ_rŞe
, 
b
->default_role))

774 
	`WARN
(
diff
, "MuÉË„Şe_Œªs™iÚ„uË fÜ % % w™h difã»Á deçuÉ„Şes.", 
a
->
sourû_rŞe
,

775 
	`ty³_m­_g‘_Çme
(
diff
, 
a
->
p£udo_rg‘
, 
POLDIFF_POLICY_ORIG
));

776  
»tv
;

777 
	}
}

779 
	$rŞe_Œªs_ä“_™em
(*
™em
)

782 
	`ä“
(
™em
);

783 
	}
}

785 
­Ş_veùÜ_t
 *
	$rŞe_Œªs_g‘_™ems
(
pŞdiff_t
 * 
diff
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
)

787 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
, *
©Œ_ty³s
 = NULL;

788 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

789 cÚ¡ 
qpŞ_rŞe_Œªs_t
 *
q¹
 = 
NULL
;

790 
p£udo_rŞe_Œªs_t
 *
tmp_´t
 = 
NULL
;

791 cÚ¡ *
tmp_Çme
 = 
NULL
;

792 cÚ¡ 
qpŞ_rŞe_t
 *
tmp_rŞe
 = 
NULL
;

793 cÚ¡ 
qpŞ_ty³_t
 *
tmp_ty³
 = 
NULL
;

794 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicy
);

795 
”rÜ
 = 0, 
which_pŞ
;

796 
i§‰r
 = 0;

798 
which_pŞ
 = (
pŞicy
 =ğ
diff
->
Üig_pŞ
 ? 
POLDIFF_POLICY_ORIG
 : 
POLDIFF_POLICY_MOD
);

799 ià(
	`qpŞ_pŞicy_g‘_rŞe_Œªs_™”
(
q
, &
™”
)) {

800 
”rÜ
 = 
”ºo
;

801 
”r
;

803 
v
 = 
	`­Ş_veùÜ_ü—‹
(
rŞe_Œªs_ä“_™em
);

804 ià(!
v
) {

805 
”rÜ
 = 
”ºo
;

806 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

807 
”r
;

809 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

810 
i§‰r
 = 0;

811 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
q¹
) < 0) {

812 
”rÜ
 = 
”ºo
;

813 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

814 
”r
;

816 ià(
	`qpŞ_rŞe_Œªs_g‘_rg‘_ty³
(
q
, 
q¹
, &
tmp_ty³
) < 0) {

817 
”rÜ
 = 
”ºo
;

818 
”r
;

820 
	`qpŞ_ty³_g‘_i§‰r
(
q
, 
tmp_ty³
, &
i§‰r
);

821 ià(
i§‰r
) {

822 
	`qpŞ_ty³_g‘_ty³_™”
(
q
, 
tmp_ty³
, &
©Œ_ty³s
);

823 ; !
	`qpŞ_™”©Ü_’d
(
©Œ_ty³s
); 
	`qpŞ_™”©Ü_Ãxt
(attr_types)) {

824 
	`qpŞ_™”©Ü_g‘_™em
(
©Œ_ty³s
, (**)&
tmp_ty³
);

825 ià(!(
tmp_´t
 = 
	`ÿÎoc
(1, (*tmp_prt)))) {

826 
”rÜ
 = 
”ºo
;

827 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

828 
”r
;

830 
tmp_´t
->
p£udo_rg‘
 = 
	`ty³_m­_lookup
(
diff
, 
tmp_ty³
, 
which_pŞ
);

831 
	`qpŞ_rŞe_Œªs_g‘_sourû_rŞe
(
q
, 
q¹
, &
tmp_rŞe
);

832 
	`qpŞ_rŞe_g‘_Çme
(
q
, 
tmp_rŞe
, &
tmp_Çme
);

833 
tmp_´t
->
sourû_rŞe
 = 
tmp_Çme
;

834 
	`qpŞ_rŞe_Œªs_g‘_deçuÉ_rŞe
(
q
, 
q¹
, &
tmp_rŞe
);

835 
	`qpŞ_rŞe_g‘_Çme
(
q
, 
tmp_rŞe
, &
tmp_Çme
);

836 
tmp_´t
->
deçuÉ_rŞe
 = 
tmp_Çme
;

837 ià(
	`­Ş_veùÜ_­³nd
(
v
, 
tmp_´t
)) {

838 
”rÜ
 = 
”ºo
;

839 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

840 
”r
;

842 
tmp_´t
 = 
NULL
;

844 
	`qpŞ_™”©Ü_de¡roy
(&
©Œ_ty³s
);

846 ià(!(
tmp_´t
 = 
	`ÿÎoc
(1, (*tmp_prt)))) {

847 
”rÜ
 = 
”ºo
;

848 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

849 
”r
;

851 
tmp_´t
->
p£udo_rg‘
 = 
	`ty³_m­_lookup
(
diff
, 
tmp_ty³
, 
which_pŞ
);

852 
	`qpŞ_rŞe_Œªs_g‘_sourû_rŞe
(
q
, 
q¹
, &
tmp_rŞe
);

853 
	`qpŞ_rŞe_g‘_Çme
(
q
, 
tmp_rŞe
, &
tmp_Çme
);

854 
tmp_´t
->
sourû_rŞe
 = 
tmp_Çme
;

855 
	`qpŞ_rŞe_Œªs_g‘_deçuÉ_rŞe
(
q
, 
q¹
, &
tmp_rŞe
);

856 
	`qpŞ_rŞe_g‘_Çme
(
q
, 
tmp_rŞe
, &
tmp_Çme
);

857 
tmp_´t
->
deçuÉ_rŞe
 = 
tmp_Çme
;

858 ià(
	`­Ş_veùÜ_­³nd
(
v
, 
tmp_´t
)) {

859 
”rÜ
 = 
”ºo
;

860 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

861 
”r
;

863 
tmp_´t
 = 
NULL
;

866 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

867 
	`­Ş_veùÜ_sÜt_uniquify
(
v
, 
p£udo_rŞe_Œªs_comp
, 
diff
);

869  
v
;

871 
”r
:

872 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

873 
	`qpŞ_™”©Ü_de¡roy
(&
©Œ_ty³s
);

874 
	`­Ş_veùÜ_de¡roy
(&
v
);

875 
	`ä“
(
tmp_´t
);

876 
”ºo
 = 
”rÜ
;

877  
NULL
;

878 
	}
}

880 
rŞe_Œªs_comp
(cÚ¡ *
x
, cÚ¡ *
y
, cÚ¡ 
pŞdiff_t
 * 
diff
 
__©Œibu‹__
 ((
unu£d
)))

882 
	g»tv
 = 0;

883 cÚ¡ 
p£udo_rŞe_Œªs_t
 *
	ga
 = 
x
;

884 cÚ¡ 
p£udo_rŞe_Œªs_t
 *
	gb
 = 
y
;

886 
	g»tv
 = 
¡rcmp
(
a
->
sourû_rŞe
, 
b
->source_role);

887 ià(!
	g»tv
)

888  
	ga
->
	gp£udo_rg‘
 - 
	gb
->pseudo_target;

890  
	g»tv
;

905 
pŞdiff_rŞe_Œªs_t
 *
	$make_¹_diff
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
pŞdiff_fÜm_e
 
fÜm
, cÚ¡ *
¤c
, cÚ¡ *
tgt
)

907 
pŞdiff_rŞe_Œªs_t
 *
¹
 = 
NULL
;

908 
”rÜ
 = 0;

909 ià((
¹
 = 
	`ÿÎoc
(1, (*¹))è=ğ
NULL
 || (¹->
sourû_rŞe
 = 
¤c
è=ğNULL || (¹->
rg‘_ty³
 = 
	`¡rdup
(
tgt
)) == NULL) {

910 
”rÜ
 = 
”ºo
;

911 
	`rŞe_Œªs_ä“
(
¹
);

912 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

913 
”ºo
 = 
”rÜ
;

914  
NULL
;

916 
¹
->
fÜm
 = form;

917  
¹
;

918 
	}
}

920 
	$rŞe_Œªs_Ãw_diff
(
pŞdiff_t
 * 
diff
, 
pŞdiff_fÜm_e
 
fÜm
, cÚ¡ *
™em
)

922 cÚ¡ 
p£udo_rŞe_Œªs_t
 *
¹
 = 
™em
;

923 
pŞdiff_rŞe_Œªs_t
 *
´t
 = 
NULL
;

924 cÚ¡ *
tgt_Çme
 = 
NULL
;

925 
”rÜ
 = 0;

928 
fÜm
) {

929 
POLDIFF_FORM_ADDED
:

931 
tgt_Çme
 = 
	`ty³_m­_g‘_Çme
(
diff
, 
¹
->
p£udo_rg‘
, 
POLDIFF_POLICY_MOD
);

932 ià(
	`ty³_m­_g‘_Çme
(
diff
, 
¹
->
p£udo_rg‘
, 
POLDIFF_POLICY_ORIG
è=ğ
NULL
) {

933 
fÜm
 = 
POLDIFF_FORM_ADD_TYPE
;

937 
POLDIFF_FORM_REMOVED
:

939 
tgt_Çme
 = 
	`ty³_m­_g‘_Çme
(
diff
, 
¹
->
p£udo_rg‘
, 
POLDIFF_POLICY_ORIG
);

940 ià(
	`ty³_m­_g‘_Çme
(
diff
, 
¹
->
p£udo_rg‘
, 
POLDIFF_POLICY_MOD
è=ğ
NULL
) {

941 
fÜm
 = 
POLDIFF_FORM_REMOVE_TYPE
;

945 
POLDIFF_FORM_MODIFIED
:

946 
POLDIFF_FORM_NONE
:

949 
	`as£¹
(0);

953 
	`as£¹
(
tgt_Çme
 !ğ
NULL
);

956 
´t
 = 
	`make_¹_diff
(
diff
, 
fÜm
, 
¹
->
sourû_rŞe
, 
tgt_Çme
);

957 ià(!
´t
)

961 
fÜm
) {

962 
POLDIFF_FORM_ADDED
:

963 
POLDIFF_FORM_ADD_TYPE
:

965 
´t
->
mod_deçuÉ
 = 
¹
->
deçuÉ_rŞe
;

968 
POLDIFF_FORM_REMOVED
:

969 
POLDIFF_FORM_REMOVE_TYPE
:

971 
´t
->
Üig_deçuÉ
 = 
¹
->
deçuÉ_rŞe
;

977 
	`as£¹
(0);

980 ià(
	`­Ş_veùÜ_­³nd
(
diff
->
rŞe_Œªs_diffs
->
diffs
, 
´t
)) {

981 
”rÜ
 = 
”ºo
;

982 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

983 
	`rŞe_Œªs_ä“
(
´t
);

984 
”ºo
 = 
”rÜ
;

989 
fÜm
) {

990 
POLDIFF_FORM_ADDED
:

992 
diff
->
rŞe_Œªs_diffs
->
num_added
++;

995 
POLDIFF_FORM_ADD_TYPE
:

997 
diff
->
rŞe_Œªs_diffs
->
num_added_ty³
++;

1000 
POLDIFF_FORM_REMOVED
:

1002 
diff
->
rŞe_Œªs_diffs
->
num_»moved
++;

1005 
POLDIFF_FORM_REMOVE_TYPE
:

1007 
diff
->
rŞe_Œªs_diffs
->
num_»moved_ty³
++;

1013 
	`as£¹
(0);

1018 
	}
}

1020 
	$rŞe_Œªs_d“p_diff
(
pŞdiff_t
 * 
diff
, cÚ¡ *
x
, cÚ¡ *
y
)

1022 cÚ¡ 
p£udo_rŞe_Œªs_t
 *
´t1
 = 
x
;

1023 cÚ¡ 
p£udo_rŞe_Œªs_t
 *
´t2
 = 
y
;

1024 cÚ¡ *
deçuÉ1
 = 
NULL
, *
deçuÉ2
 = NULL;

1025 
pŞdiff_rŞe_Œªs_t
 *
¹
 = 
NULL
;

1026 cÚ¡ *
tgt
 = 
NULL
;

1027 
”rÜ
 = 0;

1029 
deçuÉ1
 = 
´t1
->
deçuÉ_rŞe
;

1030 
deçuÉ2
 = 
´t2
->
deçuÉ_rŞe
;

1032 ià(!
	`¡rcmp
(
deçuÉ1
, 
deçuÉ2
))

1035 
tgt
 = 
	`ty³_m­_g‘_Çme
(
diff
, 
´t1
->
p£udo_rg‘
, 
POLDIFF_POLICY_ORIG
);

1036 
	`as£¹
(
tgt
 !ğ
NULL
);

1037 
¹
 = 
	`make_¹_diff
(
diff
, 
POLDIFF_FORM_MODIFIED
, 
´t1
->
sourû_rŞe
, 
tgt
);

1038 ià(!
¹
)

1040 
¹
->
Üig_deçuÉ
 = 
deçuÉ1
;

1041 
¹
->
mod_deçuÉ
 = 
deçuÉ2
;

1042 ià(
	`­Ş_veùÜ_­³nd
(
diff
->
rŞe_Œªs_diffs
->
diffs
, 
¹
)) {

1043 
”rÜ
 = 
”ºo
;

1044 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1045 
	`rŞe_Œªs_ä“
(
¹
);

1046 
”ºo
 = 
”rÜ
;

1049 
diff
->
rŞe_Œªs_diffs
->
num_modif›d
++;

1052 
	}
}

	@libpoldiff/src/rbac_internal.h

26 #iâdeà
POLDIFF_RBAC_INTERNAL_H


27 
	#POLDIFF_RBAC_INTERNAL_H


	)

29 #ifdef 
__ılu¥lus


34 
pŞdiff_rŞe_®low_summ¬y
 
	tpŞdiff_rŞe_®low_summ¬y_t
;

35 
pŞdiff_rŞe_Œªs_summ¬y
 
	tpŞdiff_rŞe_Œªs_summ¬y_t
;

43 
pŞdiff_rŞe_®low_summ¬y_t
 *
rŞe_®low_ü—‹
();

53 
rŞe_®low_de¡roy
(
pŞdiff_rŞe_®low_summ¬y_t
 ** 
¿s
);

62 
rŞe_®low_»£t
(
pŞdiff_t
 * 
diff
);

76 
­Ş_veùÜ_t
 *
rŞe_®low_g‘_™ems
(
pŞdiff_t
 * 
diff
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
);

90 
rŞe_®low_comp
(cÚ¡ *
x
, cÚ¡ *
y
, cÚ¡ 
pŞdiff_t
 * 
diff
);

103 
rŞe_®low_Ãw_diff
(
pŞdiff_t
 * 
diff
, 
pŞdiff_fÜm_e
 
fÜm
, cÚ¡ *
™em
);

119 
rŞe_®low_d“p_diff
(
pŞdiff_t
 * 
diff
, cÚ¡ *
x
, cÚ¡ *
y
);

127 
pŞdiff_rŞe_Œªs_summ¬y_t
 *
rŞe_Œªs_ü—‹
();

137 
rŞe_Œªs_de¡roy
(
pŞdiff_rŞe_Œªs_summ¬y_t
 ** 
¹s
);

146 
rŞe_Œªs_»£t
(
pŞdiff_t
 * 
diff
);

160 
­Ş_veùÜ_t
 *
rŞe_Œªs_g‘_™ems
(
pŞdiff_t
 * 
diff
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
);

174 
rŞe_Œªs_comp
(cÚ¡ *
x
, cÚ¡ *
y
, cÚ¡ 
pŞdiff_t
 * 
diff
);

187 
rŞe_Œªs_Ãw_diff
(
pŞdiff_t
 * 
diff
, 
pŞdiff_fÜm_e
 
fÜm
, cÚ¡ *
™em
);

203 
rŞe_Œªs_d“p_diff
(
pŞdiff_t
 * 
diff
, cÚ¡ *
x
, cÚ¡ *
y
);

205 #ifdef 
__ılu¥lus


	@libpoldiff/src/role_diff.c

25 
	~<cÚfig.h
>

27 
	~"pŞdiff_š‹º®.h
"

29 
	~<­Ş/ut.h
>

30 
	~<”ºo.h
>

31 
	~<¡dio.h
>

32 
	~<¡ršg.h
>

34 
	spŞdiff_rŞe_summ¬y


36 
size_t
 
	mnum_added
;

37 
size_t
 
	mnum_»moved
;

38 
size_t
 
	mnum_modif›d
;

39 
­Ş_veùÜ_t
 *
	mdiffs
;

42 
	spŞdiff_rŞe


44 *
	mÇme
;

45 
pŞdiff_fÜm_e
 
	mfÜm
;

46 
­Ş_veùÜ_t
 *
	madded_ty³s
;

47 
­Ş_veùÜ_t
 *
	m»moved_ty³s
;

50 
	$pŞdiff_rŞe_g‘_¡©s
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
size_t
 
¡©s
[5])

52 ià(
diff
 =ğ
NULL
 || 
¡©s
 == NULL) {

53 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
EINVAL
));

54 
”ºo
 = 
EINVAL
;

57 
¡©s
[0] = 
diff
->
rŞe_diffs
->
num_added
;

58 
¡©s
[1] = 
diff
->
rŞe_diffs
->
num_»moved
;

59 
¡©s
[2] = 
diff
->
rŞe_diffs
->
num_modif›d
;

60 
¡©s
[3] = 0;

61 
¡©s
[4] = 0;

62 
	}
}

64 *
	$pŞdiff_rŞe_to_¡ršg
(cÚ¡ 
pŞdiff_t
 * 
diff
, cÚ¡ *
rŞe
)

66 cÚ¡ 
pŞdiff_rŞe_t
 *
r
 = 
rŞe
;

67 
size_t
 
num_added
, 
num_»moved
, 
Ën
 = 0, 
i
;

68 *
s
 = 
NULL
, *
ty³
;

69 ià(
diff
 =ğ
NULL
 || 
rŞe
 == NULL) {

70 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
EINVAL
));

71 
”ºo
 = 
EINVAL
;

72  
NULL
;

74 
num_added
 = 
	`­Ş_veùÜ_g‘_size
(
r
->
added_ty³s
);

75 
num_»moved
 = 
	`­Ş_veùÜ_g‘_size
(
r
->
»moved_ty³s
);

76 
r
->
fÜm
) {

77 
POLDIFF_FORM_ADDED
:

79 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "+ %s", 
r
->
Çme
) < 0) {

80 
s
 = 
NULL
;

83  
s
;

85 
POLDIFF_FORM_REMOVED
:

87 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "- %s", 
r
->
Çme
) < 0) {

88 
s
 = 
NULL
;

91  
s
;

93 
POLDIFF_FORM_MODIFIED
:

95 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "* % (", 
r
->
Çme
) < 0) {

96 
s
 = 
NULL
;

99 ià(
num_added
 > 0) {

100 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "%zd Added Ty³%s", 
num_added
, (num_added == 1 ? "" : "s")) < 0) {

104 ià(
num_»moved
 > 0) {

105 ià(
­Ş_¡r_­³ndf


106 (&
s
, &
Ën
, "%s%zd Removed Ty³%s", (
num_added
 > 0 ? ", " : ""), 
num_»moved
,

107 (
num_»moved
 == 1 ? "" : "s")) < 0) {

111 ià(
	`­Ş_¡r_­³nd
(&
s
, &
Ën
, ")\n") < 0) {

114 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
r
->
added_ty³s
); i++) {

115 
ty³
 = (*)
	`­Ş_veùÜ_g‘_–em’t
(
r
->
added_ty³s
, 
i
);

116 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "\t+ %s\n", 
ty³
) < 0) {

117 
”r
;

120 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
r
->
»moved_ty³s
); i++) {

121 
ty³
 = (*)
	`­Ş_veùÜ_g‘_–em’t
(
r
->
»moved_ty³s
, 
i
);

122 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "\t- %s\n", 
ty³
) < 0) {

123 
”r
;

126  
s
;

130 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
ENOTSUP
));

131 
”ºo
 = 
ENOTSUP
;

132  
NULL
;

135 
”r
:

137 
	`ä“
(
s
);

138 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

139 
”ºo
 = 
ENOMEM
;

140  
NULL
;

141 
	}
}

143 cÚ¡ 
­Ş_veùÜ_t
 *
	$pŞdiff_g‘_rŞe_veùÜ
(cÚ¡ 
pŞdiff_t
 * 
diff
)

145 ià(
diff
 =ğ
NULL
) {

146 
”ºo
 = 
EINVAL
;

147  
NULL
;

149  
diff
->
rŞe_diffs
->
diffs
;

150 
	}
}

152 cÚ¡ *
	$pŞdiff_rŞe_g‘_Çme
(cÚ¡ 
pŞdiff_rŞe_t
 * 
rŞe
)

154 ià(
rŞe
 =ğ
NULL
) {

155 
”ºo
 = 
EINVAL
;

156  
NULL
;

158  
rŞe
->
Çme
;

159 
	}
}

161 
pŞdiff_fÜm_e
 
	$pŞdiff_rŞe_g‘_fÜm
(cÚ¡ *
rŞe
)

163 ià(
rŞe
 =ğ
NULL
) {

164 
”ºo
 = 
EINVAL
;

167  ((cÚ¡ 
pŞdiff_rŞe_t
 *)
rŞe
)->
fÜm
;

168 
	}
}

170 cÚ¡ 
­Ş_veùÜ_t
 *
	$pŞdiff_rŞe_g‘_added_ty³s
(cÚ¡ 
pŞdiff_rŞe_t
 * 
rŞe
)

172 ià(
rŞe
 =ğ
NULL
) {

173 
”ºo
 = 
EINVAL
;

174  
NULL
;

176  
rŞe
->
added_ty³s
;

177 
	}
}

179 cÚ¡ 
­Ş_veùÜ_t
 *
	$pŞdiff_rŞe_g‘_»moved_ty³s
(cÚ¡ 
pŞdiff_rŞe_t
 * 
rŞe
)

181 ià(
rŞe
 =ğ
NULL
) {

182 
”ºo
 = 
EINVAL
;

183  
NULL
;

185  
rŞe
->
»moved_ty³s
;

186 
	}
}

190 
	$rŞe_ä“
(*
–em
)

192 ià(
–em
 !ğ
NULL
) {

193 
pŞdiff_rŞe_t
 *
r
 = (pŞdiff_rŞe_ˆ*è
–em
;

194 
	`ä“
(
r
->
Çme
);

195 
	`­Ş_veùÜ_de¡roy
(&
r
->
added_ty³s
);

196 
	`­Ş_veùÜ_de¡roy
(&
r
->
»moved_ty³s
);

197 
	`ä“
(
r
);

199 
	}
}

201 
pŞdiff_rŞe_summ¬y_t
 *
	$rŞe_ü—‹
()

203 
pŞdiff_rŞe_summ¬y_t
 *
rs
 = 
	`ÿÎoc
(1, (*rs));

204 ià(
rs
 =ğ
NULL
) {

205  
NULL
;

207 ià((
rs
->
diffs
 = 
	`­Ş_veùÜ_ü—‹
(
rŞe_ä“
)è=ğ
NULL
) {

208 
	`rŞe_de¡roy
(&
rs
);

209  
NULL
;

211  
rs
;

212 
	}
}

214 
	$rŞe_de¡roy
(
pŞdiff_rŞe_summ¬y_t
 ** 
rs
)

216 ià(
rs
 !ğ
NULL
 && *rs != NULL) {

217 
	`­Ş_veùÜ_de¡roy
(&(*
rs
)->
diffs
);

218 
	`ä“
(*
rs
);

219 *
rs
 = 
NULL
;

221 
	}
}

223 
	$rŞe_»£t
(
pŞdiff_t
 * 
diff
)

225 
”rÜ
 = 0;

227 ià(
diff
 =ğ
NULL
) {

228 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
EINVAL
));

229 
”ºo
 = 
EINVAL
;

233 
	`rŞe_de¡roy
(&
diff
->
rŞe_diffs
);

234 
diff
->
rŞe_diffs
 = 
	`rŞe_ü—‹
();

235 ià(
diff
->
rŞe_diffs
 =ğ
NULL
) {

236 
”rÜ
 = 
”ºo
;

237 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

238 
”ºo
 = 
”rÜ
;

243 
	}
}

248 
	$rŞe_Çme_comp
(cÚ¡ *
x
, cÚ¡ *
y
, *
¬g
)

250 cÚ¡ 
qpŞ_rŞe_t
 *
r1
 = 
x
;

251 cÚ¡ 
qpŞ_rŞe_t
 *
r2
 = 
y
;

252 
­Ş_pŞicy_t
 *
p
 = (­Ş_pŞicy_ˆ*è
¬g
;

253 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
p
);

254 cÚ¡ *
Çme1
, *
Çme2
;

255 ià(
	`qpŞ_rŞe_g‘_Çme
(
q
, 
r1
, &
Çme1
è< 0 || qpŞ_rŞe_g‘_Çme(q, 
r2
, &
Çme2
) < 0) {

258  
	`¡rcmp
(
Çme1
, 
Çme2
);

259 
	}
}

261 
­Ş_veùÜ_t
 *
	$rŞe_g‘_™ems
(
pŞdiff_t
 * 
diff
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
)

263 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

264 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

265 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicy
);

266 
”rÜ
 = 0;

267 ià(
	`qpŞ_pŞicy_g‘_rŞe_™”
(
q
, &
™”
) < 0) {

268  
NULL
;

270 
v
 = 
	`­Ş_veùÜ_ü—‹_äom_™”
(
™”
, 
NULL
);

271 ià(
v
 =ğ
NULL
) {

272 
”rÜ
 = 
”ºo
;

273 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

274 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

275 
”ºo
 = 
”rÜ
;

276  
NULL
;

278 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

279 
	`­Ş_veùÜ_sÜt
(
v
, 
rŞe_Çme_comp
, (*)
pŞicy
);

280  
v
;

281 
	}
}

283 
	$rŞe_comp
(cÚ¡ *
x
, cÚ¡ *
y
, cÚ¡ 
pŞdiff_t
 * 
diff
)

285 cÚ¡ 
qpŞ_rŞe_t
 *
r1
 = 
x
;

286 cÚ¡ 
qpŞ_rŞe_t
 *
r2
 = 
y
;

287 cÚ¡ *
Çme1
, *
Çme2
;

288 ià(
	`qpŞ_rŞe_g‘_Çme
(
diff
->
Üig_qpŞ
, 
r1
, &
Çme1
è< 0 || qpŞ_rŞe_g‘_Çme(diff->
mod_qpŞ
, 
r2
, &
Çme2
) < 0) {

291  
	`¡rcmp
(
Çme1
, 
Çme2
);

292 
	}
}

305 
pŞdiff_rŞe_t
 *
	$make_diff
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
pŞdiff_fÜm_e
 
fÜm
, cÚ¡ *
Çme
)

307 
pŞdiff_rŞe_t
 *
´
;

308 
”rÜ
;

309 ià((
´
 = 
	`ÿÎoc
(1, (*´))è=ğ
NULL
 ||

310 (
´
->
Çme
 = 
	`¡rdup
Òame)è=ğ
NULL
 ||

311 (
´
->
added_ty³s
 = 
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(1, 
ä“
)è=ğ
NULL
 ||

312 (
´
->
»moved_ty³s
 = 
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(1, 
ä“
)è=ğ
NULL
) {

313 
”rÜ
 = 
”ºo
;

314 
	`rŞe_ä“
(
´
);

315 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

316 
”ºo
 = 
”rÜ
;

317  
NULL
;

319 
´
->
fÜm
 = form;

320  
´
;

321 
	}
}

323 
	$rŞe_Ãw_diff
(
pŞdiff_t
 * 
diff
, 
pŞdiff_fÜm_e
 
fÜm
, cÚ¡ *
™em
)

325 cÚ¡ 
qpŞ_rŞe_t
 *
r
 = 
™em
;

326 cÚ¡ *
Çme
 = 
NULL
;

327 
pŞdiff_rŞe_t
 *
´
;

328 
”rÜ
;

329 ià((
fÜm
 =ğ
POLDIFF_FORM_ADDED
 &&

330 
	`qpŞ_rŞe_g‘_Çme
(
diff
->
mod_qpŞ
, 
r
, &
Çme
) < 0) ||

331 ((
fÜm
 =ğ
POLDIFF_FORM_REMOVED
 || fÜm =ğ
POLDIFF_FORM_MODIFIED
è&& 
	`qpŞ_rŞe_g‘_Çme
(
diff
->
Üig_qpŞ
, 
r
, &
Çme
) < 0))

335 
´
 = 
	`make_diff
(
diff
, 
fÜm
, 
Çme
);

336 ià(
´
 =ğ
NULL
) {

339 ià(
	`­Ş_veùÜ_­³nd
(
diff
->
rŞe_diffs
->
diffs
, 
´
) < 0) {

340 
”rÜ
 = 
”ºo
;

341 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

342 
	`rŞe_ä“
(
´
);

343 
”ºo
 = 
”rÜ
;

346 ià(
fÜm
 =ğ
POLDIFF_FORM_ADDED
) {

347 
diff
->
rŞe_diffs
->
num_added
++;

349 
diff
->
rŞe_diffs
->
num_»moved
++;

352 
	}
}

366 
­Ş_veùÜ_t
 *
	$rŞe_g‘_ty³s
(cÚ¡ 
pŞdiff_t
 * 
diff
, cÚ¡ 
qpŞ_rŞe_t
 * 
rŞe
, 
which
)

368 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

369 cÚ¡ 
qpŞ_ty³_t
 *
ty³
;

370 
ušt32_t
 
Ãw_v®
;

371 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

372 
»tv®
 = -1, 
”rÜ
 = 0;

374 ià((
v
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)) == NULL) {

375 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”ºo
));

376 
ş—nup
;

378 ià(
which
 =ğ
POLDIFF_POLICY_ORIG
) {

379 ià(
	`qpŞ_rŞe_g‘_ty³_™”
(
diff
->
Üig_qpŞ
, 
rŞe
, &
™”
) < 0) {

380 
ş—nup
;

383 ià(
	`qpŞ_rŞe_g‘_ty³_™”
(
diff
->
mod_qpŞ
, 
rŞe
, &
™”
) < 0) {

384 
ş—nup
;

387 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

388 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
ty³
è< 0 || (
Ãw_v®
 = 
	`ty³_m­_lookup
(
diff
,y³, 
which
)) == 0) {

389 
”rÜ
 = 
”ºo
;

390 
ş—nup
;

392 ià(
	`­Ş_veùÜ_­³nd
(
v
, (*)((
size_t
è
Ãw_v®
)) < 0) {

393 
”rÜ
 = 
”ºo
;

394 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

395 
ş—nup
;

399 
»tv®
 = 0;

400 
ş—nup
:

401 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

402 ià(
»tv®
 < 0) {

403 
	`­Ş_veùÜ_de¡roy
(&
v
);

404 
”ºo
 = 
”rÜ
;

405  
NULL
;

407  
v
;

408 
	}
}

410 
	$rŞe_d“p_diff
(
pŞdiff_t
 * 
diff
, cÚ¡ *
x
, cÚ¡ *
y
)

412 cÚ¡ 
qpŞ_rŞe_t
 *
r1
 = 
x
;

413 cÚ¡ 
qpŞ_rŞe_t
 *
r2
 = 
y
;

414 
­Ş_veùÜ_t
 *
v1
 = 
NULL
, *
v2
 = NULL;

415 
­Ş_veùÜ_t
 *
added_ty³s
 = 
NULL
, *
»moved_ty³s
 = NULL;

416 cÚ¡ 
­Ş_veùÜ_t
 *
»v”£_v
;

417 cÚ¡ *
Çme
;

418 *
Ãw_Çme
;

419 
ušt32_t
 
t1
, 
t2
;

420 
pŞdiff_rŞe_t
 *
r
 = 
NULL
;

421 
qpŞ_ty³_t
 *
t
;

422 
size_t
 
i
, 
j
;

423 
»tv®
 = -1, 
”rÜ
 = 0;

425 ià(
	`qpŞ_rŞe_g‘_Çme
(
diff
->
Üig_qpŞ
, 
r1
, &
Çme
) < 0 ||

426 (
v1
 = 
	`rŞe_g‘_ty³s
(
diff
, 
r1
, 
POLDIFF_POLICY_ORIG
)è=ğ
NULL
 ||

427 (
v2
 = 
	`rŞe_g‘_ty³s
(
diff
, 
r2
, 
POLDIFF_POLICY_MOD
)è=ğ
NULL
) {

428 
”rÜ
 = 
”ºo
;

429 
ş—nup
;

431 
	`­Ş_veùÜ_sÜt_uniquify
(
v1
, 
NULL
, NULL);

432 
	`­Ş_veùÜ_sÜt_uniquify
(
v2
, 
NULL
, NULL);

433 ià((
added_ty³s
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)è=ğNULL || (
»moved_ty³s
 =‡pol_vector_create(NULL)) == NULL) {

434 
”rÜ
 = 
”ºo
;

435 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

436 
ş—nup
;

438 
i
 = 
j
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v1
);) {

439 ià(
j
 >ğ
	`­Ş_veùÜ_g‘_size
(
v2
))

441 
t1
 = (
ušt32_t
è((
size_t
è
	`­Ş_veùÜ_g‘_–em’t
(
v1
, 
i
));

442 
t2
 = (
ušt32_t
è((
size_t
è
	`­Ş_veùÜ_g‘_–em’t
(
v2
, 
j
));

443 ià(
t2
 > 
t1
) {

444 ià(
	`­Ş_veùÜ_­³nd
(
»moved_ty³s
, (*)((
size_t
è
t1
)) < 0) {

445 
”rÜ
 = 
”ºo
;

446 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

447 
ş—nup
;

449 
i
++;

450 } ià(
t1
 > 
t2
) {

451 ià(
	`­Ş_veùÜ_­³nd
(
added_ty³s
, (*)((
size_t
è
t2
)) < 0) {

452 
”rÜ
 = 
”ºo
;

453 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

454 
ş—nup
;

456 
j
++;

458 
i
++;

459 
j
++;

462 ; 
i
 < 
	`­Ş_veùÜ_g‘_size
(
v1
); i++) {

463 
t1
 = (
ušt32_t
è((
size_t
è
	`­Ş_veùÜ_g‘_–em’t
(
v1
, 
i
));

464 ià(
	`­Ş_veùÜ_­³nd
(
»moved_ty³s
, (*)((
size_t
è
t1
)) < 0) {

465 
”rÜ
 = 
”ºo
;

466 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

467 
ş—nup
;

470 ; 
j
 < 
	`­Ş_veùÜ_g‘_size
(
v2
); j++) {

471 
t2
 = (
ušt32_t
è((
size_t
è
	`­Ş_veùÜ_g‘_–em’t
(
v2
, 
j
));

472 ià(
	`­Ş_veùÜ_­³nd
(
added_ty³s
, (*)((
size_t
è
t2
)) < 0) {

473 
”rÜ
 = 
”ºo
;

474 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

475 
ş—nup
;

478 ià(
	`­Ş_veùÜ_g‘_size
(
added_ty³s
è> 0 ||‡pŞ_veùÜ_g‘_size(
»moved_ty³s
) > 0) {

479 ià((
r
 = 
	`make_diff
(
diff
, 
POLDIFF_FORM_MODIFIED
, 
Çme
)è=ğ
NULL
) {

480 
”rÜ
 = 
”ºo
;

481 
ş—nup
;

483 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
»moved_ty³s
); i++) {

484 
t1
 = (
ušt32_t
è((
size_t
è
	`­Ş_veùÜ_g‘_–em’t
(
»moved_ty³s
, 
i
));

485 ià((
»v”£_v
 = 
	`ty³_m­_lookup_»v”£
(
diff
, 
t1
, 
POLDIFF_POLICY_ORIG
)è=ğ
NULL
) {

486 
”rÜ
 = 
”ºo
;

487 
ş—nup
;

489 
j
 = 0; j < 
	`­Ş_veùÜ_g‘_size
(
»v”£_v
); j++) {

490 
t
 = (
qpŞ_ty³_t
 *è
	`­Ş_veùÜ_g‘_–em’t
(
»v”£_v
, 
j
);

491 ià(
	`qpŞ_ty³_g‘_Çme
(
diff
->
Üig_qpŞ
, 
t
, &
Çme
) < 0) {

492 
”rÜ
 = 
”ºo
;

493 
ş—nup
;

495 ià((
Ãw_Çme
 = 
	`¡rdup
(
Çme
)è=ğ
NULL
 || 
	`­Ş_veùÜ_­³nd
(
r
->
»moved_ty³s
,‚ew_name) < 0) {

496 
”rÜ
 = 
”ºo
;

497 
	`ä“
(
Ãw_Çme
);

498 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

499 
ş—nup
;

503 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
added_ty³s
); i++) {

504 
t2
 = (
ušt32_t
è((
size_t
è
	`­Ş_veùÜ_g‘_–em’t
(
added_ty³s
, 
i
));

505 ià((
»v”£_v
 = 
	`ty³_m­_lookup_»v”£
(
diff
, 
t2
, 
POLDIFF_POLICY_MOD
)è=ğ
NULL
) {

506 
”rÜ
 = 
”ºo
;

507 
ş—nup
;

509 
j
 = 0; j < 
	`­Ş_veùÜ_g‘_size
(
»v”£_v
); j++) {

510 
t
 = (
qpŞ_ty³_t
 *è
	`­Ş_veùÜ_g‘_–em’t
(
»v”£_v
, 
j
);

511 ià(
	`qpŞ_ty³_g‘_Çme
(
diff
->
mod_qpŞ
, 
t
, &
Çme
) < 0) {

512 
”rÜ
 = 
”ºo
;

513 
ş—nup
;

515 ià((
Ãw_Çme
 = 
	`¡rdup
(
Çme
)è=ğ
NULL
 || 
	`­Ş_veùÜ_­³nd
(
r
->
added_ty³s
,‚ew_name) < 0) {

516 
”rÜ
 = 
”ºo
;

517 
	`ä“
(
Ãw_Çme
);

518 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

519 
ş—nup
;

523 
	`­Ş_veùÜ_sÜt
(
r
->
»moved_ty³s
, 
­Ş_¡r_¡rcmp
, 
NULL
);

524 
	`­Ş_veùÜ_sÜt
(
r
->
added_ty³s
, 
­Ş_¡r_¡rcmp
, 
NULL
);

525 ià(
	`­Ş_veùÜ_­³nd
(
diff
->
rŞe_diffs
->
diffs
, 
r
) < 0) {

526 
”rÜ
 = 
”ºo
;

527 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

528 
ş—nup
;

530 
diff
->
rŞe_diffs
->
num_modif›d
++;

532 
»tv®
 = 0;

533 
ş—nup
:

534 
	`­Ş_veùÜ_de¡roy
(&
v1
);

535 
	`­Ş_veùÜ_de¡roy
(&
v2
);

536 
	`­Ş_veùÜ_de¡roy
(&
added_ty³s
);

537 
	`­Ş_veùÜ_de¡roy
(&
»moved_ty³s
);

538 ià(
»tv®
 != 0) {

539 
	`rŞe_ä“
(
r
);

541 
”ºo
 = 
”rÜ
;

542  
»tv®
;

543 
	}
}

	@libpoldiff/src/role_internal.h

25 #iâdeà
POLDIFF_ROLE_INTERNAL_H


26 
	#POLDIFF_ROLE_INTERNAL_H


	)

28 #ifdef 
__ılu¥lus


33 
pŞdiff_rŞe_summ¬y
 
	tpŞdiff_rŞe_summ¬y_t
;

41 
pŞdiff_rŞe_summ¬y_t
 *
rŞe_ü—‹
();

51 
rŞe_de¡roy
(
pŞdiff_rŞe_summ¬y_t
 ** 
us
);

60 
rŞe_»£t
(
pŞdiff_t
 * 
diff
);

72 
­Ş_veùÜ_t
 *
rŞe_g‘_™ems
(
pŞdiff_t
 * 
diff
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
);

86 
rŞe_comp
(cÚ¡ *
x
, cÚ¡ *
y
, cÚ¡ 
pŞdiff_t
 * 
diff
);

99 
rŞe_Ãw_diff
(
pŞdiff_t
 * 
diff
, 
pŞdiff_fÜm_e
 
fÜm
, cÚ¡ *
™em
);

115 
rŞe_d“p_diff
(
pŞdiff_t
 * 
diff
, cÚ¡ *
x
, cÚ¡ *
y
);

117 #ifdef 
__ılu¥lus


	@libpoldiff/src/terule_diff.c

26 
	~<cÚfig.h
>

28 
	~"pŞdiff_š‹º®.h
"

30 
	~<­Ş/pŞicy-qu”y.h
>

31 
	~<­Ş/ut.h
>

32 
	~<qpŞ/pŞicy_ex‹nd.h
>

33 
	~<as£¹.h
>

34 
	~<”ºo.h
>

35 
	~<¡dio.h
>

36 
	~<¡ršg.h
>

38 
	spŞdiff_‹ruË_summ¬y


40 
size_t
 
	mnum_added
;

41 
size_t
 
	mnum_»moved
;

42 
size_t
 
	mnum_modif›d
;

43 
size_t
 
	mnum_added_ty³
;

44 
size_t
 
	mnum_»moved_ty³
;

45 
	mdiffs_sÜ‹d
;

47 
­Ş_veùÜ_t
 *
	mdiffs
;

50 
	spŞdiff_‹ruË


52 
ušt32_t
 
	m¥ec
;

54 cÚ¡ *
	msourû
, *
	mrg‘
;

56 cÚ¡ *
	mşs
;

57 
pŞdiff_fÜm_e
 
	mfÜm
;

59 cÚ¡ *
	mÜig_deçuÉ
, *
	mmod_deçuÉ
;

62 cÚ¡ 
qpŞ_cÚd_t
 *
	mcÚd
;

63 
ušt32_t
 
	mb¿nch
;

65 
­Ş_veùÜ_t
 *
	mÜig_lš’os
;

67 
­Ş_veùÜ_t
 *
	mmod_lš’os
;

69 
qpŞ_‹ruË_t
 **
	mÜig_ruËs
;

70 
size_t
 
	mnum_Üig_ruËs
;

72 
qpŞ_‹ruË_t
 **
	mmod_ruËs
;

73 
size_t
 
	mnum_mod_ruËs
;

76 
	sp£udo_‹ruË


78 
ušt32_t
 
	m¥ec
;

80 
ušt32_t
 
	msourû
, 
	mrg‘
, 
	mdeçuÉ_ty³
;

82 cÚ¡ *
	mşs
;

84 cÚ¡ *
	mboŞs
[5];

85 
ušt32_t
 
	mboŞ_v®
;

86 
ušt32_t
 
	mb¿nch
;

89 cÚ¡ 
qpŞ_cÚd_t
 *
	mcÚd
;

91 cÚ¡ 
qpŞ_‹ruË_t
 **
	mruËs
;

92 
size_t
 
	mnum_ruËs
;

93 } 
	tp£udo_‹ruË_t
;

111 
	$pŞdiff_‹ruË_g‘_¡©s
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
size_t
 
¡©s
[5], 
idx
)

113 ià(
diff
 =ğ
NULL
 || 
¡©s
 == NULL) {

114 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
EINVAL
));

115 
”ºo
 = 
EINVAL
;

118 
¡©s
[0] = 
diff
->
‹ruË_diffs
[
idx
]->
num_added
;

119 
¡©s
[1] = 
diff
->
‹ruË_diffs
[
idx
]->
num_»moved
;

120 
¡©s
[2] = 
diff
->
‹ruË_diffs
[
idx
]->
num_modif›d
;

121 
¡©s
[3] = 
diff
->
‹ruË_diffs
[
idx
]->
num_added_ty³
;

122 
¡©s
[4] = 
diff
->
‹ruË_diffs
[
idx
]->
num_»moved_ty³
;

123 
	}
}

125 
	$pŞdiff_‹ruË_g‘_¡©s_chªge
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
size_t
 
¡©s
[5])

127 
	`pŞdiff_‹ruË_g‘_¡©s
(
diff
, 
¡©s
, 
TERULE_OFFSET_CHANGE
);

128 
	}
}

130 
	$pŞdiff_‹ruË_g‘_¡©s_memb”
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
size_t
 
¡©s
[5])

132 
	`pŞdiff_‹ruË_g‘_¡©s
(
diff
, 
¡©s
, 
TERULE_OFFSET_MEMBER
);

133 
	}
}

135 
	$pŞdiff_‹ruË_g‘_¡©s_Œªs
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
size_t
 
¡©s
[5])

137 
	`pŞdiff_‹ruË_g‘_¡©s
(
diff
, 
¡©s
, 
TERULE_OFFSET_TRANS
);

138 
	}
}

140 *
	$pŞdiff_‹ruË_to_¡ršg
(cÚ¡ 
pŞdiff_t
 * 
diff
, cÚ¡ *
‹ruË
)

142 cÚ¡ 
pŞdiff_‹ruË_t
 *
±
 = (cÚ¡…Şdiff_‹ruË_ˆ*)
‹ruË
;

143 
­Ş_pŞicy_t
 *
p
;

144 cÚ¡ *
ruË_ty³
;

145 *
diff_ch¬
 = "", *
s
 = 
NULL
, *
cÚd_ex´
 = NULL;

146 
size_t
 
Ën
 = 0;

147 
”rÜ
;

148 ià(
diff
 =ğ
NULL
 || 
‹ruË
 == NULL) {

149 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
EINVAL
));

150 
”ºo
 = 
EINVAL
;

151  
NULL
;

153 
±
->
fÜm
) {

154 
POLDIFF_FORM_ADDED
:

155 
POLDIFF_FORM_ADD_TYPE
:

157 
diff_ch¬
 = "+";

158 
p
 = 
diff
->
mod_pŞ
;

161 
POLDIFF_FORM_REMOVED
:

162 
POLDIFF_FORM_REMOVE_TYPE
:

164 
diff_ch¬
 = "-";

165 
p
 = 
diff
->
Üig_pŞ
;

168 
POLDIFF_FORM_MODIFIED
:

170 
diff_ch¬
 = "*";

171 
p
 = 
diff
->
Üig_pŞ
;

176 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
ENOTSUP
));

177 
”ºo
 = 
ENOTSUP
;

178  
NULL
;

181 
ruË_ty³
 = 
	`­Ş_ruË_ty³_to_¡r
(
±
->
¥ec
);

182 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "% % % % : % ", 
diff_ch¬
, 
ruË_ty³
, 
±
->
sourû
,…t->
rg‘
,…t->
şs
) < 0) {

183 
”rÜ
 = 
”ºo
;

184 
s
 = 
NULL
;

185 
”r
;

187 
±
->
fÜm
) {

188 
POLDIFF_FORM_ADDED
:

189 
POLDIFF_FORM_ADD_TYPE
:

191 ià(
	`­Ş_¡r_­³nd
(&
s
, &
Ën
, 
±
->
mod_deçuÉ
) < 0) {

192 
”rÜ
 = 
”ºo
;

193 
”r
;

197 
POLDIFF_FORM_REMOVED
:

198 
POLDIFF_FORM_REMOVE_TYPE
:

200 ià(
	`­Ş_¡r_­³nd
(&
s
, &
Ën
, 
±
->
Üig_deçuÉ
) < 0) {

201 
”rÜ
 = 
”ºo
;

202 
”r
;

206 
POLDIFF_FORM_MODIFIED
:

208 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "{ -% +% }", 
±
->
Üig_deçuÉ
,…t->
mod_deçuÉ
) < 0) {

209 
”rÜ
 = 
”ºo
;

210 
”r
;

216 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
ENOTSUP
));

217 
”ºo
 = 
ENOTSUP
;

218  
NULL
;

221 ià(
	`­Ş_¡r_­³nd
(&
s
, &
Ën
, ";") < 0) {

222 
”rÜ
 = 
”ºo
;

223 
”r
;

225 ià(
±
->
cÚd
 !ğ
NULL
) {

226 ià((
cÚd_ex´
 = 
	`­Ş_cÚd_ex´_»nd”
(
p
, 
±
->
cÚd
)è=ğ
NULL
) {

227 
”rÜ
 = 
”ºo
;

228 
”r
;

230 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, " [%s]:%s", 
cÚd_ex´
, (
±
->
b¿nch
 ? "TRUE" : "FALSE")) < 0) {

231 
”rÜ
 = 
”ºo
;

232 
”r
;

234 
	`ä“
(
cÚd_ex´
);

236  
s
;

237 
”r
:

238 
	`ä“
(
s
);

239 
	`ä“
(
cÚd_ex´
);

240 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

241 
”ºo
 = 
”rÜ
;

242  
NULL
;

243 
	}
}

248 
pŞdiff_‹ruË_cmp
(cÚ¡ *
x
, cÚ¡ *
y
, *
d©a
 
__©Œibu‹__
 ((
unu£d
)))

250 cÚ¡ 
pŞdiff_‹ruË_t
 *
	ga
 = (cÚ¡…Şdiff_‹ruË_ˆ*)
x
;

251 cÚ¡ 
pŞdiff_‹ruË_t
 *
	gb
 = (cÚ¡…Şdiff_‹ruË_ˆ*)
y
;

252 
	gcompv®
;

253 ià(
	ga
->
	g¥ec
 !ğ
b
->
¥ec
) {

254 cÚ¡ *
ruË_ty³1
 = 
­Ş_ruË_ty³_to_¡r
(
a
->
¥ec
);

255 cÚ¡ *
	gruË_ty³2
 = 
­Ş_ruË_ty³_to_¡r
(
b
->
¥ec
);

256 
	gcompv®
 = 
¡rcmp
(
ruË_ty³1
, 
ruË_ty³2
);

257 ià(
	gcompv®
 != 0) {

258  
compv®
;

261 ià((
	gcompv®
 = 
¡rcmp
(
a
->
sourû
, 
b
->source)) != 0) {

262  
compv®
;

264 ià((
	gcompv®
 = 
¡rcmp
(
a
->
rg‘
, 
b
->target)) != 0) {

265  
compv®
;

267 ià((
	gcompv®
 = 
¡rcmp
(
a
->
şs
, 
b
->cls)) != 0) {

268  
compv®
;

270 ià(
	ga
->
	gcÚd
 !ğ
b
->
cÚd
) {

271  ()((*)
a
->
cÚd
 - (*)
b
->cond);

274  
	gb
->
	gb¿nch
 - 
	ga
->branch;

290 cÚ¡ 
­Ş_veùÜ_t
 *
	$pŞdiff_g‘_‹ruË_veùÜ
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
‹ruË_off£t_e
 
idx
)

292 ià(
diff
 =ğ
NULL
) {

293 
”ºo
 = 
EINVAL
;

294  
NULL
;

296 ià(
diff
->
‹ruË_diffs
[
idx
]->
diffs_sÜ‹d
 == 0) {

297 
	`­Ş_veùÜ_sÜt
(
diff
->
‹ruË_diffs
[
idx
]->
diffs
, 
pŞdiff_‹ruË_cmp
, 
NULL
);

298 
diff
->
‹ruË_diffs
[
idx
]->
diffs_sÜ‹d
 = 1;

300  
diff
->
‹ruË_diffs
[
idx
]->
diffs
;

301 
	}
}

303 cÚ¡ 
­Ş_veùÜ_t
 *
	$pŞdiff_g‘_‹ruË_veùÜ_memb”
(cÚ¡ 
pŞdiff_t
 * 
diff
)

305  
	`pŞdiff_g‘_‹ruË_veùÜ
(
diff
, 
TERULE_OFFSET_MEMBER
);

306 
	}
}

308 cÚ¡ 
­Ş_veùÜ_t
 *
	$pŞdiff_g‘_‹ruË_veùÜ_chªge
(cÚ¡ 
pŞdiff_t
 * 
diff
)

310  
	`pŞdiff_g‘_‹ruË_veùÜ
(
diff
, 
TERULE_OFFSET_CHANGE
);

311 
	}
}

313 cÚ¡ 
­Ş_veùÜ_t
 *
	$pŞdiff_g‘_‹ruË_veùÜ_Œªs
(cÚ¡ 
pŞdiff_t
 * 
diff
)

315  
	`pŞdiff_g‘_‹ruË_veùÜ
(
diff
, 
TERULE_OFFSET_TRANS
);

316 
	}
}

318 
pŞdiff_fÜm_e
 
	$pŞdiff_‹ruË_g‘_fÜm
(cÚ¡ *
‹ruË
)

320 ià(
‹ruË
 =ğ
NULL
) {

321 
”ºo
 = 
EINVAL
;

324  ((cÚ¡ 
pŞdiff_‹ruË_t
 *)
‹ruË
)->
fÜm
;

325 
	}
}

327 
ušt32_t
 
	$pŞdiff_‹ruË_g‘_ruË_ty³
(cÚ¡ 
pŞdiff_‹ruË_t
 * 
‹ruË
)

329 ià(
‹ruË
 =ğ
NULL
) {

330 
”ºo
 = 
EINVAL
;

333  
‹ruË
->
¥ec
;

334 
	}
}

336 cÚ¡ *
	$pŞdiff_‹ruË_g‘_sourû_ty³
(cÚ¡ 
pŞdiff_‹ruË_t
 * 
‹ruË
)

338 ià(
‹ruË
 =ğ
NULL
) {

339 
”ºo
 = 
EINVAL
;

342  
‹ruË
->
sourû
;

343 
	}
}

345 cÚ¡ *
	$pŞdiff_‹ruË_g‘_rg‘_ty³
(cÚ¡ 
pŞdiff_‹ruË_t
 * 
‹ruË
)

347 ià(
‹ruË
 =ğ
NULL
) {

348 
”ºo
 = 
EINVAL
;

351  
‹ruË
->
rg‘
;

352 
	}
}

354 cÚ¡ *
	$pŞdiff_‹ruË_g‘_objeù_şass
(cÚ¡ 
pŞdiff_‹ruË_t
 * 
‹ruË
)

356 ià(
‹ruË
 =ğ
NULL
) {

357 
”ºo
 = 
EINVAL
;

360  
‹ruË
->
şs
;

361 
	}
}

363 
	$pŞdiff_‹ruË_g‘_cÚd
(cÚ¡ 
pŞdiff_t
 * 
diff
, cÚ¡ 
pŞdiff_‹ruË_t
 * 
‹ruË
,

364 cÚ¡ 
qpŞ_cÚd_t
 ** 
cÚd
, 
ušt32_t
 * 
which_li¡
, cÚ¡ 
­Ş_pŞicy_t
 ** 
p
)

366 ià(
diff
 =ğ
NULL
 || 
‹ruË
 =ğNULL || 
cÚd
 =ğNULL || 
p
 == NULL) {

367 
”ºo
 = 
EINVAL
;

370 *
cÚd
 = 
‹ruË
->cond;

371 ià(*
cÚd
 =ğ
NULL
) {

372 *
which_li¡
 = 1;

373 *
p
 = 
NULL
;

374 } ià(
‹ruË
->
fÜm
 =ğ
POLDIFF_FORM_ADDED
 ||”uË->fÜm =ğ
POLDIFF_FORM_ADD_TYPE
) {

375 *
which_li¡
 = 
‹ruË
->
b¿nch
;

376 *
p
 = 
diff
->
mod_pŞ
;

378 *
which_li¡
 = 
‹ruË
->
b¿nch
;

379 *
p
 = 
diff
->
Üig_pŞ
;

381 
	}
}

383 cÚ¡ *
	$pŞdiff_‹ruË_g‘_Üigš®_deçuÉ
(cÚ¡ 
pŞdiff_‹ruË_t
 * 
‹ruË
)

385 ià(
‹ruË
 =ğ
NULL
) {

386 
”ºo
 = 
EINVAL
;

389  
‹ruË
->
Üig_deçuÉ
;

390 
	}
}

392 cÚ¡ *
	$pŞdiff_‹ruË_g‘_modif›d_deçuÉ
(cÚ¡ 
pŞdiff_‹ruË_t
 * 
‹ruË
)

394 ià(
‹ruË
 =ğ
NULL
) {

395 
”ºo
 = 
EINVAL
;

398  
‹ruË
->
mod_deçuÉ
;

399 
	}
}

401 
­Ş_veùÜ_t
 *
	$pŞdiff_‹ruË_g‘_Üig_lše_numb”s
(cÚ¡ 
pŞdiff_‹ruË_t
 * 
‹ruË
)

403 ià(
‹ruË
 =ğ
NULL
) {

404 
”ºo
 = 
EINVAL
;

405  
NULL
;

407  
‹ruË
->
Üig_lš’os
;

408 
	}
}

410 
­Ş_veùÜ_t
 *
	$pŞdiff_‹ruË_g‘_mod_lše_numb”s
(cÚ¡ 
pŞdiff_‹ruË_t
 * 
‹ruË
)

412 ià(
‹ruË
 =ğ
NULL
) {

413 
”ºo
 = 
EINVAL
;

414  
NULL
;

416  
‹ruË
->
mod_lš’os
;

417 
	}
}

427 
	$pŞdiff_‹ruË_ä“
(*
–em
)

429 ià(
–em
 !ğ
NULL
) {

430 
pŞdiff_‹ruË_t
 *
t
 = 
–em
;

431 
	`­Ş_veùÜ_de¡roy
(&
t
->
Üig_lš’os
);

432 
	`­Ş_veùÜ_de¡roy
(&
t
->
mod_lš’os
);

433 
	`ä“
(
t
->
Üig_ruËs
);

434 
	`ä“
(
t
->
mod_ruËs
);

435 
	`ä“
(
–em
);

437 
	}
}

439 
pŞdiff_‹ruË_summ¬y_t
 *
	$‹ruË_ü—‹
()

441 
pŞdiff_‹ruË_summ¬y_t
 *
rs
 = 
	`ÿÎoc
(1, (*rs));

442 ià(
rs
 =ğ
NULL
) {

443  
NULL
;

445 ià((
rs
->
diffs
 = 
	`­Ş_veùÜ_ü—‹
(
pŞdiff_‹ruË_ä“
)è=ğ
NULL
) {

446 
	`‹ruË_de¡roy
(&
rs
);

447  
NULL
;

449  
rs
;

450 
	}
}

452 
	$‹ruË_de¡roy
(
pŞdiff_‹ruË_summ¬y_t
 ** 
rs
)

454 ià(
rs
 !ğ
NULL
 && *rs != NULL) {

455 
	`­Ş_veùÜ_de¡roy
(&(*
rs
)->
diffs
);

456 
	`ä“
(*
rs
);

457 *
rs
 = 
NULL
;

459 
	}
}

470 
	$‹ruË_»£t
(
pŞdiff_t
 * 
diff
, 
‹ruË_off£t_e
 
idx
)

472 
”rÜ
 = 0;

473 
	`‹ruË_de¡roy
(&
diff
->
‹ruË_diffs
[
idx
]);

474 
diff
->
‹ruË_diffs
[
idx
] = 
	`‹ruË_ü—‹
();

475 ià(
diff
->
‹ruË_diffs
[
idx
] =ğ
NULL
) {

476 
”rÜ
 = 
”ºo
;

477 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

478 
”ºo
 = 
”rÜ
;

482 
	}
}

484 
	$‹ruË_»£t_chªge
(
pŞdiff_t
 * 
diff
)

486  
	`‹ruË_»£t
(
diff
, 
TERULE_OFFSET_CHANGE
);

487 
	}
}

489 
	$‹ruË_»£t_memb”
(
pŞdiff_t
 * 
diff
)

491  
	`‹ruË_»£t
(
diff
, 
TERULE_OFFSET_MEMBER
);

492 
	}
}

494 
	$‹ruË_»£t_Œªs
(
pŞdiff_t
 * 
diff
)

496  
	`‹ruË_»£t
(
diff
, 
TERULE_OFFSET_TRANS
);

497 
	}
}

499 
	$‹ruË_ä“_™em
(*
™em
)

501 
p£udo_‹ruË_t
 *
t
 = (p£udo_‹ruË_ˆ*è
™em
;

502 ià(
™em
 !ğ
NULL
) {

503 
	`ä“
(
t
->
ruËs
);

504 
	`ä“
(
t
);

506 
	}
}

526 
	$p£udo_‹ruË_comp
(cÚ¡ 
p£udo_‹ruË_t
 * 
ruË1
, cÚ¡…£udo_‹ruË_ˆ* 
ruË2
, 
is_sÜtšg
)

528 
size_t
 
i
;

529 
ušt32_t
 
boŞ_v®
;

530 ià(
ruË1
->
rg‘
 !ğ
ruË2
->target) {

531  
ruË1
->
rg‘
 - 
ruË2
->target;

533 ià(
ruË1
->
sourû
 !ğ
ruË2
->source) {

534  
ruË1
->
sourû
 - 
ruË2
->source;

536 ià(
ruË1
->
şs
 !ğ
ruË2
->cls) {

537  ()(
ruË1
->
şs
 - 
ruË2
->cls);

539 ià(
ruË1
->
¥ec
 !ğ
ruË2
->spec) {

540  
ruË1
->
¥ec
 - 
ruË2
->spec;

542 ià(
ruË1
->
boŞs
[0] =ğ
NULL
 && 
ruË2
->bools[0] == NULL) {

545 } ià(
ruË1
->
boŞs
[0] =ğ
NULL
 && 
ruË2
->bools[0] != NULL) {

548 } ià(
ruË1
->
boŞs
[0] !ğ
NULL
 && 
ruË2
->bools[0] == NULL) {

552 
i
 = 0; i < ((
ruË1
->
boŞs
) / (rule1->bools[0])); i++) {

553 ià(
ruË1
->
boŞs
[
i
] !ğ
ruË2
->bools[i]) {

554  ()(
ruË1
->
boŞs
[
i
] - 
ruË2
->bools[i]);

557 ià(
is_sÜtšg
) {

558 ià(
ruË1
->
b¿nch
 !ğ
ruË2
->branch) {

559  
ruË1
->
b¿nch
 - 
ruË2
->branch;

561  ()
ruË1
->
boŞ_v®
 - ()
ruË2
->bool_val;

563 ià(
ruË1
->
b¿nch
 =ğ
ruË2
->branch) {

564 
boŞ_v®
 = 
ruË2
->bool_val;

566 
boŞ_v®
 = ~
ruË2
->bool_val;

568 ià(
ruË1
->
boŞ_v®
 < bool_val) {

570 } ià(
ruË1
->
boŞ_v®
 > bool_val) {

575 
	}
}

577 
	$‹ruË_b¡_comp
(cÚ¡ *
x
, cÚ¡ *
y
, *
d©a
)

579 cÚ¡ 
p£udo_‹ruË_t
 *
r1
 = (cÚ¡…£udo_‹ruË_ˆ*)
x
;

580 cÚ¡ 
p£udo_‹ruË_t
 *
r2
 = (cÚ¡…£udo_‹ruË_ˆ*)
y
;

581 
pŞdiff_t
 *
diff
 = 
d©a
;

582 
»tv
;

583 
»tv
 = 
	`p£udo_‹ruË_comp
(
r1
, 
r2
, 1);

584 ià(!
»tv
 && 
r1
->
deçuÉ_ty³
 !ğ
r2
->default_type)

585 
	`WARN
(
diff
, "MuÉË % ruË fÜ % % % w™h difã»Á deçuÉy³s", 
	`­Ş_ruË_ty³_to_¡r
(
r1
->
¥ec
),

586 
	`ty³_m­_g‘_Çme
(
diff
, 
r1
->
sourû
, 
POLDIFF_POLICY_ORIG
),y³_m­_g‘_Çme(diff,„1->
rg‘
,

587 
POLDIFF_POLICY_ORIG
), 
r1
->
şs
);

588  
»tv
;

589 
	}
}

601 
	$‹ruË_bud_cÚd
(cÚ¡ 
pŞdiff_t
 * 
diff
, cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
qpŞ_cÚd_t
 * 
cÚd
, 
p£udo_‹ruË_t
 * 
key
)

603 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

604 
qpŞ_cÚd_ex´_node_t
 *
node
;

605 
ušt32_t
 
ex´_ty³
, 
Œuthšess
;

606 
qpŞ_boŞ_t
 *
boŞs
[5] = { 
NULL
, NULL, NULL, NULL, NULL }, *
qboŞ
;

607 
size_t
 
i
, 
j
;

608 
size_t
 
num_boŞs
 = 0;

609 cÚ¡ *
boŞ_Çme
, *
p£udo_boŞ
, *
t
;

610 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
p
);

611 
»tv®
 = -1, 
”rÜ
 = 0, 
compv®
;

612 ià(
	`qpŞ_cÚd_g‘_ex´_node_™”
(
q
, 
cÚd
, &
™”
) < 0) {

613 
”rÜ
 = 
”ºo
;

614 
ş—nup
;

616 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

617 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
node
è< 0 || 
	`qpŞ_cÚd_ex´_node_g‘_ex´_ty³
(
q
,‚ode, &
ex´_ty³
) < 0) {

618 
”rÜ
 = 
”ºo
;

619 
ş—nup
;

621 ià(
ex´_ty³
 !ğ
QPOL_COND_EXPR_BOOL
) {

624 ià(
	`qpŞ_cÚd_ex´_node_g‘_boŞ
(
q
, 
node
, &
qboŞ
) < 0) {

625 
”rÜ
 = 
”ºo
;

626 
ş—nup
;

628 
i
 = 0; i < 
num_boŞs
; i++) {

629 ià(
boŞs
[
i
] =ğ
qboŞ
) {

633 ià(
i
 >ğ
num_boŞs
) {

634 
	`as£¹
(
i
 < 5);

635 
boŞs
[
i
] = 
qboŞ
;

636 
num_boŞs
++;

639 
i
 = 0; i < 
num_boŞs
; i++) {

640 ià(
	`qpŞ_boŞ_g‘_Çme
(
q
, 
boŞs
[
i
], &
boŞ_Çme
) < 0) {

641 
”rÜ
 = 
”ºo
;

642 
ş—nup
;

644 ià(
	`­Ş_b¡_g‘_–em’t
(
diff
->
boŞ_b¡
, (*)
boŞ_Çme
, 
NULL
, (**)&
p£udo_boŞ
) < 0) {

645 
”rÜ
 = 
EBADRQC
;

646 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

647 
	`as£¹
(0);

648 
ş—nup
;

650 
key
->
boŞs
[
i
] = 
p£udo_boŞ
;

655 
i
 = 
num_boŞs
; i > 1; i--) {

656 
j
 = 1; j < 
i
; j++) {

657 
compv®
 = 
	`¡rcmp
(
key
->
boŞs
[
j
 - 1], key->bools[j]);

658 ià(
compv®
 > 0) {

659 
t
 = 
key
->
boŞs
[
j
];

660 
key
->
boŞs
[
j
] = key->bools[j - 1];

661 
key
->
boŞs
[
j
 - 1] = 
t
;

662 
qboŞ
 = 
boŞs
[
j
];

663 
boŞs
[
j
] = bools[j - 1];

664 
boŞs
[
j
 - 1] = 
qboŞ
;

670 
key
->
boŞ_v®
 = 0;

671 
i
 = 0; i < 32; i++) {

672 
j
 = 0; j < 
num_boŞs
; j++) {

673 
¡©e
 = ((
i
 & (1 << 
j
)) ? 1 : 0);

674 ià(
	`qpŞ_boŞ_£t_¡©e_no_ev®
(
q
, 
boŞs
[
j
], 
¡©e
) < 0) {

675 
”rÜ
 = 
”ºo
;

676 
ş—nup
;

679 ià(
	`qpŞ_cÚd_ev®
(
q
, 
cÚd
, &
Œuthšess
) < 0) {

680 
”rÜ
 = 
”ºo
;

681 
ş—nup
;

683 
key
->
boŞ_v®
 = (key->boŞ_v® << 1è| 
Œuthšess
;

686 
key
->
cÚd
 = cond;

687 
»tv®
 = 0;

688 
ş—nup
:

689 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

690  
»tv®
;

691 
	}
}

706 
	$‹ruË_add_to_b¡
(
pŞdiff_t
 * 
diff
, cÚ¡ 
­Ş_pŞicy_t
 * 
p
,

707 cÚ¡ 
qpŞ_‹ruË_t
 * 
ruË
, 
ušt32_t
 
sourû
, ušt32_ˆ
rg‘
, 
­Ş_b¡_t
 * 
b
)

709 
p£udo_‹ruË_t
 *
key
, *
š£¹ed_key
;

710 cÚ¡ 
qpŞ_şass_t
 *
obj_şass
;

711 cÚ¡ 
qpŞ_ty³_t
 *
deçuÉ_ty³
;

712 cÚ¡ *
şass_Çme
;

713 cÚ¡ 
qpŞ_cÚd_t
 *
cÚd
;

714 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
p
);

715 
»tv®
 = -1, 
”rÜ
 = 0, 
compv®
;

716 
which
 = (
p
 =ğ
diff
->
Üig_pŞ
 ? 
POLDIFF_POLICY_ORIG
 : 
POLDIFF_POLICY_MOD
);

717 ià((
key
 = 
	`ÿÎoc
(1, (*key))è=ğ
NULL
) {

718 
”rÜ
 = 
”ºo
;

719 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

720 
ş—nup
;

722 ià(
	`qpŞ_‹ruË_g‘_ruË_ty³
(
q
, 
ruË
, &(
key
->
¥ec
)) < 0 ||

723 
	`qpŞ_‹ruË_g‘_objeù_şass
(
q
, 
ruË
, &
obj_şass
) < 0 ||

724 
	`qpŞ_‹ruË_g‘_deçuÉ_ty³
(
q
, 
ruË
, &
deçuÉ_ty³
è< 0 || 
	`qpŞ_‹ruË_g‘_cÚd
(q,„uË, &
cÚd
) < 0) {

725 
”rÜ
 = 
”ºo
;

726 
ş—nup
;

728 ià(
	`qpŞ_şass_g‘_Çme
(
q
, 
obj_şass
, &
şass_Çme
) < 0) {

729 
”rÜ
 = 
”ºo
;

730 
ş—nup
;

732 ià(
	`­Ş_b¡_g‘_–em’t
(
diff
->
şass_b¡
, (*)
şass_Çme
, 
NULL
, (**)&
key
->
şs
) < 0) {

733 
”rÜ
 = 
EBADRQC
;

734 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

735 
	`as£¹
(0);

736 
ş—nup
;

738 ià((
key
->
deçuÉ_ty³
 = 
	`ty³_m­_lookup
(
diff
, deçuÉ_ty³, 
which
)) == 0) {

739 
”rÜ
 = 
”ºo
;

740 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

741 
ş—nup
;

743 
key
->
sourû
 = source;

744 
key
->
rg‘
 =arget;

745 ià(
cÚd
 !ğ
NULL
 && (
	`qpŞ_‹ruË_g‘_which_li¡
(
q
, 
ruË
, &(
key
->
b¿nch
)è< 0 || 
	`‹ruË_bud_cÚd
(
diff
, 
p
, cond, key) < 0)) {

746 
”rÜ
 = 
”ºo
;

747 
ş—nup
;

751 ià((
compv®
 = 
	`­Ş_b¡_š£¹_ªd_g‘
(
b
, (**)&
key
, 
diff
)) < 0) {

752 
”rÜ
 = 
”ºo
;

753 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

754 
ş—nup
;

756 
š£¹ed_key
 = 
key
;

757 
key
 = 
NULL
;

760 ià(
	`qpŞ_pŞicy_has_ÿ·b™y
(
q
, 
QPOL_CAP_LINE_NUMBERS
)) {

761 cÚ¡ 
qpŞ_‹ruË_t
 **
t
 = 
	`»®loc
(
š£¹ed_key
->
ruËs
,

762 (
š£¹ed_key
->
num_ruËs
 + 1è* (*
t
));

763 ià(
t
 =ğ
NULL
) {

764 
”rÜ
 = 
”ºo
;

765 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

766 
ş—nup
;

768 
š£¹ed_key
->
ruËs
 = 
t
;

769 
š£¹ed_key
->
ruËs
[š£¹ed_key->
num_ruËs
++] = 
ruË
;

772 
»tv®
 = 0;

773 
ş—nup
:

774 ià(
»tv®
 < 0) {

775 
	`‹ruË_ä“_™em
(
key
);

777 
”ºo
 = 
”rÜ
;

778  
»tv®
;

779 
	}
}

793 
	$‹ruË_ex·nd
(
pŞdiff_t
 * 
diff
, cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
qpŞ_‹ruË_t
 * 
ruË
, 
­Ş_b¡_t
 * 
b
)

795 cÚ¡ 
qpŞ_ty³_t
 *
sourû
, *
Üig_rg‘
, *
rg‘
;

796 
sourû_©Œ
, 
rg‘_©Œ
;

797 
qpŞ_™”©Ü_t
 *
sourû_™”
 = 
NULL
, *
rg‘_™”
 = NULL;

798 
ušt32_t
 
sourû_v®
, 
rg‘_v®
;

799 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
p
);

800 
which
 = (
p
 =ğ
diff
->
Üig_pŞ
 ? 
POLDIFF_POLICY_ORIG
 : 
POLDIFF_POLICY_MOD
);

801 
»tv®
 = -1, 
”rÜ
 = 0;

802 ià(
	`qpŞ_‹ruË_g‘_sourû_ty³
(
q
, 
ruË
, &
sourû
) < 0 ||

803 
	`qpŞ_‹ruË_g‘_rg‘_ty³
(
q
, 
ruË
, &
Üig_rg‘
) < 0 ||

804 
	`qpŞ_ty³_g‘_i§‰r
(
q
, 
sourû
, &
sourû_©Œ
è< 0 || qpŞ_ty³_g‘_i§‰r(q, 
Üig_rg‘
, &
rg‘_©Œ
)) {

805 
”rÜ
 = 
”ºo
;

806 
ş—nup
;

808 ià(
sourû_©Œ
 && 
	`qpŞ_ty³_g‘_ty³_™”
(
q
, 
sourû
, &
sourû_™”
) < 0) {

809 
”rÜ
 = 
”ºo
;

810 
ş—nup
;

813 ià(
sourû_©Œ
) {

814 ià(
	`qpŞ_™”©Ü_g‘_™em
(
sourû_™”
, (**)&
sourû
) < 0) {

815 
”rÜ
 = 
”ºo
;

816 
ş—nup
;

818 
	`qpŞ_™”©Ü_Ãxt
(
sourû_™”
);

820 ià(
rg‘_©Œ
) {

821 ià(
	`qpŞ_ty³_g‘_ty³_™”
(
q
, 
Üig_rg‘
, &
rg‘_™”
) < 0) {

822 
”rÜ
 = 
”ºo
;

823 
ş—nup
;

826 
rg‘
 = 
Üig_rg‘
;

829 ià(
rg‘_©Œ
) {

830 ià(
	`qpŞ_™”©Ü_g‘_™em
(
rg‘_™”
, (**)&
rg‘
) < 0) {

831 
”rÜ
 = 
”ºo
;

832 
ş—nup
;

834 
	`qpŞ_™”©Ü_Ãxt
(
rg‘_™”
);

836 cÚ¡ *
n1
, *
n2
;

837 
	`qpŞ_ty³_g‘_Çme
(
q
, 
sourû
, &
n1
);

838 
	`qpŞ_ty³_g‘_Çme
(
q
, 
rg‘
, &
n2
);

839 ià((
sourû_v®
 = 
	`ty³_m­_lookup
(
diff
, 
sourû
, 
which
)) == 0 ||

840 (
rg‘_v®
 = 
	`ty³_m­_lookup
(
diff
, 
rg‘
, 
which
)) == 0 ||

841 
	`‹ruË_add_to_b¡
(
diff
, 
p
, 
ruË
, 
sourû_v®
, 
rg‘_v®
, 
b
) < 0) {

842 
”rÜ
 = 
”ºo
;

843 
ş—nup
;

845 } 
rg‘_©Œ
 && !
	`qpŞ_™”©Ü_’d
(
rg‘_™”
));

846 
	`qpŞ_™”©Ü_de¡roy
(&
rg‘_™”
);

847 } 
sourû_©Œ
 && !
	`qpŞ_™”©Ü_’d
(
sourû_™”
));

848 
»tv®
 = 0;

849 
ş—nup
:

850 
	`qpŞ_™”©Ü_de¡roy
(&
sourû_™”
);

851 
	`qpŞ_™”©Ü_de¡roy
(&
rg‘_™”
);

852 
”ºo
 = 
”rÜ
;

853  
»tv®
;

854 
	}
}

870 
­Ş_veùÜ_t
 *
	$‹ruË_g‘_™ems
(
pŞdiff_t
 * 
diff
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
, 
which
)

872 
­Ş_veùÜ_t
 *
boŞs
 = 
NULL
, *
boŞ_¡©es
 = NULL;

873 
size_t
 
i
, 
num_ruËs
, 
j
;

874 
­Ş_b¡_t
 *
b
 = 
NULL
;

875 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

876 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

877 
qpŞ_‹ruË_t
 *
ruË
;

878 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicy
);

879 
»tv®
 = -1, 
”rÜ
 = 0;

880 ià(
	`pŞdiff_bud_b¡s
(
diff
) < 0) {

881 
”rÜ
 = 
”ºo
;

882 
ş—nup
;

886 ià(
	`­Ş_boŞ_g‘_by_qu”y
(
pŞicy
, 
NULL
, &
boŞs
) < 0) {

887 
”rÜ
 = 
”ºo
;

888 
ş—nup
;

890 ià((
boŞ_¡©es
 = 
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(
	`­Ş_veùÜ_g‘_size
(
boŞs
), 
NULL
)) == NULL) {

891 
”rÜ
 = 
”ºo
;

892 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

893 
ş—nup
;

895 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
boŞs
); i++) {

896 
qpŞ_boŞ_t
 *
qboŞ
 = 
	`­Ş_veùÜ_g‘_–em’t
(
boŞs
, 
i
);

897 
¡©e
;

898 ià(
	`qpŞ_boŞ_g‘_¡©e
(
q
, 
qboŞ
, &
¡©e
) < 0) {

899 
”rÜ
 = 
”ºo
;

900 
ş—nup
;

902 ià(
	`­Ş_veùÜ_­³nd
(
boŞ_¡©es
, (*)((
size_t
è
¡©e
)) < 0) {

903 
”rÜ
 = 
”ºo
;

904 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

905 
ş—nup
;

908 ià((
b
 = 
	`­Ş_b¡_ü—‹
(
‹ruË_b¡_comp
, 
‹ruË_ä“_™em
)è=ğ
NULL
) {

909 
”rÜ
 = 
”ºo
;

910 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

911 
ş—nup
;

913 ià(
	`qpŞ_pŞicy_g‘_‹ruË_™”
(
q
, 
which
, &
™”
) < 0) {

914 
”rÜ
 = 
”ºo
;

915 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

916 
ş—nup
;

918 
	`qpŞ_™”©Ü_g‘_size
(
™”
, &
num_ruËs
);

919 
j
 = 0; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter), j++) {

920 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
ruË
è< 0 || 
	`‹ruË_ex·nd
(
diff
, 
pŞicy
,„uË, 
b
) < 0) {

921 
”rÜ
 = 
”ºo
;

922 
ş—nup
;

924 ià(!(
j
 % 1024)) {

925 
³rûÁ
 = 50 * 
j
 / 
num_ruËs
 + (
pŞicy
 =ğ
diff
->
mod_pŞ
 ? 50 : 0);

926 
	`INFO
(
diff
, "Computšg TE„uË difã»nû: %02d%% com¶‘e", 
³rûÁ
);

929 ià((
v
 = 
	`­Ş_b¡_g‘_veùÜ
(
b
, 1)è=ğ
NULL
) {

930 
”rÜ
 = 
”ºo
;

931 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

932 
ş—nup
;

934 
»tv®
 = 0;

935 
ş—nup
:

937 
i
 = 0; 
boŞs
 !ğ
NULL
 && i < 
	`­Ş_veùÜ_g‘_size
(bools); i++) {

938 
qpŞ_boŞ_t
 *
qboŞ
 = 
	`­Ş_veùÜ_g‘_–em’t
(
boŞs
, 
i
);

939 
¡©e
 = ()((
size_t
è
	`­Ş_veùÜ_g‘_–em’t
(
boŞ_¡©es
, 
i
));

940 
	`qpŞ_boŞ_£t_¡©e_no_ev®
(
q
, 
qboŞ
, 
¡©e
);

942 
	`­Ş_veùÜ_de¡roy
(&
boŞs
);

943 
	`­Ş_veùÜ_de¡roy
(&
boŞ_¡©es
);

944 
	`qpŞ_pŞicy_»ev®u©e_cÚds
(
q
);

945 
	`­Ş_b¡_de¡roy
(&
b
);

946 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

947 ià(
»tv®
 < 0) {

948 
	`­Ş_veùÜ_de¡roy
(&
v
);

949 
”ºo
 = 
”rÜ
;

950  
NULL
;

952  
v
;

953 
	}
}

955 
­Ş_veùÜ_t
 *
	$‹ruË_g‘_™ems_chªge
(
pŞdiff_t
 * 
diff
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
)

957  
	`‹ruË_g‘_™ems
(
diff
, 
pŞicy
, 
QPOL_RULE_TYPE_CHANGE
);

958 
	}
}

960 
­Ş_veùÜ_t
 *
	$‹ruË_g‘_™ems_memb”
(
pŞdiff_t
 * 
diff
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
)

962  
	`‹ruË_g‘_™ems
(
diff
, 
pŞicy
, 
QPOL_RULE_TYPE_MEMBER
);

963 
	}
}

965 
­Ş_veùÜ_t
 *
	$‹ruË_g‘_™ems_Œªs
(
pŞdiff_t
 * 
diff
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
)

967  
	`‹ruË_g‘_™ems
(
diff
, 
pŞicy
, 
QPOL_RULE_TYPE_TRANS
);

968 
	}
}

970 
‹ruË_comp
(cÚ¡ *
x
, cÚ¡ *
y
, cÚ¡ 
pŞdiff_t
 * 
diff
 
__©Œibu‹__
 ((
unu£d
)))

972 cÚ¡ 
p£udo_‹ruË_t
 *
	gr1
 = (cÚ¡…£udo_‹ruË_ˆ*)
x
;

973 cÚ¡ 
p£udo_‹ruË_t
 *
	gr2
 = (cÚ¡…£udo_‹ruË_ˆ*)
y
;

974  
p£udo_‹ruË_comp
(
r1
, 
r2
, 0);

990 
pŞdiff_‹ruË_t
 *
	$make_‹diff
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
pŞdiff_fÜm_e
 
fÜm
, cÚ¡ 
p£udo_‹ruË_t
 * 
ruË
)

992 
pŞdiff_‹ruË_t
 *
±
;

993 cÚ¡ *
n1
, *
n2
;

994 
”rÜ
;

995 ià(
fÜm
 =ğ
POLDIFF_FORM_ADDED
 || fÜm =ğ
POLDIFF_FORM_ADD_TYPE
) {

996 
n1
 = 
	`ty³_m­_g‘_Çme
(
diff
, 
ruË
->
sourû
, 
POLDIFF_POLICY_MOD
);

997 
n2
 = 
	`ty³_m­_g‘_Çme
(
diff
, 
ruË
->
rg‘
, 
POLDIFF_POLICY_MOD
);

999 
n1
 = 
	`ty³_m­_g‘_Çme
(
diff
, 
ruË
->
sourû
, 
POLDIFF_POLICY_ORIG
);

1000 
n2
 = 
	`ty³_m­_g‘_Çme
(
diff
, 
ruË
->
rg‘
, 
POLDIFF_POLICY_ORIG
);

1002 
	`as£¹
(
n1
 !ğ
NULL
 && 
n2
 != NULL);

1003 ià((
±
 = 
	`ÿÎoc
(1, (*±))è=ğ
NULL
) {

1004 
”rÜ
 = 
”ºo
;

1005 
	`pŞdiff_‹ruË_ä“
(
±
);

1006 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1007 
”ºo
 = 
”rÜ
;

1008  
NULL
;

1010 
±
->
¥ec
 = 
ruË
->spec;

1011 
±
->
sourû
 = 
n1
;

1012 
±
->
rg‘
 = 
n2
;

1013 
±
->
şs
 = 
ruË
->cls;

1014 
±
->
fÜm
 = form;

1015 
±
->
cÚd
 = 
ruË
->cond;

1016 
±
->
b¿nch
 = 
ruË
->branch;

1017  
±
;

1018 
	}
}

1032 
	$‹ruË_Ãw_diff
(
pŞdiff_t
 * 
diff
, 
pŞdiff_fÜm_e
 
fÜm
, cÚ¡ *
™em
, 
‹ruË_off£t_e
 
idx
)

1034 
p£udo_‹ruË_t
 *
ruË
 = (p£udo_‹ruË_ˆ*è
™em
;

1035 
pŞdiff_‹ruË_t
 *
±
 = 
NULL
;

1036 cÚ¡ 
­Ş_veùÜ_t
 *
v1
, *
v2
;

1037 
­Ş_pŞicy_t
 *
p
;

1038 cÚ¡ *
Üig_deçuÉ
 = 
NULL
, *
mod_deçuÉ
 = NULL;

1039 
»tv®
 = -1, 
”rÜ
 = 
”ºo
;

1044 ià(
fÜm
 =ğ
POLDIFF_FORM_ADDED
) {

1045 ià((
v1
 = 
	`ty³_m­_lookup_»v”£
(
diff
, 
ruË
->
sourû
, 
POLDIFF_POLICY_ORIG
)è=ğ
NULL
 ||

1046 (
v2
 = 
	`ty³_m­_lookup_»v”£
(
diff
, 
ruË
->
rg‘
, 
POLDIFF_POLICY_ORIG
)è=ğ
NULL
 ||

1047 (
mod_deçuÉ
 = 
	`ty³_m­_g‘_Çme
(
diff
, 
ruË
->
deçuÉ_ty³
, 
POLDIFF_POLICY_MOD
)è=ğ
NULL
) {

1048 
”rÜ
 = 
”ºo
;

1049 
ş—nup
;

1051 ià(
	`­Ş_veùÜ_g‘_size
(
v1
è=ğ0 ||‡pŞ_veùÜ_g‘_size(
v2
) == 0) {

1052 
fÜm
 = 
POLDIFF_FORM_ADD_TYPE
;

1054 
p
 = 
diff
->
mod_pŞ
;

1056 ià((
v1
 = 
	`ty³_m­_lookup_»v”£
(
diff
, 
ruË
->
sourû
, 
POLDIFF_POLICY_MOD
)è=ğ
NULL
 ||

1057 (
v2
 = 
	`ty³_m­_lookup_»v”£
(
diff
, 
ruË
->
rg‘
, 
POLDIFF_POLICY_MOD
)è=ğ
NULL
 ||

1058 (
Üig_deçuÉ
 = 
	`ty³_m­_g‘_Çme
(
diff
, 
ruË
->
deçuÉ_ty³
, 
POLDIFF_POLICY_ORIG
)è=ğ
NULL
) {

1059 
”rÜ
 = 
”ºo
;

1060 
ş—nup
;

1062 ià(
	`­Ş_veùÜ_g‘_size
(
v1
è=ğ0 ||‡pŞ_veùÜ_g‘_size(
v2
) == 0) {

1063 
fÜm
 = 
POLDIFF_FORM_REMOVE_TYPE
;

1065 
p
 = 
diff
->
Üig_pŞ
;

1068 
±
 = 
	`make_‹diff
(
diff
, 
fÜm
, 
ruË
);

1069 ià(
±
 =ğ
NULL
) {

1072 
±
->
Üig_deçuÉ
 = orig_default;

1073 
±
->
mod_deçuÉ
 = mod_default;

1076 ià(
	`qpŞ_pŞicy_has_ÿ·b™y
(
	`­Ş_pŞicy_g‘_qpŞ
(
p
), 
QPOL_CAP_LINE_NUMBERS
)) {

1077 
­Ş_veùÜ_t
 *
vl
 = 
NULL
;

1078 ià((
vl
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)) == NULL) {

1079 
”rÜ
 = 
”ºo
;

1080 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1081 
ş—nup
;

1083 ià(
fÜm
 =ğ
POLDIFF_FORM_ADDED
 || fÜm =ğ
POLDIFF_FORM_ADD_TYPE
) {

1084 
±
->
mod_lš’os
 = 
vl
;

1086 
±
->
Üig_lš’os
 = 
vl
;

1090 ià(
fÜm
 =ğ
POLDIFF_FORM_ADDED
 || fÜm =ğ
POLDIFF_FORM_ADD_TYPE
) {

1091 
±
->
num_mod_ruËs
 = 
ruË
->
num_ruËs
;

1092 
±
->
mod_ruËs
 = 
	`ÿÎoc
(
ruË
->
num_ruËs
, (
qpŞ_‹ruË_t
 *));

1093 ià(!
±
->
mod_ruËs
) {

1094 
”rÜ
 = 
”ºo
;

1095 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1096 
ş—nup
;

1098 
	`memıy
(
±
->
mod_ruËs
, 
ruË
->
ruËs
,„uË->
num_ruËs
 * (
qpŞ_‹ruË_t
 *));

1100 
±
->
num_Üig_ruËs
 = 
ruË
->
num_ruËs
;

1101 
±
->
Üig_ruËs
 = 
	`ÿÎoc
(
ruË
->
num_ruËs
, (
qpŞ_‹ruË_t
 *));

1102 ià(!
±
->
Üig_ruËs
) {

1103 
”rÜ
 = 
”ºo
;

1104 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1105 
ş—nup
;

1107 
	`memıy
(
±
->
Üig_ruËs
, 
ruË
->
ruËs
,„uË->
num_ruËs
 * (
qpŞ_‹ruË_t
 *));

1111 ià(
	`­Ş_veùÜ_­³nd
(
diff
->
‹ruË_diffs
[
idx
]->
diffs
, 
±
) < 0) {

1112 
”rÜ
 = 
”ºo
;

1113 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1114 
ş—nup
;

1116 
fÜm
) {

1117 
POLDIFF_FORM_ADDED
:

1118 
diff
->
‹ruË_diffs
[
idx
]->
num_added
++;

1120 
POLDIFF_FORM_ADD_TYPE
:

1121 
diff
->
‹ruË_diffs
[
idx
]->
num_added_ty³
++;

1123 
POLDIFF_FORM_REMOVED
:

1124 
diff
->
‹ruË_diffs
[
idx
]->
num_»moved
++;

1126 
POLDIFF_FORM_REMOVE_TYPE
:

1127 
diff
->
‹ruË_diffs
[
idx
]->
num_»moved_ty³
++;

1130 
”rÜ
 = 
EBADRQC
;

1131 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1132 
	`as£¹
(0);

1133 
ş—nup
;

1135 
diff
->
‹ruË_diffs
[
idx
]->
diffs_sÜ‹d
 = 0;

1136 
»tv®
 = 0;

1137 
ş—nup
:

1138 ià(
»tv®
 < 0) {

1139 
	`pŞdiff_‹ruË_ä“
(
±
);

1141 
”ºo
 = 
”rÜ
;

1142  
»tv®
;

1143 
	}
}

1145 
	$‹ruË_Ãw_diff_chªge
(
pŞdiff_t
 * 
diff
, 
pŞdiff_fÜm_e
 
fÜm
, cÚ¡ *
™em
)

1147  
	`‹ruË_Ãw_diff
(
diff
, 
fÜm
, 
™em
, 
TERULE_OFFSET_CHANGE
);

1148 
	}
}

1150 
	$‹ruË_Ãw_diff_memb”
(
pŞdiff_t
 * 
diff
, 
pŞdiff_fÜm_e
 
fÜm
, cÚ¡ *
™em
)

1152  
	`‹ruË_Ãw_diff
(
diff
, 
fÜm
, 
™em
, 
TERULE_OFFSET_MEMBER
);

1153 
	}
}

1155 
	$‹ruË_Ãw_diff_Œªs
(
pŞdiff_t
 * 
diff
, 
pŞdiff_fÜm_e
 
fÜm
, cÚ¡ *
™em
)

1157  
	`‹ruË_Ãw_diff
(
diff
, 
fÜm
, 
™em
, 
TERULE_OFFSET_TRANS
);

1158 
	}
}

1176 
	$‹ruË_d“p_diff
(
pŞdiff_t
 * 
diff
, cÚ¡ *
x
, cÚ¡ *
y
, 
‹ruË_off£t_e
 
idx
)

1178 
p£udo_‹ruË_t
 *
r1
 = (p£udo_‹ruË_ˆ*è
x
;

1179 
p£udo_‹ruË_t
 *
r2
 = (p£udo_‹ruË_ˆ*è
y
;

1180 
pŞdiff_‹ruË_t
 *
±
 = 
NULL
;

1181 
»tv®
 = -1, 
”rÜ
 = 0;

1183 ià(
r1
->
deçuÉ_ty³
 !ğ
r2
->default_type) {

1184 ià((
±
 = 
	`make_‹diff
(
diff
, 
POLDIFF_FORM_MODIFIED
, 
r1
)è=ğ
NULL
) {

1185 
”rÜ
 = 
”ºo
;

1186 
ş—nup
;

1188 
±
->
Üig_deçuÉ
 = 
	`ty³_m­_g‘_Çme
(
diff
, 
r1
->
deçuÉ_ty³
, 
POLDIFF_POLICY_ORIG
);

1189 
±
->
mod_deçuÉ
 = 
	`ty³_m­_g‘_Çme
(
diff
, 
r2
->
deçuÉ_ty³
, 
POLDIFF_POLICY_MOD
);

1192 ià(
	`qpŞ_pŞicy_has_ÿ·b™y
(
	`­Ş_pŞicy_g‘_qpŞ
(
diff
->
Üig_pŞ
), 
QPOL_CAP_LINE_NUMBERS
)) {

1193 ià((
±
->
Üig_lš’os
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)) == NULL) {

1194 
”rÜ
 = 
”ºo
;

1195 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1196 
ş—nup
;

1200 
±
->
num_Üig_ruËs
 = 
r1
->
num_ruËs
;

1201 
±
->
Üig_ruËs
 = 
	`ÿÎoc
(
r1
->
num_ruËs
, (
qpŞ_‹ruË_t
 *));

1202 ià(!
±
->
Üig_ruËs
) {

1203 
”rÜ
 = 
”ºo
;

1204 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1205 
ş—nup
;

1207 
	`memıy
(
±
->
Üig_ruËs
, 
r1
->
ruËs
,„1->
num_ruËs
 * (
qpŞ_‹ruË_t
 *));

1209 ià(
	`qpŞ_pŞicy_has_ÿ·b™y
(
	`­Ş_pŞicy_g‘_qpŞ
(
diff
->
mod_pŞ
), 
QPOL_CAP_LINE_NUMBERS
)) {

1210 ià((
±
->
mod_lš’os
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)) == NULL) {

1211 
”rÜ
 = 
”ºo
;

1212 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1213 
ş—nup
;

1217 
±
->
num_mod_ruËs
 = 
r2
->
num_ruËs
;

1218 
±
->
mod_ruËs
 = 
	`ÿÎoc
(
r2
->
num_ruËs
, (
qpŞ_‹ruË_t
 *));

1219 ià(!
±
->
mod_ruËs
) {

1220 
”rÜ
 = 
”ºo
;

1221 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1222 
ş—nup
;

1224 
	`memıy
(
±
->
mod_ruËs
, 
r2
->
ruËs
,„2->
num_ruËs
 * (
qpŞ_‹ruË_t
 *));

1227 ià(
	`­Ş_veùÜ_­³nd
(
diff
->
‹ruË_diffs
[
idx
]->
diffs
, 
±
) < 0) {

1228 
”rÜ
 = 
”ºo
;

1229 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1230 
ş—nup
;

1232 
diff
->
‹ruË_diffs
[
idx
]->
num_modif›d
++;

1233 
diff
->
‹ruË_diffs
[
idx
]->
diffs_sÜ‹d
 = 0;

1235 
»tv®
 = 0;

1236 
ş—nup
:

1237 ià(
»tv®
 != 0) {

1238 
	`pŞdiff_‹ruË_ä“
(
±
);

1240 
”ºo
 = 
”rÜ
;

1241  
»tv®
;

1242 
	}
}

1244 
	$‹ruË_d“p_diff_chªge
(
pŞdiff_t
 * 
diff
, cÚ¡ *
x
, cÚ¡ *
y
)

1246  
	`‹ruË_d“p_diff
(
diff
, 
x
, 
y
, 
TERULE_OFFSET_CHANGE
);

1247 
	}
}

1249 
	$‹ruË_d“p_diff_memb”
(
pŞdiff_t
 * 
diff
, cÚ¡ *
x
, cÚ¡ *
y
)

1251  
	`‹ruË_d“p_diff
(
diff
, 
x
, 
y
, 
TERULE_OFFSET_MEMBER
);

1252 
	}
}

1254 
	$‹ruË_d“p_diff_Œªs
(
pŞdiff_t
 * 
diff
, cÚ¡ *
x
, cÚ¡ *
y
)

1256  
	`‹ruË_d“p_diff
(
diff
, 
x
, 
y
, 
TERULE_OFFSET_TRANS
);

1257 
	}
}

1259 
	$‹ruË_’abË_lše_numb”s
(
pŞdiff_t
 * 
diff
, 
‹ruË_off£t_e
 
idx
)

1261 cÚ¡ 
­Ş_veùÜ_t
 *
‹
 = 
NULL
;

1262 
pŞdiff_‹ruË_t
 *
‹ruË
 = 
NULL
;

1263 
size_t
 
i
, 
j
;

1264 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

1265 
qpŞ_syn_‹ruË_t
 *
¡e
 = 
NULL
;

1266 
”rÜ
 = 0;

1267 
lš’o
 = 0;

1269 
‹
 = 
	`pŞdiff_g‘_‹ruË_veùÜ
(
diff
, 
idx
);

1271 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
‹
); i++) {

1272 
‹ruË
 = 
	`­Ş_veùÜ_g‘_–em’t
(
‹
, 
i
);

1273 ià(
	`­Ş_veùÜ_g‘_size
(
‹ruË
->
mod_lš’os
è||‡pŞ_veùÜ_g‘_sizeÑ”uË->
Üig_lš’os
))

1275 
j
 = 0; j < 
‹ruË
->
num_Üig_ruËs
; j++) {

1276 ià(
	`qpŞ_‹ruË_g‘_syn_‹ruË_™”
(
diff
->
Üig_qpŞ
, 
‹ruË
->
Üig_ruËs
[
j
], &
™”
)) {

1277 
”rÜ
 = 
”ºo
;

1278 
”r
;

1280 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

1281 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
¡e
) < 0) {

1282 
”rÜ
 = 
”ºo
;

1283 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1284 
”r
;

1286 ià(
	`qpŞ_syn_‹ruË_g‘_lš’o
(
diff
->
Üig_qpŞ
, 
¡e
, &
lš’o
) < 0) {

1287 
”rÜ
 = 
”ºo
;

1288 
”r
;

1290 ià(
	`­Ş_veùÜ_­³nd
(
‹ruË
->
Üig_lš’os
, (*)
lš’o
) < 0) {

1291 
”rÜ
 = 
”ºo
;

1292 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1293 
”r
;

1296 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

1298 
	`­Ş_veùÜ_sÜt_uniquify
(
‹ruË
->
Üig_lš’os
, 
NULL
, NULL);

1299 
j
 = 0; j < 
‹ruË
->
num_mod_ruËs
; j++) {

1300 ià(
	`qpŞ_‹ruË_g‘_syn_‹ruË_™”
(
diff
->
mod_qpŞ
, 
‹ruË
->
mod_ruËs
[
j
], &
™”
)) {

1301 
”rÜ
 = 
”ºo
;

1302 
”r
;

1304 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

1305 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
¡e
) < 0) {

1306 
”rÜ
 = 
”ºo
;

1307 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1308 
”r
;

1310 ià(
	`qpŞ_syn_‹ruË_g‘_lš’o
(
diff
->
mod_qpŞ
, 
¡e
, &
lš’o
) < 0) {

1311 
”rÜ
 = 
”ºo
;

1312 
”r
;

1314 ià(
	`­Ş_veùÜ_­³nd
(
‹ruË
->
mod_lš’os
, (*)
lš’o
) < 0) {

1315 
”rÜ
 = 
”ºo
;

1316 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1317 
”r
;

1320 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

1322 
	`­Ş_veùÜ_sÜt_uniquify
(
‹ruË
->
mod_lš’os
, 
NULL
, NULL);

1326 
”r
:

1327 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

1329 
	}
}

	@libpoldiff/src/terule_internal.h

25 #iâdeà
POLDIFF_TERULE_INTERNAL_H


26 
	#POLDIFF_TERULE_INTERNAL_H


	)

28 #ifdef 
__ılu¥lus


33 
pŞdiff_‹ruË_summ¬y
 
	tpŞdiff_‹ruË_summ¬y_t
;

42 
pŞdiff_‹ruË_summ¬y_t
 *
‹ruË_ü—‹
();

52 
‹ruË_de¡roy
(
pŞdiff_‹ruË_summ¬y_t
 ** 
rs
);

61 
‹ruË_»£t_chªge
(
pŞdiff_t
 * 
diff
);

70 
‹ruË_»£t_memb”
(
pŞdiff_t
 * 
diff
);

79 
‹ruË_»£t_Œªs
(
pŞdiff_t
 * 
diff
);

94 
­Ş_veùÜ_t
 *
‹ruË_g‘_™ems_chªge
(
pŞdiff_t
 * 
diff
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
);

110 
­Ş_veùÜ_t
 *
‹ruË_g‘_™ems_memb”
(
pŞdiff_t
 * 
diff
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
);

125 
­Ş_veùÜ_t
 *
‹ruË_g‘_™ems_Œªs
(
pŞdiff_t
 * 
diff
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
);

140 
‹ruË_comp
(cÚ¡ *
x
, cÚ¡ *
y
, cÚ¡ 
pŞdiff_t
 * 
diff
);

153 
‹ruË_Ãw_diff_chªge
(
pŞdiff_t
 * 
diff
, 
pŞdiff_fÜm_e
 
fÜm
, cÚ¡ *
™em
);

166 
‹ruË_Ãw_diff_memb”
(
pŞdiff_t
 * 
diff
, 
pŞdiff_fÜm_e
 
fÜm
, cÚ¡ *
™em
);

179 
‹ruË_Ãw_diff_Œªs
(
pŞdiff_t
 * 
diff
, 
pŞdiff_fÜm_e
 
fÜm
, cÚ¡ *
™em
);

195 
‹ruË_d“p_diff_chªge
(
pŞdiff_t
 * 
diff
, cÚ¡ *
x
, cÚ¡ *
y
);

211 
‹ruË_d“p_diff_memb”
(
pŞdiff_t
 * 
diff
, cÚ¡ *
x
, cÚ¡ *
y
);

227 
‹ruË_d“p_diff_Œªs
(
pŞdiff_t
 * 
diff
, cÚ¡ *
x
, cÚ¡ *
y
);

238 
‹ruË_’abË_lše_numb”s
(
pŞdiff_t
 * 
diff
, 
idx
);

240 #ifdef 
__ılu¥lus


	@libpoldiff/src/type_diff.c

25 
	~<cÚfig.h
>

27 
	~"pŞdiff_š‹º®.h
"

29 
	~<­Ş/ut.h
>

30 
	~<as£¹.h
>

31 
	~<”ºo.h
>

32 
	~<¡dboŞ.h
>

33 
	~<¡dio.h
>

34 
	~<¡ršg.h
>

38 
	spŞdiff_ty³_summ¬y


40 
size_t
 
	mnum_added
;

41 
size_t
 
	mnum_»moved
;

42 
size_t
 
	mnum_modif›d
;

43 
	m¬e_diffs_sÜ‹d
;

44 
­Ş_veùÜ_t
 *
	mdiffs
;

47 
	spŞdiff_ty³


49 *
	mÇme
;

50 
pŞdiff_fÜm_e
 
	mfÜm
;

51 
­Ş_veùÜ_t
 *
	madded_©Œibs
;

52 
­Ş_veùÜ_t
 *
	m»moved_©Œibs
;

55 
	$pŞdiff_ty³_g‘_¡©s
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
size_t
 
¡©s
[5])

57 ià(
diff
 =ğ
NULL
 || 
¡©s
 == NULL) {

58 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
EINVAL
));

59 
”ºo
 = 
EINVAL
;

62 
¡©s
[0] = 
diff
->
ty³_diffs
->
num_added
;

63 
¡©s
[1] = 
diff
->
ty³_diffs
->
num_»moved
;

64 
¡©s
[2] = 
diff
->
ty³_diffs
->
num_modif›d
;

65 
¡©s
[3] = 0;

66 
¡©s
[4] = 0;

67 
	}
}

69 *
	$pŞdiff_ty³_to_¡ršg
(cÚ¡ 
pŞdiff_t
 * 
diff
, cÚ¡ *
ty³
)

71 
pŞdiff_ty³_t
 *
t
 = (pŞdiff_ty³_ˆ*è
ty³
;

72 
size_t
 
num_added
, 
num_»moved
, 
Ën
 = 0, 
i
;

73 *
s
 = 
NULL
, *
©Œib
;

75 ià(
diff
 =ğ
NULL
 || 
ty³
 == NULL) {

76 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
EINVAL
));

77 
”ºo
 = 
EINVAL
;

78  
NULL
;

80 
num_added
 = 
	`­Ş_veùÜ_g‘_size
(
t
->
added_©Œibs
);

81 
num_»moved
 = 
	`­Ş_veùÜ_g‘_size
(
t
->
»moved_©Œibs
);

82 
t
->
fÜm
) {

83 
POLDIFF_FORM_ADDED
:

85 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "+ %s", 
t
->
Çme
) < 0) {

88  
s
;

90 
POLDIFF_FORM_REMOVED
:

92 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "- %s", 
t
->
Çme
) < 0) {

95  
s
;

97 
POLDIFF_FORM_MODIFIED
:

99 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "* % (", 
t
->
Çme
) < 0) {

102 ià(
num_added
 > 0) {

103 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "%zd Added A‰ribu‹%s", 
num_added
, (num_added == 1 ? "" : "s")) < 0) {

107 ià(
num_»moved
 > 0) {

108 ià(
­Ş_¡r_­³ndf


109 (&
s
, &
Ën
, "%s%zd Removed A‰ribu‹%s", (
num_added
 > 0 ? ", " : ""), 
num_»moved
,

110 (
num_»moved
 == 1 ? "" : "s")) < 0) {

114 ià(
	`­Ş_¡r_­³nd
(&
s
, &
Ën
, ")\n") < 0) {

117 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
t
->
added_©Œibs
); i++) {

118 
©Œib
 = (*)
	`­Ş_veùÜ_g‘_–em’t
(
t
->
added_©Œibs
, 
i
);

119 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "\t+ %s\n", 
©Œib
) < 0) {

120 
”r
;

123 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
t
->
»moved_©Œibs
); i++) {

124 
©Œib
 = (*)
	`­Ş_veùÜ_g‘_–em’t
(
t
->
»moved_©Œibs
, 
i
);

125 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "\t- %s\n", 
©Œib
) < 0) {

126 
”r
;

129  
s
;

133 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
ENOTSUP
));

134 
”ºo
 = 
ENOTSUP
;

135  
NULL
;

138 
”r
:

140 
	`ä“
(
s
);

141 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

142 
”ºo
 = 
ENOMEM
;

143  
NULL
;

144 
	}
}

146 
pŞdiff_ty³_comp
(cÚ¡ *
a
, cÚ¡ *
b
, *
d©a
 
__©Œibu‹__
 ((
unu£d
)))

148 cÚ¡ 
pŞdiff_ty³_t
 *
	gt1
 = 
a
;

149 cÚ¡ 
pŞdiff_ty³_t
 *
	gt2
 = 
b
;

150  
¡rcmp
(
t1
->
Çme
, 
t2
->name);

153 cÚ¡ 
­Ş_veùÜ_t
 *
	$pŞdiff_g‘_ty³_veùÜ
(cÚ¡ 
pŞdiff_t
 * 
diff
)

155 ià(
diff
 =ğ
NULL
) {

156 
”ºo
 = 
EINVAL
;

157  
NULL
;

162 ià(!
diff
->
ty³_diffs
->
¬e_diffs_sÜ‹d
) {

163 
	`­Ş_veùÜ_sÜt
(
diff
->
ty³_diffs
->
diffs
, 
pŞdiff_ty³_comp
, 
NULL
);

164 
diff
->
ty³_diffs
->
¬e_diffs_sÜ‹d
 = 1;

166  
diff
->
ty³_diffs
->
diffs
;

167 
	}
}

169 cÚ¡ *
	$pŞdiff_ty³_g‘_Çme
(cÚ¡ 
pŞdiff_ty³_t
 * 
ty³
)

171 ià(
ty³
 =ğ
NULL
) {

172 
”ºo
 = 
EINVAL
;

173  
NULL
;

175  
ty³
->
Çme
;

176 
	}
}

178 
pŞdiff_fÜm_e
 
	$pŞdiff_ty³_g‘_fÜm
(cÚ¡ *
ty³
)

180 ià(
ty³
 =ğ
NULL
) {

181 
”ºo
 = 
EINVAL
;

182  
POLDIFF_FORM_NONE
;

184  ((cÚ¡ 
pŞdiff_ty³_t
 *)
ty³
)->
fÜm
;

185 
	}
}

187 cÚ¡ 
­Ş_veùÜ_t
 *
	$pŞdiff_ty³_g‘_added_©Œibs
(cÚ¡ 
pŞdiff_ty³_t
 * 
ty³
)

189 ià(
ty³
 =ğ
NULL
) {

190 
”ºo
 = 
EINVAL
;

191  
NULL
;

193  
ty³
->
added_©Œibs
;

194 
	}
}

196 cÚ¡ 
­Ş_veùÜ_t
 *
	$pŞdiff_ty³_g‘_»moved_©Œibs
(cÚ¡ 
pŞdiff_ty³_t
 * 
ty³
)

198 ià(
ty³
 =ğ
NULL
) {

199 
”ºo
 = 
EINVAL
;

200  
NULL
;

202  
ty³
->
»moved_©Œibs
;

203 
	}
}

211 
	$ty³_de¡roy
(*
ty³
)

213 
pŞdiff_ty³_t
 *
t
;

214 ià(
ty³
 =ğ
NULL
)

216 
t
 = (
pŞdiff_ty³_t
 *è
ty³
;

217 
	`ä“
(
t
->
Çme
);

218 
	`­Ş_veùÜ_de¡roy
(&(
t
->
added_©Œibs
));

219 
	`­Ş_veùÜ_de¡roy
(&(
t
->
»moved_©Œibs
));

220 
	`ä“
(
t
);

221 
	}
}

223 
pŞdiff_ty³_summ¬y_t
 *
	$ty³_summ¬y_ü—‹
()

225 
pŞdiff_ty³_summ¬y_t
 *
ty³
 = 
	`ÿÎoc
(1, (*type));

226 ià(
ty³
 =ğ
NULL
) {

227  
NULL
;

229 ià((
ty³
->
diffs
 = 
	`­Ş_veùÜ_ü—‹
(
ty³_de¡roy
)è=ğ
NULL
) {

230 
	`ty³_summ¬y_de¡roy
(&
ty³
);

231  
NULL
;

233  
ty³
;

234 
	}
}

236 
	$ty³_summ¬y_de¡roy
(
pŞdiff_ty³_summ¬y_t
 ** 
ty³
)

238 ià(
ty³
 !ğ
NULL
 && *type != NULL) {

239 
	`­Ş_veùÜ_de¡roy
(&(*
ty³
)->
diffs
);

240 
	`ä“
(*
ty³
);

241 *
ty³
 = 
NULL
;

243 
	}
}

245 
­Ş_veùÜ_t
 *
	$ty³_g‘_™ems
(
pŞdiff_t
 * 
diff
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
)

247 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

248 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

249 
”rÜ
 = 0;

250 
qpŞ_ty³_t
 *
t
;

251 
i§‰r
, 
i§lŸs
;

252 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicy
);

253 
ušt32_t
 
v®
;

255 ià(
diff
 =ğ
NULL
 || 
pŞicy
 == NULL) {

256 
”rÜ
 = 
”ºo
 = 
EINVAL
;

257 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

258 
”ºo
 = 
”rÜ
;

259  
NULL
;

261 ià(
	`qpŞ_pŞicy_g‘_ty³_™”
(
q
, &
™”
) < 0) {

262  
NULL
;

264 
v
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
);

265 ià(
v
 =ğ
NULL
) {

266 
”rÜ
 = 
”ºo
;

267 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

268 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

269 
”ºo
 = 
”rÜ
;

270  
NULL
;

272 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

273 
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
t
);

274 
	`qpŞ_ty³_g‘_i§lŸs
(
q
, 
t
, &
i§lŸs
);

275 
	`qpŞ_ty³_g‘_i§‰r
(
q
, 
t
, &
i§‰r
);

276 ià(
i§‰r
 || 
i§lŸs
)

278 
v®
 = 
	`ty³_m­_lookup
(
diff
, 
t
, 
pŞicy
 =ğdiff->
Üig_pŞ
 ? 
POLDIFF_POLICY_ORIG
 : 
POLDIFF_POLICY_MOD
);

279 
	`­Ş_veùÜ_­³nd
(
v
, (*)((
size_t
è
v®
));

281 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

282 
	`­Ş_veùÜ_sÜt_uniquify
(
v
, 
NULL
, NULL);

283  
v
;

284 
	}
}

286 
	$ty³_»£t
(
pŞdiff_t
 * 
diff
)

288 
”rÜ
 = 0;

290 ià(
diff
 =ğ
NULL
) {

291 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
EINVAL
));

292 
”ºo
 = 
EINVAL
;

296 
	`ty³_summ¬y_de¡roy
(&
diff
->
ty³_diffs
);

297 
diff
->
ty³_diffs
 = 
	`ty³_summ¬y_ü—‹
();

298 ià(
diff
->
ty³_diffs
 =ğ
NULL
) {

299 
”rÜ
 = 
”ºo
;

300 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

301 
”ºo
 = 
”rÜ
;

306 
	}
}

317 
ty³_comp
(cÚ¡ *
x
, cÚ¡ *
y
, cÚ¡ 
pŞdiff_t
 * 
diff
 
__©Œibu‹__
 ((
unu£d
)))

319 
ušt32_t
 
	gp1v®
 = (ušt32_tè((
size_t
è
x
);

320 
ušt32_t
 
	gp2v®
 = (ušt32_tè((
size_t
è
y
);

323  
	gp1v®
 - 
	gp2v®
;

337 
pŞdiff_ty³_t
 *
	$make_diff
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
pŞdiff_fÜm_e
 
fÜm
, cÚ¡ *
Çme
)

339 
pŞdiff_ty³_t
 *
±
;

340 
”rÜ
;

342 ià((
±
 = 
	`ÿÎoc
(1, (
pŞdiff_ty³_t
))è=ğ
NULL
 ||

343 (
±
->
Çme
 = 
	`¡rdup
Òame)è=ğ
NULL
 ||

344 (
±
->
added_©Œibs
 = 
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(1, 
ä“
)è=ğ
NULL
 ||

345 (
±
->
»moved_©Œibs
 = 
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(1, 
ä“
)è=ğ
NULL
) {

346 
”rÜ
 = 
”ºo
;

347 
	`ty³_de¡roy
(
±
);

348 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

349 
”ºo
 = 
”rÜ
;

350  
NULL
;

352 
±
->
fÜm
 = form;

353  
±
;

354 
	}
}

368 *
	$ty³_g‘_Çme
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
ušt32_t
 
tv®
)

370 cÚ¡ 
­Ş_veùÜ_t
 *
v1
, *
v2
;

371 
size_t
 
sv1
, 
sv2
;

372 
size_t
 
i
, 
Ën
 = 0;

373 cÚ¡ 
qpŞ_ty³_t
 *
qty³
;

374 cÚ¡ *
Çme
 = 
NULL
;

375 *
»t
 = 
NULL
;

376 
”rÜ
 = 0;

379 
v1
 = 
	`ty³_m­_lookup_»v”£
(
diff
, 
tv®
, 
POLDIFF_POLICY_ORIG
);

380 
sv1
 = 
	`­Ş_veùÜ_g‘_size
(
v1
);

382 
v2
 = 
	`ty³_m­_lookup_»v”£
(
diff
, 
tv®
, 
POLDIFF_POLICY_MOD
);

383 
sv2
 = 
	`­Ş_veùÜ_g‘_size
(
v2
);

385 ià(
sv1
 =ğ1 && 
sv2
 == 0) {

387 
qty³
 = 
	`­Ş_veùÜ_g‘_–em’t
(
v1
, 0);

388 ià(
	`qpŞ_ty³_g‘_Çme
(
diff
->
Üig_qpŞ
, 
qty³
, &
Çme
è< 0 || (
»t
 = 
	`¡rdup
Òame)è=ğ
NULL
) {

389 
”rÜ
 = 
”ºo
;

390 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

391 
ş—nup
;

393 } ià(
sv1
 =ğ0 && 
sv2
 == 1) {

395 
qty³
 = 
	`­Ş_veùÜ_g‘_–em’t
(
v2
, 0);

396 ià(
	`qpŞ_ty³_g‘_Çme
(
diff
->
mod_qpŞ
, 
qty³
, &
Çme
è< 0 || (
»t
 = 
	`¡rdup
Òame)è=ğ
NULL
) {

397 
”rÜ
 = 
”ºo
;

398 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

399 
ş—nup
;

403 ià(
sv1
 =ğ
sv2
 && sv2 == 1) {

404 cÚ¡ *
Çme2
;

405 
qpŞ_ty³_t
 *
qty³2
;

406 
qty³
 = 
	`­Ş_veùÜ_g‘_–em’t
(
v1
, 0);

407 
qty³2
 = 
	`­Ş_veùÜ_g‘_–em’t
(
v2
, 0);

408 ià(
	`qpŞ_ty³_g‘_Çme
(
diff
->
Üig_qpŞ
, 
qty³
, &
Çme
) < 0 ||

409 
	`qpŞ_ty³_g‘_Çme
(
diff
->
mod_qpŞ
, 
qty³2
, &
Çme2
) < 0) {

410 
”rÜ
 = 
”ºo
;

411 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

412 
ş—nup
;

414 ià(
	`¡rcmp
(
Çme
, 
Çme2
) == 0) {

415 ià((
»t
 = 
	`¡rdup
(
Çme
)è=ğ
NULL
) {

416 
”rÜ
 = 
”ºo
;

417 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

419 
ş—nup
;

423 
i
 = 0; i < 
sv1
; i++) {

424 
qty³
 = 
	`­Ş_veùÜ_g‘_–em’t
(
v1
, 
i
);

425 ià(
	`qpŞ_ty³_g‘_Çme
(
diff
->
Üig_qpŞ
, 
qty³
, &
Çme
) < 0 ||

426 
	`­Ş_¡r_­³ndf
(&
»t
, &
Ën
, "%s%s", (
i
 > 0 ? ", " : ""), 
Çme
) < 0) {

427 
”rÜ
 = 
”ºo
;

428 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

429 
ş—nup
;

432 
	`­Ş_¡r_­³nd
(&
»t
, &
Ën
, " -> ");

433 
i
 = 0; i < 
sv2
; i++) {

434 
qty³
 = 
	`­Ş_veùÜ_g‘_–em’t
(
v2
, 
i
);

435 ià(
	`qpŞ_ty³_g‘_Çme
(
diff
->
mod_qpŞ
, 
qty³
, &
Çme
) < 0 ||

436 
	`­Ş_¡r_­³ndf
(&
»t
, &
Ën
, "%s%s", (
i
 > 0 ? ", " : ""), 
Çme
) < 0) {

437 
”rÜ
 = 
”ºo
;

438 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

439 
ş—nup
;

443 
ş—nup
:

444 ià(
”rÜ
 != 0) {

445 
	`ä“
(
»t
);

446 
”ºo
 = 
”rÜ
;

447  
NULL
;

449  
»t
;

450 
	}
}

452 
	$ty³_Ãw_diff
(
pŞdiff_t
 * 
diff
, 
pŞdiff_fÜm_e
 
fÜm
, cÚ¡ *
™em
)

454 
ušt32_t
 
tv®
 = (ušt32_tè((
size_t
è
™em
);

455 *
Çme
 = 
NULL
;

456 
pŞdiff_ty³_t
 *
±
;

457 
”rÜ
;

459 ià((
Çme
 = 
	`ty³_g‘_Çme
(
diff
, 
tv®
)è=ğ
NULL
 || (
±
 = 
	`make_diff
(diff, 
fÜm
,‚ame)) == NULL) {

460 
”rÜ
 = 
”ºo
;

461 
	`ä“
(
Çme
);

462 
”ºo
 = 
”rÜ
;

465 
	`ä“
(
Çme
);

466 ià(
	`­Ş_veùÜ_­³nd
(
diff
->
ty³_diffs
->
diffs
, 
±
) < 0) {

467 
”rÜ
 = 
”ºo
;

468 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

469 
	`ty³_de¡roy
(
±
);

470 
”ºo
 = 
”rÜ
;

473 
diff
->
ty³_diffs
->
¬e_diffs_sÜ‹d
 = 0;

474 ià(
fÜm
 =ğ
POLDIFF_FORM_ADDED
) {

475 
diff
->
ty³_diffs
->
num_added
++;

477 
diff
->
ty³_diffs
->
num_»moved
++;

480 
	}
}

494 
­Ş_veùÜ_t
 *
	$ty³_g‘_©Œib_Çmes
(cÚ¡ 
pŞdiff_t
 * 
diff
, cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
ušt32_t
 
ty³
)

496 
qpŞ_™”©Ü_t
 *
©Œib_™”
 = 
NULL
;

497 cÚ¡ *
©Œib
;

498 *
Ãw_©Œib
;

499 cÚ¡ 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

500 
­Ş_veùÜ_t
 *
»t
 = 
NULL
;

501 
qpŞ_ty³_t
 *
qt
 = 
NULL
;

502 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
p
);

503 
»tv®
 = -1;

504 
size_t
 
i
;

506 ià((
»t
 = 
	`­Ş_veùÜ_ü—‹
(
ä“
)è=ğ
NULL
) {

507 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”ºo
));

508  
NULL
;

513 
v
 = 
	`ty³_m­_lookup_»v”£
(
diff
, 
ty³
, (diff->
Üig_pŞ
 =ğ
p
 ? 
POLDIFF_POLICY_ORIG
 : 
POLDIFF_POLICY_MOD
));

514 ià(
	`­Ş_veùÜ_g‘_size
(
v
) == 0) {

515 
	`as£¹
(
çl£
);

516  
NULL
;

519 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v
); i++) {

520 
qt
 = 
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

521 ià(
qt
 =ğ
NULL
) {

522 
	`as£¹
(
çl£
);

523  
NULL
;

525 
	`qpŞ_ty³_g‘_©Œ_™”
(
q
, 
qt
, &
©Œib_™”
);

526 ; !
	`qpŞ_™”©Ü_’d
(
©Œib_™”
); 
	`qpŞ_™”©Ü_Ãxt
(attrib_iter)) {

528 ià(
	`qpŞ_™”©Ü_g‘_™em
(
©Œib_™”
, (**)&
qt
) < 0) {

529 
ş—nup
;

531 
	`qpŞ_ty³_g‘_Çme
(
q
, 
qt
, &
©Œib
);

532 ià((
Ãw_©Œib
 = 
	`¡rdup
(
©Œib
)è=ğ
NULL
 || 
	`­Ş_veùÜ_­³nd
(
»t
,‚ew_attrib) < 0) {

533 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”ºo
));

534 
ş—nup
;

538 
	`­Ş_veùÜ_sÜt_uniquify
(
»t
, &
­Ş_¡r_¡rcmp
, 
NULL
);

539 
»tv®
 = 0;

540 
ş—nup
:

541 
	`qpŞ_™”©Ü_de¡roy
(&
©Œib_™”
);

542 ià(
»tv®
 < 0) {

543 
	`­Ş_veùÜ_de¡roy
(&
»t
);

544  
NULL
;

546  
»t
;

547 
	}
}

549 
	$ty³_d“p_diff
(
pŞdiff_t
 * 
diff
, cÚ¡ *
x
, cÚ¡ *
y
)

551 
ušt32_t
 
tv®1
 = (ušt32_tè((
size_t
è
x
);

552 
ušt32_t
 
tv®2
 = (ušt32_tè((
size_t
è
y
);

553 
­Ş_veùÜ_t
 *
v1
 = 
NULL
, *
v2
 = NULL;

554 *
©Œib1
 = 
NULL
, *
©Œib2
 = NULL, *
Çme
 = NULL;

555 
pŞdiff_ty³_t
 *
t
 = 
NULL
;

556 
size_t
 
i
, 
j
;

557 
»tv®
 = -1, 
”rÜ
 = 0, 
compv®
;

559 
	`as£¹
(
tv®1
 =ğ
tv®2
);

562 ià(!(
	`qpŞ_pŞicy_has_ÿ·b™y
(
	`­Ş_pŞicy_g‘_qpŞ
(
diff
->
Üig_pŞ
), 
QPOL_CAP_ATTRIB_NAMES
))

563 || !(
	`qpŞ_pŞicy_has_ÿ·b™y
(
	`­Ş_pŞicy_g‘_qpŞ
(
diff
->
mod_pŞ
), 
QPOL_CAP_ATTRIB_NAMES
))) {

566 
v1
 = 
	`ty³_g‘_©Œib_Çmes
(
diff
, diff->
Üig_pŞ
, 
tv®1
);

567 
v2
 = 
	`ty³_g‘_©Œib_Çmes
(
diff
, diff->
mod_pŞ
, 
tv®2
);

568 
	`­Ş_veùÜ_sÜt
(
v1
, 
­Ş_¡r_¡rcmp
, 
NULL
);

569 
	`­Ş_veùÜ_sÜt
(
v2
, 
­Ş_¡r_¡rcmp
, 
NULL
);

570 
i
 = 
j
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v1
);) {

571 ià(
j
 >ğ
	`­Ş_veùÜ_g‘_size
(
v2
))

573 
©Œib1
 = (*)
	`­Ş_veùÜ_g‘_–em’t
(
v1
, 
i
);

574 
©Œib2
 = (*)
	`­Ş_veùÜ_g‘_–em’t
(
v2
, 
j
);

575 
compv®
 = 
	`¡rcmp
(
©Œib1
, 
©Œib2
);

576 ià(
compv®
 !ğ0 && 
t
 =ğ
NULL
) {

577 
Çme
 = 
	`ty³_g‘_Çme
(
diff
, 
tv®1
);

578 ià((
t
 = 
	`make_diff
(
diff
, 
POLDIFF_FORM_MODIFIED
, 
Çme
)è=ğ
NULL
) {

579 
”rÜ
 = 
”ºo
;

580 
ş—nup
;

582 
	`ä“
(
Çme
);

583 
Çme
 = 
NULL
;

585 ià(
compv®
 < 0) {

586 ià((
©Œib1
 = 
	`¡rdup
×‰rib1)è=ğ
NULL
 || 
	`­Ş_veùÜ_­³nd
(
t
->
»moved_©Œibs
,‡ttrib1) < 0) {

587 
”rÜ
 = 
”ºo
;

588 
	`ä“
(
©Œib1
);

589 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

590 
ş—nup
;

592 
i
++;

593 } ià(
compv®
 > 0) {

594 ià((
©Œib2
 = 
	`¡rdup
×‰rib2)è=ğ
NULL
 || 
	`­Ş_veùÜ_­³nd
(
t
->
added_©Œibs
,‡ttrib2) < 0) {

595 
”rÜ
 = 
”ºo
;

596 
	`ä“
(
©Œib2
);

597 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

598 
ş—nup
;

600 
j
++;

602 
i
++;

603 
j
++;

606 ; 
i
 < 
	`­Ş_veùÜ_g‘_size
(
v1
); i++) {

607 
©Œib1
 = (*)
	`­Ş_veùÜ_g‘_–em’t
(
v1
, 
i
);

608 ià(
t
 =ğ
NULL
) {

609 
Çme
 = 
	`ty³_g‘_Çme
(
diff
, 
tv®1
);

610 ià((
t
 = 
	`make_diff
(
diff
, 
POLDIFF_FORM_MODIFIED
, 
Çme
)è=ğ
NULL
) {

611 
”rÜ
 = 
”ºo
;

612 
ş—nup
;

614 
	`ä“
(
Çme
);

615 
Çme
 = 
NULL
;

617 ià((
©Œib1
 = 
	`¡rdup
×‰rib1)è=ğ
NULL
 || 
	`­Ş_veùÜ_­³nd
(
t
->
»moved_©Œibs
,‡ttrib1) < 0) {

618 
”rÜ
 = 
”ºo
;

619 
	`ä“
(
©Œib1
);

620 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

621 
ş—nup
;

624 ; 
j
 < 
	`­Ş_veùÜ_g‘_size
(
v2
); j++) {

625 
©Œib2
 = (*)
	`­Ş_veùÜ_g‘_–em’t
(
v2
, 
j
);

626 ià(
t
 =ğ
NULL
) {

627 
Çme
 = 
	`ty³_g‘_Çme
(
diff
, 
tv®1
);

628 ià((
t
 = 
	`make_diff
(
diff
, 
POLDIFF_FORM_MODIFIED
, 
Çme
)è=ğ
NULL
) {

629 
”rÜ
 = 
”ºo
;

630 
ş—nup
;

632 
	`ä“
(
Çme
);

633 
Çme
 = 
NULL
;

635 ià((
©Œib2
 = 
	`¡rdup
×‰rib2)è=ğ
NULL
 || 
	`­Ş_veùÜ_­³nd
(
t
->
added_©Œibs
,‡ttrib2) < 0) {

636 
”rÜ
 = 
”ºo
;

637 
	`ä“
(
©Œib2
);

638 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

639 
ş—nup
;

642 ià(
t
 !ğ
NULL
) {

643 ià(
	`­Ş_veùÜ_­³nd
(
diff
->
ty³_diffs
->
diffs
, 
t
) < 0) {

644 
”rÜ
 = 
”ºo
;

645 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

646 
ş—nup
;

648 
diff
->
ty³_diffs
->
¬e_diffs_sÜ‹d
 = 0;

649 
diff
->
ty³_diffs
->
num_modif›d
++;

651 
»tv®
 = 0;

652 
ş—nup
:

653 
	`­Ş_veùÜ_de¡roy
(&
v1
);

654 
	`­Ş_veùÜ_de¡roy
(&
v2
);

655 
	`ä“
(
Çme
);

656 ià(
»tv®
 != 0) {

657 
	`ty³_de¡roy
(
t
);

659 
”ºo
 = 
”rÜ
;

660  
»tv®
;

662 
	}
}

	@libpoldiff/src/type_internal.h

26 #iâdeà
POLDIFF_TYPE_INTERNAL_H


27 
	#POLDIFF_TYPE_INTERNAL_H


	)

29 #ifdef 
__ılu¥lus


36 
pŞdiff_ty³_summ¬y
 
	tpŞdiff_ty³_summ¬y_t
;

44 
pŞdiff_ty³_summ¬y_t
 *
ty³_summ¬y_ü—‹
();

54 
ty³_summ¬y_de¡roy
(
pŞdiff_ty³_summ¬y_t
 ** 
ty³
);

63 
ty³_»£t
(
pŞdiff_t
 * 
diff
);

76 
­Ş_veùÜ_t
 *
ty³_g‘_™ems
(
pŞdiff_t
 * 
diff
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
);

90 
ty³_comp
(cÚ¡ *
x
, cÚ¡ *
y
, cÚ¡ 
pŞdiff_t
 * 
diff
);

103 
ty³_Ãw_diff
(
pŞdiff_t
 * 
diff
, 
pŞdiff_fÜm_e
 
fÜm
, cÚ¡ *
™em
);

119 
ty³_d“p_diff
(
pŞdiff_t
 * 
diff
, cÚ¡ *
x
, cÚ¡ *
y
);

121 #ifdef 
__ılu¥lus


	@libpoldiff/src/type_map.c

31 
	~"pŞdiff_š‹º®.h
"

33 
	~<­Ş/pŞicy-qu”y.h
>

34 
	~<­Ş/ut.h
>

35 
	~<as£¹.h
>

36 
	~<”ºo.h
>

37 
	~<¡dio.h
>

38 
	~<¡ršg.h
>

44 
	sty³_m­


48 
ušt32_t
 *
	mÜig_to_p£udo
;

51 
ušt32_t
 *
	mmod_to_p£udo
;

54 
­Ş_veùÜ_t
 *
	mp£udo_to_Üig
;

57 
­Ş_veùÜ_t
 *
	mp£udo_to_mod
;

58 
size_t
 
	mnum_Üig_ty³s
;

59 
size_t
 
	mnum_mod_ty³s
;

61 
­Ş_veùÜ_t
 *
	m»m­
;

68 
	spŞdiff_ty³_»m­_’Œy


71 
­Ş_veùÜ_t
 *
	mÜig_ty³s
;

73 
­Ş_veùÜ_t
 *
	mmod_ty³s
;

74 
	mšã¼ed
;

75 
	m’abËd
;

84 
	$ty³_»m­_’Œy_ä“
(*
–em
)

86 
pŞdiff_ty³_»m­_’Œy_t
 *
’Œy
 = (pŞdiff_ty³_»m­_’Œy_ˆ*è
–em
;

87 ià(
’Œy
 !ğ
NULL
) {

88 
	`­Ş_veùÜ_de¡roy
(&
’Œy
->
Üig_ty³s
);

89 
	`­Ş_veùÜ_de¡roy
(&
’Œy
->
mod_ty³s
);

90 
	`ä“
(
’Œy
);

92 
	}
}

102 
pŞdiff_ty³_»m­_’Œy_t
 *
	$pŞdiff_ty³_»m­_’Œy_ü—‹
(
pŞdiff_t
 * 
diff
)

104 
pŞdiff_ty³_»m­_’Œy_t
 *
e
 = 
NULL
;

105 ià((
e
 = 
	`ÿÎoc
(1, (*e))è=ğ
NULL
 ||

106 (
e
->
Üig_ty³s
 = 
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(1, 
ä“
)è=ğ
NULL
 ||

107 (
e
->
mod_ty³s
 = 
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(1, 
ä“
)è=ğ
NULL
 || 
	`­Ş_veùÜ_­³nd
(
diff
->
ty³_m­
->
»m­
,ƒ) < 0)

109 
	`ty³_»m­_’Œy_ä“
(
e
);

110  
NULL
;

112 
diff
->
»m­³d
 = 1;

113 
e
->
’abËd
 = 1;

114  
e
;

115 
	}
}

117 
	$pŞdiff_ty³_»m­_ü—‹
(
pŞdiff_t
 * 
diff
, cÚ¡ 
­Ş_veùÜ_t
 * 
Üig_Çmes
, cÚ¡‡pŞ_veùÜ_ˆ* 
mod_Çmes
)

119 
pŞdiff_ty³_»m­_’Œy_t
 *
’Œy
 = 
NULL
;

120 
size_t
 
i
;

121 *
Çme
;

122 cÚ¡ 
qpŞ_ty³_t
 *
ty³
;

123 
i§lŸs
, 
i§‰r
;

124 
»tv®
 = -1, 
”rÜ
 = 0;

125 ià(
diff
 =ğ
NULL
 || 
Üig_Çmes
 =ğNULL || 
mod_Çmes
 == NULL) {

126 
”rÜ
 = 
EINVAL
;

127 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

128 
ş—nup
;

130 ià(
	`­Ş_veùÜ_g‘_size
(
Üig_Çmes
) == 0 ||

131 
	`­Ş_veùÜ_g‘_size
(
mod_Çmes
è=ğ0 || (­Ş_veùÜ_g‘_size(
Üig_Çmes
) > 1 &&‡pol_vector_get_size(mod_names) > 1)) {

132 
”rÜ
 = 
EINVAL
;

133 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

134 
ş—nup
;

136 ià((
’Œy
 = 
	`ÿÎoc
(1, (*’Œy))è=ğ
NULL
 ||

137 (
’Œy
->
Üig_ty³s
 = 
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(1, 
ä“
)è=ğ
NULL
 ||

138 (
’Œy
->
mod_ty³s
 = 
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(1, 
ä“
)è=ğ
NULL
) {

139 
”rÜ
 = 
ENOMEM
;

140 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

141 
ş—nup
;

143 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
Üig_Çmes
); i++) {

144 
Çme
 = (*)
	`­Ş_veùÜ_g‘_–em’t
(
Üig_Çmes
, 
i
);

145 ià(
	`qpŞ_pŞicy_g‘_ty³_by_Çme
(
diff
->
Üig_qpŞ
, 
Çme
, &
ty³
) < 0 ||

146 
	`qpŞ_ty³_g‘_i§lŸs
(
diff
->
Üig_qpŞ
, 
ty³
, &
i§lŸs
) < 0 ||

147 
	`qpŞ_ty³_g‘_i§‰r
(
diff
->
Üig_qpŞ
, 
ty³
, &
i§‰r
) < 0) {

148 
”rÜ
 = 
”ºo
;

149 
ş—nup
;

151 ià(
i§lŸs
 || 
i§‰r
) {

152 
”rÜ
 = 
EINVAL
;

153 
	`ERR
(
diff
, "% i nÙ‡…rim¬yy³.", 
Çme
);

154 
ş—nup
;

156 ià((
Çme
 = 
	`¡rdup
Òame)è=ğ
NULL
 || 
	`­Ş_veùÜ_­³nd
(
’Œy
->
Üig_ty³s
, (*)name) < 0) {

157 
”rÜ
 = 
ENOMEM
;

158 
	`ä“
(
Çme
);

159 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

160 
ş—nup
;

163 
	`­Ş_veùÜ_sÜt_uniquify
(
’Œy
->
Üig_ty³s
, 
­Ş_¡r_¡rcmp
, 
NULL
);

164 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
mod_Çmes
); i++) {

165 
Çme
 = (*)
	`­Ş_veùÜ_g‘_–em’t
(
mod_Çmes
, 
i
);

166 ià(
	`qpŞ_pŞicy_g‘_ty³_by_Çme
(
diff
->
mod_qpŞ
, 
Çme
, &
ty³
) < 0 ||

167 
	`qpŞ_ty³_g‘_i§lŸs
(
diff
->
mod_qpŞ
, 
ty³
, &
i§lŸs
) < 0 ||

168 
	`qpŞ_ty³_g‘_i§‰r
(
diff
->
mod_qpŞ
, 
ty³
, &
i§‰r
) < 0) {

169 
”rÜ
 = 
”ºo
;

170 
ş—nup
;

172 ià(
i§lŸs
 || 
i§‰r
) {

173 
”rÜ
 = 
EINVAL
;

174 
	`ERR
(
diff
, "% i nÙ‡…rim¬yy³.", 
Çme
);

175 
ş—nup
;

177 ià((
Çme
 = 
	`¡rdup
Òame)è=ğ
NULL
 || 
	`­Ş_veùÜ_­³nd
(
’Œy
->
mod_ty³s
, (*)name) < 0) {

178 
”rÜ
 = 
ENOMEM
;

179 
	`ä“
(
Çme
);

180 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

181 
ş—nup
;

184 
	`­Ş_veùÜ_sÜt_uniquify
(
’Œy
->
mod_ty³s
, 
­Ş_¡r_¡rcmp
, 
NULL
);

185 
’Œy
->
’abËd
 = 1;

186 ià(
	`­Ş_veùÜ_­³nd
(
diff
->
ty³_m­
->
»m­
, 
’Œy
) < 0) {

187 
”rÜ
 = 
ENOMEM
;

188 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

189 
ş—nup
;

191 
»tv®
 = 0;

192 
diff
->
»m­³d
 = 1;

193 
ş—nup
:

194 ià(
»tv®
 < 0) {

195 
	`ty³_»m­_’Œy_ä“
(
’Œy
);

197 
”ºo
 = 
”rÜ
;

198  
»tv®
;

199 
	}
}

201 
­Ş_veùÜ_t
 *
	$pŞdiff_ty³_»m­_g‘_’Œ›s
(cÚ¡ 
pŞdiff_t
 * 
diff
)

203 ià(
diff
 =ğ
NULL
 || diff->
ty³_m­
 == NULL) {

204 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
EINVAL
));

205 
”ºo
 = 
EINVAL
;

206  
NULL
;

208  
diff
->
ty³_m­
->
»m­
;

209 
	}
}

211 
	$pŞdiff_ty³_»m­_’Œy_»move
(
pŞdiff_t
 * 
diff
, 
pŞdiff_ty³_»m­_’Œy_t
 * 
’Œy
)

213 
size_t
 
idx
;

214 ià(
diff
 =ğ
NULL
 || 
’Œy
 == NULL) {

215 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
EINVAL
));

216 
”ºo
 = 
EINVAL
;

219 ià(
	`­Ş_veùÜ_g‘_šdex
(
diff
->
ty³_m­
->
»m­
, 
’Œy
, 
NULL
, NULL, &
idx
) < 0) {

220 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
EINVAL
));

221 
”ºo
 = 
EINVAL
;

224 
	`­Ş_veùÜ_»move
(
diff
->
ty³_m­
->
»m­
, 
idx
);

225 
diff
->
»m­³d
 = 1;

226 
	}
}

228 
­Ş_veùÜ_t
 *
	$pŞdiff_ty³_»m­_’Œy_g‘_Üigš®_ty³s
(cÚ¡ 
pŞdiff_t
 * 
diff
, cÚ¡ 
pŞdiff_ty³_»m­_’Œy_t
 * 
’Œy
)

230 ià(
diff
 =ğ
NULL
 || 
’Œy
 == NULL) {

231 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
EINVAL
));

232 
”ºo
 = 
EINVAL
;

233  
NULL
;

235  
	`­Ş_veùÜ_ü—‹_äom_veùÜ
(
’Œy
->
Üig_ty³s
, 
NULL
, NULL, NULL);

236 
	}
}

238 
­Ş_veùÜ_t
 *
	$pŞdiff_ty³_»m­_’Œy_g‘_modif›d_ty³s
(cÚ¡ 
pŞdiff_t
 * 
diff
, cÚ¡ 
pŞdiff_ty³_»m­_’Œy_t
 * 
’Œy
)

240 ià(
diff
 =ğ
NULL
 || 
’Œy
 == NULL) {

241 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
EINVAL
));

242 
”ºo
 = 
EINVAL
;

243  
NULL
;

245  
	`­Ş_veùÜ_ü—‹_äom_veùÜ
(
’Œy
->
mod_ty³s
, 
NULL
, NULL, NULL);

246 
	}
}

248 
	$pŞdiff_ty³_»m­_’Œy_g‘_is_šã¼ed
(cÚ¡ 
pŞdiff_ty³_»m­_’Œy_t
 * 
’Œy
)

250 ià(
’Œy
 =ğ
NULL
) {

251 
”ºo
 = 
EINVAL
;

254  
’Œy
->
šã¼ed
;

255 
	}
}

257 
	$pŞdiff_ty³_»m­_’Œy_g‘_is_’abËd
(cÚ¡ 
pŞdiff_ty³_»m­_’Œy_t
 * 
’Œy
)

259 ià(
’Œy
 =ğ
NULL
) {

260 
”ºo
 = 
EINVAL
;

263  
’Œy
->
’abËd
;

264 
	}
}

266 
	$pŞdiff_ty³_»m­_’Œy_£t_’abËd
(
pŞdiff_ty³_»m­_’Œy_t
 * 
’Œy
, 
’abËd
)

268 ià(
’Œy
 =ğ
NULL
) {

269 
”ºo
 = 
EINVAL
;

272 ià(
’abËd
) {

273 
’Œy
->
’abËd
 = 1;

275 
’Œy
->
’abËd
 = 0;

277 
	}
}

279 
ty³_m­_t
 *
	$ty³_m­_ü—‹
()

281 
ty³_m­_t
 *
m­
 = 
	`ÿÎoc
(1, (*map));

282 ià(
m­
 =ğ
NULL
) {

283  
NULL
;

285 ià((
m­
->
»m­
 = 
	`­Ş_veùÜ_ü—‹
(
ty³_»m­_’Œy_ä“
)è=ğ
NULL
) {

286 
	`ty³_m­_de¡roy
(&
m­
);

287  
NULL
;

289  
m­
;

290 
	}
}

292 
	$ty³_m­_de¡roy
(
ty³_m­_t
 ** 
m­
)

294 ià(
m­
 !ğ
NULL
 && *map != NULL) {

295 
	`ä“
((*
m­
)->
Üig_to_p£udo
);

296 
	`ä“
((*
m­
)->
mod_to_p£udo
);

297 
	`­Ş_veùÜ_de¡roy
(&(*
m­
)->
p£udo_to_Üig
);

298 
	`­Ş_veùÜ_de¡roy
(&(*
m­
)->
p£udo_to_mod
);

299 
	`­Ş_veùÜ_de¡roy
(&(*
m­
)->
»m­
);

300 
	`ä“
(*
m­
);

301 *
m­
 = 
NULL
;

303 
	}
}

309 
	$ty³_m­_dump
(
pŞdiff_t
 * 
diff
)

311 #ifdeà
SETOOLS_DEBUG


312 
size_t
 
i
, 
j
;

313 
­Ş_veùÜ_t
 *
v
;

314 cÚ¡ 
qpŞ_ty³_t
 *
t
;

315 cÚ¡ *
Çme
;

316 
	`´štf
("#ype map debug dump (qpol_type_t ->…seudo-type):\norig:\n");

317 
i
 = 0; i < 
diff
->
ty³_m­
->
num_Üig_ty³s
; i++) {

318 
	`´štf
("%3zd:%5d", 
i
, 
diff
->
ty³_m­
->
Üig_to_p£udo
[i]);

319 ià((
i
 + 1) % 5 == 0) {

320 
	`´štf
("\n");

322 
	`´štf
("\t");

325 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
diff
->
ty³_m­
->
p£udo_to_Üig
); i++) {

326 
v
 = 
	`­Ş_veùÜ_g‘_–em’t
(
diff
->
ty³_m­
->
p£udo_to_Üig
, 
i
);

327 
	`´štf
("\n%3zd->", 
i
);

328 
j
 = 0; j < 
	`­Ş_veùÜ_g‘_size
(
v
); j++) {

329 
t
 = 
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
j
);

330 
	`qpŞ_ty³_g‘_Çme
(
diff
->
Üig_qpŞ
, 
t
, &
Çme
);

331 
	`´štf
(" %s", 
Çme
);

334 
	`´štf
("\nmod:\n");

335 
i
 = 0; i < 
diff
->
ty³_m­
->
num_mod_ty³s
; i++) {

336 
	`´štf
("%3zd:%5d", 
i
, 
diff
->
ty³_m­
->
mod_to_p£udo
[i]);

337 ià((
i
 + 1) % 5 == 0) {

338 
	`´štf
("\n");

340 
	`´štf
("\t");

343 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
diff
->
ty³_m­
->
p£udo_to_mod
); i++) {

344 
v
 = 
	`­Ş_veùÜ_g‘_–em’t
(
diff
->
ty³_m­
->
p£udo_to_mod
, 
i
);

345 
	`´štf
("\n%3zd->", 
i
);

346 
j
 = 0; j < 
	`­Ş_veùÜ_g‘_size
(
v
); j++) {

347 
t
 = 
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
j
);

348 
	`qpŞ_ty³_g‘_Çme
(
diff
->
mod_qpŞ
, 
t
, &
Çme
);

349 
	`´štf
(" %s", 
Çme
);

352 
	`´štf
("\n");

354 
	}
}

359 
	$ty³_m­_veùÜ_ä“
(*
–em
)

361 
­Ş_veùÜ_t
 *
v
 = (­Ş_veùÜ_ˆ*è
–em
;

362 ià(
v
 !ğ
NULL
) {

363 
	`­Ş_veùÜ_de¡roy
(&
v
);

365 
	}
}

367 
	$ty³_m­_bud
(
pŞdiff_t
 * 
diff
)

369 
ty³_m­_t
 *
m­
;

370 
­Ş_veùÜ_t
 *
ov
 = 
NULL
, *
mv
 = NULL;

371 
»tv®
 = -1, 
”rÜ
 = 0;

372 
size_t
 
i
, 
j
;

373 cÚ¡ 
qpŞ_ty³_t
 *
t
;

374 
ušt32_t
 
v®
, 
max_v®
, 
Ãxt_v®
;

375 
­Ş_veùÜ_t
 *
»v”£_v
 = 
NULL
;

377 
m­
 = 
diff
->
ty³_m­
;

378 
	`ä“
(
m­
->
Üig_to_p£udo
);

379 
m­
->
Üig_to_p£udo
 = 
NULL
;

380 
m­
->
num_Üig_ty³s
 = 0;

381 
	`ä“
(
m­
->
mod_to_p£udo
);

382 
m­
->
mod_to_p£udo
 = 
NULL
;

383 
m­
->
num_mod_ty³s
 = 0;

384 
	`­Ş_veùÜ_de¡roy
(&
m­
->
p£udo_to_Üig
);

385 
	`­Ş_veùÜ_de¡roy
(&
m­
->
p£udo_to_mod
);

387 ià(
	`­Ş_ty³_g‘_by_qu”y
(
diff
->
Üig_pŞ
, 
NULL
, &
ov
è< 0 ||‡pŞ_ty³_g‘_by_qu”y(diff->
mod_pŞ
, NULL, &
mv
) < 0) {

388 
”rÜ
 = 
”ºo
;

389 
ş—nup
;

395 
max_v®
 = 0;

396 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
ov
); i++) {

397 
t
 = (
qpŞ_ty³_t
 *è
	`­Ş_veùÜ_g‘_–em’t
(
ov
, 
i
);

398 ià(
	`qpŞ_ty³_g‘_v®ue
(
diff
->
Üig_qpŞ
, 
t
, &
v®
) < 0) {

399 
”rÜ
 = 
”ºo
;

400 
ş—nup
;

402 ià(
v®
 > 
max_v®
) {

403 
max_v®
 = 
v®
;

406 ià((
m­
->
Üig_to_p£udo
 = 
	`ÿÎoc
(
max_v®
, (*(m­->Üig_to_p£udo)))è=ğ
NULL
) {

407 
”rÜ
 = 
”ºo
;

408 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

409 
ş—nup
;

411 
m­
->
num_Üig_ty³s
 = 
max_v®
;

412 
max_v®
 = 0;

413 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
mv
); i++) {

414 
t
 = (
qpŞ_ty³_t
 *è
	`­Ş_veùÜ_g‘_–em’t
(
mv
, 
i
);

415 ià(
	`qpŞ_ty³_g‘_v®ue
(
diff
->
mod_qpŞ
, 
t
, &
v®
) < 0) {

416 
”rÜ
 = 
”ºo
;

417 
ş—nup
;

419 ià(
v®
 > 
max_v®
) {

420 
max_v®
 = 
v®
;

423 ià((
m­
->
mod_to_p£udo
 = 
	`ÿÎoc
(
max_v®
, (*(m­->mod_to_p£udo)))è=ğ
NULL
) {

424 
”rÜ
 = 
”ºo
;

425 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

426 
ş—nup
;

428 
m­
->
num_mod_ty³s
 = 
max_v®
;

430 ià((
m­
->
p£udo_to_Üig
 = 
	`­Ş_veùÜ_ü—‹
(
ty³_m­_veùÜ_ä“
)è=ğ
NULL


431 || (
m­
->
p£udo_to_mod
 = 
	`­Ş_veùÜ_ü—‹
(
ty³_m­_veùÜ_ä“
)è=ğ
NULL
) {

432 
”rÜ
 = 
”ºo
;

433 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

434 
ş—nup
;

437 
Ãxt_v®
 = 1;

438 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
m­
->
»m­
); i++) {

439 
pŞdiff_ty³_»m­_’Œy_t
 *
e
;

440 cÚ¡ *
Çme
;

441 
e
 = (
pŞdiff_ty³_»m­_’Œy_t
 *è
	`­Ş_veùÜ_g‘_–em’t
(
m­
->
»m­
, 
i
);

442 ià(!
e
->
’abËd
) {

446 ià((
»v”£_v
 = 
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(1, 
NULL
)) == NULL) {

447 
”rÜ
 = 
”ºo
;

448 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

449 
ş—nup
;

451 
j
 = 0; j < 
	`­Ş_veùÜ_g‘_size
(
e
->
Üig_ty³s
); j++) {

452 
Çme
 = (cÚ¡ *)
	`­Ş_veùÜ_g‘_–em’t
(
e
->
Üig_ty³s
, 
j
);

453 ià(
	`qpŞ_pŞicy_g‘_ty³_by_Çme
(
diff
->
Üig_qpŞ
, 
Çme
, &
t
) < 0 ||

454 
	`qpŞ_ty³_g‘_v®ue
(
diff
->
Üig_qpŞ
, 
t
, &
v®
) < 0) {

455 
”rÜ
 = 
”ºo
;

456 
ş—nup
;

458 ià(
m­
->
Üig_to_p£udo
[
v®
 - 1] != 0) {

459 
”rÜ
 = 
EINVAL
;

460 
	`ERR
(
diff
, "Ty³ % i ®»ady„em­³d.", 
Çme
);

461 
ş—nup
;

463 
m­
->
Üig_to_p£udo
[
v®
 - 1] = 
Ãxt_v®
;

464 ià(
	`­Ş_veùÜ_­³nd
(
»v”£_v
, (*)
t
) < 0) {

465 
”rÜ
 = 
”ºo
;

466 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

467 
ş—nup
;

470 ià(
	`­Ş_veùÜ_­³nd
(
m­
->
p£udo_to_Üig
, 
»v”£_v
) < 0) {

471 
”rÜ
 = 
”ºo
;

472 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

473 
ş—nup
;

475 
»v”£_v
 = 
NULL
;

477 ià((
»v”£_v
 = 
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(1, 
NULL
)) == NULL) {

478 
”rÜ
 = 
”ºo
;

479 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

480 
ş—nup
;

482 
j
 = 0; j < 
	`­Ş_veùÜ_g‘_size
(
e
->
mod_ty³s
); j++) {

483 
Çme
 = (cÚ¡ *)
	`­Ş_veùÜ_g‘_–em’t
(
e
->
mod_ty³s
, 
j
);

484 ià(
	`qpŞ_pŞicy_g‘_ty³_by_Çme
(
diff
->
mod_qpŞ
, 
Çme
, &
t
) < 0 ||

485 
	`qpŞ_ty³_g‘_v®ue
(
diff
->
mod_qpŞ
, 
t
, &
v®
) < 0) {

486 
”rÜ
 = 
”ºo
;

487 
ş—nup
;

489 ià(
m­
->
mod_to_p£udo
[
v®
 - 1] != 0) {

490 
”rÜ
 = 
EINVAL
;

491 
	`ERR
(
diff
, "Ty³ % i ®»ady„em­³d.", 
Çme
);

492 
ş—nup
;

494 
m­
->
mod_to_p£udo
[
v®
 - 1] = 
Ãxt_v®
;

495 ià(
	`­Ş_veùÜ_­³nd
(
»v”£_v
, (*)
t
) < 0) {

496 
”rÜ
 = 
”ºo
;

497 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

498 
ş—nup
;

501 ià(
	`­Ş_veùÜ_­³nd
(
m­
->
p£udo_to_mod
, 
»v”£_v
) < 0) {

502 
”rÜ
 = 
”ºo
;

503 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

504 
ş—nup
;

506 
»v”£_v
 = 
NULL
;

508 
Ãxt_v®
++;

513 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
ov
); i++) {

514 
t
 = 
	`­Ş_veùÜ_g‘_–em’t
(
ov
, 
i
);

515 ià(
	`qpŞ_ty³_g‘_v®ue
(
diff
->
Üig_qpŞ
, 
t
, &
v®
) < 0) {

516 
”rÜ
 = 
”ºo
;

517 
ş—nup
;

519 ià(
m­
->
Üig_to_p£udo
[
v®
 - 1] == 0) {

520 
m­
->
Üig_to_p£udo
[
v®
 - 1] = 
Ãxt_v®
;

521 ià((
»v”£_v
 = 
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(1, 
NULL
)) == NULL ||

522 
	`­Ş_veùÜ_­³nd
(
»v”£_v
, (*)
t
) < 0 ||

523 
	`­Ş_veùÜ_­³nd
(
m­
->
p£udo_to_Üig
, 
»v”£_v
) < 0) {

524 
”rÜ
 = 
”ºo
;

525 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

526 
ş—nup
;

528 
»v”£_v
 = 
NULL
;

529 ià((
»v”£_v
 = 
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(1, 
NULL
)) == NULL ||

530 
	`­Ş_veùÜ_­³nd
(
m­
->
p£udo_to_mod
, 
»v”£_v
) < 0) {

531 
”rÜ
 = 
”ºo
;

532 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

533 
ş—nup
;

535 
»v”£_v
 = 
NULL
;

536 
Ãxt_v®
++;

539 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
mv
); i++) {

540 
t
 = 
	`­Ş_veùÜ_g‘_–em’t
(
mv
, 
i
);

541 ià(
	`qpŞ_ty³_g‘_v®ue
(
diff
->
mod_qpŞ
, 
t
, &
v®
) < 0) {

542 
”rÜ
 = 
”ºo
;

543 
ş—nup
;

545 ià(
m­
->
mod_to_p£udo
[
v®
 - 1] == 0) {

546 
m­
->
mod_to_p£udo
[
v®
 - 1] = 
Ãxt_v®
;

547 ià((
»v”£_v
 = 
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(1, 
NULL
)) == NULL ||

548 
	`­Ş_veùÜ_­³nd
(
»v”£_v
, (*)
t
è< 0 ||‡pŞ_veùÜ_­³nd(
m­
->
p£udo_to_mod
,„everse_v) < 0) {

549 
”rÜ
 = 
”ºo
;

550 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

551 
ş—nup
;

553 
»v”£_v
 = 
NULL
;

554 ià((
»v”£_v
 = 
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(1, 
NULL
)) == NULL ||

555 
	`­Ş_veùÜ_­³nd
(
m­
->
p£udo_to_Üig
, 
»v”£_v
) < 0) {

556 
”rÜ
 = 
”ºo
;

557 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

558 
ş—nup
;

560 
»v”£_v
 = 
NULL
;

561 
Ãxt_v®
++;

565 
	`ty³_m­_dump
(
diff
);

567 
»tv®
 = 0;

568 
ş—nup
:

569 
	`­Ş_veùÜ_de¡roy
(&
ov
);

570 
	`­Ş_veùÜ_de¡roy
(&
mv
);

571 
	`­Ş_veùÜ_de¡roy
(&
»v”£_v
);

572 
”rÜ
 = 
”ºo
;

573  
»tv®
;

574 
	}
}

576 
	$pŞdiff_ty³_»m­_æush
(
pŞdiff_t
 * 
diff
)

578 ià(
diff
 =ğ
NULL
 || diff->
ty³_m­
 == NULL) {

579 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
EINVAL
));

580 
”ºo
 = 
EINVAL
;

583 
	`­Ş_veùÜ_de¡roy
(&(
diff
->
ty³_m­
->
»m­
));

585 
diff
->
ty³_m­
->
»m­
 = 
	`­Ş_veùÜ_ü—‹
(
ty³_»m­_’Œy_ä“
);

586 
diff
->
»m­³d
 = 1;

587 
	}
}

592 
	sty³_m­_comp


594 
pŞdiff_t
 *
	mdiff
;

597 
	mdœ
;

610 
	$ty³_m­_´im¬y_comp
(cÚ¡ *
a
, cÚ¡ *
b
, *
d©a
)

612 cÚ¡ 
qpŞ_ty³_t
 *

 = 
a
;

613 cÚ¡ 
qpŞ_ty³_t
 *
tb
 = 
b
;

614 
ty³_m­_comp
 *
c
 = (ty³_m­_com°*)
d©a
;

615 
pŞdiff_t
 *
diff
 = 
c
->diff;

616 
dœ
 = 
c
->dir;

617 cÚ¡ *
Ç
, *
nb
;

618 ià(
dœ
 =ğ
POLDIFF_POLICY_ORIG
) {

619 ià(
	`qpŞ_ty³_g‘_Çme
(
diff
->
Üig_qpŞ
, 

, &
Ç
è< 0 || qpŞ_ty³_g‘_Çme(diff->
mod_qpŞ
, 
tb
, &
nb
) < 0) {

623 ià(
	`qpŞ_ty³_g‘_Çme
(
diff
->
mod_qpŞ
, 

, &
Ç
è< 0 || qpŞ_ty³_g‘_Çme(diff->
Üig_qpŞ
, 
tb
, &
nb
) < 0) {

627  
	`¡rcmp
(
Ç
, 
nb
);

628 
	}
}

640 
	$ty³_m­_´im_®Ÿs_comp
(cÚ¡ *
a
, cÚ¡ *
b
, *
d©a
)

642 cÚ¡ 
qpŞ_ty³_t
 *

 = 
a
;

643 cÚ¡ 
qpŞ_ty³_t
 *
tb
 = 
b
;

644 
ty³_m­_comp
 *
c
 = (ty³_m­_com°*)
d©a
;

645 
pŞdiff_t
 *
diff
 = 
c
->diff;

646 
dœ
 = 
c
->dir;

647 cÚ¡ *
´im
, *
®Ÿs
;

648 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

649 ià(
dœ
 =ğ
POLDIFF_POLICY_ORIG
) {

650 ià(
	`qpŞ_ty³_g‘_®Ÿs_™”
(
diff
->
Üig_qpŞ
, 

, &
™”
è< 0 || 
	`qpŞ_ty³_g‘_Çme
(diff->
mod_qpŞ
, 
tb
, &
´im
) < 0) {

651 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

655 ià(
	`qpŞ_ty³_g‘_®Ÿs_™”
(
diff
->
mod_qpŞ
, 

, &
™”
è< 0 || 
	`qpŞ_ty³_g‘_Çme
(diff->
Üig_qpŞ
, 
tb
, &
´im
) < 0) {

656 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

660 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

661 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
®Ÿs
) < 0) {

662 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

665 ià(
	`¡rcmp
(
´im
, 
®Ÿs
) == 0) {

666 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

670 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

672 
	}
}

684 
	$ty³_m­_´im_®Ÿ£s_comp
(cÚ¡ *
a
, cÚ¡ *
b
, *
d©a
)

686 
qpŞ_ty³_t
 *

 = (qpŞ_ty³_ˆ*è
a
;

687 
qpŞ_ty³_t
 *
tb
 = (qpŞ_ty³_ˆ*è
b
;

688 
ty³_m­_comp
 *
c
 = (ty³_m­_com°*)
d©a
;

689 
pŞdiff_t
 *
diff
 = 
c
->diff;

690 
dœ
 = 
c
->dir;

691 
qpŞ_pŞicy_t
 *
p1
, *
p2
;

692 
qpŞ_™”©Ü_t
 *
™”1
 = 
NULL
, *
™”2
 = NULL;

693 
­Ş_veùÜ_t
 *
v1
 = 
NULL
, *
v2
 = NULL;

694 
size_t
 
i
;

695 
»tv®
 = -1, 
”rÜ
 = 0;

696 ià(
dœ
 =ğ
POLDIFF_POLICY_ORIG
) {

697 
p1
 = 
diff
->
Üig_qpŞ
;

698 
p2
 = 
diff
->
mod_qpŞ
;

700 
p1
 = 
diff
->
mod_qpŞ
;

701 
p2
 = 
diff
->
Üig_qpŞ
;

703 ià(
	`qpŞ_ty³_g‘_®Ÿs_™”
(
p1
, 

, &
™”1
) < 0) {

704 
”rÜ
 = 
”ºo
;

705 
ş—nup
;

707 ià((
v1
 = 
	`­Ş_veùÜ_ü—‹_äom_™”
(
™”1
, 
NULL
)) == NULL) {

708 
”rÜ
 = 
”ºo
;

709 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

710 
ş—nup
;

712 ià(
	`qpŞ_ty³_g‘_®Ÿs_™”
(
p2
, 
tb
, &
™”2
) < 0) {

713 
”rÜ
 = 
”ºo
;

714 
ş—nup
;

716 ià((
v2
 = 
	`­Ş_veùÜ_ü—‹_äom_™”
(
™”2
, 
NULL
)) == NULL) {

717 
”rÜ
 = 
”ºo
;

718 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

719 
ş—nup
;

721 ià(
	`­Ş_veùÜ_g‘_size
(
v1
è=ğ0 ||‡pŞ_veùÜ_g‘_size(
v2
) == 0) {

722 
»tv®
 = 1;

723 
ş—nup
;

725 
	`­Ş_veùÜ_sÜt_uniquify
(
v1
, 
­Ş_¡r_¡rcmp
, 
NULL
);

726 
	`­Ş_veùÜ_sÜt_uniquify
(
v2
, 
­Ş_¡r_¡rcmp
, 
NULL
);

727 
»tv®
 = 
	`­Ş_veùÜ_com·»
(
v1
, 
v2
, 
­Ş_¡r_¡rcmp
, 
NULL
, &
i
);

729 
ş—nup
:

730 
	`qpŞ_™”©Ü_de¡roy
(&
™”1
);

731 
	`qpŞ_™”©Ü_de¡roy
(&
™”2
);

732 
	`­Ş_veùÜ_de¡roy
(&
v1
);

733 
	`­Ş_veùÜ_de¡roy
(&
v2
);

734 
”ºo
 = 
”rÜ
;

735  
»tv®
;

736 
	}
}

742 
	$ty³_»m­_veùÜ_dump
(
pŞdiff_t
 * 
diff
)

744 #ifdeà
SETOOLS_DEBUG


745 
­Ş_veùÜ_t
 *
v
, *
w
;

746 
size_t
 
i
, 
j
;

747 
pŞdiff_ty³_»m­_’Œy_t
 *
e
;

748 *
Çme
;

749 
	`´štf
("#ype„emap vector debug dump (pseudo-type -> qpol_type_t(s):\n");

750 
v
 = 
	`pŞdiff_ty³_»m­_g‘_’Œ›s
(
diff
);

751 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v
); i++) {

752 
e
 = 
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

753 
	`´štf
("%zd\t%s\t", 
i
, 
	`pŞdiff_ty³_»m­_’Œy_g‘_is_’abËd
(
e
) ? "en" : "dis");

754 
w
 = 
	`pŞdiff_ty³_»m­_’Œy_g‘_Üigš®_ty³s
(
diff
, 
e
);

755 
j
 = 0; j < 
	`­Ş_veùÜ_g‘_size
(
w
); j++) {

756 
Çme
 = 
	`­Ş_veùÜ_g‘_–em’t
(
w
, 
j
);

757 
	`´štf
("% ", 
Çme
);

759 
	`­Ş_veùÜ_de¡roy
(&
w
);

760 
	`´štf
("-> ");

761 
w
 = 
	`pŞdiff_ty³_»m­_’Œy_g‘_modif›d_ty³s
(
diff
, 
e
);

762 
j
 = 0; j < 
	`­Ş_veùÜ_g‘_size
(
w
); j++) {

763 
Çme
 = 
	`­Ş_veùÜ_g‘_–em’t
(
w
, 
j
);

764 
	`´štf
("% ", 
Çme
);

766 
	`­Ş_veùÜ_de¡roy
(&
w
);

767 
	`´štf
("\n");

770 
	}
}

772 
	$ty³_m­_’Œy_­³nd_qty³s
(
pŞdiff_t
 * 
diff
, 
pŞdiff_ty³_»m­_’Œy_t
 * 
’Œy
, cÚ¡ 
qpŞ_ty³_t
 * 
t
,

773 cÚ¡ 
qpŞ_ty³_t
 * 
u
)

775 cÚ¡ *
Çme
;

776 *
dup_Çme
;

777 ià(
	`qpŞ_ty³_g‘_Çme
(
diff
->
Üig_qpŞ
, 
t
, &
Çme
) < 0) {

780 ià((
dup_Çme
 = 
	`¡rdup
(
Çme
)è=ğ
NULL
 || 
	`­Ş_veùÜ_­³nd
(
’Œy
->
Üig_ty³s
, (*)dup_name) < 0) {

781 
	`ä“
(
dup_Çme
);

785 ià(
	`qpŞ_ty³_g‘_Çme
(
diff
->
mod_qpŞ
, 
u
, &
Çme
) < 0) {

788 ià((
dup_Çme
 = 
	`¡rdup
(
Çme
)è=ğ
NULL
 || 
	`­Ş_veùÜ_­³nd
(
’Œy
->
mod_ty³s
, (*)dup_name) < 0) {

789 
	`ä“
(
dup_Çme
);

793 
	}
}

795 
	$ty³_m­_šãr
(
pŞdiff_t
 * 
diff
)

797 
­Ş_veùÜ_t
 *
ov
 = 
NULL
, *
mv
 = NULL;

798 *
Üig_dÚe
 = 
NULL
, *
mod_dÚe
 = NULL;

799 
size_t
 
num_Üig
, 
num_mod
, 
i
, 
j
;

800 
qpŞ_ty³_t
 *
t
, *
u
;

801 
ty³_m­_comp
 
c
 = { 
diff
, 0 };

802 
pŞdiff_ty³_»m­_’Œy_t
 *
’Œy
 = 
NULL
;

803 
»tv®
 = -1, 
”rÜ
 = 0;

805 
	`INFO
(
diff
, "%s", "Inferringype„emap.");

806 ià(
	`­Ş_ty³_g‘_by_qu”y
(
diff
->
Üig_pŞ
, 
NULL
, &
ov
è< 0 ||‡pŞ_ty³_g‘_by_qu”y(diff->
mod_pŞ
, NULL, &
mv
) < 0) {

807 
”rÜ
 = 
”ºo
;

808 
ş—nup
;

810 
num_Üig
 = 
	`­Ş_veùÜ_g‘_size
(
ov
);

811 
num_mod
 = 
	`­Ş_veùÜ_g‘_size
(
mv
);

812 ià((
Üig_dÚe
 = 
	`ÿÎoc
(1, 
num_Üig
)è=ğ
NULL
 || (
mod_dÚe
 = c®loc(1, 
num_mod
)) == NULL) {

813 
”rÜ
 = 
”ºo
;

814 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

815 
ş—nup
;

819 
c
.
dœ
 = 
POLDIFF_POLICY_MOD
;

820 
i
 = 0; i < 
num_Üig
; i++) {

821 
t
 = (
qpŞ_ty³_t
 *è
	`­Ş_veùÜ_g‘_–em’t
(
ov
, 
i
);

822 ià(
	`­Ş_veùÜ_g‘_šdex
(
mv
, 
t
, 
ty³_m­_´im¬y_comp
, &
c
, &
j
) < 0) {

825 
	`as£¹
(!
mod_dÚe
[
j
]);

826 
u
 = (
qpŞ_ty³_t
 *è
	`­Ş_veùÜ_g‘_–em’t
(
mv
, 
j
);

827 ià((
’Œy
 = 
	`pŞdiff_ty³_»m­_’Œy_ü—‹
(
diff
)è=ğ
NULL
 || 
	`ty³_m­_’Œy_­³nd_qty³s
(diff,ƒÁry, 
t
, 
u
) < 0) {

828 
”rÜ
 = 
”ºo
;

829 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

830 
ş—nup
;

832 
’Œy
->
šã¼ed
 = 1;

833 
Üig_dÚe
[
i
] = 1;

834 
mod_dÚe
[
j
] = 1;

838 
c
.
dœ
 = 
POLDIFF_POLICY_MOD
;

839 
i
 = 0; i < 
num_Üig
; i++) {

840 ià(
Üig_dÚe
[
i
]) {

843 
t
 = (
qpŞ_ty³_t
 *è
	`­Ş_veùÜ_g‘_–em’t
(
ov
, 
i
);

844 
u
 = 
NULL
;

845 
j
 = 0; j < 
num_mod
; j++) {

846 ià(
mod_dÚe
[
j
]) {

849 
u
 = (
qpŞ_ty³_t
 *è
	`­Ş_veùÜ_g‘_–em’t
(
mv
, 
j
);

850 ià(
	`ty³_m­_´im_®Ÿs_comp
(
u
, 
t
, &
c
) == 0) {

854 ià(
j
 >ğ
num_mod
) {

857 ià((
’Œy
 = 
	`pŞdiff_ty³_»m­_’Œy_ü—‹
(
diff
)è=ğ
NULL
 || 
	`ty³_m­_’Œy_­³nd_qty³s
(diff,ƒÁry, 
t
, 
u
) < 0) {

858 
”rÜ
 = 
”ºo
;

859 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

860 
ş—nup
;

862 
’Œy
->
šã¼ed
 = 1;

863 
Üig_dÚe
[
i
] = 1;

864 
mod_dÚe
[
j
] = 1;

868 
c
.
dœ
 = 
POLDIFF_POLICY_ORIG
;

869 
j
 = 0; j < 
num_mod
; j++) {

870 ià(
mod_dÚe
[
j
]) {

873 
u
 = (
qpŞ_ty³_t
 *è
	`­Ş_veùÜ_g‘_–em’t
(
mv
, 
j
);

874 
t
 = 
NULL
;

875 
i
 = 0; i < 
num_Üig
; i++) {

876 ià(
Üig_dÚe
[
i
]) {

879 
t
 = (
qpŞ_ty³_t
 *è
	`­Ş_veùÜ_g‘_–em’t
(
ov
, 
i
);

880 ià(
	`ty³_m­_´im_®Ÿs_comp
(
t
, 
u
, &
c
) == 0) {

884 ià(
i
 >ğ
num_Üig
) {

887 ià((
’Œy
 = 
	`pŞdiff_ty³_»m­_’Œy_ü—‹
(
diff
)è=ğ
NULL
 || 
	`ty³_m­_’Œy_­³nd_qty³s
(diff,ƒÁry, 
t
, 
u
) < 0) {

888 
”rÜ
 = 
”ºo
;

889 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

890 
ş—nup
;

892 
’Œy
->
šã¼ed
 = 1;

893 
Üig_dÚe
[
i
] = 1;

894 
mod_dÚe
[
j
] = 1;

898 
c
.
dœ
 = 
POLDIFF_POLICY_MOD
;

899 
i
 = 0; i < 
num_Üig
; i++) {

900 ià(
Üig_dÚe
[
i
]) {

903 
t
 = (
qpŞ_ty³_t
 *è
	`­Ş_veùÜ_g‘_–em’t
(
ov
, 
i
);

904 
u
 = 
NULL
;

905 
j
 = 0; j < 
num_mod
; j++) {

906 ià(
mod_dÚe
[
j
]) {

909 
u
 = (
qpŞ_ty³_t
 *è
	`­Ş_veùÜ_g‘_–em’t
(
mv
, 
j
);

910 ià(
	`ty³_m­_´im_®Ÿ£s_comp
(
u
, 
t
, &
c
) == 0) {

914 ià(
j
 >ğ
num_mod
) {

917 ià((
’Œy
 = 
	`pŞdiff_ty³_»m­_’Œy_ü—‹
(
diff
)è=ğ
NULL
 || 
	`ty³_m­_’Œy_­³nd_qty³s
(diff,ƒÁry, 
t
, 
u
) < 0) {

918 
”rÜ
 = 
”ºo
;

919 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

920 
ş—nup
;

922 
’Œy
->
šã¼ed
 = 1;

923 
Üig_dÚe
[
i
] = 1;

924 
mod_dÚe
[
j
] = 1;

927 
	`ty³_»m­_veùÜ_dump
(
diff
);

929 
»tv®
 = 0;

930 
diff
->
»m­³d
 = 1;

931 
ş—nup
:

932 
	`­Ş_veùÜ_de¡roy
(&
ov
);

933 
	`­Ş_veùÜ_de¡roy
(&
mv
);

934 
	`ä“
(
Üig_dÚe
);

935 
	`ä“
(
mod_dÚe
);

936 
”ºo
 = 
”rÜ
;

937  
»tv®
;

938 
	}
}

940 
ušt32_t
 
	$ty³_m­_lookup
(cÚ¡ 
pŞdiff_t
 * 
diff
, cÚ¡ 
qpŞ_ty³_t
 * 
ty³
, 
which_pŞ
)

942 
ušt32_t
 
v®
;

943 ià(
which_pŞ
 =ğ
POLDIFF_POLICY_ORIG
) {

944 ià(
	`qpŞ_ty³_g‘_v®ue
(
diff
->
Üig_qpŞ
, 
ty³
, &
v®
) < 0) {

947 
	`as£¹
(
v®
 <ğ
diff
->
ty³_m­
->
num_Üig_ty³s
);

948 
	`as£¹
(
diff
->
ty³_m­
->
Üig_to_p£udo
[
v®
 - 1] != 0);

949  
diff
->
ty³_m­
->
Üig_to_p£udo
[
v®
 - 1];

951 ià(
	`qpŞ_ty³_g‘_v®ue
(
diff
->
mod_qpŞ
, 
ty³
, &
v®
) < 0) {

954 
	`as£¹
(
v®
 <ğ
diff
->
ty³_m­
->
num_mod_ty³s
);

955 
	`as£¹
(
diff
->
ty³_m­
->
mod_to_p£udo
[
v®
 - 1] != 0);

956  
diff
->
ty³_m­
->
mod_to_p£udo
[
v®
 - 1];

958 
	}
}

960 cÚ¡ 
­Ş_veùÜ_t
 *
	$ty³_m­_lookup_»v”£
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
ušt32_t
 
v®
, 
which_pŞ
)

962 ià(
which_pŞ
 =ğ
POLDIFF_POLICY_ORIG
) {

963  
	`­Ş_veùÜ_g‘_–em’t
(
diff
->
ty³_m­
->
p£udo_to_Üig
, 
v®
 - 1);

965  
	`­Ş_veùÜ_g‘_–em’t
(
diff
->
ty³_m­
->
p£udo_to_mod
, 
v®
 - 1);

967 
	}
}

969 cÚ¡ *
	$ty³_m­_g‘_Çme
(cÚ¡ 
pŞdiff_t
 * 
diff
, cÚ¡ 
ušt32_t
 
p£udo_v®
, 
pŞ
)

971 cÚ¡ 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

972 cÚ¡ *
Çme
 = 
NULL
;

973 cÚ¡ 
qpŞ_ty³_t
 *
t
;

975 
v
 = 
	`ty³_m­_lookup_»v”£
(
diff
, 
p£udo_v®
, 
pŞ
);

976 ià(
	`­Ş_veùÜ_g‘_size
(
v
) == 0) {

977  
NULL
;

979 
t
 = 
	`­Ş_veùÜ_g‘_–em’t
(
v
, 0);

980 ià(
pŞ
 =ğ
POLDIFF_POLICY_ORIG
)

981 
	`qpŞ_ty³_g‘_Çme
(
diff
->
Üig_qpŞ
, 
t
, &
Çme
);

983 
	`qpŞ_ty³_g‘_Çme
(
diff
->
mod_qpŞ
, 
t
, &
Çme
);

984  
Çme
;

985 
	}
}

	@libpoldiff/src/type_map_internal.h

26 #iâdeà
POLDIFF_TYPE_MAP_INTERNAL_H


27 
	#POLDIFF_TYPE_MAP_INTERNAL_H


	)

29 #ifdef 
__ılu¥lus


34 
	~<­Ş/veùÜ.h
>

35 
	~<qpŞ/pŞicy.h
>

37 
ty³_m­
 
	tty³_m­_t
;

39 
	#POLDIFF_POLICY_ORIG
 1

	)

40 
	#POLDIFF_POLICY_MOD
 2

	)

49 
ty³_m­_t
 *
ty³_m­_ü—‹
();

57 
ty³_m­_de¡roy
(
ty³_m­_t
 ** 
m­
);

70 
ty³_m­_bud
(
pŞdiff_t
 * 
diff
);

79 
pŞdiff_ty³_»m­_æush
(
pŞdiff_t
 * 
diff
);

117 
ty³_m­_šãr
(
pŞdiff_t
 * 
diff
);

132 
ušt32_t
 
ty³_m­_lookup
(cÚ¡ 
pŞdiff_t
 * 
diff
, cÚ¡ 
qpŞ_ty³_t
 * 
ty³
, 
which_pŞ
);

150 cÚ¡ 
­Ş_veùÜ_t
 *
ty³_m­_lookup_»v”£
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
ušt32_t
 
v®
, 
which_pŞ
);

165 cÚ¡ *
ty³_m­_g‘_Çme
(cÚ¡ 
pŞdiff_t
 * 
diff
, cÚ¡ 
ušt32_t
 
p£udo_v®
, 
pŞ
);

167 #ifdef 
__ılu¥lus


	@libpoldiff/src/user_diff.c

25 
	~<cÚfig.h
>

27 
	~"pŞdiff_š‹º®.h
"

29 
	~<­Ş/ut.h
>

30 
	~<as£¹.h
>

31 
	~<”ºo.h
>

32 
	~<¡dio.h
>

33 
	~<¡ršg.h
>

35 
	spŞdiff_u£r_summ¬y


37 
size_t
 
	mnum_added
;

38 
size_t
 
	mnum_»moved
;

39 
size_t
 
	mnum_modif›d
;

40 
­Ş_veùÜ_t
 *
	mdiffs
;

43 
	spŞdiff_u£r


45 *
	mÇme
;

46 
pŞdiff_fÜm_e
 
	mfÜm
;

48 
­Ş_veùÜ_t
 *
	munmodif›d_rŞes
;

49 
­Ş_veùÜ_t
 *
	madded_rŞes
;

50 
­Ş_veùÜ_t
 *
	m»moved_rŞes
;

52 
pŞdiff_Ëv–_t
 *
	mÜig_deçuÉ_Ëv–
;

56 
pŞdiff_Ëv–_t
 *
	mmod_deçuÉ_Ëv–
;

58 
pŞdiff_¿nge_t
 *
	m¿nge
;

61 
	$pŞdiff_u£r_g‘_¡©s
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
size_t
 
¡©s
[5])

63 ià(
diff
 =ğ
NULL
 || 
¡©s
 == NULL) {

64 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
EINVAL
));

65 
”ºo
 = 
EINVAL
;

68 
¡©s
[0] = 
diff
->
u£r_diffs
->
num_added
;

69 
¡©s
[1] = 
diff
->
u£r_diffs
->
num_»moved
;

70 
¡©s
[2] = 
diff
->
u£r_diffs
->
num_modif›d
;

71 
¡©s
[3] = 0;

72 
¡©s
[4] = 0;

73 
	}
}

78 *
	$u£r_to_modif›d_¡ršg
(cÚ¡ 
pŞdiff_t
 * 
diff
, cÚ¡ 
pŞdiff_u£r_t
 * 
u
)

80 
size_t
 
Ën
 = 0, 
i
;

81 *
s
 = 
NULL
, *
t
 = NULL, *
rŞe
, *
¿nge
 = NULL;

82 
size_t
 
num_added_rŞes
 = 
	`­Ş_veùÜ_g‘_size
(
u
->
added_rŞes
);

83 
size_t
 
num_»moved_rŞes
 = 
	`­Ş_veùÜ_g‘_size
(
u
->
»moved_rŞes
);

84 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "* %s\n", 
u
->
Çme
) < 0) {

85 
”r
;

87 ià(
num_added_rŞes
 > 0 || 
num_»moved_rŞes
 > 0) {

88 ià(
	`­Ş_¡r_­³nd
(&
s
, &
Ën
, "„oles {") < 0) {

89 
”r
;

91 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
u
->
unmodif›d_rŞes
); i++) {

92 
rŞe
 = (*)
	`­Ş_veùÜ_g‘_–em’t
(
u
->
unmodif›d_rŞes
, 
i
);

93 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, " %s", 
rŞe
) < 0) {

94 
”r
;

97 
i
 = 0; i < 
num_added_rŞes
; i++) {

98 
rŞe
 = (*)
	`­Ş_veùÜ_g‘_–em’t
(
u
->
added_rŞes
, 
i
);

99 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, " +%s", 
rŞe
) < 0) {

100 
”r
;

103 
i
 = 0; i < 
num_»moved_rŞes
; i++) {

104 
rŞe
 = (*)
	`­Ş_veùÜ_g‘_–em’t
(
u
->
»moved_rŞes
, 
i
);

105 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, " -%s", 
rŞe
) < 0) {

106 
”r
;

109 ià(
	`­Ş_¡r_­³nd
(&
s
, &
Ën
, " }\n") < 0) {

110 
”r
;

113 ià((
u
->
mod_deçuÉ_Ëv–
 !ğ
NULL
 || u->
Üig_deçuÉ_Ëv–
 !ğNULLè&& 
	`­Ş_¡r_­³nd
(&
s
, &
Ën
, "†evel:\n") < 0) {

114 
”r
;

116 ià(
u
->
mod_deçuÉ_Ëv–
 !ğ
NULL
) {

117 ià((
t
 = 
	`pŞdiff_Ëv–_to_¡ršg_br›f
(
diff
, 
u
->
mod_deçuÉ_Ëv–
)è=ğ
NULL
) {

118 
”r
;

120 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, " %s", 
t
) < 0) {

121 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”ºo
));

122 
”r
;

124 
	`ä“
(
t
);

125 
t
 = 
NULL
;

127 ià(
u
->
Üig_deçuÉ_Ëv–
 !ğ
NULL
) {

128 ià((
t
 = 
	`pŞdiff_Ëv–_to_¡ršg_br›f
(
diff
, 
u
->
Üig_deçuÉ_Ëv–
)è=ğ
NULL
) {

129 
”r
;

131 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, " %s", 
t
) < 0) {

132 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”ºo
));

133 
”r
;

135 
	`ä“
(
t
);

136 
t
 = 
NULL
;

138 ià(
u
->
¿nge
 !ğ
NULL
) {

139 ià((
¿nge
 = 
	`pŞdiff_¿nge_to_¡ršg_br›f
(
diff
, 
u
->¿nge)è=ğ
NULL


140 || (
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "%s", 
¿nge
) < 0)) {

141 
	`ä“
(
¿nge
);

142 
”r
;

144 
	`ä“
(
¿nge
);

146  
s
;

147 
”r
:

148 
	`ä“
(
s
);

149 
	`ä“
(
t
);

150  
NULL
;

151 
	}
}

153 *
	$pŞdiff_u£r_to_¡ršg
(cÚ¡ 
pŞdiff_t
 * 
diff
, cÚ¡ *
u£r
)

155 
pŞdiff_u£r_t
 *
u
 = (pŞdiff_u£r_ˆ*è
u£r
;

156 
size_t
 
Ën
 = 0;

157 *
s
 = 
NULL
;

158 ià(
diff
 =ğ
NULL
 || 
u£r
 == NULL) {

159 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
EINVAL
));

160 
”ºo
 = 
EINVAL
;

161  
NULL
;

163 
u
->
fÜm
) {

164 
POLDIFF_FORM_ADDED
:

166 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "+ %s", 
u
->
Çme
) < 0) {

169  
s
;

171 
POLDIFF_FORM_REMOVED
:

173 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "- %s", 
u
->
Çme
) < 0) {

176  
s
;

178 
POLDIFF_FORM_MODIFIED
:

180 ià((
s
 = 
	`u£r_to_modif›d_¡ršg
(
diff
, 
u
)è=ğ
NULL
) {

181 
”r
;

183  
s
;

187 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
ENOTSUP
));

188 
”ºo
 = 
ENOTSUP
;

189  
NULL
;

192 
”r
:

194 
	`ä“
(
s
);

195 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

196 
”ºo
 = 
ENOMEM
;

197  
NULL
;

198 
	}
}

200 cÚ¡ 
­Ş_veùÜ_t
 *
	$pŞdiff_g‘_u£r_veùÜ
(cÚ¡ 
pŞdiff_t
 * 
diff
)

202 ià(
diff
 =ğ
NULL
) {

203 
”ºo
 = 
EINVAL
;

204  
NULL
;

206  
diff
->
u£r_diffs
->
diffs
;

207 
	}
}

209 cÚ¡ *
	$pŞdiff_u£r_g‘_Çme
(cÚ¡ 
pŞdiff_u£r_t
 * 
u£r
)

211 ià(
u£r
 =ğ
NULL
) {

212 
”ºo
 = 
EINVAL
;

213  
NULL
;

215  
u£r
->
Çme
;

216 
	}
}

218 
pŞdiff_fÜm_e
 
	$pŞdiff_u£r_g‘_fÜm
(cÚ¡ *
u£r
)

220 ià(
u£r
 =ğ
NULL
) {

221 
”ºo
 = 
EINVAL
;

224  ((cÚ¡ 
pŞdiff_u£r_t
 *)
u£r
)->
fÜm
;

225 
	}
}

227 cÚ¡ 
­Ş_veùÜ_t
 *
	$pŞdiff_u£r_g‘_unmodif›d_rŞes
(cÚ¡ 
pŞdiff_u£r_t
 * 
u£r
)

229 ià(
u£r
 =ğ
NULL
) {

230 
”ºo
 = 
EINVAL
;

231  
NULL
;

233  
u£r
->
unmodif›d_rŞes
;

234 
	}
}

236 cÚ¡ 
­Ş_veùÜ_t
 *
	$pŞdiff_u£r_g‘_added_rŞes
(cÚ¡ 
pŞdiff_u£r_t
 * 
u£r
)

238 ià(
u£r
 =ğ
NULL
) {

239 
”ºo
 = 
EINVAL
;

240  
NULL
;

242  
u£r
->
added_rŞes
;

243 
	}
}

245 cÚ¡ 
­Ş_veùÜ_t
 *
	$pŞdiff_u£r_g‘_»moved_rŞes
(cÚ¡ 
pŞdiff_u£r_t
 * 
u£r
)

247 ià(
u£r
 =ğ
NULL
) {

248 
”ºo
 = 
EINVAL
;

249  
NULL
;

251  
u£r
->
»moved_rŞes
;

252 
	}
}

254 cÚ¡ 
pŞdiff_Ëv–_t
 *
	$pŞdiff_u£r_g‘_Üigš®_dæev–
(cÚ¡ 
pŞdiff_u£r_t
 * 
u£r
)

256 ià(
u£r
 =ğ
NULL
) {

257 
”ºo
 = 
EINVAL
;

258  
NULL
;

260  
u£r
->
Üig_deçuÉ_Ëv–
;

261 
	}
}

263 cÚ¡ 
pŞdiff_Ëv–_t
 *
	$pŞdiff_u£r_g‘_modif›d_dæev–
(cÚ¡ 
pŞdiff_u£r_t
 * 
u£r
)

265 ià(
u£r
 =ğ
NULL
) {

266 
”ºo
 = 
EINVAL
;

267  
NULL
;

269  
u£r
->
mod_deçuÉ_Ëv–
;

270 
	}
}

272 cÚ¡ 
pŞdiff_¿nge_t
 *
	$pŞdiff_u£r_g‘_¿nge
(cÚ¡ 
pŞdiff_u£r_t
 * 
u£r
)

274 ià(
u£r
 =ğ
NULL
) {

275 
”ºo
 = 
EINVAL
;

276  
NULL
;

278  
u£r
->
¿nge
;

279 
	}
}

283 
	$u£r_ä“
(*
–em
)

285 ià(
–em
 !ğ
NULL
) {

286 
pŞdiff_u£r_t
 *
u
 = (pŞdiff_u£r_ˆ*è
–em
;

287 
	`ä“
(
u
->
Çme
);

288 
	`­Ş_veùÜ_de¡roy
(&
u
->
added_rŞes
);

289 
	`­Ş_veùÜ_de¡roy
(&
u
->
»moved_rŞes
);

290 
	`­Ş_veùÜ_de¡roy
(&
u
->
unmodif›d_rŞes
);

291 
	`Ëv–_ä“
(
u
->
Üig_deçuÉ_Ëv–
);

292 
	`Ëv–_ä“
(
u
->
mod_deçuÉ_Ëv–
);

293 
	`¿nge_de¡roy
(&
u
->
¿nge
);

294 
	`ä“
(
u
);

296 
	}
}

298 
pŞdiff_u£r_summ¬y_t
 *
	$u£r_ü—‹
()

300 
pŞdiff_u£r_summ¬y_t
 *
us
 = 
	`ÿÎoc
(1, (*us));

301 ià(
us
 =ğ
NULL
) {

302  
NULL
;

304 ià((
us
->
diffs
 = 
	`­Ş_veùÜ_ü—‹
(
u£r_ä“
)è=ğ
NULL
) {

305 
	`u£r_de¡roy
(&
us
);

306  
NULL
;

308  
us
;

309 
	}
}

311 
	$u£r_de¡roy
(
pŞdiff_u£r_summ¬y_t
 ** 
us
)

313 ià(
us
 !ğ
NULL
 && *us != NULL) {

314 
	`­Ş_veùÜ_de¡roy
(&(*
us
)->
diffs
);

315 
	`ä“
(*
us
);

316 *
us
 = 
NULL
;

318 
	}
}

320 
	$u£r_»£t
(
pŞdiff_t
 * 
diff
)

322 
”rÜ
 = 0;

324 ià(
diff
 =ğ
NULL
) {

325 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
EINVAL
));

326 
”ºo
 = 
EINVAL
;

330 
	`u£r_de¡roy
(&
diff
->
u£r_diffs
);

331 
diff
->
u£r_diffs
 = 
	`u£r_ü—‹
();

332 ià(
diff
->
u£r_diffs
 =ğ
NULL
) {

333 
”rÜ
 = 
”ºo
;

334 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

335 
”ºo
 = 
”rÜ
;

340 
	}
}

345 
	$u£r_Çme_comp
(cÚ¡ *
x
, cÚ¡ *
y
, *
¬g
)

347 cÚ¡ 
qpŞ_u£r_t
 *
u1
 = 
x
;

348 cÚ¡ 
qpŞ_u£r_t
 *
u2
 = 
y
;

349 
­Ş_pŞicy_t
 *
p
 = (­Ş_pŞicy_ˆ*è
¬g
;

350 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
p
);

351 cÚ¡ *
Çme1
, *
Çme2
;

352 ià(
	`qpŞ_u£r_g‘_Çme
(
q
, 
u1
, &
Çme1
è< 0 || qpŞ_u£r_g‘_Çme(q, 
u2
, &
Çme2
) < 0) {

355  
	`¡rcmp
(
Çme1
, 
Çme2
);

356 
	}
}

358 
­Ş_veùÜ_t
 *
	$u£r_g‘_™ems
(
pŞdiff_t
 * 
diff
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
)

360 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

361 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

362 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicy
);

363 
”rÜ
 = 0;

364 ià(
	`qpŞ_pŞicy_g‘_u£r_™”
(
q
, &
™”
) < 0) {

365  
NULL
;

367 
v
 = 
	`­Ş_veùÜ_ü—‹_äom_™”
(
™”
, 
NULL
);

368 ià(
v
 =ğ
NULL
) {

369 
”rÜ
 = 
”ºo
;

370 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

371 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

372 
”ºo
 = 
”rÜ
;

373  
NULL
;

375 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

376 
	`­Ş_veùÜ_sÜt
(
v
, 
u£r_Çme_comp
, (*)
pŞicy
);

377  
v
;

378 
	}
}

380 
	$u£r_comp
(cÚ¡ *
x
, cÚ¡ *
y
, cÚ¡ 
pŞdiff_t
 * 
diff
)

382 cÚ¡ 
qpŞ_u£r_t
 *
u1
 = 
x
;

383 cÚ¡ 
qpŞ_u£r_t
 *
u2
 = 
y
;

384 cÚ¡ *
Çme1
, *
Çme2
;

385 ià(
	`qpŞ_u£r_g‘_Çme
(
diff
->
Üig_qpŞ
, 
u1
, &
Çme1
è< 0 || qpŞ_u£r_g‘_Çme(diff->
mod_qpŞ
, 
u2
, &
Çme2
) < 0) {

388  
	`¡rcmp
(
Çme1
, 
Çme2
);

389 
	}
}

402 
pŞdiff_u£r_t
 *
	$make_diff
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
pŞdiff_fÜm_e
 
fÜm
, cÚ¡ *
Çme
)

404 
pŞdiff_u£r_t
 *
pu
;

405 
”rÜ
;

406 ià((
pu
 = 
	`ÿÎoc
(1, (*pu))è=ğ
NULL
 ||

407 (
pu
->
Çme
 = 
	`¡rdup
Òame)è=ğ
NULL
 ||

408 (
pu
->
added_rŞes
 = 
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(1, 
ä“
)è=ğ
NULL
 ||

409 (
pu
->
»moved_rŞes
 = 
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(1, 
ä“
)è=ğ
NULL
 ||

410 (
pu
->
unmodif›d_rŞes
 = 
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(1, 
ä“
)è=ğ
NULL
) {

411 
”rÜ
 = 
”ºo
;

412 
	`u£r_ä“
(
pu
);

413 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

414 
”ºo
 = 
”rÜ
;

415  
NULL
;

417 
pu
->
fÜm
 = form;

418  
pu
;

419 
	}
}

433 
­Ş_veùÜ_t
 *
	$u£r_g‘_rŞes
(cÚ¡ 
pŞdiff_t
 * 
diff
, cÚ¡ 
­Ş_pŞicy_t
 * 
p
, cÚ¡ 
qpŞ_u£r_t
 * 
u£r
)

435 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

436 cÚ¡ 
qpŞ_rŞe_t
 *
rŞe
;

437 cÚ¡ *
rŞe_Çme
;

438 *
rŞe_Çme2
;

439 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

440 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
p
);

441 
»tv®
 = -1, 
”rÜ
 = 0;

443 ià((
v
 = 
	`­Ş_veùÜ_ü—‹
(
ä“
)è=ğ
NULL
) {

444 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”ºo
));

445 
ş—nup
;

447 ià(
	`qpŞ_u£r_g‘_rŞe_™”
(
q
, 
u£r
, &
™”
) < 0) {

448 
ş—nup
;

450 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

451 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
rŞe
è< 0 || 
	`qpŞ_rŞe_g‘_Çme
(
q
,„Şe, &
rŞe_Çme
)) {

452 
”rÜ
 = 
”ºo
;

453 
ş—nup
;

455 ià((
rŞe_Çme2
 = 
	`¡rdup
(
rŞe_Çme
)è=ğ
NULL
 || 
	`­Ş_veùÜ_­³nd
(
v
, (*)role_name2) < 0) {

456 
”rÜ
 = 
”ºo
;

457 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

458 
	`ä“
(
rŞe_Çme2
);

459 
ş—nup
;

463 
»tv®
 = 0;

464 
ş—nup
:

465 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

466 ià(
»tv®
 < 0) {

467 
	`­Ş_veùÜ_de¡roy
(&
v
);

468 
”ºo
 = 
”rÜ
;

469  
NULL
;

471  
v
;

472 
	}
}

489 
	$u£r_d“p_diff_deçuÉ_Ëv–s
(
pŞdiff_t
 * 
diff
, cÚ¡ 
qpŞ_u£r_t
 * 
u1
, cÚ¡ qpŞ_u£r_ˆ* 
u2
, 
pŞdiff_u£r_t
 * 
u
)

491 cÚ¡ 
qpŞ_mls_Ëv–_t
 *
ql1
 = 
NULL
, *
ql2
 = NULL;

492 
pŞdiff_Ëv–_t
 *
¶
 = 
NULL
;

493 
­Ş_mls_Ëv–_t
 *
l1
 = 
NULL
, *
l2
 = NULL;

494 
»tv®
 = -1;

495 ià(
u1
 !ğ
NULL
 && 
	`qpŞ_u£r_g‘_dæev–
(
diff
->
Üig_qpŞ
, u1, &
ql1
) < 0) {

498 ià(
u2
 !ğ
NULL
 && 
	`qpŞ_u£r_g‘_dæev–
(
diff
->
mod_qpŞ
, u2, &
ql2
) < 0) {

501 ià(
ql1
 =ğ
NULL
 && 
ql2
 == NULL) {

505 ià(
ql1
 =ğ
NULL
) {

506 ià((
l2
 = 
	`­Ş_mls_Ëv–_ü—‹_äom_qpŞ_mls_Ëv–
(
diff
->
mod_pŞ
, 
ql2
)è=ğ
NULL
 ||

507 (
¶
 = 
	`Ëv–_ü—‹_äom_­Ş_mls_Ëv–
(
l2
, 
POLDIFF_FORM_ADDED
)è=ğ
NULL
) {

508 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”ºo
));

509 
ş—nup
;

511 
u
->
mod_deçuÉ_Ëv–
 = 
¶
;

512 
»tv®
 = 1;

513 } ià(
ql2
 =ğ
NULL
) {

514 ià((
l1
 = 
	`­Ş_mls_Ëv–_ü—‹_äom_qpŞ_mls_Ëv–
(
diff
->
Üig_pŞ
, 
ql1
)è=ğ
NULL
 ||

515 (
¶
 = 
	`Ëv–_ü—‹_äom_­Ş_mls_Ëv–
(
l1
, 
POLDIFF_FORM_REMOVED
)è=ğ
NULL
) {

516 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”ºo
));

517 
ş—nup
;

519 
u
->
Üig_deçuÉ_Ëv–
 = 
¶
;

520 
»tv®
 = 1;

522 ià((
l1
 = 
	`­Ş_mls_Ëv–_ü—‹_äom_qpŞ_mls_Ëv–
(
diff
->
Üig_pŞ
, 
ql1
)è=ğ
NULL
 ||

523 (
l2
 = 
	`­Ş_mls_Ëv–_ü—‹_äom_qpŞ_mls_Ëv–
(
diff
->
mod_pŞ
, 
ql2
)è=ğ
NULL
) {

524 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”ºo
));

525 
ş—nup
;

527 ià(
	`Ëv–_d“p_diff_­Ş_mls_Ëv–s
(
diff
, 
l1
, 
l2
, &
u
->
Üig_deçuÉ_Ëv–
, &u->
mod_deçuÉ_Ëv–
) < 0) {

528 
ş—nup
;

530 ià(
u
->
Üig_deçuÉ_Ëv–
 !ğ
NULL
) {

531 
»tv®
 = 1;

534 ià(
»tv®
 == -1) {

536 
»tv®
 = 0;

538 
ş—nup
:

539 
	`­Ş_mls_Ëv–_de¡roy
(&
l1
);

540 
	`­Ş_mls_Ëv–_de¡roy
(&
l2
);

541 ià(
»tv®
 < 0) {

542 
	`Ëv–_ä“
(
¶
);

544  
»tv®
;

545 
	}
}

561 
	$u£r_d“p_diff_¿nges
(
pŞdiff_t
 * 
diff
, cÚ¡ 
qpŞ_u£r_t
 * 
u1
, cÚ¡ qpŞ_u£r_ˆ* 
u2
, 
pŞdiff_u£r_t
 * 
u
)

563 cÚ¡ 
qpŞ_mls_¿nge_t
 *
r1
 = 
NULL
, *
r2
 = NULL;

564 
pŞdiff_¿nge_t
 *
´
 = 
NULL
;

565 
»tv®
 = -1;

566 ià(
u1
 !ğ
NULL
 && 
	`qpŞ_u£r_g‘_¿nge
(
diff
->
Üig_qpŞ
, u1, &
r1
) < 0) {

569 ià(
u2
 !ğ
NULL
 && 
	`qpŞ_u£r_g‘_¿nge
(
diff
->
mod_qpŞ
, u2, &
r2
) < 0) {

572 ià(
r1
 =ğ
NULL
 && 
r2
 == NULL) {

576 ià(
r1
 =ğ
NULL
) {

577 ià((
´
 = 
	`¿nge_ü—‹
(
diff
, 
r1
, 
r2
, 
POLDIFF_FORM_ADDED
)è=ğ
NULL
) {

578 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”ºo
));

579 
ş—nup
;

581 
u
->
¿nge
 = 
´
;

582 
´
 = 
NULL
;

583 
»tv®
 = 1;

584 } ià(
r2
 =ğ
NULL
) {

585 ià((
´
 = 
	`¿nge_ü—‹
(
diff
, 
r1
, 
r2
, 
POLDIFF_FORM_REMOVED
)è=ğ
NULL
) {

586 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”ºo
));

587 
ş—nup
;

589 
u
->
¿nge
 = 
´
;

590 
´
 = 
NULL
;

591 
»tv®
 = 1;

593 ià((
´
 = 
	`¿nge_ü—‹
(
diff
, 
r1
, 
r2
, 
POLDIFF_FORM_MODIFIED
)è=ğ
NULL
) {

594 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”ºo
));

595 
ş—nup
;

597 ià((
»tv®
 = 
	`¿nge_d“p_diff
(
diff
, 
´
)) < 0) {

598 
ş—nup
;

600 ià(
»tv®
 > 0) {

601 
u
->
¿nge
 = 
´
;

602 
´
 = 
NULL
;

605 
ş—nup
:

606 
	`¿nge_de¡roy
(&
´
);

607  
»tv®
;

608 
	}
}

610 
	$u£r_Ãw_diff
(
pŞdiff_t
 * 
diff
, 
pŞdiff_fÜm_e
 
fÜm
, cÚ¡ *
™em
)

612 cÚ¡ 
qpŞ_u£r_t
 *
u
 = 
™em
;

613 cÚ¡ *
Çme
 = 
NULL
;

614 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

615 
pŞdiff_u£r_t
 *
pu
 = 
NULL
;

616 
”rÜ
 = 0, 
»tv®
 = -1;

617 ià((
fÜm
 =ğ
POLDIFF_FORM_ADDED
 &&

618 
	`qpŞ_u£r_g‘_Çme
(
diff
->
mod_qpŞ
, 
u
, &
Çme
) < 0) ||

619 ((
fÜm
 =ğ
POLDIFF_FORM_REMOVED
 || fÜm =ğ
POLDIFF_FORM_MODIFIED
è&& 
	`qpŞ_u£r_g‘_Çme
(
diff
->
Üig_qpŞ
, 
u
, &
Çme
) < 0))

621 
”rÜ
 = 
”ºo
;

622 
ş—nup
;

624 ià((
pu
 = 
	`make_diff
(
diff
, 
fÜm
, 
Çme
)è=ğ
NULL
) {

625 
”rÜ
 = 
”ºo
;

626 
ş—nup
;

628 ià(
fÜm
 =ğ
POLDIFF_FORM_ADDED
) {

629 
	`­Ş_veùÜ_de¡roy
(&
pu
->
added_rŞes
);

630 ià((
v
 = 
	`u£r_g‘_rŞes
(
diff
, diff->
mod_pŞ
, 
u
)è=ğ
NULL
 ||

631 (
pu
->
added_rŞes
 = 
	`­Ş_veùÜ_ü—‹_äom_veùÜ
(
v
, 
­Ş_¡r_¡rdup
, 
NULL
, 
ä“
)) == NULL ||

632 
	`u£r_d“p_diff_deçuÉ_Ëv–s
(
diff
, 
NULL
, 
u
, 
pu
è< 0 || 
	`u£r_d“p_diff_¿nges
(diff, NULL, u,…u) < 0) {

633 
”rÜ
 = 
”ºo
;

634 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

635 
ş—nup
;

638 
	`­Ş_veùÜ_de¡roy
(&
pu
->
»moved_rŞes
);

639 ià((
v
 = 
	`u£r_g‘_rŞes
(
diff
, diff->
Üig_pŞ
, 
u
)è=ğ
NULL
 ||

640 (
pu
->
»moved_rŞes
 = 
	`­Ş_veùÜ_ü—‹_äom_veùÜ
(
v
, 
­Ş_¡r_¡rdup
, 
NULL
, 
ä“
)) == NULL ||

641 
	`u£r_d“p_diff_deçuÉ_Ëv–s
(
diff
, 
u
, 
NULL
, 
pu
è< 0 || 
	`u£r_d“p_diff_¿nges
(diff, u, NULL,…u) < 0) {

642 
”rÜ
 = 
”ºo
;

643 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

644 
ş—nup
;

647 ià(
	`­Ş_veùÜ_­³nd
(
diff
->
u£r_diffs
->
diffs
, 
pu
) < 0) {

648 
”rÜ
 = 
”ºo
;

649 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

650 
ş—nup
;

652 ià(
fÜm
 =ğ
POLDIFF_FORM_ADDED
) {

653 
diff
->
u£r_diffs
->
num_added
++;

655 
diff
->
u£r_diffs
->
num_»moved
++;

657 
»tv®
 = 0;

658 
ş—nup
:

659 
	`­Ş_veùÜ_de¡roy
(&
v
);

660 ià(
»tv®
 < 0) {

661 
	`u£r_ä“
(
pu
);

662 
”ºo
 = 
”rÜ
;

664  
»tv®
;

665 
	}
}

679 
	$u£r_d“p_diff_rŞes
(
pŞdiff_t
 * 
diff
, cÚ¡ 
qpŞ_u£r_t
 * 
u1
, cÚ¡ qpŞ_u£r_ˆ* 
u2
, 
pŞdiff_u£r_t
 * 
u
)

681 
­Ş_veùÜ_t
 *
v1
 = 
NULL
, *
v2
 = NULL;

682 *
rŞe1
, *
rŞe2
;

683 
size_t
 
i
, 
j
;

684 
»tv®
 = -1, 
”rÜ
 = 0, 
compv®
;

686 ià((
v1
 = 
	`u£r_g‘_rŞes
(
diff
, diff->
Üig_pŞ
, 
u1
)è=ğ
NULL
 || (
v2
 = u£r_g‘_rŞes(diff, diff->
mod_pŞ
, 
u2
)) == NULL) {

687 
”rÜ
 = 
”ºo
;

688 
ş—nup
;

690 
	`­Ş_veùÜ_sÜt
(
v1
, 
­Ş_¡r_¡rcmp
, 
NULL
);

691 
	`­Ş_veùÜ_sÜt
(
v2
, 
­Ş_¡r_¡rcmp
, 
NULL
);

692 
i
 = 
j
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v1
);) {

693 ià(
j
 >ğ
	`­Ş_veùÜ_g‘_size
(
v2
))

695 
rŞe1
 = (*)
	`­Ş_veùÜ_g‘_–em’t
(
v1
, 
i
);

696 
rŞe2
 = (*)
	`­Ş_veùÜ_g‘_–em’t
(
v2
, 
j
);

697 
compv®
 = 
	`¡rcmp
(
rŞe1
, 
rŞe2
);

698 ià(
compv®
 < 0) {

699 ià((
rŞe1
 = 
	`¡rdup
ÔŞe1)è=ğ
NULL
 || 
	`­Ş_veùÜ_­³nd
(
u
->
»moved_rŞes
,„ole1) < 0) {

700 
”rÜ
 = 
”ºo
;

701 
	`ä“
(
rŞe1
);

702 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

703 
ş—nup
;

705 
i
++;

706 } ià(
compv®
 > 0) {

707 ià((
rŞe2
 = 
	`¡rdup
ÔŞe2)è=ğ
NULL
 || 
	`­Ş_veùÜ_­³nd
(
u
->
added_rŞes
,„ole2) < 0) {

708 
”rÜ
 = 
”ºo
;

709 
	`ä“
(
rŞe2
);

710 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

711 
ş—nup
;

713 
j
++;

715 ià((
rŞe1
 = 
	`¡rdup
ÔŞe1)è=ğ
NULL
 || 
	`­Ş_veùÜ_­³nd
(
u
->
unmodif›d_rŞes
,„ole1) < 0) {

716 
”rÜ
 = 
”ºo
;

717 
	`ä“
(
rŞe1
);

718 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

719 
ş—nup
;

721 
i
++;

722 
j
++;

725 ; 
i
 < 
	`­Ş_veùÜ_g‘_size
(
v1
); i++) {

726 
rŞe1
 = (*)
	`­Ş_veùÜ_g‘_–em’t
(
v1
, 
i
);

727 ià((
rŞe1
 = 
	`¡rdup
ÔŞe1)è=ğ
NULL
 || 
	`­Ş_veùÜ_­³nd
(
u
->
»moved_rŞes
,„ole1) < 0) {

728 
”rÜ
 = 
”ºo
;

729 
	`ä“
(
rŞe1
);

730 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

731 
ş—nup
;

734 ; 
j
 < 
	`­Ş_veùÜ_g‘_size
(
v2
); j++) {

735 
rŞe2
 = (*)
	`­Ş_veùÜ_g‘_–em’t
(
v2
, 
j
);

736 ià((
rŞe2
 = 
	`¡rdup
ÔŞe2)è=ğ
NULL
 || 
	`­Ş_veùÜ_­³nd
(
u
->
added_rŞes
,„ole2) < 0) {

737 
”rÜ
 = 
”ºo
;

738 
	`ä“
(
rŞe2
);

739 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

740 
ş—nup
;

743 ià(
	`­Ş_veùÜ_g‘_size
(
u
->
»moved_rŞes
è> 0 ||‡pŞ_veùÜ_g‘_size(u->
added_rŞes
) > 0) {

744 
»tv®
 = 1;

746 
»tv®
 = 0;

748 
ş—nup
:

749 
	`­Ş_veùÜ_de¡roy
(&
v1
);

750 
	`­Ş_veùÜ_de¡roy
(&
v2
);

751 
”ºo
 = 
”rÜ
;

752  
»tv®
;

753 
	}
}

755 
	$u£r_d“p_diff
(
pŞdiff_t
 * 
diff
, cÚ¡ *
x
, cÚ¡ *
y
)

757 cÚ¡ 
qpŞ_u£r_t
 *
u1
 = 
x
;

758 cÚ¡ 
qpŞ_u£r_t
 *
u2
 = 
y
;

759 cÚ¡ *
Çme
;

760 
pŞdiff_u£r_t
 *
u
 = 
NULL
;

761 
»tv®
 = -1, 
r1
 = 0, 
r2
 = 0, 
r3
 = 0, 
”rÜ
 = 0;

762 ià(
	`qpŞ_u£r_g‘_Çme
(
diff
->
Üig_qpŞ
, 
u1
, &
Çme
è< 0 || (
u
 = 
	`make_diff
(diff, 
POLDIFF_FORM_MODIFIED
,‚ame)è=ğ
NULL
) {

763 
”rÜ
 = 
”ºo
;

764 
ş—nup
;

766 ià((
r1
 = 
	`u£r_d“p_diff_rŞes
(
diff
, 
u1
, 
u2
, 
u
)è< 0 || (
r2
 = 
	`u£r_d“p_diff_deçuÉ_Ëv–s
(diff, u1, u2, u)) < 0 ||

767 (
r3
 = 
	`u£r_d“p_diff_¿nges
(
diff
, 
u1
, 
u2
, 
u
)) < 0) {

768 
”rÜ
 = 
”ºo
;

769 
ş—nup
;

771 ià(
r1
 > 0 || 
r2
 > 0 || 
r3
 > 0) {

772 ià(
	`­Ş_veùÜ_­³nd
(
diff
->
u£r_diffs
->
diffs
, 
u
) < 0) {

773 
”rÜ
 = 
”ºo
;

774 
	`ERR
(
diff
, "%s", 
	`¡»¼Ü
(
”rÜ
));

775 
ş—nup
;

777 
diff
->
u£r_diffs
->
num_modif›d
++;

780 
	`u£r_ä“
(
u
);

782 
»tv®
 = 0;

783 
ş—nup
:

784 ià(
»tv®
 != 0) {

785 
	`u£r_ä“
(
u
);

787 
”ºo
 = 
”rÜ
;

788  
»tv®
;

789 
	}
}

	@libpoldiff/src/user_internal.h

25 #iâdeà
POLDIFF_USER_INTERNAL_H


26 
	#POLDIFF_USER_INTERNAL_H


	)

28 #ifdef 
__ılu¥lus


33 
pŞdiff_u£r_summ¬y
 
	tpŞdiff_u£r_summ¬y_t
;

41 
pŞdiff_u£r_summ¬y_t
 *
u£r_ü—‹
();

51 
u£r_de¡roy
(
pŞdiff_u£r_summ¬y_t
 ** 
us
);

60 
u£r_»£t
(
pŞdiff_t
 * 
diff
);

72 
­Ş_veùÜ_t
 *
u£r_g‘_™ems
(
pŞdiff_t
 * 
diff
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
);

86 
u£r_comp
(cÚ¡ *
x
, cÚ¡ *
y
, cÚ¡ 
pŞdiff_t
 * 
diff
);

99 
u£r_Ãw_diff
(
pŞdiff_t
 * 
diff
, 
pŞdiff_fÜm_e
 
fÜm
, cÚ¡ *
™em
);

115 
u£r_d“p_diff
(
pŞdiff_t
 * 
diff
, cÚ¡ *
x
, cÚ¡ *
y
);

117 #ifdef 
__ılu¥lus


	@libpoldiff/src/util.c

26 
	~<cÚfig.h
>

27 
	~<pŞdiff/ut.h
>

29 cÚ¡ *
	$libpŞdiff_g‘_v”siÚ
()

31  
LIBPOLDIFF_VERSION_STRING
;

32 
	}
}

	@libpoldiff/tests/components-tests.c

25 
	~<cÚfig.h
>

27 
	~"libpŞdiff-‹¡s.h
"

28 
	~"compÚ’ts-‹¡s.h
"

29 
	~"pŞicy-defs.h
"

30 
	~<CUn™/Basic.h
>

31 
	~<CUn™/Te¡DB.h
>

33 
	~<­Ş/ut.h
>

35 
	~<¡dio.h
>

36 
	~<”ºo.h
>

37 
	~<g‘İt.h
>

38 
	~<¡dšt.h
>

39 
	~<¡dlib.h
>

40 
	~<¡ršg.h
>

42 *
	gunchªged_©Œibu‹s
[] = {

45 
NULL


47 *
	gadded_©Œibu‹s
[] = {

50 
NULL


52 *
	g»moved_©Œibu‹s
[] = {

55 
NULL


57 *
	gmodif›d_©Œibu‹s
[] = {

69 
NULL


71 *
	gunchªged_boŞs
[] = {

74 
NULL


76 *
	gadded_boŞs
[] = {

79 
NULL


81 *
	g»moved_boŞs
[] = {

84 
NULL


86 *
	gmodif›d_boŞs
[] = {

89 
NULL


91 *
	gunchªged_şas£s
[] = {

97 "assocŸtiÚ", "cÚ‹xt", 
NULL


99 *
	gadded_şas£s
[] = {

102 
NULL


104 *
	g»moved_şas£s
[] = {

107 
NULL


109 *
	gmodif›d_şas£s
[] = {

160 
NULL


163 *
	gunchªged_commÚs
[] = {

166 
NULL


168 *
	gadded_commÚs
[] = {

171 
NULL


173 *
	g»moved_commÚs
[] = {

176 
NULL


178 *
	gmodif›d_commÚs
[] = {

186 
NULL


189 *
	gunchªged_rŞes
[] = {

192 
NULL


194 *
	gadded_rŞes
[] = {

197 
NULL


199 *
	g»moved_rŞes
[] = {

202 
NULL


204 *
	gmodif›d_rŞes
[] = {

230 
NULL


233 *
	gunchªged_ty³s
[] = {

242 
NULL


245 *
	gadded_ty³s
[] = {

249 
NULL


253 *
	g»moved_ty³s
[] = {

258 
NULL


261 *
	gmodif›d_ty³s
[] = {

276 
NULL


278 *
	g®Ÿ£d_ty³s
[] = {

281 
NULL


284 *
	gunchªged_u£rs
[] = {

287 
NULL


289 *
	gadded_u£rs
[] = {

292 
NULL


294 *
	g»moved_u£rs
[] = {

297 
NULL


299 *
	gmodif›d_u£rs
[] = {

308 
NULL


315 
	$WRAP_NAME_FUNC
(
©Œib
)

316 
	$WRAP_NAME_FUNC
(
boŞ
)

317 
	$WRAP_NAME_FUNC
(
şass
)

318 
	$WRAP_NAME_FUNC
(
commÚ
)

319 
	$WRAP_NAME_FUNC
(
rŞe
)

320 
	$WRAP_NAME_FUNC
(
ty³
)

321 
	$WRAP_NAME_FUNC
(
u£r
)

322 
	$WRAP_NAME_FUNC
(
ÿt
)

324 
	$WRAP_MOD_FUNC
(
şass
, 
³rms
, 
added
)

325 
	$WRAP_MOD_FUNC
(
şass
, 
³rms
, 
»moved
)

326 
	$WRAP_MOD_FUNC
(
©Œib
, 
ty³s
, 
added
)

327 
	$WRAP_MOD_FUNC
(
©Œib
, 
ty³s
, 
»moved
)

328 
	$WRAP_MOD_FUNC
(
commÚ
, 
³rms
, 
added
)

329 
	$WRAP_MOD_FUNC
(
commÚ
, 
³rms
, 
»moved
)

330 
	$WRAP_MOD_FUNC
(
rŞe
, 
ty³s
, 
added
)

331 
	$WRAP_MOD_FUNC
(
rŞe
, 
ty³s
, 
»moved
)

332 
	$WRAP_MOD_FUNC
(
u£r
, 
rŞes
, 
added
)

333 
	$WRAP_MOD_FUNC
(
u£r
, 
rŞes
, 
»moved
)

334 
	$WRAP_MOD_FUNC
(
ty³
, 
©Œibs
, 
added
)

335 
	$WRAP_MOD_FUNC
(
ty³
, 
©Œibs
, 
»moved
)

337 
	$bud_compÚ’t_vecs
(
compÚ’t_funcs_t
 * 
compÚ’t_funcs
)

339 
size_t
 
i
;

340 cÚ¡ *
™em
 = 
NULL
;

341 cÚ¡ 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

342 
v
 = 
compÚ’t_funcs
->
	`g‘_diff_veùÜ
(
diff
);

343 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v
); i++) {

344 
™em
 = 
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

345 cÚ¡ *
Çme_Úly
 = 
NULL
;

346 
Çme_Úly
 = 
compÚ’t_funcs
->
	`g‘_Çme
(
™em
);

347 ià(
compÚ’t_funcs
->
	`g‘_fÜm
(
™em
è=ğ
POLDIFF_FORM_ADDED
) {

348 
	`­Ş_veùÜ_­³nd
(
added_v
, 
	`¡rdup
(
Çme_Úly
));

349 } ià(
compÚ’t_funcs
->
	`g‘_fÜm
(
™em
è=ğ
POLDIFF_FORM_REMOVED
) {

350 
	`­Ş_veùÜ_­³nd
(
»moved_v
, 
	`¡rdup
(
Çme_Úly
));

351 } ià(
compÚ’t_funcs
->
	`g‘_fÜm
(
™em
è=ğ
POLDIFF_FORM_MODIFIED
) {

352 
	`­Ş_veùÜ_­³nd
(
modif›d_Çme_Úly_v
, 
	`¡rdup
(
Çme_Úly
));

353 
size_t
 
j
;

354 ià(
compÚ’t_funcs
->
g‘_added
) {

355 cÚ¡ 
­Ş_veùÜ_t
 *
added_–em’ts
 = 
compÚ’t_funcs
->
	`g‘_added
(
™em
);

356 
j
 = 0; j < 
	`­Ş_veùÜ_g‘_size
(
added_–em’ts
); ++j) {

357 *
added_–em’t
;

358 
added_–em’t
 = 
	`­Ş_veùÜ_g‘_–em’t
(
added_–em’ts
, 
j
);

359 *
modifiÿtiÚ_¡r
 = 
NULL
;

360 
size_t
 
modifiÿtiÚ_¡r_Ën
 = 0;

361 
	`­Ş_¡r_­³ndf
(&
modifiÿtiÚ_¡r
, &
modifiÿtiÚ_¡r_Ën
, "% %s%s", 
Çme_Úly
, "+",

362 
added_–em’t
);

363 
	`­Ş_veùÜ_­³nd
(
modif›d_v
, 
modifiÿtiÚ_¡r
);

366 ià(
compÚ’t_funcs
->
g‘_»moved
) {

367 cÚ¡ 
­Ş_veùÜ_t
 *
»moved_–em’ts
 = 
compÚ’t_funcs
->
	`g‘_»moved
(
™em
);

368 
j
 = 0; j < 
	`­Ş_veùÜ_g‘_size
(
»moved_–em’ts
); ++j) {

369 *
»moved_–em’t
;

370 
»moved_–em’t
 = 
	`­Ş_veùÜ_g‘_–em’t
(
»moved_–em’ts
, 
j
);

371 *
modifiÿtiÚ_¡r
 = 
NULL
;

372 
size_t
 
modifiÿtiÚ_¡r_Ën
 = 0;

373 
	`­Ş_¡r_­³ndf
(&
modifiÿtiÚ_¡r
, &
modifiÿtiÚ_¡r_Ën
, "% %s%s", 
Çme_Úly
, "-",

374 
»moved_–em’t
);

375 
	`­Ş_veùÜ_­³nd
(
modif›d_v
, 
modifiÿtiÚ_¡r
);

378 ià(!(
compÚ’t_funcs
->
g‘_added
 && component_funcs)) {

379 
	`­Ş_veùÜ_­³nd
(
modif›d_v
, 
	`¡rdup
(
Çme_Úly
));

383 
	}
}

385 
	$compÚ’ts_ty³s_‹¡s
()

387 
pŞdiff_‹¡_ªsw”s_t
 *
ªsw”s
 = 
	`š™_ªsw”_veùÜs
(
added_ty³s
, 
»moved_ty³s
, 
unchªged_ty³s
, 
modif›d_ty³s
);

388 
compÚ’t_funcs_t
 *
funcs
 = 
	`š™_‹¡_funcs
(
pŞdiff_g‘_ty³_veùÜ
, 
pŞdiff_ty³_g‘_Çme_w
,

389 
pŞdiff_ty³_g‘_fÜm
, 
pŞdiff_ty³_g‘_added_©Œibs_w
,

390 
pŞdiff_ty³_g‘_»moved_©Œibs_w
);

391 
	`run_‹¡
(
funcs
, 
ªsw”s
, 
COMPONENT
);

392 
	`ä“
(
funcs
);

394 
size_t
 
i
;

395 
­Ş_veùÜ_t
 *
Üig_®Ÿ£s_v
 = 
	`­Ş_veùÜ_ü—‹
(
ä“
);

396 
­Ş_veùÜ_t
 *
mod_®Ÿ£s_v
 = 
	`­Ş_veùÜ_ü—‹
(
ä“
);

397 
­Ş_veùÜ_t
 *
fš®_®Ÿ£s_v
 = 
	`­Ş_veùÜ_ü—‹
(
ä“
);

398 
­Ş_veùÜ_t
 *
cÜ»ù_fš®_®Ÿ£s_v
 = 
	`¡ršg_¬¿y_to_veùÜ
(
®Ÿ£d_ty³s
);

399 
­Ş_veùÜ_t
 *
chªged_®Ÿ£s_v
;

401 
qpŞ_pŞicy_t
 *
Üig_qpŞicy
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
Üig_pŞicy
);

402 
qpŞ_pŞicy_t
 *
mod_qpŞicy
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
mod_pŞicy
);

404 
qpŞ_™”©Ü_t
 *
Üig_ty³s
;

405 
qpŞ_™”©Ü_t
 *
mod_ty³s
;

407 
	`qpŞ_pŞicy_g‘_ty³_™”
(
mod_qpŞicy
, &
Üig_ty³s
);

408 ; !
	`qpŞ_™”©Ü_’d
(
Üig_ty³s
); 
	`qpŞ_™”©Ü_Ãxt
(orig_types)) {

409 
i§lŸs
 = 0;

410 
qpŞ_ty³_t
 *
qpŞ_ty³
;

411 cÚ¡ *
Çme
;

412 
	`qpŞ_™”©Ü_g‘_™em
(
Üig_ty³s
, (**)&
qpŞ_ty³
);

413 
	`qpŞ_ty³_g‘_Çme
(
Üig_qpŞicy
, 
qpŞ_ty³
, &
Çme
);

414 
	`qpŞ_ty³_g‘_i§lŸs
(
Üig_qpŞicy
, 
qpŞ_ty³
, &
i§lŸs
);

415 ià(!
i§lŸs
) {

416 
	`­Ş_veùÜ_­³nd
(
Üig_®Ÿ£s_v
, 
	`¡rdup
(
Çme
));

419 
	`qpŞ_pŞicy_g‘_ty³_™”
(
mod_qpŞicy
, &
mod_ty³s
);

420 ; !
	`qpŞ_™”©Ü_’d
(
mod_ty³s
); 
	`qpŞ_™”©Ü_Ãxt
(mod_types)) {

421 
i§lŸs
 = 0;

422 cÚ¡ 
qpŞ_ty³_t
 *
qpŞ_ty³
;

423 cÚ¡ *
Çme
;

424 
	`qpŞ_™”©Ü_g‘_™em
(
mod_ty³s
, (**)&
qpŞ_ty³
);

425 
	`qpŞ_ty³_g‘_Çme
(
mod_qpŞicy
, 
qpŞ_ty³
, &
Çme
);

426 
	`qpŞ_ty³_g‘_i§lŸs
(
mod_qpŞicy
, 
qpŞ_ty³
, &
i§lŸs
);

427 ià(
i§lŸs
) {

428 
	`­Ş_veùÜ_­³nd
(
mod_®Ÿ£s_v
, 
	`¡rdup
(
Çme
));

432 
chªged_®Ÿ£s_v
 = 
	`­Ş_veùÜ_ü—‹_äom_š‹r£ùiÚ
(
Üig_®Ÿ£s_v
, 
mod_®Ÿ£s_v
, 
­Ş_¡r_¡rcmp
, 
NULL
);

433 *
®Ÿs_¡r
 = 
NULL
, *
¡r
 = NULL;

434 
size_t
 
®Ÿs_¡r_Ën
 = 0, 
¡r_Ën
 = 0;

435 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
chªged_®Ÿ£s_v
); ++i) {

436 *
Çme
 = 
	`­Ş_veùÜ_g‘_–em’t
(
chªged_®Ÿ£s_v
, 
i
);

437 
qpŞ_™”©Ü_t
 *
®Ÿ£d_to
;

438 cÚ¡ 
qpŞ_ty³_t
 *
qty³
;

439 
	`qpŞ_pŞicy_g‘_ty³_by_Çme
(
mod_qpŞicy
, 
Çme
, &
qty³
);

440 
	`qpŞ_ty³_g‘_®Ÿs_™”
(
mod_qpŞicy
, 
qty³
, &
®Ÿ£d_to
);

441 ; !
	`qpŞ_™”©Ü_’d
(
®Ÿ£d_to
); 
	`qpŞ_™”©Ü_Ãxt
(aliased_to)) {

442 cÚ¡ *
Çme
;

443 
	`qpŞ_™”©Ü_g‘_™em
(
®Ÿ£d_to
, (**)&
Çme
);

444 
	`­Ş_¡r_­³nd
(&
®Ÿs_¡r
, &
®Ÿs_¡r_Ën
, 
Çme
);

446 
	`­Ş_¡r_­³ndf
(&
¡r
, &
¡r_Ën
, "% -> %s", 
Çme
, 
®Ÿs_¡r
);

447 
	`ä“
(
®Ÿs_¡r
);

448 
	`­Ş_veùÜ_­³nd
(
fš®_®Ÿ£s_v
, 
¡r
);

449 
	`qpŞ_™”©Ü_de¡roy
(&
®Ÿ£d_to
);

451 
	`­Ş_veùÜ_sÜt
(
fš®_®Ÿ£s_v
, 
com·»_¡r
, 
NULL
);

452 
	`­Ş_veùÜ_sÜt
(
cÜ»ù_fš®_®Ÿ£s_v
, 
com·»_¡r
, 
NULL
);

453 
size_t
 
fœ¡_diff
 = 0;

454 
‹¡_»suÉ
;

456 
	`CU_ASSERT_FALSE
(
‹¡_»suÉ
 =

457 
	`­Ş_veùÜ_com·»
(
fš®_®Ÿ£s_v
, 
cÜ»ù_fš®_®Ÿ£s_v
, 
com·»_¡r
, 
NULL
, &
fœ¡_diff
));

458 ià(
‹¡_»suÉ
) {

459 
	`´št_‹¡_çu»
(
fš®_®Ÿ£s_v
, 
cÜ»ù_fš®_®Ÿ£s_v
, 
fœ¡_diff
, "Aliases");

461 
	`­Ş_veùÜ_de¡roy
(&
Üig_®Ÿ£s_v
);

462 
	`­Ş_veùÜ_de¡roy
(&
mod_®Ÿ£s_v
);

463 
	`­Ş_veùÜ_de¡roy
(&
fš®_®Ÿ£s_v
);

464 
	`­Ş_veùÜ_de¡roy
(&
cÜ»ù_fš®_®Ÿ£s_v
);

465 
	`­Ş_veùÜ_de¡roy
(&
chªged_®Ÿ£s_v
);

466 
	`qpŞ_™”©Ü_de¡roy
(&
mod_ty³s
);

467 
	`qpŞ_™”©Ü_de¡roy
(&
Üig_ty³s
);

469 
	`ş—nup_‹¡
(
ªsw”s
);

470 
	}
}

472 
	$compÚ’ts_boŞs_‹¡s
()

474 
pŞdiff_‹¡_ªsw”s_t
 *
ªsw”s
 = 
	`š™_ªsw”_veùÜs
(
added_boŞs
, 
»moved_boŞs
, 
unchªged_boŞs
, 
modif›d_boŞs
);

475 
compÚ’t_funcs_t
 *
funcs
 = 
	`š™_‹¡_funcs
(
pŞdiff_g‘_boŞ_veùÜ
, 
pŞdiff_boŞ_g‘_Çme_w
,

476 
pŞdiff_boŞ_g‘_fÜm
, 
NULL
, NULL);

477 
	`run_‹¡
(
funcs
, 
ªsw”s
, 
COMPONENT
);

478 
	`ä“
(
funcs
);

479 
	`ş—nup_‹¡
(
ªsw”s
);

480 
	}
}

482 
	$compÚ’ts_u£rs_‹¡s
()

484 
pŞdiff_‹¡_ªsw”s_t
 *
ªsw”s
 = 
	`š™_ªsw”_veùÜs
(
added_u£rs
, 
»moved_u£rs
, 
unchªged_u£rs
, 
modif›d_u£rs
);

485 
compÚ’t_funcs_t
 *
funcs
 = 
	`š™_‹¡_funcs
(
pŞdiff_g‘_u£r_veùÜ
, 
pŞdiff_u£r_g‘_Çme_w
,

486 
pŞdiff_u£r_g‘_fÜm
, 
pŞdiff_u£r_g‘_added_rŞes_w
,

487 
pŞdiff_u£r_g‘_»moved_rŞes_w
);

488 
	`run_‹¡
(
funcs
, 
ªsw”s
, 
COMPONENT
);

489 
	`ä“
(
funcs
);

490 
	`ş—nup_‹¡
(
ªsw”s
);

491 
	}
}

493 
	$compÚ’ts_rŞes_‹¡s
()

495 
pŞdiff_‹¡_ªsw”s_t
 *
ªsw”s
 = 
	`š™_ªsw”_veùÜs
(
added_rŞes
, 
»moved_rŞes
, 
unchªged_rŞes
, 
modif›d_rŞes
);

496 
compÚ’t_funcs_t
 *
funcs
 = 
	`š™_‹¡_funcs
(
pŞdiff_g‘_rŞe_veùÜ
, 
pŞdiff_rŞe_g‘_Çme_w
, 
pŞdiff_rŞe_g‘_fÜm
,

497 
pŞdiff_rŞe_g‘_added_ty³s_w
, 
pŞdiff_rŞe_g‘_»moved_ty³s_w
);

498 
	`run_‹¡
(
funcs
, 
ªsw”s
, 
COMPONENT
);

499 
	`ä“
(
funcs
);

500 
	`ş—nup_‹¡
(
ªsw”s
);

501 
	}
}

503 
	$compÚ’ts_commÚs_‹¡s
()

505 
pŞdiff_‹¡_ªsw”s_t
 *
ªsw”s
 = 
	`š™_ªsw”_veùÜs
(
added_commÚs
, 
»moved_commÚs
, 
unchªged_commÚs
, 
modif›d_commÚs
);

506 
compÚ’t_funcs_t
 *
funcs
 = 
	`š™_‹¡_funcs
(
pŞdiff_g‘_commÚ_veùÜ
, 
pŞdiff_commÚ_g‘_Çme_w
, 
pŞdiff_commÚ_g‘_fÜm
,

507 
pŞdiff_commÚ_g‘_added_³rms_w
, 
pŞdiff_commÚ_g‘_»moved_³rms_w
);

508 
	`run_‹¡
(
funcs
, 
ªsw”s
, 
COMPONENT
);

509 
	`ä“
(
funcs
);

510 
	`ş—nup_‹¡
(
ªsw”s
);

511 
	}
}

513 
	$compÚ’ts_©Œibu‹s_‹¡s
()

515 
pŞdiff_‹¡_ªsw”s_t
 *
ªsw”s
 =

516 
	`š™_ªsw”_veùÜs
(
added_©Œibu‹s
, 
»moved_©Œibu‹s
, 
unchªged_©Œibu‹s
, 
modif›d_©Œibu‹s
);

517 
compÚ’t_funcs_t
 *
funcs
 = 
	`š™_‹¡_funcs
(
pŞdiff_g‘_©Œib_veùÜ
, 
pŞdiff_©Œib_g‘_Çme_w
,

518 
pŞdiff_©Œib_g‘_fÜm
, 
pŞdiff_©Œib_g‘_added_ty³s_w
,

519 
pŞdiff_©Œib_g‘_»moved_ty³s_w
);

521 
	`run_‹¡
(
funcs
, 
ªsw”s
, 
COMPONENT
);

522 
	`ä“
(
funcs
);

523 
	`ş—nup_‹¡
(
ªsw”s
);

524 
	}
}

526 
	$compÚ’ts_şass_‹¡s
()

528 
pŞdiff_‹¡_ªsw”s_t
 *
ªsw”s
 = 
	`š™_ªsw”_veùÜs
(
added_şas£s
, 
»moved_şas£s
, 
unchªged_şas£s
, 
modif›d_şas£s
);

529 
compÚ’t_funcs_t
 *
funcs
 = 
	`š™_‹¡_funcs
(
pŞdiff_g‘_şass_veùÜ
, 
pŞdiff_şass_g‘_Çme_w
,

530 
pŞdiff_şass_g‘_fÜm
, 
pŞdiff_şass_g‘_added_³rms_w
,

531 
pŞdiff_şass_g‘_»moved_³rms_w
);

532 
	`run_‹¡
(
funcs
, 
ªsw”s
, 
COMPONENT
);

533 
	`ä“
(
funcs
);

534 
	`ş—nup_‹¡
(
ªsw”s
);

535 
	}
}

537 
	$compÚ’ts_‹¡_š™
()

539 ià(!(
diff
 = 
	`š™_pŞdiff
(
COMPONENTS_ORIG_POLICY
, 
COMPONENTS_MOD_POLICY
))) {

544 
	}
}

	@libpoldiff/tests/components-tests.h

25 #iâdeà
COMPONENTS_TEST


26 
	#COMPONENTS_TEST


	)

28 
	#WRAP_NAME_FUNC
(
compÚ’t
ècÚ¡ *
pŞdiff_
##compÚ’t##
	`_g‘_Çme_w
(cÚ¡ *
¬g
) { \

29 cÚ¡ 
pŞdiff_
##
compÚ’t
##
_t
 *
şs
 = (cÚ¡…Şdiff_##compÚ’t##_ˆ*)
¬g
; \

30  
pŞdiff_
##
compÚ’t
##
	`_g‘_Çme
(
şs
); }

	)

32 
	#WRAP_MOD_FUNC
(
compÚ’t
,
mod_compÚ’t
,
mod_ty³
ècÚ¡ 
­Ş_veùÜ_t
* 
pŞdiff_
##compÚ’t##
_g‘_
##mod_ty³##
_
##mod_compÚ’t##
	`_w
(cÚ¡ * 
¬g
) { \

33 cÚ¡ 
pŞdiff_
##
compÚ’t
##
_t
 *
şs
 = (cÚ¡…Şdiff_##compÚ’t##_ˆ*)
¬g
; \

34  
pŞdiff_
##
compÚ’t
##
_g‘_
##
mod_ty³
##
_
##
	`mod_compÚ’t
(
şs
); }

	)

36 
bud_compÚ’t_vecs
(
compÚ’t_funcs_t
 *);

38 
compÚ’ts_‹¡_š™
();

39 
compÚ’ts_‹¡_ş—nup
();

41 
compÚ’ts_©Œibu‹s_‹¡s
();

42 
compÚ’ts_boŞs_‹¡s
();

43 
compÚ’ts_commÚs_‹¡s
();

44 
compÚ’ts_rŞes_‹¡s
();

45 
compÚ’ts_u£rs_‹¡s
();

46 
compÚ’ts_şass_‹¡s
();

47 
compÚ’ts_ty³s_‹¡s
();

	@libpoldiff/tests/libpoldiff-tests.c

25 
	~<cÚfig.h
>

27 
	~"libpŞdiff-‹¡s.h
"

29 
	~<CUn™/Basic.h
>

30 
	~<CUn™/Te¡DB.h
>

32 
	~<­Ş/ut.h
>

33 
	~<­Ş/veùÜ.h
>

34 
	~<¡dio.h
>

35 
	~<”ºo.h
>

36 
	~<¡dšt.h
>

37 
	~<¡dlib.h
>

38 
	~<¡ršg.h
>

40 
	~"compÚ’ts-‹¡s.h
"

41 
	~"ruËs-‹¡s.h
"

42 
	~"mls-‹¡s.h
"

43 
	~"nomls-‹¡s.h
"

45 
­Ş_veùÜ_t
 *
	$¡ršg_¬¿y_to_veùÜ
(*
¬r
[])

47 
­Ş_veùÜ_t
 *
v
 = 
	`­Ş_veùÜ_ü—‹
(
ä“
);

48 
i
;

49 
i
 = 0; 
¬r
[i] !ğ
NULL
; ++i) {

50 
	`­Ş_veùÜ_­³nd
(
v
, 
	`¡rdup
(
¬r
[
i
]));

52  
v
;

53 
	}
}

55 *
	$veùÜ_to_¡ršg
(cÚ¡ 
­Ş_veùÜ_t
 * 
v
, cÚ¡ *
´e
, cÚ¡ *
£p
)

57 *
™em
 = 
NULL
, *
¡r
 = NULL, *
tmp
 = NULL;

58 
size_t
 
i
 = 0, 
¡r_Ën
 = 0, 
tmp_Ën
 = 0;

59 
size_t
 
num_–em’ts
 = 
	`­Ş_veùÜ_g‘_size
(
v
);

60 
i
 = 0; 
v
 && i < 
num_–em’ts
; i++) {

61 
™em
 = 
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

62 ià(
	`­Ş_¡r_­³ndf
(&
tmp
, &
tmp_Ën
, "%s%s", 
£p
, 
™em
) < 0) {

63  
NULL
;

66 
	`­Ş_¡r_Œim
(
tmp
);

67 ià(
tmp
) {

68 
	`­Ş_¡r_­³ndf
(&
¡r
, &
¡r_Ën
, "%s%s", 
´e
, 
tmp
);

70 
¡r
 = 
	`¡rdup
("");

72 
	`ä“
(
tmp
);

73  
¡r
;

74 
	}
}

76 
­Ş_veùÜ_t
 *
	$sh®low_cİy_¡r_vec_ªd_sÜt
(cÚ¡ 
­Ş_veùÜ_t
 * 
v
)

78 
­Ş_veùÜ_t
 *
cİy
 = 
	`­Ş_veùÜ_ü—‹_äom_veùÜ
(
v
, 
NULL
, NULL, NULL);

79 
	`­Ş_veùÜ_sÜt
(
cİy
, 
­Ş_¡r_¡rcmp
, 
NULL
);

80  
cİy
;

81 
	}
}

83 
	$run_‹¡
(
compÚ’t_funcs_t
 * 
compÚ’t_funcs
, 
pŞdiff_‹¡_ªsw”s_t
 * 
pŞdiff_‹¡_ªsw”s
, 
‹¡_numb”s_e
 
‹¡_num
)

85 
added_v
 = 
	`­Ş_veùÜ_ü—‹
(
ä“
);

86 
»moved_v
 = 
	`­Ş_veùÜ_ü—‹
(
ä“
);

87 
modif›d_v
 = 
	`­Ş_veùÜ_ü—‹
(
ä“
);

88 
modif›d_Çme_Úly_v
 = 
	`­Ş_veùÜ_ü—‹
(
ä“
);

89 
‹¡_num
) {

90 
COMPONENT
:

91 
	`bud_compÚ’t_vecs
(
compÚ’t_funcs
);

93 
RULES_AVRULE
:

94 
	`bud_avruË_vecs
();

96 
RULES_TERULE
:

97 
	`bud_‹ruË_vecs
();

99 
RULES_ROLEALLOW
:

100 
	`bud_rŞ—Îow_vecs
();

102 
RULES_ROLETRANS
:

103 
	`bud_rŞ‘¿ns_vecs
();

105 
MLS_CATEGORY
:

106 
	`bud_ÿ‹gÜy_vecs
();

108 
MLS_LEVEL
:

109 
	`bud_Ëv–_vecs
();

111 
MLS_RANGETRANS
:

112 
	`bud_¿ng‘¿ns_vecs
();

114 
MLS_USER
:

115 
	`bud_u£r_vecs
();

118 
size_t
 
fœ¡_diff
;

119 
­Ş_veùÜ_t
 *
š‹r£ù
 = 
NULL
, *
®l_chªges
 = NULL;

120 ià(!(
®l_chªges
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
))) {

121 
”r
;

123 
	`­Ş_veùÜ_ÿt
(
®l_chªges
, 
added_v
);

124 
	`­Ş_veùÜ_ÿt
(
®l_chªges
, 
»moved_v
);

125 
	`­Ş_veùÜ_ÿt
(
®l_chªges
, 
modif›d_Çme_Úly_v
);

127 (
š‹r£ù
 =

128 
	`­Ş_veùÜ_ü—‹_äom_š‹r£ùiÚ
(
®l_chªges
, 
pŞdiff_‹¡_ªsw”s
->
cÜ»ù_unchªged_v
, 
com·»_¡r
, 
NULL
))) {

129 
”r
;

132 
	`CU_ASSERT_EQUAL
(
	`­Ş_veùÜ_g‘_size
(
š‹r£ù
), 0);

134 
	`­Ş_veùÜ_sÜt
(
added_v
, 
com·»_¡r
, 
NULL
);

135 
	`­Ş_veùÜ_sÜt
(
pŞdiff_‹¡_ªsw”s
->
cÜ»ù_added_v
, 
com·»_¡r
, 
NULL
);

136 
‹¡_»suÉ
;

137 
	`CU_ASSERT_FALSE
(
‹¡_»suÉ
 =

138 
	`­Ş_veùÜ_com·»
(
added_v
, 
pŞdiff_‹¡_ªsw”s
->
cÜ»ù_added_v
, 
com·»_¡r
, 
NULL
, &
fœ¡_diff
));

139 ià(
‹¡_»suÉ
) {

140 
	`´št_‹¡_çu»
(
added_v
, 
pŞdiff_‹¡_ªsw”s
->
cÜ»ù_added_v
, 
fœ¡_diff
, "Added");

143 
	`­Ş_veùÜ_sÜt
(
»moved_v
, 
com·»_¡r
, 
NULL
);

144 
	`­Ş_veùÜ_sÜt
(
pŞdiff_‹¡_ªsw”s
->
cÜ»ù_»moved_v
, 
com·»_¡r
, 
NULL
);

145 
	`CU_ASSERT_FALSE
(
‹¡_»suÉ
 =

146 
	`­Ş_veùÜ_com·»
(
»moved_v
, 
pŞdiff_‹¡_ªsw”s
->
cÜ»ù_»moved_v
, 
com·»_¡r
, 
NULL
, &
fœ¡_diff
));

147 ià(
‹¡_»suÉ
) {

148 
	`´št_‹¡_çu»
(
»moved_v
, 
pŞdiff_‹¡_ªsw”s
->
cÜ»ù_»moved_v
, 
fœ¡_diff
, "Removed");

151 
	`­Ş_veùÜ_sÜt
(
modif›d_v
, 
com·»_¡r
, 
NULL
);

152 
	`­Ş_veùÜ_sÜt
(
pŞdiff_‹¡_ªsw”s
->
cÜ»ù_modif›d_v
, 
com·»_¡r
, 
NULL
);

153 
	`CU_ASSERT_FALSE
(
‹¡_»suÉ
 =

154 
	`­Ş_veùÜ_com·»
(
modif›d_v
, 
pŞdiff_‹¡_ªsw”s
->
cÜ»ù_modif›d_v
, 
com·»_¡r
, 
NULL
, &
fœ¡_diff
));

155 ià(
‹¡_»suÉ
) {

156 
	`´št_‹¡_çu»
(
modif›d_v
, 
pŞdiff_‹¡_ªsw”s
->
cÜ»ù_modif›d_v
, 
fœ¡_diff
, "Modified");

159 
	`­Ş_veùÜ_de¡roy
(&
š‹r£ù
);

160 
	`­Ş_veùÜ_de¡roy
(&
added_v
);

161 
	`­Ş_veùÜ_de¡roy
(&
»moved_v
);

162 
	`­Ş_veùÜ_de¡roy
(&
modif›d_Çme_Úly_v
);

163 
	`­Ş_veùÜ_de¡roy
(&
modif›d_v
);

164 
	`­Ş_veùÜ_de¡roy
(&
®l_chªges
);

166 
”r
:

167 
	`­Ş_veùÜ_de¡roy
(&
š‹r£ù
);

168 
	`­Ş_veùÜ_de¡roy
(&
added_v
);

169 
	`­Ş_veùÜ_de¡roy
(&
»moved_v
);

170 
	`­Ş_veùÜ_de¡roy
(&
modif›d_Çme_Úly_v
);

171 
	`­Ş_veùÜ_de¡roy
(&
modif›d_v
);

172 
	`­Ş_veùÜ_de¡roy
(&
®l_chªges
);

173 
	`CU_FAIL_FATAL
("Could‚ot initialize vectors forest");

174 
	}
}

176 
	$´št_‹¡_çu»
(
­Ş_veùÜ_t
 * 
aùu®
,‡pŞ_veùÜ_ˆ* 
ex³ùed
, 
size_t
 
fœ¡_diff
, cÚ¡ *
‹¡_Çme
)

178 
	`´štf
("\nTEST FAILED\n");

179 
size_t
 
i
;

180 
	`´štf
("--- ACTUAL RESULT (%sè-----\n", 
‹¡_Çme
);

181 
i
 = 
fœ¡_diff
; i < 
	`­Ş_veùÜ_g‘_size
(
aùu®
); ++i) {

182 *
™em
 = (*)
	`­Ş_veùÜ_g‘_–em’t
(
aùu®
, 
i
);

183 
	`´štf
("\t%3d. %s\n", ()
i
, 
™em
);

185 
	`´štf
("--- EXPECTED RESULT (%sè---\n", 
‹¡_Çme
);

186 
i
 = 
fœ¡_diff
; i < 
	`­Ş_veùÜ_g‘_size
(
ex³ùed
); ++i) {

187 *
™em
 = (*)
	`­Ş_veùÜ_g‘_–em’t
(
ex³ùed
, 
i
);

188 
	`´štf
("\t%3d. %s\n", ()
i
, 
™em
);

190 
	}
}

192 
	$com·»_¡r
(cÚ¡ *
s1
, cÚ¡ *
s2
, *
debug
)

194 *
¡r1
 = 
	`¡rdup
((*)
s1
);

195 *
¡r2
 = 
	`¡rdup
((*)
s2
);

196 
	`­Ş_¡r_Œim
(
¡r1
);

197 
	`­Ş_¡r_Œim
(
¡r2
);

198 
»suÉ
 = 
	`¡rcmp
(
¡r1
, 
¡r2
);

199 
	`ä“
(
¡r1
);

200 
	`ä“
(
¡r2
);

201  
»suÉ
;

202 
	}
}

204 
pŞdiff_‹¡_ªsw”s_t
 *
	$š™_ªsw”_veùÜs
(*
added_¬r
[], *
»moved_¬r
[], *
unchªged_¬r
[], *
modif›d_¬r
[])

206 
pŞdiff_‹¡_ªsw”s_t
 *
ªsw”s
 = (pŞdiff_‹¡_ªsw”s_ˆ*è
	`m®loc
((poldiff_test_answers_t));

207 
ªsw”s
->
cÜ»ù_added_v
 = 
	`¡ršg_¬¿y_to_veùÜ
(
added_¬r
);

208 
ªsw”s
->
cÜ»ù_»moved_v
 = 
	`¡ršg_¬¿y_to_veùÜ
(
»moved_¬r
);

209 
ªsw”s
->
cÜ»ù_unchªged_v
 = 
	`¡ršg_¬¿y_to_veùÜ
(
unchªged_¬r
);

210 
ªsw”s
->
cÜ»ù_modif›d_v
 = 
	`¡ršg_¬¿y_to_veùÜ
(
modif›d_¬r
);

211  
ªsw”s
;

212 
	}
}

214 
compÚ’t_funcs_t
 *
	$š™_‹¡_funcs
(
pŞdiff_g‘_diff_veùÜ
 
g‘_diff_veùÜ
, 
pŞdiff_g‘_Çme
 
g‘_Çme
, 
pŞdiff_g‘_fÜm
 
g‘_fÜm
,

215 
pŞdiff_g‘_added
 
g‘_added
, 
pŞdiff_g‘_»moved
 
g‘_»moved
)

217 
compÚ’t_funcs_t
 *
funcs
 = (compÚ’t_funcs_ˆ*è
	`m®loc
((component_funcs_t));

218 
funcs
->
g‘_diff_veùÜ
 = get_diff_vector;

219 
funcs
->
g‘_Çme
 = get_name;

220 
funcs
->
g‘_fÜm
 = get_form;

221 
funcs
->
g‘_added
 = get_added;

222 
funcs
->
g‘_»moved
 = get_removed;

223  
funcs
;

224 
	}
}

226 
pŞdiff_t
 *
	$š™_pŞdiff
(*
Üig_ba£_·th
, *
mod_ba£_·th
)

228 
pŞdiff_t
 *
»tuº_diff
 = 
NULL
;

229 
ušt32_t
 
æags
 = 
POLDIFF_DIFF_ALL
;

230 
­Ş_pŞicy_·th_t
 *
mod_pŞ_·th
 = 
NULL
;

231 
­Ş_pŞicy_·th_t
 *
Üig_pŞ_·th
 = 
NULL
;

233 
Üig_pŞ_·th
 = 
	`­Ş_pŞicy_·th_ü—‹
(
APOL_POLICY_PATH_TYPE_MONOLITHIC
, 
Üig_ba£_·th
, 
NULL
);

234 ià(!
Üig_pŞ_·th
) {

235 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
”ºo
));

236 
”r
;

239 
mod_pŞ_·th
 = 
	`­Ş_pŞicy_·th_ü—‹
(
APOL_POLICY_PATH_TYPE_MONOLITHIC
, 
mod_ba£_·th
, 
NULL
);

240 ià(!
mod_pŞ_·th
) {

241 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
”ºo
));

242 
”r
;

245 
Üig_pŞicy
 = 
	`­Ş_pŞicy_ü—‹_äom_pŞicy_·th
(
Üig_pŞ_·th
, 0, 
NULL
, NULL);

246 ià(!
Üig_pŞicy
) {

247 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
”ºo
));

248 
”r
;

251 
mod_pŞicy
 = 
	`­Ş_pŞicy_ü—‹_äom_pŞicy_·th
(
mod_pŞ_·th
, 0, 
NULL
, NULL);

252 ià(!
mod_pŞicy
) {

253 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
”ºo
));

254 
”r
;

257 ià(!(
»tuº_diff
 = 
	`pŞdiff_ü—‹
(
Üig_pŞicy
, 
mod_pŞicy
, 
NULL
, NULL))) {

258 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
”ºo
));

259 
”r
;

261 ià(
	`pŞdiff_run
(
»tuº_diff
, 
æags
)) {

262 
”r
;

264 
	`­Ş_pŞicy_·th_de¡roy
(&
Üig_pŞ_·th
);

265 
	`­Ş_pŞicy_·th_de¡roy
(&
mod_pŞ_·th
);

266  
»tuº_diff
;

267 
”r
:

268 
	`­Ş_pŞicy_de¡roy
(&
Üig_pŞicy
);

269 
	`­Ş_pŞicy_de¡roy
(&
mod_pŞicy
);

270 
	`­Ş_pŞicy_·th_de¡roy
(&
Üig_pŞ_·th
);

271 
	`­Ş_pŞicy_·th_de¡roy
(&
mod_pŞ_·th
);

272 
	`pŞdiff_de¡roy
(&
»tuº_diff
);

273  
NULL
;

274 
	}
}

276 
	$ş—nup_‹¡
(
pŞdiff_‹¡_ªsw”s_t
 * 
ªsw”s
)

278 ià(
ªsw”s
 !ğ
NULL
) {

279 
	`­Ş_veùÜ_de¡roy
(&
ªsw”s
->
cÜ»ù_added_v
);

280 
	`­Ş_veùÜ_de¡roy
(&
ªsw”s
->
cÜ»ù_unchªged_v
);

281 
	`­Ş_veùÜ_de¡roy
(&
ªsw”s
->
cÜ»ù_»moved_v
);

282 
	`­Ş_veùÜ_de¡roy
(&
ªsw”s
->
cÜ»ù_modif›d_v
);

283 
	`ä“
(
ªsw”s
);

285 
	}
}

287 
	$pŞdiff_ş—nup
()

289 
	`pŞdiff_de¡roy
(&
diff
);

291 
	}
}

293 
	$maš
()

295 ià(
	`CU_š™Ÿlize_»gi¡ry
(è!ğ
CUE_SUCCESS
) {

296  
	`CU_g‘_”rÜ
();

299 
CU_Te¡Info
 
compÚ’ts_‹¡s_¬r
[] = {

300 {"A‰ribu‹s", 
compÚ’ts_©Œibu‹s_‹¡s
}

302 {"CÏs£s", 
compÚ’ts_şass_‹¡s
}

304 {"CommÚs", 
compÚ’ts_commÚs_‹¡s
}

306 {"RŞes", 
compÚ’ts_rŞes_‹¡s
}

308 {"U£rs", 
compÚ’ts_u£rs_‹¡s
}

310 {"BoŞs", 
compÚ’ts_boŞs_‹¡s
}

312 {"Ty³s", 
compÚ’ts_ty³s_‹¡s
}

314 
CU_TEST_INFO_NULL


317 
CU_Te¡Info
 
ruËs_‹¡s_¬r
[] = {

318 {"AV RuËs", 
ruËs_avruËs_‹¡s
}

320 {"TE RuËs", 
ruËs_‹ruËs_‹¡s
}

322 {"RŞAÎow RuËs", 
ruËs_rŞ—Îow_‹¡s
}

324 {"RŞT¿ns™iÚ RuËs", 
ruËs_rŞ‘¿ns_‹¡s
}

326 
CU_TEST_INFO_NULL


329 
CU_Te¡Info
 
mls_‹¡s_¬r
[] = {

330 {"C©egÜ›s", 
mls_ÿ‹gÜy_‹¡s
}

332 {"Lev–s", 
mls_Ëv–_‹¡s
}

334 {"RªgT¿ns™iÚs", 
mls_¿ng‘¿ns_‹¡s
}

336 {"U£r (MLS)", 
mls_u£r_‹¡s
}

338 
CU_TEST_INFO_NULL


340 
CU_Te¡Info
 
nomls_‹¡s_¬r
[] = {

341 {"Chªged & Unchªged U£rs", 
nomls_‹¡s
}

343 
CU_TEST_INFO_NULL


346 
CU_Su™eInfo
 
su™es
[] = {

347 {"CompÚ’ts", 
compÚ’ts_‹¡_š™
, 
pŞdiff_ş—nup
, 
compÚ’ts_‹¡s_¬r
}

349 {"RuËs", 
ruËs_‹¡_š™
, 
pŞdiff_ş—nup
, 
ruËs_‹¡s_¬r
}

351 {"MLS", 
mls_‹¡_š™
, 
pŞdiff_ş—nup
, 
mls_‹¡s_¬r
}

353 {"NÚ-MLS vs. MLS U£rs", 
nomls_‹¡_š™
, 
pŞdiff_ş—nup
, 
nomls_‹¡s_¬r
}

355 
CU_SUITE_INFO_NULL


358 
	`CU_»gi¡”_su™es
(
su™es
);

359 
	`CU_basic_£t_mode
(
CU_BRM_VERBOSE
);

360 
	`CU_basic_run_‹¡s
();

361 
num_çu»s
 = 
	`CU_g‘_numb”_of_çu»_»cÜds
();

362 
	`CU_ş—nup_»gi¡ry
();

363  ()
num_çu»s
;

364 
	}
}

	@libpoldiff/tests/libpoldiff-tests.h

25 #iâdeà
LIBPOLDIFF_TESTS


26 
	#LIBPOLDIFF_TESTS


	)

28 
	~<pŞdiff/pŞdiff.h
>

29 
	~<­Ş/veùÜ.h
>

31 cÚ¡ 
	t­Ş_veùÜ_t
 *(*
	tpŞdiff_g‘_diff_veùÜ
è(cÚ¡ 
	tpŞdiff_t
 *);

32 cÚ¡ *(*
	tpŞdiff_g‘_Çme
) (const *);

33 
	$pŞdiff_fÜm_e
(*
	tpŞdiff_g‘_fÜm
) (const *);

34 cÚ¡ 
	t­Ş_veùÜ_t
 *(*
	tpŞdiff_g‘_added
) (const *);

35 cÚ¡ 
	t­Ş_veùÜ_t
 *(*
	tpŞdiff_g‘_»moved
) (const *);

37 
	s_‹¡_ªsw”s


39 
­Ş_veùÜ_t
 *
cÜ»ù_added_v
;

40 
­Ş_veùÜ_t
 *
cÜ»ù_»moved_v
;

41 
­Ş_veùÜ_t
 *
cÜ»ù_unchªged_v
;

42 
­Ş_veùÜ_t
 *
cÜ»ù_modif›d_v
;

43 } 
	tpŞdiff_‹¡_ªsw”s_t
;

45 
	s_compÚ’t_funcs


47 
pŞdiff_g‘_diff_veùÜ
 
g‘_diff_veùÜ
;

48 
pŞdiff_g‘_Çme
 
g‘_Çme
;

49 
pŞdiff_g‘_fÜm
 
g‘_fÜm
;

50 
pŞdiff_g‘_added
 
g‘_added
;

51 
pŞdiff_g‘_»moved
 
g‘_»moved
;

52 } 
	tcompÚ’t_funcs_t
;

54 
	e_‹¡_numb”s


56 
COMPONENT
 = 0, 
RULES_AVRULE
, 
RULES_TERULE
, 
RULES_ROLEALLOW
, 
RULES_ROLETRANS
,

57 
MLS_CATEGORY
, 
MLS_LEVEL
, 
MLS_RANGETRANS
, 
MLS_USER


58 } 
	t‹¡_numb”s_e
;

60 
pŞdiff_t
 *
	`š™_pŞdiff
(*
Üig_ba£_·th
, *
mod_ba£_·th
);

61 
compÚ’t_funcs_t
 *
	`š™_‹¡_funcs
(
pŞdiff_g‘_diff_veùÜ
, 
pŞdiff_g‘_Çme
, 
pŞdiff_g‘_fÜm
, 
pŞdiff_g‘_added
,

62 
pŞdiff_g‘_»moved
);

63 
	`run_‹¡
(
compÚ’t_funcs_t
 *, 
pŞdiff_‹¡_ªsw”s_t
 *, 
‹¡_numb”s_e
);

65 
­Ş_veùÜ_t
 *
	`¡ršg_¬¿y_to_veùÜ
(*[]);

66 
	`ş—nup_‹¡
(
pŞdiff_‹¡_ªsw”s_t
 *);

67 *
	`veùÜ_to_¡ršg
(cÚ¡ 
­Ş_veùÜ_t
 *, const *, const *);

69 
	`com·»_¡r
(cÚ¡ *
s1
, cÚ¡ *
s2
, *
debug
);

70 
pŞdiff_‹¡_ªsw”s_t
 *
	`š™_ªsw”_veùÜs
(*[], *[], *[], *[]);

71 
	`´št_‹¡_çu»
(
­Ş_veùÜ_t
 *,‡pŞ_veùÜ_ˆ*, 
size_t
, const *);

73 
­Ş_veùÜ_t
 *
	`sh®low_cİy_¡r_vec_ªd_sÜt
(cÚ¡‡pŞ_veùÜ_ˆ* 
v
);

75 
pŞdiff_t
 *
diff
;

77 
­Ş_pŞicy_t
 *
Üig_pŞicy
;

78 
­Ş_pŞicy_t
 *
mod_pŞicy
;

80 
­Ş_veùÜ_t
 *
added_v
;

81 
­Ş_veùÜ_t
 *
»moved_v
;

82 
­Ş_veùÜ_t
 *
modif›d_v
;

83 
­Ş_veùÜ_t
 *
modif›d_Çme_Úly_v
;

	@libpoldiff/tests/mls-tests.c

25 
	~<cÚfig.h
>

27 
	~"libpŞdiff-‹¡s.h
"

28 
	~"mls-‹¡s.h
"

29 
	~"pŞicy-defs.h
"

30 
	~<CUn™/Basic.h
>

31 
	~<CUn™/Te¡DB.h
>

33 
	~<pŞdiff/pŞdiff.h
>

34 
	~<­Ş/pŞicy.h
>

35 
	~<­Ş/veùÜ.h
>

36 
	~<­Ş/ut.h
>

38 
	~<as£¹.h
>

39 
	~<¡dio.h
>

40 
	~<”ºo.h
>

41 
	~<g‘İt.h
>

42 
	~<¡dšt.h
>

43 
	~<¡dlib.h
>

44 
	~<¡ršg.h
>

46 *
	gunchªged_u£rs_mls
[] = {

50 
NULL


54 *
	gadded_u£rs_mls
[] = { 
NULL
 };

55 *
	g»moved_u£rs_mls
[] = { 
NULL
 };

64 *
	gmodif›d_u£rs_mls
[] = {

98 
NULL


101 *
	gunchªged_¿ng‘¿ns
[] = {

104 
NULL


107 *
	gadded_¿ng‘¿ns
[] = {

113 
NULL


115 *
	g»moved_¿ng‘¿ns
[] = {

123 
NULL


128 *
	gmodif›d_¿ng‘¿ns
[] = {

149 
NULL


151 *
	gadded_¿ng‘¿ns_ty³
[] = {

170 
NULL


172 *
	g»moved_¿ng‘¿ns_ty³
[] = {

190 
NULL


193 *
	gunchªged_Ëv–s
[] = {

196 
NULL


198 *
	gadded_Ëv–s
[] = {

201 
NULL


203 *
	g»moved_Ëv–s
[] = {

206 
NULL


208 *
	gmodif›d_Ëv–s
[] = {

217 
NULL


220 *
	gunchªged_ÿ‹gÜ›s
[] = {

223 
NULL


225 *
	gadded_ÿ‹gÜ›s
[] = {

228 
NULL


230 *
	g»moved_ÿ‹gÜ›s
[] = {

233 
NULL


236 *
	gmodif›d_ÿ‹gÜ›s
[] = { 
NULL
 };

238 
	$mls_‹¡_š™
()

240 ià(!(
diff
 = 
	`š™_pŞdiff
(
MLS_ORIG_POLICY
, 
MLS_MOD_POLICY
))) {

245 
	}
}

247 
	$bud_ÿ‹gÜy_vecs
()

249 *
¡r
 = 
NULL
;

250 
size_t
 
i
;

251 cÚ¡ *
™em
 = 
NULL
;

252 cÚ¡ 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

253 
v
 = 
	`pŞdiff_g‘_ÿt_veùÜ
(
diff
);

254 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v
); ++i) {

255 
™em
 = 
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

256 cÚ¡ *
Çme
 = 
	`pŞdiff_ÿt_g‘_Çme
(
™em
);

257 
¡r
 = 
	`¡rdup
(
Çme
);

258 
pŞdiff_fÜm_e
 
fÜm
 = 
	`pŞdiff_ÿt_g‘_fÜm
(
™em
);

259 
fÜm
) {

260 
POLDIFF_FORM_ADDED
:

261 
	`­Ş_veùÜ_­³nd
(
added_v
, 
¡r
);

263 
POLDIFF_FORM_REMOVED
:

264 
	`­Ş_veùÜ_­³nd
(
»moved_v
, 
¡r
);

268 
	`as£¹
(0);

270 
¡r
 = 
NULL
;

272 
	}
}

274 *
	$Ëv–_to_¡ršg
(cÚ¡ *
¬g
, 
pŞdiff_fÜm_e
 
fÜm
, 
show_chªges
)

276 
pŞdiff_Ëv–_t
 *
Ëv–
 = (pŞdiff_Ëv–_ˆ*è
¬g
;

277 *
¡r
 = 
NULL
, *
ÿt
 = NULL;

278 
size_t
 
i
, 
¡r_Ën
 = 0;

279 cÚ¡ *
Çme
 = 
	`pŞdiff_Ëv–_g‘_Çme
(
Ëv–
);

280 ià(
Çme
) {

281 
	`­Ş_¡r_­³ndf
(&
¡r
, &
¡r_Ën
, "%s", 
Çme
);

282 ià(
show_chªges
) {

283 ià(
fÜm
 =ğ
POLDIFF_FORM_MODIFIED
) {

284 cÚ¡ 
­Ş_veùÜ_t
 *
added_ÿts
 = 
	`pŞdiff_Ëv–_g‘_added_ÿts
(
Ëv–
);

285 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
added_ÿts
); ++i) {

286 
ÿt
 = 
	`­Ş_veùÜ_g‘_–em’t
(
added_ÿts
, 
i
);

287 
	`­Ş_¡r_­³ndf
(&
¡r
, &
¡r_Ën
, " +%s", 
ÿt
);

289 cÚ¡ 
­Ş_veùÜ_t
 *
»moved_ÿts
 = 
	`pŞdiff_Ëv–_g‘_»moved_ÿts
(
Ëv–
);

290 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
»moved_ÿts
); ++i) {

291 
ÿt
 = 
	`­Ş_veùÜ_g‘_–em’t
(
»moved_ÿts
, 
i
);

292 
	`­Ş_¡r_­³ndf
(&
¡r
, &
¡r_Ën
, " -%s", 
ÿt
);

297 ià(
¡r
)

298 
	`­Ş_¡r_Œim
(
¡r
);

299  
¡r
;

300 
	}
}

302 *
	$modif›d_mls_¿nge_to_¡ršg
(cÚ¡ 
pŞdiff_¿nge_t
 * 
¿nge
)

304 *
¡r
 = 
NULL
;

305 
­Ş_veùÜ_t
 *
Ëv–s
 = 
NULL
;

306 ià(!(
Ëv–s
 = 
	`pŞdiff_¿nge_g‘_Ëv–s
(
¿nge
)))

307 
”r
;

308 
size_t
 
i
, 
¡r_Ën
 = 0;

309 *
mš_£t_¡r
 = 
NULL
;

310 
size_t
 
mš_£t_¡r_Ën
 = 0;

312 
­Ş_veùÜ_t
 *
mš_£t_added
 = 
	`pŞdiff_¿nge_g‘_mš_added_ÿts
(
¿nge
);

313 
­Ş_veùÜ_t
 *
mš_£t_»moved
 = 
	`pŞdiff_¿nge_g‘_mš_»moved_ÿts
(
¿nge
);

314 
size_t
 
num_mš_added
 = 
	`­Ş_veùÜ_g‘_size
(
mš_£t_added
);

315 
size_t
 
num_mš_»moved
 = 
	`­Ş_veùÜ_g‘_size
(
mš_£t_»moved
);

316 ià(
mš_£t_added
 && 
num_mš_added
 > 0) {

317 *
mš_£t_added_¡r
 = 
	`veùÜ_to_¡ršg
(
mš_£t_added
, "", " +");

318 
	`­Ş_¡r_­³ndf
(&
mš_£t_¡r
, &
mš_£t_¡r_Ën
, "%s", 
mš_£t_added_¡r
);

319 
	`ä“
(
mš_£t_added_¡r
);

321 ià(
mš_£t_»moved
 && 
num_mš_»moved
 > 0) {

322 *
mš_£t_»moved_¡r
 = 
	`veùÜ_to_¡ršg
(
mš_£t_»moved
, "", " -");

323 
	`­Ş_¡r_­³ndf
(&
mš_£t_¡r
, &
mš_£t_¡r_Ën
, "%s%s", 
num_mš_added
 > 0 ? " " : "", 
mš_£t_»moved_¡r
);

324 
	`ä“
(
mš_£t_»moved_¡r
);

326 ià(
num_mš_added
 || 
num_mš_»moved
) {

327 *
tmp
 = 
	`¡rdup
(
mš_£t_¡r
);

328 
	`ä“
(
mš_£t_¡r
);

329 
mš_£t_¡r
 = 
NULL
;

330 
mš_£t_¡r_Ën
 = 0;

331 
	`­Ş_¡r_­³ndf
(&
mš_£t_¡r
, &
mš_£t_¡r_Ën
, "m{%s} ", 
tmp
);

332 
	`ä“
(
tmp
);

334 ià(
mš_£t_¡r
) {

335 
	`­Ş_¡r_­³ndf
(&
¡r
, &
¡r_Ën
, "%s", 
mš_£t_¡r
);

336 
	`ä“
(
mš_£t_¡r
);

339 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
Ëv–s
); ++i) {

340 
pŞdiff_Ëv–_t
 *
Ëv–
 = 
	`­Ş_veùÜ_g‘_–em’t
(
Ëv–s
, 
i
);

341 
pŞdiff_fÜm_e
 
fÜm
 = 
	`pŞdiff_Ëv–_g‘_fÜm
(
Ëv–
);

342 cÚ¡ *
Ëv–_¡r
 = 
	`pŞdiff_Ëv–_g‘_Çme
(
Ëv–
);

343 *
£p
 = 
NULL
, *
add_£p
 = " +", *
»move_£p
 = " -";

344 
fÜm
) {

345 
POLDIFF_FORM_ADDED
:

346 
£p
 = "+";

347 
add_£p
 = " ";

349 
POLDIFF_FORM_REMOVED
:

350 
£p
 = "-";

351 
»move_£p
 = " ";

353 
POLDIFF_FORM_MODIFIED
:

354 
£p
 = "*";

358 
	`as£¹
(0);

360 cÚ¡ 
­Ş_veùÜ_t
 *
unmod_ÿts
 = 
	`pŞdiff_Ëv–_g‘_unmodif›d_ÿts
(
Ëv–
);

361 cÚ¡ 
­Ş_veùÜ_t
 *
added_ÿts
 = 
	`pŞdiff_Ëv–_g‘_added_ÿts
(
Ëv–
);

362 cÚ¡ 
­Ş_veùÜ_t
 *
»moved_ÿts
 = 
	`pŞdiff_Ëv–_g‘_»moved_ÿts
(
Ëv–
);

363 
size_t
 
num_unmod_ÿts
 = 
	`­Ş_veùÜ_g‘_size
(
unmod_ÿts
);

364 
size_t
 
num_added_ÿts
 = 
	`­Ş_veùÜ_g‘_size
(
added_ÿts
);

365 
size_t
 
num_»moved_ÿts
 = 
	`­Ş_veùÜ_g‘_size
(
»moved_ÿts
);

366 
size_t
 
num_ÿts
 = 
num_unmod_ÿts
 + 
num_added_ÿts
 + 
num_»moved_ÿts
;

367 *
unmod_ÿts_¡r
 = 
	`veùÜ_to_¡ršg
(
unmod_ÿts
, "", " ");

368 *
added_ÿts_¡r
 = 
	`veùÜ_to_¡ršg
(
added_ÿts
, 
num_unmod_ÿts
 > 0 ? " " : "", 
add_£p
);

369 *
»moved_ÿts_¡r
 = 
	`veùÜ_to_¡ršg
(
»moved_ÿts
, 
num_added_ÿts
 > 0 ||

370 
num_unmod_ÿts
 > 0 ? " " : "", 
»move_£p
);

371 
	`­Ş_¡r_­³ndf
(&
¡r
, &
¡r_Ën
, "%s{%s%s%s%s%s} ", 
£p
, 
Ëv–_¡r
, 
num_ÿts
 > 0 ? ":" : "", 
unmod_ÿts_¡r
,

372 
added_ÿts_¡r
, 
»moved_ÿts_¡r
);

373 
	`ä“
(
unmod_ÿts_¡r
);

374 
	`ä“
(
added_ÿts_¡r
);

375 
	`ä“
(
»moved_ÿts_¡r
);

377 
	`­Ş_¡r_Œim
(
¡r
);

378  
¡r
;

379 
”r
:

380  
NULL
;

381 
	}
}

383 *
	$¿ng‘¿ns_to_¡ršg
(cÚ¡ *
¬g
, 
pŞdiff_fÜm_e
 
fÜm
, 
show_chªges
)

385 *
¡r
 = 
NULL
;

386 
size_t
 
¡r_Ën
 = 0;

387 
pŞdiff_¿nge_Œªs_t
 *
¹
 = (pŞdiff_¿nge_Œªs_ˆ*è
¬g
;

388 cÚ¡ 
pŞdiff_¿nge_t
 *
¿nge
 = 
	`pŞdiff_¿nge_Œªs_g‘_¿nge
(
¹
);

389 cÚ¡ 
­Ş_mls_¿nge_t
 *
mod_¿nge
 = 
	`pŞdiff_¿nge_g‘_modif›d_¿nge
(
¿nge
);

390 cÚ¡ 
­Ş_mls_¿nge_t
 *
Üig_¿nge
 = 
	`pŞdiff_¿nge_g‘_Üigš®_¿nge
(
¿nge
);

391 *
¿nge_¡r
 = 
NULL
;

392 
fÜm
) {

393 
POLDIFF_FORM_ADDED
:

394 
POLDIFF_FORM_ADD_TYPE
:

395 
¿nge_¡r
 = 
	`­Ş_mls_¿nge_»nd”
(
mod_pŞicy
, 
mod_¿nge
);

397 
POLDIFF_FORM_REMOVED
:

398 
POLDIFF_FORM_REMOVE_TYPE
:

399 
¿nge_¡r
 = 
	`­Ş_mls_¿nge_»nd”
(
Üig_pŞicy
, 
Üig_¿nge
);

401 
POLDIFF_FORM_MODIFIED
:

402 
¿nge_¡r
 = 
	`modif›d_mls_¿nge_to_¡ršg
(
¿nge
);

406 
	`as£¹
(0);

408 cÚ¡ *
sourû_ty³
 = 
	`pŞdiff_¿nge_Œªs_g‘_sourû_ty³
(
¹
);

409 cÚ¡ *
rg‘_ty³
 = 
	`pŞdiff_¿nge_Œªs_g‘_rg‘_ty³
(
¹
);

410 cÚ¡ *
rg‘_şass
 = 
	`pŞdiff_¿nge_Œªs_g‘_rg‘_şass
(
¹
);

411 ià(
show_chªges
) {

412 
	`­Ş_¡r_­³ndf
(&
¡r
, &
¡r_Ën
, "¿nge_Œªs™iÚ % % : % %s", 
sourû_ty³
, 
rg‘_ty³
, 
rg‘_şass
,

413 
¿nge_¡r
);

415 
	`­Ş_¡r_­³ndf
(&
¡r
, &
¡r_Ën
, "¿nge_Œªs™iÚ % % : %s", 
sourû_ty³
, 
rg‘_ty³
, 
rg‘_şass
);

417 
	`ä“
(
¿nge_¡r
);

418  
¡r
;

419 
	}
}

421 
	$bud_¿ng‘¿ns_vecs
()

423 
­Ş_veùÜ_t
 *
added_¿ng‘¿ns_ty³_v
 = 
	`­Ş_veùÜ_ü—‹
(
ä“
);

424 
­Ş_veùÜ_t
 *
»moved_¿ng‘¿ns_ty³_v
 = 
	`­Ş_veùÜ_ü—‹
(
ä“
);

425 
­Ş_veùÜ_t
 *
cÜ»ù_added_¿ng‘¿ns_ty³_v
 = 
	`¡ršg_¬¿y_to_veùÜ
(
added_¿ng‘¿ns_ty³
);

426 
­Ş_veùÜ_t
 *
cÜ»ù_»moved_¿ng‘¿ns_ty³_v
 = 
	`¡ršg_¬¿y_to_veùÜ
(
»moved_¿ng‘¿ns_ty³
);

428 *
¡r
 = 
NULL
, *
Çme_Úly
 = NULL;

429 
size_t
 
i
;

430 cÚ¡ *
™em
 = 
NULL
;

431 cÚ¡ 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

432 
v
 = 
	`pŞdiff_g‘_¿nge_Œªs_veùÜ
(
diff
);

433 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v
); ++i) {

434 
™em
 = 
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

435 
pŞdiff_fÜm_e
 
fÜm
 = 
	`pŞdiff_¿nge_Œªs_g‘_fÜm
(
™em
);

436 
¡r
 = 
	`¿ng‘¿ns_to_¡ršg
(
™em
, 
fÜm
, 1);

437 
fÜm
) {

438 
POLDIFF_FORM_ADDED
:

439 
	`­Ş_veùÜ_­³nd
(
added_v
, 
¡r
);

441 
POLDIFF_FORM_ADD_TYPE
:

442 
	`­Ş_veùÜ_­³nd
(
added_¿ng‘¿ns_ty³_v
, 
¡r
);

444 
POLDIFF_FORM_REMOVE_TYPE
:

445 
	`­Ş_veùÜ_­³nd
(
»moved_¿ng‘¿ns_ty³_v
, 
¡r
);

447 
POLDIFF_FORM_REMOVED
:

448 
	`­Ş_veùÜ_­³nd
(
»moved_v
, 
¡r
);

450 
POLDIFF_FORM_MODIFIED
:

451 
Çme_Úly
 = 
	`¿ng‘¿ns_to_¡ršg
(
™em
, 
fÜm
, 0);

452 
	`­Ş_veùÜ_­³nd
(
modif›d_Çme_Úly_v
, 
Çme_Úly
);

453 
	`­Ş_veùÜ_­³nd
(
modif›d_v
, 
¡r
);

457 
	`as£¹
(0);

460 
‹¡_»suÉ
;

461 
size_t
 
fœ¡_diff
 = 0;

462 
	`­Ş_veùÜ_sÜt
(
added_¿ng‘¿ns_ty³_v
, 
com·»_¡r
, 
NULL
);

463 
	`­Ş_veùÜ_sÜt
(
cÜ»ù_added_¿ng‘¿ns_ty³_v
, 
com·»_¡r
, 
NULL
);

464 
	`CU_ASSERT_FALSE
(
‹¡_»suÉ
 =

465 
	`­Ş_veùÜ_com·»
(
added_¿ng‘¿ns_ty³_v
, 
cÜ»ù_added_¿ng‘¿ns_ty³_v
, 
com·»_¡r
, 
NULL
,

466 &
fœ¡_diff
));

467 ià(
‹¡_»suÉ
) {

468 
	`´št_‹¡_çu»
(
added_¿ng‘¿ns_ty³_v
, 
cÜ»ù_added_¿ng‘¿ns_ty³_v
, 
fœ¡_diff
, "Added Dueo Types");

470 
	`­Ş_veùÜ_sÜt
(
»moved_¿ng‘¿ns_ty³_v
, 
com·»_¡r
, 
NULL
);

471 
	`­Ş_veùÜ_sÜt
(
cÜ»ù_»moved_¿ng‘¿ns_ty³_v
, 
com·»_¡r
, 
NULL
);

472 
	`CU_ASSERT_FALSE
(
‹¡_»suÉ
 =

473 
	`­Ş_veùÜ_com·»
(
»moved_¿ng‘¿ns_ty³_v
, 
cÜ»ù_»moved_¿ng‘¿ns_ty³_v
, 
com·»_¡r
, 
NULL
,

474 &
fœ¡_diff
));

475 ià(
‹¡_»suÉ
) {

476 
	`´št_‹¡_çu»
(
»moved_¿ng‘¿ns_ty³_v
, 
cÜ»ù_»moved_¿ng‘¿ns_ty³_v
, 
fœ¡_diff
,

479 
	`­Ş_veùÜ_de¡roy
(&
added_¿ng‘¿ns_ty³_v
);

480 
	`­Ş_veùÜ_de¡roy
(&
cÜ»ù_added_¿ng‘¿ns_ty³_v
);

481 
	`­Ş_veùÜ_de¡roy
(&
»moved_¿ng‘¿ns_ty³_v
);

482 
	`­Ş_veùÜ_de¡roy
(&
cÜ»ù_»moved_¿ng‘¿ns_ty³_v
);

484 
	}
}

486 
	$bud_Ëv–_vecs
()

488 *
¡r
 = 
NULL
, *
Çme_Úly
 = NULL;

489 
size_t
 
i
;

490 cÚ¡ *
™em
 = 
NULL
;

491 cÚ¡ 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

492 
v
 = 
	`pŞdiff_g‘_Ëv–_veùÜ
(
diff
);

493 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v
); ++i) {

494 
™em
 = 
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

495 
pŞdiff_fÜm_e
 
fÜm
 = 
	`pŞdiff_ÿt_g‘_fÜm
(
™em
);

496 
¡r
 = 
	`Ëv–_to_¡ršg
(
™em
, 
fÜm
, 1);

497 
fÜm
) {

498 
POLDIFF_FORM_ADDED
:

499 
	`­Ş_veùÜ_­³nd
(
added_v
, 
¡r
);

501 
POLDIFF_FORM_REMOVED
:

502 
	`­Ş_veùÜ_­³nd
(
»moved_v
, 
¡r
);

504 
POLDIFF_FORM_MODIFIED
:

505 
Çme_Úly
 = 
	`Ëv–_to_¡ršg
(
™em
, 
fÜm
, 0);

506 
	`­Ş_veùÜ_­³nd
(
modif›d_Çme_Úly_v
, 
Çme_Úly
);

507 
	`­Ş_veùÜ_­³nd
(
modif›d_v
, 
¡r
);

511 
	`as£¹
(0);

514 
	}
}

516 *
	$mls_u£r_to_¡ršg
(cÚ¡ *
¬g
, 
pŞdiff_fÜm_e
 
fÜm
, 
show_chªges
)

518 
pŞdiff_u£r_t
 *
u
 = (pŞdiff_u£r_ˆ*è
¬g
;

519 *
¡r
 = 
NULL
, *
dËv–_¡r
 = NULL, *
¿nge_¡r
 = NULL, *
rŞes_¡r
 = NULL;

520 
size_t
 
¡r_Ën
 = 0, 
dËv–_¡r_Ën
 = 0, 
¿nge_¡r_Ën
 = 0, 
rŞes_¡r_Ën
 = 0;

521 cÚ¡ 
pŞdiff_¿nge_t
 *
¿nge
 = 
	`pŞdiff_u£r_g‘_¿nge
(
u
);

522 cÚ¡ 
pŞdiff_Ëv–_t
 *
Üig_Ëv–
 = 
	`pŞdiff_u£r_g‘_Üigš®_dæev–
(
u
);

523 cÚ¡ 
pŞdiff_Ëv–_t
 *
mod_Ëv–
 = 
	`pŞdiff_u£r_g‘_modif›d_dæev–
(
u
);

524 
pŞdiff_fÜm_e
 
Üig_fÜm
 = 
	`pŞdiff_Ëv–_g‘_fÜm
(
Üig_Ëv–
);

525 
pŞdiff_fÜm_e
 
mod_fÜm
 = 
	`pŞdiff_Ëv–_g‘_fÜm
(
mod_Ëv–
);

526 *
Üig_Ëv–_¡r
 = 
	`Ëv–_to_¡ršg
(
Üig_Ëv–
, 
Üig_fÜm
, 1);

527 *
mod_Ëv–_¡r
 = 
	`Ëv–_to_¡ršg
(
mod_Ëv–
, 
mod_fÜm
, 1);

529 ià(
mod_Ëv–_¡r
 && 
Üig_Ëv–_¡r
) {

530 
	`­Ş_¡r_­³ndf
(&
dËv–_¡r
, &
dËv–_¡r_Ën
, "d[+% -%s] ", 
mod_Ëv–_¡r
, 
Üig_Ëv–_¡r
);

533 ià(!
mod_Ëv–_¡r
 && 
Üig_Ëv–_¡r
) {

534 
	`­Ş_¡r_­³ndf
(&
dËv–_¡r
, &
dËv–_¡r_Ën
, "d[%s] ", 
Üig_Ëv–_¡r
);

535 } ià(!
Üig_Ëv–_¡r
 && 
mod_Ëv–_¡r
) {

537 
	`CU_ASSERT_FALSE
(1);

539 ià((
¿nge_¡r
 = 
	`modif›d_mls_¿nge_to_¡ršg
(
¿nge
)è!ğ
NULL
) {

540 *
tmp
 = 
	`¡rdup
(
¿nge_¡r
);

541 
	`ä“
(
¿nge_¡r
);

542 
¿nge_¡r
 = 
NULL
;

543 
¿nge_¡r_Ën
 = 0;

544 
	`­Ş_¡r_­³ndf
(&
¿nge_¡r
, &
¿nge_¡r_Ën
, "¿nge[%s] ", 
tmp
);

545 
	`ä“
(
tmp
);

547 *
added_rŞes_¡r
 = 
	`veùÜ_to_¡ršg
(
	`pŞdiff_u£r_g‘_added_rŞes
(
u
), "", " +");

548 *
»moved_rŞes_¡r
 = 
	`veùÜ_to_¡ršg
(
	`pŞdiff_u£r_g‘_»moved_rŞes
(
u
), "", " -");

549 ià(
	`¡¾’
(
added_rŞes_¡r
è> 0 || sŒËn(
»moved_rŞes_¡r
) > 0) {

550 
	`­Ş_¡r_­³ndf
(&
rŞes_¡r
, &
rŞes_¡r_Ën
, "rŞes[%s%s] ", 
added_rŞes_¡r
 ?‡dded_roles_str : "",

551 
»moved_rŞes_¡r
 ?„emoved_roles_str : "");

553 cÚ¡ *
u£r_Çme
 = 
	`pŞdiff_u£r_g‘_Çme
(
u
);

554 ià(
show_chªges
) {

555 
	`­Ş_¡r_­³ndf
(&
¡r
, &
¡r_Ën
, "%s: %s%s%s", 
u£r_Çme
, 
dËv–_¡r
 ? dËv–_¡¸: "", 
¿nge_¡r
 ?„ange_str : "",

556 
rŞes_¡r
 ?„oles_str : "");

558 
	`­Ş_¡r_­³ndf
(&
¡r
, &
¡r_Ën
, "%s", 
u£r_Çme
);

561 
	`ä“
(
¿nge_¡r
);

562 
	`ä“
(
rŞes_¡r
);

563 
	`ä“
(
dËv–_¡r
);

564 
	`ä“
(
mod_Ëv–_¡r
);

565 
	`ä“
(
Üig_Ëv–_¡r
);

566 
	`ä“
(
added_rŞes_¡r
);

567 
	`ä“
(
»moved_rŞes_¡r
);

568  
¡r
;

569 
	}
}

571 
	$bud_u£r_vecs
()

573 *
¡r
 = 
NULL
, *
Çme_Úly
;

574 
size_t
 
i
;

575 cÚ¡ *
™em
 = 
NULL
;

576 cÚ¡ 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

577 
v
 = 
	`pŞdiff_g‘_u£r_veùÜ
(
diff
);

578 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v
); ++i) {

579 
™em
 = 
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

580 
pŞdiff_fÜm_e
 
fÜm
 = 
	`pŞdiff_ÿt_g‘_fÜm
(
™em
);

581 
¡r
 = 
	`mls_u£r_to_¡ršg
(
™em
, 
fÜm
, 1);

582 
fÜm
) {

583 
POLDIFF_FORM_ADDED
:

584 
	`­Ş_veùÜ_­³nd
(
added_v
, 
¡r
);

586 
POLDIFF_FORM_REMOVED
:

587 
	`­Ş_veùÜ_­³nd
(
»moved_v
, 
¡r
);

589 
POLDIFF_FORM_MODIFIED
:

590 
Çme_Úly
 = 
	`mls_u£r_to_¡ršg
(
™em
, 
fÜm
, 0);

591 
	`­Ş_veùÜ_­³nd
(
modif›d_Çme_Úly_v
, 
Çme_Úly
);

592 
	`­Ş_veùÜ_­³nd
(
modif›d_v
, 
¡r
);

596 
	`as£¹
(0);

598 
¡r
 = 
NULL
;

600 
	}
}

602 
	$mls_ÿ‹gÜy_‹¡s
()

604 
‹¡_numb”s_e
 
‹¡_num
 = 
MLS_CATEGORY
;

605 
pŞdiff_‹¡_ªsw”s_t
 *
ªsw”s
 =

606 
	`š™_ªsw”_veùÜs
(
added_ÿ‹gÜ›s
, 
»moved_ÿ‹gÜ›s
, 
unchªged_ÿ‹gÜ›s
, 
modif›d_ÿ‹gÜ›s
);

607 
	`run_‹¡
(
NULL
, 
ªsw”s
, 
‹¡_num
);

608 
	`ş—nup_‹¡
(
ªsw”s
);

609 
	}
}

611 
	$mls_¿ng‘¿ns_‹¡s
()

613 
‹¡_numb”s_e
 
‹¡_num
 = 
MLS_RANGETRANS
;

614 
pŞdiff_‹¡_ªsw”s_t
 *
ªsw”s
 =

615 
	`š™_ªsw”_veùÜs
(
added_¿ng‘¿ns
, 
»moved_¿ng‘¿ns
, 
unchªged_¿ng‘¿ns
, 
modif›d_¿ng‘¿ns
);

616 
	`run_‹¡
(
NULL
, 
ªsw”s
, 
‹¡_num
);

617 
	`ş—nup_‹¡
(
ªsw”s
);

618 
	}
}

620 
	$mls_Ëv–_‹¡s
()

622 
‹¡_numb”s_e
 
‹¡_num
 = 
MLS_LEVEL
;

623 
pŞdiff_‹¡_ªsw”s_t
 *
ªsw”s
 = 
	`š™_ªsw”_veùÜs
(
added_Ëv–s
, 
»moved_Ëv–s
, 
unchªged_Ëv–s
, 
modif›d_Ëv–s
);

624 
	`run_‹¡
(
NULL
, 
ªsw”s
, 
‹¡_num
);

625 
	`ş—nup_‹¡
(
ªsw”s
);

626 
	}
}

628 
	$mls_u£r_‹¡s
()

630 
‹¡_numb”s_e
 
‹¡_num
 = 
MLS_USER
;

631 
pŞdiff_‹¡_ªsw”s_t
 *
ªsw”s
 =

632 
	`š™_ªsw”_veùÜs
(
added_u£rs_mls
, 
»moved_u£rs_mls
, 
unchªged_u£rs_mls
, 
modif›d_u£rs_mls
);

633 
	`run_‹¡
(
NULL
, 
ªsw”s
, 
‹¡_num
);

634 
	`ş—nup_‹¡
(
ªsw”s
);

635 
	}
}

	@libpoldiff/tests/mls-tests.h

25 #iâdeà
MLS_TEST


26 
	#MLS_TEST


	)

27 
mls_‹¡_š™
();

28 
mls_‹¡_ş—nup
();

30 
mls_ÿ‹gÜy_‹¡s
();

31 
mls_u£r_‹¡s
();

32 
mls_¿ng‘¿ns_‹¡s
();

33 
mls_Ëv–_‹¡s
();

34 
bud_ÿ‹gÜy_vecs
();

35 
bud_¿ng‘¿ns_vecs
();

36 
bud_Ëv–_vecs
();

37 
bud_u£r_vecs
();

	@libpoldiff/tests/nomls-tests.c

25 
	~<cÚfig.h
>

27 
	~"libpŞdiff-‹¡s.h
"

28 
	~"nomls-‹¡s.h
"

29 
	~"pŞicy-defs.h
"

30 
	~<CUn™/Basic.h
>

31 
	~<CUn™/Te¡DB.h
>

33 
	~<pŞdiff/pŞdiff.h
>

34 
	~<­Ş/ut.h
>

35 
	~<¡dboŞ.h
>

36 
	~<¡dio.h
>

37 
	~<”ºo.h
>

38 
	~<g‘İt.h
>

39 
	~<¡dšt.h
>

40 
	~<¡dlib.h
>

41 
	~<¡ršg.h
>

43 *
	gnomls_unchªged_u£rs
[] = {

59 
NULL


61 
­Ş_veùÜ_t
 *
	gunchªged_u£rs_v
;

62 
­Ş_veùÜ_t
 *
	gchªged_u£rs_v
;

64 *
	gnomls_chªged_u£rs
[] = {

69 
NULL


72 
	$nomls_‹¡_š™
()

74 ià(!(
diff
 = 
	`š™_pŞdiff
(
NOMLS_ORIG_POLICY
, 
NOMLS_MOD_POLICY
))) {

79 
	}
}

81 
	$bud_nomls_vecs
()

83 cÚ¡ *
™em
;

84 cÚ¡ 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

85 
size_t
 
i
, 
¡r_Ën
 = 0;

86 *
¡r
 = 
NULL
;

87 
v
 = 
	`pŞdiff_g‘_u£r_veùÜ
(
diff
);

88 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v
); ++i) {

89 
™em
 = 
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

90 
pŞdiff_u£r_t
 *
u
 = (pŞdiff_u£r_ˆ*è
™em
;

91 cÚ¡ *
Çme
 = 
	`pŞdiff_u£r_g‘_Çme
(
u
);

92 cÚ¡ 
­Ş_veùÜ_t
 *
added_rŞes
 = 
	`pŞdiff_u£r_g‘_added_rŞes
(
u
);

93 cÚ¡ 
­Ş_veùÜ_t
 *
»moved_rŞes
 = 
	`pŞdiff_u£r_g‘_»moved_rŞes
(
u
);

94 ià(
	`­Ş_veùÜ_g‘_size
(
added_rŞes
è=ğ0 &&‡pŞ_veùÜ_g‘_size(
»moved_rŞes
) == 0) {

95 
	`­Ş_veùÜ_­³nd
(
unchªged_u£rs_v
, 
	`¡rdup
(
Çme
));

97 *
added_rŞes_¡r
 = 
	`veùÜ_to_¡ršg
(
added_rŞes
, "", " +");

98 *
»moved_rŞes_¡r
 = 
	`veùÜ_to_¡ršg
(
»moved_rŞes
, "-", " ");

99 
	`­Ş_¡r_­³ndf
(&
¡r
, &
¡r_Ën
, "% %s%s", 
Çme
, 
added_rŞes_¡r
, 
»moved_rŞes_¡r
);

100 
	`ä“
(
added_rŞes_¡r
);

101 
	`ä“
(
»moved_rŞes_¡r
);

102 
	`­Ş_¡r_Œim
(
¡r
);

103 
	`­Ş_veùÜ_­³nd
(
chªged_u£rs_v
, 
¡r
);

104 
¡r
 = 
NULL
;

105 
¡r_Ën
 = 0;

108 
	}
}

109 
	$nomls_‹¡s
()

111 
size_t
 
fœ¡_diff
 = 0;

112 
‹¡_»suÉ
;

113 
unchªged_u£rs_v
 = 
	`­Ş_veùÜ_ü—‹
(
ä“
);

114 
chªged_u£rs_v
 = 
	`­Ş_veùÜ_ü—‹
(
ä“
);

116 
­Ş_veùÜ_t
 *
cÜ»ù_unchªged_u£rs_v
 = 
	`¡ršg_¬¿y_to_veùÜ
(
nomls_unchªged_u£rs
);

117 
­Ş_veùÜ_t
 *
cÜ»ù_chªged_u£rs_v
 = 
	`¡ršg_¬¿y_to_veùÜ
(
nomls_chªged_u£rs
);

119 
	`bud_nomls_vecs
();

120 
	`­Ş_veùÜ_sÜt
(
unchªged_u£rs_v
, 
com·»_¡r
, 
NULL
);

121 
	`­Ş_veùÜ_sÜt
(
cÜ»ù_unchªged_u£rs_v
, 
com·»_¡r
, 
NULL
);

122 
	`CU_ASSERT_FALSE
(
‹¡_»suÉ
 =

123 
	`­Ş_veùÜ_com·»
(
unchªged_u£rs_v
, 
cÜ»ù_unchªged_u£rs_v
, 
com·»_¡r
, 
NULL
, &
fœ¡_diff
));

124 ià(
‹¡_»suÉ
) {

125 
	`´št_‹¡_çu»
(
unchªged_u£rs_v
, 
cÜ»ù_unchªged_u£rs_v
, 
fœ¡_diff
, "Unchanged MLS Users");

127 
	`­Ş_veùÜ_sÜt
(
chªged_u£rs_v
, 
com·»_¡r
, 
NULL
);

128 
	`­Ş_veùÜ_sÜt
(
cÜ»ù_chªged_u£rs_v
, 
com·»_¡r
, 
NULL
);

129 
	`CU_ASSERT_FALSE
(
‹¡_»suÉ
 =

130 
	`­Ş_veùÜ_com·»
(
chªged_u£rs_v
, 
cÜ»ù_chªged_u£rs_v
, 
com·»_¡r
, 
NULL
, &
fœ¡_diff
));

131 ià(
‹¡_»suÉ
) {

132 
	`´št_‹¡_çu»
(
chªged_u£rs_v
, 
cÜ»ù_chªged_u£rs_v
, 
fœ¡_diff
, "Changed MLS Users");

134 
	`­Ş_veùÜ_de¡roy
(&
unchªged_u£rs_v
);

135 
	`­Ş_veùÜ_de¡roy
(&
chªged_u£rs_v
);

136 
	`­Ş_veùÜ_de¡roy
(&
cÜ»ù_unchªged_u£rs_v
);

137 
	`­Ş_veùÜ_de¡roy
(&
cÜ»ù_chªged_u£rs_v
);

139 
	}
}

	@libpoldiff/tests/nomls-tests.h

25 #iâdeà
NOMLS_TEST


26 
	#NOMLS_TEST


	)

27 
nomls_‹¡_š™
();

28 
nomls_‹¡_ş—nup
();

30 
nomls_‹¡s
();

31 
nomls_unchªged_‹¡
();

	@libpoldiff/tests/policy-defs.h

25 #iâdeà
POLICY_DEFS


26 
	#POLICY_DEFS


	)

28 
	~<cÚfig.h
>

30 
	#POLICY_ROOT
 
TEST_POLICIES
 "/£toŞs-3.2/£diff"

	)

32 
	#COMPONENTS_ORIG_POLICY
 (
POLICY_ROOT
 "/‹¡šg-compÚ’t-Üig.cÚf")

	)

33 
	#COMPONENTS_MOD_POLICY
 (
POLICY_ROOT
 "/‹¡šg-compÚ’t-mod.cÚf")

	)

35 
	#RULES_ORIG_POLICY
 (
POLICY_ROOT
 "/‹¡šg-ruËs-Üig.cÚf")

	)

36 
	#RULES_MOD_POLICY
 (
POLICY_ROOT
 "/‹¡šg-ruËs-mod.cÚf")

	)

38 
	#MLS_ORIG_POLICY
 (
POLICY_ROOT
 "/‹¡šg-mls-Üig.cÚf")

	)

39 
	#MLS_MOD_POLICY
 (
POLICY_ROOT
 "/‹¡šg-mls-mod.cÚf")

	)

41 
	#NOMLS_ORIG_POLICY
 (
POLICY_ROOT
 "/‹¡šg-mls-Üig.cÚf")

	)

42 
	#NOMLS_MOD_POLICY
 (
POLICY_ROOT
 "/‹¡šg-mls-mod-nomls.cÚf")

	)

	@libpoldiff/tests/rules-tests.c

25 
	~<cÚfig.h
>

27 
	~"libpŞdiff-‹¡s.h
"

28 
	~"ruËs-‹¡s.h
"

29 
	~"pŞicy-defs.h
"

30 
	~<CUn™/Basic.h
>

31 
	~<CUn™/Te¡DB.h
>

33 
	~<pŞdiff/pŞdiff.h
>

34 
	~<­Ş/pŞicy.h
>

35 
	~<­Ş/veùÜ.h
>

36 
	~<­Ş/ut.h
>

38 
	~<as£¹.h
>

39 
	~<¡dio.h
>

40 
	~<”ºo.h
>

41 
	~<g‘İt.h
>

42 
	~<¡dšt.h
>

43 
	~<¡dlib.h
>

44 
	~<¡ršg.h
>

46 
­Ş_veùÜ_t
 *
	gadded_ty³_ruËs_v
;

47 
­Ş_veùÜ_t
 *
	g»moved_ty³_ruËs_v
;

48 
­Ş_veùÜ_t
 *
	gcÜ»ù_added_ty³_ruËs_v
;

49 
­Ş_veùÜ_t
 *
	gcÜ»ù_»moved_ty³_ruËs_v
;

51 *
	gunchªged_avruËs
[] = {

55 
NULL


57 *
	gadded_avruËs
[] = {

64 
NULL


66 *
	g»moved_avruËs
[] = {

78 
NULL


81 *
	gmodif›d_avruËs
[] = {

89 
NULL


92 *
	gadded_ty³_avruËs
[] = {

171 
NULL


173 *
	g»moved_ty³_avruËs
[] = {

261 
NULL


264 *
	gunchªged_rŞ—ÎowruËs
[] = {

270 
NULL


272 *
	gadded_rŞ—ÎowruËs
[] = {

275 
NULL


277 *
	g»moved_rŞ—ÎowruËs
[] = {

280 
NULL


282 *
	gmodif›d_rŞ—ÎowruËs
[] = {

292 
NULL


295 *
	gunchªged_rŞ‘¿ns_ruËs
[] = {

301 
NULL


303 *
	gadded_rŞ‘¿ns_ruËs
[] = {

307 
NULL


309 *
	g»moved_rŞ‘¿ns_ruËs
[] = {

314 
NULL


316 *
	gmodif›d_rŞ‘¿ns_ruËs
[] = {

319 
NULL


321 *
	gadded_rŞ‘¿ns_ty³
[] = {

328 
NULL


331 *
	g»moved_rŞ‘¿ns_ty³
[] = {

336 
NULL


339 *
	gunchªged_‹ruËs
[] = {

342 
NULL


344 *
	gadded_‹ruËs
[] = {

348 
NULL


350 *
	g»moved_‹ruËs
[] = {

356 
NULL


358 *
	gadded_ty³_‹ruËs
[] = {

381 
NULL


383 *
	g»moved_ty³_‹ruËs
[] = {

425 
NULL


428 *
	gmodif›d_‹ruËs
[] = {

430 
NULL


433 *
	$g‘_ruË_modifiÿtiÚ_¡r
(cÚ¡ 
­Ş_veùÜ_t
 * 
unmodif›d
, cÚ¡‡pŞ_veùÜ_ˆ* 
added
, cÚ¡‡pŞ_veùÜ_ˆ* 
»moved
,

434 
pŞdiff_fÜm_e
 
fÜm
, 
show_chªges
)

436 *
³rm_add_ch¬
 = "+", *
³rm_»move_ch¬
 = "-";

437 
­Ş_veùÜ_t
 *
added_cİy
 = 
	`sh®low_cİy_¡r_vec_ªd_sÜt
(
added
);

438 
­Ş_veùÜ_t
 *
»moved_cİy
 = 
	`sh®low_cİy_¡r_vec_ªd_sÜt
(
»moved
);

439 
­Ş_veùÜ_t
 *
unmodif›d_cİy
 = 
	`sh®low_cİy_¡r_vec_ªd_sÜt
(
unmodif›d
);

440 
”rÜ
 = 0;

441 
fÜm
) {

442 
POLDIFF_FORM_ADDED
:

443 
POLDIFF_FORM_ADD_TYPE
:

444 
³rm_add_ch¬
 = "";

446 
POLDIFF_FORM_REMOVE_TYPE
:

447 
POLDIFF_FORM_REMOVED
:

448 
³rm_»move_ch¬
 = "";

450 
POLDIFF_FORM_MODIFIED
:

455 
	`as£¹
(0);

457 
size_t
 
i
, 
¡r_Ën
;

458 *
³rm_Çme
 = 
NULL
, *
¡r
 = NULL;

459 
i
 = 0; 
unmodif›d_cİy
 !ğ
NULL
 && i < 
	`­Ş_veùÜ_g‘_size
(unmodified_copy); ++i) {

460 *
unmod_³rm
 = 
	`­Ş_veùÜ_g‘_–em’t
(
unmodif›d_cİy
, 
i
);

461 
	`­Ş_¡r_­³ndf
(&
¡r
, &
¡r_Ën
, " %s", 
unmod_³rm
);

463 ià(
show_chªges
) {

464 
i
 = 0; 
added
 !ğ
NULL
 && i < 
	`­Ş_veùÜ_g‘_size
(added); i++) {

465 
³rm_Çme
 = (*)
	`­Ş_veùÜ_g‘_–em’t
(
added_cİy
, 
i
);

466 ià(
	`­Ş_¡r_­³ndf
(&
¡r
, &
¡r_Ën
, " %s%s", 
³rm_add_ch¬
, 
³rm_Çme
) < 0) {

467 
”rÜ
 = 
”ºo
;

468 
”r
;

471 
i
 = 0; 
»moved
 !ğ
NULL
 && i < 
	`­Ş_veùÜ_g‘_size
(
»moved_cİy
); i++) {

472 
³rm_Çme
 = (*)
	`­Ş_veùÜ_g‘_–em’t
(
»moved_cİy
, 
i
);

473 ià(
	`­Ş_¡r_­³ndf
(&
¡r
, &
¡r_Ën
, " %s%s", 
³rm_»move_ch¬
, 
³rm_Çme
) < 0) {

474 
”rÜ
 = 
”ºo
;

475 
”r
;

479 
	`­Ş_veùÜ_de¡roy
(&
added_cİy
);

480 
	`­Ş_veùÜ_de¡roy
(&
»moved_cİy
);

481 
	`­Ş_veùÜ_de¡roy
(&
unmodif›d_cİy
);

482  
¡r
;

483 
”r
:

484 
	`ä“
(
¡r
);

485  
NULL
;

486 
	}
}

488 *
	$avruË_to_¡ršg
(cÚ¡ *
¬g
, 
pŞdiff_fÜm_e
 
fÜm
, 
show_chªges
)

490 cÚ¡ 
pŞdiff_avruË_t
 *
avr
 = (cÚ¡…Şdiff_avruË_ˆ*)
¬g
;

491 *
¡r
 = 
NULL
;

492 
size_t
 
¡r_Ën
 = 0;

493 
ušt32_t
 
ruË_ty³
 = 
	`pŞdiff_avruË_g‘_ruË_ty³
(
avr
);

494 cÚ¡ *
ruË_ty³_¡r
 = 
	`­Ş_ruË_ty³_to_¡r
(
ruË_ty³
);

495 cÚ¡ *
rg‘_ty³
 = 
	`pŞdiff_avruË_g‘_rg‘_ty³
(
avr
);

496 cÚ¡ *
sourû_ty³
 = 
	`pŞdiff_avruË_g‘_sourû_ty³
(
avr
);

497 cÚ¡ *
objeù_şass
 = 
	`pŞdiff_avruË_g‘_objeù_şass
(
avr
);

498 
	`­Ş_¡r_­³ndf
(&
¡r
, &
¡r_Ën
, "% % % : %s", 
ruË_ty³_¡r
, 
sourû_ty³
, 
rg‘_ty³
, 
objeù_şass
);

499 ià(
show_chªges
) {

500 cÚ¡ 
­Ş_veùÜ_t
 *
unmodif›d_³rms
 = 
	`pŞdiff_avruË_g‘_unmodif›d_³rms
(
avr
);

501 cÚ¡ 
­Ş_veùÜ_t
 *
»moved_³rms
 = 
	`pŞdiff_avruË_g‘_»moved_³rms
(
avr
);

502 cÚ¡ 
­Ş_veùÜ_t
 *
added_³rms
 = 
	`pŞdiff_avruË_g‘_added_³rms
(
avr
);

503 *
³rm_¡r
 = 
	`g‘_ruË_modifiÿtiÚ_¡r
(
unmodif›d_³rms
, 
added_³rms
, 
»moved_³rms
, 
fÜm
, 
show_chªges
);

504 
	`­Ş_¡r_­³ndf
(&
¡r
, &
¡r_Ën
, "%s", 
³rm_¡r
);

505 
	`ä“
(
³rm_¡r
);

507  
¡r
;

508 
	}
}

510 *
	$‹ruË_to_¡ršg
(cÚ¡ *
¬g
, 
pŞdiff_fÜm_e
 
fÜm
, 
show_chªges
)

512 
pŞdiff_‹ruË_t
 *
‹r
 = (pŞdiff_‹ruË_ˆ*è
¬g
;

513 *
¡r
 = 
NULL
;

514 
size_t
 
¡r_Ën
 = 0;

515 
ušt32_t
 
ruË_ty³
 = 
	`pŞdiff_‹ruË_g‘_ruË_ty³
(
‹r
);

516 cÚ¡ *
ruË_ty³_¡r
 = 
	`­Ş_ruË_ty³_to_¡r
(
ruË_ty³
);

517 cÚ¡ *
rg‘_ty³
 = 
	`pŞdiff_‹ruË_g‘_rg‘_ty³
(
‹r
);

518 cÚ¡ *
sourû_ty³
 = 
	`pŞdiff_‹ruË_g‘_sourû_ty³
(
‹r
);

519 cÚ¡ *
objeù_şass
 = 
	`pŞdiff_‹ruË_g‘_objeù_şass
(
‹r
);

520 cÚ¡ *
deçuÉ_ty³
;

521 
fÜm
) {

522 
POLDIFF_FORM_ADDED
:

523 
POLDIFF_FORM_ADD_TYPE
:

524 
deçuÉ_ty³
 = 
	`pŞdiff_‹ruË_g‘_modif›d_deçuÉ
(
‹r
);

526 
POLDIFF_FORM_REMOVED
:

527 
POLDIFF_FORM_REMOVE_TYPE
:

528 
POLDIFF_FORM_MODIFIED
:

529 
deçuÉ_ty³
 = 
	`pŞdiff_‹ruË_g‘_Üigš®_deçuÉ
(
‹r
);

533 
	`as£¹
(0);

535 ià(
fÜm
 =ğ
POLDIFF_FORM_MODIFIED
 && 
show_chªges
) {

536 cÚ¡ *
Üig_deçuÉ
 = 
	`pŞdiff_‹ruË_g‘_Üigš®_deçuÉ
(
‹r
);

537 cÚ¡ *
mod_deçuÉ
 = 
	`pŞdiff_‹ruË_g‘_modif›d_deçuÉ
(
‹r
);

538 
	`­Ş_¡r_­³ndf
(&
¡r
, &
¡r_Ën
, "% % % : % +% -%s", 
ruË_ty³_¡r
, 
sourû_ty³
, 
rg‘_ty³
, 
objeù_şass
,

539 
mod_deçuÉ
, 
Üig_deçuÉ
);

541 
	`­Ş_¡r_­³ndf
(&
¡r
, &
¡r_Ën
, "% % % : % %s", 
ruË_ty³_¡r
, 
sourû_ty³
, 
rg‘_ty³
, 
objeù_şass
,

542 
deçuÉ_ty³
);

543  
¡r
;

544 
	}
}

546 *
	$rŞ‘¿ns_to_¡ršg
(cÚ¡ *
¬g
, 
pŞdiff_fÜm_e
 
fÜm
, 
show_chªges
)

548 
pŞdiff_rŞe_Œªs_t
 *
¹
 = (pŞdiff_rŞe_Œªs_ˆ*è
¬g
;

549 *
¡r
 = 
NULL
;

550 
size_t
 
¡r_Ën
 = 0;

551 cÚ¡ *
sourû_rŞe
 = 
	`pŞdiff_rŞe_Œªs_g‘_sourû_rŞe
(
¹
);

552 cÚ¡ *
rg‘_ty³
 = 
	`pŞdiff_rŞe_Œªs_g‘_rg‘_ty³
(
¹
);

553 
	`­Ş_¡r_­³ndf
(&
¡r
, &
¡r_Ën
, "rŞe_Œªs™iÚ % %s", 
sourû_rŞe
, 
rg‘_ty³
);

554 ià(
show_chªges
) {

555 cÚ¡ *
Üig_deçuÉ
 = 
	`pŞdiff_rŞe_Œªs_g‘_Üigš®_deçuÉ
(
¹
);

556 cÚ¡ *
mod_deçuÉ
 = 
	`pŞdiff_rŞe_Œªs_g‘_modif›d_deçuÉ
(
¹
);

558 
fÜm
) {

559 
POLDIFF_FORM_ADDED
:

560 
POLDIFF_FORM_ADD_TYPE
:

561 
	`­Ş_¡r_­³ndf
(&
¡r
, &
¡r_Ën
, " %s", 
mod_deçuÉ
);

563 
POLDIFF_FORM_REMOVED
:

564 
POLDIFF_FORM_REMOVE_TYPE
:

565 
	`­Ş_¡r_­³ndf
(&
¡r
, &
¡r_Ën
, " %s", 
Üig_deçuÉ
);

567 
POLDIFF_FORM_MODIFIED
:

568 
	`­Ş_¡r_­³ndf
(&
¡r
, &
¡r_Ën
, " { +% -% }", 
mod_deçuÉ
, 
Üig_deçuÉ
);

572 
	`as£¹
(0);

575  
¡r
;

576 
	}
}

578 *
	$rŞ—Îow_to_¡ršg
(cÚ¡ *
¬g
, 
pŞdiff_fÜm_e
 
fÜm
, 
show_chªges
)

580 
pŞdiff_rŞe_®low_t
 *
¿t
 = (pŞdiff_rŞe_®low_ˆ*è
¬g
;

581 *
¡r
 = 
NULL
, *
Üig_rŞes_¡r
 = NULL;

582 
size_t
 
¡r_Ën
 = 0, 
Üig_rŞes_¡r_Ën
 = 0;

583 cÚ¡ *
Çme
 = 
	`pŞdiff_rŞe_®low_g‘_Çme
(
¿t
);

584 cÚ¡ 
­Ş_veùÜ_t
 *
Üig_rŞes
;

585 
fÜm
) {

586 
POLDIFF_FORM_ADDED
:

587 
Üig_rŞes
 = 
	`pŞdiff_rŞe_®low_g‘_added_rŞes
(
¿t
);

589 
POLDIFF_FORM_REMOVED
:

590 
Üig_rŞes
 = 
	`pŞdiff_rŞe_®low_g‘_»moved_rŞes
(
¿t
);

592 
POLDIFF_FORM_MODIFIED
:

593 
Üig_rŞes
 = 
	`pŞdiff_rŞe_®low_g‘_unmodif›d_rŞes
(
¿t
);

597 
	`as£¹
(0);

599 
size_t
 
i
;

600 
size_t
 
num_Üig_rŞes
 = 
	`­Ş_veùÜ_g‘_size
(
Üig_rŞes
);

601 cÚ¡ *
fmt
;

602 ià(
num_Üig_rŞes
 > 1 || (
show_chªges
 && 
fÜm
 =ğ
POLDIFF_FORM_MODIFIED
))

603 
fmt
 = "allow %s {%s }";

605 
fmt
 = "allow %s%s";

606 
i
 = 0; i < 
num_Üig_rŞes
; ++i) {

607 *
rŞe
 = 
	`­Ş_veùÜ_g‘_–em’t
(
Üig_rŞes
, 
i
);

608 
	`­Ş_¡r_­³ndf
(&
Üig_rŞes_¡r
, &
Üig_rŞes_¡r_Ën
, " %s", 
rŞe
);

610 ià(
show_chªges
 && 
fÜm
 =ğ
POLDIFF_FORM_MODIFIED
) {

611 cÚ¡ 
­Ş_veùÜ_t
 *
added_rŞe_v
 = 
	`pŞdiff_rŞe_®low_g‘_added_rŞes
(
¿t
);

612 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
added_rŞe_v
); ++i) {

613 *
added_rŞe
 = 
	`­Ş_veùÜ_g‘_–em’t
(
added_rŞe_v
, 
i
);

614 
	`­Ş_¡r_­³ndf
(&
Üig_rŞes_¡r
, &
Üig_rŞes_¡r_Ën
, " +%s", 
added_rŞe
);

616 cÚ¡ 
­Ş_veùÜ_t
 *
»moved_rŞe_v
 = 
	`pŞdiff_rŞe_®low_g‘_»moved_rŞes
(
¿t
);

617 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
»moved_rŞe_v
); ++i) {

618 *
»moved_rŞe
 = 
	`­Ş_veùÜ_g‘_–em’t
(
»moved_rŞe_v
, 
i
);

619 
	`­Ş_¡r_­³ndf
(&
Üig_rŞes_¡r
, &
Üig_rŞes_¡r_Ën
, " -%s", 
»moved_rŞe
);

622 
	`­Ş_¡r_­³ndf
(&
¡r
, &
¡r_Ën
, 
fmt
, 
Çme
, 
Üig_rŞes_¡r
);

623 
	`ä“
(
Üig_rŞes_¡r
);

624  
¡r
;

625 
	}
}

627 
	$bud_rŞ—Îow_vecs
()

629 *
¡r
 = 
NULL
, *
Çme_Úly
 = NULL;

630 
size_t
 
i
;

631 cÚ¡ *
™em
 = 
NULL
;

632 cÚ¡ 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

633 
v
 = 
	`pŞdiff_g‘_rŞe_®low_veùÜ
(
diff
);

634 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v
); i++) {

635 
™em
 = 
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

636 ià(!
™em
)

638 
pŞdiff_fÜm_e
 
fÜm
 = 
	`pŞdiff_rŞe_®low_g‘_fÜm
(
™em
);

639 
¡r
 = 
	`rŞ—Îow_to_¡ršg
(
™em
, 
fÜm
, 1);

640 ià(!
¡r
)

642 
fÜm
) {

643 
POLDIFF_FORM_ADDED
:

644 
	`­Ş_veùÜ_­³nd
(
added_v
, 
¡r
);

646 
POLDIFF_FORM_REMOVED
:

647 
	`­Ş_veùÜ_­³nd
(
»moved_v
, 
¡r
);

649 
POLDIFF_FORM_MODIFIED
:

650 
Çme_Úly
 = 
	`rŞ—Îow_to_¡ršg
(
™em
, 
fÜm
, 0);

651 
	`­Ş_veùÜ_­³nd
(
modif›d_Çme_Úly_v
, 
Çme_Úly
);

652 
	`­Ş_veùÜ_­³nd
(
modif›d_v
, 
¡r
);

656 
	`as£¹
(0);

659 
	}
}

661 
	$bud_rŞ‘¿ns_vecs
()

663 
added_ty³_ruËs_v
 = 
	`­Ş_veùÜ_ü—‹
(
ä“
);

664 
»moved_ty³_ruËs_v
 = 
	`­Ş_veùÜ_ü—‹
(
ä“
);

665 
cÜ»ù_added_ty³_ruËs_v
 = 
	`¡ršg_¬¿y_to_veùÜ
(
added_rŞ‘¿ns_ty³
);

666 
cÜ»ù_»moved_ty³_ruËs_v
 = 
	`¡ršg_¬¿y_to_veùÜ
(
»moved_rŞ‘¿ns_ty³
);

668 *
¡r
 = 
NULL
, *
Çme_Úly
;

669 
size_t
 
i
;

670 cÚ¡ *
™em
 = 
NULL
;

671 cÚ¡ 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

672 
v
 = 
	`pŞdiff_g‘_rŞe_Œªs_veùÜ
(
diff
);

673 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v
); i++) {

674 
™em
 = 
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

675 ià(!
™em
)

677 
pŞdiff_fÜm_e
 
fÜm
 = 
	`pŞdiff_rŞe_Œªs_g‘_fÜm
(
™em
);

678 
¡r
 = 
	`rŞ‘¿ns_to_¡ršg
(
™em
, 
fÜm
, 1);

679 ià(!
¡r
)

681 
fÜm
) {

682 
POLDIFF_FORM_ADDED
:

683 
	`­Ş_veùÜ_­³nd
(
added_v
, 
¡r
);

685 
POLDIFF_FORM_REMOVED
:

686 
	`­Ş_veùÜ_­³nd
(
»moved_v
, 
¡r
);

688 
POLDIFF_FORM_ADD_TYPE
:

689 
	`­Ş_veùÜ_­³nd
(
added_ty³_ruËs_v
, 
¡r
);

691 
POLDIFF_FORM_REMOVE_TYPE
:

692 
	`­Ş_veùÜ_­³nd
(
»moved_ty³_ruËs_v
, 
¡r
);

694 
POLDIFF_FORM_MODIFIED
:

695 
Çme_Úly
 = 
	`rŞ‘¿ns_to_¡ršg
(
™em
, 
fÜm
, 0);

696 
	`­Ş_veùÜ_­³nd
(
modif›d_Çme_Úly_v
, 
Çme_Úly
);

697 
	`­Ş_veùÜ_­³nd
(
modif›d_v
, 
¡r
);

701 
	`as£¹
(0);

704 
‹¡_»suÉ
;

705 
size_t
 
fœ¡_diff
 = 0;

706 
	`­Ş_veùÜ_sÜt
(
added_ty³_ruËs_v
, 
com·»_¡r
, 
NULL
);

707 
	`­Ş_veùÜ_sÜt
(
cÜ»ù_added_ty³_ruËs_v
, 
com·»_¡r
, 
NULL
);

708 
	`CU_ASSERT_FALSE
(
‹¡_»suÉ
 =

709 
	`­Ş_veùÜ_com·»
(
added_ty³_ruËs_v
, 
cÜ»ù_added_ty³_ruËs_v
, 
com·»_¡r
, 
NULL
, &
fœ¡_diff
));

710 ià(
‹¡_»suÉ
) {

711 
	`´št_‹¡_çu»
(
added_ty³_ruËs_v
, 
cÜ»ù_added_ty³_ruËs_v
, 
fœ¡_diff
, "Added Rule (dueo Type)");

713 
	`­Ş_veùÜ_sÜt
(
»moved_ty³_ruËs_v
, 
com·»_¡r
, 
NULL
);

714 
	`­Ş_veùÜ_sÜt
(
cÜ»ù_»moved_ty³_ruËs_v
, 
com·»_¡r
, 
NULL
);

715 
	`CU_ASSERT_FALSE
(
‹¡_»suÉ
 =

716 
	`­Ş_veùÜ_com·»
(
»moved_ty³_ruËs_v
, 
cÜ»ù_»moved_ty³_ruËs_v
, 
com·»_¡r
, 
NULL
, &
fœ¡_diff
));

717 ià(
‹¡_»suÉ
) {

718 
	`´št_‹¡_çu»
(
»moved_ty³_ruËs_v
, 
cÜ»ù_»moved_ty³_ruËs_v
, 
fœ¡_diff
, "Removed Rule (dueo Type)");

720 
	`­Ş_veùÜ_de¡roy
(&
added_ty³_ruËs_v
);

721 
	`­Ş_veùÜ_de¡roy
(&
cÜ»ù_added_ty³_ruËs_v
);

722 
	`­Ş_veùÜ_de¡roy
(&
»moved_ty³_ruËs_v
);

723 
	`­Ş_veùÜ_de¡roy
(&
cÜ»ù_»moved_ty³_ruËs_v
);

724 
	}
}

726 
	$bud_‹ruË_vecs
()

728 
added_ty³_ruËs_v
 = 
	`­Ş_veùÜ_ü—‹
(
ä“
);

729 
»moved_ty³_ruËs_v
 = 
	`­Ş_veùÜ_ü—‹
(
ä“
);

730 
cÜ»ù_added_ty³_ruËs_v
 = 
	`¡ršg_¬¿y_to_veùÜ
(
added_ty³_‹ruËs
);

731 
cÜ»ù_»moved_ty³_ruËs_v
 = 
	`¡ršg_¬¿y_to_veùÜ
(
»moved_ty³_‹ruËs
);

733 
size_t
 
i
;

734 *
¡r
 = 
NULL
;

735 cÚ¡ *
™em
 = 
NULL
;

736 cÚ¡ 
­Ş_veùÜ_t
 *
memb”_v
 = 
NULL
, *
chªge_v
 = NULL, *
Œªs_v
 = NULL;

737 
memb”_v
 = 
	`pŞdiff_g‘_‹ruË_veùÜ_memb”
(
diff
);

738 
chªge_v
 = 
	`pŞdiff_g‘_‹ruË_veùÜ_chªge
(
diff
);

739 
Œªs_v
 = 
	`pŞdiff_g‘_‹ruË_veùÜ_Œªs
(
diff
);

740 
­Ş_veùÜ_t
 *
®l_‹ruËs
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
);

741 
	`­Ş_veùÜ_ÿt
(
®l_‹ruËs
, 
memb”_v
);

742 
	`­Ş_veùÜ_ÿt
(
®l_‹ruËs
, 
chªge_v
);

743 
	`­Ş_veùÜ_ÿt
(
®l_‹ruËs
, 
Œªs_v
);

745 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
®l_‹ruËs
); i++) {

746 
™em
 = 
	`­Ş_veùÜ_g‘_–em’t
(
®l_‹ruËs
, 
i
);

747 ià(!
™em
)

749 
pŞdiff_fÜm_e
 
fÜm
 = 
	`pŞdiff_‹ruË_g‘_fÜm
(
™em
);

750 
¡r
 = 
	`‹ruË_to_¡ršg
(
™em
, 
fÜm
, 1);

751 ià(!
¡r
)

753 *
Çme_Úly
 = 
NULL
;

754 
fÜm
) {

755 
POLDIFF_FORM_ADDED
:

756 
	`­Ş_veùÜ_­³nd
(
added_v
, 
¡r
);

758 
POLDIFF_FORM_REMOVED
:

759 
	`­Ş_veùÜ_­³nd
(
»moved_v
, 
¡r
);

761 
POLDIFF_FORM_ADD_TYPE
:

762 
	`­Ş_veùÜ_­³nd
(
added_ty³_ruËs_v
, 
¡r
);

764 
POLDIFF_FORM_REMOVE_TYPE
:

765 
	`­Ş_veùÜ_­³nd
(
»moved_ty³_ruËs_v
, 
¡r
);

767 
POLDIFF_FORM_MODIFIED
:

768 
Çme_Úly
 = 
	`‹ruË_to_¡ršg
(
™em
, 
fÜm
, 0);

769 
	`­Ş_veùÜ_­³nd
(
modif›d_Çme_Úly_v
, 
Çme_Úly
);

770 
	`­Ş_veùÜ_­³nd
(
modif›d_v
, 
¡r
);

774 
	`as£¹
(0);

777 
size_t
 
fœ¡_diff
 = 0;

778 
‹¡_»suÉ
 = 0;

779 
	`­Ş_veùÜ_sÜt
(
added_ty³_ruËs_v
, 
com·»_¡r
, 
NULL
);

780 
	`­Ş_veùÜ_sÜt
(
cÜ»ù_added_ty³_ruËs_v
, 
com·»_¡r
, 
NULL
);

781 
	`CU_ASSERT_FALSE
(
‹¡_»suÉ
 =

782 
	`­Ş_veùÜ_com·»
(
added_ty³_ruËs_v
, 
cÜ»ù_added_ty³_ruËs_v
, 
com·»_¡r
, 
NULL
, &
fœ¡_diff
));

783 ià(
‹¡_»suÉ
) {

784 
	`´št_‹¡_çu»
(
added_ty³_ruËs_v
, 
cÜ»ù_added_ty³_ruËs_v
, 
fœ¡_diff
, "Added Rules (dueoypes)");

787 
	`­Ş_veùÜ_sÜt
(
»moved_ty³_ruËs_v
, 
com·»_¡r
, 
NULL
);

788 
	`­Ş_veùÜ_sÜt
(
cÜ»ù_»moved_ty³_ruËs_v
, 
com·»_¡r
, 
NULL
);

789 
	`CU_ASSERT_FALSE
(
‹¡_»suÉ
 =

790 
	`­Ş_veùÜ_com·»
(
»moved_ty³_ruËs_v
, 
cÜ»ù_»moved_ty³_ruËs_v
, 
com·»_¡r
, 
NULL
, &
fœ¡_diff
));

791 ià(
‹¡_»suÉ
) {

792 
	`´št_‹¡_çu»
(
»moved_ty³_ruËs_v
, 
cÜ»ù_»moved_ty³_ruËs_v
, 
fœ¡_diff
, "Removed Rules (dueoypes)");

794 
	`­Ş_veùÜ_de¡roy
(&
®l_‹ruËs
);

795 
	`­Ş_veùÜ_de¡roy
(&
added_ty³_ruËs_v
);

796 
	`­Ş_veùÜ_de¡roy
(&
cÜ»ù_added_ty³_ruËs_v
);

797 
	`­Ş_veùÜ_de¡roy
(&
»moved_ty³_ruËs_v
);

798 
	`­Ş_veùÜ_de¡roy
(&
cÜ»ù_»moved_ty³_ruËs_v
);

799 
	}
}

801 
	$bud_avruË_vecs
()

803 
added_ty³_ruËs_v
 = 
	`­Ş_veùÜ_ü—‹
(
ä“
);

804 
»moved_ty³_ruËs_v
 = 
	`­Ş_veùÜ_ü—‹
(
ä“
);

805 
cÜ»ù_added_ty³_ruËs_v
 = 
	`¡ršg_¬¿y_to_veùÜ
(
added_ty³_avruËs
);

806 
cÜ»ù_»moved_ty³_ruËs_v
 = 
	`¡ršg_¬¿y_to_veùÜ
(
»moved_ty³_avruËs
);

808 
size_t
 
i
;

809 *
¡r
 = 
NULL
, *
Çme_Úly
 = NULL;

810 cÚ¡ *
™em
 = 
NULL
;

811 cÚ¡ 
­Ş_veùÜ_t
 *
®low_v
 = 
NULL
, *
Ãv”®low_v
 = NULL, *
aud™®low_v
 = NULL, *
dÚud™_v
 = NULL;

812 
­Ş_veùÜ_t
 *
®l_avruËs_v
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
);

814 
®low_v
 = 
	`pŞdiff_g‘_avruË_veùÜ_®low
(
diff
);

815 
Ãv”®low_v
 = 
	`pŞdiff_g‘_avruË_veùÜ_Ãv”®low
(
diff
);

816 
aud™®low_v
 = 
	`pŞdiff_g‘_avruË_veùÜ_aud™®low
(
diff
);

817 
dÚud™_v
 = 
	`pŞdiff_g‘_avruË_veùÜ_dÚud™
(
diff
);

819 
	`­Ş_veùÜ_ÿt
(
®l_avruËs_v
, 
®low_v
);

820 
	`­Ş_veùÜ_ÿt
(
®l_avruËs_v
, 
Ãv”®low_v
);

821 
	`­Ş_veùÜ_ÿt
(
®l_avruËs_v
, 
aud™®low_v
);

822 
	`­Ş_veùÜ_ÿt
(
®l_avruËs_v
, 
dÚud™_v
);

824 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
®l_avruËs_v
); i++) {

825 
™em
 = 
	`­Ş_veùÜ_g‘_–em’t
(
®l_avruËs_v
, 
i
);

826 ià(!
™em
)

828 
pŞdiff_fÜm_e
 
fÜm
 = 
	`pŞdiff_avruË_g‘_fÜm
(
™em
);

829 
¡r
 = 
	`avruË_to_¡ršg
(
™em
, 
fÜm
, 1);

830 ià(!
¡r
)

832 
fÜm
) {

833 
POLDIFF_FORM_ADDED
:

834 
	`­Ş_veùÜ_­³nd
(
added_v
, 
¡r
);

836 
POLDIFF_FORM_REMOVED
:

837 
	`­Ş_veùÜ_­³nd
(
»moved_v
, 
¡r
);

839 
POLDIFF_FORM_ADD_TYPE
:

840 
	`­Ş_veùÜ_­³nd
(
added_ty³_ruËs_v
, 
¡r
);

842 
POLDIFF_FORM_REMOVE_TYPE
:

843 
	`­Ş_veùÜ_­³nd
(
»moved_ty³_ruËs_v
, 
¡r
);

845 
POLDIFF_FORM_MODIFIED
:

846 
Çme_Úly
 = 
	`avruË_to_¡ršg
(
™em
, 
fÜm
, 0);

847 
	`­Ş_veùÜ_­³nd
(
modif›d_Çme_Úly_v
, 
Çme_Úly
);

848 
	`­Ş_veùÜ_­³nd
(
modif›d_v
, 
¡r
);

852 
	`as£¹
(0);

855 
size_t
 
fœ¡_diff
 = 0;

856 
	`­Ş_veùÜ_sÜt
(
added_ty³_ruËs_v
, 
com·»_¡r
, 
NULL
);

857 
	`­Ş_veùÜ_sÜt
(
cÜ»ù_added_ty³_ruËs_v
, 
com·»_¡r
, 
NULL
);

858 
	`CU_ASSERT_FALSE
(
	`­Ş_veùÜ_com·»
(
added_ty³_ruËs_v
, 
cÜ»ù_added_ty³_ruËs_v
, 
com·»_¡r
, 
NULL
, &
fœ¡_diff
));

860 
	`­Ş_veùÜ_sÜt
(
»moved_ty³_ruËs_v
, 
com·»_¡r
, 
NULL
);

861 
	`­Ş_veùÜ_sÜt
(
cÜ»ù_»moved_ty³_ruËs_v
, 
com·»_¡r
, 
NULL
);

862 
	`CU_ASSERT_FALSE
(
	`­Ş_veùÜ_com·»
(
»moved_ty³_ruËs_v
, 
cÜ»ù_»moved_ty³_ruËs_v
, 
com·»_¡r
, 
NULL
, &
fœ¡_diff
));

864 
	`­Ş_veùÜ_de¡roy
(&
»moved_ty³_ruËs_v
);

865 
	`­Ş_veùÜ_de¡roy
(&
cÜ»ù_»moved_ty³_ruËs_v
);

866 
	`­Ş_veùÜ_de¡roy
(&
added_ty³_ruËs_v
);

867 
	`­Ş_veùÜ_de¡roy
(&
cÜ»ù_added_ty³_ruËs_v
);

868 
	`­Ş_veùÜ_de¡roy
(&
®l_avruËs_v
);

869 
	}
}

871 
	$ruËs_avruËs_‹¡s
()

873 
‹¡_numb”s_e
 
‹¡_num
 = 
RULES_AVRULE
;

874 
pŞdiff_‹¡_ªsw”s_t
 *
ªsw”s
 = 
	`š™_ªsw”_veùÜs
(
added_avruËs
, 
»moved_avruËs
, 
unchªged_avruËs
, 
modif›d_avruËs
);

875 
	`run_‹¡
(
NULL
, 
ªsw”s
, 
‹¡_num
);

876 
	`ş—nup_‹¡
(
ªsw”s
);

877 
	}
}

879 
	$ruËs_‹ruËs_‹¡s
()

881 
‹¡_numb”s_e
 
‹¡_num
 = 
RULES_TERULE
;

882 
pŞdiff_‹¡_ªsw”s_t
 *
ªsw”s
 = 
	`š™_ªsw”_veùÜs
(
added_‹ruËs
, 
»moved_‹ruËs
, 
unchªged_‹ruËs
, 
modif›d_‹ruËs
);

883 
	`run_‹¡
(
NULL
, 
ªsw”s
, 
‹¡_num
);

884 
	`ş—nup_‹¡
(
ªsw”s
);

885 
	}
}

887 
	$ruËs_rŞ—Îow_‹¡s
()

889 
‹¡_numb”s_e
 
‹¡_num
 = 
RULES_ROLEALLOW
;

890 
pŞdiff_‹¡_ªsw”s_t
 *
ªsw”s
 =

891 
	`š™_ªsw”_veùÜs
(
added_rŞ—ÎowruËs
, 
»moved_rŞ—ÎowruËs
, 
unchªged_rŞ—ÎowruËs
,

892 
modif›d_rŞ—ÎowruËs
);

893 
	`run_‹¡
(
NULL
, 
ªsw”s
, 
‹¡_num
);

894 
	`ş—nup_‹¡
(
ªsw”s
);

895 
	}
}

897 
	$ruËs_rŞ‘¿ns_‹¡s
()

899 
‹¡_numb”s_e
 
‹¡_num
 = 
RULES_ROLETRANS
;

900 
pŞdiff_‹¡_ªsw”s_t
 *
ªsw”s
 =

901 
	`š™_ªsw”_veùÜs
(
added_rŞ‘¿ns_ruËs
, 
»moved_rŞ‘¿ns_ruËs
, 
unchªged_rŞ‘¿ns_ruËs
,

902 
modif›d_rŞ‘¿ns_ruËs
);

903 
	`run_‹¡
(
NULL
, 
ªsw”s
, 
‹¡_num
);

904 
	`ş—nup_‹¡
(
ªsw”s
);

905 
	}
}

907 
	$ruËs_‹¡_š™
()

909 ià(!(
diff
 = 
	`š™_pŞdiff
(
RULES_ORIG_POLICY
, 
RULES_MOD_POLICY
))) {

914 
	}
}

	@libpoldiff/tests/rules-tests.h

25 #iâdeà
RULES_TEST


26 
	#RULES_TEST


	)

27 
ruËs_‹¡_š™
();

28 
ruËs_‹¡_ş—nup
();

30 
ruËs_avruËs_‹¡s
();

31 
ruËs_rŞ—Îow_‹¡s
();

32 
ruËs_rŞ‘¿ns_‹¡s
();

33 
ruËs_‹ruËs_‹¡s
();

35 
bud_avruË_vecs
();

36 
bud_‹ruË_vecs
();

37 
bud_rŞ‘¿ns_vecs
();

38 
bud_rŞ—Îow_vecs
();

	@libqpol/include/qpol/avrule_query.h

26 #iâdeà
QPOL_AVRULE_QUERY_H


27 
	#QPOL_AVRULE_QUERY_H


	)

29 #ifdef 
__ılu¥lus


34 
	~<qpŞ/pŞicy.h
>

35 
	~<qpŞ/şass_³rm_qu”y.h
>

36 
	~<qpŞ/cÚd_qu”y.h
>

37 
	~<qpŞ/ty³_qu”y.h
>

39 
qpŞ_avruË
 
	tqpŞ_avruË_t
;

42 
	#QPOL_RULE_ALLOW
 1

	)

43 
	#QPOL_RULE_NEVERALLOW
 128

	)

44 
	#QPOL_RULE_AUDITALLOW
 2

	)

46 
	#QPOL_RULE_DONTAUDIT
 4

	)

64 
qpŞ_pŞicy_g‘_avruË_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, 
ušt32_t
 
ruË_ty³_mask
, 
qpŞ_™”©Ü_t
 ** 
™”
);

75 
qpŞ_avruË_g‘_sourû_ty³
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_avruË_t
 * 
ruË
,

76 cÚ¡ 
qpŞ_ty³_t
 ** 
sourû
);

87 
qpŞ_avruË_g‘_rg‘_ty³
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_avruË_t
 * 
ruË
,

88 cÚ¡ 
qpŞ_ty³_t
 ** 
rg‘
);

99 
qpŞ_avruË_g‘_objeù_şass
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_avruË_t
 * 
ruË
,

100 cÚ¡ 
qpŞ_şass_t
 ** 
obj_şass
);

115 
qpŞ_avruË_g‘_³rm_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_avruË_t
 * 
ruË
, 
qpŞ_™”©Ü_t
 ** 
³rms
);

126 
qpŞ_avruË_g‘_ruË_ty³
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_avruË_t
 * 
ruË
, 
ušt32_t
 * 
ruË_ty³
);

138 
qpŞ_avruË_g‘_cÚd
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_avruË_t
 * 
ruË
, cÚ¡ 
qpŞ_cÚd_t
 ** 
cÚd
);

149 
qpŞ_avruË_g‘_is_’abËd
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_avruË_t
 * 
ruË
, 
ušt32_t
 * 
is_’abËd
);

161 
qpŞ_avruË_g‘_which_li¡
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_avruË_t
 * 
ruË
, 
ušt32_t
 * 
which_li¡
);

163 #ifdef 
__ılu¥lus


	@libqpol/include/qpol/bool_query.h

26 #iâdeà
QPOL_BOOL_QUERY_H


27 
	#QPOL_BOOL_QUERY_H


	)

29 #ifdef 
__ılu¥lus


34 
	~<¡ddef.h
>

35 
	~<¡dšt.h
>

36 
	~<qpŞ/pŞicy.h
>

37 
	~<qpŞ/™”©Ü.h
>

39 
qpŞ_boŞ
 
	tqpŞ_boŞ_t
;

50 
qpŞ_pŞicy_g‘_boŞ_by_Çme
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ *
Çme
, 
qpŞ_boŞ_t
 ** 
d©um
);

62 
qpŞ_pŞicy_g‘_boŞ_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, 
qpŞ_™”©Ü_t
 ** 
™”
);

73 
qpŞ_boŞ_g‘_v®ue
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_boŞ_t
 * 
d©um
, 
ušt32_t
 * 
v®ue
);

84 
qpŞ_boŞ_g‘_¡©e
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_boŞ_t
 * 
d©um
, *
¡©e
);

96 
qpŞ_boŞ_£t_¡©e
(
qpŞ_pŞicy_t
 * 
pŞicy
, 
qpŞ_boŞ_t
 * 
d©um
, 
¡©e
);

110 
qpŞ_boŞ_£t_¡©e_no_ev®
(
qpŞ_pŞicy_t
 * 
pŞicy
, 
qpŞ_boŞ_t
 * 
d©um
, 
¡©e
);

121 
qpŞ_boŞ_g‘_Çme
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_boŞ_t
 * 
d©um
, cÚ¡ **
Çme
);

123 #ifdef 
__ılu¥lus


	@libqpol/include/qpol/bounds_query.h

24 #iâdeà
QPOL_BOUNDS_QUERY_H


25 
	#QPOL_BOUNDS_QUERY_H


	)

27 #ifdef 
__ılu¥lus


32 
	~<¡ddef.h
>

33 
	~<¡dšt.h
>

34 
	~<qpŞ/™”©Ü.h
>

35 
	~<qpŞ/pŞicy.h
>

39 
qpŞ_ty³bounds
 
	tqpŞ_ty³bounds_t
;

52 
qpŞ_pŞicy_g‘_ty³bounds_™”
(cÚ¡ 
qpŞ_pŞicy_t
 *
pŞicy
, 
qpŞ_™”©Ü_t
 **
™”
);

64 
qpŞ_ty³bounds_g‘_·»Á_Çme
(cÚ¡ 
qpŞ_pŞicy_t
 *
pŞicy
, cÚ¡ 
qpŞ_ty³bounds_t
 *
d©um
, cÚ¡ **
Çme
);

75 
qpŞ_ty³bounds_g‘_chd_Çme
(cÚ¡ 
qpŞ_pŞicy_t
 *
pŞicy
, cÚ¡ 
qpŞ_ty³bounds_t
 *
d©um
, cÚ¡ **
Çme
);

78 
qpŞ_rŞebounds
 
	tqpŞ_rŞebounds_t
;

91 
qpŞ_pŞicy_g‘_rŞebounds_™”
(cÚ¡ 
qpŞ_pŞicy_t
 *
pŞicy
, 
qpŞ_™”©Ü_t
 **
™”
);

103 
qpŞ_rŞebounds_g‘_·»Á_Çme
(cÚ¡ 
qpŞ_pŞicy_t
 *
pŞicy
, cÚ¡ 
qpŞ_rŞebounds_t
 *
d©um
, cÚ¡ **
Çme
);

114 
qpŞ_rŞebounds_g‘_chd_Çme
(cÚ¡ 
qpŞ_pŞicy_t
 *
pŞicy
, cÚ¡ 
qpŞ_rŞebounds_t
 *
d©um
, cÚ¡ **
Çme
);

117 
qpŞ_u£rbounds
 
	tqpŞ_u£rbounds_t
;

130 
qpŞ_pŞicy_g‘_u£rbounds_™”
(cÚ¡ 
qpŞ_pŞicy_t
 *
pŞicy
, 
qpŞ_™”©Ü_t
 **
™”
);

142 
qpŞ_u£rbounds_g‘_·»Á_Çme
(cÚ¡ 
qpŞ_pŞicy_t
 *
pŞicy
, cÚ¡ 
qpŞ_u£rbounds_t
 *
d©um
, cÚ¡ **
Çme
);

153 
qpŞ_u£rbounds_g‘_chd_Çme
(cÚ¡ 
qpŞ_pŞicy_t
 *
pŞicy
, cÚ¡ 
qpŞ_u£rbounds_t
 *
d©um
, cÚ¡ **
Çme
);

158 #ifdef 
__ılu¥lus


	@libqpol/include/qpol/class_perm_query.h

27 #iâdeà
QPOL_CLASS_PERM_QUERY_H


28 
	#QPOL_CLASS_PERM_QUERY_H


	)

30 #ifdef 
__ılu¥lus


35 
	~<¡ddef.h
>

36 
	~<¡dšt.h
>

37 
	~<qpŞ/™”©Ü.h
>

38 
	~<qpŞ/pŞicy.h
>

40 
qpŞ_şass
 
	tqpŞ_şass_t
;

41 
qpŞ_commÚ
 
	tqpŞ_commÚ_t
;

57 
qpŞ_³rm_g‘_şass_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ *
³rm
, 
qpŞ_™”©Ü_t
 ** 
şas£s
);

71 
qpŞ_³rm_g‘_commÚ_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ *
³rm
, 
qpŞ_™”©Ü_t
 ** 
commÚs
);

83 
qpŞ_pŞicy_g‘_şass_by_Çme
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ *
Çme
, cÚ¡ 
qpŞ_şass_t
 ** 
obj_şass
);

95 
qpŞ_pŞicy_g‘_şass_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, 
qpŞ_™”©Ü_t
 ** 
™”
);

106 
qpŞ_şass_g‘_v®ue
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_şass_t
 * 
obj_şass
, 
ušt32_t
 * 
v®ue
);

118 
qpŞ_şass_g‘_commÚ
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_şass_t
 * 
obj_şass
,

119 cÚ¡ 
qpŞ_commÚ_t
 ** 
commÚ
);

133 
qpŞ_şass_g‘_³rm_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_şass_t
 * 
obj_şass
, 
qpŞ_™”©Ü_t
 ** 
³rms
);

144 
qpŞ_şass_g‘_Çme
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_şass_t
 * 
obj_şass
, cÚ¡ **
Çme
);

156 
qpŞ_pŞicy_g‘_commÚ_by_Çme
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ *
Çme
, cÚ¡ 
qpŞ_commÚ_t
 ** 
commÚ
);

168 
qpŞ_pŞicy_g‘_commÚ_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, 
qpŞ_™”©Ü_t
 ** 
™”
);

179 
qpŞ_commÚ_g‘_v®ue
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_commÚ_t
 * 
commÚ
, 
ušt32_t
 * 
v®ue
);

192 
qpŞ_commÚ_g‘_³rm_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_commÚ_t
 * 
commÚ
, 
qpŞ_™”©Ü_t
 ** 
³rms
);

203 
qpŞ_commÚ_g‘_Çme
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_commÚ_t
 * 
commÚ
, cÚ¡ **
Çme
);

205 #ifdef 
__ılu¥lus


	@libqpol/include/qpol/cond_query.h

27 #iâdeà
QPOL_COND_QUERY_H


28 
	#QPOL_COND_QUERY_H


	)

30 #ifdef 
__ılu¥lus


35 
	~<qpŞ/pŞicy.h
>

36 
	~<qpŞ/boŞ_qu”y.h
>

37 
	~<qpŞ/™”©Ü.h
>

39 
qpŞ_cÚd
 
	tqpŞ_cÚd_t
;

40 
qpŞ_cÚd_ex´_node
 
	tqpŞ_cÚd_ex´_node_t
;

54 
qpŞ_pŞicy_g‘_cÚd_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, 
qpŞ_™”©Ü_t
 ** 
™”
);

69 
qpŞ_cÚd_g‘_ex´_node_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_cÚd_t
 * 
cÚd
, 
qpŞ_™”©Ü_t
 ** 
™”
);

72 
	#QPOL_COND_RULE_LIST
 0x00000001

	)

73 
	#QPOL_COND_RULE_ENABLED
 0x00000002

	)

90 
qpŞ_cÚd_g‘_av_Œue_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_cÚd_t
 * 
cÚd
, 
ušt32_t
 
ruË_ty³_mask
,

91 
qpŞ_™”©Ü_t
 ** 
™”
);

108 
qpŞ_cÚd_g‘_‹_Œue_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_cÚd_t
 * 
cÚd
, 
ušt32_t
 
ruË_ty³_mask
,

109 
qpŞ_™”©Ü_t
 ** 
™”
);

126 
qpŞ_cÚd_g‘_av_çl£_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_cÚd_t
 * 
cÚd
, 
ušt32_t
 
ruË_ty³_mask
,

127 
qpŞ_™”©Ü_t
 ** 
™”
);

144 
qpŞ_cÚd_g‘_‹_çl£_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_cÚd_t
 * 
cÚd
, 
ušt32_t
 
ruË_ty³_mask
,

145 
qpŞ_™”©Ü_t
 ** 
™”
);

157 
qpŞ_cÚd_ev®
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_cÚd_t
 * 
cÚd
, 
ušt32_t
 * 
is_Œue
);

160 
	#QPOL_COND_EXPR_BOOL
 1

	)

161 
	#QPOL_COND_EXPR_NOT
 2

	)

162 
	#QPOL_COND_EXPR_OR
 3

	)

163 
	#QPOL_COND_EXPR_AND
 4

	)

164 
	#QPOL_COND_EXPR_XOR
 5

	)

165 
	#QPOL_COND_EXPR_EQ
 6

	)

166 
	#QPOL_COND_EXPR_NEQ
 7

	)

177 
qpŞ_cÚd_ex´_node_g‘_ex´_ty³
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_cÚd_ex´_node_t
 * 
node
,

178 
ušt32_t
 * 
ex´_ty³
);

191 
qpŞ_cÚd_ex´_node_g‘_boŞ
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_cÚd_ex´_node_t
 * 
node
,

192 
qpŞ_boŞ_t
 ** 
cÚd_boŞ
);

194 #ifdef 
__ılu¥lus


	@libqpol/include/qpol/constraint_query.h

26 #iâdeà
QPOL_CONSTRAINT_QUERY_H


27 
	#QPOL_CONSTRAINT_QUERY_H


	)

29 #ifdef 
__ılu¥lus


34 
	~<qpŞ/pŞicy.h
>

35 
	~<qpŞ/™”©Ü.h
>

36 
	~<qpŞ/şass_³rm_qu”y.h
>

38 
qpŞ_cÚ¡¿št
 
	tqpŞ_cÚ¡¿št_t
;

39 
qpŞ_v®id©‘¿ns
 
	tqpŞ_v®id©‘¿ns_t
;

40 
qpŞ_cÚ¡¿št_ex´_node
 
	tqpŞ_cÚ¡¿št_ex´_node_t
;

54 
qpŞ_pŞicy_g‘_cÚ¡¿št_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, 
qpŞ_™”©Ü_t
 ** 
™”
);

65 
qpŞ_cÚ¡¿št_g‘_şass
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_cÚ¡¿št_t
 * 
cÚ¡r
,

66 cÚ¡ 
qpŞ_şass_t
 ** 
obj_şass
);

81 
qpŞ_cÚ¡¿št_g‘_³rm_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_cÚ¡¿št_t
 * 
cÚ¡r
,

82 
qpŞ_™”©Ü_t
 ** 
™”
);

97 
qpŞ_cÚ¡¿št_g‘_ex´_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_cÚ¡¿št_t
 * 
cÚ¡r
,

98 
qpŞ_™”©Ü_t
 ** 
™”
);

112 
qpŞ_pŞicy_g‘_v®id©‘¿ns_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, 
qpŞ_™”©Ü_t
 ** 
™”
);

123 
qpŞ_v®id©‘¿ns_g‘_şass
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_v®id©‘¿ns_t
 * 
vŒªs
,

124 cÚ¡ 
qpŞ_şass_t
 ** 
obj_şass
);

139 
qpŞ_v®id©‘¿ns_g‘_ex´_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_v®id©‘¿ns_t
 * 
vŒªs
,

140 
qpŞ_™”©Ü_t
 ** 
™”
);

143 
	#QPOL_CEXPR_TYPE_NOT
 1

	)

144 
	#QPOL_CEXPR_TYPE_AND
 2

	)

145 
	#QPOL_CEXPR_TYPE_OR
 3

	)

146 
	#QPOL_CEXPR_TYPE_ATTR
 4

	)

147 
	#QPOL_CEXPR_TYPE_NAMES
 5

	)

158 
qpŞ_cÚ¡¿št_ex´_node_g‘_ex´_ty³
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_cÚ¡¿št_ex´_node_t
 * 
ex´
,

159 
ušt32_t
 * 
ex´_ty³
);

162 
	#QPOL_CEXPR_SYM_USER
 1

	)

163 
	#QPOL_CEXPR_SYM_ROLE
 2

	)

164 
	#QPOL_CEXPR_SYM_TYPE
 4

	)

165 
	#QPOL_CEXPR_SYM_TARGET
 8

	)

166 
	#QPOL_CEXPR_SYM_XTARGET
 16

	)

167 
	#QPOL_CEXPR_SYM_L1L2
 32

	)

168 
	#QPOL_CEXPR_SYM_L1H2
 64

	)

169 
	#QPOL_CEXPR_SYM_H1L2
 128

	)

170 
	#QPOL_CEXPR_SYM_H1H2
 256

	)

171 
	#QPOL_CEXPR_SYM_L1H1
 512

	)

172 
	#QPOL_CEXPR_SYM_L2H2
 1024

	)

184 
qpŞ_cÚ¡¿št_ex´_node_g‘_sym_ty³
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_cÚ¡¿št_ex´_node_t
 * 
ex´
,

185 
ušt32_t
 * 
sym_ty³
);

188 
	#QPOL_CEXPR_OP_EQ
 1

	)

189 
	#QPOL_CEXPR_OP_NEQ
 2

	)

190 
	#QPOL_CEXPR_OP_DOM
 3

	)

191 
	#QPOL_CEXPR_OP_DOMBY
 4

	)

192 
	#QPOL_CEXPR_OP_INCOMP
 5

	)

204 
qpŞ_cÚ¡¿št_ex´_node_g‘_İ
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_cÚ¡¿št_ex´_node_t
 * 
ex´
,

205 
ušt32_t
 * 
İ
);

223 
qpŞ_cÚ¡¿št_ex´_node_g‘_Çmes_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_cÚ¡¿št_ex´_node_t
 * 
ex´
,

224 
qpŞ_™”©Ü_t
 ** 
™”
);

239 
qpŞ_şass_g‘_cÚ¡¿št_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_şass_t
 * 
obj_şass
,

240 
qpŞ_™”©Ü_t
 ** 
cÚ¡r
);

255 
qpŞ_şass_g‘_v®id©‘¿ns_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_şass_t
 * 
obj_şass
,

256 
qpŞ_™”©Ü_t
 ** 
vŒªs
);

258 #ifdef 
__ılu¥lus


	@libqpol/include/qpol/context_query.h

26 #iâdeà
QPOL_CONTEXT_QUERY_H


27 
	#QPOL_CONTEXT_QUERY_H


	)

29 #ifdef 
__ılu¥lus


34 
	~<¡ddef.h
>

35 
	~<¡dšt.h
>

36 
	~<qpŞ/pŞicy.h
>

37 
	~<qpŞ/u£r_qu”y.h
>

38 
	~<qpŞ/rŞe_qu”y.h
>

39 
	~<qpŞ/ty³_qu”y.h
>

40 
	~<qpŞ/mls_qu”y.h
>

42 
qpŞ_cÚ‹xt
 
	tqpŞ_cÚ‹xt_t
;

53 
qpŞ_cÚ‹xt_g‘_u£r
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_cÚ‹xt_t
 * 
cÚ‹xt
, cÚ¡ 
qpŞ_u£r_t
 ** 
u£r
);

64 
qpŞ_cÚ‹xt_g‘_rŞe
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_cÚ‹xt_t
 * 
cÚ‹xt
, cÚ¡ 
qpŞ_rŞe_t
 ** 
rŞe
);

75 
qpŞ_cÚ‹xt_g‘_ty³
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_cÚ‹xt_t
 * 
cÚ‹xt
, cÚ¡ 
qpŞ_ty³_t
 ** 
ty³
);

86 
qpŞ_cÚ‹xt_g‘_¿nge
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_cÚ‹xt_t
 * 
cÚ‹xt
,

87 cÚ¡ 
qpŞ_mls_¿nge_t
 ** 
¿nge
);

89 #ifdef 
__ılu¥lus


	@libqpol/include/qpol/default_object_query.h

24 #iâdeà
QPOL_DEFAULT_OBJECT_QUERY_H


25 
	#QPOL_DEFAULT_OBJECT_QUERY_H


	)

27 #ifdef 
__ılu¥lus


32 
	~<¡ddef.h
>

33 
	~<¡dšt.h
>

34 
	~<qpŞ/™”©Ü.h
>

35 
	~<qpŞ/pŞicy.h
>

38 
qpŞ_deçuÉ_objeù
 
	tqpŞ_deçuÉ_objeù_t
;

51 
qpŞ_pŞicy_g‘_deçuÉ_objeù_™”
(cÚ¡ 
qpŞ_pŞicy_t
 *
pŞicy
, 
qpŞ_™”©Ü_t
 **
™”
);

62 
qpŞ_deçuÉ_objeù_g‘_şass
(cÚ¡ 
qpŞ_pŞicy_t
 *
pŞicy
, cÚ¡ 
qpŞ_deçuÉ_objeù_t
 *
d©um
, cÚ¡ **
Çme
);

73 
qpŞ_deçuÉ_objeù_g‘_u£r_deçuÉ
(cÚ¡ 
qpŞ_pŞicy_t
 *
pŞicy
, cÚ¡ 
qpŞ_deçuÉ_objeù_t
 *
d©um
, cÚ¡ **
v®ue
);

84 
qpŞ_deçuÉ_objeù_g‘_rŞe_deçuÉ
(cÚ¡ 
qpŞ_pŞicy_t
 *
pŞicy
, cÚ¡ 
qpŞ_deçuÉ_objeù_t
 *
d©um
, cÚ¡ **
v®ue
);

95 
qpŞ_deçuÉ_objeù_g‘_ty³_deçuÉ
(cÚ¡ 
qpŞ_pŞicy_t
 *
pŞicy
, cÚ¡ 
qpŞ_deçuÉ_objeù_t
 *
d©um
, cÚ¡ **
v®ue
);

106 
qpŞ_deçuÉ_objeù_g‘_¿nge_deçuÉ
(cÚ¡ 
qpŞ_pŞicy_t
 *
pŞicy
, cÚ¡ 
qpŞ_deçuÉ_objeù_t
 *
d©um
, cÚ¡ **
v®ue
);

109 #ifdef 
__ılu¥lus


	@libqpol/include/qpol/fs_use_query.h

26 #iâdeà
QPOL_FS_USE_QUERY_H


27 
	#QPOL_FS_USE_QUERY_H


	)

29 #ifdef 
__ılu¥lus


34 
	~<¡ddef.h
>

35 
	~<¡dšt.h
>

36 
	~<qpŞ/™”©Ü.h
>

37 
	~<qpŞ/pŞicy.h
>

38 
	~<qpŞ/cÚ‹xt_qu”y.h
>

40 
qpŞ_fs_u£
 
	tqpŞ_fs_u£_t
;

51 
qpŞ_pŞicy_g‘_fs_u£_by_Çme
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ *
Çme
, cÚ¡ 
qpŞ_fs_u£_t
 ** 
ocÚ
);

64 
qpŞ_pŞicy_g‘_fs_u£_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, 
qpŞ_™”©Ü_t
 ** 
™”
);

75 
qpŞ_fs_u£_g‘_Çme
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_fs_u£_t
 * 
ocÚ
, cÚ¡ **
Çme
);

80 
	#QPOL_FS_USE_XATTR
 1U

	)

81 
	#QPOL_FS_USE_TRANS
 2U

	)

82 
	#QPOL_FS_USE_TASK
 3U

	)

83 
	#QPOL_FS_USE_GENFS
 4U

	)

84 
	#QPOL_FS_USE_NONE
 5U

	)

85 
	#QPOL_FS_USE_PSID
 6U

	)

96 
qpŞ_fs_u£_g‘_behaviÜ
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_fs_u£_t
 * 
ocÚ
, 
ušt32_t
 * 
behaviÜ
);

108 
qpŞ_fs_u£_g‘_cÚ‹xt
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_fs_u£_t
 * 
ocÚ
,

109 cÚ¡ 
qpŞ_cÚ‹xt_t
 ** 
cÚ‹xt
);

111 #ifdef 
__ılu¥lus


	@libqpol/include/qpol/ftrule_query.h

26 #iâdeà
QPOL_FTRULE_QUERY


27 
	#QPOL_FTRULE_QUERY


	)

29 #ifdef 
__ılu¥lus


34 
	~<qpŞ/pŞicy.h
>

35 
	~<qpŞ/™”©Ü.h
>

37 
qpŞ_f’ame_Œªs
 
	tqpŞ_f’ame_Œªs_t
;

50 
qpŞ_pŞicy_g‘_f’ame_Œªs_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, 
qpŞ_™”©Ü_t
 ** 
™”
);

61 
qpŞ_f’ame_Œªs_g‘_sourû_ty³
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_f’ame_Œªs_t
 * 
ruË
,

62 cÚ¡ 
qpŞ_ty³_t
 ** 
sourû
);

73 
qpŞ_f’ame_Œªs_g‘_rg‘_ty³
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_f’ame_Œªs_t
 * 
ruË
,

74 cÚ¡ 
qpŞ_ty³_t
 ** 
rg‘
);

85 
qpŞ_f’ame_Œªs_g‘_deçuÉ_ty³
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_f’ame_Œªs_t
 * 
ruË
,

86 cÚ¡ 
qpŞ_ty³_t
 ** 
dæt
);

97 
qpŞ_f’ame_Œªs_g‘_objeù_şass
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_f’ame_Œªs_t
 * 
ruË
,

98 cÚ¡ 
qpŞ_şass_t
 ** 
obj_şass
);

109 
qpŞ_f’ame_Œªs_g‘_f’ame
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_f’ame_Œªs_t
 * 
ruË
,

110 cÚ¡ ** 
Çme
);

112 #ifdef 
__ılu¥lus


	@libqpol/include/qpol/genfscon_query.h

26 #iâdeà
QPOL_OCON_QUERY_H


27 
	#QPOL_OCON_QUERY_H


	)

29 #ifdef 
__ılu¥lus


34 
	~<¡ddef.h
>

35 
	~<¡dšt.h
>

36 
	~<qpŞ/™”©Ü.h
>

37 
	~<qpŞ/pŞicy.h
>

39 
qpŞ_g’fscÚ
 
	tqpŞ_g’fscÚ_t
;

51 
qpŞ_pŞicy_g‘_g’fscÚ_by_Çme
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ *
Çme
, cÚ¡ *
·th
,

52 
qpŞ_g’fscÚ_t
 ** 
g’fscÚ
);

66 
qpŞ_pŞicy_g‘_g’fscÚ_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, 
qpŞ_™”©Ü_t
 ** 
™”
);

77 
qpŞ_g’fscÚ_g‘_Çme
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_g’fscÚ_t
 * 
g’fs
, cÚ¡ **
Çme
);

88 
qpŞ_g’fscÚ_g‘_·th
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_g’fscÚ_t
 * 
g’fs
, cÚ¡ **
·th
);

91 
	#QPOL_CLASS_ALL
 0U

	)

92 
	#QPOL_CLASS_BLK_FILE
 11U

	)

93 
	#QPOL_CLASS_CHR_FILE
 10U

	)

94 
	#QPOL_CLASS_DIR
 7U

	)

95 
	#QPOL_CLASS_FIFO_FILE
 13U

	)

96 
	#QPOL_CLASS_FILE
 6U

	)

97 
	#QPOL_CLASS_LNK_FILE
 9U

	)

98 
	#QPOL_CLASS_SOCK_FILE
 12U

	)

109 
qpŞ_g’fscÚ_g‘_şass
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_g’fscÚ_t
 * 
g’fs
, 
ušt32_t
 * 
obj_şass
);

121 
qpŞ_g’fscÚ_g‘_cÚ‹xt
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_g’fscÚ_t
 * 
g’fscÚ
,

122 cÚ¡ 
qpŞ_cÚ‹xt_t
 ** 
cÚ‹xt
);

124 #ifdef 
__ılu¥lus


	@libqpol/include/qpol/isid_query.h

26 #iâdeà
QPOL_ISID_QUERY_H


27 
	#QPOL_ISID_QUERY_H


	)

29 #ifdef 
__ılu¥lus


34 
	~<¡ddef.h
>

35 
	~<¡dšt.h
>

36 
	~<qpŞ/™”©Ü.h
>

37 
	~<qpŞ/pŞicy.h
>

39 
qpŞ_isid
 
	tqpŞ_isid_t
;

50 
qpŞ_pŞicy_g‘_isid_by_Çme
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ *
Çme
, cÚ¡ 
qpŞ_isid_t
 ** 
ocÚ
);

63 
qpŞ_pŞicy_g‘_isid_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, 
qpŞ_™”©Ü_t
 ** 
™”
);

74 
qpŞ_isid_g‘_Çme
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_isid_t
 * 
ocÚ
, cÚ¡ **
Çme
);

85 
qpŞ_isid_g‘_cÚ‹xt
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_isid_t
 * 
ocÚ
, cÚ¡ 
qpŞ_cÚ‹xt_t
 ** 
cÚ‹xt
);

87 #ifdef 
__ılu¥lus


	@libqpol/include/qpol/iterator.h

28 #iâdeà
QPOL_ITERATOR_H


29 
	#QPOL_ITERATOR_H


	)

31 #ifdef 
__ılu¥lus


36 
	~<¡ddef.h
>

38 
qpŞ_™”©Ü
;

39 
qpŞ_™”©Ü
 
	tqpŞ_™”©Ü_t
;

47 
qpŞ_™”©Ü_de¡roy
(
qpŞ_™”©Ü_t
 ** 
™”
);

60 
qpŞ_™”©Ü_g‘_™em
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
, **
™em
);

69 
qpŞ_™”©Ü_Ãxt
(
qpŞ_™”©Ü_t
 * 
™”
);

79 
qpŞ_™”©Ü_’d
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
);

89 
qpŞ_™”©Ü_g‘_size
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
, 
size_t
 * 
size
);

91 #ifdef 
__ılu¥lus


	@libqpol/include/qpol/mls_query.h

26 #iâdeà
QPOL_MLS_QUERY_H


27 
	#QPOL_MLS_QUERY_H


	)

29 #ifdef 
__ılu¥lus


34 
	~<¡ddef.h
>

35 
	~<¡dšt.h
>

37 
qpŞ_Ëv–
 
	tqpŞ_Ëv–_t
;

38 
qpŞ_ÿt
 
	tqpŞ_ÿt_t
;

39 
qpŞ_mls_¿nge
 
	tqpŞ_mls_¿nge_t
;

40 
qpŞ_mls_Ëv–
 
	tqpŞ_mls_Ëv–_t
;

42 
	~<qpŞ/™”©Ü.h
>

43 
	~<qpŞ/pŞicy.h
>

55 
qpŞ_pŞicy_g‘_Ëv–_by_Çme
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ *
Çme
, cÚ¡ 
qpŞ_Ëv–_t
 ** 
d©um
);

67 
qpŞ_pŞicy_g‘_Ëv–_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, 
qpŞ_™”©Ü_t
 ** 
™”
);

78 
qpŞ_Ëv–_g‘_i§lŸs
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_Ëv–_t
 * 
d©um
, *
i§lŸs
);

89 
qpŞ_Ëv–_g‘_v®ue
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_Ëv–_t
 * 
d©um
, 
ušt32_t
 * 
v®ue
);

103 
qpŞ_Ëv–_g‘_ÿt_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_Ëv–_t
 * 
d©um
, 
qpŞ_™”©Ü_t
 ** 
ÿts
);

115 
qpŞ_Ëv–_g‘_Çme
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_Ëv–_t
 * 
d©um
, cÚ¡ **
Çme
);

129 
qpŞ_Ëv–_g‘_®Ÿs_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_Ëv–_t
 * 
d©um
, 
qpŞ_™”©Ü_t
 ** 
®Ÿ£s
);

141 
qpŞ_pŞicy_g‘_ÿt_by_Çme
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ *
Çme
, cÚ¡ 
qpŞ_ÿt_t
 ** 
d©um
);

154 
qpŞ_pŞicy_g‘_ÿt_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, 
qpŞ_™”©Ü_t
 ** 
™”
);

165 
qpŞ_ÿt_g‘_v®ue
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_ÿt_t
 * 
d©um
, 
ušt32_t
 * 
v®ue
);

176 
qpŞ_ÿt_g‘_i§lŸs
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_ÿt_t
 * 
d©um
, *
i§lŸs
);

188 
qpŞ_ÿt_g‘_Çme
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_ÿt_t
 * 
d©um
, cÚ¡ **
Çme
);

202 
qpŞ_ÿt_g‘_®Ÿs_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_ÿt_t
 * 
d©um
, 
qpŞ_™”©Ü_t
 ** 
®Ÿ£s
);

214 
qpŞ_mls_¿nge_g‘_low_Ëv–
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_mls_¿nge_t
 * 
¿nge
,

215 cÚ¡ 
qpŞ_mls_Ëv–_t
 ** 
Ëv–
);

226 
qpŞ_mls_¿nge_g‘_high_Ëv–
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_mls_¿nge_t
 * 
¿nge
,

227 cÚ¡ 
qpŞ_mls_Ëv–_t
 ** 
Ëv–
);

239 
qpŞ_mls_Ëv–_g‘_£ns_Çme
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_mls_Ëv–_t
 * 
Ëv–
, cÚ¡ **
Çme
);

253 
qpŞ_mls_Ëv–_g‘_ÿt_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_mls_Ëv–_t
 * 
Ëv–
,

254 
qpŞ_™”©Ü_t
 ** 
ÿts
);

256 #ifdef 
__ılu¥lus


	@libqpol/include/qpol/mlsrule_query.h

27 #iâdeà
QPOL_MLSRULE_QUERY_H


28 
	#QPOL_MLSRULE_QUERY_H


	)

30 #ifdef 
__ılu¥lus


35 
	~<qpŞ/pŞicy.h
>

37 
qpŞ_¿nge_Œªs
 
	tqpŞ_¿nge_Œªs_t
;

50 
qpŞ_pŞicy_g‘_¿nge_Œªs_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, 
qpŞ_™”©Ü_t
 ** 
™”
);

61 
qpŞ_¿nge_Œªs_g‘_sourû_ty³
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_¿nge_Œªs_t
 * 
ruË
,

62 cÚ¡ 
qpŞ_ty³_t
 ** 
sourû
);

73 
qpŞ_¿nge_Œªs_g‘_rg‘_ty³
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_¿nge_Œªs_t
 * 
ruË
,

74 cÚ¡ 
qpŞ_ty³_t
 ** 
rg‘
);

85 
qpŞ_¿nge_Œªs_g‘_rg‘_şass
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_¿nge_Œªs_t
 * 
ruË
,

86 cÚ¡ 
qpŞ_şass_t
 ** 
rg‘
);

97 
qpŞ_¿nge_Œªs_g‘_¿nge
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_¿nge_Œªs_t
 * 
ruË
,

98 cÚ¡ 
qpŞ_mls_¿nge_t
 ** 
¿nge
);

100 #ifdef 
__ılu¥lus


	@libqpol/include/qpol/module.h

25 #iâdeà
QPOL_MODULE_H


26 
	#QPOL_MODULE_H


	)

28 #ifdef 
__ılu¥lus


33 
	~<¡dšt.h
>

35 
qpŞ_moduË
 
	tqpŞ_moduË_t
;

37 
	#QPOL_MODULE_UNKNOWN
 0

	)

38 
	#QPOL_MODULE_BASE
 1

	)

39 
	#QPOL_MODULE_OTHER
 2

	)

52 
qpŞ_moduË_ü—‹_äom_fe
(cÚ¡ *
·th
, 
qpŞ_moduË_t
 ** 
moduË
);

59 
qpŞ_moduË_de¡roy
(
qpŞ_moduË_t
 ** 
moduË
);

69 
qpŞ_moduË_g‘_·th
(cÚ¡ 
qpŞ_moduË_t
 * 
moduË
, cÚ¡ **
·th
);

80 
qpŞ_moduË_g‘_Çme
(cÚ¡ 
qpŞ_moduË_t
 * 
moduË
, cÚ¡ **
Çme
);

90 
qpŞ_moduË_g‘_v”siÚ
(cÚ¡ 
qpŞ_moduË_t
 * 
moduË
, cÚ¡ **
v”siÚ
);

100 
qpŞ_moduË_g‘_ty³
(cÚ¡ 
qpŞ_moduË_t
 * 
moduË
, *
ty³
);

110 
qpŞ_moduË_g‘_’abËd
(cÚ¡ 
qpŞ_moduË_t
 * 
moduË
, *
’abËd
);

120 
qpŞ_moduË_£t_’abËd
(
qpŞ_moduË_t
 * 
moduË
, 
’abËd
);

121 #ifdef 
__ılu¥lus


	@libqpol/include/qpol/netifcon_query.h

26 #iâdeà
QPOL_NETIFCON_QUERY_H


27 
	#QPOL_NETIFCON_QUERY_H


	)

29 #ifdef 
__ılu¥lus


34 
	~<¡ddef.h
>

35 
	~<¡dšt.h
>

36 
	~<qpŞ/™”©Ü.h
>

37 
	~<qpŞ/pŞicy.h
>

39 
qpŞ_ÃtifcÚ
 
	tqpŞ_ÃtifcÚ_t
;

50 
qpŞ_pŞicy_g‘_ÃtifcÚ_by_Çme
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ *
Çme
, cÚ¡ 
qpŞ_ÃtifcÚ_t
 ** 
ocÚ
);

63 
qpŞ_pŞicy_g‘_ÃtifcÚ_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, 
qpŞ_™”©Ü_t
 ** 
™”
);

74 
qpŞ_ÃtifcÚ_g‘_Çme
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_ÃtifcÚ_t
 * 
ocÚ
, cÚ¡ **
Çme
);

85 
qpŞ_ÃtifcÚ_g‘_msg_cÚ
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_ÃtifcÚ_t
 * 
ocÚ
,

86 cÚ¡ 
qpŞ_cÚ‹xt_t
 ** 
cÚ‹xt
);

97 
qpŞ_ÃtifcÚ_g‘_if_cÚ
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_ÃtifcÚ_t
 * 
ocÚ
,

98 cÚ¡ 
qpŞ_cÚ‹xt_t
 ** 
cÚ‹xt
);

100 #ifdef 
__ılu¥lus


	@libqpol/include/qpol/nodecon_query.h

26 #iâdeà
QPOL_NODECON_QUERY_H


27 
	#QPOL_NODECON_QUERY_H


	)

29 #ifdef 
__ılu¥lus


34 
	~<¡ddef.h
>

35 
	~<¡dšt.h
>

36 
	~<qpŞ/™”©Ü.h
>

37 
	~<qpŞ/pŞicy.h
>

39 
	#QPOL_IPV4
 0

	)

40 
	#QPOL_IPV6
 1

	)

42 
qpŞ_nodecÚ
 
	tqpŞ_nodecÚ_t
;

56 
qpŞ_pŞicy_g‘_nodecÚ_by_node
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, 
ušt32_t
 
addr
[4], ušt32_ˆ
mask
[4],

57 
´ÙocŞ
, 
qpŞ_nodecÚ_t
 ** 
ocÚ
);

71 
qpŞ_pŞicy_g‘_nodecÚ_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, 
qpŞ_™”©Ü_t
 ** 
™”
);

86 
qpŞ_nodecÚ_g‘_addr
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_nodecÚ_t
 * 
ocÚ
, 
ušt32_t
 ** 
addr
,

87 *
´ÙocŞ
);

102 
qpŞ_nodecÚ_g‘_mask
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_nodecÚ_t
 * 
ocÚ
, 
ušt32_t
 ** 
mask
,

103 *
´ÙocŞ
);

114 
qpŞ_nodecÚ_g‘_´ÙocŞ
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_nodecÚ_t
 * 
ocÚ
, *
´ÙocŞ
);

125 
qpŞ_nodecÚ_g‘_cÚ‹xt
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_nodecÚ_t
 * 
ocÚ
,

126 cÚ¡ 
qpŞ_cÚ‹xt_t
 ** 
cÚ‹xt
);

128 #ifdef 
__ılu¥lus


	@libqpol/include/qpol/permissive_query.h

24 #iâdeà
QPOL_PERMISSIVE_QUERY_H


25 
	#QPOL_PERMISSIVE_QUERY_H


	)

27 #ifdef 
__ılu¥lus


32 
	~<¡ddef.h
>

33 
	~<¡dšt.h
>

34 
	~<qpŞ/™”©Ü.h
>

35 
	~<qpŞ/pŞicy.h
>

37 
qpŞ_³rmissive
 
	tqpŞ_³rmissive_t
;

50 
qpŞ_pŞicy_g‘_³rmissive_™”
(cÚ¡ 
qpŞ_pŞicy_t
 *
pŞicy
, 
qpŞ_™”©Ü_t
 **
™”
);

62 
qpŞ_³rmissive_g‘_Çme
(cÚ¡ 
qpŞ_pŞicy_t
 *
pŞicy
, cÚ¡ 
qpŞ_³rmissive_t
 *
d©um
, cÚ¡ **
Çme
);

64 #ifdef 
__ılu¥lus


	@libqpol/include/qpol/polcap_query.h

24 #iâdeà
QPOL_POLCAP_QUERY_H


25 
	#QPOL_POLCAP_QUERY_H


	)

27 #ifdef 
__ılu¥lus


32 
	~<¡ddef.h
>

33 
	~<¡dšt.h
>

34 
	~<qpŞ/™”©Ü.h
>

35 
	~<qpŞ/pŞicy.h
>

37 
qpŞ_pŞÿp
 
	tqpŞ_pŞÿp_t
;

50 
qpŞ_pŞicy_g‘_pŞÿp_™”
(cÚ¡ 
qpŞ_pŞicy_t
 *
pŞicy
, 
qpŞ_™”©Ü_t
 **
™”
);

62 
qpŞ_pŞÿp_g‘_Çme
(cÚ¡ 
qpŞ_pŞicy_t
 *
pŞicy
, cÚ¡ 
qpŞ_pŞÿp_t
 *
d©um
, cÚ¡ **
Çme
);

64 #ifdef 
__ılu¥lus


	@libqpol/include/qpol/policy.h

26 #iâdeà
QPOL_POLICY_H


27 
	#QPOL_POLICY_H


	)

29 #ifdef 
__ılu¥lus


34 
	~<¡d¬g.h
>

35 
	~<¡dšt.h
>

37 
qpŞ_pŞicy
 
	tqpŞ_pŞicy_t
;

39 
	~<qpŞ/avruË_qu”y.h
>

40 
	~<qpŞ/boŞ_qu”y.h
>

41 
	~<qpŞ/şass_³rm_qu”y.h
>

42 
	~<qpŞ/cÚd_qu”y.h
>

43 
	~<qpŞ/cÚ¡¿št_qu”y.h
>

44 
	~<qpŞ/cÚ‹xt_qu”y.h
>

45 
	~<qpŞ/fs_u£_qu”y.h
>

46 
	~<qpŞ/isid_qu”y.h
>

47 
	~<qpŞ/™”©Ü.h
>

48 
	~<qpŞ/g’fscÚ_qu”y.h
>

49 
	~<qpŞ/mls_qu”y.h
>

50 
	~<qpŞ/ml¤uË_qu”y.h
>

51 
	~<qpŞ/moduË.h
>

52 
	~<qpŞ/ÃtifcÚ_qu”y.h
>

53 
	~<qpŞ/nodecÚ_qu”y.h
>

54 
	~<qpŞ/³rmissive_qu”y.h
>

55 
	~<qpŞ/bounds_qu”y.h
>

56 
	~<qpŞ/deçuÉ_objeù_qu”y.h
>

57 
	~<qpŞ/pŞÿp_qu”y.h
>

58 
	~<qpŞ/pÜtcÚ_qu”y.h
>

59 
	~<qpŞ/rbaüuË_qu”y.h
>

60 
	~<qpŞ/áruË_qu”y.h
>

61 
	~<qpŞ/rŞe_qu”y.h
>

62 
	~<qpŞ/syn_ruË_qu”y.h
>

63 
	~<qpŞ/‹ruË_qu”y.h
>

64 
	~<qpŞ/ty³_qu”y.h
>

65 
	~<qpŞ/u£r_qu”y.h
>

67 (*
qpŞ_ÿÎback_â_t
è(*
	tv¬g
, cÚ¡ 
	tqpŞ_pŞicy
 * 
	tpŞicy
, 
	tËv–
, cÚ¡ *
	tfmt
,

68 
	tva_li¡
 
	tva_¬gs
);

70 
	#QPOL_POLICY_UNKNOWN
 -1

	)

71 
	#QPOL_POLICY_KERNEL_SOURCE
 0

	)

72 
	#QPOL_POLICY_KERNEL_BINARY
 1

	)

73 
	#QPOL_POLICY_MODULE_BINARY
 2

	)

78 
	#QPOL_POLICY_OPTION_NO_NEVERALLOWS
 0x00000001

	)

84 
	#QPOL_POLICY_OPTION_NO_RULES
 0x00000002

	)

92 
	#QPOL_POLICY_OPTION_MATCH_SYSTEM
 0x00000004

	)

101 
	eqpŞ_ÿ·b™y


104 
QPOL_CAP_ATTRIB_NAMES
,

106 
QPOL_CAP_SYN_RULES
,

108 
QPOL_CAP_LINE_NUMBERS
,

110 
QPOL_CAP_CONDITIONALS
,

112 
QPOL_CAP_MLS
,

114 
QPOL_CAP_POLCAPS
,

116 
QPOL_CAP_MODULES
,

118 
QPOL_CAP_RULES_LOADED
,

120 
QPOL_CAP_SOURCE
,

122 
QPOL_CAP_NEVERALLOW
,

124 
QPOL_CAP_BOUNDS
,

126 
QPOL_CAP_DEFAULT_OBJECTS
,

127 
QPOL_CAP_DEFAULT_TYPE
,

129 
QPOL_CAP_PERMISSIVE
,

131 
QPOL_CAP_FILENAME_TRANS
,

133 
QPOL_CAP_ROLETRANS


134 } 
	tqpŞ_ÿ·b™y_e
;

150 
qpŞ_pŞicy_İ’_äom_fe
(cÚ¡ *
f’ame
, 
qpŞ_pŞicy_t
 ** 
pŞicy
, 
qpŞ_ÿÎback_â_t
 
â
, *
v¬g
,

151 cÚ¡ 
İtiÚs
);

164 
qpŞ_pŞicy_İ’_äom_fe_no_ruËs
(cÚ¡ *
f’ame
, 
qpŞ_pŞicy_t
 ** 
pŞicy
, 
qpŞ_ÿÎback_â_t
 
â
,

165 *
v¬g
è
__©Œibu‹__
 ((
d•»ÿ‹d
));

180 
qpŞ_pŞicy_İ’_äom_memÜy
(
qpŞ_pŞicy_t
 ** 
pŞicy
, cÚ¡ *
fed©a
, 
size_t
 
size
, 
qpŞ_ÿÎback_â_t
 
â
,

181 *
v¬g
, cÚ¡ 
İtiÚs
);

189 
qpŞ_pŞicy_de¡roy
(
qpŞ_pŞicy_t
 ** 
pŞicy
);

200 
qpŞ_pŞicy_»ev®u©e_cÚds
(
qpŞ_pŞicy_t
 * 
pŞicy
);

214 
qpŞ_pŞicy_­³nd_moduË
(
qpŞ_pŞicy_t
 * 
pŞicy
, 
qpŞ_moduË_t
 * 
moduË
);

230 
qpŞ_pŞicy_»bud
(
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
İtiÚs
);

241 
qpŞ_pŞicy_g‘_moduË_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, 
qpŞ_™”©Ü_t
 ** 
™”
);

250 
qpŞ_pŞicy_g‘_pŞicy_v”siÚ
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, *
v”siÚ
);

260 
qpŞ_pŞicy_g‘_ty³
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, *
ty³
);

269 
qpŞ_pŞicy_has_ÿ·b™y
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, 
qpŞ_ÿ·b™y_e
 
ÿp
);

278 
qpŞ_pŞicy_g‘_pŞicy_hªdË_unknown
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, *
hªdË_unknown
);

280 #ifdef 
__ılu¥lus


	@libqpol/include/qpol/policy_extend.h

27 #iâdeà
QPOL_POLICY_EXTEND_H


28 
	#QPOL_POLICY_EXTEND_H


	)

30 #ifdef 
__ılu¥lus


35 
	~<qpŞ/pŞicy.h
>

36 
	~<qpŞ/™”©Ü.h
>

46 
qpŞ_pŞicy_bud_syn_ruË_bË
(
qpŞ_pŞicy_t
 * 
pŞicy
);

49 
	gqpŞ_avruË
;

50 
	gqpŞ_‹ruË
;

64 
qpŞ_avruË_g‘_syn_avruË_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_avruË
 *
ruË
,

65 
qpŞ_™”©Ü_t
 ** 
™”
);

79 
qpŞ_‹ruË_g‘_syn_‹ruË_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_‹ruË
 *
ruË
,

80 
qpŞ_™”©Ü_t
 ** 
™”
);

82 #ifdef 
__ılu¥lus


	@libqpol/include/qpol/portcon_query.h

26 #iâdeà
QPOL_PORTCON_QUERY_H


27 
	#QPOL_PORTCON_QUERY_H


	)

29 #ifdef 
__ılu¥lus


34 
	~<¡ddef.h
>

35 
	~<¡dšt.h
>

36 
	~<Ãtš‘/š.h
>

37 
	~<qpŞ/™”©Ü.h
>

38 
	~<qpŞ/pŞicy.h
>

40 
qpŞ_pÜtcÚ
 
	tqpŞ_pÜtcÚ_t
;

55 
qpŞ_pŞicy_g‘_pÜtcÚ_by_pÜt
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, 
ušt16_t
 
low
, ušt16_ˆ
high
, 
ušt8_t
 
´ÙocŞ
,

56 cÚ¡ 
qpŞ_pÜtcÚ_t
 ** 
ocÚ
);

69 
qpŞ_pŞicy_g‘_pÜtcÚ_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, 
qpŞ_™”©Ü_t
 ** 
™”
);

80 
qpŞ_pÜtcÚ_g‘_´ÙocŞ
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_pÜtcÚ_t
 * 
ocÚ
, 
ušt8_t
 * 
´ÙocŞ
);

90 
qpŞ_pÜtcÚ_g‘_low_pÜt
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_pÜtcÚ_t
 * 
ocÚ
, 
ušt16_t
 * 
pÜt
);

100 
qpŞ_pÜtcÚ_g‘_high_pÜt
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_pÜtcÚ_t
 * 
ocÚ
, 
ušt16_t
 * 
pÜt
);

111 
qpŞ_pÜtcÚ_g‘_cÚ‹xt
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_pÜtcÚ_t
 * 
ocÚ
,

112 cÚ¡ 
qpŞ_cÚ‹xt_t
 ** 
cÚ‹xt
);

114 #ifdef 
__ılu¥lus


	@libqpol/include/qpol/rbacrule_query.h

26 #iâdeà
QPOL_RBACRULE_QUERY


27 
	#QPOL_RBACRULE_QUERY


	)

29 #ifdef 
__ılu¥lus


34 
	~<qpŞ/pŞicy.h
>

35 
	~<qpŞ/™”©Ü.h
>

37 
qpŞ_rŞe_®low
 
	tqpŞ_rŞe_®low_t
;

38 
qpŞ_rŞe_Œªs
 
	tqpŞ_rŞe_Œªs_t
;

51 
qpŞ_pŞicy_g‘_rŞe_®low_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, 
qpŞ_™”©Ü_t
 ** 
™”
);

62 
qpŞ_rŞe_®low_g‘_sourû_rŞe
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_rŞe_®low_t
 * 
ruË
,

63 cÚ¡ 
qpŞ_rŞe_t
 ** 
sourû
);

74 
qpŞ_rŞe_®low_g‘_rg‘_rŞe
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_rŞe_®low_t
 * 
ruË
,

75 cÚ¡ 
qpŞ_rŞe_t
 ** 
rg‘
);

88 
qpŞ_pŞicy_g‘_rŞe_Œªs_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, 
qpŞ_™”©Ü_t
 ** 
™”
);

99 
qpŞ_rŞe_Œªs_g‘_sourû_rŞe
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_rŞe_Œªs_t
 * 
ruË
,

100 cÚ¡ 
qpŞ_rŞe_t
 ** 
sourû
);

111 
qpŞ_rŞe_Œªs_g‘_rg‘_ty³
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_rŞe_Œªs_t
 * 
ruË
,

112 cÚ¡ 
qpŞ_ty³_t
 ** 
rg‘
);

122 
qpŞ_rŞe_Œªs_g‘_objeù_şass
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_rŞe_Œªs_t
 * 
ruË
,

123 cÚ¡ 
qpŞ_şass_t
 ** 
obj_şass
);

134 
qpŞ_rŞe_Œªs_g‘_deçuÉ_rŞe
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_rŞe_Œªs_t
 * 
ruË
,

135 cÚ¡ 
qpŞ_rŞe_t
 ** 
dæt
);

137 #ifdef 
__ılu¥lus


	@libqpol/include/qpol/role_query.h

26 #iâdeà
QPOL_ROLE_QUERY_H


27 
	#QPOL_ROLE_QUERY_H


	)

29 #ifdef 
__ılu¥lus


34 
	~<¡ddef.h
>

35 
	~<¡dšt.h
>

36 
	~<qpŞ/™”©Ü.h
>

37 
	~<qpŞ/pŞicy.h
>

39 
qpŞ_rŞe
 
	tqpŞ_rŞe_t
;

50 
qpŞ_pŞicy_g‘_rŞe_by_Çme
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ *
Çme
, cÚ¡ 
qpŞ_rŞe_t
 ** 
d©um
);

62 
qpŞ_pŞicy_g‘_rŞe_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, 
qpŞ_™”©Ü_t
 ** 
™”
);

73 
qpŞ_rŞe_g‘_v®ue
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_rŞe_t
 * 
d©um
, 
ušt32_t
 * 
v®ue
);

88 
qpŞ_rŞe_g‘_domš©e_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_rŞe_t
 * 
d©um
,

89 
qpŞ_™”©Ü_t
 ** 
domš©es
);

102 
qpŞ_rŞe_g‘_ty³_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_rŞe_t
 * 
d©um
, 
qpŞ_™”©Ü_t
 ** 
ty³s
);

113 
qpŞ_rŞe_g‘_Çme
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_rŞe_t
 * 
d©um
, cÚ¡ **
Çme
);

115 #ifdef 
__ılu¥lus


	@libqpol/include/qpol/syn_rule_query.h

26 #iâdeà
QPOL_SYN_RULE_QUERY_H


27 
	#QPOL_SYN_RULE_QUERY_H


	)

29 #ifdef 
__ılu¥lus


34 
	~<qpŞ/pŞicy.h
>

35 
	~<qpŞ/cÚd_qu”y.h
>

36 
	~<qpŞ/™”©Ü.h
>

37 
	~<¡dšt.h
>

39 
qpŞ_ty³_£t
 
	tqpŞ_ty³_£t_t
;

40 
qpŞ_syn_avruË
 
	tqpŞ_syn_avruË_t
;

41 
qpŞ_syn_‹ruË
 
	tqpŞ_syn_‹ruË_t
;

55 
qpŞ_ty³_£t_g‘_šşuded_ty³s_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_ty³_£t_t
 * 
ts
,

56 
qpŞ_™”©Ü_t
 ** 
™”
);

70 
qpŞ_ty³_£t_g‘_subŒaùed_ty³s_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_ty³_£t_t
 * 
ts
,

71 
qpŞ_™”©Ü_t
 ** 
™”
);

82 
qpŞ_ty³_£t_g‘_is_¡¬
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_ty³_£t_t
 * 
ts
, 
ušt32_t
 * 
is_¡¬
);

93 
qpŞ_ty³_£t_g‘_is_comp
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_ty³_£t_t
 * 
ts
, 
ušt32_t
 * 
is_comp
);

104 
qpŞ_syn_avruË_g‘_ruË_ty³
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_syn_avruË_t
 * 
ruË
,

105 
ušt32_t
 * 
ruË_ty³
);

116 
qpŞ_syn_avruË_g‘_sourû_ty³_£t
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_syn_avruË_t
 * 
ruË
,

117 cÚ¡ 
qpŞ_ty³_£t_t
 ** 
sourû_£t
);

128 
qpŞ_syn_avruË_g‘_rg‘_ty³_£t
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_syn_avruË_t
 * 
ruË
,

129 cÚ¡ 
qpŞ_ty³_£t_t
 ** 
rg‘_£t
);

140 
qpŞ_syn_avruË_g‘_is_rg‘_£lf
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_syn_avruË_t
 * 
ruË
,

141 
ušt32_t
 * 
is_£lf
);

155 
qpŞ_syn_avruË_g‘_şass_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_syn_avruË_t
 * 
ruË
,

156 
qpŞ_™”©Ü_t
 ** 
şas£s
);

170 
qpŞ_syn_avruË_g‘_³rm_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_syn_avruË_t
 * 
ruË
,

171 
qpŞ_™”©Ü_t
 ** 
³rms
);

181 
qpŞ_syn_avruË_g‘_lš’o
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_syn_avruË_t
 * 
ruË
, *
lš’o
);

193 
qpŞ_syn_avruË_g‘_cÚd
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_syn_avruË_t
 * 
ruË
,

194 cÚ¡ 
qpŞ_cÚd_t
 ** 
cÚd
);

206 
qpŞ_syn_avruË_g‘_is_’abËd
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_syn_avruË_t
 * 
ruË
,

207 
ušt32_t
 * 
is_’abËd
);

218 
qpŞ_syn_‹ruË_g‘_ruË_ty³
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_syn_‹ruË_t
 * 
ruË
,

219 
ušt32_t
 * 
ruË_ty³
);

230 
qpŞ_syn_‹ruË_g‘_sourû_ty³_£t
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_syn_‹ruË_t
 * 
ruË
,

231 cÚ¡ 
qpŞ_ty³_£t_t
 ** 
sourû_£t
);

242 
qpŞ_syn_‹ruË_g‘_rg‘_ty³_£t
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_syn_‹ruË_t
 * 
ruË
,

243 cÚ¡ 
qpŞ_ty³_£t_t
 ** 
rg‘_£t
);

257 
qpŞ_syn_‹ruË_g‘_şass_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_syn_‹ruË_t
 * 
ruË
,

258 
qpŞ_™”©Ü_t
 ** 
şas£s
);

261 
	gqpŞ_ty³
;

271 
qpŞ_syn_‹ruË_g‘_deçuÉ_ty³
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_syn_‹ruË_t
 * 
ruË
,

272 cÚ¡ 
qpŞ_ty³
 **
dæt
);

282 
qpŞ_syn_‹ruË_g‘_lš’o
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_syn_‹ruË_t
 * 
ruË
, *
lš’o
);

294 
qpŞ_syn_‹ruË_g‘_cÚd
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_syn_‹ruË_t
 * 
ruË
,

295 cÚ¡ 
qpŞ_cÚd_t
 ** 
cÚd
);

307 
qpŞ_syn_‹ruË_g‘_is_’abËd
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_syn_‹ruË_t
 * 
ruË
,

308 
ušt32_t
 * 
is_’abËd
);

310 #ifdef 
__ılu¥lus


	@libqpol/include/qpol/terule_query.h

26 #iâdeà
QPOL_TERULE_QUERY_H


27 
	#QPOL_TERULE_QUERY_H


	)

29 #ifdef 
__ılu¥lus


34 
	~<qpŞ/pŞicy.h
>

35 
	~<qpŞ/cÚd_qu”y.h
>

37 
qpŞ_‹ruË
 
	tqpŞ_‹ruË_t
;

40 
	#QPOL_RULE_TYPE_TRANS
 16

	)

41 
	#QPOL_RULE_TYPE_CHANGE
 64

	)

42 
	#QPOL_RULE_TYPE_MEMBER
 32

	)

59 
qpŞ_pŞicy_g‘_‹ruË_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, 
ušt32_t
 
ruË_ty³_mask
, 
qpŞ_™”©Ü_t
 ** 
™”
);

70 
qpŞ_‹ruË_g‘_sourû_ty³
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_‹ruË_t
 * 
ruË
,

71 cÚ¡ 
qpŞ_ty³_t
 ** 
sourû
);

82 
qpŞ_‹ruË_g‘_rg‘_ty³
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_‹ruË_t
 * 
ruË
,

83 cÚ¡ 
qpŞ_ty³_t
 ** 
rg‘
);

94 
qpŞ_‹ruË_g‘_objeù_şass
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_‹ruË_t
 * 
ruË
,

95 cÚ¡ 
qpŞ_şass_t
 ** 
obj_şass
);

106 
qpŞ_‹ruË_g‘_deçuÉ_ty³
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_‹ruË_t
 * 
ruË
,

107 cÚ¡ 
qpŞ_ty³_t
 ** 
dæt
);

118 
qpŞ_‹ruË_g‘_ruË_ty³
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_‹ruË_t
 * 
ruË
, 
ušt32_t
 * 
ruË_ty³
);

130 
qpŞ_‹ruË_g‘_cÚd
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_‹ruË_t
 * 
ruË
, cÚ¡ 
qpŞ_cÚd_t
 ** 
cÚd
);

141 
qpŞ_‹ruË_g‘_is_’abËd
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_‹ruË_t
 * 
ruË
, 
ušt32_t
 * 
is_’abËd
);

153 
qpŞ_‹ruË_g‘_which_li¡
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_‹ruË_t
 * 
ruË
, 
ušt32_t
 * 
which_li¡
);

155 #ifdef 
__ılu¥lus


	@libqpol/include/qpol/type_query.h

26 #iâdeà
QPOL_TYPE_QUERY_H


27 
	#QPOL_TYPE_QUERY_H


	)

29 #ifdef 
__ılu¥lus


34 
	~<¡ddef.h
>

35 
	~<¡dšt.h
>

36 
	~<qpŞ/™”©Ü.h
>

37 
	~<qpŞ/pŞicy.h
>

39 
qpŞ_ty³
 
	tqpŞ_ty³_t
;

50 
qpŞ_pŞicy_g‘_ty³_by_Çme
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ *
Çme
, cÚ¡ 
qpŞ_ty³_t
 ** 
d©um
);

63 
qpŞ_pŞicy_g‘_ty³_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, 
qpŞ_™”©Ü_t
 ** 
™”
);

74 
qpŞ_ty³_g‘_v®ue
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_ty³_t
 * 
d©um
, 
ušt32_t
 * 
v®ue
);

85 
qpŞ_ty³_g‘_i§lŸs
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_ty³_t
 * 
d©um
, *
i§lŸs
);

96 
qpŞ_ty³_g‘_i§‰r
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_ty³_t
 * 
d©um
, *
i§‰r
);

111 
qpŞ_ty³_g‘_i¥”missive
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_ty³_t
 * 
d©um
, *
i¥”missive
);

126 
qpŞ_ty³_g‘_ty³_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_ty³_t
 * 
d©um
, 
qpŞ_™”©Ü_t
 ** 
ty³s
);

141 
qpŞ_ty³_g‘_©Œ_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_ty³_t
 * 
d©um
, 
qpŞ_™”©Ü_t
 ** 
©Œs
);

153 
qpŞ_ty³_g‘_Çme
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_ty³_t
 * 
d©um
, cÚ¡ **
Çme
);

169 
qpŞ_ty³_g‘_®Ÿs_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_ty³_t
 * 
d©um
, 
qpŞ_™”©Ü_t
 ** 
®Ÿ£s
);

171 #ifdef 
__ılu¥lus


	@libqpol/include/qpol/user_query.h

25 #iâdeà
QPOL_USER_QUERY_H


26 
	#QPOL_USER_QUERY_H


	)

28 #ifdef 
__ılu¥lus


33 
	~<¡ddef.h
>

34 
	~<¡dšt.h
>

35 
	~<qpŞ/™”©Ü.h
>

36 
	~<qpŞ/pŞicy.h
>

37 
	~<qpŞ/mls_qu”y.h
>

39 
qpŞ_u£r
 
	tqpŞ_u£r_t
;

50 
qpŞ_pŞicy_g‘_u£r_by_Çme
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ *
Çme
, cÚ¡ 
qpŞ_u£r_t
 ** 
d©um
);

62 
qpŞ_pŞicy_g‘_u£r_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, 
qpŞ_™”©Ü_t
 ** 
™”
);

73 
qpŞ_u£r_g‘_v®ue
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_u£r_t
 * 
d©um
, 
ušt32_t
 * 
v®ue
);

86 
qpŞ_u£r_g‘_rŞe_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_u£r_t
 * 
d©um
, 
qpŞ_™”©Ü_t
 ** 
rŞes
);

99 
qpŞ_u£r_g‘_¿nge
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_u£r_t
 * 
d©um
, cÚ¡ 
qpŞ_mls_¿nge_t
 ** 
¿nge
);

112 
qpŞ_u£r_g‘_dæev–
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_u£r_t
 * 
d©um
,

113 cÚ¡ 
qpŞ_mls_Ëv–_t
 ** 
Ëv–
);

124 
qpŞ_u£r_g‘_Çme
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_u£r_t
 * 
d©um
, cÚ¡ **
Çme
);

126 #ifdef 
__ılu¥lus


	@libqpol/include/qpol/util.h

26 #iâdeà
QPOL_UTIL_H


27 
	#QPOL_UTIL_H


	)

29 #ifdef 
__ılu¥lus


39 cÚ¡ *
libqpŞ_g‘_v”siÚ
();

51 
qpŞ_deçuÉ_pŞicy_fšd
(**
·th
);

55 
ssize_t
 
qpŞ_bunz
(
FILE
 *
f
, **
d©a
);

57 #ifdef 
__ılu¥lus


	@libqpol/src/avrule_query.c

26 
	~"™”©Ü_š‹º®.h
"

27 
	~<qpŞ/™”©Ü.h
>

28 
	~<qpŞ/pŞicy.h
>

29 
	~<qpŞ/avruË_qu”y.h
>

30 
	~<£pŞ/pŞicydb/pŞicydb.h
>

31 
	~<£pŞ/pŞicydb/avb.h
>

32 
	~<£pŞ/pŞicydb/ut.h
>

33 
	~<¡dlib.h
>

34 
	~"qpŞ_š‹º®.h
"

36 
	$qpŞ_pŞicy_g‘_avruË_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, 
ušt32_t
 
ruË_ty³_mask
, 
qpŞ_™”©Ü_t
 ** 
™”
)

38 
pŞicydb_t
 *
db
;

39 
avb_¡©e_t
 *
¡©e
;

41 ià(
™”
) {

42 *
™”
 = 
NULL
;

44 ià(
pŞicy
 =ğ
NULL
 || 
™”
 == NULL) {

45 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

46 
”ºo
 = 
EINVAL
;

47  
STATUS_ERR
;

51 ià(!
	`qpŞ_pŞicy_has_ÿ·b™y
(
pŞicy
, 
QPOL_CAP_RULES_LOADED
)) {

52 
	`ERR
(
pŞicy
, "%s", "Cannot get‡vrules: Rules‚ot†oaded");

53 
”ºo
 = 
ENOTSUP
;

54  
STATUS_ERR
;

58 ià((
ruË_ty³_mask
 & 
QPOL_RULE_NEVERALLOW
è&& !
	`qpŞ_pŞicy_has_ÿ·b™y
(
pŞicy
, 
QPOL_CAP_NEVERALLOW
)) {

59 
	`ERR
(
pŞicy
, "%s", "Cannot get‡vrules: Neverallow„ules„equested but‚ot‡vailable");

60 
”ºo
 = 
ENOTSUP
;

61  
STATUS_ERR
;

64 
db
 = &
pŞicy
->
p
->p;

66 
¡©e
 = 
	`ÿÎoc
(1, (
avb_¡©e_t
));

67 ià(
¡©e
 =ğ
NULL
) {

68 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

69 
”ºo
 = 
ENOMEM
;

70  
STATUS_ERR
;

72 
¡©e
->
ucÚd_b
 = &
db
->
‹_avb
;

73 
¡©e
->
cÚd_b
 = &
db
->
‹_cÚd_avb
;

74 
¡©e
->
ruË_ty³_mask
 =„ule_type_mask;

75 
¡©e
->
node
 = 
db
->
‹_avb
.
hbË
[0];

77 ià(
qpŞ_™”©Ü_ü—‹


78 (
pŞicy
, 
¡©e
, 
avb_¡©e_g‘_cur
, 
avb_¡©e_Ãxt
, 
avb_¡©e_’d
, 
avb_¡©e_size
, 
ä“
, 
™”
)) {

79 
	`ä“
(
¡©e
);

80  
STATUS_ERR
;

82 ià(
¡©e
->
node
 =ğ
NULL
 || !(¡©e->node->
key
.
¥ecif›d
 & s‹->
ruË_ty³_mask
)) {

83 
	`avb_¡©e_Ãxt
(*
™”
);

85  
STATUS_SUCCESS
;

86 
	}
}

88 
	$qpŞ_avruË_g‘_sourû_ty³
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_avruË_t
 * 
ruË
, cÚ¡ 
qpŞ_ty³_t
 ** 
sourû
)

90 
pŞicydb_t
 *
db
 = 
NULL
;

91 
avb_±r_t
 
avruË
 = 
NULL
;

93 ià(
sourû
) {

94 *
sourû
 = 
NULL
;

97 ià(!
pŞicy
 || !
ruË
 || !
sourû
) {

98 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

99 
”ºo
 = 
EINVAL
;

100  
STATUS_ERR
;

103 
db
 = &
pŞicy
->
p
->p;

104 
avruË
 = (
avb_±r_t
è
ruË
;

106 *
sourû
 = (
qpŞ_ty³_t
 *è
db
->
ty³_v®_to_¡ruù
[
avruË
->
key
.
sourû_ty³
 - 1];

108  
STATUS_SUCCESS
;

109 
	}
}

111 
	$qpŞ_avruË_g‘_rg‘_ty³
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_avruË_t
 * 
ruË
, cÚ¡ 
qpŞ_ty³_t
 ** 
rg‘
)

113 
pŞicydb_t
 *
db
 = 
NULL
;

114 
avb_±r_t
 
avruË
 = 
NULL
;

116 ià(
rg‘
) {

117 *
rg‘
 = 
NULL
;

120 ià(!
pŞicy
 || !
ruË
 || !
rg‘
) {

121 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

122 
”ºo
 = 
EINVAL
;

123  
STATUS_ERR
;

126 
db
 = &
pŞicy
->
p
->p;

127 
avruË
 = (
avb_±r_t
è
ruË
;

129 *
rg‘
 = (
qpŞ_ty³_t
 *è
db
->
ty³_v®_to_¡ruù
[
avruË
->
key
.
rg‘_ty³
 - 1];

131  
STATUS_SUCCESS
;

132 
	}
}

134 
	$qpŞ_avruË_g‘_objeù_şass
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_avruË_t
 * 
ruË
, cÚ¡ 
qpŞ_şass_t
 ** 
obj_şass
)

136 
pŞicydb_t
 *
db
 = 
NULL
;

137 
avb_±r_t
 
avruË
 = 
NULL
;

139 ià(
obj_şass
) {

140 *
obj_şass
 = 
NULL
;

143 ià(!
pŞicy
 || !
ruË
 || !
obj_şass
) {

144 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

145 
”ºo
 = 
EINVAL
;

146  
STATUS_ERR
;

149 
db
 = &
pŞicy
->
p
->p;

150 
avruË
 = (
avb_±r_t
è
ruË
;

152 *
obj_şass
 = (
qpŞ_şass_t
 *è
db
->
şass_v®_to_¡ruù
[
avruË
->
key
.
rg‘_şass
 - 1];

154  
STATUS_SUCCESS
;

155 
	}
}

157 
	$qpŞ_avruË_g‘_³rm_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_avruË_t
 * 
ruË
, 
qpŞ_™”©Ü_t
 ** 
³rms
)

159 
pŞicydb_t
 *
db
 = 
NULL
;

160 
avb_±r_t
 
avruË
 = 
NULL
;

161 
³rm_¡©e_t
 *
ps
 = 
NULL
;

163 ià(
³rms
) {

164 *
³rms
 = 
NULL
;

167 ià(!
pŞicy
 || !
ruË
 || !
³rms
) {

168 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

169 
”ºo
 = 
EINVAL
;

170  
STATUS_ERR
;

173 
db
 = &
pŞicy
->
p
->p;

174 
avruË
 = (
avb_±r_t
è
ruË
;

175 
ps
 = 
	`ÿÎoc
(1, (
³rm_¡©e_t
));

176 ià(!
ps
) {

177  
STATUS_ERR
;

179 ià(
avruË
->
key
.
¥ecif›d
 & 
QPOL_RULE_DONTAUDIT
) {

180 
ps
->
³rm_£t
 = ~(
avruË
->
d©um
.
d©a
);

182 
ps
->
³rm_£t
 = 
avruË
->
d©um
.
d©a
;

184 
ps
->
obj_şass_v®
 = 
avruË
->
key
.
rg‘_şass
;

186 ià(
	`qpŞ_™”©Ü_ü—‹
(
pŞicy
, (*)
ps
, 
³rm_¡©e_g‘_cur
,

187 
³rm_¡©e_Ãxt
, 
³rm_¡©e_’d
, 
³rm_¡©e_size
, 
ä“
, 
³rms
)) {

188  
STATUS_ERR
;

191 ià(!(
ps
->
³rm_£t
 & 1))

192 
	`³rm_¡©e_Ãxt
(*
³rms
);

194  
STATUS_SUCCESS
;

195 
	}
}

197 
	$qpŞ_avruË_g‘_ruË_ty³
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_avruË_t
 * 
ruË
, 
ušt32_t
 * 
ruË_ty³
)

199 
pŞicydb_t
 *
db
 = 
NULL
;

200 
avb_±r_t
 
avruË
 = 
NULL
;

202 ià(
ruË_ty³
) {

203 *
ruË_ty³
 = 0;

206 ià(!
pŞicy
 || !
ruË
 || !
ruË_ty³
) {

207 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

208 
”ºo
 = 
EINVAL
;

209  
STATUS_ERR
;

212 
db
 = &
pŞicy
->
p
->p;

213 
avruË
 = (
avb_±r_t
è
ruË
;

215 *
ruË_ty³
 =

216 (
avruË
->
key
.
¥ecif›d
 & (
QPOL_RULE_ALLOW
 | 
QPOL_RULE_NEVERALLOW
 | 
QPOL_RULE_AUDITALLOW
 | 
QPOL_RULE_DONTAUDIT
));

218  
STATUS_SUCCESS
;

219 
	}
}

221 
	$qpŞ_avruË_g‘_cÚd
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_avruË_t
 * 
ruË
, cÚ¡ 
qpŞ_cÚd_t
 ** 
cÚd
)

223 
avb_±r_t
 
avruË
 = 
NULL
;

225 ià(
cÚd
) {

226 *
cÚd
 = 
NULL
;

229 ià(!
pŞicy
 || !
ruË
 || !
cÚd
) {

230 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

231 
”ºo
 = 
EINVAL
;

232  
STATUS_ERR
;

235 
avruË
 = (
avb_±r_t
è
ruË
;

237 *
cÚd
 = (
qpŞ_cÚd_t
 *è
avruË
->
·r£_cÚ‹xt
;

239  
STATUS_SUCCESS
;

240 
	}
}

242 
	$qpŞ_avruË_g‘_is_’abËd
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_avruË_t
 * 
ruË
, 
ušt32_t
 * 
is_’abËd
)

244 
avb_±r_t
 
avruË
 = 
NULL
;

246 ià(
is_’abËd
) {

247 *
is_’abËd
 = 0;

250 ià(!
pŞicy
 || !
ruË
 || !
is_’abËd
) {

251 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

252 
”ºo
 = 
EINVAL
;

253  
STATUS_ERR
;

256 
avruË
 = (
avb_±r_t
è
ruË
;

258 *
is_’abËd
 = ((
avruË
->
m”ged
 & 
QPOL_COND_RULE_ENABLED
) ? 1 : 0);

260  
STATUS_SUCCESS
;

261 
	}
}

263 
	$qpŞ_avruË_g‘_which_li¡
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_avruË_t
 * 
ruË
, 
ušt32_t
 * 
which_li¡
)

265 
avb_±r_t
 
avruË
 = 
NULL
;

267 ià(
which_li¡
) {

268 *
which_li¡
 = 0;

271 ià(!
pŞicy
 || !
ruË
 || !
which_li¡
) {

272 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

273 
”ºo
 = 
EINVAL
;

274  
STATUS_ERR
;

277 
avruË
 = (
avb_±r_t
è
ruË
;

279 ià(!
avruË
->
·r£_cÚ‹xt
) {

280 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

281 
”ºo
 = 
EINVAL
;

282  
STATUS_ERR
;

285 *
which_li¡
 = ((
avruË
->
m”ged
 & 
QPOL_COND_RULE_LIST
) ? 1 : 0);

287  
STATUS_SUCCESS
;

288 
	}
}

	@libqpol/src/bool_query.c

26 
	~<¡ddef.h
>

27 
	~<¡dlib.h
>

28 
	~<¡dšt.h
>

29 
	~<qpŞ/™”©Ü.h
>

30 
	~<£pŞ/pŞicydb.h
>

31 
	~<£pŞ/pŞicydb/pŞicydb.h
>

32 
	~<£pŞ/pŞicydb/ex·nd.h
>

33 
	~"™”©Ü_š‹º®.h
"

34 
	~<qpŞ/boŞ_qu”y.h
>

35 
	~"qpŞ_š‹º®.h
"

37 
	$qpŞ_pŞicy_g‘_boŞ_by_Çme
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ *
Çme
, 
qpŞ_boŞ_t
 ** 
d©um
)

39 
hashb_d©um_t
 
š‹º®_d©um
;

40 
pŞicydb_t
 *
db
;

42 ià(
pŞicy
 =ğ
NULL
 || 
Çme
 =ğNULL || 
d©um
 == NULL) {

43 ià(
d©um
 !ğ
NULL
)

44 *
d©um
 = 
NULL
;

45 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

46 
”ºo
 = 
EINVAL
;

47  
STATUS_ERR
;

50 
db
 = &
pŞicy
->
p
->p;

51 
š‹º®_d©um
 = 
	`hashb_£¬ch
(
db
->
p_boŞs
.
bË
, (cÚ¡ 
hashb_key_t
)
Çme
);

52 ià(
š‹º®_d©um
 =ğ
NULL
) {

53 
	`ERR
(
pŞicy
, "could‚Ù fšd d©um fÜ boŞ %s", 
Çme
);

54 *
d©um
 = 
NULL
;

55 
”ºo
 = 
ENOENT
;

56  
STATUS_ERR
;

58 *
d©um
 = (
qpŞ_boŞ_t
 *è
š‹º®_d©um
;

60  
STATUS_SUCCESS
;

61 
	}
}

63 
	$qpŞ_pŞicy_g‘_boŞ_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, 
qpŞ_™”©Ü_t
 ** 
™”
)

65 
pŞicydb_t
 *
db
;

66 
hash_¡©e_t
 *
hs
 = 
NULL
;

67 
”rÜ
 = 0;

69 ià(
pŞicy
 =ğ
NULL
 || 
™”
 == NULL) {

70 ià(
™”
 !ğ
NULL
)

71 *
™”
 = 
NULL
;

72 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

73 
”ºo
 = 
EINVAL
;

74  
STATUS_ERR
;

77 
db
 = &
pŞicy
->
p
->p;

79 
hs
 = 
	`ÿÎoc
(1, (
hash_¡©e_t
));

80 ià(
hs
 =ğ
NULL
) {

81 
”rÜ
 = 
”ºo
;

82 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

83 
”ºo
 = 
”rÜ
;

84  
STATUS_ERR
;

86 
hs
->
bË
 = &
db
->
p_boŞs
.table;

87 
hs
->
node
 = (*(hs->
bË
))->
hbË
[0];

89 ià(
	`qpŞ_™”©Ü_ü—‹
(
pŞicy
, (*)
hs
, 
hash_¡©e_g‘_cur
,

90 
hash_¡©e_Ãxt
, 
hash_¡©e_’d
, 
hash_¡©e_size
, 
ä“
, 
™”
)) {

91 
	`ä“
(
hs
);

92  
STATUS_ERR
;

95 ià(
hs
->
node
 =ğ
NULL
)

96 
	`hash_¡©e_Ãxt
(*
™”
);

98  
STATUS_SUCCESS
;

99 
	}
}

101 
	$qpŞ_boŞ_g‘_v®ue
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_boŞ_t
 * 
d©um
, 
ušt32_t
 * 
v®ue
)

103 
cÚd_boŞ_d©um_t
 *
š‹º®_d©um
;

105 ià(
pŞicy
 =ğ
NULL
 || 
d©um
 =ğNULL || 
v®ue
 == NULL) {

106 ià(
v®ue
 !ğ
NULL
)

107 *
v®ue
 = 0;

108 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

109 
”ºo
 = 
EINVAL
;

110  
STATUS_ERR
;

113 
š‹º®_d©um
 = (
cÚd_boŞ_d©um_t
 *è
d©um
;

114 *
v®ue
 = 
š‹º®_d©um
->
s
.value;

116  
STATUS_SUCCESS
;

117 
	}
}

119 
	$qpŞ_boŞ_g‘_¡©e
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_boŞ_t
 * 
d©um
, *
¡©e
)

121 
cÚd_boŞ_d©um_t
 *
š‹º®_d©um
;

123 ià(
pŞicy
 =ğ
NULL
 || 
d©um
 =ğNULL || 
¡©e
 == NULL) {

124 ià(
¡©e
 !ğ
NULL
)

125 *
¡©e
 = 0;

126 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

127 
”ºo
 = 
EINVAL
;

128  
STATUS_ERR
;

131 
š‹º®_d©um
 = (
cÚd_boŞ_d©um_t
 *è
d©um
;

132 *
¡©e
 = 
š‹º®_d©um
->state;

134  
STATUS_SUCCESS
;

135 
	}
}

137 
	$qpŞ_boŞ_£t_¡©e
(
qpŞ_pŞicy_t
 * 
pŞicy
, 
qpŞ_boŞ_t
 * 
d©um
, 
¡©e
)

139 
cÚd_boŞ_d©um_t
 *
š‹º®_d©um
;

141 ià(
pŞicy
 =ğ
NULL
 || 
d©um
 == NULL) {

142 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

143 
”ºo
 = 
EINVAL
;

144  
STATUS_ERR
;

147 
š‹º®_d©um
 = (
cÚd_boŞ_d©um_t
 *è
d©um
;

148 
š‹º®_d©um
->
¡©e
 = state;

151 ià(
	`qpŞ_pŞicy_»ev®u©e_cÚds
(
pŞicy
)) {

152  
STATUS_ERR
;

155  
STATUS_SUCCESS
;

156 
	}
}

158 
	$qpŞ_boŞ_£t_¡©e_no_ev®
(
qpŞ_pŞicy_t
 * 
pŞicy
, 
qpŞ_boŞ_t
 * 
d©um
, 
¡©e
)

160 
cÚd_boŞ_d©um_t
 *
š‹º®_d©um
;

162 ià(
pŞicy
 =ğ
NULL
 || 
d©um
 == NULL) {

163 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

164 
”ºo
 = 
EINVAL
;

165  
STATUS_ERR
;

168 
š‹º®_d©um
 = (
cÚd_boŞ_d©um_t
 *è
d©um
;

169 
š‹º®_d©um
->
¡©e
 = state;

171  
STATUS_SUCCESS
;

172 
	}
}

174 
	$qpŞ_boŞ_g‘_Çme
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_boŞ_t
 * 
d©um
, cÚ¡ **
Çme
)

176 
cÚd_boŞ_d©um_t
 *
š‹º®_d©um
 = 
NULL
;

177 
pŞicydb_t
 *
db
 = 
NULL
;

179 ià(
pŞicy
 =ğ
NULL
 || 
d©um
 =ğNULL || 
Çme
 == NULL) {

180 ià(
Çme
 !ğ
NULL
)

181 *
Çme
 = 
NULL
;

182 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

183 
”ºo
 = 
EINVAL
;

184  
STATUS_ERR
;

187 
db
 = &
pŞicy
->
p
->p;

188 
š‹º®_d©um
 = (
cÚd_boŞ_d©um_t
 *è
d©um
;

190 *
Çme
 = 
db
->
p_boŞ_v®_to_Çme
[
š‹º®_d©um
->
s
.
v®ue
 - 1];

192  
STATUS_SUCCESS
;

193 
	}
}

	@libqpol/src/bounds_query.c

24 
	~<¡ddef.h
>

25 
	~<¡dlib.h
>

26 
	~<¡dšt.h
>

27 
	~<qpŞ/™”©Ü.h
>

28 
	~<qpŞ/pŞicy.h
>

29 
	~<qpŞ/bounds_qu”y.h
>

30 
	~<£pŞ/pŞicydb/pŞicydb.h
>

31 
	~"qpŞ_š‹º®.h
"

32 
	~"™”©Ü_š‹º®.h
"

35 
	$qpŞ_ty³bounds_g‘_·»Á_Çme
(cÚ¡ 
qpŞ_pŞicy_t
 *
pŞicy
, cÚ¡ 
qpŞ_ty³bounds_t
 * 
d©um
, cÚ¡ **
Çme
)

37 
ty³_d©um_t
 *
š‹º®_d©um
 = 
NULL
;

38 
pŞicydb_t
 *
db
 = 
NULL
;

40 ià(
pŞicy
 =ğ
NULL
 || 
d©um
 =ğNULL || 
Çme
 == NULL) {

41 ià(
Çme
 !ğ
NULL
)

42 *
Çme
 = 
NULL
;

43 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

44 
”ºo
 = 
EINVAL
;

45  
STATUS_ERR
;

47 *
Çme
 = 
NULL
;

50 ià(!
	`qpŞ_pŞicy_has_ÿ·b™y
(
pŞicy
, 
QPOL_CAP_BOUNDS
))

51  
STATUS_SUCCESS
;

53 
db
 = &
pŞicy
->
p
->p;

54 
š‹º®_d©um
 = (
ty³_d©um_t
 *)
d©um
;

57 ià(
š‹º®_d©um
->
æavÜ
 =ğ
TYPE_TYPE
 && iÁ”Çl_d©um->
bounds
 != 0) {

58 *
Çme
 = 
db
->
p_ty³_v®_to_Çme
[
š‹º®_d©um
->
bounds
 - 1];

60  
STATUS_SUCCESS
;

61 
	}
}

63 
	$qpŞ_ty³bounds_g‘_chd_Çme
(cÚ¡ 
qpŞ_pŞicy_t
 *
pŞicy
, cÚ¡ 
qpŞ_ty³bounds_t
 * 
d©um
, cÚ¡ **
Çme
)

65 
ty³_d©um_t
 *
š‹º®_d©um
 = 
NULL
;

66 
pŞicydb_t
 *
db
 = 
NULL
;

68 ià(
pŞicy
 =ğ
NULL
 || 
d©um
 =ğNULL || 
Çme
 == NULL) {

69 ià(
Çme
 !ğ
NULL
)

70 *
Çme
 = 
NULL
;

71 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

72 
”ºo
 = 
EINVAL
;

73  
STATUS_ERR
;

75 *
Çme
 = 
NULL
;

78 ià(!
	`qpŞ_pŞicy_has_ÿ·b™y
(
pŞicy
, 
QPOL_CAP_BOUNDS
))

79  
STATUS_SUCCESS
;

81 
db
 = &
pŞicy
->
p
->p;

82 
š‹º®_d©um
 = (
ty³_d©um_t
 *)
d©um
;

84 ià(
š‹º®_d©um
->
æavÜ
 =ğ
TYPE_TYPE
 && iÁ”Çl_d©um->
bounds
 != 0) {

85 *
Çme
 = 
db
->
p_ty³_v®_to_Çme
[
š‹º®_d©um
->
s
.
v®ue
 - 1];

87  
STATUS_SUCCESS
;

88 
	}
}

91 
	$qpŞ_pŞicy_g‘_ty³bounds_™”
(cÚ¡ 
qpŞ_pŞicy_t
 *
pŞicy
, 
qpŞ_™”©Ü_t
 **
™”
)

93 
pŞicydb_t
 *
db
;

94 
”rÜ
 = 0;

95 
hash_¡©e_t
 *
hs
 = 
NULL
;

97 ià(
pŞicy
 =ğ
NULL
 || 
™”
 == NULL) {

98 ià(
™”
 !ğ
NULL
)

99 *
™”
 = 
NULL
;

100 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

101 
”ºo
 = 
EINVAL
;

102  
STATUS_ERR
;

105 
db
 = &
pŞicy
->
p
->p;

121 
hs
 = 
	`ÿÎoc
(1, (
hash_¡©e_t
));

122 ià(
hs
 =ğ
NULL
) {

123 
”rÜ
 = 
”ºo
;

124 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

125 
”ºo
 = 
”rÜ
;

126  
STATUS_ERR
;

128 
hs
->
bË
 = &
db
->
p_ty³s
.table;

129 
hs
->
node
 = (*(hs->
bË
))->
hbË
[0];

131 ià(
	`qpŞ_™”©Ü_ü—‹
(
pŞicy
, (*)
hs
, 
hash_¡©e_g‘_cur
,

132 
hash_¡©e_Ãxt
, 
hash_¡©e_’d
, 
hash_¡©e_size
, 
ä“
, 
™”
)) {

133 
	`ä“
(
hs
);

134  
STATUS_ERR
;

137 ià(
hs
->
node
 =ğ
NULL
)

138 
	`hash_¡©e_Ãxt
(*
™”
);

140  
STATUS_SUCCESS
;

141 
	}
}

144 
	$qpŞ_rŞebounds_g‘_·»Á_Çme
(cÚ¡ 
qpŞ_pŞicy_t
 *
pŞicy
, cÚ¡ 
qpŞ_rŞebounds_t
 * 
d©um
, cÚ¡ **
Çme
)

146 
rŞe_d©um_t
 *
š‹º®_d©um
 = 
NULL
;

147 
pŞicydb_t
 *
db
 = 
NULL
;

149 ià(
pŞicy
 =ğ
NULL
 || 
d©um
 =ğNULL || 
Çme
 == NULL) {

150 ià(
Çme
 !ğ
NULL
)

151 *
Çme
 = 
NULL
;

152 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

153 
”ºo
 = 
EINVAL
;

154  
STATUS_ERR
;

156 *
Çme
 = 
NULL
;

159 ià(!
	`qpŞ_pŞicy_has_ÿ·b™y
(
pŞicy
, 
QPOL_CAP_BOUNDS
))

160  
STATUS_SUCCESS
;

162 
db
 = &
pŞicy
->
p
->p;

163 
š‹º®_d©um
 = (
rŞe_d©um_t
 *)
d©um
;

166 ià(
š‹º®_d©um
->
æavÜ
 =ğ
ROLE_ROLE
 && iÁ”Çl_d©um->
bounds
 != 0) {

167 *
Çme
 = 
db
->
p_rŞe_v®_to_Çme
[
š‹º®_d©um
->
bounds
 - 1];

169  
STATUS_SUCCESS
;

170 
	}
}

172 
	$qpŞ_rŞebounds_g‘_chd_Çme
(cÚ¡ 
qpŞ_pŞicy_t
 *
pŞicy
, cÚ¡ 
qpŞ_rŞebounds_t
 * 
d©um
, cÚ¡ **
Çme
)

174 
rŞe_d©um_t
 *
š‹º®_d©um
 = 
NULL
;

175 
pŞicydb_t
 *
db
 = 
NULL
;

177 ià(
pŞicy
 =ğ
NULL
 || 
d©um
 =ğNULL || 
Çme
 == NULL) {

178 ià(
Çme
 !ğ
NULL
)

179 *
Çme
 = 
NULL
;

180 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

181 
”ºo
 = 
EINVAL
;

182  
STATUS_ERR
;

184 *
Çme
 = 
NULL
;

187 ià(!
	`qpŞ_pŞicy_has_ÿ·b™y
(
pŞicy
, 
QPOL_CAP_BOUNDS
))

188  
STATUS_SUCCESS
;

190 
db
 = &
pŞicy
->
p
->p;

191 
š‹º®_d©um
 = (
rŞe_d©um_t
 *)
d©um
;

193 ià(
š‹º®_d©um
->
æavÜ
 =ğ
ROLE_ROLE
 && iÁ”Çl_d©um->
bounds
 != 0) {

194 *
Çme
 = 
db
->
p_rŞe_v®_to_Çme
[
š‹º®_d©um
->
s
.
v®ue
 - 1];

196  
STATUS_SUCCESS
;

197 
	}
}

200 
	$qpŞ_pŞicy_g‘_rŞebounds_™”
(cÚ¡ 
qpŞ_pŞicy_t
 *
pŞicy
, 
qpŞ_™”©Ü_t
 **
™”
)

202 
pŞicydb_t
 *
db
;

203 
”rÜ
 = 0;

204 
hash_¡©e_t
 *
hs
 = 
NULL
;

206 ià(
pŞicy
 =ğ
NULL
 || 
™”
 == NULL) {

207 ià(
™”
 !ğ
NULL
)

208 *
™”
 = 
NULL
;

209 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

210 
”ºo
 = 
EINVAL
;

211  
STATUS_ERR
;

214 
db
 = &
pŞicy
->
p
->p;

216 
hs
 = 
	`ÿÎoc
(1, (
hash_¡©e_t
));

217 ià(
hs
 =ğ
NULL
) {

218 
”rÜ
 = 
”ºo
;

219 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

220 
”ºo
 = 
”rÜ
;

221  
STATUS_ERR
;

223 
hs
->
bË
 = &
db
->
p_rŞes
.table;

224 
hs
->
node
 = (*(hs->
bË
))->
hbË
[0];

226 ià(
	`qpŞ_™”©Ü_ü—‹
(
pŞicy
, (*)
hs
, 
hash_¡©e_g‘_cur
,

227 
hash_¡©e_Ãxt
, 
hash_¡©e_’d
, 
hash_¡©e_size
, 
ä“
, 
™”
)) {

228 
	`ä“
(
hs
);

229  
STATUS_ERR
;

232 ià(
hs
->
node
 =ğ
NULL
)

233 
	`hash_¡©e_Ãxt
(*
™”
);

235  
STATUS_SUCCESS
;

236 
	}
}

239 
	$qpŞ_u£rbounds_g‘_·»Á_Çme
(cÚ¡ 
qpŞ_pŞicy_t
 *
pŞicy
, cÚ¡ 
qpŞ_u£rbounds_t
 * 
d©um
, cÚ¡ **
Çme
)

241 
u£r_d©um_t
 *
š‹º®_d©um
 = 
NULL
;

242 
pŞicydb_t
 *
db
 = 
NULL
;

244 ià(
pŞicy
 =ğ
NULL
 || 
d©um
 =ğNULL || 
Çme
 == NULL) {

245 ià(
Çme
 !ğ
NULL
)

246 *
Çme
 = 
NULL
;

247 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

248 
”ºo
 = 
EINVAL
;

249  
STATUS_ERR
;

251 *
Çme
 = 
NULL
;

254 ià(!
	`qpŞ_pŞicy_has_ÿ·b™y
(
pŞicy
, 
QPOL_CAP_BOUNDS
))

255  
STATUS_SUCCESS
;

257 
db
 = &
pŞicy
->
p
->p;

258 
š‹º®_d©um
 = (
u£r_d©um_t
 *)
d©um
;

261 ià(
š‹º®_d©um
->
bounds
 != 0) {

262 *
Çme
 = 
db
->
p_u£r_v®_to_Çme
[
š‹º®_d©um
->
bounds
 - 1];

264  
STATUS_SUCCESS
;

265 
	}
}

267 
	$qpŞ_u£rbounds_g‘_chd_Çme
(cÚ¡ 
qpŞ_pŞicy_t
 *
pŞicy
, cÚ¡ 
qpŞ_u£rbounds_t
 * 
d©um
, cÚ¡ **
Çme
)

269 
u£r_d©um_t
 *
š‹º®_d©um
 = 
NULL
;

270 
pŞicydb_t
 *
db
 = 
NULL
;

272 ià(
pŞicy
 =ğ
NULL
 || 
d©um
 =ğNULL || 
Çme
 == NULL) {

273 ià(
Çme
 !ğ
NULL
)

274 *
Çme
 = 
NULL
;

275 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

276 
”ºo
 = 
EINVAL
;

277  
STATUS_ERR
;

279 *
Çme
 = 
NULL
;

282 ià(!
	`qpŞ_pŞicy_has_ÿ·b™y
(
pŞicy
, 
QPOL_CAP_BOUNDS
))

283  
STATUS_SUCCESS
;

285 
db
 = &
pŞicy
->
p
->p;

286 
š‹º®_d©um
 = (
u£r_d©um_t
 *)
d©um
;

288 ià(
š‹º®_d©um
->
bounds
 != 0) {

289 *
Çme
 = 
db
->
p_u£r_v®_to_Çme
[
š‹º®_d©um
->
s
.
v®ue
 - 1];

291  
STATUS_SUCCESS
;

292 
	}
}

295 
	$qpŞ_pŞicy_g‘_u£rbounds_™”
(cÚ¡ 
qpŞ_pŞicy_t
 *
pŞicy
, 
qpŞ_™”©Ü_t
 **
™”
)

297 
pŞicydb_t
 *
db
;

298 
”rÜ
 = 0;

299 
hash_¡©e_t
 *
hs
 = 
NULL
;

301 ià(
pŞicy
 =ğ
NULL
 || 
™”
 == NULL) {

302 ià(
™”
 !ğ
NULL
)

303 *
™”
 = 
NULL
;

304 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

305 
”ºo
 = 
EINVAL
;

306  
STATUS_ERR
;

309 
db
 = &
pŞicy
->
p
->p;

311 
hs
 = 
	`ÿÎoc
(1, (
hash_¡©e_t
));

312 ià(
hs
 =ğ
NULL
) {

313 
”rÜ
 = 
”ºo
;

314 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

315 
”ºo
 = 
”rÜ
;

316  
STATUS_ERR
;

318 
hs
->
bË
 = &
db
->
p_u£rs
.table;

319 
hs
->
node
 = (*(hs->
bË
))->
hbË
[0];

321 ià(
	`qpŞ_™”©Ü_ü—‹
(
pŞicy
, (*)
hs
, 
hash_¡©e_g‘_cur
,

322 
hash_¡©e_Ãxt
, 
hash_¡©e_’d
, 
hash_¡©e_size
, 
ä“
, 
™”
)) {

323 
	`ä“
(
hs
);

324  
STATUS_ERR
;

327 ià(
hs
->
node
 =ğ
NULL
)

328 
	`hash_¡©e_Ãxt
(*
™”
);

330  
STATUS_SUCCESS
;

331 
	}
}

	@libqpol/src/class_perm_query.c

27 
	~<¡ddef.h
>

28 
	~<¡dšt.h
>

29 
	~<¡dlib.h
>

30 
	~<¡ršg.h
>

31 
	~<qpŞ/™”©Ü.h
>

32 
	~<£pŞ/pŞicydb.h
>

33 
	~<£pŞ/pŞicydb/pŞicydb.h
>

34 
	~<£pŞ/pŞicydb/ex·nd.h
>

35 
	~"™”©Ü_š‹º®.h
"

36 
	~<qpŞ/şass_³rm_qu”y.h
>

37 
	~"qpŞ_š‹º®.h
"

40 
	s³rm_hash_¡©e


42 
	mbuck‘
;

43 
hashb_node_t
 *
	mnode
;

44 
hashb_t
 *
	mbË
;

45 cÚ¡ *
	m³rm_Çme
;

46 } 
	t³rm_hash_¡©e_t
;

48 
	$hash_¡©e_Ãxt_şass_w_³rm
(
qpŞ_™”©Ü_t
 * 
™”
)

50 
şass_d©um_t
 *
š‹º®_şass
 = 
NULL
;

51 
qpŞ_™”©Ü_t
 *
š‹º®_³rms
 = 
NULL
;

52 
has_³rm
 = 0;

53 
³rm_hash_¡©e_t
 *
hs
 = 
NULL
;

54 
£pŞ_pŞicydb_t
 
¥
;

55 
qpŞ_pŞicy_t
 
qp
;

56 *
tmp
 = 
NULL
;

58 
hs
 = (
³rm_hash_¡©e_t
 *è
	`qpŞ_™”©Ü_¡©e
(
™”
);

59 ià(
hs
 =ğ
NULL
) {

60 
”ºo
 = 
EINVAL
;

61  
STATUS_ERR
;

64 ià(
hs
->
buck‘
 >ğ(*(hs->
bË
))->
size
) {

65 
”ºo
 = 
ERANGE
;

66  
STATUS_ERR
;

70 
¥
.
p
 = *
	`qpŞ_™”©Ü_pŞicy
(
™”
);

71 
qp
.
p
 = &
¥
;

72 
qp
.
â
 = 
NULL
;

75 
	`hash_¡©e_Ãxt
(
™”
);

76 ià(
	`hash_¡©e_’d
(
™”
))

78 
š‹º®_şass
 = 
hs
->
node
 ? (
şass_d©um_t
 *èhs->node->
d©um
 : 
NULL
;

79 
	`qpŞ_şass_g‘_³rm_™”
(&
qp
, (
qpŞ_şass_t
 *è
š‹º®_şass
, &
š‹º®_³rms
);

80 ; !
	`qpŞ_™”©Ü_’d
(
š‹º®_³rms
); 
	`qpŞ_™”©Ü_Ãxt
(internal_perms)) {

81 
	`qpŞ_™”©Ü_g‘_™em
(
š‹º®_³rms
, (**)&
tmp
);

82 ià(!
	`¡rcmp
(
tmp
, 
hs
->
³rm_Çme
)) {

83 
has_³rm
 = 1;

87 
	`qpŞ_™”©Ü_de¡roy
(&
š‹º®_³rms
);

88 } !
has_³rm
 && !
	`hash_¡©e_’d
(
™”
));

90  
STATUS_SUCCESS
;

91 
	}
}

93 
size_t
 
	$hash_³rm_¡©e_size_commÚ
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

95 
³rm_hash_¡©e_t
 *
hs
 = 
NULL
;

96 
ušt32_t
 
tmp_buck‘
 = 0;

97 
size_t
 
couÁ
 = 0;

98 
hashb_node_t
 *
tmp_node
;

99 
£pŞ_pŞicydb_t
 
¥
;

100 
qpŞ_pŞicy_t
 
qp
;

101 
qpŞ_™”©Ü_t
 *
š‹º®_³rms
;

102 
commÚ_d©um_t
 *
š‹º®_commÚ
;

103 *
tmp
 = 
NULL
;

105 ià(
™”
 =ğ
NULL
 || 
	`qpŞ_™”©Ü_¡©e
(iter) == NULL) {

106 
”ºo
 = 
EINVAL
;

107  
STATUS_ERR
;

109 
hs
 = (
³rm_hash_¡©e_t
 *è
	`qpŞ_™”©Ü_¡©e
(
™”
);

110 ià(
hs
 =ğ
NULL
) {

111 
”ºo
 = 
EINVAL
;

112  
STATUS_ERR
;

115 
¥
.
p
 = *
	`qpŞ_™”©Ü_pŞicy
(
™”
);

116 ià(&
¥
.
p
 =ğ
NULL
) {

117 
”ºo
 = 
EINVAL
;

118  
STATUS_ERR
;

120 
qp
.
p
 = &
¥
;

121 
qp
.
â
 = 
NULL
;

122 
tmp_buck‘
 = 0;mp_buck‘ < (*(
hs
->
bË
))->
size
;mp_bucket++) {

123 
tmp_node
 = (*(
hs
->
bË
))->
hbË
[
tmp_buck‘
];mp_node;mp_nodğtmp_node->
Ãxt
) {

124 
š‹º®_commÚ
 = 
tmp_node
 ? ((
commÚ_d©um_t
 *ètmp_node->
d©um
è: 
NULL
;

125 
	`qpŞ_commÚ_g‘_³rm_™”
(&
qp
, (
qpŞ_commÚ_t
 *è
š‹º®_commÚ
, &
š‹º®_³rms
);

126 ; !
	`qpŞ_™”©Ü_’d
(
š‹º®_³rms
); 
	`qpŞ_™”©Ü_Ãxt
(internal_perms)) {

127 
	`qpŞ_™”©Ü_g‘_™em
(
š‹º®_³rms
, (**)&
tmp
);

128 ià(!
	`¡rcmp
(
tmp
, 
hs
->
³rm_Çme
)) {

129 
couÁ
++;

133 
	`qpŞ_™”©Ü_de¡roy
(&
š‹º®_³rms
);

137  
couÁ
;

138 
	}
}

140 
size_t
 
	$hash_³rm_¡©e_size_şass
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

142 
³rm_hash_¡©e_t
 *
hs
 = 
NULL
;

143 
ušt32_t
 
tmp_buck‘
 = 0;

144 
size_t
 
couÁ
 = 0;

145 
hashb_node_t
 *
tmp_node
;

146 
£pŞ_pŞicydb_t
 
¥
;

147 
qpŞ_pŞicy_t
 
qp
;

148 
qpŞ_™”©Ü_t
 *
š‹º®_³rms
;

149 
şass_d©um_t
 *
š‹º®_şass
;

150 *
tmp
 = 
NULL
;

152 ià(
™”
 =ğ
NULL
 || 
	`qpŞ_™”©Ü_¡©e
(iter) == NULL) {

153 
”ºo
 = 
EINVAL
;

154  
STATUS_ERR
;

156 
hs
 = (
³rm_hash_¡©e_t
 *è
	`qpŞ_™”©Ü_¡©e
(
™”
);

157 ià(
hs
 =ğ
NULL
) {

158 
”ºo
 = 
EINVAL
;

159  
STATUS_ERR
;

162 
¥
.
p
 = *
	`qpŞ_™”©Ü_pŞicy
(
™”
);

163 
qp
.
p
 = &
¥
;

164 
qp
.
â
 = 
NULL
;

165 ià(&
¥
.
p
 =ğ
NULL
) {

166 
”ºo
 = 
EINVAL
;

167  
STATUS_ERR
;

169 
tmp_buck‘
 = 0;mp_buck‘ < (*(
hs
->
bË
))->
size
;mp_bucket++) {

170 
tmp_node
 = (*(
hs
->
bË
))->
hbË
[
tmp_buck‘
];mp_node;mp_nodğtmp_node->
Ãxt
) {

171 
š‹º®_şass
 = 
tmp_node
 ? ((
şass_d©um_t
 *ètmp_node->
d©um
è: 
NULL
;

172 
	`qpŞ_şass_g‘_³rm_™”
(&
qp
, (
qpŞ_şass_t
 *è
š‹º®_şass
, &
š‹º®_³rms
);

173 ; !
	`qpŞ_™”©Ü_’d
(
š‹º®_³rms
); 
	`qpŞ_™”©Ü_Ãxt
(internal_perms)) {

174 
	`qpŞ_™”©Ü_g‘_™em
(
š‹º®_³rms
, (**)&
tmp
);

175 ià(!
	`¡rcmp
(
tmp
, 
hs
->
³rm_Çme
)) {

176 
couÁ
++;

180 
	`qpŞ_™”©Ü_de¡roy
(&
š‹º®_³rms
);

184  
couÁ
;

185 
	}
}

187 
	$hash_¡©e_Ãxt_commÚ_w_³rm
(
qpŞ_™”©Ü_t
 * 
™”
)

189 
commÚ_d©um_t
 *
š‹º®_commÚ
 = 
NULL
;

190 
qpŞ_™”©Ü_t
 *
š‹º®_³rms
 = 
NULL
;

191 
has_³rm
 = 0;

192 
³rm_hash_¡©e_t
 *
hs
 = 
NULL
;

193 
£pŞ_pŞicydb_t
 
¥
;

194 
qpŞ_pŞicy_t
 
qp
;

195 *
tmp
 = 
NULL
;

197 
hs
 = (
³rm_hash_¡©e_t
 *è
	`qpŞ_™”©Ü_¡©e
(
™”
);

198 ià(
hs
 =ğ
NULL
) {

199 
”ºo
 = 
EINVAL
;

200  
STATUS_ERR
;

203 ià(
hs
->
buck‘
 >ğ(*(hs->
bË
))->
size
) {

204 
”ºo
 = 
ERANGE
;

205  
STATUS_ERR
;

209 
¥
.
p
 = *
	`qpŞ_™”©Ü_pŞicy
(
™”
);

210 
qp
.
p
 = &
¥
;

211 
qp
.
â
 = 
NULL
;

214 
	`hash_¡©e_Ãxt
(
™”
);

215 ià(
	`hash_¡©e_’d
(
™”
))

217 
š‹º®_commÚ
 = 
hs
->
node
 ? (
commÚ_d©um_t
 *èhs->node->
d©um
 : 
NULL
;

218 
	`qpŞ_commÚ_g‘_³rm_™”
(&
qp
, (
qpŞ_commÚ_t
 *è
š‹º®_commÚ
, &
š‹º®_³rms
);

219 ; !
	`qpŞ_™”©Ü_’d
(
š‹º®_³rms
); 
	`qpŞ_™”©Ü_Ãxt
(internal_perms)) {

220 
	`qpŞ_™”©Ü_g‘_™em
(
š‹º®_³rms
, (**)&
tmp
);

221 ià(!
	`¡rcmp
(
tmp
, 
hs
->
³rm_Çme
)) {

222 
has_³rm
 = 1;

226 
	`qpŞ_™”©Ü_de¡roy
(&
š‹º®_³rms
);

227 } !
has_³rm
 && !
	`hash_¡©e_’d
(
™”
));

229  
STATUS_SUCCESS
;

230 
	}
}

232 
	$qpŞ_şass_has_³rm
(cÚ¡ 
qpŞ_pŞicy_t
 * 
p
, cÚ¡ 
qpŞ_şass_t
 * 
şass
, cÚ¡ *
³rm
)

234 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

235 *
tmp
;

237 
	`qpŞ_şass_g‘_³rm_™”
(
p
, 
şass
, &
™”
);

238 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

239 
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
tmp
);

240 ià(!
	`¡rcmp
(
³rm
, 
tmp
)) {

241 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

245 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

247 
	}
}

249 
	$qpŞ_commÚ_has_³rm
(cÚ¡ 
qpŞ_pŞicy_t
 * 
p
, cÚ¡ 
qpŞ_commÚ_t
 * 
commÚ
, cÚ¡ *
³rm
)

251 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

252 *
tmp
;

254 
	`qpŞ_commÚ_g‘_³rm_™”
(
p
, 
commÚ
, &
™”
);

255 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

256 
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
tmp
);

257 ià(!
	`¡rcmp
(
³rm
, 
tmp
)) {

258 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

262 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

264 
	}
}

266 
	$qpŞ_³rm_g‘_şass_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ *
³rm
, 
qpŞ_™”©Ü_t
 ** 
şas£s
)

268 
pŞicydb_t
 *
db
;

269 
”rÜ
 = 0;

270 
³rm_hash_¡©e_t
 *
hs
 = 
NULL
;

272 ià(
pŞicy
 =ğ
NULL
 || 
şas£s
 == NULL) {

273 ià(
şas£s
 !ğ
NULL
)

274 *
şas£s
 = 
NULL
;

275 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

276 
”ºo
 = 
EINVAL
;

277  
STATUS_ERR
;

280 
db
 = &
pŞicy
->
p
->p;

282 
hs
 = 
	`ÿÎoc
(1, (
³rm_hash_¡©e_t
));

283 ià(
hs
 =ğ
NULL
) {

284 
”rÜ
 = 
”ºo
;

285 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

286 
”ºo
 = 
”rÜ
;

287  
STATUS_ERR
;

289 
hs
->
bË
 = &
db
->
p_şas£s
.table;

290 
hs
->
node
 = (*(hs->
bË
))->
hbË
[0];

291 
hs
->
³rm_Çme
 = 
³rm
;

293 ià(
	`qpŞ_™”©Ü_ü—‹
(
pŞicy
, (*)
hs
, 
hash_¡©e_g‘_cur
,

294 
hash_¡©e_Ãxt_şass_w_³rm
, 
hash_¡©e_’d
, 
hash_³rm_¡©e_size_şass
, 
ä“
, 
şas£s
)) {

295 
	`ä“
(
hs
);

296  
STATUS_ERR
;

299 ià(
hs
->
node
 =ğ
NULL
 || !
	`qpŞ_şass_has_³rm
(
pŞicy
, (
qpŞ_şass_t
 *èhs->node->
d©um
, 
³rm
))

300 
	`hash_¡©e_Ãxt_şass_w_³rm
(*
şas£s
);

302  
STATUS_SUCCESS
;

303 
	}
}

305 
	$qpŞ_³rm_g‘_commÚ_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ *
³rm
, 
qpŞ_™”©Ü_t
 ** 
commÚs
)

307 
pŞicydb_t
 *
db
;

308 
”rÜ
 = 0;

309 
³rm_hash_¡©e_t
 *
hs
 = 
NULL
;

311 ià(
pŞicy
 =ğ
NULL
 || 
commÚs
 == NULL) {

312 ià(
commÚs
 !ğ
NULL
)

313 *
commÚs
 = 
NULL
;

314 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

315 
”ºo
 = 
EINVAL
;

316  
STATUS_ERR
;

319 
db
 = &
pŞicy
->
p
->p;

321 
hs
 = 
	`ÿÎoc
(1, (
³rm_hash_¡©e_t
));

322 ià(
hs
 =ğ
NULL
) {

323 
”rÜ
 = 
”ºo
;

324 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

325 
”ºo
 = 
”rÜ
;

326  
STATUS_ERR
;

328 
hs
->
bË
 = &
db
->
p_commÚs
.table;

329 
hs
->
node
 = (*(hs->
bË
))->
hbË
[0];

330 
hs
->
³rm_Çme
 = 
³rm
;

332 ià(
	`qpŞ_™”©Ü_ü—‹
(
pŞicy
, (*)
hs
, 
hash_¡©e_g‘_cur
,

333 
hash_¡©e_Ãxt_commÚ_w_³rm
, 
hash_¡©e_’d
, 
hash_³rm_¡©e_size_commÚ
, 
ä“
, 
commÚs
)) {

334 
	`ä“
(
hs
);

335  
STATUS_ERR
;

338 ià(
hs
->
node
 =ğ
NULL
 || !
	`qpŞ_commÚ_has_³rm
(
pŞicy
, (
qpŞ_commÚ_t
 *èhs->node->
d©um
, 
³rm
))

339 
	`hash_¡©e_Ãxt_commÚ_w_³rm
(*
commÚs
);

341  
STATUS_SUCCESS
;

342 
	}
}

345 
	$qpŞ_pŞicy_g‘_şass_by_Çme
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ *
Çme
, cÚ¡ 
qpŞ_şass_t
 ** 
obj_şass
)

347 
hashb_d©um_t
 
š‹º®_d©um
;

348 
pŞicydb_t
 *
db
;

350 ià(
pŞicy
 =ğ
NULL
 || 
Çme
 =ğNULL || 
obj_şass
 == NULL) {

351 ià(
obj_şass
 !ğ
NULL
)

352 *
obj_şass
 = 
NULL
;

353 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

354 
”ºo
 = 
EINVAL
;

355  
STATUS_ERR
;

358 
db
 = &
pŞicy
->
p
->p;

359 
š‹º®_d©um
 = 
	`hashb_£¬ch
(
db
->
p_şas£s
.
bË
, (cÚ¡ 
hashb_key_t
)
Çme
);

360 ià(
š‹º®_d©um
 =ğ
NULL
) {

361 *
obj_şass
 = 
NULL
;

362 
	`ERR
(
pŞicy
, "could‚Ù fšd cÏs %s", 
Çme
);

363 
”ºo
 = 
ENOENT
;

364  
STATUS_ERR
;

367 *
obj_şass
 = (
qpŞ_şass_t
 *è
š‹º®_d©um
;

369  
STATUS_SUCCESS
;

370 
	}
}

372 
	$qpŞ_pŞicy_g‘_şass_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, 
qpŞ_™”©Ü_t
 ** 
™”
)

374 
pŞicydb_t
 *
db
;

375 
”rÜ
 = 0;

376 
hash_¡©e_t
 *
hs
 = 
NULL
;

378 ià(
pŞicy
 =ğ
NULL
 || 
™”
 == NULL) {

379 ià(
™”
 !ğ
NULL
)

380 *
™”
 = 
NULL
;

381 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

382 
”ºo
 = 
EINVAL
;

383  
STATUS_ERR
;

386 
db
 = &
pŞicy
->
p
->p;

388 
hs
 = 
	`ÿÎoc
(1, (
hash_¡©e_t
));

389 ià(
hs
 =ğ
NULL
) {

390 
”rÜ
 = 
”ºo
;

391 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

392 
”ºo
 = 
”rÜ
;

393  
STATUS_ERR
;

395 
hs
->
bË
 = &
db
->
p_şas£s
.table;

396 
hs
->
node
 = (*(hs->
bË
))->
hbË
[0];

398 ià(
	`qpŞ_™”©Ü_ü—‹
(
pŞicy
, (*)
hs
, 
hash_¡©e_g‘_cur
,

399 
hash_¡©e_Ãxt
, 
hash_¡©e_’d
, 
hash_¡©e_size
, 
ä“
, 
™”
)) {

400 
	`ä“
(
hs
);

401  
STATUS_ERR
;

404 ià(
hs
->
node
 =ğ
NULL
)

405 
	`hash_¡©e_Ãxt
(*
™”
);

407  
STATUS_SUCCESS
;

408 
	}
}

410 
	$qpŞ_şass_g‘_v®ue
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_şass_t
 * 
obj_şass
, 
ušt32_t
 * 
v®ue
)

412 
şass_d©um_t
 *
š‹º®_d©um
;

414 ià(
pŞicy
 =ğ
NULL
 || 
obj_şass
 =ğNULL || 
v®ue
 == NULL) {

415 ià(
v®ue
 !ğ
NULL
)

416 *
v®ue
 = 0;

417 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

418 
”ºo
 = 
EINVAL
;

419  
STATUS_ERR
;

422 
š‹º®_d©um
 = (
şass_d©um_t
 *è
obj_şass
;

423 *
v®ue
 = 
š‹º®_d©um
->
s
.value;

425  
STATUS_SUCCESS
;

426 
	}
}

428 
	$qpŞ_şass_g‘_commÚ
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_şass_t
 * 
obj_şass
, cÚ¡ 
qpŞ_commÚ_t
 ** 
commÚ
)

430 
şass_d©um_t
 *
š‹º®_d©um
 = 
NULL
;

432 ià(
pŞicy
 =ğ
NULL
 || 
obj_şass
 =ğNULL || 
commÚ
 == NULL) {

433 ià(
commÚ
 !ğ
NULL
)

434 *
commÚ
 = 
NULL
;

435 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

436 
”ºo
 = 
EINVAL
;

437  
STATUS_ERR
;

440 
š‹º®_d©um
 = (
şass_d©um_t
 *è
obj_şass
;

441 *
commÚ
 = (
qpŞ_commÚ_t
 *è
š‹º®_d©um
->
comd©um
;

443  
STATUS_SUCCESS
;

444 
	}
}

446 
	$qpŞ_şass_g‘_³rm_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_şass_t
 * 
obj_şass
, 
qpŞ_™”©Ü_t
 ** 
³rms
)

448 
şass_d©um_t
 *
š‹º®_d©um
 = 
NULL
;

449 
pŞicydb_t
 *
db
 = 
NULL
;

450 
”rÜ
 = 0;

451 
hash_¡©e_t
 *
hs
 = 
NULL
;

453 ià(
pŞicy
 =ğ
NULL
 || 
obj_şass
 =ğNULL || 
³rms
 == NULL) {

454 ià(
³rms
 !ğ
NULL
)

455 *
³rms
 = 
NULL
;

456 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

457 
”ºo
 = 
EINVAL
;

458  
STATUS_ERR
;

461 
š‹º®_d©um
 = (
şass_d©um_t
 *è
obj_şass
;

462 
db
 = &
pŞicy
->
p
->p;

464 
hs
 = 
	`ÿÎoc
(1, (
hash_¡©e_t
));

465 ià(
hs
 =ğ
NULL
) {

466 
”rÜ
 = 
”ºo
;

467 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

468 
”ºo
 = 
”rÜ
;

469  
STATUS_ERR
;

471 
hs
->
bË
 = &
š‹º®_d©um
->
³rmissiÚs
.table;

472 ià(
hs
->
bË
 && *(hs->table)) {

473 
hs
->
node
 = (*(hs->
bË
))->
hbË
[0];

475 
hs
->
node
 = 
NULL
;

478 ià(
	`qpŞ_™”©Ü_ü—‹
(
pŞicy
, (*)
hs
, 
hash_¡©e_g‘_cur_key
,

479 
hash_¡©e_Ãxt
, 
hash_¡©e_’d
, 
hash_¡©e_size
, 
ä“
, 
³rms
)) {

480 
	`ä“
(
hs
);

481  
STATUS_ERR
;

484 ià(
hs
->
node
 =ğ
NULL
)

485 
	`hash_¡©e_Ãxt
(*
³rms
);

487  
STATUS_SUCCESS
;

488 
	}
}

490 
	$qpŞ_şass_g‘_Çme
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_şass_t
 * 
obj_şass
, cÚ¡ **
Çme
)

492 
şass_d©um_t
 *
š‹º®_d©um
 = 
NULL
;

493 
pŞicydb_t
 *
db
 = 
NULL
;

495 ià(
pŞicy
 =ğ
NULL
 || 
obj_şass
 =ğNULL || 
Çme
 == NULL) {

496 ià(
Çme
 !ğ
NULL
)

497 *
Çme
 = 
NULL
;

498 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

499 
”ºo
 = 
EINVAL
;

500  
STATUS_ERR
;

503 
db
 = &
pŞicy
->
p
->p;

504 
š‹º®_d©um
 = (
şass_d©um_t
 *è
obj_şass
;

506 *
Çme
 = 
db
->
p_şass_v®_to_Çme
[
š‹º®_d©um
->
s
.
v®ue
 - 1];

508  
STATUS_SUCCESS
;

509 
	}
}

512 
	$qpŞ_pŞicy_g‘_commÚ_by_Çme
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ *
Çme
, cÚ¡ 
qpŞ_commÚ_t
 ** 
commÚ
)

514 
hashb_d©um_t
 
š‹º®_d©um
;

515 
pŞicydb_t
 *
db
;

517 ià(
pŞicy
 =ğ
NULL
 || 
Çme
 =ğNULL || 
commÚ
 == NULL) {

518 ià(
commÚ
 !ğ
NULL
)

519 *
commÚ
 = 
NULL
;

520 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

521 
”ºo
 = 
EINVAL
;

522  
STATUS_ERR
;

525 
db
 = &
pŞicy
->
p
->p;

526 
š‹º®_d©um
 = 
	`hashb_£¬ch
(
db
->
p_commÚs
.
bË
, (cÚ¡ 
hashb_key_t
)
Çme
);

527 ià(
š‹º®_d©um
 =ğ
NULL
) {

528 *
commÚ
 = 
NULL
;

529 
	`ERR
(
pŞicy
, "could‚Ù fšd commÚ %s", 
Çme
);

530 
”ºo
 = 
ENOENT
;

531  
STATUS_ERR
;

533 *
commÚ
 = (
qpŞ_commÚ_t
 *è
š‹º®_d©um
;

535  
STATUS_SUCCESS
;

536 
	}
}

538 
	$qpŞ_pŞicy_g‘_commÚ_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, 
qpŞ_™”©Ü_t
 ** 
™”
)

540 
pŞicydb_t
 *
db
;

541 
”rÜ
 = 0;

542 
hash_¡©e_t
 *
hs
 = 
NULL
;

544 ià(
pŞicy
 =ğ
NULL
 || 
™”
 == NULL) {

545 ià(
™”
 !ğ
NULL
)

546 *
™”
 = 
NULL
;

547 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

548 
”ºo
 = 
EINVAL
;

549  
STATUS_ERR
;

552 
db
 = &
pŞicy
->
p
->p;

554 
hs
 = 
	`ÿÎoc
(1, (
hash_¡©e_t
));

555 ià(
hs
 =ğ
NULL
) {

556 
”rÜ
 = 
”ºo
;

557 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

558 
”ºo
 = 
”rÜ
;

559  
STATUS_ERR
;

561 
hs
->
bË
 = &
db
->
p_commÚs
.table;

562 
hs
->
node
 = (*(hs->
bË
))->
hbË
[0];

564 ià(
	`qpŞ_™”©Ü_ü—‹
(
pŞicy
, (*)
hs
, 
hash_¡©e_g‘_cur
,

565 
hash_¡©e_Ãxt
, 
hash_¡©e_’d
, 
hash_¡©e_size
, 
ä“
, 
™”
)) {

566 
	`ä“
(
hs
);

567  
STATUS_ERR
;

570 ià(
hs
->
node
 =ğ
NULL
)

571 
	`hash_¡©e_Ãxt
(*
™”
);

573  
STATUS_SUCCESS
;

574 
	}
}

576 
	$qpŞ_commÚ_g‘_v®ue
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_commÚ_t
 * 
commÚ
, 
ušt32_t
 * 
v®ue
)

578 
commÚ_d©um_t
 *
š‹º®_d©um
;

580 ià(
pŞicy
 =ğ
NULL
 || 
commÚ
 =ğNULL || 
v®ue
 == NULL) {

581 ià(
v®ue
 !ğ
NULL
)

582 *
v®ue
 = 0;

583 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

584 
”ºo
 = 
EINVAL
;

585  
STATUS_ERR
;

588 
š‹º®_d©um
 = (
commÚ_d©um_t
 *è
commÚ
;

589 *
v®ue
 = 
š‹º®_d©um
->
s
.value;

591  
STATUS_SUCCESS
;

592 
	}
}

594 
	$qpŞ_commÚ_g‘_³rm_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_commÚ_t
 * 
commÚ
, 
qpŞ_™”©Ü_t
 ** 
³rms
)

596 
commÚ_d©um_t
 *
š‹º®_d©um
 = 
NULL
;

597 
pŞicydb_t
 *
db
 = 
NULL
;

598 
”rÜ
 = 0;

599 
hash_¡©e_t
 *
hs
 = 
NULL
;

601 ià(
pŞicy
 =ğ
NULL
 || 
commÚ
 =ğNULL || 
³rms
 == NULL) {

602 ià(
³rms
 !ğ
NULL
)

603 *
³rms
 = 
NULL
;

604 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

605 
”ºo
 = 
EINVAL
;

606  
STATUS_ERR
;

609 
š‹º®_d©um
 = (
commÚ_d©um_t
 *è
commÚ
;

610 
db
 = &
pŞicy
->
p
->p;

612 
hs
 = 
	`ÿÎoc
(1, (
hash_¡©e_t
));

613 ià(
hs
 =ğ
NULL
) {

614 
”rÜ
 = 
”ºo
;

615 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

616 
”ºo
 = 
”rÜ
;

617  
STATUS_ERR
;

619 
hs
->
bË
 = &
š‹º®_d©um
->
³rmissiÚs
.table;

620 
hs
->
node
 = (*(hs->
bË
))->
hbË
[0];

622 ià(
	`qpŞ_™”©Ü_ü—‹
(
pŞicy
, (*)
hs
, 
hash_¡©e_g‘_cur_key
,

623 
hash_¡©e_Ãxt
, 
hash_¡©e_’d
, 
hash_¡©e_size
, 
ä“
, 
³rms
)) {

624 
	`ä“
(
hs
);

625  
STATUS_ERR
;

628 ià(
hs
->
node
 =ğ
NULL
)

629 
	`hash_¡©e_Ãxt
(*
³rms
);

631  
STATUS_SUCCESS
;

632 
	}
}

634 
	$qpŞ_commÚ_g‘_Çme
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_commÚ_t
 * 
commÚ
, cÚ¡ **
Çme
)

636 
commÚ_d©um_t
 *
š‹º®_d©um
 = 
NULL
;

637 
pŞicydb_t
 *
db
 = 
NULL
;

639 ià(
pŞicy
 =ğ
NULL
 || 
commÚ
 =ğNULL || 
Çme
 == NULL) {

640 ià(
Çme
 !ğ
NULL
)

641 *
Çme
 = 
NULL
;

642 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

643 
”ºo
 = 
EINVAL
;

644  
STATUS_ERR
;

647 
db
 = &
pŞicy
->
p
->p;

648 
š‹º®_d©um
 = (
commÚ_d©um_t
 *è
commÚ
;

650 *
Çme
 = 
db
->
p_commÚ_v®_to_Çme
[
š‹º®_d©um
->
s
.
v®ue
 - 1];

652  
STATUS_SUCCESS
;

653 
	}
}

	@libqpol/src/cond_query.c

27 
	~<qpŞ/pŞicy.h
>

28 
	~<qpŞ/cÚd_qu”y.h
>

29 
	~<qpŞ/boŞ_qu”y.h
>

30 
	~<qpŞ/avruË_qu”y.h
>

31 
	~<qpŞ/‹ruË_qu”y.h
>

32 
	~<qpŞ/™”©Ü.h
>

33 
	~"™”©Ü_š‹º®.h
"

34 
	~"qpŞ_š‹º®.h
"

36 
	~<£pŞ/pŞicydb/cÚd™iÚ®.h
>

38 
	~<¡dlib.h
>

39 
	~<”ºo.h
>

41 
	scÚd_¡©e


43 
cÚd_node_t
 *
	mh—d
;

44 
cÚd_node_t
 *
	mcur
;

45 } 
	tcÚd_¡©e_t
;

47 
	$cÚd_¡©e_’d
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

49 
cÚd_¡©e_t
 *
cs
 = 
NULL
;

51 ià(!
™”
 || !(
cs
 = (
cÚd_¡©e_t
 *è
	`qpŞ_™”©Ü_¡©e
(iter))) {

52 
”ºo
 = 
EINVAL
;

53  
STATUS_ERR
;

56  
cs
->
cur
 ? 0 : 1;

57 
	}
}

59 *
	$cÚd_¡©e_g‘_cur
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

61 
cÚd_¡©e_t
 *
cs
 = 
NULL
;

63 ià(!
™”
 || !(
cs
 = (
cÚd_¡©e_t
 *è
	`qpŞ_™”©Ü_¡©e
(™”)è|| 
	`qpŞ_™”©Ü_’d
(iter)) {

64 
”ºo
 = 
EINVAL
;

65  
NULL
;

68  
cs
->
cur
;

69 
	}
}

71 
	$cÚd_¡©e_Ãxt
(
qpŞ_™”©Ü_t
 * 
™”
)

73 
cÚd_¡©e_t
 *
cs
 = 
NULL
;

75 ià(!
™”
 || !(
cs
 = (
cÚd_¡©e_t
 *è
	`qpŞ_™”©Ü_¡©e
(iter))) {

76 
”ºo
 = 
EINVAL
;

77  
STATUS_ERR
;

80 ià(
	`qpŞ_™”©Ü_’d
(
™”
)) {

81 
”ºo
 = 
ERANGE
;

82  
STATUS_ERR
;

85 
cs
->
cur
 = cs->cur->
Ãxt
;

87  
STATUS_SUCCESS
;

88 
	}
}

90 
size_t
 
	$cÚd_¡©e_size
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

92 
cÚd_¡©e_t
 *
cs
 = 
NULL
;

93 
cÚd_node_t
 *
tmp
 = 
NULL
;

94 
size_t
 
couÁ
 = 0;

96 ià(!
™”
 || !(
cs
 = (
cÚd_¡©e_t
 *è
	`qpŞ_™”©Ü_¡©e
(iter))) {

97 
”ºo
 = 
EINVAL
;

101 
tmp
 = 
cs
->
h—d
;mp;m°ğtmp->
Ãxt
)

102 
couÁ
++;

104  
couÁ
;

105 
	}
}

107 
	$qpŞ_pŞicy_g‘_cÚd_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, 
qpŞ_™”©Ü_t
 ** 
™”
)

109 
”rÜ
 = 0;

110 
cÚd_¡©e_t
 *
cs
 = 
NULL
;

111 
pŞicydb_t
 *
db
 = 
NULL
;

113 ià(
™”
)

114 *
™”
 = 
NULL
;

116 ià(!
pŞicy
 || !
™”
) {

117 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

118 
”ºo
 = 
EINVAL
;

119  
STATUS_ERR
;

122 ià(!
	`qpŞ_pŞicy_has_ÿ·b™y
(
pŞicy
, 
QPOL_CAP_RULES_LOADED
)) {

123 
	`ERR
(
pŞicy
, "%s", "Cannot get conditionals: Rules‚ot†oaded");

124 
”ºo
 = 
ENOTSUP
;

125  
STATUS_ERR
;

128 
db
 = &
pŞicy
->
p
->p;

130 ià(!(
cs
 = 
	`ÿÎoc
(1, (
cÚd_¡©e_t
)))) {

131 
”rÜ
 = 
”ºo
;

132 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

133 
”r
;

135 
cs
->
h—d
 = cs->
cur
 = 
db
->
cÚd_li¡
;

137 ià(
	`qpŞ_™”©Ü_ü—‹
(
pŞicy
, (*)
cs
,

138 
cÚd_¡©e_g‘_cur
, 
cÚd_¡©e_Ãxt
, 
cÚd_¡©e_’d
, 
cÚd_¡©e_size
, 
ä“
, 
™”
)) {

139 
”rÜ
 = 
”ºo
;

140 
”r
;

143  
STATUS_SUCCESS
;

145 
”r
:

146 
	`ä“
(
cs
);

147 
”ºo
 = 
”rÜ
;

148  
STATUS_ERR
;

149 
	}
}

151 
	scÚd_ex´_¡©e


153 
cÚd_ex´_t
 *
	mh—d
;

154 
cÚd_ex´_t
 *
	mcur
;

155 } 
	tcÚd_ex´_¡©e_t
;

157 
	$cÚd_ex´_¡©e_’d
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

159 
cÚd_ex´_¡©e_t
 *
ûs
 = 
NULL
;

161 ià(!
™”
 || !(
ûs
 = (
cÚd_ex´_¡©e_t
 *è
	`qpŞ_™”©Ü_¡©e
(iter))) {

162 
”ºo
 = 
EINVAL
;

163  
STATUS_ERR
;

166  
ûs
->
cur
 ? 0 : 1;

167 
	}
}

169 *
	$cÚd_ex´_¡©e_g‘_cur
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

171 
cÚd_ex´_¡©e_t
 *
ûs
 = 
NULL
;

173 ià(!
™”
 || !(
ûs
 = (
cÚd_ex´_¡©e_t
 *è
	`qpŞ_™”©Ü_¡©e
(™”)è|| 
	`qpŞ_™”©Ü_’d
(iter)) {

174 
”ºo
 = 
EINVAL
;

175  
NULL
;

178  
ûs
->
cur
;

179 
	}
}

181 
	$cÚd_ex´_¡©e_Ãxt
(
qpŞ_™”©Ü_t
 * 
™”
)

183 
cÚd_ex´_¡©e_t
 *
ûs
 = 
NULL
;

185 ià(!
™”
 || !(
ûs
 = (
cÚd_ex´_¡©e_t
 *è
	`qpŞ_™”©Ü_¡©e
(iter))) {

186 
”ºo
 = 
EINVAL
;

187  
STATUS_ERR
;

190 ià(
	`qpŞ_™”©Ü_’d
(
™”
)) {

191 
”ºo
 = 
ERANGE
;

192  
STATUS_ERR
;

195 
ûs
->
cur
 = ces->cur->
Ãxt
;

197  
STATUS_SUCCESS
;

198 
	}
}

200 
size_t
 
	$cÚd_ex´_¡©e_size
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

202 
cÚd_ex´_¡©e_t
 *
ûs
 = 
NULL
;

203 
cÚd_ex´_t
 *
tmp
 = 
NULL
;

204 
size_t
 
couÁ
 = 0;

206 ià(!
™”
 || !(
ûs
 = (
cÚd_ex´_¡©e_t
 *è
	`qpŞ_™”©Ü_¡©e
(iter))) {

207 
”ºo
 = 
EINVAL
;

211 
tmp
 = 
ûs
->
h—d
;mp;m°ğtmp->
Ãxt
)

212 
couÁ
++;

214  
couÁ
;

215 
	}
}

217 
	$qpŞ_cÚd_g‘_ex´_node_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_cÚd_t
 * 
cÚd
, 
qpŞ_™”©Ü_t
 ** 
™”
)

219 
”rÜ
 = 0;

220 
cÚd_ex´_¡©e_t
 *
ûs
 = 
NULL
;

221 
cÚd_node_t
 *
š‹º®_cÚd
 = 
NULL
;

222 
pŞicydb_t
 *
db
 = 
NULL
;

224 ià(
™”
)

225 *
™”
 = 
NULL
;

227 ià(!
pŞicy
 || !
cÚd
 || !
™”
) {

228 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

229 
”ºo
 = 
EINVAL
;

230  
STATUS_ERR
;

233 
db
 = &
pŞicy
->
p
->p;

234 
š‹º®_cÚd
 = (
cÚd_node_t
 *è
cÚd
;

236 ià(!(
ûs
 = 
	`ÿÎoc
(1, (
cÚd_ex´_¡©e_t
)))) {

237 
”rÜ
 = 
”ºo
;

238 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

239 
”r
;

241 
ûs
->
h—d
 = ces->
cur
 = 
š‹º®_cÚd
->
ex´
;

243 ià(
	`qpŞ_™”©Ü_ü—‹
(
pŞicy
, (*)
ûs
,

244 
cÚd_ex´_¡©e_g‘_cur
, 
cÚd_ex´_¡©e_Ãxt
, 
cÚd_ex´_¡©e_’d
,

245 
cÚd_ex´_¡©e_size
, 
ä“
, 
™”
)) {

246 
”rÜ
 = 
”ºo
;

247 
”r
;

250  
STATUS_SUCCESS
;

252 
”r
:

253 
	`ä“
(
ûs
);

254 
”ºo
 = 
”rÜ
;

255  
STATUS_ERR
;

256 
	}
}

258 
	scÚd_ruË_¡©e


260 
cÚd_av_li¡_t
 *
	mh—d
;

261 
cÚd_av_li¡_t
 *
	mcur
;

262 
ušt32_t
 
	mruË_ty³_mask
;

263 } 
	tcÚd_ruË_¡©e_t
;

265 
	$cÚd_ruË_¡©e_’d
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

267 
cÚd_ruË_¡©e_t
 *
üs
 = 
NULL
;

269 ià(!
™”
 || !(
üs
 = (
cÚd_ruË_¡©e_t
 *è
	`qpŞ_™”©Ü_¡©e
(iter))) {

270 
”ºo
 = 
EINVAL
;

271  
STATUS_ERR
;

274  
üs
->
cur
 ? 0 : 1;

275 
	}
}

277 *
	$cÚd_ruË_¡©e_g‘_cur
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

279 
cÚd_ruË_¡©e_t
 *
üs
 = 
NULL
;

281 ià(!
™”
 || !(
üs
 = (
cÚd_ruË_¡©e_t
 *è
	`qpŞ_™”©Ü_¡©e
(™”)è|| 
	`qpŞ_™”©Ü_’d
(iter)) {

282 
”ºo
 = 
EINVAL
;

283  
NULL
;

286  
üs
->
cur
->
node
;

287 
	}
}

289 
	$cÚd_ruË_¡©e_Ãxt
(
qpŞ_™”©Ü_t
 * 
™”
)

291 
cÚd_ruË_¡©e_t
 *
üs
 = 
NULL
;

293 ià(!
™”
 || !(
üs
 = (
cÚd_ruË_¡©e_t
 *è
	`qpŞ_™”©Ü_¡©e
(iter))) {

294 
”ºo
 = 
EINVAL
;

295  
STATUS_ERR
;

298 ià(
	`qpŞ_™”©Ü_’d
(
™”
)) {

299 
”ºo
 = 
ERANGE
;

300  
STATUS_ERR
;

304 
üs
->
cur
 = crs->cur->
Ãxt
;

305 } 
üs
->
cur
 && !(üs->cur->
node
->
key
.
¥ecif›d
 & crs->
ruË_ty³_mask
));

307  
STATUS_SUCCESS
;

308 
	}
}

310 
size_t
 
	$cÚd_ruË_¡©e_size
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

312 
cÚd_ruË_¡©e_t
 *
üs
 = 
NULL
;

313 
cÚd_av_li¡_t
 *
tmp
 = 
NULL
;

314 
size_t
 
couÁ
 = 0;

316 ià(!
™”
 || !(
üs
 = (
cÚd_ruË_¡©e_t
 *è
	`qpŞ_™”©Ü_¡©e
(iter))) {

317 
”ºo
 = 
EINVAL
;

321 
tmp
 = 
üs
->
h—d
;mp;m°ğtmp->
Ãxt
) {

322 ià(
tmp
->
node
->
key
.
¥ecif›d
 & 
üs
->
ruË_ty³_mask
)

323 
couÁ
++;

326  
couÁ
;

327 
	}
}

329 
	$qpŞ_cÚd_g‘_av_Œue_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_cÚd_t
 * 
cÚd
, 
ušt32_t
 
ruË_ty³_mask
,

330 
qpŞ_™”©Ü_t
 ** 
™”
)

332 
”rÜ
 = 0;

333 
cÚd_ruË_¡©e_t
 *
üs
 = 
NULL
;

334 
cÚd_node_t
 *
š‹º®_cÚd
 = 
NULL
;

335 
pŞicydb_t
 *
db
 = 
NULL
;

337 ià(
™”
)

338 *
™”
 = 
NULL
;

340 ià(!
pŞicy
 || !
cÚd
 || !
™”
) {

341 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

342 
”ºo
 = 
EINVAL
;

343  
STATUS_ERR
;

346 ià(
ruË_ty³_mask
 & ~(
QPOL_RULE_ALLOW
 | 
QPOL_RULE_NEVERALLOW
 | 
QPOL_RULE_AUDITALLOW
 | 
QPOL_RULE_DONTAUDIT
)) {

347 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

348 
”ºo
 = 
EINVAL
;

349  
STATUS_ERR
;

352 
db
 = &
pŞicy
->
p
->p;

353 
š‹º®_cÚd
 = (
cÚd_node_t
 *è
cÚd
;

355 ià(!(
üs
 = 
	`ÿÎoc
(1, (
cÚd_ruË_¡©e_t
)))) {

356 
”rÜ
 = 
”ºo
;

357 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

358 
”r
;

360 
üs
->
h—d
 = crs->
cur
 = 
š‹º®_cÚd
->
Œue_li¡
;

361 
üs
->
ruË_ty³_mask
 =„ule_type_mask;

363 ià(
	`qpŞ_™”©Ü_ü—‹
(
pŞicy
, (*)
üs
,

364 
cÚd_ruË_¡©e_g‘_cur
, 
cÚd_ruË_¡©e_Ãxt
, 
cÚd_ruË_¡©e_’d
,

365 
cÚd_ruË_¡©e_size
, 
ä“
, 
™”
)) {

366 
”rÜ
 = 
”ºo
;

367 
”r
;

370 ià(
üs
->
cur
 && !(üs->cur->
node
->
key
.
¥ecif›d
 & crs->
ruË_ty³_mask
))

371 
	`qpŞ_™”©Ü_Ãxt
(*
™”
);

373  
STATUS_SUCCESS
;

375 
”r
:

376 
	`ä“
(
üs
);

377 
”ºo
 = 
”rÜ
;

378  
STATUS_ERR
;

379 
	}
}

381 
	$qpŞ_cÚd_g‘_‹_Œue_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_cÚd_t
 * 
cÚd
, 
ušt32_t
 
ruË_ty³_mask
,

382 
qpŞ_™”©Ü_t
 ** 
™”
)

384 
”rÜ
 = 0;

385 
cÚd_ruË_¡©e_t
 *
üs
 = 
NULL
;

386 
cÚd_node_t
 *
š‹º®_cÚd
 = 
NULL
;

387 
pŞicydb_t
 *
db
 = 
NULL
;

389 ià(
™”
)

390 *
™”
 = 
NULL
;

392 ià(!
pŞicy
 || !
cÚd
 || !
™”
) {

393 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

394 
”ºo
 = 
EINVAL
;

395  
STATUS_ERR
;

398 ià(
ruË_ty³_mask
 & ~(
QPOL_RULE_TYPE_TRANS
 | 
QPOL_RULE_TYPE_CHANGE
 | 
QPOL_RULE_TYPE_MEMBER
)) {

399 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

400 
”ºo
 = 
EINVAL
;

401  
STATUS_ERR
;

404 
db
 = &
pŞicy
->
p
->p;

405 
š‹º®_cÚd
 = (
cÚd_node_t
 *è
cÚd
;

407 ià(!(
üs
 = 
	`ÿÎoc
(1, (
cÚd_ruË_¡©e_t
)))) {

408 
”rÜ
 = 
”ºo
;

409 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

410 
”r
;

412 
üs
->
h—d
 = crs->
cur
 = 
š‹º®_cÚd
->
Œue_li¡
;

413 
üs
->
ruË_ty³_mask
 =„ule_type_mask;

415 ià(
	`qpŞ_™”©Ü_ü—‹
(
pŞicy
, (*)
üs
,

416 
cÚd_ruË_¡©e_g‘_cur
, 
cÚd_ruË_¡©e_Ãxt
, 
cÚd_ruË_¡©e_’d
,

417 
cÚd_ruË_¡©e_size
, 
ä“
, 
™”
)) {

418 
”rÜ
 = 
”ºo
;

419 
”r
;

422 ià(
üs
->
cur
 && !(üs->cur->
node
->
key
.
¥ecif›d
 & crs->
ruË_ty³_mask
))

423 
	`qpŞ_™”©Ü_Ãxt
(*
™”
);

425  
STATUS_SUCCESS
;

427 
”r
:

428 
	`ä“
(
üs
);

429 
”ºo
 = 
”rÜ
;

430  
STATUS_ERR
;

431 
	}
}

433 
	$qpŞ_cÚd_g‘_av_çl£_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_cÚd_t
 * 
cÚd
, 
ušt32_t
 
ruË_ty³_mask
,

434 
qpŞ_™”©Ü_t
 ** 
™”
)

436 
”rÜ
 = 0;

437 
cÚd_ruË_¡©e_t
 *
üs
 = 
NULL
;

438 
cÚd_node_t
 *
š‹º®_cÚd
 = 
NULL
;

439 
pŞicydb_t
 *
db
 = 
NULL
;

441 ià(
™”
)

442 *
™”
 = 
NULL
;

444 ià(!
pŞicy
 || !
cÚd
 || !
™”
) {

445 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

446 
”ºo
 = 
EINVAL
;

447  
STATUS_ERR
;

450 ià(
ruË_ty³_mask
 & ~(
QPOL_RULE_ALLOW
 | 
QPOL_RULE_NEVERALLOW
 | 
QPOL_RULE_AUDITALLOW
 | 
QPOL_RULE_DONTAUDIT
)) {

451 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

452 
”ºo
 = 
EINVAL
;

453  
STATUS_ERR
;

456 
db
 = &
pŞicy
->
p
->p;

457 
š‹º®_cÚd
 = (
cÚd_node_t
 *è
cÚd
;

459 ià(!(
üs
 = 
	`ÿÎoc
(1, (
cÚd_ruË_¡©e_t
)))) {

460 
”rÜ
 = 
”ºo
;

461 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

462 
”r
;

464 
üs
->
h—d
 = crs->
cur
 = 
š‹º®_cÚd
->
çl£_li¡
;

465 
üs
->
ruË_ty³_mask
 =„ule_type_mask;

467 ià(
	`qpŞ_™”©Ü_ü—‹
(
pŞicy
, (*)
üs
,

468 
cÚd_ruË_¡©e_g‘_cur
, 
cÚd_ruË_¡©e_Ãxt
, 
cÚd_ruË_¡©e_’d
,

469 
cÚd_ruË_¡©e_size
, 
ä“
, 
™”
)) {

470 
”rÜ
 = 
”ºo
;

471 
”r
;

474 ià(
üs
->
cur
 && !(üs->cur->
node
->
key
.
¥ecif›d
 & crs->
ruË_ty³_mask
))

475 
	`qpŞ_™”©Ü_Ãxt
(*
™”
);

477  
STATUS_SUCCESS
;

479 
”r
:

480 
	`ä“
(
üs
);

481 
”ºo
 = 
”rÜ
;

482  
STATUS_ERR
;

483 
	}
}

485 
	$qpŞ_cÚd_g‘_‹_çl£_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_cÚd_t
 * 
cÚd
, 
ušt32_t
 
ruË_ty³_mask
,

486 
qpŞ_™”©Ü_t
 ** 
™”
)

488 
”rÜ
 = 0;

489 
cÚd_ruË_¡©e_t
 *
üs
 = 
NULL
;

490 
cÚd_node_t
 *
š‹º®_cÚd
 = 
NULL
;

491 
pŞicydb_t
 *
db
 = 
NULL
;

493 ià(
™”
)

494 *
™”
 = 
NULL
;

496 ià(!
pŞicy
 || !
cÚd
 || !
™”
) {

497 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

498 
”ºo
 = 
EINVAL
;

499  
STATUS_ERR
;

502 ià(
ruË_ty³_mask
 & ~(
QPOL_RULE_TYPE_TRANS
 | 
QPOL_RULE_TYPE_CHANGE
 | 
QPOL_RULE_TYPE_MEMBER
)) {

503 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

504 
”ºo
 = 
EINVAL
;

505  
STATUS_ERR
;

508 
db
 = &
pŞicy
->
p
->p;

509 
š‹º®_cÚd
 = (
cÚd_node_t
 *è
cÚd
;

511 ià(!(
üs
 = 
	`ÿÎoc
(1, (
cÚd_ruË_¡©e_t
)))) {

512 
”rÜ
 = 
”ºo
;

513 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

514 
”r
;

516 
üs
->
h—d
 = crs->
cur
 = 
š‹º®_cÚd
->
çl£_li¡
;

517 
üs
->
ruË_ty³_mask
 =„ule_type_mask;

519 ià(
	`qpŞ_™”©Ü_ü—‹
(
pŞicy
, (*)
üs
,

520 
cÚd_ruË_¡©e_g‘_cur
, 
cÚd_ruË_¡©e_Ãxt
, 
cÚd_ruË_¡©e_’d
,

521 
cÚd_ruË_¡©e_size
, 
ä“
, 
™”
)) {

522 
”rÜ
 = 
”ºo
;

523 
”r
;

526 ià(
üs
->
cur
 && !(üs->cur->
node
->
key
.
¥ecif›d
 & crs->
ruË_ty³_mask
))

527 
	`qpŞ_™”©Ü_Ãxt
(*
™”
);

529  
STATUS_SUCCESS
;

531 
”r
:

532 
	`ä“
(
üs
);

533 
”ºo
 = 
”rÜ
;

534  
STATUS_ERR
;

535 
	}
}

537 
	$qpŞ_cÚd_ev®
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_cÚd_t
 * 
cÚd
, 
ušt32_t
 * 
is_Œue
)

539 
”rÜ
 = 0;

540 
cÚd_node_t
 *
š‹º®_cÚd
 = 
NULL
;

542 ià(
is_Œue
)

543 *
is_Œue
 = 0;

545 ià(!
pŞicy
 || !
cÚd
 || !
is_Œue
) {

546 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

547 
”ºo
 = 
EINVAL
;

548  
STATUS_ERR
;

551 
š‹º®_cÚd
 = (
cÚd_node_t
 *è
cÚd
;

553 ià((*
is_Œue
 = (
ušt32_t
è
	`cÚd_ev®u©e_ex´
(&
pŞicy
->
p
->p, 
š‹º®_cÚd
->
ex´
)) > 1) {

554 
”rÜ
 = 
ERANGE
;

555 
”r
;

558  
STATUS_SUCCESS
;

560 
”r
:

561 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

562 
”ºo
 = 
”rÜ
;

563  
STATUS_ERR
;

564 
	}
}

566 
	$qpŞ_cÚd_ex´_node_g‘_ex´_ty³
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_cÚd_ex´_node_t
 * 
node
, 
ušt32_t
 * 
ex´_ty³
)

568 
cÚd_ex´_t
 *
š‹º®_cÚd
 = 
NULL
;

570 ià(
ex´_ty³
)

571 *
ex´_ty³
 = 0;

573 ià(!
pŞicy
 || !
node
 || !
ex´_ty³
) {

574 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

575 
”ºo
 = 
EINVAL
;

576  
STATUS_ERR
;

579 
š‹º®_cÚd
 = (
cÚd_ex´_t
 *è
node
;

581 *
ex´_ty³
 = 
š‹º®_cÚd
->expr_type;

583  
STATUS_SUCCESS
;

584 
	}
}

586 
	$qpŞ_cÚd_ex´_node_g‘_boŞ
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_cÚd_ex´_node_t
 * 
node
, 
qpŞ_boŞ_t
 ** 
cÚd_boŞ
)

588 
”rÜ
 = 0;

589 
cÚd_ex´_t
 *
š‹º®_cÚd
 = 
NULL
;

590 
pŞicydb_t
 *
db
 = 
NULL
;

592 ià(
cÚd_boŞ
)

593 *
cÚd_boŞ
 = 
NULL
;

595 ià(!
pŞicy
 || !
node
 || !
cÚd_boŞ
) {

596 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

597 
”ºo
 = 
EINVAL
;

598  
STATUS_ERR
;

601 
db
 = &
pŞicy
->
p
->p;

602 
š‹º®_cÚd
 = (
cÚd_ex´_t
 *è
node
;

604 ià(
š‹º®_cÚd
->
ex´_ty³
 !ğ
QPOL_COND_EXPR_BOOL
) {

605 
”rÜ
 = 
EINVAL
;

606 
”r
;

609 ià(!(*
cÚd_boŞ
 = (
qpŞ_boŞ_t
 *è
db
->
boŞ_v®_to_¡ruù
[
š‹º®_cÚd
->
boŞ
 - 1])) {

610 
”rÜ
 = 
EINVAL
;

611 
”r
;

614  
STATUS_SUCCESS
;

616 
”r
:

617 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

618 
”ºo
 = 
”rÜ
;

619  
STATUS_ERR
;

620 
	}
}

	@libqpol/src/constraint_query.c

27 
	~<cÚfig.h
>

29 
	~<qpŞ/pŞicy.h
>

30 
	~<qpŞ/cÚ¡¿št_qu”y.h
>

31 
	~<qpŞ/™”©Ü.h
>

32 
	~<qpŞ/şass_³rm_qu”y.h
>

33 
	~"qpŞ_š‹º®.h
"

34 
	~"™”©Ü_š‹º®.h
"

36 
	~<£pŞ/pŞicydb/pŞicydb.h
>

37 
	~<£pŞ/pŞicydb/cÚ¡¿št.h
>

39 
	~<¡dlib.h
>

40 
	~<¡ršg.h
>

41 
	~<”ºo.h
>

43 
	sqpŞ_cÚ¡¿št


45 cÚ¡ 
qpŞ_şass_t
 *
	mobj_şass
;

46 
cÚ¡¿št_node_t
 *
	mcÚ¡r
;

49 
	spŞicy_cÚ¡r_¡©e


51 
qpŞ_™”©Ü_t
 *
	mşass_™”
;

52 
qpŞ_™”©Ü_t
 *
	mcÚ¡r_™”
;

53 cÚ¡ 
qpŞ_pŞicy_t
 *
	mpŞicy
;

54 } 
	tpŞicy_cÚ¡r_¡©e_t
;

56 
	$pŞicy_cÚ¡r_¡©e_’d
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

58 
pŞicy_cÚ¡r_¡©e_t
 *
pcs
 = 
NULL
;

60 ià(!
™”
 || !(
pcs
 = (
pŞicy_cÚ¡r_¡©e_t
 *è
	`qpŞ_™”©Ü_¡©e
(iter))) {

61 
”ºo
 = 
EINVAL
;

62  
STATUS_ERR
;

65  (
	`qpŞ_™”©Ü_’d
(
pcs
->
şass_™”
è&& qpŞ_™”©Ü_’dÕcs->
cÚ¡r_™”
)) ? 1 : 0;

66 
	}
}

68 *
	$pŞicy_cÚ¡r_¡©e_g‘_cur
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

70 
pŞicy_cÚ¡r_¡©e_t
 *
pcs
 = 
NULL
;

71 *
tmp
 = 
NULL
;

73 ià(!
™”
 || !(
pcs
 = (
pŞicy_cÚ¡r_¡©e_t
 *è
	`qpŞ_™”©Ü_¡©e
(™”)è|| 
	`qpŞ_™”©Ü_’d
(iter)) {

74 
”ºo
 = 
EINVAL
;

75  
NULL
;

78 ià(
	`qpŞ_™”©Ü_g‘_™em
(
pcs
->
cÚ¡r_™”
, &
tmp
)) {

79  
NULL
;

82  
tmp
;

83 
	}
}

85 
	$pŞicy_cÚ¡r_¡©e_Ãxt
(
qpŞ_™”©Ü_t
 * 
™”
)

87 
pŞicy_cÚ¡r_¡©e_t
 *
pcs
 = 
NULL
;

88 
qpŞ_şass_t
 *
obj_şass
 = 
NULL
;

90 ià(!
™”
 || !(
pcs
 = (
pŞicy_cÚ¡r_¡©e_t
 *è
	`qpŞ_™”©Ü_¡©e
(iter))) {

91 
”ºo
 = 
EINVAL
;

92  
STATUS_ERR
;

95 ià(
	`qpŞ_™”©Ü_’d
(
™”
)) {

96 
”ºo
 = 
ERANGE
;

97  
STATUS_ERR
;

100 
	`qpŞ_™”©Ü_Ãxt
(
pcs
->
cÚ¡r_™”
);

101 
	`qpŞ_™”©Ü_’d
(
pcs
->
cÚ¡r_™”
)) {

102 
	`qpŞ_™”©Ü_de¡roy
(&
pcs
->
cÚ¡r_™”
);

103 
	`qpŞ_™”©Ü_Ãxt
(
pcs
->
şass_™”
);

104 ià(
	`qpŞ_™”©Ü_’d
(
pcs
->
şass_™”
))

105  
STATUS_SUCCESS
;

106 ià(
	`qpŞ_™”©Ü_g‘_™em
(
pcs
->
şass_™”
, (**)&
obj_şass
))

107  
STATUS_ERR
;

108 ià(
	`qpŞ_şass_g‘_cÚ¡¿št_™”
(
pcs
->
pŞicy
, 
obj_şass
, &pcs->
cÚ¡r_™”
))

109  
STATUS_ERR
;

112  
STATUS_SUCCESS
;

113 
	}
}

115 
size_t
 
	$pŞicy_cÚ¡r_¡©e_size
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

117 
pŞicy_cÚ¡r_¡©e_t
 *
pcs
 = 
NULL
;

118 
qpŞ_şass_t
 *
obj_şass
 = 
NULL
;

119 
qpŞ_™”©Ü_t
 *
š‹º®_™”
 = 
NULL
, *
cÚ¡r_™”
 = NULL;

120 
size_t
 
couÁ
 = 0, 
tmp
 = 0;

122 ià(!
™”
 || !(
pcs
 = (
pŞicy_cÚ¡r_¡©e_t
 *è
	`qpŞ_™”©Ü_¡©e
(iter))) {

123 
”ºo
 = 
EINVAL
;

127 ià(
	`qpŞ_pŞicy_g‘_şass_™”
(
pcs
->
pŞicy
, &
š‹º®_™”
))

130 ; !
	`qpŞ_™”©Ü_’d
(
š‹º®_™”
); 
	`qpŞ_™”©Ü_Ãxt
(internal_iter)) {

131 ià(
	`qpŞ_™”©Ü_g‘_™em
(
š‹º®_™”
, (**)&
obj_şass
))

132 
”r
;

133 ià(
	`qpŞ_şass_g‘_cÚ¡¿št_™”
(
pcs
->
pŞicy
, 
obj_şass
, &
cÚ¡r_™”
))

134 
”r
;

135 ià(
	`qpŞ_™”©Ü_g‘_size
(
cÚ¡r_™”
, &
tmp
))

136 
”r
;

137 
couÁ
 +ğ
tmp
;

138 
tmp
 = 0;

139 
	`qpŞ_™”©Ü_de¡roy
(&
cÚ¡r_™”
);

142 
	`qpŞ_™”©Ü_de¡roy
(&
š‹º®_™”
);

143  
couÁ
;

145 
”r
:

146 
	`qpŞ_™”©Ü_de¡roy
(&
š‹º®_™”
);

147 
	`qpŞ_™”©Ü_de¡roy
(&
cÚ¡r_™”
);

149 
	}
}

151 
	$pŞicy_cÚ¡r_¡©e_ä“
(*
x
)

153 
pŞicy_cÚ¡r_¡©e_t
 *
pcs
 = (pŞicy_cÚ¡r_¡©e_ˆ*è
x
;

155 ià(!
pcs
)

158 
	`qpŞ_™”©Ü_de¡roy
(&
pcs
->
şass_™”
);

159 
	`qpŞ_™”©Ü_de¡roy
(&
pcs
->
cÚ¡r_™”
);

160 
	`ä“
(
pcs
);

161 
	}
}

163 
	$qpŞ_pŞicy_g‘_cÚ¡¿št_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, 
qpŞ_™”©Ü_t
 ** 
™”
)

165 
pŞicy_cÚ¡r_¡©e_t
 *
pcs
 = 
NULL
;

166 
”rÜ
 = 0;

167 
qpŞ_şass_t
 *
tmp
 = 
NULL
;

169 ià(
™”
)

170 *
™”
 = 
NULL
;

172 ià(!
pŞicy
 || !
™”
) {

173 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

174 
”ºo
 = 
EINVAL
;

175  
STATUS_ERR
;

178 ià(!(
pcs
 = 
	`ÿÎoc
(1, (
pŞicy_cÚ¡r_¡©e_t
)))) {

179 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

180 
”ºo
 = 
ENOMEM
;

181  
STATUS_ERR
;

183 
pcs
->
pŞicy
 =…olicy;

184 ià(
	`qpŞ_pŞicy_g‘_şass_™”
(
pŞicy
, &
pcs
->
şass_™”
)) {

185 
”rÜ
 = 
”ºo
;

186 
”r
;

188 ià(
	`qpŞ_™”©Ü_g‘_™em
(
pcs
->
şass_™”
, (**)&
tmp
)) {

189 
”rÜ
 = 
”ºo
;

190 
	`ERR
(
pŞicy
, "E¼Ü g‘tšg fœ¡ cÏss: %s", 
	`¡»¼Ü
(
”rÜ
));

191 
”r
;

193 ià(
	`qpŞ_şass_g‘_cÚ¡¿št_™”
(
pŞicy
, 
tmp
, &
pcs
->
cÚ¡r_™”
)) {

194 
”rÜ
 = 
”ºo
;

195 
”r
;

198 ià(
	`qpŞ_™”©Ü_ü—‹
(
pŞicy
, (*)
pcs
,

199 
pŞicy_cÚ¡r_¡©e_g‘_cur
, 
pŞicy_cÚ¡r_¡©e_Ãxt
,

200 
pŞicy_cÚ¡r_¡©e_’d
, 
pŞicy_cÚ¡r_¡©e_size
, 
pŞicy_cÚ¡r_¡©e_ä“
, 
™”
)) {

201 
”rÜ
 = 
”ºo
;

202 
”r
;

205 ià(
	`qpŞ_™”©Ü_’d
(
pcs
->
cÚ¡r_™”
)) {

206 ià(
	`qpŞ_™”©Ü_Ãxt
(*
™”
)) {

207 
”rÜ
 = 
”ºo
;

208 
pcs
 = 
NULL
;

209 
	`ERR
(
pŞicy
, "E¼Ü fšdšg fœ¡ cÚ¡¿št: %s", 
	`¡»¼Ü
(
”rÜ
));

210 
”r
;

214  
STATUS_SUCCESS
;

216 
”r
:

217 
	`pŞicy_cÚ¡r_¡©e_ä“
(
pcs
);

218 
	`qpŞ_™”©Ü_de¡roy
(
™”
);

219 
”ºo
 = 
”rÜ
;

220  
STATUS_ERR
;

221 
	}
}

223 
	$qpŞ_cÚ¡¿št_g‘_şass
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_cÚ¡¿št_t
 * 
cÚ¡r
, cÚ¡ 
qpŞ_şass_t
 ** 
obj_şass
)

225 ià(
obj_şass
)

226 *
obj_şass
 = 
NULL
;

228 ià(!
pŞicy
 || !
cÚ¡r
 || !
obj_şass
) {

229 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

230 
”ºo
 = 
EINVAL
;

231  
STATUS_ERR
;

234 *
obj_şass
 = 
cÚ¡r
->obj_class;

236  
STATUS_SUCCESS
;

237 
	}
}

239 
	$qpŞ_cÚ¡¿št_g‘_³rm_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_cÚ¡¿št_t
 * 
cÚ¡r
, 
qpŞ_™”©Ü_t
 ** 
™”
)

241 
³rm_¡©e_t
 *
ps
 = 
NULL
;

242 
cÚ¡¿št_node_t
 *
š‹º®_cÚ¡r
 = 
NULL
;

244 ià(
™”
)

245 *
™”
 = 
NULL
;

247 ià(!
pŞicy
 || !
cÚ¡r
 || !
™”
) {

248 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

249 
”ºo
 = 
EINVAL
;

250  
STATUS_ERR
;

253 
š‹º®_cÚ¡r
 = (
cÚ¡¿št_node_t
 *è
cÚ¡r
->constr;

255 ià(!(
ps
 = 
	`ÿÎoc
(1, (
³rm_¡©e_t
)))) {

256 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

257 
”ºo
 = 
ENOMEM
;

259 
ps
->
³rm_£t
 = 
š‹º®_cÚ¡r
->
³rmissiÚs
;

260 
	`qpŞ_şass_g‘_v®ue
(
pŞicy
, 
cÚ¡r
->
obj_şass
, &
ps
->
obj_şass_v®
);

262 ià(
	`qpŞ_™”©Ü_ü—‹
(
pŞicy
, (*)
ps
, 
³rm_¡©e_g‘_cur
,

263 
³rm_¡©e_Ãxt
, 
³rm_¡©e_’d
, 
³rm_¡©e_size
, 
ä“
, 
™”
)) {

264 
	`ä“
(
ps
);

265  
STATUS_ERR
;

268 ià(!(
ps
->
³rm_£t
 & 1))

269 
	`qpŞ_™”©Ü_Ãxt
(*
™”
);

271  
STATUS_SUCCESS
;

272 
	}
}

274 
	scÚ¡r_ex´_¡©e


276 
cÚ¡¿št_ex´_t
 *
	mh—d
;

277 
cÚ¡¿št_ex´_t
 *
	mcur
;

278 } 
	tcÚ¡r_ex´_¡©e_t
;

280 
	$cÚ¡r_ex´_¡©e_’d
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

282 
cÚ¡r_ex´_¡©e_t
 *
ûs
 = 
NULL
;

284 ià(!
™”
 || !(
ûs
 = (
cÚ¡r_ex´_¡©e_t
 *è
	`qpŞ_™”©Ü_¡©e
(iter))) {

285 
”ºo
 = 
EINVAL
;

286  
STATUS_ERR
;

289  
ûs
->
cur
 ? 0 : 1;

290 
	}
}

292 *
	$cÚ¡r_ex´_¡©e_g‘_cur
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

294 
cÚ¡r_ex´_¡©e_t
 *
ûs
 = 
NULL
;

296 ià(!
™”
 || !(
ûs
 = (
cÚ¡r_ex´_¡©e_t
 *è
	`qpŞ_™”©Ü_¡©e
(™”)è|| 
	`qpŞ_™”©Ü_’d
(iter)) {

297 
”ºo
 = 
EINVAL
;

298  
NULL
;

301  
ûs
->
cur
;

302 
	}
}

304 
	$cÚ¡r_ex´_¡©e_Ãxt
(
qpŞ_™”©Ü_t
 * 
™”
)

306 
cÚ¡r_ex´_¡©e_t
 *
ûs
 = 
NULL
;

308 ià(!
™”
 || !(
ûs
 = (
cÚ¡r_ex´_¡©e_t
 *è
	`qpŞ_™”©Ü_¡©e
(iter))) {

309 
”ºo
 = 
EINVAL
;

310  
STATUS_ERR
;

313 ià(
	`qpŞ_™”©Ü_’d
(
™”
)) {

314 
”ºo
 = 
ERANGE
;

315  
STATUS_ERR
;

318 
ûs
->
cur
 = ces->cur->
Ãxt
;

320  
STATUS_SUCCESS
;

321 
	}
}

323 
size_t
 
	$cÚ¡r_ex´_¡©e_size
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

325 
cÚ¡r_ex´_¡©e_t
 *
ûs
 = 
NULL
;

326 
cÚ¡¿št_ex´_t
 *
tmp
 = 
NULL
;

327 
size_t
 
couÁ
 = 0;

329 ià(!
™”
 || !(
ûs
 = (
cÚ¡r_ex´_¡©e_t
 *è
	`qpŞ_™”©Ü_¡©e
(iter))) {

330 
”ºo
 = 
EINVAL
;

334 
tmp
 = 
ûs
->
h—d
;mp;m°ğtmp->
Ãxt
)

335 
couÁ
++;

337  
couÁ
;

338 
	}
}

340 
	$qpŞ_cÚ¡¿št_g‘_ex´_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_cÚ¡¿št_t
 * 
cÚ¡r
, 
qpŞ_™”©Ü_t
 ** 
™”
)

342 
cÚ¡r_ex´_¡©e_t
 *
ûs
 = 
NULL
;

343 
cÚ¡¿št_node_t
 *
š‹º®_cÚ¡r
 = 
NULL
;

345 ià(
™”
)

346 *
™”
 = 
NULL
;

348 ià(!
pŞicy
 || !
cÚ¡r
 || !
™”
) {

349 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

350 
”ºo
 = 
EINVAL
;

351  
STATUS_ERR
;

354 
š‹º®_cÚ¡r
 = (
cÚ¡¿št_node_t
 *è
cÚ¡r
->constr;

356 ià(!(
ûs
 = 
	`ÿÎoc
(1, (
cÚ¡r_ex´_¡©e_t
)))) {

357 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

358 
”ºo
 = 
ENOMEM
;

359  
STATUS_ERR
;

361 
ûs
->
h—d
 = ces->
cur
 = 
š‹º®_cÚ¡r
->
ex´
;

363 ià(
	`qpŞ_™”©Ü_ü—‹
(
pŞicy
, (*)
ûs
,

364 
cÚ¡r_ex´_¡©e_g‘_cur
, 
cÚ¡r_ex´_¡©e_Ãxt
,

365 
cÚ¡r_ex´_¡©e_’d
, 
cÚ¡r_ex´_¡©e_size
, 
ä“
, 
™”
)) {

366 
	`ä“
(
ûs
);

367  
STATUS_ERR
;

370  
STATUS_SUCCESS
;

371 
	}
}

373 
	$pŞicy_cÚ¡r_¡©e_Ãxt_vŒªs
(
qpŞ_™”©Ü_t
 * 
™”
)

375 
pŞicy_cÚ¡r_¡©e_t
 *
pcs
 = 
NULL
;

376 
qpŞ_şass_t
 *
obj_şass
 = 
NULL
;

378 ià(!
™”
 || !(
pcs
 = (
pŞicy_cÚ¡r_¡©e_t
 *è
	`qpŞ_™”©Ü_¡©e
(iter))) {

379 
”ºo
 = 
EINVAL
;

380  
STATUS_ERR
;

383 ià(
	`qpŞ_™”©Ü_’d
(
™”
)) {

384 
”ºo
 = 
ERANGE
;

385  
STATUS_ERR
;

388 
	`qpŞ_™”©Ü_Ãxt
(
pcs
->
cÚ¡r_™”
);

389 
	`qpŞ_™”©Ü_’d
(
pcs
->
cÚ¡r_™”
)) {

390 
	`qpŞ_™”©Ü_de¡roy
(&
pcs
->
cÚ¡r_™”
);

391 
	`qpŞ_™”©Ü_Ãxt
(
pcs
->
şass_™”
);

392 ià(
	`qpŞ_™”©Ü_’d
(
pcs
->
şass_™”
))

393  
STATUS_SUCCESS
;

394 ià(
	`qpŞ_™”©Ü_g‘_™em
(
pcs
->
şass_™”
, (**)&
obj_şass
))

395  
STATUS_ERR
;

396 ià(
	`qpŞ_şass_g‘_v®id©‘¿ns_™”
(
pcs
->
pŞicy
, 
obj_şass
, &pcs->
cÚ¡r_™”
))

397  
STATUS_ERR
;

400  
STATUS_SUCCESS
;

401 
	}
}

403 
size_t
 
	$pŞicy_cÚ¡r_¡©e_size_vŒªs
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

405 
pŞicy_cÚ¡r_¡©e_t
 *
pcs
 = 
NULL
;

406 
qpŞ_şass_t
 *
obj_şass
 = 
NULL
;

407 
qpŞ_™”©Ü_t
 *
š‹º®_™”
 = 
NULL
, *
cÚ¡r_™”
 = NULL;

408 
size_t
 
couÁ
 = 0, 
tmp
 = 0;

410 ià(!
™”
 || !(
pcs
 = (
pŞicy_cÚ¡r_¡©e_t
 *è
	`qpŞ_™”©Ü_¡©e
(iter))) {

411 
”ºo
 = 
EINVAL
;

415 ià(
	`qpŞ_pŞicy_g‘_şass_™”
(
pcs
->
pŞicy
, &
š‹º®_™”
))

418 ; !
	`qpŞ_™”©Ü_’d
(
š‹º®_™”
); 
	`qpŞ_™”©Ü_Ãxt
(internal_iter)) {

419 ià(
	`qpŞ_™”©Ü_g‘_™em
(
š‹º®_™”
, (**)&
obj_şass
))

420 
”r
;

421 ià(
	`qpŞ_şass_g‘_v®id©‘¿ns_™”
(
pcs
->
pŞicy
, 
obj_şass
, &
cÚ¡r_™”
))

422 
”r
;

423 ià(
	`qpŞ_™”©Ü_g‘_size
(
cÚ¡r_™”
, &
tmp
))

424 
”r
;

425 
couÁ
 +ğ
tmp
;

426 
tmp
 = 0;

427 
	`qpŞ_™”©Ü_de¡roy
(&
cÚ¡r_™”
);

430 
	`qpŞ_™”©Ü_de¡roy
(&
š‹º®_™”
);

431  
couÁ
;

433 
”r
:

434 
	`qpŞ_™”©Ü_de¡roy
(&
š‹º®_™”
);

435 
	`qpŞ_™”©Ü_de¡roy
(&
cÚ¡r_™”
);

437 
	}
}

439 
	$qpŞ_pŞicy_g‘_v®id©‘¿ns_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, 
qpŞ_™”©Ü_t
 ** 
™”
)

441 
pŞicy_cÚ¡r_¡©e_t
 *
pcs
 = 
NULL
;

442 
”rÜ
 = 0;

443 
qpŞ_şass_t
 *
tmp
 = 
NULL
;

445 ià(
™”
)

446 *
™”
 = 
NULL
;

448 ià(!
pŞicy
 || !
™”
) {

449 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

450 
”ºo
 = 
EINVAL
;

451  
STATUS_ERR
;

454 ià(!(
pcs
 = 
	`ÿÎoc
(1, (
pŞicy_cÚ¡r_¡©e_t
)))) {

455 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

456 
”ºo
 = 
ENOMEM
;

457  
STATUS_ERR
;

459 
pcs
->
pŞicy
 =…olicy;

460 ià(
	`qpŞ_pŞicy_g‘_şass_™”
(
pŞicy
, &
pcs
->
şass_™”
)) {

461 
”rÜ
 = 
”ºo
;

462 
”r
;

464 ià(
	`qpŞ_™”©Ü_g‘_™em
(
pcs
->
şass_™”
, (**)&
tmp
)) {

465 
”rÜ
 = 
”ºo
;

466 
	`ERR
(
pŞicy
, "E¼Ü g‘tšg fœ¡ cÏss: %s", 
	`¡»¼Ü
(
”rÜ
));

467 
”r
;

469 ià(
	`qpŞ_şass_g‘_v®id©‘¿ns_™”
(
pŞicy
, 
tmp
, &
pcs
->
cÚ¡r_™”
)) {

470 
”rÜ
 = 
”ºo
;

471 
”r
;

474 ià(
	`qpŞ_™”©Ü_ü—‹
(
pŞicy
, (*)
pcs
,

475 
pŞicy_cÚ¡r_¡©e_g‘_cur
, 
pŞicy_cÚ¡r_¡©e_Ãxt_vŒªs
,

476 
pŞicy_cÚ¡r_¡©e_’d
, 
pŞicy_cÚ¡r_¡©e_size_vŒªs
, 
pŞicy_cÚ¡r_¡©e_ä“
, 
™”
)) {

477 
”rÜ
 = 
”ºo
;

478 
”r
;

481 ià(
	`qpŞ_™”©Ü_’d
(
pcs
->
cÚ¡r_™”
)) {

482 ià(
	`qpŞ_™”©Ü_Ãxt
(*
™”
)) {

483 
”rÜ
 = 
”ºo
;

484 
pcs
 = 
NULL
;

485 
	`ERR
(
pŞicy
, "E¼Ü fšdšg fœ¡ v®id©‘¿ns: %s", 
	`¡»¼Ü
(
”rÜ
));

486 
”r
;

490  
STATUS_SUCCESS
;

492 
”r
:

493 
	`pŞicy_cÚ¡r_¡©e_ä“
(
pcs
);

494 
	`qpŞ_™”©Ü_de¡roy
(
™”
);

495 
”ºo
 = 
”rÜ
;

496  
STATUS_ERR
;

498 
	}
}

500 
	$qpŞ_v®id©‘¿ns_g‘_şass
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_v®id©‘¿ns_t
 * 
vŒªs
, cÚ¡ 
qpŞ_şass_t
 ** 
obj_şass
)

502 ià(
obj_şass
)

503 *
obj_şass
 = 
NULL
;

505 ià(!
pŞicy
 || !
vŒªs
 || !
obj_şass
) {

506 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

507 
”ºo
 = 
EINVAL
;

508  
STATUS_ERR
;

511 *
obj_şass
 = ((
qpŞ_cÚ¡¿št_t
 *è
vŒªs
)->obj_class;

513  
STATUS_SUCCESS
;

514 
	}
}

516 
	$qpŞ_v®id©‘¿ns_g‘_ex´_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_v®id©‘¿ns_t
 * 
vŒªs
, 
qpŞ_™”©Ü_t
 ** 
™”
)

518 
cÚ¡r_ex´_¡©e_t
 *
ûs
 = 
NULL
;

519 
cÚ¡¿št_node_t
 *
š‹º®_cÚ¡r
 = 
NULL
;

521 ià(
™”
)

522 *
™”
 = 
NULL
;

524 ià(!
pŞicy
 || !
vŒªs
 || !
™”
) {

525 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

526 
”ºo
 = 
EINVAL
;

527  
STATUS_ERR
;

530 
š‹º®_cÚ¡r
 = (
cÚ¡¿št_node_t
 *è((
qpŞ_cÚ¡¿št_t
 *è
vŒªs
)->
cÚ¡r
;

532 ià(!(
ûs
 = 
	`ÿÎoc
(1, (
cÚ¡r_ex´_¡©e_t
)))) {

533 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

534 
”ºo
 = 
ENOMEM
;

535  
STATUS_ERR
;

537 
ûs
->
h—d
 = ces->
cur
 = 
š‹º®_cÚ¡r
->
ex´
;

539 ià(
	`qpŞ_™”©Ü_ü—‹
(
pŞicy
, (*)
ûs
,

540 
cÚ¡r_ex´_¡©e_g‘_cur
, 
cÚ¡r_ex´_¡©e_Ãxt
,

541 
cÚ¡r_ex´_¡©e_’d
, 
cÚ¡r_ex´_¡©e_size
, 
ä“
, 
™”
)) {

542 
	`ä“
(
ûs
);

543  
STATUS_ERR
;

546  
STATUS_SUCCESS
;

547 
	}
}

549 
	$qpŞ_cÚ¡¿št_ex´_node_g‘_ex´_ty³
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_cÚ¡¿št_ex´_node_t
 * 
ex´
,

550 
ušt32_t
 * 
ex´_ty³
)

552 
cÚ¡¿št_ex´_t
 *
š‹º®_ex´
 = 
NULL
;

554 ià(!
pŞicy
 || !
ex´
 || !
ex´_ty³
) {

555 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

556 
”ºo
 = 
EINVAL
;

557  
STATUS_ERR
;

560 
š‹º®_ex´
 = (
cÚ¡¿št_ex´_t
 *è
ex´
;

562 *
ex´_ty³
 = 
š‹º®_ex´
->expr_type;

564  
STATUS_SUCCESS
;

565 
	}
}

567 
	$qpŞ_cÚ¡¿št_ex´_node_g‘_sym_ty³
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_cÚ¡¿št_ex´_node_t
 * 
ex´
,

568 
ušt32_t
 * 
sym_ty³
)

570 
cÚ¡¿št_ex´_t
 *
š‹º®_ex´
 = 
NULL
;

572 ià(!
pŞicy
 || !
ex´
 || !
sym_ty³
) {

573 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

574 
”ºo
 = 
EINVAL
;

575  
STATUS_ERR
;

578 
š‹º®_ex´
 = (
cÚ¡¿št_ex´_t
 *è
ex´
;

580 *
sym_ty³
 = 
š‹º®_ex´
->
©Œ
;

582  
STATUS_SUCCESS
;

583 
	}
}

585 
	$qpŞ_cÚ¡¿št_ex´_node_g‘_İ
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_cÚ¡¿št_ex´_node_t
 * 
ex´
, 
ušt32_t
 * 
İ
)

587 
cÚ¡¿št_ex´_t
 *
š‹º®_ex´
 = 
NULL
;

589 ià(!
pŞicy
 || !
ex´
 || !
İ
) {

590 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

591 
”ºo
 = 
EINVAL
;

592  
STATUS_ERR
;

595 
š‹º®_ex´
 = (
cÚ¡¿št_ex´_t
 *è
ex´
;

597 *
İ
 = 
š‹º®_ex´
->op;

599  
STATUS_SUCCESS
;

600 
	}
}

602 
	sûx´_Çme_¡©e


604 
eb™m­_t
 *
	mšc
;

605 
eb™m­_t
 *
	msub
;

606 
size_t
 
	mcur
;

607 
	#QPOL_CEXPR_NAME_STATE_INC_LIST
 0

	)

608 
	#QPOL_CEXPR_NAME_STATE_SUB_LIST
 1

	)

609 
	mli¡
;

610 } 
	tûx´_Çme_¡©e_t
;

612 
	$ûx´_Çme_¡©e_’d
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

614 
ûx´_Çme_¡©e_t
 *
ús
 = 
NULL
;

616 ià(!
™”
 || !(
ús
 = (
ûx´_Çme_¡©e_t
 *è
	`qpŞ_™”©Ü_¡©e
(iter))) {

617 
”ºo
 = 
EINVAL
;

618  
STATUS_ERR
;

621 ià(
ús
->
li¡
 =ğ
QPOL_CEXPR_NAME_STATE_SUB_LIST
 && (ús->
sub
 ? cns->
cur
 >ğús->sub->
highb™
 : 1))

625 
	}
}

627 
	$ûx´_Çme_¡©e_Ãxt
(
qpŞ_™”©Ü_t
 * 
™”
)

629 
ûx´_Çme_¡©e_t
 *
ús
 = 
NULL
;

630 
eb™m­_t
 *
bm­
 = 
NULL
;

632 ià(!
™”
 || !(
ús
 = (
ûx´_Çme_¡©e_t
 *è
	`qpŞ_™”©Ü_¡©e
(iter))) {

633 
”ºo
 = 
EINVAL
;

634  
STATUS_ERR
;

637 ià(
	`qpŞ_™”©Ü_’d
(
™”
)) {

638 
”ºo
 = 
ERANGE
;

639  
STATUS_ERR
;

642 
bm­
 = (
ús
->
li¡
 =ğ
QPOL_CEXPR_NAME_STATE_INC_LIST
 ? cns->
šc
 : cns->
sub
);

645 
ús
->
cur
++;

646 ià(
ús
->
cur
 >ğ
bm­
->
highb™
) {

647 ià(
ús
->
li¡
 =ğ
QPOL_CEXPR_NAME_STATE_INC_LIST
) {

648 
ús
->
li¡
 = 
QPOL_CEXPR_NAME_STATE_SUB_LIST
;

649 
ús
->
cur
 = 0;

650 
bm­
 = 
ús
->
sub
;

651 ià(!
bm­
)

657 } !
	`eb™m­_g‘_b™
(
bm­
, 
ús
->
cur
));

659  
STATUS_SUCCESS
;

660 
	}
}

662 
size_t
 
	$ûx´_Çme_¡©e_size
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

664 
ûx´_Çme_¡©e_t
 *
ús
 = 
NULL
;

665 
size_t
 
couÁ
 = 0, 
b™
 = 0;

666 
eb™m­_node_t
 *
node
 = 
NULL
;

668 ià(!
™”
 || !(
ús
 = (
ûx´_Çme_¡©e_t
 *è
	`qpŞ_™”©Ü_¡©e
(iter))) {

669 
”ºo
 = 
EINVAL
;

673 
	`eb™m­_fÜ_—ch_b™
(
ús
->
šc
, 
node
, 
b™
) {

674 
couÁ
 +ğ
	`eb™m­_g‘_b™
(
ús
->
šc
, 
b™
);

677 ià(!(
ús
->
sub
))

678  
couÁ
;

680 
b™
 = 0;

681 
	`eb™m­_fÜ_—ch_b™
(
ús
->
sub
, 
node
, 
b™
) {

682 
couÁ
 +ğ
	`eb™m­_g‘_b™
(
ús
->
sub
, 
b™
);

685  
couÁ
;

686 
	}
}

688 *
	$ûx´_Çme_¡©e_g‘_cur_u£r
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

690 
ûx´_Çme_¡©e_t
 *
ús
 = 
NULL
;

691 cÚ¡ 
pŞicydb_t
 *
db
 = 
NULL
;

693 ià(!
™”
 || !(
ús
 = (
ûx´_Çme_¡©e_t
 *è
	`qpŞ_™”©Ü_¡©e
(iter)) ||

694 !(
db
 = 
	`qpŞ_™”©Ü_pŞicy
(
™”
)è|| 
	`qpŞ_™”©Ü_’d
(iter)) {

695 
”ºo
 = 
EINVAL
;

696  
NULL
;

699  
	`¡rdup
(
db
->
p_u£r_v®_to_Çme
[
ús
->
cur
]);

700 
	}
}

702 *
	$ûx´_Çme_¡©e_g‘_cur_rŞe
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

704 
ûx´_Çme_¡©e_t
 *
ús
 = 
NULL
;

705 cÚ¡ 
pŞicydb_t
 *
db
 = 
NULL
;

707 ià(!
™”
 || !(
ús
 = (
ûx´_Çme_¡©e_t
 *è
	`qpŞ_™”©Ü_¡©e
(iter)) ||

708 !(
db
 = 
	`qpŞ_™”©Ü_pŞicy
(
™”
)è|| 
	`qpŞ_™”©Ü_’d
(iter)) {

709 
”ºo
 = 
EINVAL
;

710  
NULL
;

713  
	`¡rdup
(
db
->
p_rŞe_v®_to_Çme
[
ús
->
cur
]);

714 
	}
}

716 *
	$ûx´_Çme_¡©e_g‘_cur_ty³
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

718 
ûx´_Çme_¡©e_t
 *
ús
 = 
NULL
;

719 cÚ¡ 
pŞicydb_t
 *
db
 = 
NULL
;

720 *
tmp
 = 
NULL
, *
Çme
 = NULL;

721 
size_t
 
Ën
 = 0;

723 ià(!
™”
 || !(
ús
 = (
ûx´_Çme_¡©e_t
 *è
	`qpŞ_™”©Ü_¡©e
(iter)) ||

724 !(
db
 = 
	`qpŞ_™”©Ü_pŞicy
(
™”
)è|| 
	`qpŞ_™”©Ü_’d
(iter)) {

725 
”ºo
 = 
EINVAL
;

726  
NULL
;

729 
tmp
 = 
	`¡rdup
(
db
->
p_ty³_v®_to_Çme
[
ús
->
cur
]);

731 ià(
ús
->
li¡
 =ğ
QPOL_CEXPR_NAME_STATE_INC_LIST
)

732  
tmp
;

734 
Ën
 = 
	`¡¾’
(
tmp
);

735 
Çme
 = 
	`ÿÎoc
(
Ën
 + 2, ());

736 ià(!
Çme
) {

737 
	`ä“
(
tmp
);

738 
”ºo
 = 
ENOMEM
;

739  
NULL
;

741 
Ën
++;

743 
	`¢´štf
(
Çme
, 
Ën
 + 1, "-%s", 
tmp
);

744 
	`ä“
(
tmp
);

746  
Çme
;

747 
	}
}

749 
	$qpŞ_cÚ¡¿št_ex´_node_g‘_Çmes_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_cÚ¡¿št_ex´_node_t
 * 
ex´
,

750 
qpŞ_™”©Ü_t
 ** 
™”
)

752 
cÚ¡¿št_ex´_t
 *
š‹º®_ex´
 = 
NULL
;

753 
ûx´_Çme_¡©e_t
 *
ús
 = 
NULL
;

754 
pŞicy_ty³
 = 0;

756 ià(
™”
)

757 *
™”
 = 
NULL
;

759 ià(!
pŞicy
 || !
ex´
 || !
™”
) {

760 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

761 
”ºo
 = 
EINVAL
;

762  
STATUS_ERR
;

765 ià(
	`qpŞ_pŞicy_g‘_ty³
(
pŞicy
, &
pŞicy_ty³
))

766  
STATUS_ERR
;

768 
š‹º®_ex´
 = (
cÚ¡¿št_ex´_t
 *è
ex´
;

770 ià(
š‹º®_ex´
->
ex´_ty³
 !ğ
QPOL_CEXPR_TYPE_NAMES
) {

771 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

772 
”ºo
 = 
EINVAL
;

773  
STATUS_ERR
;

776 ià(!(
ús
 = 
	`ÿÎoc
(1, (
ûx´_Çme_¡©e_t
)))) {

777 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

778 
”ºo
 = 
ENOMEM
;

779  
STATUS_ERR
;

782 
pŞicy_v”siÚ
;

783 ià(
	`qpŞ_pŞicy_g‘_pŞicy_v”siÚ
(
pŞicy
, &
pŞicy_v”siÚ
))

784  
STATUS_ERR
;

786 ià(
š‹º®_ex´
->
©Œ
 & 
QPOL_CEXPR_SYM_TYPE
) {

787 ià(
pŞicy_ty³
 =ğ
QPOL_POLICY_KERNEL_BINARY
 && 
pŞicy_v”siÚ
 <= 28) {

788 
ús
->
šc
 = &(
š‹º®_ex´
->
Çmes
);

789 } ià(
pŞicy_ty³
 =ğ
QPOL_POLICY_KERNEL_BINARY
 && 
pŞicy_v”siÚ
 > 28) {

790 
ús
->
šc
 = &(
š‹º®_ex´
->
ty³_Çmes
->
ty³s
);

792 
ús
->
šc
 = &(
š‹º®_ex´
->
ty³_Çmes
->
ty³s
);

793 
ús
->
sub
 = &(
š‹º®_ex´
->
ty³_Çmes
->
Ãg£t
);

796 
ús
->
šc
 = &(
š‹º®_ex´
->
Çmes
);

798 
ús
->
li¡
 = 
QPOL_CEXPR_NAME_STATE_INC_LIST
;

799 
ús
->
cur
 = cns->
šc
->
node
 ? cns->šc->node->
¡¬tb™
 : 0;

801 
š‹º®_ex´
->
©Œ
 & ~(
QPOL_CEXPR_SYM_TARGET
 | 
QPOL_CEXPR_SYM_XTARGET
)) {

802 
QPOL_CEXPR_SYM_USER
:

804 ià(
	`qpŞ_™”©Ü_ü—‹
(
pŞicy
, (*)
ús
,

805 
ûx´_Çme_¡©e_g‘_cur_u£r
, 
ûx´_Çme_¡©e_Ãxt
,

806 
ûx´_Çme_¡©e_’d
, 
ûx´_Çme_¡©e_size
, 
ä“
, 
™”
)) {

807  
STATUS_ERR
;

811 
QPOL_CEXPR_SYM_ROLE
:

813 ià(
	`qpŞ_™”©Ü_ü—‹
(
pŞicy
, (*)
ús
,

814 
ûx´_Çme_¡©e_g‘_cur_rŞe
, 
ûx´_Çme_¡©e_Ãxt
,

815 
ûx´_Çme_¡©e_’d
, 
ûx´_Çme_¡©e_size
, 
ä“
, 
™”
)) {

816  
STATUS_ERR
;

820 
QPOL_CEXPR_SYM_TYPE
:

822 ià(
	`qpŞ_™”©Ü_ü—‹
(
pŞicy
, (*)
ús
,

823 
ûx´_Çme_¡©e_g‘_cur_ty³
, 
ûx´_Çme_¡©e_Ãxt
,

824 
ûx´_Çme_¡©e_’d
, 
ûx´_Çme_¡©e_size
, 
ä“
, 
™”
)) {

825  
STATUS_ERR
;

831 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

832 
	`ä“
(
ús
);

833 
”ºo
 = 
EINVAL
;

834  
STATUS_ERR
;

838 ià(
ús
->
šc
->
node
 && !
	`eb™m­_g‘_b™
(ús->šc, cns->
cur
))

839 
	`qpŞ_™”©Ü_Ãxt
(*
™”
);

841  
STATUS_SUCCESS
;

842 
	}
}

844 
	sşass_cÚ¡r_¡©e


846 
cÚ¡¿št_node_t
 *
	mh—d
;

847 
cÚ¡¿št_node_t
 *
	mcur
;

848 cÚ¡ 
qpŞ_şass_t
 *
	mobj_şass
;

849 } 
	tşass_cÚ¡r_¡©e_t
;

851 
	$şass_cÚ¡r_¡©e_’d
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

853 
şass_cÚ¡r_¡©e_t
 *
ccs
 = 
NULL
;

855 ià(!
™”
 || !(
ccs
 = (
şass_cÚ¡r_¡©e_t
 *è
	`qpŞ_™”©Ü_¡©e
(iter))) {

856 
”ºo
 = 
EINVAL
;

857  
STATUS_ERR
;

860  
ccs
->
cur
 ? 0 : 1;

861 
	}
}

863 *
	$şass_cÚ¡r_¡©e_g‘_cur
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

865 
şass_cÚ¡r_¡©e_t
 *
ccs
 = 
NULL
;

866 
qpŞ_cÚ¡¿št_t
 *
qc
 = 
NULL
;

868 ià(!
™”
 || !(
ccs
 = (
şass_cÚ¡r_¡©e_t
 *è
	`qpŞ_™”©Ü_¡©e
(™”)è|| 
	`qpŞ_™”©Ü_’d
(iter)) {

869 
”ºo
 = 
EINVAL
;

870  
NULL
;

873 ià(!(
qc
 = 
	`ÿÎoc
(1, (
qpŞ_cÚ¡¿št_t
)))) {

874  
NULL
;

876 
qc
->
obj_şass
 = 
ccs
->obj_class;

877 
qc
->
cÚ¡r
 = 
ccs
->
cur
;

879  
qc
;

880 
	}
}

882 
	$şass_cÚ¡r_¡©e_Ãxt
(
qpŞ_™”©Ü_t
 * 
™”
)

884 
şass_cÚ¡r_¡©e_t
 *
ccs
 = 
NULL
;

886 ià(!
™”
 || !(
ccs
 = (
şass_cÚ¡r_¡©e_t
 *è
	`qpŞ_™”©Ü_¡©e
(iter))) {

887 
”ºo
 = 
EINVAL
;

888  
STATUS_ERR
;

891 ià(
	`qpŞ_™”©Ü_’d
(
™”
)) {

892 
”ºo
 = 
ERANGE
;

893  
STATUS_ERR
;

896 
ccs
->
cur
 = ccs->cur->
Ãxt
;

898  
STATUS_SUCCESS
;

899 
	}
}

901 
size_t
 
	$şass_cÚ¡r_¡©e_size
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

903 
şass_cÚ¡r_¡©e_t
 *
ccs
 = 
NULL
;

904 
cÚ¡¿št_node_t
 *
tmp
 = 
NULL
;

905 
size_t
 
couÁ
 = 0;

907 ià(!
™”
 || !(
ccs
 = (
şass_cÚ¡r_¡©e_t
 *è
	`qpŞ_™”©Ü_¡©e
(™”)è|| 
	`qpŞ_™”©Ü_’d
(iter)) {

908 
”ºo
 = 
EINVAL
;

912 
tmp
 = 
ccs
->
h—d
;mp;m°ğtmp->
Ãxt
)

913 
couÁ
++;

915  
couÁ
;

916 
	}
}

918 
	$qpŞ_şass_g‘_cÚ¡¿št_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_şass_t
 * 
obj_şass
, 
qpŞ_™”©Ü_t
 ** 
cÚ¡r
)

920 cÚ¡ 
pŞicydb_t
 *
db
 = 
NULL
;

921 
şass_cÚ¡r_¡©e_t
 *
ccs
 = 
NULL
;

922 
şass_d©um_t
 *
š‹º®_şass
 = 
NULL
;

923 
”rÜ
 = 0;

925 ià(
cÚ¡r
)

926 *
cÚ¡r
 = 
NULL
;

928 ià(!
pŞicy
 || !
obj_şass
 || !
cÚ¡r
) {

929 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

930 
”ºo
 = 
EINVAL
;

931  
STATUS_ERR
;

934 
db
 = &
pŞicy
->
p
->p;

935 
š‹º®_şass
 = (
şass_d©um_t
 *è
obj_şass
;

937 
ccs
 = 
	`ÿÎoc
(1, (
şass_cÚ¡r_¡©e_t
));

938 ià(!
ccs
) {

939 
”rÜ
 = 
”ºo
;

940 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

941 
”ºo
 = 
”rÜ
;

942  
STATUS_ERR
;

944 
ccs
->
obj_şass
 = obj_class;

945 
ccs
->
h—d
 = ccs->
cur
 = 
š‹º®_şass
->
cÚ¡¿šts
;

947 ià(
	`qpŞ_™”©Ü_ü—‹
(
pŞicy
, (*)
ccs
, 
şass_cÚ¡r_¡©e_g‘_cur
,

948 
şass_cÚ¡r_¡©e_Ãxt
, 
şass_cÚ¡r_¡©e_’d
, 
şass_cÚ¡r_¡©e_size
, 
ä“
, 
cÚ¡r
)) {

949  
STATUS_ERR
;

952  
STATUS_SUCCESS
;

953 
	}
}

955 
	$qpŞ_şass_g‘_v®id©‘¿ns_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_şass_t
 * 
obj_şass
, 
qpŞ_™”©Ü_t
 ** 
vŒªs
)

957 cÚ¡ 
pŞicydb_t
 *
db
 = 
NULL
;

958 
şass_cÚ¡r_¡©e_t
 *
ccs
 = 
NULL
;

959 
şass_d©um_t
 *
š‹º®_şass
 = 
NULL
;

960 
”rÜ
 = 0;

962 ià(
vŒªs
)

963 *
vŒªs
 = 
NULL
;

965 ià(!
pŞicy
 || !
obj_şass
 || !
vŒªs
) {

966 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

967 
”ºo
 = 
EINVAL
;

968  
STATUS_ERR
;

971 
db
 = &
pŞicy
->
p
->p;

972 
š‹º®_şass
 = (
şass_d©um_t
 *è
obj_şass
;

974 
ccs
 = 
	`ÿÎoc
(1, (
şass_cÚ¡r_¡©e_t
));

975 ià(!
ccs
) {

976 
”rÜ
 = 
”ºo
;

977 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

978 
”ºo
 = 
”rÜ
;

979  
STATUS_ERR
;

981 
ccs
->
obj_şass
 = obj_class;

982 
ccs
->
h—d
 = ccs->
cur
 = 
š‹º®_şass
->
v®id©‘¿ns
;

984 ià(
	`qpŞ_™”©Ü_ü—‹
(
pŞicy
, (*)
ccs
, 
şass_cÚ¡r_¡©e_g‘_cur
,

985 
şass_cÚ¡r_¡©e_Ãxt
, 
şass_cÚ¡r_¡©e_’d
, 
şass_cÚ¡r_¡©e_size
, 
ä“
, 
vŒªs
)) {

986  
STATUS_ERR
;

989  
STATUS_SUCCESS
;

990 
	}
}

	@libqpol/src/context_query.c

26 
	~<¡ddef.h
>

27 
	~<¡dlib.h
>

28 
	~<¡dšt.h
>

29 
	~<qpŞ/pŞicy.h
>

30 
	~<qpŞ/cÚ‹xt_qu”y.h
>

31 
	~<qpŞ/u£r_qu”y.h
>

32 
	~<qpŞ/rŞe_qu”y.h
>

33 
	~<qpŞ/ty³_qu”y.h
>

34 
	~<qpŞ/mls_qu”y.h
>

35 
	~<£pŞ/pŞicydb/pŞicydb.h
>

36 
	~<£pŞ/pŞicydb/cÚ‹xt.h
>

37 
	~"qpŞ_š‹º®.h
"

39 
	$qpŞ_cÚ‹xt_g‘_u£r
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_cÚ‹xt_t
 * 
cÚ‹xt
, cÚ¡ 
qpŞ_u£r_t
 ** 
u£r
)

41 
pŞicydb_t
 *
db
 = 
NULL
;

42 
cÚ‹xt_¡ruù_t
 *
š‹º®_cÚ‹xt
 = 
NULL
;

44 ià(
u£r
 !ğ
NULL
)

45 *
u£r
 = 
NULL
;

47 ià(
pŞicy
 =ğ
NULL
 || 
cÚ‹xt
 =ğNULL || 
u£r
 == NULL) {

48 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

49 
”ºo
 = 
EINVAL
;

50  
STATUS_ERR
;

53 
š‹º®_cÚ‹xt
 = (
cÚ‹xt_¡ruù_t
 *è
cÚ‹xt
;

54 
db
 = &
pŞicy
->
p
->p;

56 *
u£r
 = (
qpŞ_u£r_t
 *è
db
->
u£r_v®_to_¡ruù
[
š‹º®_cÚ‹xt
->user - 1];

58  
STATUS_SUCCESS
;

59 
	}
}

61 
	$qpŞ_cÚ‹xt_g‘_rŞe
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_cÚ‹xt_t
 * 
cÚ‹xt
, cÚ¡ 
qpŞ_rŞe_t
 ** 
rŞe
)

63 
pŞicydb_t
 *
db
 = 
NULL
;

64 
cÚ‹xt_¡ruù_t
 *
š‹º®_cÚ‹xt
 = 
NULL
;

66 ià(
rŞe
 !ğ
NULL
)

67 *
rŞe
 = 
NULL
;

69 ià(
pŞicy
 =ğ
NULL
 || 
cÚ‹xt
 =ğNULL || 
rŞe
 == NULL) {

70 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

71 
”ºo
 = 
EINVAL
;

72  
STATUS_ERR
;

75 
š‹º®_cÚ‹xt
 = (
cÚ‹xt_¡ruù_t
 *è
cÚ‹xt
;

76 
db
 = &
pŞicy
->
p
->p;

78 *
rŞe
 = (
qpŞ_rŞe_t
 *è
db
->
rŞe_v®_to_¡ruù
[
š‹º®_cÚ‹xt
->role - 1];

80  
STATUS_SUCCESS
;

81 
	}
}

83 
	$qpŞ_cÚ‹xt_g‘_ty³
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_cÚ‹xt_t
 * 
cÚ‹xt
, cÚ¡ 
qpŞ_ty³_t
 ** 
ty³
)

85 
pŞicydb_t
 *
db
 = 
NULL
;

86 
cÚ‹xt_¡ruù_t
 *
š‹º®_cÚ‹xt
 = 
NULL
;

88 ià(
ty³
 !ğ
NULL
)

89 *
ty³
 = 
NULL
;

91 ià(
pŞicy
 =ğ
NULL
 || 
cÚ‹xt
 =ğNULL || 
ty³
 == NULL) {

92 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

93 
”ºo
 = 
EINVAL
;

94  
STATUS_ERR
;

97 
š‹º®_cÚ‹xt
 = (
cÚ‹xt_¡ruù_t
 *è
cÚ‹xt
;

98 
db
 = &
pŞicy
->
p
->p;

100 *
ty³
 = (
qpŞ_ty³_t
 *è
db
->
ty³_v®_to_¡ruù
[
š‹º®_cÚ‹xt
->type - 1];

102  
STATUS_SUCCESS
;

103 
	}
}

105 
	$qpŞ_cÚ‹xt_g‘_¿nge
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_cÚ‹xt_t
 * 
cÚ‹xt
, cÚ¡ 
qpŞ_mls_¿nge_t
 ** 
¿nge
)

107 
cÚ‹xt_¡ruù_t
 *
š‹º®_cÚ‹xt
 = 
NULL
;

109 ià(
¿nge
 !ğ
NULL
)

110 *
¿nge
 = 
NULL
;

112 ià(
pŞicy
 =ğ
NULL
 || 
cÚ‹xt
 =ğNULL || 
¿nge
 == NULL) {

113 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

114 
”ºo
 = 
EINVAL
;

115  
STATUS_ERR
;

118 
š‹º®_cÚ‹xt
 = (
cÚ‹xt_¡ruù_t
 *è
cÚ‹xt
;

120 *
¿nge
 = (
qpŞ_mls_¿nge_t
 *è& 
š‹º®_cÚ‹xt
->range;

122  
STATUS_SUCCESS
;

123 
	}
}

	@libqpol/src/default_object_query.c

24 
	~<¡ddef.h
>

25 
	~<¡dlib.h
>

26 
	~<¡dšt.h
>

27 
	~<qpŞ/™”©Ü.h
>

28 
	~<qpŞ/pŞicy.h
>

29 
	~<qpŞ/deçuÉ_objeù_qu”y.h
>

30 
	~<£pŞ/pŞicydb/pŞicydb.h
>

31 
	~"qpŞ_š‹º®.h
"

32 
	~"™”©Ü_š‹º®.h
"

34 
	$qpŞ_deçuÉ_objeù_g‘_şass
(cÚ¡ 
qpŞ_pŞicy_t
 *
pŞicy
, cÚ¡ 
qpŞ_deçuÉ_objeù_t
 * 
d©um
, cÚ¡ **
Çme
)

36 
şass_d©um_t
 *
š‹º®_d©um
 = 
NULL
;

37 
pŞicydb_t
 *
db
 = 
NULL
;

39 ià(
pŞicy
 =ğ
NULL
 || 
d©um
 =ğNULL || 
Çme
 == NULL) {

40 ià(
Çme
 !ğ
NULL
)

41 *
Çme
 = 
NULL
;

42 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

43 
”ºo
 = 
EINVAL
;

44  
STATUS_ERR
;

46 *
Çme
 = 
NULL
;

48 
db
 = &
pŞicy
->
p
->p;

49 
š‹º®_d©um
 = (
şass_d©um_t
 *)
d©um
;

52 ià(
š‹º®_d©um
->
deçuÉ_u£r
 || iÁ”Çl_d©um->
deçuÉ_rŞe
 ||

53 
š‹º®_d©um
->
deçuÉ_ty³
 ||

54 
š‹º®_d©um
->
deçuÉ_¿nge
) {

55 *
Çme
 = 
db
->
p_şass_v®_to_Çme
[
š‹º®_d©um
->
s
.
v®ue
 - 1];

57  
STATUS_SUCCESS
;

58 
	}
}

60 
	$qpŞ_deçuÉ_objeù_g‘_u£r_deçuÉ
(cÚ¡ 
qpŞ_pŞicy_t
 *
pŞicy
, cÚ¡ 
qpŞ_deçuÉ_objeù_t
 * 
d©um
, cÚ¡ **
v®ue
)

62 
şass_d©um_t
 *
š‹º®_d©um
 = 
NULL
;

63 
pŞicydb_t
 *
db
 = 
NULL
;

65 ià(
pŞicy
 =ğ
NULL
 || 
d©um
 =ğNULL || 
v®ue
 == NULL) {

66 ià(
v®ue
 !ğ
NULL
)

67 *
v®ue
 = 
NULL
;

68 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

69 
”ºo
 = 
EINVAL
;

70  
STATUS_ERR
;

72 *
v®ue
 = 
NULL
;

75 ià(!
	`qpŞ_pŞicy_has_ÿ·b™y
(
pŞicy
, 
QPOL_CAP_DEFAULT_OBJECTS
))

76  
STATUS_SUCCESS
;

78 
db
 = &
pŞicy
->
p
->p;

79 
š‹º®_d©um
 = (
şass_d©um_t
 *)
d©um
;

81 ià(
š‹º®_d©um
->
deçuÉ_u£r
 =ğ
DEFAULT_SOURCE
) {

82 *
v®ue
 = "source";

83 } ià(
š‹º®_d©um
->
deçuÉ_u£r
 =ğ
DEFAULT_TARGET
) {

84 *
v®ue
 = "target";

86  
STATUS_SUCCESS
;

87 
	}
}

89 
	$qpŞ_deçuÉ_objeù_g‘_rŞe_deçuÉ
(cÚ¡ 
qpŞ_pŞicy_t
 *
pŞicy
, cÚ¡ 
qpŞ_deçuÉ_objeù_t
 * 
d©um
, cÚ¡ **
v®ue
)

91 
şass_d©um_t
 *
š‹º®_d©um
 = 
NULL
;

92 
pŞicydb_t
 *
db
 = 
NULL
;

94 ià(
pŞicy
 =ğ
NULL
 || 
d©um
 =ğNULL || 
v®ue
 == NULL) {

95 ià(
v®ue
 !ğ
NULL
)

96 *
v®ue
 = 
NULL
;

97 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

98 
”ºo
 = 
EINVAL
;

99  
STATUS_ERR
;

101 *
v®ue
 = 
NULL
;

104 ià(!
	`qpŞ_pŞicy_has_ÿ·b™y
(
pŞicy
, 
QPOL_CAP_DEFAULT_OBJECTS
))

105  
STATUS_SUCCESS
;

107 
db
 = &
pŞicy
->
p
->p;

108 
š‹º®_d©um
 = (
şass_d©um_t
 *)
d©um
;

110 ià(
š‹º®_d©um
->
deçuÉ_rŞe
 =ğ
DEFAULT_SOURCE
) {

111 *
v®ue
 = "source";

112 } ià(
š‹º®_d©um
->
deçuÉ_rŞe
 =ğ
DEFAULT_TARGET
) {

113 *
v®ue
 = "target";

115  
STATUS_SUCCESS
;

116 
	}
}

118 
	$qpŞ_deçuÉ_objeù_g‘_ty³_deçuÉ
(cÚ¡ 
qpŞ_pŞicy_t
 *
pŞicy
, cÚ¡ 
qpŞ_deçuÉ_objeù_t
 * 
d©um
, cÚ¡ **
v®ue
)

120 
şass_d©um_t
 *
š‹º®_d©um
 = 
NULL
;

121 
pŞicydb_t
 *
db
 = 
NULL
;

123 ià(
pŞicy
 =ğ
NULL
 || 
d©um
 =ğNULL || 
v®ue
 == NULL) {

124 ià(
v®ue
 !ğ
NULL
)

125 *
v®ue
 = 
NULL
;

126 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

127 
”ºo
 = 
EINVAL
;

128  
STATUS_ERR
;

130 *
v®ue
 = 
NULL
;

133 ià(!
	`qpŞ_pŞicy_has_ÿ·b™y
(
pŞicy
, 
QPOL_CAP_DEFAULT_TYPE
))

134  
STATUS_SUCCESS
;

136 
db
 = &
pŞicy
->
p
->p;

137 
š‹º®_d©um
 = (
şass_d©um_t
 *)
d©um
;

139 ià(
š‹º®_d©um
->
deçuÉ_ty³
 =ğ
DEFAULT_SOURCE
) {

140 *
v®ue
 = "source";

141 } ià(
š‹º®_d©um
->
deçuÉ_ty³
 =ğ
DEFAULT_TARGET
) {

142 *
v®ue
 = "target";

144  
STATUS_SUCCESS
;

145 
	}
}

147 
	$qpŞ_deçuÉ_objeù_g‘_¿nge_deçuÉ
(cÚ¡ 
qpŞ_pŞicy_t
 *
pŞicy
, cÚ¡ 
qpŞ_deçuÉ_objeù_t
 * 
d©um
, cÚ¡ **
v®ue
)

149 
şass_d©um_t
 *
š‹º®_d©um
 = 
NULL
;

150 
pŞicydb_t
 *
db
 = 
NULL
;

152 ià(
pŞicy
 =ğ
NULL
 || 
d©um
 =ğNULL || 
v®ue
 == NULL) {

153 ià(
v®ue
 !ğ
NULL
)

154 *
v®ue
 = 
NULL
;

155 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

156 
”ºo
 = 
EINVAL
;

157  
STATUS_ERR
;

159 *
v®ue
 = 
NULL
;

162 
pŞicy_v”siÚ
;

163 ià(!
	`qpŞ_pŞicy_has_ÿ·b™y
(
pŞicy
, 
QPOL_CAP_DEFAULT_OBJECTS
))

164  
STATUS_SUCCESS
;

166 
db
 = &
pŞicy
->
p
->p;

167 
š‹º®_d©um
 = (
şass_d©um_t
 *)
d©um
;

169 
š‹º®_d©um
->
deçuÉ_¿nge
) {

170 
DEFAULT_SOURCE_LOW
:

171 *
v®ue
 = "source†ow";

173 
DEFAULT_SOURCE_HIGH
:

174 *
v®ue
 = "source high";

176 
DEFAULT_SOURCE_LOW_HIGH
:

177 *
v®ue
 = "source†ow_high";

179 
DEFAULT_TARGET_LOW
:

180 *
v®ue
 = "target†ow";

182 
DEFAULT_TARGET_HIGH
:

183 *
v®ue
 = "target high";

185 
DEFAULT_TARGET_LOW_HIGH
:

186 *
v®ue
 = "target†ow_high";

191  
STATUS_SUCCESS
;

192 
	}
}

195 
	$qpŞ_pŞicy_g‘_deçuÉ_objeù_™”
(cÚ¡ 
qpŞ_pŞicy_t
 *
pŞicy
, 
qpŞ_™”©Ü_t
 **
™”
)

197 
pŞicydb_t
 *
db
;

198 
”rÜ
 = 0;

199 
hash_¡©e_t
 *
hs
 = 
NULL
;

201 ià(
pŞicy
 =ğ
NULL
 || 
™”
 == NULL) {

202 ià(
™”
 !ğ
NULL
)

203 *
™”
 = 
NULL
;

204 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

205 
”ºo
 = 
EINVAL
;

206  
STATUS_ERR
;

209 
db
 = &
pŞicy
->
p
->p;

261 
hs
 = 
	`ÿÎoc
(1, (
hash_¡©e_t
));

262 ià(
hs
 =ğ
NULL
) {

263 
”rÜ
 = 
”ºo
;

264 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

265 
”ºo
 = 
”rÜ
;

266  
STATUS_ERR
;

268 
hs
->
bË
 = &
db
->
p_şas£s
.table;

269 
hs
->
node
 = (*(hs->
bË
))->
hbË
[0];

271 ià(
	`qpŞ_™”©Ü_ü—‹
(
pŞicy
, (*)
hs
, 
hash_¡©e_g‘_cur
,

272 
hash_¡©e_Ãxt
, 
hash_¡©e_’d
, 
hash_¡©e_size
, 
ä“
, 
™”
)) {

273 
	`ä“
(
hs
);

274  
STATUS_ERR
;

277 ià(
hs
->
node
 =ğ
NULL
)

278 
	`hash_¡©e_Ãxt
(*
™”
);

280  
STATUS_SUCCESS
;

281 
	}
}

	@libqpol/src/expand.c

26 
	~<cÚfig.h
>

28 
	~<£pŞ/pŞicydb/ex·nd.h
>

29 
	~<£pŞ/pŞicydb.h
>

30 
	~<¡dlib.h
>

31 
	~"qpŞ_š‹º®.h
"

32 
	~"ex·nd.h
"

34 
ex·nd_ty³_©Œ_m­
(
hashb_key_t
 
key
 
__©Œibu‹__
 ((
unu£d
)), 
hashb_d©um_t
 
d©um
, *
±r
)

36 
ty³_d©um_t
 *
	gty³
 = 
NULL
, *
	gÜig_ty³
;

37 
pŞicydb_t
 *
	gdb
 = (pŞicydb_ˆ*è
±r
;

38 
eb™m­_node_t
 *
	gnode
 = 
NULL
;

39 
ušt32_t
 
	gb™
 = 0;

41 
	gty³
 = (
ty³_d©um_t
 *è
d©um
;

44 ià(
	gty³
->
	gæavÜ
 =ğ
TYPE_ATTRIB
) {

45 
eb™m­_fÜ_—ch_b™
(&
ty³
->
ty³s
, 
node
, 
b™
) {

46 ià(
eb™m­_node_g‘_b™
(
node
, 
b™
)) {

47 
Üig_ty³
 = 
db
->
ty³_v®_to_¡ruù
[
b™
];

48 ià(
eb™m­_£t_b™
(&
Üig_ty³
->
ty³s
, 
ty³
->
s
.
v®ue
 - 1, 1)) {

57 
ex·nd_ty³_³rmissive_m­
(
hashb_key_t
 
key
 
__©Œibu‹__
 ((
unu£d
)), 
hashb_d©um_t
 
d©um
, *
±r
)

59 #ifdeà
HAVE_SEPOL_PERMISSIVE_TYPES


60 
ty³_d©um_t
 *
	gty³
 = (ty³_d©um_ˆ*è
d©um
;

61 
pŞicydb_t
 *
	gdb
 = (pŞicydb_ˆ*è
±r
;

63 
	gty³
 = (
ty³_d©um_t
 *è
d©um
;

68 ià(
	gty³
->
	gæags
 & 
	gTYPE_FLAGS_PERMISSIVE
) {

69 
ušt32_t
 
	gv®ue
;

70 ià(
	gty³
->
	gæavÜ
 =ğ
TYPE_ALIAS
) {

73 
v®ue
 = 
ty³
->
´im¬y
;

75 
	gv®ue
 = 
ty³
->
s
.
v®ue
;

77 ià(
eb™m­_£t_b™
(&
db
->
³rmissive_m­
, 
v®ue
, 1)) {

85 
	$qpŞ_ex·nd_moduË
(
qpŞ_pŞicy_t
 * 
ba£
, 
Ãv”®lows
)

87 
i
;

88 
ušt32_t
 *
ty³m­
 = 
NULL
, *
boŞm­
 = NULL, *
rŞem­
 = NULL, *
u£rm­
 = NULL;

89 
pŞicydb_t
 *
db
;

90 
¹
, 
”rÜ
 = 0;

92 
	`INFO
(
ba£
, "%s", "Expanding…olicy. (Step 3 of 5)");

93 ià(
ba£
 =ğ
NULL
) {

94 
	`ERR
(
ba£
, "%s", 
	`¡»¼Ü
(
EINVAL
));

95 
”ºo
 = 
EINVAL
;

98 
db
 = &
ba£
->
p
->p;

101 
db
->
glob®
->
b¿nch_li¡
->
’abËd
 = 1;

102 
db
->
glob®
->
’abËd
 = db->glob®->
b¿nch_li¡
;

105 ià(
	`hashb_m­
(
db
->
p_ty³s
.
bË
, 
ex·nd_ty³_©Œ_m­
, (db))) {

106 
”rÜ
 = 
”ºo
;

107 
	`ERR
(
ba£
, "%s", "Errorƒxpanding‡ttributes forypes.");

108 
”r
;

110 #ifdeà
HAVE_SEPOL_PERMISSIVE_TYPES


114 ià(
	`hashb_m­
(
db
->
p_ty³s
.
bË
, 
ex·nd_ty³_³rmissive_m­
, (db))) {

115 
”rÜ
 = 
”ºo
;

116 
	`ERR
(
ba£
, "%s", "Errorƒxpanding‡ttributes forypes.");

117 
”r
;

122 
ty³m­
 = (
ušt32_t
 *è
	`ÿÎoc
(
db
->
p_ty³s
.
Årim
, (uint32_t));

123 ià(
ty³m­
 =ğ
NULL
) {

124 
”rÜ
 = 
”ºo
;

125 
	`ERR
(
ba£
, "%s", 
	`¡»¼Ü
(
”ºo
));

126 
”r
;

128 
i
 = 0; i < 
db
->
p_ty³s
.
Årim
; i++) {

129 
ty³m­
[
i
] = i + 1;

132 #ifdeà
HAVE_SEPOL_BOOLMAP


133 
boŞm­
 = (
ušt32_t
 *è
	`ÿÎoc
(
db
->
p_boŞs
.
Årim
, (uint32_t));

134 ià(
boŞm­
 =ğ
NULL
) {

135 
”rÜ
 = 
”ºo
;

136 
	`ERR
(
ba£
, "%s", 
	`¡»¼Ü
(
”ºo
));

137 
”r
;

139 
i
 = 0; i < 
db
->
p_boŞs
.
Årim
; i++) {

140 
boŞm­
[
i
] = i + 1;

143 #ifdeà
HAVE_SEPOL_USER_ROLE_MAPPING


144 
rŞem­
 = (
ušt32_t
 *è
	`ÿÎoc
(
db
->
p_rŞes
.
Årim
, (uint32_t));

145 ià(
rŞem­
 =ğ
NULL
) {

146 
”rÜ
 = 
”ºo
;

147 
	`ERR
(
ba£
, "%s", 
	`¡»¼Ü
(
”ºo
));

148 
”r
;

150 
i
 = 0; i < 
db
->
p_rŞes
.
Årim
; i++) {

151 
rŞem­
[
i
] = i + 1;

153 
u£rm­
 = (
ušt32_t
 *è
	`ÿÎoc
(
db
->
p_u£rs
.
Årim
, (uint32_t));

154 ià(
u£rm­
 =ğ
NULL
) {

155 
”rÜ
 = 
”ºo
;

156 
	`ERR
(
ba£
, "%s", 
	`¡»¼Ü
(
”ºo
));

157 
”r
;

159 
i
 = 0; i < 
db
->
p_u£rs
.
Årim
; i++) {

160 
u£rm­
[
i
] = i + 1;

162 
¹
 = 
	`ex·nd_moduË_avruËs
(
ba£
->
sh
, 
db
, db, 
ty³m­
, 
boŞm­
, 
rŞem­
, 
u£rm­
, 0, 
Ãv”®lows
);

164 
¹
 = 
	`ex·nd_moduË_avruËs
(
ba£
->
sh
, 
db
, db, 
ty³m­
, 
boŞm­
, 0, 
Ãv”®lows
);

168 
¹
 = 
	`ex·nd_moduË_avruËs
(
ba£
->
sh
, 
db
, db, 
ty³m­
, 0, 
Ãv”®lows
);

170 ià(
¹
 < 0) {

171 
”rÜ
 = 
”ºo
;

172 
”r
;

174 
¹
 = 0;

176 
ex™
:

177 
	`ä“
(
ty³m­
);

178 
	`ä“
(
boŞm­
);

179 
	`ä“
(
rŞem­
);

180 
	`ä“
(
u£rm­
);

181 
”ºo
 = 
”rÜ
;

182  
¹
;

183 
”r
:

184 
¹
 = -1;

187 ià(!
”rÜ
)

188 
”rÜ
 = 
EIO
;

189 
ex™
;

190 
	}
}

	@libqpol/src/expand.h

27 #iâdeà
QPOL_EXPAND_H


28 
	#QPOL_EXPAND_H


	)

30 #ifdef 
__ılu¥lus


35 
	~<qpŞ/pŞicy.h
>

45 
qpŞ_ex·nd_moduË
(
qpŞ_pŞicy_t
 * 
ba£
, 
Ãv”®lows
);

47 #ifdef 
__ılu¥lus


	@libqpol/src/fs_use_query.c

26 
	~<¡ddef.h
>

27 
	~<¡dlib.h
>

28 
	~<¡dšt.h
>

29 
	~<qpŞ/™”©Ü.h
>

30 
	~<qpŞ/pŞicy.h
>

31 
	~<qpŞ/fs_u£_qu”y.h
>

32 
	~<qpŞ/cÚ‹xt_qu”y.h
>

33 
	~<£pŞ/pŞicydb/pŞicydb.h
>

34 
	~<£pŞ/pŞicydb/cÚ‹xt.h
>

35 
	~"qpŞ_š‹º®.h
"

36 
	~"™”©Ü_š‹º®.h
"

38 
	$qpŞ_pŞicy_g‘_fs_u£_by_Çme
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ *
Çme
, cÚ¡ 
qpŞ_fs_u£_t
 ** 
ocÚ
)

40 
ocÚ‹xt_t
 *
tmp
 = 
NULL
;

41 
pŞicydb_t
 *
db
 = 
NULL
;

43 ià(
ocÚ
 !ğ
NULL
)

44 *
ocÚ
 = 
NULL
;

46 ià(
pŞicy
 =ğ
NULL
 || 
Çme
 =ğNULL || 
ocÚ
 == NULL) {

47 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

48 
”ºo
 = 
EINVAL
;

49  
STATUS_ERR
;

52 
db
 = &
pŞicy
->
p
->p;

53 
tmp
 = 
db
->
ocÚ‹xts
[
OCON_FSUSE
];mp;m°ğtmp->
Ãxt
) {

54 ià(!
	`¡rcmp
(
Çme
, 
tmp
->
u
.name))

58 *
ocÚ
 = (
qpŞ_fs_u£_t
 *è
tmp
;

60 ià(*
ocÚ
 =ğ
NULL
) {

61 
	`ERR
(
pŞicy
, "could‚Ù fšd fs_u£ s‹m’ˆfÜ %s", 
Çme
);

62 
”ºo
 = 
ENOENT
;

63  
STATUS_ERR
;

66  
STATUS_SUCCESS
;

67 
	}
}

69 
	$qpŞ_pŞicy_g‘_fs_u£_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, 
qpŞ_™”©Ü_t
 ** 
™”
)

71 
pŞicydb_t
 *
db
 = 
NULL
;

72 
”rÜ
 = 0;

73 
ocÚ_¡©e_t
 *
os
 = 
NULL
;

75 ià(
™”
 !ğ
NULL
)

76 *
™”
 = 
NULL
;

78 ià(
pŞicy
 =ğ
NULL
 || 
™”
 == NULL) {

79 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

80 
”ºo
 = 
EINVAL
;

81  
STATUS_ERR
;

84 
db
 = &
pŞicy
->
p
->p;

86 
os
 = 
	`ÿÎoc
(1, (
ocÚ_¡©e_t
));

87 ià(
os
 =ğ
NULL
) {

88 
”rÜ
 = 
”ºo
;

89 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

90 
”ºo
 = 
”rÜ
;

91  
STATUS_ERR
;

94 
os
->
h—d
 = os->
cur
 = 
db
->
ocÚ‹xts
[
OCON_FSUSE
];

96 ià(
	`qpŞ_™”©Ü_ü—‹
(
pŞicy
, (*)
os
, 
ocÚ_¡©e_g‘_cur
,

97 
ocÚ_¡©e_Ãxt
, 
ocÚ_¡©e_’d
, 
ocÚ_¡©e_size
, 
ä“
, 
™”
)) {

98 
	`ä“
(
os
);

99  
STATUS_ERR
;

102  
STATUS_SUCCESS
;

103 
	}
}

105 
	$qpŞ_fs_u£_g‘_Çme
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_fs_u£_t
 * 
ocÚ
, cÚ¡ **
Çme
)

107 
ocÚ‹xt_t
 *
š‹º®_ocÚ
 = 
NULL
;

109 ià(
Çme
 !ğ
NULL
)

110 *
Çme
 = 
NULL
;

112 ià(
pŞicy
 =ğ
NULL
 || 
ocÚ
 =ğNULL || 
Çme
 == NULL) {

113 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

114 
”ºo
 = 
EINVAL
;

115  
STATUS_ERR
;

118 
š‹º®_ocÚ
 = (
ocÚ‹xt_t
 *è
ocÚ
;

119 *
Çme
 = 
š‹º®_ocÚ
->
u
.name;

121  
STATUS_SUCCESS
;

122 
	}
}

124 
	$qpŞ_fs_u£_g‘_behaviÜ
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_fs_u£_t
 * 
ocÚ
, 
ušt32_t
 * 
behaviÜ
)

126 
ocÚ‹xt_t
 *
š‹º®_ocÚ
 = 
NULL
;

128 ià(
behaviÜ
 !ğ
NULL
)

129 *
behaviÜ
 = 0;

131 ià(
pŞicy
 =ğ
NULL
 || 
ocÚ
 =ğNULL || 
behaviÜ
 == NULL) {

132 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

133 
”ºo
 = 
EINVAL
;

134  
STATUS_ERR
;

137 
š‹º®_ocÚ
 = (
ocÚ‹xt_t
 *è
ocÚ
;

138 *
behaviÜ
 = 
š‹º®_ocÚ
->
v
.behavior;

140  
STATUS_SUCCESS
;

141 
	}
}

143 
	$qpŞ_fs_u£_g‘_cÚ‹xt
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_fs_u£_t
 * 
ocÚ
, cÚ¡ 
qpŞ_cÚ‹xt_t
 ** 
cÚ‹xt
)

145 
ocÚ‹xt_t
 *
š‹º®_ocÚ
 = 
NULL
;

147 ià(
cÚ‹xt
 !ğ
NULL
)

148 *
cÚ‹xt
 = 
NULL
;

150 ià(
pŞicy
 =ğ
NULL
 || 
ocÚ
 =ğNULL || 
cÚ‹xt
 == NULL) {

151 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

152 
”ºo
 = 
EINVAL
;

153  
STATUS_ERR
;

156 
š‹º®_ocÚ
 = (
ocÚ‹xt_t
 *è
ocÚ
;

158 ià(
š‹º®_ocÚ
->
v
.
behaviÜ
 =ğ
QPOL_FS_USE_PSID
) {

159 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

160 
”ºo
 = 
EINVAL
;

161  
STATUS_ERR
;

164 *
cÚ‹xt
 = (
qpŞ_cÚ‹xt_t
 *è& (
š‹º®_ocÚ
->context[0]);

166  
STATUS_SUCCESS
;

167 
	}
}

	@libqpol/src/ftrule_query.c

25 
	~<qpŞ/™”©Ü.h
>

26 
	~<qpŞ/pŞicy.h
>

27 
	~<qpŞ/áruË_qu”y.h
>

28 
	~<¡dlib.h
>

29 
	~"™”©Ü_š‹º®.h
"

30 
	~"qpŞ_š‹º®.h
"

31 
	~<£pŞ/pŞicydb/pŞicydb.h
>

33 
	sf’ame_Œªs_¡©e


35 
f’ame_Œªs_t
 *
	mh—d
;

36 
f’ame_Œªs_t
 *
	mcur
;

37 } 
	tf’ame_Œªs_¡©e_t
;

39 
	$f’ame_Œªs_¡©e_’d
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

41 
f’ame_Œªs_¡©e_t
 *
ás
 = 
NULL
;

43 ià(!
™”
 || !(
ás
 = 
	`qpŞ_™”©Ü_¡©e
(iter))) {

44 
”ºo
 = 
EINVAL
;

45  
STATUS_ERR
;

48  
ás
->
cur
 ? 0 : 1;

49 
	}
}

51 *
	$f’ame_Œªs_¡©e_g‘_cur
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

53 
f’ame_Œªs_¡©e_t
 *
ás
 = 
NULL
;

54 cÚ¡ 
pŞicydb_t
 *
db
 = 
NULL
;

56 ià(!
™”
 || !(
ás
 = 
	`qpŞ_™”©Ü_¡©e
(™”)è|| !(
db
 = 
	`qpŞ_™”©Ü_pŞicy
(™”)è|| 
	`f’ame_Œªs_¡©e_’d
(iter)) {

57 
”ºo
 = 
EINVAL
;

58  
NULL
;

61  
ás
->
cur
;

62 
	}
}

64 
	$f’ame_Œªs_¡©e_Ãxt
(
qpŞ_™”©Ü_t
 * 
™”
)

66 
f’ame_Œªs_¡©e_t
 *
ás
 = 
NULL
;

67 cÚ¡ 
pŞicydb_t
 *
db
 = 
NULL
;

69 ià(!
™”
 || !(
ás
 = 
	`qpŞ_™”©Ü_¡©e
(™”)è|| !(
db
 = 
	`qpŞ_™”©Ü_pŞicy
(iter))) {

70 
”ºo
 = 
EINVAL
;

71  
STATUS_ERR
;

74 ià(
	`f’ame_Œªs_¡©e_’d
(
™”
)) {

75 
”ºo
 = 
ERANGE
;

76  
STATUS_ERR
;

79 
ás
->
cur
 = fts->cur->
Ãxt
;

81  
STATUS_SUCCESS
;

82 
	}
}

84 
size_t
 
	$f’ame_Œªs_¡©e_size
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

86 
f’ame_Œªs_¡©e_t
 *
ás
 = 
NULL
;

87 cÚ¡ 
pŞicydb_t
 *
db
 = 
NULL
;

88 
f’ame_Œªs_t
 *
tmp
 = 
NULL
;

89 
size_t
 
couÁ
 = 0;

91 ià(!
™”
 || !(
ás
 = 
	`qpŞ_™”©Ü_¡©e
(™”)è|| !(
db
 = 
	`qpŞ_™”©Ü_pŞicy
(iter))) {

92 
”ºo
 = 
EINVAL
;

93  
STATUS_ERR
;

96 
tmp
 = 
ás
->
h—d
;mp;m°ğtmp->
Ãxt
)

97 
couÁ
++;

99  
couÁ
;

100 
	}
}

102 
	$qpŞ_pŞicy_g‘_f’ame_Œªs_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, 
qpŞ_™”©Ü_t
 ** 
™”
)

104 
pŞicydb_t
 *
db
 = 
NULL
;

105 
f’ame_Œªs_¡©e_t
 *
ás
 = 
NULL
;

106 
”rÜ
 = 0;

108 ià(
™”
)

109 *
™”
 = 
NULL
;

111 ià(!
pŞicy
 || !
™”
) {

112 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

113 
”ºo
 = 
EINVAL
;

114  
STATUS_ERR
;

117 
db
 = &
pŞicy
->
p
->p;

119 
ás
 = 
	`ÿÎoc
(1, (
f’ame_Œªs_¡©e_t
));

120 ià(!
ás
) {

122 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”ºo
));

123  
STATUS_ERR
;

125 
ás
->
h—d
 = fts->
cur
 = 
db
->
f’ame_Œªs
;

127 ià(
qpŞ_™”©Ü_ü—‹


128 (
pŞicy
, (*)
ás
, 
f’ame_Œªs_¡©e_g‘_cur
, 
f’ame_Œªs_¡©e_Ãxt
, 
f’ame_Œªs_¡©e_’d
, 
f’ame_Œªs_¡©e_size
,

129 
ä“
, 
™”
)) {

130 
”rÜ
 = 
”ºo
;

131 
	`ä“
(
ás
);

132 
”ºo
 = 
”rÜ
;

133  
STATUS_ERR
;

136  
STATUS_SUCCESS
;

137 
	}
}

139 
	$qpŞ_f’ame_Œªs_g‘_sourû_ty³
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_f’ame_Œªs_t
 * 
ruË
, cÚ¡ 
qpŞ_ty³_t
 ** 
sourû
)

141 
pŞicydb_t
 *
db
 = 
NULL
;

142 
f’ame_Œªs_t
 *
á
 = 
NULL
;

144 ià(
sourû
) {

145 *
sourû
 = 
NULL
;

148 ià(!
pŞicy
 || !
ruË
 || !
sourû
) {

149 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

150 
”ºo
 = 
EINVAL
;

151  
STATUS_ERR
;

154 
db
 = &
pŞicy
->
p
->p;

155 
á
 = (
f’ame_Œªs_t
 *è
ruË
;

157 *
sourû
 = (
qpŞ_ty³_t
 *è
db
->
ty³_v®_to_¡ruù
[
á
->
¡y³
 - 1];

159  
STATUS_SUCCESS
;

160 
	}
}

162 
	$qpŞ_f’ame_Œªs_g‘_rg‘_ty³
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_f’ame_Œªs_t
 * 
ruË
, cÚ¡ 
qpŞ_ty³_t
 ** 
rg‘
)

164 
pŞicydb_t
 *
db
 = 
NULL
;

165 
f’ame_Œªs_t
 *
á
 = 
NULL
;

167 ià(
rg‘
) {

168 *
rg‘
 = 
NULL
;

171 ià(!
pŞicy
 || !
ruË
 || !
rg‘
) {

172 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

173 
”ºo
 = 
EINVAL
;

174  
STATUS_ERR
;

177 
db
 = &
pŞicy
->
p
->p;

178 
á
 = (
f’ame_Œªs_t
 *è
ruË
;

180 *
rg‘
 = (
qpŞ_ty³_t
 *è
db
->
ty³_v®_to_¡ruù
[
á
->
‰y³
 - 1];

182  
STATUS_SUCCESS
;

183 
	}
}

185 
	$qpŞ_f’ame_Œªs_g‘_objeù_şass
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_f’ame_Œªs_t
 * 
ruË
,

186 cÚ¡ 
qpŞ_şass_t
 ** 
obj_şass
)

188 
pŞicydb_t
 *
db
 = 
NULL
;

189 
f’ame_Œªs_t
 *
á
 = 
NULL
;

191 ià(
obj_şass
) {

192 *
obj_şass
 = 
NULL
;

195 ià(!
pŞicy
 || !
ruË
 || !
obj_şass
) {

196 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

197 
”ºo
 = 
EINVAL
;

198  
STATUS_ERR
;

201 
db
 = &
pŞicy
->
p
->p;

202 
á
 = (
f’ame_Œªs_t
 *è
ruË
;

204 *
obj_şass
 = (
qpŞ_şass_t
 *è
db
->
şass_v®_to_¡ruù
[
á
->
tşass
 - 1];

206  
STATUS_SUCCESS
;

207 
	}
}

209 
	$qpŞ_f’ame_Œªs_g‘_deçuÉ_ty³
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_f’ame_Œªs_t
 * 
ruË
, cÚ¡ 
qpŞ_ty³_t
 ** 
dæt
)

211 
pŞicydb_t
 *
db
 = 
NULL
;

212 
f’ame_Œªs_t
 *
á
 = 
NULL
;

214 ià(
dæt
) {

215 *
dæt
 = 
NULL
;

218 ià(!
pŞicy
 || !
ruË
 || !
dæt
) {

219 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

220 
”ºo
 = 
EINVAL
;

221  
STATUS_ERR
;

224 
db
 = &
pŞicy
->
p
->p;

225 
á
 = (
f’ame_Œªs_t
 *è
ruË
;

227 *
dæt
 = (
qpŞ_ty³_t
 *è
db
->
ty³_v®_to_¡ruù
[
á
->
Ùy³
 - 1];

229  
STATUS_SUCCESS
;

230 
	}
}

232 
	$qpŞ_f’ame_Œªs_g‘_f’ame
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_f’ame_Œªs_t
 * 
ruË
, cÚ¡ ** 
Çme
)

234 
f’ame_Œªs_t
 *
á
 = 
NULL
;

236 ià(
Çme
) {

237 *
Çme
 = 
NULL
;

240 ià(!
pŞicy
 || !
ruË
 || !
Çme
) {

241 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

242 
”ºo
 = 
EINVAL
;

243  
STATUS_ERR
;

246 
á
 = (
f’ame_Œªs_t
 *è
ruË
;

248 *
Çme
 = 
á
->name;

250  
STATUS_SUCCESS
;

251 
	}
}

	@libqpol/src/genfscon_query.c

26 
	~<¡ddef.h
>

27 
	~<¡dlib.h
>

28 
	~<¡dšt.h
>

29 
	~<qpŞ/™”©Ü.h
>

30 
	~<qpŞ/pŞicy.h
>

31 
	~<qpŞ/cÚ‹xt_qu”y.h
>

32 
	~<qpŞ/g’fscÚ_qu”y.h
>

33 
	~<£pŞ/pŞicydb/pŞicydb.h
>

34 
	~"qpŞ_š‹º®.h
"

35 
	~"™”©Ü_š‹º®.h
"

37 
	sqpŞ_g’fscÚ


39 cÚ¡ *
	mfs_Çme
;

40 cÚ¡ *
	m·th
;

41 cÚ¡ 
cÚ‹xt_¡ruù_t
 *
	mcÚ‹xt
;

42 
ušt32_t
 
	msşass
;

45 
	$qpŞ_pŞicy_g‘_g’fscÚ_by_Çme
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ *
Çme
, cÚ¡ *
·th
, 
qpŞ_g’fscÚ_t
 ** 
g’fscÚ
)

47 
g’fs_t
 *
tmp
 = 
NULL
;

48 
ocÚ‹xt_t
 *
tmp2
 = 
NULL
;

49 
pŞicydb_t
 *
db
 = 
NULL
;

50 
”rÜ
 = 0;

52 ià(
g’fscÚ
 !ğ
NULL
)

53 *
g’fscÚ
 = 
NULL
;

55 ià(
pŞicy
 =ğ
NULL
 || 
Çme
 =ğNULL || 
·th
 =ğNULL || 
g’fscÚ
 == NULL) {

56 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

57 
”ºo
 = 
EINVAL
;

58  
STATUS_ERR
;

61 
db
 = &
pŞicy
->
p
->p;

62 
tmp
 = 
db
->
g’fs
;mp;m°ğtmp->
Ãxt
) {

63 ià(!
	`¡rcmp
(
Çme
, 
tmp
->
f¡y³
))

67 ià(
tmp
) {

68 
tmp2
 = 
tmp
->
h—d
;mp2;mp2 =mp2->
Ãxt
) {

69 ià(!
	`¡rcmp
(
·th
, 
tmp2
->
u
.
Çme
))

74 ià(
tmp
 && 
tmp2
) {

75 *
g’fscÚ
 = 
	`ÿÎoc
(1, (
qpŞ_g’fscÚ_t
));

76 ià(!(*
g’fscÚ
)) {

77 
”rÜ
 = 
”ºo
;

78 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

79 
”ºo
 =ƒrrno;

80  
STATUS_ERR
;

83 (*
g’fscÚ
)->
fs_Çme
 = 
tmp
->
f¡y³
;

84 (*
g’fscÚ
)->
·th
 = 
tmp2
->
u
.
Çme
;

85 (*
g’fscÚ
)->
cÚ‹xt
 = &(
tmp2
->context[0]);

86 (*
g’fscÚ
)->
sşass
 = 
tmp2
->
v
.sclass;

89 ià(*
g’fscÚ
 =ğ
NULL
) {

90 
	`ERR
(
pŞicy
, "could‚Ù fšd g’fscÚ s‹m’ˆfÜ % %s", 
Çme
, 
·th
);

91 
”ºo
 = 
ENOENT
;

92  
STATUS_ERR
;

95  
STATUS_SUCCESS
;

96 
	}
}

98 
	sg’fs_¡©e


100 
g’fs_t
 *
	mh—d
;

101 
g’fs_t
 *
	mcur
;

102 
ocÚ‹xt_t
 *
	mcur_·th
;

103 } 
	tg’fs_¡©e_t
;

105 
	$g’fs_¡©e_’d
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

107 
g’fs_¡©e_t
 *
gs
 = 
NULL
;

109 ià(
™”
 =ğ
NULL
 || 
	`qpŞ_™”©Ü_¡©e
(iter) == NULL) {

110 
”ºo
 = 
EINVAL
;

111  
STATUS_ERR
;

114 
gs
 = (
g’fs_¡©e_t
 *è
	`qpŞ_™”©Ü_¡©e
(
™”
);

116 ià(
gs
->
cur
 =ğ
NULL
 && gs->
cur_·th
 == NULL)

120 
	}
}

122 *
	$g’fs_¡©e_g‘_cur
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

124 
g’fs_¡©e_t
 *
gs
 = 
NULL
;

125 
qpŞ_g’fscÚ_t
 *
g’fscÚ
 = 
NULL
;

127 ià(
™”
 =ğ
NULL
 || 
	`qpŞ_™”©Ü_¡©e
(™”è=ğNULL || 
	`g’fs_¡©e_’d
(iter)) {

128 
”ºo
 = 
EINVAL
;

129  
NULL
;

132 
gs
 = (
g’fs_¡©e_t
 *è
	`qpŞ_™”©Ü_¡©e
(
™”
);

134 
g’fscÚ
 = 
	`ÿÎoc
(1, (
qpŞ_g’fscÚ_t
));

135 ià(!
g’fscÚ
) {

136  
NULL
;

139 
g’fscÚ
->
fs_Çme
 = 
gs
->
cur
->
f¡y³
;

140 
g’fscÚ
->
·th
 = 
gs
->
cur_·th
->
u
.
Çme
;

141 
g’fscÚ
->
cÚ‹xt
 = &(
gs
->
cur_·th
->context[0]);

142 
g’fscÚ
->
sşass
 = 
gs
->
cur_·th
->
v
.sclass;

144  
g’fscÚ
;

145 
	}
}

147 
size_t
 
	$g’fs_¡©e_size
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

149 
g’fs_¡©e_t
 *
gs
 = 
NULL
;

150 
size_t
 
couÁ
 = 0;

151 
g’fs_t
 *
g’fs
 = 
NULL
;

152 
ocÚ‹xt_t
 *
·th
 = 
NULL
;

154 ià(
™”
 =ğ
NULL
 || 
	`qpŞ_™”©Ü_¡©e
(iter) == NULL) {

155 
”ºo
 = 
EINVAL
;

159 
gs
 = (
g’fs_¡©e_t
 *è
	`qpŞ_™”©Ü_¡©e
(
™”
);

161 
g’fs
 = 
gs
->
h—d
; g’fs; g’f ğg’fs->
Ãxt
)

162 
·th
 = 
g’fs
->
h—d
;…©h;…©h =…©h->
Ãxt
)

163 
couÁ
++;

165  
couÁ
;

166 
	}
}

168 
	$g’fs_¡©e_Ãxt
(
qpŞ_™”©Ü_t
 * 
™”
)

170 
g’fs_¡©e_t
 *
gs
 = 
NULL
;

172 ià(
™”
 =ğ
NULL
 || 
	`qpŞ_™”©Ü_¡©e
(iter) == NULL) {

173 
”ºo
 = 
EINVAL
;

174  
STATUS_ERR
;

177 
gs
 = (
g’fs_¡©e_t
 *è
	`qpŞ_™”©Ü_¡©e
(
™”
);

179 ià(
gs
->
cur
 =ğ
NULL
) {

180 
”ºo
 = 
ERANGE
;

181  
STATUS_ERR
;

184 ià(
gs
->
cur_·th
->
Ãxt
 !ğ
NULL
) {

185 
gs
->
cur_·th
 = gs->cur_·th->
Ãxt
;

187 
gs
->
cur
 = gs->cur->
Ãxt
;

188 
gs
->
cur_·th
 = gs->
cur
 ? gs->cur->
h—d
 : 
NULL
;

191  
STATUS_SUCCESS
;

192 
	}
}

194 
	$qpŞ_pŞicy_g‘_g’fscÚ_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, 
qpŞ_™”©Ü_t
 ** 
™”
)

196 
pŞicydb_t
 *
db
 = 
NULL
;

197 
g’fs_¡©e_t
 *
gs
 = 
NULL
;

198 
”rÜ
 = 0;

200 ià(
™”
 !ğ
NULL
)

201 *
™”
 = 
NULL
;

203 ià(
pŞicy
 =ğ
NULL
 || 
™”
 == NULL) {

204 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

205 
”ºo
 = 
EINVAL
;

206  
STATUS_ERR
;

209 
db
 = &
pŞicy
->
p
->p;

211 
gs
 = 
	`ÿÎoc
(1, (
g’fs_¡©e_t
));

212 ià(
gs
 =ğ
NULL
) {

213 
”rÜ
 = 
”ºo
;

214 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

215 
”ºo
 = 
”rÜ
;

216  
STATUS_ERR
;

219 
gs
->
h—d
 = gs->
cur
 = 
db
->
g’fs
;

220 ià(
gs
->
h—d
)

221 
gs
->
cur_·th
 = gs->
h—d
->head;

223 ià(
	`qpŞ_™”©Ü_ü—‹
(
pŞicy
, (*)
gs
, 
g’fs_¡©e_g‘_cur
,

224 
g’fs_¡©e_Ãxt
, 
g’fs_¡©e_’d
, 
g’fs_¡©e_size
, 
ä“
, 
™”
)) {

225 
	`ä“
(
gs
);

226  
STATUS_ERR
;

229  
STATUS_SUCCESS
;

230 
	}
}

232 
	$qpŞ_g’fscÚ_g‘_Çme
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_g’fscÚ_t
 * 
g’fs
, cÚ¡ **
Çme
)

234 ià(
Çme
 !ğ
NULL
)

235 *
Çme
 = 
NULL
;

237 ià(
pŞicy
 =ğ
NULL
 || 
g’fs
 =ğNULL || 
Çme
 == NULL) {

238 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

239 
”ºo
 = 
EINVAL
;

240  
STATUS_ERR
;

243 *
Çme
 = 
g’fs
->
fs_Çme
;

245  
STATUS_SUCCESS
;

246 
	}
}

248 
	$qpŞ_g’fscÚ_g‘_·th
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_g’fscÚ_t
 * 
g’fs
, cÚ¡ **
·th
)

250 ià(
·th
 !ğ
NULL
)

251 *
·th
 = 
NULL
;

253 ià(
pŞicy
 =ğ
NULL
 || 
g’fs
 =ğNULL || 
·th
 == NULL) {

254 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

255 
”ºo
 = 
EINVAL
;

256  
STATUS_ERR
;

259 *
·th
 = 
g’fs
->path;

261  
STATUS_SUCCESS
;

262 
	}
}

264 
	$qpŞ_g’fscÚ_g‘_şass
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_g’fscÚ_t
 * 
g’fs
, 
ušt32_t
 * 
obj_şass
)

266 ià(
obj_şass
 !ğ
NULL
)

267 *
obj_şass
 = 0;

269 ià(
pŞicy
 =ğ
NULL
 || 
g’fs
 =ğNULL || 
obj_şass
 == NULL) {

270 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

271 
”ºo
 = 
EINVAL
;

272  
STATUS_ERR
;

275 *
obj_şass
 = 
g’fs
->
sşass
;

277  
STATUS_SUCCESS
;

278 
	}
}

280 
	$qpŞ_g’fscÚ_g‘_cÚ‹xt
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_g’fscÚ_t
 * 
g’fscÚ
, cÚ¡ 
qpŞ_cÚ‹xt_t
 ** 
cÚ‹xt
)

282 ià(
cÚ‹xt
 !ğ
NULL
)

283 *
cÚ‹xt
 = 
NULL
;

285 ià(
pŞicy
 =ğ
NULL
 || 
g’fscÚ
 =ğNULL || 
cÚ‹xt
 == NULL) {

286 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

287 
”ºo
 = 
EINVAL
;

288  
STATUS_ERR
;

291 *
cÚ‹xt
 = (
qpŞ_cÚ‹xt_t
 *è
g’fscÚ
->context;

293  
STATUS_SUCCESS
;

294 
	}
}

	@libqpol/src/isid_query.c

26 
	~<¡ddef.h
>

27 
	~<¡dlib.h
>

28 
	~<¡dšt.h
>

29 
	~<qpŞ/™”©Ü.h
>

30 
	~<qpŞ/pŞicy.h
>

31 
	~<qpŞ/cÚ‹xt_qu”y.h
>

32 
	~<qpŞ/isid_qu”y.h
>

33 
	~<£pŞ/pŞicydb/pŞicydb.h
>

34 
	~"qpŞ_š‹º®.h
"

35 
	~"™”©Ü_š‹º®.h
"

37 
	$qpŞ_pŞicy_g‘_isid_by_Çme
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ *
Çme
, cÚ¡ 
qpŞ_isid_t
 ** 
ocÚ
)

39 
ocÚ‹xt_t
 *
tmp
 = 
NULL
;

40 
pŞicydb_t
 *
db
 = 
NULL
;

42 ià(
ocÚ
 !ğ
NULL
)

43 *
ocÚ
 = 
NULL
;

45 ià(
pŞicy
 =ğ
NULL
 || 
Çme
 =ğNULL || 
ocÚ
 == NULL) {

46 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

47 
”ºo
 = 
EINVAL
;

48  
STATUS_ERR
;

51 
db
 = &
pŞicy
->
p
->p;

52 
tmp
 = 
db
->
ocÚ‹xts
[
OCON_ISID
];mp;m°ğtmp->
Ãxt
) {

53 ià(!
	`¡rcmp
(
Çme
, 
tmp
->
u
.name))

57 *
ocÚ
 = (
qpŞ_isid_t
 *è
tmp
;

59 ià(*
ocÚ
 =ğ
NULL
) {

60 
	`ERR
(
pŞicy
, "could‚Ù fšd in™ŸÈSID s‹m’ˆfÜ %s", 
Çme
);

61 
”ºo
 = 
ENOENT
;

62  
STATUS_ERR
;

65  
STATUS_SUCCESS
;

66 
	}
}

68 
	$qpŞ_pŞicy_g‘_isid_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, 
qpŞ_™”©Ü_t
 ** 
™”
)

70 
pŞicydb_t
 *
db
 = 
NULL
;

71 
ocÚ_¡©e_t
 *
os
 = 
NULL
;

72 
”rÜ
 = 0;

74 ià(
™”
 !ğ
NULL
)

75 *
™”
 = 
NULL
;

77 ià(
pŞicy
 =ğ
NULL
 || 
™”
 == NULL) {

78 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

79 
”ºo
 = 
EINVAL
;

80  
STATUS_ERR
;

83 
db
 = &
pŞicy
->
p
->p;

85 
os
 = 
	`ÿÎoc
(1, (
ocÚ_¡©e_t
));

86 ià(
os
 =ğ
NULL
) {

87 
”rÜ
 = 
”ºo
;

88 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

89 
”ºo
 = 
”rÜ
;

90  
STATUS_ERR
;

93 
os
->
h—d
 = os->
cur
 = 
db
->
ocÚ‹xts
[
OCON_ISID
];

95 ià(
	`qpŞ_™”©Ü_ü—‹
(
pŞicy
, (*)
os
, 
ocÚ_¡©e_g‘_cur
,

96 
ocÚ_¡©e_Ãxt
, 
ocÚ_¡©e_’d
, 
ocÚ_¡©e_size
, 
ä“
, 
™”
)) {

97 
	`ä“
(
os
);

98  
STATUS_ERR
;

100  
STATUS_SUCCESS
;

101 
	}
}

103 
	$qpŞ_isid_g‘_Çme
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_isid_t
 * 
ocÚ
, cÚ¡ **
Çme
)

105 
ocÚ‹xt_t
 *
š‹º®_ocÚ
 = 
NULL
;

107 ià(
Çme
 !ğ
NULL
)

108 *
Çme
 = 
NULL
;

110 ià(
pŞicy
 =ğ
NULL
 || 
ocÚ
 =ğNULL || 
Çme
 == NULL) {

111 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

112 
”ºo
 = 
EINVAL
;

113  
STATUS_ERR
;

116 
š‹º®_ocÚ
 = (
ocÚ‹xt_t
 *è
ocÚ
;

117 *
Çme
 = 
š‹º®_ocÚ
->
u
.name;

119  
STATUS_SUCCESS
;

120 
	}
}

122 
	$qpŞ_isid_g‘_cÚ‹xt
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_isid_t
 * 
ocÚ
, cÚ¡ 
qpŞ_cÚ‹xt_t
 ** 
cÚ‹xt
)

124 
ocÚ‹xt_t
 *
š‹º®_ocÚ
 = 
NULL
;

126 ià(
cÚ‹xt
 !ğ
NULL
)

127 *
cÚ‹xt
 = 
NULL
;

129 ià(
pŞicy
 =ğ
NULL
 || 
ocÚ
 =ğNULL || 
cÚ‹xt
 == NULL) {

130 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

131 
”ºo
 = 
EINVAL
;

132  
STATUS_ERR
;

135 
š‹º®_ocÚ
 = (
ocÚ‹xt_t
 *è
ocÚ
;

136 *
cÚ‹xt
 = (
qpŞ_cÚ‹xt_t
 *è& (
š‹º®_ocÚ
->context[0]);

138  
STATUS_SUCCESS
;

139 
	}
}

	@libqpol/src/iterator.c

28 
	~<cÚfig.h
>

30 
	~<qpŞ/™”©Ü.h
>

31 
	~<qpŞ/pŞicy.h
>

32 
	~<qpŞ/mls_qu”y.h
>

34 
	~<¡dlib.h
>

35 
	~<”ºo.h
>

36 
	~<¡ršg.h
>

38 
	~<£pŞ/pŞicydb/pŞicydb.h
>

39 
	~<£pŞ/pŞicydb/pŞÿps.h
>

40 
	~<£pŞ/pŞicydb/ut.h
>

41 
	~<£pŞ/pŞicydb.h
>

43 
	~"qpŞ_š‹º®.h
"

44 
	~"™”©Ü_š‹º®.h
"

51 
	sqpŞ_™”©Ü


53 
pŞicydb_t
 *
	mpŞicy
;

54 *
	m¡©e
;

55 *(*
	mg‘_cur
è(cÚ¡ 
qpŞ_™”©Ü_t
 * 
	m™”
);

56 (*
	mÃxt
è(
qpŞ_™”©Ü_t
 * 
	m™”
);

57 (*
	m’d
è(cÚ¡ 
qpŞ_™”©Ü_t
 * 
	m™”
);

58 
size_t
(*
size
è(cÚ¡ 
qpŞ_™”©Ü_t
 * 
	m™”
);

59 (*
	mä“_â
è(*
	mx
);

67 
ušt32_t
 
	$™”©Ü_g‘_avb_size
(cÚ¡ 
avb_t
 * 
avb
)

69 #ifdeà
SEPOL_DYNAMIC_AVTAB


70  
avb
->
n¦Ù
;

72  
AVTAB_SIZE
;

74 
	}
}

76 
qpŞ_™”©Ü_ü—‹
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, *
¡©e
,

77 *(*
g‘_cur
è(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
),

78 (*
Ãxt
è(
qpŞ_™”©Ü_t
 * 
™”
),

79 (*
’d
è(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
),

80 
	$size_t
(*
size
è(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
), (*
ä“_â
è(*
x
), qpol_iterator_t ** iter)

82 
”rÜ
 = 0;

84 ià(
™”
 !ğ
NULL
)

85 *
™”
 = 
NULL
;

87 ià(
pŞicy
 =ğ
NULL
 || 
¡©e
 =ğNULL || 
™”
 =ğNULL || 
g‘_cur
 =ğNULL || 
Ãxt
 =ğNULL || 
’d
 =ğNULL || 
size
 == NULL) {

88 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

89 
”ºo
 = 
EINVAL
;

90  
STATUS_ERR
;

93 *
™”
 = 
	`ÿÎoc
(1, (
qpŞ_™”©Ü
));

94 ià(*
™”
 =ğ
NULL
) {

95 
”rÜ
 = 
”ºo
;

96 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

97 
”ºo
 = 
”rÜ
;

98  
STATUS_ERR
;

101 (*
™”
)->
pŞicy
 = &pŞicy->
p
->p;

102 (*
™”
)->
¡©e
 = state;

103 (*
™”
)->
g‘_cur
 = get_cur;

104 (*
™”
)->
Ãxt
 =‚ext;

105 (*
™”
)->
’d
 =ƒnd;

106 (*
™”
)->
size
 = size;

107 (*
™”
)->
ä“_â
 = free_fn;

109  
STATUS_SUCCESS
;

110 
	}
}

112 *
	$qpŞ_™”©Ü_¡©e
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

114 ià(
™”
 =ğ
NULL
 || i‹r->
¡©e
 == NULL) {

115 
”ºo
 = 
EINVAL
;

116  
NULL
;

119  
™”
->
¡©e
;

120 
	}
}

122 cÚ¡ 
pŞicydb_t
 *
	$qpŞ_™”©Ü_pŞicy
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

124 ià(
™”
 =ğ
NULL
 || i‹r->
pŞicy
 == NULL) {

125 
”ºo
 = 
EINVAL
;

126  
NULL
;

129  
™”
->
pŞicy
;

130 
	}
}

132 *
	$hash_¡©e_g‘_cur
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

134 
hash_¡©e_t
 *
hs
 = 
NULL
;

136 ià(
™”
 =ğ
NULL
 || i‹r->
¡©e
 =ğNULL || 
	`hash_¡©e_’d
(iter)) {

137 
”ºo
 = 
EINVAL
;

138  
NULL
;

141 
hs
 = (
hash_¡©e_t
 *è
™”
->
¡©e
;

143  
hs
->
node
->
d©um
;

144 
	}
}

146 *
	$hash_¡©e_g‘_cur_key
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

148 
hash_¡©e_t
 *
hs
 = 
NULL
;

150 ià(
™”
 =ğ
NULL
 || i‹r->
¡©e
 =ğNULL || 
	`hash_¡©e_’d
(iter)) {

151 
”ºo
 = 
EINVAL
;

152  
NULL
;

155 
hs
 = (
hash_¡©e_t
 *è
™”
->
¡©e
;

157  
hs
->
node
->
key
;

158 
	}
}

160 *
	$ocÚ_¡©e_g‘_cur
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

162 
ocÚ_¡©e_t
 *
os
 = 
NULL
;

164 ià(
™”
 =ğ
NULL
 || i‹r->
¡©e
 =ğNULL || 
	`ocÚ_¡©e_’d
(iter)) {

165 
”ºo
 = 
EINVAL
;

166  
NULL
;

169 
os
 = (
ocÚ_¡©e_t
 *è
™”
->
¡©e
;

171  
os
->
cur
;

172 
	}
}

174 *
	$avb_¡©e_g‘_cur
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

176 
avb_¡©e_t
 *
¡©e
;

178 ià(
™”
 =ğ
NULL
 || i‹r->
¡©e
 =ğNULL || 
	`avb_¡©e_’d
(iter)) {

179 
”ºo
 = 
EINVAL
;

180  
NULL
;

182 
¡©e
 = (
avb_¡©e_t
 *è
™”
->state;

183  
¡©e
->
node
;

184 
	}
}

186 
	$hash_¡©e_Ãxt
(
qpŞ_™”©Ü_t
 * 
™”
)

188 
hash_¡©e_t
 *
hs
 = 
NULL
;

190 ià(
™”
 =ğ
NULL
 || i‹r->
¡©e
 == NULL) {

191 
”ºo
 = 
EINVAL
;

192  
STATUS_ERR
;

195 
hs
 = (
hash_¡©e_t
 *è
™”
->
¡©e
;

197 ià(
hs
->
bË
 =ğ
NULL
 || *(hs->bËè=ğNULL || hs->
buck‘
 >ğ(*(hs->bË))->
size
) {

198 
”ºo
 = 
ERANGE
;

199  
STATUS_ERR
;

202 ià(
hs
->
node
 !ğ
NULL
 && hs->node->
Ãxt
 != NULL) {

203 
hs
->
node
 = hs->node->
Ãxt
;

206 
hs
->
buck‘
++;

207 ià(
hs
->
buck‘
 < (*(hs->
bË
))->
size
) {

208 
hs
->
node
 = (*(hs->
bË
))->
hbË
[hs->
buck‘
];

210 
hs
->
node
 = 
NULL
;

212 } 
hs
->
buck‘
 < (*(hs->
bË
))->
size
 && hs->
node
 =ğ
NULL
);

215  
STATUS_SUCCESS
;

216 
	}
}

218 
	$eb™m­_¡©e_Ãxt
(
qpŞ_™”©Ü_t
 * 
™”
)

220 
eb™m­_¡©e_t
 *
es
 = 
NULL
;

222 ià(
™”
 =ğ
NULL
 || i‹r->
¡©e
 == NULL) {

223 
”ºo
 = 
EINVAL
;

224  
STATUS_ERR
;

227 
es
 = (
eb™m­_¡©e_t
 *è
™”
->
¡©e
;

229 ià(
es
->
cur
 >ğes->
bm­
->
highb™
) {

230 
”ºo
 = 
ERANGE
;

231  
STATUS_ERR
;

235 
es
->
cur
++;

236 } 
es
->
cur
 <ƒs->
bm­
->
highb™
 && !
	`eb™m­_g‘_b™
(es->bmap,ƒs->cur));

238  
STATUS_SUCCESS
;

239 
	}
}

241 
	$ocÚ_¡©e_Ãxt
(
qpŞ_™”©Ü_t
 * 
™”
)

243 
ocÚ_¡©e_t
 *
os
 = 
NULL
;

245 ià(
™”
 =ğ
NULL
 || i‹r->
¡©e
 == NULL) {

246 
”ºo
 = 
EINVAL
;

247  
STATUS_ERR
;

250 
os
 = (
ocÚ_¡©e_t
 *è
™”
->
¡©e
;

252 ià(
os
->
cur
 =ğ
NULL
) {

253 
”ºo
 = 
ERANGE
;

254  
STATUS_ERR
;

257 
os
->
cur
 = os->cur->
Ãxt
;

259  
STATUS_SUCCESS
;

260 
	}
}

262 
	$avb_¡©e_Ãxt
(
qpŞ_™”©Ü_t
 * 
™”
)

264 
avb_t
 *
avb
;

265 
avb_¡©e_t
 *
¡©e
;

267 ià(
™”
 =ğ
NULL
 || i‹r->
¡©e
 == NULL) {

268 
”ºo
 = 
EINVAL
;

269  
STATUS_ERR
;

272 
¡©e
 = 
™”
->state;

273 
avb
 = (
¡©e
->
which
 =ğ
QPOL_AVTAB_STATE_AV
 ? s‹->
ucÚd_b
 : s‹->
cÚd_b
);

275 ià((!
avb
->
hbË
 || 
¡©e
->
buck‘
 >ğ
	`™”©Ü_g‘_avb_size
×vb)è&& s‹->
which
 =ğ
QPOL_AVTAB_STATE_COND
) {

276 
”ºo
 = 
ERANGE
;

277  
STATUS_ERR
;

281 ià(
¡©e
->
node
 !ğ
NULL
 && s‹->node->
Ãxt
 != NULL) {

282 
¡©e
->
node
 = s‹->node->
Ãxt
;

286 
¡©e
->
buck‘
++;

287 ià(!
avb
->
hbË
 || 
¡©e
->
buck‘
 >ğ
	`™”©Ü_g‘_avb_size
(avtab)) {

288 ià(
¡©e
->
which
 =ğ
QPOL_AVTAB_STATE_AV
) {

289 
¡©e
->
buck‘
 = 0;

290 
avb
 = 
¡©e
->
cÚd_b
;

291 
¡©e
->
which
 = 
QPOL_AVTAB_STATE_COND
;

293 
¡©e
->
node
 = 
NULL
;

297 ià(
avb
->
hbË
 &&‡vb->hbË[
¡©e
->
buck‘
] !ğ
NULL
) {

298 
¡©e
->
node
 = 
avb
->
hbË
[¡©e->
buck‘
];

301 } 
avb
->
hbË
 && 
¡©e
->
buck‘
 < 
	`™”©Ü_g‘_avb_size
(avtab));

303 } 
avb
->
hbË
 && 
¡©e
->
buck‘
 < 
	`™”©Ü_g‘_avb_size
(avtab) &&

304 
¡©e
->
node
 ? !(¡©e->
ruË_ty³_mask
 & s‹->node->
key
.
¥ecif›d
) : 0);

306  
STATUS_SUCCESS
;

307 
	}
}

309 
	$hash_¡©e_’d
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

311 
hash_¡©e_t
 *
hs
 = 
NULL
;

313 ià(
™”
 =ğ
NULL
 || i‹r->
¡©e
 == NULL) {

314 
”ºo
 = 
EINVAL
;

315  
STATUS_ERR
;

318 
hs
 = (
hash_¡©e_t
 *è
™”
->
¡©e
;

320 ià(
hs
->
bË
 =ğ
NULL
 || *(hs->bËè=ğNULL || (*(hs->bË))->
Ãl
 =ğ0 || hs->
buck‘
 >ğ(*(hs->bË))->
size
)

324 
	}
}

326 
	$eb™m­_¡©e_’d
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

328 
eb™m­_¡©e_t
 *
es
 = 
NULL
;

330 ià(
™”
 =ğ
NULL
 || i‹r->
¡©e
 == NULL) {

331 
”ºo
 = 
EINVAL
;

332  
STATUS_ERR
;

335 
es
 = (
eb™m­_¡©e_t
 *è
™”
->
¡©e
;

337 ià(
es
->
cur
 >ğes->
bm­
->
highb™
)

341 
	}
}

343 
	$ocÚ_¡©e_’d
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

345 
ocÚ_¡©e_t
 *
os
 = 
NULL
;

347 ià(
™”
 =ğ
NULL
 || i‹r->
¡©e
 == NULL) {

348 
”ºo
 = 
EINVAL
;

349  
STATUS_ERR
;

352 
os
 = (
ocÚ_¡©e_t
 *è
™”
->
¡©e
;

354 ià(
os
->
cur
 =ğ
NULL
)

358 
	}
}

360 
	$avb_¡©e_’d
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

362 
avb_¡©e_t
 *
¡©e
;

363 
avb_t
 *
avb
;

365 ià(
™”
 =ğ
NULL
 || i‹r->
¡©e
 == NULL) {

366 
”ºo
 = 
EINVAL
;

367  
STATUS_ERR
;

369 
¡©e
 = 
™”
->state;

370 
avb
 = (
¡©e
->
which
 =ğ
QPOL_AVTAB_STATE_AV
 ? s‹->
ucÚd_b
 : s‹->
cÚd_b
);

371 ià((!
avb
->
hbË
 || 
¡©e
->
buck‘
 >ğ
	`™”©Ü_g‘_avb_size
×vb)è&& s‹->
which
 =ğ
QPOL_AVTAB_STATE_COND
)

374 
	}
}

376 
size_t
 
	$hash_¡©e_size
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

378 
hash_¡©e_t
 *
hs
 = 
NULL
;

380 ià(
™”
 =ğ
NULL
 || i‹r->
¡©e
 == NULL) {

381 
”ºo
 = 
EINVAL
;

385 
hs
 = (
hash_¡©e_t
 *è
™”
->
¡©e
;

387  (*(
hs
->
bË
))->
Ãl
;

388 
	}
}

390 
size_t
 
	$eb™m­_¡©e_size
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

392 
eb™m­_¡©e_t
 *
es
 = 
NULL
;

393 
size_t
 
couÁ
 = 0, 
b™
 = 0;

394 
eb™m­_node_t
 *
node
 = 
NULL
;

396 ià(
™”
 =ğ
NULL
 || i‹r->
¡©e
 == NULL) {

397 
”ºo
 = 
EINVAL
;

401 
es
 = (
eb™m­_¡©e_t
 *è
™”
->
¡©e
;

403 
	`eb™m­_fÜ_—ch_b™
(
es
->
bm­
, 
node
, 
b™
) {

404 
couÁ
 +ğ
	`eb™m­_g‘_b™
(
es
->
bm­
, 
b™
);

407  
couÁ
;

408 
	}
}

410 
size_t
 
	$ocÚ_¡©e_size
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

412 
ocÚ_¡©e_t
 *
os
 = 
NULL
;

413 
size_t
 
couÁ
 = 0;

414 
ocÚ‹xt_t
 *
ocÚ
 = 
NULL
;

416 ià(
™”
 =ğ
NULL
 || i‹r->
¡©e
 == NULL) {

417 
”ºo
 = 
EINVAL
;

421 
os
 = (
ocÚ_¡©e_t
 *è
™”
->
¡©e
;

423 
ocÚ
 = 
os
->
h—d
; ocÚ; ocÚ = ocÚ->
Ãxt
)

424 
couÁ
++;

426  
couÁ
;

427 
	}
}

429 
size_t
 
	$avb_¡©e_size
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

431 
avb_¡©e_t
 *
¡©e
;

432 
avb_t
 *
avb
;

433 
size_t
 
couÁ
 = 0;

434 
avb_±r_t
 
node
 = 
NULL
;

435 
ušt32_t
 
buck‘
 = 0;

437 ià(
™”
 =ğ
NULL
 || i‹r->
¡©e
 =ğNULL || i‹r->
pŞicy
 == NULL) {

438 
”ºo
 = 
EINVAL
;

439  
STATUS_ERR
;

442 
¡©e
 = 
™”
->state;

443 
avb
 = 
¡©e
->
ucÚd_b
;

445 
buck‘
 = 0; 
avb
->
hbË
 && buck‘ < 
	`™”©Ü_g‘_avb_size
(avtab); bucket++) {

446 
node
 = 
avb
->
hbË
[
buck‘
];‚ode;‚odğnode->
Ãxt
) {

447 ià(
node
->
key
.
¥ecif›d
 & 
¡©e
->
ruË_ty³_mask
)

448 
couÁ
++;

452 
avb
 = 
¡©e
->
cÚd_b
;

454 
buck‘
 = 0; 
avb
->
hbË
 && buck‘ < 
	`™”©Ü_g‘_avb_size
(avtab); bucket++) {

455 
node
 = 
avb
->
hbË
[
buck‘
];‚ode;‚odğnode->
Ãxt
) {

456 ià(
node
->
key
.
¥ecif›d
 & 
¡©e
->
ruË_ty³_mask
)

457 
couÁ
++;

461  
couÁ
;

462 
	}
}

464 
	$qpŞ_™”©Ü_de¡roy
(
qpŞ_™”©Ü_t
 ** 
™”
)

466 ià(
™”
 =ğ
NULL
 || *iter == NULL)

469 ià((*
™”
)->
ä“_â
)

470 (*
™”
)->
	`ä“_â
((*™”)->
¡©e
);

472 
	`ä“
(*
™”
);

473 *
™”
 = 
NULL
;

474 
	}
}

476 
	$qpŞ_™”©Ü_g‘_™em
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
, **
™em
)

478 ià(
™em
 !ğ
NULL
)

479 *
™em
 = 
NULL
;

481 ià(
™”
 =ğ
NULL
 || i‹r->
g‘_cur
 =ğNULL || 
™em
 == NULL) {

482 
”ºo
 = 
EINVAL
;

483  
STATUS_ERR
;

486 *
™em
 = 
™”
->
	`g‘_cur
(iter);

487 ià(*
™em
 =ğ
NULL
)

488  
STATUS_ERR
;

490  
STATUS_SUCCESS
;

491 
	}
}

493 
	$qpŞ_™”©Ü_Ãxt
(
qpŞ_™”©Ü_t
 * 
™”
)

495 ià(
™”
 =ğ
NULL
 || i‹r->
Ãxt
 == NULL) {

496 
”ºo
 = 
EINVAL
;

497  
STATUS_ERR
;

500  
™”
->
	`Ãxt
(iter);

501 
	}
}

503 
	$qpŞ_™”©Ü_’d
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

505 ià(
™”
 =ğ
NULL
 || i‹r->
’d
 == NULL) {

506 
”ºo
 = 
EINVAL
;

507  
STATUS_ERR
;

510  
™”
->
	`’d
(iter);

511 
	}
}

513 
	$qpŞ_™”©Ü_g‘_size
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
, 
size_t
 * 
size
)

515 ià(
size
 !ğ
NULL
)

516 *
size
 = 0;

518 ià(
™”
 =ğ
NULL
 || 
size
 == NULL || iter->size == NULL) {

519 
”ºo
 = 
EINVAL
;

520  
STATUS_ERR
;

523 *
size
 = 
™”
->
	`size
(iter);

525  
STATUS_SUCCESS
;

526 
	}
}

528 *
	$eb™m­_¡©e_g‘_cur_ty³
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

530 
eb™m­_¡©e_t
 *
es
 = 
NULL
;

531 cÚ¡ 
pŞicydb_t
 *
db
 = 
NULL
;

533 ià(
™”
 =ğ
NULL
) {

534 
”ºo
 = 
EINVAL
;

535  
NULL
;

537 
es
 = 
	`qpŞ_™”©Ü_¡©e
(
™”
);

538 ià(
es
 =ğ
NULL
) {

539 
”ºo
 = 
EINVAL
;

540  
NULL
;

542 
db
 = 
	`qpŞ_™”©Ü_pŞicy
(
™”
);

543 ià(
db
 =ğ
NULL
) {

544 
”ºo
 = 
EINVAL
;

545  
NULL
;

548  
db
->
ty³_v®_to_¡ruù
[
es
->
cur
];

549 
	}
}

551 *
	$eb™m­_¡©e_g‘_cur_rŞe
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

553 
eb™m­_¡©e_t
 *
es
 = 
NULL
;

554 cÚ¡ 
pŞicydb_t
 *
db
 = 
NULL
;

556 ià(
™”
 =ğ
NULL
) {

557 
”ºo
 = 
EINVAL
;

558  
NULL
;

560 
es
 = 
	`qpŞ_™”©Ü_¡©e
(
™”
);

561 ià(
es
 =ğ
NULL
) {

562 
”ºo
 = 
EINVAL
;

563  
NULL
;

565 
db
 = 
	`qpŞ_™”©Ü_pŞicy
(
™”
);

566 ià(
db
 =ğ
NULL
) {

567 
”ºo
 = 
EINVAL
;

568  
NULL
;

571  
db
->
rŞe_v®_to_¡ruù
[
es
->
cur
];

572 
	}
}

574 *
	$eb™m­_¡©e_g‘_cur_ÿt
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

576 
eb™m­_¡©e_t
 *
es
 = 
NULL
;

577 cÚ¡ 
pŞicydb_t
 *
db
 = 
NULL
;

578 cÚ¡ 
qpŞ_ÿt_t
 *
ÿt
 = 
NULL
;

579 
£pŞ_pŞicydb_t
 
¥
;

580 
qpŞ_pŞicy_t
 
qp
;

582 ià(
™”
 =ğ
NULL
) {

583 
”ºo
 = 
EINVAL
;

584  
NULL
;

586 
es
 = 
	`qpŞ_™”©Ü_¡©e
(
™”
);

587 ià(
es
 =ğ
NULL
) {

588 
”ºo
 = 
EINVAL
;

589  
NULL
;

591 
db
 = 
	`qpŞ_™”©Ü_pŞicy
(
™”
);

592 ià(
db
 =ğ
NULL
) {

593 
”ºo
 = 
EINVAL
;

594  
NULL
;

598 
¥
.
p
 = *
db
;

599 
qp
.
p
 = &
¥
;

600 
qp
.
â
 = 
NULL
;

602 
	`qpŞ_pŞicy_g‘_ÿt_by_Çme
(&
qp
, 
db
->
p_ÿt_v®_to_Çme
[
es
->
cur
], &
ÿt
);

607  (*)
ÿt
;

608 
	}
}

610 *
	$eb™m­_¡©e_g‘_cur_³rmissive
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

612 
eb™m­_¡©e_t
 *
es
 = 
NULL
;

613 cÚ¡ 
pŞicydb_t
 *
db
 = 
NULL
;

615 ià(
™”
 =ğ
NULL
) {

616 
”ºo
 = 
EINVAL
;

617  
NULL
;

619 
es
 = 
	`qpŞ_™”©Ü_¡©e
(
™”
);

620 ià(
es
 =ğ
NULL
) {

621 
”ºo
 = 
EINVAL
;

622  
NULL
;

624 
db
 = 
	`qpŞ_™”©Ü_pŞicy
(
™”
);

625 ià(
db
 =ğ
NULL
) {

626 
”ºo
 = 
EINVAL
;

627  
NULL
;

630  
db
->
ty³_v®_to_¡ruù
[
es
->
cur
 - 1];

631 
	}
}

633 *
	$eb™m­_¡©e_g‘_cur_pŞÿp
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

635 
eb™m­_¡©e_t
 *
es
 = 
NULL
;

636 cÚ¡ 
pŞicydb_t
 *
db
 = 
NULL
;

638 ià(
™”
 =ğ
NULL
) {

639 
”ºo
 = 
EINVAL
;

640  
NULL
;

642 
es
 = 
	`qpŞ_™”©Ü_¡©e
(
™”
);

643 ià(
es
 =ğ
NULL
) {

644 
”ºo
 = 
EINVAL
;

645  
NULL
;

647 
db
 = 
	`qpŞ_™”©Ü_pŞicy
(
™”
);

648 ià(
db
 =ğ
NULL
) {

649 
”ºo
 = 
EINVAL
;

650  
NULL
;

653  
	`£pŞ_pŞÿp_g‘Çme
(
es
->
cur
);

654 
	}
}

656 
	$eb™m­_¡©e_de¡roy
(*
es
)

658 
eb™m­_¡©e_t
 *
›s
 = (eb™m­_¡©e_ˆ*è
es
;

660 ià(!
es
)

663 
	`eb™m­_de¡roy
(
›s
->
bm­
);

664 
	`ä“
(
›s
->
bm­
);

665 
	`ä“
(
›s
);

666 
	}
}

668 
	$³rm_¡©e_’d
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

670 
³rm_¡©e_t
 *
ps
 = 
NULL
;

671 cÚ¡ 
pŞicydb_t
 *
db
 = 
NULL
;

672 
³rm_max
 = 0;

674 ià(
™”
 =ğ
NULL
 || (
ps
 = 
	`qpŞ_™”©Ü_¡©e
(™”)è=ğNULL || (
db
 = 
	`qpŞ_™”©Ü_pŞicy
(iter)) == NULL) {

675 
”ºo
 = 
EINVAL
;

676  
STATUS_ERR
;

681 
³rm_max
 = 
db
->
şass_v®_to_¡ruù
[
ps
->
obj_şass_v®
 - 1]->
³rmissiÚs
.
Årim
;

682 ià(
³rm_max
 > 32) {

683 
”ºo
 = 
EDOM
;

684  
STATUS_ERR
;

687 ià(!(
ps
->
³rm_£t
è||…s->
cur
 >ğ
³rm_max
)

691 
	}
}

693 *
	$³rm_¡©e_g‘_cur
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

695 cÚ¡ 
pŞicydb_t
 *
db
 = 
NULL
;

696 
şass_d©um_t
 *
obj_şass
 = 
NULL
;

697 
commÚ_d©um_t
 *
comm
 = 
NULL
;

698 
³rm_¡©e_t
 *
ps
 = 
NULL
;

699 
³rm_max
 = 0;

700 *
tmp
 = 
NULL
;

702 ià(
™”
 =ğ
NULL
 || (
db
 = 
	`qpŞ_™”©Ü_pŞicy
(iter)) == NULL ||

703 (
ps
 = (
³rm_¡©e_t
 *è
	`qpŞ_™”©Ü_¡©e
(
™”
)è=ğ
NULL
 || 
	`³rm_¡©e_’d
(iter)) {

704 
”ºo
 = 
EINVAL
;

705  
NULL
;

708 
obj_şass
 = 
db
->
şass_v®_to_¡ruù
[
ps
->
obj_şass_v®
 - 1];

709 
comm
 = 
obj_şass
->
comd©um
;

713 
³rm_max
 = 
obj_şass
->
³rmissiÚs
.
Årim
;

714 ià(
³rm_max
 > 32) {

715 
”ºo
 = 
EDOM
;

716  
NULL
;

718 ià(
ps
->
cur
 >ğ
³rm_max
) {

719 
”ºo
 = 
ERANGE
;

720  
NULL
;

722 ià(!(
ps
->
³rm_£t
 & 1 << (ps->
cur
))) {

723 
”ºo
 = 
EINVAL
;

724  
NULL
;

728 
tmp
 = 
	`£pŞ_av_to_¡ršg
((
pŞicydb_t
 *è
db
, 
ps
->
obj_şass_v®
, (
£pŞ_acûss_veùÜ_t
è1 << (ps->
cur
));

729 ià(
tmp
) {

730 
tmp
++;

731  
	`¡rdup
(
tmp
);

733 
”ºo
 = 
EINVAL
;

734  
NULL
;

736 
	}
}

738 
	$³rm_¡©e_Ãxt
(
qpŞ_™”©Ü_t
 * 
™”
)

740 
³rm_¡©e_t
 *
ps
 = 
NULL
;

741 cÚ¡ 
pŞicydb_t
 *
db
 = 
NULL
;

742 
³rm_max
 = 0;

744 ià(
™”
 =ğ
NULL
 || (
ps
 = 
	`qpŞ_™”©Ü_¡©e
(iter)) == NULL ||

745 (
db
 = 
	`qpŞ_™”©Ü_pŞicy
(
™”
)è=ğ
NULL
 || 
	`³rm_¡©e_’d
(iter)) {

746 
”ºo
 = 
EINVAL
;

747  
STATUS_ERR
;

752 
³rm_max
 = 
db
->
şass_v®_to_¡ruù
[
ps
->
obj_şass_v®
 - 1]->
³rmissiÚs
.
Årim
;

753 ià(
³rm_max
 > 32) {

754 
”ºo
 = 
EDOM
;

755  
STATUS_ERR
;

758 ià(
ps
->
cur
 >ğ
³rm_max
) {

759 
”ºo
 = 
ERANGE
;

760  
STATUS_ERR
;

764 
ps
->
cur
++;

765 } 
ps
->
cur
 < 
³rm_max
 && !Õs->
³rm_£t
 & 1 << (ps->cur)));

767  
STATUS_SUCCESS
;

768 
	}
}

770 
size_t
 
	$³rm_¡©e_size
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

772 
³rm_¡©e_t
 *
ps
 = 
NULL
;

773 cÚ¡ 
pŞicydb_t
 *
db
 = 
NULL
;

774 
³rm_max
 = 0;

775 
size_t
 
i
, 
couÁ
 = 0;

777 ià(
™”
 =ğ
NULL
 || (
ps
 = 
	`qpŞ_™”©Ü_¡©e
(iter)) == NULL ||

778 (
db
 = 
	`qpŞ_™”©Ü_pŞicy
(
™”
)è=ğ
NULL
 || 
	`³rm_¡©e_’d
(iter)) {

779 
”ºo
 = 
EINVAL
;

785 
³rm_max
 = 
db
->
şass_v®_to_¡ruù
[
ps
->
obj_şass_v®
 - 1]->
³rmissiÚs
.
Årim
;

786 ià(
³rm_max
 > 32) {

787 
”ºo
 = 
EDOM
;

791 
i
 = 0; i < 
³rm_max
; i++) {

792 ià(
ps
->
³rm_£t
 & 1 << 
i
)

793 
couÁ
++;

796  
couÁ
;

797 
	}
}

	@libqpol/src/iterator_internal.h

28 #iâdeà
QPOL_ITERATOR_INTERNAL_H


29 
	#QPOL_ITERATOR_INTERNAL_H


	)

31 #ifdef 
__ılu¥lus


36 
	~<£pŞ/pŞicydb/pŞicydb.h
>

37 
	~<£pŞ/pŞicydb/avb.h
>

38 
	~<qpŞ/™”©Ü.h
>

39 
	~<qpŞ/pŞicy.h
>

40 
	~<¡ddef.h
>

42 
	shash_¡©e


44 
buck‘
;

45 
hashb_node_t
 *
node
;

46 
hashb_t
 *
bË
;

47 } 
	thash_¡©e_t
;

49 
	seb™m­_¡©e


51 
eb™m­_t
 *
bm­
;

52 
size_t
 
cur
;

53 } 
	teb™m­_¡©e_t
;

55 
	socÚ_¡©e


57 
ocÚ‹xt_t
 *
h—d
;

58 
ocÚ‹xt_t
 *
cur
;

59 } 
	tocÚ_¡©e_t
;

61 
	s³rm_¡©e


63 
ušt32_t
 
³rm_£t
;

64 
ušt32_t
 
obj_şass_v®
;

65 
ušt8_t
 
cur
;

66 } 
	t³rm_¡©e_t
;

68 
	savb_¡©e


70 
ušt32_t
 
ruË_ty³_mask
;

71 
avb_t
 *
ucÚd_b
;

72 
avb_t
 *
cÚd_b
;

73 
ušt32_t
 
buck‘
;

74 
avb_±r_t
 
node
;

75 
	#QPOL_AVTAB_STATE_AV
 0

	)

76 
	#QPOL_AVTAB_STATE_COND
 1

	)

77 
which
;

78 } 
	tavb_¡©e_t
;

80 
qpŞ_™”©Ü_ü—‹
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, *
¡©e
,

81 *(*
g‘_cur
è(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
),

82 (*
Ãxt
è(
qpŞ_™”©Ü_t
 * 
™”
),

83 (*
’d
è(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
),

84 
size_t
(*
size
è(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
), (*
ä“_â
è(*
x
), qpol_iterator_t ** iter);

86 *
qpŞ_™”©Ü_¡©e
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
);

87 cÚ¡ 
pŞicydb_t
 *
qpŞ_™”©Ü_pŞicy
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
);

89 *
hash_¡©e_g‘_cur
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
);

90 *
hash_¡©e_g‘_cur_key
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
);

91 *
eb™m­_¡©e_g‘_cur_ty³
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
);

92 *
eb™m­_¡©e_g‘_cur_rŞe
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
);

93 *
eb™m­_¡©e_g‘_cur_ÿt
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
);

94 *
eb™m­_¡©e_g‘_cur_³rmissive
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
);

95 *
eb™m­_¡©e_g‘_cur_pŞÿp
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
);

96 *
ocÚ_¡©e_g‘_cur
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
);

97 *
³rm_¡©e_g‘_cur
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
);

98 *
avb_¡©e_g‘_cur
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
);

100 
hash_¡©e_Ãxt
(
qpŞ_™”©Ü_t
 * 
™”
);

101 
eb™m­_¡©e_Ãxt
(
qpŞ_™”©Ü_t
 * 
™”
);

102 
ocÚ_¡©e_Ãxt
(
qpŞ_™”©Ü_t
 * 
™”
);

103 
³rm_¡©e_Ãxt
(
qpŞ_™”©Ü_t
 * 
™”
);

104 
avb_¡©e_Ãxt
(
qpŞ_™”©Ü_t
 * 
™”
);

106 
hash_¡©e_’d
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
);

107 
eb™m­_¡©e_’d
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
);

108 
ocÚ_¡©e_’d
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
);

109 
³rm_¡©e_’d
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
);

110 
avb_¡©e_’d
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
);

112 
size_t
 
hash_¡©e_size
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
);

113 
size_t
 
eb™m­_¡©e_size
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
);

114 
size_t
 
ocÚ_¡©e_size
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
);

115 
size_t
 
³rm_¡©e_size
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
);

116 
size_t
 
avb_¡©e_size
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
);

118 
eb™m­_¡©e_de¡roy
(*
es
);

119 #ifdef 
__ılu¥lus


	@libqpol/src/mls_query.c

26 
	~<¡ddef.h
>

27 
	~<¡dšt.h
>

28 
	~<¡dlib.h
>

29 
	~<qpŞ/™”©Ü.h
>

30 
	~<£pŞ/pŞicydb/pŞicydb.h
>

31 
	~<£pŞ/pŞicydb/ex·nd.h
>

32 
	~"™”©Ü_š‹º®.h
"

33 
	~<qpŞ/mls_qu”y.h
>

34 
	~"qpŞ_š‹º®.h
"

37 
	$qpŞ_pŞicy_g‘_Ëv–_by_Çme
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ *
Çme
, cÚ¡ 
qpŞ_Ëv–_t
 ** 
d©um
)

39 
pŞicydb_t
 *
db
 = 
NULL
;

40 
hashb_d©um_t
 
š‹º®_d©um
 = 
NULL
;

42 ià(
pŞicy
 =ğ
NULL
 || 
Çme
 =ğNULL || 
d©um
 == NULL) {

43 ià(
d©um
 !ğ
NULL
)

44 *
d©um
 = 
NULL
;

45 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

46 
”ºo
 = 
EINVAL
;

47  
STATUS_ERR
;

49 
db
 = &
pŞicy
->
p
->p;

50 
š‹º®_d©um
 = 
	`hashb_£¬ch
(
db
->
p_Ëv–s
.
bË
, (cÚ¡ 
hashb_key_t
)
Çme
);

51 ià(
š‹º®_d©um
 =ğ
NULL
) {

52 
	`ERR
(
pŞicy
, "could‚Ù fšd d©um fÜ†ev– %s", 
Çme
);

53 
”ºo
 = 
ENOENT
;

54  
STATUS_ERR
;

56 *
d©um
 = (
qpŞ_Ëv–_t
 *è
š‹º®_d©um
;

58  
STATUS_SUCCESS
;

59 
	}
}

61 
	$qpŞ_pŞicy_g‘_Ëv–_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, 
qpŞ_™”©Ü_t
 ** 
™”
)

63 
pŞicydb_t
 *
db
;

64 
”rÜ
 = 0;

65 
hash_¡©e_t
 *
hs
 = 
NULL
;

67 ià(
pŞicy
 =ğ
NULL
 || 
™”
 == NULL) {

68 ià(
™”
 !ğ
NULL
)

69 *
™”
 = 
NULL
;

70 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

71 
”ºo
 = 
EINVAL
;

72  
STATUS_ERR
;

75 
db
 = &
pŞicy
->
p
->p;

77 
hs
 = 
	`ÿÎoc
(1, (
hash_¡©e_t
));

78 ià(
hs
 =ğ
NULL
) {

79 
”rÜ
 = 
”ºo
;

80 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

81 
”ºo
 = 
”rÜ
;

82  
STATUS_ERR
;

84 
hs
->
bË
 = &
db
->
p_Ëv–s
.table;

85 
hs
->
node
 = (*(hs->
bË
))->
hbË
[0];

87 ià(
	`qpŞ_™”©Ü_ü—‹
(
pŞicy
, (*)
hs
, 
hash_¡©e_g‘_cur
,

88 
hash_¡©e_Ãxt
, 
hash_¡©e_’d
, 
hash_¡©e_size
, 
ä“
, 
™”
)) {

89 
	`ä“
(
hs
);

90  
STATUS_ERR
;

93 ià(
hs
->
node
 =ğ
NULL
)

94 
	`hash_¡©e_Ãxt
(*
™”
);

96  
STATUS_SUCCESS
;

97 
	}
}

99 
	$qpŞ_Ëv–_g‘_i§lŸs
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_Ëv–_t
 * 
d©um
, *
i§lŸs
)

101 
Ëv–_d©um_t
 *
š‹º®_d©um
;

103 ià(
pŞicy
 =ğ
NULL
 || 
d©um
 =ğNULL || 
i§lŸs
 == NULL) {

104 ià(
i§lŸs
 !ğ
NULL
)

105 *
i§lŸs
 = 0;

106 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

107 
”ºo
 = 
EINVAL
;

108  
STATUS_ERR
;

111 
š‹º®_d©um
 = (
Ëv–_d©um_t
 *è
d©um
;

112 *
i§lŸs
 = 
š‹º®_d©um
->isalias;

114  
STATUS_SUCCESS
;

115 
	}
}

117 
	$qpŞ_Ëv–_g‘_v®ue
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_Ëv–_t
 * 
d©um
, 
ušt32_t
 * 
v®ue
)

119 
Ëv–_d©um_t
 *
š‹º®_d©um
 = 
NULL
;

121 ià(
pŞicy
 =ğ
NULL
 || 
d©um
 =ğNULL || 
v®ue
 == NULL) {

122 ià(
v®ue
 !ğ
NULL
)

123 *
v®ue
 = 0;

124 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

125 
”ºo
 = 
EINVAL
;

126  
STATUS_ERR
;

129 
š‹º®_d©um
 = (
Ëv–_d©um_t
 *è
d©um
;

130 *
v®ue
 = 
š‹º®_d©um
->
Ëv–
->
£ns
;

132  
STATUS_SUCCESS
;

133 
	}
}

135 
	$qpŞ_Ëv–_g‘_ÿt_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_Ëv–_t
 * 
d©um
, 
qpŞ_™”©Ü_t
 ** 
ÿts
)

137 
Ëv–_d©um_t
 *
š‹º®_d©um
 = 
NULL
;

138 
eb™m­_¡©e_t
 *
es
 = 
NULL
;

139 
”rÜ
 = 0;

141 ià(
pŞicy
 =ğ
NULL
 || 
d©um
 =ğNULL || 
ÿts
 == NULL) {

142 ià(
ÿts
 !ğ
NULL
)

143 *
ÿts
 = 
NULL
;

144 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

145 
”ºo
 = 
EINVAL
;

146  
STATUS_ERR
;

149 
š‹º®_d©um
 = (
Ëv–_d©um_t
 *è
d©um
;

151 
es
 = 
	`ÿÎoc
(1, (
eb™m­_¡©e_t
));

152 ià(
es
 =ğ
NULL
) {

153 
”rÜ
 = 
”ºo
;

154 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

155 
”ºo
 = 
”rÜ
;

156  
STATUS_ERR
;

159 
es
->
bm­
 = &(
š‹º®_d©um
->
Ëv–
->
ÿt
);

160 
es
->
cur
 =ƒs->
bm­
->
node
 ?ƒs->bm­->node->
¡¬tb™
 : 0;

162 ià(
	`qpŞ_™”©Ü_ü—‹
(
pŞicy
, 
es
, 
eb™m­_¡©e_g‘_cur_ÿt
,

163 
eb™m­_¡©e_Ãxt
, 
eb™m­_¡©e_’d
, 
eb™m­_¡©e_size
, 
ä“
, 
ÿts
)) {

164 
	`ä“
(
es
);

165  
STATUS_ERR
;

168 ià(
es
->
bm­
->
node
 && !
	`eb™m­_g‘_b™
Ós->bm­,ƒs->
cur
))

169 
	`eb™m­_¡©e_Ãxt
(*
ÿts
);

171  
STATUS_SUCCESS
;

172 
	}
}

174 
	$qpŞ_Ëv–_g‘_Çme
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_Ëv–_t
 * 
d©um
, cÚ¡ **
Çme
)

176 
Ëv–_d©um_t
 *
š‹º®_d©um
 = 
NULL
;

177 
pŞicydb_t
 *
db
 = 
NULL
;

179 ià(
pŞicy
 =ğ
NULL
 || 
d©um
 =ğNULL || 
Çme
 == NULL) {

180 ià(
Çme
 !ğ
NULL
)

181 *
Çme
 = 
NULL
;

182 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

183 
”ºo
 = 
EINVAL
;

184  
STATUS_ERR
;

187 
db
 = &
pŞicy
->
p
->p;

188 
š‹º®_d©um
 = (
Ëv–_d©um_t
 *è
d©um
;

190 *
Çme
 = 
db
->
p_£ns_v®_to_Çme
[
š‹º®_d©um
->
Ëv–
->
£ns
 - 1];

192  
STATUS_SUCCESS
;

193 
	}
}

195 
	sËv–_®Ÿs_hash_¡©e


197 
	mbuck‘
;

198 
hashb_node_t
 *
	mnode
;

199 
hashb_t
 *
	mbË
;

200 
ušt32_t
 
	mv®
;

201 } 
	tËv–_®Ÿs_hash_¡©e_t
;

203 
	$hash_¡©e_Ãxt_Ëv–_®Ÿs
(
qpŞ_™”©Ü_t
 * 
™”
)

205 
Ëv–_®Ÿs_hash_¡©e_t
 *
hs
 = 
NULL
;

206 
Ëv–_d©um_t
 *
d©um
 = 
NULL
;

208 ià(
™”
 =ğ
NULL
) {

209 
”ºo
 = 
EINVAL
;

210  
STATUS_ERR
;

212 
hs
 = (
Ëv–_®Ÿs_hash_¡©e_t
 *è
	`qpŞ_™”©Ü_¡©e
(
™”
);

213 ià(
hs
 =ğ
NULL
) {

214 
”ºo
 = 
EINVAL
;

215  
STATUS_ERR
;

218 ià(
hs
->
buck‘
 >ğ(*(hs->
bË
))->
size
) {

219 
”ºo
 = 
ERANGE
;

220  
STATUS_ERR
;

224 
	`hash_¡©e_Ãxt
(
™”
);

225 
d©um
 = 
hs
->
node
 ? (
Ëv–_d©um_t
 *èhs->node->d©um : 
NULL
;

226 } 
d©um
 !ğ
NULL
 && (d©um->
Ëv–
->
£ns
 !ğ
hs
->
v®
 || !d©um->
i§lŸs
));

228  
STATUS_SUCCESS
;

229 
	}
}

231 *
	$hash_¡©e_g‘_cur_®Ÿs
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

233 
Ëv–_®Ÿs_hash_¡©e_t
 *
hs
 = 
NULL
;

235 ià(
™”
 =ğ
NULL
) {

236 
”ºo
 = 
EINVAL
;

237  
NULL
;

239 
hs
 = (
Ëv–_®Ÿs_hash_¡©e_t
 *è
	`qpŞ_™”©Ü_¡©e
(
™”
);

240 ià(
hs
 =ğ
NULL
) {

241 
”ºo
 = 
EINVAL
;

242  
NULL
;

245 ià(
hs
->
buck‘
 >ğ(*(hs->
bË
))->
size
) {

246 
”ºo
 = 
ERANGE
;

247  
NULL
;

250  
hs
->
node
->
key
;

251 
	}
}

253 
size_t
 
	$hash_¡©e_Ëv–_®Ÿs_size
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

255 
Ëv–_®Ÿs_hash_¡©e_t
 *
hs
 = 
NULL
;

256 
hashb_node_t
 *
tmp_node
;

257 
Ëv–_d©um_t
 *
tmp_lvl_d©um
;

258 
ušt32_t
 
tmp_buck‘
 = 0;

259 
size_t
 
couÁ
 = 0;

260 ià(
™”
 =ğ
NULL
 || 
	`qpŞ_™”©Ü_¡©e
(iter) == NULL) {

261 
”ºo
 = 
EINVAL
;

264 
hs
 = (
Ëv–_®Ÿs_hash_¡©e_t
 *è
	`qpŞ_™”©Ü_¡©e
(
™”
);

265 ià(!
hs
) {

266 
”ºo
 = 
EINVAL
;

267  
STATUS_ERR
;

269 
tmp_buck‘
 = 0;mp_buck‘ < (*(
hs
->
bË
))->
size
;mp_bucket++) {

270 
tmp_node
 = (*(
hs
->
bË
))->
hbË
[
tmp_buck‘
];mp_node;mp_nodğtmp_node->
Ãxt
) {

271 
tmp_lvl_d©um
 = 
tmp_node
 ?mp_node->
d©um
 : 
NULL
;

272 ià(
tmp_lvl_d©um
) {

273 ià(
tmp_lvl_d©um
->
i§lŸs
 &&mp_lvl_d©um->
Ëv–
->
£ns
 =ğ
hs
->
v®
)

274 
couÁ
++;

278  
couÁ
;

279 
	}
}

281 
	$qpŞ_Ëv–_g‘_®Ÿs_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_Ëv–_t
 * 
d©um
, 
qpŞ_™”©Ü_t
 ** 
®Ÿ£s
)

283 
Ëv–_d©um_t
 *
š‹º®_d©um
 = 
NULL
;

284 
pŞicydb_t
 *
db
 = 
NULL
;

285 
”rÜ
;

286 
Ëv–_®Ÿs_hash_¡©e_t
 *
hs
 = 
NULL
;

288 ià(
pŞicy
 =ğ
NULL
 || 
d©um
 =ğNULL || 
®Ÿ£s
 == NULL) {

289 ià(
®Ÿ£s
 !ğ
NULL
)

290 *
®Ÿ£s
 = 
NULL
;

291 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

292 
”ºo
 = 
EINVAL
;

293  
STATUS_ERR
;

296 
db
 = &
pŞicy
->
p
->p;

297 
š‹º®_d©um
 = (
Ëv–_d©um_t
 *è
d©um
;

299 
hs
 = 
	`ÿÎoc
(1, (
Ëv–_®Ÿs_hash_¡©e_t
));

300 ià(
hs
 =ğ
NULL
) {

301 
”rÜ
 = 
”ºo
;

302 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

303 
”ºo
 = 
”rÜ
;

304  
STATUS_ERR
;

306 
hs
->
bË
 = &
db
->
p_Ëv–s
.table;

307 
hs
->
node
 = (*(hs->
bË
))->
hbË
[0];

308 
hs
->
v®
 = 
š‹º®_d©um
->
Ëv–
->
£ns
;

310 ià(
	`qpŞ_™”©Ü_ü—‹
(
pŞicy
, (*)
hs
, 
hash_¡©e_g‘_cur_®Ÿs
,

311 
hash_¡©e_Ãxt_Ëv–_®Ÿs
, 
hash_¡©e_’d
, 
hash_¡©e_Ëv–_®Ÿs_size
, 
ä“
, 
®Ÿ£s
)) {

312 
	`ä“
(
hs
);

313  
STATUS_ERR
;

316 ià(
hs
->
node
 =ğ
NULL
 || !((
Ëv–_d©um_t
 *èhs->node->
d©um
)->
i§lŸs


317 || ((
Ëv–_d©um_t
 *è(
hs
->
node
->
d©um
))->
Ëv–
->
£ns
 !ğhs->
v®
)

318 
	`hash_¡©e_Ãxt_Ëv–_®Ÿs
(*
®Ÿ£s
);

320  
STATUS_SUCCESS
;

321 
	}
}

324 
	$qpŞ_pŞicy_g‘_ÿt_by_Çme
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ *
Çme
, cÚ¡ 
qpŞ_ÿt_t
 ** 
d©um
)

326 
hashb_d©um_t
 
š‹º®_d©um
;

327 
pŞicydb_t
 *
db
;

329 ià(
pŞicy
 =ğ
NULL
 || 
Çme
 =ğNULL || 
d©um
 == NULL) {

330 ià(
d©um
 !ğ
NULL
)

331 *
d©um
 = 
NULL
;

332 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

333 
”ºo
 = 
EINVAL
;

334  
STATUS_ERR
;

337 
db
 = &
pŞicy
->
p
->p;

338 
š‹º®_d©um
 = 
	`hashb_£¬ch
(
db
->
p_ÿts
.
bË
, (cÚ¡ 
hashb_key_t
)
Çme
);

339 ià(
š‹º®_d©um
 =ğ
NULL
) {

340 *
d©um
 = 
NULL
;

341 
	`ERR
(
pŞicy
, "could‚Ù fšd d©um fÜ c© %s", 
Çme
);

342 
”ºo
 = 
ENOENT
;

343  
STATUS_ERR
;

345 *
d©um
 = (
qpŞ_ÿt_t
 *è
š‹º®_d©um
;

347  
STATUS_SUCCESS
;

348 
	}
}

350 
	$qpŞ_pŞicy_g‘_ÿt_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, 
qpŞ_™”©Ü_t
 ** 
™”
)

352 
pŞicydb_t
 *
db
;

353 
”rÜ
 = 0;

354 
hash_¡©e_t
 *
hs
 = 
NULL
;

356 ià(
pŞicy
 =ğ
NULL
 || 
™”
 == NULL) {

357 ià(
™”
 !ğ
NULL
)

358 *
™”
 = 
NULL
;

359 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

360 
”ºo
 = 
EINVAL
;

361  
STATUS_ERR
;

364 
db
 = &
pŞicy
->
p
->p;

366 
hs
 = 
	`ÿÎoc
(1, (
hash_¡©e_t
));

367 ià(
hs
 =ğ
NULL
) {

368 
”rÜ
 = 
”ºo
;

369 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

370 
”ºo
 = 
”rÜ
;

371  
STATUS_ERR
;

373 
hs
->
bË
 = &
db
->
p_ÿts
.table;

374 
hs
->
node
 = (*(hs->
bË
))->
hbË
[0];

376 ià(
	`qpŞ_™”©Ü_ü—‹
(
pŞicy
, (*)
hs
, 
hash_¡©e_g‘_cur
,

377 
hash_¡©e_Ãxt
, 
hash_¡©e_’d
, 
hash_¡©e_size
, 
ä“
, 
™”
)) {

378 
	`ä“
(
hs
);

379  
STATUS_ERR
;

382 ià(
hs
->
node
 =ğ
NULL
)

383 
	`hash_¡©e_Ãxt
(*
™”
);

385  
STATUS_SUCCESS
;

386 
	}
}

388 
	$qpŞ_ÿt_g‘_v®ue
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_ÿt_t
 * 
d©um
, 
ušt32_t
 * 
v®ue
)

390 
ÿt_d©um_t
 *
š‹º®_d©um
 = 
NULL
;

392 ià(
pŞicy
 =ğ
NULL
 || 
d©um
 =ğNULL || 
v®ue
 == NULL) {

393 ià(
v®ue
 !ğ
NULL
)

394 *
v®ue
 = 0;

395 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

396 
”ºo
 = 
EINVAL
;

397  
STATUS_ERR
;

400 
š‹º®_d©um
 = (
ÿt_d©um_t
 *è
d©um
;

401 *
v®ue
 = 
š‹º®_d©um
->
s
.value;

403  
STATUS_SUCCESS
;

404 
	}
}

406 
	$qpŞ_ÿt_g‘_i§lŸs
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_ÿt_t
 * 
d©um
, *
i§lŸs
)

408 
ÿt_d©um_t
 *
š‹º®_d©um
;

410 ià(
pŞicy
 =ğ
NULL
 || 
d©um
 =ğNULL || 
i§lŸs
 == NULL) {

411 ià(
i§lŸs
 !ğ
NULL
)

412 *
i§lŸs
 = 0;

413 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

414 
”ºo
 = 
EINVAL
;

415  
STATUS_ERR
;

418 
š‹º®_d©um
 = (
ÿt_d©um_t
 *è
d©um
;

419 *
i§lŸs
 = 
š‹º®_d©um
->isalias;

421  
STATUS_SUCCESS
;

422 
	}
}

424 
	$qpŞ_ÿt_g‘_Çme
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_ÿt_t
 * 
d©um
, cÚ¡ **
Çme
)

426 
ÿt_d©um_t
 *
š‹º®_d©um
 = 
NULL
;

427 
pŞicydb_t
 *
db
 = 
NULL
;

429 ià(
pŞicy
 =ğ
NULL
 || 
d©um
 =ğNULL || 
Çme
 == NULL) {

430 ià(
Çme
 !ğ
NULL
)

431 *
Çme
 = 
NULL
;

432 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

433 
”ºo
 = 
EINVAL
;

434  
STATUS_ERR
;

437 
db
 = &
pŞicy
->
p
->p;

438 
š‹º®_d©um
 = (
ÿt_d©um_t
 *è
d©um
;

440 *
Çme
 = 
db
->
p_ÿt_v®_to_Çme
[
š‹º®_d©um
->
s
.
v®ue
 - 1];

442  
STATUS_SUCCESS
;

443 
	}
}

445 
	$hash_¡©e_Ãxt_ÿt_®Ÿs
(
qpŞ_™”©Ü_t
 * 
™”
)

448 
Ëv–_®Ÿs_hash_¡©e_t
 *
hs
 = 
NULL
;

449 
ÿt_d©um_t
 *
d©um
 = 
NULL
;

451 ià(
™”
 =ğ
NULL
) {

452 
”ºo
 = 
EINVAL
;

453  
STATUS_ERR
;

455 
hs
 = (
Ëv–_®Ÿs_hash_¡©e_t
 *è
	`qpŞ_™”©Ü_¡©e
(
™”
);

456 ià(
hs
 =ğ
NULL
) {

457 
”ºo
 = 
EINVAL
;

458  
STATUS_ERR
;

461 ià(
hs
->
buck‘
 >ğ(*(hs->
bË
))->
size
) {

462 
”ºo
 = 
ERANGE
;

463  
STATUS_ERR
;

467 
	`hash_¡©e_Ãxt
(
™”
);

468 
d©um
 = 
hs
->
node
 ? (
ÿt_d©um_t
 *èhs->node->d©um : 
NULL
;

469 } 
d©um
 !ğ
NULL
 && (d©um->
s
.
v®ue
 !ğ
hs
->
v®
 || !d©um->
i§lŸs
));

471  
STATUS_SUCCESS
;

472 
	}
}

474 
size_t
 
	$hash_¡©e_ÿt_®Ÿs_size
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

476 
Ëv–_®Ÿs_hash_¡©e_t
 *
hs
 = 
NULL
;

477 
hashb_node_t
 *
tmp_node
;

478 
ÿt_d©um_t
 *
tmp_ÿt_d©um
;

479 
ušt32_t
 
tmp_buck‘
 = 0;

480 
size_t
 
couÁ
 = 0;

481 ià(
™”
 =ğ
NULL
 || 
	`qpŞ_™”©Ü_¡©e
(iter) == NULL) {

482 
”ºo
 = 
EINVAL
;

485 
hs
 = (
Ëv–_®Ÿs_hash_¡©e_t
 *è
	`qpŞ_™”©Ü_¡©e
(
™”
);

486 ià(!
hs
) {

487 
”ºo
 = 
EINVAL
;

488  
STATUS_ERR
;

490 
tmp_buck‘
 = 0;mp_buck‘ < (*(
hs
->
bË
))->
size
;mp_bucket++) {

491 
tmp_node
 = (*(
hs
->
bË
))->
hbË
[
tmp_buck‘
];mp_node;mp_nodğtmp_node->
Ãxt
) {

492 
tmp_ÿt_d©um
 = 
tmp_node
 ?mp_node->
d©um
 : 
NULL
;

493 ià(
tmp_ÿt_d©um
) {

494 ià(
tmp_ÿt_d©um
->
i§lŸs
 &&mp_ÿt_d©um->
s
.
v®ue
 =ğ
hs
->
v®
)

495 
couÁ
++;

499  
couÁ
;

500 
	}
}

502 
	$qpŞ_ÿt_g‘_®Ÿs_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_ÿt_t
 * 
d©um
, 
qpŞ_™”©Ü_t
 ** 
®Ÿ£s
)

504 
ÿt_d©um_t
 *
š‹º®_d©um
 = 
NULL
;

505 
pŞicydb_t
 *
db
 = 
NULL
;

506 
”rÜ
;

507 
Ëv–_®Ÿs_hash_¡©e_t
 *
hs
 = 
NULL
;

509 ià(
pŞicy
 =ğ
NULL
 || 
d©um
 =ğNULL || 
®Ÿ£s
 == NULL) {

510 ià(
®Ÿ£s
 !ğ
NULL
)

511 *
®Ÿ£s
 = 
NULL
;

512 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

513 
”ºo
 = 
EINVAL
;

514  
STATUS_ERR
;

517 
db
 = &
pŞicy
->
p
->p;

518 
š‹º®_d©um
 = (
ÿt_d©um_t
 *è
d©um
;

520 
hs
 = 
	`ÿÎoc
(1, (
Ëv–_®Ÿs_hash_¡©e_t
));

521 ià(
hs
 =ğ
NULL
) {

522 
”rÜ
 = 
”ºo
;

523 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

524 
”ºo
 = 
”rÜ
;

525  
STATUS_ERR
;

527 
hs
->
bË
 = &
db
->
p_ÿts
.table;

528 
hs
->
node
 = (*(hs->
bË
))->
hbË
[0];

529 
hs
->
v®
 = 
š‹º®_d©um
->
s
.
v®ue
;

531 ià(
	`qpŞ_™”©Ü_ü—‹
(
pŞicy
, (*)
hs
, 
hash_¡©e_g‘_cur_®Ÿs
,

532 
hash_¡©e_Ãxt_ÿt_®Ÿs
, 
hash_¡©e_’d
, 
hash_¡©e_ÿt_®Ÿs_size
, 
ä“
, 
®Ÿ£s
)) {

533 
	`ä“
(
hs
);

534  
STATUS_ERR
;

537 ià(
hs
->
node
 =ğ
NULL
 || ((
ÿt_d©um_t
 *è(hs->node->
d©um
))->
s
.
v®ue
 !ğhs->
v®
)

538 
	`hash_¡©e_Ãxt_ÿt_®Ÿs
(*
®Ÿ£s
);

540  
STATUS_SUCCESS
;

541 
	}
}

544 
	$qpŞ_mls_¿nge_g‘_low_Ëv–
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_mls_¿nge_t
 * 
¿nge
, cÚ¡ 
qpŞ_mls_Ëv–_t
 ** 
Ëv–
)

546 
mls_¿nge_t
 *
š‹º®_¿nge
 = 
NULL
;

548 ià(
pŞicy
 =ğ
NULL
 || 
¿nge
 =ğNULL || 
Ëv–
 == NULL) {

549 ià(
Ëv–
 !ğ
NULL
)

550 *
Ëv–
 = 
NULL
;

551 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

552 
”ºo
 = 
EINVAL
;

553  
STATUS_ERR
;

556 
š‹º®_¿nge
 = (
mls_¿nge_t
 *è
¿nge
;

557 *
Ëv–
 = (
qpŞ_mls_Ëv–_t
 *è& (
š‹º®_¿nge
->level[0]);

559  
STATUS_SUCCESS
;

560 
	}
}

562 
	$qpŞ_mls_¿nge_g‘_high_Ëv–
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_mls_¿nge_t
 * 
¿nge
, cÚ¡ 
qpŞ_mls_Ëv–_t
 ** 
Ëv–
)

564 
mls_¿nge_t
 *
š‹º®_¿nge
 = 
NULL
;

566 ià(
pŞicy
 =ğ
NULL
 || 
¿nge
 =ğNULL || 
Ëv–
 == NULL) {

567 ià(
Ëv–
 !ğ
NULL
)

568 *
Ëv–
 = 
NULL
;

569 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

570 
”ºo
 = 
EINVAL
;

571  
STATUS_ERR
;

574 
š‹º®_¿nge
 = (
mls_¿nge_t
 *è
¿nge
;

575 *
Ëv–
 = (
qpŞ_mls_Ëv–_t
 *è& (
š‹º®_¿nge
->level[1]);

577  
STATUS_SUCCESS
;

578 
	}
}

581 
	$qpŞ_mls_Ëv–_g‘_£ns_Çme
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_mls_Ëv–_t
 * 
Ëv–
, cÚ¡ **
Çme
)

583 
pŞicydb_t
 *
db
 = 
NULL
;

584 
mls_Ëv–_t
 *
š‹º®_Ëv–
 = 
NULL
;

586 ià(
pŞicy
 =ğ
NULL
 || 
Ëv–
 =ğNULL || 
Çme
 == NULL) {

587 ià(
Çme
 !ğ
NULL
)

588 *
Çme
 = 
NULL
;

589 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

590 
”ºo
 = 
EINVAL
;

591  
STATUS_ERR
;

594 
š‹º®_Ëv–
 = (
mls_Ëv–_t
 *è
Ëv–
;

595 
db
 = &
pŞicy
->
p
->p;

597 *
Çme
 = 
db
->
p_£ns_v®_to_Çme
[
š‹º®_Ëv–
->
£ns
 - 1];

599  
STATUS_SUCCESS
;

600 
	}
}

602 
	$qpŞ_mls_Ëv–_g‘_ÿt_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_mls_Ëv–_t
 * 
Ëv–
, 
qpŞ_™”©Ü_t
 ** 
ÿts
)

604 
mls_Ëv–_t
 *
š‹º®_Ëv–
 = 
NULL
;

605 
eb™m­_¡©e_t
 *
es
 = 
NULL
;

606 
”rÜ
 = 0;

608 ià(
pŞicy
 =ğ
NULL
 || 
Ëv–
 =ğNULL || 
ÿts
 == NULL) {

609 ià(
ÿts
 !ğ
NULL
)

610 *
ÿts
 = 
NULL
;

611 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

612 
”ºo
 = 
EINVAL
;

613  
STATUS_ERR
;

616 
š‹º®_Ëv–
 = (
mls_Ëv–_t
 *è
Ëv–
;

618 
es
 = 
	`ÿÎoc
(1, (
eb™m­_¡©e_t
));

619 ià(
es
 =ğ
NULL
) {

620 
”rÜ
 = 
”ºo
;

621 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

622 
”ºo
 = 
”rÜ
;

623  
STATUS_ERR
;

626 
es
->
bm­
 = &(
š‹º®_Ëv–
->
ÿt
);

627 
es
->
cur
 =ƒs->
bm­
->
node
 ?ƒs->bm­->node->
¡¬tb™
 : 0;

629 ià(
	`qpŞ_™”©Ü_ü—‹
(
pŞicy
, 
es
, 
eb™m­_¡©e_g‘_cur_ÿt
,

630 
eb™m­_¡©e_Ãxt
, 
eb™m­_¡©e_’d
, 
eb™m­_¡©e_size
, 
ä“
, 
ÿts
)) {

631 
	`ä“
(
es
);

632  
STATUS_ERR
;

635 ià(
es
->
bm­
->
node
 && !
	`eb™m­_g‘_b™
Ós->bm­,ƒs->
cur
))

636 
	`eb™m­_¡©e_Ãxt
(*
ÿts
);

638  
STATUS_SUCCESS
;

639 
	}
}

	@libqpol/src/mlsrule_query.c

27 
	~"™”©Ü_š‹º®.h
"

28 
	~<qpŞ/™”©Ü.h
>

29 
	~<qpŞ/pŞicy.h
>

30 
	~<qpŞ/ml¤uË_qu”y.h
>

31 
	~<£pŞ/pŞicydb/pŞicydb.h
>

32 
	~<£pŞ/pŞicydb/avb.h
>

33 
	~<£pŞ/pŞicydb/ut.h
>

34 
	~<¡dlib.h
>

35 
	~"qpŞ_š‹º®.h
"

37 
	s¿nge_Œªs_¡©e


39 
¿nge_Œªs_t
 *
	mh—d
;

40 
¿nge_Œªs_t
 *
	mcur
;

41 } 
	t¿nge_Œªs_¡©e_t
;

43 
	$¿nge_Œªs_¡©e_’d
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

45 
¿nge_Œªs_¡©e_t
 *
rs
 = 
NULL
;

47 ià(!
™”
 || !(
rs
 = 
	`qpŞ_™”©Ü_¡©e
(iter))) {

48 
”ºo
 = 
EINVAL
;

49  
STATUS_ERR
;

52  
rs
->
cur
 ? 0 : 1;

53 
	}
}

55 *
	$¿nge_Œªs_¡©e_g‘_cur
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

57 
¿nge_Œªs_¡©e_t
 *
rs
 = 
NULL
;

59 ià(!
™”
 || !(
rs
 = 
	`qpŞ_™”©Ü_¡©e
(iter))) {

60 
”ºo
 = 
EINVAL
;

61  
NULL
;

64  
rs
->
cur
;

65 
	}
}

67 
	$¿nge_Œªs_¡©e_Ãxt
(
qpŞ_™”©Ü_t
 * 
™”
)

69 
¿nge_Œªs_¡©e_t
 *
rs
 = 
NULL
;

71 ià(!
™”
 || !(
rs
 = 
	`qpŞ_™”©Ü_¡©e
(iter))) {

72 
”ºo
 = 
EINVAL
;

73  
STATUS_ERR
;

76 ià(
	`¿nge_Œªs_¡©e_’d
(
™”
)) {

77 
”ºo
 = 
EINVAL
;

78  
STATUS_ERR
;

81 
rs
->
cur
 =„s->cur->
Ãxt
;

83  
STATUS_SUCCESS
;

84 
	}
}

86 
size_t
 
	$¿nge_Œªs_¡©e_size
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

88 
¿nge_Œªs_¡©e_t
 *
rs
 = 
NULL
;

89 
size_t
 
couÁ
 = 0;

90 
¿nge_Œªs_t
 *
tmp
 = 
NULL
;

92 ià(!
™”
 || !(
rs
 = 
	`qpŞ_™”©Ü_¡©e
(iter))) {

93 
”ºo
 = 
EINVAL
;

97 
tmp
 = 
rs
->
h—d
;mp;m°ğtmp->
Ãxt
)

98 
couÁ
++;

100  
couÁ
;

101 
	}
}

103 
	$qpŞ_pŞicy_g‘_¿nge_Œªs_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, 
qpŞ_™”©Ü_t
 ** 
™”
)

105 
pŞicydb_t
 *
db
 = 
NULL
;

106 
¿nge_Œªs_¡©e_t
 *
rs
 = 
NULL
;

107 
”rÜ
 = 0;

109 ià(
™”
)

110 *
™”
 = 
NULL
;

112 ià(!
pŞicy
 || !
™”
) {

113 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

114 
”ºo
 = 
EINVAL
;

115  
STATUS_ERR
;

118 
db
 = &
pŞicy
->
p
->p;

120 
rs
 = 
	`ÿÎoc
(1, (
¿nge_Œªs_¡©e_t
));

121 ià(!
rs
) {

122 
”rÜ
 = 
”ºo
;

123 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

124 
”ºo
 = 
”rÜ
;

125  
STATUS_ERR
;

128 ià(
	`qpŞ_™”©Ü_ü—‹
(
pŞicy
, (*)
rs
, 
¿nge_Œªs_¡©e_g‘_cur
,

129 
¿nge_Œªs_¡©e_Ãxt
, 
¿nge_Œªs_¡©e_’d
, 
¿nge_Œªs_¡©e_size
, 
ä“
, 
™”
)) {

130 
”rÜ
 = 
”ºo
;

131 
	`ä“
(
rs
);

132 
”ºo
 = 
”rÜ
;

133  
STATUS_ERR
;

136 
rs
->
h—d
 =„s->
cur
 = 
db
->
¿nge_Œ
;

137  
STATUS_SUCCESS
;

138 
	}
}

140 
	$qpŞ_¿nge_Œªs_g‘_sourû_ty³
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_¿nge_Œªs_t
 * 
ruË
, cÚ¡ 
qpŞ_ty³_t
 ** 
sourû
)

142 
pŞicydb_t
 *
db
 = 
NULL
;

143 
¿nge_Œªs_t
 *
¹
 = 
NULL
;

145 ià(
sourû
) {

146 *
sourû
 = 
NULL
;

149 ià(!
pŞicy
 || !
ruË
 || !
sourû
) {

150 
”ºo
 = 
EINVAL
;

151 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

152  
STATUS_ERR
;

155 
db
 = &
pŞicy
->
p
->p;

156 
¹
 = (
¿nge_Œªs_t
 *è
ruË
;

158 *
sourû
 = (
qpŞ_ty³_t
 *è
db
->
ty³_v®_to_¡ruù
[
¹
->
sourû_ty³
 - 1];

160  
STATUS_SUCCESS
;

161 
	}
}

163 
	$qpŞ_¿nge_Œªs_g‘_rg‘_ty³
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_¿nge_Œªs_t
 * 
ruË
, cÚ¡ 
qpŞ_ty³_t
 ** 
rg‘
)

165 
pŞicydb_t
 *
db
 = 
NULL
;

166 
¿nge_Œªs_t
 *
¹
 = 
NULL
;

168 ià(
rg‘
) {

169 *
rg‘
 = 
NULL
;

172 ià(!
pŞicy
 || !
ruË
 || !
rg‘
) {

173 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

174 
”ºo
 = 
EINVAL
;

175  
STATUS_ERR
;

178 
db
 = &
pŞicy
->
p
->p;

179 
¹
 = (
¿nge_Œªs_t
 *è
ruË
;

181 *
rg‘
 = (
qpŞ_ty³_t
 *è
db
->
ty³_v®_to_¡ruù
[
¹
->
rg‘_ty³
 - 1];

183  
STATUS_SUCCESS
;

184 
	}
}

186 
	$qpŞ_¿nge_Œªs_g‘_rg‘_şass
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_¿nge_Œªs_t
 * 
ruË
, cÚ¡ 
qpŞ_şass_t
 ** 
rg‘
)

188 
pŞicydb_t
 *
db
 = 
NULL
;

189 
¿nge_Œªs_t
 *
¹
 = 
NULL
;

191 ià(
rg‘
) {

192 *
rg‘
 = 
NULL
;

195 ià(!
pŞicy
 || !
ruË
 || !
rg‘
) {

196 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

197 
”ºo
 = 
EINVAL
;

198  
STATUS_ERR
;

201 
db
 = &
pŞicy
->
p
->p;

202 
¹
 = (
¿nge_Œªs_t
 *è
ruË
;

204 *
rg‘
 = (
qpŞ_şass_t
 *è
db
->
şass_v®_to_¡ruù
[
¹
->
rg‘_şass
 - 1];

206  
STATUS_SUCCESS
;

207 
	}
}

209 
	$qpŞ_¿nge_Œªs_g‘_¿nge
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_¿nge_Œªs_t
 * 
ruË
, cÚ¡ 
qpŞ_mls_¿nge_t
 ** 
¿nge
)

211 
pŞicydb_t
 *
db
 = 
NULL
;

212 
¿nge_Œªs_t
 *
¹
 = 
NULL
;

214 ià(
¿nge
) {

215 *
¿nge
 = 
NULL
;

218 ià(!
pŞicy
 || !
ruË
 || !
¿nge
) {

219 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

220 
”ºo
 = 
EINVAL
;

221  
STATUS_ERR
;

224 
db
 = &
pŞicy
->
p
->p;

225 
¹
 = (
¿nge_Œªs_t
 *è
ruË
;

227 *
¿nge
 = (
qpŞ_mls_¿nge_t
 *è& 
¹
->
rg‘_¿nge
;

229  
STATUS_SUCCESS
;

230 
	}
}

	@libqpol/src/module.c

26 
	~<cÚfig.h
>

28 
	~<”ºo.h
>

29 
	~<¡dio.h
>

30 
	~<¡dlib.h
>

31 
	~<¡ršg.h
>

33 
	~<qpŞ/moduË.h
>

34 
	~<qpŞ/ut.h
>

35 
	~"qpŞ_š‹º®.h
"

37 
	~<£pŞ/pŞicydb.h
>

38 
	~<£pŞ/pŞicydb/moduË.h
>

40 
	$qpŞ_moduË_ü—‹_äom_fe
(cÚ¡ *
·th
, 
qpŞ_moduË_t
 ** 
moduË
)

42 
£pŞ_moduË_·ckage_t
 *
smp
 = 
NULL
;

43 
£pŞ_pŞicy_fe_t
 *
¥f
 = 
NULL
;

44 
FILE
 *
šfe
 = 
NULL
;

45 
”rÜ
 = 0;

46 *
tmp
 = 
NULL
;

47 *
d©a
 = 
NULL
;

48 
ssize_t
 
size
;

50 ià(
moduË
)

51 *
moduË
 = 
NULL
;

53 ià(!
·th
 || !
moduË
) {

54 
”ºo
 = 
EINVAL
;

55  
STATUS_ERR
;

58 ià(!(*
moduË
 = 
	`ÿÎoc
(1, (
qpŞ_moduË_t
)))) {

59  
STATUS_ERR
;

62 ià(!((*
moduË
)->
·th
 = 
	`¡rdup
(path))) {

63 
”rÜ
 = 
”ºo
;

64 
”r
;

67 ià(
	`£pŞ_pŞicy_fe_ü—‹
(&
¥f
)) {

68 
”rÜ
 = 
”ºo
;

69 
”r
;

72 
šfe
 = 
	`fİ’
(
·th
, "rb");

73 ià(!
šfe
) {

74 
”rÜ
 = 
”ºo
;

75 
”r
;

77 
size
 = 
	`qpŞ_bunz
(
šfe
, &
d©a
);

79 ià(
size
 > 0) {

80 ià(!
	`qpŞ_is_d©a_mod_pkg
(
d©a
)) {

81 
”rÜ
 = 
ENOTSUP
;

82 
”r
;

84 
	`£pŞ_pŞicy_fe_£t_mem
(
¥f
, 
d©a
, 
size
);

86 ià(!
	`qpŞ_is_fe_mod_pkg
(
šfe
)) {

87 
”rÜ
 = 
ENOTSUP
;

88 
”r
;

90 
	`»wšd
(
šfe
);

91 
	`£pŞ_pŞicy_fe_£t_å
(
¥f
, 
šfe
);

94 ià(
	`£pŞ_moduË_·ckage_ü—‹
(&
smp
)) {

95 
”rÜ
 = 
EIO
;

96 
”r
;

99 ià(
	`£pŞ_moduË_·ckage_šfo
(
¥f
, &((*
moduË
)->
ty³
), &((*moduË)->
Çme
), &
tmp
)) {

100 
”rÜ
 = 
EIO
;

101 
”r
;

103 
	`ä“
(
tmp
);

104 
tmp
 = 
NULL
;

105 ià(
size
 > 0) {

109 
	`£pŞ_pŞicy_fe_£t_mem
(
¥f
, 
d©a
, 
size
);

111 
	`»wšd
(
šfe
);

114 ià(
	`£pŞ_moduË_·ckage_»ad
(
smp
, 
¥f
, 0)) {

115 
”rÜ
 = 
EIO
;

116 
”r
;

119 ià(!((*
moduË
)->
p
 = 
	`£pŞ_moduË_·ckage_g‘_pŞicy
(
smp
))) {

120 
”rÜ
 = 
EIO
;

121 
”r
;

124 
smp
->
pŞicy
 = 
NULL
;

126 (*
moduË
)->
v”siÚ
 = (*moduË)->
p
->p.version;

127 (*
moduË
)->
’abËd
 = 1;

129 
	`£pŞ_moduË_·ckage_ä“
(
smp
);

130 
	`fşo£
(
šfe
);

131 ià(
d©a
 !ğ
NULL
)

132 
	`ä“
 (
d©a
);

133 
	`£pŞ_pŞicy_fe_ä“
(
¥f
);

135  
STATUS_SUCCESS
;

137 
”r
:

138 
	`qpŞ_moduË_de¡roy
(
moduË
);

139 
	`£pŞ_pŞicy_fe_ä“
(
¥f
);

140 
	`£pŞ_moduË_·ckage_ä“
(
smp
);

141 ià(
šfe
)

142 
	`fşo£
(
šfe
);

143 ià(
d©a
 !ğ
NULL
)

144 
	`ä“
 (
d©a
);

145 ià(
tmp
 !ğ
NULL
)

146 
	`ä“
(
tmp
);

147 
”ºo
 = 
”rÜ
;

148  
STATUS_ERR
;

149 
	}
}

151 
	$qpŞ_moduË_de¡roy
(
qpŞ_moduË_t
 ** 
moduË
)

153 ià(!
moduË
 || !(*module))

156 
	`ä“
((*
moduË
)->
·th
);

157 
	`ä“
((*
moduË
)->
Çme
);

158 
	`£pŞ_pŞicydb_ä“
((*
moduË
)->
p
);

159 
	`ä“
(*
moduË
);

160 *
moduË
 = 
NULL
;

161 
	}
}

163 
	$qpŞ_moduË_g‘_·th
(cÚ¡ 
qpŞ_moduË_t
 * 
moduË
, cÚ¡ **
·th
)

165 ià(!
moduË
 || !
·th
) {

166 
”ºo
 = 
EINVAL
;

167  
STATUS_ERR
;

170 *
·th
 = 
moduË
->path;

172  
STATUS_SUCCESS
;

173 
	}
}

175 
	$qpŞ_moduË_g‘_Çme
(cÚ¡ 
qpŞ_moduË_t
 * 
moduË
, cÚ¡ **
Çme
)

177 ià(!
moduË
 || !
Çme
) {

178 
”ºo
 = 
EINVAL
;

179  
STATUS_ERR
;

182 *
Çme
 = 
moduË
->name;

184  
STATUS_SUCCESS
;

185 
	}
}

187 
	$qpŞ_moduË_g‘_v”siÚ
(cÚ¡ 
qpŞ_moduË_t
 * 
moduË
, cÚ¡ **
v”siÚ
)

189 ià(!
moduË
 || !
v”siÚ
) {

190 
”ºo
 = 
EINVAL
;

191  
STATUS_ERR
;

194 *
v”siÚ
 = 
moduË
->version;

196  
STATUS_SUCCESS
;

197 
	}
}

199 
	$qpŞ_moduË_g‘_ty³
(cÚ¡ 
qpŞ_moduË_t
 * 
moduË
, *
ty³
)

201 ià(!
moduË
 || !
ty³
) {

202 
”ºo
 = 
EINVAL
;

203  
STATUS_ERR
;

206 *
ty³
 = 
moduË
->type;

208  
STATUS_SUCCESS
;

209 
	}
}

211 
	$qpŞ_moduË_g‘_’abËd
(cÚ¡ 
qpŞ_moduË_t
 * 
moduË
, *
’abËd
)

213 ià(!
moduË
 || !
’abËd
) {

214 
”ºo
 = 
EINVAL
;

215  
STATUS_ERR
;

218 *
’abËd
 = 
moduË
->enabled;

220  
STATUS_SUCCESS
;

221 
	}
}

223 
	$qpŞ_moduË_£t_’abËd
(
qpŞ_moduË_t
 * 
moduË
, 
’abËd
)

225 ià(!
moduË
) {

226 
”ºo
 = 
EINVAL
;

227  
STATUS_ERR
;

230 ià(
’abËd
 !ğ
moduË
->’abËd && moduË->
·»Á
) {

231 
moduË
->
·»Á
->
modif›d
 = 1;

233 
moduË
->
’abËd
 =ƒnabled;

235  
STATUS_SUCCESS
;

236 
	}
}

	@libqpol/src/module_compiler.c

18 
	~<cÚfig.h
>

20 
	~<as£¹.h
>

21 
	~<¡d¬g.h
>

22 
	~<¡dlib.h
>

23 
	~<¡ršg.h
>

25 
	~<£pŞ/pŞicydb/pŞicydb.h
>

26 
	~<£pŞ/pŞicydb/avruË_block.h
>

27 
	~<£pŞ/pŞicydb/cÚd™iÚ®.h
>

29 
	~"queue.h
"

30 
	~"moduË_comp”.h
"

32 
	u¡ack_™em_u
 {

33 
avruË_block_t
 *
	mavruË
;

34 
cÚd_li¡_t
 *
	mcÚd_li¡
;

37 
	sscİe_¡ack
 {

38 
¡ack_™em_u
 
	mu
;

39 
	mty³
;

40 
avruË_deş_t
 *
	mdeş
;

42 
avruË_t
 *
	mÏ¡_avruË
;

43 
	mš_–£
;

44 
	m»quœe_giv’
;

45 
scİe_¡ack
 *
	m·»Á
, *
	mchd
;

46 } 
	tscİe_¡ack_t
;

48 
pŞicydb_t
 *
pŞicydbp
;

49 
queue_t
 
id_queue
;

50 
yy”rÜ
(*
msg
);

51 
yy”rÜ2
(*
fmt
, ...);

53 
push_¡ack
(
¡ack_ty³
, ...);

54 
pİ_¡ack
();

57 
scİe_¡ack_t
 *
	g¡ack_tİ
 = 
NULL
;

58 
avruË_block_t
 *
	gÏ¡_block
;

59 
ušt32_t
 
	gÃxt_deş_id
 = 1;

61 
	$defše_pŞicy
(
·ss
, 
moduË_h—d”_giv’
)

63 *
id
;

65 ià(
moduË_h—d”_giv’
) {

66 ià(
pŞicydbp
->
pŞicy_ty³
 !ğ
POLICY_MOD
) {

67 
yy”rÜ


72 ià(
·ss
 == 2) {

73 (
id
 = 
	`queue_»move
(
id_queue
)è!ğ
NULL
)

74 
	`ä“
(
id
);

76 
id
 = (*)
	`queue_»move
(
id_queue
);

77 ià(!
id
) {

78 
	`yy”rÜ
("no module‚ame");

81 
pŞicydbp
->
Çme
 = 
id
;

82 ià((
pŞicydbp
->
v”siÚ
 =

83 
	`queue_»move
(
id_queue
)è=ğ
NULL
) {

84 
yy”rÜ


90 ià(
pŞicydbp
->
pŞicy_ty³
 =ğ
POLICY_MOD
) {

91 
yy”rÜ


98 
Ãxt_deş_id
 = 2;

101 
¡ack_tİ
 !ğ
NULL
) {

102 
	`pİ_¡ack
();

104 ià(
	`push_¡ack
(1, 
pŞicydbp
->
glob®
,…Şicydbp->glob®->
b¿nch_li¡
) ==

108 
Ï¡_block
 = 
pŞicydbp
->
glob®
;

110 
	}
}

117 
	$is_deş¬©iÚ_®lowed
()

119 ià(
¡ack_tİ
->
ty³
 !ğ1 || sck_tİ->
š_–£
) {

123 
	}
}

134 
	$deş¬e_symbŞ
(
ušt32_t
 
symbŞ_ty³
,

135 
hashb_key_t
 
key
, 
hashb_d©um_t
 
d©um
,

136 
ušt32_t
 * 
de¡_v®ue
, ušt32_ˆ* 
d©um_v®ue
)

138 
avruË_deş_t
 *
deş
 = 
¡ack_tİ
->decl;

139 
»tv®
;

142 ià(!
	`is_deş¬©iÚ_®lowed
()) {

145 
»tv®
 = 
	`symb_š£¹
(
pŞicydbp
, 
symbŞ_ty³
, 
key
, 
d©um
,

146 
SCOPE_DECL
, 
deş
->
deş_id
, 
de¡_v®ue
);

147 ià(
»tv®
 =ğ1 && 
de¡_v®ue
) {

148 
symb_d©um_t
 *
s
 =

149 (
symb_d©um_t
 *è
	`hashb_£¬ch
(
pŞicydbp
->

150 
symb
[
symbŞ_ty³
].
bË
,

151 
key
);

152 
	`as£¹
(
s
 !ğ
NULL
);

154 ià(
symbŞ_ty³
 =ğ
SYM_LEVELS
) {

155 *
de¡_v®ue
 = ((
Ëv–_d©um_t
 *)
s
)->
Ëv–
->
£ns
;

157 *
de¡_v®ue
 = 
s
->
v®ue
;

159 } ià(
»tv®
 == -2) {

161 } ià(
»tv®
 < 0) {

165 ià(
d©um_v®ue
 !ğ
NULL
) {

166 ià(
	`eb™m­_£t_b™
(
deş
->
deş¬ed
.
scİe
 + 
symbŞ_ty³
,

167 *
d©um_v®ue
 - 1, 1)) {

171  
»tv®
;

172 
	}
}

174 
	$rŞe_im¶ic™_bounds
(
hashb_t
 
rŞes_b
,

175 *
rŞe_id
, 
rŞe_d©um_t
 *
rŞe
)

177 
rŞe_d©um_t
 *
bounds
;

178 *
bounds_id
, *
d–im
;

180 
d–im
 = 
	`¡¼chr
(
rŞe_id
, '.');

181 ià(!
d–im
)

184 
bounds_id
 = 
	`¡rdup
(
rŞe_id
);

185 ià(!
bounds_id
) {

186 
	`yy”rÜ
("out of memory");

189 
bounds_id
[(
size_t
)(
d–im
 - 
rŞe_id
)] = '\0';

191 
bounds
 = 
	`hashb_£¬ch
(
rŞes_b
, 
bounds_id
);

192 ià(!
bounds
) {

193 
	`yy”rÜ2
("role %s doesn'tƒxist, is implicit bounds of %s",

194 
bounds_id
, 
rŞe_id
);

198 ià(!
rŞe
->
bounds
)

199 
rŞe
->
bounds
 = bounds->
s
.
v®ue
;

200 ià(
rŞe
->
bounds
 !ğbounds->
s
.
v®ue
) {

201 
	`yy”rÜ2
("role %s has inconsistent bounds %s/%s",

202 
rŞe_id
, 
bounds_id
,

203 
pŞicydbp
->
p_rŞe_v®_to_Çme
[
rŞe
->
bounds
 - 1]);

206 
	`ä“
(
bounds_id
);

209 
	}
}

211 
rŞe_d©um_t
 *
	$deş¬e_rŞe
(
i§‰r
)

213 *
id
 = 
	`queue_»move
(
id_queue
), *
de¡_id
 = 
NULL
;

214 
rŞe_d©um_t
 *
rŞe
 = 
NULL
, *
de¡_rŞe
 = NULL;

215 
»tv®
;

216 
ušt32_t
 
v®ue
;

218 ià(
id
 =ğ
NULL
) {

219 
	`yy”rÜ
("no„ole‚ame");

220  
NULL
;

222 ià((
rŞe
 = (
rŞe_d©um_t
 *è
	`m®loc
((*rŞe))è=ğ
NULL
) {

223 
	`yy”rÜ
("Out of memory!");

224 
	`ä“
(
id
);

225  
NULL
;

227 
	`rŞe_d©um_š™
(
rŞe
);

228 
rŞe
->
æavÜ
 = 
i§‰r
 ? 
ROLE_ATTRIB
 : 
ROLE_ROLE
;

229 
»tv®
 =

230 
	`deş¬e_symbŞ
(
SYM_ROLES
, 
id
, (
hashb_d©um_t
 *è
rŞe
, &
v®ue
,

231 &
v®ue
);

232 ià(
»tv®
 == 0) {

233 
rŞe
->
s
.
v®ue
 = value;

234 ià((
de¡_id
 = 
	`¡rdup
(
id
)è=ğ
NULL
) {

235 
	`yy”rÜ
("Out of memory!");

236  
NULL
;

240 
de¡_id
 = 
id
;

241 
	`rŞe_d©um_de¡roy
(
rŞe
);

242 
	`ä“
(
rŞe
);

244 ià(
»tv®
 == 0 ||„etval == 1) {

246 
hashb_t
 
rŞes_b
;

247 
	`as£¹
(
¡ack_tİ
->
ty³
 == 1);

248 ià(
¡ack_tİ
->
·»Á
 =ğ
NULL
) {

250 
rŞes_b
 = 
pŞicydbp
->
p_rŞes
.
bË
;

252 
rŞes_b
 = 
¡ack_tİ
->
deş
->
p_rŞes
.
bË
;

254 
de¡_rŞe
 = (
rŞe_d©um_t
 *è
	`hashb_£¬ch
(
rŞes_b
, 
de¡_id
);

255 ià(
de¡_rŞe
 =ğ
NULL
) {

256 ià((
de¡_rŞe
 =

257 (
rŞe_d©um_t
 *è
	`m®loc
((*
de¡_rŞe
))) ==

258 
NULL
) {

259 
	`yy”rÜ
("Out of memory!");

260 
	`ä“
(
de¡_id
);

261  
NULL
;

263 
	`rŞe_d©um_š™
(
de¡_rŞe
);

264 
de¡_rŞe
->
s
.
v®ue
 = value;

265 
de¡_rŞe
->
æavÜ
 = 
i§‰r
 ? 
ROLE_ATTRIB
 : 
ROLE_ROLE
;

266 ià(
	`rŞe_im¶ic™_bounds
(
rŞes_b
, 
de¡_id
, 
de¡_rŞe
)) {

267 
	`ä“
(
de¡_id
);

268 
	`rŞe_d©um_de¡roy
(
de¡_rŞe
);

269 
	`ä“
(
de¡_rŞe
);

270  
NULL
;

272 ià(
	`hashb_š£¹
(
rŞes_b
, 
de¡_id
, 
de¡_rŞe
)) {

273 
	`yy”rÜ
("Out of memory!");

274 
	`ä“
(
de¡_id
);

275 
	`rŞe_d©um_de¡roy
(
de¡_rŞe
);

276 
	`ä“
(
de¡_rŞe
);

277  
NULL
;

280 
	`ä“
(
de¡_id
);

283 
	`ä“
(
de¡_id
);

285 
»tv®
) {

287 
	`yy”rÜ
("Out of memory!");

288  
NULL
;

291 
	`yy”rÜ
("duplicate declaration of„ole");

292  
NULL
;

295 
	`yy”rÜ
("could‚ot declare„ole here");

296  
NULL
;

299 ià(
eb™m­_£t_b™


300 (&
de¡_rŞe
->
domš©es
, 
rŞe
->
s
.
v®ue
 - 1, 1)) {

301 
	`yy”rÜ
("out of memory");

302  
NULL
;

304  
de¡_rŞe
;

307  
de¡_rŞe
;

310 
	`as£¹
(0);

313 
	}
}

315 
ty³_d©um_t
 *
	$deş¬e_ty³
(
´im¬y
, 
i§‰r
)

317 *
id
;

318 
ty³_d©um_t
 *
typd©um
;

319 
»tv®
;

320 
ušt32_t
 
v®ue
 = 0;

322 
id
 = (*)
	`queue_»move
(
id_queue
);

323 ià(!
id
) {

324 
	`yy”rÜ
("noype/attribute‚ame?");

325  
NULL
;

327 ià(
	`¡rcmp
(
id
, "self") == 0) {

328 
yy”rÜ


330 
	`ä“
(
id
);

331  
NULL
;

334 
typd©um
 = (
ty³_d©um_t
 *è
	`m®loc
((type_datum_t));

335 ià(!
typd©um
) {

336 
	`yy”rÜ
("Out of memory!");

337 
	`ä“
(
id
);

338  
NULL
;

340 
	`ty³_d©um_š™
(
typd©um
);

341 
typd©um
->
´im¬y
 =…rimary;

342 
typd©um
->
æavÜ
 = 
i§‰r
 ? 
TYPE_ATTRIB
 : 
TYPE_TYPE
;

344 
»tv®
 = 
	`deş¬e_symbŞ
(
SYM_TYPES
, 
id
, 
typd©um
, &
v®ue
, &value);

345 ià(
»tv®
 == 0 ||„etval == 1) {

346 ià(
typd©um
->
´im¬y
) {

347 
typd©um
->
s
.
v®ue
 = value;

351 
	`ä“
(
id
);

352 
	`ty³_d©um_de¡roy
(
typd©um
);

353 
	`ä“
(
typd©um
);

355 
»tv®
) {

357 
	`yy”rÜ
("Out of memory!");

358  
NULL
;

361 
	`yy”rÜ2
("duplicate declaration ofype/attribute");

362  
NULL
;

365 
	`yy”rÜ
("could‚ot declareype/attribute here");

366  
NULL
;

370  
typd©um
;

373 
	`as£¹
(0);

376 
	}
}

378 
	$u£r_im¶ic™_bounds
(
hashb_t
 
u£rs_b
,

379 *
u£r_id
, 
u£r_d©um_t
 *
u£r
)

381 
u£r_d©um_t
 *
bounds
;

382 *
bounds_id
, *
d–im
;

384 
d–im
 = 
	`¡¼chr
(
u£r_id
, '.');

385 ià(!
d–im
)

388 
bounds_id
 = 
	`¡rdup
(
u£r_id
);

389 ià(!
bounds_id
) {

390 
	`yy”rÜ
("out of memory");

393 
bounds_id
[(
size_t
)(
d–im
 - 
u£r_id
)] = '\0';

395 
bounds
 = 
	`hashb_£¬ch
(
u£rs_b
, 
bounds_id
);

396 ià(!
bounds
) {

397 
	`yy”rÜ2
("user %s doesn'tƒxist, is implicit bounds of %s",

398 
bounds_id
, 
u£r_id
);

402 ià(!
u£r
->
bounds
)

403 
u£r
->
bounds
 = bounds->
s
.
v®ue
;

404 ià(
u£r
->
bounds
 !ğbounds->
s
.
v®ue
) {

405 
	`yy”rÜ2
("user %s has inconsistent bounds %s/%s",

406 
u£r_id
, 
bounds_id
,

407 
pŞicydbp
->
p_rŞe_v®_to_Çme
[
u£r
->
bounds
 - 1]);

410 
	`ä“
(
bounds_id
);

413 
	}
}

415 
u£r_d©um_t
 *
	$deş¬e_u£r
()

417 *
id
 = 
	`queue_»move
(
id_queue
), *
de¡_id
 = 
NULL
;

418 
u£r_d©um_t
 *
u£r
 = 
NULL
, *
de¡_u£r
 = NULL;

419 
»tv®
;

420 
ušt32_t
 
v®ue
 = 0;

422 ià(
id
 =ğ
NULL
) {

423 
	`yy”rÜ
("no user‚ame");

424  
NULL
;

426 ià((
u£r
 = (
u£r_d©um_t
 *è
	`m®loc
((*u£r))è=ğ
NULL
) {

427 
	`yy”rÜ
("Out of memory!");

428 
	`ä“
(
id
);

429  
NULL
;

431 
	`u£r_d©um_š™
(
u£r
);

433 
»tv®
 =

434 
	`deş¬e_symbŞ
(
SYM_USERS
, 
id
, (
hashb_d©um_t
 *è
u£r
, &
v®ue
,

435 &
v®ue
);

437 ià(
»tv®
 == 0) {

438 
u£r
->
s
.
v®ue
 = value;

439 ià((
de¡_id
 = 
	`¡rdup
(
id
)è=ğ
NULL
) {

440 
	`yy”rÜ
("Out of memory!");

441  
NULL
;

445 
de¡_id
 = 
id
;

446 
	`u£r_d©um_de¡roy
(
u£r
);

447 
	`ä“
(
u£r
);

449 ià(
»tv®
 == 0 ||„etval == 1) {

451 
hashb_t
 
u£rs_b
;

452 
	`as£¹
(
¡ack_tİ
->
ty³
 == 1);

453 ià(
¡ack_tİ
->
·»Á
 =ğ
NULL
) {

455 
u£rs_b
 = 
pŞicydbp
->
p_u£rs
.
bË
;

457 
u£rs_b
 = 
¡ack_tİ
->
deş
->
p_u£rs
.
bË
;

459 
de¡_u£r
 = (
u£r_d©um_t
 *è
	`hashb_£¬ch
(
u£rs_b
, 
de¡_id
);

460 ià(
de¡_u£r
 =ğ
NULL
) {

461 ià((
de¡_u£r
 =

462 (
u£r_d©um_t
 *è
	`m®loc
((*
de¡_u£r
))) ==

463 
NULL
) {

464 
	`yy”rÜ
("Out of memory!");

465 
	`ä“
(
de¡_id
);

466  
NULL
;

468 
	`u£r_d©um_š™
(
de¡_u£r
);

469 
de¡_u£r
->
s
.
v®ue
 = value;

470 ià(
	`u£r_im¶ic™_bounds
(
u£rs_b
, 
de¡_id
, 
de¡_u£r
)) {

471 
	`ä“
(
de¡_id
);

472 
	`u£r_d©um_de¡roy
(
de¡_u£r
);

473 
	`ä“
(
de¡_u£r
);

474  
NULL
;

476 ià(
	`hashb_š£¹
(
u£rs_b
, 
de¡_id
, 
de¡_u£r
)) {

477 
	`yy”rÜ
("Out of memory!");

478 
	`ä“
(
de¡_id
);

479 
	`u£r_d©um_de¡roy
(
de¡_u£r
);

480 
	`ä“
(
de¡_u£r
);

481  
NULL
;

484 
	`ä“
(
de¡_id
);

487 
	`ä“
(
de¡_id
);

489 
»tv®
) {

491 
	`yy”rÜ
("Out of memory!");

492  
NULL
;

495 
	`yy”rÜ
("duplicate declaration of user");

496  
NULL
;

499 
	`yy”rÜ
("could‚ot declare user here");

500  
NULL
;

503  
de¡_u£r
;

506  
de¡_u£r
;

509 
	`as£¹
(0);

512 
	}
}

522 
ty³_d©um_t
 *
	$g‘_loÿl_ty³
(*
id
, 
ušt32_t
 
v®ue
, 
i§‰r
)

524 
ty³_d©um_t
 *
de¡_typd©um
;

525 
hashb_t
 
ty³s_b
;

526 
	`as£¹
(
¡ack_tİ
->
ty³
 == 1);

527 ià(
¡ack_tİ
->
·»Á
 =ğ
NULL
) {

529 
ty³s_b
 = 
pŞicydbp
->
p_ty³s
.
bË
;

531 
ty³s_b
 = 
¡ack_tİ
->
deş
->
p_ty³s
.
bË
;

533 
de¡_typd©um
 = 
	`hashb_£¬ch
(
ty³s_b
, 
id
);

534 ià(!
de¡_typd©um
) {

535 
de¡_typd©um
 = (
ty³_d©um_t
 *è
	`m®loc
((type_datum_t));

536 ià(
de¡_typd©um
 =ğ
NULL
) {

537 
	`ä“
(
id
);

538  
NULL
;

540 
	`ty³_d©um_š™
(
de¡_typd©um
);

541 
de¡_typd©um
->
s
.
v®ue
 = value;

542 
de¡_typd©um
->
æavÜ
 = 
i§‰r
 ? 
TYPE_ATTRIB
 : 
TYPE_TYPE
;

543 
de¡_typd©um
->
´im¬y
 = 1;

544 ià(
	`hashb_š£¹
(
ty³s_b
, 
id
, 
de¡_typd©um
)) {

545 
	`ä“
(
id
);

546 
	`ty³_d©um_de¡roy
(
de¡_typd©um
);

547 
	`ä“
(
de¡_typd©um
);

548  
NULL
;

552 
	`ä“
(
id
);

553 ià(
de¡_typd©um
->
æavÜ
 !ğ
i§‰r
 ? 
TYPE_ATTRIB
 : 
TYPE_TYPE
) {

554  
NULL
;

557  
de¡_typd©um
;

558 
	}
}

568 
rŞe_d©um_t
 *
	$g‘_loÿl_rŞe
(*
id
, 
ušt32_t
 
v®ue
, 
i§‰r
)

570 
rŞe_d©um_t
 *
de¡_rŞed©um
;

571 
hashb_t
 
rŞes_b
;

573 
	`as£¹
(
¡ack_tİ
->
ty³
 == 1);

575 ià(
¡ack_tİ
->
·»Á
 =ğ
NULL
) {

577 
rŞes_b
 = 
pŞicydbp
->
p_rŞes
.
bË
;

579 
rŞes_b
 = 
¡ack_tİ
->
deş
->
p_rŞes
.
bË
;

582 
de¡_rŞed©um
 = 
	`hashb_£¬ch
(
rŞes_b
, 
id
);

583 ià(!
de¡_rŞed©um
) {

584 
de¡_rŞed©um
 = (
rŞe_d©um_t
 *)
	`m®loc
((role_datum_t));

585 ià(
de¡_rŞed©um
 =ğ
NULL
) {

586 
	`ä“
(
id
);

587  
NULL
;

590 
	`rŞe_d©um_š™
(
de¡_rŞed©um
);

591 
de¡_rŞed©um
->
s
.
v®ue
 = value;

592 
de¡_rŞed©um
->
æavÜ
 = 
i§‰r
 ? 
ROLE_ATTRIB
 : 
ROLE_ROLE
;

594 ià(
	`hashb_š£¹
(
rŞes_b
, 
id
, 
de¡_rŞed©um
)) {

595 
	`ä“
(
id
);

596 
	`rŞe_d©um_de¡roy
(
de¡_rŞed©um
);

597 
	`ä“
(
de¡_rŞed©um
);

598  
NULL
;

601 
	`ä“
(
id
);

602 ià(
de¡_rŞed©um
->
æavÜ
 !ğ
i§‰r
 ? 
ROLE_ATTRIB
 : 
ROLE_ROLE
)

603  
NULL
;

606  
de¡_rŞed©um
;

607 
	}
}

613 
	$is_»quœe_®lowed
()

615 ià(
¡ack_tİ
->
ty³
 =ğ1 && !¡ack_tİ->
š_–£
) {

619 
	}
}

629 
	$»quœe_symbŞ
(
ušt32_t
 
symbŞ_ty³
,

630 
hashb_key_t
 
key
, 
hashb_d©um_t
 
d©um
,

631 
ušt32_t
 * 
de¡_v®ue
, ušt32_ˆ* 
d©um_v®ue
)

633 
avruË_deş_t
 *
deş
 = 
¡ack_tİ
->decl;

634 
»tv®
;

637 ià(!
	`is_»quœe_®lowed
()) {

640 
»tv®
 = 
	`symb_š£¹
(
pŞicydbp
, 
symbŞ_ty³
, 
key
, 
d©um
,

641 
SCOPE_REQ
, 
deş
->
deş_id
, 
de¡_v®ue
);

642 ià(
»tv®
 == 1) {

643 
symb_d©um_t
 *
s
 =

644 (
symb_d©um_t
 *è
	`hashb_£¬ch
(
pŞicydbp
->

645 
symb
[
symbŞ_ty³
].
bË
,

646 
key
);

647 
	`as£¹
(
s
 !ğ
NULL
);

649 ià(
symbŞ_ty³
 =ğ
SYM_LEVELS
) {

650 *
de¡_v®ue
 = ((
Ëv–_d©um_t
 *)
s
)->
Ëv–
->
£ns
;

652 *
de¡_v®ue
 = 
s
->
v®ue
;

654 } ià(
»tv®
 == -2) {

657 
´ev_deş¬©iÚ_ok
 = 0;

658 ià(
	`is_id_š_scİe
(
symbŞ_ty³
, 
key
)) {

659 ià(
symbŞ_ty³
 =ğ
SYM_TYPES
) {

662 
Ãw_i§‰r
 =

663 ((
ty³_d©um_t
 *è
d©um
)->
æavÜ
;

664 
ty³_d©um_t
 *
Şd_d©um
 =

665 (
ty³_d©um_t
 *è
	`hashb_£¬ch
(
pŞicydbp
->

666 
symb


667 [
SYM_TYPES
].

668 
bË
, 
key
);

669 
	`as£¹
(
Şd_d©um
 !ğ
NULL
);

670 
Şd_i§‰r
 = 
Şd_d©um
->
æavÜ
;

671 
´ev_deş¬©iÚ_ok
 =

672 (
Şd_i§‰r
 =ğ
Ãw_i§‰r
 ? 1 : 0);

674 
´ev_deş¬©iÚ_ok
 = 1;

677 ià(
´ev_deş¬©iÚ_ok
) {

680 
¡ack_tİ
->
»quœe_giv’
 = 1;

688 } ià(
»tv®
 < 0) {

692 ià(
d©um_v®ue
 !ğ
NULL
) {

693 ià(
	`eb™m­_£t_b™
(
deş
->
»quœed
.
scİe
 + 
symbŞ_ty³
,

694 *
d©um_v®ue
 - 1, 1)) {

698 
¡ack_tİ
->
»quœe_giv’
 = 1;

699  
»tv®
;

700 
	}
}

702 
	$add_³rm_to_şass
(
ušt32_t
 
³rm_v®ue
, ušt32_ˆ
şass_v®ue
)

704 
avruË_deş_t
 *
deş
 = 
¡ack_tİ
->decl;

705 
scİe_šdex_t
 *
scİe
;

707 
	`as£¹
(
³rm_v®ue
 >= 1);

708 
	`as£¹
(
şass_v®ue
 >= 1);

709 
scİe
 = &
deş
->
»quœed
;

710 ià(
şass_v®ue
 > 
scİe
->
şass_³rms_Ën
) {

711 
i
;

712 
eb™m­_t
 *
Ãw_m­
 = 
	`»®loc
(
scİe
->
şass_³rms_m­
,

713 
şass_v®ue
 * (*
Ãw_m­
));

714 ià(
Ãw_m­
 =ğ
NULL
) {

717 
scİe
->
şass_³rms_m­
 = 
Ãw_m­
;

718 
i
 = 
scİe
->
şass_³rms_Ën
; i < 
şass_v®ue
; i++) {

719 
	`eb™m­_š™
(
scİe
->
şass_³rms_m­
 + 
i
);

721 
scİe
->
şass_³rms_Ën
 = 
şass_v®ue
;

723 ià(
	`eb™m­_£t_b™
(
scİe
->
şass_³rms_m­
 + 
şass_v®ue
 - 1,

724 
³rm_v®ue
 - 1, 1)) {

728 
	}
}

730 
³rm_de¡roy
(
hashb_key_t
 
key
, 
hashb_d©um_t
 
d©um
, *
p


731 
__©Œibu‹__
 ((
unu£d
)))

733 ià(
	gkey
)

734 
ä“
(
key
);

735 
ä“
(
d©um
);

739 
	$şass_d©um_de¡roy
(
şass_d©um_t
 * 
şad©um
)

741 ià(
şad©um
 !ğ
NULL
) {

742 
	`hashb_m­
(
şad©um
->
³rmissiÚs
.
bË
, 
³rm_de¡roy
, 
NULL
);

743 
	`hashb_de¡roy
(
şad©um
->
³rmissiÚs
.
bË
);

744 
	`ä“
(
şad©um
);

746 
	}
}

748 
	$»quœe_şass
(
·ss
)

750 *
şass_id
 = 
	`queue_»move
(
id_queue
);

751 *
³rm_id
 = 
NULL
;

752 
şass_d©um_t
 *
d©um
 = 
NULL
;

753 
³rm_d©um_t
 *
³rm
 = 
NULL
;

754 
»t
;

756 ià(
·ss
 == 2) {

757 
	`ä“
(
şass_id
);

758 (
³rm_id
 = 
	`queue_»move
(
id_queue
)è!ğ
NULL
)

759 
	`ä“
(
³rm_id
);

764 ià(
şass_id
 =ğ
NULL
) {

765 
	`yy”rÜ
("no class‚ame for class definition?");

769 ià((
d©um
 = 
	`ÿÎoc
(1, (*d©um))è=ğ
NULL
 ||

770 
	`symb_š™
(&
d©um
->
³rmissiÚs
, 
PERM_SYMTAB_SIZE
)) {

771 
	`yy”rÜ
("Out of memory!");

772 
ş—nup
;

774 
»t
 =

775 
	`»quœe_symbŞ
(
SYM_CLASSES
, 
şass_id
, 
d©um
, &d©um->
s
.
v®ue
,

776 &
d©um
->
s
.
v®ue
);

777 
»t
) {

779 
	`yy”rÜ
("Out of memory!");

780 
	`ä“
(
şass_id
);

781 
	`şass_d©um_de¡roy
(
d©um
);

782 
ş—nup
;

785 
	`yy”rÜ
("duplicate declaration of class");

786 
	`ä“
(
şass_id
);

787 
	`şass_d©um_de¡roy
(
d©um
);

788 
ş—nup
;

791 
	`yy”rÜ
("could‚ot„equire class here");

792 
	`ä“
(
şass_id
);

793 
	`şass_d©um_de¡roy
(
d©um
);

794 
ş—nup
;

798 ià(
	`pŞicydb_šdex_şas£s
(
pŞicydbp
)) {

799 
	`yy”rÜ
("Out of memory!");

800 
ş—nup
;

805 
	`şass_d©um_de¡roy
(
d©um
);

806 
d©um
 =

807 
	`hashb_£¬ch
(
pŞicydbp
->
p_şas£s
.
bË
,

808 
şass_id
);

809 
	`as£¹
(
d©um
);

810 
	`ä“
(
şass_id
);

814 
	`as£¹
(0);

819 (
³rm_id
 = 
	`queue_»move
(
id_queue
)è!ğ
NULL
) {

820 
®loÿ‹d
 = 0;

823 
³rm
 = 
	`hashb_£¬ch
(
d©um
->
³rmissiÚs
.
bË
, 
³rm_id
);

824 ià(!
³rm
 && 
d©um
->
comd©um
)

825 
³rm
 =

826 
	`hashb_£¬ch
(
d©um
->
comd©um
->
³rmissiÚs
.
bË
,

827 
³rm_id
);

828 ià(
³rm
) {

830 
	`ä“
(
³rm_id
);

833 ià(
pŞicydbp
->
pŞicy_ty³
 =ğ
POLICY_BASE
) {

834 
yy”rÜ2


836 
³rm_id
);

837 
	`ä“
(
³rm_id
);

838 
ş—nup
;

840 
®loÿ‹d
 = 1;

841 ià((
³rm
 = 
	`m®loc
((*³rm))è=ğ
NULL
) {

842 
	`yy”rÜ
("Out of memory!");

843 
	`ä“
(
³rm_id
);

844 
ş—nup
;

846 
	`mem£t
(
³rm
, 0, (*perm));

847 
»t
 =

848 
	`hashb_š£¹
(
d©um
->
³rmissiÚs
.
bË
, 
³rm_id
,

849 
³rm
);

850 ià(
»t
) {

851 
	`yy”rÜ
("Out of memory!");

852 
	`ä“
(
³rm_id
);

853 
	`ä“
(
³rm
);

854 
ş—nup
;

856 
³rm
->
s
.
v®ue
 = 
d©um
->
³rmissiÚs
.
Årim
 + 1;

859 ià(
	`add_³rm_to_şass
(
³rm
->
s
.
v®ue
, 
d©um
->s.value) == -1) {

860 
	`yy”rÜ
("Out of memory!");

861 
ş—nup
;

865 ià(
®loÿ‹d
)

866 
d©um
->
³rmissiÚs
.
Årim
++;

869 
ş—nup
:

871 
	}
}

873 
	$»quœe_rŞe_Ü_©Œibu‹
(
·ss
, 
i§‰r
)

875 *
id
 = 
	`queue_»move
(
id_queue
);

876 
rŞe_d©um_t
 *
rŞe
 = 
NULL
;

877 
»tv®
;

878 ià(
·ss
 == 2) {

879 
	`ä“
(
id
);

882 ià(
id
 =ğ
NULL
) {

883 
	`yy”rÜ
("no„ole‚ame");

886 ià((
rŞe
 = 
	`m®loc
((*rŞe))è=ğ
NULL
) {

887 
	`ä“
(
id
);

888 
	`yy”rÜ
("Out of memory!");

891 
	`rŞe_d©um_š™
(
rŞe
);

892 
rŞe
->
æavÜ
 = 
i§‰r
 ? 
ROLE_ATTRIB
 : 
ROLE_ROLE
;

893 
»tv®
 =

894 
	`»quœe_symbŞ
(
SYM_ROLES
, 
id
, (
hashb_d©um_t
 *è
rŞe
,

895 &
rŞe
->
s
.
v®ue
, &role->s.value);

896 ià(
»tv®
 != 0) {

897 
	`ä“
(
id
);

898 
	`rŞe_d©um_de¡roy
(
rŞe
);

899 
	`ä“
(
rŞe
);

901 
»tv®
) {

903 
	`yy”rÜ
("Out of memory!");

907 
	`yy”rÜ
("duplicate declaration of„ole");

911 
	`yy”rÜ
("could‚ot„equire„ole here");

916 ià(
eb™m­_£t_b™


917 (&
rŞe
->
domš©es
,„Şe->
s
.
v®ue
 - 1, 1)) {

918 
	`yy”rÜ
("Out of memory");

927 
	`as£¹
(0);

930 
	}
}

932 
	$»quœe_rŞe
(
·ss
)

934  
	`»quœe_rŞe_Ü_©Œibu‹
(
·ss
, 0);

935 
	}
}

937 
	$»quœe_©Œibu‹_rŞe
(
·ss
)

939  
	`»quœe_rŞe_Ü_©Œibu‹
(
·ss
, 1);

940 
	}
}

942 
	$»quœe_ty³_Ü_©Œibu‹
(
·ss
, 
i§‰r
)

944 *
id
 = 
	`queue_»move
(
id_queue
);

945 
ty³_d©um_t
 *
ty³
 = 
NULL
;

946 
»tv®
;

947 ià(
·ss
 == 2) {

948 
	`ä“
(
id
);

951 ià(
id
 =ğ
NULL
) {

952 
	`yy”rÜ
("noype‚ame");

955 ià((
ty³
 = 
	`m®loc
((*ty³))è=ğ
NULL
) {

956 
	`ä“
(
id
);

957 
	`yy”rÜ
("Out of memory!");

960 
	`ty³_d©um_š™
(
ty³
);

961 
ty³
->
´im¬y
 = 1;

962 
ty³
->
æavÜ
 = 
i§‰r
 ? 
TYPE_ATTRIB
 : 
TYPE_TYPE
;

963 
»tv®
 =

964 
	`»quœe_symbŞ
(
SYM_TYPES
, 
id
, (
hashb_d©um_t
 *è
ty³
,

965 &
ty³
->
s
.
v®ue
, &type->s.value);

966 ià(
»tv®
 != 0) {

967 
	`ä“
(
id
);

968 
	`ä“
(
ty³
);

970 
»tv®
) {

972 
	`yy”rÜ
("Out of memory!");

976 
	`yy”rÜ
("duplicate declaration ofype/attribute");

980 
	`yy”rÜ
("could‚ot„equireype/attribute here");

990 
	`as£¹
(0);

993 
	}
}

995 
	$»quœe_ty³
(
·ss
)

997  
	`»quœe_ty³_Ü_©Œibu‹
(
·ss
, 0);

998 
	}
}

1000 
	$»quœe_©Œibu‹
(
·ss
)

1002  
	`»quœe_ty³_Ü_©Œibu‹
(
·ss
, 1);

1003 
	}
}

1005 
	$»quœe_u£r
(
·ss
)

1007 *
id
 = 
	`queue_»move
(
id_queue
);

1008 
u£r_d©um_t
 *
u£r
 = 
NULL
;

1009 
»tv®
;

1010 ià(
·ss
 == 1) {

1011 
	`ä“
(
id
);

1014 ià(
id
 =ğ
NULL
) {

1015 
	`yy”rÜ
("no user‚ame");

1018 ià((
u£r
 = 
	`m®loc
((*u£r))è=ğ
NULL
) {

1019 
	`ä“
(
id
);

1020 
	`yy”rÜ
("Out of memory!");

1023 
	`u£r_d©um_š™
(
u£r
);

1024 
»tv®
 =

1025 
	`»quœe_symbŞ
(
SYM_USERS
, 
id
, (
hashb_d©um_t
 *è
u£r
,

1026 &
u£r
->
s
.
v®ue
, &user->s.value);

1027 ià(
»tv®
 != 0) {

1028 
	`ä“
(
id
);

1029 
	`u£r_d©um_de¡roy
(
u£r
);

1031 
»tv®
) {

1033 
	`yy”rÜ
("Out of memory!");

1037 
	`yy”rÜ
("duplicate declaration of user");

1041 
	`yy”rÜ
("could‚ot„equire user here");

1051 
	`as£¹
(0);

1054 
	}
}

1056 
	$»quœe_boŞ_tuÇbË
(
·ss
, 
is_tuÇbË
)

1058 *
id
 = 
	`queue_»move
(
id_queue
);

1059 
cÚd_boŞ_d©um_t
 *
boŞd©um
 = 
NULL
;

1060 
»tv®
;

1061 ià(
·ss
 == 2) {

1062 
	`ä“
(
id
);

1065 ià(
id
 =ğ
NULL
) {

1066 
	`yy”rÜ
("no boolean‚ame");

1069 ià((
boŞd©um
 = 
	`ÿÎoc
(1, (*boŞd©um))è=ğ
NULL
) {

1070 
	`cÚd_de¡roy_boŞ
(
id
, 
boŞd©um
, 
NULL
);

1071 
	`yy”rÜ
("Out of memory!");

1074 ià(
is_tuÇbË
)

1075 
boŞd©um
->
æags
 |ğ
COND_BOOL_FLAGS_TUNABLE
;

1076 
»tv®
 =

1077 
	`»quœe_symbŞ
(
SYM_BOOLS
, 
id
, (
hashb_d©um_t
 *è
boŞd©um
,

1078 &
boŞd©um
->
s
.
v®ue
, &booldatum->s.value);

1079 ià(
»tv®
 != 0) {

1080 
	`cÚd_de¡roy_boŞ
(
id
, 
boŞd©um
, 
NULL
);

1082 
»tv®
) {

1084 
	`yy”rÜ
("Out of memory!");

1088 
	`yy”rÜ
("duplicate declaration of boolean");

1092 
	`yy”rÜ
("could‚ot„equire boolean here");

1102 
	`as£¹
(0);

1105 
	}
}

1107 
	$»quœe_boŞ
(
·ss
)

1109  
	`»quœe_boŞ_tuÇbË
(
·ss
, 0);

1110 
	}
}

1112 
	$»quœe_tuÇbË
(
·ss
)

1114  
	`»quœe_boŞ_tuÇbË
(
·ss
, 1);

1115 
	}
}

1117 
	$»quœe_£ns
(
·ss
)

1119 *
id
 = 
	`queue_»move
(
id_queue
);

1120 
Ëv–_d©um_t
 *
Ëv–
 = 
NULL
;

1121 
»tv®
;

1122 ià(
·ss
 == 2) {

1123 
	`ä“
(
id
);

1126 ià(!
id
) {

1127 
	`yy”rÜ
("no sensitivity‚ame");

1130 
Ëv–
 = 
	`m®loc
((
Ëv–_d©um_t
));

1131 ià(!
Ëv–
) {

1132 
	`ä“
(
id
);

1133 
	`yy”rÜ
("Out of memory!");

1136 
	`Ëv–_d©um_š™
(
Ëv–
);

1137 
Ëv–
->Ëv– = 
	`m®loc
((
mls_Ëv–_t
));

1138 ià(!
Ëv–
->level) {

1139 
	`ä“
(
id
);

1140 
	`Ëv–_d©um_de¡roy
(
Ëv–
);

1141 
	`ä“
(
Ëv–
);

1142 
	`yy”rÜ
("Out of memory!");

1145 
	`mls_Ëv–_š™
(
Ëv–
->level);

1146 
»tv®
 = 
	`»quœe_symbŞ
(
SYM_LEVELS
, 
id
, (
hashb_d©um_t
 *è
Ëv–
,

1147 &
Ëv–
->Ëv–->
£ns
, &level->level->sens);

1148 ià(
»tv®
 != 0) {

1149 
	`ä“
(
id
);

1150 
	`mls_Ëv–_de¡roy
(
Ëv–
->level);

1151 
	`ä“
(
Ëv–
->level);

1152 
	`Ëv–_d©um_de¡roy
(
Ëv–
);

1153 
	`ä“
(
Ëv–
);

1155 
»tv®
) {

1157 
	`yy”rÜ
("Out of memory!");

1161 
	`yy”rÜ
("duplicate declaration of sensitivity");

1165 
	`yy”rÜ
("could‚ot„equire sensitivity here");

1175 
	`as£¹
(0);

1178 
	}
}

1180 
	$»quœe_ÿt
(
·ss
)

1182 *
id
 = 
	`queue_»move
(
id_queue
);

1183 
ÿt_d©um_t
 *
ÿt
 = 
NULL
;

1184 
»tv®
;

1185 ià(
·ss
 == 2) {

1186 
	`ä“
(
id
);

1189 ià(!
id
) {

1190 
	`yy”rÜ
("no category‚ame");

1193 
ÿt
 = 
	`m®loc
((
ÿt_d©um_t
));

1194 ià(!
ÿt
) {

1195 
	`ä“
(
id
);

1196 
	`yy”rÜ
("Out of memory!");

1199 
	`ÿt_d©um_š™
(
ÿt
);

1201 
»tv®
 = 
	`»quœe_symbŞ
(
SYM_CATS
, 
id
, (
hashb_d©um_t
 *è
ÿt
,

1202 &
ÿt
->
s
.
v®ue
, &cat->s.value);

1203 ià(
»tv®
 != 0) {

1204 
	`ä“
(
id
);

1205 
	`ÿt_d©um_de¡roy
(
ÿt
);

1206 
	`ä“
(
ÿt
);

1208 
»tv®
) {

1210 
	`yy”rÜ
("Out of memory!");

1214 
	`yy”rÜ
("duplicate declaration of category");

1218 
	`yy”rÜ
("could‚ot„equire category here");

1228 
	`as£¹
(0);

1231 
	}
}

1233 
	$is_scİe_š_¡ack
(
scİe_d©um_t
 * 
scİe
, 
scİe_¡ack_t
 * 
¡ack
)

1235 
i
;

1236 ià(
¡ack
 =ğ
NULL
) {

1239 ià(
¡ack
->
ty³
 == 1) {

1240 
avruË_deş_t
 *
deş
 = 
¡ack
->decl;

1241 
i
 = 0; i < 
scİe
->
deş_ids_Ën
; i++) {

1242 ià(
scİe
->
deş_ids
[
i
] =ğ
deş
->
deş_id
) {

1252  
	`is_scİe_š_¡ack
(
scİe
, 
¡ack
->
·»Á
);

1253 
	}
}

1255 
	$is_id_š_scİe
(
ušt32_t
 
symbŞ_ty³
, 
hashb_key_t
 
id
)

1257 
scİe_d©um_t
 *
scİe
 =

1258 (
scİe_d©um_t
 *è
	`hashb_£¬ch
(
pŞicydbp
->
scİe
[
symbŞ_ty³
].

1259 
bË
, 
id
);

1260 ià(
scİe
 =ğ
NULL
) {

1263  
	`is_scİe_š_¡ack
(
scİe
, 
¡ack_tİ
);

1264 
	}
}

1266 
	$is_³rm_š_scİe_šdex
(
ušt32_t
 
³rm_v®ue
, ušt32_ˆ
şass_v®ue
,

1267 
scİe_šdex_t
 * 
scİe
)

1269 ià(
şass_v®ue
 > 
scİe
->
şass_³rms_Ën
) {

1272 ià(
	`eb™m­_g‘_b™
(
scİe
->
şass_³rms_m­
 + 
şass_v®ue
 - 1,

1273 
³rm_v®ue
 - 1)) {

1277 
	}
}

1279 
	$is_³rm_š_¡ack
(
ušt32_t
 
³rm_v®ue
, ušt32_ˆ
şass_v®ue
,

1280 
scİe_¡ack_t
 * 
¡ack
)

1282 ià(
¡ack
 =ğ
NULL
) {

1285 ià(
¡ack
->
ty³
 == 1) {

1286 
avruË_deş_t
 *
deş
 = 
¡ack
->decl;

1287 ià(
is_³rm_š_scİe_šdex


1288 (
³rm_v®ue
, 
şass_v®ue
, &
deş
->
»quœed
)

1289 || 
	`is_³rm_š_scİe_šdex
(
³rm_v®ue
, 
şass_v®ue
,

1290 &
deş
->
deş¬ed
)) {

1299  
	`is_³rm_š_¡ack
(
³rm_v®ue
, 
şass_v®ue
, 
¡ack
->
·»Á
);

1300 
	}
}

1302 
	$is_³rm_š_scİe
(
hashb_key_t
 
³rm_id
, hashb_key_ˆ
şass_id
)

1304 
şass_d©um_t
 *
şad©um
 =

1305 (
şass_d©um_t
 *è
	`hashb_£¬ch
(
pŞicydbp
->
p_şas£s
.
bË
,

1306 
şass_id
);

1307 
³rm_d©um_t
 *
³rd©um
;

1308 ià(
şad©um
 =ğ
NULL
) {

1311 
³rd©um
 = (
³rm_d©um_t
 *è
	`hashb_£¬ch
(
şad©um
->
³rmissiÚs
.
bË
,

1312 
³rm_id
);

1313 ià(
³rd©um
 =ğ
NULL
) {

1316  
	`is_³rm_š_¡ack
(
³rd©um
->
s
.
v®ue
, 
şad©um
->s.value,

1317 
¡ack_tİ
);

1318 
	}
}

1320 
cÚd_li¡_t
 *
	$g‘_cu¼’t_cÚd_li¡
(
cÚd_li¡_t
 * 
cÚd
)

1324 
avruË_deş_t
 *
deş
 = 
¡ack_tİ
->decl;

1325  
	`g‘_deş_cÚd_li¡
(
pŞicydbp
, 
deş
, 
cÚd
);

1326 
	}
}

1332 
	$­³nd_cÚd_li¡
(
cÚd_li¡_t
 * 
cÚd
)

1334 
cÚd_li¡_t
 *
Şd_cÚd
 = 
	`g‘_cu¼’t_cÚd_li¡
(
cÚd
);

1335 
avruË_t
 *
tmp
;

1336 
	`as£¹
(
Şd_cÚd
 !ğ
NULL
);

1337 ià(
Şd_cÚd
->
avŒue_li¡
 =ğ
NULL
) {

1338 
Şd_cÚd
->
avŒue_li¡
 = 
cÚd
->avtrue_list;

1340 
tmp
 = 
Şd_cÚd
->
avŒue_li¡
;mp->
Ãxt
 !ğ
NULL
;

1341 
tmp
 =mp->
Ãxt
) ;

1342 
tmp
->
Ãxt
 = 
cÚd
->
avŒue_li¡
;

1344 ià(
Şd_cÚd
->
avçl£_li¡
 =ğ
NULL
) {

1345 
Şd_cÚd
->
avçl£_li¡
 = 
cÚd
->avfalse_list;

1347 
tmp
 = 
Şd_cÚd
->
avçl£_li¡
;mp->
Ãxt
 !ğ
NULL
;

1348 
tmp
 =mp->
Ãxt
) ;

1349 
tmp
->
Ãxt
 = 
cÚd
->
avçl£_li¡
;

1352 
Şd_cÚd
->
æags
 |ğ
cÚd
->flags;

1353 
	}
}

1355 
	$­³nd_avruË
(
avruË_t
 * 
avruË
)

1357 
avruË_deş_t
 *
deş
 = 
¡ack_tİ
->decl;

1364 
	`as£¹
(
¡ack_tİ
->
ty³
 == 1);

1366 ià(
¡ack_tİ
->
Ï¡_avruË
 =ğ
NULL
) {

1367 
deş
->
avruËs
 = 
avruË
;

1369 
¡ack_tİ
->
Ï¡_avruË
->
Ãxt
 = 
avruË
;

1371 
¡ack_tİ
->
Ï¡_avruË
 = 
avruË
;

1372 
	}
}

1375 
	$­³nd_rŞe_Œªs
(
rŞe_Œªs_ruË_t
 * 
rŞe_Œ_ruËs
)

1377 
avruË_deş_t
 *
deş
 = 
¡ack_tİ
->decl;

1380 
	`as£¹
(
¡ack_tİ
->
ty³
 == 1);

1382 
rŞe_Œ_ruËs
->
Ãxt
 = 
deş
->role_tr_rules;

1383 
deş
->
rŞe_Œ_ruËs
 =„ole_tr_rules;

1384 
	}
}

1387 
	$­³nd_rŞe_®low
(
rŞe_®low_ruË_t
 * 
rŞe_®low_ruËs
)

1389 
avruË_deş_t
 *
deş
 = 
¡ack_tİ
->decl;

1392 
	`as£¹
(
¡ack_tİ
->
ty³
 == 1);

1394 
rŞe_®low_ruËs
->
Ãxt
 = 
deş
->role_allow_rules;

1395 
deş
->
rŞe_®low_ruËs
 =„ole_allow_rules;

1396 
	}
}

1399 
	$­³nd_f’ame_Œªs
(
f’ame_Œªs_ruË_t
 * 
f’ame_Œªs_ruËs
)

1401 
avruË_deş_t
 *
deş
 = 
¡ack_tİ
->decl;

1404 
	`as£¹
(
¡ack_tİ
->
ty³
 == 1);

1406 
f’ame_Œªs_ruËs
->
Ãxt
 = 
deş
->filename_trans_rules;

1407 
deş
->
f’ame_Œªs_ruËs
 = filename_trans_rules;

1408 
	}
}

1411 
	$­³nd_¿nge_Œªs
(
¿nge_Œªs_ruË_t
 * 
¿nge_Œ_ruËs
)

1413 
avruË_deş_t
 *
deş
 = 
¡ack_tİ
->decl;

1416 
	`as£¹
(
¡ack_tİ
->
ty³
 == 1);

1418 
¿nge_Œ_ruËs
->
Ãxt
 = 
deş
->range_tr_rules;

1419 
deş
->
¿nge_Œ_ruËs
 =„ange_tr_rules;

1420 
	}
}

1422 
	$begš_İtiÚ®
(
·ss
)

1424 
avruË_block_t
 *
block
 = 
NULL
;

1425 
avruË_deş_t
 *
deş
;

1426 ià(
·ss
 == 1) {

1428 ià((
block
 = 
	`avruË_block_ü—‹
()è=ğ
NULL
 ||

1429 (
deş
 = 
	`avruË_deş_ü—‹
(
Ãxt_deş_id
)è=ğ
NULL
) {

1430 
ş—nup
;

1432 
block
->
æags
 |ğ
AVRULE_OPTIONAL
;

1433 
block
->
b¿nch_li¡
 = 
deş
;

1434 
Ï¡_block
->
Ãxt
 = 
block
;

1437 
block
 = 
Ï¡_block
->
Ãxt
;

1438 
	`as£¹
(
block
 !ğ
NULL
 &&

1439 
block
->
b¿nch_li¡
 !ğ
NULL
 &&

1440 
block
->
b¿nch_li¡
->
deş_id
 =ğ
Ãxt_deş_id
);

1441 
deş
 = 
block
->
b¿nch_li¡
;

1443 ià(
	`push_¡ack
(1, 
block
, 
deş
) == -1) {

1444 
ş—nup
;

1446 
¡ack_tİ
->
Ï¡_avruË
 = 
NULL
;

1447 
Ï¡_block
 = 
block
;

1448 
Ãxt_deş_id
++;

1450 
ş—nup
:

1451 
	`yy”rÜ
("Out of memory!");

1452 
	`avruË_block_de¡roy
(
block
);

1454 
	}
}

1456 
	$’d_İtiÚ®
(
·ss
)

1459 
	`pİ_¡ack
();

1461 
	}
}

1463 
	$begš_İtiÚ®_–£
(
·ss
)

1465 
avruË_deş_t
 *
deş
;

1466 
	`as£¹
(
¡ack_tİ
->
ty³
 =ğ1 && sck_tİ->
š_–£
 == 0);

1467 ià(
·ss
 == 1) {

1470 ià((
deş
 = 
	`avruË_deş_ü—‹
(
Ãxt_deş_id
)è=ğ
NULL
) {

1471 
	`yy”rÜ
("Out of memory!");

1474 
¡ack_tİ
->
deş
->
Ãxt
 = decl;

1478 
deş
 = 
¡ack_tİ
->deş->
Ãxt
;

1479 
	`as£¹
(
deş
 !ğ
NULL
 &&

1480 
deş
->
Ãxt
 =ğ
NULL
 && deş->
deş_id
 =ğ
Ãxt_deş_id
);

1482 
¡ack_tİ
->
š_–£
 = 1;

1483 
¡ack_tİ
->
deş
 = decl;

1484 
¡ack_tİ
->
Ï¡_avruË
 = 
NULL
;

1485 
¡ack_tİ
->
»quœe_giv’
 = 0;

1486 
Ãxt_deş_id
++;

1488 
	}
}

1490 
	$cİy_»quœem’ts
(
avruË_deş_t
 * 
de¡
, 
scİe_¡ack_t
 * 
¡ack
)

1492 
i
;

1493 ià(
¡ack
 =ğ
NULL
) {

1496 ià(
¡ack
->
ty³
 == 1) {

1497 
scİe_šdex_t
 *
¤c_scİe
 = &
¡ack
->
deş
->
»quœed
;

1498 
scİe_šdex_t
 *
de¡_scİe
 = &
de¡
->
»quœed
;

1499 
i
 = 0; i < 
SYM_NUM
; i++) {

1500 
eb™m­_t
 *
¤c_b™m­
 = &
¤c_scİe
->
scİe
[
i
];

1501 
eb™m­_t
 *
de¡_b™m­
 = &
de¡_scİe
->
scİe
[
i
];

1502 ià(
	`eb™m­_uniÚ
(
de¡_b™m­
, 
¤c_b™m­
)) {

1503 
	`yy”rÜ
("Out of memory!");

1508 ià(
¤c_scİe
->
şass_³rms_Ën
 > 
de¡_scİe
->class_perms_len) {

1509 
eb™m­_t
 *
Ãw_m­
 =

1510 
	`»®loc
(
de¡_scİe
->
şass_³rms_m­
,

1511 
¤c_scİe
->
şass_³rms_Ën
 *

1512 (*
Ãw_m­
));

1513 ià(
Ãw_m­
 =ğ
NULL
) {

1514 
	`yy”rÜ
("Out of memory!");

1517 
de¡_scİe
->
şass_³rms_m­
 = 
Ãw_m­
;

1518 
i
 = 
de¡_scİe
->
şass_³rms_Ën
;

1519 
i
 < 
¤c_scİe
->
şass_³rms_Ën
; i++) {

1520 
	`eb™m­_š™
(
de¡_scİe
->
şass_³rms_m­
 + 
i
);

1522 
de¡_scİe
->
şass_³rms_Ën
 =

1523 
¤c_scİe
->
şass_³rms_Ën
;

1525 
i
 = 0; i < 
¤c_scİe
->
şass_³rms_Ën
; i++) {

1526 
eb™m­_t
 *
¤c_b™m­
 = &
¤c_scİe
->
şass_³rms_m­
[
i
];

1527 
eb™m­_t
 *
de¡_b™m­
 =

1528 &
de¡_scİe
->
şass_³rms_m­
[
i
];

1529 ià(
	`eb™m­_uniÚ
(
de¡_b™m­
, 
¤c_b™m­
)) {

1530 
	`yy”rÜ
("Out of memory!");

1535  
	`cİy_»quœem’ts
(
de¡
, 
¡ack
->
·»Á
);

1536 
	}
}

1542 
	$’d_avruË_block
(
·ss
)

1544 
avruË_deş_t
 *
deş
 = 
¡ack_tİ
->decl;

1545 
	`as£¹
(
¡ack_tİ
->
ty³
 == 1);

1546 ià(
·ss
 == 2) {

1549 ià(
	`cİy_»quœem’ts
(
deş
, 
¡ack_tİ
->
·»Á
) == -1) {

1554 ià(!
¡ack_tİ
->
š_–£
 && !¡ack_tİ->
»quœe_giv’
) {

1555 ià(
pŞicydbp
->
pŞicy_ty³
 =ğ
POLICY_BASE


1556 && 
¡ack_tİ
->
·»Á
 !ğ
NULL
) {

1561 
	`yy”rÜ
("This block has‚o„equire section.");

1566 
	}
}

1570 
	$push_¡ack
(
¡ack_ty³
, ...)

1572 
scİe_¡ack_t
 *
s
 = 
	`ÿÎoc
(1, (*s));

1573 
va_li¡
 
­
;

1574 ià(
s
 =ğ
NULL
) {

1577 
	`va_¡¬t
(
­
, 
¡ack_ty³
);

1578 
s
->
ty³
 = 
¡ack_ty³
) {

1580 
s
->
u
.
avruË
 = 
	`va_¬g
(
­
, 
avruË_block_t
 *);

1581 
s
->
deş
 = 
	`va_¬g
(
­
, 
avruË_deş_t
 *);

1585 
s
->
u
.
cÚd_li¡
 = 
	`va_¬g
(
­
, 
cÚd_li¡_t
 *);

1590 
	`as£¹
(0);

1592 
	`va_’d
(
­
);

1593 
s
->
·»Á
 = 
¡ack_tİ
;

1594 
s
->
chd
 = 
NULL
;

1595 
¡ack_tİ
 = 
s
;

1597 
	}
}

1601 
	$pİ_¡ack
()

1603 
scİe_¡ack_t
 *
·»Á
;

1604 
	`as£¹
(
¡ack_tİ
 !ğ
NULL
);

1605 
·»Á
 = 
¡ack_tİ
->parent;

1606 ià(
·»Á
 !ğ
NULL
) {

1607 
·»Á
->
chd
 = 
NULL
;

1609 
	`ä“
(
¡ack_tİ
);

1610 
¡ack_tİ
 = 
·»Á
;

1611 
	}
}

	@libqpol/src/module_compiler.h

17 #iâdeà
MODULE_COMPILER_H


18 
	#MODULE_COMPILER_H


	)

21 #ifdef 
__ılu¥lus


26 
	~<£pŞ/pŞicydb/hashb.h
>

32 
defše_pŞicy
(
·ss
, 
moduË_h—d”_giv’
);

40 
deş¬e_symbŞ
(
ušt32_t
 
symbŞ_ty³
,

41 
hashb_key_t
 
key
, 
hashb_d©um_t
 
d©um
,

42 
ušt32_t
 * 
de¡_v®ue
, ušt32_ˆ* 
d©um_v®ue
);

44 
rŞe_d©um_t
 *
deş¬e_rŞe
(
i§‰r
);

45 
ty³_d©um_t
 *
deş¬e_ty³
(
´im¬y
, 
i§‰r
);

46 
u£r_d©um_t
 *
deş¬e_u£r
();

48 
ty³_d©um_t
 *
g‘_loÿl_ty³
(*
id
, 
ušt32_t
 
v®ue
, 
i§‰r
);

49 
rŞe_d©um_t
 *
g‘_loÿl_rŞe
(*
id
, 
ušt32_t
 
v®ue
, 
i§‰r
);

54 
»quœe_symbŞ
(
ušt32_t
 
symbŞ_ty³
,

55 
hashb_key_t
 
key
, 
hashb_d©um_t
 
d©um
,

56 
ušt32_t
 * 
de¡_v®ue
, ušt32_ˆ* 
d©um_v®ue
);

60 
add_³rm_to_şass
(
ušt32_t
 
³rm_v®ue
, ušt32_ˆ
şass_v®ue
);

65 
»quœe_şass
(
·ss
);

66 
»quœe_rŞe
(
·ss
);

67 
»quœe_ty³
(
·ss
);

68 
»quœe_©Œibu‹
(
·ss
);

69 
»quœe_©Œibu‹_rŞe
(
·ss
);

70 
»quœe_u£r
(
·ss
);

71 
»quœe_boŞ
(
·ss
);

72 
»quœe_tuÇbË
(
·ss
);

73 
»quœe_£ns
(
·ss
);

74 
»quœe_ÿt
(
·ss
);

79 
is_id_š_scİe
(
ušt32_t
 
symbŞ_ty³
, 
hashb_key_t
 
id
);

84 
is_³rm_š_scİe
(
hashb_key_t
 
³rm_id
, hashb_key_ˆ
şass_id
);

89 
cÚd_li¡_t
 *
g‘_cu¼’t_cÚd_li¡
(cÚd_li¡_ˆ* 
cÚd
);

92 
­³nd_cÚd_li¡
(
cÚd_li¡_t
 * 
cÚd
);

93 
­³nd_avruË
(
avruË_t
 * 
avruË
);

94 
­³nd_rŞe_Œªs
(
rŞe_Œªs_ruË_t
 * 
rŞe_Œ_ruËs
);

95 
­³nd_rŞe_®low
(
rŞe_®low_ruË_t
 * 
rŞe_®low_ruËs
);

96 
­³nd_¿nge_Œªs
(
¿nge_Œªs_ruË_t
 * 
¿nge_Œ_ruËs
);

97 
­³nd_f’ame_Œªs
(
f’ame_Œªs_ruË_t
 * 
f’ame_Œªs_ruËs
);

103 
begš_İtiÚ®
(
·ss
);

104 
’d_İtiÚ®
(
·ss
);

112 
begš_İtiÚ®_–£
(
·ss
);

118 
’d_avruË_block
(
·ss
);

120 #ifdef 
__ılu¥lus


	@libqpol/src/netifcon_query.c

26 
	~<¡ddef.h
>

27 
	~<¡dlib.h
>

28 
	~<¡dšt.h
>

29 
	~<qpŞ/™”©Ü.h
>

30 
	~<qpŞ/pŞicy.h
>

31 
	~<qpŞ/cÚ‹xt_qu”y.h
>

32 
	~<qpŞ/ÃtifcÚ_qu”y.h
>

33 
	~<£pŞ/pŞicydb/pŞicydb.h
>

34 
	~"qpŞ_š‹º®.h
"

35 
	~"™”©Ü_š‹º®.h
"

37 
	$qpŞ_pŞicy_g‘_ÃtifcÚ_by_Çme
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ *
Çme
, cÚ¡ 
qpŞ_ÃtifcÚ_t
 ** 
ocÚ
)

39 
ocÚ‹xt_t
 *
tmp
 = 
NULL
;

40 
pŞicydb_t
 *
db
 = 
NULL
;

42 ià(
ocÚ
 !ğ
NULL
)

43 *
ocÚ
 = 
NULL
;

45 ià(
pŞicy
 =ğ
NULL
 || 
Çme
 =ğNULL || 
ocÚ
 == NULL) {

46 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

47 
”ºo
 = 
EINVAL
;

48  
STATUS_ERR
;

51 
db
 = &
pŞicy
->
p
->p;

52 
tmp
 = 
db
->
ocÚ‹xts
[
OCON_NETIF
];mp;m°ğtmp->
Ãxt
) {

53 ià(!
	`¡rcmp
(
Çme
, 
tmp
->
u
.name))

57 *
ocÚ
 = (
qpŞ_ÃtifcÚ_t
 *è
tmp
;

59 ià(*
ocÚ
 =ğ
NULL
) {

60 
	`ERR
(
pŞicy
, "could‚Ù fšd‚‘ifcÚ s‹m’ˆfÜ %s", 
Çme
);

61 
”ºo
 = 
ENOENT
;

62  
STATUS_ERR
;

65  
STATUS_SUCCESS
;

66 
	}
}

68 
	$qpŞ_pŞicy_g‘_ÃtifcÚ_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, 
qpŞ_™”©Ü_t
 ** 
™”
)

70 
pŞicydb_t
 *
db
 = 
NULL
;

71 
”rÜ
 = 0;

72 
ocÚ_¡©e_t
 *
os
 = 
NULL
;

74 ià(
™”
 !ğ
NULL
)

75 *
™”
 = 
NULL
;

77 ià(
pŞicy
 =ğ
NULL
 || 
™”
 == NULL) {

78 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

79 
”ºo
 = 
EINVAL
;

80  
STATUS_ERR
;

83 
db
 = &
pŞicy
->
p
->p;

85 
os
 = 
	`ÿÎoc
(1, (
ocÚ_¡©e_t
));

86 ià(
os
 =ğ
NULL
) {

87 
”rÜ
 = 
”ºo
;

88 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

89 
”ºo
 = 
”rÜ
;

90  
STATUS_ERR
;

93 
os
->
h—d
 = os->
cur
 = 
db
->
ocÚ‹xts
[
OCON_NETIF
];

95 ià(
	`qpŞ_™”©Ü_ü—‹
(
pŞicy
, (*)
os
, 
ocÚ_¡©e_g‘_cur
,

96 
ocÚ_¡©e_Ãxt
, 
ocÚ_¡©e_’d
, 
ocÚ_¡©e_size
, 
ä“
, 
™”
)) {

97 
	`ä“
(
os
);

98  
STATUS_ERR
;

101  
STATUS_SUCCESS
;

102 
	}
}

104 
	$qpŞ_ÃtifcÚ_g‘_Çme
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_ÃtifcÚ_t
 * 
ocÚ
, cÚ¡ **
Çme
)

106 
ocÚ‹xt_t
 *
š‹º®_ocÚ
 = 
NULL
;

108 ià(
Çme
 !ğ
NULL
)

109 *
Çme
 = 
NULL
;

111 ià(
pŞicy
 =ğ
NULL
 || 
ocÚ
 =ğNULL || 
Çme
 == NULL) {

112 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

113 
”ºo
 = 
EINVAL
;

114  
STATUS_ERR
;

117 
š‹º®_ocÚ
 = (
ocÚ‹xt_t
 *è
ocÚ
;

118 *
Çme
 = 
š‹º®_ocÚ
->
u
.name;

120  
STATUS_SUCCESS
;

121 
	}
}

123 
	$qpŞ_ÃtifcÚ_g‘_msg_cÚ
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_ÃtifcÚ_t
 * 
ocÚ
, cÚ¡ 
qpŞ_cÚ‹xt_t
 ** 
cÚ‹xt
)

125 
ocÚ‹xt_t
 *
š‹º®_ocÚ
 = 
NULL
;

127 ià(
cÚ‹xt
 !ğ
NULL
)

128 *
cÚ‹xt
 = 
NULL
;

130 ià(
pŞicy
 =ğ
NULL
 || 
ocÚ
 =ğNULL || 
cÚ‹xt
 == NULL) {

131 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

132 
”ºo
 = 
EINVAL
;

133  
STATUS_ERR
;

136 
š‹º®_ocÚ
 = (
ocÚ‹xt_t
 *è
ocÚ
;

137 *
cÚ‹xt
 = (
qpŞ_cÚ‹xt_t
 *è& (
š‹º®_ocÚ
->context[1]);

139  
STATUS_SUCCESS
;

140 
	}
}

142 
	$qpŞ_ÃtifcÚ_g‘_if_cÚ
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_ÃtifcÚ_t
 * 
ocÚ
, cÚ¡ 
qpŞ_cÚ‹xt_t
 ** 
cÚ‹xt
)

144 
ocÚ‹xt_t
 *
š‹º®_ocÚ
 = 
NULL
;

146 ià(
cÚ‹xt
 !ğ
NULL
)

147 *
cÚ‹xt
 = 
NULL
;

149 ià(
pŞicy
 =ğ
NULL
 || 
ocÚ
 =ğNULL || 
cÚ‹xt
 == NULL) {

150 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

151 
”ºo
 = 
EINVAL
;

152  
STATUS_ERR
;

155 
š‹º®_ocÚ
 = (
ocÚ‹xt_t
 *è
ocÚ
;

156 *
cÚ‹xt
 = (
qpŞ_cÚ‹xt_t
 *è& (
š‹º®_ocÚ
->context[0]);

158  
STATUS_SUCCESS
;

159 
	}
}

	@libqpol/src/nodecon_query.c

26 
	~<¡ddef.h
>

27 
	~<¡dlib.h
>

28 
	~<¡dšt.h
>

29 
	~<qpŞ/™”©Ü.h
>

30 
	~<qpŞ/pŞicy.h
>

31 
	~<qpŞ/cÚ‹xt_qu”y.h
>

32 
	~<qpŞ/nodecÚ_qu”y.h
>

33 
	~<£pŞ/pŞicydb/pŞicydb.h
>

34 
	~"qpŞ_š‹º®.h
"

35 
	~"™”©Ü_š‹º®.h
"

37 
	sqpŞ_nodecÚ


39 
ocÚ‹xt_t
 *
	mocÚ
;

40 
	m´ÙocŞ
;

43 
	$qpŞ_pŞicy_g‘_nodecÚ_by_node
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, 
ušt32_t
 
addr
[4], ušt32_ˆ
mask
[4], 
´ÙocŞ
,

44 
qpŞ_nodecÚ_t
 ** 
ocÚ
)

46 
pŞicydb_t
 *
db
 = 
NULL
;

47 
ocÚ‹xt_t
 *
tmp
 = 
NULL
;

48 
”rÜ
 = 0;

50 ià(
ocÚ
 !ğ
NULL
)

51 *
ocÚ
 = 
NULL
;

53 ià(
pŞicy
 =ğ
NULL
 || 
ocÚ
 == NULL) {

54 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

55 
”ºo
 = 
EINVAL
;

56  
STATUS_ERR
;

59 
db
 = &
pŞicy
->
p
->p;

61 
tmp
 = 
db
->
ocÚ‹xts
[(
´ÙocŞ
 =ğ
QPOL_IPV4
 ? 
OCON_NODE
 : 
OCON_NODE6
)];mp;m°ğtmp->
Ãxt
) {

62 ià(
´ÙocŞ
 =ğ
QPOL_IPV4
) {

63 ià(
addr
[0] !ğ
tmp
->
u
.
node
.add¸|| 
mask
[0] !=mp->u.node.mask)

66 ià(
	`memcmp
(
addr
, 
tmp
->
u
.
node6
.addr, 16è|| memcmp(
mask
,mp->u.node6.mask, 16))

69 *
ocÚ
 = 
	`ÿÎoc
(1, (
qpŞ_nodecÚ_t
));

70 ià(*
ocÚ
 =ğ
NULL
) {

71 
”rÜ
 = 
”ºo
;

72 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

73 
”ºo
 = 
”rÜ
;

74  
STATUS_ERR
;

77 (*
ocÚ
)->
´ÙocŞ
 =…rÙocŞ =ğ
QPOL_IPV4
 ? QPOL_IPV4 : 
QPOL_IPV6
;

78 (*
ocÚ
)->ocÚ = 
tmp
;

81 ià(*
ocÚ
 =ğ
NULL
) {

82 
	`ERR
(
pŞicy
, "%s", "could‚ot find‚odecon statement for‚ode");

83 
”ºo
 = 
ENOENT
;

84  
STATUS_ERR
;

87  
STATUS_SUCCESS
;

88 
	}
}

90 
	snode_¡©e


92 
ocÚ_¡©e_t
 *
	mv4¡©e
;

93 
ocÚ_¡©e_t
 *
	mv6¡©e
;

94 } 
	tnode_¡©e_t
;

96 
	$node_¡©e_ä“
(*
ns
)

98 
node_¡©e_t
 *
šs
 = (node_¡©e_ˆ*è
ns
;

100 ià(!
ns
)

103 
	`ä“
(
šs
->
v4¡©e
);

104 
	`ä“
(
šs
->
v6¡©e
);

105 
	`ä“
(
ns
);

106 
	}
}

108 
	$node_¡©e_’d
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

110 
node_¡©e_t
 *
ns
 = 
NULL
;

112 ià(
™”
 =ğ
NULL
 || 
	`qpŞ_™”©Ü_¡©e
(iter) == NULL) {

113 
”ºo
 = 
EINVAL
;

114  
STATUS_ERR
;

117 
ns
 = (
node_¡©e_t
 *è
	`qpŞ_™”©Ü_¡©e
(
™”
);

119  (
ns
->
v4¡©e
->
cur
 =ğ
NULL
 &&‚s->
v6¡©e
->cur == NULL);

120 
	}
}

122 *
	$node_¡©e_g‘_cur
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

124 
node_¡©e_t
 *
ns
 = 
NULL
;

125 
qpŞ_nodecÚ_t
 *
node
 = 
NULL
;

127 ià(
™”
 =ğ
NULL
 || 
	`qpŞ_™”©Ü_¡©e
(™”è=ğNULL || 
	`node_¡©e_’d
(iter)) {

128 
”ºo
 = 
EINVAL
;

129  
NULL
;

132 
ns
 = (
node_¡©e_t
 *è
	`qpŞ_™”©Ü_¡©e
(
™”
);

134 
node
 = 
	`ÿÎoc
(1, (
qpŞ_nodecÚ_t
));

135 ià(!
node
) {

136  
NULL
;

139 
node
->
ocÚ
 = 
ns
->
v4¡©e
->
cur
 ?‚s->v4¡©e->cu¸:‚s->
v6¡©e
->cur;

140 
node
->
´ÙocŞ
 = 
ns
->
v4¡©e
->
cur
 ? 
QPOL_IPV4
 : 
QPOL_IPV6
;

142  
node
;

143 
	}
}

145 
size_t
 
	$node_¡©e_size
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

147 
node_¡©e_t
 *
ns
 = 
NULL
;

148 
size_t
 
couÁ
 = 0;

149 
ocÚ‹xt_t
 *
ocÚ
 = 
NULL
;

151 ià(
™”
 =ğ
NULL
 || 
	`qpŞ_™”©Ü_¡©e
(iter) == NULL) {

152 
”ºo
 = 
EINVAL
;

156 
ns
 = (
node_¡©e_t
 *è
	`qpŞ_™”©Ü_¡©e
(
™”
);

158 ià(
ns
->
v4¡©e
)

159 
ocÚ
 = 
ns
->
v4¡©e
->
h—d
; ocÚ; ocÚ = ocÚ->
Ãxt
)

160 
couÁ
++;

162 ià(
ns
->
v6¡©e
)

163 
ocÚ
 = 
ns
->
v6¡©e
->
h—d
; ocÚ; ocÚ = ocÚ->
Ãxt
)

164 
couÁ
++;

166  
couÁ
;

167 
	}
}

169 
	$node_¡©e_Ãxt
(
qpŞ_™”©Ü_t
 * 
™”
)

171 
node_¡©e_t
 *
ns
 = 
NULL
;

173 ià(
™”
 =ğ
NULL
 || 
	`qpŞ_™”©Ü_¡©e
(iter) == NULL) {

174 
”ºo
 = 
EINVAL
;

175  
STATUS_ERR
;

178 
ns
 = (
node_¡©e_t
 *è
	`qpŞ_™”©Ü_¡©e
(
™”
);

180 ià(
ns
->
v4¡©e
->
cur
 =ğ
NULL
 &&‚s->
v6¡©e
->cur == NULL) {

181 
”ºo
 = 
ERANGE
;

182  
STATUS_ERR
;

185 ià(
ns
->
v4¡©e
->
cur
)

186 
ns
->
v4¡©e
->
cur
 =‚s->v4¡©e->cur->
Ãxt
;

188 
ns
->
v6¡©e
->
cur
 =‚s->v6¡©e->cur->
Ãxt
;

190  
STATUS_SUCCESS
;

191 
	}
}

193 
	$qpŞ_pŞicy_g‘_nodecÚ_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, 
qpŞ_™”©Ü_t
 ** 
™”
)

195 
pŞicydb_t
 *
db
 = 
NULL
;

196 
”rÜ
 = 0;

197 
ocÚ_¡©e_t
 *
v4os
 = 
NULL
, *
v6os
 = NULL;

198 
node_¡©e_t
 *
ns
 = 
NULL
;

200 ià(
™”
 !ğ
NULL
)

201 *
™”
 = 
NULL
;

203 ià(
pŞicy
 =ğ
NULL
 || 
™”
 == NULL) {

204 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

205 
”ºo
 = 
EINVAL
;

206  
STATUS_ERR
;

209 
db
 = &
pŞicy
->
p
->p;

211 
v4os
 = 
	`ÿÎoc
(1, (
ocÚ_¡©e_t
));

212 ià(
v4os
 =ğ
NULL
) {

213 
”rÜ
 = 
”ºo
;

214 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

215 
”ºo
 = 
”rÜ
;

216  
STATUS_ERR
;

218 
v4os
->
h—d
 = v4os->
cur
 = 
db
->
ocÚ‹xts
[
OCON_NODE
];

220 
v6os
 = 
	`ÿÎoc
(1, (
ocÚ_¡©e_t
));

221 ià(
v6os
 =ğ
NULL
) {

222 
”rÜ
 = 
”ºo
;

223 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

224 
	`ä“
(
v4os
);

225 
”ºo
 = 
”rÜ
;

226  
STATUS_ERR
;

228 
v6os
->
h—d
 = v6os->
cur
 = 
db
->
ocÚ‹xts
[
OCON_NODE6
];

230 
ns
 = 
	`ÿÎoc
(1, (
node_¡©e_t
));

231 ià(
ns
 =ğ
NULL
) {

232 
”rÜ
 = 
”ºo
;

233 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

234 
	`ä“
(
v4os
);

235 
	`ä“
(
v6os
);

236 
”ºo
 = 
”rÜ
;

237  
STATUS_ERR
;

239 
ns
->
v4¡©e
 = 
v4os
;

240 
ns
->
v6¡©e
 = 
v6os
;

242 ià(
	`qpŞ_™”©Ü_ü—‹
(
pŞicy
, (*)
ns
, 
node_¡©e_g‘_cur
,

243 
node_¡©e_Ãxt
, 
node_¡©e_’d
, 
node_¡©e_size
, 
node_¡©e_ä“
, 
™”
)) {

244 
	`node_¡©e_ä“
(
ns
);

245  
STATUS_ERR
;

248  
STATUS_SUCCESS
;

249 
	}
}

251 
	$qpŞ_nodecÚ_g‘_addr
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_nodecÚ_t
 * 
ocÚ
, 
ušt32_t
 ** 
addr
, *
´ÙocŞ
)

253 ià(
addr
 !ğ
NULL
)

254 *
addr
 = 
NULL
;

255 ià(
´ÙocŞ
 !ğ
NULL
)

256 *
´ÙocŞ
 = 0;

258 ià(
pŞicy
 =ğ
NULL
 || 
ocÚ
 =ğNULL || 
addr
 =ğNULL || 
´ÙocŞ
 == NULL) {

259 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

260 
”ºo
 = 
EINVAL
;

261  
STATUS_ERR
;

264 *
´ÙocŞ
 = 
ocÚ
->protocol;

266 ià(
ocÚ
->
´ÙocŞ
 =ğ
QPOL_IPV4
) {

267 *
addr
 = &(
ocÚ
->ocÚ->
u
.
node
.addr);

269 *
addr
 = 
ocÚ
->ocÚ->
u
.
node6
.addr;

272  
STATUS_SUCCESS
;

273 
	}
}

275 
	$qpŞ_nodecÚ_g‘_mask
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_nodecÚ_t
 * 
ocÚ
, 
ušt32_t
 ** 
mask
, *
´ÙocŞ
)

277 ià(
mask
 !ğ
NULL
)

278 *
mask
 = 
NULL
;

279 ià(
´ÙocŞ
 !ğ
NULL
)

280 *
´ÙocŞ
 = 0;

282 ià(
pŞicy
 =ğ
NULL
 || 
ocÚ
 =ğNULL || 
mask
 =ğNULL || 
´ÙocŞ
 == NULL) {

283 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

284 
”ºo
 = 
EINVAL
;

285  
STATUS_ERR
;

288 *
´ÙocŞ
 = 
ocÚ
->protocol;

290 ià(
ocÚ
->
´ÙocŞ
 =ğ
QPOL_IPV4
) {

291 *
mask
 = &(
ocÚ
->ocÚ->
u
.
node
.mask);

293 *
mask
 = 
ocÚ
->ocÚ->
u
.
node6
.mask;

296  
STATUS_SUCCESS
;

297 
	}
}

299 
	$qpŞ_nodecÚ_g‘_´ÙocŞ
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_nodecÚ_t
 * 
ocÚ
, *
´ÙocŞ
)

301 ià(
´ÙocŞ
 !ğ
NULL
)

302 *
´ÙocŞ
 = 0;

304 ià(
pŞicy
 =ğ
NULL
 || 
ocÚ
 =ğNULL || 
´ÙocŞ
 == NULL) {

305 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

306 
”ºo
 = 
EINVAL
;

307  
STATUS_ERR
;

310 *
´ÙocŞ
 = 
ocÚ
->protocol;

312  
STATUS_SUCCESS
;

313 
	}
}

315 
	$qpŞ_nodecÚ_g‘_cÚ‹xt
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_nodecÚ_t
 * 
ocÚ
, cÚ¡ 
qpŞ_cÚ‹xt_t
 ** 
cÚ‹xt
)

317 ià(
cÚ‹xt
 !ğ
NULL
)

318 *
cÚ‹xt
 = 
NULL
;

320 ià(
pŞicy
 =ğ
NULL
 || 
ocÚ
 =ğNULL || 
cÚ‹xt
 == NULL) {

321 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

322 
”ºo
 = 
EINVAL
;

323  
STATUS_ERR
;

326 *
cÚ‹xt
 = (
qpŞ_cÚ‹xt_t
 *è& (
ocÚ
->ocon->context[0]);

328  
STATUS_SUCCESS
;

329 
	}
}

	@libqpol/src/permissive_query.c

24 
	~<¡ddef.h
>

25 
	~<¡dlib.h
>

26 
	~<¡dšt.h
>

27 
	~<qpŞ/™”©Ü.h
>

28 
	~<qpŞ/pŞicy.h
>

29 
	~<qpŞ/³rmissive_qu”y.h
>

30 
	~<£pŞ/pŞicydb/pŞicydb.h
>

31 
	~"qpŞ_š‹º®.h
"

32 
	~"™”©Ü_š‹º®.h
"

35 
	$qpŞ_³rmissive_g‘_Çme
(cÚ¡ 
qpŞ_pŞicy_t
 *
pŞicy
, cÚ¡ 
qpŞ_³rmissive_t
 * 
d©um
, cÚ¡ **
Çme
)

37 
ty³_d©um_t
 *
š‹º®_d©um
 = 
NULL
;

38 
pŞicydb_t
 *
db
 = 
NULL
;

40 ià(
pŞicy
 =ğ
NULL
 || 
d©um
 =ğNULL || 
Çme
 == NULL) {

41 ià(
Çme
 !ğ
NULL
)

42 *
Çme
 = 
NULL
;

43 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

44 
”ºo
 = 
EINVAL
;

45  
STATUS_ERR
;

48 
db
 = &
pŞicy
->
p
->p;

49 
š‹º®_d©um
 = (
ty³_d©um_t
 *)
d©um
;

51 *
Çme
 = 
db
->
p_ty³_v®_to_Çme
[
š‹º®_d©um
->
s
.
v®ue
 - 1];

53  
STATUS_SUCCESS
;

54 
	}
}

56 
	$qpŞ_pŞicy_g‘_³rmissive_™”
(cÚ¡ 
qpŞ_pŞicy_t
 *
pŞicy
, 
qpŞ_™”©Ü_t
 **
™”
)

58 
”rÜ
 = 0;

59 
pŞicydb_t
 *
db
;

60 
eb™m­_¡©e_t
 *
¡©e
 = 
NULL
;

62 ià(
™”
) {

63 *
™”
 = 
NULL
;

66 ià(
pŞicy
 =ğ
NULL
 || 
™”
 == NULL) {

67 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

68 
”ºo
 = 
EINVAL
;

69  
STATUS_ERR
;

72 
db
 = &
pŞicy
->
p
->p;

74 
¡©e
 = 
	`ÿÎoc
(1, (
eb™m­_¡©e_t
));

75 ià(
¡©e
 =ğ
NULL
) {

76 
”rÜ
 = 
”ºo
;

77 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

78 
”ºo
 = 
”rÜ
;

79  
STATUS_ERR
;

82 
¡©e
->
bm­
 = &(
db
->
³rmissive_m­
);

83 
¡©e
->
cur
 = s‹->
bm­
->
node
 ? s‹->bm­->node->
¡¬tb™
 : 0;

85 ià(
	`qpŞ_™”©Ü_ü—‹
(
pŞicy
, 
¡©e
, 
eb™m­_¡©e_g‘_cur_³rmissive
,

86 
eb™m­_¡©e_Ãxt
, 
eb™m­_¡©e_’d
, 
eb™m­_¡©e_size
, 
ä“
, 
™”
)) {

87 
	`ä“
(
¡©e
);

88  
STATUS_ERR
;

91 ià(
¡©e
->
bm­
->
node
 && !
	`eb™m­_g‘_b™
(¡©e->bm­, s‹->
cur
))

92 
	`eb™m­_¡©e_Ãxt
(*
™”
);

94  
STATUS_SUCCESS
;

95 
	}
}

	@libqpol/src/polcap_query.c

24 
	~<¡ddef.h
>

25 
	~<¡dlib.h
>

26 
	~<¡dšt.h
>

27 
	~<qpŞ/™”©Ü.h
>

28 
	~<qpŞ/pŞicy.h
>

29 
	~<qpŞ/pŞÿp_qu”y.h
>

30 
	~<£pŞ/pŞicydb/pŞicydb.h
>

31 
	~"qpŞ_š‹º®.h
"

32 
	~"™”©Ü_š‹º®.h
"

35 
	$qpŞ_pŞÿp_g‘_Çme
(cÚ¡ 
qpŞ_pŞicy_t
 *
pŞicy
, cÚ¡ 
qpŞ_pŞÿp_t
 * 
d©um
, cÚ¡ **
Çme
)

37 *
š‹º®_d©um
 = 
NULL
;

39 ià(
pŞicy
 =ğ
NULL
 || 
d©um
 =ğNULL || 
Çme
 == NULL) {

40 ià(
Çme
 !ğ
NULL
)

41 *
Çme
 = 
NULL
;

42 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

43 
”ºo
 = 
EINVAL
;

44  
STATUS_ERR
;

47 
š‹º®_d©um
 = (*è
d©um
;

48 *
Çme
 = 
š‹º®_d©um
;

50  
STATUS_SUCCESS
;

51 
	}
}

53 
	$qpŞ_pŞicy_g‘_pŞÿp_™”
(cÚ¡ 
qpŞ_pŞicy_t
 *
pŞicy
, 
qpŞ_™”©Ü_t
 **
™”
)

55 
”rÜ
 = 0;

56 
pŞicydb_t
 *
db
;

57 
eb™m­_¡©e_t
 *
¡©e
 = 
NULL
;

59 ià(
™”
) {

60 *
™”
 = 
NULL
;

63 ià(
pŞicy
 =ğ
NULL
 || 
™”
 == NULL) {

64 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

65 
”ºo
 = 
EINVAL
;

66  
STATUS_ERR
;

69 
db
 = &
pŞicy
->
p
->p;

71 
¡©e
 = 
	`ÿÎoc
(1, (
eb™m­_¡©e_t
));

72 ià(
¡©e
 =ğ
NULL
) {

73 
”rÜ
 = 
”ºo
;

74 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

75 
”ºo
 = 
”rÜ
;

76  
STATUS_ERR
;

79 
¡©e
->
bm­
 = &(
db
->
pŞicyÿps
);

80 
¡©e
->
cur
 = s‹->
bm­
->
node
 ? s‹->bm­->node->
¡¬tb™
 : 0;

82 ià(
	`qpŞ_™”©Ü_ü—‹
(
pŞicy
, 
¡©e
, 
eb™m­_¡©e_g‘_cur_pŞÿp
,

83 
eb™m­_¡©e_Ãxt
, 
eb™m­_¡©e_’d
, 
eb™m­_¡©e_size
, 
ä“
, 
™”
)) {

84 
	`ä“
(
¡©e
);

85  
STATUS_ERR
;

88 ià(
¡©e
->
bm­
->
node
 && !
	`eb™m­_g‘_b™
(¡©e->bm­, s‹->
cur
))

89 
	`eb™m­_¡©e_Ãxt
(*
™”
);

91  
STATUS_SUCCESS
;

92 
	}
}

	@libqpol/src/policy.c

27 
	~<cÚfig.h
>

29 
	~"qpŞ_š‹º®.h
"

30 
	~<as£¹.h
>

31 
	~<by‹sw­.h
>

32 
	~<’dŸn.h
>

33 
	~<”ºo.h
>

34 
	~<fú.h
>

35 
	~<lim™s.h
>

36 
	~<¡dio.h
>

37 
	~<¡dlib.h
>

38 
	~<sys/mmª.h
>

39 
	~<asm/ty³s.h
>

41 
	~<£pŞ/debug.h
>

42 
	~<£pŞ/hªdË.h
>

43 
	~<£pŞ/pŞicydb/æask_ty³s.h
>

44 
	~<£pŞ/pŞicydb/pŞicydb.h
>

45 
	~<£pŞ/pŞicydb/cÚd™iÚ®.h
>

46 
	~<£pŞ/pŞicydb.h
>

47 
	~<£pŞ/moduË.h
>

48 
	~<£pŞ/pŞicydb/moduË.h
>

49 
	~<£pŞ/pŞicydb/avruË_block.h
>

51 
	~<¡dboŞ.h
>

52 
	~<qpŞ/™”©Ü.h
>

53 
	~<qpŞ/pŞicy.h
>

54 
	~<qpŞ/pŞicy_ex‹nd.h
>

55 
	~"ex·nd.h
"

56 
	~"queue.h
"

57 
	~"™”©Ü_š‹º®.h
"

61 *
	gqpŞ_¤c_Üigš®šput
;

62 *
	gqpŞ_¤c_šput
;

63 *
	gqpŞ_¤c_špuŒ
;

64 *
	gqpŞ_¤c_špuim
;

66 
š™_sÿÂ”
();

67 
yy·r£
();

68 
š™_·r£r
(, );

69 
queue_t
 
id_queue
;

70 
pŞicydb_”rÜs
;

71 
pŞicydb_lš’o
;

72 
sourû_fe
[];

73 
pŞicydb_t
 *
pŞicydbp
;

74 
ml¥Ş
;

76 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


77 
	#ıu_to_Ë16
(
x
è(x)

	)

78 
	#Ë16_to_ıu
(
x
è(x)

	)

79 
	#ıu_to_Ë32
(
x
è(x)

	)

80 
	#Ë32_to_ıu
(
x
è(x)

	)

81 
	#ıu_to_Ë64
(
x
è(x)

	)

82 
	#Ë64_to_ıu
(
x
è(x)

	)

84 
	#ıu_to_Ë16
(
x
è
	`bsw­_16
(x)

	)

85 
	#Ë16_to_ıu
(
x
è
	`bsw­_16
(x)

	)

86 
	#ıu_to_Ë32
(
x
è
	`bsw­_32
(x)

	)

87 
	#Ë32_to_ıu
(
x
è
	`bsw­_32
(x)

	)

88 
	#ıu_to_Ë64
(
x
è
	`bsw­_64
(x)

	)

89 
	#Ë64_to_ıu
(
x
è
	`bsw­_64
(x)

	)

93 
	sfbuf


95 *
	mbuf
;

96 
size_t
 
	msz
;

97 
	m”r
;

98 } 
	tqpŞ_fbuf_t
;

100 
qpŞ_hªdË_rou‹_to_ÿÎback
(*
v¬g


101 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
qpŞ_pŞicy_t
 * 
p
, 
Ëv–
, cÚ¡ *
fmt
,

102 
va_li¡
 
va_¬gs
)

104 ià(!
	gp
 || !Õ->
	gâ
)) {

105 
vårštf
(
¡d”r
, 
fmt
, 
va_¬gs
);

106 
årštf
(
¡d”r
, "\n");

110 
	gp
->
â
(
p
->
v¬g
,…, 
Ëv–
, 
fmt
, 
va_¬gs
);

113 
	$£pŞ_hªdË_rou‹_to_ÿÎback
(*
v¬g
, 
£pŞ_hªdË_t
 * 
sh
, cÚ¡ *
fmt
, ...)

115 
va_li¡
 
­
;

116 
qpŞ_pŞicy_t
 *
p
 = 
v¬g
;

118 ià(!
sh
) {

119 
	`va_¡¬t
(
­
, 
fmt
);

120 
	`vårštf
(
¡d”r
, 
fmt
, 
­
);

121 
	`va_’d
(
­
);

122 
	`årštf
(
¡d”r
, "\n");

126 
	`va_¡¬t
(
­
, 
fmt
);

127 
	`qpŞ_hªdË_rou‹_to_ÿÎback
(
NULL
, 
p
, 
	`£pŞ_msg_g‘_Ëv–
(
sh
), 
fmt
, 
­
);

128 
	`va_’d
(
­
);

129 
	}
}

131 
	$qpŞ_hªdË_msg
(cÚ¡ 
qpŞ_pŞicy_t
 * 
p
, 
Ëv–
, cÚ¡ *
fmt
, ...)

133 
va_li¡
 
­
;

135 ià(!
p
) {

136 
	`va_¡¬t
(
­
, 
fmt
);

137 
	`vårštf
(
¡d”r
, 
fmt
, 
­
);

138 
	`va_’d
(
­
);

139 
	`årštf
(
¡d”r
, "\n");

143 
	`va_¡¬t
(
­
, 
fmt
);

145 
	`qpŞ_hªdË_rou‹_to_ÿÎback
((*)
p
->
v¬g
,…, 
Ëv–
, 
fmt
, 
­
);

146 
	`va_’d
(
­
);

147 
	}
}

149 
qpŞ_hªdË_deçuÉ_ÿÎback
(*
v¬g
 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
qpŞ_pŞicy_t
 * 
p


150 
__©Œibu‹__
 ((
unu£d
)), 
Ëv–
, cÚ¡ *
fmt
, 
va_li¡
 
va_¬gs
)

152 
	gËv–
) {

153 
	gQPOL_MSG_INFO
:

158 
	gQPOL_MSG_WARN
:

160 
årštf
(
¡d”r
, "WARNING: ");

163 
	gQPOL_MSG_ERR
:

166 
årštf
(
¡d”r
, "ERROR: ");

171 
vårštf
(
¡d”r
, 
fmt
, 
va_¬gs
);

172 
årštf
(
¡d”r
, "\n");

175 
	$»ad_sourû_pŞicy
(
qpŞ_pŞicy_t
 * 
qpŞicy
, *
´ogÇme
, 
İtiÚs
)

177 
lßd_ruËs
 = 1;

178 ià(
İtiÚs
 & 
QPOL_POLICY_OPTION_NO_RULES
)

179 
lßd_ruËs
 = 0;

180 ià((
id_queue
 = 
	`queue_ü—‹
()è=ğ
NULL
) {

181 
	`ERR
(
qpŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

185 
pŞicydbp
 = &
qpŞicy
->
p
->p;

186 
ml¥Ş
 = 
pŞicydbp
->
mls
;

188 
	`INFO
(
qpŞicy
, "%s", "Parsing…olicy. (Step 1 of 5)");

189 
	`š™_sÿÂ”
();

190 
	`š™_·r£r
(1, 
lßd_ruËs
);

191 
”ºo
 = 0;

192 ià(
	`yy·r£
(è|| 
pŞicydb_”rÜs
) {

193 
	`ERR
(
qpŞicy
, "%s:ƒ¼Ü(sè’couÁ”ed wh·rsšg cÚfigu¿tiÚ\n", 
´ogÇme
);

194 
	`queue_de¡roy
(
id_queue
);

195 
id_queue
 = 
NULL
;

200 
qpŞ_¤c_špuŒ
 = 
qpŞ_¤c_Üigš®šput
;

201 
	`š™_·r£r
(2, 
lßd_ruËs
);

202 
sourû_fe
[0] = '\0';

203 ià(
	`yy·r£
(è|| 
pŞicydb_”rÜs
) {

204 
	`ERR
(
qpŞicy
, "%s:ƒ¼Ü(sè’couÁ”ed wh·rsšg cÚfigu¿tiÚ\n", 
´ogÇme
);

205 
	`queue_de¡roy
(
id_queue
);

206 
id_queue
 = 
NULL
;

210 
	`queue_de¡roy
(
id_queue
);

211 
id_queue
 = 
NULL
;

212 ià(
pŞicydb_”rÜs
) {

217 
	}
}

219 
	$qpŞ_š™_fbuf
(
qpŞ_fbuf_t
 ** 
fb
)

221 ià(
fb
 =ğ
NULL
)

223 *
fb
 = (
qpŞ_fbuf_t
 *è
	`m®loc
((qpol_fbuf_t));

224 ià(*
fb
 =ğ
NULL
)

226 (*
fb
)->
buf
 = 
NULL
;

227 (*
fb
)->
sz
 = 0;

228 (*
fb
)->
”r
 = 0;

230 
	}
}

232 
	$qpŞ_ä“_fbuf
(
qpŞ_fbuf_t
 ** 
fb
)

234 ià(*
fb
 =ğ
NULL
)

236 ià((*
fb
)->
sz
 > 0 && (*fb)->
buf
 !ğ
NULL
)

237 
	`ä“
((*
fb
)->
buf
);

238 
	`ä“
(*
fb
);

240 
	}
}

242 *
	$qpŞ_»ad_fbuf
(
qpŞ_fbuf_t
 * 
fb
, 
size_t
 
by‹s
, 
FILE
 * 
å
)

244 
size_t
 
sz
;

246 
	`as£¹
(
fb
 !ğ
NULL
 && 
å
 != NULL);

247 
	`as£¹
(!(
fb
->
sz
 > 0 && fb->
buf
 =ğ
NULL
));

249 ià(
fb
->
sz
 == 0) {

250 
fb
->
buf
 = (*)
	`m®loc
(
by‹s
 + 1);

251 
fb
->
sz
 = 
by‹s
 + 1;

252 } ià(
by‹s
 + 1 > 
fb
->
sz
) {

253 
fb
->
buf
 = (*)
	`»®loc
(fb->buf, 
by‹s
 + 1);

254 
fb
->
sz
 = 
by‹s
 + 1;

257 ià(
fb
->
buf
 =ğ
NULL
) {

258 
fb
->
”r
 = -1;

259  
NULL
;

262 
sz
 = 
	`ä—d
(
fb
->
buf
, 
by‹s
, 1, 
å
);

263 ià(
sz
 != 1) {

264 
fb
->
”r
 = -3;

265  
NULL
;

267 
fb
->
”r
 = 0;

268  
fb
->
buf
;

269 
	}
}

271 
	$qpŞ_bšpŞ_v”siÚ
(
FILE
 * 
å
)

273 
__u32
 *
buf
;

274 
¹
, 
Ën
;

275 
qpŞ_fbuf_t
 *
fb
;

277 ià(
å
 =ğ
NULL
)

280 ià(
	`qpŞ_š™_fbuf
(&
fb
) != 0)

284 
buf
 = 
	`qpŞ_»ad_fbuf
(
fb
, (
__u32
è* 2, 
å
);

285 ià(
buf
 =ğ
NULL
) {

286 
¹
 = 
fb
->
”r
;

287 
”r_»tuº
;

289 
buf
[0] = 
	`Ë32_to_ıu
(buf[0]);

290 ià(
buf
[0] !ğ
SELINUX_MAGIC
) {

291 
¹
 = -2;

292 
”r_»tuº
;

295 
Ën
 = 
	`Ë32_to_ıu
(
buf
[1]);

296 ià(
Ën
 < 0) {

297 
¹
 = -3;

298 
”r_»tuº
;

301 ià(
	`f£ek
(
å
, (è* 
Ën
, 
SEEK_CUR
) != 0) {

302 
¹
 = -3;

303 
”r_»tuº
;

307 
buf
 = 
	`qpŞ_»ad_fbuf
(
fb
, (
__u32
è* 1, 
å
);

308 ià(
buf
 =ğ
NULL
) {

309 
¹
 = 
fb
->
”r
;

310 
”r_»tuº
;

312 
buf
[0] = 
	`Ë32_to_ıu
(buf[0]);

314 
¹
 = 
buf
[0];

315 
”r_»tuº
:

316 
	`»wšd
(
å
);

317 
	`qpŞ_ä“_fbuf
(&
fb
);

318  
¹
;

319 
	}
}

321 
	$qpŞ_is_fe_bšpŞ
(
FILE
 * 
å
)

323 
¹
;

324 
size_t
 
sz
;

325 
__u32
 
ubuf
;

327 
sz
 = 
	`ä—d
(&
ubuf
, (
__u32
), 1, 
å
);

328 ià(
sz
 != 1)

329 
¹
 = 0;

331 
ubuf
 = 
	`Ë32_to_ıu
(ubuf);

332 ià(
ubuf
 =ğ
SELINUX_MAGIC
)

333 
¹
 = 1;

335 
¹
 = 0;

336 
	`»wšd
(
å
);

337  
¹
;

338 
	}
}

340 
	$qpŞ_is_d©a_mod_pkg
(* 
d©a
)

342 
size_t
 
sz
;

343 
__u32
 
ubuf
;

345 
	`memıy
(&
ubuf
, 
d©a
, (
__u32
));

347 
ubuf
 = 
	`Ë32_to_ıu
(ubuf);

348 ià(
ubuf
 =ğ
SEPOL_MODULE_PACKAGE_MAGIC
)

352 
	}
}

354 
	$qpŞ_is_fe_mod_pkg
(
FILE
 * 
å
)

356 
size_t
 
sz
;

357 
__u32
 
ubuf
;

358 
¹
;

360 
sz
 = 
	`ä—d
(&
ubuf
, (
__u32
), 1, 
å
);

362 ià(
sz
 != 1)

363 
¹
 = 0;

365 
ubuf
 = 
	`Ë32_to_ıu
(ubuf);

366 ià(
ubuf
 =ğ
SEPOL_MODULE_PACKAGE_MAGIC
)

367 
¹
 = 1;

369 
¹
 = 0;

370 
	`»wšd
(
å
);

371  
¹
;

372 
	}
}

374 
	$šãr_pŞicy_v”siÚ
(
qpŞ_pŞicy_t
 * 
pŞicy
)

376 
pŞicydb_t
 *
db
 = 
NULL
;

377 cÚ¡ 
qpŞ_şass_t
 *
obj_şass
 = 
NULL
;

378 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

379 
qpŞ_fs_u£_t
 *
fsu£
 = 
NULL
;

380 
qpŞ_¿nge_Œªs_t
 *
¿ng‘¿ns
 = 
NULL
;

381 
ušt32_t
 
behaviÜ
 = 0;

382 
size_t
 
nvŒªs
 = 0, 
fsu£x©Œ
 = 0;

383 cÚ¡ *
obj_Çme
 = 
NULL
;

385 ià(!
pŞicy
) {

386 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

387 
”ºo
 = 
EINVAL
;

388  
STATUS_ERR
;

391 
db
 = &
pŞicy
->
p
->p;

393 ià(
db
->
pŞicyv”s
) {

395  
STATUS_SUCCESS
;

399 
	`qpŞ_pŞicy_g‘_fs_u£_™”
(
pŞicy
, &
™”
);

400 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

401 
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
fsu£
);

402 
	`qpŞ_fs_u£_g‘_behaviÜ
(
pŞicy
, 
fsu£
, &
behaviÜ
);

404 ià(
behaviÜ
 =ğ
QPOL_FS_USE_XATTR
) {

405 
fsu£x©Œ
 = 1;

407 } ià(
behaviÜ
 =ğ
QPOL_FS_USE_PSID
) {

408 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

409 
db
->
pŞicyv”s
 = 12;

410  
STATUS_SUCCESS
;

413 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

417 #ifdeà
HAVE_SEPOL_CONSTRAINT_NAMES


418 
db
->
pŞicyv”s
 = 29;

419  
STATUS_SUCCESS
;

428 #ifdeà
HAVE_SEPOL_DEFAULT_TYPE


429 
db
->
pŞicyv”s
 = 28;

430  
STATUS_SUCCESS
;

433 #ifdeà
HAVE_SEPOL_NEW_OBJECT_DEFAULTS


434 
db
->
pŞicyv”s
 = 27;

435  
STATUS_SUCCESS
;

444 #ifdeà
HAVE_SEPOL_FILENAME_TRANS


445 
db
->
pŞicyv”s
 = 25;

446  
STATUS_SUCCESS
;

449 #ifdeà
HAVE_SEPOL_BOUNDARY


450 
db
->
pŞicyv”s
 = 24;

451  
STATUS_SUCCESS
;

454 #ià
	`defšed
(
HAVE_SEPOL_PERMISSIVE_TYPES
è|| defšed(
HAVE_SEPOL_POLICYCAPS
)

455 
eb™m­_node_t
 *
node
 = 
NULL
;

456 
i
 = 0;

460 #ifdeà
HAVE_SEPOL_PERMISSIVE_TYPES


461 
	`eb™m­_fÜ_—ch_b™
(&
db
->
³rmissive_m­
, 
node
, 
i
) {

462 ià(
	`eb™m­_g‘_b™
(&
db
->
³rmissive_m­
, 
i
)) {

463 
db
->
pŞicyv”s
 = 23;

464  
STATUS_SUCCESS
;

470 #ifdeà
HAVE_SEPOL_POLICYCAPS


471 
	`eb™m­_fÜ_—ch_b™
(&
db
->
pŞicyÿps
, 
node
, 
i
) {

472 ià(
	`eb™m­_g‘_b™
(&
db
->
pŞicyÿps
, 
i
)) {

473 
db
->
pŞicyv”s
 = 22;

474  
STATUS_SUCCESS
;

480 
	`qpŞ_pŞicy_g‘_¿nge_Œªs_™”
(
pŞicy
, &
™”
);

481 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

482 
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
¿ng‘¿ns
);

483 
	`qpŞ_¿nge_Œªs_g‘_rg‘_şass
(
pŞicy
, 
¿ng‘¿ns
, &
obj_şass
);

484 
	`qpŞ_şass_g‘_Çme
(
pŞicy
, 
obj_şass
, &
obj_Çme
);

485 ià(
	`¡rcmp
(
obj_Çme
, "process")) {

486 
db
->
pŞicyv”s
 = 21;

487 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

488  
STATUS_SUCCESS
;

491 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

494 
	`qpŞ_pŞicy_g‘_v®id©‘¿ns_™”
(
pŞicy
, &
™”
);

495 
	`qpŞ_™”©Ü_g‘_size
(
™”
, &
nvŒªs
);

496 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

497 ià(
db
->
mls
 || 
nvŒªs
) {

498 
db
->
pŞicyv”s
 = 19;

502 ià(
	`hashb_£¬ch
(
db
->
p_şas£s
.
bË
, (cÚ¡ 
hashb_key_t
)"netlink_audit_socket")) {

503 
db
->
pŞicyv”s
 = 18;

507 ià(
db
->
ocÚ‹xts
[
OCON_NODE6
]) {

508 
db
->
pŞicyv”s
 = 17;

512 ià(
db
->
p_boŞ_v®_to_Çme
 && db->p_bool_val_to_name[0]) {

513 
db
->
pŞicyv”s
 = 16;

517 ià(
fsu£x©Œ
) {

518 
db
->
pŞicyv”s
 = 15;

523 
db
->
pŞicyv”s
 = 12;

526  
STATUS_SUCCESS
;

527 
	}
}

530 
	ssymbŞ_´unšg_¡©e


532 
qpŞ_pŞicy_t
 *
	mp
;

533 
	msymbŞ_ty³
;

544 
	$check_di§bËd
(
hashb_key_t
 
key
, 
hashb_d©um_t
 
d©um
, *
¬gs
)

546 
symbŞ_´unšg_¡©e
 *
s
 = 
¬gs
;

547 ià(!
	`is_id_’abËd
((*)
key
, &(
s
->
p
->p->p), s->
symbŞ_ty³
))

550 
	}
}

559 
	$»move_symbŞ
(
hashb_key_t
 
key
, 
hashb_d©um_t
 
d©um
, *
¬gs
)

561 
symbŞ_´unšg_¡©e
 *
s
 = 
¬gs
;

562 
s
->
symbŞ_ty³
) {

563 
SYM_ROLES
:

565 
	`rŞe_d©um_de¡roy
((
rŞe_d©um_t
 *è
d©um
);

568 
SYM_TYPES
:

570 
	`ty³_d©um_de¡roy
((
ty³_d©um_t
 *è
d©um
);

573 
SYM_USERS
:

575 
	`u£r_d©um_de¡roy
((
u£r_d©um_t
 *è
d©um
);

578 
SYM_BOOLS
:

583 
SYM_LEVELS
:

585 
	`Ëv–_d©um_de¡roy
((
Ëv–_d©um_t
 *è
d©um
);

588 
SYM_CATS
:

590 
	`ÿt_d©um_de¡roy
((
ÿt_d©um_t
 *è
d©um
);

596 
	`ä“
(
key
);

597 
	`ä“
(
d©um
);

598 
	}
}

608 
	$´uÃ_di§bËd_symbŞs
(
qpŞ_pŞicy_t
 * 
pŞicy
)

610 ià(
pŞicy
->
ty³
 =ğ
QPOL_POLICY_KERNEL_BINARY
)

612 
symbŞ_´unšg_¡©e
 
¡©e
;

613 
¡©e
.
p
 = 
pŞicy
;

614 
¡©e
.
symbŞ_ty³
 = 
SYM_ROLES
; s‹.symbŞ_ty³ < 
SYM_NUM
; state.symbol_type++) {

615 
	`hashb_m­_»move_Ú_”rÜ
(
pŞicy
->
p
->p.
symb
[
¡©e
.
symbŞ_ty³
].
bË
, 
check_di§bËd
, 
»move_symbŞ
, &state);

618 
	}
}

626 
	$uniÚ_muÉly_deş¬ed_symbŞs
(
qpŞ_pŞicy_t
 * 
pŞicy
) {

634 
qpŞ_™”©Ü_t
 * 
™”
 = 
NULL
;

635 
”rÜ
 = 0;

636 ià(
	`qpŞ_pŞicy_g‘_ty³_™”
(
pŞicy
, &
™”
)) {

639 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

640 
ty³_d©um_t
 *
©Œ
;

641 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
©Œ
)) {

642 
”rÜ
 = 
”ºo
;

643 
”r
;

645 
i§‰r
 = 0;

646 ià(
	`qpŞ_ty³_g‘_i§‰r
(
pŞicy
, 
©Œ
, &
i§‰r
)) {

647 
”rÜ
 = 
”ºo
;

648 
”r
;

650 ià(!
i§‰r
)

652 cÚ¡ *
Çme
;

653 ià(
	`qpŞ_ty³_g‘_Çme
(
pŞicy
, (
qpŞ_ty³_t
*)
©Œ
, &
Çme
)) {

654 
”rÜ
 = 
”ºo
;

655 
”r
;

657 
pŞicydb_t
 *
db
 = &
pŞicy
->
p
->p;

658 
avruË_block_t
 *
blk
 = 
db
->
glob®
;

659 ; 
blk
; blk = blk->
Ãxt
) {

660 
avruË_deş_t
 *
deş
 = 
blk
->
’abËd
;

661 ià(!
deş
)

663 
ty³_d©um_t
 *
š‹º®_d©um
 = 
	`hashb_£¬ch
(
deş
->
symb
[
SYM_TYPES
].
bË
, (cÚ¡ 
hashb_key_t
)
Çme
);

664 ià(
š‹º®_d©um
 =ğ
NULL
) {

667 ià(
	`eb™m­_uniÚ
(&
©Œ
->
ty³s
, &
š‹º®_d©um
->types))

669 
”rÜ
 = 
”ºo
;

670 
	`ERR
(
pŞicy
, "could‚Ù m”gdeş¬©iÚ fÜ‡‰ribu‹ %s", 
Çme
);

671 
”r
;

675 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

678 ià(
	`qpŞ_pŞicy_g‘_rŞe_™”
(
pŞicy
, &
™”
)) {

681 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

682 
rŞe_d©um_t
 *
rŞe
;

683 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
rŞe
)) {

684 
”rÜ
 = 
”ºo
;

685 
”r
;

687 cÚ¡ *
Çme
;

688 ià(
	`qpŞ_rŞe_g‘_Çme
(
pŞicy
, (
qpŞ_rŞe_t
*)
rŞe
, &
Çme
)) {

689 
”rÜ
 = 
”ºo
;

690 
”r
;

692 
pŞicydb_t
 *
db
 = &
pŞicy
->
p
->p;

693 
scİe_d©um_t
* 
scİe_d©um
 = 
	`hashb_£¬ch
(
db
->
scİe
[
SYM_ROLES
].
bË
, (cÚ¡ 
hashb_key_t
)
Çme
);

694 ià(
scİe_d©um
 =ğ
NULL
) {

695 
	`ERR
(
pŞicy
, "could‚Ù fšd scİd©um fÜ„Ş%s", 
Çme
);

696 
”rÜ
 = 
ENOENT
;

697 
”r
;

699 
ušt32_t
 
i
 = 0; i < 
scİe_d©um
->
deş_ids_Ën
; i++)

701 ià(
db
->
deş_v®_to_¡ruù
[
scİe_d©um
->
deş_ids
[
i
] - 1]->
’abËd
 == 0)

703 
rŞe_d©um_t
 *
š‹º®_d©um
 = 
	`hashb_£¬ch
(
db
->
deş_v®_to_¡ruù
[
scİe_d©um
->
deş_ids
[
i
] - 1]->
symb
[
SYM_ROLES
].
bË
, (cÚ¡ 
hashb_key_t
)
Çme
);

704 ià(
š‹º®_d©um
 =ğ
NULL
) {

707 ià(
	`eb™m­_uniÚ
(&
rŞe
->
ty³s
.ty³s, &
š‹º®_d©um
->ty³s.ty³sè||ƒb™m­_uniÚ(&rŞe->
domš©es
, &internal_datum->dominates))

709 
”rÜ
 = 
”ºo
;

710 
	`ERR
(
pŞicy
, "could‚Ù m”gdeş¬©iÚ fÜ„Ş%s", 
Çme
);

711 
”r
;

715 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

718 ià(
	`qpŞ_pŞicy_g‘_u£r_™”
(
pŞicy
, &
™”
)) {

721 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

722 
u£r_d©um_t
 *
u£r
;

723 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
u£r
)) {

724 
”rÜ
 = 
”ºo
;

725 
”r
;

727 cÚ¡ *
Çme
;

728 ià(
	`qpŞ_u£r_g‘_Çme
(
pŞicy
, (
qpŞ_u£r_t
*)
u£r
, &
Çme
)) {

729 
”rÜ
 = 
”ºo
;

730 
”r
;

732 
pŞicydb_t
 *
db
 = &
pŞicy
->
p
->p;

733 
scİe_d©um_t
* 
scİe_d©um
 = 
	`hashb_£¬ch
(
db
->
scİe
[
SYM_USERS
].
bË
, (cÚ¡ 
hashb_key_t
)
Çme
);

734 ià(
scİe_d©um
 =ğ
NULL
) {

735 
	`ERR
(
pŞicy
, "could‚Ù fšd scİd©um fÜ u£¸%s", 
Çme
);

736 
”rÜ
 = 
ENOENT
;

737 
”r
;

739 
ušt32_t
 
i
 = 0; i < 
scİe_d©um
->
deş_ids_Ën
; i++)

741 ià(
db
->
deş_v®_to_¡ruù
[
scİe_d©um
->
deş_ids
[
i
] - 1]->
’abËd
 == 0)

743 
u£r_d©um_t
 *
š‹º®_d©um
 = 
	`hashb_£¬ch
(
db
->
deş_v®_to_¡ruù
[
scİe_d©um
->
deş_ids
[
i
] -1 ]->
symb
[
SYM_USERS
].
bË
, (cÚ¡ 
hashb_key_t
)
Çme
);

744 ià(
š‹º®_d©um
 =ğ
NULL
) {

747 ià(
	`eb™m­_uniÚ
(&
u£r
->
rŞes
.rŞes, &
š‹º®_d©um
->roles.roles))

749 
”rÜ
 = 
”ºo
;

750 
	`ERR
(
pŞicy
, "could‚Ù m”gdeş¬©iÚ fÜ u£¸%s", 
Çme
);

751 
”r
;

755 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

758 
”r
:

759 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

760 
”ºo
 = 
”rÜ
;

762 
	}
}

765 
	gqpŞ_ex‹nded_image
;

766 
qpŞ_ex‹nded_image_de¡roy
(
qpŞ_ex‹nded_image
 **
ext
);

768 #ià
LINK_SHARED
 == 1

769 
__asm__
(".symver qpol_policy_open_from_file_old,qpol_policy_open_from_file@");

770 
__asm__
(".symver qpol_policy_open_from_file_opt,qpol_policy_open_from_file@@VERS_1.3");

771 
__asm__
(".symver qpol_policy_open_from_memory_old,qpol_policy_open_from_memory@");

772 
__asm__
(".symver qpol_policy_open_from_memory_opt,qpol_policy_open_from_memory@VERS_1.3");

773 
__asm__
(".symver qpol_policy_rebuild_old,qpol_policy_rebuild@");

774 
__asm__
(".symver qpol_policy_rebuild_opt,qpol_policy_rebuild@@VERS_1.3");

784 
	$qpŞ_pŞicy_»bud_İt
(
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
İtiÚs
)

786 
£pŞ_pŞicydb_t
 *
Şd_p
 = 
NULL
;

787 
£pŞ_pŞicydb_t
 **
moduËs
 = 
NULL
;

788 
qpŞ_moduË_t
 *
ba£
 = 
NULL
;

789 
size_t
 
num_moduËs
 = 0, 
i
;

790 
”rÜ
 = 0, 
Şd_İtiÚs
;

792 ià(!
pŞicy
) {

793 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
EINVAL
));

794 
”ºo
 = 
EINVAL
;

795  
STATUS_ERR
;

799 ià(
pŞicy
->
ty³
 =ğ
QPOL_POLICY_KERNEL_BINARY
)

800  
STATUS_SUCCESS
;

803 ià(
İtiÚs
 =ğ
pŞicy
->İtiÚ &&…Şicy->
modif›d
 == 0)

804  
STATUS_SUCCESS
;

807 
Şd_p
 = 
pŞicy
->
p
;

808 
pŞicy
->
p
 = 
NULL
;

809 
qpŞ_ex‹nded_image
 *
ext
 = 
pŞicy
->ext;

810 
pŞicy
->
ext
 = 
NULL
;

811 
Şd_İtiÚs
 = 
pŞicy
->
İtiÚs
;

812 
pŞicy
->
İtiÚs
 = options;

815 ià(
pŞicy
->
İtiÚs
 & 
QPOL_POLICY_OPTION_NO_RULES
)

816 
pŞicy
->
İtiÚs
 |ğ
QPOL_POLICY_OPTION_NO_NEVERALLOWS
;

818 ià(
pŞicy
->
ty³
 =ğ
QPOL_POLICY_MODULE_BINARY
) {

820 ià(!(
moduËs
 = 
	`ÿÎoc
(
pŞicy
->
num_moduËs
, (
£pŞ_pŞicydb_t
 *)))) {

821 
”rÜ
 = 
”ºo
;

822 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

823 
”r
;

826 
i
 = 1; i < 
pŞicy
->
num_moduËs
; i++) {

827 ià((
pŞicy
->
moduËs
[
i
])->
’abËd
) {

828 
moduËs
[
num_moduËs
++] = (
pŞicy
->moduËs[
i
])->
p
;

832 ià(
	`qpŞ_moduË_ü—‹_äom_fe
((
pŞicy
->
moduËs
[0])->
·th
, &
ba£
)) {

833 
”rÜ
 = 
”ºo
;

834 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

835 
”r
;

838 
pŞicy
->
p
 = 
ba£
->p;

839 
ba£
->
p
 = 
NULL
;

840 
	`qpŞ_moduË_de¡roy
(&
ba£
);

841 ià(
	`£pŞ_lšk_moduËs
(
pŞicy
->
sh
,…Şicy->
p
, 
moduËs
, 
num_moduËs
, 0)) {

842 
”rÜ
 = 
EIO
;

843 
”r
;

845 
	`ä“
(
moduËs
);

848 ià(
	`£pŞ_pŞicydb_ü—‹
(&(
pŞicy
->
p
))) {

849 
”rÜ
 = 
”ºo
;

850 
”r
;

853 
qpŞ_¤c_šput
 = 
pŞicy
->
fe_d©a
;

854 
qpŞ_¤c_špuŒ
 = 
qpŞ_¤c_šput
;

855 
qpŞ_¤c_špuim
 = 
qpŞ_¤c_špuŒ
 + 
pŞicy
->
fe_d©a_sz
 - 1;

856 
qpŞ_¤c_Üigš®šput
 = 
qpŞ_¤c_šput
;

859 
pŞicy
->
p
->p.
pŞicy_ty³
 = 
POLICY_BASE
;

860 ià(
	`»ad_sourû_pŞicy
(
pŞicy
, "·r£",…Şicy->
İtiÚs
) < 0) {

861 
”rÜ
 = 
”ºo
;

862 
”r
;

866 
	`INFO
(
pŞicy
, "%s", "Linking source…olicy. (Step 2 of 5)");

867 ià(
	`£pŞ_lšk_moduËs
(
pŞicy
->
sh
,…Şicy->
p
, 
NULL
, 0, 0)) {

868 
”rÜ
 = 
EIO
;

869 
”r
;

871 
	`avb_de¡roy
(&(
pŞicy
->
p
->p.
‹_avb
));

872 
	`avb_de¡roy
(&(
pŞicy
->
p
->p.
‹_cÚd_avb
));

873 
	`avb_š™
(&(
pŞicy
->
p
->p.
‹_avb
));

874 
	`avb_š™
(&(
pŞicy
->
p
->p.
‹_cÚd_avb
));

877 ià(
	`´uÃ_di§bËd_symbŞs
(
pŞicy
)) {

878 
”rÜ
 = 
”ºo
;

879 
”r
;

882 ià(
	`uniÚ_muÉly_deş¬ed_symbŞs
(
pŞicy
)) {

883 
”rÜ
 = 
”ºo
;

884 
”r
;

887 ià(
	`qpŞ_ex·nd_moduË
(
pŞicy
, !ÕŞicy->
İtiÚs
 & (
QPOL_POLICY_OPTION_NO_NEVERALLOWS
)))) {

888 
”rÜ
 = 
”ºo
;

889 
”r
;

892 ià(
	`šãr_pŞicy_v”siÚ
(
pŞicy
)) {

893 
”rÜ
 = 
”ºo
;

894 
”r
;

897 ià(
	`pŞicy_ex‹nd
(
pŞicy
)) {

898 
”rÜ
 = 
”ºo
;

899 
”r
;

901 
	`qpŞ_ex‹nded_image_de¡roy
(&
ext
);

903 
	`£pŞ_pŞicydb_ä“
(
Şd_p
);

905  
STATUS_SUCCESS
;

907 
”r
:

908 
	`ä“
(
moduËs
);

910 
pŞicy
->
p
 = 
Şd_p
;

911 
pŞicy
->
ext
 =ƒxt;

912 
pŞicy
->
İtiÚs
 = 
Şd_İtiÚs
;

913 
”ºo
 = 
”rÜ
;

914  
STATUS_ERR
;

915 
	}
}

917 #ià
LINK_SHARED
 == 0

918 
	$qpŞ_pŞicy_»bud
(
qpŞ_pŞicy_t
 * 
pŞicy
, 
İtiÚs
)

920  
	`qpŞ_pŞicy_»bud_İt
(
pŞicy
, 
İtiÚs
);

921 
	}
}

929 
	$qpŞ_pŞicy_»bud_Şd
(
qpŞ_pŞicy_t
 * 
pŞicy
)

931 ià(!
pŞicy
) {

932 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
EINVAL
));

933 
”ºo
 = 
EINVAL
;

934  
STATUS_ERR
;

938 ià(
pŞicy
->
ty³
 !ğ
QPOL_POLICY_MODULE_BINARY
) {

939 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOTSUP
));

940 
”ºo
 = 
ENOTSUP
;

941  
STATUS_ERR
;

944 ià(!
pŞicy
->
modif›d
)

945  
STATUS_SUCCESS
;

947  
	`qpŞ_pŞicy_»bud_İt
(
pŞicy
,…Şicy->
İtiÚs
);

948 
	}
}

957 
	$qpŞ_pŞicy_İ’_äom_fe_İt
(cÚ¡ *
·th
, 
qpŞ_pŞicy_t
 ** 
pŞicy
, 
qpŞ_ÿÎback_â_t
 
â
, *
v¬g
, cÚ¡ 
İtiÚs
)

959 
”rÜ
 = 0, 
»tv
 = -1;

960 
FILE
 *
šfe
 = 
NULL
;

961 
£pŞ_pŞicy_fe_t
 *
pfe
 = 
NULL
;

962 
qpŞ_moduË_t
 *
mod
 = 
NULL
;

963 
fd
 = 0;

964 
¡©
 
sb
;

966 ià(
pŞicy
 !ğ
NULL
)

967 *
pŞicy
 = 
NULL
;

969 ià(
·th
 =ğ
NULL
 || 
pŞicy
 == NULL) {

971 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
EINVAL
));

972 
”ºo
 = 
EINVAL
;

976 
”ºo
 = 0;

977 ià(!(*
pŞicy
 = 
	`ÿÎoc
(1, (
qpŞ_pŞicy_t
)))) {

978 
”rÜ
 = 
”ºo
;

979 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
”rÜ
));

980 
”r
;

982 (*
pŞicy
)->
İtiÚs
 = options;

985 ià((*
pŞicy
)->
İtiÚs
 & 
QPOL_POLICY_OPTION_NO_RULES
)

986 (*
pŞicy
)->
İtiÚs
 |ğ
QPOL_POLICY_OPTION_NO_NEVERALLOWS
;

988 (*
pŞicy
)->
sh
 = 
	`£pŞ_hªdË_ü—‹
();

989 ià((*
pŞicy
)->
sh
 =ğ
NULL
) {

990 
”rÜ
 = 
”ºo
;

991 
	`ERR
(*
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

992 
”ºo
 = 
”rÜ
;

996 ià(
â
) {

997 (*
pŞicy
)->
â
 = fn;

998 (*
pŞicy
)->
v¬g
 = varg;

1000 (*
pŞicy
)->
â
 = 
qpŞ_hªdË_deçuÉ_ÿÎback
;

1002 
	`£pŞ_msg_£t_ÿÎback
((*
pŞicy
)->
sh
, 
£pŞ_hªdË_rou‹_to_ÿÎback
, (*policy));

1004 ià(
	`£pŞ_pŞicydb_ü—‹
(&((*
pŞicy
)->
p
))) {

1005 
”rÜ
 = 
”ºo
;

1006 
”r
;

1009 ià(
	`£pŞ_pŞicy_fe_ü—‹
(&
pfe
)) {

1010 
”rÜ
 = 
”ºo
;

1011 
”r
;

1014 
šfe
 = 
	`fİ’
(
·th
, "rb");

1015 ià(
šfe
 =ğ
NULL
) {

1016 
”rÜ
 = 
”ºo
;

1017 
”r
;

1020 
	`£pŞ_pŞicy_fe_£t_hªdË
(
pfe
, (*
pŞicy
)->
sh
);

1022 
”ºo
=0;

1023 ià(
	`qpŞ_is_fe_bšpŞ
(
šfe
)) {

1024 (*
pŞicy
)->
ty³
 = 
»tv
 = 
QPOL_POLICY_KERNEL_BINARY
;

1025 
	`£pŞ_pŞicy_fe_£t_å
(
pfe
, 
šfe
);

1026 ià(
	`£pŞ_pŞicydb_»ad
((*
pŞicy
)->
p
, 
pfe
)) {

1028 
”r
;

1031 (*
pŞicy
)->
İtiÚs
 |ğ
QPOL_POLICY_OPTION_NO_NEVERALLOWS
;

1032 (*
pŞicy
)->
İtiÚs
 &ğ~(
QPOL_POLICY_OPTION_NO_RULES
);

1033 ià(
	`pŞicy_ex‹nd
(*
pŞicy
)) {

1034 
”rÜ
 = 
”ºo
;

1035 
”r
;

1037 } ià(
	`qpŞ_moduË_ü—‹_äom_fe
(
·th
, &
mod
è=ğ
STATUS_SUCCESS
) {

1038 (*
pŞicy
)->
ty³
 = 
»tv
 = 
QPOL_POLICY_MODULE_BINARY
;

1040 ià(
	`qpŞ_pŞicy_­³nd_moduË
(*
pŞicy
, 
mod
)) {

1041 
”rÜ
 = 
”ºo
;

1042 
”r
;

1045 
mod
 = 
NULL
;

1046 ià(
	`qpŞ_pŞicy_»bud_İt
(*
pŞicy
, 
İtiÚs
)) {

1047 
”rÜ
 = 
”ºo
;

1048 
”r
;

1051 (*
pŞicy
)->
ty³
 = 
»tv
 = 
QPOL_POLICY_KERNEL_SOURCE
;

1052 
fd
 = 
	`f’o
(
šfe
);

1053 ià(
fd
 < 0) {

1054 
”rÜ
 = 
”ºo
;

1055 
”r
;

1057 ià(
	`f¡©
(
fd
, &
sb
) < 0) {

1058 
”rÜ
 = 
”ºo
;

1059 
	`ERR
(*
pŞicy
, "Cª'ˆ¡© '%s': %s\n", 
·th
, 
	`¡»¼Ü
(
”ºo
));

1060 
”r
;

1062 
qpŞ_¤c_šput
 = 
	`mm­
(
NULL
, 
sb
.
¡_size
, 
PROT_READ
, 
MAP_PRIVATE
, 
fd
, 0);

1063 ià(
qpŞ_¤c_šput
 =ğ
MAP_FAILED
) {

1064 
”rÜ
 = 
”ºo
;

1065 
	`ERR
(*
pŞicy
, "Cª'ˆm­ '%s': %s\n", 
·th
, 
	`¡»¼Ü
(
”ºo
));

1067 
”r
;

1069 
qpŞ_¤c_špuŒ
 = 
qpŞ_¤c_šput
;

1070 
qpŞ_¤c_špuim
 = &
qpŞ_¤c_špuŒ
[
sb
.
¡_size
 - 1];

1071 
qpŞ_¤c_Üigš®šput
 = 
qpŞ_¤c_šput
;

1074 (*
pŞicy
)->
fe_d©a
 = 
qpŞ_¤c_Üigš®šput
;

1075 (*
pŞicy
)->
fe_d©a_sz
 = 
sb
.
¡_size
;

1076 (*
pŞicy
)->
fe_d©a_ty³
 = 
QPOL_POLICY_FILE_DATA_TYPE_MMAP
;

1078 (*
pŞicy
)->
p
->p.
pŞicy_ty³
 = 
POLICY_BASE
;

1079 ià(
	`»ad_sourû_pŞicy
(*
pŞicy
, "libqpŞ", (*pŞicy)->
İtiÚs
) < 0) {

1080 
”rÜ
 = 
”ºo
;

1081 
”r
;

1085 
	`INFO
(*
pŞicy
, "%s", "Linking source…olicy. (Step 2 of 5)");

1086 ià(
	`£pŞ_lšk_moduËs
((*
pŞicy
)->
sh
, (*pŞicy)->
p
, 
NULL
, 0, 0)) {

1087 
”rÜ
 = 
EIO
;

1088 
”r
;

1090 
	`avb_de¡roy
(&((*
pŞicy
)->
p
->p.
‹_avb
));

1091 
	`avb_de¡roy
(&((*
pŞicy
)->
p
->p.
‹_cÚd_avb
));

1092 
	`avb_š™
(&((*
pŞicy
)->
p
->p.
‹_avb
));

1093 
	`avb_š™
(&((*
pŞicy
)->
p
->p.
‹_cÚd_avb
));

1095 ià(
	`´uÃ_di§bËd_symbŞs
(*
pŞicy
)) {

1096 
”rÜ
 = 
”ºo
;

1097 
”r
;

1100 ià(
	`uniÚ_muÉly_deş¬ed_symbŞs
(*
pŞicy
)) {

1101 
”rÜ
 = 
”ºo
;

1102 
”r
;

1106 ià(
	`qpŞ_ex·nd_moduË
(*
pŞicy
, !(
İtiÚs
 & (
QPOL_POLICY_OPTION_NO_NEVERALLOWS
)))) {

1107 
”rÜ
 = 
”ºo
;

1108 
”r
;

1111 ià(
	`šãr_pŞicy_v”siÚ
(*
pŞicy
)) {

1112 
”rÜ
 = 
”ºo
;

1113 
”r
;

1115 ià(
	`pŞicy_ex‹nd
(*
pŞicy
)) {

1116 
”rÜ
 = 
”ºo
;

1117 
”r
;

1121 
	`fşo£
(
šfe
);

1122 
	`£pŞ_pŞicy_fe_ä“
(
pfe
);

1123  
»tv
;

1125 
”r
:

1126 
	`qpŞ_pŞicy_de¡roy
(
pŞicy
);

1127 
	`qpŞ_moduË_de¡roy
(&
mod
);

1128 
	`£pŞ_pŞicy_fe_ä“
(
pfe
);

1129 ià(
šfe
)

1130 
	`fşo£
(
šfe
);

1131 
”ºo
 = 
”rÜ
;

1133 
	}
}

1135 #ià
LINK_SHARED
 == 0

1136 
	$qpŞ_pŞicy_İ’_äom_fe
(cÚ¡ *
·th
, 
qpŞ_pŞicy_t
 ** 
pŞicy
, 
qpŞ_ÿÎback_â_t
 
â
, *
v¬g
, cÚ¡ 
İtiÚs
)

1138  
	`qpŞ_pŞicy_İ’_äom_fe_İt
(
·th
, 
pŞicy
, 
â
, 
v¬g
, 
İtiÚs
);

1139 
	}
}

1142 
	$qpŞ_pŞicy_İ’_äom_fe_no_ruËs
(cÚ¡ *
·th
, 
qpŞ_pŞicy_t
 ** 
pŞicy
, 
qpŞ_ÿÎback_â_t
 
â
, *
v¬g
)

1144  
	`qpŞ_pŞicy_İ’_äom_fe_İt
(
·th
, 
pŞicy
, 
â
, 
v¬g
, 
QPOL_POLICY_OPTION_NO_RULES
);

1145 
	}
}

1154 
	$qpŞ_pŞicy_İ’_äom_memÜy_İt
(
qpŞ_pŞicy_t
 ** 
pŞicy
, cÚ¡ *
fed©a
, 
size_t
 
size
, 
qpŞ_ÿÎback_â_t
 
â
, *
v¬g
,

1155 cÚ¡ 
İtiÚs
)

1157 
”rÜ
 = 0;

1158 ià(
pŞicy
 =ğ
NULL
 || 
fed©a
 == NULL)

1160 *
pŞicy
 = 
NULL
;

1162 ià(!(*
pŞicy
 = 
	`ÿÎoc
(1, (
qpŞ_pŞicy_t
)))) {

1163 
”rÜ
 = 
”ºo
;

1164 
”r
;

1166 (*
pŞicy
)->
İtiÚs
 = options;

1169 ià((*
pŞicy
)->
İtiÚs
 & 
QPOL_POLICY_OPTION_NO_RULES
)

1170 (*
pŞicy
)->
İtiÚs
 |ğ
QPOL_POLICY_OPTION_NO_NEVERALLOWS
;

1172 (*
pŞicy
)->
sh
 = 
	`£pŞ_hªdË_ü—‹
();

1173 ià((*
pŞicy
)->
sh
 =ğ
NULL
) {

1174 
”rÜ
 = 
”ºo
;

1175 
	`ERR
(*
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1176 
”ºo
 = 
”rÜ
;

1180 
	`£pŞ_msg_£t_ÿÎback
((*
pŞicy
)->
sh
, 
£pŞ_hªdË_rou‹_to_ÿÎback
, (*policy));

1181 ià(
â
) {

1182 (*
pŞicy
)->
â
 = fn;

1183 (*
pŞicy
)->
v¬g
 = varg;

1185 (*
pŞicy
)->
â
 = 
qpŞ_hªdË_deçuÉ_ÿÎback
;

1188 ià(
	`£pŞ_pŞicydb_ü—‹
(&((*
pŞicy
)->
p
))) {

1189 
”rÜ
 = 
”ºo
;

1190 
”r
;

1193 
qpŞ_¤c_šput
 = (*)
fed©a
;

1194 
qpŞ_¤c_špuŒ
 = 
qpŞ_¤c_šput
;

1195 
qpŞ_¤c_špuim
 = 
qpŞ_¤c_špuŒ
 + 
size
 - 1;

1196 
qpŞ_¤c_Üigš®šput
 = 
qpŞ_¤c_šput
;

1199 ià(!((*
pŞicy
)->
fe_d©a
 = 
	`m®loc
(
size
))) {

1200 
”rÜ
 = 
”ºo
;

1201 
”r
;

1203 
	`memıy
((*
pŞicy
)->
fe_d©a
, 
fed©a
, 
size
);

1204 (*
pŞicy
)->
fe_d©a_sz
 = 
size
;

1205 (*
pŞicy
)->
fe_d©a_ty³
 = 
QPOL_POLICY_FILE_DATA_TYPE_MEM
;

1208 (*
pŞicy
)->
p
->p.
pŞicy_ty³
 = 
POLICY_BASE
;

1209 ià(
	`»ad_sourû_pŞicy
(*
pŞicy
, "·r£", (*pŞicy)->
İtiÚs
) < 0)

1210 
	`ex™
(1);

1213 
	`INFO
(*
pŞicy
, "%s", "Linking source…olicy. (Step 2 of 5)");

1214 ià(
	`£pŞ_lšk_moduËs
((*
pŞicy
)->
sh
, (*pŞicy)->
p
, 
NULL
, 0, 0)) {

1215 
”rÜ
 = 
EIO
;

1216 
”r
;

1218 
	`avb_de¡roy
(&((*
pŞicy
)->
p
->p.
‹_avb
));

1219 
	`avb_de¡roy
(&((*
pŞicy
)->
p
->p.
‹_cÚd_avb
));

1220 
	`avb_š™
(&((*
pŞicy
)->
p
->p.
‹_avb
));

1221 
	`avb_š™
(&((*
pŞicy
)->
p
->p.
‹_cÚd_avb
));

1223 ià(
	`´uÃ_di§bËd_symbŞs
(*
pŞicy
)) {

1224 
”rÜ
 = 
”ºo
;

1225 
”r
;

1228 ià(
	`uniÚ_muÉly_deş¬ed_symbŞs
(*
pŞicy
)) {

1229 
”rÜ
 = 
”ºo
;

1230 
”r
;

1234 ià(
	`qpŞ_ex·nd_moduË
(*
pŞicy
, !(
İtiÚs
 & (
QPOL_POLICY_OPTION_NO_NEVERALLOWS
)))) {

1235 
”rÜ
 = 
”ºo
;

1236 
”r
;

1240 
”r
:

1241 
	`qpŞ_pŞicy_de¡roy
(
pŞicy
);

1242 
”ºo
 = 
”rÜ
;

1245 
	}
}

1247 #ià
LINK_SHARED
 == 0

1248 
	$qpŞ_pŞicy_İ’_äom_memÜy
(
qpŞ_pŞicy_t
 ** 
pŞicy
, cÚ¡ *
fed©a
, 
size_t
 
size
, 
qpŞ_ÿÎback_â_t
 
â
, *
v¬g
,

1249 cÚ¡ 
İtiÚs
)

1251  
	`qpŞ_pŞicy_İ’_äom_memÜy_İt
(
pŞicy
, 
fed©a
, 
size
, 
â
, 
v¬g
, 
İtiÚs
);

1252 
	}
}

1260 
	$qpŞ_pŞicy_İ’_äom_fe_Şd
(cÚ¡ *
·th
, 
qpŞ_pŞicy_t
 ** 
pŞicy
, 
qpŞ_ÿÎback_â_t
 
â
, *
v¬g
)

1262  
	`qpŞ_pŞicy_İ’_äom_fe
(
·th
, 
pŞicy
, 
â
, 
v¬g
, 0);

1263 
	}
}

1270 
	$qpŞ_pŞicy_İ’_äom_memÜy_Şd
(
qpŞ_pŞicy_t
 ** 
pŞicy
, cÚ¡ *
fed©a
, 
size_t
 
size
, 
qpŞ_ÿÎback_â_t
 
â
, *
v¬g
)

1272  
	`qpŞ_pŞicy_İ’_äom_memÜy_İt
(
pŞicy
, 
fed©a
, 
size
, 
â
, 
v¬g
, 0);

1273 
	}
}

1275 
	$qpŞ_pŞicy_de¡roy
(
qpŞ_pŞicy_t
 ** 
pŞicy
)

1277 ià(
pŞicy
 !ğ
NULL
 && *policy != NULL) {

1278 
	`£pŞ_pŞicydb_ä“
((*
pŞicy
)->
p
);

1279 
	`£pŞ_hªdË_de¡roy
((*
pŞicy
)->
sh
);

1280 
	`qpŞ_ex‹nded_image_de¡roy
(&((*
pŞicy
)->
ext
));

1281 ià((*
pŞicy
)->
moduËs
) {

1282 
size_t
 
i
 = 0;

1283 
i
 = 0; i < (*
pŞicy
)->
num_moduËs
; i++) {

1284 
	`qpŞ_moduË_de¡roy
(&((*
pŞicy
)->
moduËs
[
i
]));

1286 
	`ä“
((*
pŞicy
)->
moduËs
);

1288 ià((*
pŞicy
)->
fe_d©a_ty³
 =ğ
QPOL_POLICY_FILE_DATA_TYPE_MEM
) {

1289 
	`ä“
((*
pŞicy
)->
fe_d©a
);

1290 } ià((*
pŞicy
)->
fe_d©a_ty³
 =ğ
QPOL_POLICY_FILE_DATA_TYPE_MMAP
) {

1291 
	`munm­
((*
pŞicy
)->
fe_d©a
, (*pŞicy)->
fe_d©a_sz
);

1293 
	`ä“
(*
pŞicy
);

1294 *
pŞicy
 = 
NULL
;

1296 
	}
}

1298 
	$qpŞ_pŞicy_»ev®u©e_cÚds
(
qpŞ_pŞicy_t
 * 
pŞicy
)

1300 
pŞicydb_t
 *
db
 = 
NULL
;

1301 
cÚd_node_t
 *
cÚd
 = 
NULL
;

1302 
cÚd_av_li¡_t
 *
li¡_±r
 = 
NULL
;

1304 ià(!
pŞicy
) {

1305 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

1306 
”ºo
 = 
EINVAL
;

1307  
STATUS_ERR
;

1310 
db
 = &
pŞicy
->
p
->p;

1312 
cÚd
 = 
db
->
cÚd_li¡
; cÚd; cÚd = cÚd->
Ãxt
) {

1314 
cÚd
->
cur_¡©e
 = 
	`cÚd_ev®u©e_ex´
(
db
, cÚd->
ex´
);

1315 ià(
cÚd
->
cur_¡©e
 < 0) {

1316 
	`ERR
(
pŞicy
, "E¼Üƒv®u©šg cÚd™iÚ®: %s", 
	`¡»¼Ü
(
EILSEQ
));

1317 
”ºo
 = 
EILSEQ
;

1318  
STATUS_ERR
;

1322 
li¡_±r
 = 
cÚd
->
Œue_li¡
;†i¡_±r;†i¡_±¸ğli¡_±r->
Ãxt
) {

1325 ià(
cÚd
->
cur_¡©e
)

1326 
li¡_±r
->
node
->
m”ged
 |ğ
QPOL_COND_RULE_ENABLED
;

1328 
li¡_±r
->
node
->
m”ged
 &ğ~(
QPOL_COND_RULE_ENABLED
);

1332 
li¡_±r
 = 
cÚd
->
çl£_li¡
;†i¡_±r;†i¡_±¸ğli¡_±r->
Ãxt
) {

1335 ià(!
cÚd
->
cur_¡©e
)

1336 
li¡_±r
->
node
->
m”ged
 |ğ
QPOL_COND_RULE_ENABLED
;

1338 
li¡_±r
->
node
->
m”ged
 &ğ~(
QPOL_COND_RULE_ENABLED
);

1342  
STATUS_SUCCESS
;

1343 
	}
}

1345 
	$qpŞ_pŞicy_­³nd_moduË
(
qpŞ_pŞicy_t
 * 
pŞicy
, 
qpŞ_moduË_t
 * 
moduË
)

1347 
qpŞ_moduË_t
 **
tmp
 = 
NULL
;

1348 
”rÜ
 = 0;

1350 ià(!
pŞicy
 || !
moduË
) {

1351 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

1352 
”ºo
 = 
EINVAL
;

1353  
STATUS_ERR
;

1356 ià(!(
tmp
 = 
	`»®loc
(
pŞicy
->
moduËs
, (1 +…Şicy->
num_moduËs
è* (
qpŞ_moduË_t
 *)))) {

1357 
”rÜ
 = 
”ºo
;

1358 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1359 
”ºo
 = 
”rÜ
;

1360  
STATUS_ERR
;

1363 
pŞicy
->
moduËs
 = 
tmp
;

1364 
pŞicy
->
moduËs
[pŞicy->
num_moduËs
] = 
moduË
;

1365 
pŞicy
->
num_moduËs
++;

1366 
pŞicy
->
modif›d
 = 1;

1367 
moduË
->
·»Á
 = 
pŞicy
;

1369  
STATUS_SUCCESS
;

1370 
	}
}

1372 
	smod_¡©e


1374 
qpŞ_moduË_t
 **
	mli¡
;

1375 
size_t
 
	mcur
;

1376 
size_t
 
	m’d
;

1377 } 
	tmod_¡©e_t
;

1379 
	$mod_¡©e_’d
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

1381 
mod_¡©e_t
 *
ms
;

1383 ià(!
™”
 || !(
ms
 = 
	`qpŞ_™”©Ü_¡©e
(iter))) {

1384 
”ºo
 = 
EINVAL
;

1388  (
ms
->
cur
 >ğms->
’d
);

1389 
	}
}

1391 *
	$mod_¡©e_g‘_cur
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

1393 
mod_¡©e_t
 *
ms
;

1395 ià(!
™”
 || !(
ms
 = 
	`qpŞ_™”©Ü_¡©e
(™”)è|| 
	`qpŞ_™”©Ü_’d
(iter)) {

1396 
”ºo
 = 
EINVAL
;

1397  
NULL
;

1400  
ms
->
li¡
[ms->
cur
];

1401 
	}
}

1403 
	$mod_¡©e_Ãxt
(
qpŞ_™”©Ü_t
 * 
™”
)

1405 
mod_¡©e_t
 *
ms
;

1407 ià(!
™”
 || !(
ms
 = 
	`qpŞ_™”©Ü_¡©e
(iter))) {

1408 
”ºo
 = 
EINVAL
;

1409  
STATUS_ERR
;

1411 ià(
	`qpŞ_™”©Ü_’d
(
™”
)) {

1412 
”ºo
 = 
ERANGE
;

1413  
STATUS_ERR
;

1416 
ms
->
cur
++;

1418  
STATUS_SUCCESS
;

1419 
	}
}

1421 
size_t
 
	$mod_¡©e_size
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

1423 
mod_¡©e_t
 *
ms
;

1425 ià(!
™”
 || !(
ms
 = 
	`qpŞ_™”©Ü_¡©e
(iter))) {

1426 
”ºo
 = 
EINVAL
;

1430  
ms
->
’d
;

1431 
	}
}

1433 
	$qpŞ_pŞicy_g‘_moduË_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, 
qpŞ_™”©Ü_t
 ** 
™”
)

1435 
mod_¡©e_t
 *
ms
 = 
NULL
;

1436 
”rÜ
 = 0;

1438 ià(!
pŞicy
 || !
™”
) {

1439 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

1440 
”ºo
 = 
EINVAL
;

1441  
STATUS_ERR
;

1444 ià(!(
ms
 = 
	`ÿÎoc
(1, (
mod_¡©e_t
)))) {

1445 
”rÜ
 = 
”ºo
;

1446 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1447 
”ºo
 = 
”rÜ
;

1448  
STATUS_ERR
;

1451 ià(
	`qpŞ_™”©Ü_ü—‹
(
pŞicy
, (*)
ms
, 
mod_¡©e_g‘_cur
, 
mod_¡©e_Ãxt
, 
mod_¡©e_’d
, 
mod_¡©e_size
, 
ä“
, 
™”
)) {

1452 
”rÜ
 = 
”ºo
;

1453 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1454 
	`ä“
(
ms
);

1455 
”ºo
 = 
”rÜ
;

1456  
STATUS_ERR
;

1459 
ms
->
’d
 = 
pŞicy
->
num_moduËs
;

1460 
ms
->
li¡
 = 
pŞicy
->
moduËs
;

1462  
STATUS_SUCCESS
;

1463 
	}
}

1465 
	$is_mls_pŞicy
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
)

1467 
pŞicydb_t
 *
db
 = 
NULL
;

1469 ià(
pŞicy
 =ğ
NULL
) {

1470 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

1471 
”ºo
 = 
EINVAL
;

1472  
STATUS_ERR
;

1475 
db
 = &
pŞicy
->
p
->p;

1477 ià(
db
->
mls
 != 0)

1481 
	}
}

1483 
	$qpŞ_pŞicy_is_mls_’abËd
(
qpŞ_pŞicy_t
 * 
pŞicy
)

1485  
	`is_mls_pŞicy
(
pŞicy
);

1486 
	}
}

1488 
	$qpŞ_pŞicy_g‘_pŞicy_v”siÚ
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, *
v”siÚ
)

1490 
pŞicydb_t
 *
db
;

1492 ià(
v”siÚ
 !ğ
NULL
)

1493 *
v”siÚ
 = 0;

1495 ià(
pŞicy
 =ğ
NULL
 || 
v”siÚ
 == NULL) {

1496 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

1497 
”ºo
 = 
EINVAL
;

1498  
STATUS_ERR
;

1501 
db
 = &
pŞicy
->
p
->p;

1503 *
v”siÚ
 = 
db
->
pŞicyv”s
;

1505  
STATUS_SUCCESS
;

1506 
	}
}

1508 
	$qpŞ_pŞicy_g‘_pŞicy_hªdË_unknown
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, *
hªdË_unknown
)

1510 
pŞicydb_t
 *
db
;

1512 ià(
hªdË_unknown
 !ğ
NULL
)

1513 *
hªdË_unknown
 = 0;

1515 ià(
pŞicy
 =ğ
NULL
 || 
hªdË_unknown
 == NULL) {

1516 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

1517 
”ºo
 = 
EINVAL
;

1518  
STATUS_ERR
;

1521 
db
 = &
pŞicy
->
p
->p;

1522 *
hªdË_unknown
 = 
db
->handle_unknown;

1524  
STATUS_SUCCESS
;

1525 
	}
}

1527 
	$qpŞ_pŞicy_g‘_ty³
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, *
ty³
)

1529 ià(!
pŞicy
 || !
ty³
) {

1530 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

1531 
”ºo
 = 
EINVAL
;

1532  
STATUS_ERR
;

1535 *
ty³
 = 
pŞicy
->type;

1537  
STATUS_SUCCESS
;

1538 
	}
}

1540 
	$qpŞ_pŞicy_has_ÿ·b™y
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, 
qpŞ_ÿ·b™y_e
 
ÿp
)

1542 
v”siÚ
 = 0;

1544 ià(!
pŞicy
) {

1545 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

1546 
”ºo
 = 
EINVAL
;

1550 
	`qpŞ_pŞicy_g‘_pŞicy_v”siÚ
(
pŞicy
, &
v”siÚ
);

1552 
ÿp
) {

1553 
QPOL_CAP_ATTRIB_NAMES
:

1555 ià((
pŞicy
->
ty³
 =ğ
QPOL_POLICY_KERNEL_SOURCE
 ||…Şicy->ty³ =ğ
QPOL_POLICY_MODULE_BINARY
è|| (
v”siÚ
 >= 24))

1559 
QPOL_CAP_SYN_RULES
:

1561 ià(
pŞicy
->
ty³
 =ğ
QPOL_POLICY_KERNEL_SOURCE
 ||…Şicy->ty³ =ğ
QPOL_POLICY_MODULE_BINARY
)

1565 
QPOL_CAP_LINE_NUMBERS
:

1567 ià(
pŞicy
->
ty³
 =ğ
QPOL_POLICY_KERNEL_SOURCE
)

1571 
QPOL_CAP_CONDITIONALS
:

1573 ià(
v”siÚ
 >ğ16 || 
pŞicy
->
ty³
 =ğ
QPOL_POLICY_MODULE_BINARY
)

1577 
QPOL_CAP_MLS
:

1579  
	`is_mls_pŞicy
(
pŞicy
);

1581 
QPOL_CAP_MODULES
:

1583 ià(
pŞicy
->
ty³
 =ğ
QPOL_POLICY_MODULE_BINARY
)

1587 
QPOL_CAP_POLCAPS
:

1589 ià(
v”siÚ
 >ğ22 && 
pŞicy
->
ty³
 !ğ
QPOL_POLICY_MODULE_BINARY
)

1591 ià(
v”siÚ
 >ğ7 && 
pŞicy
->
ty³
 =ğ
QPOL_POLICY_MODULE_BINARY
)

1595 
QPOL_CAP_BOUNDS
:

1597 ià(
v”siÚ
 >ğ24 && 
pŞicy
->
ty³
 !ğ
QPOL_POLICY_MODULE_BINARY
)

1599 ià(
v”siÚ
 >ğ9 && 
pŞicy
->
ty³
 =ğ
QPOL_POLICY_MODULE_BINARY
)

1603 
QPOL_CAP_PERMISSIVE
:

1605 ià(
v”siÚ
 >ğ23 && 
pŞicy
->
ty³
 !ğ
QPOL_POLICY_MODULE_BINARY
)

1607 ià(
v”siÚ
 >ğ8 && 
pŞicy
->
ty³
 =ğ
QPOL_POLICY_MODULE_BINARY
)

1611 
QPOL_CAP_FILENAME_TRANS
:

1613 ià(
v”siÚ
 >ğ25 && 
pŞicy
->
ty³
 !ğ
QPOL_POLICY_MODULE_BINARY
)

1615 ià(
v”siÚ
 >ğ11 && 
pŞicy
->
ty³
 =ğ
QPOL_POLICY_MODULE_BINARY
)

1619 
QPOL_CAP_ROLETRANS
:

1621 ià(
v”siÚ
 >ğ26 && 
pŞicy
->
ty³
 !ğ
QPOL_POLICY_MODULE_BINARY
)

1623 ià(
v”siÚ
 >ğ12 && 
pŞicy
->
ty³
 =ğ
QPOL_POLICY_MODULE_BINARY
)

1628 
QPOL_CAP_DEFAULT_OBJECTS
:

1630 ià(
v”siÚ
 >ğ27 && 
pŞicy
->
ty³
 !ğ
QPOL_POLICY_MODULE_BINARY
)

1632 ià(
v”siÚ
 >ğ15 && 
pŞicy
->
ty³
 =ğ
QPOL_POLICY_MODULE_BINARY
)

1636 
QPOL_CAP_DEFAULT_TYPE
:

1638 ià(
v”siÚ
 >ğ28 && 
pŞicy
->
ty³
 !ğ
QPOL_POLICY_MODULE_BINARY
)

1640 ià(
v”siÚ
 >ğ16 && 
pŞicy
->
ty³
 =ğ
QPOL_POLICY_MODULE_BINARY
)

1644 
QPOL_CAP_RULES_LOADED
:

1646 ià(!(
pŞicy
->
İtiÚs
 & 
QPOL_POLICY_OPTION_NO_RULES
))

1650 
QPOL_CAP_SOURCE
:

1652 ià(
pŞicy
->
ty³
 =ğ
QPOL_POLICY_KERNEL_SOURCE
)

1656 
QPOL_CAP_NEVERALLOW
:

1658 ià(!(
pŞicy
->
İtiÚs
 & 
QPOL_POLICY_OPTION_NO_NEVERALLOWS
è&&…Şicy->
ty³
 !ğ
QPOL_POLICY_KERNEL_BINARY
)

1664 
	`ERR
(
pŞicy
, "%s", "Unknown capability");

1665 
”ºo
 = 
EDOM
;

1670 
	}
}

	@libqpol/src/policy_define.c

39 
	~<cÚfig.h
>

41 
	~<sys/ty³s.h
>

42 
	~<as£¹.h
>

43 
	~<¡d¬g.h
>

44 
	~<¡dšt.h
>

45 
	~<¡dio.h
>

46 
	~<¡dlib.h
>

47 
	~<¡ršg.h
>

48 
	~<sys/sock‘.h
>

49 
	~<Ãtš‘/š.h
>

50 
	~<¬·/š‘.h
>

51 
	~<¡dlib.h
>

53 
	~<£pŞ/pŞicydb/ex·nd.h
>

54 
	~<£pŞ/pŞicydb/pŞicydb.h
>

55 
	~<£pŞ/pŞicydb/£rviûs.h
>

56 
	~<£pŞ/pŞicydb/cÚd™iÚ®.h
>

57 
	~<£pŞ/pŞicydb/æask.h
>

58 
	~<£pŞ/pŞicydb/h›¿rchy.h
>

60 #ifdeà
HAVE_SEPOL_POLICYCAPS


61 
	~<£pŞ/pŞicydb/pŞÿps.h
>

63 #ifdeà
HAVE_SEPOL_ERRCODES


64 
	~<£pŞ/”rcodes.h
>

67 
	~"queue.h
"

69 
	~<qpŞ/pŞicy.h
>

71 
	~"moduË_comp”.h
"

72 
	~"pŞicy_defše.h
"

74 
pŞicydb_t
 *
	gpŞicydbp
;

75 
queue_t
 
	gid_queue
 = 0;

76 
	g·ss
;

77 *
	gcurfe
 = 0;

78 
	gml¥Ş
 = 0;

80 
pŞicydb_lš’o
;

81 
sourû_lš’o
;

82 
pŞicydb_”rÜs
;

84 
yyw¬n
(*
msg
);

85 
yy”rÜ
(*
msg
);

87 
	#ERRORMSG_LEN
 255

	)

88 
	g”rÜmsg
[
ERRORMSG_LEN
 + 1] = {0};

90 
id_has_dÙ
(*
id
);

91 
·r£_£cur™y_cÚ‹xt
(
cÚ‹xt_¡ruù_t
 *
c
);

95 
	glßd_ruËs
;

96 
	gnum_ruËs
 = 0;

97 
	$š™_·r£r
(
·ss_numb”
, 
do_ruËs
)

99 
pŞicydb_lš’o
 = 1;

100 
sourû_lš’o
 = 1;

101 
pŞicydb_”rÜs
 = 0;

102 
·ss
 = 
·ss_numb”
;

103 
lßd_ruËs
 = 
do_ruËs
;

104 
num_ruËs
 = 0;

105 
	}
}

107 
	$yy”rÜ2
(*
fmt
, ...)

109 
va_li¡
 
­
;

110 
	`va_¡¬t
(
­
, 
fmt
);

111 
	`v¢´štf
(
”rÜmsg
, 
ERRORMSG_LEN
, 
fmt
, 
­
);

112 
	`yy”rÜ
(
”rÜmsg
);

113 
	`va_’d
(
­
);

114 
	}
}

117 
	$defše_mls
()

119 
ml¥Ş
 = 1;

120 
pŞicydbp
->
mls
 = 1;

123 
	}
}

132 
	$š£¹_check_ty³_ruË
(
avruË_t
 * 
ruË
, 
avb_t
 * 
avb
, 
cÚd_av_li¡_t
 ** 
li¡
, cÚd_av_li¡_ˆ** 
Ùh”
)

134 
»t
;

136 ià(
num_ruËs
 && !
lßd_ruËs
)

139 #ifdeà
SEPOL_DYNAMIC_AVTAB


140 ià(!
avb
->
hbË
)

141 ià(
	`avb_®loc
(
avb
, 
MAX_AVTAB_SIZE
))

145 
»t
 = 
	`ex·nd_ruË
(
NULL
, 
pŞicydbp
, 
ruË
, 
avb
, 
li¡
, 
Ùh”
, 0);

147 ià(
»t
 < 0) {

148 
	`yy”rÜ
("Failed onƒxpanding„ule");

150  
»t
;

151 
	}
}

153 
	$š£¹_£·¿tÜ
(
push
)

155 
”rÜ
;

157 ià(
push
)

158 
”rÜ
 = 
	`queue_push
(
id_queue
, 0);

160 
”rÜ
 = 
	`queue_š£¹
(
id_queue
, 0);

162 ià(
”rÜ
) {

163 
	`yy”rÜ
("queue overflow");

167 
	}
}

169 
	$š£¹_id
(*
id
, 
push
)

171 *
Ãwid
 = 0;

172 
”rÜ
;

174 
Ãwid
 = (*)
	`m®loc
(
	`¡¾’
(
id
) + 1);

175 ià(!
Ãwid
) {

176 
	`yy”rÜ
("out of memory");

179 
	`¡rıy
(
Ãwid
, 
id
);

180 ià(
push
)

181 
”rÜ
 = 
	`queue_push
(
id_queue
, (
queue_–em’t_t
è
Ãwid
);

183 
”rÜ
 = 
	`queue_š£¹
(
id_queue
, (
queue_–em’t_t
è
Ãwid
);

185 ià(
”rÜ
) {

186 
	`yy”rÜ
("queue overflow");

187 
	`ä“
(
Ãwid
);

191 
	}
}

195 
	$id_has_dÙ
(*
id
)

197 ià(
	`¡rchr
(
id
, '.') >= id + 1) {

201 
	}
}

203 
	$defše_şass
()

205 *
id
 = 0;

206 
şass_d©um_t
 *
d©um
 = 0;

207 
»t
;

208 
ušt32_t
 
v®ue
;

210 ià(
·ss
 == 2) {

211 
id
 = 
	`queue_»move
(
id_queue
);

212 
	`ä“
(
id
);

216 
id
 = (*)
	`queue_»move
(
id_queue
);

217 ià(!
id
) {

218 
	`yy”rÜ
("no class‚ame for class definition?");

221 
d©um
 = (
şass_d©um_t
 *è
	`m®loc
((class_datum_t));

222 ià(!
d©um
) {

223 
	`yy”rÜ
("out of memory");

224 
bad
;

226 
	`mem£t
(
d©um
, 0, (
şass_d©um_t
));

227 
»t
 = 
	`deş¬e_symbŞ
(
SYM_CLASSES
, 
id
, 
d©um
, &
v®ue
, &value);

228 
»t
) {

230 
	`yy”rÜ
("Out of memory!");

231 
bad
;

234 
	`yy”rÜ2
("du¶iÿ‹ deş¬©iÚ oàşas %s", 
id
);

235 
bad
;

238 
	`yy”rÜ
("could‚ot declare class here");

239 
bad
;

246 
	`as£¹
(0);

249 
d©um
->
s
.
v®ue
 = value;

252 
bad
:

253 ià(
id
)

254 
	`ä“
(
id
);

255 ià(
d©um
)

256 
	`ä“
(
d©um
);

258 
	}
}

260 
	$defše_³rmissive
()

262 *
ty³
 = 
NULL
;

263 
ty³_d©um
 *
t
;

264 
rc
 = 0;

266 
ty³
 = 
	`queue_»move
(
id_queue
);

268 ià(!
ty³
) {

269 
	`yy”rÜ2
("forgoto includeype in…ermissive definition?");

270 
rc
 = -1;

271 
out
;

274 ià(
·ss
 == 1)

275 
out
;

277 ià(!
	`is_id_š_scİe
(
SYM_TYPES
, 
ty³
)) {

278 
	`yy”rÜ2
("ty³ % i nÙ w™hš scİe", 
ty³
);

279 
rc
 = -1;

280 
out
;

283 
t
 = 
	`hashb_£¬ch
(
pŞicydbp
->
p_ty³s
.
bË
, 
ty³
);

284 ià(!
t
) {

285 
	`yy”rÜ2
("ty³ i nÙ defšed: %s", 
ty³
);

286 
rc
 = -1;

287 
out
;

290 ià(
t
->
æavÜ
 =ğ
TYPE_ATTRIB
) {

291 
	`yy”rÜ2
("©Œibu‹ may‚Ù b³rmissive: %s\n", 
ty³
);

292 
rc
 = -1;

293 
out
;

296 #ifdeà
HAVE_SEPOL_PERMISSIVE_TYPES


297 
t
->
æags
 |ğ
TYPE_FLAGS_PERMISSIVE
;

299 
	`yy”rÜ
("This version of SETools does‚ot have…ermissiveypesƒnabled.");

301 
out
:

302 
	`ä“
(
ty³
);

303  
rc
;

304 
	}
}

306 
	$defše_pŞÿp
()

308 *
id
 = 0;

309 
ÿ²um
;

311 ià(
·ss
 == 2) {

312 
id
 = 
	`queue_»move
(
id_queue
);

313 
	`ä“
(
id
);

317 
id
 = (*)
	`queue_»move
(
id_queue
);

318 ià(!
id
) {

319 
	`yy”rÜ
("no capability‚ame for…olicycap definition?");

320 
bad
;

323 #ifdeà
HAVE_SEPOL_POLICYCAPS


325 
ÿ²um
 = 
	`£pŞ_pŞÿp_g‘num
(
id
);

326 ià(
ÿ²um
 < 0) {

327 
	`yy”rÜ2
("šv®id…Şicy c­ab™y‚am%s", 
id
);

328 
bad
;

332 ià(
	`eb™m­_£t_b™
(&
pŞicydbp
->
pŞicyÿps
, 
ÿ²um
, 
TRUE
)) {

333 
	`yy”rÜ
("out of memory");

334 
bad
;

337 
	`yy”rÜ
("This version of SETools does‚ot have…olicycapƒnabled.");

340 
	`ä“
(
id
);

343 
bad
:

344 
	`ä“
(
id
);

346 
	}
}

348 
	$defše_š™Ÿl_sid
()

350 *
id
 = 0;

351 
ocÚ‹xt_t
 *
Ãwc
 = 0, *
c
, *
h—d
;

353 ià(
·ss
 == 2) {

354 
id
 = 
	`queue_»move
(
id_queue
);

355 
	`ä“
(
id
);

359 
id
 = (*)
	`queue_»move
(
id_queue
);

360 ià(!
id
) {

361 
	`yy”rÜ
("no sid‚ame for SID definition?");

364 
Ãwc
 = (
ocÚ‹xt_t
 *è
	`m®loc
((ocontext_t));

365 ià(!
Ãwc
) {

366 
	`yy”rÜ
("out of memory");

367 
bad
;

369 
	`mem£t
(
Ãwc
, 0, (
ocÚ‹xt_t
));

370 
Ãwc
->
u
.
Çme
 = 
id
;

371 
	`cÚ‹xt_š™
(&
Ãwc
->
cÚ‹xt
[0]);

372 
h—d
 = 
pŞicydbp
->
ocÚ‹xts
[
OCON_ISID
];

374 
c
 = 
h—d
; c; c = c->
Ãxt
) {

375 ià(!
	`¡rcmp
(
Ãwc
->
u
.
Çme
, 
c
->u.name)) {

376 
	`yy”rÜ2
("du¶iÿ‹ in™ŸÈSID %s", 
id
);

377 
bad
;

381 ià(
h—d
) {

382 
Ãwc
->
sid
[0] = 
h—d
->sid[0] + 1;

384 
Ãwc
->
sid
[0] = 1;

386 
Ãwc
->
Ãxt
 = 
h—d
;

387 
pŞicydbp
->
ocÚ‹xts
[
OCON_ISID
] = 
Ãwc
;

391 
bad
:

392 ià(
id
)

393 
	`ä“
(
id
);

394 ià(
Ãwc
)

395 
	`ä“
(
Ãwc
);

397 
	}
}

399 
	$»ad_şas£s
(
eb™m­_t
 *
e_şas£s
)

401 *
id
;

402 
şass_d©um_t
 *
şad©um
;

404 (
id
 = 
	`queue_»move
(
id_queue
))) {

405 ià(!
	`is_id_š_scİe
(
SYM_CLASSES
, 
id
)) {

406 
	`yy”rÜ2
("şas % i nÙ w™hš scİe", 
id
);

409 
şad©um
 = 
	`hashb_£¬ch
(
pŞicydbp
->
p_şas£s
.
bË
, 
id
);

410 ià(!
şad©um
) {

411 
	`yy”rÜ2
("unknowÀşas %s", 
id
);

414 ià(
	`eb™m­_£t_b™
(
e_şas£s
, 
şad©um
->
s
.
v®ue
 - 1, 
TRUE
)) {

415 
	`yy”rÜ
("Out of memory");

418 
	`ä“
(
id
);

421 
	}
}

423 
	$defše_deçuÉ_u£r
(
which
)

425 *
id
;

427 ià(
·ss
 == 1) {

428 (
id
 = 
	`queue_»move
(
id_queue
)))

429 
	`ä“
(
id
);

433 #ifdeà
HAVE_SEPOL_NEW_OBJECT_DEFAULTS


434 
şass_d©um_t
 *
şad©um
;

436 (
id
 = 
	`queue_»move
(
id_queue
))) {

437 ià(!
	`is_id_š_scİe
(
SYM_CLASSES
, 
id
)) {

438 
	`yy”rÜ2
("şas % i nÙ w™hš scİe", 
id
);

441 
şad©um
 = 
	`hashb_£¬ch
(
pŞicydbp
->
p_şas£s
.
bË
, 
id
);

442 ià(!
şad©um
) {

443 
	`yy”rÜ2
("unknowÀşas %s", 
id
);

446 ià(
şad©um
->
deçuÉ_u£r
 && cÏd©um->deçuÉ_u£¸!ğ
which
) {

447 
	`yy”rÜ2
("cÚæiùšg deçuÉ u£¸šfÜm©iÚ fÜ cÏs %s", 
id
);

450 
şad©um
->
deçuÉ_u£r
 = 
which
;

451 
	`ä“
(
id
);

456 
	`yy”rÜ
("This version of SETools does‚ot have default_userƒnabled.");

458 
	}
}

460 
	$defše_deçuÉ_rŞe
(
which
)

462 *
id
;

464 ià(
·ss
 == 1) {

465 (
id
 = 
	`queue_»move
(
id_queue
)))

466 
	`ä“
(
id
);

470 #ifdeà
HAVE_SEPOL_NEW_OBJECT_DEFAULTS


471 
şass_d©um_t
 *
şad©um
;

473 (
id
 = 
	`queue_»move
(
id_queue
))) {

474 ià(!
	`is_id_š_scİe
(
SYM_CLASSES
, 
id
)) {

475 
	`yy”rÜ2
("şas % i nÙ w™hš scİe", 
id
);

478 
şad©um
 = 
	`hashb_£¬ch
(
pŞicydbp
->
p_şas£s
.
bË
, 
id
);

479 ià(!
şad©um
) {

480 
	`yy”rÜ2
("unknowÀşas %s", 
id
);

483 ià(
şad©um
->
deçuÉ_rŞe
 && cÏd©um->deçuÉ_rŞ!ğ
which
) {

484 
	`yy”rÜ2
("cÚæiùšg deçuÉ„ŞšfÜm©iÚ fÜ cÏs %s", 
id
);

487 
şad©um
->
deçuÉ_rŞe
 = 
which
;

488 
	`ä“
(
id
);

493 
	`yy”rÜ
("This version of SETools does‚ot have default_roleƒnabled.");

495 
	}
}

497 
	$defše_deçuÉ_ty³
(
which
)

499 *
id
;

501 ià(
·ss
 == 1) {

502 (
id
 = 
	`queue_»move
(
id_queue
)))

503 
	`ä“
(
id
);

507 #ifdeà
HAVE_SEPOL_DEFAULT_TYPE


508 
şass_d©um_t
 *
şad©um
;

510 (
id
 = 
	`queue_»move
(
id_queue
))) {

511 ià(!
	`is_id_š_scİe
(
SYM_CLASSES
, 
id
)) {

512 
	`yy”rÜ2
("şas % i nÙ w™hš scİe", 
id
);

515 
şad©um
 = 
	`hashb_£¬ch
(
pŞicydbp
->
p_şas£s
.
bË
, 
id
);

516 ià(!
şad©um
) {

517 
	`yy”rÜ2
("unknowÀşas %s", 
id
);

520 ià(
şad©um
->
deçuÉ_ty³
 && cÏd©um->deçuÉ_ty³ !ğ
which
) {

521 
	`yy”rÜ2
("cÚæiùšg deçuÉy³ infÜm©iÚ fÜ cÏs %s", 
id
);

524 
şad©um
->
deçuÉ_ty³
 = 
which
;

525 
	`ä“
(
id
);

530 
	`yy”rÜ
("This version of SETools does‚ot have default_typeƒnabled.");

532 
	}
}

534 
	$defše_deçuÉ_¿nge
(
which
)

536 *
id
;

538 ià(
·ss
 == 1) {

539 (
id
 = 
	`queue_»move
(
id_queue
)))

540 
	`ä“
(
id
);

544 #ifdeà
HAVE_SEPOL_NEW_OBJECT_DEFAULTS


545 
şass_d©um_t
 *
şad©um
;

547 (
id
 = 
	`queue_»move
(
id_queue
))) {

548 ià(!
	`is_id_š_scİe
(
SYM_CLASSES
, 
id
)) {

549 
	`yy”rÜ2
("şas % i nÙ w™hš scİe", 
id
);

552 
şad©um
 = 
	`hashb_£¬ch
(
pŞicydbp
->
p_şas£s
.
bË
, 
id
);

553 ià(!
şad©um
) {

554 
	`yy”rÜ2
("unknowÀşas %s", 
id
);

557 ià(
şad©um
->
deçuÉ_¿nge
 && cÏd©um->deçuÉ_¿ng!ğ
which
) {

558 
	`yy”rÜ2
("cÚæiùšg deçuÉ„ªgšfÜm©iÚ fÜ cÏs %s", 
id
);

561 
şad©um
->
deçuÉ_¿nge
 = 
which
;

562 
	`ä“
(
id
);

567 
	`yy”rÜ
("This version of SETools does‚ot have default_rangeƒnabled.");

569 
	}
}

571 
	$defše_commÚ_³rms
()

573 *
id
 = 0, *
³rm
 = 0;

574 
commÚ_d©um_t
 *
comd©um
 = 0;

575 
³rm_d©um_t
 *
³rd©um
 = 0;

576 
»t
;

578 ià(
·ss
 == 2) {

579 (
id
 = 
	`queue_»move
(
id_queue
)))

580 
	`ä“
(
id
);

584 
id
 = (*)
	`queue_»move
(
id_queue
);

585 ià(!
id
) {

586 
	`yy”rÜ
("no common‚ame for common…erm definition?");

589 
comd©um
 = 
	`hashb_£¬ch
(
pŞicydbp
->
p_commÚs
.
bË
, 
id
);

590 ià(
comd©um
) {

591 
	`yy”rÜ2
("du¶iÿ‹ deş¬©iÚ fÜ commÚ %s\n", 
id
);

594 
comd©um
 = (
commÚ_d©um_t
 *è
	`m®loc
((common_datum_t));

595 ià(!
comd©um
) {

596 
	`yy”rÜ
("out of memory");

597 
bad
;

599 
	`mem£t
(
comd©um
, 0, (
commÚ_d©um_t
));

600 
»t
 = 
	`hashb_š£¹
(
pŞicydbp
->
p_commÚs
.
bË
,

601 (
hashb_key_t
è
id
, (
hashb_d©um_t
è
comd©um
);

603 ià(
»t
 =ğ
SEPOL_EEXIST
) {

604 
	`yy”rÜ
("duplicate common definition");

605 
bad
;

607 ià(
»t
 =ğ
SEPOL_ENOMEM
) {

608 
	`yy”rÜ
("hashable overflow");

609 
bad
;

611 
comd©um
->
s
.
v®ue
 = 
pŞicydbp
->
p_commÚs
.
Årim
 + 1;

612 ià(
	`symb_š™
(&
comd©um
->
³rmissiÚs
, 
PERM_SYMTAB_SIZE
)) {

613 
	`yy”rÜ
("out of memory");

614 
bad
;

616 
pŞicydbp
->
p_commÚs
.
Årim
++;

617 (
³rm
 = 
	`queue_»move
(
id_queue
))) {

618 
³rd©um
 = (
³rm_d©um_t
 *è
	`m®loc
((perm_datum_t));

619 ià(!
³rd©um
) {

620 
	`yy”rÜ
("out of memory");

621 
bad_³rm
;

623 
	`mem£t
(
³rd©um
, 0, (
³rm_d©um_t
));

624 
³rd©um
->
s
.
v®ue
 = 
comd©um
->
³rmissiÚs
.
Årim
 + 1;

626 ià(
³rd©um
->
s
.
v®ue
 > ((
£pŞ_acûss_veùÜ_t
) * 8)) {

627 
yy”rÜ


629 
bad_³rm
;

631 
»t
 = 
	`hashb_š£¹
(
comd©um
->
³rmissiÚs
.
bË
,

632 (
hashb_key_t
è
³rm
,

633 (
hashb_d©um_t
è
³rd©um
);

635 ià(
»t
 =ğ
SEPOL_EEXIST
) {

636 
	`yy”rÜ2
("du¶iÿ‹…”missiÚ % š commÚ %s", 
³rm
,

637 
id
);

638 
bad_³rm
;

640 ià(
»t
 =ğ
SEPOL_ENOMEM
) {

641 
	`yy”rÜ
("hashable overflow");

642 
bad_³rm
;

644 
comd©um
->
³rmissiÚs
.
Årim
++;

649 
bad
:

650 ià(
id
)

651 
	`ä“
(
id
);

652 ià(
comd©um
)

653 
	`ä“
(
comd©um
);

656 
bad_³rm
:

657 ià(
³rm
)

658 
	`ä“
(
³rm
);

659 ià(
³rd©um
)

660 
	`ä“
(
³rd©um
);

662 
	}
}

664 
	$defše_av_³rms
(
šh”™s
)

666 *
id
;

667 
şass_d©um_t
 *
şad©um
;

668 
commÚ_d©um_t
 *
comd©um
;

669 
³rm_d©um_t
 *
³rd©um
 = 0, *
³rd©um2
 = 0;

670 
»t
;

672 ià(
·ss
 == 2) {

673 (
id
 = 
	`queue_»move
(
id_queue
)))

674 
	`ä“
(
id
);

678 
id
 = (*)
	`queue_»move
(
id_queue
);

679 ià(!
id
) {

680 
	`yy”rÜ
("noclass‚ame for‡v…erm definition?");

683 
şad©um
 = (
şass_d©um_t
 *è
	`hashb_£¬ch
(
pŞicydbp
->
p_şas£s
.
bË
,

684 (
hashb_key_t
è
id
);

685 ià(!
şad©um
) {

686 
	`yy”rÜ2
("şas % i nÙ defšed", 
id
);

687 
bad
;

689 
	`ä“
(
id
);

691 ià(
şad©um
->
comd©um
 || cÏd©um->
³rmissiÚs
.
Årim
) {

692 
	`yy”rÜ
("duplicate‡ccess vector definition");

695 ià(
	`symb_š™
(&
şad©um
->
³rmissiÚs
, 
PERM_SYMTAB_SIZE
)) {

696 
	`yy”rÜ
("out of memory");

699 ià(
šh”™s
) {

700 
id
 = (*)
	`queue_»move
(
id_queue
);

701 ià(!
id
) {

702 
yy”rÜ


706 
comd©um
 =

707 (
commÚ_d©um_t
 *è
	`hashb_£¬ch
(
pŞicydbp
->
p_commÚs
.

708 
bË
,

709 (
hashb_key_t
è
id
);

711 ià(!
comd©um
) {

712 
	`yy”rÜ2
("commÚ % i nÙ defšed", 
id
);

713 
bad
;

715 
şad©um
->
comkey
 = 
id
;

716 
şad©um
->
comd©um
 = comdatum;

722 
şad©um
->
³rmissiÚs
.
Årim
 +ğ
comd©um
->permissions.nprim;

724 (
id
 = 
	`queue_»move
(
id_queue
))) {

725 
³rd©um
 = (
³rm_d©um_t
 *è
	`m®loc
((perm_datum_t));

726 ià(!
³rd©um
) {

727 
	`yy”rÜ
("out of memory");

728 
bad
;

730 
	`mem£t
(
³rd©um
, 0, (
³rm_d©um_t
));

731 
³rd©um
->
s
.
v®ue
 = ++
şad©um
->
³rmissiÚs
.
Årim
;

733 ià(
³rd©um
->
s
.
v®ue
 > ((
£pŞ_acûss_veùÜ_t
) * 8)) {

734 
yy”rÜ


736 
bad
;

738 ià(
šh”™s
) {

744 
³rd©um2
 =

745 (
³rm_d©um_t
 *è
	`hashb_£¬ch
(
şad©um
->
comd©um
->

746 
³rmissiÚs
.
bË
,

747 (
hashb_key_t
è
id
);

748 ià(
³rd©um2
) {

749 
	`yy”rÜ2
("permission %s conflicts with‡n "

750 "šh”™ed…”missiÚ", 
id
);

751 
bad
;

754 
»t
 = 
	`hashb_š£¹
(
şad©um
->
³rmissiÚs
.
bË
,

755 (
hashb_key_t
è
id
,

756 (
hashb_d©um_t
è
³rd©um
);

758 ià(
»t
 =ğ
SEPOL_EEXIST
) {

759 
	`yy”rÜ2
("du¶iÿ‹…”missiÚ %s", 
id
);

760 
bad
;

762 ià(
»t
 =ğ
SEPOL_ENOMEM
) {

763 
	`yy”rÜ
("hashable overflow");

764 
bad
;

766 ià(
	`add_³rm_to_şass
(
³rd©um
->
s
.
v®ue
, 
şad©um
->s.value)) {

767 
	`yy”rÜ
("out of memory");

768 
bad
;

774 
bad
:

775 ià(
id
)

776 
	`ä“
(
id
);

777 ià(
³rd©um
)

778 
	`ä“
(
³rd©um
);

780 
	}
}

782 
	$defše_£ns
()

784 *
id
;

785 
mls_Ëv–_t
 *
Ëv–
 = 0;

786 
Ëv–_d©um_t
 *
d©um
 = 0, *
®Ÿsd©um
 = 0;

787 
»t
;

788 
ušt32_t
 
v®ue
;

790 ià(!
ml¥Ş
) {

791 
	`yy”rÜ
("sensitivity definition in‚on-MLS configuration");

795 ià(
·ss
 == 2) {

796 (
id
 = 
	`queue_»move
(
id_queue
)))

797 
	`ä“
(
id
);

801 
id
 = (*)
	`queue_»move
(
id_queue
);

802 ià(!
id
) {

803 
	`yy”rÜ
("no sensitivity‚ame for sensitivity definition?");

806 ià(
	`id_has_dÙ
(
id
)) {

807 
	`yy”rÜ
("sensitivity identifiers may‚ot contain…eriods");

808 
bad
;

810 
Ëv–
 = (
mls_Ëv–_t
 *è
	`m®loc
((mls_level_t));

811 ià(!
Ëv–
) {

812 
	`yy”rÜ
("out of memory");

813 
bad
;

815 
	`mls_Ëv–_š™
(
Ëv–
);

816 
Ëv–
->
£ns
 = 0;

817 
	`eb™m­_š™
(&
Ëv–
->
ÿt
);

819 
d©um
 = (
Ëv–_d©um_t
 *è
	`m®loc
((level_datum_t));

820 ià(!
d©um
) {

821 
	`yy”rÜ
("out of memory");

822 
bad
;

824 
	`Ëv–_d©um_š™
(
d©um
);

825 
d©um
->
i§lŸs
 = 
FALSE
;

826 
d©um
->
Ëv–
 =†evel;

828 
»t
 = 
	`deş¬e_symbŞ
(
SYM_LEVELS
, 
id
, 
d©um
, &
v®ue
, &value);

829 
»t
) {

831 
	`yy”rÜ
("Out of memory!");

832 
bad
;

835 
	`yy”rÜ
("duplicate declaration of sensitivity†evel");

836 
bad
;

839 
	`yy”rÜ
("could‚ot declare sensitivity†evel here");

840 
bad
;

847 
	`as£¹
(0);

851 (
id
 = 
	`queue_»move
(
id_queue
))) {

852 ià(
	`id_has_dÙ
(
id
)) {

853 
	`yy”rÜ
("sensitivity‡liases may‚ot contain…eriods");

854 
bad_®Ÿs
;

856 
®Ÿsd©um
 = (
Ëv–_d©um_t
 *è
	`m®loc
((level_datum_t));

857 ià(!
®Ÿsd©um
) {

858 
	`yy”rÜ
("out of memory");

859 
bad_®Ÿs
;

861 
	`Ëv–_d©um_š™
(
®Ÿsd©um
);

862 
®Ÿsd©um
->
i§lŸs
 = 
TRUE
;

863 
®Ÿsd©um
->
Ëv–
 =†evel;

865 
»t
 = 
	`deş¬e_symbŞ
(
SYM_LEVELS
, 
id
, 
®Ÿsd©um
, 
NULL
, &
v®ue
);

866 
»t
) {

868 
	`yy”rÜ
("Out of memory!");

869 
bad_®Ÿs
;

872 
yy”rÜ


874 
bad_®Ÿs
;

877 
yy”rÜ


879 
bad_®Ÿs
;

886 
	`as£¹
(0);

893 
bad
:

894 ià(
id
)

895 
	`ä“
(
id
);

896 ià(
Ëv–
)

897 
	`ä“
(
Ëv–
);

898 ià(
d©um
) {

899 
	`Ëv–_d©um_de¡roy
(
d©um
);

900 
	`ä“
(
d©um
);

904 
bad_®Ÿs
:

905 ià(
id
)

906 
	`ä“
(
id
);

907 ià(
®Ÿsd©um
) {

908 
	`Ëv–_d©um_de¡roy
(
®Ÿsd©um
);

909 
	`ä“
(
®Ÿsd©um
);

912 
	}
}

914 
	$defše_domšªû
()

916 
Ëv–_d©um_t
 *
d©um
;

917 
Üd”
;

918 *
id
;

920 ià(!
ml¥Ş
) {

921 
	`yy”rÜ
("dominance definition in‚on-MLS configuration");

925 ià(
·ss
 == 2) {

926 (
id
 = 
	`queue_»move
(
id_queue
)))

927 
	`ä“
(
id
);

931 
Üd”
 = 0;

932 (
id
 = (*)
	`queue_»move
(
id_queue
))) {

933 
d©um
 =

934 (
Ëv–_d©um_t
 *è
	`hashb_£¬ch
(
pŞicydbp
->
p_Ëv–s
.
bË
,

935 (
hashb_key_t
è
id
);

936 ià(!
d©um
) {

937 
	`yy”rÜ2
("unknown sensitivity %s used in dominance "

938 "defš™iÚ", 
id
);

939 
	`ä“
(
id
);

942 ià(
d©um
->
Ëv–
->
£ns
 != 0) {

943 
	`yy”rÜ2
("sensitivity %s occurs multiply in dominance "

944 "defš™iÚ", 
id
);

945 
	`ä“
(
id
);

948 
d©um
->
Ëv–
->
£ns
 = ++
Üd”
;

951 
	`ä“
(
id
);

954 ià(
Üd”
 !ğ
pŞicydbp
->
p_Ëv–s
.
Årim
) {

955 
yy”rÜ


960 
	}
}

962 
	$defše_ÿ‹gÜy
()

964 *
id
;

965 
ÿt_d©um_t
 *
d©um
 = 0, *
®Ÿsd©um
 = 0;

966 
»t
;

967 
ušt32_t
 
v®ue
;

969 ià(!
ml¥Ş
) {

970 
	`yy”rÜ
("category definition in‚on-MLS configuration");

974 ià(
·ss
 == 2) {

975 (
id
 = 
	`queue_»move
(
id_queue
)))

976 
	`ä“
(
id
);

980 
id
 = (*)
	`queue_»move
(
id_queue
);

981 ià(!
id
) {

982 
	`yy”rÜ
("no category‚ame for category definition?");

985 ià(
	`id_has_dÙ
(
id
)) {

986 
	`yy”rÜ
("category identifiers may‚ot contain…eriods");

987 
bad
;

989 
d©um
 = (
ÿt_d©um_t
 *è
	`m®loc
((cat_datum_t));

990 ià(!
d©um
) {

991 
	`yy”rÜ
("out of memory");

992 
bad
;

994 
	`ÿt_d©um_š™
(
d©um
);

995 
d©um
->
i§lŸs
 = 
FALSE
;

997 
»t
 = 
	`deş¬e_symbŞ
(
SYM_CATS
, 
id
, 
d©um
, &
v®ue
, &value);

998 
»t
) {

1000 
	`yy”rÜ
("Out of memory!");

1001 
bad
;

1004 
	`yy”rÜ
("duplicate declaration of category");

1005 
bad
;

1008 
	`yy”rÜ
("could‚ot declare category here");

1009 
bad
;

1016 
	`as£¹
(0);

1019 
d©um
->
s
.
v®ue
 = value;

1021 (
id
 = 
	`queue_»move
(
id_queue
))) {

1022 ià(
	`id_has_dÙ
(
id
)) {

1023 
	`yy”rÜ
("category‡liases may‚ot contain…eriods");

1024 
bad_®Ÿs
;

1026 
®Ÿsd©um
 = (
ÿt_d©um_t
 *è
	`m®loc
((cat_datum_t));

1027 ià(!
®Ÿsd©um
) {

1028 
	`yy”rÜ
("out of memory");

1029 
bad_®Ÿs
;

1031 
	`ÿt_d©um_š™
(
®Ÿsd©um
);

1032 
®Ÿsd©um
->
i§lŸs
 = 
TRUE
;

1033 
®Ÿsd©um
->
s
.
v®ue
 = 
d©um
->s.value;

1035 
»t
 =

1036 
	`deş¬e_symbŞ
(
SYM_CATS
, 
id
, 
®Ÿsd©um
, 
NULL
,

1037 &
d©um
->
s
.
v®ue
);

1038 
»t
) {

1040 
	`yy”rÜ
("Out of memory!");

1041 
bad_®Ÿs
;

1044 
yy”rÜ


1046 
bad_®Ÿs
;

1049 
yy”rÜ


1051 
bad_®Ÿs
;

1058 
	`as£¹
(0);

1065 
bad
:

1066 ià(
id
)

1067 
	`ä“
(
id
);

1068 ià(
d©um
) {

1069 
	`ÿt_d©um_de¡roy
(
d©um
);

1070 
	`ä“
(
d©um
);

1074 
bad_®Ÿs
:

1075 ià(
id
)

1076 
	`ä“
(
id
);

1077 ià(
®Ÿsd©um
) {

1078 
	`ÿt_d©um_de¡roy
(
®Ÿsd©um
);

1079 
	`ä“
(
®Ÿsd©um
);

1082 
	}
}

1084 
	$şÚe_Ëv–
(
hashb_key_t
 
key
, 
hashb_d©um_t
 
d©um
, *
¬g
)

1086 
Ëv–_d©um_t
 *
Ëvd©um
 = (Ëv–_d©um_ˆ*è
d©um
;

1087 
mls_Ëv–_t
 *
Ëv–
 = (mls_Ëv–_ˆ*è
¬g
, *
ÃwËv–
;

1089 ià(
Ëvd©um
->
Ëv–
 ==†evel) {

1090 
Ëvd©um
->
defšed
 = 1;

1091 ià(!
Ëvd©um
->
i§lŸs
)

1093 
ÃwËv–
 = (
mls_Ëv–_t
 *è
	`m®loc
((mls_level_t));

1094 ià(!
ÃwËv–
)

1096 ià(
	`mls_Ëv–_ıy
(
ÃwËv–
, 
Ëv–
)) {

1097 
	`ä“
(
ÃwËv–
);

1100 
Ëvd©um
->
Ëv–
 = 
ÃwËv–
;

1103 
	}
}

1105 
	$defše_Ëv–
()

1107 *
id
;

1108 
Ëv–_d©um_t
 *
Ëvd©um
;

1110 ià(!
ml¥Ş
) {

1111 
	`yy”rÜ
("level definition in‚on-MLS configuration");

1115 ià(
·ss
 == 2) {

1116 (
id
 = 
	`queue_»move
(
id_queue
)))

1117 
	`ä“
(
id
);

1121 
id
 = (*)
	`queue_»move
(
id_queue
);

1122 ià(!
id
) {

1123 
	`yy”rÜ
("no†evel‚ame for†evel definition?");

1126 
Ëvd©um
 = (
Ëv–_d©um_t
 *è
	`hashb_£¬ch
(
pŞicydbp
->
p_Ëv–s
.
bË
,

1127 (
hashb_key_t
è
id
);

1128 ià(!
Ëvd©um
) {

1129 
	`yy”rÜ2
("unknowÀ£ns™iv™y % u£d iÀËv– defš™iÚ", 
id
);

1130 
	`ä“
(
id
);

1133 ià(
	`eb™m­_Ëngth
(&
Ëvd©um
->
Ëv–
->
ÿt
)) {

1134 
	`yy”rÜ2
("sensitivity %s used in multiple†evel definitions",

1135 
id
);

1136 
	`ä“
(
id
);

1139 
	`ä“
(
id
);

1141 
Ëvd©um
->
defšed
 = 1;

1143 (
id
 = 
	`queue_»move
(
id_queue
))) {

1144 
ÿt_d©um_t
 *
cd©um
;

1145 
¿nge_¡¬t
, 
¿nge_’d
, 
i
;

1147 ià(
	`id_has_dÙ
(
id
)) {

1148 *
id_¡¬t
 = 
id
;

1149 *
id_’d
 = 
	`¡rchr
(
id
, '.');

1151 *(
id_’d
++) = '\0';

1153 
cd©um
 =

1154 (
ÿt_d©um_t
 *è
	`hashb_£¬ch
(
pŞicydbp
->
p_ÿts
.

1155 
bË
,

1156 (
hashb_key_t
)

1157 
id_¡¬t
);

1158 ià(!
cd©um
) {

1159 
	`yy”rÜ2
("unknowÀÿ‹gÜy %s", 
id_¡¬t
);

1160 
	`ä“
(
id
);

1163 
¿nge_¡¬t
 = 
cd©um
->
s
.
v®ue
 - 1;

1164 
cd©um
 =

1165 (
ÿt_d©um_t
 *è
	`hashb_£¬ch
(
pŞicydbp
->
p_ÿts
.

1166 
bË
,

1167 (
hashb_key_t
)

1168 
id_’d
);

1169 ià(!
cd©um
) {

1170 
	`yy”rÜ2
("unknowÀÿ‹gÜy %s", 
id_’d
);

1171 
	`ä“
(
id
);

1174 
¿nge_’d
 = 
cd©um
->
s
.
v®ue
 - 1;

1176 ià(
¿nge_’d
 < 
¿nge_¡¬t
) {

1177 
	`yy”rÜ2
("category„ange is invalid");

1178 
	`ä“
(
id
);

1182 
cd©um
 =

1183 (
ÿt_d©um_t
 *è
	`hashb_£¬ch
(
pŞicydbp
->
p_ÿts
.

1184 
bË
,

1185 (
hashb_key_t
è
id
);

1186 
¿nge_¡¬t
 = 
¿nge_’d
 = 
cd©um
->
s
.
v®ue
 - 1;

1189 
i
 = 
¿nge_¡¬t
; i <ğ
¿nge_’d
; i++) {

1190 ià(
	`eb™m­_£t_b™
(&
Ëvd©um
->
Ëv–
->
ÿt
, 
i
, 
TRUE
)) {

1191 
	`yy”rÜ
("out of memory");

1192 
	`ä“
(
id
);

1197 
	`ä“
(
id
);

1200 ià(
hashb_m­


1201 (
pŞicydbp
->
p_Ëv–s
.
bË
, 
şÚe_Ëv–
, 
Ëvd©um
->
Ëv–
)) {

1202 
	`yy”rÜ
("out of memory");

1207 
	}
}

1209 
	$defše_©Œib
()

1211 ià(
·ss
 == 2) {

1212 
	`ä“
(
	`queue_»move
(
id_queue
));

1216 ià(
	`deş¬e_ty³
(
TRUE
, TRUEè=ğ
NULL
) {

1220 
	}
}

1222 
	$add_®Ÿ£s_to_ty³
(
ty³_d©um_t
 * 
ty³
)

1224 *
id
;

1225 
ty³_d©um_t
 *
®Ÿsd©um
 = 
NULL
;

1226 
»t
;

1227 (
id
 = 
	`queue_»move
(
id_queue
))) {

1228 ià(
	`id_has_dÙ
(
id
)) {

1229 
	`ä“
(
id
);

1230 
yy”rÜ


1234 
®Ÿsd©um
 = (
ty³_d©um_t
 *è
	`m®loc
((type_datum_t));

1235 ià(!
®Ÿsd©um
) {

1236 
	`ä“
(
id
);

1237 
	`yy”rÜ
("Out of memory!");

1240 
	`mem£t
(
®Ÿsd©um
, 0, (
ty³_d©um_t
));

1241 
®Ÿsd©um
->
s
.
v®ue
 = 
ty³
->s.value;

1243 
»t
 = 
	`deş¬e_symbŞ
(
SYM_TYPES
, 
id
, 
®Ÿsd©um
,

1244 
NULL
, &
®Ÿsd©um
->
s
.
v®ue
);

1245 
»t
) {

1247 
	`yy”rÜ
("Out of memory!");

1248 
ş—nup
;

1251 
	`yy”rÜ2
("duplicate declaration of‡lias %s",

1252 
id
);

1253 
ş—nup
;

1256 
	`yy”rÜ
("could‚ot declare‡lias here");

1257 
ş—nup
;

1263 
	`ty³_d©um_de¡roy
(
®Ÿsd©um
);

1264 
	`ä“
(
®Ÿsd©um
);

1266 
®Ÿsd©um
 = 
	`hashb_£¬ch
(
pŞicydbp
->
symb
[
SYM_TYPES
].
bË
, 
id
);

1267 
	`as£¹
(
®Ÿsd©um
);

1269 
®Ÿsd©um
->
´im¬y
 = 
ty³
->
s
.
v®ue
;

1270 
®Ÿsd©um
->
æavÜ
 = 
TYPE_ALIAS
;

1275 
	`as£¹
(0);

1280 
ş—nup
:

1281 
	`ä“
(
id
);

1282 
	`ty³_d©um_de¡roy
(
®Ÿsd©um
);

1283 
	`ä“
(
®Ÿsd©um
);

1285 
	}
}

1287 
	$defše_ty³®Ÿs
()

1289 *
id
;

1290 
ty³_d©um_t
 *
t
;

1292 ià(
·ss
 == 2) {

1293 (
id
 = 
	`queue_»move
(
id_queue
)))

1294 
	`ä“
(
id
);

1298 
id
 = (*)
	`queue_»move
(
id_queue
);

1299 ià(!
id
) {

1300 
	`yy”rÜ
("noype‚ame forypealias definition?");

1304 ià(!
	`is_id_š_scİe
(
SYM_TYPES
, 
id
)) {

1305 
	`yy”rÜ2
("ty³ % i nÙ w™hš scİe", 
id
);

1306 
	`ä“
(
id
);

1309 
t
 = 
	`hashb_£¬ch
(
pŞicydbp
->
p_ty³s
.
bË
, 
id
);

1310 ià(!
t
 ||->
æavÜ
 =ğ
TYPE_ATTRIB
) {

1311 
	`yy”rÜ2
("unknownype %s, or it was‡lready declared‡s‡n "

1312 "©Œibu‹", 
id
);

1313 
	`ä“
(
id
);

1316  
	`add_®Ÿ£s_to_ty³
(
t
);

1317 
	}
}

1319 
	$defše_ty³©Œibu‹
()

1321 *
id
;

1322 
ty³_d©um_t
 *
t
, *
©Œ
;

1324 ià(
·ss
 == 2) {

1325 (
id
 = 
	`queue_»move
(
id_queue
)))

1326 
	`ä“
(
id
);

1330 
id
 = (*)
	`queue_»move
(
id_queue
);

1331 ià(!
id
) {

1332 
	`yy”rÜ
("noype‚ame forypeattribute definition?");

1336 ià(!
	`is_id_š_scİe
(
SYM_TYPES
, 
id
)) {

1337 
	`yy”rÜ2
("ty³ % i nÙ w™hš scİe", 
id
);

1338 
	`ä“
(
id
);

1341 
t
 = 
	`hashb_£¬ch
(
pŞicydbp
->
p_ty³s
.
bË
, 
id
);

1342 ià(!
t
 ||->
æavÜ
 =ğ
TYPE_ATTRIB
) {

1343 
	`yy”rÜ2
("unknowÀty³ %s", 
id
);

1344 
	`ä“
(
id
);

1348 (
id
 = 
	`queue_»move
(
id_queue
))) {

1349 ià(!
	`is_id_š_scİe
(
SYM_TYPES
, 
id
)) {

1350 
	`yy”rÜ2
("©Œibu‹ % i nÙ w™hš scİe", 
id
);

1351 
	`ä“
(
id
);

1354 
©Œ
 = 
	`hashb_£¬ch
(
pŞicydbp
->
p_ty³s
.
bË
, 
id
);

1355 ià(!
©Œ
) {

1357 
	`yy”rÜ2
("©Œibu‹ % i nÙ deş¬ed", 
id
);

1358 
	`ä“
(
id
);

1362 ià(
©Œ
->
æavÜ
 !ğ
TYPE_ATTRIB
) {

1363 
	`yy”rÜ2
("% i ¨ty³,‚Ù‡À©Œibu‹", 
id
);

1364 
	`ä“
(
id
);

1368 ià((
©Œ
 = 
	`g‘_loÿl_ty³
(
id
,‡‰r->
s
.
v®ue
, 1)è=ğ
NULL
) {

1369 
	`yy”rÜ
("Out of memory!");

1373 ià(
	`eb™m­_£t_b™
(&
©Œ
->
ty³s
, (
t
->
s
.
v®ue
 - 1), 
TRUE
)) {

1374 
	`yy”rÜ
("out of memory");

1380 
	}
}

1382 
	$defše_ty³bounds_h–³r
(*
bounds_id
, *
ty³_id
)

1384 
ty³_d©um_t
 *
bounds
, *
ty³
;

1386 ià(!
	`is_id_š_scİe
(
SYM_TYPES
, 
bounds_id
)) {

1387 
	`yy”rÜ2
("ty³ % i nÙ w™hš scİe", 
bounds_id
);

1391 
bounds
 = 
	`hashb_£¬ch
(
pŞicydbp
->
p_ty³s
.
bË
, 
bounds_id
);

1392 ià(!
bounds
 || bounds->
æavÜ
 =ğ
TYPE_ATTRIB
) {

1393 
	`yy”rÜ2
("hogunknowÀty³ %s", 
bounds_id
);

1397 ià(!
	`is_id_š_scİe
(
SYM_TYPES
, 
ty³_id
)) {

1398 
	`yy”rÜ2
("ty³ % i nÙ w™hš scİe", 
ty³_id
);

1402 
ty³
 = 
	`hashb_£¬ch
(
pŞicydbp
->
p_ty³s
.
bË
, 
ty³_id
);

1403 ià(!
ty³
 ||y³->
æavÜ
 =ğ
TYPE_ATTRIB
) {

1404 
	`yy”rÜ2
("ty³ % i nÙ deş¬ed", 
ty³_id
);

1408 ià(
ty³
->
æavÜ
 =ğ
TYPE_TYPE
 && !ty³->
´im¬y
) {

1409 
ty³
 = 
pŞicydbp
->
ty³_v®_to_¡ruù
[ty³->
s
.
v®ue
 - 1];

1410 } ià(
ty³
->
æavÜ
 =ğ
TYPE_ALIAS
) {

1411 
ty³
 = 
pŞicydbp
->
ty³_v®_to_¡ruù
[ty³->
´im¬y
 - 1];

1414 ià(!
ty³
->
bounds
)

1415 
ty³
->
bounds
 = bounds->
s
.
v®ue
;

1416 ià(
ty³
->
bounds
 !ğbounds->
s
.
v®ue
) {

1417 
	`yy”rÜ2
("type %s has inconsistent master {%s,%s}",

1418 
ty³_id
,

1419 
pŞicydbp
->
p_ty³_v®_to_Çme
[
ty³
->
bounds
 - 1],

1420 
pŞicydbp
->
p_ty³_v®_to_Çme
[
bounds
->
s
.
v®ue
 - 1]);

1425 
	}
}

1427 
	$defše_ty³bounds
()

1429 *
id
;

1431 ià(
·ss
 == 1) {

1432 (
id
 = 
	`queue_»move
(
id_queue
)))

1433 
	`ä“
(
id
);

1437 #ifdeà
HAVE_SEPOL_BOUNDARY


1438 *
bounds
;

1440 
bounds
 = (*è
	`queue_»move
(
id_queue
);

1441 ià(!
bounds
) {

1442 
	`yy”rÜ
("noype‚ame forypebounds definition?");

1446 (
id
 = 
	`queue_»move
(
id_queue
))) {

1447 ià(
	`defše_ty³bounds_h–³r
(
bounds
, 
id
))

1449 
	`ä“
(
id
);

1451 
	`ä“
(
bounds
);

1455 
	`yy”rÜ
("This version of SETools does‚ot haveypeboundsƒnabled.");

1457 
	}
}

1459 
	$defše_ty³
(
®Ÿs
)

1461 *
id
;

1462 
ty³_d©um_t
 *
d©um
, *
©Œ
;

1464 ià(
·ss
 == 2) {

1470 ià((
id
 = 
	`queue_»move
(
id_queue
))) {

1471 *
bounds
, *
d–im
;

1473 ià((
d–im
 = 
	`¡¼chr
(
id
, '.'))

1474 && (
bounds
 = 
	`¡rdup
(
id
))) {

1475 
bounds
[(
size_t
)(
d–im
 - 
id
)] = '\0';

1477 ià(
	`defše_ty³bounds_h–³r
(
bounds
, 
id
))

1479 
	`ä“
(
bounds
);

1481 
	`ä“
(
id
);

1484 ià(
®Ÿs
) {

1485 (
id
 = 
	`queue_»move
(
id_queue
)))

1486 
	`ä“
(
id
);

1489 (
id
 = 
	`queue_»move
(
id_queue
)))

1490 
	`ä“
(
id
);

1494 ià((
d©um
 = 
	`deş¬e_ty³
(
TRUE
, 
FALSE
)è=ğ
NULL
) {

1498 ià(
®Ÿs
) {

1499 ià(
	`add_®Ÿ£s_to_ty³
(
d©um
) == -1) {

1504 (
id
 = 
	`queue_»move
(
id_queue
))) {

1505 ià(!
	`is_id_š_scİe
(
SYM_TYPES
, 
id
)) {

1506 
	`yy”rÜ2
("©Œibu‹ % i nÙ w™hš scİe", 
id
);

1507 
	`ä“
(
id
);

1510 
©Œ
 = 
	`hashb_£¬ch
(
pŞicydbp
->
p_ty³s
.
bË
, 
id
);

1511 ià(!
©Œ
) {

1513 
	`yy”rÜ2
("©Œibu‹ % i nÙ deş¬ed", 
id
);

1517 ià(
©Œ
->
æavÜ
 !ğ
TYPE_ATTRIB
) {

1518 
	`yy”rÜ2
("% i ¨ty³,‚Ù‡À©Œibu‹", 
id
);

1522 ià((
©Œ
 = 
	`g‘_loÿl_ty³
(
id
,‡‰r->
s
.
v®ue
, 1)è=ğ
NULL
) {

1523 
	`yy”rÜ
("Out of memory!");

1527 ià(
	`eb™m­_£t_b™
(&
©Œ
->
ty³s
, 
d©um
->
s
.
v®ue
 - 1, 
TRUE
)) {

1528 
	`yy”rÜ
("Out of memory");

1534 
	}
}

1536 
	sv®_to_Çme
 {

1537 
	mv®
;

1538 *
	mÇme
;

1544 
	$£t_ty³s
(
ty³_£t_t
 * 
£t
, *
id
, *
add
, 
¡¬®lowed
)

1546 
ty³_d©um_t
 *
t
;

1548 ià(
	`¡rcmp
(
id
, "*") == 0) {

1549 ià(!
¡¬®lowed
) {

1550 
	`yy”rÜ
("*‚ot‡llowed inhisype of„ule");

1554 
£t
->
æags
 = 
TYPE_STAR
;

1555 
	`ä“
(
id
);

1556 *
add
 = 1;

1560 ià(
	`¡rcmp
(
id
, "~") == 0) {

1561 ià(!
¡¬®lowed
) {

1562 
	`yy”rÜ
("~‚ot‡llowed inhisype of„ule");

1566 
£t
->
æags
 = 
TYPE_COMP
;

1567 
	`ä“
(
id
);

1568 *
add
 = 1;

1572 ià(
	`¡rcmp
(
id
, "-") == 0) {

1573 *
add
 = 0;

1574 
	`ä“
(
id
);

1578 ià(!
	`is_id_š_scİe
(
SYM_TYPES
, 
id
)) {

1579 
	`yy”rÜ2
("ty³ % i nÙ w™hš scİe", 
id
);

1580 
	`ä“
(
id
);

1583 
t
 = 
	`hashb_£¬ch
(
pŞicydbp
->
p_ty³s
.
bË
, 
id
);

1584 ià(!
t
) {

1585 
	`yy”rÜ2
("unknowÀty³ %s", 
id
);

1586 
	`ä“
(
id
);

1590 ià(*
add
 == 0) {

1591 ià(
	`eb™m­_£t_b™
(&
£t
->
Ãg£t
, 
t
->
s
.
v®ue
 - 1, 
TRUE
))

1592 
oom
;

1594 ià(
	`eb™m­_£t_b™
(&
£t
->
ty³s
, 
t
->
s
.
v®ue
 - 1, 
TRUE
))

1595 
oom
;

1597 
	`ä“
(
id
);

1598 *
add
 = 1;

1600 
oom
:

1601 
	`yy”rÜ
("Out of memory");

1602 
	`ä“
(
id
);

1604 
	}
}

1606 
	$defše_compu‹_ty³_h–³r
(
which
, 
avruË_t
 ** 
ruË
)

1608 *
id
;

1609 
ty³_d©um_t
 *
d©um
;

1610 
eb™m­_t
 
tşas£s
;

1611 
eb™m­_node_t
 *
node
;

1612 
avruË_t
 *
avruË
;

1613 
şass_³rm_node_t
 *
³rm
;

1614 
i
, 
add
 = 1;

1616 
avruË
 = 
	`m®loc
((
avruË_t
));

1617 ià(!
avruË
) {

1618 
	`yy”rÜ
("out of memory");

1621 
	`avruË_š™
(
avruË
);

1622 
avruË
->
¥ecif›d
 = 
which
;

1623 
avruË
->
lše
 = 
pŞicydb_lš’o
;

1625 (
id
 = 
	`queue_»move
(
id_queue
))) {

1626 ià(
	`£t_ty³s
(&
avruË
->
¡y³s
, 
id
, &
add
, 0))

1627 
bad
;

1629 
add
 = 1;

1630 (
id
 = 
	`queue_»move
(
id_queue
))) {

1631 ià(
	`£t_ty³s
(&
avruË
->
‰y³s
, 
id
, &
add
, 0))

1632 
bad
;

1635 
	`eb™m­_š™
(&
tşas£s
);

1636 ià(
	`»ad_şas£s
(&
tşas£s
))

1637 
bad
;

1639 
id
 = (*)
	`queue_»move
(
id_queue
);

1640 ià(!
id
) {

1641 
	`yy”rÜ
("no‚ewtype?");

1642 
bad
;

1644 ià(!
	`is_id_š_scİe
(
SYM_TYPES
, 
id
)) {

1645 
	`yy”rÜ2
("ty³ % i nÙ w™hš scİe", 
id
);

1646 
	`ä“
(
id
);

1647 
bad
;

1649 
d©um
 = (
ty³_d©um_t
 *è
	`hashb_£¬ch
(
pŞicydbp
->
p_ty³s
.
bË
,

1650 (
hashb_key_t
è
id
);

1651 ià(!
d©um
 || d©um->
æavÜ
 =ğ
TYPE_ATTRIB
) {

1652 
	`yy”rÜ2
("unknowÀty³ %s", 
id
);

1653 
bad
;

1656 
	`eb™m­_fÜ_—ch_b™
(&
tşas£s
, 
node
, 
i
) {

1657 ià(
	`eb™m­_node_g‘_b™
(
node
, 
i
)) {

1658 
³rm
 = 
	`m®loc
((
şass_³rm_node_t
));

1659 ià(!
³rm
) {

1660 
	`yy”rÜ
("out of memory");

1661 
bad
;

1663 
	`şass_³rm_node_š™
(
³rm
);

1664 
³rm
->
tşass
 = 
i
 + 1;

1665 
³rm
->
d©a
 = 
d©um
->
s
.
v®ue
;

1666 
³rm
->
Ãxt
 = 
avruË
->
³rms
;

1667 
avruË
->
³rms
 = 
³rm
;

1670 
	`eb™m­_de¡roy
(&
tşas£s
);

1672 *
ruË
 = 
avruË
;

1675 
bad
:

1676 
	`avruË_de¡roy
(
avruË
);

1677 
	`ä“
(
avruË
);

1679 
	}
}

1681 
	$defše_compu‹_ty³
(
which
)

1683 *
id
;

1684 
avruË_t
 *
avruË
;

1685 
»tv®
;

1687 ià(
·ss
 =ğ1 || (
num_ruËs
 && !
lßd_ruËs
)) {

1688 (
id
 = 
	`queue_»move
(
id_queue
)))

1689 
	`ä“
(
id
);

1690 (
id
 = 
	`queue_»move
(
id_queue
)))

1691 
	`ä“
(
id
);

1692 (
id
 = 
	`queue_»move
(
id_queue
)))

1693 
	`ä“
(
id
);

1694 
id
 = 
	`queue_»move
(
id_queue
);

1695 
	`ä“
(
id
);

1699 
num_ruËs
++;

1701 ià(
	`defše_compu‹_ty³_h–³r
(
which
, &
avruË
))

1704 
»tv®
 = 
	`š£¹_check_ty³_ruË
(
avruË
, &
pŞicydbp
->
‹_avb
, 
NULL
, NULL);

1705 
»tv®
) {

1708 
	`­³nd_avruË
(
avruË
);

1714 
	`avruË_de¡roy
(
avruË
);

1715 
	`ä“
(
avruË
);

1719 
	`avruË_de¡roy
(
avruË
);

1720 
	`ä“
(
avruË
);

1724 
	`as£¹
(0);

1727 
	}
}

1729 
avruË_t
 *
	$defše_cÚd_compu‹_ty³
(
which
)

1731 *
id
;

1732 
avruË_t
 *
avruË
;

1734 ià(
·ss
 =ğ1 || (
num_ruËs
 && !
lßd_ruËs
)) {

1735 (
id
 = 
	`queue_»move
(
id_queue
)))

1736 
	`ä“
(
id
);

1737 (
id
 = 
	`queue_»move
(
id_queue
)))

1738 
	`ä“
(
id
);

1739 (
id
 = 
	`queue_»move
(
id_queue
)))

1740 
	`ä“
(
id
);

1741 
id
 = 
	`queue_»move
(
id_queue
);

1742 
	`ä“
(
id
);

1743  (
avruË_t
 *) 1;

1746 
num_ruËs
++;

1748 ià(
	`defše_compu‹_ty³_h–³r
(
which
, &
avruË
))

1749  
COND_ERR
;

1751  
avruË
;

1752 
	}
}

1754 
	$defše_boŞ_tuÇbË
(
is_tuÇbË
)

1756 *
id
, *
boŞ_v®ue
;

1757 
cÚd_boŞ_d©um_t
 *
d©um
;

1758 
»t
;

1759 
ušt32_t
 
v®ue
;

1761 ià(
·ss
 == 2) {

1762 (
id
 = 
	`queue_»move
(
id_queue
)))

1763 
	`ä“
(
id
);

1767 
id
 = (*)
	`queue_»move
(
id_queue
);

1768 ià(!
id
) {

1769 
	`yy”rÜ
("no identifier for bool definition?");

1772 ià(
	`id_has_dÙ
(
id
)) {

1773 
	`ä“
(
id
);

1774 
	`yy”rÜ
("boolean identifiers may‚ot contain…eriods");

1777 
d©um
 = (
cÚd_boŞ_d©um_t
 *è
	`m®loc
((cond_bool_datum_t));

1778 ià(!
d©um
) {

1779 
	`yy”rÜ
("out of memory");

1780 
	`ä“
(
id
);

1783 
	`mem£t
(
d©um
, 0, (
cÚd_boŞ_d©um_t
));

1784 ià(
is_tuÇbË
)

1785 
d©um
->
æags
 |ğ
COND_BOOL_FLAGS_TUNABLE
;

1786 
»t
 = 
	`deş¬e_symbŞ
(
SYM_BOOLS
, 
id
, 
d©um
, &
v®ue
, &value);

1787 
»t
) {

1789 
	`yy”rÜ
("Out of memory!");

1790 
ş—nup
;

1793 
	`yy”rÜ2
("du¶iÿ‹ deş¬©iÚ oàboŞ—À%s", 
id
);

1794 
ş—nup
;

1797 
	`yy”rÜ
("could‚ot declare boolean here");

1798 
ş—nup
;

1805 
	`as£¹
(0);

1808 
d©um
->
s
.
v®ue
 = value;

1810 
boŞ_v®ue
 = (*)
	`queue_»move
(
id_queue
);

1811 ià(!
boŞ_v®ue
) {

1812 
	`yy”rÜ
("no default value for bool definition?");

1813 
	`ä“
(
id
);

1817 
d©um
->
¡©e
 = ()(
boŞ_v®ue
[0] == 'T') ? 1 : 0;

1819 
ş—nup
:

1820 
	`cÚd_de¡roy_boŞ
(
id
, 
d©um
, 
NULL
);

1822 
	}
}

1824 
avruË_t
 *
	$defše_cÚd_pŞ_li¡
(
avruË_t
 * 
avli¡
,‡vruË_ˆ* 
¦
)

1826 ià(
·ss
 =ğ1 || (
num_ruËs
 && !
lßd_ruËs
)) {

1828  (
avruË_t
 *) 1;

1831 ià(
¦
 =ğ
NULL
) {

1833  
avli¡
;

1837 
¦
->
Ãxt
 = 
avli¡
;

1838  
¦
;

1839 
	}
}

1841 
	$defše_‹_avb_h–³r
(
which
, 
avruË_t
 ** 
ruË
)

1843 *
id
;

1844 
şass_d©um_t
 *
şad©um
;

1845 
³rm_d©um_t
 *
³rd©um
 = 
NULL
;

1846 
şass_³rm_node_t
 *
³rms
, *

 = 
NULL
, *
cur_³rms
 = NULL;

1847 
eb™m­_t
 
tşas£s
;

1848 
eb™m­_node_t
 *
node
;

1849 
avruË_t
 *
avruË
;

1850 
i
;

1851 
add
 = 1, 
»t
 = 0;

1852 
suµ»ss
 = 0;

1854 
avruË
 = (
avruË_t
 *è
	`m®loc
((avrule_t));

1855 ià(!
avruË
) {

1856 
	`yy”rÜ
("memoryƒrror");

1857 
»t
 = -1;

1858 
out
;

1860 
	`avruË_š™
(
avruË
);

1861 
avruË
->
¥ecif›d
 = 
which
;

1862 
avruË
->
lše
 = 
pŞicydb_lš’o
;

1864 (
id
 = 
	`queue_»move
(
id_queue
))) {

1865 ià(
£t_ty³s


1866 (&
avruË
->
¡y³s
, 
id
, &
add
,

1867 
which
 =ğ
AVRULE_NEVERALLOW
 ? 1 : 0)) {

1868 
»t
 = -1;

1869 
out
;

1872 
add
 = 1;

1873 (
id
 = 
	`queue_»move
(
id_queue
))) {

1874 ià(
	`¡rcmp
(
id
, "self") == 0) {

1875 
	`ä“
(
id
);

1876 
avruË
->
æags
 |ğ
RULE_SELF
;

1879 ià(
£t_ty³s


1880 (&
avruË
->
‰y³s
, 
id
, &
add
,

1881 
which
 =ğ
AVRULE_NEVERALLOW
 ? 1 : 0)) {

1882 
»t
 = -1;

1883 
out
;

1887 
	`eb™m­_š™
(&
tşas£s
);

1888 
»t
 = 
	`»ad_şas£s
(&
tşas£s
);

1889 ià(
»t
)

1890 
out
;

1892 
³rms
 = 
NULL
;

1893 
	`eb™m­_fÜ_—ch_b™
(&
tşas£s
, 
node
, 
i
) {

1894 ià(!
	`eb™m­_node_g‘_b™
(
node
, 
i
))

1896 
cur_³rms
 =

1897 (
şass_³rm_node_t
 *è
	`m®loc
((class_perm_node_t));

1898 ià(!
cur_³rms
) {

1899 
	`yy”rÜ
("out of memory");

1900 
»t
 = -1;

1901 
out
;

1903 
	`şass_³rm_node_š™
(
cur_³rms
);

1904 
cur_³rms
->
tşass
 = 
i
 + 1;

1905 ià(!
³rms
)

1906 
³rms
 = 
cur_³rms
;

1907 ià(

)

1908 

->
Ãxt
 = 
cur_³rms
;

1909 

 = 
cur_³rms
;

1912 (
id
 = 
	`queue_»move
(
id_queue
))) {

1913 
cur_³rms
 = 
³rms
;

1914 
	`eb™m­_fÜ_—ch_b™
(&
tşas£s
, 
node
, 
i
) {

1915 ià(!
	`eb™m­_node_g‘_b™
(
node
, 
i
))

1917 
şad©um
 = 
pŞicydbp
->
şass_v®_to_¡ruù
[
i
];

1919 ià(
	`¡rcmp
(
id
, "*") == 0) {

1921 
cur_³rms
->
d©a
 = ~0U;

1922 
Ãxt
;

1925 ià(
	`¡rcmp
(
id
, "~") == 0) {

1927 ià(
which
 =ğ
AVRULE_DONTAUDIT
)

1928 
	`yyw¬n
("dontaudit„ule with‡ ~?");

1929 
cur_³rms
->
d©a
 = ~cur_perms->data;

1930 
Ãxt
;

1933 
³rd©um
 =

1934 
	`hashb_£¬ch
(
şad©um
->
³rmissiÚs
.
bË
, 
id
);

1935 ià(!
³rd©um
) {

1936 ià(
şad©um
->
comd©um
) {

1937 
³rd©um
 =

1938 
	`hashb_£¬ch
(
şad©um
->
comd©um
->

1939 
³rmissiÚs
.
bË
,

1940 
id
);

1943 ià(!
³rd©um
) {

1944 ià(!
suµ»ss
)

1945 
	`yy”rÜ2
("permission %s is‚ot defined"

1946 " fÜ cÏs %s", 
id
,

1947 
pŞicydbp
->
p_şass_v®_to_Çme
[
i
]);

1950 ià(!
is_³rm_š_scİe


1951 (
id
, 
pŞicydbp
->
p_şass_v®_to_Çme
[
i
])) {

1952 ià(!
suµ»ss
) {

1953 
	`yy”rÜ2
("permission %s of class %s is"

1954 "‚Ù w™hš scİe", 
id
,

1955 
pŞicydbp
->
p_şass_v®_to_Çme
[
i
]);

1959 
cur_³rms
->
d©a
 |ğ1U << (
³rd©um
->
s
.
v®ue
 - 1);

1961 
Ãxt
:

1962 
cur_³rms
 = cur_³rms->
Ãxt
;

1965 
	`ä“
(
id
);

1968 
	`eb™m­_de¡roy
(&
tşas£s
);

1970 
avruË
->
³rms
 =…erms;

1971 *
ruË
 = 
avruË
;

1973 
out
:

1974  
»t
;

1976 
	}
}

1978 
avruË_t
 *
	$defše_cÚd_‹_avb
(
which
)

1980 *
id
;

1981 
avruË_t
 *
avruË
;

1982 
i
;

1984 ià(
·ss
 =ğ1 || (
num_ruËs
 && !
lßd_ruËs
)) {

1985 
i
 = 0; i < 4; i++) {

1986 (
id
 = 
	`queue_»move
(
id_queue
)))

1987 
	`ä“
(
id
);

1989  (
avruË_t
 *) 1;

1992 
num_ruËs
++;

1994 ià(
	`defše_‹_avb_h–³r
(
which
, &
avruË
))

1995  
COND_ERR
;

1997  
avruË
;

1998 
	}
}

2000 
	$defše_‹_avb
(
which
)

2002 *
id
;

2003 
avruË_t
 *
avruË
;

2004 
i
;

2006 ià(
·ss
 =ğ1 || (
num_ruËs
 && !
lßd_ruËs
)) {

2007 
i
 = 0; i < 4; i++) {

2008 (
id
 = 
	`queue_»move
(
id_queue
)))

2009 
	`ä“
(
id
);

2014 
num_ruËs
++;

2016 ià(
	`defše_‹_avb_h–³r
(
which
, &
avruË
))

2020 
	`­³nd_avruË
(
avruË
);

2022 
	}
}

2027 
	$defše_rŞe_ty³s
()

2029 
rŞe_d©um_t
 *
rŞe
;

2030 *
id
;

2031 
add
 = 1;

2033 ià(
·ss
 == 1) {

2034 (
id
 = 
	`queue_»move
(
id_queue
)))

2035 
	`ä“
(
id
);

2039 
id
 = (*)
	`queue_»move
(
id_queue
);

2040 ià(!
id
) {

2041 
	`yy”rÜ
("no„ole‚ame for„ole-types„ule?");

2045 ià(!
	`is_id_š_scİe
(
SYM_ROLES
, 
id
)) {

2046 
	`yy”rÜ2
("rŞ% i nÙ w™hš scİe", 
id
);

2047 
	`ä“
(
id
);

2051 
rŞe
 = 
	`hashb_£¬ch
(
pŞicydbp
->
p_rŞes
.
bË
, 
id
);

2052 ià(!
rŞe
) {

2053 
	`yy”rÜ2
("unknowÀrŞ%s", 
id
);

2054 
	`ä“
(
id
);

2058 (
id
 = 
	`queue_»move
(
id_queue
))) {

2059 ià(
	`£t_ty³s
(&
rŞe
->
ty³s
, 
id
, &
add
, 0))

2064 
	}
}

2066 
	$defše_©Œib_rŞe
()

2068 ià(
·ss
 == 2) {

2069 
	`ä“
(
	`queue_»move
(
id_queue
));

2074 ià(
	`deş¬e_rŞe
(
TRUE
è=ğ
NULL
)

2078 
	}
}

2080 
	$defše_rŞe_©Œ
()

2082 *
id
;

2083 
rŞe_d©um_t
 *
r
, *
©Œ
;

2085 ià(
·ss
 == 2) {

2086 (
id
 = 
	`queue_»move
(
id_queue
)))

2087 
	`ä“
(
id
);

2092 ià((
r
 = 
	`deş¬e_rŞe
(
FALSE
)è=ğ
NULL
)

2095 (
id
 = 
	`queue_»move
(
id_queue
))) {

2096 ià(!
	`is_id_š_scİe
(
SYM_ROLES
, 
id
)) {

2097 
	`yy”rÜ2
("©Œibu‹ % i nÙ w™hš scİe", 
id
);

2098 
	`ä“
(
id
);

2101 
©Œ
 = 
	`hashb_£¬ch
(
pŞicydbp
->
p_rŞes
.
bË
, 
id
);

2102 ià(!
©Œ
) {

2104 
	`yy”rÜ2
("rŞ©Œibu‹ % i nÙ deş¬ed", 
id
);

2105 
	`ä“
(
id
);

2109 ià(
©Œ
->
æavÜ
 !ğ
ROLE_ATTRIB
) {

2110 
	`yy”rÜ2
("% i ¨»guÏ¸rŞe,‚Ù‡À©Œibu‹", 
id
);

2111 
	`ä“
(
id
);

2115 ià((
©Œ
 = 
	`g‘_loÿl_rŞe
(
id
,‡‰r->
s
.
v®ue
, 1)è=ğ
NULL
) {

2116 
	`yy”rÜ
("Out of memory!");

2120 ià(
	`eb™m­_£t_b™
(&
©Œ
->
rŞes
, (
r
->
s
.
v®ue
 - 1), 
TRUE
)) {

2121 
	`yy”rÜ
("out of memory");

2127 
	}
}

2129 
	$defše_rŞ—‰ribu‹
()

2131 *
id
;

2132 
rŞe_d©um_t
 *
r
, *
©Œ
;

2134 ià(
·ss
 == 2) {

2135 (
id
 = 
	`queue_»move
(
id_queue
)))

2136 
	`ä“
(
id
);

2140 
id
 = (*)
	`queue_»move
(
id_queue
);

2141 ià(!
id
) {

2142 
	`yy”rÜ
("no„ole‚ame for„oleattribute definition?");

2146 ià(!
	`is_id_š_scİe
(
SYM_ROLES
, 
id
)) {

2147 
	`yy”rÜ2
("rŞ% i nÙ w™hš scİe", 
id
);

2148 
	`ä“
(
id
);

2151 
r
 = 
	`hashb_£¬ch
(
pŞicydbp
->
p_rŞes
.
bË
, 
id
);

2153 ià(!
r
) {

2154 
	`yy”rÜ2
("unknowÀrŞ%s", 
id
);

2155 
	`ä“
(
id
);

2159 (
id
 = 
	`queue_»move
(
id_queue
))) {

2160 ià(!
	`is_id_š_scİe
(
SYM_ROLES
, 
id
)) {

2161 
	`yy”rÜ2
("©Œibu‹ % i nÙ w™hš scİe", 
id
);

2162 
	`ä“
(
id
);

2165 
©Œ
 = 
	`hashb_£¬ch
(
pŞicydbp
->
p_rŞes
.
bË
, 
id
);

2166 ià(!
©Œ
) {

2168 
	`yy”rÜ2
("rŞ©Œibu‹ % i nÙ deş¬ed", 
id
);

2169 
	`ä“
(
id
);

2173 ià(
©Œ
->
æavÜ
 !ğ
ROLE_ATTRIB
) {

2174 
	`yy”rÜ2
("% i ¨»guÏ¸rŞe,‚Ù‡À©Œibu‹", 
id
);

2175 
	`ä“
(
id
);

2179 ià((
©Œ
 = 
	`g‘_loÿl_rŞe
(
id
,‡‰r->
s
.
v®ue
, 1)è=ğ
NULL
) {

2180 
	`yy”rÜ
("Out of memory!");

2184 ià(
	`eb™m­_£t_b™
(&
©Œ
->
rŞes
, (
r
->
s
.
v®ue
 - 1), 
TRUE
)) {

2185 
	`yy”rÜ
("out of memory");

2191 
	}
}

2193 
rŞe_d©um_t
 *
	$m”ge_rŞes_dom
(
rŞe_d©um_t
 * 
r1
,„Şe_d©um_ˆ* 
r2
)

2195 
rŞe_d©um_t
 *
Ãw
;

2197 ià(
·ss
 == 1) {

2198  (
rŞe_d©um_t
 *) 1;

2201 
Ãw
 = 
	`m®loc
((
rŞe_d©um_t
));

2202 ià(!
Ãw
) {

2203 
	`yy”rÜ
("out of memory");

2204  
NULL
;

2206 
	`mem£t
(
Ãw
, 0, (
rŞe_d©um_t
));

2207 
Ãw
->
s
.
v®ue
 = 0;

2208 ià(
	`eb™m­_Ü
(&
Ãw
->
domš©es
, &
r1
->domš©es, &
r2
->dominates)) {

2209 
	`yy”rÜ
("out of memory");

2210 
	`ä“
(
Ãw
);

2211  
NULL
;

2213 ià(
	`eb™m­_Ü
(&
Ãw
->
ty³s
.ty³s, &
r1
->ty³s.ty³s, &
r2
->types.types)) {

2214 
	`yy”rÜ
("out of memory");

2215 
	`ä“
(
Ãw
);

2216  
NULL
;

2218 ià(!
r1
->
s
.
v®ue
) {

2220 
	`ty³_£t_de¡roy
(&
r1
->
ty³s
);

2221 
	`eb™m­_de¡roy
(&
r1
->
domš©es
);

2222 
	`ä“
(
r1
);

2224 ià(!
r2
->
s
.
v®ue
) {

2226 
	`yy”rÜ
("right hand„ole isemporary?");

2227 
	`ty³_£t_de¡roy
(&
r2
->
ty³s
);

2228 
	`eb™m­_de¡roy
(&
r2
->
domš©es
);

2229 
	`ä“
(
r2
);

2231  
Ãw
;

2232 
	}
}

2235 
	$domš©e_rŞe_»check
(
hashb_key_t
 
key
, 
hashb_d©um_t
 
d©um
,

2236 *
¬g
)

2238 
rŞe_d©um_t
 *
rdp
 = (rŞe_d©um_ˆ*è
¬g
;

2239 
rŞe_d©um_t
 *
rd©um
 = (rŞe_d©um_ˆ*è
d©um
;

2240 
eb™m­_node_t
 *
node
;

2241 
i
;

2244 ià(
rd©um
->
s
.
v®ue
 =ğ
rdp
->s.value)

2248 ià(
	`eb™m­_g‘_b™
(&(
rd©um
->
domš©es
), 
rdp
->
s
.
v®ue
 - 1)) {

2249 
eb™m­_t
 
ty³s
;

2250 
	`eb™m­_š™
(&
ty³s
);

2251 ià(
	`ty³_£t_ex·nd
(&
rdp
->
ty³s
, &ty³s, 
pŞicydbp
, 1)) {

2252 
	`eb™m­_de¡roy
(&
ty³s
);

2256 
	`eb™m­_fÜ_—ch_b™
(&
rdp
->
domš©es
, 
node
, 
i
) {

2257 ià(
	`eb™m­_node_g‘_b™
(
node
, 
i
))

2258 ià(
eb™m­_£t_b™


2259 (&
rd©um
->
domš©es
, 
i
, 
TRUE
))

2260 
oom
;

2262 
	`eb™m­_fÜ_—ch_b™
(&
ty³s
, 
node
, 
i
) {

2263 ià(
	`eb™m­_node_g‘_b™
(
node
, 
i
))

2264 ià(
eb™m­_£t_b™


2265 (&
rd©um
->
ty³s
.ty³s, 
i
, 
TRUE
))

2266 
oom
;

2268 
	`eb™m­_de¡roy
(&
ty³s
);

2273 
oom
:

2274 
	`yy”rÜ
("Out of memory");

2276 
	}
}

2278 
rŞe_d©um_t
 *
	$defše_rŞe_dom
(
rŞe_d©um_t
 * 
r
)

2280 
rŞe_d©um_t
 *
rŞe
;

2281 *
rŞe_id
;

2282 
eb™m­_node_t
 *
node
;

2283 
i
;

2284 
»t
;

2286 ià(
·ss
 == 1) {

2287 
rŞe_id
 = 
	`queue_»move
(
id_queue
);

2288 
	`ä“
(
rŞe_id
);

2289  (
rŞe_d©um_t
 *) 1;

2292 
	`yyw¬n
("Role dominance has been deprecated");

2294 
rŞe_id
 = 
	`queue_»move
(
id_queue
);

2295 ià(!
	`is_id_š_scİe
(
SYM_ROLES
, 
rŞe_id
)) {

2296 
	`yy”rÜ2
("rŞ% i nÙ w™hš scİe", 
rŞe_id
);

2297 
	`ä“
(
rŞe_id
);

2298  
NULL
;

2300 
rŞe
 = (
rŞe_d©um_t
 *è
	`hashb_£¬ch
(
pŞicydbp
->
p_rŞes
.
bË
,

2301 
rŞe_id
);

2302 ià(!
rŞe
) {

2303 
rŞe
 = (
rŞe_d©um_t
 *è
	`m®loc
((role_datum_t));

2304 ià(!
rŞe
) {

2305 
	`yy”rÜ
("out of memory");

2306 
	`ä“
(
rŞe_id
);

2307  
NULL
;

2309 
	`mem£t
(
rŞe
, 0, (
rŞe_d©um_t
));

2310 
»t
 =

2311 
	`deş¬e_symbŞ
(
SYM_ROLES
, (
hashb_key_t
è
rŞe_id
,

2312 (
hashb_d©um_t
è
rŞe
, &rŞe->
s
.
v®ue
,

2313 &
rŞe
->
s
.
v®ue
);

2314 
»t
) {

2316 
	`yy”rÜ
("Out of memory!");

2317 
ş—nup
;

2320 
	`yy”rÜ2
("duplicate declaration of„ole %s",

2321 
rŞe_id
);

2322 
ş—nup
;

2325 
	`yy”rÜ
("could‚ot declare„ole here");

2326 
ş—nup
;

2333 
	`as£¹
(0);

2336 ià(
	`eb™m­_£t_b™
(&
rŞe
->
domš©es
,„Şe->
s
.
v®ue
 - 1, 
TRUE
)) {

2337 
	`yy”rÜ
("Out of memory!");

2338 
ş—nup
;

2341 ià(
r
) {

2342 
eb™m­_t
 
ty³s
;

2343 
	`eb™m­_š™
(&
ty³s
);

2344 
	`eb™m­_fÜ_—ch_b™
(&
r
->
domš©es
, 
node
, 
i
) {

2345 ià(
	`eb™m­_node_g‘_b™
(
node
, 
i
))

2346 ià(
	`eb™m­_£t_b™
(&
rŞe
->
domš©es
, 
i
, 
TRUE
))

2347 
oom
;

2349 ià(
	`ty³_£t_ex·nd
(&
r
->
ty³s
, &ty³s, 
pŞicydbp
, 1)) {

2350 
	`eb™m­_de¡roy
(&
ty³s
);

2351  
NULL
;

2353 
	`eb™m­_fÜ_—ch_b™
(&
ty³s
, 
node
, 
i
) {

2354 ià(
	`eb™m­_node_g‘_b™
(
node
, 
i
))

2355 ià(
eb™m­_£t_b™


2356 (&
rŞe
->
ty³s
.ty³s, 
i
, 
TRUE
))

2357 
oom
;

2359 
	`eb™m­_de¡roy
(&
ty³s
);

2360 ià(!
r
->
s
.
v®ue
) {

2362 
	`ty³_£t_de¡roy
(&
r
->
ty³s
);

2363 
	`eb™m­_de¡roy
(&
r
->
domš©es
);

2364 
	`ä“
(
r
);

2370 
	`hashb_m­
(
pŞicydbp
->
p_rŞes
.
bË
,

2371 
domš©e_rŞe_»check
, 
rŞe
);

2373  
rŞe
;

2374 
ş—nup
:

2375 
	`ä“
(
rŞe_id
);

2376 
	`rŞe_d©um_de¡roy
(
rŞe
);

2377 
	`ä“
(
rŞe
);

2378  
NULL
;

2379 
oom
:

2380 
	`yy”rÜ
("Out of memory");

2381 
ş—nup
;

2382 
	}
}

2384 
	$rŞe_v®_to_Çme_h–³r
(
hashb_key_t
 
key
, 
hashb_d©um_t
 
d©um
,

2385 *
p
)

2387 
v®_to_Çme
 *
v
 = 
p
;

2388 
rŞe_d©um_t
 *
rŞd©um
;

2390 
rŞd©um
 = (
rŞe_d©um_t
 *è
d©um
;

2392 ià(
v
->
v®
 =ğ
rŞd©um
->
s
.
v®ue
) {

2393 
v
->
Çme
 = 
key
;

2398 
	}
}

2400 *
	$rŞe_v®_to_Çme
(
v®
)

2402 
v®_to_Çme
 
v
;

2403 
rc
;

2405 
v
.
v®
 = val;

2406 
rc
 = 
	`hashb_m­
(
pŞicydbp
->
p_rŞes
.
bË
, 
rŞe_v®_to_Çme_h–³r
, &
v
);

2407 ià(
rc
)

2408  
v
.
Çme
;

2409  
NULL
;

2410 
	}
}

2412 
	$£t_rŞes
(
rŞe_£t_t
 * 
£t
, *
id
)

2414 
rŞe_d©um_t
 *
r
;

2416 ià(
	`¡rcmp
(
id
, "*") == 0) {

2417 
	`ä“
(
id
);

2418 
	`yy”rÜ
("* is‚ot‡llowed for„ole sets");

2422 ià(
	`¡rcmp
(
id
, "~") == 0) {

2423 
	`ä“
(
id
);

2424 
	`yy”rÜ
("~ is‚ot‡llowed for„ole sets");

2427 ià(!
	`is_id_š_scİe
(
SYM_ROLES
, 
id
)) {

2428 
	`yy”rÜ2
("rŞ% i nÙ w™hš scİe", 
id
);

2429 
	`ä“
(
id
);

2432 
r
 = 
	`hashb_£¬ch
(
pŞicydbp
->
p_rŞes
.
bË
, 
id
);

2433 ià(!
r
) {

2434 
	`yy”rÜ2
("unknowÀrŞ%s", 
id
);

2435 
	`ä“
(
id
);

2439 ià(
	`eb™m­_£t_b™
(&
£t
->
rŞes
, 
r
->
s
.
v®ue
 - 1, 
TRUE
)) {

2440 
	`yy”rÜ
("out of memory");

2441 
	`ä“
(
id
);

2444 
	`ä“
(
id
);

2446 
	}
}

2448 
	$defše_rŞe_Œªs
(
şass_¥ecif›d
)

2450 *
id
;

2451 
rŞe_d©um_t
 *
rŞe
;

2452 
rŞe_£t_t
 
rŞes
;

2453 
ty³_£t_t
 
ty³s
;

2454 
şass_d©um_t
 *
şad©um
;

2455 
eb™m­_t
 
e_ty³s
, 
e_rŞes
, 
e_şas£s
;

2456 
eb™m­_node_t
 *
Šode
, *
ºode
, *
úode
;

2457 
rŞe_Œªs
 *
Œ
 = 
NULL
;

2458 
rŞe_Œªs_ruË
 *
ruË
 = 
NULL
;

2459 
i
, 
j
, 
k
;

2460 
add
 = 1;

2462 ià(
·ss
 == 1) {

2463 (
id
 = 
	`queue_»move
(
id_queue
)))

2464 
	`ä“
(
id
);

2465 (
id
 = 
	`queue_»move
(
id_queue
)))

2466 
	`ä“
(
id
);

2467 ià(
şass_¥ecif›d
)

2468 (
id
 = 
	`queue_»move
(
id_queue
)))

2469 
	`ä“
(
id
);

2470 
id
 = 
	`queue_»move
(
id_queue
);

2471 
	`ä“
(
id
);

2475 
	`rŞe_£t_š™
(&
rŞes
);

2476 
	`eb™m­_š™
(&
e_rŞes
);

2477 
	`ty³_£t_š™
(&
ty³s
);

2478 
	`eb™m­_š™
(&
e_ty³s
);

2479 
	`eb™m­_š™
(&
e_şas£s
);

2481 (
id
 = 
	`queue_»move
(
id_queue
))) {

2482 ià(
	`£t_rŞes
(&
rŞes
, 
id
))

2485 
add
 = 1;

2486 (
id
 = 
	`queue_»move
(
id_queue
))) {

2487 ià(
	`£t_ty³s
(&
ty³s
, 
id
, &
add
, 0))

2491 ià(
şass_¥ecif›d
) {

2492 ià(
	`»ad_şas£s
(&
e_şas£s
))

2495 
şad©um
 = 
	`hashb_£¬ch
(
pŞicydbp
->
p_şas£s
.
bË
,

2497 ià(!
şad©um
) {

2498 
	`yy”rÜ2
("could‚ot find…rocess class for "

2503 ià(
	`eb™m­_£t_b™
(&
e_şas£s
, 
şad©um
->
s
.
v®ue
 - 1, 
TRUE
)) {

2504 
	`yy”rÜ
("out of memory");

2509 
id
 = (*)
	`queue_»move
(
id_queue
);

2510 ià(!
id
) {

2511 
	`yy”rÜ
("no‚ew„ole inransition definition?");

2512 
bad
;

2514 ià(!
	`is_id_š_scİe
(
SYM_ROLES
, 
id
)) {

2515 
	`yy”rÜ2
("rŞ% i nÙ w™hš scİe", 
id
);

2516 
	`ä“
(
id
);

2517 
bad
;

2519 
rŞe
 = 
	`hashb_£¬ch
(
pŞicydbp
->
p_rŞes
.
bË
, 
id
);

2520 ià(!
rŞe
) {

2521 
	`yy”rÜ2
("unknowÀrŞ% u£d iÀŒªs™iÚ defš™iÚ", 
id
);

2522 
bad
;

2525 ià(
rŞe
->
æavÜ
 !ğ
ROLE_ROLE
) {

2526 
	`yy”rÜ2
("thÃw„Ş% mu¡ b¨»guÏ¸rŞe", 
id
);

2527 
bad
;

2532 #ifdeà
HAVE_SEPOL_ROLE_ATTRS


2533 ià(
	`rŞe_£t_ex·nd
(&
rŞes
, &
e_rŞes
, 
pŞicydbp
, 
NULL
, NULL))

2534 #–ià
HAVE_SEPOL_USER_ROLE_MAPPING


2535 ià(
	`rŞe_£t_ex·nd
(&
rŞes
, &
e_rŞes
, 
pŞicydbp
, 
NULL
))

2537 ià(
	`rŞe_£t_ex·nd
(&
rŞes
, &
e_rŞes
, 
pŞicydbp
))

2539 
bad
;

2541 ià(
	`ty³_£t_ex·nd
(&
ty³s
, &
e_ty³s
, 
pŞicydbp
, 1))

2542 
bad
;

2544 
	`eb™m­_fÜ_—ch_b™
(&
e_rŞes
, 
ºode
, 
i
) {

2545 ià(!
	`eb™m­_node_g‘_b™
(
ºode
, 
i
))

2547 
	`eb™m­_fÜ_—ch_b™
(&
e_ty³s
, 
Šode
, 
j
) {

2548 ià(!
	`eb™m­_node_g‘_b™
(
Šode
, 
j
))

2550 
	`eb™m­_fÜ_—ch_b™
(&
e_şas£s
, 
úode
, 
k
) {

2551 ià(!
	`eb™m­_node_g‘_b™
(
úode
, 
k
))

2553 
Œ
 = 
pŞicydbp
->
rŞe_Œ
;r;

2554 
Œ
 =r->
Ãxt
) {

2555 ià(
Œ
->
rŞe
 =ğ(
i
 + 1) &&

2556 
Œ
->
ty³
 =ğ(
j
 + 1) &&

2557 
Œ
->
tşass
 =ğ(
k
 + 1)) {

2558 
	`yy”rÜ2
("duplicate„ole "

2561 
	`rŞe_v®_to_Çme
(
i
+1),

2562 
pŞicydbp
->
p_ty³_v®_to_Çme
[
j
],

2563 
pŞicydbp
->
p_şass_v®_to_Çme
[
k
]);

2564 
bad
;

2568 
Œ
 = 
	`m®loc
((
rŞe_Œªs
));

2569 ià(!
Œ
) {

2570 
	`yy”rÜ
("out of memory");

2573 
	`mem£t
(
Œ
, 0, (
rŞe_Œªs
));

2574 
Œ
->
rŞe
 = 
i
 + 1;

2575 
Œ
->
ty³
 = 
j
 + 1;

2576 
Œ
->
tşass
 = 
k
 + 1;

2577 
Œ
->
Ãw_rŞe
 = 
rŞe
->
s
.
v®ue
;

2578 
Œ
->
Ãxt
 = 
pŞicydbp
->
rŞe_Œ
;

2579 
pŞicydbp
->
rŞe_Œ
 = 
Œ
;

2584 
ruË
 = 
	`m®loc
((
rŞe_Œªs_ruË
));

2585 ià(!
ruË
) {

2586 
	`yy”rÜ
("out of memory");

2589 
	`mem£t
(
ruË
, 0, (
rŞe_Œªs_ruË
));

2590 
ruË
->
rŞes
 =„oles;

2591 
ruË
->
ty³s
 =ypes;

2592 
ruË
->
şas£s
 = 
e_şas£s
;

2593 
ruË
->
Ãw_rŞe
 = 
rŞe
->
s
.
v®ue
;

2595 
	`­³nd_rŞe_Œªs
(
ruË
);

2597 
	`eb™m­_de¡roy
(&
e_rŞes
);

2598 
	`eb™m­_de¡roy
(&
e_ty³s
);

2602 
bad
:

2604 
	}
}

2606 
	$defše_rŞe_®low
()

2608 *
id
;

2609 
rŞe_®low_ruË
 *
¿
 = 0;

2611 ià(
·ss
 == 1) {

2612 (
id
 = 
	`queue_»move
(
id_queue
)))

2613 
	`ä“
(
id
);

2614 (
id
 = 
	`queue_»move
(
id_queue
)))

2615 
	`ä“
(
id
);

2619 
¿
 = 
	`m®loc
((
rŞe_®low_ruË_t
));

2620 ià(!
¿
) {

2621 
	`yy”rÜ
("out of memory");

2624 
	`rŞe_®low_ruË_š™
(
¿
);

2626 (
id
 = 
	`queue_»move
(
id_queue
))) {

2627 ià(
	`£t_rŞes
(&
¿
->
rŞes
, 
id
)) {

2628 
	`ä“
(
¿
);

2633 (
id
 = 
	`queue_»move
(
id_queue
))) {

2634 ià(
	`£t_rŞes
(&
¿
->
Ãw_rŞes
, 
id
)) {

2635 
	`ä“
(
¿
);

2640 
	`­³nd_rŞe_®low
(
¿
);

2642 
	}
}

2644 
avruË_t
 *
	$defše_cÚd_f’ame_Œªs
()

2646 
	`yy”rÜ
("typeransitions with‡ filename‚ot‡llowed inside "

2648  
COND_ERR
;

2649 
	}
}

2651 
	$defše_f’ame_Œªs
()

2653 *
id
;

2655 ià(
·ss
 == 1) {

2657 (
id
 = 
	`queue_»move
(
id_queue
)))

2658 
	`ä“
(
id
);

2660 (
id
 = 
	`queue_»move
(
id_queue
)))

2661 
	`ä“
(
id
);

2663 (
id
 = 
	`queue_»move
(
id_queue
)))

2664 
	`ä“
(
id
);

2666 
id
 = 
	`queue_»move
(
id_queue
);

2667 
	`ä“
(
id
);

2669 
id
 = 
	`queue_»move
(
id_queue
);

2670 
	`ä“
(
id
);

2674 #ifdeà
HAVE_SEPOL_FILENAME_TRANS


2675 *
Çme
 = 
NULL
;

2676 
ty³_£t_t
 
¡y³s
, 
‰y³s
;

2677 
eb™m­_t
 
e_¡y³s
, 
e_‰y³s
;

2678 
eb™m­_t
 
e_tşas£s
;

2679 
eb™m­_node_t
 *
¢ode
, *
Šode
, *
úode
;

2680 
f’ame_Œªs_t
 *
á
;

2681 
f’ame_Œªs_ruË_t
 *
ár
;

2682 
ty³_d©um_t
 *
typd©um
;

2683 
ušt32_t
 
Ùy³
;

2684 
c
, 
s
, 
t
;

2685 
add
;

2687 
add
 = 1;

2688 
	`ty³_£t_š™
(&
¡y³s
);

2689 (
id
 = 
	`queue_»move
(
id_queue
))) {

2690 ià(
	`£t_ty³s
(&
¡y³s
, 
id
, &
add
, 0))

2691 
bad
;

2694 
add
 =1;

2695 
	`ty³_£t_š™
(&
‰y³s
);

2696 (
id
 = 
	`queue_»move
(
id_queue
))) {

2697 ià(
	`£t_ty³s
(&
‰y³s
, 
id
, &
add
, 0))

2698 
bad
;

2701 
	`eb™m­_š™
(&
e_tşas£s
);

2702 ià(
	`»ad_şas£s
(&
e_tşas£s
))

2703 
bad
;

2705 
id
 = (*)
	`queue_»move
(
id_queue
);

2706 ià(!
id
) {

2707 
	`yy”rÜ
("no otype inransition definition?");

2708 
bad
;

2710 ià(!
	`is_id_š_scİe
(
SYM_TYPES
, 
id
)) {

2711 
	`yy”rÜ2
("ty³ % i nÙ w™hš scİe", 
id
);

2712 
	`ä“
(
id
);

2713 
bad
;

2715 
typd©um
 = 
	`hashb_£¬ch
(
pŞicydbp
->
p_ty³s
.
bË
, 
id
);

2716 ià(!
typd©um
) {

2717 
	`yy”rÜ2
("unknowÀty³ % u£d iÀŒªs™iÚ defš™iÚ", 
id
);

2718 
bad
;

2720 
	`ä“
(
id
);

2721 
Ùy³
 = 
typd©um
->
s
.
v®ue
;

2723 
Çme
 = 
	`queue_»move
(
id_queue
);

2724 ià(!
Çme
) {

2725 
	`yy”rÜ
("no…athname specified in filename_trans definition?");

2726 
bad
;

2732 
	`eb™m­_š™
(&
e_¡y³s
);

2733 ià(
	`ty³_£t_ex·nd
(&
¡y³s
, &
e_¡y³s
, 
pŞicydbp
, 1))

2734 
bad
;

2736 
	`eb™m­_š™
(&
e_‰y³s
);

2737 ià(
	`ty³_£t_ex·nd
(&
‰y³s
, &
e_‰y³s
, 
pŞicydbp
, 1))

2738 
bad
;

2740 
	`eb™m­_fÜ_—ch_b™
(&
e_tşas£s
, 
úode
, 
c
) {

2741 ià(!
	`eb™m­_node_g‘_b™
(
úode
, 
c
))

2743 
	`eb™m­_fÜ_—ch_b™
(&
e_¡y³s
, 
¢ode
, 
s
) {

2744 ià(!
	`eb™m­_node_g‘_b™
(
¢ode
, 
s
))

2746 
	`eb™m­_fÜ_—ch_b™
(&
e_‰y³s
, 
Šode
, 
t
) {

2747 ià(!
	`eb™m­_node_g‘_b™
(
Šode
, 
t
))

2750 
á
 = 
pŞicydbp
->
f’ame_Œªs
; ft; fˆğá->
Ãxt
) {

2751 ià(
á
->
¡y³
 =ğ(
s
 + 1) &&

2752 
á
->
‰y³
 =ğ(
t
 + 1) &&

2753 
á
->
tşass
 =ğ(
c
 + 1) &&

2754 !
	`¡rcmp
(
á
->
Çme
,‚ame)) {

2755 
	`yy”rÜ2
("duplicate filenameransition for: filename_trans %s %s %s:%s",

2756 
Çme
,

2757 
pŞicydbp
->
p_ty³_v®_to_Çme
[
s
],

2758 
pŞicydbp
->
p_ty³_v®_to_Çme
[
t
],

2759 
pŞicydbp
->
p_şass_v®_to_Çme
[
c
]);

2760 
bad
;

2763 
á
 = 
	`m®loc
((*ft));

2764 ià(!
á
) {

2765 
	`yy”rÜ
("out of memory");

2766 
bad
;

2768 
	`mem£t
(
á
, 0, (*ft));

2770 
á
->
Ãxt
 = 
pŞicydbp
->
f’ame_Œªs
;

2771 
pŞicydbp
->
f’ame_Œªs
 = 
á
;

2773 
á
->
Çme
 = 
	`¡rdup
(name);

2774 ià(!
á
->
Çme
) {

2775 
	`yy”rÜ
("out of memory");

2776 
bad
;

2778 
á
->
¡y³
 = 
s
 + 1;

2779 
á
->
‰y³
 = 
t
 + 1;

2780 
á
->
tşass
 = 
c
 + 1;

2781 
á
->
Ùy³
 = otype;

2785 
ár
 = 
	`m®loc
((*ftr));

2786 ià(!
ár
) {

2787 
	`yy”rÜ
("out of memory");

2788 
bad
;

2790 
	`f’ame_Œªs_ruË_š™
(
ár
);

2791 
	`­³nd_f’ame_Œªs
(
ár
);

2793 
ár
->
Çme
 = 
	`¡rdup
(name);

2794 
ár
->
¡y³s
 = stypes;

2795 
ár
->
‰y³s
 =types;

2796 
ár
->
tşass
 = 
c
 + 1;

2797 
ár
->
Ùy³
 = otype;

2800 
	`ä“
(
Çme
);

2801 
	`eb™m­_de¡roy
(&
e_¡y³s
);

2802 
	`eb™m­_de¡roy
(&
e_‰y³s
);

2803 
	`eb™m­_de¡roy
(&
e_tşas£s
);

2807 
bad
:

2808 
	`ä“
(
Çme
);

2811 
	`yy”rÜ
("This version of SETools does‚ot have filenameype_transition„ulesƒnabled.");

2813 
	}
}

2815 
cÚ¡¿št_ex´_t
 *
	$cÚ¡¿št_ex´_şÚe
(
cÚ¡¿št_ex´_t
 * 
ex´
)

2817 
cÚ¡¿št_ex´_t
 *
h
 = 
NULL
, *
l
 = NULL, *
e
, *
Ãwe
;

2818 
e
 = 
ex´
;ƒ;ƒ =ƒ->
Ãxt
) {

2819 
Ãwe
 = 
	`m®loc
((*newe));

2820 ià(!
Ãwe
)

2821 
oom
;

2822 ià(
	`cÚ¡¿št_ex´_š™
(
Ãwe
) == -1) {

2823 
	`ä“
(
Ãwe
);

2824 
oom
;

2826 ià(
l
)

2827 
l
->
Ãxt
 = 
Ãwe
;

2829 
h
 = 
Ãwe
;

2830 
l
 = 
Ãwe
;

2831 
Ãwe
->
ex´_ty³
 = 
e
->expr_type;

2832 
Ãwe
->
©Œ
 = 
e
->attr;

2833 
Ãwe
->
İ
 = 
e
->op;

2834 ià(
Ãwe
->
ex´_ty³
 =ğ
CEXPR_NAMES
) {

2835 ià(
Ãwe
->
©Œ
 & 
CEXPR_TYPE
) {

2836 ià(
ty³_£t_ıy


2837 (
Ãwe
->
ty³_Çmes
, 
e
->type_names))

2838 
oom
;

2840 ià(
	`eb™m­_ıy
(&
Ãwe
->
Çmes
, &
e
->names))

2841 
oom
;

2846  
h
;

2847 
oom
:

2848 
e
 = 
h
;

2849 
e
) {

2850 
l
 = 
e
;

2851 
e
 =ƒ->
Ãxt
;

2852 
	`cÚ¡¿št_ex´_de¡roy
(
l
);

2854  
NULL
;

2855 
	}
}

2857 
	$defše_cÚ¡¿št
(
cÚ¡¿št_ex´_t
 * 
ex´
)

2859 
cÚ¡¿št_node
 *
node
;

2860 *
id
;

2861 
şass_d©um_t
 *
şad©um
;

2862 
³rm_d©um_t
 *
³rd©um
;

2863 
eb™m­_t
 
şassm­
;

2864 
eb™m­_node_t
 *
’ode
;

2865 
cÚ¡¿št_ex´_t
 *
e
;

2866 
i
;

2867 
d•th
;

2868 
u£ex´
 = 1;

2870 ià(
·ss
 == 1) {

2871 (
id
 = 
	`queue_»move
(
id_queue
)))

2872 
	`ä“
(
id
);

2873 (
id
 = 
	`queue_»move
(
id_queue
)))

2874 
	`ä“
(
id
);

2878 
d•th
 = -1;

2879 
e
 = 
ex´
;ƒ;ƒ =ƒ->
Ãxt
) {

2880 
e
->
ex´_ty³
) {

2881 
CEXPR_NOT
:

2882 ià(
d•th
 < 0) {

2883 
	`yy”rÜ
("illegal constraintƒxpression");

2887 
CEXPR_AND
:

2888 
CEXPR_OR
:

2889 ià(
d•th
 < 1) {

2890 
	`yy”rÜ
("illegal constraintƒxpression");

2893 
d•th
--;

2895 
CEXPR_ATTR
:

2896 
CEXPR_NAMES
:

2897 ià(
e
->
©Œ
 & 
CEXPR_XTARGET
) {

2898 
	`yy”rÜ
("illegal constraintƒxpression");

2901 ià(
d•th
 =ğ(
CEXPR_MAXDEPTH
 - 1)) {

2902 
	`yy”rÜ
("constraintƒxpression isoo deep");

2905 
d•th
++;

2908 
	`yy”rÜ
("illegal constraintƒxpression");

2912 ià(
d•th
 != 0) {

2913 
	`yy”rÜ
("illegal constraintƒxpression");

2917 
	`eb™m­_š™
(&
şassm­
);

2918 (
id
 = 
	`queue_»move
(
id_queue
))) {

2919 ià(!
	`is_id_š_scİe
(
SYM_CLASSES
, 
id
)) {

2920 
	`yy”rÜ2
("şas % i nÙ w™hš scİe", 
id
);

2921 
	`ä“
(
id
);

2924 
şad©um
 =

2925 (
şass_d©um_t
 *è
	`hashb_£¬ch
(
pŞicydbp
->
p_şas£s
.
bË
,

2926 (
hashb_key_t
è
id
);

2927 ià(!
şad©um
) {

2928 
	`yy”rÜ2
("şas % i nÙ defšed", 
id
);

2929 
	`eb™m­_de¡roy
(&
şassm­
);

2930 
	`ä“
(
id
);

2933 ià(
	`eb™m­_£t_b™
(&
şassm­
, 
şad©um
->
s
.
v®ue
 - 1, 
TRUE
)) {

2934 
	`yy”rÜ
("out of memory");

2935 
	`eb™m­_de¡roy
(&
şassm­
);

2936 
	`ä“
(
id
);

2939 
node
 = 
	`m®loc
((
cÚ¡¿št_node
));

2940 ià(!
node
) {

2941 
	`yy”rÜ
("out of memory");

2942 
	`ä“
(
node
);

2945 
	`mem£t
(
node
, 0, (
cÚ¡¿št_node_t
));

2946 ià(
u£ex´
) {

2947 
node
->
ex´
 =ƒxpr;

2948 
u£ex´
 = 0;

2950 
node
->
ex´
 = 
	`cÚ¡¿št_ex´_şÚe
(expr);

2952 ià(!
node
->
ex´
) {

2953 
	`yy”rÜ
("out of memory");

2954 
	`ä“
(
node
);

2957 
node
->
³rmissiÚs
 = 0;

2959 
node
->
Ãxt
 = 
şad©um
->
cÚ¡¿šts
;

2960 
şad©um
->
cÚ¡¿šts
 = 
node
;

2962 
	`ä“
(
id
);

2965 (
id
 = 
	`queue_»move
(
id_queue
))) {

2966 
	`eb™m­_fÜ_—ch_b™
(&
şassm­
, 
’ode
, 
i
) {

2967 ià(
	`eb™m­_node_g‘_b™
(
’ode
, 
i
)) {

2968 
şad©um
 = 
pŞicydbp
->
şass_v®_to_¡ruù
[
i
];

2969 
node
 = 
şad©um
->
cÚ¡¿šts
;

2971 
³rd©um
 =

2972 (
³rm_d©um_t
 *è
	`hashb_£¬ch
(
şad©um
->

2973 
³rmissiÚs
.

2974 
bË
,

2975 (
hashb_key_t
)

2976 
id
);

2977 ià(!
³rd©um
) {

2978 ià(
şad©um
->
comd©um
) {

2979 
³rd©um
 =

2980 (
³rm_d©um_t
 *)

2981 
	`hashb_£¬ch
(
şad©um
->

2982 
comd©um
->

2983 
³rmissiÚs
.

2984 
bË
,

2985 (
hashb_key_t
)

2986 
id
);

2988 ià(!
³rd©um
) {

2989 
	`yy”rÜ2
("permission %s is‚ot"

2990 " defšed", 
id
);

2991 
	`ä“
(
id
);

2992 
	`eb™m­_de¡roy
(&
şassm­
);

2996 
node
->
³rmissiÚs
 |=

2997 (1 << (
³rd©um
->
s
.
v®ue
 - 1));

3000 
	`ä“
(
id
);

3003 
	`eb™m­_de¡roy
(&
şassm­
);

3006 
	}
}

3008 
	$defše_v®id©‘¿ns
(
cÚ¡¿št_ex´_t
 * 
ex´
)

3010 
cÚ¡¿št_node
 *
node
;

3011 *
id
;

3012 
şass_d©um_t
 *
şad©um
;

3013 
eb™m­_t
 
şassm­
;

3014 
cÚ¡¿št_ex´_t
 *
e
;

3015 
d•th
;

3016 
u£ex´
 = 1;

3018 ià(
·ss
 == 1) {

3019 (
id
 = 
	`queue_»move
(
id_queue
)))

3020 
	`ä“
(
id
);

3024 
d•th
 = -1;

3025 
e
 = 
ex´
;ƒ;ƒ =ƒ->
Ãxt
) {

3026 
e
->
ex´_ty³
) {

3027 
CEXPR_NOT
:

3028 ià(
d•th
 < 0) {

3029 
	`yy”rÜ
("illegal validatetransƒxpression");

3033 
CEXPR_AND
:

3034 
CEXPR_OR
:

3035 ià(
d•th
 < 1) {

3036 
	`yy”rÜ
("illegal validatetransƒxpression");

3039 
d•th
--;

3041 
CEXPR_ATTR
:

3042 
CEXPR_NAMES
:

3043 ià(
d•th
 =ğ(
CEXPR_MAXDEPTH
 - 1)) {

3044 
	`yy”rÜ
("validatetransƒxpression isoo deep");

3047 
d•th
++;

3050 
	`yy”rÜ
("illegal validatetransƒxpression");

3054 ià(
d•th
 != 0) {

3055 
	`yy”rÜ
("illegal validatetransƒxpression");

3059 
	`eb™m­_š™
(&
şassm­
);

3060 (
id
 = 
	`queue_»move
(
id_queue
))) {

3061 ià(!
	`is_id_š_scİe
(
SYM_CLASSES
, 
id
)) {

3062 
	`yy”rÜ2
("şas % i nÙ w™hš scİe", 
id
);

3063 
	`ä“
(
id
);

3066 
şad©um
 =

3067 (
şass_d©um_t
 *è
	`hashb_£¬ch
(
pŞicydbp
->
p_şas£s
.
bË
,

3068 (
hashb_key_t
è
id
);

3069 ià(!
şad©um
) {

3070 
	`yy”rÜ2
("şas % i nÙ defšed", 
id
);

3071 
	`eb™m­_de¡roy
(&
şassm­
);

3072 
	`ä“
(
id
);

3075 ià(
	`eb™m­_£t_b™
(&
şassm­
, (
şad©um
->
s
.
v®ue
 - 1), 
TRUE
)) {

3076 
	`yy”rÜ
("out of memory");

3077 
	`eb™m­_de¡roy
(&
şassm­
);

3078 
	`ä“
(
id
);

3082 
node
 = 
	`m®loc
((
cÚ¡¿št_node
));

3083 ià(!
node
) {

3084 
	`yy”rÜ
("out of memory");

3087 
	`mem£t
(
node
, 0, (
cÚ¡¿št_node_t
));

3088 ià(
u£ex´
) {

3089 
node
->
ex´
 =ƒxpr;

3090 
u£ex´
 = 0;

3092 
node
->
ex´
 = 
	`cÚ¡¿št_ex´_şÚe
(expr);

3094 
node
->
³rmissiÚs
 = 0;

3096 
node
->
Ãxt
 = 
şad©um
->
v®id©‘¿ns
;

3097 
şad©um
->
v®id©‘¿ns
 = 
node
;

3099 
	`ä“
(
id
);

3102 
	`eb™m­_de¡roy
(&
şassm­
);

3105 
	}
}

3107 
ušŒ_t
 
	$defše_ûx´
(
ušt32_t
 
ex´_ty³
, 
ušŒ_t
 
¬g1
, ušŒ_ˆ
¬g2
)

3109 
cÚ¡¿št_ex´
 *
ex´
, *
e1
 = 
NULL
, *
e2
;

3110 
u£r_d©um_t
 *
u£r
;

3111 
rŞe_d©um_t
 *
rŞe
;

3112 
eb™m­_t
 
Ãg£t
;

3113 *
id
;

3114 
ušt32_t
 
v®
;

3115 
add
 = 1;

3117 ià(
·ss
 == 1) {

3118 ià(
ex´_ty³
 =ğ
CEXPR_NAMES
) {

3119 (
id
 = 
	`queue_»move
(
id_queue
)))

3120 
	`ä“
(
id
);

3125 ià((
ex´
 = 
	`m®loc
((*ex´))è=ğ
NULL
 ||

3126 
	`cÚ¡¿št_ex´_š™
(
ex´
) == -1) {

3127 
	`yy”rÜ
("out of memory");

3128 
	`ä“
(
ex´
);

3131 
ex´
->
ex´_ty³
 =ƒxpr_type;

3133 
ex´_ty³
) {

3134 
CEXPR_NOT
:

3135 
e1
 = 
NULL
;

3136 
e2
 = (
cÚ¡¿št_ex´
 *)
¬g1
;

3137 
e2
) {

3138 
e1
 = 
e2
;

3139 
e2
 =ƒ2->
Ãxt
;

3141 ià(!
e1
 ||ƒ1->
Ãxt
) {

3142 
	`yy”rÜ
("illegal constraintƒxpression");

3143 
	`cÚ¡¿št_ex´_de¡roy
(
ex´
);

3146 
e1
->
Ãxt
 = 
ex´
;

3147  
¬g1
;

3148 
CEXPR_AND
:

3149 
CEXPR_OR
:

3150 
e1
 = 
NULL
;

3151 
e2
 = (
cÚ¡¿št_ex´
 *)
¬g1
;

3152 
e2
) {

3153 
e1
 = 
e2
;

3154 
e2
 =ƒ2->
Ãxt
;

3156 ià(!
e1
 ||ƒ1->
Ãxt
) {

3157 
	`yy”rÜ
("illegal constraintƒxpression");

3158 
	`cÚ¡¿št_ex´_de¡roy
(
ex´
);

3161 
e1
->
Ãxt
 = (
cÚ¡¿št_ex´
 *)
¬g2
;

3163 
e1
 = 
NULL
;

3164 
e2
 = (
cÚ¡¿št_ex´
 *)
¬g2
;

3165 
e2
) {

3166 
e1
 = 
e2
;

3167 
e2
 =ƒ2->
Ãxt
;

3169 ià(!
e1
 ||ƒ1->
Ãxt
) {

3170 
	`yy”rÜ
("illegal constraintƒxpression");

3171 
	`cÚ¡¿št_ex´_de¡roy
(
ex´
);

3174 
e1
->
Ãxt
 = 
ex´
;

3175  
¬g1
;

3176 
CEXPR_ATTR
:

3177 
ex´
->
©Œ
 = 
¬g1
;

3178 
ex´
->
İ
 = 
¬g2
;

3179  (
ušŒ_t
è
ex´
;

3180 
CEXPR_NAMES
:

3181 
add
 = 1;

3182 
ex´
->
©Œ
 = 
¬g1
;

3183 
ex´
->
İ
 = 
¬g2
;

3184 
	`eb™m­_š™
(&
Ãg£t
);

3185 (
id
 = (*)
	`queue_»move
(
id_queue
))) {

3186 ià(
ex´
->
©Œ
 & 
CEXPR_USER
) {

3187 ià(!
	`is_id_š_scİe
(
SYM_USERS
, 
id
)) {

3188 
	`yy”rÜ2
("user %s is‚ot within scope",

3189 
id
);

3190 
	`cÚ¡¿št_ex´_de¡roy
(
ex´
);

3193 
u£r
 =

3194 (
u£r_d©um_t
 *è
	`hashb_£¬ch
(
pŞicydbp
->

3195 
p_u£rs
.

3196 
bË
,

3197 (
hashb_key_t
)

3198 
id
);

3199 ià(!
u£r
) {

3200 
	`yy”rÜ2
("unknowÀu£¸%s", 
id
);

3201 
	`cÚ¡¿št_ex´_de¡roy
(
ex´
);

3204 
v®
 = 
u£r
->
s
.
v®ue
;

3205 } ià(
ex´
->
©Œ
 & 
CEXPR_ROLE
) {

3206 ià(!
	`is_id_š_scİe
(
SYM_ROLES
, 
id
)) {

3207 
	`yy”rÜ2
("role %s is‚ot within scope",

3208 
id
);

3209 
	`cÚ¡¿št_ex´_de¡roy
(
ex´
);

3212 
rŞe
 =

3213 (
rŞe_d©um_t
 *è
	`hashb_£¬ch
(
pŞicydbp
->

3214 
p_rŞes
.

3215 
bË
,

3216 (
hashb_key_t
)

3217 
id
);

3218 ià(!
rŞe
) {

3219 
	`yy”rÜ2
("unknowÀrŞ%s", 
id
);

3220 
	`cÚ¡¿št_ex´_de¡roy
(
ex´
);

3223 
v®
 = 
rŞe
->
s
.
v®ue
;

3224 } ià(
ex´
->
©Œ
 & 
CEXPR_TYPE
) {

3225 ià(
	`£t_ty³s
(
ex´
->
ty³_Çmes
, 
id
, &
add
, 0)) {

3226 
	`cÚ¡¿št_ex´_de¡roy
(
ex´
);

3231 
	`yy”rÜ
("invalid constraintƒxpression");

3232 
	`cÚ¡¿št_ex´_de¡roy
(
ex´
);

3235 ià(
	`eb™m­_£t_b™
(&
ex´
->
Çmes
, 
v®
 - 1, 
TRUE
)) {

3236 
	`yy”rÜ
("out of memory");

3237 
	`eb™m­_de¡roy
(&
ex´
->
Çmes
);

3238 
	`cÚ¡¿št_ex´_de¡roy
(
ex´
);

3241 
	`ä“
(
id
);

3243 
	`eb™m­_de¡roy
(&
Ãg£t
);

3244  (
ušŒ_t
è
ex´
;

3249 
	`yy”rÜ
("invalid constraintƒxpression");

3250 
	`cÚ¡¿št_ex´_de¡roy
(
ex´
);

3252 
	}
}

3254 
	$defše_cÚd™iÚ®
(
cÚd_ex´_t
 * 
ex´
, 
avruË_t
 * 
t
,‡vruË_ˆ* 
f
)

3256 
cÚd_ex´_t
 *
e
;

3257 
d•th
;

3258 
cÚd_node_t
 
ú
, *
ú_Şd
;

3261 ià(!
ex´
) {

3262 
	`yy”rÜ
("illegal conditionalƒxpression");

3265 ià(!
t
) {

3266 ià(!
f
) {

3268 
	`cÚd_ex´_de¡roy
(
ex´
);

3272 
t
 = 
f
;

3273 
f
 = 0;

3274 
ex´
 = 
	`defše_cÚd_ex´
(
COND_NOT
,ƒxpr, 0);

3275 ià(!
ex´
) {

3276 
	`yy”rÜ
("unableo invert");

3282 
d•th
 = -1;

3283 
e
 = 
ex´
;ƒ;ƒ =ƒ->
Ãxt
) {

3284 
e
->
ex´_ty³
) {

3285 
COND_NOT
:

3286 ià(
d•th
 < 0) {

3287 
yy”rÜ


3292 
COND_AND
:

3293 
COND_OR
:

3294 
COND_XOR
:

3295 
COND_EQ
:

3296 
COND_NEQ
:

3297 ià(
d•th
 < 1) {

3298 
yy”rÜ


3302 
d•th
--;

3304 
COND_BOOL
:

3305 ià(
d•th
 =ğ(
COND_EXPR_MAXDEPTH
 - 1)) {

3306 
yy”rÜ


3310 
d•th
++;

3313 
	`yy”rÜ
("illegal conditionalƒxpression");

3317 ià(
d•th
 != 0) {

3318 
	`yy”rÜ
("illegal conditionalƒxpression");

3323 
	`mem£t
(&
ú
, 0, (cn));

3324 
ú
.
ex´
 =ƒxpr;

3325 
ú
.
avŒue_li¡
 = 
t
;

3326 
ú
.
avçl£_li¡
 = 
f
;

3329 ià(
	`cÚd_nÜm®ize_ex´
(
pŞicydbp
, &
ú
) < 0) {

3330 
	`yy”rÜ
("problem‚ormalizing conditionalƒxpression");

3335 
ú_Şd
 = 
	`g‘_cu¼’t_cÚd_li¡
(&
ú
);

3336 ià(!
ú_Şd
) {

3341 
avruË_t
 *
tmp
, *
Ï¡_tmp
;

3342 
»tv®
;

3344 
tmp
 = 
ú
.
avŒue_li¡
;

3345 
Ï¡_tmp
 = 
NULL
;

3346 
tmp
) {

3347 ià(!(
tmp
->
¥ecif›d
 & 
AVRULE_TRANSITION
))

3349 
»tv®
 = 
	`š£¹_check_ty³_ruË
(
tmp
, &
pŞicydbp
->
‹_cÚd_avb
, &
ú_Şd
->
Œue_li¡
, &ú_Şd->
çl£_li¡
);

3350 
»tv®
) {

3352 
Ï¡_tmp
 = 
tmp
;

3353 
tmp
 =mp->
Ãxt
;

3358 ià(
Ï¡_tmp
 =ğ
NULL
) {

3359 
ú
.
avŒue_li¡
 = cn.avŒue_li¡->
Ãxt
;

3360 
	`avruË_de¡roy
(
tmp
);

3361 
	`ä“
(
tmp
);

3362 
tmp
 = 
ú
.
avŒue_li¡
;

3364 
Ï¡_tmp
->
Ãxt
 = 
tmp
->next;

3365 
	`avruË_de¡roy
(
tmp
);

3366 
	`ä“
(
tmp
);

3367 
tmp
 = 
Ï¡_tmp
->
Ãxt
;

3378 
	`as£¹
(0);

3383 
tmp
 = 
ú
.
avçl£_li¡
;

3384 
Ï¡_tmp
 = 
NULL
;

3385 
tmp
) {

3386 ià(!(
tmp
->
¥ecif›d
 & 
AVRULE_TRANSITION
))

3388 
»tv®
 = 
	`š£¹_check_ty³_ruË
(
tmp
, &
pŞicydbp
->
‹_cÚd_avb
, &
ú_Şd
->
çl£_li¡
, &ú_Şd->
Œue_li¡
);

3389 
»tv®
) {

3391 
Ï¡_tmp
 = 
tmp
;

3392 
tmp
 =mp->
Ãxt
;

3397 ià(
Ï¡_tmp
 =ğ
NULL
) {

3398 
ú
.
avçl£_li¡
 = cn.avçl£_li¡->
Ãxt
;

3399 
	`avruË_de¡roy
(
tmp
);

3400 
	`ä“
(
tmp
);

3401 
tmp
 = 
ú
.
avçl£_li¡
;

3403 
Ï¡_tmp
->
Ãxt
 = 
tmp
->next;

3404 
	`avruË_de¡roy
(
tmp
);

3405 
	`ä“
(
tmp
);

3406 
tmp
 = 
Ï¡_tmp
->
Ãxt
;

3417 
	`as£¹
(0);

3422 
	`­³nd_cÚd_li¡
(&
ú
);

3428 
ú
.
avŒue_li¡
 = 
NULL
;

3429 
ú
.
avçl£_li¡
 = 
NULL
;

3430 
	`cÚd_node_de¡roy
(&
ú
);

3433 
	}
}

3435 
cÚd_ex´_t
 *
	$defše_cÚd_ex´
(
ušt32_t
 
ex´_ty³
, *
¬g1
, *
¬g2
)

3437 
cÚd_ex´
 *
ex´
, *
e1
 = 
NULL
, *
e2
;

3438 
cÚd_boŞ_d©um_t
 *
boŞ_v¬
;

3439 *
id
;

3442 ià(
·ss
 == 1) {

3443 ià(
ex´_ty³
 =ğ
COND_BOOL
) {

3444 (
id
 = 
	`queue_»move
(
id_queue
))) {

3445 
	`ä“
(
id
);

3448  (
cÚd_ex´_t
 *) 1;

3452 
ex´
 = 
	`m®loc
((
cÚd_ex´
));

3453 ià(!
ex´
) {

3454 
	`yy”rÜ
("out of memory");

3455  
NULL
;

3457 
	`mem£t
(
ex´
, 0, (
cÚd_ex´_t
));

3458 
ex´
->
ex´_ty³
 =ƒxpr_type;

3461 
ex´_ty³
) {

3462 
COND_NOT
:

3463 
e1
 = 
NULL
;

3464 
e2
 = (
cÚd_ex´
 *)
¬g1
;

3465 
e2
) {

3466 
e1
 = 
e2
;

3467 
e2
 =ƒ2->
Ãxt
;

3469 ià(!
e1
 ||ƒ1->
Ãxt
) {

3470 
	`yy”rÜ
("illegal conditional NOTƒxpression");

3471 
	`ä“
(
ex´
);

3472  
NULL
;

3474 
e1
->
Ãxt
 = 
ex´
;

3475  (
cÚd_ex´
 *)
¬g1
;

3476 
COND_AND
:

3477 
COND_OR
:

3478 
COND_XOR
:

3479 
COND_EQ
:

3480 
COND_NEQ
:

3481 
e1
 = 
NULL
;

3482 
e2
 = (
cÚd_ex´
 *)
¬g1
;

3483 
e2
) {

3484 
e1
 = 
e2
;

3485 
e2
 =ƒ2->
Ãxt
;

3487 ià(!
e1
 ||ƒ1->
Ãxt
) {

3488 
yy”rÜ


3490 
	`ä“
(
ex´
);

3491  
NULL
;

3493 
e1
->
Ãxt
 = (
cÚd_ex´
 *)
¬g2
;

3495 
e1
 = 
NULL
;

3496 
e2
 = (
cÚd_ex´
 *)
¬g2
;

3497 
e2
) {

3498 
e1
 = 
e2
;

3499 
e2
 =ƒ2->
Ãxt
;

3501 ià(!
e1
 ||ƒ1->
Ãxt
) {

3502 
yy”rÜ


3504 
	`ä“
(
ex´
);

3505  
NULL
;

3507 
e1
->
Ãxt
 = 
ex´
;

3508  (
cÚd_ex´
 *)
¬g1
;

3509 
COND_BOOL
:

3510 
id
 = (*)
	`queue_»move
(
id_queue
);

3511 ià(!
id
) {

3512 
	`yy”rÜ
("bad conditional;ƒxpected boolean id");

3513 
	`ä“
(
id
);

3514 
	`ä“
(
ex´
);

3515  
NULL
;

3517 ià(!
	`is_id_š_scİe
(
SYM_BOOLS
, 
id
)) {

3518 
	`yy”rÜ2
("boŞ—À% i nÙ w™hš scİe", 
id
);

3519 
	`ä“
(
id
);

3520 
	`ä“
(
ex´
);

3521  
NULL
;

3523 
boŞ_v¬
 =

3524 (
cÚd_boŞ_d©um_t
 *è
	`hashb_£¬ch
(
pŞicydbp
->
p_boŞs
.

3525 
bË
,

3526 (
hashb_key_t
è
id
);

3527 ià(!
boŞ_v¬
) {

3528 
	`yy”rÜ2
("unknown boolean %s in conditionalƒxpression",

3529 
id
);

3530 
	`ä“
(
ex´
);

3531 
	`ä“
(
id
);

3532  
NULL
;

3534 
ex´
->
boŞ
 = 
boŞ_v¬
->
s
.
v®ue
;

3535 
	`ä“
(
id
);

3536  
ex´
;

3538 
	`yy”rÜ
("illegal conditionalƒxpression");

3539 
	`ä“
(
ex´
);

3540  
NULL
;

3542 
	}
}

3544 
	$£t_u£r_rŞes
(
rŞe_£t_t
 * 
£t
, *
id
)

3546 
rŞe_d©um_t
 *
r
;

3547 
i
;

3548 
eb™m­_node_t
 *
node
;

3550 ià(
	`¡rcmp
(
id
, "*") == 0) {

3551 
	`ä“
(
id
);

3552 
	`yy”rÜ
("* is‚ot‡llowed in user declarations");

3556 ià(
	`¡rcmp
(
id
, "~") == 0) {

3557 
	`ä“
(
id
);

3558 
	`yy”rÜ
("~ is‚ot‡llowed in user declarations");

3562 ià(!
	`is_id_š_scİe
(
SYM_ROLES
, 
id
)) {

3563 
	`yy”rÜ2
("rŞ% i nÙ w™hš scİe", 
id
);

3564 
	`ä“
(
id
);

3567 
r
 = 
	`hashb_£¬ch
(
pŞicydbp
->
p_rŞes
.
bË
, 
id
);

3568 ià(!
r
) {

3569 
	`yy”rÜ2
("unknowÀrŞ%s", 
id
);

3570 
	`ä“
(
id
);

3575 
	`eb™m­_fÜ_—ch_b™
(&
r
->
domš©es
, 
node
, 
i
) {

3576 ià(
	`eb™m­_node_g‘_b™
(
node
, 
i
))

3577 ià(
	`eb™m­_£t_b™
(&
£t
->
rŞes
, 
i
, 
TRUE
))

3578 
oom
;

3580 
	`ä“
(
id
);

3582 
oom
:

3583 
	`yy”rÜ
("out of memory");

3585 
	}
}

3587 
	$·r£_ÿ‹gÜ›s
(*
id
, 
Ëv–_d©um_t
 * 
Ëvd©um
, 
eb™m­_t
 * 
ÿts
)

3589 
ÿt_d©um_t
 *
cd©um
;

3590 
¿nge_¡¬t
, 
¿nge_’d
, 
i
;

3592 ià(
	`id_has_dÙ
(
id
)) {

3593 *
id_¡¬t
 = 
id
;

3594 *
id_’d
 = 
	`¡rchr
(
id
, '.');

3596 *(
id_’d
++) = '\0';

3598 
cd©um
 = (
ÿt_d©um_t
 *è
	`hashb_£¬ch
(
pŞicydbp
->
p_ÿts
.
bË
,

3599 (
hashb_key_t
)

3600 
id_¡¬t
);

3601 ià(!
cd©um
) {

3602 
	`yy”rÜ2
("unknowÀÿ‹gÜy %s", 
id_¡¬t
);

3605 
¿nge_¡¬t
 = 
cd©um
->
s
.
v®ue
 - 1;

3606 
cd©um
 = (
ÿt_d©um_t
 *è
	`hashb_£¬ch
(
pŞicydbp
->
p_ÿts
.
bË
,

3607 (
hashb_key_t
è
id_’d
);

3608 ià(!
cd©um
) {

3609 
	`yy”rÜ2
("unknowÀÿ‹gÜy %s", 
id_’d
);

3612 
¿nge_’d
 = 
cd©um
->
s
.
v®ue
 - 1;

3614 ià(
¿nge_’d
 < 
¿nge_¡¬t
) {

3615 
	`yy”rÜ2
("category„ange is invalid");

3619 
cd©um
 = (
ÿt_d©um_t
 *è
	`hashb_£¬ch
(
pŞicydbp
->
p_ÿts
.
bË
,

3620 (
hashb_key_t
è
id
);

3621 ià(!
cd©um
) {

3622 
	`yy”rÜ2
("unknowÀÿ‹gÜy %s", 
id
);

3625 
¿nge_¡¬t
 = 
¿nge_’d
 = 
cd©um
->
s
.
v®ue
 - 1;

3628 
i
 = 
¿nge_¡¬t
; i <ğ
¿nge_’d
; i++) {

3629 ià(!
	`eb™m­_g‘_b™
(&
Ëvd©um
->
Ëv–
->
ÿt
, 
i
)) {

3630 
ušt32_t
 
Ëv–_v®ue
 = 
Ëvd©um
->
Ëv–
->
£ns
 - 1;

3631 
	`pŞicydb_šdex_Ùh”s
(
NULL
, 
pŞicydbp
, 0);

3632 
	`yy”rÜ2
("category %s can‚ot be‡ssociated "

3634 
pŞicydbp
->
p_ÿt_v®_to_Çme
[
i
],

3635 
pŞicydbp
->
p_£ns_v®_to_Çme
[
Ëv–_v®ue
]);

3638 ià(
	`eb™m­_£t_b™
(
ÿts
, 
i
, 
TRUE
)) {

3639 
	`yy”rÜ
("out of memory");

3645 
	}
}

3647 
	$·r£_£mªtic_ÿ‹gÜ›s
(*
id
, 
Ëv–_d©um_t
 * 
Ëvd©um
,

3648 
mls_£mªtic_ÿt_t
 ** 
ÿts
)

3650 
ÿt_d©um_t
 *
cd©um
;

3651 
mls_£mªtic_ÿt_t
 *
Ãwÿt
;

3652 
¿nge_¡¬t
, 
¿nge_’d
;

3654 ià(
	`id_has_dÙ
(
id
)) {

3655 *
id_¡¬t
 = 
id
;

3656 *
id_’d
 = 
	`¡rchr
(
id
, '.');

3658 *(
id_’d
++) = '\0';

3660 
cd©um
 = (
ÿt_d©um_t
 *è
	`hashb_£¬ch
(
pŞicydbp
->
p_ÿts
.
bË
,

3661 (
hashb_key_t
)

3662 
id_¡¬t
);

3663 ià(!
cd©um
) {

3664 
	`yy”rÜ2
("unknowÀÿ‹gÜy %s", 
id_¡¬t
);

3667 
¿nge_¡¬t
 = 
cd©um
->
s
.
v®ue
;

3669 
cd©um
 = (
ÿt_d©um_t
 *è
	`hashb_£¬ch
(
pŞicydbp
->
p_ÿts
.
bË
,

3670 (
hashb_key_t
è
id_’d
);

3671 ià(!
cd©um
) {

3672 
	`yy”rÜ2
("unknowÀÿ‹gÜy %s", 
id_’d
);

3675 
¿nge_’d
 = 
cd©um
->
s
.
v®ue
;

3677 
cd©um
 = (
ÿt_d©um_t
 *è
	`hashb_£¬ch
(
pŞicydbp
->
p_ÿts
.
bË
,

3678 (
hashb_key_t
è
id
);

3679 ià(!
cd©um
) {

3680 
	`yy”rÜ2
("unknowÀÿ‹gÜy %s", 
id
);

3683 
¿nge_¡¬t
 = 
¿nge_’d
 = 
cd©um
->
s
.
v®ue
;

3686 
Ãwÿt
 = (
mls_£mªtic_ÿt_t
 *è
	`m®loc
((mls_semantic_cat_t));

3687 ià(!
Ãwÿt
) {

3688 
	`yy”rÜ
("out of memory");

3692 
	`mls_£mªtic_ÿt_š™
(
Ãwÿt
);

3693 
Ãwÿt
->
Ãxt
 = *
ÿts
;

3694 
Ãwÿt
->
low
 = 
¿nge_¡¬t
;

3695 
Ãwÿt
->
high
 = 
¿nge_’d
;

3697 *
ÿts
 = 
Ãwÿt
;

3700 
	}
}

3702 
	$defše_u£r
()

3704 *
id
;

3705 
u£r_d©um_t
 *
u¤d©um
;

3706 
Ëv–_d©um_t
 *
Ëvd©um
;

3707 
l
;

3709 ià(
·ss
 == 1) {

3710 (
id
 = 
	`queue_»move
(
id_queue
)))

3711 
	`ä“
(
id
);

3712 ià(
ml¥Ş
) {

3713 (
id
 = 
	`queue_»move
(
id_queue
)))

3714 
	`ä“
(
id
);

3715 
id
 = 
	`queue_»move
(
id_queue
);

3716 
	`ä“
(
id
);

3717 
l
 = 0;† < 2;†++) {

3718 (
id
 = 
	`queue_»move
(
id_queue
))) {

3719 
	`ä“
(
id
);

3721 
id
 = 
	`queue_»move
(
id_queue
);

3722 ià(!
id
)

3724 
	`ä“
(
id
);

3730 ià((
u¤d©um
 = 
	`deş¬e_u£r
()è=ğ
NULL
) {

3734 (
id
 = 
	`queue_»move
(
id_queue
))) {

3735 ià(
	`£t_u£r_rŞes
(&
u¤d©um
->
rŞes
, 
id
))

3739 ià(
ml¥Ş
) {

3740 
id
 = 
	`queue_»move
(
id_queue
);

3741 ià(!
id
) {

3742 
	`yy”rÜ
("no default†evel specified for user");

3746 
Ëvd©um
 = (
Ëv–_d©um_t
 *)

3747 
	`hashb_£¬ch
(
pŞicydbp
->
p_Ëv–s
.
bË
,

3748 (
hashb_key_t
è
id
);

3749 ià(!
Ëvd©um
) {

3750 
	`yy”rÜ2
("unknown sensitivity %s used in user"

3751 "†ev– defš™iÚ", 
id
);

3752 
	`ä“
(
id
);

3755 
	`ä“
(
id
);

3757 
u¤d©um
->
dæev–
.
£ns
 = 
Ëvd©um
->
Ëv–
->sens;

3759 (
id
 = 
	`queue_»move
(
id_queue
))) {

3760 ià(
	`·r£_£mªtic_ÿ‹gÜ›s
(
id
, 
Ëvd©um
,

3761 &
u¤d©um
->
dæev–
.
ÿt
)) {

3762 
	`ä“
(
id
);

3765 
	`ä“
(
id
);

3768 
id
 = 
	`queue_»move
(
id_queue
);

3770 
l
 = 0;† < 2;†++) {

3771 
Ëvd©um
 = (
Ëv–_d©um_t
 *)

3772 
	`hashb_£¬ch
(
pŞicydbp
->
p_Ëv–s
.
bË
,

3773 (
hashb_key_t
è
id
);

3774 ià(!
Ëvd©um
) {

3775 
	`yy”rÜ2
("unknown sensitivity %s used in user"

3776 "„ªgdefš™iÚ", 
id
);

3777 
	`ä“
(
id
);

3780 
	`ä“
(
id
);

3782 
u¤d©um
->
¿nge
.
Ëv–
[
l
].
£ns
 = 
Ëvd©um
->level->sens;

3784 (
id
 = 
	`queue_»move
(
id_queue
))) {

3785 ià(
	`·r£_£mªtic_ÿ‹gÜ›s
(
id
, 
Ëvd©um
,

3786 &
u¤d©um
->
¿nge
.
Ëv–
[
l
].
ÿt
)) {

3787 
	`ä“
(
id
);

3790 
	`ä“
(
id
);

3793 
id
 = 
	`queue_»move
(
id_queue
);

3794 ià(!
id
)

3798 ià(
l
 == 0) {

3799 ià(
	`mls_£mªtic_Ëv–_ıy
(&
u¤d©um
->
¿nge
.
Ëv–
[1],

3800 &
u¤d©um
->
¿nge
.
Ëv–
[0])) {

3801 
	`yy”rÜ
("out of memory");

3807 
	}
}

3809 
	$·r£_£cur™y_cÚ‹xt
(
cÚ‹xt_¡ruù_t
 * 
c
)

3811 *
id
;

3812 
rŞe_d©um_t
 *
rŞe
;

3813 
ty³_d©um_t
 *
typd©um
;

3814 
u£r_d©um_t
 *
u¤d©um
;

3815 
Ëv–_d©um_t
 *
Ëvd©um
;

3816 
l
;

3818 ià(
·ss
 == 1) {

3819 
id
 = 
	`queue_»move
(
id_queue
);

3820 
	`ä“
(
id
);

3821 
id
 = 
	`queue_»move
(
id_queue
);

3822 
	`ä“
(
id
);

3823 
id
 = 
	`queue_»move
(
id_queue
);

3824 
	`ä“
(
id
);

3825 ià(
ml¥Ş
) {

3826 
id
 = 
	`queue_»move
(
id_queue
);

3827 
	`ä“
(
id
);

3828 
l
 = 0;† < 2;†++) {

3829 (
id
 = 
	`queue_»move
(
id_queue
))) {

3830 
	`ä“
(
id
);

3832 
id
 = 
	`queue_»move
(
id_queue
);

3833 ià(!
id
)

3835 
	`ä“
(
id
);

3842 ià(
c
 =ğ
NULL
) {

3843 
	`yy”rÜ
("null context…ointer!");

3847 
	`cÚ‹xt_š™
(
c
);

3850 
id
 = 
	`queue_»move
(
id_queue
);

3851 ià(!
id
) {

3852 
	`yy”rÜ
("noƒffective user?");

3853 
bad
;

3855 ià(!
	`is_id_š_scİe
(
SYM_USERS
, 
id
)) {

3856 
	`yy”rÜ2
("u£¸% i nÙ w™hš scİe", 
id
);

3857 
	`ä“
(
id
);

3858 
bad
;

3860 
u¤d©um
 = (
u£r_d©um_t
 *è
	`hashb_£¬ch
(
pŞicydbp
->
p_u£rs
.
bË
,

3861 (
hashb_key_t
è
id
);

3862 ià(!
u¤d©um
) {

3863 
	`yy”rÜ2
("u£¸% i nÙ defšed", 
id
);

3864 
	`ä“
(
id
);

3865 
bad
;

3867 
c
->
u£r
 = 
u¤d©um
->
s
.
v®ue
;

3870 
	`ä“
(
id
);

3873 
id
 = (*)
	`queue_»move
(
id_queue
);

3874 ià(!
id
) {

3875 
	`yy”rÜ
("no„ole‚ame for sid context definition?");

3878 ià(!
	`is_id_š_scİe
(
SYM_ROLES
, 
id
)) {

3879 
	`yy”rÜ2
("rŞ% i nÙ w™hš scİe", 
id
);

3880 
	`ä“
(
id
);

3883 
rŞe
 = (
rŞe_d©um_t
 *è
	`hashb_£¬ch
(
pŞicydbp
->
p_rŞes
.
bË
,

3884 (
hashb_key_t
è
id
);

3885 ià(!
rŞe
) {

3886 
	`yy”rÜ2
("rŞ% i nÙ defšed", 
id
);

3887 
	`ä“
(
id
);

3890 
c
->
rŞe
 =„Şe->
s
.
v®ue
;

3893 
	`ä“
(
id
);

3896 
id
 = (*)
	`queue_»move
(
id_queue
);

3897 ià(!
id
) {

3898 
	`yy”rÜ
("noype‚ame for sid context definition?");

3901 ià(!
	`is_id_š_scİe
(
SYM_TYPES
, 
id
)) {

3902 
	`yy”rÜ2
("ty³ % i nÙ w™hš scİe", 
id
);

3903 
	`ä“
(
id
);

3906 
typd©um
 = (
ty³_d©um_t
 *è
	`hashb_£¬ch
(
pŞicydbp
->
p_ty³s
.
bË
,

3907 (
hashb_key_t
è
id
);

3908 ià(!
typd©um
 ||ypd©um->
æavÜ
 =ğ
TYPE_ATTRIB
) {

3909 
	`yy”rÜ2
("ty³ % i nÙ defšed o¸i ª‡‰ribu‹", 
id
);

3910 
	`ä“
(
id
);

3913 
c
->
ty³
 = 
typd©um
->
s
.
v®ue
;

3916 
	`ä“
(
id
);

3918 ià(
ml¥Ş
) {

3920 
id
 = (*)
	`queue_h—d
(
id_queue
);

3921 ià(!
id
) {

3922 
	`yy”rÜ
("no sensitivity‚ame for sid context"

3927 
id
 = (*)
	`queue_»move
(
id_queue
);

3928 
l
 = 0;† < 2;†++) {

3929 
Ëvd©um
 = (
Ëv–_d©um_t
 *)

3930 
	`hashb_£¬ch
(
pŞicydbp
->
p_Ëv–s
.
bË
,

3931 (
hashb_key_t
è
id
);

3932 ià(!
Ëvd©um
) {

3933 
	`yy”rÜ2
("S’s™iv™y % i nÙ defšed", 
id
);

3934 
	`ä“
(
id
);

3937 
	`ä“
(
id
);

3938 
c
->
¿nge
.
Ëv–
[
l
].
£ns
 = 
Ëvd©um
->level->sens;

3941 (
id
 = 
	`queue_»move
(
id_queue
))) {

3942 ià(
	`·r£_ÿ‹gÜ›s
(
id
, 
Ëvd©um
,

3943 &
c
->
¿nge
.
Ëv–
[
l
].
ÿt
)) {

3944 
	`ä“
(
id
);

3947 
	`ä“
(
id
);

3951 
id
 = (*)
	`queue_»move
(
id_queue
);

3952 ià(!
id
)

3956 ià(
l
 == 0) {

3957 
c
->
¿nge
.
Ëv–
[1].
£ns
 = c->range.level[0].sens;

3958 ià(
	`eb™m­_ıy
(&
c
->
¿nge
.
Ëv–
[1].
ÿt
,

3959 &
c
->
¿nge
.
Ëv–
[0].
ÿt
)) {

3961 
	`yy”rÜ
("out of memory");

3962 
bad
;

3967 ià(!
	`pŞicydb_cÚ‹xt_isv®id
(
pŞicydbp
, 
c
)) {

3968 
	`yy”rÜ
("invalid security context");

3969 
bad
;

3973 
bad
:

3974 
	`cÚ‹xt_de¡roy
(
c
);

3977 
	}
}

3979 
	$defše_š™Ÿl_sid_cÚ‹xt
()

3981 *
id
;

3982 
ocÚ‹xt_t
 *
c
, *
h—d
;

3984 ià(
·ss
 == 1) {

3985 
id
 = (*)
	`queue_»move
(
id_queue
);

3986 
	`ä“
(
id
);

3987 
	`·r£_£cur™y_cÚ‹xt
(
NULL
);

3991 
id
 = (*)
	`queue_»move
(
id_queue
);

3992 ià(!
id
) {

3993 
	`yy”rÜ
("no sid‚ame for SID context definition?");

3996 
h—d
 = 
pŞicydbp
->
ocÚ‹xts
[
OCON_ISID
];

3997 
c
 = 
h—d
; c; c = c->
Ãxt
) {

3998 ià(!
	`¡rcmp
(
id
, 
c
->
u
.
Çme
))

4002 ià(!
c
) {

4003 
	`yy”rÜ2
("SID % i nÙ defšed", 
id
);

4004 
	`ä“
(
id
);

4007 ià(
c
->
cÚ‹xt
[0].
u£r
) {

4008 
	`yy”rÜ2
("ThcÚ‹xˆfÜ SID % i muÉly defšed", 
id
);

4009 
	`ä“
(
id
);

4013 
	`ä“
(
id
);

4015 ià(
	`·r£_£cur™y_cÚ‹xt
(&
c
->
cÚ‹xt
[0]))

4019 
	}
}

4021 
	$defše_fs_cÚ‹xt
(
majÜ
, 
mšÜ
)

4023 
ocÚ‹xt_t
 *
Ãwc
, *
c
, *
h—d
;

4025 ià(
pŞicydbp
->
rg‘_¶©fÜm
 !ğ
SEPOL_TARGET_SELINUX
) {

4026 
	`yy”rÜ
("fscon‚ot supported forarget");

4030 ià(
·ss
 == 1) {

4031 
	`·r£_£cur™y_cÚ‹xt
(
NULL
);

4032 
	`·r£_£cur™y_cÚ‹xt
(
NULL
);

4036 
Ãwc
 = (
ocÚ‹xt_t
 *è
	`m®loc
((ocontext_t));

4037 ià(!
Ãwc
) {

4038 
	`yy”rÜ
("out of memory");

4041 
	`mem£t
(
Ãwc
, 0, (
ocÚ‹xt_t
));

4043 
Ãwc
->
u
.
Çme
 = (*)
	`m®loc
(6);

4044 ià(!
Ãwc
->
u
.
Çme
) {

4045 
	`yy”rÜ
("out of memory");

4046 
	`ä“
(
Ãwc
);

4049 
	`¥rštf
(
Ãwc
->
u
.
Çme
, "%02x:%02x", 
majÜ
, 
mšÜ
);

4051 ià(
	`·r£_£cur™y_cÚ‹xt
(&
Ãwc
->
cÚ‹xt
[0])) {

4052 
	`ä“
(
Ãwc
->
u
.
Çme
);

4053 
	`ä“
(
Ãwc
);

4056 ià(
	`·r£_£cur™y_cÚ‹xt
(&
Ãwc
->
cÚ‹xt
[1])) {

4057 
	`cÚ‹xt_de¡roy
(&
Ãwc
->
cÚ‹xt
[0]);

4058 
	`ä“
(
Ãwc
->
u
.
Çme
);

4059 
	`ä“
(
Ãwc
);

4062 
h—d
 = 
pŞicydbp
->
ocÚ‹xts
[
OCON_FS
];

4064 
c
 = 
h—d
; c; c = c->
Ãxt
) {

4065 ià(!
	`¡rcmp
(
Ãwc
->
u
.
Çme
, 
c
->u.name)) {

4066 
	`yy”rÜ2
("duplicateƒntry for file system %s",

4067 
Ãwc
->
u
.
Çme
);

4068 
	`cÚ‹xt_de¡roy
(&
Ãwc
->
cÚ‹xt
[0]);

4069 
	`cÚ‹xt_de¡roy
(&
Ãwc
->
cÚ‹xt
[1]);

4070 
	`ä“
(
Ãwc
->
u
.
Çme
);

4071 
	`ä“
(
Ãwc
);

4076 
Ãwc
->
Ãxt
 = 
h—d
;

4077 
pŞicydbp
->
ocÚ‹xts
[
OCON_FS
] = 
Ãwc
;

4080 
	}
}

4082 
	$defše_pœq_cÚ‹xt
(
pœq
)

4084 
ocÚ‹xt_t
 *
Ãwc
, *
c
, *
l
, *
h—d
;

4085 *
id
;

4087 ià(
pŞicydbp
->
rg‘_¶©fÜm
 !ğ
SEPOL_TARGET_XEN
) {

4088 
	`yy”rÜ
("pirqcon‚ot supported forarget");

4092 ià(
·ss
 == 1) {

4093 
id
 = (*è
	`queue_»move
(
id_queue
);

4094 
	`ä“
(
id
);

4095 
	`·r£_£cur™y_cÚ‹xt
(
NULL
);

4099 
Ãwc
 = 
	`m®loc
((
ocÚ‹xt_t
));

4100 ià(!
Ãwc
) {

4101 
	`yy”rÜ
("out of memory");

4104 
	`mem£t
(
Ãwc
, 0, (
ocÚ‹xt_t
));

4106 
Ãwc
->
u
.
pœq
 =…irq;

4108 ià(
	`·r£_£cur™y_cÚ‹xt
(&
Ãwc
->
cÚ‹xt
[0])) {

4109 
	`ä“
(
Ãwc
);

4113 
h—d
 = 
pŞicydbp
->
ocÚ‹xts
[
OCON_XEN_PIRQ
];

4114 
l
 = 
NULL
, 
c
 = 
h—d
; c;† = c, c = c->
Ãxt
) {

4115 
pœq2
;

4117 
pœq2
 = 
c
->
u
.
pœq
;

4118 ià(
pœq
 =ğ
pœq2
) {

4119 
	`yy”rÜ2
("du¶iÿ‹…œqcÚƒÁry fÜ %d ", 
pœq
);

4120 
bad
;

4124 ià(
l
)

4125 
l
->
Ãxt
 = 
Ãwc
;

4127 
pŞicydbp
->
ocÚ‹xts
[
OCON_XEN_PIRQ
] = 
Ãwc
;

4131 
bad
:

4132 
	`ä“
(
Ãwc
);

4134 
	}
}

4136 
	$defše_iomem_cÚ‹xt
(
low
, 
high
)

4138 
ocÚ‹xt_t
 *
Ãwc
, *
c
, *
l
, *
h—d
;

4139 *
id
;

4141 ià(
pŞicydbp
->
rg‘_¶©fÜm
 !ğ
SEPOL_TARGET_XEN
) {

4142 
	`yy”rÜ
("iomemcon‚ot supported forarget");

4146 ià(
·ss
 == 1) {

4147 
id
 = (*)
	`queue_»move
(
id_queue
);

4148 
	`ä“
(
id
);

4149 
	`·r£_£cur™y_cÚ‹xt
(
NULL
);

4153 
Ãwc
 = 
	`m®loc
((
ocÚ‹xt_t
));

4154 ià(!
Ãwc
) {

4155 
	`yy”rÜ
("out of memory");

4158 
	`mem£t
(
Ãwc
, 0, (
ocÚ‹xt_t
));

4160 
Ãwc
->
u
.
iomem
.
low_iomem
 = 
low
;

4161 
Ãwc
->
u
.
iomem
.
high_iomem
 = 
high
;

4163 ià(
low
 > 
high
) {

4164 
	`yy”rÜ2
("low memÜy 0x%xƒxûed high memÜy 0x%x", 
low
, 
high
);

4165 
	`ä“
(
Ãwc
);

4169 ià(
	`·r£_£cur™y_cÚ‹xt
(&
Ãwc
->
cÚ‹xt
[0])) {

4170 
	`ä“
(
Ãwc
);

4174 
h—d
 = 
pŞicydbp
->
ocÚ‹xts
[
OCON_XEN_IOMEM
];

4175 
l
 = 
NULL
, 
c
 = 
h—d
; c;† = c, c = c->
Ãxt
) {

4176 
low2
, 
high2
;

4178 
low2
 = 
c
->
u
.
iomem
.
low_iomem
;

4179 
high2
 = 
c
->
u
.
iomem
.
high_iomem
;

4180 ià(
low
 <ğ
high2
 && 
low2
 <ğ
high
) {

4181 
	`yy”rÜ2
("iomemconƒntry for 0x%x-0x%x overlaps with "

4182 "—¾›¸’Œy 0x%x-0x%x", 
low
, 
high
,

4183 
low2
, 
high2
);

4184 
bad
;

4188 ià(
l
)

4189 
l
->
Ãxt
 = 
Ãwc
;

4191 
pŞicydbp
->
ocÚ‹xts
[
OCON_XEN_IOMEM
] = 
Ãwc
;

4195 
bad
:

4196 
	`ä“
(
Ãwc
);

4198 
	}
}

4200 
	$defše_iİÜt_cÚ‹xt
(
low
, 
high
)

4202 
ocÚ‹xt_t
 *
Ãwc
, *
c
, *
l
, *
h—d
;

4203 *
id
;

4205 ià(
pŞicydbp
->
rg‘_¶©fÜm
 !ğ
SEPOL_TARGET_XEN
) {

4206 
	`yy”rÜ
("ioportcon‚ot supported forarget");

4210 ià(
·ss
 == 1) {

4211 
id
 = (*)
	`queue_»move
(
id_queue
);

4212 
	`ä“
(
id
);

4213 
	`·r£_£cur™y_cÚ‹xt
(
NULL
);

4217 
Ãwc
 = 
	`m®loc
((
ocÚ‹xt_t
));

4218 ià(!
Ãwc
) {

4219 
	`yy”rÜ
("out of memory");

4222 
	`mem£t
(
Ãwc
, 0, (
ocÚ‹xt_t
));

4224 
Ãwc
->
u
.
iİÜt
.
low_iİÜt
 = 
low
;

4225 
Ãwc
->
u
.
iİÜt
.
high_iİÜt
 = 
high
;

4227 ià(
low
 > 
high
) {

4228 
	`yy”rÜ2
("low iİÜˆ0x%xƒxûed high iİÜˆ0x%x", 
low
, 
high
);

4229 
	`ä“
(
Ãwc
);

4233 ià(
	`·r£_£cur™y_cÚ‹xt
(&
Ãwc
->
cÚ‹xt
[0])) {

4234 
	`ä“
(
Ãwc
);

4238 
h—d
 = 
pŞicydbp
->
ocÚ‹xts
[
OCON_XEN_IOPORT
];

4239 
l
 = 
NULL
, 
c
 = 
h—d
; c;† = c, c = c->
Ãxt
) {

4240 
low2
, 
high2
;

4242 
low2
 = 
c
->
u
.
iİÜt
.
low_iİÜt
;

4243 
high2
 = 
c
->
u
.
iİÜt
.
high_iİÜt
;

4244 ià(
low
 <ğ
high2
 && 
low2
 <ğ
high
) {

4245 
	`yy”rÜ2
("ioportconƒntry for 0x%x-0x%x overlaps with"

4246 "—¾›¸’Œy 0x%x-0x%x", 
low
, 
high
,

4247 
low2
, 
high2
);

4248 
bad
;

4252 ià(
l
)

4253 
l
->
Ãxt
 = 
Ãwc
;

4255 
pŞicydbp
->
ocÚ‹xts
[
OCON_XEN_IOPORT
] = 
Ãwc
;

4259 
bad
:

4260 
	`ä“
(
Ãwc
);

4262 
	}
}

4264 
	$defše_pcideviû_cÚ‹xt
(
deviû
)

4266 
ocÚ‹xt_t
 *
Ãwc
, *
c
, *
l
, *
h—d
;

4267 *
id
;

4269 ià(
pŞicydbp
->
rg‘_¶©fÜm
 !ğ
SEPOL_TARGET_XEN
) {

4270 
	`yy”rÜ
("pcidevicecon‚ot supported forarget");

4274 ià(
·ss
 == 1) {

4275 
id
 = (*è
	`queue_»move
(
id_queue
);

4276 
	`ä“
(
id
);

4277 
	`·r£_£cur™y_cÚ‹xt
(
NULL
);

4281 
Ãwc
 = 
	`m®loc
((
ocÚ‹xt_t
));

4282 ià(!
Ãwc
) {

4283 
	`yy”rÜ
("out of memory");

4286 
	`mem£t
(
Ãwc
, 0, (
ocÚ‹xt_t
));

4288 
Ãwc
->
u
.
deviû
 = device;

4290 ià(
	`·r£_£cur™y_cÚ‹xt
(&
Ãwc
->
cÚ‹xt
[0])) {

4291 
	`ä“
(
Ãwc
);

4295 
h—d
 = 
pŞicydbp
->
ocÚ‹xts
[
OCON_XEN_PCIDEVICE
];

4296 
l
 = 
NULL
, 
c
 = 
h—d
; c;† = c, c = c->
Ãxt
) {

4297 
deviû2
;

4299 
deviû2
 = 
c
->
u
.
deviû
;

4300 ià(
deviû
 =ğ
deviû2
) {

4301 
	`yy”rÜ2
("duplicate…cideviceconƒntry for 0x%x ",

4302 
deviû
);

4303 
bad
;

4307 ià(
l
)

4308 
l
->
Ãxt
 = 
Ãwc
;

4310 
pŞicydbp
->
ocÚ‹xts
[
OCON_XEN_PCIDEVICE
] = 
Ãwc
;

4314 
bad
:

4315 
	`ä“
(
Ãwc
);

4317 
	}
}

4319 
	$defše_pÜt_cÚ‹xt
(
low
, 
high
)

4321 
ocÚ‹xt_t
 *
Ãwc
, *
c
, *
l
, *
h—d
;

4322 
´ÙocŞ
;

4323 *
id
;

4325 ià(
pŞicydbp
->
rg‘_¶©fÜm
 !ğ
SEPOL_TARGET_SELINUX
) {

4326 
	`yy”rÜ
("portcon‚ot supported forarget");

4330 ià(
·ss
 == 1) {

4331 
id
 = (*)
	`queue_»move
(
id_queue
);

4332 
	`ä“
(
id
);

4333 
	`·r£_£cur™y_cÚ‹xt
(
NULL
);

4337 
Ãwc
 = 
	`m®loc
((
ocÚ‹xt_t
));

4338 ià(!
Ãwc
) {

4339 
	`yy”rÜ
("out of memory");

4342 
	`mem£t
(
Ãwc
, 0, (
ocÚ‹xt_t
));

4344 
id
 = (*)
	`queue_»move
(
id_queue
);

4345 ià(!
id
) {

4346 
	`ä“
(
Ãwc
);

4349 ià((
	`¡rcmp
(
id
, "tcp") == 0) || (strcmp(id, "TCP") == 0)) {

4350 
´ÙocŞ
 = 
IPPROTO_TCP
;

4351 } ià((
	`¡rcmp
(
id
, "udp") == 0) || (strcmp(id, "UDP") == 0)) {

4352 
´ÙocŞ
 = 
IPPROTO_UDP
;

4354 
	`yy”rÜ2
("uÄecognized…rÙocŞ %s", 
id
);

4355 
	`ä“
(
Ãwc
);

4359 
Ãwc
->
u
.
pÜt
.
´ÙocŞ
 =…rotocol;

4360 
Ãwc
->
u
.
pÜt
.
low_pÜt
 = 
low
;

4361 
Ãwc
->
u
.
pÜt
.
high_pÜt
 = 
high
;

4363 ià(
low
 > 
high
) {

4364 
	`yy”rÜ2
("low…Üˆ%dƒxûed high…Üˆ%d", 
low
, 
high
);

4365 
	`ä“
(
Ãwc
);

4369 ià(
	`·r£_£cur™y_cÚ‹xt
(&
Ãwc
->
cÚ‹xt
[0])) {

4370 
	`ä“
(
Ãwc
);

4375 
h—d
 = 
pŞicydbp
->
ocÚ‹xts
[
OCON_PORT
];

4376 
l
 = 
NULL
, 
c
 = 
h—d
; c;† = c, c = c->
Ãxt
) {

4377 
´Ù2
, 
low2
, 
high2
;

4379 
´Ù2
 = 
c
->
u
.
pÜt
.
´ÙocŞ
;

4380 
low2
 = 
c
->
u
.
pÜt
.
low_pÜt
;

4381 
high2
 = 
c
->
u
.
pÜt
.
high_pÜt
;

4382 ià(
´ÙocŞ
 !ğ
´Ù2
)

4384 ià(
low
 =ğ
low2
 && 
high
 =ğ
high2
) {

4385 
	`yy”rÜ2
("du¶iÿ‹…ÜtcÚƒÁry fÜ % %d-%d ", 
id
,

4386 
low
, 
high
);

4387 
bad
;

4389 ià(
low2
 <ğ
low
 && 
high2
 >ğ
high
) {

4390 
	`yy”rÜ2
("portconƒntry for %s %d-%d hidden byƒarlier "

4391 "’Œy fÜ %d-%d", 
id
, 
low
, 
high
, 
low2
, 
high2
);

4392 
bad
;

4396 ià(
l
)

4397 
l
->
Ãxt
 = 
Ãwc
;

4399 
pŞicydbp
->
ocÚ‹xts
[
OCON_PORT
] = 
Ãwc
;

4403 
bad
:

4404 
	`ä“
(
Ãwc
);

4406 
	}
}

4408 
	$defše_Ãtif_cÚ‹xt
()

4410 
ocÚ‹xt_t
 *
Ãwc
, *
c
, *
h—d
;

4412 ià(
pŞicydbp
->
rg‘_¶©fÜm
 !ğ
SEPOL_TARGET_SELINUX
) {

4413 
	`yy”rÜ
("netifcon‚ot supported forarget");

4417 ià(
·ss
 == 1) {

4418 
	`ä“
(
	`queue_»move
(
id_queue
));

4419 
	`·r£_£cur™y_cÚ‹xt
(
NULL
);

4420 
	`·r£_£cur™y_cÚ‹xt
(
NULL
);

4424 
Ãwc
 = (
ocÚ‹xt_t
 *è
	`m®loc
((ocontext_t));

4425 ià(!
Ãwc
) {

4426 
	`yy”rÜ
("out of memory");

4429 
	`mem£t
(
Ãwc
, 0, (
ocÚ‹xt_t
));

4431 
Ãwc
->
u
.
Çme
 = (*)
	`queue_»move
(
id_queue
);

4432 ià(!
Ãwc
->
u
.
Çme
) {

4433 
	`ä“
(
Ãwc
);

4436 ià(
	`·r£_£cur™y_cÚ‹xt
(&
Ãwc
->
cÚ‹xt
[0])) {

4437 
	`ä“
(
Ãwc
->
u
.
Çme
);

4438 
	`ä“
(
Ãwc
);

4441 ià(
	`·r£_£cur™y_cÚ‹xt
(&
Ãwc
->
cÚ‹xt
[1])) {

4442 
	`cÚ‹xt_de¡roy
(&
Ãwc
->
cÚ‹xt
[0]);

4443 
	`ä“
(
Ãwc
->
u
.
Çme
);

4444 
	`ä“
(
Ãwc
);

4447 
h—d
 = 
pŞicydbp
->
ocÚ‹xts
[
OCON_NETIF
];

4449 
c
 = 
h—d
; c; c = c->
Ãxt
) {

4450 ià(!
	`¡rcmp
(
Ãwc
->
u
.
Çme
, 
c
->u.name)) {

4451 
	`yy”rÜ2
("duplicateƒntry for‚etwork interface %s",

4452 
Ãwc
->
u
.
Çme
);

4453 
	`cÚ‹xt_de¡roy
(&
Ãwc
->
cÚ‹xt
[0]);

4454 
	`cÚ‹xt_de¡roy
(&
Ãwc
->
cÚ‹xt
[1]);

4455 
	`ä“
(
Ãwc
->
u
.
Çme
);

4456 
	`ä“
(
Ãwc
);

4461 
Ãwc
->
Ãxt
 = 
h—d
;

4462 
pŞicydbp
->
ocÚ‹xts
[
OCON_NETIF
] = 
Ãwc
;

4464 
	}
}

4466 
	$defše_v4_node_cÚ‹xt
()

4468 *
id
;

4469 
rc
 = 0;

4470 
š_addr
 
addr
, 
mask
;

4471 
ocÚ‹xt_t
 *
Ãwc
, *
c
, *
l
, *
h—d
;

4473 ià(
pŞicydbp
->
rg‘_¶©fÜm
 !ğ
SEPOL_TARGET_SELINUX
) {

4474 
	`yy”rÜ
("nodecon‚ot supported forarget");

4478 ià(
·ss
 == 1) {

4479 
	`ä“
(
	`queue_»move
(
id_queue
));

4480 
	`ä“
(
	`queue_»move
(
id_queue
));

4481 
	`·r£_£cur™y_cÚ‹xt
(
NULL
);

4482 
out
;

4485 
id
 = 
	`queue_»move
(
id_queue
);

4486 ià(!
id
) {

4487 
	`yy”rÜ
("failedo„ead ipv4‡ddress");

4488 
rc
 = -1;

4489 
out
;

4492 
rc
 = 
	`š‘_±Ú
(
AF_INET
, 
id
, &
addr
);

4493 
	`ä“
(
id
);

4494 ià(
rc
 < 1) {

4495 
	`yy”rÜ
("failedo…arse ipv4‡ddress");

4496 ià(
rc
 == 0)

4497 
rc
 = -1;

4498 
out
;

4501 
id
 = 
	`queue_»move
(
id_queue
);

4502 ià(!
id
) {

4503 
	`yy”rÜ
("failedo„ead ipv4‡ddress");

4504 
rc
 = -1;

4505 
out
;

4508 
rc
 = 
	`š‘_±Ú
(
AF_INET
, 
id
, &
mask
);

4509 
	`ä“
(
id
);

4510 ià(
rc
 < 1) {

4511 
	`yy”rÜ
("failedo…arse ipv4 mask");

4512 ià(
rc
 == 0)

4513 
rc
 = -1;

4514 
out
;

4517 
Ãwc
 = 
	`m®loc
((
ocÚ‹xt_t
));

4518 ià(!
Ãwc
) {

4519 
	`yy”rÜ
("out of memory");

4520 
rc
 = -1;

4521 
out
;

4524 
	`mem£t
(
Ãwc
, 0, (
ocÚ‹xt_t
));

4525 
Ãwc
->
u
.
node
.
addr
 =‡ddr.
s_addr
;

4526 
Ãwc
->
u
.
node
.
mask
 = mask.
s_addr
;

4528 ià(
	`·r£_£cur™y_cÚ‹xt
(&
Ãwc
->
cÚ‹xt
[0])) {

4529 
	`ä“
(
Ãwc
);

4535 
h—d
 = 
pŞicydbp
->
ocÚ‹xts
[
OCON_NODE
];

4536 
l
 = 
NULL
, 
c
 = 
h—d
; c;† = c, c = c->
Ãxt
) {

4537 ià(
Ãwc
->
u
.
node
.
mask
 > 
c
->u.node.mask)

4541 
Ãwc
->
Ãxt
 = 
c
;

4543 ià(
l
)

4544 
l
->
Ãxt
 = 
Ãwc
;

4546 
pŞicydbp
->
ocÚ‹xts
[
OCON_NODE
] = 
Ãwc
;

4547 
rc
 = 0;

4548 
out
:

4549  
rc
;

4550 
	}
}

4552 
	$defše_v6_node_cÚ‹xt
()

4554 *
id
;

4555 
rc
 = 0;

4556 
š6_addr
 
addr
, 
mask
;

4557 
ocÚ‹xt_t
 *
Ãwc
, *
c
, *
l
, *
h—d
;

4559 ià(
pŞicydbp
->
rg‘_¶©fÜm
 !ğ
SEPOL_TARGET_SELINUX
) {

4560 
	`yy”rÜ
("nodecon‚ot supported forarget");

4564 ià(
·ss
 == 1) {

4565 
	`ä“
(
	`queue_»move
(
id_queue
));

4566 
	`ä“
(
	`queue_»move
(
id_queue
));

4567 
	`·r£_£cur™y_cÚ‹xt
(
NULL
);

4568 
out
;

4571 
id
 = 
	`queue_»move
(
id_queue
);

4572 ià(!
id
) {

4573 
	`yy”rÜ
("failedo„ead ipv6‡ddress");

4574 
rc
 = -1;

4575 
out
;

4578 
rc
 = 
	`š‘_±Ú
(
AF_INET6
, 
id
, &
addr
);

4579 
	`ä“
(
id
);

4580 ià(
rc
 < 1) {

4581 
	`yy”rÜ
("failedo…arse ipv6‡ddress");

4582 ià(
rc
 == 0)

4583 
rc
 = -1;

4584 
out
;

4587 
id
 = 
	`queue_»move
(
id_queue
);

4588 ià(!
id
) {

4589 
	`yy”rÜ
("failedo„ead ipv6‡ddress");

4590 
rc
 = -1;

4591 
out
;

4594 
rc
 = 
	`š‘_±Ú
(
AF_INET6
, 
id
, &
mask
);

4595 
	`ä“
(
id
);

4596 ià(
rc
 < 1) {

4597 
	`yy”rÜ
("failedo…arse ipv6 mask");

4598 ià(
rc
 == 0)

4599 
rc
 = -1;

4600 
out
;

4603 
Ãwc
 = 
	`m®loc
((
ocÚ‹xt_t
));

4604 ià(!
Ãwc
) {

4605 
	`yy”rÜ
("out of memory");

4606 
rc
 = -1;

4607 
out
;

4610 
	`mem£t
(
Ãwc
, 0, (
ocÚ‹xt_t
));

4612 #ifdeà
DARWIN


4613 
	`memıy
(&
Ãwc
->
u
.
node6
.
addr
[0], &addr.
s6_addr
[0], 16);

4614 
	`memıy
(&
Ãwc
->
u
.
node6
.
mask
[0], &mask.
s6_addr
[0], 16);

4616 
	`memıy
(&
Ãwc
->
u
.
node6
.
addr
[0], &addr.
s6_addr32
[0], 16);

4617 
	`memıy
(&
Ãwc
->
u
.
node6
.
mask
[0], &mask.
s6_addr32
[0], 16);

4620 ià(
	`·r£_£cur™y_cÚ‹xt
(&
Ãwc
->
cÚ‹xt
[0])) {

4621 
	`ä“
(
Ãwc
);

4622 
rc
 = -1;

4623 
out
;

4628 
h—d
 = 
pŞicydbp
->
ocÚ‹xts
[
OCON_NODE6
];

4629 
l
 = 
NULL
, 
c
 = 
h—d
; c;† = c, c = c->
Ãxt
) {

4630 ià(
	`memcmp
(&
Ãwc
->
u
.
node6
.
mask
, &
c
->u.node6.mask, 16) > 0)

4634 
Ãwc
->
Ãxt
 = 
c
;

4636 ià(
l
)

4637 
l
->
Ãxt
 = 
Ãwc
;

4639 
pŞicydbp
->
ocÚ‹xts
[
OCON_NODE6
] = 
Ãwc
;

4641 
rc
 = 0;

4642 
out
:

4643  
rc
;

4644 
	}
}

4646 
	$defše_fs_u£
(
behaviÜ
)

4648 
ocÚ‹xt_t
 *
Ãwc
, *
c
, *
h—d
;

4650 ià(
pŞicydbp
->
rg‘_¶©fÜm
 !ğ
SEPOL_TARGET_SELINUX
) {

4651 
	`yy”rÜ
("fsuse‚ot supported forarget");

4655 ià(
·ss
 == 1) {

4656 
	`ä“
(
	`queue_»move
(
id_queue
));

4658 ià(
behaviÜ
 !ğ
SECURITY_FS_USE_PSIDS
)

4659 
	`·r£_£cur™y_cÚ‹xt
(
NULL
);

4663 
Ãwc
 = (
ocÚ‹xt_t
 *è
	`m®loc
((ocontext_t));

4664 ià(!
Ãwc
) {

4665 
	`yy”rÜ
("out of memory");

4668 
	`mem£t
(
Ãwc
, 0, (
ocÚ‹xt_t
));

4670 
Ãwc
->
u
.
Çme
 = (*)
	`queue_»move
(
id_queue
);

4671 ià(!
Ãwc
->
u
.
Çme
) {

4672 
	`ä“
(
Ãwc
);

4675 
Ãwc
->
v
.
behaviÜ
 = behavior;

4677 ià(
Ãwc
->
v
.
behaviÜ
 !ğ
SECURITY_FS_USE_PSIDS
) {

4678 ià(
	`·r£_£cur™y_cÚ‹xt
(&
Ãwc
->
cÚ‹xt
[0])) {

4679 
	`ä“
(
Ãwc
->
u
.
Çme
);

4680 
	`ä“
(
Ãwc
);

4684 
	`mem£t
(&
Ãwc
->
cÚ‹xt
[0], 0, (
cÚ‹xt_¡ruù_t
) * 2);

4686 
h—d
 = 
pŞicydbp
->
ocÚ‹xts
[
OCON_FSUSE
];

4688 
c
 = 
h—d
; c; c = c->
Ãxt
) {

4689 ià(!
	`¡rcmp
(
Ãwc
->
u
.
Çme
, 
c
->u.name)) {

4690 
	`yy”rÜ2
("duplicate fs_useƒntry for filesystemype %s",

4691 
Ãwc
->
u
.
Çme
);

4692 
	`cÚ‹xt_de¡roy
(&
Ãwc
->
cÚ‹xt
[0]);

4693 
	`ä“
(
Ãwc
->
u
.
Çme
);

4694 
	`ä“
(
Ãwc
);

4699 
Ãwc
->
Ãxt
 = 
h—d
;

4700 
pŞicydbp
->
ocÚ‹xts
[
OCON_FSUSE
] = 
Ãwc
;

4702 
	}
}

4704 
	$defše_g’fs_cÚ‹xt_h–³r
(*
f¡y³
, 
has_ty³
)

4706 
g’fs
 *
g’fs_p
, *g’fs, *
Ãwg’fs
;

4707 
ocÚ‹xt_t
 *
Ãwc
, *
c
, *
h—d
, *
p
;

4708 *
ty³
 = 
NULL
;

4709 
Ën
, 
Ën2
;

4711 ià(
pŞicydbp
->
rg‘_¶©fÜm
 !ğ
SEPOL_TARGET_SELINUX
) {

4712 
	`yy”rÜ
("genfs‚ot supported forarget");

4716 ià(
·ss
 == 1) {

4717 
	`ä“
(
f¡y³
);

4718 
	`ä“
(
	`queue_»move
(
id_queue
));

4719 ià(
has_ty³
)

4720 
	`ä“
(
	`queue_»move
(
id_queue
));

4721 
	`·r£_£cur™y_cÚ‹xt
(
NULL
);

4725 
g’fs_p
 = 
NULL
, 
g’fs
 = 
pŞicydbp
->genfs;

4726 
g’fs
; 
g’fs_p
 = g’fs, g’f ğg’fs->
Ãxt
) {

4727 ià(
	`¡rcmp
(
f¡y³
, 
g’fs
->fstype) <= 0)

4731 ià(!
g’fs
 || 
	`¡rcmp
(
f¡y³
, genfs->fstype)) {

4732 
Ãwg’fs
 = 
	`m®loc
((
g’fs
));

4733 ià(!
Ãwg’fs
) {

4734 
	`yy”rÜ
("out of memory");

4737 
	`mem£t
(
Ãwg’fs
, 0, (
g’fs
));

4738 
Ãwg’fs
->
f¡y³
 = fstype;

4739 
Ãwg’fs
->
Ãxt
 = 
g’fs
;

4740 ià(
g’fs_p
)

4741 
g’fs_p
->
Ãxt
 = 
Ãwg’fs
;

4743 
pŞicydbp
->
g’fs
 = 
Ãwg’fs
;

4744 
g’fs
 = 
Ãwg’fs
;

4747 
Ãwc
 = (
ocÚ‹xt_t
 *è
	`m®loc
((ocontext_t));

4748 ià(!
Ãwc
) {

4749 
	`yy”rÜ
("out of memory");

4752 
	`mem£t
(
Ãwc
, 0, (
ocÚ‹xt_t
));

4754 
Ãwc
->
u
.
Çme
 = (*)
	`queue_»move
(
id_queue
);

4755 ià(!
Ãwc
->
u
.
Çme
)

4756 
ç
;

4757 ià(
has_ty³
) {

4758 
ty³
 = (*)
	`queue_»move
(
id_queue
);

4759 ià(!
ty³
)

4760 
ç
;

4761 ià(
ty³
[1] != 0) {

4762 
	`yy”rÜ2
("šv®idy³ %s", 
ty³
);

4763 
ç
;

4765 
ty³
[0]) {

4767 
Ãwc
->
v
.
sşass
 = 
SECCLASS_BLK_FILE
;

4770 
Ãwc
->
v
.
sşass
 = 
SECCLASS_CHR_FILE
;

4773 
Ãwc
->
v
.
sşass
 = 
SECCLASS_DIR
;

4776 
Ãwc
->
v
.
sşass
 = 
SECCLASS_FIFO_FILE
;

4779 
Ãwc
->
v
.
sşass
 = 
SECCLASS_LNK_FILE
;

4782 
Ãwc
->
v
.
sşass
 = 
SECCLASS_SOCK_FILE
;

4785 
Ãwc
->
v
.
sşass
 = 
SECCLASS_FILE
;

4788 
	`yy”rÜ2
("šv®idy³ %s", 
ty³
);

4789 
ç
;

4792 ià(
	`·r£_£cur™y_cÚ‹xt
(&
Ãwc
->
cÚ‹xt
[0]))

4793 
ç
;

4795 
h—d
 = 
g’fs
->head;

4797 
p
 = 
NULL
, 
c
 = 
h—d
; c;… = c, c = c->
Ãxt
) {

4798 ià(!
	`¡rcmp
(
Ãwc
->
u
.
Çme
, 
c
->u.name) &&

4799 (!
Ãwc
->
v
.
sşass
 || !
c
->v.sclass

4800 || 
Ãwc
->
v
.
sşass
 =ğ
c
->v.sclass)) {

4801 
	`yy”rÜ2
("duplicateƒntry for genfsƒntry (%s, %s)",

4802 
f¡y³
, 
Ãwc
->
u
.
Çme
);

4803 
ç
;

4805 
Ën
 = 
	`¡¾’
(
Ãwc
->
u
.
Çme
);

4806 
Ën2
 = 
	`¡¾’
(
c
->
u
.
Çme
);

4807 ià(
Ën
 > 
Ën2
)

4811 
Ãwc
->
Ãxt
 = 
c
;

4812 ià(
p
)

4813 
p
->
Ãxt
 = 
Ãwc
;

4815 
g’fs
->
h—d
 = 
Ãwc
;

4817 
ç
:

4818 ià(
ty³
)

4819 
	`ä“
(
ty³
);

4820 
	`cÚ‹xt_de¡roy
(&
Ãwc
->
cÚ‹xt
[0]);

4821 ià(
f¡y³
)

4822 
	`ä“
(
f¡y³
);

4823 ià(
Ãwc
->
u
.
Çme
)

4824 
	`ä“
(
Ãwc
->
u
.
Çme
);

4825 
	`ä“
(
Ãwc
);

4827 
	}
}

4829 
	$defše_g’fs_cÚ‹xt
(
has_ty³
)

4831  
	`defše_g’fs_cÚ‹xt_h–³r
(
	`queue_»move
(
id_queue
), 
has_ty³
);

4832 
	}
}

4834 
	$defše_¿nge_Œªs
(
şass_¥ecif›d
)

4836 *
id
;

4837 
Ëv–_d©um_t
 *
Ëvd©um
 = 0;

4838 
şass_d©um_t
 *
şad©um
;

4839 
¿nge_Œªs_ruË_t
 *
ruË
;

4840 
l
, 
add
 = 1;

4842 ià(!
ml¥Ş
) {

4843 
	`yy”rÜ
("range_transition„ule in‚on-MLS configuration");

4847 ià(
·ss
 == 1) {

4848 (
id
 = 
	`queue_»move
(
id_queue
)))

4849 
	`ä“
(
id
);

4850 (
id
 = 
	`queue_»move
(
id_queue
)))

4851 
	`ä“
(
id
);

4852 ià(
şass_¥ecif›d
)

4853 (
id
 = 
	`queue_»move
(
id_queue
)))

4854 
	`ä“
(
id
);

4855 
id
 = 
	`queue_»move
(
id_queue
);

4856 
	`ä“
(
id
);

4857 
l
 = 0;† < 2;†++) {

4858 (
id
 = 
	`queue_»move
(
id_queue
))) {

4859 
	`ä“
(
id
);

4861 
id
 = 
	`queue_»move
(
id_queue
);

4862 ià(!
id
)

4864 
	`ä“
(
id
);

4869 
ruË
 = 
	`m®loc
((
¿nge_Œªs_ruË
));

4870 ià(!
ruË
) {

4871 
	`yy”rÜ
("out of memory");

4874 
	`¿nge_Œªs_ruË_š™
(
ruË
);

4876 (
id
 = 
	`queue_»move
(
id_queue
))) {

4877 ià(
	`£t_ty³s
(&
ruË
->
¡y³s
, 
id
, &
add
, 0))

4878 
out
;

4880 
add
 = 1;

4881 (
id
 = 
	`queue_»move
(
id_queue
))) {

4882 ià(
	`£t_ty³s
(&
ruË
->
‰y³s
, 
id
, &
add
, 0))

4883 
out
;

4886 ià(
şass_¥ecif›d
) {

4887 ià(
	`»ad_şas£s
(&
ruË
->
tşas£s
))

4888 
out
;

4890 
şad©um
 = 
	`hashb_£¬ch
(
pŞicydbp
->
p_şas£s
.
bË
,

4892 ià(!
şad©um
) {

4893 
	`yy”rÜ2
("could‚ot find…rocess class for "

4895 
out
;

4898 ià(
	`eb™m­_£t_b™
(&
ruË
->
tşas£s
, 
şad©um
->
s
.
v®ue
 - 1, 
TRUE
)) {

4899 
	`yy”rÜ
("out of memory");

4900 
out
;

4904 
id
 = (*)
	`queue_»move
(
id_queue
);

4905 ià(!
id
) {

4906 
	`yy”rÜ
("no„ange in„ange_transition definition?");

4907 
out
;

4909 
l
 = 0;† < 2;†++) {

4910 
Ëvd©um
 = 
	`hashb_£¬ch
(
pŞicydbp
->
p_Ëv–s
.
bË
, 
id
);

4911 ià(!
Ëvd©um
) {

4912 
	`yy”rÜ2
("unknown†evel %s used in„ange_transition "

4913 "defš™iÚ", 
id
);

4914 
	`ä“
(
id
);

4915 
out
;

4917 
	`ä“
(
id
);

4919 
ruË
->
Œªge
.
Ëv–
[
l
].
£ns
 = 
Ëvd©um
->level->sens;

4921 (
id
 = 
	`queue_»move
(
id_queue
))) {

4922 ià(
	`·r£_£mªtic_ÿ‹gÜ›s
(
id
, 
Ëvd©um
,

4923 &
ruË
->
Œªge
.
Ëv–
[
l
].
ÿt
)) {

4924 
	`ä“
(
id
);

4925 
out
;

4927 
	`ä“
(
id
);

4930 
id
 = (*)
	`queue_»move
(
id_queue
);

4931 ià(!
id
)

4934 ià(
l
 == 0) {

4935 ià(
	`mls_£mªtic_Ëv–_ıy
(&
ruË
->
Œªge
.
Ëv–
[1],

4936 &
ruË
->
Œªge
.
Ëv–
[0])) {

4937 
	`yy”rÜ
("out of memory");

4938 
out
;

4942 
	`­³nd_¿nge_Œªs
(
ruË
);

4945 
out
:

4946 
	`¿nge_Œªs_ruË_de¡roy
(
ruË
);

4947 
	`ä“
(
ruË
);

4949 
	}
}

	@libqpol/src/policy_define.h

9 #iâdeà
_POLICY_DEFINE_H_


10 
	#_POLICY_DEFINE_H_


	)

17 
	#COND_ERR
 ((
avruË_t
 *)-1)

	)

19 
	#TRUE
 1

	)

20 
	#FALSE
 0

	)

25 
	#SECURITY_FS_USE_PSIDS
 6

	)

27 
defše_mls
();

29 
avruË_t
 *
defše_cÚd_compu‹_ty³
(
which
);

30 
avruË_t
 *
defše_cÚd_pŞ_li¡
×vruË_ˆ*
avli¡
,‡vruË_ˆ*
¡mt
);

31 
avruË_t
 *
defše_cÚd_‹_avb
(
which
);

32 
avruË_t
 *
defše_cÚd_f’ame_Œªs
();

33 
cÚd_ex´_t
 *
defše_cÚd_ex´
(
ušt32_t
 
ex´_ty³
, *
¬g1
, * 
¬g2
);

34 
defše_©Œib
();

35 
defše_©Œib_rŞe
();

36 
defše_av_³rms
(
šh”™s
);

37 
defše_boŞ_tuÇbË
(
is_tuÇbË
);

38 
defše_ÿ‹gÜy
();

39 
defše_şass
();

40 
defše_deçuÉ_u£r
(
which
);

41 
defše_deçuÉ_rŞe
(
which
);

42 
defše_deçuÉ_ty³
(
which
);

43 
defše_deçuÉ_¿nge
(
which
);

44 
defše_commÚ_³rms
();

45 
defše_compu‹_ty³
(
which
);

46 
defše_cÚd™iÚ®
(
cÚd_ex´_t
 *
ex´
, 
avruË_t
 *
t_li¡
,‡vruË_ˆ*
f_li¡
 );

47 
defše_cÚ¡¿št
(
cÚ¡¿št_ex´_t
 *
ex´
);

48 
defše_domšªû
();

49 
defše_fs_cÚ‹xt
(
majÜ
, 
mšÜ
);

50 
defše_fs_u£
(
behaviÜ
);

51 
defše_g’fs_cÚ‹xt
(
has_ty³
);

52 
defše_š™Ÿl_sid_cÚ‹xt
();

53 
defše_š™Ÿl_sid
();

54 
defše_v4_node_cÚ‹xt
();

55 
defše_v6_node_cÚ‹xt
();

56 
defše_Ëv–
();

57 
defše_Ãtif_cÚ‹xt
();

58 
defše_³rmissive
();

59 
defše_pŞÿp
();

60 
defše_pÜt_cÚ‹xt
(
low
, 
high
);

61 
defše_pœq_cÚ‹xt
(
pœq
);

62 
defše_iomem_cÚ‹xt
(
low
, 
high
);

63 
defše_iİÜt_cÚ‹xt
(
low
, 
high
);

64 
defše_pcideviû_cÚ‹xt
(
deviû
);

65 
defše_¿nge_Œªs
(
şass_¥ecif›d
);

66 
defše_rŞe_®low
();

67 
defše_rŞe_Œªs
(
şass_¥ecif›d
);

68 
defše_rŞe_ty³s
();

69 
defše_rŞe_©Œ
();

70 
defše_rŞ—‰ribu‹
();

71 
defše_f’ame_Œªs
();

72 
defše_£ns
();

73 
defše_‹_avb
(
which
);

74 
defše_ty³®Ÿs
();

75 
defše_ty³©Œibu‹
();

76 
defše_ty³bounds
();

77 
defše_ty³
(
®Ÿs
);

78 
defše_u£r
();

79 
defše_v®id©‘¿ns
(
cÚ¡¿št_ex´_t
 *
ex´
);

80 
š£¹_id
(*
id
,
push
);

81 
š£¹_£·¿tÜ
(
push
);

82 
rŞe_d©um_t
 *
defše_rŞe_dom
ÔŞe_d©um_ˆ*
r
);

83 
rŞe_d©um_t
 *
m”ge_rŞes_dom
ÔŞe_d©um_ˆ*
r1
,rŞe_d©um_ˆ*
r2
);

84 
ušŒ_t
 
defše_ûx´
(
ušt32_t
 
ex´_ty³
, ušŒ_ˆ
¬g1
, ušŒ_ˆ
¬g2
);

	@libqpol/src/policy_extend.c

27 
	~<cÚfig.h
>

29 
	~<£pŞ/pŞicydb/pŞicydb.h
>

30 
	~<£pŞ/pŞicydb/cÚd™iÚ®.h
>

31 
	~<£pŞ/pŞicydb/avb.h
>

32 
	~<£pŞ/pŞicydb/hashb.h
>

33 
	~<£pŞ/pŞicydb/æask.h
>

34 
	~<£pŞ/pŞicydb/eb™m­.h
>

35 
	~<£pŞ/pŞicydb/ex·nd.h
>

36 #ifdeà
HAVE_SEPOL_ERRCODES


37 
	~<£pŞ/”rcodes.h
>

39 
	~<qpŞ/pŞicy.h
>

40 
	~<qpŞ/pŞicy_ex‹nd.h
>

41 
	~<qpŞ/™”©Ü.h
>

42 
	~<£lšux/£lšux.h
>

43 
	~<”ºo.h
>

44 
	~<as£¹.h
>

45 
	~<¡dio.h
>

46 
	~<¡dlib.h
>

47 
	~"qpŞ_š‹º®.h
"

48 
	~"™”©Ü_š‹º®.h
"

49 
	~"syn_ruË_š‹º®.h
"

51 #ifdeà
SETOOLS_DEBUG


52 
	~<m©h.h
>

55 
	#OBJECT_R
 "objeù_r"

	)

57 
	#QPOL_SYN_RULE_TABLE_BITS
 16

	)

58 
	#QPOL_SYN_RULE_TABLE_SIZE
 (1 << 
QPOL_SYN_RULE_TABLE_BITS
)

	)

59 
	#QPOL_SYN_RULE_TABLE_MASK
 (
QPOL_SYN_RULE_TABLE_SIZE
 - 1)

	)

71 
	#QPOL_SYN_RULE_TABLE_HASH
(
ruË_key
) \

72 (((((
ruË_key
->
sourû_v®
 & 0xffè<< 8è| (ruË_key->
rg‘_v®
 & 0xff)) ^ \

73 (
ruË_key
->
şass_v®
 & 0xf) ^ \

74 ((è((
size_t
è
ruË_key
->
cÚd
è& 0xfff0)è& 
QPOL_SYN_RULE_TABLE_MASK
)

	)

76 
	sqpŞ_syn_ruË_key


78 
ušt32_t
 
	mruË_ty³
;

79 
ušt32_t
 
	msourû_v®
;

80 
ušt32_t
 
	mrg‘_v®
;

81 
ušt32_t
 
	mşass_v®
;

82 
cÚd_node_t
 *
	mcÚd
;

83 } 
	tqpŞ_syn_ruË_key_t
;

85 
	sqpŞ_syn_ruË_li¡


87 
qpŞ_syn_ruË
 *
	mruË
;

88 
qpŞ_syn_ruË_li¡
 *
	mÃxt
;

89 } 
	tqpŞ_syn_ruË_li¡_t
;

91 
	sqpŞ_syn_ruË_node


93 
qpŞ_syn_ruË_key_t
 
	mkey
;

94 
qpŞ_syn_ruË_li¡_t
 *
	mruËs
;

95 
qpŞ_syn_ruË_node
 *
	mÃxt
;

96 } 
	tqpŞ_syn_ruË_node_t
;

98 
	sqpŞ_syn_ruË_bË


100 
qpŞ_syn_ruË_node_t
 **
	mbuck‘s
;

101 } 
	tqpŞ_syn_ruË_bË_t
;

103 
	sqpŞ_ex‹nded_image


105 
qpŞ_syn_ruË_bË_t
 *
	msyn_ruË_bË
;

106 
qpŞ_syn_ruË
 **
	msyn_ruË_ma¡”_li¡
;

107 
size_t
 
	mma¡”_li¡_sz
;

108 } 
	tqpŞ_ex‹nded_image_t
;

110 
	sex‹nd_bogus_®Ÿs_¡ruù


112 
qpŞ_pŞicy_t
 *
	mq
;

113 
	mnum_bogus_®Ÿ£s
;

116 
ex‹nd_fšd_bogus_®Ÿs
(
hashb_key_t
 
key
 
__©Œibu‹__
 ((
unu£d
)), 
hashb_d©um_t
 
d©um
, *
¬gs
)

118 
ex‹nd_bogus_®Ÿs_¡ruù
 *
	ge
 = (ex‹nd_bogus_®Ÿs_¡ruù *)
¬gs
;

120 
qpŞ_ty³_t
 *
	gqty³
 = (qpŞ_ty³_ˆ*è
d©um
;

121 
ty³_d©um_t
 *
	gty³
 = (ty³_d©um_ˆ*è
d©um
;

122 
	gi§lŸs
;

123 
qpŞ_ty³_g‘_i§lŸs
(
e
->
q
, 
qty³
, &
i§lŸs
);

124  
	gi§lŸs
 && 
	gty³
->
	gs
.
	gv®ue
 == 0;

127 
	$ex‹nd_»move_bogus_®Ÿs
(
hashb_key_t
 
key
, 
hashb_d©um_t
 
d©um
, *
¬gs
)

129 
ex‹nd_bogus_®Ÿs_¡ruù
 *
e
 = (ex‹nd_bogus_®Ÿs_¡ruù *)
¬gs
;

130 
	`ä“
(
key
);

131 
ty³_d©um_t
 *
ty³
 = (ty³_d©um_ˆ*è
d©um
;

132 
	`ty³_d©um_de¡roy
(
ty³
);

133 
	`ä“
(
ty³
);

134 
e
->
num_bogus_®Ÿ£s
++;

135 
	}
}

147 
	$qpŞ_pŞicy_»move_bogus_®Ÿ£s
(
qpŞ_pŞicy_t
 * 
pŞicy
)

149 
pŞicydb_t
 *
db
 = 
NULL
;

151 ià(
pŞicy
 =ğ
NULL
) {

152 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

153 
”ºo
 = 
EINVAL
;

154  
STATUS_ERR
;

157 
db
 = &
pŞicy
->
p
->p;

158 
ex‹nd_bogus_®Ÿs_¡ruù
 
e
 = { 
pŞicy
, 0 };

159 
	`hashb_m­_»move_Ú_”rÜ
(
db
->
p_ty³s
.
bË
, 
ex‹nd_fšd_bogus_®Ÿs
, 
ex‹nd_»move_bogus_®Ÿs
, &
e
);

161 #ifdeà
SETOOLS_DEBUG


162 ià(
e
.
num_bogus_®Ÿ£s
 > 0) {

163 
	`WARN
(
pŞicy
, "%s", "This…olicy contained disabled‡liases;hey have been„emoved.");

168 
	}
}

182 
	$qpŞ_pŞicy_bud_©Œs_äom_m­
(
qpŞ_pŞicy_t
 * 
pŞicy
)

184 
pŞicydb_t
 *
db
 = 
NULL
;

185 
size_t
 
i
;

186 
ušt32_t
 
b™
 = 0, 
couÁ
 = 0;

187 
eb™m­_node_t
 *
node
 = 
NULL
;

188 
ty³_d©um_t
 *
tmp_ty³
 = 
NULL
, *
Üig_ty³
;

189 *
tmp_Çme
 = 
NULL
, 
buff
[10];

190 
”rÜ
 = 0, 
»tv
;

192 
	`INFO
(
pŞicy
, "%s", "Generating‡ttributes for…olicy. (Step 4 of 5)");

193 ià(
pŞicy
 =ğ
NULL
) {

194 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

195 
”ºo
 = 
EINVAL
;

199 
db
 = &
pŞicy
->
p
->p;

201 
	`mem£t
(&
buff
, 0, 10 * ());

203 
i
 = 0; i < 
db
->
p_ty³s
.
Årim
; i++) {

204 
couÁ
 = 0;

205 
	`eb™m­_fÜ_—ch_b™
(&
db
->
©Œ_ty³_m­
[
i
], 
node
, 
b™
) {

206 ià(
	`eb™m­_node_g‘_b™
(
node
, 
b™
))

207 
couÁ
++;

209 ià(
couÁ
 == 0) {

216 ià(
db
->
p_ty³_v®_to_Çme
[
i
] =ğ
NULL
){

217 
	`¢´štf
(
buff
, 9, "@‰r%04zd", 
i
 + 1);

218 
tmp_Çme
 = 
	`¡rdup
(
buff
);

219 ià(!
tmp_Çme
) {

220 
”rÜ
 = 
”ºo
;

221 
”r
;

227 
tmp_Çme
 = 
db
->
p_ty³_v®_to_Çme
[
i
];

229 
tmp_ty³
 = 
	`ÿÎoc
(1, (
ty³_d©um_t
));

230 ià(!
tmp_ty³
) {

231 
”rÜ
 = 
”ºo
;

232 
”r
;

234 
tmp_ty³
->
´im¬y
 = 1;

235 
tmp_ty³
->
æavÜ
 = 
TYPE_ATTRIB
;

236 
tmp_ty³
->
s
.
v®ue
 = 
i
 + 1;

237 ià(
	`eb™m­_ıy
(&
tmp_ty³
->
ty³s
, &
db
->
©Œ_ty³_m­
[
i
])) {

238 
”rÜ
 = 
ENOMEM
;

239 
”r
;

244 
	`eb™m­_fÜ_—ch_b™
(&
tmp_ty³
->
ty³s
, 
node
, 
b™
) {

245 ià(
	`eb™m­_node_g‘_b™
(
node
, 
b™
)) {

246 
Üig_ty³
 = 
db
->
ty³_v®_to_¡ruù
[
b™
];

247 ià(
	`eb™m­_£t_b™
(&
Üig_ty³
->
ty³s
, 
tmp_ty³
->
s
.
v®ue
 - 1, 1)) {

248 
”rÜ
 = 
ENOMEM
;

249 
”r
;

254 ià(
db
->
p_ty³_v®_to_Çme
[
i
] =ğ
NULL
){

255 
»tv
 = 
	`hashb_š£¹
(
db
->
p_ty³s
.
bË
, (
hashb_key_t
è
tmp_Çme
, (
hashb_d©um_t
è
tmp_ty³
);

256 ià(
»tv
) {

257 ià(
»tv
 =ğ
SEPOL_ENOMEM
)

258 
”rÜ
 = 
db
->
p_ty³s
.
bË
 ? 
ENOMEM
 : 
EINVAL
;

260 
”rÜ
 = 
EEXIST
;

261 
”r
;

266 
»tv
 = 
	`hashb_»¶aû
(
db
->
p_ty³s
.
bË
, (
hashb_key_t
è
tmp_Çme
, (
hashb_d©um_t
è
tmp_ty³
, 
NULL
, NULL);

267 ià(
»tv
) {

268 ià(
»tv
 =ğ
SEPOL_ENOMEM
)

269 
”rÜ
 = 
db
->
p_ty³s
.
bË
 ? 
ENOMEM
 : 
EINVAL
;

271 
”rÜ
 = 
EEXIST
;

272 
”r
;

276 
db
->
p_ty³_v®_to_Çme
[
i
] = 
tmp_Çme
;

277 
db
->
ty³_v®_to_¡ruù
[
i
] = 
tmp_ty³
;

280 
tmp_Çme
 = 
NULL
;

281 
tmp_ty³
 = 
NULL
;

284  
STATUS_SUCCESS
;

286 
”r
:

287 
	`ä“
(
tmp_Çme
);

288 
	`ty³_d©um_de¡roy
(
tmp_ty³
);

289 
	`ä“
(
tmp_ty³
);

290 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

291 
”ºo
 = 
”rÜ
;

292  
STATUS_ERR
;

293 
	}
}

306 
	$qpŞ_pŞicy_fl_©Œ_hŞes
(
qpŞ_pŞicy_t
 * 
pŞicy
)

308 
pŞicydb_t
 *
db
 = 
NULL
;

309 *
tmp_Çme
 = 
NULL
, 
buff
[10];

310 
”rÜ
 = 0, 
»tv
 = 0;

311 
eb™m­_t
 
tmp_bm­
 = { 
NULL
, 0 };

312 
ty³_d©um_t
 *
tmp_ty³
 = 
NULL
;

313 
size_t
 
i
;

315 ià(
pŞicy
 =ğ
NULL
) {

316 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

317 
”ºo
 = 
EINVAL
;

318  
STATUS_ERR
;

321 
db
 = &
pŞicy
->
p
->p;

323 
	`mem£t
(&
buff
, 0, 10 * ());

325 
i
 = 0; i < 
db
->
p_ty³s
.
Årim
; i++) {

326 ià(
db
->
ty³_v®_to_¡ruù
[
i
])

328 
	`¢´štf
(
buff
, 9, "@‰r%04zd", 
i
 + 1);

329 
tmp_Çme
 = 
	`¡rdup
(
buff
);

330 ià(!
tmp_Çme
) {

331 
”rÜ
 = 
”ºo
;

332 
”r
;

334 
tmp_ty³
 = 
	`ÿÎoc
(1, (
ty³_d©um_t
));

335 ià(!
tmp_ty³
) {

336 
”rÜ
 = 
”ºo
;

337 
”r
;

339 
tmp_ty³
->
´im¬y
 = 1;

340 
tmp_ty³
->
æavÜ
 = 
TYPE_ATTRIB
;

341 
tmp_ty³
->
s
.
v®ue
 = 
i
 + 1;

342 
tmp_ty³
->
ty³s
 = 
tmp_bm­
;

344 
»tv
 = 
	`hashb_š£¹
(
db
->
p_ty³s
.
bË
, (
hashb_key_t
è
tmp_Çme
, (
hashb_d©um_t
è
tmp_ty³
);

345 ià(
»tv
) {

346 ià(
»tv
 =ğ
SEPOL_ENOMEM
)

347 
”rÜ
 = 
db
->
p_ty³s
.
bË
 ? 
ENOMEM
 : 
EINVAL
;

349 
”rÜ
 = 
EEXIST
;

350 
”r
;

352 
db
->
p_ty³_v®_to_Çme
[
i
] = 
tmp_Çme
;

353 
db
->
ty³_v®_to_¡ruù
[
i
] = 
tmp_ty³
;

356 
tmp_Çme
 = 
NULL
;

357 
tmp_ty³
 = 
NULL
;

360  
STATUS_SUCCESS
;

362 
”r
:

363 
	`ä“
(
tmp_ty³
);

364 
	`ä“
(
tmp_Çme
);

365 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

366 
”ºo
 = 
”rÜ
;

367  
STATUS_ERR
;

368 
	}
}

370 *
	gsidÇmes
[] = {

409 
	$qpŞ_pŞicy_add_isid_Çmes
(
qpŞ_pŞicy_t
 * 
pŞicy
)

411 
pŞicydb_t
 *
db
 = 
NULL
;

412 
ocÚ‹xt_t
 *
sid
 = 
NULL
;

413 
ušt32_t
 
v®
 = 0;

414 
”rÜ
 = 0;

416 ià(
pŞicy
 =ğ
NULL
) {

417 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

418 
”ºo
 = 
EINVAL
;

419  
STATUS_ERR
;

422 
db
 = &
pŞicy
->
p
->p;

424 
sid
 = 
db
->
ocÚ‹xts
[
OCON_ISID
]; sid; sid = sid->
Ãxt
) {

425 
v®
 = (
ušt32_t
è
sid
->sid[0];

426 ià(
v®
 > 
SECINITSID_NUM
)

427 
v®
 = 0;

429 ià(!
sid
->
u
.
Çme
) {

430 
sid
->
u
.
Çme
 = 
	`¡rdup
(
sidÇmes
[
v®
]);

431 ià(!
sid
->
u
.
Çme
) {

432 
”rÜ
 = 
”ºo
;

433 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

434 
”ºo
 = 
”rÜ
;

435  
STATUS_ERR
;

441 
	}
}

443 
ex‹nd_assign_rŞe_to_u£r
(
hashb_key_t
 
k
 
__©Œibu‹__
 ((
unu£d
)), 
hashb_d©um_t
 
d
, *
¬gs
)

445 
u£r_d©um_t
 *
	gu£r
 = (u£r_d©um_ˆ*è
d
;

446 
ušt32_t
 *
	gv®ue
 = (ušt32_ˆ*è
¬gs
;

447 ià(
eb™m­_£t_b™
(&
u£r
->
rŞes
.rŞes, *
v®ue
 - 1, 1)) {

461 
	$qpŞ_pŞicy_add_objeù_r
(
qpŞ_pŞicy_t
 * 
pŞicy
)

463 
pŞicydb_t
 *
db
 = 
NULL
;

464 
”rÜ
 = 0;

466 ià(
pŞicy
 =ğ
NULL
) {

467 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

468 
”ºo
 = 
EINVAL
;

469  
STATUS_ERR
;

472 
db
 = &
pŞicy
->
p
->p;

474 
hashb_d©um_t
 
d©um
 = 
	`hashb_£¬ch
(
db
->
p_rŞes
.
bË
, (cÚ¡ 
hashb_key_t
)
OBJECT_R
);

475 ià(
d©um
 =ğ
NULL
) {

476 
	`ERR
(
pŞicy
, "%s", 
OBJECT_R
 "‚ot found in…olicy!");

477 
”ºo
 = 
EIO
;

478 
	`as£¹
(0);

479  
STATUS_ERR
;

482 
rŞe_d©um_t
 *
rŞe
 = (rŞe_d©um_ˆ*è
d©um
;

484 
ušt32_t
 
v®ue
 = 
rŞe
->
s
.value;

486 ià(
	`hashb_m­
(
db
->
p_u£rs
.
bË
, 
ex‹nd_assign_rŞe_to_u£r
, &
v®ue
) < 0) {

487  
STATUS_ERR
;

490 
qpŞ_™”©Ü_t
 *
™”
;

491 ià(
	`qpŞ_pŞicy_g‘_ty³_™”
(
pŞicy
, &
™”
) < 0) {

492  
STATUS_ERR
;

494 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

495 cÚ¡ 
qpŞ_ty³_t
 *
ty³
;

496 
i§‰r
, 
i§lŸs
;

497 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
ty³
) < 0 ||

498 
	`qpŞ_ty³_g‘_i§‰r
(
pŞicy
, 
ty³
, &
i§‰r
è< 0 || 
	`qpŞ_ty³_g‘_i§lŸs
ÕŞicy,y³, &
i§lŸs
) < 0) {

499 
”rÜ
 = 
”ºo
;

500 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

501 
”ºo
 = 
”rÜ
;

502  
STATUS_ERR
;

504 ià(
i§‰r
 || 
i§lŸs
) {

507 ià(
	`qpŞ_ty³_g‘_v®ue
(
pŞicy
, 
ty³
, &
v®ue
) < 0) {

508 
”rÜ
 = 
”ºo
;

509 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

510 
”ºo
 = 
”rÜ
;

511  
STATUS_ERR
;

513 ià(
	`eb™m­_£t_b™
(&
rŞe
->
ty³s
.ty³s, 
v®ue
 - 1, 1)) {

514 
”rÜ
 = 
”ºo
;

515 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

516 
”ºo
 = 
”rÜ
;

517  
STATUS_ERR
;

520 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

523 
	}
}

531 
	$qpŞ_pŞicy_m©ch_sy¡em
(
qpŞ_pŞicy_t
 * 
pŞicy
)

533 
k”nv”s
 = 
	`£cur™y_pŞicyv”s
();

534 
cu¼’tv”s
 = 
pŞicy
->
p
->p.
pŞicyv”s
;

535 
”rÜ
;

536 ià(
k”nv”s
 < 0) {

537 
”rÜ
 = 
”ºo
;

538 
	`ERR
(
pŞicy
, "%s", "Could‚ot determine„unning system's…olicy version.");

539 
”ºo
 = 
”rÜ
;

542 ià(
pŞicy
->
p
->p.
pŞicyv”s
 > 
k”nv”s
) {

543 ià(
	`£pŞ_pŞicydb_£t_v”s
(
pŞicy
->
p
, 
k”nv”s
)) {

544 
”rÜ
 = 
”ºo
;

545 
	`ERR
(
pŞicy
, "Could‚Ù downg¿dpŞicyØv”siÚ %d.", 
k”nv”s
);

546 
”ºo
 = 
”rÜ
;

549 
	`WARN
(
pŞicy
, "PŞicy would bdowng¿ded from v”siÚ %dØ%d.", 
cu¼’tv”s
, 
k”nv”s
);

552 
	}
}

562 
	$qpŞ_pŞicy_add_cÚd_ruË_Œaûback
(
qpŞ_pŞicy_t
 * 
pŞicy
)

564 
pŞicydb_t
 *
db
 = 
NULL
;

565 
cÚd_node_t
 *
cÚd
 = 
NULL
;

566 
cÚd_av_li¡_t
 *
li¡_±r
 = 
NULL
;

567 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

568 
avb_±r_t
 
ruË
 = 
NULL
;

569 
”rÜ
 = 0;

570 
ušt32_t
 
ruËs
 = 0;

572 
	`INFO
(
pŞicy
, "%s", "Building conditional„ulesables. (Step 5 of 5)");

573 ià(!
pŞicy
) {

574 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

575 
”ºo
 = 
EINVAL
;

576  
STATUS_ERR
;

579 
db
 = &
pŞicy
->
p
->p;

581 
ruËs
 = (
QPOL_RULE_ALLOW
 | 
QPOL_RULE_AUDITALLOW
 | 
QPOL_RULE_DONTAUDIT
);

582 ià(!(
pŞicy
->
İtiÚs
 & 
QPOL_POLICY_OPTION_NO_NEVERALLOWS
))

583 
ruËs
 |ğ
QPOL_RULE_NEVERALLOW
;

586 ià(
	`qpŞ_pŞicy_g‘_avruË_™”
(
pŞicy
, 
ruËs
, &
™”
))

587  
STATUS_ERR
;

588 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

589 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
ruË
)) {

590 
”rÜ
 = 
”ºo
;

591 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

592 
”ºo
 = 
”rÜ
;

593  
STATUS_ERR
;

595 
ruË
->
·r£_cÚ‹xt
 = 
NULL
;

596 
ruË
->
m”ged
 = 
QPOL_COND_RULE_ENABLED
;

598 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

599 ià(
	`qpŞ_pŞicy_g‘_‹ruË_™”
(
pŞicy
, (
QPOL_RULE_TYPE_TRANS
 | 
QPOL_RULE_TYPE_CHANGE
 | 
QPOL_RULE_TYPE_MEMBER
), &
™”
))

600  
STATUS_ERR
;

601 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

602 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
ruË
)) {

603 
”rÜ
 = 
”ºo
;

604 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

605 
”ºo
 = 
”rÜ
;

606  
STATUS_ERR
;

608 
ruË
->
·r£_cÚ‹xt
 = 
NULL
;

609 
ruË
->
m”ged
 = 
QPOL_COND_RULE_ENABLED
;

611 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

613 
cÚd
 = 
db
->
cÚd_li¡
; cÚd; cÚd = cÚd->
Ãxt
) {

615 
cÚd
->
cur_¡©e
 = 
	`cÚd_ev®u©e_ex´
(
db
, cÚd->
ex´
);

616 ià(
cÚd
->
cur_¡©e
 < 0) {

617 
	`ERR
(
pŞicy
, "E¼Üƒv®u©šg cÚd™iÚ®: %s", 
	`¡»¼Ü
(
EILSEQ
));

618 
”ºo
 = 
EILSEQ
;

619  
STATUS_ERR
;

623 
li¡_±r
 = 
cÚd
->
Œue_li¡
;†i¡_±r;†i¡_±¸ğli¡_±r->
Ãxt
) {

625 
li¡_±r
->
node
->
·r£_cÚ‹xt
 = (*)
cÚd
;

628 
li¡_±r
->
node
->
m”ged
 = 
QPOL_COND_RULE_LIST
;

629 ià(
cÚd
->
cur_¡©e
)

630 
li¡_±r
->
node
->
m”ged
 |ğ
QPOL_COND_RULE_ENABLED
;

634 
li¡_±r
 = 
cÚd
->
çl£_li¡
;†i¡_±r;†i¡_±¸ğli¡_±r->
Ãxt
) {

636 
li¡_±r
->
node
->
·r£_cÚ‹xt
 = (*)
cÚd
;

639 
li¡_±r
->
node
->
m”ged
 = 0;

640 ià(!
cÚd
->
cur_¡©e
)

641 
li¡_±r
->
node
->
m”ged
 |ğ
QPOL_COND_RULE_ENABLED
;

646 
	}
}

652 
	$qpŞ_syn_ruË_de¡roy
(
qpŞ_syn_ruË
 **
r
)

654 ià(!
r
 || !(*r))

657 
	`ä“
(*
r
);

658 *
r
 = 
NULL
;

659 
	}
}

667 
	$qpŞ_syn_ruË_li¡_de¡roy
(
qpŞ_syn_ruË_li¡_t
 ** 
li¡
)

669 
qpŞ_syn_ruË_li¡_t
 *
cur
 = 
NULL
, *
Ãxt
 = NULL;

671 ià(!
li¡
 || !(*list))

674 
cur
 = *
li¡
; cur; cu¸ğ
Ãxt
) {

675 
Ãxt
 = 
cur
->next;

676 
	`ä“
(
cur
);

678 
	}
}

685 
	$qpŞ_syn_ruË_node_de¡roy
(
qpŞ_syn_ruË_node_t
 ** 
node
)

687 
qpŞ_syn_ruË_node_t
 *
cur
 = 
NULL
, *
Ãxt
 = NULL;

689 ià(!
node
 || !(*node))

692 
cur
 = *
node
; cur; cu¸ğ
Ãxt
) {

693 
Ãxt
 = 
cur
->next;

694 
	`qpŞ_syn_ruË_li¡_de¡roy
(&
cur
->
ruËs
);

695 
	`ä“
(
cur
);

697 
	}
}

703 
	$qpŞ_syn_ruË_bË_de¡roy
(
qpŞ_syn_ruË_bË_t
 ** 
t
)

705 
size_t
 
i
 = 0;

707 ià(!
t
 || !(*t))

710 
i
 = 0; i < 
QPOL_SYN_RULE_TABLE_SIZE
; i++)

711 
	`qpŞ_syn_ruË_node_de¡roy
(&((*
t
)->
buck‘s
[
i
]));

713 
	`ä“
((*
t
)->
buck‘s
);

714 
	`ä“
(*
t
);

715 *
t
 = 
NULL
;

716 
	}
}

724 
qpŞ_syn_ruË_node_t
 *
	$qpŞ_syn_ruË_bË_fšd_node_by_key
(cÚ¡ 
qpŞ_syn_ruË_bË_t
 * 
bË
,

725 cÚ¡ 
qpŞ_syn_ruË_key_t
 * 
key
)

727 
qpŞ_syn_ruË_node_t
 *
node
 = 
NULL
;

729 
node
 = 
bË
->
buck‘s
[
	`QPOL_SYN_RULE_TABLE_HASH
(
key
)];‚ode;‚odğnode->
Ãxt
) {

730 ià((
node
->
key
.
ruË_ty³
 & key->rule_type) &&

731 (
node
->
key
.
sourû_v®
 == key->source_val) &&

732 (
node
->
key
.
rg‘_v®
 == key->target_val) &&

733 (
node
->
key
.
şass_v®
 =ğkey->şass_v®è&& (node->key.
cÚd
 == key->cond))

734  
node
;

737  
NULL
;

738 
	}
}

752 
	$qpŞ_syn_ruË_bË_š£¹_’Œy
(
qpŞ_pŞicy_t
 * 
pŞicy
,

753 
qpŞ_syn_ruË_bË_t
 * 
bË
, 
qpŞ_syn_ruË_key_t
 * 
key
, 
qpŞ_syn_ruË
 *
ruË
)

755 
”rÜ
 = 0;

756 
qpŞ_syn_ruË_node_t
 *
bË_node
 = 
NULL
;

757 
qpŞ_syn_ruË_li¡_t
 *
li¡_’Œy
 = 
NULL
;

759 ià(!(
li¡_’Œy
 = 
	`m®loc
((
qpŞ_syn_ruË_li¡_t
)))) {

760 
”rÜ
 = 
”ºo
;

761 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

764 
li¡_’Œy
->
ruË
 =„ule;

766 
bË_node
 = 
	`qpŞ_syn_ruË_bË_fšd_node_by_key
(
bË
, 
key
);

767 ià(
bË_node
) {

768 
li¡_’Œy
->
Ãxt
 = 
bË_node
->
ruËs
;

769 
bË_node
->
ruËs
 = 
li¡_’Œy
;

771 
li¡_’Œy
->
Ãxt
 = 
NULL
;

772 ià(!(
bË_node
 = 
	`m®loc
((
qpŞ_syn_ruË_node_t
)))) {

773 
”rÜ
 = 
”ºo
;

774 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

775 
	`ä“
(
li¡_’Œy
);

778 
bË_node
->
key
 = *key;

779 
bË_node
->
ruËs
 = 
li¡_’Œy
;

780 
size_t
 
hash
 = 
	`QPOL_SYN_RULE_TABLE_HASH
(
key
);

781 
bË_node
->
Ãxt
 = 
bË
->
buck‘s
[
hash
];

782 
bË
->
buck‘s
[
hash
] = 
bË_node
;

785 
	}
}

799 
	$qpŞ_syn_ruË_bË_š£¹_£pŞ_avruË
(
qpŞ_pŞicy_t
 * 
pŞicy
, 
qpŞ_syn_ruË_bË_t
 * 
bË
, 
avruË_t
 * 
ruË
,

800 
cÚd_node_t
 * 
cÚd
, 
b¿nch
)

802 
”rÜ
 = 0;

803 
qpŞ_syn_ruË_key_t
 
key
 = { 0, 0, 0, 0, 
NULL
 };

804 
qpŞ_syn_ruË
 *
Ãw_ruË
 = 
NULL
;

805 
eb™m­_t
 
sourû_ty³s
, 
sourû_ty³s2
, 
rg‘_ty³s
, 
rg‘_ty³s2
;

806 
eb™m­_node_t
 *
¢ode
 = 
NULL
, *
Šode
 = NULL;

807 
i
, 
j
;

808 
şass_³rm_node_t
 *
şass_node
 = 
NULL
;

810 ià(!(
Ãw_ruË
 = 
	`m®loc
((
qpŞ_syn_ruË
)))) {

811 
”rÜ
 = 
”ºo
;

812 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

813 
”r
;

815 
Ãw_ruË
->
ruË
 =„ule;

816 
Ãw_ruË
->
cÚd
 = cond;

817 
Ãw_ruË
->
cÚd_b¿nch
 = 
b¿nch
;

819 
pŞicy
->
ext
->
syn_ruË_ma¡”_li¡
[pŞicy->ext->
ma¡”_li¡_sz
] = 
Ãw_ruË
;

820 
pŞicy
->
ext
->
ma¡”_li¡_sz
++;

822 ià(
	`ty³_£t_ex·nd
(&
ruË
->
¡y³s
, &
sourû_ty³s
, &
pŞicy
->
p
->p, 0) ||

823 
	`ty³_£t_ex·nd
(&
ruË
->
¡y³s
, &
sourû_ty³s2
, &
pŞicy
->
p
->p, 1)) {

824 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

825 
”rÜ
 = 
ENOMEM
;

826 
”r
;

828 ià(
	`ty³_£t_ex·nd
(&
ruË
->
‰y³s
, &
rg‘_ty³s
, &
pŞicy
->
p
->p, 0) ||

829 
	`ty³_£t_ex·nd
(&
ruË
->
‰y³s
, &
rg‘_ty³s2
, &
pŞicy
->
p
->p, 1)) {

830 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

831 
”rÜ
 = 
ENOMEM
;

832 
”r
;

834 ià(
	`eb™m­_uniÚ
(&
sourû_ty³s
, &
sourû_ty³s2
è||ƒb™m­_uniÚ(&
rg‘_ty³s
, &
rg‘_ty³s2
)) {

835 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

836 
”rÜ
 = 
ENOMEM
;

837 
”r
;

839 
	`eb™m­_fÜ_—ch_b™
(&
sourû_ty³s
, 
¢ode
, 
i
) {

840 ià(!
	`eb™m­_g‘_b™
(&
sourû_ty³s
, 
i
))

842 ià(
ruË
->
æags
 & 
RULE_SELF
) {

843 
şass_node
 = 
ruË
->
³rms
; cÏss_node; cÏss_nodğşass_node->
Ãxt
) {

844 
key
.
ruË_ty³
 = 
ruË
->
¥ecif›d
;

845 
key
.
sourû_v®
 = key.
rg‘_v®
 = 
i
 + 1;

846 
key
.
şass_v®
 = 
şass_node
->
tşass
;

847 
key
.
cÚd
 = cond;

848 ià(
	`qpŞ_syn_ruË_bË_š£¹_’Œy
(
pŞicy
, 
bË
, &
key
, 
Ãw_ruË
))

849 
”r
;

852 
	`eb™m­_fÜ_—ch_b™
(&
rg‘_ty³s
, 
Šode
, 
j
) {

853 ià(!
	`eb™m­_g‘_b™
(&
rg‘_ty³s
, 
j
))

855 
şass_node
 = 
ruË
->
³rms
; cÏss_node; cÏss_nodğşass_node->
Ãxt
) {

856 
key
.
ruË_ty³
 = 
ruË
->
¥ecif›d
;

857 
key
.
sourû_v®
 = 
i
 + 1;

858 
key
.
rg‘_v®
 = 
j
 + 1;

859 
key
.
şass_v®
 = 
şass_node
->
tşass
;

860 
key
.
cÚd
 = cond;

861 ià(
	`qpŞ_syn_ruË_bË_š£¹_’Œy
(
pŞicy
, 
bË
, &
key
, 
Ãw_ruË
))

862 
”r
;

867 
	`eb™m­_de¡roy
(&
sourû_ty³s
);

868 
	`eb™m­_de¡roy
(&
sourû_ty³s2
);

869 
	`eb™m­_de¡roy
(&
rg‘_ty³s
);

870 
	`eb™m­_de¡roy
(&
rg‘_ty³s2
);

873 
”r
:

874 
	`eb™m­_de¡roy
(&
sourû_ty³s
);

875 
	`eb™m­_de¡roy
(&
sourû_ty³s2
);

876 
	`eb™m­_de¡roy
(&
rg‘_ty³s
);

877 
	`eb™m­_de¡roy
(&
rg‘_ty³s2
);

879 
	}
}

881 
	$qpŞ_pŞicy_bud_syn_ruË_bË
(
qpŞ_pŞicy_t
 * 
pŞicy
)

883 
”rÜ
 = 0, 
ü—‹d
 = 0;

884 
avruË_block_t
 *
cur_block
 = 
NULL
;

885 
avruË_deş_t
 *
deş
 = 
NULL
;

886 
avruË_t
 *
cur_ruË
 = 
NULL
;

887 
cÚd_node_t
 *
cur_cÚd
 = 
NULL
, *
»m­³d_cÚd
;

889 ià(!
pŞicy
) {

890 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

891 
”ºo
 = 
EINVAL
;

895 ià(!
pŞicy
->
ext
) {

896 
pŞicy
->
ext
 = 
	`ÿÎoc
(1, (
qpŞ_ex‹nded_image_t
));

897 ià(!
pŞicy
->
ext
) {

898 
”rÜ
 = 
”ºo
;

899 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

900 
”r
;

904 ià(
pŞicy
->
ext
->
syn_ruË_bË
)

907 
pŞicy
->
ext
->
syn_ruË_bË
 = 
	`ÿÎoc
(1, (
qpŞ_syn_ruË_bË_t
));

908 ià(!
pŞicy
->
ext
->
syn_ruË_bË
) {

909 
”rÜ
 = 
”ºo
;

910 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

911 
”r
;

913 
pŞicy
->
ext
->
syn_ruË_bË
->
buck‘s
 = 
	`ÿÎoc
(
QPOL_SYN_RULE_TABLE_SIZE
, (
qpŞ_syn_ruË_node_t
 *));

914 ià(!
pŞicy
->
ext
->
syn_ruË_bË
->
buck‘s
) {

915 
”rÜ
 = 
”ºo
;

916 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

917 
”r
;

920 
pŞicy
->
ext
->
ma¡”_li¡_sz
 = 0;

921 
cur_block
 = 
pŞicy
->
p
->p.
glob®
; cur_block; cur_block = cur_block->
Ãxt
) {

922 
deş
 = 
cur_block
->
’abËd
;

923 ià(!
deş
)

926 
cur_ruË
 = 
deş
->
avruËs
; cur_ruË; cur_ruË = cur_ruË->
Ãxt
) {

927 
pŞicy
->
ext
->
ma¡”_li¡_sz
++;

929 
cur_cÚd
 = 
deş
->
cÚd_li¡
; cur_cÚd; cur_cÚd = cur_cÚd->
Ãxt
) {

930 
cur_ruË
 = 
cur_cÚd
->
avŒue_li¡
; cur_ruË; cur_ruË = cur_ruË->
Ãxt
) {

931 
pŞicy
->
ext
->
ma¡”_li¡_sz
++;

933 
cur_ruË
 = 
cur_cÚd
->
avçl£_li¡
; cur_ruË; cur_ruË = cur_ruË->
Ãxt
) {

934 
pŞicy
->
ext
->
ma¡”_li¡_sz
++;

939 ià(
pŞicy
->
ext
->
ma¡”_li¡_sz
 == 0) {

940 
pŞicy
->
ext
->
syn_ruË_ma¡”_li¡
 = 
NULL
;

944 
	`INFO
(
pŞicy
, "%s", "Building syntactic„ulesables.");

946 
pŞicy
->
ext
->
syn_ruË_ma¡”_li¡
 = 
	`ÿÎoc
ÕŞicy->ext->
ma¡”_li¡_sz
, (
qpŞ_syn_ruË
 *));

947 ià(!
pŞicy
->
ext
->
syn_ruË_ma¡”_li¡
) {

948 
”rÜ
 = 
”ºo
;

949 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

950 
”r
;

954 
pŞicy
->
ext
->
ma¡”_li¡_sz
 = 0;

956 
cur_block
 = 
pŞicy
->
p
->p.
glob®
; cur_block; cur_block = cur_block->
Ãxt
) {

957 
deş
 = 
cur_block
->
’abËd
;

958 ià(!
deş
)

961 
cur_ruË
 = 
deş
->
avruËs
; cur_ruË; cur_ruË = cur_ruË->
Ãxt
) {

962 ià(
	`qpŞ_syn_ruË_bË_š£¹_£pŞ_avruË
(
pŞicy
,…Şicy->
ext
->
syn_ruË_bË
, 
cur_ruË
, 
NULL
, 0)) {

963 
”rÜ
 = 
”ºo
;

964 
”r
;

967 
cur_cÚd
 = 
deş
->
cÚd_li¡
; cur_cÚd; cur_cÚd = cur_cÚd->
Ãxt
) {

970 
»m­³d_cÚd
 = 
	`cÚd_node_fšd
(&
pŞicy
->
p
->p, 
cur_cÚd
,…Şicy->p->p.
cÚd_li¡
, &
ü—‹d
);

971 ià(
ü—‹d
 || !
»m­³d_cÚd
) {

972 
	`cÚd_node_de¡roy
(
»m­³d_cÚd
);

973 
”rÜ
 = 
EIO
;

974 
	`ERR
(
pŞicy
, "%s", "Inconsistent conditional„ecords");

975 
	`as£¹
(0);

976 
”r
;

978 
cur_ruË
 = 
cur_cÚd
->
avŒue_li¡
; cur_ruË; cur_ruË = cur_ruË->
Ãxt
) {

979 ià(
qpŞ_syn_ruË_bË_š£¹_£pŞ_avruË


980 (
pŞicy
,…Şicy->
ext
->
syn_ruË_bË
, 
cur_ruË
, 
»m­³d_cÚd
, 0)) {

981 
”rÜ
 = 
”ºo
;

982 
”r
;

985 
cur_ruË
 = 
cur_cÚd
->
avçl£_li¡
; cur_ruË; cur_ruË = cur_ruË->
Ãxt
) {

986 ià(
qpŞ_syn_ruË_bË_š£¹_£pŞ_avruË


987 (
pŞicy
,…Şicy->
ext
->
syn_ruË_bË
, 
cur_ruË
, 
»m­³d_cÚd
, 1)) {

988 
”rÜ
 = 
”ºo
;

989 
”r
;

995 #ifdeà
SETOOLS_DEBUG


1001 
size_t
 
buck‘
;

1002 
o2
 = 0.0f;

1003 
tÙ®_’Œ›s
 = 0;

1004 
buck‘
 = 0; buck‘ < 
QPOL_SYN_RULE_TABLE_SIZE
; bucket++) {

1005 
qpŞ_syn_ruË_node_t
 *
n
 = 
pŞicy
->
ext
->
syn_ruË_bË
->
buck‘s
[
buck‘
];

1006 
n
 !ğ
NULL
) {

1007 
tÙ®_’Œ›s
++;

1008 
n
 =‚->
Ãxt
;

1011 
ex³ùed_v®ue
 = 
tÙ®_’Œ›s
 * 1.0à/ 
QPOL_SYN_RULE_TABLE_SIZE
;

1012 
size_t
 
mš_™ems
 = 
tÙ®_’Œ›s
;

1013 
size_t
 
max_™ems
 = 0;

1014 
buck‘
 = 0; buck‘ < 
QPOL_SYN_RULE_TABLE_SIZE
; bucket++) {

1015 
size_t
 
num_™ems
 = 0;

1016 
qpŞ_syn_ruË_node_t
 *
n
 = 
pŞicy
->
ext
->
syn_ruË_bË
->
buck‘s
[
buck‘
];

1017 
n
 !ğ
NULL
) {

1018 
num_™ems
++;

1019 
n
 =‚->
Ãxt
;

1021 ià(
num_™ems
 > 
max_™ems
) {

1022 
max_™ems
 = 
num_™ems
;

1024 ià(
num_™ems
 < 
mš_™ems
) {

1025 
mš_™ems
 = 
num_™ems
;

1027 
o2
 +ğ(
num_™ems
 - 
ex³ùed_v®ue
) * (num_items -ƒxpected_value);

1029 
¡ddev
 = 
	`sq¹f
(
o2
 / (
QPOL_SYN_RULE_TABLE_SIZE
 - 1));

1030 
	`årštf
(
¡d”r
, "libqpŞ syÄuËabË %d b™s:Ù®ƒÁr› %lu,ƒx³ùed %g\n", 
QPOL_SYN_RULE_TABLE_BITS
, 
tÙ®_’Œ›s
,

1031 
ex³ùed_v®ue
);

1032 
	`årštf
(
¡d”r
, " mš %zd, max %zd, stddev %g\n", 
mš_™ems
, 
max_™ems
, 
¡ddev
);

1037 
”r
:

1038 ià(
pŞicy
->
ext
)

1039 
	`qpŞ_syn_ruË_bË_de¡roy
(&
pŞicy
->
ext
->
syn_ruË_bË
);

1040 
”ºo
 = 
”rÜ
;

1042 
	}
}

1048 
	$qpŞ_ex‹nded_image_de¡roy
(
qpŞ_ex‹nded_image_t
 ** 
ext
)

1050 
size_t
 
i
 = 0;

1052 ià(!
ext
 || !(*ext))

1055 
	`qpŞ_syn_ruË_bË_de¡roy
(&((*
ext
)->
syn_ruË_bË
));

1057 
i
 = 0; i < (*
ext
)->
ma¡”_li¡_sz
; i++) {

1058 
	`qpŞ_syn_ruË_de¡roy
(&((*
ext
)->
syn_ruË_ma¡”_li¡
[
i
]));

1060 
	`ä“
((*
ext
)->
syn_ruË_ma¡”_li¡
);

1062 
	`ä“
(*
ext
);

1063 *
ext
 = 
NULL
;

1064 
	}
}

1066 
	$pŞicy_ex‹nd
(
qpŞ_pŞicy_t
 * 
pŞicy
)

1068 
»tv
, 
”rÜ
;

1069 
pŞicydb_t
 *
db
 = 
NULL
;

1071 ià(
pŞicy
 =ğ
NULL
) {

1072 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

1073 
”ºo
 = 
EINVAL
;

1077 
db
 = &
pŞicy
->
p
->p;

1079 
»tv
 = 
	`qpŞ_pŞicy_»move_bogus_®Ÿ£s
(
pŞicy
);

1080 ià(
»tv
) {

1081 
”rÜ
 = 
”ºo
;

1082 
”r
;

1084 ià(
db
->
©Œ_ty³_m­
) {

1085 
»tv
 = 
	`qpŞ_pŞicy_bud_©Œs_äom_m­
(
pŞicy
);

1086 ià(
»tv
) {

1087 
”rÜ
 = 
”ºo
;

1088 
”r
;

1090 ià(
db
->
pŞicy_ty³
 =ğ
POLICY_KERN
) {

1091 
»tv
 = 
	`qpŞ_pŞicy_fl_©Œ_hŞes
(
pŞicy
);

1092 ià(
»tv
) {

1093 
”rÜ
 = 
”ºo
;

1094 
”r
;

1098 
»tv
 = 
	`qpŞ_pŞicy_add_isid_Çmes
(
pŞicy
);

1099 ià(
»tv
) {

1100 
”rÜ
 = 
”ºo
;

1101 
”r
;

1103 
»tv
 = 
	`qpŞ_pŞicy_add_objeù_r
(
pŞicy
);

1104 ià(
»tv
) {

1105 
”rÜ
 = 
”ºo
;

1106 
”r
;

1109 ià((
pŞicy
->
İtiÚs
 & 
QPOL_POLICY_OPTION_MATCH_SYSTEM
è&& 
	`qpŞ_pŞicy_m©ch_sy¡em
(policy)) {

1110 
”rÜ
 = 
”ºo
;

1111 
”r
;

1114 ià(
pŞicy
->
İtiÚs
 & 
QPOL_POLICY_OPTION_NO_RULES
)

1115  
STATUS_SUCCESS
;

1117 
»tv
 = 
	`qpŞ_pŞicy_add_cÚd_ruË_Œaûback
(
pŞicy
);

1118 ià(
»tv
) {

1119 
”rÜ
 = 
”ºo
;

1120 
”r
;

1123  
STATUS_SUCCESS
;

1125 
”r
:

1127 
	`qpŞ_ex‹nded_image_de¡roy
(&
pŞicy
->
ext
);

1128 
”ºo
 = 
”rÜ
;

1129  
STATUS_ERR
;

1130 
	}
}

1132 
	ssyn_ruË_¡©e


1134 
qpŞ_syn_ruË_node_t
 *
	mnode
;

1135 
qpŞ_syn_ruË_li¡_t
 *
	mcur
;

1136 } 
	tsyn_ruË_¡©e_t
;

1138 
	$syn_ruË_¡©e_’d
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

1140 
syn_ruË_¡©e_t
 *
¤s
 = 
NULL
;

1142 ià(!
™”
 || !(
¤s
 = 
	`qpŞ_™”©Ü_¡©e
(iter))) {

1143 
”ºo
 = 
EINVAL
;

1144  
STATUS_ERR
;

1147  (
¤s
->
cur
 ? 0 : 1);

1148 
	}
}

1150 *
	$syn_ruË_¡©e_g‘_cur
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

1152 
syn_ruË_¡©e_t
 *
¤s
 = 
NULL
;

1154 ià(!
™”
 || !(
¤s
 = 
	`qpŞ_™”©Ü_¡©e
(™”)è|| 
	`qpŞ_™”©Ü_’d
(iter)) {

1155 
”ºo
 = 
EINVAL
;

1156  
NULL
;

1159  
¤s
->
cur
->
ruË
;

1160 
	}
}

1162 
	$syn_ruË_¡©e_Ãxt
(
qpŞ_™”©Ü_t
 * 
™”
)

1164 
syn_ruË_¡©e_t
 *
¤s
 = 
NULL
;

1166 ià(!
™”
 || !(
¤s
 = 
	`qpŞ_™”©Ü_¡©e
(iter))) {

1167 
”ºo
 = 
EINVAL
;

1168  
STATUS_ERR
;

1170 ià(
	`qpŞ_™”©Ü_’d
(
™”
)) {

1171 
”ºo
 = 
ERANGE
;

1172  
STATUS_ERR
;

1175 
¤s
->
cur
 = srs->cur->
Ãxt
;

1177  
STATUS_SUCCESS
;

1178 
	}
}

1180 
size_t
 
	$syn_ruË_¡©e_size
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

1182 
size_t
 
couÁ
 = 0;

1183 
qpŞ_syn_ruË_li¡_t
 *
tmp
 = 
NULL
;

1184 
syn_ruË_¡©e_t
 *
¤s
 = 
NULL
;

1186 ià(!
™”
 || !(
¤s
 = 
	`qpŞ_™”©Ü_¡©e
(iter))) {

1187 
”ºo
 = 
EINVAL
;

1191 
tmp
 = 
¤s
->
node
->
ruËs
;mp;m°ğtmp->
Ãxt
)

1192 
couÁ
++;

1194  
couÁ
;

1195 
	}
}

1197 
	$qpŞ_avruË_g‘_syn_avruË_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_avruË
 *
ruË
, 
qpŞ_™”©Ü_t
 ** 
™”
)

1199 
qpŞ_syn_ruË_key_t
 *
key
 = 
NULL
;

1200 cÚ¡ 
qpŞ_ty³_t
 *
tmp_ty³
;

1201 cÚ¡ 
qpŞ_şass_t
 *
tmp_şass
;

1202 cÚ¡ 
qpŞ_cÚd_t
 *
tmp_cÚd
;

1203 
syn_ruË_¡©e_t
 *
¤s
 = 
NULL
;

1204 
ušt32_t
 
tmp_v®
;

1205 
”rÜ
 = 0;

1207 ià(
™”
)

1208 *
™”
 = 
NULL
;

1210 ià(!
pŞicy
 || !pŞicy->
ext
 || !
ruË
 || !
™”
) {

1211 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

1212 
”ºo
 = 
EINVAL
;

1217 ià(!(
key
 = 
	`ÿÎoc
(1, (
qpŞ_syn_ruË_key_t
)))) {

1218 
”rÜ
 = 
”ºo
;

1219 
	`ERR
(
pŞicy
, "%S", 
	`¡»¼Ü
(
”rÜ
));

1220 
”r
;

1223 ià(
	`qpŞ_avruË_g‘_ruË_ty³
(
pŞicy
, 
ruË
, &
tmp_v®
)) {

1224 
”rÜ
 = 
”ºo
;

1225 
”r
;

1227 
key
->
ruË_ty³
 = (
tmp_v®
 =ğ
QPOL_RULE_DONTAUDIT
 ? (
AVRULE_AUDITDENY
 | 
AVRULE_DONTAUDIT
) :mp_val);

1229 ià(
	`qpŞ_avruË_g‘_sourû_ty³
(
pŞicy
, 
ruË
, &
tmp_ty³
)) {

1230 
”rÜ
 = 
”ºo
;

1231 
”r
;

1233 ià(
	`qpŞ_ty³_g‘_v®ue
(
pŞicy
, 
tmp_ty³
, &
tmp_v®
)) {

1234 
”rÜ
 = 
”ºo
;

1235 
”r
;

1237 
key
->
sourû_v®
 = 
tmp_v®
;

1239 ià(
	`qpŞ_avruË_g‘_rg‘_ty³
(
pŞicy
, 
ruË
, &
tmp_ty³
)) {

1240 
”rÜ
 = 
”ºo
;

1241 
”r
;

1243 ià(
	`qpŞ_ty³_g‘_v®ue
(
pŞicy
, 
tmp_ty³
, &
tmp_v®
)) {

1244 
”rÜ
 = 
”ºo
;

1245 
”r
;

1247 
key
->
rg‘_v®
 = 
tmp_v®
;

1249 ià(
	`qpŞ_avruË_g‘_objeù_şass
(
pŞicy
, 
ruË
, &
tmp_şass
)) {

1250 
”rÜ
 = 
”ºo
;

1251 
”r
;

1253 ià(
	`qpŞ_şass_g‘_v®ue
(
pŞicy
, 
tmp_şass
, &
tmp_v®
)) {

1254 
”rÜ
 = 
”ºo
;

1255 
”r
;

1257 
key
->
şass_v®
 = 
tmp_v®
;

1259 ià(
	`qpŞ_avruË_g‘_cÚd
(
pŞicy
, 
ruË
, &
tmp_cÚd
)) {

1260 
”rÜ
 = 
”ºo
;

1261 
”r
;

1263 
key
->
cÚd
 = (
cÚd_node_t
 *è
tmp_cÚd
;

1266 ià(!(
¤s
 = 
	`ÿÎoc
(1, (
syn_ruË_¡©e_t
)))) {

1267 
”rÜ
 = 
”ºo
;

1268 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1269 
”r
;

1272 
¤s
->
node
 = 
	`qpŞ_syn_ruË_bË_fšd_node_by_key
(
pŞicy
->
ext
->
syn_ruË_bË
, 
key
);

1273 ià(!
¤s
->
node
) {

1274 
	`ERR
(
pŞicy
, "%s", "Unableo†ocate syntactic„ules for semantic‡v„ule");

1275 
”ºo
 = 
ENOENT
;

1276 
”r
;

1278 
¤s
->
cur
 = srs->
node
->
ruËs
;

1280 ià(
	`qpŞ_™”©Ü_ü—‹
(
pŞicy
, (*)
¤s
,

1281 
syn_ruË_¡©e_g‘_cur
, 
syn_ruË_¡©e_Ãxt
, 
syn_ruË_¡©e_’d
, 
syn_ruË_¡©e_size
, 
ä“
, 
™”
))

1283 
”rÜ
 = 
”ºo
;

1284 
”r
;

1287 
	`ä“
(
key
);

1291 
”r
:

1292 
	`ä“
(
key
);

1293 
	`ä“
(
¤s
);

1294 
”ºo
 = 
”rÜ
;

1296 
	}
}

1298 
	$qpŞ_‹ruË_g‘_syn_‹ruË_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_‹ruË
 *
ruË
, 
qpŞ_™”©Ü_t
 ** 
™”
)

1300 
qpŞ_syn_ruË_key_t
 *
key
 = 
NULL
;

1301 cÚ¡ 
qpŞ_ty³_t
 *
tmp_ty³
;

1302 cÚ¡ 
qpŞ_şass_t
 *
tmp_şass
;

1303 cÚ¡ 
qpŞ_cÚd_t
 *
tmp_cÚd
;

1304 
syn_ruË_¡©e_t
 *
¤s
 = 
NULL
;

1305 
ušt32_t
 
tmp_v®
;

1306 
”rÜ
 = 0;

1308 ià(
™”
)

1309 *
™”
 = 
NULL
;

1311 ià(!
pŞicy
 || !pŞicy->
ext
 || !
ruË
 || !
™”
) {

1312 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

1313 
”ºo
 = 
EINVAL
;

1318 ià(!(
key
 = 
	`ÿÎoc
(1, (
qpŞ_syn_ruË_key_t
)))) {

1319 
”rÜ
 = 
”ºo
;

1320 
	`ERR
(
pŞicy
, "%S", 
	`¡»¼Ü
(
”rÜ
));

1321 
”r
;

1324 ià(
	`qpŞ_‹ruË_g‘_ruË_ty³
(
pŞicy
, 
ruË
, &
tmp_v®
)) {

1325 
”rÜ
 = 
”ºo
;

1326 
”r
;

1328 
key
->
ruË_ty³
 = 
tmp_v®
;

1330 ià(
	`qpŞ_‹ruË_g‘_sourû_ty³
(
pŞicy
, 
ruË
, &
tmp_ty³
)) {

1331 
”rÜ
 = 
”ºo
;

1332 
”r
;

1334 ià(
	`qpŞ_ty³_g‘_v®ue
(
pŞicy
, 
tmp_ty³
, &
tmp_v®
)) {

1335 
”rÜ
 = 
”ºo
;

1336 
”r
;

1338 
key
->
sourû_v®
 = 
tmp_v®
;

1340 ià(
	`qpŞ_‹ruË_g‘_rg‘_ty³
(
pŞicy
, 
ruË
, &
tmp_ty³
)) {

1341 
”rÜ
 = 
”ºo
;

1342 
”r
;

1344 ià(
	`qpŞ_ty³_g‘_v®ue
(
pŞicy
, 
tmp_ty³
, &
tmp_v®
)) {

1345 
”rÜ
 = 
”ºo
;

1346 
”r
;

1348 
key
->
rg‘_v®
 = 
tmp_v®
;

1350 ià(
	`qpŞ_‹ruË_g‘_objeù_şass
(
pŞicy
, 
ruË
, &
tmp_şass
)) {

1351 
”rÜ
 = 
”ºo
;

1352 
”r
;

1354 ià(
	`qpŞ_şass_g‘_v®ue
(
pŞicy
, 
tmp_şass
, &
tmp_v®
)) {

1355 
”rÜ
 = 
”ºo
;

1356 
”r
;

1358 
key
->
şass_v®
 = 
tmp_v®
;

1360 ià(
	`qpŞ_‹ruË_g‘_cÚd
(
pŞicy
, 
ruË
, &
tmp_cÚd
)) {

1361 
”rÜ
 = 
”ºo
;

1362 
”r
;

1364 
key
->
cÚd
 = (
cÚd_node_t
 *è
tmp_cÚd
;

1367 ià(!(
¤s
 = 
	`ÿÎoc
(1, (
syn_ruË_¡©e_t
)))) {

1368 
”rÜ
 = 
”ºo
;

1369 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1370 
”r
;

1373 
¤s
->
node
 = 
	`qpŞ_syn_ruË_bË_fšd_node_by_key
(
pŞicy
->
ext
->
syn_ruË_bË
, 
key
);

1374 ià(!
¤s
->
node
) {

1375 
	`ERR
(
pŞicy
, "%s", "Unableo†ocate syntactic„ules for semantice„ule");

1376 
”rÜ
 = 
ENOENT
;

1377 
”r
;

1379 
¤s
->
cur
 = srs->
node
->
ruËs
;

1381 ià(
	`qpŞ_™”©Ü_ü—‹
(
pŞicy
, (*)
¤s
,

1382 
syn_ruË_¡©e_g‘_cur
, 
syn_ruË_¡©e_Ãxt
, 
syn_ruË_¡©e_’d
, 
syn_ruË_¡©e_size
, 
ä“
, 
™”
))

1384 
”rÜ
 = 
”ºo
;

1385 
”r
;

1388 
	`ä“
(
key
);

1392 
”r
:

1393 
	`ä“
(
key
);

1394 
	`ä“
(
¤s
);

1395 
”ºo
 = 
”rÜ
;

1397 
	}
}

	@libqpol/src/policy_parse.y

41 
	~<cÚfig.h
>

43 
	~<sys/ty³s.h
>

44 
	~<as£¹.h
>

45 
	~<¡d¬g.h
>

46 
	~<¡dšt.h
>

47 
	~<¡dio.h
>

48 
	~<¡dlib.h
>

49 
	~<¡ršg.h
>

50 
	~<sys/sock‘.h
>

51 
	~<Ãtš‘/š.h
>

52 
	~<¬·/š‘.h
>

53 
	~<¡dlib.h
>

55 
	~<£pŞ/pŞicydb/ex·nd.h
>

56 
	~<£pŞ/pŞicydb/pŞicydb.h
>

57 
	~<£pŞ/pŞicydb/£rviûs.h
>

58 
	~<£pŞ/pŞicydb/cÚd™iÚ®.h
>

59 
	~<£pŞ/pŞicydb/æask.h
>

60 
	~<£pŞ/pŞicydb/h›¿rchy.h
>

62 #ifdeà
HAVE_SEPOL_POLICYCAPS


63 
	~<£pŞ/pŞicydb/pŞÿps.h
>

66 
	~"queue.h
"

69 
	~<qpŞ/pŞicy.h
>

71 
	~"moduË_comp”.h
"

72 
	~"pŞicy_defše.h
"

74 
pŞicydb_t
 *
pŞicydbp
;

75 
·ss
;

77 
yy‹xt
[];

78 
yyËx
();

79 
yyw¬n
(*
msg
);

80 
yy”rÜ
(*
msg
);

82 (* 
	g»quœe_func_t
)();

87 
qpŞ_¤c_šput
[];

88 *
qpŞ_¤c_špuŒ
;

89 *
qpŞ_¤c_špuim
;

94 
v®
;

95 
ušŒ_t
 
v®±r
;

96 *
±r
;

97 
»quœe_func_t
 
»quœe_func
;

100 %
ty³
 <
±r
> 
cÚd_ex´
 
cÚd_ex´_´im
 
cÚd_pŞ_li¡
 
cÚd_–£


101 %
ty³
 <
±r
> 
cÚd_®low_def
 
cÚd_aud™®low_def
 
cÚd_aud™d’y_def
 
cÚd_dÚud™_def


102 %
ty³
 <
±r
> 
cÚd_Œªs™iÚ_def
 
cÚd_‹_avb_def
 
cÚd_ruË_def


103 %
ty³
 <
±r
> 
rŞe_def
 
rŞes


104 %
ty³
 <
v®±r
> 
ûx´
 
ûx´_´im
 
İ
 
rŞe_mls_İ


105 %
ty³
 <
v®
> 
v4_addr_def
 
numb”


106 %
ty³
 <
»quœe_func
> 
»quœe_deş_def


108 %
tok’
 
PATH


109 %
tok’
 
FILENAME


110 %
tok’
 
CLONE


111 %
tok’
 
COMMON


112 %
tok’
 
CLASS


113 %
tok’
 
CONSTRAIN


114 %
tok’
 
VALIDATETRANS


115 %
tok’
 
INHERITS


116 %
tok’
 
SID


117 %
tok’
 
ROLE


118 %
tok’
 
ROLEATTRIBUTE


119 %
tok’
 
ATTRIBUTE_ROLE


120 %
tok’
 
ROLES


121 %
tok’
 
TYPEALIAS


122 %
tok’
 
TYPEATTRIBUTE


123 %
tok’
 
TYPEBOUNDS


124 %
tok’
 
TYPE


125 %
tok’
 
TYPES


126 %
tok’
 
ALIAS


127 %
tok’
 
ATTRIBUTE


128 %
tok’
 
BOOL


129 %
tok’
 
TUNABLE


130 %
tok’
 
IF


131 %
tok’
 
ELSE


132 %
tok’
 
TYPE_TRANSITION


133 %
tok’
 
TYPE_MEMBER


134 %
tok’
 
TYPE_CHANGE


135 %
tok’
 
ROLE_TRANSITION


136 %
tok’
 
RANGE_TRANSITION


137 %
tok’
 
SENSITIVITY


138 %
tok’
 
DOMINANCE


139 %
tok’
 
DOM
 
DOMBY
 
INCOMP


140 %
tok’
 
CATEGORY


141 %
tok’
 
LEVEL


142 %
tok’
 
RANGE


143 %
tok’
 
MLSCONSTRAIN


144 %
tok’
 
MLSVALIDATETRANS


145 %
tok’
 
USER


146 %
tok’
 
NEVERALLOW


147 %
tok’
 
ALLOW


148 %
tok’
 
AUDITALLOW


149 %
tok’
 
AUDITDENY


150 %
tok’
 
DONTAUDIT


151 %
tok’
 
SOURCE


152 %
tok’
 
TARGET


153 %
tok’
 
SAMEUSER


154 %
tok’
 
FSCON
 
PORTCON
 
NETIFCON
 
NODECON


155 %
tok’
 
PIRQCON
 
IOMEMCON
 
IOPORTCON
 
PCIDEVICECON


156 %
tok’
 
FSUSEXATTR
 
FSUSETASK
 
FSUSETRANS
 
FSUSEPSID


157 %
tok’
 
GENFSCON


158 %
tok’
 
U1
 
U2
 
U3
 
R1
 
R2
 
R3
 
T1
 
T2
 
T3
 
L1
 
L2
 
H1
 
H2


159 %
tok’
 
NOT
 
AND
 
OR
 
XOR


160 %
tok’
 
CTRUE
 
CFALSE


161 %
tok’
 
IDENTIFIER


162 %
tok’
 
NUMBER


163 %
tok’
 
EQUALS


164 %
tok’
 
NOTEQUAL


165 %
tok’
 
IPV4_ADDR


166 %
tok’
 
IPV6_ADDR


167 %
tok’
 
MODULE
 
VERSION_IDENTIFIER
 
REQUIRE
 
OPTIONAL


168 %
tok’
 
POLICYCAP


169 %
tok’
 
PERMISSIVE


170 %
tok’
 
FILESYSTEM


171 %
tok’
 
DEFAULT_USER
 
DEFAULT_ROLE
 
DEFAULT_TYPE
 
DEFAULT_RANGE


172 %
tok’
 
LOW_HIGH
 
LOW
 
HIGH


174 %
Ëá
 
OR


175 %
Ëá
 
XOR


176 %
Ëá
 
AND


177 %
right
 
NOT


178 %
Ëá
 
EQUALS
 
NOTEQUAL


179 %% /* 
	$yy·r£
 */ 
	`yyËx
()

180 
pŞicy
 : 
ba£_pŞicy


181 | 
moduË_pŞicy


183 
ba£_pŞicy
 : { ià(
	`defše_pŞicy
(
·ss
, 0) == -1)  -1; }

184 
şas£s
 
š™Ÿl_sids
 
acûss_veùÜs


185 { ià(
·ss
 =ğ1è{ ià(
	`pŞicydb_šdex_şas£s
(
pŞicydbp
))  -1; }

186 ià(
·ss
 =ğ2è{ ià(
	`pŞicydb_šdex_Ùh”s
(
NULL
, 
pŞicydbp
, 0))  -1; }}

187 
İt_deçuÉ_ruËs
 
İt_mls
 
‹_rbac
 
u£rs
 
İt_cÚ¡¿šts


188 { ià(
·ss
 =ğ1è{ ià(
	`pŞicydb_šdex_boŞs
(
pŞicydbp
))  -1;}

189 ià(
·ss
 =ğ2è{ ià(
	`pŞicydb_šdex_Ùh”s
(
NULL
, 
pŞicydbp
, 0))  -1;}}

190 
š™Ÿl_sid_cÚ‹xts
 
İt_fs_cÚ‹xts
 
İt_fs_u£s
 
İt_g’fs_cÚ‹xts
 
Ãt_cÚ‹xts
 
İt_dev_cÚ‹xts


192 
şas£s
 : 
şass_def


193 | 
şas£s
 
şass_def


195 
şass_def
 : 
CLASS
 
id’tif›r


196 {ià(
	`defše_şass
())  -1;}

198 
š™Ÿl_sids
 : 
š™Ÿl_sid_def


199 | 
š™Ÿl_sids
 
š™Ÿl_sid_def


201 
š™Ÿl_sid_def
 : 
SID
 
id’tif›r


202 {ià(
	`defše_š™Ÿl_sid
())  -1;}

204 
acûss_veùÜs
 : 
İt_commÚ_³rms
 
av_³rms


206 
İt_commÚ_³rms
 : 
commÚ_³rms


209 
commÚ_³rms
 : 
commÚ_³rms_def


210 | 
commÚ_³rms
 
commÚ_³rms_def


212 
commÚ_³rms_def
 : 
COMMON
 
id’tif›r
 '{' 
id’tif›r_li¡
 '}'

213 {ià(
	`defše_commÚ_³rms
())  -1;}

215 
av_³rms
 : 
av_³rms_def


216 | 
av_³rms
 
av_³rms_def


218 
av_³rms_def
 : 
CLASS
 
id’tif›r
 '{' 
id’tif›r_li¡
 '}'

219 {ià(
	`defše_av_³rms
(
FALSE
))  -1;}

220 | 
CLASS
 
id’tif›r
 
INHERITS
 identifier

221 {ià(
	`defše_av_³rms
(
TRUE
))  -1;}

222 | 
CLASS
 
id’tif›r
 
INHERITS
 id’tif›¸'{' 
id’tif›r_li¡
 '}'

223 {ià(
	`defše_av_³rms
(
TRUE
))  -1;}

225 
İt_deçuÉ_ruËs
 : 
deçuÉ_ruËs


228 
deçuÉ_ruËs
 : 
deçuÉ_u£r_def


229 | 
deçuÉ_rŞe_def


230 | 
deçuÉ_ty³_def


231 | 
deçuÉ_¿nge_def


232 | 
deçuÉ_ruËs
 
deçuÉ_u£r_def


233 | 
deçuÉ_ruËs
 
deçuÉ_rŞe_def


234 | 
deçuÉ_ruËs
 
deçuÉ_ty³_def


235 | 
deçuÉ_ruËs
 
deçuÉ_¿nge_def


237 
deçuÉ_u£r_def
 : 
DEFAULT_USER
 
Çmes
 
SOURCE
 ';'

238 {ià(
	`defše_deçuÉ_u£r
(
DEFAULT_SOURCE
))  -1; }

239 | 
DEFAULT_USER
 
Çmes
 
TARGET
 ';'

240 {ià(
	`defše_deçuÉ_u£r
(
DEFAULT_TARGET
))  -1; }

242 
deçuÉ_rŞe_def
 : 
DEFAULT_ROLE
 
Çmes
 
SOURCE
 ';'

243 {ià(
	`defše_deçuÉ_rŞe
(
DEFAULT_SOURCE
))  -1; }

244 | 
DEFAULT_ROLE
 
Çmes
 
TARGET
 ';'

245 {ià(
	`defše_deçuÉ_rŞe
(
DEFAULT_TARGET
))  -1; }

247 
deçuÉ_ty³_def
 : 
DEFAULT_TYPE
 
Çmes
 
SOURCE
 ';'

248 {ià(
	`defše_deçuÉ_ty³
(
DEFAULT_SOURCE
))  -1; }

249 | 
DEFAULT_TYPE
 
Çmes
 
TARGET
 ';'

250 {ià(
	`defše_deçuÉ_ty³
(
DEFAULT_TARGET
))  -1; }

252 
deçuÉ_¿nge_def
 : 
DEFAULT_RANGE
 
Çmes
 
SOURCE
 
LOW
 ';'

253 {ià(
	`defše_deçuÉ_¿nge
(
DEFAULT_SOURCE_LOW
))  -1; }

254 | 
DEFAULT_RANGE
 
Çmes
 
SOURCE
 
HIGH
 ';'

255 {ià(
	`defše_deçuÉ_¿nge
(
DEFAULT_SOURCE_HIGH
))  -1; }

256 | 
DEFAULT_RANGE
 
Çmes
 
SOURCE
 
LOW_HIGH
 ';'

257 {ià(
	`defše_deçuÉ_¿nge
(
DEFAULT_SOURCE_LOW_HIGH
))  -1; }

258 | 
DEFAULT_RANGE
 
Çmes
 
TARGET
 
LOW
 ';'

259 {ià(
	`defše_deçuÉ_¿nge
(
DEFAULT_TARGET_LOW
))  -1; }

260 | 
DEFAULT_RANGE
 
Çmes
 
TARGET
 
HIGH
 ';'

261 {ià(
	`defše_deçuÉ_¿nge
(
DEFAULT_TARGET_HIGH
))  -1; }

262 | 
DEFAULT_RANGE
 
Çmes
 
TARGET
 
LOW_HIGH
 ';'

263 {ià(
	`defše_deçuÉ_¿nge
(
DEFAULT_TARGET_LOW_HIGH
))  -1; }

265 
İt_mls
 : 
mls


268 
mls
 : 
£ns™iv™›s
 
domšªû
 
İt_ÿ‹gÜ›s
 
Ëv–s
 
ml¥Şicy


270 
£ns™iv™›s
 : 
£ns™iv™y_def


271 | 
£ns™iv™›s
 
£ns™iv™y_def


281 
£ns™iv™y_def
 : 
SENSITIVITY
 
id’tif›r
 
®Ÿs_def
 ';'

282 {ià(
	`defše_mls
(è| 
	`defše_£ns
())  -1;}

283 | 
SENSITIVITY
 
id’tif›r
 ';'

284 {ià(
	`defše_mls
(è| 
	`defše_£ns
())  -1;}

286 
®Ÿs_def
 : 
ALIAS
 
Çmes


288 
domšªû
 : 
DOMINANCE
 
id’tif›r


289 {ià(
	`defše_domšªû
())  -1;}

290 | 
DOMINANCE
 '{' 
id’tif›r_li¡
 '}'

291 {ià(
	`defše_domšªû
())  -1;}

293 
İt_ÿ‹gÜ›s
 : 
ÿ‹gÜ›s


296 
ÿ‹gÜ›s
 : 
ÿ‹gÜy_def


297 | 
ÿ‹gÜ›s
 
ÿ‹gÜy_def


299 
ÿ‹gÜy_def
 : 
CATEGORY
 
id’tif›r
 
®Ÿs_def
 ';'

300 {ià(
	`defše_ÿ‹gÜy
())  -1;}

301 | 
CATEGORY
 
id’tif›r
 ';'

302 {ià(
	`defše_ÿ‹gÜy
())  -1;}

304 
Ëv–s
 : 
Ëv–_def


305 | 
Ëv–s
 
Ëv–_def


307 
Ëv–_def
 : 
LEVEL
 
id’tif›r
 ':' 
id_comma_li¡
 ';'

308 {ià(
	`defše_Ëv–
())  -1;}

309 | 
LEVEL
 
id’tif›r
 ';'

310 {ià(
	`defše_Ëv–
())  -1;}

312 
ml¥Şicy
 : 
ml¥Şicy_deş


313 | 
ml¥Şicy
 
ml¥Şicy_deş


315 
ml¥Şicy_deş
 : 
mlscÚ¡¿št_def


316 | 
mlsv®id©‘¿ns_def


318 
mlscÚ¡¿št_def
 : 
MLSCONSTRAIN
 
Çmes
‚ame 
ûx´
 ';'

319 { ià(
	`defše_cÚ¡¿št
((
cÚ¡¿št_ex´_t
*)
$4
))  -1; }

321 
mlsv®id©‘¿ns_def
 : 
MLSVALIDATETRANS
 
Çmes
 
ûx´
 ';'

322 { ià(
	`defše_v®id©‘¿ns
((
cÚ¡¿št_ex´_t
*)
$3
))  -1; }

324 
‹_rbac
 : 
‹_rbac_deş


325 | 
‹_rbac
 
‹_rbac_deş


327 
‹_rbac_deş
 : 
‹_deş


328 | 
rbac_deş


329 | 
cÚd_¡mt_def


330 | 
İtiÚ®_block


331 | 
pŞicyÿp_def


334 
rbac_deş
 : 
©Œibu‹_rŞe_def


335 | 
rŞe_ty³_def


336 | 
rŞe_domšªû


337 | 
rŞe_Œªs_def


338 | 
rŞe_®low_def


339 | 
rŞ—‰ribu‹_def


340 | 
rŞe_©Œ_def


342 
‹_deş
 : 
©Œibu‹_def


343 | 
ty³_def


344 | 
ty³®Ÿs_def


345 | 
ty³©Œibu‹_def


346 | 
ty³bounds_def


347 | 
boŞ_def


348 | 
tuÇbË_def


349 | 
Œªs™iÚ_def


350 | 
¿nge_Œªs_def


351 | 
‹_avb_def


352 | 
³rmissive_def


354 
©Œibu‹_def
 : 
ATTRIBUTE
 
id’tif›r
 ';'

355 { ià(
	`defše_©Œib
())  -1;}

357 
ty³_def
 : 
TYPE
 
id’tif›r
 
®Ÿs_def
 
İt_©Œ_li¡
 ';'

358 {ià(
	`defše_ty³
(1))  -1;}

359 | 
TYPE
 
id’tif›r
 
İt_©Œ_li¡
 ';'

360 {ià(
	`defše_ty³
(0))  -1;}

362 
ty³®Ÿs_def
 : 
TYPEALIAS
 
id’tif›r
 
®Ÿs_def
 ';'

363 {ià(
	`defše_ty³®Ÿs
())  -1;}

365 
ty³©Œibu‹_def
 : 
TYPEATTRIBUTE
 
id’tif›r
 
id_comma_li¡
 ';'

366 {ià(
	`defše_ty³©Œibu‹
())  -1;}

368 
ty³bounds_def
 : 
TYPEBOUNDS
 
id’tif›r
 
id_comma_li¡
 ';'

369 {ià(
	`defše_ty³bounds
())  -1;}

371 
İt_©Œ_li¡
 : ',' 
id_comma_li¡


374 
boŞ_def
 : 
BOOL
 
id’tif›r
 
boŞ_v®
 ';'

375 { ià(
	`defše_boŞ_tuÇbË
(0))  -1; }

377 
tuÇbË_def
 : 
TUNABLE
 
id’tif›r
 
boŞ_v®
 ';'

378 { ià(
	`defše_boŞ_tuÇbË
(1))  -1; }

380 
boŞ_v®
 : 
CTRUE


381 { ià(
	`š£¹_id
("T",0))  -1; }

382 | 
CFALSE


383 { ià(
	`š£¹_id
("F",0))  -1; }

385 
cÚd_¡mt_def
 : 
IF
 
cÚd_ex´
 '{' 
cÚd_pŞ_li¡
 '}' 
cÚd_–£


386 { ià(
·ss
 =ğ2è{ ià(
	`defše_cÚd™iÚ®
((
cÚd_ex´_t
*)
$2
, (
avruË_t
*)
$4
, (avruË_t*)
$6
) < 0)  -1; }}

388 
cÚd_–£
 : 
ELSE
 '{' 
cÚd_pŞ_li¡
 '}'

389 { 
$$
 = 
$3
; }

391 { 
$$
 = 
NULL
; }

392 
cÚd_ex´
 : '(' cond_expr ')'

393 { 
$$
 = 
$2
;}

394 | 
NOT
 
cÚd_ex´


395 { 
$$
 = 
	`defše_cÚd_ex´
(
COND_NOT
, 
$2
, 0);

396 ià(
$$
 == 0)  -1; }

397 | 
cÚd_ex´
 
AND
 cond_expr

398 { 
$$
 = 
	`defše_cÚd_ex´
(
COND_AND
, 
$1
, 
$3
);

399 ià(
$$
 == 0)  -1; }

400 | 
cÚd_ex´
 
OR
 cond_expr

401 { 
$$
 = 
	`defše_cÚd_ex´
(
COND_OR
, 
$1
, 
$3
);

402 ià(
$$
 == 0)  -1; }

403 | 
cÚd_ex´
 
XOR
 cond_expr

404 { 
$$
 = 
	`defše_cÚd_ex´
(
COND_XOR
, 
$1
, 
$3
);

405 ià(
$$
 == 0)  -1; }

406 | 
cÚd_ex´
 
EQUALS
 cond_expr

407 { 
$$
 = 
	`defše_cÚd_ex´
(
COND_EQ
, 
$1
, 
$3
);

408 ià(
$$
 == 0)  -1; }

409 | 
cÚd_ex´
 
NOTEQUAL
 cond_expr

410 { 
$$
 = 
	`defše_cÚd_ex´
(
COND_NEQ
, 
$1
, 
$3
);

411 ià(
$$
 == 0)  -1; }

412 | 
cÚd_ex´_´im


413 { 
$$
 = 
$1
; }

415 
cÚd_ex´_´im
 : 
id’tif›r


416 { 
$$
 = 
	`defše_cÚd_ex´
(
COND_BOOL
,0, 0);

417 ià(
$$
 =ğ
COND_ERR
)  -1; }

419 
cÚd_pŞ_li¡
 : cÚd_pŞ_li¡ 
cÚd_ruË_def


420 { 
$$
 = 
	`defše_cÚd_pŞ_li¡
((
avruË_t
 *)
$1
, (avruË_ˆ*)
$2
); }

422 { 
$$
 = 
NULL
; }

424 
cÚd_ruË_def
 : 
cÚd_Œªs™iÚ_def


425 { 
$$
 = 
$1
; }

426 | 
cÚd_‹_avb_def


427 { 
$$
 = 
$1
; }

428 | 
»quœe_block


429 { 
$$
 = 
NULL
; }

431 
cÚd_Œªs™iÚ_def
 : 
TYPE_TRANSITION
 
Çmes
‚ame ':'‚ame 
id’tif›r
 
f’ame
 ';'

432 { 
$$
 = 
	`defše_cÚd_f’ame_Œªs
() ;

433 ià(
$$
 =ğ
COND_ERR
)  -1;}

434 | 
TYPE_TRANSITION
 
Çmes
‚ame ':'‚ame 
id’tif›r
 ';'

435 { 
$$
 = 
	`defše_cÚd_compu‹_ty³
(
AVRULE_TRANSITION
) ;

436 ià(
$$
 =ğ
COND_ERR
)  -1;}

437 | 
TYPE_MEMBER
 
Çmes
‚ame ':'‚ame 
id’tif›r
 ';'

438 { 
$$
 = 
	`defše_cÚd_compu‹_ty³
(
AVRULE_MEMBER
) ;

439 ià(
$$
 =ğ
COND_ERR
)  -1;}

440 | 
TYPE_CHANGE
 
Çmes
‚ame ':'‚ame 
id’tif›r
 ';'

441 { 
$$
 = 
	`defše_cÚd_compu‹_ty³
(
AVRULE_CHANGE
) ;

442 ià(
$$
 =ğ
COND_ERR
)  -1;}

444 
cÚd_‹_avb_def
 : 
cÚd_®low_def


445 { 
$$
 = 
$1
; }

446 | 
cÚd_aud™®low_def


447 { 
$$
 = 
$1
; }

448 | 
cÚd_aud™d’y_def


449 { 
$$
 = 
$1
; }

450 | 
cÚd_dÚud™_def


451 { 
$$
 = 
$1
; }

453 
cÚd_®low_def
 : 
ALLOW
 
Çmes
‚ames ':'‚ames‚ames ';'

454 { 
$$
 = 
	`defše_cÚd_‹_avb
(
AVRULE_ALLOWED
) ;

455 ià(
$$
 =ğ
COND_ERR
)  -1; }

457 
cÚd_aud™®low_def
 : 
AUDITALLOW
 
Çmes
‚ames ':'‚ames‚ames ';'

458 { 
$$
 = 
	`defše_cÚd_‹_avb
(
AVRULE_AUDITALLOW
) ;

459 ià(
$$
 =ğ
COND_ERR
)  -1; }

461 
cÚd_aud™d’y_def
 : 
AUDITDENY
 
Çmes
‚ames ':'‚ames‚ames ';'

462 { 
$$
 = 
	`defše_cÚd_‹_avb
(
AVRULE_AUDITDENY
) ;

463 ià(
$$
 =ğ
COND_ERR
)  -1; }

465 
cÚd_dÚud™_def
 : 
DONTAUDIT
 
Çmes
‚ames ':'‚ames‚ames ';'

466 { 
$$
 = 
	`defše_cÚd_‹_avb
(
AVRULE_DONTAUDIT
);

467 ià(
$$
 =ğ
COND_ERR
)  -1; }

470 
Œªs™iÚ_def
 : 
TYPE_TRANSITION
 
Çmes
‚ame ':'‚ame 
id’tif›r
 
f’ame
 ';'

471 {ià(
	`defše_f’ame_Œªs
())  -1; }

472 | 
TYPE_TRANSITION
 
Çmes
‚ame ':'‚ame 
id’tif›r
 ';'

473 {ià(
	`defše_compu‹_ty³
(
AVRULE_TRANSITION
))  -1;}

474 | 
TYPE_MEMBER
 
Çmes
‚ame ':'‚ame 
id’tif›r
 ';'

475 {ià(
	`defše_compu‹_ty³
(
AVRULE_MEMBER
))  -1;}

476 | 
TYPE_CHANGE
 
Çmes
‚ame ':'‚ame 
id’tif›r
 ';'

477 {ià(
	`defše_compu‹_ty³
(
AVRULE_CHANGE
))  -1;}

479 
¿nge_Œªs_def
 : 
RANGE_TRANSITION
 
Çmes
‚ame 
mls_¿nge_def
 ';'

480 { ià(
	`defše_¿nge_Œªs
(0))  -1; }

481 | 
RANGE_TRANSITION
 
Çmes
‚ame ':'‚ame 
mls_¿nge_def
 ';'

482 { ià(
	`defše_¿nge_Œªs
(1))  -1; }

484 
‹_avb_def
 : 
®low_def


485 | 
aud™®low_def


486 | 
aud™d’y_def


487 | 
dÚud™_def


488 | 
Ãv”®low_def


490 
®low_def
 : 
ALLOW
 
Çmes
‚ames ':'‚ames‚ames ';'

491 {ià(
	`defše_‹_avb
(
AVRULE_ALLOWED
))  -1; }

493 
aud™®low_def
 : 
AUDITALLOW
 
Çmes
‚ames ':'‚ames‚ames ';'

494 {ià(
	`defše_‹_avb
(
AVRULE_AUDITALLOW
))  -1; }

496 
aud™d’y_def
 : 
AUDITDENY
 
Çmes
‚ames ':'‚ames‚ames ';'

497 {ià(
	`defše_‹_avb
(
AVRULE_AUDITDENY
))  -1; }

499 
dÚud™_def
 : 
DONTAUDIT
 
Çmes
‚ames ':'‚ames‚ames ';'

500 {ià(
	`defše_‹_avb
(
AVRULE_DONTAUDIT
))  -1; }

502 
Ãv”®low_def
 : 
NEVERALLOW
 
Çmes
‚ames ':'‚ames‚ames ';'

503 {ià(
	`defše_‹_avb
(
AVRULE_NEVERALLOW
))  -1; }

505 
©Œibu‹_rŞe_def
 : 
ATTRIBUTE_ROLE
 
id’tif›r
 ';'

506 {ià(
	`defše_©Œib_rŞe
())  -1; }

508 
rŞe_ty³_def
 : 
ROLE
 
id’tif›r
 
TYPES
 
Çmes
 ';'

509 {ià(
	`defše_rŞe_ty³s
())  -1;}

511 
rŞe_©Œ_def
 : 
ROLE
 
id’tif›r
 
İt_©Œ_li¡
 ';'

512 {ià(
	`defše_rŞe_©Œ
())  -1;}

514 
rŞe_domšªû
 : 
DOMINANCE
 '{' 
rŞes
 '}'

516 
rŞe_Œªs_def
 : 
ROLE_TRANSITION
 
Çmes
‚ame 
id’tif›r
 ';'

517 {ià(
	`defše_rŞe_Œªs
(0))  -1; }

518 | 
ROLE_TRANSITION
 
Çmes
‚ame ':'‚ame 
id’tif›r
 ';'

519 {ià(
	`defše_rŞe_Œªs
(1))  -1;}

521 
rŞe_®low_def
 : 
ALLOW
 
Çmes
‚ames ';'

522 {ià(
	`defše_rŞe_®low
())  -1; }

524 
rŞes
 : 
rŞe_def


525 { 
$$
 = 
$1
; }

526 | 
rŞes
 
rŞe_def


527 { 
$$
 = 
	`m”ge_rŞes_dom
((
rŞe_d©um_t
*)
$1
, (rŞe_d©um_t*)
$2
); if ($$ == 0)  -1;}

529 
rŞe_def
 : 
ROLE
 
id’tif›r_push
 ';'

530 {
$$
 = 
	`defše_rŞe_dom
(
NULL
); if ($$ == 0)  -1;}

531 | 
ROLE
 
id’tif›r_push
 '{' 
rŞes
 '}'

532 {
$$
 = 
	`defše_rŞe_dom
((
rŞe_d©um_t
*)
$4
); if ($$ == 0)  -1;}

534 
rŞ—‰ribu‹_def
 : 
ROLEATTRIBUTE
 
id’tif›r
 
id_comma_li¡
 ';'

535 {ià(
	`defše_rŞ—‰ribu‹
())  -1;}

537 
İt_cÚ¡¿šts
 : 
cÚ¡¿šts


540 
cÚ¡¿šts
 : 
cÚ¡¿št_deş


541 | 
cÚ¡¿šts
 
cÚ¡¿št_deş


543 
cÚ¡¿št_deş
 : 
cÚ¡¿št_def


544 | 
v®id©‘¿ns_def


546 
cÚ¡¿št_def
 : 
CONSTRAIN
 
Çmes
‚ame 
ûx´
 ';'

547 { ià(
	`defše_cÚ¡¿št
((
cÚ¡¿št_ex´_t
*)
$4
))  -1; }

549 
v®id©‘¿ns_def
 : 
VALIDATETRANS
 
Çmes
 
ûx´
 ';'

550 { ià(
	`defše_v®id©‘¿ns
((
cÚ¡¿št_ex´_t
*)
$3
))  -1; }

552 
ûx´
 : '(' cexpr ')'

553 { 
$$
 = 
$2
; }

554 | 
NOT
 
ûx´


555 { 
$$
 = 
	`defše_ûx´
(
CEXPR_NOT
, 
$2
, 0);

556 ià(
$$
 == 0)  -1; }

557 | 
ûx´
 
AND
 cexpr

558 { 
$$
 = 
	`defše_ûx´
(
CEXPR_AND
, 
$1
, 
$3
);

559 ià(
$$
 == 0)  -1; }

560 | 
ûx´
 
OR
 cexpr

561 { 
$$
 = 
	`defše_ûx´
(
CEXPR_OR
, 
$1
, 
$3
);

562 ià(
$$
 == 0)  -1; }

563 | 
ûx´_´im


564 { 
$$
 = 
$1
; }

566 
ûx´_´im
 : 
U1
 
İ
 
U2


567 { 
$$
 = 
	`defše_ûx´
(
CEXPR_ATTR
, 
CEXPR_USER
, 
$2
);

568 ià(
$$
 == 0)  -1; }

569 | 
R1
 
rŞe_mls_İ
 
R2


570 { 
$$
 = 
	`defše_ûx´
(
CEXPR_ATTR
, 
CEXPR_ROLE
, 
$2
);

571 ià(
$$
 == 0)  -1; }

572 | 
T1
 
İ
 
T2


573 { 
$$
 = 
	`defše_ûx´
(
CEXPR_ATTR
, 
CEXPR_TYPE
, 
$2
);

574 ià(
$$
 == 0)  -1; }

575 | 
U1
 
İ
 { ià(
	`š£¹_£·¿tÜ
(1)è -1; } 
Çmes_push


576 { 
$$
 = 
	`defše_ûx´
(
CEXPR_NAMES
, 
CEXPR_USER
, 
$2
);

577 ià(
$$
 == 0)  -1; }

578 | 
U2
 
İ
 { ià(
	`š£¹_£·¿tÜ
(1)è -1; } 
Çmes_push


579 { 
$$
 = 
	`defše_ûx´
(
CEXPR_NAMES
, (
CEXPR_USER
 | 
CEXPR_TARGET
), 
$2
);

580 ià(
$$
 == 0)  -1; }

581 | 
U3
 
İ
 { ià(
	`š£¹_£·¿tÜ
(1)è -1; } 
Çmes_push


582 { 
$$
 = 
	`defše_ûx´
(
CEXPR_NAMES
, (
CEXPR_USER
 | 
CEXPR_XTARGET
), 
$2
);

583 ià(
$$
 == 0)  -1; }

584 | 
R1
 
İ
 { ià(
	`š£¹_£·¿tÜ
(1)è -1; } 
Çmes_push


585 { 
$$
 = 
	`defše_ûx´
(
CEXPR_NAMES
, 
CEXPR_ROLE
, 
$2
);

586 ià(
$$
 == 0)  -1; }

587 | 
R2
 
İ
 { ià(
	`š£¹_£·¿tÜ
(1)è -1; } 
Çmes_push


588 { 
$$
 = 
	`defše_ûx´
(
CEXPR_NAMES
, (
CEXPR_ROLE
 | 
CEXPR_TARGET
), 
$2
);

589 ià(
$$
 == 0)  -1; }

590 | 
R3
 
İ
 { ià(
	`š£¹_£·¿tÜ
(1)è -1; } 
Çmes_push


591 { 
$$
 = 
	`defše_ûx´
(
CEXPR_NAMES
, (
CEXPR_ROLE
 | 
CEXPR_XTARGET
), 
$2
);

592 ià(
$$
 == 0)  -1; }

593 | 
T1
 
İ
 { ià(
	`š£¹_£·¿tÜ
(1)è -1; } 
Çmes_push


594 { 
$$
 = 
	`defše_ûx´
(
CEXPR_NAMES
, 
CEXPR_TYPE
, 
$2
);

595 ià(
$$
 == 0)  -1; }

596 | 
T2
 
İ
 { ià(
	`š£¹_£·¿tÜ
(1)è -1; } 
Çmes_push


597 { 
$$
 = 
	`defše_ûx´
(
CEXPR_NAMES
, (
CEXPR_TYPE
 | 
CEXPR_TARGET
), 
$2
);

598 ià(
$$
 == 0)  -1; }

599 | 
T3
 
İ
 { ià(
	`š£¹_£·¿tÜ
(1)è -1; } 
Çmes_push


600 { 
$$
 = 
	`defše_ûx´
(
CEXPR_NAMES
, (
CEXPR_TYPE
 | 
CEXPR_XTARGET
), 
$2
);

601 ià(
$$
 == 0)  -1; }

602 | 
SAMEUSER


603 { 
$$
 = 
	`defše_ûx´
(
CEXPR_ATTR
, 
CEXPR_USER
, 
CEXPR_EQ
);

604 ià(
$$
 == 0)  -1; }

605 | 
SOURCE
 
ROLE
 { ià(
	`š£¹_£·¿tÜ
(1)è -1; } 
Çmes_push


606 { 
$$
 = 
	`defše_ûx´
(
CEXPR_NAMES
, 
CEXPR_ROLE
, 
CEXPR_EQ
);

607 ià(
$$
 == 0)  -1; }

608 | 
TARGET
 
ROLE
 { ià(
	`š£¹_£·¿tÜ
(1)è -1; } 
Çmes_push


609 { 
$$
 = 
	`defše_ûx´
(
CEXPR_NAMES
, (
CEXPR_ROLE
 | 
CEXPR_TARGET
), 
CEXPR_EQ
);

610 ià(
$$
 == 0)  -1; }

611 | 
ROLE
 
rŞe_mls_İ


612 { 
$$
 = 
	`defše_ûx´
(
CEXPR_ATTR
, 
CEXPR_ROLE
, 
$2
);

613 ià(
$$
 == 0)  -1; }

614 | 
SOURCE
 
TYPE
 { ià(
	`š£¹_£·¿tÜ
(1)è -1; } 
Çmes_push


615 { 
$$
 = 
	`defše_ûx´
(
CEXPR_NAMES
, 
CEXPR_TYPE
, 
CEXPR_EQ
);

616 ià(
$$
 == 0)  -1; }

617 | 
TARGET
 
TYPE
 { ià(
	`š£¹_£·¿tÜ
(1)è -1; } 
Çmes_push


618 { 
$$
 = 
	`defše_ûx´
(
CEXPR_NAMES
, (
CEXPR_TYPE
 | 
CEXPR_TARGET
), 
CEXPR_EQ
);

619 ià(
$$
 == 0)  -1; }

620 | 
L1
 
rŞe_mls_İ
 
L2


621 { 
$$
 = 
	`defše_ûx´
(
CEXPR_ATTR
, 
CEXPR_L1L2
, 
$2
);

622 ià(
$$
 == 0)  -1; }

623 | 
L1
 
rŞe_mls_İ
 
H2


624 { 
$$
 = 
	`defše_ûx´
(
CEXPR_ATTR
, 
CEXPR_L1H2
, 
$2
);

625 ià(
$$
 == 0)  -1; }

626 | 
H1
 
rŞe_mls_İ
 
L2


627 { 
$$
 = 
	`defše_ûx´
(
CEXPR_ATTR
, 
CEXPR_H1L2
, 
$2
);

628 ià(
$$
 == 0)  -1; }

629 | 
H1
 
rŞe_mls_İ
 
H2


630 { 
$$
 = 
	`defše_ûx´
(
CEXPR_ATTR
, 
CEXPR_H1H2
, 
$2
);

631 ià(
$$
 == 0)  -1; }

632 | 
L1
 
rŞe_mls_İ
 
H1


633 { 
$$
 = 
	`defše_ûx´
(
CEXPR_ATTR
, 
CEXPR_L1H1
, 
$2
);

634 ià(
$$
 == 0)  -1; }

635 | 
L2
 
rŞe_mls_İ
 
H2


636 { 
$$
 = 
	`defše_ûx´
(
CEXPR_ATTR
, 
CEXPR_L2H2
, 
$2
);

637 ià(
$$
 == 0)  -1; }

639 
İ
 : 
EQUALS


640 { 
$$
 = 
CEXPR_EQ
; }

641 | 
NOTEQUAL


642 { 
$$
 = 
CEXPR_NEQ
; }

644 
rŞe_mls_İ
 : 
İ


645 { 
$$
 = 
$1
; }

646 | 
DOM


647 { 
$$
 = 
CEXPR_DOM
; }

648 | 
DOMBY


649 { 
$$
 = 
CEXPR_DOMBY
; }

650 | 
INCOMP


651 { 
$$
 = 
CEXPR_INCOMP
; }

653 
u£rs
 : 
u£r_def


654 | 
u£rs
 
u£r_def


656 
u£r_def
 : 
USER
 
id’tif›r
 
ROLES
 
Çmes
 
İt_mls_u£r
 ';'

657 {ià(
	`defše_u£r
())  -1;}

659 
İt_mls_u£r
 : 
LEVEL
 
mls_Ëv–_def
 
RANGE
 
mls_¿nge_def


662 
š™Ÿl_sid_cÚ‹xts
 : 
š™Ÿl_sid_cÚ‹xt_def


663 | 
š™Ÿl_sid_cÚ‹xts
 
š™Ÿl_sid_cÚ‹xt_def


665 
š™Ÿl_sid_cÚ‹xt_def
 : 
SID
 
id’tif›r
 
£cur™y_cÚ‹xt_def


666 {ià(
	`defše_š™Ÿl_sid_cÚ‹xt
())  -1;}

668 
İt_dev_cÚ‹xts
 : 
dev_cÚ‹xts
 |

670 
dev_cÚ‹xts
 : 
dev_cÚ‹xt_def


671 | 
dev_cÚ‹xts
 
dev_cÚ‹xt_def


673 
dev_cÚ‹xt_def
 : 
pœq_cÚ‹xt_def
 |

674 
iomem_cÚ‹xt_def
 |

675 
iİÜt_cÚ‹xt_def
 |

676 
pci_cÚ‹xt_def


678 
pœq_cÚ‹xt_def
 : 
PIRQCON
 
numb”
 
£cur™y_cÚ‹xt_def


679 {ià(
	`defše_pœq_cÚ‹xt
(
$2
))  -1;}

681 
iomem_cÚ‹xt_def
 : 
IOMEMCON
 
numb”
 
£cur™y_cÚ‹xt_def


682 {ià(
	`defše_iomem_cÚ‹xt
(
$2
,$2))  -1;}

683 | 
IOMEMCON
 
numb”
 '-'‚umb” 
£cur™y_cÚ‹xt_def


684 {ià(
	`defše_iomem_cÚ‹xt
(
$2
,
$4
))  -1;}

686 
iİÜt_cÚ‹xt_def
 : 
IOPORTCON
 
numb”
 
£cur™y_cÚ‹xt_def


687 {ià(
	`defše_iİÜt_cÚ‹xt
(
$2
,$2))  -1;}

688 | 
IOPORTCON
 
numb”
 '-'‚umb” 
£cur™y_cÚ‹xt_def


689 {ià(
	`defše_iİÜt_cÚ‹xt
(
$2
,
$4
))  -1;}

691 
pci_cÚ‹xt_def
 : 
PCIDEVICECON
 
numb”
 
£cur™y_cÚ‹xt_def


692 {ià(
	`defše_pcideviû_cÚ‹xt
(
$2
))  -1;}

694 
İt_fs_cÚ‹xts
 : 
fs_cÚ‹xts


697 
fs_cÚ‹xts
 : 
fs_cÚ‹xt_def


698 | 
fs_cÚ‹xts
 
fs_cÚ‹xt_def


700 
fs_cÚ‹xt_def
 : 
FSCON
 
numb”
‚umb” 
£cur™y_cÚ‹xt_def
 security_context_def

701 {ià(
	`defše_fs_cÚ‹xt
(
$2
,
$3
))  -1;}

703 
Ãt_cÚ‹xts
 : 
İt_pÜt_cÚ‹xts
 
İt_Ãtif_cÚ‹xts
 
İt_node_cÚ‹xts


705 
İt_pÜt_cÚ‹xts
 : 
pÜt_cÚ‹xts


708 
pÜt_cÚ‹xts
 : 
pÜt_cÚ‹xt_def


709 | 
pÜt_cÚ‹xts
 
pÜt_cÚ‹xt_def


711 
pÜt_cÚ‹xt_def
 : 
PORTCON
 
id’tif›r
 
numb”
 
£cur™y_cÚ‹xt_def


712 {ià(
	`defše_pÜt_cÚ‹xt
(
$3
,$3))  -1;}

713 | 
PORTCON
 
id’tif›r
 
numb”
 '-'‚umb” 
£cur™y_cÚ‹xt_def


714 {ià(
	`defše_pÜt_cÚ‹xt
(
$3
,
$5
))  -1;}

716 
İt_Ãtif_cÚ‹xts
 : 
Ãtif_cÚ‹xts


719 
Ãtif_cÚ‹xts
 : 
Ãtif_cÚ‹xt_def


720 | 
Ãtif_cÚ‹xts
 
Ãtif_cÚ‹xt_def


722 
Ãtif_cÚ‹xt_def
 : 
NETIFCON
 
id’tif›r
 
£cur™y_cÚ‹xt_def
 security_context_def

723 {ià(
	`defše_Ãtif_cÚ‹xt
())  -1;}

725 
İt_node_cÚ‹xts
 : 
node_cÚ‹xts


728 
node_cÚ‹xts
 : 
node_cÚ‹xt_def


729 | 
node_cÚ‹xts
 
node_cÚ‹xt_def


731 
node_cÚ‹xt_def
 : 
NODECON
 
v4_addr_def
 ipv4_addr_deà
£cur™y_cÚ‹xt_def


732 {ià(
	`defše_v4_node_cÚ‹xt
())  -1;}

733 | 
NODECON
 
v6_addr
 ipv6_add¸
£cur™y_cÚ‹xt_def


734 {ià(
	`defše_v6_node_cÚ‹xt
())  -1;}

736 
İt_fs_u£s
 : 
fs_u£s


739 
fs_u£s
 : 
fs_u£_def


740 | 
fs_u£s
 
fs_u£_def


742 
fs_u£_def
 : 
FSUSEXATTR
 
fesy¡em
 
£cur™y_cÚ‹xt_def
 ';'

743 {ià(
	`defše_fs_u£
(
SECURITY_FS_USE_XATTR
))  -1;}

744 | 
FSUSETASK
 
id’tif›r
 
£cur™y_cÚ‹xt_def
 ';'

745 {ià(
	`defše_fs_u£
(
SECURITY_FS_USE_TASK
))  -1;}

746 | 
FSUSETRANS
 
id’tif›r
 
£cur™y_cÚ‹xt_def
 ';'

747 {ià(
	`defše_fs_u£
(
SECURITY_FS_USE_TRANS
))  -1;}

748 | 
FSUSEPSID
 
id’tif›r
 ';'

749 {ià(
	`defše_fs_u£
(
SECURITY_FS_USE_PSIDS
))  -1;}

751 
İt_g’fs_cÚ‹xts
 : 
g’fs_cÚ‹xts


754 
g’fs_cÚ‹xts
 : 
g’fs_cÚ‹xt_def


755 | 
g’fs_cÚ‹xts
 
g’fs_cÚ‹xt_def


757 
g’fs_cÚ‹xt_def
 : 
GENFSCON
 
fesy¡em
 
·th
 '-' 
id’tif›r
 
£cur™y_cÚ‹xt_def


758 {ià(
	`defše_g’fs_cÚ‹xt
(1))  -1;}

759 | 
GENFSCON
 
fesy¡em
 
·th
 '-' '-' {
	`š£¹_id
("-", 0);} 
£cur™y_cÚ‹xt_def


760 {ià(
	`defše_g’fs_cÚ‹xt
(1))  -1;}

761 | 
GENFSCON
 
fesy¡em
 
·th
 
£cur™y_cÚ‹xt_def


762 {ià(
	`defše_g’fs_cÚ‹xt
(0))  -1;}

764 
v4_addr_def
 : 
IPV4_ADDR


765 { ià(
	`š£¹_id
(
yy‹xt
,0))  -1; }

767 
£cur™y_cÚ‹xt_def
 : 
id’tif›r
 ':' id’tif›¸':' id’tif›¸
İt_mls_¿nge_def


769 
İt_mls_¿nge_def
 : ':' 
mls_¿nge_def


772 
mls_¿nge_def
 : 
mls_Ëv–_def
 '-' mls_level_def

773 {ià(
	`š£¹_£·¿tÜ
(0))  -1;}

774 | 
mls_Ëv–_def


775 {ià(
	`š£¹_£·¿tÜ
(0))  -1;}

777 
mls_Ëv–_def
 : 
id’tif›r
 ':' 
id_comma_li¡


778 {ià(
	`š£¹_£·¿tÜ
(0))  -1;}

779 | 
id’tif›r


780 {ià(
	`š£¹_£·¿tÜ
(0))  -1;}

782 
id_comma_li¡
 : 
id’tif›r


783 | 
id_comma_li¡
 ',' 
id’tif›r


785 
tde
 : '~'

787 
a¡”isk
 : '*'

789 
Çmes
 : 
id’tif›r


790 { ià(
	`š£¹_£·¿tÜ
(0))  -1; }

791 | 
Ã¡ed_id_£t


792 { ià(
	`š£¹_£·¿tÜ
(0))  -1; }

793 | 
a¡”isk


794 { ià(
	`š£¹_id
("*", 0))  -1;

795 ià(
	`š£¹_£·¿tÜ
(0))  -1; }

796 | 
tde
 
id’tif›r


797 { ià(
	`š£¹_id
("~", 0))  -1;

798 ià(
	`š£¹_£·¿tÜ
(0))  -1; }

799 | 
tde
 
Ã¡ed_id_£t


800 { ià(
	`š£¹_id
("~", 0))  -1;

801 ià(
	`š£¹_£·¿tÜ
(0))  -1; }

802 | 
id’tif›r
 '-' { ià(
	`š£¹_id
("-", 0))  -1; } identifier

803 { ià(
	`š£¹_£·¿tÜ
(0))  -1; }

805 
tde_push
 : 
tde


806 { ià(
	`š£¹_id
("~", 1))  -1; }

808 
a¡”isk_push
 : 
a¡”isk


809 { ià(
	`š£¹_id
("*", 1))  -1; }

811 
Çmes_push
 : 
id’tif›r_push


812 | '{' 
id’tif›r_li¡_push
 '}'

813 | 
a¡”isk_push


814 | 
tde_push
 
id’tif›r_push


815 | 
tde_push
 '{' 
id’tif›r_li¡_push
 '}'

817 
id’tif›r_li¡_push
 : 
id’tif›r_push


818 | 
id’tif›r_li¡_push
 
id’tif›r_push


820 
id’tif›r_push
 : 
IDENTIFIER


821 { ià(
	`š£¹_id
(
yy‹xt
, 1))  -1; }

823 
id’tif›r_li¡
 : 
id’tif›r


824 | 
id’tif›r_li¡
 
id’tif›r


826 
Ã¡ed_id_£t
 : '{' 
Ã¡ed_id_li¡
 '}'

828 
Ã¡ed_id_li¡
 : 
Ã¡ed_id_–em’t
 |‚ested_id_list‚ested_id_element

830 
Ã¡ed_id_–em’t
 : 
id’tif›r
 | '-' { ià(
	`š£¹_id
("-", 0)è -1; } id’tif›¸| 
Ã¡ed_id_£t


832 
id’tif›r
 : 
IDENTIFIER


833 { ià(
	`š£¹_id
(
yy‹xt
,0))  -1; }

835 
fesy¡em
 : 
FILESYSTEM


836 { ià(
	`š£¹_id
(
yy‹xt
,0))  -1; }

837 | 
IDENTIFIER


838 { ià(
	`š£¹_id
(
yy‹xt
,0))  -1; }

840 
·th
 : 
PATH


841 { ià(
	`š£¹_id
(
yy‹xt
,0))  -1; }

843 
f’ame
 : 
FILENAME


844 { 
yy‹xt
[
	`¡¾’
(yy‹xtè- 1] = '\0'; ià(
	`š£¹_id
(yytext + 1,0))  -1; }

846 
numb”
 : 
NUMBER


847 { 
$$
 = 
	`¡¹oul
(
yy‹xt
,
NULL
,0); }

849 
v6_addr
 : 
IPV6_ADDR


850 { ià(
	`š£¹_id
(
yy‹xt
,0))  -1; }

852 
pŞicyÿp_def
 : 
POLICYCAP
 
id’tif›r
 ';'

853 {ià(
	`defše_pŞÿp
())  -1;}

855 
³rmissive_def
 : 
PERMISSIVE
 
id’tif›r
 ';'

856 {ià(
	`defše_³rmissive
())  -1;}

860 
moduË_pŞicy
 : 
moduË_def
 
avruËs_block


861 { ià(
	`’d_avruË_block
(
·ss
) == -1)  -1;

862 ià(
	`pŞicydb_šdex_Ùh”s
(
NULL
, 
pŞicydbp
, 0))  -1;

865 
moduË_def
 : 
MODULE
 
id’tif›r
 
v”siÚ_id’tif›r
 ';'

866 { ià(
	`defše_pŞicy
(
·ss
, 1) == -1)  -1; }

868 
v”siÚ_id’tif›r
 : 
VERSION_IDENTIFIER


869 { ià(
	`š£¹_id
(
yy‹xt
,0))  -1; }

870 | 
numb”


871 { ià(
	`š£¹_id
(
yy‹xt
,0))  -1; }

872 | 
v4_addr_def


874 
avruËs_block
 : 
avruË_deşs
 
avruË_u£r_defs


876 
avruË_deşs
 :‡vruË_deş 
avruË_deş


877 | 
avruË_deş


879 
avruË_deş
 : 
rbac_deş


880 | 
‹_deş


881 | 
cÚd_¡mt_def


882 | 
»quœe_block


883 | 
İtiÚ®_block


886 
»quœe_block
 : 
REQUIRE
 '{' 
»quœe_li¡
 '}'

888 
»quœe_li¡
 :„equœe_li¡ 
»quœe_deş


889 | 
»quœe_deş


891 
»quœe_deş
 : 
»quœe_şass
 ';'

892 | 
»quœe_deş_def
 
»quœe_id_li¡
 ';'

894 
»quœe_şass
 : 
CLASS
 
id’tif›r
 
Çmes


895 { ià(
	`»quœe_şass
(
·ss
))  -1; }

897 
»quœe_deş_def
 : 
ROLE
 { 
$$
 = 
»quœe_rŞe
; }

898 | 
TYPE
 { 
$$
 = 
»quœe_ty³
; }

899 | 
ATTRIBUTE
 { 
$$
 = 
»quœe_©Œibu‹
; }

900 | 
ATTRIBUTE_ROLE
 { 
$$
 = 
»quœe_©Œibu‹_rŞe
; }

901 | 
USER
 { 
$$
 = 
»quœe_u£r
; }

902 | 
BOOL
 { 
$$
 = 
»quœe_boŞ
; }

903 | 
TUNABLE
 { 
$$
 = 
»quœe_tuÇbË
; }

904 | 
SENSITIVITY
 { 
$$
 = 
»quœe_£ns
; }

905 | 
CATEGORY
 { 
$$
 = 
»quœe_ÿt
; }

907 
»quœe_id_li¡
 : 
id’tif›r


908 { ià(
$
<
»quœe_func
>0 (
·ss
))  -1; }

909 | 
»quœe_id_li¡
 ',' 
id’tif›r


910 { ià(
$
<
»quœe_func
>0 (
·ss
))  -1; }

912 
İtiÚ®_block
 : 
İtiÚ®_deş
 '{' 
avruËs_block
 '}'

913 { ià(
	`’d_avruË_block
(
·ss
) == -1)  -1; }

914 
İtiÚ®_–£


915 { ià(
	`’d_İtiÚ®
(
·ss
) == -1)  -1; }

917 
İtiÚ®_–£
 : 
–£_deş
 '{' 
avruËs_block
 '}'

918 { ià(
	`’d_avruË_block
(
·ss
) == -1)  -1; }

921 
İtiÚ®_deş
 : 
OPTIONAL


922 { ià(
	`begš_İtiÚ®
(
·ss
) == -1)  -1; }

924 
–£_deş
 : 
ELSE


925 { ià(
	`begš_İtiÚ®_–£
(
·ss
) == -1)  -1; }

927 
avruË_u£r_defs
 : 
u£r_def
‡vrule_user_defs

	@libqpol/src/policy_scan.l

29 #undeà
YY_INPUT


30 
	#YY_INPUT
(
b
, 
r
, 
ms
èÔ = 
	`qpŞ_¤c_yyšput
(b, ms))

	)

34 
	~<sys/ty³s.h
>

35 
	~<lim™s.h
>

36 
	~<¡dšt.h
>

37 
	~<¡ršg.h
>

39 (* 
	g»quœe_func_t
)();

43 
	~"pŞicy_·r£.h
"

48 
	glšebuf
[2][255];

49 
	gÊo
 = 0;

50 
yyw¬n
(*
msg
);

52 
£t_sourû_fe
(cÚ¡ *
Çme
);

54 
	gsourû_fe
[
PATH_MAX
];

55 
	gsourû_lš’o
 = 1;

57 
	gpŞicydb_lš’o
 = 1;

59 
	gpŞicydb_”rÜs
 = 0;

64 
qpŞ_¤c_šput
[];

65 *
qpŞ_¤c_špuŒ
;

66 *
qpŞ_¤c_špuim
;

67 
qpŞ_¤c_yyšput
(*
buf
, 
max_size
);

70 %
İtiÚ
 
nošput
 
nouÅut
 
noyyw¿p


72 %
¬¿y


73 
Ë‰”
 [
A
-
Za
-
z
]

74 
dig™
 [0-9]

75 
®num
 [
a
-
zA
-
Z0
-9]

76 
hexv®
 [0-9A-
Fa
-
f
]

78 %% /* 
	$yyËx
 */

79 \
n
.* { 
	`¡ºıy
(
lšebuf
[
Êo
], 
yy‹xt
+1, 255);

80 
lšebuf
[
Êo
][254] = 0;

81 
Êo
 = 1 -†no;

82 
pŞicydb_lš’o
++;

83 
sourû_lš’o
++;

84 
	`yyËss
(1); }

85 
CLONE
 |

86 
şÚe
 { (
CLONE
); }

87 
COMMON
 |

88 
commÚ
 { (
COMMON
); }

89 
CLASS
 |

90 
şass
 { (
CLASS
); }

91 
CONSTRAIN
 |

92 
cÚ¡¿š
 { (
CONSTRAIN
); }

93 
VALIDATETRANS
 |

94 
v®id©‘¿ns
 { (
VALIDATETRANS
); }

95 
INHERITS
 |

96 
šh”™s
 { (
INHERITS
); }

97 
SID
 |

98 
sid
 { (
SID
); }

99 
ROLE
 |

100 
rŞe
 { (
ROLE
); }

101 
ROLES
 |

102 
rŞes
 { (
ROLES
); }

103 
ROLEATTRIBUTE
 |

104 
rŞ—‰ribu‹
 { (
ROLEATTRIBUTE
);}

105 
ATTRIBUTE_ROLE
 |

106 
©Œibu‹_rŞe
 { (
ATTRIBUTE_ROLE
);}

107 
TYPES
 |

108 
ty³s
 { (
TYPES
); }

109 
TYPEALIAS
 |

110 
ty³®Ÿs
 { (
TYPEALIAS
); }

111 
TYPEATTRIBUTE
 |

112 
ty³©Œibu‹
 { (
TYPEATTRIBUTE
); }

113 
TYPEBOUNDS
 |

114 
ty³bounds
 { (
TYPEBOUNDS
); }

115 
TYPE
 |

116 
ty³
 { (
TYPE
); }

117 
BOOL
 |

118 
boŞ
 { (
BOOL
); }

119 
TUNABLE
 |

120 
tuÇbË
 { (
TUNABLE
); }

121 
IF
 |

122 { (
IF
); }

123 
ELSE
 |

124 { (
ELSE
); }

125 
ALIAS
 |

126 
®Ÿs
 { (
ALIAS
); }

127 
ATTRIBUTE
 |

128 
©Œibu‹
 { (
ATTRIBUTE
); }

129 
TYPE_TRANSITION
 |

130 
ty³_Œªs™iÚ
 { (
TYPE_TRANSITION
); }

131 
TYPE_MEMBER
 |

132 
ty³_memb”
 { (
TYPE_MEMBER
); }

133 
TYPE_CHANGE
 |

134 
ty³_chªge
 { (
TYPE_CHANGE
); }

135 
ROLE_TRANSITION
 |

136 
rŞe_Œªs™iÚ
 { (
ROLE_TRANSITION
); }

137 
RANGE_TRANSITION
 |

138 
¿nge_Œªs™iÚ
 { (
RANGE_TRANSITION
); }

139 
SENSITIVITY
 |

140 
£ns™iv™y
 { (
SENSITIVITY
); }

141 
DOMINANCE
 |

142 
domšªû
 { (
DOMINANCE
); }

143 
CATEGORY
 |

144 
ÿ‹gÜy
 { (
CATEGORY
); }

145 
LEVEL
 |

146 
Ëv–
 { (
LEVEL
); }

147 
RANGE
 |

148 
¿nge
 { (
RANGE
); }

149 
MLSCONSTRAIN
 |

150 
mlscÚ¡¿š
 { (
MLSCONSTRAIN
); }

151 
MLSVALIDATETRANS
 |

152 
mlsv®id©‘¿ns
 { (
MLSVALIDATETRANS
); }

153 
USER
 |

154 
u£r
 { (
USER
); }

155 
NEVERALLOW
 |

156 
Ãv”®low
 { (
NEVERALLOW
); }

157 
ALLOW
 |

158 
®low
 { (
ALLOW
); }

159 
AUDITALLOW
 |

160 
aud™®low
 { (
AUDITALLOW
); }

161 
AUDITDENY
 |

162 
aud™d’y
 { (
AUDITDENY
); }

163 
DONTAUDIT
 |

164 
dÚud™
 { (
DONTAUDIT
); }

165 
SOURCE
 |

166 
sourû
 { (
SOURCE
); }

167 
TARGET
 |

168 
rg‘
 { (
TARGET
); }

169 
SAMEUSER
 |

170 
§meu£r
 { (
SAMEUSER
);}

171 
moduË
|
MODULE
 { (MODULE); }

172 
»quœe
|
REQUIRE
 { (REQUIRE); }

173 
İtiÚ®
|
OPTIONAL
 { (OPTIONAL); }

174 
OR
 |

175 
Ü
 { (
OR
);}

176 
AND
 |

177 
ªd
 { (
AND
);}

178 
NOT
 |

179 
nÙ
 { (
NOT
);}

180 
xÜ
 |

181 
XOR
 { (XOR); }

182 
eq
 |

183 
EQ
 { (
EQUALS
);}

184 
Œue
 |

185 
TRUE
 { (
CTRUE
); }

186 
çl£
 |

187 
FALSE
 { (
CFALSE
); }

188 
dom
 |

189 
DOM
 { (DOM);}

190 
domby
 |

191 
DOMBY
 { (DOMBY);}

192 
INCOMP
 |

193 
šcomp
 { (
INCOMP
);}

194 
fscÚ
 |

195 
FSCON
 { (FSCON);}

196 
pÜtcÚ
 |

197 
PORTCON
 { (PORTCON);}

198 
ÃtifcÚ
 |

199 
NETIFCON
 { (NETIFCON);}

200 
nodecÚ
 |

201 
NODECON
 { (NODECON);}

202 
fs_u£_psid
 |

203 
FS_USE_PSID
 { (
FSUSEPSID
);}

204 
pœqcÚ
 |

205 
PIRQCON
 { (PIRQCON);}

206 
iomemcÚ
 |

207 
IOMEMCON
 { (IOMEMCON);}

208 
iİÜtcÚ
 |

209 
IOPORTCON
 { (IOPORTCON);}

210 
pcideviûcÚ
 |

211 
PCIDEVICECON
 { (PCIDEVICECON);}

212 
fs_u£_x©Œ
 |

213 
FS_USE_XATTR
 { (
FSUSEXATTR
);}

214 
fs_u£_sk
 |

215 
FS_USE_TASK
 { (
FSUSETASK
);}

216 
fs_u£_Œªs
 |

217 
FS_USE_TRANS
 { (
FSUSETRANS
);}

218 
g’fscÚ
 |

219 
GENFSCON
 { (GENFSCON);}

220 
r1
 |

221 
R1
 { (R1); }

222 
r2
 |

223 
R2
 { (R2); }

224 
r3
 |

225 
R3
 { (R3); }

226 
u1
 |

227 
U1
 { (U1); }

228 
u2
 |

229 
U2
 { (U2); }

230 
u3
 |

231 
U3
 { (U3); }

232 
t1
 |

233 
T1
 { (T1); }

234 
t2
 |

235 
T2
 { (T2); }

236 
t3
 |

237 
T3
 { (T3); }

238 
l1
 |

239 
L1
 { (L1); }

240 
l2
 |

241 
L2
 { (L2); }

242 
h1
 |

243 
H1
 { (H1); }

244 
h2
 |

245 
H2
 { (H2); }

246 
pŞicyÿp
 |

247 
POLICYCAP
 { (POLICYCAP); }

248 
³rmissive
 |

249 
PERMISSIVE
 { (PERMISSIVE); }

250 
deçuÉ_u£r
 |

251 
DEFAULT_USER
 { (DEFAULT_USER); }

252 
deçuÉ_rŞe
 |

253 
DEFAULT_ROLE
 { (DEFAULT_ROLE); }

254 
deçuÉ_ty³
 |

255 
DEFAULT_TYPE
 { (DEFAULT_TYPE); }

256 
deçuÉ_¿nge
 |

257 
DEFAULT_RANGE
 { (DEFAULT_RANGE); }

258 
low
-
high
 |

259 
LOW
-
HIGH
 { (
LOW_HIGH
); }

260 
high
 |

261 
HIGH
 { (HIGH); }

262 
low
 |

263 
LOW
 { (LOW); }

264 "/"({
®num
}|[
_
\.\-/])* { (
PATH
); }

266 {
Ë‰”
}({
®num
}|[
_
\-])*([\.]?({®num}|[_\-]))* { (
IDENTIFIER
); }

267 {
®num
}*{
Ë‰”
}{®num}* { (
FILESYSTEM
); }

268 {
dig™
}+|0x{
hexv®
}+ { (
NUMBER
); }

269 {
dig™
}{1,3}(\.{dig™}{1,3}){3} { (
IPV4_ADDR
); }

270 {
hexv®
}{0,4}":"{hexv®}{0,4}":"({hexv®}|[:.])* { (
IPV6_ADDR
); }

271 {
dig™
}+(\.({
®num
}|[
_
.])*)? { (
VERSION_IDENTIFIER
); }

272 #
lše
[ ]1[ ]\"[^\n]*\" { set_source_file(yytext+9); }

273 #
lše
[ ]{
dig™
}+ { 
sourû_lš’o
 = 
	`©oi
(
yy‹xt
+6)-1; }

274 #[^\
n
]* { }

275 [ \
t
\
f
]+ { }

276 "==" { (
EQUALS
); }

277 "!=" {  (
NOTEQUAL
); }

278 "&&" {  (
AND
); }

279 "||" {  (
OR
); }

280 "!" {  (
NOT
); }

281 "^" {  (
XOR
); }

294 "*" { (
yy‹xt
[0]); }

295 . { 
	`yyw¬n
("unrecognized character");}

296 
	}
%%

297 
	$yy”rÜ
(*
msg
)

299 ià(
sourû_fe
[0])

300 
	`årštf
(
¡d”r
, "%s:%ld:",

301 
sourû_fe
, 
sourû_lš’o
);

303 
	`årštf
(
¡d”r
, "(unknown source)::");

304 
	`årštf
(
¡d”r
, "ERROR '%s'‡token '%s' on†ine %ld:\n%s\n%s\n",

305 
msg
,

306 
yy‹xt
,

307 
pŞicydb_lš’o
,

308 
lšebuf
[0],†inebuf[1]);

309 
pŞicydb_”rÜs
++;

311 
	}
}

313 
	$yyw¬n
(*
msg
)

315 ià(
sourû_fe
[0])

316 
	`årštf
(
¡d”r
, "%s:%ld:",

317 
sourû_fe
, 
sourû_lš’o
);

319 
	`årštf
(
¡d”r
, "(unknown source)::");

320 
	`årštf
(
¡d”r
, "WARNING '%s'‡token '%s' on†ine %ld:\n%s\n%s\n",

321 
msg
,

322 
yy‹xt
,

323 
pŞicydb_lš’o
,

324 
lšebuf
[0],†inebuf[1]);

326 
	}
}

328 
	$£t_sourû_fe
(cÚ¡ *
Çme
)

330 
sourû_lš’o
 = 1;

331 
	`¡ºıy
(
sourû_fe
, 
Çme
, (source_file)-1);

332 
sourû_fe
[(source_file)-1] = '\0';

333 
	}
}

336 
	$qpŞ_¤c_yyšput
(*
buf
, 
max_size
)

338 
n
 = 
max_size
 < (
qpŞ_¤c_špuim
 - 
qpŞ_¤c_špuŒ
) ? max_size : (qpol_src_inputlim - qpol_src_inputptr);

339 ià(
n
 > 0) {

340 
	`memıy
(
buf
, 
qpŞ_¤c_špuŒ
, 
n
);

341 
qpŞ_¤c_špuŒ
 +ğ
n
;

344  
n
;

345 
	}
}

348 
	$š™_sÿÂ”
()

350 
	`yy_æush_bufãr
(
YY_CURRENT_BUFFER
);

351 
	}
}

	@libqpol/src/portcon_query.c

26 
	~<¡ddef.h
>

27 
	~<¡dlib.h
>

28 
	~<¡dšt.h
>

29 
	~<Ãtš‘/š.h
>

30 
	~<qpŞ/™”©Ü.h
>

31 
	~<qpŞ/pŞicy.h
>

32 
	~<qpŞ/cÚ‹xt_qu”y.h
>

33 
	~<qpŞ/pÜtcÚ_qu”y.h
>

34 
	~<£pŞ/pŞicydb/pŞicydb.h
>

35 
	~"qpŞ_š‹º®.h
"

36 
	~"™”©Ü_š‹º®.h
"

38 
	$qpŞ_pŞicy_g‘_pÜtcÚ_by_pÜt
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, 
ušt16_t
 
low
, ušt16_ˆ
high
, 
ušt8_t
 
´ÙocŞ
,

39 cÚ¡ 
qpŞ_pÜtcÚ_t
 ** 
ocÚ
)

41 
ocÚ‹xt_t
 *
tmp
 = 
NULL
;

42 
pŞicydb_t
 *
db
 = 
NULL
;

44 ià(
ocÚ
 !ğ
NULL
)

45 *
ocÚ
 = 
NULL
;

47 ià(
pŞicy
 =ğ
NULL
 || 
ocÚ
 == NULL) {

48 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

49 
”ºo
 = 
EINVAL
;

50  
STATUS_ERR
;

53 
db
 = &
pŞicy
->
p
->p;

54 
tmp
 = 
db
->
ocÚ‹xts
[
OCON_PORT
];mp;m°ğtmp->
Ãxt
) {

55 ià(
tmp
->
u
.
pÜt
.
low_pÜt
 =ğ
low
 &&mp->u.pÜt.
high_pÜt
 =ğ
high
 &&mp->u.pÜt.
´ÙocŞ
 ==…rotocol)

59 *
ocÚ
 = (
qpŞ_pÜtcÚ_t
 *è
tmp
;

61 ià(*
ocÚ
 =ğ
NULL
) {

62 
	`ERR
(
pŞicy
, "could‚Ù fšd…ÜtcÚ s‹m’ˆfÜ %u-%u:%u", 
low
, 
high
, 
´ÙocŞ
);

63 
”ºo
 = 
ENOENT
;

64  
STATUS_ERR
;

67  
STATUS_SUCCESS
;

68 
	}
}

70 
	$qpŞ_pŞicy_g‘_pÜtcÚ_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, 
qpŞ_™”©Ü_t
 ** 
™”
)

72 
pŞicydb_t
 *
db
 = 
NULL
;

73 
”rÜ
 = 0;

74 
ocÚ_¡©e_t
 *
os
 = 
NULL
;

76 ià(
™”
 !ğ
NULL
)

77 *
™”
 = 
NULL
;

79 ià(
pŞicy
 =ğ
NULL
 || 
™”
 == NULL) {

80 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

81 
”ºo
 = 
EINVAL
;

82  
STATUS_ERR
;

85 
db
 = &
pŞicy
->
p
->p;

87 
os
 = 
	`ÿÎoc
(1, (
ocÚ_¡©e_t
));

88 ià(
os
 =ğ
NULL
) {

89 
”rÜ
 = 
”ºo
;

90 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

91 
”ºo
 = 
”rÜ
;

92  
STATUS_ERR
;

95 
os
->
h—d
 = os->
cur
 = 
db
->
ocÚ‹xts
[
OCON_PORT
];

97 ià(
	`qpŞ_™”©Ü_ü—‹
(
pŞicy
, (*)
os
, 
ocÚ_¡©e_g‘_cur
,

98 
ocÚ_¡©e_Ãxt
, 
ocÚ_¡©e_’d
, 
ocÚ_¡©e_size
, 
ä“
, 
™”
)) {

99 
	`ä“
(
os
);

100  
STATUS_ERR
;

103  
STATUS_SUCCESS
;

104 
	}
}

106 
	$qpŞ_pÜtcÚ_g‘_´ÙocŞ
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_pÜtcÚ_t
 * 
ocÚ
, 
ušt8_t
 * 
´ÙocŞ
)

108 
ocÚ‹xt_t
 *
š‹º®_ocÚ
 = 
NULL
;

110 ià(
´ÙocŞ
 !ğ
NULL
)

111 *
´ÙocŞ
 = 0;

113 ià(
pŞicy
 =ğ
NULL
 || 
ocÚ
 =ğNULL || 
´ÙocŞ
 == NULL) {

114 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

115 
”ºo
 = 
EINVAL
;

116  
STATUS_ERR
;

119 
š‹º®_ocÚ
 = (
ocÚ‹xt_t
 *è
ocÚ
;

121 *
´ÙocŞ
 = 
š‹º®_ocÚ
->
u
.
pÜt
.protocol;

123  
STATUS_SUCCESS
;

124 
	}
}

126 
	$qpŞ_pÜtcÚ_g‘_low_pÜt
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_pÜtcÚ_t
 * 
ocÚ
, 
ušt16_t
 * 
pÜt
)

128 
ocÚ‹xt_t
 *
š‹º®_ocÚ
 = 
NULL
;

130 ià(
pÜt
 !ğ
NULL
)

131 *
pÜt
 = 0;

133 ià(
pŞicy
 =ğ
NULL
 || 
ocÚ
 =ğNULL || 
pÜt
 == NULL) {

134 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

135 
”ºo
 = 
EINVAL
;

136  
STATUS_ERR
;

139 
š‹º®_ocÚ
 = (
ocÚ‹xt_t
 *è
ocÚ
;

141 *
pÜt
 = 
š‹º®_ocÚ
->
u
.pÜt.
low_pÜt
;

143  
STATUS_SUCCESS
;

144 
	}
}

146 
	$qpŞ_pÜtcÚ_g‘_high_pÜt
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_pÜtcÚ_t
 * 
ocÚ
, 
ušt16_t
 * 
pÜt
)

148 
ocÚ‹xt_t
 *
š‹º®_ocÚ
 = 
NULL
;

150 ià(
pÜt
 !ğ
NULL
)

151 *
pÜt
 = 0;

153 ià(
pŞicy
 =ğ
NULL
 || 
ocÚ
 =ğNULL || 
pÜt
 == NULL) {

154 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

155 
”ºo
 = 
EINVAL
;

156  
STATUS_ERR
;

159 
š‹º®_ocÚ
 = (
ocÚ‹xt_t
 *è
ocÚ
;

161 *
pÜt
 = 
š‹º®_ocÚ
->
u
.pÜt.
high_pÜt
;

163  
STATUS_SUCCESS
;

164 
	}
}

166 
	$qpŞ_pÜtcÚ_g‘_cÚ‹xt
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_pÜtcÚ_t
 * 
ocÚ
, cÚ¡ 
qpŞ_cÚ‹xt_t
 ** 
cÚ‹xt
)

168 
ocÚ‹xt_t
 *
š‹º®_ocÚ
 = 
NULL
;

170 ià(
cÚ‹xt
 !ğ
NULL
)

171 *
cÚ‹xt
 = 
NULL
;

173 ià(
pŞicy
 =ğ
NULL
 || 
ocÚ
 =ğNULL || 
cÚ‹xt
 == NULL) {

174 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

175 
”ºo
 = 
EINVAL
;

176  
STATUS_ERR
;

179 
š‹º®_ocÚ
 = (
ocÚ‹xt_t
 *è
ocÚ
;

180 *
cÚ‹xt
 = (
qpŞ_cÚ‹xt_t
 *è& (
š‹º®_ocÚ
->context[0]);

182  
STATUS_SUCCESS
;

183 
	}
}

	@libqpol/src/qpol_internal.h

25 #iâdeà
QPOL_INTERNAL_H


26 
	#QPOL_INTERNAL_H


	)

28 #ifdef 
__ılu¥lus


33 
	~<£pŞ/hªdË.h
>

34 
	~<qpŞ/pŞicy.h
>

35 
	~<¡dio.h
>

37 
	#STATUS_SUCCESS
 0

	)

38 
	#STATUS_ERR
 -1

	)

39 
	#STATUS_NODATA
 1

	)

41 
	#QPOL_MSG_ERR
 1

	)

42 
	#QPOL_MSG_WARN
 2

	)

43 
	#QPOL_MSG_INFO
 3

	)

45 
qpŞ_ex‹nded_image
;

46 
qpŞ_pŞicy
;

48 
	sqpŞ_moduË


50 *
Çme
;

51 *
·th
;

52 *
v”siÚ
;

53 
ty³
;

54 
£pŞ_pŞicydb
 *
p
;

55 
’abËd
;

56 
qpŞ_pŞicy
 *
·»Á
;

59 
	sqpŞ_pŞicy


61 
£pŞ_pŞicydb
 *
p
;

62 
£pŞ_hªdË
 *
sh
;

63 
qpŞ_ÿÎback_â_t
 
â
;

64 *
v¬g
;

65 
İtiÚs
;

66 
ty³
;

67 
modif›d
;

68 
qpŞ_ex‹nded_image
 *
ext
;

69 
qpŞ_moduË
 **
moduËs
;

70 
size_t
 
num_moduËs
;

71 *
fe_d©a
;

72 
size_t
 
fe_d©a_sz
;

73 
fe_d©a_ty³
;

80 
	#QPOL_POLICY_FILE_DATA_TYPE_BIN
 0

	)

81 
	#QPOL_POLICY_FILE_DATA_TYPE_MMAP
 1

	)

82 
	#QPOL_POLICY_FILE_DATA_TYPE_MEM
 2

	)

94 
pŞicy_ex‹nd
(
qpŞ_pŞicy_t
 * 
pŞicy
);

96 
qpŞ_hªdË_msg
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, 
Ëv–
, cÚ¡ *
fmt
, ...);

97 
qpŞ_is_fe_bšpŞ
(
FILE
 * 
å
);

98 
qpŞ_is_fe_mod_pkg
(
FILE
 * 
å
);

106 
qpŞ_bšpŞ_v”siÚ
(
FILE
 * 
å
);

112 
qpŞ_is_d©a_mod_pkg
(* 
d©a
);

114 
	#ERR
(
pŞicy
, 
fÜm©
, ...è
	`qpŞ_hªdË_msg
ÕŞicy, 
QPOL_MSG_ERR
, fÜm©, 
__VA_ARGS__
)

	)

115 
	#WARN
(
pŞicy
, 
fÜm©
, ...è
	`qpŞ_hªdË_msg
ÕŞicy, 
QPOL_MSG_WARN
, fÜm©, 
__VA_ARGS__
)

	)

116 
	#INFO
(
pŞicy
, 
fÜm©
, ...è
	`qpŞ_hªdË_msg
ÕŞicy, 
QPOL_MSG_INFO
, fÜm©, 
__VA_ARGS__
)

	)

118 #ifdef 
__ılu¥lus


	@libqpol/src/queue.c

17 
	~<¡dlib.h
>

18 
	~"queue.h
"

20 
queue_t
 
	$queue_ü—‹
()

22 
queue_t
 
q
;

24 
q
 = (
queue_t
è
	`m®loc
((
queue_šfo
));

25 ià(
q
 =ğ
NULL
)

26  
NULL
;

28 
q
->
h—d
 = q->

 = 
NULL
;

30  
q
;

31 
	}
}

33 
	$queue_š£¹
(
queue_t
 
q
, 
queue_–em’t_t
 
e
)

35 
queue_node_±r_t
 
Ãwnode
;

37 ià(!
q
)

40 
Ãwnode
 = (
queue_node_±r_t
è
	`m®loc
((
queue_node
));

41 ià(
Ãwnode
 =ğ
NULL
)

44 
Ãwnode
->
–em’t
 = 
e
;

45 
Ãwnode
->
Ãxt
 = 
NULL
;

47 ià(
q
->
h—d
 =ğ
NULL
) {

48 
q
->
h—d
 = q->

 = 
Ãwnode
;

50 
q
->

->
Ãxt
 = 
Ãwnode
;

51 
q
->

 = 
Ãwnode
;

55 
	}
}

57 
	$queue_push
(
queue_t
 
q
, 
queue_–em’t_t
 
e
)

59 
queue_node_±r_t
 
Ãwnode
;

61 ià(!
q
)

64 
Ãwnode
 = (
queue_node_±r_t
è
	`m®loc
((
queue_node
));

65 ià(
Ãwnode
 =ğ
NULL
)

68 
Ãwnode
->
–em’t
 = 
e
;

69 
Ãwnode
->
Ãxt
 = 
NULL
;

71 ià(
q
->
h—d
 =ğ
NULL
) {

72 
q
->
h—d
 = q->

 = 
Ãwnode
;

74 
Ãwnode
->
Ãxt
 = 
q
->
h—d
;

75 
q
->
h—d
 = 
Ãwnode
;

79 
	}
}

81 
queue_–em’t_t
 
	$queue_»move
(
queue_t
 
q
)

83 
queue_node_±r_t
 
node
;

84 
queue_–em’t_t
 
e
;

86 ià(!
q
)

87  
NULL
;

89 ià(
q
->
h—d
 =ğ
NULL
)

90  
NULL
;

92 
node
 = 
q
->
h—d
;

93 
q
->
h—d
 = q->h—d->
Ãxt
;

94 ià(
q
->
h—d
 =ğ
NULL
)

95 
q
->

 = 
NULL
;

97 
e
 = 
node
->
–em’t
;

98 
	`ä“
(
node
);

100  
e
;

101 
	}
}

103 
queue_–em’t_t
 
	$queue_h—d
(
queue_t
 
q
)

105 ià(!
q
)

106  
NULL
;

108 ià(
q
->
h—d
 =ğ
NULL
)

109  
NULL
;

111  
q
->
h—d
->
–em’t
;

112 
	}
}

114 
	$queue_de¡roy
(
queue_t
 
q
)

116 
queue_node_±r_t
 
p
, 
‹mp
;

118 ià(!
q
)

121 
p
 = 
q
->
h—d
;

122 
p
 !ğ
NULL
) {

123 
‹mp
 = 
p
;

124 
p
 =…->
Ãxt
;

125 
	`ä“
(
‹mp
);

128 
	`ä“
(
q
);

129 
	}
}

131 
queue_m­
(
queue_t
 
q
, (*
f
è(
queue_–em’t_t
, *), *
vp
)

133 
queue_node_±r_t
 
p
;

134 
»t
;

136 ià(!
q
)

139 
p
 = 
q
->
h—d
;

140 
p
 !ğ
NULL
) {

141 
»t
 = 
	`f
(
p
->
–em’t
, 
vp
);

142 ià(
»t
)

143  
»t
;

144 
p
 =…->
Ãxt
;

147 
	}
}

149 
queue_m­_»move_Ú_”rÜ
(
queue_t
 
q
,

150 (*
f
è(
queue_–em’t_t
, *),

151 (*
g
è(
queue_–em’t_t
, *), *
vp
)

153 
queue_node_±r_t
 
p
, 
Ï¡
, 
‹mp
;

154 
»t
;

156 ià(!
q
)

159 
Ï¡
 = 
NULL
;

160 
p
 = 
q
->
h—d
;

161 
p
 !ğ
NULL
) {

162 
»t
 = 
	`f
(
p
->
–em’t
, 
vp
);

163 ià(
»t
) {

164 ià(
Ï¡
) {

165 
Ï¡
->
Ãxt
 = 
p
->next;

166 ià(
Ï¡
->
Ãxt
 =ğ
NULL
)

167 
q
->

 = 
Ï¡
;

169 
q
->
h—d
 = 
p
->
Ãxt
;

170 ià(
q
->
h—d
 =ğ
NULL
)

171 
q
->

 = 
NULL
;

174 
‹mp
 = 
p
;

175 
p
 =…->
Ãxt
;

176 
	`g
(
‹mp
->
–em’t
, 
vp
);

177 
	`ä“
(
‹mp
);

179 
Ï¡
 = 
p
;

180 
p
 =…->
Ãxt
;

185 
	}
}

	@libqpol/src/queue.h

19 #iâdeà
_QUEUE_H_


20 
	#_QUEUE_H_


	)

22 *
	tqueue_–em’t_t
;

24 
queue_node
 *
	tqueue_node_±r_t
;

26 
	squeue_node
 {

27 
queue_–em’t_t
 
	m–em’t
;

28 
queue_node_±r_t
 
	mÃxt
;

29 } 
	tqueue_node_t
;

31 
	squeue_šfo
 {

32 
queue_node_±r_t
 
	mh—d
;

33 
queue_node_±r_t
 
	m
;

34 } 
	tqueue_šfo_t
;

36 
queue_šfo_t
 *
	tqueue_t
;

38 
queue_t
 
queue_ü—‹
();

39 
queue_š£¹
(
queue_t
, 
queue_–em’t_t
);

40 
queue_push
(
queue_t
, 
queue_–em’t_t
);

41 
queue_–em’t_t
 
queue_»move
(
queue_t
);

42 
queue_–em’t_t
 
queue_h—d
(
queue_t
);

43 
queue_de¡roy
(
queue_t
);

56 
queue_m­
(
queue_t
, (*
f
è(
queue_–em’t_t
, *), *);

63 
	`queue_m­_»move_Ú_”rÜ
(
queue_t
,

64 (*
f
è(
queue_–em’t_t
, *),

65 (*
g
è(
queue_–em’t_t
, *), *);

	@libqpol/src/rbacrule_query.c

25 
	~<qpŞ/™”©Ü.h
>

26 
	~<qpŞ/pŞicy.h
>

27 
	~<qpŞ/rbaüuË_qu”y.h
>

28 
	~<¡dlib.h
>

29 
	~"™”©Ü_š‹º®.h
"

30 
	~"qpŞ_š‹º®.h
"

31 
	~<£pŞ/pŞicydb/pŞicydb.h
>

33 
	srŞe_®low_¡©e


35 
rŞe_®low_t
 *
	mh—d
;

36 
rŞe_®low_t
 *
	mcur
;

37 } 
	trŞe_®low_¡©e_t
;

39 
	$rŞe_®low_¡©e_’d
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

41 
rŞe_®low_¡©e_t
 *
¿s
 = 
NULL
;

43 ià(!
™”
 || !(
¿s
 = 
	`qpŞ_™”©Ü_¡©e
(iter))) {

44 
”ºo
 = 
EINVAL
;

45  
STATUS_ERR
;

48  
¿s
->
cur
 ? 0 : 1;

49 
	}
}

51 *
	$rŞe_®low_¡©e_g‘_cur
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

53 
rŞe_®low_¡©e_t
 *
¿s
 = 
NULL
;

54 cÚ¡ 
pŞicydb_t
 *
db
 = 
NULL
;

56 ià(!
™”
 || !(
¿s
 = 
	`qpŞ_™”©Ü_¡©e
(™”)è|| !(
db
 = 
	`qpŞ_™”©Ü_pŞicy
(™”)è|| 
	`rŞe_®low_¡©e_’d
(iter)) {

57 
”ºo
 = 
EINVAL
;

58  
NULL
;

61  
¿s
->
cur
;

62 
	}
}

64 
	$rŞe_®low_¡©e_Ãxt
(
qpŞ_™”©Ü_t
 * 
™”
)

66 
rŞe_®low_¡©e_t
 *
¿s
 = 
NULL
;

67 cÚ¡ 
pŞicydb_t
 *
db
 = 
NULL
;

69 ià(!
™”
 || !(
¿s
 = 
	`qpŞ_™”©Ü_¡©e
(™”)è|| !(
db
 = 
	`qpŞ_™”©Ü_pŞicy
(iter))) {

70 
”ºo
 = 
EINVAL
;

71  
STATUS_ERR
;

74 ià(
	`rŞe_®low_¡©e_’d
(
™”
)) {

75 
”ºo
 = 
ERANGE
;

76  
STATUS_ERR
;

79 
¿s
->
cur
 =„as->cur->
Ãxt
;

81  
STATUS_SUCCESS
;

82 
	}
}

84 
size_t
 
	$rŞe_®low_¡©e_size
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

86 
rŞe_®low_¡©e_t
 *
¿s
 = 
NULL
;

87 cÚ¡ 
pŞicydb_t
 *
db
 = 
NULL
;

88 
rŞe_®low_t
 *
tmp
 = 
NULL
;

89 
size_t
 
couÁ
 = 0;

91 ià(!
™”
 || !(
¿s
 = 
	`qpŞ_™”©Ü_¡©e
(™”)è|| !(
db
 = 
	`qpŞ_™”©Ü_pŞicy
(iter))) {

92 
”ºo
 = 
EINVAL
;

93  
STATUS_ERR
;

96 
tmp
 = 
¿s
->
h—d
;mp;m°ğtmp->
Ãxt
)

97 
couÁ
++;

99  
couÁ
;

100 
	}
}

102 
	$qpŞ_pŞicy_g‘_rŞe_®low_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, 
qpŞ_™”©Ü_t
 ** 
™”
)

104 
pŞicydb_t
 *
db
 = 
NULL
;

105 
rŞe_®low_¡©e_t
 *
¿s
 = 
NULL
;

106 
”rÜ
 = 0;

108 ià(
™”
)

109 *
™”
 = 
NULL
;

111 ià(!
pŞicy
 || !
™”
) {

112 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

113 
”ºo
 = 
EINVAL
;

114  
STATUS_ERR
;

117 
db
 = &
pŞicy
->
p
->p;

119 
¿s
 = 
	`ÿÎoc
(1, (
rŞe_®low_¡©e_t
));

120 ià(!
¿s
) {

122 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”ºo
));

123  
STATUS_ERR
;

125 
¿s
->
h—d
 =„as->
cur
 = 
db
->
rŞe_®low
;

127 ià(
qpŞ_™”©Ü_ü—‹


128 (
pŞicy
, (*)
¿s
, 
rŞe_®low_¡©e_g‘_cur
, 
rŞe_®low_¡©e_Ãxt
, 
rŞe_®low_¡©e_’d
, 
rŞe_®low_¡©e_size
,

129 
ä“
, 
™”
)) {

130 
”rÜ
 = 
”ºo
;

131 
	`ä“
(
¿s
);

132 
”ºo
 = 
”rÜ
;

133  
STATUS_ERR
;

136  
STATUS_SUCCESS
;

137 
	}
}

139 
	$qpŞ_rŞe_®low_g‘_sourû_rŞe
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_rŞe_®low_t
 * 
ruË
, cÚ¡ 
qpŞ_rŞe_t
 ** 
sourû
)

141 
pŞicydb_t
 *
db
 = 
NULL
;

142 
rŞe_®low_t
 *
¿
 = 
NULL
;

144 ià(
sourû
) {

145 *
sourû
 = 
NULL
;

148 ià(!
pŞicy
 || !
ruË
 || !
sourû
) {

149 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

150 
”ºo
 = 
EINVAL
;

151  
STATUS_ERR
;

154 
db
 = &
pŞicy
->
p
->p;

155 
¿
 = (
rŞe_®low_t
 *è
ruË
;

157 *
sourû
 = (
qpŞ_rŞe_t
 *è
db
->
rŞe_v®_to_¡ruù
[
¿
->
rŞe
 - 1];

159  
STATUS_SUCCESS
;

160 
	}
}

162 
	$qpŞ_rŞe_®low_g‘_rg‘_rŞe
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_rŞe_®low_t
 * 
ruË
, cÚ¡ 
qpŞ_rŞe_t
 ** 
rg‘
)

164 
pŞicydb_t
 *
db
 = 
NULL
;

165 
rŞe_®low_t
 *
¿
 = 
NULL
;

167 ià(
rg‘
) {

168 *
rg‘
 = 
NULL
;

171 ià(!
pŞicy
 || !
ruË
 || !
rg‘
) {

172 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

173 
”ºo
 = 
EINVAL
;

174  
STATUS_ERR
;

177 
db
 = &
pŞicy
->
p
->p;

178 
¿
 = (
rŞe_®low_t
 *è
ruË
;

180 *
rg‘
 = (
qpŞ_rŞe_t
 *è
db
->
rŞe_v®_to_¡ruù
[
¿
->
Ãw_rŞe
 - 1];

182  
STATUS_SUCCESS
;

183 
	}
}

185 
	srŞe_Œªs_¡©e


187 
rŞe_Œªs_t
 *
	mh—d
;

188 
rŞe_Œªs_t
 *
	mcur
;

189 } 
	trŞe_Œªs_¡©e_t
;

191 
	$rŞe_Œªs_¡©e_’d
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

193 
rŞe_Œªs_¡©e_t
 *
¹s
 = 
NULL
;

195 ià(!
™”
 || !(
¹s
 = 
	`qpŞ_™”©Ü_¡©e
(iter))) {

196 
”ºo
 = 
EINVAL
;

197  
STATUS_ERR
;

200  
¹s
->
cur
 ? 0 : 1;

201 
	}
}

203 *
	$rŞe_Œªs_¡©e_g‘_cur
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

205 
rŞe_Œªs_¡©e_t
 *
¹s
 = 
NULL
;

206 cÚ¡ 
pŞicydb_t
 *
db
 = 
NULL
;

208 ià(!
™”
 || !(
¹s
 = 
	`qpŞ_™”©Ü_¡©e
(™”)è|| !(
db
 = 
	`qpŞ_™”©Ü_pŞicy
(™”)è|| 
	`rŞe_Œªs_¡©e_’d
(iter)) {

209 
”ºo
 = 
EINVAL
;

210  
NULL
;

213  
¹s
->
cur
;

214 
	}
}

216 
	$rŞe_Œªs_¡©e_Ãxt
(
qpŞ_™”©Ü_t
 * 
™”
)

218 
rŞe_Œªs_¡©e_t
 *
¹s
 = 
NULL
;

219 cÚ¡ 
pŞicydb_t
 *
db
 = 
NULL
;

221 ià(!
™”
 || !(
¹s
 = 
	`qpŞ_™”©Ü_¡©e
(™”)è|| !(
db
 = 
	`qpŞ_™”©Ü_pŞicy
(iter))) {

222 
”ºo
 = 
EINVAL
;

223  
STATUS_ERR
;

226 ià(
	`rŞe_Œªs_¡©e_’d
(
™”
)) {

227 
”ºo
 = 
ERANGE
;

228  
STATUS_ERR
;

231 
¹s
->
cur
 =„ts->cur->
Ãxt
;

233  
STATUS_SUCCESS
;

234 
	}
}

236 
size_t
 
	$rŞe_Œªs_¡©e_size
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

238 
rŞe_Œªs_¡©e_t
 *
¹s
 = 
NULL
;

239 cÚ¡ 
pŞicydb_t
 *
db
 = 
NULL
;

240 
rŞe_Œªs_t
 *
tmp
 = 
NULL
;

241 
size_t
 
couÁ
 = 0;

243 ià(!
™”
 || !(
¹s
 = 
	`qpŞ_™”©Ü_¡©e
(™”)è|| !(
db
 = 
	`qpŞ_™”©Ü_pŞicy
(iter))) {

244 
”ºo
 = 
EINVAL
;

245  
STATUS_ERR
;

248 
tmp
 = 
¹s
->
h—d
;mp;m°ğtmp->
Ãxt
)

249 
couÁ
++;

251  
couÁ
;

252 
	}
}

254 
	$qpŞ_pŞicy_g‘_rŞe_Œªs_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, 
qpŞ_™”©Ü_t
 ** 
™”
)

256 
pŞicydb_t
 *
db
 = 
NULL
;

257 
rŞe_Œªs_¡©e_t
 *
¹s
 = 
NULL
;

258 
”rÜ
 = 0;

260 ià(
™”
)

261 *
™”
 = 
NULL
;

263 ià(!
pŞicy
 || !
™”
) {

264 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

265 
”ºo
 = 
EINVAL
;

266  
STATUS_ERR
;

269 
db
 = &
pŞicy
->
p
->p;

271 
¹s
 = 
	`ÿÎoc
(1, (
rŞe_Œªs_¡©e_t
));

272 ià(!
¹s
) {

274 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”ºo
));

275  
STATUS_ERR
;

277 
¹s
->
h—d
 =„ts->
cur
 = 
db
->
rŞe_Œ
;

279 ià(
qpŞ_™”©Ü_ü—‹


280 (
pŞicy
, (*)
¹s
, 
rŞe_Œªs_¡©e_g‘_cur
, 
rŞe_Œªs_¡©e_Ãxt
, 
rŞe_Œªs_¡©e_’d
, 
rŞe_Œªs_¡©e_size
,

281 
ä“
, 
™”
)) {

282 
”rÜ
 = 
”ºo
;

283 
	`ä“
(
¹s
);

284 
”ºo
 = 
”rÜ
;

285  
STATUS_ERR
;

288  
STATUS_SUCCESS
;

289 
	}
}

291 
	$qpŞ_rŞe_Œªs_g‘_sourû_rŞe
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_rŞe_Œªs_t
 * 
ruË
, cÚ¡ 
qpŞ_rŞe_t
 ** 
sourû
)

293 
pŞicydb_t
 *
db
 = 
NULL
;

294 
rŞe_Œªs_t
 *
¹
 = 
NULL
;

296 ià(
sourû
) {

297 *
sourû
 = 
NULL
;

300 ià(!
pŞicy
 || !
ruË
 || !
sourû
) {

301 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

302 
”ºo
 = 
EINVAL
;

303  
STATUS_ERR
;

306 
db
 = &
pŞicy
->
p
->p;

307 
¹
 = (
rŞe_Œªs_t
 *è
ruË
;

309 *
sourû
 = (
qpŞ_rŞe_t
 *è
db
->
rŞe_v®_to_¡ruù
[
¹
->
rŞe
 - 1];

311  
STATUS_SUCCESS
;

312 
	}
}

314 
	$qpŞ_rŞe_Œªs_g‘_rg‘_ty³
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_rŞe_Œªs_t
 * 
ruË
, cÚ¡ 
qpŞ_ty³_t
 ** 
rg‘
)

316 
pŞicydb_t
 *
db
 = 
NULL
;

317 
rŞe_Œªs_t
 *
¹
 = 
NULL
;

319 ià(
rg‘
) {

320 *
rg‘
 = 
NULL
;

323 ià(!
pŞicy
 || !
ruË
 || !
rg‘
) {

324 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

325 
”ºo
 = 
EINVAL
;

326  
STATUS_ERR
;

329 
db
 = &
pŞicy
->
p
->p;

330 
¹
 = (
rŞe_Œªs_t
 *è
ruË
;

332 *
rg‘
 = (
qpŞ_ty³_t
 *è
db
->
ty³_v®_to_¡ruù
[
¹
->
ty³
 - 1];

334  
STATUS_SUCCESS
;

335 
	}
}

337 
	$qpŞ_rŞe_Œªs_g‘_objeù_şass
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_rŞe_Œªs_t
 * 
ruË
, cÚ¡ 
qpŞ_şass_t
 ** 
obj_şass
)

339 
pŞicydb_t
 *
db
 = 
NULL
;

340 
rŞe_Œªs_t
 *
¹
 = 
NULL
;

342 ià(
obj_şass
) {

343 *
obj_şass
 = 
NULL
;

346 ià(!
pŞicy
 || !
ruË
 || !
obj_şass
) {

347 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

348 
”ºo
 = 
EINVAL
;

349  
STATUS_ERR
;

352 
db
 = &
pŞicy
->
p
->p;

353 
¹
 = (
rŞe_Œªs_t
 *è
ruË
;

355 *
obj_şass
 = (
qpŞ_şass_t
 *è
db
->
şass_v®_to_¡ruù
[
¹
->
tşass
 - 1];

357  
STATUS_SUCCESS
;

358 
	}
}

360 
	$qpŞ_rŞe_Œªs_g‘_deçuÉ_rŞe
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_rŞe_Œªs_t
 * 
ruË
, cÚ¡ 
qpŞ_rŞe_t
 ** 
dæt
)

362 
pŞicydb_t
 *
db
 = 
NULL
;

363 
rŞe_Œªs_t
 *
¹
 = 
NULL
;

365 ià(
dæt
) {

366 *
dæt
 = 
NULL
;

369 ià(!
pŞicy
 || !
ruË
 || !
dæt
) {

370 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

371 
”ºo
 = 
EINVAL
;

372  
STATUS_ERR
;

375 
db
 = &
pŞicy
->
p
->p;

376 
¹
 = (
rŞe_Œªs_t
 *è
ruË
;

378 *
dæt
 = (
qpŞ_rŞe_t
 *è
db
->
rŞe_v®_to_¡ruù
[
¹
->
Ãw_rŞe
 - 1];

380  
STATUS_SUCCESS
;

381 
	}
}

	@libqpol/src/role_query.c

26 
	~<¡ddef.h
>

27 
	~<¡dšt.h
>

28 
	~<¡dlib.h
>

29 
	~<qpŞ/™”©Ü.h
>

30 
	~<qpŞ/pŞicy.h
>

31 
	~<£pŞ/pŞicydb/pŞicydb.h
>

32 
	~<£pŞ/pŞicydb/ex·nd.h
>

33 
	~"™”©Ü_š‹º®.h
"

34 
	~<qpŞ/rŞe_qu”y.h
>

35 
	~<qpŞ/ty³_qu”y.h
>

36 
	~"qpŞ_š‹º®.h
"

38 
	$qpŞ_pŞicy_g‘_rŞe_by_Çme
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ *
Çme
, cÚ¡ 
qpŞ_rŞe_t
 ** 
d©um
)

40 
hashb_d©um_t
 
š‹º®_d©um
;

41 
pŞicydb_t
 *
db
;

43 ià(
pŞicy
 =ğ
NULL
 || 
Çme
 =ğNULL || 
d©um
 == NULL) {

44 ià(
d©um
 !ğ
NULL
)

45 *
d©um
 = 
NULL
;

46 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

47 
”ºo
 = 
EINVAL
;

48  
STATUS_ERR
;

51 
db
 = &
pŞicy
->
p
->p;

52 
š‹º®_d©um
 = 
	`hashb_£¬ch
(
db
->
p_rŞes
.
bË
, (cÚ¡ 
hashb_key_t
)
Çme
);

53 ià(
š‹º®_d©um
 =ğ
NULL
) {

54 *
d©um
 = 
NULL
;

55 
	`ERR
(
pŞicy
, "could‚Ù fšd d©um fÜ„Ş%s", 
Çme
);

56 
”ºo
 = 
ENOENT
;

57  
STATUS_ERR
;

59 *
d©um
 = (
qpŞ_rŞe_t
 *è
š‹º®_d©um
;

61  
STATUS_SUCCESS
;

62 
	}
}

64 
	$qpŞ_pŞicy_g‘_rŞe_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, 
qpŞ_™”©Ü_t
 ** 
™”
)

66 
pŞicydb_t
 *
db
;

67 
”rÜ
 = 0;

68 
hash_¡©e_t
 *
hs
 = 
NULL
;

70 ià(
pŞicy
 =ğ
NULL
 || 
™”
 == NULL) {

71 ià(
™”
 !ğ
NULL
)

72 *
™”
 = 
NULL
;

73 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

74 
”ºo
 = 
EINVAL
;

75  
STATUS_ERR
;

78 
db
 = &
pŞicy
->
p
->p;

80 
hs
 = 
	`ÿÎoc
(1, (
hash_¡©e_t
));

81 ià(
hs
 =ğ
NULL
) {

82 
”rÜ
 = 
”ºo
;

83 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

84 
”ºo
 = 
”rÜ
;

85  
STATUS_ERR
;

87 
hs
->
bË
 = &
db
->
p_rŞes
.table;

88 
hs
->
node
 = (*(hs->
bË
))->
hbË
[0];

90 ià(
	`qpŞ_™”©Ü_ü—‹
(
pŞicy
, (*)
hs
, 
hash_¡©e_g‘_cur
,

91 
hash_¡©e_Ãxt
, 
hash_¡©e_’d
, 
hash_¡©e_size
, 
ä“
, 
™”
)) {

92 
	`ä“
(
hs
);

93  
STATUS_ERR
;

96 ià(
hs
->
node
 =ğ
NULL
)

97 
	`hash_¡©e_Ãxt
(*
™”
);

99  
STATUS_SUCCESS
;

100 
	}
}

102 
	$qpŞ_rŞe_g‘_v®ue
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_rŞe_t
 * 
d©um
, 
ušt32_t
 * 
v®ue
)

104 
rŞe_d©um_t
 *
š‹º®_d©um
 = 
NULL
;

106 ià(
pŞicy
 =ğ
NULL
 || 
d©um
 =ğNULL || 
v®ue
 == NULL) {

107 ià(
v®ue
 !ğ
NULL
)

108 *
v®ue
 = 0;

109 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

110 
”ºo
 = 
EINVAL
;

111  
STATUS_ERR
;

114 
š‹º®_d©um
 = (
rŞe_d©um_t
 *è
d©um
;

115 *
v®ue
 = 
š‹º®_d©um
->
s
.value;

117  
STATUS_SUCCESS
;

118 
	}
}

120 
	$qpŞ_rŞe_g‘_domš©e_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_rŞe_t
 * 
d©um
, 
qpŞ_™”©Ü_t
 ** 
domš©es
)

122 
rŞe_d©um_t
 *
š‹º®_d©um
 = 
NULL
;

123 
pŞicydb_t
 *
db
 = 
NULL
;

124 
”rÜ
;

125 
eb™m­_¡©e_t
 *
es
 = 
NULL
;

127 ià(
pŞicy
 =ğ
NULL
 || 
d©um
 =ğNULL || 
domš©es
 == NULL) {

128 ià(
domš©es
 !ğ
NULL
)

129 *
domš©es
 = 
NULL
;

130 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

131 
”ºo
 = 
EINVAL
;

132  
STATUS_ERR
;

135 
š‹º®_d©um
 = (
rŞe_d©um_t
 *è
d©um
;

136 
db
 = &
pŞicy
->
p
->p;

138 ià(!(
es
 = 
	`ÿÎoc
(1, (
eb™m­_¡©e_t
)))) {

139 
”rÜ
 = 
”ºo
;

140 
	`ERR
(
pŞicy
, "%s", "unableo create iterator state object");

141 
”ºo
 = 
”rÜ
;

142  
STATUS_ERR
;

144 
es
->
bm­
 = &
š‹º®_d©um
->
domš©es
;

146 ià(
	`qpŞ_™”©Ü_ü—‹
(
pŞicy
, (*)
es
, 
eb™m­_¡©e_g‘_cur_rŞe
,

147 
eb™m­_¡©e_Ãxt
, 
eb™m­_¡©e_’d
, 
eb™m­_¡©e_size
, 
ä“
, 
domš©es
)) {

148 
”rÜ
 = 
”ºo
;

149 
	`ä“
(
es
);

150 
”ºo
 = 
”rÜ
;

151  
STATUS_ERR
;

154 ià(
es
->
bm­
->
node
 && !
	`eb™m­_g‘_b™
Ós->bm­,ƒs->
cur
))

155 
	`eb™m­_¡©e_Ãxt
(*
domš©es
);

157  
STATUS_SUCCESS
;

158 
	}
}

160 
	$qpŞ_rŞe_g‘_ty³_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_rŞe_t
 * 
d©um
, 
qpŞ_™”©Ü_t
 ** 
ty³s
)

162 
rŞe_d©um_t
 *
š‹º®_d©um
 = 
NULL
;

163 
pŞicydb_t
 *
db
 = 
NULL
;

164 
eb™m­_t
 *
ex·nded_£t
 = 
NULL
;

165 
”rÜ
;

166 
eb™m­_¡©e_t
 *
es
 = 
NULL
;

168 ià(
pŞicy
 =ğ
NULL
 || 
d©um
 =ğNULL || 
ty³s
 == NULL) {

169 ià(
ty³s
 !ğ
NULL
)

170 *
ty³s
 = 
NULL
;

171 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

172 
”ºo
 = 
EINVAL
;

173  
STATUS_ERR
;

176 
š‹º®_d©um
 = (
rŞe_d©um_t
 *è
d©um
;

177 
db
 = &
pŞicy
->
p
->p;

179 ià(!(
ex·nded_£t
 = 
	`ÿÎoc
(1, (
eb™m­_t
)))) {

180 
”rÜ
 = 
”ºo
;

181 
	`ERR
(
pŞicy
, "%s", "unableo create bitmap");

182 
”ºo
 = 
”rÜ
;

183  
STATUS_ERR
;

186 ià(
	`ty³_£t_ex·nd
(&
š‹º®_d©um
->
ty³s
, 
ex·nded_£t
, 
db
, 1)) {

187 
	`eb™m­_de¡roy
(
ex·nded_£t
);

188 
	`ä“
(
ex·nded_£t
);

189 
	`ERR
(
pŞicy
, "”rÜ„—dšgy³ s‘ fÜ„Ş%s", 
db
->
p_rŞe_v®_to_Çme
[
š‹º®_d©um
->
s
.
v®ue
 - 1]);

190 
”ºo
 = 
EIO
;

191  
STATUS_ERR
;

194 ià(!(
es
 = 
	`ÿÎoc
(1, (
eb™m­_¡©e_t
)))) {

195 
”rÜ
 = 
”ºo
;

196 
	`ERR
(
pŞicy
, "%s", "unableo create iterator state object");

197 
	`eb™m­_de¡roy
(
ex·nded_£t
);

198 
	`ä“
(
ex·nded_£t
);

199 
”ºo
 = 
”rÜ
;

200  
STATUS_ERR
;

202 
es
->
bm­
 = 
ex·nded_£t
;

203 
es
->
cur
 =ƒs->
bm­
->
node
 ?ƒs->bm­->node->
¡¬tb™
 : 0;

205 ià(
	`qpŞ_™”©Ü_ü—‹
(
pŞicy
, (*)
es
, 
eb™m­_¡©e_g‘_cur_ty³
,

206 
eb™m­_¡©e_Ãxt
, 
eb™m­_¡©e_’d
, 
eb™m­_¡©e_size
, 
eb™m­_¡©e_de¡roy
, 
ty³s
)) {

207 
”rÜ
 = 
”ºo
;

208 
	`eb™m­_¡©e_de¡roy
(
es
);

209 
”ºo
 = 
”rÜ
;

210  
STATUS_ERR
;

213 ià(
es
->
bm­
->
node
 && !
	`eb™m­_g‘_b™
Ós->bm­,ƒs->
cur
))

214 
	`eb™m­_¡©e_Ãxt
(*
ty³s
);

216  
STATUS_SUCCESS
;

217 
	}
}

219 
	$qpŞ_rŞe_g‘_Çme
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_rŞe_t
 * 
d©um
, cÚ¡ **
Çme
)

221 
rŞe_d©um_t
 *
š‹º®_d©um
 = 
NULL
;

222 
pŞicydb_t
 *
db
 = 
NULL
;

224 ià(
pŞicy
 =ğ
NULL
 || 
d©um
 =ğNULL || 
Çme
 == NULL) {

225 ià(
Çme
 !ğ
NULL
)

226 *
Çme
 = 
NULL
;

227 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

228 
”ºo
 = 
EINVAL
;

229  
STATUS_ERR
;

232 
db
 = &
pŞicy
->
p
->p;

233 
š‹º®_d©um
 = (
rŞe_d©um_t
 *è
d©um
;

235 *
Çme
 = 
db
->
p_rŞe_v®_to_Çme
[
š‹º®_d©um
->
s
.
v®ue
 - 1];

237  
STATUS_SUCCESS
;

238 
	}
}

	@libqpol/src/syn_rule_internal.h

26 #iâdeà
QPOL_SYN_RULE_INTERNAL_H


27 
	#QPOL_SYN_RULE_INTERNAL_H


	)

29 #ifdef 
__ılu¥lus


34 
	sqpŞ_syn_ruË


36 
avruË_t
 *
ruË
;

37 
cÚd_node_t
 *
cÚd
;

39 
cÚd_b¿nch
;

43 #ifdef 
__ılu¥lus


	@libqpol/src/syn_rule_query.c

26 
	~<cÚfig.h
>

28 
	~<qpŞ/syn_ruË_qu”y.h
>

29 
	~<£pŞ/pŞicydb/pŞicydb.h
>

30 
	~<£pŞ/pŞicydb/ut.h
>

31 
	~<£pŞ/pŞicydb/cÚd™iÚ®.h
>

32 
	~"qpŞ_š‹º®.h
"

33 
	~"™”©Ü_š‹º®.h
"

34 
	~"syn_ruË_š‹º®.h
"

35 
	~<”ºo.h
>

36 
	~<¡dlib.h
>

38 
	ssyn_ruË_şass_¡©e


40 
şass_³rm_node_t
 *
	mh—d
;

41 
şass_³rm_node_t
 *
	mcur
;

42 } 
	tsyn_ruË_şass_¡©e_t
;

44 
	$syn_ruË_şass_¡©e_’d
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

46 
syn_ruË_şass_¡©e_t
 *
¤cs
 = 
NULL
;

48 ià(!
™”
 || !(
¤cs
 = (
syn_ruË_şass_¡©e_t
 *è
	`qpŞ_™”©Ü_¡©e
(iter))) {

49 
”ºo
 = 
EINVAL
;

50  
STATUS_ERR
;

53 ià(
¤cs
->
cur
 =ğ
NULL
)

57 
	}
}

59 *
	$syn_ruË_şass_¡©e_g‘_cur
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

61 
syn_ruË_şass_¡©e_t
 *
¤cs
 = 
NULL
;

62 cÚ¡ 
pŞicydb_t
 *
db
 = 
NULL
;

64 ià(!
™”
 || !(
¤cs
 = (
syn_ruË_şass_¡©e_t
 *è
	`qpŞ_™”©Ü_¡©e
(iter)) ||

65 !(
db
 = 
	`qpŞ_™”©Ü_pŞicy
(
™”
)è|| 
	`qpŞ_™”©Ü_’d
(iter)) {

66 
”ºo
 = 
EINVAL
;

67  
NULL
;

70  
db
->
şass_v®_to_¡ruù
[
¤cs
->
cur
->
tşass
 - 1];

71 
	}
}

73 
	$syn_ruË_şass_¡©e_Ãxt
(
qpŞ_™”©Ü_t
 * 
™”
)

75 
syn_ruË_şass_¡©e_t
 *
¤cs
 = 
NULL
;

77 ià(!
™”
 || !(
¤cs
 = (
syn_ruË_şass_¡©e_t
 *è
	`qpŞ_™”©Ü_¡©e
(iter))) {

78 
”ºo
 = 
EINVAL
;

79  
STATUS_ERR
;

81 ià(
	`qpŞ_™”©Ü_’d
(
™”
)) {

82 
”ºo
 = 
ERANGE
;

83  
STATUS_ERR
;

86 
¤cs
->
cur
 = srcs->cur->
Ãxt
;

88  
STATUS_SUCCESS
;

89 
	}
}

91 
size_t
 
	$syn_ruË_şass_¡©e_size
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

93 
syn_ruË_şass_¡©e_t
 *
¤cs
 = 
NULL
;

94 
size_t
 
couÁ
 = 0;

95 
şass_³rm_node_t
 *
ın
 = 
NULL
;

97 ià(!
™”
 || !(
¤cs
 = (
syn_ruË_şass_¡©e_t
 *è
	`qpŞ_™”©Ü_¡©e
(iter))) {

98 
”ºo
 = 
EINVAL
;

102 
ın
 = 
¤cs
->
h—d
; c²; c² = c²->
Ãxt
)

103 
couÁ
++;

105  
couÁ
;

106 
	}
}

108 
	ssyn_ruË_³rm_¡©e


110 **
	m³rm_li¡
;

111 
size_t
 
	m³rm_li¡_sz
;

112 
size_t
 
	mcur
;

113 } 
	tsyn_ruË_³rm_¡©e_t
;

115 
	$syn_ruË_³rm_¡©e_’d
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

117 
syn_ruË_³rm_¡©e_t
 *
¤ps
 = 
NULL
;

119 ià(!
™”
 || !(
¤ps
 = (
syn_ruË_³rm_¡©e_t
 *è
	`qpŞ_™”©Ü_¡©e
(iter))) {

120 
”ºo
 = 
EINVAL
;

121  
STATUS_ERR
;

124  (
¤ps
->
cur
 >ğ¤ps->
³rm_li¡_sz
 ? 1 : 0);

125 
	}
}

127 *
	$syn_ruË_³rm_¡©e_g‘_cur
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

129 
syn_ruË_³rm_¡©e_t
 *
¤ps
 = 
NULL
;

131 ià(!
™”
 || !(
¤ps
 = (
syn_ruË_³rm_¡©e_t
 *è
	`qpŞ_™”©Ü_¡©e
(™”)è|| 
	`qpŞ_™”©Ü_’d
(iter)) {

132 
”ºo
 = 
EINVAL
;

133  
NULL
;

136  
¤ps
->
³rm_li¡
[¤ps->
cur
];

137 
	}
}

139 
	$syn_ruË_³rm_¡©e_Ãxt
(
qpŞ_™”©Ü_t
 * 
™”
)

141 
syn_ruË_³rm_¡©e_t
 *
¤ps
 = 
NULL
;

143 ià(!
™”
 || !(
¤ps
 = (
syn_ruË_³rm_¡©e_t
 *è
	`qpŞ_™”©Ü_¡©e
(iter))) {

144 
”ºo
 = 
EINVAL
;

145  
STATUS_ERR
;

147 ià(
	`qpŞ_™”©Ü_’d
(
™”
)) {

148 
”ºo
 = 
ERANGE
;

149  
STATUS_ERR
;

152 
¤ps
->
cur
++;

154  
STATUS_SUCCESS
;

155 
	}
}

157 
size_t
 
	$syn_ruË_³rm_¡©e_size
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

159 
syn_ruË_³rm_¡©e_t
 *
¤ps
 = 
NULL
;

161 ià(!
™”
 || !(
¤ps
 = (
syn_ruË_³rm_¡©e_t
 *è
	`qpŞ_™”©Ü_¡©e
(iter))) {

162 
”ºo
 = 
EINVAL
;

163  
STATUS_ERR
;

166  
¤ps
->
³rm_li¡_sz
;

167 
	}
}

169 
	$syn_ruË_³rm_¡©e_ä“
(*
¡©e
)

171 
size_t
 
i
;

173 
syn_ruË_³rm_¡©e_t
 *
¤ps
 = (syn_ruË_³rm_¡©e_ˆ*è
¡©e
;

175 ià(!
¤ps
)

178 
i
 = 0; i < 
¤ps
->
³rm_li¡_sz
; i++)

179 
	`ä“
(
¤ps
->
³rm_li¡
[
i
]);

180 
	`ä“
(
¤ps
->
³rm_li¡
);

181 
	`ä“
(
¤ps
);

182 
	}
}

186 
	$qpŞ_ty³_£t_g‘_šşuded_ty³s_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_ty³_£t_t
 * 
ts
, 
qpŞ_™”©Ü_t
 ** 
™”
)

188 
ty³_£t_t
 *
š‹º®_ts
 = 
NULL
;

189 
eb™m­_¡©e_t
 *
es
 = 
NULL
;

190 
”rÜ
 = 0;

192 ià(
™”
)

193 *
™”
 = 
NULL
;

195 ià(!
pŞicy
 || !
ts
 || !
™”
) {

196 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

197 
”rÜ
 = 
EINVAL
;

198  
STATUS_ERR
;

201 
š‹º®_ts
 = (
ty³_£t_t
 *è
ts
;

203 
es
 = 
	`ÿÎoc
(1, (
eb™m­_¡©e_t
));

204 ià(!
es
) {

205 
”rÜ
 = 
”ºo
;

206 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

207 
”ºo
 = 
”rÜ
;

208  
STATUS_ERR
;

211 
es
->
bm­
 = &(
š‹º®_ts
->
ty³s
);

212 
es
->
cur
 =ƒs->
bm­
->
node
 ?ƒs->bm­->node->
¡¬tb™
 : 0;

214 ià(
	`qpŞ_™”©Ü_ü—‹
(
pŞicy
, 
es
, 
eb™m­_¡©e_g‘_cur_ty³
,

215 
eb™m­_¡©e_Ãxt
, 
eb™m­_¡©e_’d
, 
eb™m­_¡©e_size
, 
ä“
, 
™”
)) {

216 
	`ä“
(
es
);

217  
STATUS_ERR
;

220 ià(
es
->
bm­
->
node
 && !
	`eb™m­_g‘_b™
Ós->bm­,ƒs->
cur
))

221 
	`eb™m­_¡©e_Ãxt
(*
™”
);

223  
STATUS_SUCCESS
;

224 
	}
}

226 
	$qpŞ_ty³_£t_g‘_subŒaùed_ty³s_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_ty³_£t_t
 * 
ts
, 
qpŞ_™”©Ü_t
 ** 
™”
)

228 
ty³_£t_t
 *
š‹º®_ts
 = 
NULL
;

229 
eb™m­_¡©e_t
 *
es
 = 
NULL
;

230 
”rÜ
 = 0;

232 ià(
™”
)

233 *
™”
 = 
NULL
;

235 ià(!
pŞicy
 || !
ts
 || !
™”
) {

236 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

237 
”rÜ
 = 
EINVAL
;

238  
STATUS_ERR
;

241 
š‹º®_ts
 = (
ty³_£t_t
 *è
ts
;

243 
es
 = 
	`ÿÎoc
(1, (
eb™m­_¡©e_t
));

244 ià(!
es
) {

245 
”rÜ
 = 
”ºo
;

246 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

247 
”ºo
 = 
”rÜ
;

248  
STATUS_ERR
;

251 
es
->
bm­
 = &(
š‹º®_ts
->
Ãg£t
);

252 
es
->
cur
 =ƒs->
bm­
->
node
 ?ƒs->bm­->node->
¡¬tb™
 : 0;

254 ià(
	`qpŞ_™”©Ü_ü—‹
(
pŞicy
, 
es
, 
eb™m­_¡©e_g‘_cur_ty³
,

255 
eb™m­_¡©e_Ãxt
, 
eb™m­_¡©e_’d
, 
eb™m­_¡©e_size
, 
ä“
, 
™”
)) {

256 
	`ä“
(
es
);

257  
STATUS_ERR
;

260 ià(
es
->
bm­
->
node
 && !
	`eb™m­_g‘_b™
Ós->bm­,ƒs->
cur
))

261 
	`eb™m­_¡©e_Ãxt
(*
™”
);

263  
STATUS_SUCCESS
;

264 
	}
}

266 
	$qpŞ_ty³_£t_g‘_is_¡¬
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_ty³_£t_t
 * 
ts
, 
ušt32_t
 * 
is_¡¬
)

268 
ty³_£t_t
 *
š‹º®_ts
 = 
NULL
;

270 ià(
is_¡¬
)

271 *
is_¡¬
 = 0;

273 ià(!
pŞicy
 || !
ts
 || !
is_¡¬
) {

274 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

275 
”ºo
 = 
EINVAL
;

276  
STATUS_ERR
;

279 
š‹º®_ts
 = (
ty³_£t_t
 *è
ts
;

281 ià(
š‹º®_ts
->
æags
 =ğ
TYPE_STAR
)

282 *
is_¡¬
 = 1;

284  
STATUS_SUCCESS
;

285 
	}
}

287 
	$qpŞ_ty³_£t_g‘_is_comp
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_ty³_£t_t
 * 
ts
, 
ušt32_t
 * 
is_comp
)

289 
ty³_£t_t
 *
š‹º®_ts
 = 
NULL
;

291 ià(
is_comp
)

292 *
is_comp
 = 0;

294 ià(!
pŞicy
 || !
ts
 || !
is_comp
) {

295 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

296 
”ºo
 = 
EINVAL
;

297  
STATUS_ERR
;

300 
š‹º®_ts
 = (
ty³_£t_t
 *è
ts
;

302 ià(
š‹º®_ts
->
æags
 =ğ
TYPE_COMP
)

303 *
is_comp
 = 1;

305  
STATUS_SUCCESS
;

306 
	}
}

310 
	$qpŞ_syn_avruË_g‘_ruË_ty³
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_syn_avruË_t
 * 
ruË
, 
ušt32_t
 * 
ruË_ty³
)

312 
avruË_t
 *
š‹º®_ruË
 = 
NULL
;

314 ià(
ruË_ty³
)

315 *
ruË_ty³
 = 0;

317 ià(!
pŞicy
 || !
ruË
 || !
ruË_ty³
) {

318 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

319 
”ºo
 = 
EINVAL
;

320  
STATUS_ERR
;

323 
š‹º®_ruË
 = ((
qpŞ_syn_ruË
 *)
ruË
)->rule;

325 ià(
š‹º®_ruË
->
¥ecif›d
 =ğ
AVRULE_DONTAUDIT
)

326 *
ruË_ty³
 = 
QPOL_RULE_DONTAUDIT
;

328 *
ruË_ty³
 = 
š‹º®_ruË
->
¥ecif›d
;

330  
STATUS_SUCCESS
;

331 
	}
}

333 
	$qpŞ_syn_avruË_g‘_sourû_ty³_£t
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_syn_avruË_t
 * 
ruË
,

334 cÚ¡ 
qpŞ_ty³_£t_t
 ** 
sourû_£t
)

336 
avruË_t
 *
š‹º®_ruË
 = 
NULL
;

338 ià(
sourû_£t
)

339 *
sourû_£t
 = 
NULL
;

341 ià(!
pŞicy
 || !
ruË
 || !
sourû_£t
) {

342 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

343 
”ºo
 = 
EINVAL
;

344  
STATUS_ERR
;

347 
š‹º®_ruË
 = ((
qpŞ_syn_ruË
 *)
ruË
)->rule;

349 *
sourû_£t
 = (
qpŞ_ty³_£t_t
 *è(&
š‹º®_ruË
->
¡y³s
);

351  
STATUS_SUCCESS
;

352 
	}
}

354 
	$qpŞ_syn_avruË_g‘_rg‘_ty³_£t
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_syn_avruË_t
 * 
ruË
,

355 cÚ¡ 
qpŞ_ty³_£t_t
 ** 
rg‘_£t
)

357 
avruË_t
 *
š‹º®_ruË
 = 
NULL
;

359 ià(
rg‘_£t
)

360 *
rg‘_£t
 = 
NULL
;

362 ià(!
pŞicy
 || !
ruË
 || !
rg‘_£t
) {

363 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

364 
”ºo
 = 
EINVAL
;

365  
STATUS_ERR
;

368 
š‹º®_ruË
 = ((
qpŞ_syn_ruË
 *)
ruË
)->rule;

370 *
rg‘_£t
 = (
qpŞ_ty³_£t_t
 *è(&
š‹º®_ruË
->
‰y³s
);

372  
STATUS_SUCCESS
;

373 
	}
}

375 
	$qpŞ_syn_avruË_g‘_is_rg‘_£lf
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_syn_avruË_t
 * 
ruË
, 
ušt32_t
 * 
is_£lf
)

377 
avruË_t
 *
š‹º®_ruË
 = 
NULL
;

379 ià(
is_£lf
)

380 *
is_£lf
 = 0;

382 ià(!
pŞicy
 || !
ruË
 || !
is_£lf
) {

383 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

384 
”ºo
 = 
EINVAL
;

385  
STATUS_ERR
;

388 
š‹º®_ruË
 = ((
qpŞ_syn_ruË
 *)
ruË
)->rule;

390 ià(
š‹º®_ruË
->
æags
 & 
RULE_SELF
)

391 *
is_£lf
 = 1;

393  
STATUS_SUCCESS
;

394 
	}
}

396 
	$qpŞ_syn_avruË_g‘_şass_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_syn_avruË_t
 * 
ruË
, 
qpŞ_™”©Ü_t
 ** 
şas£s
)

398 
syn_ruË_şass_¡©e_t
 *
¤cs
 = 
NULL
;

399 
avruË_t
 *
š‹º®_ruË
 = 
NULL
;

400 
”rÜ
 = 0;

402 ià(
şas£s
)

403 *
şas£s
 = 
NULL
;

405 ià(!
pŞicy
 || !
ruË
 || !
şas£s
) {

406 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

407 
”ºo
 = 
EINVAL
;

408  
STATUS_ERR
;

411 ià(!(
¤cs
 = 
	`ÿÎoc
(1, (
syn_ruË_şass_¡©e_t
)))) {

412 
”rÜ
 = 
”ºo
;

413 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

414 
”ºo
 = 
”rÜ
;

415  
STATUS_ERR
;

418 
š‹º®_ruË
 = ((
qpŞ_syn_ruË
 *)
ruË
)->rule;

419 
¤cs
->
h—d
 = srcs->
cur
 = 
š‹º®_ruË
->
³rms
;

421 ià(
	`qpŞ_™”©Ü_ü—‹
(
pŞicy
, (*)
¤cs
,

422 
syn_ruË_şass_¡©e_g‘_cur
, 
syn_ruË_şass_¡©e_Ãxt
,

423 
syn_ruË_şass_¡©e_’d
, 
syn_ruË_şass_¡©e_size
, 
ä“
, 
şas£s
)) {

424 
”rÜ
 = 
”ºo
;

425 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

426 
	`ä“
(
¤cs
);

427 
”ºo
 = 
”rÜ
;

428  
STATUS_ERR
;

431  
STATUS_SUCCESS
;

432 
	}
}

434 
	$qpŞ_syn_avruË_g‘_³rm_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_syn_avruË_t
 * 
ruË
, 
qpŞ_™”©Ü_t
 ** 
³rms
)

436 
avruË_t
 *
š‹º®_ruË
 = 
NULL
;

437 
pŞicydb_t
 *
db
 = 
NULL
;

438 **
³rm_li¡
, *
tmp
 = 
NULL
, **
tmp_cİy
 = NULL;

439 
şass_³rm_node_t
 *
node
 = 
NULL
;

440 
size_t
 
node_num
 = 0, 
i
, 
cur
, 
³rm_li¡_sz
 = 0;

441 
”rÜ
 = 0;

442 
syn_ruË_³rm_¡©e_t
 *
¤ps
 = 
NULL
;

444 ià(
³rms
)

445 *
³rms
 = 
NULL
;

447 ià(!
pŞicy
 || !
ruË
 || !
³rms
) {

448 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

449 
”ºo
 = 
EINVAL
;

450  
STATUS_ERR
;

453 
db
 = &
pŞicy
->
p
->p;

454 
š‹º®_ruË
 = ((
qpŞ_syn_ruË
 *)
ruË
)->rule;

455 
node
 = 
š‹º®_ruË
->
³rms
;‚ode;‚odğnode->
Ãxt
)

456 
node_num
++;

459 
³rm_li¡
 = 
	`ÿÎoc
(
node_num
 * 32, (*));

460 ià(!
³rm_li¡
) {

461 
”rÜ
 = 
”ºo
;

462 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

463 
”ºo
 = 
”rÜ
;

464  
STATUS_ERR
;

467 
node
 = 
š‹º®_ruË
->
³rms
;‚ode;‚odğnode->
Ãxt
) {

468 
i
 = 0; i < 
db
->
şass_v®_to_¡ruù
[
node
->
tşass
 - 1]->
³rmissiÚs
.
Årim
; i++) {

469 ià(!(
node
->
d©a
 & (1 << 
i
)))

471 
tmp
 = 
	`£pŞ_av_to_¡ršg
(
db
, 
node
->
tşass
, (
£pŞ_acûss_veùÜ_t
è(1 << 
i
));

472 ià(
tmp
) {

473 
tmp
++;

474 
cur
 = 0; cu¸< 
³rm_li¡_sz
; cur++)

475 ià(!
	`¡rcmp
(
tmp
, 
³rm_li¡
[
cur
]))

477 ià(
cur
 < 
³rm_li¡_sz
)

479 
³rm_li¡
[
³rm_li¡_sz
] = 
	`¡rdup
(
tmp
);

480 ià(!(
³rm_li¡
[
³rm_li¡_sz
])) {

481 
”rÜ
 = 
”ºo
;

482 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

483 
”r
;

485 
³rm_li¡_sz
++;

487 
”rÜ
 = 
”ºo
;

488 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

489 
”r
;

495 
tmp_cİy
 = 
	`»®loc
(
³rm_li¡
, 
³rm_li¡_sz
 * (*));

496 ià(!
tmp_cİy
) {

497 
”rÜ
 = 
”ºo
;

498 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

499 
”r
;

501 
³rm_li¡
 = 
tmp_cİy
;

503 
¤ps
 = 
	`ÿÎoc
(1, (
syn_ruË_³rm_¡©e_t
));

504 ià(!
¤ps
) {

505 
”rÜ
 = 
”ºo
;

506 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

507 
”r
;

509 
¤ps
->
³rm_li¡
 =…erm_list;

510 
¤ps
->
³rm_li¡_sz
 =…erm_list_sz;

511 
¤ps
->
cur
 = 0;

513 ià(
	`qpŞ_™”©Ü_ü—‹
(
pŞicy
, (*)
¤ps
,

514 
syn_ruË_³rm_¡©e_g‘_cur
, 
syn_ruË_³rm_¡©e_Ãxt
,

515 
syn_ruË_³rm_¡©e_’d
, 
syn_ruË_³rm_¡©e_size
, 
syn_ruË_³rm_¡©e_ä“
, 
³rms
)) {

516 
”rÜ
 = 
”ºo
;

517 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

518 
”r
;

521  
STATUS_SUCCESS
;

523 
”r
:

524 
i
 = 0; i < 
³rm_li¡_sz
; i++)

525 
	`ä“
(
³rm_li¡
[
i
]);

526 
	`ä“
(
³rm_li¡
);

527 
”ºo
 = 
”rÜ
;

528  
STATUS_ERR
;

529 
	}
}

531 
	$qpŞ_syn_avruË_g‘_lš’o
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_syn_avruË_t
 * 
ruË
, *
lš’o
)

533 
avruË_t
 *
š‹º®_ruË
 = 
NULL
;

535 ià(
lš’o
)

536 *
lš’o
 = 0;

538 ià(!
pŞicy
 || !
ruË
 || !
lš’o
) {

539 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

540 
”ºo
 = 
EINVAL
;

541  
STATUS_ERR
;

544 
š‹º®_ruË
 = ((
qpŞ_syn_ruË
 *)
ruË
)->rule;

546 *
lš’o
 = 
š‹º®_ruË
->
lše
;

548  
STATUS_SUCCESS
;

549 
	}
}

551 
	$qpŞ_syn_avruË_g‘_cÚd
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_syn_avruË_t
 * 
ruË
, cÚ¡ 
qpŞ_cÚd_t
 ** 
cÚd
)

553 ià(
cÚd
)

554 *
cÚd
 = 
NULL
;

556 ià(!
pŞicy
 || !
ruË
 || !
cÚd
) {

557 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

558 
”ºo
 = 
EINVAL
;

559  
STATUS_ERR
;

562 *
cÚd
 = (
qpŞ_cÚd_t
 *è((
qpŞ_syn_ruË
 *)
ruË
)->cond;

563  
STATUS_SUCCESS
;

564 
	}
}

566 
	$qpŞ_syn_avruË_g‘_is_’abËd
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_syn_avruË_t
 * 
ruË
, 
ušt32_t
 * 
is_’abËd
)

568 
Œuth
;

569 ià(
is_’abËd
)

570 *
is_’abËd
 = 0;

572 ià(!
pŞicy
 || !
ruË
 || !
is_’abËd
) {

573 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

574 
”ºo
 = 
EINVAL
;

575  
STATUS_ERR
;

578 ià(!((
qpŞ_syn_ruË
 *)
ruË
)->
cÚd
)

579 *
is_’abËd
 = 1;

581 
Œuth
 = 
	`cÚd_ev®u©e_ex´
(&
pŞicy
->
p
->p, ((
qpŞ_syn_ruË
 *)
ruË
)->
cÚd
->
ex´
);

582 ià(
Œuth
 < 0) {

583 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ERANGE
));

584 
”ºo
 = 
ERANGE
;

585  
STATUS_ERR
;

587 ià(!((
qpŞ_syn_ruË
 *)
ruË
)->
cÚd_b¿nch
)

588 *
is_’abËd
 = 
Œuth
;

590 *
is_’abËd
 = 
Œuth
 ? 0 : 1;

592  
STATUS_SUCCESS
;

593 
	}
}

597 
	$qpŞ_syn_‹ruË_g‘_ruË_ty³
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_syn_‹ruË_t
 * 
ruË
, 
ušt32_t
 * 
ruË_ty³
)

599 
avruË_t
 *
š‹º®_ruË
 = 
NULL
;

601 ià(
ruË_ty³
)

602 *
ruË_ty³
 = 0;

604 ià(!
pŞicy
 || !
ruË
 || !
ruË_ty³
) {

605 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

606 
”ºo
 = 
EINVAL
;

607  
STATUS_ERR
;

610 
š‹º®_ruË
 = ((
qpŞ_syn_ruË
 *)
ruË
)->rule;

612 *
ruË_ty³
 = 
š‹º®_ruË
->
¥ecif›d
;

614  
STATUS_SUCCESS
;

615 
	}
}

617 
	$qpŞ_syn_‹ruË_g‘_sourû_ty³_£t
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_syn_‹ruË_t
 * 
ruË
,

618 cÚ¡ 
qpŞ_ty³_£t_t
 ** 
sourû_£t
)

620 
avruË_t
 *
š‹º®_ruË
 = 
NULL
;

622 ià(
sourû_£t
)

623 *
sourû_£t
 = 
NULL
;

625 ià(!
pŞicy
 || !
ruË
 || !
sourû_£t
) {

626 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

627 
”ºo
 = 
EINVAL
;

628  
STATUS_ERR
;

631 
š‹º®_ruË
 = ((
qpŞ_syn_ruË
 *)
ruË
)->rule;

633 *
sourû_£t
 = (
qpŞ_ty³_£t_t
 *è(&
š‹º®_ruË
->
¡y³s
);

635  
STATUS_SUCCESS
;

636 
	}
}

638 
	$qpŞ_syn_‹ruË_g‘_rg‘_ty³_£t
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_syn_‹ruË_t
 * 
ruË
,

639 cÚ¡ 
qpŞ_ty³_£t_t
 ** 
rg‘_£t
)

641 
avruË_t
 *
š‹º®_ruË
 = 
NULL
;

643 ià(
rg‘_£t
)

644 *
rg‘_£t
 = 
NULL
;

646 ià(!
pŞicy
 || !
ruË
 || !
rg‘_£t
) {

647 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

648 
”ºo
 = 
EINVAL
;

649  
STATUS_ERR
;

652 
š‹º®_ruË
 = ((
qpŞ_syn_ruË
 *)
ruË
)->rule;

654 *
rg‘_£t
 = (
qpŞ_ty³_£t_t
 *è(&
š‹º®_ruË
->
‰y³s
);

656  
STATUS_SUCCESS
;

657 
	}
}

659 
	$qpŞ_syn_‹ruË_g‘_şass_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_syn_‹ruË_t
 * 
ruË
, 
qpŞ_™”©Ü_t
 ** 
şas£s
)

661 
syn_ruË_şass_¡©e_t
 *
¤cs
 = 
NULL
;

662 
avruË_t
 *
š‹º®_ruË
 = 
NULL
;

663 
”rÜ
 = 0;

665 ià(
şas£s
)

666 *
şas£s
 = 
NULL
;

668 ià(!
pŞicy
 || !
ruË
 || !
şas£s
) {

669 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

670 
”ºo
 = 
EINVAL
;

671  
STATUS_ERR
;

674 ià(!(
¤cs
 = 
	`ÿÎoc
(1, (
syn_ruË_şass_¡©e_t
)))) {

675 
”rÜ
 = 
”ºo
;

676 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

677 
”ºo
 = 
”rÜ
;

678  
STATUS_ERR
;

681 
š‹º®_ruË
 = ((
qpŞ_syn_ruË
 *)
ruË
)->rule;

682 
¤cs
->
h—d
 = srcs->
cur
 = 
š‹º®_ruË
->
³rms
;

684 ià(
	`qpŞ_™”©Ü_ü—‹
(
pŞicy
, (*)
¤cs
,

685 
syn_ruË_şass_¡©e_g‘_cur
, 
syn_ruË_şass_¡©e_Ãxt
,

686 
syn_ruË_şass_¡©e_’d
, 
syn_ruË_şass_¡©e_size
, 
ä“
, 
şas£s
)) {

687 
”rÜ
 = 
”ºo
;

688 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

689 
	`ä“
(
¤cs
);

690 
”ºo
 = 
”rÜ
;

691  
STATUS_ERR
;

694  
STATUS_SUCCESS
;

695 
	}
}

697 
	$qpŞ_syn_‹ruË_g‘_deçuÉ_ty³
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_syn_‹ruË_t
 * 
ruË
, cÚ¡ 
qpŞ_ty³_t
 ** 
dæt
)

699 
avruË_t
 *
š‹º®_ruË
 = 
NULL
;

700 
pŞicydb_t
 *
db
 = 
NULL
;

702 ià(
dæt
)

703 *
dæt
 = 0;

705 ià(!
pŞicy
 || !
ruË
 || !
dæt
) {

706 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

707 
”ºo
 = 
EINVAL
;

708  
STATUS_ERR
;

711 
š‹º®_ruË
 = ((
qpŞ_syn_ruË
 *)
ruË
)->rule;

712 
db
 = &
pŞicy
->
p
->p;

715 *
dæt
 = (
qpŞ_ty³_t
 *è(
db
->
ty³_v®_to_¡ruù
[
š‹º®_ruË
->
³rms
->
d©a
 - 1]);

717  
STATUS_SUCCESS
;

718 
	}
}

720 
	$qpŞ_syn_‹ruË_g‘_lš’o
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_syn_‹ruË_t
 * 
ruË
, *
lš’o
)

722 
avruË_t
 *
š‹º®_ruË
 = 
NULL
;

724 ià(
lš’o
)

725 *
lš’o
 = 0;

727 ià(!
pŞicy
 || !
ruË
 || !
lš’o
) {

728 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

729 
”ºo
 = 
EINVAL
;

730  
STATUS_ERR
;

733 
š‹º®_ruË
 = ((
qpŞ_syn_ruË
 *)
ruË
)->rule;

735 *
lš’o
 = 
š‹º®_ruË
->
lše
;

737  
STATUS_SUCCESS
;

738 
	}
}

740 
	$qpŞ_syn_‹ruË_g‘_cÚd
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_syn_‹ruË_t
 * 
ruË
, cÚ¡ 
qpŞ_cÚd_t
 ** 
cÚd
)

742 ià(
cÚd
)

743 *
cÚd
 = 
NULL
;

745 ià(!
pŞicy
 || !
ruË
 || !
cÚd
) {

746 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

747 
”ºo
 = 
EINVAL
;

748  
STATUS_ERR
;

751 *
cÚd
 = (
qpŞ_cÚd_t
 *è((
qpŞ_syn_ruË
 *)
ruË
)->cond;

752  
STATUS_SUCCESS
;

753 
	}
}

755 
	$qpŞ_syn_‹ruË_g‘_is_’abËd
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_syn_‹ruË_t
 * 
ruË
, 
ušt32_t
 * 
is_’abËd
)

757 
Œuth
;

758 ià(
is_’abËd
)

759 *
is_’abËd
 = 0;

761 ià(!
pŞicy
 || !
ruË
 || !
is_’abËd
) {

762 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

763 
”ºo
 = 
EINVAL
;

764  
STATUS_ERR
;

767 ià(!((
qpŞ_syn_ruË
 *)
ruË
)->
cÚd
)

768 *
is_’abËd
 = 1;

770 
Œuth
 = 
	`cÚd_ev®u©e_ex´
(&
pŞicy
->
p
->p, ((
qpŞ_syn_ruË
 *)
ruË
)->
cÚd
->
ex´
);

771 ià(
Œuth
 < 0) {

772 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ERANGE
));

773 
”ºo
 = 
ERANGE
;

774  
STATUS_ERR
;

776 ià(!((
qpŞ_syn_ruË
 *)
ruË
)->
cÚd_b¿nch
)

777 *
is_’abËd
 = 
Œuth
;

779 *
is_’abËd
 = 
Œuth
 ? 0 : 1;

781  
STATUS_SUCCESS
;

782 
	}
}

	@libqpol/src/terule_query.c

26 
	~"™”©Ü_š‹º®.h
"

27 
	~<qpŞ/™”©Ü.h
>

28 
	~<qpŞ/pŞicy.h
>

29 
	~<qpŞ/‹ruË_qu”y.h
>

30 
	~<£pŞ/pŞicydb/pŞicydb.h
>

31 
	~<£pŞ/pŞicydb/avb.h
>

32 
	~<£pŞ/pŞicydb/ut.h
>

33 
	~<¡dlib.h
>

34 
	~"qpŞ_š‹º®.h
"

36 
	$qpŞ_pŞicy_g‘_‹ruË_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, 
ušt32_t
 
ruË_ty³_mask
, 
qpŞ_™”©Ü_t
 ** 
™”
)

38 
pŞicydb_t
 *
db
;

39 
avb_¡©e_t
 *
¡©e
;

41 ià(
™”
) {

42 *
™”
 = 
NULL
;

44 ià(
pŞicy
 =ğ
NULL
 || 
™”
 == NULL) {

45 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

46 
”ºo
 = 
EINVAL
;

47  
STATUS_ERR
;

51 ià(!
	`qpŞ_pŞicy_has_ÿ·b™y
(
pŞicy
, 
QPOL_CAP_RULES_LOADED
)) {

52 
	`ERR
(
pŞicy
, "%s", "Cannot geterules: Rules‚ot†oaded");

53 
”ºo
 = 
ENOTSUP
;

54  
STATUS_ERR
;

58 
db
 = &
pŞicy
->
p
->p;

60 
¡©e
 = 
	`ÿÎoc
(1, (
avb_¡©e_t
));

61 ià(
¡©e
 =ğ
NULL
) {

62 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

63 
”ºo
 = 
ENOMEM
;

64  
STATUS_ERR
;

66 
¡©e
->
ucÚd_b
 = &
db
->
‹_avb
;

67 
¡©e
->
cÚd_b
 = &
db
->
‹_cÚd_avb
;

68 
¡©e
->
ruË_ty³_mask
 =„ule_type_mask;

69 
¡©e
->
node
 = 
db
->
‹_avb
.
hbË
[0];

71 ià(
qpŞ_™”©Ü_ü—‹


72 (
pŞicy
, 
¡©e
, 
avb_¡©e_g‘_cur
, 
avb_¡©e_Ãxt
, 
avb_¡©e_’d
, 
avb_¡©e_size
, 
ä“
, 
™”
)) {

73 
	`ä“
(
¡©e
);

74  
STATUS_ERR
;

76 ià(
¡©e
->
node
 =ğ
NULL
 || !(¡©e->node->
key
.
¥ecif›d
 & s‹->
ruË_ty³_mask
)) {

77 
	`avb_¡©e_Ãxt
(*
™”
);

79  
STATUS_SUCCESS
;

80 
	}
}

82 
	$qpŞ_‹ruË_g‘_sourû_ty³
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_‹ruË_t
 * 
ruË
, cÚ¡ 
qpŞ_ty³_t
 ** 
sourû
)

84 
pŞicydb_t
 *
db
 = 
NULL
;

85 
avb_±r_t
 
‹ruË
 = 
NULL
;

87 ià(
sourû
) {

88 *
sourû
 = 
NULL
;

91 ià(!
pŞicy
 || !
ruË
 || !
sourû
) {

92 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

93 
”ºo
 = 
EINVAL
;

94  
STATUS_ERR
;

97 
db
 = &
pŞicy
->
p
->p;

98 
‹ruË
 = (
avb_±r_t
è
ruË
;

100 *
sourû
 = (
qpŞ_ty³_t
 *è
db
->
ty³_v®_to_¡ruù
[
‹ruË
->
key
.
sourû_ty³
 - 1];

102  
STATUS_SUCCESS
;

103 
	}
}

105 
	$qpŞ_‹ruË_g‘_rg‘_ty³
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_‹ruË_t
 * 
ruË
, cÚ¡ 
qpŞ_ty³_t
 ** 
rg‘
)

107 
pŞicydb_t
 *
db
 = 
NULL
;

108 
avb_±r_t
 
‹ruË
 = 
NULL
;

110 ià(
rg‘
) {

111 *
rg‘
 = 
NULL
;

114 ià(!
pŞicy
 || !
ruË
 || !
rg‘
) {

115 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

116 
”ºo
 = 
EINVAL
;

117  
STATUS_ERR
;

120 
db
 = &
pŞicy
->
p
->p;

121 
‹ruË
 = (
avb_±r_t
è
ruË
;

123 *
rg‘
 = (
qpŞ_ty³_t
 *è
db
->
ty³_v®_to_¡ruù
[
‹ruË
->
key
.
rg‘_ty³
 - 1];

125  
STATUS_SUCCESS
;

126 
	}
}

128 
	$qpŞ_‹ruË_g‘_objeù_şass
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_‹ruË_t
 * 
ruË
, cÚ¡ 
qpŞ_şass_t
 ** 
obj_şass
)

130 
pŞicydb_t
 *
db
 = 
NULL
;

131 
avb_±r_t
 
‹ruË
 = 
NULL
;

133 ià(
obj_şass
) {

134 *
obj_şass
 = 
NULL
;

137 ià(!
pŞicy
 || !
ruË
 || !
obj_şass
) {

138 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

139 
”ºo
 = 
EINVAL
;

140  
STATUS_ERR
;

143 
db
 = &
pŞicy
->
p
->p;

144 
‹ruË
 = (
avb_±r_t
è
ruË
;

146 *
obj_şass
 = (
qpŞ_şass_t
 *è
db
->
şass_v®_to_¡ruù
[
‹ruË
->
key
.
rg‘_şass
 - 1];

148  
STATUS_SUCCESS
;

149 
	}
}

151 
	$qpŞ_‹ruË_g‘_deçuÉ_ty³
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_‹ruË_t
 * 
ruË
, cÚ¡ 
qpŞ_ty³_t
 ** 
dæt
)

153 
pŞicydb_t
 *
db
 = 
NULL
;

154 
avb_±r_t
 
‹ruË
 = 
NULL
;

156 ià(
dæt
) {

157 *
dæt
 = 
NULL
;

160 ià(!
pŞicy
 || !
ruË
 || !
dæt
) {

161 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

162 
”ºo
 = 
EINVAL
;

163  
STATUS_ERR
;

166 
db
 = &
pŞicy
->
p
->p;

167 
‹ruË
 = (
avb_±r_t
è
ruË
;

169 *
dæt
 = (
qpŞ_ty³_t
 *è
db
->
ty³_v®_to_¡ruù
[
‹ruË
->
d©um
.
d©a
 - 1];

171  
STATUS_SUCCESS
;

172 
	}
}

174 
	$qpŞ_‹ruË_g‘_ruË_ty³
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_‹ruË_t
 * 
ruË
, 
ušt32_t
 * 
ruË_ty³
)

176 
pŞicydb_t
 *
db
 = 
NULL
;

177 
avb_±r_t
 
‹ruË
 = 
NULL
;

179 ià(
ruË_ty³
) {

180 *
ruË_ty³
 = 0;

183 ià(!
pŞicy
 || !
ruË
 || !
ruË_ty³
) {

184 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

185 
”ºo
 = 
EINVAL
;

186  
STATUS_ERR
;

189 
db
 = &
pŞicy
->
p
->p;

190 
‹ruË
 = (
avb_±r_t
è
ruË
;

192 *
ruË_ty³
 = (
‹ruË
->
key
.
¥ecif›d
 & (
QPOL_RULE_TYPE_TRANS
 | 
QPOL_RULE_TYPE_CHANGE
 | 
QPOL_RULE_TYPE_MEMBER
));

194  
STATUS_SUCCESS
;

195 
	}
}

197 
	$qpŞ_‹ruË_g‘_cÚd
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_‹ruË_t
 * 
ruË
, cÚ¡ 
qpŞ_cÚd_t
 ** 
cÚd
)

199 
avb_±r_t
 
‹ruË
 = 
NULL
;

201 ià(
cÚd
) {

202 *
cÚd
 = 
NULL
;

205 ià(!
pŞicy
 || !
ruË
 || !
cÚd
) {

206 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

207 
”ºo
 = 
EINVAL
;

208  
STATUS_ERR
;

211 
‹ruË
 = (
avb_±r_t
è
ruË
;

213 *
cÚd
 = (
qpŞ_cÚd_t
 *è
‹ruË
->
·r£_cÚ‹xt
;

215  
STATUS_SUCCESS
;

216 
	}
}

218 
	$qpŞ_‹ruË_g‘_is_’abËd
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_‹ruË_t
 * 
ruË
, 
ušt32_t
 * 
is_’abËd
)

220 
avb_±r_t
 
‹ruË
 = 
NULL
;

222 ià(
is_’abËd
) {

223 *
is_’abËd
 = 0;

226 ià(!
pŞicy
 || !
ruË
 || !
is_’abËd
) {

227 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

228 
”ºo
 = 
EINVAL
;

229  
STATUS_ERR
;

232 
‹ruË
 = (
avb_±r_t
è
ruË
;

234 *
is_’abËd
 = ((
‹ruË
->
m”ged
 & 
QPOL_COND_RULE_ENABLED
) ? 1 : 0);

236  
STATUS_SUCCESS
;

237 
	}
}

239 
	$qpŞ_‹ruË_g‘_which_li¡
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_‹ruË_t
 * 
ruË
, 
ušt32_t
 * 
which_li¡
)

241 
avb_±r_t
 
‹ruË
 = 
NULL
;

243 ià(
which_li¡
) {

244 *
which_li¡
 = 0;

247 ià(!
pŞicy
 || !
ruË
 || !
which_li¡
) {

248 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

249 
”ºo
 = 
EINVAL
;

250  
STATUS_ERR
;

253 
‹ruË
 = (
avb_±r_t
è
ruË
;

255 ià(!
‹ruË
->
·r£_cÚ‹xt
) {

256 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

257 
”ºo
 = 
EINVAL
;

258  
STATUS_ERR
;

261 *
which_li¡
 = ((
‹ruË
->
m”ged
 & 
QPOL_COND_RULE_LIST
) ? 1 : 0);

263  
STATUS_SUCCESS
;

264 
	}
}

	@libqpol/src/type_query.c

25 
	~<cÚfig.h
>

27 
	~<¡ddef.h
>

28 
	~<¡dšt.h
>

29 
	~<¡dlib.h
>

30 
	~<qpŞ/™”©Ü.h
>

31 
	~<qpŞ/pŞicy.h
>

32 
	~<£pŞ/pŞicydb/pŞicydb.h
>

33 
	~<£pŞ/pŞicydb/ex·nd.h
>

34 
	~"™”©Ü_š‹º®.h
"

35 
	~<qpŞ/ty³_qu”y.h
>

36 
	~"qpŞ_š‹º®.h
"

38 
	$qpŞ_pŞicy_g‘_ty³_by_Çme
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ *
Çme
, cÚ¡ 
qpŞ_ty³_t
 ** 
d©um
)

40 
hashb_d©um_t
 
š‹º®_d©um
;

41 
pŞicydb_t
 *
db
;

43 ià(
pŞicy
 =ğ
NULL
 || 
Çme
 =ğNULL || 
d©um
 == NULL) {

44 ià(
d©um
 !ğ
NULL
)

45 *
d©um
 = 
NULL
;

46 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

47 
”ºo
 = 
EINVAL
;

48  
STATUS_ERR
;

51 
db
 = &
pŞicy
->
p
->p;

52 
š‹º®_d©um
 = 
	`hashb_£¬ch
(
db
->
p_ty³s
.
bË
, (cÚ¡ 
hashb_key_t
)
Çme
);

53 ià(
š‹º®_d©um
 =ğ
NULL
) {

54 *
d©um
 = 
NULL
;

55 
	`ERR
(
pŞicy
, "could‚Ù fšd d©um fÜy³ %s", 
Çme
);

56 
”ºo
 = 
ENOENT
;

57  
STATUS_ERR
;

59 *
d©um
 = (
qpŞ_ty³_t
 *è
š‹º®_d©um
;

61  
STATUS_SUCCESS
;

62 
	}
}

64 
	$qpŞ_pŞicy_g‘_ty³_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, 
qpŞ_™”©Ü_t
 ** 
™”
)

66 
pŞicydb_t
 *
db
;

67 
”rÜ
 = 0;

68 
hash_¡©e_t
 *
hs
 = 
NULL
;

70 ià(
pŞicy
 =ğ
NULL
 || 
™”
 == NULL) {

71 ià(
™”
 !ğ
NULL
)

72 *
™”
 = 
NULL
;

73 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

74 
”ºo
 = 
EINVAL
;

75  
STATUS_ERR
;

78 
db
 = &
pŞicy
->
p
->p;

80 
hs
 = 
	`ÿÎoc
(1, (
hash_¡©e_t
));

81 ià(
hs
 =ğ
NULL
) {

82 
”rÜ
 = 
”ºo
;

83 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

84 
”ºo
 = 
”rÜ
;

85  
STATUS_ERR
;

87 
hs
->
bË
 = &
db
->
p_ty³s
.table;

88 
hs
->
node
 = (*(hs->
bË
))->
hbË
[0];

90 ià(
	`qpŞ_™”©Ü_ü—‹
(
pŞicy
, (*)
hs
, 
hash_¡©e_g‘_cur
,

91 
hash_¡©e_Ãxt
, 
hash_¡©e_’d
, 
hash_¡©e_size
, 
ä“
, 
™”
)) {

92 
	`ä“
(
hs
);

93  
STATUS_ERR
;

96 ià(
hs
->
node
 =ğ
NULL
)

97 
	`hash_¡©e_Ãxt
(*
™”
);

99  
STATUS_SUCCESS
;

100 
	}
}

102 
	$qpŞ_ty³_g‘_v®ue
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_ty³_t
 * 
d©um
, 
ušt32_t
 * 
v®ue
)

104 
ty³_d©um_t
 *
š‹º®_d©um
;

106 ià(
pŞicy
 =ğ
NULL
 || 
d©um
 =ğNULL || 
v®ue
 == NULL) {

107 ià(
v®ue
 !ğ
NULL
)

108 *
v®ue
 = 0;

109 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

110 
”ºo
 = 
EINVAL
;

111  
STATUS_ERR
;

114 
š‹º®_d©um
 = (
ty³_d©um_t
 *è
d©um
;

115 ià(
š‹º®_d©um
->
æavÜ
 =ğ
TYPE_ALIAS
) {

118 *
v®ue
 = 
š‹º®_d©um
->
´im¬y
;

120 *
v®ue
 = 
š‹º®_d©um
->
s
.value;

123  
STATUS_SUCCESS
;

124 
	}
}

137 
	$is_ty³_»®ly_ª_®Ÿs
(cÚ¡ 
ty³_d©um_t
 * 
d©um
)

139 ià(
d©um
->
´im¬y
 =ğ0 && d©um->
æavÜ
 =ğ
TYPE_TYPE
) {

142 ià(
d©um
->
æavÜ
 =ğ
TYPE_ALIAS
) {

146 
	}
}

148 
	$qpŞ_ty³_g‘_i§lŸs
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_ty³_t
 * 
d©um
, *
i§lŸs
)

150 
ty³_d©um_t
 *
š‹º®_d©um
;

152 ià(
pŞicy
 =ğ
NULL
 || 
d©um
 =ğNULL || 
i§lŸs
 == NULL) {

153 ià(
i§lŸs
 !ğ
NULL
)

154 *
i§lŸs
 = 0;

155 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

156 
”ºo
 = 
EINVAL
;

157  
STATUS_ERR
;

159 
š‹º®_d©um
 = (
ty³_d©um_t
 *è
d©um
;

160 *
i§lŸs
 = 
	`is_ty³_»®ly_ª_®Ÿs
(
š‹º®_d©um
);

162  
STATUS_SUCCESS
;

163 
	}
}

165 
	$qpŞ_ty³_g‘_i§‰r
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_ty³_t
 * 
d©um
, *
i§‰r
)

167 
ty³_d©um_t
 *
š‹º®_d©um
;

169 ià(
pŞicy
 =ğ
NULL
 || 
d©um
 =ğNULL || 
i§‰r
 == NULL) {

170 ià(
i§‰r
 !ğ
NULL
)

171 *
i§‰r
 = 0;

172 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

173 
”ºo
 = 
EINVAL
;

174  
STATUS_ERR
;

177 
š‹º®_d©um
 = (
ty³_d©um_t
 *è
d©um
;

178 *
i§‰r
 = (
š‹º®_d©um
->
æavÜ
 =ğ
TYPE_ATTRIB
 ? 1 : 0);

180  
STATUS_SUCCESS
;

181 
	}
}

183 
	$qpŞ_ty³_g‘_i¥”missive
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_ty³_t
 * 
d©um
, *
i¥”missive
)

185 ià(
pŞicy
 =ğ
NULL
 || 
d©um
 =ğNULL || 
i¥”missive
 == NULL) {

186 ià(
i¥”missive
 !ğ
NULL
)

187 *
i¥”missive
 = 0;

188 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

189 
”ºo
 = 
EINVAL
;

190  
STATUS_ERR
;

192 #ifdeà
HAVE_SEPOL_PERMISSIVE_TYPES


196 
ušt32_t
 
v®ue
;

197 ià(
	`qpŞ_ty³_g‘_v®ue
(
pŞicy
, 
d©um
, &
v®ue
) < 0) {

198  
STATUS_ERR
;

200 
pŞicydb_t
 *
p
 = &
pŞicy
->p->p;

203 *
i¥”missive
 = 
	`eb™m­_g‘_b™
(&
p
->
³rmissive_m­
, 
v®ue
);

205 *
i¥”missive
 = 0;

208  
STATUS_SUCCESS
;

209 
	}
}

211 
	$qpŞ_ty³_g‘_ty³_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_ty³_t
 * 
d©um
, 
qpŞ_™”©Ü_t
 ** 
ty³s
)

213 
ty³_d©um_t
 *
š‹º®_d©um
 = 
NULL
;

214 
eb™m­_¡©e_t
 *
es
 = 
NULL
;

215 
”rÜ
 = 0;

217 ià(
ty³s
 !ğ
NULL
)

218 *
ty³s
 = 
NULL
;

220 ià(
pŞicy
 =ğ
NULL
 || 
d©um
 =ğNULL || 
ty³s
 == NULL) {

221 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

222 
”ºo
 = 
EINVAL
;

223  
STATUS_ERR
;

226 
š‹º®_d©um
 = (
ty³_d©um_t
 *è
d©um
;

228 ià(
š‹º®_d©um
->
æavÜ
 !ğ
TYPE_ATTRIB
) {

229 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

230 
”ºo
 = 
EINVAL
;

231  
STATUS_NODATA
;

234 
es
 = 
	`ÿÎoc
(1, (
eb™m­_¡©e_t
));

235 ià(
es
 =ğ
NULL
) {

236 
”rÜ
 = 
”ºo
;

237 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

238 
”ºo
 = 
”rÜ
;

239  
STATUS_ERR
;

242 
es
->
bm­
 = &(
š‹º®_d©um
->
ty³s
);

243 
es
->
cur
 =ƒs->
bm­
->
node
 ?ƒs->bm­->node->
¡¬tb™
 : 0;

245 ià(
	`qpŞ_™”©Ü_ü—‹
(
pŞicy
, 
es
, 
eb™m­_¡©e_g‘_cur_ty³
,

246 
eb™m­_¡©e_Ãxt
, 
eb™m­_¡©e_’d
, 
eb™m­_¡©e_size
, 
ä“
, 
ty³s
)) {

247 
	`ä“
(
es
);

248  
STATUS_ERR
;

251 ià(
es
->
bm­
->
node
 && !
	`eb™m­_g‘_b™
Ós->bm­,ƒs->
cur
))

252 
	`eb™m­_¡©e_Ãxt
(*
ty³s
);

254  
STATUS_SUCCESS
;

255 
	}
}

257 
	$qpŞ_ty³_g‘_©Œ_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_ty³_t
 * 
d©um
, 
qpŞ_™”©Ü_t
 ** 
©Œs
)

259 
ty³_d©um_t
 *
š‹º®_d©um
 = 
NULL
;

260 
eb™m­_¡©e_t
 *
es
 = 
NULL
;

261 
”rÜ
 = 0;

263 ià(
©Œs
 !ğ
NULL
)

264 *
©Œs
 = 
NULL
;

266 ià(
pŞicy
 =ğ
NULL
 || 
d©um
 =ğNULL || 
©Œs
 == NULL) {

267 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

268 
”ºo
 = 
EINVAL
;

269  
STATUS_ERR
;

272 
š‹º®_d©um
 = (
ty³_d©um_t
 *è
d©um
;

274 ià(
š‹º®_d©um
->
æavÜ
 =ğ
TYPE_ATTRIB
) {

275 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

276 
”ºo
 = 
EINVAL
;

277  
STATUS_NODATA
;

280 
es
 = 
	`ÿÎoc
(1, (
eb™m­_¡©e_t
));

281 ià(
es
 =ğ
NULL
) {

282 
”rÜ
 = 
”ºo
;

283 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

284 
”ºo
 = 
”rÜ
;

285  
STATUS_ERR
;

288 
es
->
bm­
 = &(
š‹º®_d©um
->
ty³s
);

289 
es
->
cur
 =ƒs->
bm­
->
node
 ?ƒs->bm­->node->
¡¬tb™
 : 0;

291 ià(
	`qpŞ_™”©Ü_ü—‹
(
pŞicy
, 
es
, 
eb™m­_¡©e_g‘_cur_ty³
,

292 
eb™m­_¡©e_Ãxt
, 
eb™m­_¡©e_’d
, 
eb™m­_¡©e_size
, 
ä“
, 
©Œs
)) {

293 
	`ä“
(
es
);

294  
STATUS_ERR
;

297 ià(
es
->
bm­
->
node
 && !
	`eb™m­_g‘_b™
Ós->bm­,ƒs->
cur
))

298 
	`eb™m­_¡©e_Ãxt
(*
©Œs
);

300  
STATUS_SUCCESS
;

301 
	}
}

303 
	$qpŞ_ty³_g‘_Çme
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_ty³_t
 * 
d©um
, cÚ¡ **
Çme
)

305 
ty³_d©um_t
 *
š‹º®_d©um
 = 
NULL
;

306 
pŞicydb_t
 *
db
 = 
NULL
;

308 ià(
pŞicy
 =ğ
NULL
 || 
d©um
 =ğNULL || 
Çme
 == NULL) {

309 ià(
Çme
 !ğ
NULL
)

310 *
Çme
 = 
NULL
;

311 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

312 
”ºo
 = 
EINVAL
;

313  
STATUS_ERR
;

316 
db
 = &
pŞicy
->
p
->p;

317 
š‹º®_d©um
 = (
ty³_d©um_t
 *è
d©um
;

319 *
Çme
 = 
db
->
p_ty³_v®_to_Çme
[
š‹º®_d©um
->
s
.
v®ue
 - 1];

321  
STATUS_SUCCESS
;

322 
	}
}

324 
	sty³_®Ÿs_hash_¡©e


326 
	mbuck‘
;

327 
hashb_node_t
 *
	mnode
;

328 
hashb_t
 *
	mbË
;

329 
ušt32_t
 
	mv®
;

330 } 
	tty³_®Ÿs_hash_¡©e_t
;

341 
ušt32_t
 
	$g‘_®Ÿs_´im¬y
(cÚ¡ 
ty³_d©um_t
 * 
d©um
)

343 ià(
d©um
->
æavÜ
 =ğ
TYPE_TYPE
) {

344  
d©um
->
s
.
v®ue
;

346  
d©um
->
´im¬y
;

348 
	}
}

350 
	$hash_¡©e_Ãxt_ty³_®Ÿs
(
qpŞ_™”©Ü_t
 * 
™”
)

352 
ty³_®Ÿs_hash_¡©e_t
 *
hs
 = 
NULL
;

353 
ty³_d©um_t
 *
d©um
 = 
NULL
;

355 ià(
™”
 =ğ
NULL
) {

356 
”ºo
 = 
EINVAL
;

357  
STATUS_ERR
;

359 
hs
 = (
ty³_®Ÿs_hash_¡©e_t
 *è
	`qpŞ_™”©Ü_¡©e
(
™”
);

360 ià(
hs
 =ğ
NULL
) {

361 
”ºo
 = 
EINVAL
;

362  
STATUS_ERR
;

365 ià(
hs
->
buck‘
 >ğ(*(hs->
bË
))->
size
) {

366 
”ºo
 = 
ERANGE
;

367  
STATUS_ERR
;

371 
	`hash_¡©e_Ãxt
(
™”
);

372 
d©um
 = 
hs
->
node
 ? (
ty³_d©um_t
 *èhs->node->d©um : 
NULL
;

373 } 
d©um
 !ğ
NULL
 && (
hs
->
v®
 !ğ
	`g‘_®Ÿs_´im¬y
(d©umè|| !
	`is_ty³_»®ly_ª_®Ÿs
(datum)));

375  
STATUS_SUCCESS
;

376 
	}
}

378 *
	$hash_¡©e_g‘_cur_®Ÿs
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

380 
ty³_®Ÿs_hash_¡©e_t
 *
hs
 = 
NULL
;

382 ià(
™”
 =ğ
NULL
) {

383 
”ºo
 = 
EINVAL
;

384  
NULL
;

386 
hs
 = (
ty³_®Ÿs_hash_¡©e_t
 *è
	`qpŞ_™”©Ü_¡©e
(
™”
);

387 ià(
hs
 =ğ
NULL
) {

388 
”ºo
 = 
EINVAL
;

389  
NULL
;

392 ià(
hs
->
buck‘
 >ğ(*(hs->
bË
))->
size
) {

393 
”ºo
 = 
ERANGE
;

394  
NULL
;

397  
hs
->
node
->
key
;

398 
	}
}

400 
size_t
 
	$hash_®Ÿs_¡©e_size
(cÚ¡ 
qpŞ_™”©Ü_t
 * 
™”
)

402 
ty³_®Ÿs_hash_¡©e_t
 *
hs
 = 
NULL
;

403 
ty³_d©um_t
 *
tmp_d©um
;

404 
hashb_node_t
 *
tmp_node
;

405 
ušt32_t
 
tmp_buck‘
 = 0;

406 
size_t
 
couÁ
 = 0;

408 ià(
™”
 =ğ
NULL
 || 
	`qpŞ_™”©Ü_¡©e
(iter) == NULL) {

409 
”ºo
 = 
EINVAL
;

413 
hs
 = (
ty³_®Ÿs_hash_¡©e_t
 *è
	`qpŞ_™”©Ü_¡©e
(
™”
);

415 
tmp_buck‘
 = 0;mp_buck‘ < (*(
hs
->
bË
))->
size
;mp_bucket++) {

416 
tmp_node
 = (*(
hs
->
bË
))->
hbË
[
tmp_buck‘
];mp_node;mp_nodğtmp_node->
Ãxt
) {

417 
tmp_d©um
 = 
tmp_node
 ?mp_node->
d©um
 : 
NULL
;

418 ià(
tmp_d©um
) {

419 ià(
hs
->
v®
 =ğ
	`g‘_®Ÿs_´im¬y
(
tmp_d©um
è&& 
	`is_ty³_»®ly_ª_®Ÿs
(tmp_datum)) {

420 
couÁ
++;

425  
couÁ
;

426 
	}
}

428 
	$qpŞ_ty³_g‘_®Ÿs_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_ty³_t
 * 
d©um
, 
qpŞ_™”©Ü_t
 ** 
®Ÿ£s
)

430 
ty³_d©um_t
 *
š‹º®_d©um
 = 
NULL
;

431 
pŞicydb_t
 *
db
 = 
NULL
;

432 
”rÜ
 = 0;

433 
ty³_®Ÿs_hash_¡©e_t
 *
hs
 = 
NULL
;

435 ià(
pŞicy
 =ğ
NULL
 || 
d©um
 =ğNULL || 
®Ÿ£s
 == NULL) {

436 ià(
®Ÿ£s
 !ğ
NULL
)

437 *
®Ÿ£s
 = 
NULL
;

438 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

439 
”ºo
 = 
EINVAL
;

440  
STATUS_ERR
;

443 
db
 = &
pŞicy
->
p
->p;

444 
š‹º®_d©um
 = (
ty³_d©um_t
 *è
d©um
;

446 
hs
 = 
	`ÿÎoc
(1, (
ty³_®Ÿs_hash_¡©e_t
));

447 ià(
hs
 =ğ
NULL
) {

448 
”rÜ
 = 
”ºo
;

449 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

450 
”ºo
 = 
”rÜ
;

451  
STATUS_ERR
;

453 
hs
->
bË
 = &
db
->
p_ty³s
.table;

454 
hs
->
node
 = (*(hs->
bË
))->
hbË
[0];

455 
hs
->
v®
 = 
	`g‘_®Ÿs_´im¬y
(
š‹º®_d©um
);

457 ià(
	`qpŞ_™”©Ü_ü—‹
(
pŞicy
, (*)
hs
, 
hash_¡©e_g‘_cur_®Ÿs
,

458 
hash_¡©e_Ãxt_ty³_®Ÿs
, 
hash_¡©e_’d
, 
hash_®Ÿs_¡©e_size
, 
ä“
, 
®Ÿ£s
)) {

459 
	`ä“
(
hs
);

460  
STATUS_ERR
;

463 ià(
hs
->
node
 =ğ
NULL
 || hs->
v®
 !ğ
	`g‘_®Ÿs_´im¬y
((
ty³_d©um_t
 *è(hs->node->
d©um
)) ||

464 !
	`is_ty³_»®ly_ª_®Ÿs
((
ty³_d©um_t
 *è
hs
->
node
->
d©um
))

465 
	`hash_¡©e_Ãxt_ty³_®Ÿs
(*
®Ÿ£s
);

467  
STATUS_SUCCESS
;

468 
	}
}

	@libqpol/src/user_query.c

25 
	~<cÚfig.h
>

27 
	~<¡ddef.h
>

28 
	~<¡dšt.h
>

29 
	~<¡dlib.h
>

31 
	~<£pŞ/pŞicydb/pŞicydb.h
>

32 
	~<£pŞ/pŞicydb/ex·nd.h
>

34 
	~<qpŞ/™”©Ü.h
>

35 
	~<qpŞ/mls_qu”y.h
>

36 
	~<qpŞ/pŞicy.h
>

37 
	~<qpŞ/rŞe_qu”y.h
>

38 
	~<qpŞ/u£r_qu”y.h
>

39 
	~"™”©Ü_š‹º®.h
"

40 
	~"qpŞ_š‹º®.h
"

42 
	$qpŞ_pŞicy_g‘_u£r_by_Çme
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ *
Çme
, cÚ¡ 
qpŞ_u£r_t
 ** 
d©um
)

44 
hashb_d©um_t
 
š‹º®_d©um
;

45 
pŞicydb_t
 *
db
;

47 ià(
pŞicy
 =ğ
NULL
 || 
Çme
 =ğNULL || 
d©um
 == NULL) {

48 ià(
d©um
 !ğ
NULL
)

49 *
d©um
 = 
NULL
;

50 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

51 
”ºo
 = 
EINVAL
;

52  
STATUS_ERR
;

55 
db
 = &
pŞicy
->
p
->p;

56 
š‹º®_d©um
 = 
	`hashb_£¬ch
(
db
->
p_u£rs
.
bË
, (cÚ¡ 
hashb_key_t
)
Çme
);

57 ià(
š‹º®_d©um
 =ğ
NULL
) {

58 *
d©um
 = 
NULL
;

59 
	`ERR
(
pŞicy
, "could‚Ù fšd d©um fÜ u£¸%s", 
Çme
);

60 
”ºo
 = 
ENOENT
;

61  
STATUS_ERR
;

63 *
d©um
 = (
qpŞ_u£r_t
 *è
š‹º®_d©um
;

65  
STATUS_SUCCESS
;

66 
	}
}

68 
	$qpŞ_pŞicy_g‘_u£r_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, 
qpŞ_™”©Ü_t
 ** 
™”
)

70 
pŞicydb_t
 *
db
;

71 
hash_¡©e_t
 *
hs
 = 
NULL
;

72 
”rÜ
 = 0;

74 ià(
pŞicy
 =ğ
NULL
 || 
™”
 == NULL) {

75 ià(
™”
 !ğ
NULL
)

76 *
™”
 = 
NULL
;

77 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

78 
”ºo
 = 
EINVAL
;

79  
STATUS_ERR
;

82 
db
 = &
pŞicy
->
p
->p;

84 
hs
 = 
	`ÿÎoc
(1, (
hash_¡©e_t
));

85 ià(
hs
 =ğ
NULL
) {

86 
”rÜ
 = 
”ºo
;

87 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

88 
”ºo
 = 
”rÜ
;

89  
STATUS_ERR
;

91 
hs
->
bË
 = &
db
->
p_u£rs
.table;

92 
hs
->
node
 = (*(hs->
bË
))->
hbË
[0];

94 ià(
	`qpŞ_™”©Ü_ü—‹
(
pŞicy
, (*)
hs
, 
hash_¡©e_g‘_cur
,

95 
hash_¡©e_Ãxt
, 
hash_¡©e_’d
, 
hash_¡©e_size
, 
ä“
, 
™”
)) {

96 
	`ä“
(
hs
);

97  
STATUS_ERR
;

100 ià(
hs
->
node
 =ğ
NULL
)

101 
	`hash_¡©e_Ãxt
(*
™”
);

103  
STATUS_SUCCESS
;

104 
	}
}

106 
	$qpŞ_u£r_g‘_v®ue
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_u£r_t
 * 
d©um
, 
ušt32_t
 * 
v®ue
)

108 
u£r_d©um_t
 *
š‹º®_d©um
;

110 ià(
pŞicy
 =ğ
NULL
 || 
d©um
 =ğNULL || 
v®ue
 == NULL) {

111 ià(
v®ue
 !ğ
NULL
)

112 *
v®ue
 = 0;

113 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

114 
”ºo
 = 
EINVAL
;

115  
STATUS_ERR
;

118 
š‹º®_d©um
 = (
u£r_d©um_t
 *è
d©um
;

119 *
v®ue
 = 
š‹º®_d©um
->
s
.value;

121  
STATUS_SUCCESS
;

122 
	}
}

124 
	$qpŞ_u£r_g‘_rŞe_™”
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_u£r_t
 * 
d©um
, 
qpŞ_™”©Ü_t
 ** 
rŞes
)

126 
u£r_d©um_t
 *
š‹º®_d©um
 = 
NULL
;

127 
”rÜ
 = 0;

128 
eb™m­_¡©e_t
 *
es
 = 
NULL
;

130 ià(
pŞicy
 =ğ
NULL
 || 
d©um
 =ğNULL || 
rŞes
 == NULL) {

131 ià(
rŞes
 !ğ
NULL
)

132 *
rŞes
 = 
NULL
;

133 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

134 
”ºo
 = 
EINVAL
;

135  
STATUS_ERR
;

138 
š‹º®_d©um
 = (
u£r_d©um_t
 *è
d©um
;

140 
es
 = 
	`ÿÎoc
(1, (
eb™m­_¡©e_t
));

141 ià(
es
 =ğ
NULL
) {

142 
”rÜ
 = 
”ºo
;

143 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

144 
”ºo
 = 
”rÜ
;

145  
STATUS_ERR
;

148 
es
->
bm­
 = &(
š‹º®_d©um
->
rŞes
.roles);

149 
es
->
cur
 =ƒs->
bm­
->
node
 ?ƒs->bm­->node->
¡¬tb™
 : 0;

151 ià(
	`qpŞ_™”©Ü_ü—‹
(
pŞicy
, 
es
, 
eb™m­_¡©e_g‘_cur_rŞe
,

152 
eb™m­_¡©e_Ãxt
, 
eb™m­_¡©e_’d
, 
eb™m­_¡©e_size
, 
ä“
, 
rŞes
)) {

153 
	`ä“
(
es
);

154  
STATUS_ERR
;

157 ià(
es
->
bm­
->
node
 && !
	`eb™m­_g‘_b™
Ós->bm­,ƒs->
cur
))

158 
	`eb™m­_¡©e_Ãxt
(*
rŞes
);

160  
STATUS_SUCCESS
;

161 
	}
}

163 
	$qpŞ_u£r_g‘_¿nge
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_u£r_t
 * 
d©um
, cÚ¡ 
qpŞ_mls_¿nge_t
 ** 
¿nge
)

165 
u£r_d©um_t
 *
š‹º®_d©um
 = 
NULL
;

167 ià(
pŞicy
 =ğ
NULL
 || 
d©um
 =ğNULL || 
¿nge
 == NULL) {

168 ià(
¿nge
 !ğ
NULL
)

169 *
¿nge
 = 
NULL
;

170 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

171 
”ºo
 = 
EINVAL
;

172  
STATUS_ERR
;

175 ià(!
	`qpŞ_pŞicy_has_ÿ·b™y
(
pŞicy
, 
QPOL_CAP_MLS
)) {

176 *
¿nge
 = 
NULL
;

178 
š‹º®_d©um
 = (
u£r_d©um_t
 *è
d©um
;

179 *
¿nge
 = (
qpŞ_mls_¿nge_t
 *è& 
š‹º®_d©um
->
exp_¿nge
;

181  
STATUS_SUCCESS
;

182 
	}
}

184 
	$qpŞ_u£r_g‘_dæev–
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_u£r_t
 * 
d©um
, cÚ¡ 
qpŞ_mls_Ëv–_t
 ** 
Ëv–
)

186 
u£r_d©um_t
 *
š‹º®_d©um
 = 
NULL
;

188 ià(
pŞicy
 =ğ
NULL
 || 
d©um
 =ğNULL || 
Ëv–
 == NULL) {

189 ià(
Ëv–
 !ğ
NULL
)

190 *
Ëv–
 = 
NULL
;

191 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

192 
”ºo
 = 
EINVAL
;

193  
STATUS_ERR
;

196 ià(!
	`qpŞ_pŞicy_has_ÿ·b™y
(
pŞicy
, 
QPOL_CAP_MLS
)) {

197 *
Ëv–
 = 
NULL
;

199 
š‹º®_d©um
 = (
u£r_d©um_t
 *è
d©um
;

200 *
Ëv–
 = (
qpŞ_mls_Ëv–_t
 *è& 
š‹º®_d©um
->
exp_dæev–
;

202  
STATUS_SUCCESS
;

203 
	}
}

205 
	$qpŞ_u£r_g‘_Çme
(cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy
, cÚ¡ 
qpŞ_u£r_t
 * 
d©um
, cÚ¡ **
Çme
)

207 
u£r_d©um_t
 *
š‹º®_d©um
 = 
NULL
;

208 
pŞicydb_t
 *
db
 = 
NULL
;

210 ià(
pŞicy
 =ğ
NULL
 || 
d©um
 =ğNULL || 
Çme
 == NULL) {

211 ià(
Çme
 !ğ
NULL
)

212 *
Çme
 = 
NULL
;

213 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

214 
”ºo
 = 
EINVAL
;

215  
STATUS_ERR
;

218 
db
 = &
pŞicy
->
p
->p;

219 
š‹º®_d©um
 = (
u£r_d©um_t
 *è
d©um
;

221 *
Çme
 = 
db
->
p_u£r_v®_to_Çme
[
š‹º®_d©um
->
s
.
v®ue
 - 1];

223  
STATUS_SUCCESS
;

224 
	}
}

	@libqpol/src/util.c

26 
	~<cÚfig.h
>

28 
	~"qpŞ_š‹º®.h
"

30 
	~<qpŞ/ut.h
>

32 
	~<glob.h
>

33 
	~<”ºo.h
>

34 
	~<¡dio.h
>

35 
	~<¡dlib.h
>

36 
	~<¡ršg.h
>

37 
	~<uni¡d.h
>

38 
	~<sys/¡©.h
>

39 
	~<sys/ty³s.h
>

41 
	~<£lšux/£lšux.h
>

43 cÚ¡ *
	$libqpŞ_g‘_v”siÚ
()

45  
LIBQPOL_VERSION_STRING
;

46 
	}
}

48 
	$£¬ch_pŞicy_sourû_fe
(**
·th
)

50 
”rÜ
;

51 *
sourû_·th
;

52 ià(
	`a¥rštf
(&
sourû_·th
, "%s/¤c/pŞicy/pŞicy.cÚf", 
	`£lšux_pŞicy_roÙ
()) < 0) {

55 ià(
	`acûss
(
sourû_·th
, 
R_OK
) < 0) {

56 
”rÜ
 = 
”ºo
;

57 
	`ä“
(
sourû_·th
);

58 
”ºo
 = 
”rÜ
;

61 *
·th
 = 
sourû_·th
;

63 
	}
}

65 
	$g‘_bšpŞ_v”siÚ
(cÚ¡ *
pŞicy_âame
)

67 
FILE
 *
pŞicy_å
 = 
NULL
;

68 
»t_v”siÚ
, 
”rÜ
;

70 
pŞicy_å
 = 
	`fİ’
(
pŞicy_âame
, "r");

71 ià(
pŞicy_å
 =ğ
NULL
) {

74 ià(!
	`qpŞ_is_fe_bšpŞ
(
pŞicy_å
)) {

75 
”rÜ
 = 
”ºo
;

76 
	`fşo£
(
pŞicy_å
);

77 
”ºo
 = 
”rÜ
;

80 
»t_v”siÚ
 = 
	`qpŞ_bšpŞ_v”siÚ
(
pŞicy_å
);

81 
	`fşo£
(
pŞicy_å
);

82  
»t_v”siÚ
;

83 
	}
}

85 
	$£¬ch_pŞicy_bš¬y_fe
(**
·th
)

87 cÚ¡ *
bš¬y_·th
;

88 ià((
bš¬y_·th
 = 
	`£lšux_bš¬y_pŞicy_·th
()è=ğ
NULL
) {

92 
ex³ùed_v”siÚ
 = -1, 
Ï‹¡_v”siÚ
 = -1;

93 #ifdeà
LIBSELINUX


96 ià((
ex³ùed_v”siÚ
 = 
	`£cur™y_pŞicyv”s
()) < 0) {

101 
glob_t
 
glob_buf
;

102 
¡©
 
fs
;

103 
¹
, 
”rÜ
 = 0, 
»tv®
 = -1;

104 
size_t
 
i
;

105 *
·‰”n
 = 
NULL
;

106 ià(
	`a¥rštf
(&
·‰”n
, "%s.*", 
bš¬y_·th
) < 0) {

109 
glob_buf
.
gl_offs
 = 1;

110 
glob_buf
.
gl_·thc
 = 0;

111 
¹
 = 
	`glob
(
·‰”n
, 
GLOB_DOOFFS
, 
NULL
, &
glob_buf
);

112 ià(
¹
 !ğ0 &&„ˆ!ğ
GLOB_NOMATCH
) {

113 
”ºo
 = 
EIO
;

117 
i
 = 0; i < 
glob_buf
.
gl_·thc
; i++) {

118 *
p
 = 
glob_buf
.
gl_·thv
[
i
 + glob_buf.
gl_offs
];

119 ià(
	`¡©
(
p
, &
fs
) != 0) {

120 
”rÜ
 = 
”ºo
;

121 
ş—nup
;

123 ià(
	`S_ISDIR
(
fs
.
¡_mode
))

126 ià((
¹
 = 
	`g‘_bšpŞ_v”siÚ
(
p
)) < 0) {

127 
”rÜ
 = 
”ºo
;

128 
ş—nup
;

131 ià(
¹
 > 
Ï‹¡_v”siÚ
 ||„ˆ=ğ
ex³ùed_v”siÚ
) {

132 
	`ä“
(*
·th
);

133 ià((*
·th
 = 
	`¡rdup
(
p
)è=ğ
NULL
) {

134 
”rÜ
 = 
”ºo
;

135 
ş—nup
;

137 ià(
¹
 =ğ
ex³ùed_v”siÚ
) {

140 
Ï‹¡_v”siÚ
 = 
¹
;

144 ià(*
·th
 =ğ
NULL
) {

145 
»tv®
 = 1;

147 
»tv®
 = 0;

149 
ş—nup
:

150 
	`ä“
(
·‰”n
);

151 
	`globä“
(&
glob_buf
);

152 ià(
»tv®
 == -1) {

153 
”ºo
 = 
”rÜ
;

155  
»tv®
;

156 
	}
}

158 
	$qpŞ_deçuÉ_pŞicy_fšd
(**
·th
)

160 
¹
;

161 ià(
·th
 =ğ
NULL
) {

162 
”ºo
 = 
EINVAL
;

165 *
·th
 = 
NULL
;

168 ià((
¹
 = 
	`£¬ch_pŞicy_sourû_fe
(
·th
)) <= 0) {

169  
¹
;

172  
	`£¬ch_pŞicy_bš¬y_fe
(
·th
);

173 
	}
}

175 
	~<¡dlib.h
>

176 
	~<bzlib.h
>

177 
	~<¡ršg.h
>

178 
	~<sys/£ndfe.h
>

180 
	#BZ2_MAGICSTR
 "BZh"

	)

181 
	#BZ2_MAGICLEN
 ((
BZ2_MAGICSTR
)-1)

	)

187 
ssize_t
 
	$qpŞ_bunz
(
FILE
 *
f
, **
d©a
)

189 
BZFILE
* 
b
;

190 
size_t
 
nBuf
;

191 
buf
[1<<18];

192 
size_t
 
size
 = (
buf
);

193 
bz”rÜ
;

194 
size_t
 
tÙ®
=0;

195 
sm®l
=0;

197 
bz”rÜ
 = 
	`ä—d
(
buf
, 1, 
BZ2_MAGICLEN
, 
f
);

198 
	`»wšd
(
f
);

199 ià((
bz”rÜ
 !ğ
BZ2_MAGICLEN
è|| 
	`memcmp
(
buf
, 
BZ2_MAGICSTR
, BZ2_MAGICLEN))

202 
b
 = 
	`BZ2_bzR—dO³n
 ( &
bz”rÜ
, 
f
, 0, 
sm®l
, 
NULL
, 0 );

203 iàĞ
bz”rÜ
 !ğ
BZ_OK
 ) {

204 
	`BZ2_bzR—dClo£
 ( &
bz”rÜ
, 
b
 );

208 *
uncom´ess
 = 
	`»®loc
(
NULL
, 
size
);

210  
bz”rÜ
 =ğ
BZ_OK
) {

211 
nBuf
 = 
	`BZ2_bzR—d
 ( &
bz”rÜ
, 
b
, 
buf
, (buf));

212 ià(Ğ
bz”rÜ
 =ğ
BZ_OK
 ) || ( bz”rÜ =ğ
BZ_STREAM_END
 )) {

213 ià(
tÙ®
 + 
nBuf
 > 
size
) {

214 
size
 *= 2;

215 
uncom´ess
 = 
	`»®loc
(uncom´ess, 
size
);

217 
	`memıy
(&
uncom´ess
[
tÙ®
], 
buf
, 
nBuf
);

218 
tÙ®
 +ğ
nBuf
;

221 iàĞ
bz”rÜ
 !ğ
BZ_STREAM_END
 ) {

222 
	`BZ2_bzR—dClo£
 ( &
bz”rÜ
, 
b
 );

223 
	`ä“
(
uncom´ess
);

226 
	`BZ2_bzR—dClo£
 ( &
bz”rÜ
, 
b
 );

228 *
d©a
 = 
uncom´ess
;

229  
tÙ®
;

230 
	}
}

	@libqpol/tests/capabilities-tests.c

27 
	~<cÚfig.h
>

29 
	~<CUn™/CUn™.h
>

30 
	~<qpŞ/pŞicy.h
>

32 
	~<¡dboŞ.h
>

34 
	#POLICY_ROOT
 
TEST_POLICIES
 "/pŞicy-v”siÚs"

	)

36 
	sÿ·b™y_ªsw”


38 cÚ¡ *
	mpŞicy_Çme
;

39 
	mpŞicy_ty³
;

40 
	mpŞicy_v”siÚ
;

41 
boŞ
 
	mhas_©Œibu‹s
;

42 
boŞ
 
	mhas_syn_ruËs
;

43 
boŞ
 
	mhas_lše_numb”s
;

44 
boŞ
 
	mhas_cÚd™iÚ®s
;

45 
boŞ
 
	mhas_mls
;

46 
boŞ
 
	mhas_pŞÿps
;

47 
boŞ
 
	mhas_sourû
;

48 
boŞ
 
	mhas_moduËs
;

49 *
	m’fÜcšg_ty³
, *
	m³rmissive_ty³
;

52 
	$ÿ·b™y_‹¡
(cÚ¡ 
ÿ·b™y_ªsw”
 *
ÿ
)

54 
qpŞ_pŞicy_t
 *
q
 = 
NULL
;

55 
pŞicy_ty³
 = 
	`qpŞ_pŞicy_İ’_äom_fe
(
ÿ
->
pŞicy_Çme
, &
q
, 
NULL
, NULL, 
QPOL_POLICY_OPTION_NO_NEVERALLOWS
);

56 
	`CU_ASSERT_FATAL
(
pŞicy_ty³
 >= 0);

57 
	`CU_ASSERT_EQUAL
(
pŞicy_ty³
, 
ÿ
->policy_type);

59 
pŞicy_v”siÚ
;

60 
»tv®
;

61 
»tv®
 = 
	`qpŞ_pŞicy_g‘_pŞicy_v”siÚ
(
q
, &
pŞicy_v”siÚ
);

62 
	`CU_ASSERT_EQUAL_FATAL
(
»tv®
, 0);

63 
	`CU_ASSERT_EQUAL
(
pŞicy_v”siÚ
, 
ÿ
->policy_version);

65 
boŞ
 
ÿp
;

67 
ÿp
 = (
boŞ
è
	`qpŞ_pŞicy_has_ÿ·b™y
(
q
, 
QPOL_CAP_ATTRIB_NAMES
);

68 
	`CU_ASSERT_EQUAL
(
ÿp
, 
ÿ
->
has_©Œibu‹s
);

70 
ÿp
 = (
boŞ
è
	`qpŞ_pŞicy_has_ÿ·b™y
(
q
, 
QPOL_CAP_SYN_RULES
);

71 
	`CU_ASSERT_EQUAL
(
ÿp
, 
ÿ
->
has_syn_ruËs
);

73 
ÿp
 = (
boŞ
è
	`qpŞ_pŞicy_has_ÿ·b™y
(
q
, 
QPOL_CAP_LINE_NUMBERS
);

74 
	`CU_ASSERT_EQUAL
(
ÿp
, 
ÿ
->
has_lše_numb”s
);

76 
ÿp
 = (
boŞ
è
	`qpŞ_pŞicy_has_ÿ·b™y
(
q
, 
QPOL_CAP_CONDITIONALS
);

77 
	`CU_ASSERT_EQUAL
(
ÿp
, 
ÿ
->
has_cÚd™iÚ®s
);

79 
ÿp
 = (
boŞ
è
	`qpŞ_pŞicy_has_ÿ·b™y
(
q
, 
QPOL_CAP_MLS
);

80 
	`CU_ASSERT_EQUAL
(
ÿp
, 
ÿ
->
has_mls
);

82 
ÿp
 = (
boŞ
è
	`qpŞ_pŞicy_has_ÿ·b™y
(
q
, 
QPOL_CAP_POLCAPS
);

83 
	`CU_ASSERT_EQUAL
(
ÿp
, 
ÿ
->
has_pŞÿps
);

85 
ÿp
 = (
boŞ
è
	`qpŞ_pŞicy_has_ÿ·b™y
(
q
, 
QPOL_CAP_SOURCE
);

86 
	`CU_ASSERT_EQUAL
(
ÿp
, 
ÿ
->
has_sourû
);

88 
ÿp
 = (
boŞ
è
	`qpŞ_pŞicy_has_ÿ·b™y
(
q
, 
QPOL_CAP_MODULES
);

89 
	`CU_ASSERT_EQUAL
(
ÿp
, 
ÿ
->
has_moduËs
);

91 
i¥”missive
;

92 cÚ¡ 
qpŞ_ty³_t
 *
ty³
;

94 ià(
ÿ
->
’fÜcšg_ty³
 !ğ
NULL
) {

95 
»tv®
 = 
	`qpŞ_pŞicy_g‘_ty³_by_Çme
(
q
, 
ÿ
->
’fÜcšg_ty³
, &
ty³
);

96 
	`CU_ASSERT
(
»tv®
 =ğ0 && 
ty³
 !ğ
NULL
);

97 
»tv®
 = 
	`qpŞ_ty³_g‘_i¥”missive
(
q
, 
ty³
, &
i¥”missive
);

98 
	`CU_ASSERT
(
»tv®
 =ğ0 && 
i¥”missive
 == 0);

100 ià(
ÿ
->
³rmissive_ty³
 !ğ
NULL
) {

101 
»tv®
 = 
	`qpŞ_pŞicy_g‘_ty³_by_Çme
(
q
, 
ÿ
->
³rmissive_ty³
, &
ty³
);

102 
	`CU_ASSERT
(
»tv®
 =ğ0 && 
ty³
 !ğ
NULL
);

103 
»tv®
 = 
	`qpŞ_ty³_g‘_i¥”missive
(
q
, 
ty³
, &
i¥”missive
);

104 
	`CU_ASSERT
(
»tv®
 =ğ0 && 
i¥”missive
 == 1);

107 
	`qpŞ_pŞicy_de¡roy
(&
q
);

108 
	}
}

110 
	$ÿ·b™y_v12_sourû
()

112 
ÿ·b™y_ªsw”
 
ÿp
 = {

113 
POLICY_ROOT
 "/policy-12.conf",

114 
QPOL_POLICY_KERNEL_SOURCE
,

116 
Œue
,

117 
Œue
,

118 
Œue
,

119 
çl£
,

120 
çl£
,

121 
çl£
,

122 
Œue
,

123 
çl£
,

124 "fs_t", 
NULL


126 
	`ÿ·b™y_‹¡
(&
ÿp
);

127 
	}
}

129 
	$ÿ·b™y_v15_sourû
()

131 
ÿ·b™y_ªsw”
 
ÿp
 = {

132 
POLICY_ROOT
 "/policy-15.conf",

133 
QPOL_POLICY_KERNEL_SOURCE
,

135 
Œue
,

136 
Œue
,

137 
Œue
,

138 
çl£
,

139 
çl£
,

140 
çl£
,

141 
Œue
,

142 
çl£
,

143 "fs_t", 
NULL


145 
	`ÿ·b™y_‹¡
(&
ÿp
);

146 
	}
}

148 
	$ÿ·b™y_v15_bš¬y
()

150 
ÿ·b™y_ªsw”
 
ÿp
 = {

151 
POLICY_ROOT
 "/policy.15",

152 
QPOL_POLICY_KERNEL_BINARY
,

154 
çl£
,

155 
çl£
,

156 
çl£
,

157 
çl£
,

158 
çl£
,

159 
çl£
,

160 
çl£
,

161 
çl£
,

162 "fs_t", 
NULL


164 
	`ÿ·b™y_‹¡
(&
ÿp
);

165 
	}
}

167 
	$ÿ·b™y_v16_sourû
()

169 
ÿ·b™y_ªsw”
 
ÿp
 = {

170 
POLICY_ROOT
 "/policy-16.conf",

171 
QPOL_POLICY_KERNEL_SOURCE
,

173 
Œue
,

174 
Œue
,

175 
Œue
,

176 
Œue
,

177 
çl£
,

178 
çl£
,

179 
Œue
,

180 
çl£
,

181 "fs_t", 
NULL


183 
	`ÿ·b™y_‹¡
(&
ÿp
);

184 
	}
}

186 
	$ÿ·b™y_v16_bš¬y
()

188 
ÿ·b™y_ªsw”
 
ÿp
 = {

189 
POLICY_ROOT
 "/policy.16",

190 
QPOL_POLICY_KERNEL_BINARY
,

192 
çl£
,

193 
çl£
,

194 
çl£
,

195 
Œue
,

196 
çl£
,

197 
çl£
,

198 
çl£
,

199 
çl£
,

200 "fs_t", 
NULL


202 
	`ÿ·b™y_‹¡
(&
ÿp
);

203 
	}
}

205 
	$ÿ·b™y_v17_sourû
()

207 
ÿ·b™y_ªsw”
 
ÿp
 = {

208 
POLICY_ROOT
 "/policy-17.conf",

209 
QPOL_POLICY_KERNEL_SOURCE
,

211 
Œue
,

212 
Œue
,

213 
Œue
,

214 
Œue
,

215 
çl£
,

216 
çl£
,

217 
Œue
,

218 
çl£
,

219 "fs_t", 
NULL


221 
	`ÿ·b™y_‹¡
(&
ÿp
);

222 
	}
}

224 
	$ÿ·b™y_v17_bš¬y
()

226 
ÿ·b™y_ªsw”
 
ÿp
 = {

227 
POLICY_ROOT
 "/policy.17",

228 
QPOL_POLICY_KERNEL_BINARY
,

230 
çl£
,

231 
çl£
,

232 
çl£
,

233 
Œue
,

234 
çl£
,

235 
çl£
,

236 
çl£
,

237 
çl£
,

238 "fs_t", 
NULL


240 
	`ÿ·b™y_‹¡
(&
ÿp
);

241 
	}
}

243 
	$ÿ·b™y_v18_sourû
()

245 
ÿ·b™y_ªsw”
 
ÿp
 = {

246 
POLICY_ROOT
 "/policy-18.conf",

247 
QPOL_POLICY_KERNEL_SOURCE
,

249 
Œue
,

250 
Œue
,

251 
Œue
,

252 
Œue
,

253 
çl£
,

254 
çl£
,

255 
Œue
,

256 
çl£
,

257 "wšg_t", 
NULL


259 
	`ÿ·b™y_‹¡
(&
ÿp
);

260 
	}
}

262 
	$ÿ·b™y_v18_bš¬y
()

264 
ÿ·b™y_ªsw”
 
ÿp
 = {

265 
POLICY_ROOT
 "/policy.18",

266 
QPOL_POLICY_KERNEL_BINARY
,

268 
çl£
,

269 
çl£
,

270 
çl£
,

271 
Œue
,

272 
çl£
,

273 
çl£
,

274 
çl£
,

275 
çl£
,

276 "wšg_t", 
NULL


278 
	`ÿ·b™y_‹¡
(&
ÿp
);

279 
	}
}

281 
	$ÿ·b™y_v19_bš¬y
()

283 
ÿ·b™y_ªsw”
 
ÿp
 = {

284 
POLICY_ROOT
 "/policy.19",

285 
QPOL_POLICY_KERNEL_BINARY
,

287 
çl£
,

288 
çl£
,

289 
çl£
,

290 
Œue
,

291 
çl£
,

292 
çl£
,

293 
çl£
,

294 
çl£
,

295 "wšg_t", 
NULL


297 
	`ÿ·b™y_‹¡
(&
ÿp
);

298 
	}
}

300 
	$ÿ·b™y_v19_bš¬y_mls
()

302 
ÿ·b™y_ªsw”
 
ÿp
 = {

303 
POLICY_ROOT
 "/policy-mls.19",

304 
QPOL_POLICY_KERNEL_BINARY
,

306 
çl£
,

307 
çl£
,

308 
çl£
,

309 
Œue
,

310 
Œue
,

311 
çl£
,

312 
çl£
,

313 
çl£
,

314 "roÙ_t", 
NULL


316 
	`ÿ·b™y_‹¡
(&
ÿp
);

317 
	}
}

319 
	$ÿ·b™y_v20_bš¬y
()

321 
ÿ·b™y_ªsw”
 
ÿp
 = {

322 
POLICY_ROOT
 "/policy.20",

323 
QPOL_POLICY_KERNEL_BINARY
,

325 
çl£
,

326 
çl£
,

327 
çl£
,

328 
Œue
,

329 
çl£
,

330 
çl£
,

331 
çl£
,

332 
çl£
,

333 "wšg_t", 
NULL


335 
	`ÿ·b™y_‹¡
(&
ÿp
);

336 
	}
}

338 
	$ÿ·b™y_v20_bš¬y_mls
()

340 
ÿ·b™y_ªsw”
 
ÿp
 = {

341 
POLICY_ROOT
 "/policy-mls.20",

342 
QPOL_POLICY_KERNEL_BINARY
,

344 
çl£
,

345 
çl£
,

346 
çl£
,

347 
Œue
,

348 
Œue
,

349 
çl£
,

350 
çl£
,

351 
çl£
,

352 "roÙ_t", 
NULL


354 
	`ÿ·b™y_‹¡
(&
ÿp
);

355 
	}
}

357 
	$ÿ·b™y_v21_sourû
()

359 
ÿ·b™y_ªsw”
 
ÿp
 = {

360 
POLICY_ROOT
 "/policy-mls-21.conf",

361 
QPOL_POLICY_KERNEL_SOURCE
,

363 
Œue
,

364 
Œue
,

365 
Œue
,

366 
Œue
,

367 
Œue
,

368 
çl£
,

369 
Œue
,

370 
çl£
,

371 "roÙ_t", 
NULL


373 
	`ÿ·b™y_‹¡
(&
ÿp
);

374 
	}
}

376 
	$ÿ·b™y_v21_bš¬y
()

378 
ÿ·b™y_ªsw”
 
ÿp
 = {

379 
POLICY_ROOT
 "/policy-mls.21",

380 
QPOL_POLICY_KERNEL_BINARY
,

382 
çl£
,

383 
çl£
,

384 
çl£
,

385 
Œue
,

386 
Œue
,

387 
çl£
,

388 
çl£
,

389 
çl£
,

390 "roÙ_t", 
NULL


392 
	`ÿ·b™y_‹¡
(&
ÿp
);

393 
	}
}

395 
	$ÿ·b™y_v22_sourû
()

397 
ÿ·b™y_ªsw”
 
ÿp
 = {

398 
POLICY_ROOT
 "/policy-mls-22.conf",

399 
QPOL_POLICY_KERNEL_SOURCE
,

401 
Œue
,

402 
Œue
,

403 
Œue
,

404 
Œue
,

405 
Œue
,

406 
Œue
,

407 
Œue
,

408 
çl£
,

409 "roÙ_t", 
NULL


411 
	`ÿ·b™y_‹¡
(&
ÿp
);

412 
	}
}

414 
	$ÿ·b™y_v22_bš¬y
()

416 
ÿ·b™y_ªsw”
 
ÿp
 = {

417 
POLICY_ROOT
 "/policy-mls.22",

418 
QPOL_POLICY_KERNEL_BINARY
,

420 
çl£
,

421 
çl£
,

422 
çl£
,

423 
Œue
,

424 
Œue
,

425 
Œue
,

426 
çl£
,

427 
çl£
,

428 "roÙ_t", 
NULL


430 
	`ÿ·b™y_‹¡
(&
ÿp
);

431 
	}
}

433 
	$ÿ·b™y_v23_sourû
()

435 
ÿ·b™y_ªsw”
 
ÿp
 = {

436 
POLICY_ROOT
 "/policy-mls-23.conf",

437 
QPOL_POLICY_KERNEL_SOURCE
,

439 
Œue
,

440 
Œue
,

441 
Œue
,

442 
Œue
,

443 
Œue
,

444 
Œue
,

445 
Œue
,

446 
çl£
,

449 
	`ÿ·b™y_‹¡
(&
ÿp
);

450 
	}
}

452 
	$ÿ·b™y_v23_bš¬y
()

454 
ÿ·b™y_ªsw”
 
ÿp
 = {

455 
POLICY_ROOT
 "/policy-mls.23",

456 
QPOL_POLICY_KERNEL_BINARY
,

458 
çl£
,

459 
çl£
,

460 
çl£
,

461 
Œue
,

462 
Œue
,

463 
Œue
,

464 
çl£
,

465 
çl£
,

468 
	`ÿ·b™y_‹¡
(&
ÿp
);

469 
	}
}

471 
	$ÿ·b™y_modv6_ba£_bš¬y
()

473 
ÿ·b™y_ªsw”
 
ÿp
 = {

474 
POLICY_ROOT
 "/base-6.pp",

475 
QPOL_POLICY_MODULE_BINARY
,

477 
Œue
,

478 
Œue
,

479 
çl£
,

480 
Œue
,

481 
Œue
,

482 
çl£
,

483 
çl£
,

484 
Œue
,

485 "roÙ_t", 
NULL


487 
	`ÿ·b™y_‹¡
(&
ÿp
);

488 
	}
}

490 
	$ÿ·b™y_modv8_ba£_bš¬y
()

492 
ÿ·b™y_ªsw”
 
ÿp
 = {

493 
POLICY_ROOT
 "/base-8.pp",

494 
QPOL_POLICY_MODULE_BINARY
,

496 
Œue
,

497 
Œue
,

498 
çl£
,

499 
Œue
,

500 
Œue
,

501 
Œue
,

502 
çl£
,

503 
Œue
,

506 
	`ÿ·b™y_‹¡
(&
ÿp
);

507 
	}
}

509 
CU_Te¡Info
 
	gÿ·b™›s_‹¡s
[] = {

510 {"v12, sourû", 
ÿ·b™y_v12_sourû
},

511 {"v15, sourû", 
ÿ·b™y_v15_sourû
},

512 {"v15, bš¬y", 
ÿ·b™y_v15_bš¬y
},

513 {"v16, sourû", 
ÿ·b™y_v16_sourû
},

514 {"v16, bš¬y", 
ÿ·b™y_v16_bš¬y
},

515 {"v17, sourû", 
ÿ·b™y_v17_sourû
},

516 {"v17, bš¬y", 
ÿ·b™y_v17_bš¬y
},

517 {"v18, sourû", 
ÿ·b™y_v18_sourû
},

518 {"v18, bš¬y", 
ÿ·b™y_v18_bš¬y
},

519 {"v19, bš¬y", 
ÿ·b™y_v19_bš¬y
},

520 {"v19, bš¬y mls", 
ÿ·b™y_v19_bš¬y_mls
},

521 {"v20, bš¬y", 
ÿ·b™y_v20_bš¬y
},

522 {"v20, bš¬y mls", 
ÿ·b™y_v20_bš¬y_mls
},

523 {"v21, sourû", 
ÿ·b™y_v21_sourû
},

524 {"v21, bš¬y", 
ÿ·b™y_v21_bš¬y
},

525 {"v22, sourû", 
ÿ·b™y_v22_sourû
},

526 {"v22, bš¬y", 
ÿ·b™y_v22_bš¬y
},

527 {"v23, sourû", 
ÿ·b™y_v23_sourû
},

528 {"v23, bš¬y", 
ÿ·b™y_v23_bš¬y
},

529 {"mod v6, ba£ bš¬y", 
ÿ·b™y_modv6_ba£_bš¬y
},

530 {"mod v8, ba£ bš¬y", 
ÿ·b™y_modv8_ba£_bš¬y
},

531 
CU_TEST_INFO_NULL


534 
	$ÿ·b™›s_š™
()

537 
	}
}

539 
	$ÿ·b™›s_ş—nup
()

542 
	}
}

	@libqpol/tests/capabilities-tests.h

26 #iâdeà
CAPABILITES_TESTS_H


27 
	#CAPABILITES_TESTS_H


	)

29 
	~<CUn™/CUn™.h
>

31 
CU_Te¡Info
 
ÿ·b™›s_‹¡s
[];

32 
ÿ·b™›s_š™
();

33 
ÿ·b™›s_ş—nup
();

	@libqpol/tests/iterators-tests.c

26 
	~<cÚfig.h
>

28 
	~<CUn™/CUn™.h
>

29 
	~<qpŞ/pŞicy.h
>

30 
	~<¡dio.h
>

32 
	#SOURCE_POLICY
 
TEST_POLICIES
 "/¢­shÙs/fc4_rg‘ed.pŞicy.cÚf"

	)

34 
qpŞ_pŞicy_t
 *
	gqp
 = 
NULL
;

36 
	$™”©Üs_®Ÿs
()

38 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

39 
	`CU_ASSERT_FATAL
(
	`qpŞ_pŞicy_g‘_ty³_™”
(
qp
, &
™”
) == 0);

40 !
	`qpŞ_™”©Ü_’d
(
™”
)) {

41 *
v
;

42 
	`CU_ASSERT_FATAL
(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, &
v
) == 0);

43 
qpŞ_ty³_t
 *
ty³
 = (qpŞ_ty³_ˆ*è
v
;

45 
qpŞ_™”©Ü_t
 *
®Ÿs_™”
 = 
NULL
;

46 
size_t
 
®Ÿs_size
;

47 
i§lŸs
 = 0;

48 
	`CU_ASSERT_FATAL
(
	`qpŞ_ty³_g‘_i§lŸs
(
qp
, 
ty³
, &
i§lŸs
) == 0);

49 
	`CU_ASSERT_FATAL
(
	`qpŞ_ty³_g‘_®Ÿs_™”
(
qp
, 
ty³
, &
®Ÿs_™”
) == 0);

50 
	`CU_ASSERT_FATAL
(
	`qpŞ_™”©Ü_g‘_size
(
®Ÿs_™”
, &
®Ÿs_size
) == 0);

52 ià(
®Ÿs_size
 > 0) {

55 
	`CU_ASSERT
(!
	`qpŞ_™”©Ü_’d
(
®Ÿs_™”
));

59 
	`CU_ASSERT
(!
i§lŸs
 && 
	`qpŞ_™”©Ü_’d
(
®Ÿs_™”
));

62 
	`qpŞ_™”©Ü_de¡roy
(&
®Ÿs_™”
);

63 
	`CU_ASSERT_FATAL
(
	`qpŞ_™”©Ü_Ãxt
(
™”
) == 0);

65 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

66 
	}
}

68 
CU_Te¡Info
 
	g™”©Üs_‹¡s
[] = {

69 {"®Ÿ ™”©Ü", 
™”©Üs_®Ÿs
}

71 
CU_TEST_INFO_NULL


74 
	$™”©Üs_š™
()

76 
pŞicy_ty³
 = 
	`qpŞ_pŞicy_İ’_äom_fe
(
SOURCE_POLICY
, &
qp
, 
NULL
, NULL, 
QPOL_POLICY_OPTION_NO_RULES
);

77 ià(
pŞicy_ty³
 < 0) {

81 
	}
}

83 
	$™”©Üs_ş—nup
()

85 
	`qpŞ_pŞicy_de¡roy
(&
qp
);

87 
	}
}

	@libqpol/tests/iterators-tests.h

26 #iâdeà
ITERATORS_TESTS_H


27 
	#ITERATORS_TESTS_H


	)

29 
	~<CUn™/CUn™.h
>

31 
CU_Te¡Info
 
™”©Üs_‹¡s
[];

32 
™”©Üs_š™
();

33 
™”©Üs_ş—nup
();

	@libqpol/tests/libqpol-tests.c

26 
	~<cÚfig.h
>

28 
	~<CUn™/CUn™.h
>

29 
	~<CUn™/Basic.h
>

31 
	~"ÿ·b™›s-‹¡s.h
"

32 
	~"™”©Üs-‹¡s.h
"

33 
	~"pŞicy-ã©u»s-‹¡s.h
"

35 
	$maš
()

37 ià(
	`CU_š™Ÿlize_»gi¡ry
(è!ğ
CUE_SUCCESS
) {

38  
	`CU_g‘_”rÜ
();

41 
CU_Su™eInfo
 
su™es
[] = {

42 {"C­ab™›s", 
ÿ·b™›s_š™
, 
ÿ·b™›s_ş—nup
, 
ÿ·b™›s_‹¡s
}

44 {"I‹¿tÜs", 
™”©Üs_š™
, 
™”©Üs_ş—nup
, 
™”©Üs_‹¡s
}

46 {"PŞicy F—tu»ns", 
pŞicy_ã©u»s_š™
, 
pŞicy_ã©u»s_ş—nup
, 
pŞicy_ã©u»s_‹¡s
}

48 
CU_SUITE_INFO_NULL


51 
	`CU_»gi¡”_su™es
(
su™es
);

52 
	`CU_basic_£t_mode
(
CU_BRM_VERBOSE
);

53 
	`CU_basic_run_‹¡s
();

54 
num_çu»s
 = 
	`CU_g‘_numb”_of_çu»_»cÜds
();

55 
	`CU_ş—nup_»gi¡ry
();

56  ()
num_çu»s
;

57 
	}
}

	@libqpol/tests/policy-features-tests.c

26 
	~<cÚfig.h
>

28 
	~<CUn™/CUn™.h
>

29 
	~<qpŞ/pŞicy.h
>

30 
	~"../¤c/qpŞ_š‹º®.h
"

31 
	~<¡dio.h
>

33 
	#BROKEN_ALIAS_POLICY
 
TEST_POLICIES
 "/£toŞs-3.3/pŞicy-ã©u»s/brok’-®Ÿs-mod.21"

	)

34 
	#NOT_BROKEN_ALIAS_POLICY
 
TEST_POLICIES
 "/£toŞs-3.3/pŞicy-ã©u»s/nÙ-brok’-®Ÿs-mod.21"

	)

35 
	#NOGENFS_POLICY
 
TEST_POLICIES
 "/£toŞs-3.3/pŞicy-ã©u»s/nog’fscÚ-pŞicy.21"

	)

37 
pŞicy_ã©u»s_®Ÿs_couÁ
(*
v¬g
, cÚ¡ 
qpŞ_pŞicy_t
 * 
pŞicy


38 
__©Œibu‹__
 ((
unu£d
)), 
Ëv–
, cÚ¡ *
fmt
, 
va_li¡
 
va_¬gs
)

40 ià(
	gËv–
 =ğ
QPOL_MSG_WARN
) {

41 *
num_»moved_®Ÿ£s
 = (*)
v¬g
;

42 (*
	gnum_»moved_®Ÿ£s
)++;

43 } ià(
	gËv–
 =ğ
QPOL_MSG_ERR
) {

44 
årštf
(
¡d”r
, "ERROR: ");

45 
vårštf
(
¡d”r
, 
fmt
, 
va_¬gs
);

46 
årštf
(
¡d”r
, "\n");

53 
	$pŞicy_ã©u»s_šv®id_®Ÿs
()

55 
qpŞ_pŞicy_t
 *
qp
 = 
NULL
;

56 
pŞicy_ã©u»s_»moved_®Ÿ£s
 = 0;

57 *
v
;

58 
i§lŸs
 = 0;

59 cÚ¡ *
Çme
;

61 
pŞicy_ty³
 = 
	`qpŞ_pŞicy_İ’_äom_fe
(
NOT_BROKEN_ALIAS_POLICY
, &
qp
, 
pŞicy_ã©u»s_®Ÿs_couÁ
,

62 &
pŞicy_ã©u»s_»moved_®Ÿ£s
, 
QPOL_POLICY_OPTION_NO_RULES
);

63 
	`CU_ASSERT_FATAL
(
pŞicy_ty³
 =ğ
QPOL_POLICY_KERNEL_BINARY
);

64 
	`CU_ASSERT
(
pŞicy_ã©u»s_»moved_®Ÿ£s
 == 0)

66 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

67 
	`CU_ASSERT_FATAL
(
	`qpŞ_pŞicy_g‘_ty³_™”
(
qp
, &
™”
) == 0);

68 !
	`qpŞ_™”©Ü_’d
(
™”
)) {

69 
	`CU_ASSERT_FATAL
(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, &
v
) == 0);

70 
qpŞ_ty³_t
 *
ty³
 = (qpŞ_ty³_ˆ*è
v
;

71 
	`CU_ASSERT_FATAL
(
	`qpŞ_ty³_g‘_i§lŸs
(
qp
, 
ty³
, &
i§lŸs
) == 0);

72 ià(
i§lŸs
) {

73 
	`CU_ASSERT_FATAL
(
	`qpŞ_ty³_g‘_Çme
(
qp
, 
ty³
, &
Çme
) == 0);

74 
	`CU_ASSERT_STRING_EQUAL
(
Çme
, "fs_t");

76 
	`CU_ASSERT_FATAL
(
	`qpŞ_™”©Ü_Ãxt
(
™”
) == 0);

78 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

79 
	`qpŞ_pŞicy_de¡roy
(&
qp
);

81 
pŞicy_ã©u»s_»moved_®Ÿ£s
 = 0;

82 
pŞicy_ty³
 =

83 
	`qpŞ_pŞicy_İ’_äom_fe
(
BROKEN_ALIAS_POLICY
, &
qp
, 
pŞicy_ã©u»s_®Ÿs_couÁ
, &
pŞicy_ã©u»s_»moved_®Ÿ£s
,

84 
QPOL_POLICY_OPTION_NO_RULES
);

85 
	`CU_ASSERT_FATAL
(
pŞicy_ty³
 =ğ
QPOL_POLICY_KERNEL_BINARY
);

86 
	`CU_ASSERT
(
pŞicy_ã©u»s_»moved_®Ÿ£s
 == 1)

88 
	`CU_ASSERT_FATAL
(
	`qpŞ_pŞicy_g‘_ty³_™”
(
qp
, &
™”
) == 0);

89 !
	`qpŞ_™”©Ü_’d
(
™”
)) {

90 
	`CU_ASSERT_FATAL
(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, &
v
) == 0);

91 
qpŞ_ty³_t
 *
ty³
 = (qpŞ_ty³_ˆ*è
v
;

92 
	`CU_ASSERT_FATAL
(
	`qpŞ_ty³_g‘_i§lŸs
(
qp
, 
ty³
, &
i§lŸs
) == 0);

93 
	`CU_ASSERT
(
i§lŸs
 == 0);

94 
	`CU_ASSERT_FATAL
(
	`qpŞ_™”©Ü_Ãxt
(
™”
) == 0);

96 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

97 
	`qpŞ_pŞicy_de¡roy
(&
qp
);

98 
	}
}

102 
	$pŞicy_ã©u»s_nog’fscÚ_™”
()

104 
qpŞ_pŞicy_t
 *
qp
 = 
NULL
;

107 
pŞicy_ty³
 = 
	`qpŞ_pŞicy_İ’_äom_fe
(
NOGENFS_POLICY
, &
qp
, 
NULL
, NULL, 
QPOL_POLICY_OPTION_NO_RULES
);

108 
	`CU_ASSERT_FATAL
(
pŞicy_ty³
 =ğ
QPOL_POLICY_KERNEL_BINARY
);

110 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

113 
	`CU_ASSERT_FATAL
(
	`qpŞ_pŞicy_g‘_g’fscÚ_™”
(
qp
, &
™”
) == 0);

114 
	`CU_ASSERT
(
	`qpŞ_™”©Ü_’d
(
™”
));

115 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

116 
	`qpŞ_pŞicy_de¡roy
(&
qp
);

119 
pŞicy_ty³
 = 
	`qpŞ_pŞicy_İ’_äom_fe
(
NOT_BROKEN_ALIAS_POLICY
, &
qp
, 
NULL
, NULL, 
QPOL_POLICY_OPTION_NO_RULES
);

120 
	`CU_ASSERT_FATAL
(
pŞicy_ty³
 =ğ
QPOL_POLICY_KERNEL_BINARY
);

123 
	`CU_ASSERT_FATAL
(
	`qpŞ_pŞicy_g‘_g’fscÚ_™”
(
qp
, &
™”
) == 0);

124 
	`CU_ASSERT
(!
	`qpŞ_™”©Ü_’d
(
™”
));

125 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

126 
	`qpŞ_pŞicy_de¡roy
(&
qp
);

127 
	}
}

129 
CU_Te¡Info
 
	gpŞicy_ã©u»s_‹¡s
[] = {

130 {"šv®id‡lŸs", 
pŞicy_ã©u»s_šv®id_®Ÿs
}

132 {"NØg’fscÚ", 
pŞicy_ã©u»s_nog’fscÚ_™”
}

134 
CU_TEST_INFO_NULL


137 
	$pŞicy_ã©u»s_š™
()

140 
	}
}

142 
	$pŞicy_ã©u»s_ş—nup
()

145 
	}
}

	@libqpol/tests/policy-features-tests.h

26 #iâdeà
POLICY_FEATURES_TESTS_H


27 
	#POLICY_FEATURES_TESTS_H


	)

29 
	~<CUn™/CUn™.h
>

31 
CU_Te¡Info
 
pŞicy_ã©u»s_‹¡s
[];

32 
pŞicy_ã©u»s_š™
();

33 
pŞicy_ã©u»s_ş—nup
();

	@libseaudit/include/seaudit/avc_message.h

27 #iâdeà
SEAUDIT_AVC_MESSAGE_H


28 
	#SEAUDIT_AVC_MESSAGE_H


	)

30 
	~<­Ş/veùÜ.h
>

32 #ifdeà 
__ılu¥lus


37 
£aud™_avc_mes§ge
 
	t£aud™_avc_mes§ge_t
;

42 
	e£aud™_avc_mes§ge_ty³


44 
SEAUDIT_AVC_UNKNOWN
 = 0,

45 
SEAUDIT_AVC_DENIED
,

46 
SEAUDIT_AVC_GRANTED


47 } 
	t£aud™_avc_mes§ge_ty³_e
;

58 
£aud™_avc_mes§ge_ty³_e
 
£aud™_avc_mes§ge_g‘_mes§ge_ty³
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
);

67 
£aud™_avc_mes§ge_g‘_time¡amp_Çno
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
);

77 cÚ¡ *
£aud™_avc_mes§ge_g‘_sourû_u£r
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
);

87 cÚ¡ *
£aud™_avc_mes§ge_g‘_sourû_rŞe
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
);

97 cÚ¡ *
£aud™_avc_mes§ge_g‘_sourû_ty³
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
);

107 cÚ¡ *
£aud™_avc_mes§ge_g‘_sourû_mls_lvl
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
);

117 cÚ¡ *
£aud™_avc_mes§ge_g‘_sourû_mls_şr
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
);

127 cÚ¡ *
£aud™_avc_mes§ge_g‘_rg‘_u£r
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
);

137 cÚ¡ *
£aud™_avc_mes§ge_g‘_rg‘_rŞe
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
);

147 cÚ¡ *
£aud™_avc_mes§ge_g‘_rg‘_ty³
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
);

157 cÚ¡ *
£aud™_avc_mes§ge_g‘_rg‘_mls_lvl
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
);

167 cÚ¡ *
£aud™_avc_mes§ge_g‘_rg‘_mls_şr
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
);

177 cÚ¡ *
£aud™_avc_mes§ge_g‘_objeù_şass
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
);

187 cÚ¡ 
­Ş_veùÜ_t
 *
£aud™_avc_mes§ge_g‘_³rm
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
);

197 cÚ¡ *
£aud™_avc_mes§ge_g‘_exe
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
);

207 cÚ¡ *
£aud™_avc_mes§ge_g‘_comm
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
);

217 cÚ¡ *
£aud™_avc_mes§ge_g‘_Çme
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
);

226 
£aud™_avc_mes§ge_g‘_pid
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
);

235 
£aud™_avc_mes§ge_g‘_šode
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
);

245 cÚ¡ *
£aud™_avc_mes§ge_g‘_·th
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
);

255 cÚ¡ *
£aud™_avc_mes§ge_g‘_dev
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
);

265 cÚ¡ *
£aud™_avc_mes§ge_g‘_Ãtif
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
);

274 
£aud™_avc_mes§ge_g‘_pÜt
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
);

284 cÚ¡ *
£aud™_avc_mes§ge_g‘_Ïddr
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
);

293 
£aud™_avc_mes§ge_g‘_ÍÜt
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
);

303 cÚ¡ *
£aud™_avc_mes§ge_g‘_çddr
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
);

312 
£aud™_avc_mes§ge_g‘_åÜt
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
);

322 cÚ¡ *
£aud™_avc_mes§ge_g‘_§ddr
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
);

331 
£aud™_avc_mes§ge_g‘_¥Üt
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
);

341 cÚ¡ *
£aud™_avc_mes§ge_g‘_daddr
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
);

350 
£aud™_avc_mes§ge_g‘_dpÜt
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
);

359 
£aud™_avc_mes§ge_g‘_key
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
);

368 
£aud™_avc_mes§ge_g‘_ÿp
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
);

370 #ifdeà 
__ılu¥lus


	@libseaudit/include/seaudit/bool_message.h

27 #iâdeà
SEAUDIT_BOOL_MESSAGE_H


28 
	#SEAUDIT_BOOL_MESSAGE_H


	)

30 
	~<­Ş/veùÜ.h
>

32 #ifdeà 
__ılu¥lus


37 
£aud™_boŞ_mes§ge
 
	t£aud™_boŞ_mes§ge_t
;

39 #ifdeà 
__ılu¥lus


	@libseaudit/include/seaudit/filter.h

28 #iâdeà
SEAUDIT_FILTER_H


29 
	#SEAUDIT_FILTER_H


	)

31 #ifdeà 
__ılu¥lus


36 
	~<£aud™/avc_mes§ge.h
>

38 
	~<­Ş/veùÜ.h
>

39 
	~<¡dboŞ.h
>

40 
	~<¡dio.h
>

41 
	~<time.h
>

43 
£aud™_f‹r
 
	t£aud™_f‹r_t
;

50 
	e£aud™_f‹r_m©ch


52 
SEAUDIT_FILTER_MATCH_ALL
 = 0,

53 
SEAUDIT_FILTER_MATCH_ANY


54 } 
	t£aud™_f‹r_m©ch_e
;

61 
	e£aud™_f‹r_visibË


63 
SEAUDIT_FILTER_VISIBLE_SHOW
 = 0,

64 
SEAUDIT_FILTER_VISIBLE_HIDE


65 } 
	t£aud™_f‹r_visibË_e
;

71 
	e£aud™_f‹r_d©e_m©ch


73 
SEAUDIT_FILTER_DATE_MATCH_BEFORE
 = 0,

74 
SEAUDIT_FILTER_DATE_MATCH_AFTER
,

75 
SEAUDIT_FILTER_DATE_MATCH_BETWEEN


76 } 
	t£aud™_f‹r_d©e_m©ch_e
;

88 
£aud™_f‹r_t
 *
£aud™_f‹r_ü—‹
(cÚ¡ *
Çme
);

100 
£aud™_f‹r_t
 *
£aud™_f‹r_ü—‹_äom_f‹r
(cÚ¡ s—ud™_f‹r_ˆ* 
f‹r
);

113 
­Ş_veùÜ_t
 *
£aud™_f‹r_ü—‹_äom_fe
(cÚ¡ *
f’ame
);

121 
£aud™_f‹r_de¡roy
(
£aud™_f‹r_t
 ** 
f‹r
);

135 
£aud™_f‹r_§ve_to_fe
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ *
f’ame
);

146 
£aud™_f‹r_£t_m©ch
(
£aud™_f‹r_t
 * 
f‹r
, 
£aud™_f‹r_m©ch_e
 
m©ch
);

155 
£aud™_f‹r_m©ch_e
 
£aud™_f‹r_g‘_m©ch
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
);

166 
£aud™_f‹r_£t_Çme
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ *
Çme
);

176 cÚ¡ *
£aud™_f‹r_g‘_Çme
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
);

189 
£aud™_f‹r_£t_desütiÚ
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ *
desc
);

199 cÚ¡ *
£aud™_f‹r_g‘_desütiÚ
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
);

220 
£aud™_f‹r_£t_¡riù
(
£aud™_f‹r_t
 * 
f‹r
, 
boŞ
 
is_¡riù
);

230 
boŞ
 
£aud™_f‹r_g‘_¡riù
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
);

242 
£aud™_f‹r_£t_sourû_u£r
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
­Ş_veùÜ_t
 * 
v
);

252 cÚ¡ 
­Ş_veùÜ_t
 *
£aud™_f‹r_g‘_sourû_u£r
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
);

264 
£aud™_f‹r_£t_sourû_rŞe
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
­Ş_veùÜ_t
 * 
v
);

274 cÚ¡ 
­Ş_veùÜ_t
 *
£aud™_f‹r_g‘_sourû_rŞe
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
);

286 
£aud™_f‹r_£t_sourû_ty³
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
­Ş_veùÜ_t
 * 
v
);

296 cÚ¡ 
­Ş_veùÜ_t
 *
£aud™_f‹r_g‘_sourû_ty³
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
);

308 
£aud™_f‹r_£t_sourû_mls_lvl
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
­Ş_veùÜ_t
 * 
v
);

318 cÚ¡ 
­Ş_veùÜ_t
 *
£aud™_f‹r_g‘_sourû_mls_lvl
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
);

330 
£aud™_f‹r_£t_sourû_mls_şr
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
­Ş_veùÜ_t
 * 
v
);

340 cÚ¡ 
­Ş_veùÜ_t
 *
£aud™_f‹r_g‘_sourû_mls_şr
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
);

352 
£aud™_f‹r_£t_rg‘_u£r
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
­Ş_veùÜ_t
 * 
v
);

362 cÚ¡ 
­Ş_veùÜ_t
 *
£aud™_f‹r_g‘_rg‘_u£r
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
);

374 
£aud™_f‹r_£t_rg‘_rŞe
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
­Ş_veùÜ_t
 * 
v
);

384 cÚ¡ 
­Ş_veùÜ_t
 *
£aud™_f‹r_g‘_rg‘_rŞe
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
);

396 
£aud™_f‹r_£t_rg‘_ty³
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
­Ş_veùÜ_t
 * 
v
);

406 cÚ¡ 
­Ş_veùÜ_t
 *
£aud™_f‹r_g‘_rg‘_ty³
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
);

418 
£aud™_f‹r_£t_rg‘_mls_lvl
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
­Ş_veùÜ_t
 * 
v
);

428 cÚ¡ 
­Ş_veùÜ_t
 *
£aud™_f‹r_g‘_rg‘_mls_lvl
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
);

440 
£aud™_f‹r_£t_rg‘_mls_şr
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
­Ş_veùÜ_t
 * 
v
);

450 cÚ¡ 
­Ş_veùÜ_t
 *
£aud™_f‹r_g‘_rg‘_mls_şr
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
);

462 
£aud™_f‹r_£t_rg‘_şass
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
­Ş_veùÜ_t
 * 
v
);

473 cÚ¡ 
­Ş_veùÜ_t
 *
£aud™_f‹r_g‘_rg‘_şass
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
);

487 
£aud™_f‹r_£t_³rmissiÚ
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ *
³rm
);

497 cÚ¡ *
£aud™_f‹r_g‘_³rmissiÚ
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
);

510 
£aud™_f‹r_£t_execubË
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ *
exe
);

520 cÚ¡ *
£aud™_f‹r_g‘_execubË
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
);

532 
£aud™_f‹r_£t_ho¡
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ *
ho¡
);

541 cÚ¡ *
£aud™_f‹r_g‘_ho¡
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
);

553 
£aud™_f‹r_£t_·th
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ *
·th
);

562 cÚ¡ *
£aud™_f‹r_g‘_·th
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
);

574 
£aud™_f‹r_£t_šode
(
£aud™_f‹r_t
 * 
f‹r
, 
šode
);

583 
£aud™_f‹r_g‘_šode
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
);

594 
£aud™_f‹r_£t_pid
(
£aud™_f‹r_t
 * 
f‹r
, 
pid
);

603 
£aud™_f‹r_g‘_pid
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
);

616 
£aud™_f‹r_£t_commªd
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ *
commªd
);

625 cÚ¡ *
£aud™_f‹r_g‘_commªd
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
);

639 
£aud™_f‹r_£t_ªyaddr
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ *
addr
);

649 cÚ¡ *
£aud™_f‹r_g‘_ªyaddr
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
);

661 
£aud™_f‹r_£t_ªypÜt
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
pÜt
);

670 
£aud™_f‹r_g‘_ªypÜt
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
);

686 
£aud™_f‹r_£t_Ïddr
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ *
Ïddr
);

696 cÚ¡ *
£aud™_f‹r_g‘_Ïddr
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
);

711 
£aud™_f‹r_£t_ÍÜt
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
ÍÜt
);

720 
£aud™_f‹r_g‘_ÍÜt
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
);

736 
£aud™_f‹r_£t_çddr
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ *
çddr
);

746 cÚ¡ *
£aud™_f‹r_g‘_çddr
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
);

761 
£aud™_f‹r_£t_åÜt
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
åÜt
);

770 
£aud™_f‹r_g‘_åÜt
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
);

786 
£aud™_f‹r_£t_§ddr
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ *
§ddr
);

796 cÚ¡ *
£aud™_f‹r_g‘_§ddr
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
);

811 
£aud™_f‹r_£t_¥Üt
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
¥Üt
);

820 
£aud™_f‹r_g‘_¥Üt
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
);

837 
£aud™_f‹r_£t_daddr
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ *
daddr
);

847 cÚ¡ *
£aud™_f‹r_g‘_daddr
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
);

862 
£aud™_f‹r_£t_dpÜt
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
dpÜt
);

871 
£aud™_f‹r_g‘_dpÜt
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
);

886 
£aud™_f‹r_£t_pÜt
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
pÜt
);

895 
£aud™_f‹r_g‘_pÜt
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
);

908 
£aud™_f‹r_£t_Ãtif
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ *
Ãtif
);

918 cÚ¡ *
£aud™_f‹r_g‘_Ãtif
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
);

930 
£aud™_f‹r_£t_key
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
key
);

939 
£aud™_f‹r_g‘_key
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
);

951 
£aud™_f‹r_£t_ÿp
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
ÿp
);

960 
£aud™_f‹r_g‘_ÿp
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
);

974 
£aud™_f‹r_£t_mes§ge_ty³
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
£aud™_avc_mes§ge_ty³_e
 
mes§ge_ty³
);

984 
£aud™_avc_mes§ge_ty³_e
 
£aud™_f‹r_g‘_mes§ge_ty³
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
);

1001 
£aud™_f‹r_£t_d©e
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
tm
 *
¡¬t
, cÚ¡ tm *
’d
,

1002 
£aud™_f‹r_d©e_m©ch_e
 
m©ch
);

1018 
£aud™_f‹r_g‘_d©e
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
tm
 **
¡¬t
, cÚ¡ tm **
’d
,

1019 
£aud™_f‹r_d©e_m©ch_e
 * 
m©ch
);

1021 #ifdeà 
__ılu¥lus


	@libseaudit/include/seaudit/load_message.h

27 #iâdeà
SEAUDIT_LOAD_MESSAGE_H


28 
	#SEAUDIT_LOAD_MESSAGE_H


	)

30 #ifdeà 
__ılu¥lus


35 
£aud™_lßd_mes§ge
 
	t£aud™_lßd_mes§ge_t
;

37 #ifdeà 
__ılu¥lus


	@libseaudit/include/seaudit/log.h

30 #iâdeà
SEAUDIT_LOG_H


31 
	#SEAUDIT_LOG_H


	)

33 #ifdeà 
__ılu¥lus


38 
	~<¡d¬g.h
>

39 
	~<­Ş/veùÜ.h
>

41 
£aud™_log
 
	t£aud™_log_t
;

42 (*
£aud™_hªdË_â_t
è(*
	t¬g
, cÚ¡ 
	t£aud™_log_t
 * 
	tlog
, 
	tËv–
, cÚ¡ *
	tfmt
, 
	tva_li¡
 
	tva_¬gs
);

47 
	e£aud™_log_ty³


49 
SEAUDIT_LOG_TYPE_INVALID
 = 0,

50 
SEAUDIT_LOG_TYPE_SYSLOG
,

51 
SEAUDIT_LOG_TYPE_AUDITD


52 } 
	t£aud™_log_ty³_e
;

68 
£aud™_log_t
 *
£aud™_log_ü—‹
(
£aud™_hªdË_â_t
 
â
, *
ÿÎback_¬g
);

78 
£aud™_log_de¡roy
(
£aud™_log_t
 ** 
log
);

89 
£aud™_log_ş—r
(
£aud™_log_t
 * 
log
);

100 
­Ş_veùÜ_t
 *
£aud™_log_g‘_u£rs
(cÚ¡ 
£aud™_log_t
 * 
log
);

111 
­Ş_veùÜ_t
 *
£aud™_log_g‘_rŞes
(cÚ¡ 
£aud™_log_t
 * 
log
);

122 
­Ş_veùÜ_t
 *
£aud™_log_g‘_ty³s
(cÚ¡ 
£aud™_log_t
 * 
log
);

133 
­Ş_veùÜ_t
 *
£aud™_log_g‘_mls_lvl
(cÚ¡ 
£aud™_log_t
 * 
log
);

144 
­Ş_veùÜ_t
 *
£aud™_log_g‘_mls_şr
(cÚ¡ 
£aud™_log_t
 * 
log
);

156 
­Ş_veùÜ_t
 *
£aud™_log_g‘_şas£s
(cÚ¡ 
£aud™_log_t
 * 
log
);

158 #ifdeà 
__ılu¥lus


	@libseaudit/include/seaudit/message.h

26 #iâdeà
SEAUDIT_MESSAGE_H


27 
	#SEAUDIT_MESSAGE_H


	)

29 #ifdeà 
__ılu¥lus


34 
	~<time.h
>

36 
£aud™_mes§ge
 
	t£aud™_mes§ge_t
;

43 
	e£aud™_mes§ge_ty³


45 
SEAUDIT_MESSAGE_TYPE_INVALID
 = 0,

48 
SEAUDIT_MESSAGE_TYPE_BOOL
,

51 
SEAUDIT_MESSAGE_TYPE_AVC
,

54 
SEAUDIT_MESSAGE_TYPE_LOAD


55 } 
	t£aud™_mes§ge_ty³_e
;

69 *
£aud™_mes§ge_g‘_d©a
(cÚ¡ 
£aud™_mes§ge_t
 * 
msg
, 
£aud™_mes§ge_ty³_e
 * 
ty³
);

81 cÚ¡ 
tm
 *
£aud™_mes§ge_g‘_time
(cÚ¡ 
£aud™_mes§ge_t
 * 
msg
);

90 cÚ¡ *
£aud™_mes§ge_g‘_ho¡
(cÚ¡ 
£aud™_mes§ge_t
 * 
msg
);

101 *
£aud™_mes§ge_to_¡ršg
(cÚ¡ 
£aud™_mes§ge_t
 * 
msg
);

113 *
£aud™_mes§ge_to_¡ršg_html
(cÚ¡ 
£aud™_mes§ge_t
 * 
msg
);

127 *
£aud™_mes§ge_to_misc_¡ršg
(cÚ¡ 
£aud™_mes§ge_t
 * 
msg
);

129 #ifdeà 
__ılu¥lus


	@libseaudit/include/seaudit/model.h

29 #iâdeà
SEAUDIT_MODEL_H


30 
	#SEAUDIT_MODEL_H


	)

32 #ifdeà 
__ılu¥lus


37 
	~"f‹r.h
"

38 
	~"log.h
"

39 
	~"mes§ge.h
"

40 
	~"sÜt.h
"

42 
	~<¡dlib.h
>

44 
£aud™_mod–
 
	t£aud™_mod–_t
;

59 
£aud™_mod–_t
 *
£aud™_mod–_ü—‹
(cÚ¡ *
Çme
, 
£aud™_log_t
 * 
log
);

72 
£aud™_mod–_t
 *
£aud™_mod–_ü—‹_äom_mod–
(cÚ¡ s—ud™_mod–_ˆ* 
mod–
);

87 
£aud™_mod–_t
 *
£aud™_mod–_ü—‹_äom_fe
(cÚ¡ *
f’ame
);

95 
£aud™_mod–_de¡roy
(
£aud™_mod–_t
 ** 
mod–
);

111 
£aud™_mod–_§ve_to_fe
(cÚ¡ 
£aud™_mod–_t
 * 
mod–
, cÚ¡ *
f’ame
);

121 cÚ¡ *
£aud™_mod–_g‘_Çme
(cÚ¡ 
£aud™_mod–_t
 * 
mod–
);

132 
£aud™_mod–_£t_Çme
(
£aud™_mod–_t
 * 
mod–
, cÚ¡ *
Çme
);

143 
£aud™_mod–_­³nd_log
(
£aud™_mod–_t
 * 
mod–
, 
£aud™_log_t
 * 
log
);

156 
£aud™_mod–_­³nd_f‹r
(
£aud™_mod–_t
 * 
mod–
, 
£aud™_f‹r_t
 * 
f‹r
);

170 cÚ¡ 
­Ş_veùÜ_t
 *
£aud™_mod–_g‘_f‹rs
(cÚ¡ 
£aud™_mod–_t
 * 
mod–
);

183 
£aud™_mod–_»move_f‹r
(
£aud™_mod–_t
 * 
mod–
, 
£aud™_f‹r_t
 * 
f‹r
);

195 
£aud™_mod–_£t_f‹r_m©ch
(
£aud™_mod–_t
 * 
mod–
, 
£aud™_f‹r_m©ch_e
 
m©ch
);

204 
£aud™_f‹r_m©ch_e
 
£aud™_mod–_g‘_f‹r_m©ch
(cÚ¡ 
£aud™_mod–_t
 * 
mod–
);

216 
£aud™_mod–_£t_f‹r_visibË
(
£aud™_mod–_t
 * 
mod–
, 
£aud™_f‹r_visibË_e
 
visibË
);

226 
£aud™_f‹r_visibË_e
 
£aud™_mod–_g‘_f‹r_visibË
(cÚ¡ 
£aud™_mod–_t
 * 
mod–
);

240 
£aud™_mod–_­³nd_sÜt
(
£aud™_mod–_t
 * 
mod–
, 
£aud™_sÜt_t
 * 
sÜt
);

251 
£aud™_mod–_ş—r_sÜts
(
£aud™_mod–_t
 * 
mod–
);

266 
£aud™_mod–_is_chªged
(cÚ¡ 
£aud™_mod–_t
 * 
mod–
);

280 
­Ş_veùÜ_t
 *
£aud™_mod–_g‘_mes§ges
(cÚ¡ 
£aud™_log_t
 * 
log
, 
£aud™_mod–_t
 * 
mod–
);

295 
­Ş_veùÜ_t
 *
£aud™_mod–_g‘_m®fÜmed_mes§ges
(cÚ¡ 
£aud™_log_t
 * 
log
, 
£aud™_mod–_t
 * 
mod–
);

307 
£aud™_mod–_hide_mes§ge
(
£aud™_mod–_t
 * 
mod–
, cÚ¡ 
£aud™_mes§ge_t
 * 
mes§ge
);

319 
size_t
 
£aud™_mod–_g‘_num_®lows
(cÚ¡ 
£aud™_log_t
 * 
log
, 
£aud™_mod–_t
 * 
mod–
);

331 
size_t
 
£aud™_mod–_g‘_num_d’›s
(cÚ¡ 
£aud™_log_t
 * 
log
, 
£aud™_mod–_t
 * 
mod–
);

344 
size_t
 
£aud™_mod–_g‘_num_boŞs
(cÚ¡ 
£aud™_log_t
 * 
log
, 
£aud™_mod–_t
 * 
mod–
);

356 
size_t
 
£aud™_mod–_g‘_num_lßds
(cÚ¡ 
£aud™_log_t
 * 
log
, 
£aud™_mod–_t
 * 
mod–
);

358 #ifdeà 
__ılu¥lus


	@libseaudit/include/seaudit/parse.h

26 #iâdeà
SEAUDIT_PARSE_H


27 
	#SEAUDIT_PARSE_H


	)

29 #ifdeà 
__ılu¥lus


34 
	~"log.h
"

35 
	~<¡dio.h
>

50 
£aud™_log_·r£
(
£aud™_log_t
 * 
log
, 
FILE
 * 
sy¦og
);

66 
£aud™_log_·r£_bufãr
(
£aud™_log_t
 * 
log
, cÚ¡ *
bufãr
, cÚ¡ 
size_t
 
bufsize
);

68 #ifdeà 
__ılu¥lus


	@libseaudit/include/seaudit/report.h

32 #iâdeà
SEAUDIT_REPORT_H


33 
	#SEAUDIT_REPORT_H


	)

35 #ifdeà 
__ılu¥lus


40 
	~"mod–.h
"

42 
£aud™_»pÜt
 
	t£aud™_»pÜt_t
;

44 
	e£aud™_»pÜt_fÜm©


46 
SEAUDIT_REPORT_FORMAT_TEXT
, 
SEAUDIT_REPORT_FORMAT_HTML


47 } 
	t£aud™_»pÜt_fÜm©_e
;

59 
£aud™_»pÜt_t
 *
£aud™_»pÜt_ü—‹
(
£aud™_mod–_t
 * 
mod–
);

67 
£aud™_»pÜt_de¡roy
(
£aud™_»pÜt_t
 ** 
»pÜt
);

80 
£aud™_»pÜt_wr™e
(cÚ¡ 
£aud™_log_t
 * 
log
, cÚ¡ 
£aud™_»pÜt_t
 * 
»pÜt
, cÚ¡ *
out_fe
);

92 
£aud™_»pÜt_£t_fÜm©
(cÚ¡ 
£aud™_log_t
 * 
log
, 
£aud™_»pÜt_t
 * 
»pÜt
, 
£aud™_»pÜt_fÜm©_e
 
fÜm©
);

105 
£aud™_»pÜt_£t_cÚfigu¿tiÚ
(cÚ¡ 
£aud™_log_t
 * 
log
, 
£aud™_»pÜt_t
 * 
»pÜt
, cÚ¡ *
fe
);

120 
£aud™_»pÜt_£t_¡yËsh“t
(cÚ¡ 
£aud™_log_t
 * 
log
, 
£aud™_»pÜt_t
 * 
»pÜt
, cÚ¡ *
fe
,

121 cÚ¡ 
u£_¡yËsh“t
);

134 
£aud™_»pÜt_£t_m®fÜmed
(cÚ¡ 
£aud™_log_t
 * 
log
, 
£aud™_»pÜt_t
 * 
»pÜt
, cÚ¡ 
do_m®fÜmed
);

136 #ifdeà 
__ılu¥lus


	@libseaudit/include/seaudit/sort.h

31 #iâdeà
SEAUDIT_SORT_H


32 
	#SEAUDIT_SORT_H


	)

34 #ifdeà 
__ılu¥lus


39 
£aud™_sÜt
 
	t£aud™_sÜt_t
;

50 
£aud™_sÜt_t
 *
£aud™_sÜt_ü—‹_äom_sÜt
(cÚ¡ s—ud™_sÜt_ˆ* 
sÜt
);

58 
£aud™_sÜt_de¡roy
(
£aud™_sÜt_t
 ** 
sÜt
);

71 
£aud™_sÜt_t
 *
£aud™_sÜt_by_mes§ge_ty³
(cÚ¡ 
dœeùiÚ
);

83 
£aud™_sÜt_t
 *
£aud™_sÜt_by_d©e
(cÚ¡ 
dœeùiÚ
);

95 
£aud™_sÜt_t
 *
£aud™_sÜt_by_ho¡
(cÚ¡ 
dœeùiÚ
);

108 
£aud™_sÜt_t
 *
£aud™_sÜt_by_³rmissiÚ
(cÚ¡ 
dœeùiÚ
);

121 
£aud™_sÜt_t
 *
£aud™_sÜt_by_sourû_u£r
(cÚ¡ 
dœeùiÚ
);

134 
£aud™_sÜt_t
 *
£aud™_sÜt_by_sourû_rŞe
(cÚ¡ 
dœeùiÚ
);

147 
£aud™_sÜt_t
 *
£aud™_sÜt_by_sourû_ty³
(cÚ¡ 
dœeùiÚ
);

160 
£aud™_sÜt_t
 *
£aud™_sÜt_by_sourû_mls_lvl
(cÚ¡ 
dœeùiÚ
);

173 
£aud™_sÜt_t
 *
£aud™_sÜt_by_sourû_mls_şr
(cÚ¡ 
dœeùiÚ
);

186 
£aud™_sÜt_t
 *
£aud™_sÜt_by_rg‘_u£r
(cÚ¡ 
dœeùiÚ
);

199 
£aud™_sÜt_t
 *
£aud™_sÜt_by_rg‘_rŞe
(cÚ¡ 
dœeùiÚ
);

212 
£aud™_sÜt_t
 *
£aud™_sÜt_by_rg‘_ty³
(cÚ¡ 
dœeùiÚ
);

225 
£aud™_sÜt_t
 *
£aud™_sÜt_by_rg‘_mls_lvl
(cÚ¡ 
dœeùiÚ
);

238 
£aud™_sÜt_t
 *
£aud™_sÜt_by_rg‘_mls_şr
(cÚ¡ 
dœeùiÚ
);

251 
£aud™_sÜt_t
 *
£aud™_sÜt_by_objeù_şass
(cÚ¡ 
dœeùiÚ
);

264 
£aud™_sÜt_t
 *
£aud™_sÜt_by_execubË
(cÚ¡ 
dœeùiÚ
);

277 
£aud™_sÜt_t
 *
£aud™_sÜt_by_commªd
(cÚ¡ 
dœeùiÚ
);

290 
£aud™_sÜt_t
 *
£aud™_sÜt_by_Çme
(cÚ¡ 
dœeùiÚ
);

303 
£aud™_sÜt_t
 *
£aud™_sÜt_by_·th
(cÚ¡ 
dœeùiÚ
);

316 
£aud™_sÜt_t
 *
£aud™_sÜt_by_deviû
(cÚ¡ 
dœeùiÚ
);

329 
£aud™_sÜt_t
 *
£aud™_sÜt_by_šode
(cÚ¡ 
dœeùiÚ
);

342 
£aud™_sÜt_t
 *
£aud™_sÜt_by_pid
(cÚ¡ 
dœeùiÚ
);

355 
£aud™_sÜt_t
 *
£aud™_sÜt_by_pÜt
(cÚ¡ 
dœeùiÚ
);

368 
£aud™_sÜt_t
 *
£aud™_sÜt_by_Ïddr
(cÚ¡ 
dœeùiÚ
);

381 
£aud™_sÜt_t
 *
£aud™_sÜt_by_ÍÜt
(cÚ¡ 
dœeùiÚ
);

394 
£aud™_sÜt_t
 *
£aud™_sÜt_by_çddr
(cÚ¡ 
dœeùiÚ
);

407 
£aud™_sÜt_t
 *
£aud™_sÜt_by_åÜt
(cÚ¡ 
dœeùiÚ
);

420 
£aud™_sÜt_t
 *
£aud™_sÜt_by_§ddr
(cÚ¡ 
dœeùiÚ
);

433 
£aud™_sÜt_t
 *
£aud™_sÜt_by_¥Üt
(cÚ¡ 
dœeùiÚ
);

446 
£aud™_sÜt_t
 *
£aud™_sÜt_by_daddr
(cÚ¡ 
dœeùiÚ
);

459 
£aud™_sÜt_t
 *
£aud™_sÜt_by_dpÜt
(cÚ¡ 
dœeùiÚ
);

472 
£aud™_sÜt_t
 *
£aud™_sÜt_by_key
(cÚ¡ 
dœeùiÚ
);

485 
£aud™_sÜt_t
 *
£aud™_sÜt_by_ÿp
(cÚ¡ 
dœeùiÚ
);

487 #ifdeà 
__ılu¥lus


	@libseaudit/include/seaudit/util.h

25 #iâdeà
SEAUDIT_UTIL_H


26 
	#SEAUDIT_UTIL_H


	)

28 #ifdeà 
__ılu¥lus


38 cÚ¡ *
lib£aud™_g‘_v”siÚ
();

40 #ifdeà 
__ılu¥lus


	@libseaudit/src/avc_message.c

26 
	~"£aud™_š‹º®.h
"

28 
	~<­Ş/ut.h
>

30 
	~<”ºo.h
>

31 
	~<¡dlib.h
>

32 
	~<¡ršg.h
>

34 
£aud™_avc_mes§ge_ty³_e
 
	$£aud™_avc_mes§ge_g‘_mes§ge_ty³
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
)

36 ià(
avc
 =ğ
NULL
) {

37 
”ºo
 = 
EINVAL
;

38  
SEAUDIT_AVC_UNKNOWN
;

40  
avc
->
msg
;

41 
	}
}

43 
	$£aud™_avc_mes§ge_g‘_time¡amp_Çno
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
)

45 ià(
avc
 =ğ
NULL
) {

46 
”ºo
 = 
EINVAL
;

49  
avc
->
tm_¡mp_£c
;

50 
	}
}

52 cÚ¡ *
	$£aud™_avc_mes§ge_g‘_sourû_u£r
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
)

54 ià(
avc
 =ğ
NULL
) {

55 
”ºo
 = 
EINVAL
;

56  
NULL
;

58  
avc
->
su£r
;

59 
	}
}

61 cÚ¡ *
	$£aud™_avc_mes§ge_g‘_sourû_rŞe
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
)

63 ià(
avc
 =ğ
NULL
) {

64 
”ºo
 = 
EINVAL
;

65  
NULL
;

67  
avc
->
¤Şe
;

68 
	}
}

70 cÚ¡ *
	$£aud™_avc_mes§ge_g‘_sourû_ty³
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
)

72 ià(
avc
 =ğ
NULL
) {

73 
”ºo
 = 
EINVAL
;

74  
NULL
;

76  
avc
->
¡y³
;

77 
	}
}

79 cÚ¡ *
	$£aud™_avc_mes§ge_g‘_sourû_mls_lvl
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
)

81 ià(
avc
 =ğ
NULL
) {

82 
”ºo
 = 
EINVAL
;

83  
NULL
;

85  
avc
->
smls_lvl
;

86 
	}
}

88 cÚ¡ *
	$£aud™_avc_mes§ge_g‘_sourû_mls_şr
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
)

90 ià(
avc
 =ğ
NULL
) {

91 
”ºo
 = 
EINVAL
;

92  
NULL
;

94  
avc
->
smls_şr
;

95 
	}
}

97 cÚ¡ *
	$£aud™_avc_mes§ge_g‘_rg‘_u£r
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
)

99 ià(
avc
 =ğ
NULL
) {

100 
”ºo
 = 
EINVAL
;

101  
NULL
;

103  
avc
->
tu£r
;

104 
	}
}

106 cÚ¡ *
	$£aud™_avc_mes§ge_g‘_rg‘_rŞe
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
)

108 ià(
avc
 =ğ
NULL
) {

109 
”ºo
 = 
EINVAL
;

110  
NULL
;

112  
avc
->
ŒŞe
;

113 
	}
}

115 cÚ¡ *
	$£aud™_avc_mes§ge_g‘_rg‘_ty³
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
)

117 ià(
avc
 =ğ
NULL
) {

118 
”ºo
 = 
EINVAL
;

119  
NULL
;

121  
avc
->
‰y³
;

122 
	}
}

124 cÚ¡ *
	$£aud™_avc_mes§ge_g‘_rg‘_mls_lvl
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
)

126 ià(
avc
 =ğ
NULL
) {

127 
”ºo
 = 
EINVAL
;

128  
NULL
;

130  
avc
->
tmls_lvl
;

131 
	}
}

133 cÚ¡ *
	$£aud™_avc_mes§ge_g‘_rg‘_mls_şr
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
)

135 ià(
avc
 =ğ
NULL
) {

136 
”ºo
 = 
EINVAL
;

137  
NULL
;

139  
avc
->
tmls_şr
;

140 
	}
}

142 cÚ¡ *
	$£aud™_avc_mes§ge_g‘_objeù_şass
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
)

144 ià(
avc
 =ğ
NULL
) {

145 
”ºo
 = 
EINVAL
;

146  
NULL
;

148  
avc
->
tşass
;

149 
	}
}

151 cÚ¡ 
­Ş_veùÜ_t
 *
	$£aud™_avc_mes§ge_g‘_³rm
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
)

153 ià(
avc
 =ğ
NULL
) {

154 
”ºo
 = 
EINVAL
;

155  
NULL
;

157  
avc
->
³rms
;

158 
	}
}

160 cÚ¡ *
	$£aud™_avc_mes§ge_g‘_exe
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
)

162 ià(
avc
 =ğ
NULL
) {

163 
”ºo
 = 
EINVAL
;

164  
NULL
;

166  
avc
->
exe
;

167 
	}
}

169 cÚ¡ *
	$£aud™_avc_mes§ge_g‘_comm
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
)

171 ià(
avc
 =ğ
NULL
) {

172 
”ºo
 = 
EINVAL
;

173  
NULL
;

175  
avc
->
comm
;

176 
	}
}

178 cÚ¡ *
	$£aud™_avc_mes§ge_g‘_Çme
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
)

180 ià(
avc
 =ğ
NULL
) {

181 
”ºo
 = 
EINVAL
;

182  
NULL
;

184  
avc
->
Çme
;

185 
	}
}

187 
	$£aud™_avc_mes§ge_g‘_pid
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
)

189 ià(
avc
 =ğ
NULL
) {

190 
”ºo
 = 
EINVAL
;

193 ià(!
avc
->
is_pid
) {

196  
avc
->
pid
;

197 
	}
}

199 
	$£aud™_avc_mes§ge_g‘_šode
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
)

201 ià(
avc
 =ğ
NULL
) {

202 
”ºo
 = 
EINVAL
;

205 ià(!
avc
->
is_šode
) {

208  
avc
->
šode
;

209 
	}
}

211 cÚ¡ *
	$£aud™_avc_mes§ge_g‘_·th
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
)

213 ià(
avc
 =ğ
NULL
) {

214 
”ºo
 = 
EINVAL
;

215  
NULL
;

217  
avc
->
·th
;

218 
	}
}

220 cÚ¡ *
	$£aud™_avc_mes§ge_g‘_dev
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
)

222 ià(
avc
 =ğ
NULL
) {

223 
”ºo
 = 
EINVAL
;

224  
NULL
;

226  
avc
->
dev
;

227 
	}
}

229 cÚ¡ *
	$£aud™_avc_mes§ge_g‘_Ãtif
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
)

231 ià(
avc
 =ğ
NULL
) {

232 
”ºo
 = 
EINVAL
;

233  
NULL
;

235  
avc
->
Ãtif
;

236 
	}
}

238 
	$£aud™_avc_mes§ge_g‘_pÜt
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
)

240 ià(
avc
 =ğ
NULL
) {

241 
”ºo
 = 
EINVAL
;

244  
avc
->
pÜt
;

245 
	}
}

247 cÚ¡ *
	$£aud™_avc_mes§ge_g‘_Ïddr
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
)

249 ià(
avc
 =ğ
NULL
) {

250 
”ºo
 = 
EINVAL
;

251  
NULL
;

253  
avc
->
Ïddr
;

254 
	}
}

256 
	$£aud™_avc_mes§ge_g‘_ÍÜt
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
)

258 ià(
avc
 =ğ
NULL
) {

259 
”ºo
 = 
EINVAL
;

262  
avc
->
ÍÜt
;

263 
	}
}

265 cÚ¡ *
	$£aud™_avc_mes§ge_g‘_çddr
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
)

267 ià(
avc
 =ğ
NULL
) {

268 
”ºo
 = 
EINVAL
;

269  
NULL
;

271  
avc
->
çddr
;

272 
	}
}

274 
	$£aud™_avc_mes§ge_g‘_åÜt
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
)

276 ià(
avc
 =ğ
NULL
) {

277 
”ºo
 = 
EINVAL
;

280  
avc
->
åÜt
;

281 
	}
}

283 cÚ¡ *
	$£aud™_avc_mes§ge_g‘_§ddr
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
)

285 ià(
avc
 =ğ
NULL
) {

286 
”ºo
 = 
EINVAL
;

287  
NULL
;

289  
avc
->
§ddr
;

290 
	}
}

292 
	$£aud™_avc_mes§ge_g‘_¥Üt
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
)

294 ià(
avc
 =ğ
NULL
) {

295 
”ºo
 = 
EINVAL
;

298  
avc
->
sourû
;

299 
	}
}

301 cÚ¡ *
	$£aud™_avc_mes§ge_g‘_daddr
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
)

303 ià(
avc
 =ğ
NULL
) {

304 
”ºo
 = 
EINVAL
;

305  
NULL
;

307  
avc
->
daddr
;

308 
	}
}

310 
	$£aud™_avc_mes§ge_g‘_dpÜt
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
)

312 ià(
avc
 =ğ
NULL
) {

313 
”ºo
 = 
EINVAL
;

316  
avc
->
de¡
;

317 
	}
}

319 
	$£aud™_avc_mes§ge_g‘_key
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
)

321 ià(
avc
 =ğ
NULL
) {

322 
”ºo
 = 
EINVAL
;

325 ià(!
avc
->
is_key
) {

328  
avc
->
key
;

329 
	}
}

331 
	$£aud™_avc_mes§ge_g‘_ÿp
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
)

333 ià(
avc
 =ğ
NULL
) {

334 
”ºo
 = 
EINVAL
;

337 ià(!
avc
->
is_ÿ·b™y
) {

340  
avc
->
ÿ·b™y
;

341 
	}
}

345 
£aud™_avc_mes§ge_t
 *
	$avc_mes§ge_ü—‹
()

347 
£aud™_avc_mes§ge_t
 *
avc
 = 
	`ÿÎoc
(1, (seaudit_avc_message_t));

348 ià(
avc
 =ğ
NULL
) {

349  
NULL
;

351 ià((
avc
->
³rms
 = 
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(1, 
NULL
)) == NULL) {

352 
”rÜ
 = 
”ºo
;

353 
	`avc_mes§ge_ä“
(
avc
);

354 
”ºo
 = 
”rÜ
;

355  
NULL
;

357  
avc
;

358 
	}
}

360 
	$avc_mes§ge_ä“
(
£aud™_avc_mes§ge_t
 * 
avc
)

362 ià(
avc
 !ğ
NULL
) {

363 
	`ä“
(
avc
->
exe
);

364 
	`ä“
(
avc
->
comm
);

365 
	`ä“
(
avc
->
·th
);

366 
	`ä“
(
avc
->
dev
);

367 
	`ä“
(
avc
->
Ãtif
);

368 
	`ä“
(
avc
->
Ïddr
);

369 
	`ä“
(
avc
->
çddr
);

370 
	`ä“
(
avc
->
§ddr
);

371 
	`ä“
(
avc
->
daddr
);

372 
	`ä“
(
avc
->
Çme
);

373 
	`ä“
(
avc
->
addr
);

374 
	`­Ş_veùÜ_de¡roy
(&
avc
->
³rms
);

375 
	`ä“
(
avc
);

377 
	}
}

382 *
	$avc_mes§ge_g‘_misc_¡ršg
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
)

384 *
s
 = 
NULL
;

385 
size_t
 
Ën
 = 0;

386 ià(
avc
->
dev
 && 
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "dev=%s ",‡vc->dev) < 0) {

387  
NULL
;

389 ià(
avc
->
addr
 && 
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "ipaddr=%s ",‡vc->ipaddr) < 0) {

390  
NULL
;

392 ià(
avc
->
Ïddr
 && 
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "laddr=%s ",‡vc->laddr) < 0) {

393  
NULL
;

395 ià(
avc
->
ÍÜt
 !ğ0 && 
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "lport=%d ",‡vc->lport) < 0) {

396  
NULL
;

398 ià(
avc
->
çddr
 && 
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "faddr=%s ",‡vc->faddr) < 0) {

399  
NULL
;

401 ià(
avc
->
åÜt
 !ğ0 && 
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "fport=%d ",‡vc->fport) < 0) {

402  
NULL
;

404 ià(
avc
->
daddr
 && 
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "daddr=%s ",‡vc->daddr) < 0) {

405  
NULL
;

407 ià(
avc
->
de¡
 !ğ0 && 
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "dest=%d ",‡vc->dest) < 0) {

408  
NULL
;

410 ià(
avc
->
pÜt
 !ğ0 && 
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "port=%d ",‡vc->port) < 0) {

411  
NULL
;

413 ià(
avc
->
§ddr
 && 
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "saddr=%s ",‡vc->saddr) < 0) {

414  
NULL
;

416 ià(
avc
->
sourû
 !ğ0 && 
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "source=%d ",‡vc->source) < 0) {

417  
NULL
;

419 ià(
avc
->
Ãtif
 && 
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "netif=%s ",‡vc->netif) < 0) {

420  
NULL
;

422 ià(
avc
->
is_key
 && 
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "key=%d ",‡vc->
key
) < 0) {

423  
NULL
;

425 ià(
avc
->
is_ÿ·b™y
 && 
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "ÿ·b™y=%d ",‡vc->
ÿ·b™y
) < 0) {

426  
NULL
;

428 ià(
s
 =ğ
NULL
) {

429  
	`¡rdup
("");

431  
s
;

432 
	}
}

434 *
	$avc_mes§ge_to_¡ršg
(cÚ¡ 
£aud™_mes§ge_t
 * 
msg
, cÚ¡ *
d©e
)

436 
£aud™_avc_mes§ge_t
 *
avc
 = 
msg
->
d©a
.avc;

437 cÚ¡ *
ho¡
 = 
msg
->host;

438 cÚ¡ *
mªag”
 = 
msg
->manager;

439 *
s
 = 
NULL
, *
misc_¡ršg
 = NULL, *
³rm
;

440 
size_t
 
i
, 
Ën
 = 0;

441 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "% % %s: ", 
d©e
, 
ho¡
, 
mªag”
) < 0) {

442  
NULL
;

444 ià(!(
avc
->
tm_¡mp_£c
 =ğ0 &&‡vc->
tm_¡mp_Çno
 =ğ0 &&‡vc->
£rŸl
 == 0)) {

445 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "aud™(%lu.%03lu:%u): ", 
avc
->
tm_¡mp_£c
,‡vc->
tm_¡mp_Çno
,‡vc->
£rŸl
) < 0) {

446  
NULL
;

449 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
,

451 (
avc
->
msg
 =ğ
SEAUDIT_AVC_DENIED
 ? "denied" :

452 
avc
->
msg
 =ğ
SEAUDIT_AVC_GRANTED
 ? "granted" : "<unknown>")) < 0) {

453  
NULL
;

456 ià(
	`­Ş_veùÜ_g‘_size
(
avc
->
³rms
) > 0) {

457 ià(
	`­Ş_¡r_­³nd
(&
s
, &
Ën
, "{ ") < 0) {

458  
NULL
;

460 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
avc
->
³rms
); i++) {

461 
³rm
 = 
	`­Ş_veùÜ_g‘_–em’t
(
avc
->
³rms
, 
i
);

462 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "% ", 
³rm
) < 0) {

463  
NULL
;

466 ià(
	`­Ş_¡r_­³nd
(&
s
, &
Ën
, "} for ") < 0) {

467  
NULL
;

470 ià(
avc
->
is_pid
 && 
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "pid=%d ",‡vc->
pid
) < 0) {

471  
NULL
;

473 ià(
avc
->
exe
 && 
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "exe=%s ",‡vc->exe) < 0) {

474  
NULL
;

476 ià(
avc
->
comm
 && 
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "comm=%s ",‡vc->comm) < 0) {

477  
NULL
;

479 ià(
avc
->
·th
 && 
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "path=%s ",‡vc->path) < 0) {

480  
NULL
;

482 ià(
avc
->
Çme
 && 
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "name=%s ",‡vc->name) < 0) {

483  
NULL
;

485 ià(
avc
->
is_šode
 && 
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "šo=%lu ",‡vc->
šode
) < 0) {

486  
NULL
;

488 ià((
misc_¡ršg
 = 
	`avc_mes§ge_g‘_misc_¡ršg
(
avc
)è=ğ
NULL
 || 
	`­Ş_¡r_­³nd
(&
s
, &
Ën
, misc_string) < 0) {

489 
”rÜ
 = 
”ºo
;

490 
	`ä“
(
misc_¡ršg
);

491 
”ºo
 = 
”rÜ
;

492  
NULL
;

494 
	`ä“
(
misc_¡ršg
);

496 ià(
	`¡rcmp
(
avc
->
smls_lvl
,‡vc->
smls_şr
)) {

497 ià(
avc
->
su£r
 && 
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "scÚ‹xt=%s:%s:%s:%s-% ",‡vc->su£r,‡vc->
¤Şe
,‡vc->
¡y³
,‡vc->
smls_lvl
,‡vc->
smls_şr
) < 0) {

498  
NULL
;

500 } ià(
avc
->
su£r
 && 
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "scÚ‹xt=%s:%s:%s:% ",‡vc->su£r,‡vc->
¤Şe
,‡vc->
¡y³
,‡vc->
smls_lvl
) < 0) {

502  
NULL
;

504 ià(
	`¡rcmp
(
avc
->
tmls_lvl
,‡vc->
tmls_şr
)) {

505 ià(
avc
->
tu£r
 && 
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "tcÚ‹xt=%s:%s:%s:%s-% ",‡vc->tu£r,‡vc->
ŒŞe
,‡vc->
‰y³
,‡vc->
tmls_lvl
,‡vc->
tmls_şr
) < 0) {

506  
NULL
;

508 } ià(
avc
->
tu£r
 && 
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "tcÚ‹xt=%s:%s:%s:% ",‡vc->tu£r,‡vc->
ŒŞe
,‡vc->
‰y³
,‡vc->
tmls_lvl
) < 0) {

510  
NULL
;

512 ià(
avc
->
tşass
 && 
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "tclass=%s ",‡vc->tclass) < 0) {

513  
NULL
;

515  
s
;

516 
	}
}

518 *
	$avc_mes§ge_to_¡ršg_html
(cÚ¡ 
£aud™_mes§ge_t
 * 
msg
, cÚ¡ *
d©e
)

520 
£aud™_avc_mes§ge_t
 *
avc
 = 
msg
->
d©a
.avc;

521 cÚ¡ *
ho¡
 = 
msg
->host;

522 cÚ¡ *
mªag”
 = 
msg
->manager;

523 *
s
 = 
NULL
, *
misc_¡ršg
 = NULL, *
³rm
;

524 
size_t
 
i
, 
Ën
 = 0;

525 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
,

527 "<fÚˆşass=\"ho¡_Çme\">%s</fÚt> " "%s: ", 
d©e
, 
ho¡
, 
mªag”
) < 0) {

528  
NULL
;

530 ià(!(
avc
->
tm_¡mp_£c
 =ğ0 &&‡vc->
tm_¡mp_Çno
 =ğ0 &&‡vc->
£rŸl
 == 0)) {

531 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
,

533 
avc
->
tm_¡mp_£c
,‡vc->
tm_¡mp_Çno
,‡vc->
£rŸl
) < 0) {

534  
NULL
;

537 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
,

539 (
avc
->
msg
 =ğ
SEAUDIT_AVC_DENIED
 ? "<font class=\"avc_deny\">denied</font> " :

540 
avc
->
msg
 =ğ
SEAUDIT_AVC_GRANTED
 ? "<font class=\"avc_grant\">granted</font>" : "<unknown>")) < 0) {

541  
NULL
;

544 ià(
	`­Ş_veùÜ_g‘_size
(
avc
->
³rms
) > 0) {

545 ià(
	`­Ş_¡r_­³nd
(&
s
, &
Ën
, "{ ") < 0) {

546  
NULL
;

548 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
avc
->
³rms
); i++) {

549 
³rm
 = 
	`­Ş_veùÜ_g‘_–em’t
(
avc
->
³rms
, 
i
);

550 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "% ", 
³rm
) < 0) {

551  
NULL
;

554 ià(
	`­Ş_¡r_­³nd
(&
s
, &
Ën
, "} for ") < 0) {

555  
NULL
;

558 ià(
avc
->
is_pid
 && 
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "pid=%d ",‡vc->
pid
) < 0) {

559  
NULL
;

561 ià(
avc
->
exe
 && 
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "<font class=\"exe\">exe=%s</font> ",‡vc->exe) < 0) {

562  
NULL
;

564 ià(
avc
->
comm
 && 
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "comm=%s ",‡vc->comm) < 0) {

565  
NULL
;

567 ià(
avc
->
·th
 && 
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "path=%s ",‡vc->path) < 0) {

568  
NULL
;

570 ià(
avc
->
Çme
 && 
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "name=%s ",‡vc->name) < 0) {

571  
NULL
;

573 ià(
avc
->
is_šode
 && 
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "šo=%lu ",‡vc->
šode
) < 0) {

574  
NULL
;

576 ià((
misc_¡ršg
 = 
	`avc_mes§ge_g‘_misc_¡ršg
(
avc
)è=ğ
NULL
 || 
	`­Ş_¡r_­³nd
(&
s
, &
Ën
, misc_string) < 0) {

577 
”rÜ
 = 
”ºo
;

578 
	`ä“
(
misc_¡ršg
);

579 
”ºo
 = 
”rÜ
;

580  
NULL
;

582 
	`ä“
(
misc_¡ršg
);

583 if(
	`¡rcmp
(
avc
->
smls_lvl
,‡vc->
smls_şr
)) {

584 ià(
avc
->
su£r
 &&

585 
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "<font class=\"src_context\">scontext=%s:%s:%s:%s-%s</font> ",

586 
avc
->
su£r
,‡vc->
¤Şe
,‡vc->
¡y³
,‡vc->
smls_lvl
,‡vc->
smls_şr
) < 0) {

587  
NULL
;

589 } ià(
avc
->
su£r
 && 
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "<font class=\"src_context\">scontext=%s:%s:%s:%s</font> ",

590 
avc
->
su£r
,‡vc->
¤Şe
,‡vc->
¡y³
,‡vc->
smls_lvl
) < 0) {

592  
NULL
;

594 if(
	`¡rcmp
(
avc
->
tmls_lvl
,‡vc->
tmls_şr
)) {

595 ià(
avc
->
tu£r
 &&

596 
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "<font class=\"tgt_context\">tcontext=%s:%s:%s:%s-%s</font> ",

597 
avc
->
tu£r
,‡vc->
ŒŞe
,‡vc->
‰y³
,‡vc->
tmls_lvl
,‡vc->
tmls_şr
) < 0) {

598  
NULL
;

600 } ià(
avc
->
tu£r
 &&

601 
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "<font class=\"tgt_context\">tcontext=%s:%s:%s:%s</font> ",

602 
avc
->
tu£r
,‡vc->
ŒŞe
,‡vc->
‰y³
,‡vc->
tmls_lvl
) < 0) {

604  
NULL
;

606 ià(
avc
->
tşass
 && 
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "<font class=\"obj_class\">tclass=%s</font> ",‡vc->tclass) < 0) {

607  
NULL
;

609 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "<br>") < 0) {

610  
NULL
;

612  
s
;

613 
	}
}

615 *
	$avc_mes§ge_to_misc_¡ršg
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
)

617 *
s
 = 
	`avc_mes§ge_g‘_misc_¡ršg
(
avc
);

618 
size_t
 
Ën
;

619 ià(
s
 =ğ
NULL
) {

620  
NULL
;

622 
Ën
 = 
	`¡¾’
(
s
) + 1;

623 ià(!(
avc
->
tm_¡mp_£c
 =ğ0 &&‡vc->
tm_¡mp_Çno
 =ğ0 &&‡vc->
£rŸl
 == 0)) {

624 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "%stimestamp=%lu.%03lu serial=%u",

625 (
Ën
 > 1 ? " " : ""), 
avc
->
tm_¡mp_£c
,‡vc->
tm_¡mp_Çno
,‡vc->
£rŸl
) < 0) {

626  
NULL
;

629  
s
;

630 
	}
}

	@libseaudit/src/bool_message.c

25 
	~"£aud™_š‹º®.h
"

27 
	~<­Ş/ut.h
>

29 
	~<”ºo.h
>

30 
	~<¡dlib.h
>

31 
	~<¡ršg.h
>

35 
	$£aud™_boŞ_chªge_ä“
(*
–em
)

37 ià(
–em
 !ğ
NULL
) {

38 
£aud™_boŞ_mes§ge_chªge_t
 *
b
 = 
–em
;

39 
	`ä“
(
b
);

41 
	}
}

43 
£aud™_boŞ_mes§ge_t
 *
	$boŞ_mes§ge_ü—‹
()

45 
£aud™_boŞ_mes§ge_t
 *
boŞm
 = 
	`ÿÎoc
(1, (seaudit_bool_message_t));

46 ià(
boŞm
 =ğ
NULL
) {

47  
NULL
;

49 ià((
boŞm
->
chªges
 = 
	`­Ş_veùÜ_ü—‹
(
£aud™_boŞ_chªge_ä“
)è=ğ
NULL
) {

50 
	`boŞ_mes§ge_ä“
(
boŞm
);

51  
NULL
;

53  
boŞm
;

54 
	}
}

56 
	$boŞ_chªge_­³nd
(
£aud™_log_t
 * 
log
, 
£aud™_boŞ_mes§ge_t
 * 
boŞm
, cÚ¡ *
Çme
, 
v®ue
)

58 *
s
 = 
	`¡rdup
(
Çme
);

59 
£aud™_boŞ_mes§ge_chªge_t
 *
bc
 = 
NULL
;

60 
”rÜ
;

61 ià(
s
 =ğ
NULL
 || 
	`­Ş_b¡_š£¹_ªd_g‘
(
log
->
boŞs
, (**)&s, NULL) < 0) {

62 
”rÜ
 = 
”ºo
;

63 
	`ä“
(
s
);

64 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
”rÜ
));

65 
”ºo
 = 
”rÜ
;

68 ià((
bc
 = 
	`ÿÎoc
(1, (*bc))è=ğ
NULL
 || 
	`­Ş_veùÜ_­³nd
(
boŞm
->
chªges
, bc) < 0) {

69 
”rÜ
 = 
”ºo
;

70 
	`ä“
(
s
);

71 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
”rÜ
));

72 
”ºo
 = 
”rÜ
;

75 
bc
->
boŞ—n
 = 
s
;

76 
bc
->
v®ue
 = value;

78 
	}
}

80 
	$boŞ_mes§ge_ä“
(
£aud™_boŞ_mes§ge_t
 * 
boŞm
)

82 ià(
boŞm
 !ğ
NULL
) {

83 
	`­Ş_veùÜ_de¡roy
(&
boŞm
->
chªges
);

84 
	`ä“
(
boŞm
);

86 
	}
}

88 *
	$boŞ_mes§ge_to_¡ršg
(cÚ¡ 
£aud™_mes§ge_t
 * 
msg
, cÚ¡ *
d©e
)

90 
£aud™_boŞ_mes§ge_t
 *
boŞm
 = 
msg
->
d©a
.boolm;

91 cÚ¡ *
ho¡
 = 
msg
->host;

92 cÚ¡ *
mªag”
 = 
msg
->manager;

93 *
s
 = 
NULL
, *
misc_¡ršg
;

94 
size_t
 
Ën
 = 0;

95 *
İ’_b¿û
 = "", *
şo£_b¿û
 = "";

96 ià(
	`­Ş_veùÜ_g‘_size
(
boŞm
->
chªges
) > 0) {

97 
İ’_b¿û
 = "{ ";

98 
şo£_b¿û
 = " }";

100 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "% % %s: secur™y: comm™‹d boŞ—ns: %s", 
d©e
, 
ho¡
, 
mªag”
, 
İ’_b¿û
) < 0) {

101  
NULL
;

103 ià((
misc_¡ršg
 = 
	`boŞ_mes§ge_to_misc_¡ršg
(
boŞm
)è=ğ
NULL
 ||

104 
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, 
misc_¡ršg
è< 0 || 
	`­Ş_¡r_­³nd
(&s, &Ën, 
şo£_b¿û
) < 0) {

105 
	`ä“
(
misc_¡ršg
);

106  
NULL
;

108 
	`ä“
(
misc_¡ršg
);

109  
s
;

110 
	}
}

112 *
	$boŞ_mes§ge_to_¡ršg_html
(cÚ¡ 
£aud™_mes§ge_t
 * 
msg
, cÚ¡ *
d©e
)

114 
£aud™_boŞ_mes§ge_t
 *
boŞm
 = 
msg
->
d©a
.boolm;

115 cÚ¡ *
ho¡
 = 
msg
->host;

116 cÚ¡ *
mªag”
 = 
msg
->manager;

117 *
s
 = 
NULL
, *
misc_¡ršg
;

118 
size_t
 
Ën
 = 0;

119 *
İ’_b¿û
 = "", *
şo£_b¿û
 = "";

120 ià(
	`­Ş_veùÜ_g‘_size
(
boŞm
->
chªges
) > 0) {

121 
İ’_b¿û
 = "{ ";

122 
şo£_b¿û
 = " }";

124 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
,

127 "%s: secur™y: comm™‹d boŞ—ns: %s", 
d©e
, 
ho¡
, 
mªag”
, 
İ’_b¿û
) < 0) {

128  
NULL
;

130 ià((
misc_¡ršg
 = 
	`boŞ_mes§ge_to_misc_¡ršg
(
boŞm
)è=ğ
NULL
 ||

131 
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, 
misc_¡ršg
è< 0 ||‡pŞ_¡r_­³ndf(&s, &Ën, "%s%s<br>", s, 
şo£_b¿û
) < 0) {

132 
	`ä“
(
misc_¡ršg
);

133  
NULL
;

135 
	`ä“
(
misc_¡ršg
);

136  
s
;

137 
	}
}

139 *
	$boŞ_mes§ge_to_misc_¡ršg
(cÚ¡ 
£aud™_boŞ_mes§ge_t
 * 
boŞm
)

141 *
s
 = 
NULL
;

142 
size_t
 
Ën
 = 0, 
i
;

143 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
boŞm
->
chªges
); i++) {

144 
£aud™_boŞ_mes§ge_chªge_t
 *
bc
 = 
	`­Ş_veùÜ_g‘_–em’t
(
boŞm
->
chªges
, 
i
);

145 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "%s%s:%d", (
i
 =ğ0 ? "" : ", "), 
bc
->
boŞ—n
, bc->
v®ue
) < 0) {

146  
NULL
;

149 ià(
s
 =ğ
NULL
) {

150  
	`¡rdup
("");

152  
s
;

153 
	}
}

	@libseaudit/src/filter-internal.c

26 
	~"£aud™_š‹º®.h
"

27 
	~"f‹r-š‹º®.h
"

29 
	~<­Ş/ut.h
>

31 
	~<”ºo.h
>

32 
	~<âm©ch.h
>

33 
	~<¡dboŞ.h
>

34 
	~<¡dlib.h
>

35 
	~<¡ršg.h
>

36 
	~<time.h
>

37 
	~<libxml/uri.h
>

41 
	$f‹r_¡ršg_veùÜ_»ad
(
­Ş_veùÜ_t
 ** 
v
, cÚ¡ 
xmlCh¬
 * 
ch
)

43 *
s
;

44 ià(*
v
 =ğ
NULL
 && (*v = 
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(1, 
ä“
)) == NULL) {

47 ià((
s
 = 
	`xmlURIUÃsÿ³SŒšg
((cÚ¡ *)
ch
, 0, 
NULL
)è=ğNULL || 
	`­Ş_veùÜ_­³nd
(*
v
, s) < 0) {

48 
	`ä“
(
s
);

52 
	}
}

54 
	$f‹r_¡ršg_»ad
(**
de¡
, cÚ¡ 
xmlCh¬
 * 
ch
)

56 
	`ä“
(*
de¡
);

57 *
de¡
 = 
NULL
;

58 ià((*
de¡
 = 
	`xmlURIUÃsÿ³SŒšg
((cÚ¡ *)
ch
, 0, 
NULL
)) == NULL) {

62 
	}
}

64 
	$f‹r_ulÚg_»ad
(*
de¡
, cÚ¡ 
xmlCh¬
 * 
ch
)

66 *
s
, *
’d±r
;

67 
»tv®
 = -1;

68 ià((
s
 = 
	`xmlURIUÃsÿ³SŒšg
((cÚ¡ *)
ch
, 0, 
NULL
)) == NULL) {

71 *
de¡
 = 
	`¡¹oul
(
s
, &
’d±r
, 10);

72 ià(*
s
 !ğ'\0' && *
’d±r
 == '\0') {

73 
»tv®
 = 0;

75 
	`ä“
(
s
);

76  
»tv®
;

77 
	}
}

79 
	$f‹r_ušt_»ad
(*
de¡
, cÚ¡ 
xmlCh¬
 * 
ch
)

81 *
s
, *
’d±r
;

82 
»tv®
 = -1;

83 ià((
s
 = 
	`xmlURIUÃsÿ³SŒšg
((cÚ¡ *)
ch
, 0, 
NULL
)) == NULL) {

86 *
de¡
 = ()(
	`¡¹oul
(
s
, &
’d±r
, 10));

87 ià(*
s
 !ğ'\0' && *
’d±r
 == '\0') {

88 
»tv®
 = 0;

90 
	`ä“
(
s
);

91  
»tv®
;

92 
	}
}

94 
	$f‹r_št_»ad
(*
de¡
, cÚ¡ 
xmlCh¬
 * 
ch
)

96 *
s
, *
’d±r
;

97 
»tv®
 = -1;

98 ià((
s
 = 
	`xmlURIUÃsÿ³SŒšg
((cÚ¡ *)
ch
, 0, 
NULL
)) == NULL) {

101 *
de¡
 = ()(
	`¡¹Ş
(
s
, &
’d±r
, 10));

102 ià(*
s
 !ğ'\0' && *
’d±r
 == '\0') {

103 
»tv®
 = 0;

105 
	`ä“
(
s
);

106  
»tv®
;

107 
	}
}

109 
	$f‹r_¡ršg_veùÜ_´št
(cÚ¡ *
ü™”Ÿ_Çme
, 
­Ş_veùÜ_t
 * 
v
, 
FILE
 * 
f
, 
bs
)

111 
i
;

112 
size_t
 
j
;

113 ià(
v
 =ğ
NULL
) {

116 
i
 = 0; i < 
bs
; i++)

117 
	`årštf
(
f
, "\t");

118 
	`årštf
(
f
, "<ü™”Ÿy³=\"%s\">\n", 
ü™”Ÿ_Çme
);

119 
j
 = 0; j < 
	`­Ş_veùÜ_g‘_size
(
v
); j++) {

120 
xmlCh¬
 *
s
 = 
	`xmlCh¬SŒdup
(
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
j
));

121 
xmlCh¬
 *
esÿ³d
 = 
	`xmlURIEsÿ³SŒ
(
s
, 
NULL
);

122 
i
 = 0; i < 
bs
 + 1; i++) {

123 
	`årštf
(
f
, "\t");

125 
	`årštf
(
f
, "<™em>%s</™em>\n", 
esÿ³d
);

126 
	`ä“
(
esÿ³d
);

127 
	`ä“
(
s
);

129 
i
 = 0; i < 
bs
; i++)

130 
	`årštf
(
f
, "\t");

131 
	`årštf
(
f
, "</criteria>\n");

132 
	}
}

134 
	$f‹r_¡ršg_´št
(cÚ¡ *
ü™”Ÿ_Çme
, cÚ¡ *
s
, 
FILE
 * 
f
, 
bs
)

136 
i
;

137 
xmlCh¬
 *
t
, *
esÿ³d
;

138 ià(
s
 =ğ
NULL
) {

141 
t
 = 
	`xmlCh¬SŒdup
(
s
);

142 
esÿ³d
 = 
	`xmlURIEsÿ³SŒ
(
t
, 
NULL
);

143 
i
 = 0; i < 
bs
; i++)

144 
	`årštf
(
f
, "\t");

145 
	`årštf
(
f
, "<ü™”Ÿy³=\"%s\">\n", 
ü™”Ÿ_Çme
);

146 
i
 = 0; i < 
bs
 + 1; i++) {

147 
	`årštf
(
f
, "\t");

149 
	`årštf
(
f
, "<™em>%s</™em>\n", 
esÿ³d
);

150 
i
 = 0; i < 
bs
; i++)

151 
	`årštf
(
f
, "\t");

152 
	`årštf
(
f
, "</criteria>\n");

153 
	`ä“
(
esÿ³d
);

154 
	`ä“
(
t
);

155 
	}
}

157 
	$f‹r_ulÚg_´št
(cÚ¡ *
ü™”Ÿ_Çme
, cÚ¡ 
v®
, 
FILE
 * 
f
, 
bs
)

159 
i
;

160 
i
 = 0; i < 
bs
; i++)

161 
	`årštf
(
f
, "\t");

162 
	`årštf
(
f
, "<ü™”Ÿy³=\"%s\">\n", 
ü™”Ÿ_Çme
);

163 
i
 = 0; i < 
bs
 + 1; i++) {

164 
	`årštf
(
f
, "\t");

166 
	`årštf
(
f
, "<™em>%lu</™em>\n", 
v®
);

167 
i
 = 0; i < 
bs
; i++)

168 
	`årštf
(
f
, "\t");

169 
	`årštf
(
f
, "</criteria>\n");

170 
	}
}

172 
	$f‹r_ušt_´št
(cÚ¡ *
ü™”Ÿ_Çme
, cÚ¡ 
v®
, 
FILE
 * 
f
, 
bs
)

174 
i
;

175 
i
 = 0; i < 
bs
; i++)

176 
	`årštf
(
f
, "\t");

177 
	`årštf
(
f
, "<ü™”Ÿy³=\"%s\">\n", 
ü™”Ÿ_Çme
);

178 
i
 = 0; i < 
bs
 + 1; i++) {

179 
	`årštf
(
f
, "\t");

181 
	`årštf
(
f
, "<™em>%u</™em>\n", 
v®
);

182 
i
 = 0; i < 
bs
; i++)

183 
	`årštf
(
f
, "\t");

184 
	`årštf
(
f
, "</criteria>\n");

185 
	}
}

187 
	$f‹r_št_´št
(cÚ¡ *
ü™”Ÿ_Çme
, cÚ¡ 
v®
, 
FILE
 * 
f
, 
bs
)

189 
i
;

190 
i
 = 0; i < 
bs
; i++)

191 
	`årštf
(
f
, "\t");

192 
	`årštf
(
f
, "<ü™”Ÿy³=\"%s\">\n", 
ü™”Ÿ_Çme
);

193 
i
 = 0; i < 
bs
 + 1; i++) {

194 
	`årštf
(
f
, "\t");

196 
	`årštf
(
f
, "<™em>%d</™em>\n", 
v®
);

197 
i
 = 0; i < 
bs
; i++)

198 
	`årštf
(
f
, "\t");

199 
	`årštf
(
f
, "</criteria>\n");

200 
	}
}

204 
boŞ
 
	$f‹r_¤c_u£r_is_£t
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

206  
f‹r
->
¤c_u£rs
 !ğ
NULL
;

207 
	}
}

209 
	$f‹r_¤c_u£r_suµÜt
(cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

211  
msg
->
ty³
 =ğ
SEAUDIT_MESSAGE_TYPE_AVC
 && msg->
d©a
.
avc
->
su£r
 !ğ
NULL
;

212 
	}
}

214 
	$f‹r_¤c_u£r_acû±
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

216 
size_t
 
i
;

217  
	`­Ş_veùÜ_g‘_šdex
(
f‹r
->
¤c_u£rs
, 
msg
->
d©a
.
avc
->
su£r
, 
­Ş_¡r_¡rcmp
, 
NULL
, &
i
) == 0;

218 
	}
}

220 
	$f‹r_¤c_u£r_»ad
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
xmlCh¬
 * 
ch
)

222  
	`f‹r_¡ršg_veùÜ_»ad
(&
f‹r
->
¤c_u£rs
, 
ch
);

223 
	}
}

225 
	$f‹r_¤c_u£r_´št
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ *
Çme
, 
FILE
 * 
f
, 
bs
)

227 
	`f‹r_¡ršg_veùÜ_´št
(
Çme
, 
f‹r
->
¤c_u£rs
, 
f
, 
bs
);

228 
	}
}

230 
boŞ
 
	$f‹r_¤c_rŞe_is_£t
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

232  
f‹r
->
¤c_rŞes
 !ğ
NULL
;

233 
	}
}

235 
	$f‹r_¤c_rŞe_suµÜt
(cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

237  
msg
->
ty³
 =ğ
SEAUDIT_MESSAGE_TYPE_AVC
 && msg->
d©a
.
avc
->
¤Şe
 !ğ
NULL
;

238 
	}
}

240 
	$f‹r_¤c_rŞe_acû±
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

242 
size_t
 
i
;

243  
	`­Ş_veùÜ_g‘_šdex
(
f‹r
->
¤c_rŞes
, 
msg
->
d©a
.
avc
->
¤Şe
, 
­Ş_¡r_¡rcmp
, 
NULL
, &
i
) == 0;

244 
	}
}

246 
	$f‹r_¤c_rŞe_»ad
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
xmlCh¬
 * 
ch
)

248  
	`f‹r_¡ršg_veùÜ_»ad
(&
f‹r
->
¤c_rŞes
, 
ch
);

249 
	}
}

251 
	$f‹r_¤c_rŞe_´št
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ *
Çme
, 
FILE
 * 
f
, 
bs
)

253 
	`f‹r_¡ršg_veùÜ_´št
(
Çme
, 
f‹r
->
¤c_rŞes
, 
f
, 
bs
);

254 
	}
}

256 
boŞ
 
	$f‹r_¤c_ty³_is_£t
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

258  
f‹r
->
¤c_ty³s
 !ğ
NULL
;

259 
	}
}

261 
	$f‹r_¤c_ty³_suµÜt
(cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

263  
msg
->
ty³
 =ğ
SEAUDIT_MESSAGE_TYPE_AVC
 && msg->
d©a
.
avc
->
¡y³
 !ğ
NULL
;

264 
	}
}

266 
	$f‹r_¤c_ty³_»ad
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
xmlCh¬
 * 
ch
)

268  
	`f‹r_¡ršg_veùÜ_»ad
(&
f‹r
->
¤c_ty³s
, 
ch
);

269 
	}
}

271 
	$f‹r_¤c_ty³_acû±
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

273 
size_t
 
i
;

274  
	`­Ş_veùÜ_g‘_šdex
(
f‹r
->
¤c_ty³s
, 
msg
->
d©a
.
avc
->
¡y³
, 
­Ş_¡r_¡rcmp
, 
NULL
, &
i
) == 0;

275 
	}
}

277 
	$f‹r_¤c_ty³_´št
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ *
Çme
, 
FILE
 * 
f
, 
bs
)

279 
	`f‹r_¡ršg_veùÜ_´št
(
Çme
, 
f‹r
->
¤c_ty³s
, 
f
, 
bs
);

280 
	}
}

282 
boŞ
 
	$f‹r_¤c_mls_lvl_is_£t
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

284  
f‹r
->
¤c_mls_lvl
 !ğ
NULL
;

285 
	}
}

287 
	$f‹r_¤c_mls_lvl_suµÜt
(cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

289  
msg
->
ty³
 =ğ
SEAUDIT_MESSAGE_TYPE_AVC
 && msg->
d©a
.
avc
->
smls_lvl
 !ğ
NULL
;

290 
	}
}

292 
	$f‹r_¤c_mls_lvl_»ad
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
xmlCh¬
 * 
ch
)

294  
	`f‹r_¡ršg_veùÜ_»ad
(&
f‹r
->
¤c_mls_lvl
, 
ch
);

295 
	}
}

297 
	$f‹r_¤c_mls_lvl_acû±
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

299 
size_t
 
i
;

300  
	`­Ş_veùÜ_g‘_šdex
(
f‹r
->
¤c_mls_lvl
, 
msg
->
d©a
.
avc
->
smls_lvl
, 
­Ş_¡r_¡rcmp
, 
NULL
, &
i
) == 0;

301 
	}
}

303 
	$f‹r_¤c_mls_lvl_´št
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ *
Çme
, 
FILE
 * 
f
, 
bs
)

305 
	`f‹r_¡ršg_veùÜ_´št
(
Çme
, 
f‹r
->
¤c_mls_lvl
, 
f
, 
bs
);

306 
	}
}

308 
boŞ
 
	$f‹r_¤c_mls_şr_is_£t
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

310  
f‹r
->
¤c_mls_şr
 !ğ
NULL
;

311 
	}
}

313 
	$f‹r_¤c_mls_şr_suµÜt
(cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

315  
msg
->
ty³
 =ğ
SEAUDIT_MESSAGE_TYPE_AVC
 && msg->
d©a
.
avc
->
smls_şr
 !ğ
NULL
;

316 
	}
}

318 
	$f‹r_¤c_mls_şr_»ad
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
xmlCh¬
 * 
ch
)

320  
	`f‹r_¡ršg_veùÜ_»ad
(&
f‹r
->
¤c_mls_şr
, 
ch
);

321 
	}
}

323 
	$f‹r_¤c_mls_şr_acû±
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

325 
size_t
 
i
;

326  
	`­Ş_veùÜ_g‘_šdex
(
f‹r
->
¤c_mls_şr
, 
msg
->
d©a
.
avc
->
smls_şr
, 
­Ş_¡r_¡rcmp
, 
NULL
, &
i
) == 0;

327 
	}
}

329 
	$f‹r_¤c_mls_şr_´št
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ *
Çme
, 
FILE
 * 
f
, 
bs
)

331 
	`f‹r_¡ršg_veùÜ_´št
(
Çme
, 
f‹r
->
¤c_mls_şr
, 
f
, 
bs
);

332 
	}
}

334 
boŞ
 
	$f‹r_tgt_u£r_is_£t
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

336  
f‹r
->
tgt_u£rs
 !ğ
NULL
;

337 
	}
}

339 
	$f‹r_tgt_u£r_suµÜt
(cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

341  
msg
->
ty³
 =ğ
SEAUDIT_MESSAGE_TYPE_AVC
 && msg->
d©a
.
avc
->
tu£r
 !ğ
NULL
;

342 
	}
}

344 
	$f‹r_tgt_u£r_acû±
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

346 
size_t
 
i
;

347  
	`­Ş_veùÜ_g‘_šdex
(
f‹r
->
tgt_u£rs
, 
msg
->
d©a
.
avc
->
tu£r
, 
­Ş_¡r_¡rcmp
, 
NULL
, &
i
) == 0;

348 
	}
}

350 
	$f‹r_tgt_u£r_»ad
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
xmlCh¬
 * 
ch
)

352  
	`f‹r_¡ršg_veùÜ_»ad
(&
f‹r
->
tgt_u£rs
, 
ch
);

353 
	}
}

355 
	$f‹r_tgt_u£r_´št
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ *
Çme
, 
FILE
 * 
f
, 
bs
)

357 
	`f‹r_¡ršg_veùÜ_´št
(
Çme
, 
f‹r
->
tgt_u£rs
, 
f
, 
bs
);

358 
	}
}

360 
boŞ
 
	$f‹r_tgt_rŞe_is_£t
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

362  
f‹r
->
tgt_rŞes
 !ğ
NULL
;

363 
	}
}

365 
	$f‹r_tgt_rŞe_suµÜt
(cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

367  
msg
->
ty³
 =ğ
SEAUDIT_MESSAGE_TYPE_AVC
 && msg->
d©a
.
avc
->
ŒŞe
 !ğ
NULL
;

368 
	}
}

370 
	$f‹r_tgt_rŞe_acû±
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

372 
size_t
 
i
;

373  
	`­Ş_veùÜ_g‘_šdex
(
f‹r
->
tgt_rŞes
, 
msg
->
d©a
.
avc
->
ŒŞe
, 
­Ş_¡r_¡rcmp
, 
NULL
, &
i
) == 0;

374 
	}
}

376 
	$f‹r_tgt_rŞe_»ad
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
xmlCh¬
 * 
ch
)

378  
	`f‹r_¡ršg_veùÜ_»ad
(&
f‹r
->
tgt_rŞes
, 
ch
);

379 
	}
}

381 
	$f‹r_tgt_rŞe_´št
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ *
Çme
, 
FILE
 * 
f
, 
bs
)

383 
	`f‹r_¡ršg_veùÜ_´št
(
Çme
, 
f‹r
->
tgt_rŞes
, 
f
, 
bs
);

384 
	}
}

386 
boŞ
 
	$f‹r_tgt_ty³_is_£t
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

388  
f‹r
->
tgt_ty³s
 !ğ
NULL
;

389 
	}
}

391 
	$f‹r_tgt_ty³_suµÜt
(cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

393  
msg
->
ty³
 =ğ
SEAUDIT_MESSAGE_TYPE_AVC
 && msg->
d©a
.
avc
->
‰y³
 !ğ
NULL
;

394 
	}
}

396 
	$f‹r_tgt_ty³_acû±
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

398 
size_t
 
i
;

399  
	`­Ş_veùÜ_g‘_šdex
(
f‹r
->
tgt_ty³s
, 
msg
->
d©a
.
avc
->
‰y³
, 
­Ş_¡r_¡rcmp
, 
NULL
, &
i
) == 0;

400 
	}
}

402 
	$f‹r_tgt_ty³_»ad
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
xmlCh¬
 * 
ch
)

404  
	`f‹r_¡ršg_veùÜ_»ad
(&
f‹r
->
tgt_ty³s
, 
ch
);

405 
	}
}

407 
	$f‹r_tgt_ty³_´št
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ *
Çme
, 
FILE
 * 
f
, 
bs
)

409 
	`f‹r_¡ršg_veùÜ_´št
(
Çme
, 
f‹r
->
tgt_ty³s
, 
f
, 
bs
);

410 
	}
}

412 
boŞ
 
	$f‹r_tgt_mls_lvl_is_£t
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

414  
f‹r
->
tgt_mls_lvl
 !ğ
NULL
;

415 
	}
}

417 
	$f‹r_tgt_mls_lvl_suµÜt
(cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

419  
msg
->
ty³
 =ğ
SEAUDIT_MESSAGE_TYPE_AVC
 && msg->
d©a
.
avc
->
tmls_lvl
 !ğ
NULL
;

420 
	}
}

422 
	$f‹r_tgt_mls_lvl_»ad
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
xmlCh¬
 * 
ch
)

424  
	`f‹r_¡ršg_veùÜ_»ad
(&
f‹r
->
tgt_mls_lvl
, 
ch
);

425 
	}
}

427 
	$f‹r_tgt_mls_lvl_acû±
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

429 
size_t
 
i
;

430  
	`­Ş_veùÜ_g‘_šdex
(
f‹r
->
tgt_mls_lvl
, 
msg
->
d©a
.
avc
->
tmls_lvl
, 
­Ş_¡r_¡rcmp
, 
NULL
, &
i
) == 0;

431 
	}
}

433 
	$f‹r_tgt_mls_lvl_´št
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ *
Çme
, 
FILE
 * 
f
, 
bs
)

435 
	`f‹r_¡ršg_veùÜ_´št
(
Çme
, 
f‹r
->
tgt_mls_lvl
, 
f
, 
bs
);

436 
	}
}

438 
boŞ
 
	$f‹r_tgt_mls_şr_is_£t
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

440  
f‹r
->
tgt_mls_şr
 !ğ
NULL
;

441 
	}
}

443 
	$f‹r_tgt_mls_şr_suµÜt
(cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

445  
msg
->
ty³
 =ğ
SEAUDIT_MESSAGE_TYPE_AVC
 && msg->
d©a
.
avc
->
tmls_şr
 !ğ
NULL
;

446 
	}
}

448 
	$f‹r_tgt_mls_şr_»ad
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
xmlCh¬
 * 
ch
)

450  
	`f‹r_¡ršg_veùÜ_»ad
(&
f‹r
->
tgt_mls_şr
, 
ch
);

451 
	}
}

453 
	$f‹r_tgt_mls_şr_acû±
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

455 
size_t
 
i
;

456  
	`­Ş_veùÜ_g‘_šdex
(
f‹r
->
tgt_mls_şr
, 
msg
->
d©a
.
avc
->
tmls_şr
, 
­Ş_¡r_¡rcmp
, 
NULL
, &
i
) == 0;

457 
	}
}

459 
	$f‹r_tgt_mls_şr_´št
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ *
Çme
, 
FILE
 * 
f
, 
bs
)

461 
	`f‹r_¡ršg_veùÜ_´št
(
Çme
, 
f‹r
->
tgt_mls_şr
, 
f
, 
bs
);

462 
	}
}

465 
boŞ
 
	$f‹r_tgt_şass_is_£t
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

467  
f‹r
->
tgt_şas£s
 !ğ
NULL
;

468 
	}
}

470 
	$f‹r_tgt_şass_suµÜt
(cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

472  
msg
->
ty³
 =ğ
SEAUDIT_MESSAGE_TYPE_AVC
 && msg->
d©a
.
avc
->
tşass
 !ğ
NULL
;

473 
	}
}

475 
	$f‹r_tgt_şass_acû±
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

477 
size_t
 
i
;

478  
	`­Ş_veùÜ_g‘_šdex
(
f‹r
->
tgt_şas£s
, 
msg
->
d©a
.
avc
->
tşass
, 
­Ş_¡r_¡rcmp
, 
NULL
, &
i
) == 0;

479 
	}
}

481 
	$f‹r_tgt_şass_»ad
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
xmlCh¬
 * 
ch
)

483  
	`f‹r_¡ršg_veùÜ_»ad
(&
f‹r
->
tgt_şas£s
, 
ch
);

484 
	}
}

486 
	$f‹r_tgt_şass_´št
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ *
Çme
, 
FILE
 * 
f
, 
bs
)

488 
	`f‹r_¡ršg_veùÜ_´št
(
Çme
, 
f‹r
->
tgt_şas£s
, 
f
, 
bs
);

489 
	}
}

491 
boŞ
 
	$f‹r_³rm_is_£t
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

493  
f‹r
->
³rm
 !ğ
NULL
;

494 
	}
}

496 
	$f‹r_³rm_suµÜt
(cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

498  
msg
->
ty³
 =ğ
SEAUDIT_MESSAGE_TYPE_AVC
 && msg->
d©a
.
avc
->
³rms
 !ğ
NULL
 &&

499 
	`­Ş_veùÜ_g‘_size
(
msg
->
d©a
.
avc
->
³rms
) >= 1;

500 
	}
}

502 
	$f‹r_³rm_acû±
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

504 
size_t
 
i
;

505 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
msg
->
d©a
.
avc
->
³rms
); i++) {

506 cÚ¡ *
p
 = 
	`­Ş_veùÜ_g‘_–em’t
(
msg
->
d©a
.
avc
->
³rms
, 
i
);

507 ià(
	`âm©ch
(
f‹r
->
³rm
, 
p
, 0) == 0) {

512 
	}
}

514 
	$f‹r_³rm_»ad
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
xmlCh¬
 * 
ch
)

516  
	`f‹r_¡ršg_»ad
(&
f‹r
->
³rm
, 
ch
);

517 
	}
}

519 
	$f‹r_³rm_´št
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ *
Çme
, 
FILE
 * 
f
, 
bs
)

521 
	`f‹r_¡ršg_´št
(
Çme
, 
f‹r
->
³rm
, 
f
, 
bs
);

522 
	}
}

524 
boŞ
 
	$f‹r_exe_is_£t
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

526  
f‹r
->
exe
 !ğ
NULL
;

527 
	}
}

529 
	$f‹r_exe_suµÜt
(cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

531  
msg
->
ty³
 =ğ
SEAUDIT_MESSAGE_TYPE_AVC
 && msg->
d©a
.
avc
->
exe
 !ğ
NULL
;

532 
	}
}

534 
	$f‹r_exe_acû±
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

536  
	`âm©ch
(
f‹r
->
exe
, 
msg
->
d©a
.
avc
->exe, 0) == 0;

537 
	}
}

539 
	$f‹r_exe_»ad
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
xmlCh¬
 * 
ch
)

541  
	`f‹r_¡ršg_»ad
(&
f‹r
->
exe
, 
ch
);

542 
	}
}

544 
	$f‹r_exe_´št
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ *
Çme
, 
FILE
 * 
f
, 
bs
)

546 
	`f‹r_¡ršg_´št
(
Çme
, 
f‹r
->
exe
, 
f
, 
bs
);

547 
	}
}

549 
boŞ
 
	$f‹r_ho¡_is_£t
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

551  
f‹r
->
ho¡
 !ğ
NULL
;

552 
	}
}

554 
	$f‹r_ho¡_suµÜt
(cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

556  
msg
->
ho¡
 !ğ
NULL
;

557 
	}
}

559 
	$f‹r_ho¡_acû±
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

561  
	`âm©ch
(
f‹r
->
ho¡
, 
msg
->host, 0) == 0;

562 
	}
}

564 
	$f‹r_ho¡_»ad
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
xmlCh¬
 * 
ch
)

566  
	`f‹r_¡ršg_»ad
(&
f‹r
->
ho¡
, 
ch
);

567 
	}
}

569 
	$f‹r_ho¡_´št
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ *
Çme
, 
FILE
 * 
f
, 
bs
)

571 
	`f‹r_¡ršg_´št
(
Çme
, 
f‹r
->
ho¡
, 
f
, 
bs
);

572 
	}
}

574 
boŞ
 
	$f‹r_·th_is_£t
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

576  
f‹r
->
·th
 !ğ
NULL
;

577 
	}
}

579 
	$f‹r_·th_suµÜt
(cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

581  
msg
->
ty³
 =ğ
SEAUDIT_MESSAGE_TYPE_AVC
 && msg->
d©a
.
avc
->
·th
 !ğ
NULL
;

582 
	}
}

584 
	$f‹r_·th_acû±
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

586  
	`âm©ch
(
f‹r
->
·th
, 
msg
->
d©a
.
avc
->path, 0) == 0;

587 
	}
}

589 
	$f‹r_·th_»ad
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
xmlCh¬
 * 
ch
)

591  
	`f‹r_¡ršg_»ad
(&
f‹r
->
·th
, 
ch
);

592 
	}
}

594 
	$f‹r_·th_´št
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ *
Çme
, 
FILE
 * 
f
, 
bs
)

596 
	`f‹r_¡ršg_´št
(
Çme
, 
f‹r
->
·th
, 
f
, 
bs
);

597 
	}
}

599 
boŞ
 
	$f‹r_šode_is_£t
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

601  
f‹r
->
šode
 != 0;

602 
	}
}

604 
	$f‹r_šode_suµÜt
(cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

606  
msg
->
ty³
 =ğ
SEAUDIT_MESSAGE_TYPE_AVC
 && msg->
d©a
.
avc
->
is_šode
;

607 
	}
}

609 
	$f‹r_šode_acû±
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

611  
f‹r
->
šode
 =ğ
msg
->
d©a
.
avc
->inode;

612 
	}
}

614 
	$f‹r_šode_»ad
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
xmlCh¬
 * 
ch
)

616  
	`f‹r_ulÚg_»ad
(&
f‹r
->
šode
, 
ch
);

617 
	}
}

619 
	$f‹r_šode_´št
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ *
Çme
, 
FILE
 * 
f
, 
bs
)

621 
	`f‹r_ulÚg_´št
(
Çme
, 
f‹r
->
šode
, 
f
, 
bs
);

622 
	}
}

624 
boŞ
 
	$f‹r_pid_is_£t
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

626  
f‹r
->
pid
 != 0;

627 
	}
}

629 
	$f‹r_pid_suµÜt
(cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

631  
msg
->
ty³
 =ğ
SEAUDIT_MESSAGE_TYPE_AVC
 && msg->
d©a
.
avc
->
is_pid
;

632 
	}
}

634 
	$f‹r_pid_acû±
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

636  
f‹r
->
pid
 =ğ
msg
->
d©a
.
avc
->pid;

637 
	}
}

639 
	$f‹r_pid_»ad
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
xmlCh¬
 * 
ch
)

641  
	`f‹r_ušt_»ad
(&
f‹r
->
pid
, 
ch
);

642 
	}
}

644 
	$f‹r_pid_´št
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ *
Çme
, 
FILE
 * 
f
, 
bs
)

646 
	`f‹r_ušt_´št
(
Çme
, 
f‹r
->
pid
, 
f
, 
bs
);

647 
	}
}

649 
boŞ
 
	$f‹r_comm_is_£t
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

651  
f‹r
->
comm
 !ğ
NULL
;

652 
	}
}

654 
	$f‹r_comm_suµÜt
(cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

656  
msg
->
ty³
 =ğ
SEAUDIT_MESSAGE_TYPE_AVC
 && msg->
d©a
.
avc
->
comm
 !ğ
NULL
;

657 
	}
}

659 
	$f‹r_comm_acû±
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

661  
	`âm©ch
(
f‹r
->
comm
, 
msg
->
d©a
.
avc
->comm, 0) == 0;

662 
	}
}

664 
	$f‹r_comm_»ad
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
xmlCh¬
 * 
ch
)

666  
	`f‹r_¡ršg_»ad
(&
f‹r
->
comm
, 
ch
);

667 
	}
}

669 
	$f‹r_comm_´št
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ *
Çme
, 
FILE
 * 
f
, 
bs
)

671 
	`f‹r_¡ršg_´št
(
Çme
, 
f‹r
->
comm
, 
f
, 
bs
);

672 
	}
}

674 
boŞ
 
	$f‹r_ªyaddr_is_£t
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

676  
f‹r
->
ªyaddr
 !ğ
NULL
;

677 
	}
}

679 
	$f‹r_ªyaddr_suµÜt
(cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

681  
msg
->
ty³
 =ğ
SEAUDIT_MESSAGE_TYPE_AVC
 && (msg->
d©a
.
avc
->
§ddr
 !ğ
NULL


682 || 
msg
->
d©a
.
avc
->
daddr
 !ğ
NULL


683 || 
msg
->
d©a
.
avc
->
çddr
 !ğ
NULL


684 || 
msg
->
d©a
.
avc
->
Ïddr
 !ğ
NULL
 || msg->d©a.avc->
addr
 != NULL);

685 
	}
}

687 
	$f‹r_ªyaddr_acû±
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

689 ià(
msg
->
d©a
.
avc
->
§ddr
 && 
	`âm©ch
(
f‹r
->
ªyaddr
, msg->data.avc->saddr, 0) == 0)

691 ià(
msg
->
d©a
.
avc
->
daddr
 && 
	`âm©ch
(
f‹r
->
ªyaddr
, msg->data.avc->daddr, 0) == 0)

693 ià(
msg
->
d©a
.
avc
->
çddr
 && 
	`âm©ch
(
f‹r
->
ªyaddr
, msg->data.avc->faddr, 0) == 0)

695 ià(
msg
->
d©a
.
avc
->
Ïddr
 && 
	`âm©ch
(
f‹r
->
ªyaddr
, msg->data.avc->laddr, 0) == 0)

697 ià(
msg
->
d©a
.
avc
->
addr
 && 
	`âm©ch
(
f‹r
->
ªyaddr
, msg->data.avc->ipaddr, 0) == 0)

700 
	}
}

702 
	$f‹r_ªyaddr_»ad
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
xmlCh¬
 * 
ch
)

704  
	`f‹r_¡ršg_»ad
(&
f‹r
->
ªyaddr
, 
ch
);

705 
	}
}

707 
	$f‹r_ªyaddr_´št
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ *
Çme
, 
FILE
 * 
f
, 
bs
)

709 
	`f‹r_¡ršg_´št
(
Çme
, 
f‹r
->
ªyaddr
, 
f
, 
bs
);

710 
	}
}

712 
boŞ
 
	$f‹r_ªypÜt_is_£t
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

714  
f‹r
->
ªypÜt
 != 0;

715 
	}
}

717 
	$f‹r_ªypÜt_suµÜt
(cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

719  
msg
->
ty³
 =ğ
SEAUDIT_MESSAGE_TYPE_AVC
 && (msg->
d©a
.
avc
->
pÜt
 != 0 ||

720 
msg
->
d©a
.
avc
->
sourû
 != 0 ||

721 
msg
->
d©a
.
avc
->
de¡
 != 0 ||

722 
msg
->
d©a
.
avc
->
åÜt
 !ğ0 || msg->d©a.avc->
ÍÜt
 != 0);

723 
	}
}

725 
	$f‹r_ªypÜt_acû±
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

727 ià(
msg
->
d©a
.
avc
->
pÜt
 !ğ0 && 
f‹r
->
ªypÜt
 == msg->data.avc->port) {

730 ià(
msg
->
d©a
.
avc
->
sourû
 !ğ0 && 
f‹r
->
ªypÜt
 == msg->data.avc->source) {

733 ià(
msg
->
d©a
.
avc
->
de¡
 !ğ0 && 
f‹r
->
ªypÜt
 == msg->data.avc->dest) {

736 ià(
msg
->
d©a
.
avc
->
åÜt
 !ğ0 && 
f‹r
->
ªypÜt
 == msg->data.avc->fport) {

739 ià(
msg
->
d©a
.
avc
->
ÍÜt
 !ğ0 && 
f‹r
->
ªypÜt
 == msg->data.avc->lport) {

743 
	}
}

745 
	$f‹r_ªypÜt_»ad
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
xmlCh¬
 * 
ch
)

747  
	`f‹r_št_»ad
(&
f‹r
->
ªypÜt
, 
ch
);

748 
	}
}

750 
	$f‹r_ªypÜt_´št
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ *
Çme
, 
FILE
 * 
f
, 
bs
)

752 
	`f‹r_št_´št
(
Çme
, 
f‹r
->
ªypÜt
, 
f
, 
bs
);

753 
	}
}

755 
boŞ
 
	$f‹r_Ïddr_is_£t
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

757  
f‹r
->
Ïddr
 !ğ
NULL
;

758 
	}
}

760 
	$f‹r_Ïddr_suµÜt
(cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

762  
msg
->
ty³
 =ğ
SEAUDIT_MESSAGE_TYPE_AVC
 && msg->
d©a
.
avc
->
Ïddr
 !ğ
NULL
;

763 
	}
}

765 
	$f‹r_Ïddr_acû±
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

767  
	`âm©ch
(
f‹r
->
Ïddr
, 
msg
->
d©a
.
avc
->laddr, 0) == 0;

768 
	}
}

770 
	$f‹r_Ïddr_»ad
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
xmlCh¬
 * 
ch
)

772  
	`f‹r_¡ršg_»ad
(&
f‹r
->
Ïddr
, 
ch
);

773 
	}
}

775 
	$f‹r_Ïddr_´št
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ *
Çme
, 
FILE
 * 
f
, 
bs
)

777 
	`f‹r_¡ršg_´št
(
Çme
, 
f‹r
->
Ïddr
, 
f
, 
bs
);

778 
	}
}

780 
boŞ
 
	$f‹r_ÍÜt_is_£t
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

782  
f‹r
->
ÍÜt
 != 0;

783 
	}
}

785 
	$f‹r_ÍÜt_suµÜt
(cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

787  
msg
->
ty³
 =ğ
SEAUDIT_MESSAGE_TYPE_AVC
 && msg->
d©a
.
avc
->
ÍÜt
 != 0;

788 
	}
}

790 
	$f‹r_ÍÜt_acû±
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

792  
f‹r
->
ÍÜt
 =ğ
msg
->
d©a
.
avc
->lport;

793 
	}
}

795 
	$f‹r_ÍÜt_»ad
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
xmlCh¬
 * 
ch
)

797  
	`f‹r_št_»ad
(&
f‹r
->
ÍÜt
, 
ch
);

798 
	}
}

800 
	$f‹r_ÍÜt_´št
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ *
Çme
, 
FILE
 * 
f
, 
bs
)

802 
	`f‹r_št_´št
(
Çme
, 
f‹r
->
ÍÜt
, 
f
, 
bs
);

803 
	}
}

805 
boŞ
 
	$f‹r_çddr_is_£t
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

807  
f‹r
->
çddr
 !ğ
NULL
;

808 
	}
}

810 
	$f‹r_çddr_suµÜt
(cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

812  
msg
->
ty³
 =ğ
SEAUDIT_MESSAGE_TYPE_AVC
 && msg->
d©a
.
avc
->
çddr
 !ğ
NULL
;

813 
	}
}

815 
	$f‹r_çddr_acû±
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

817  
	`âm©ch
(
f‹r
->
çddr
, 
msg
->
d©a
.
avc
->faddr, 0) == 0;

818 
	}
}

820 
	$f‹r_çddr_»ad
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
xmlCh¬
 * 
ch
)

822  
	`f‹r_¡ršg_»ad
(&
f‹r
->
çddr
, 
ch
);

823 
	}
}

825 
	$f‹r_çddr_´št
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ *
Çme
, 
FILE
 * 
f
, 
bs
)

827 
	`f‹r_¡ršg_´št
(
Çme
, 
f‹r
->
çddr
, 
f
, 
bs
);

828 
	}
}

830 
boŞ
 
	$f‹r_åÜt_is_£t
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

832  
f‹r
->
åÜt
 != 0;

833 
	}
}

835 
	$f‹r_åÜt_suµÜt
(cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

837  
msg
->
ty³
 =ğ
SEAUDIT_MESSAGE_TYPE_AVC
 && msg->
d©a
.
avc
->
åÜt
 != 0;

838 
	}
}

840 
	$f‹r_åÜt_acû±
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

842  
f‹r
->
åÜt
 =ğ
msg
->
d©a
.
avc
->fport;

843 
	}
}

845 
	$f‹r_åÜt_»ad
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
xmlCh¬
 * 
ch
)

847  
	`f‹r_št_»ad
(&
f‹r
->
åÜt
, 
ch
);

848 
	}
}

850 
	$f‹r_åÜt_´št
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ *
Çme
, 
FILE
 * 
f
, 
bs
)

852 
	`f‹r_št_´št
(
Çme
, 
f‹r
->
åÜt
, 
f
, 
bs
);

853 
	}
}

855 
boŞ
 
	$f‹r_§ddr_is_£t
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

857  
f‹r
->
§ddr
 !ğ
NULL
;

858 
	}
}

860 
	$f‹r_§ddr_suµÜt
(cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

862  
msg
->
ty³
 =ğ
SEAUDIT_MESSAGE_TYPE_AVC
 && msg->
d©a
.
avc
->
§ddr
 !ğ
NULL
;

863 
	}
}

865 
	$f‹r_§ddr_acû±
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

867  
	`âm©ch
(
f‹r
->
§ddr
, 
msg
->
d©a
.
avc
->saddr, 0) == 0;

868 
	}
}

870 
	$f‹r_§ddr_»ad
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
xmlCh¬
 * 
ch
)

872  
	`f‹r_¡ršg_»ad
(&
f‹r
->
§ddr
, 
ch
);

873 
	}
}

875 
	$f‹r_§ddr_´št
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ *
Çme
, 
FILE
 * 
f
, 
bs
)

877 
	`f‹r_¡ršg_´št
(
Çme
, 
f‹r
->
§ddr
, 
f
, 
bs
);

878 
	}
}

880 
boŞ
 
	$f‹r_¥Üt_is_£t
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

882  
f‹r
->
¥Üt
 != 0;

883 
	}
}

885 
	$f‹r_¥Üt_suµÜt
(cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

887  
msg
->
ty³
 =ğ
SEAUDIT_MESSAGE_TYPE_AVC
 && msg->
d©a
.
avc
->
sourû
 != 0;

888 
	}
}

890 
	$f‹r_¥Üt_acû±
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

892  
f‹r
->
¥Üt
 =ğ
msg
->
d©a
.
avc
->
sourû
;

893 
	}
}

895 
	$f‹r_¥Üt_»ad
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
xmlCh¬
 * 
ch
)

897  
	`f‹r_št_»ad
(&
f‹r
->
¥Üt
, 
ch
);

898 
	}
}

900 
	$f‹r_¥Üt_´št
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ *
Çme
, 
FILE
 * 
f
, 
bs
)

902 
	`f‹r_št_´št
(
Çme
, 
f‹r
->
¥Üt
, 
f
, 
bs
);

903 
	}
}

905 
boŞ
 
	$f‹r_daddr_is_£t
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

907  
f‹r
->
daddr
 !ğ
NULL
;

908 
	}
}

910 
	$f‹r_daddr_suµÜt
(cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

912  
msg
->
ty³
 =ğ
SEAUDIT_MESSAGE_TYPE_AVC
 && msg->
d©a
.
avc
->
daddr
 !ğ
NULL
;

913 
	}
}

915 
	$f‹r_daddr_acû±
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

917  
	`âm©ch
(
f‹r
->
daddr
, 
msg
->
d©a
.
avc
->daddr, 0) == 0;

918 
	}
}

920 
	$f‹r_daddr_»ad
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
xmlCh¬
 * 
ch
)

922  
	`f‹r_¡ršg_»ad
(&
f‹r
->
daddr
, 
ch
);

923 
	}
}

925 
	$f‹r_daddr_´št
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ *
Çme
, 
FILE
 * 
f
, 
bs
)

927 
	`f‹r_¡ršg_´št
(
Çme
, 
f‹r
->
daddr
, 
f
, 
bs
);

928 
	}
}

930 
boŞ
 
	$f‹r_dpÜt_is_£t
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

932  
f‹r
->
dpÜt
 != 0;

933 
	}
}

935 
	$f‹r_dpÜt_suµÜt
(cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

937  
msg
->
ty³
 =ğ
SEAUDIT_MESSAGE_TYPE_AVC
 && msg->
d©a
.
avc
->
de¡
 != 0;

938 
	}
}

940 
	$f‹r_dpÜt_acû±
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

942  
f‹r
->
dpÜt
 =ğ
msg
->
d©a
.
avc
->
de¡
;

943 
	}
}

945 
	$f‹r_dpÜt_»ad
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
xmlCh¬
 * 
ch
)

947  
	`f‹r_št_»ad
(&
f‹r
->
dpÜt
, 
ch
);

948 
	}
}

950 
	$f‹r_dpÜt_´št
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ *
Çme
, 
FILE
 * 
f
, 
bs
)

952 
	`f‹r_št_´št
(
Çme
, 
f‹r
->
dpÜt
, 
f
, 
bs
);

953 
	}
}

955 
boŞ
 
	$f‹r_pÜt_is_£t
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

957  
f‹r
->
pÜt
 != 0;

958 
	}
}

960 
	$f‹r_pÜt_suµÜt
(cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

962  
msg
->
ty³
 =ğ
SEAUDIT_MESSAGE_TYPE_AVC
 && msg->
d©a
.
avc
->
pÜt
 != 0;

963 
	}
}

965 
	$f‹r_pÜt_acû±
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

967  
f‹r
->
pÜt
 =ğ
msg
->
d©a
.
avc
->port;

968 
	}
}

970 
	$f‹r_pÜt_»ad
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
xmlCh¬
 * 
ch
)

972  
	`f‹r_št_»ad
(&
f‹r
->
pÜt
, 
ch
);

973 
	}
}

975 
	$f‹r_pÜt_´št
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ *
Çme
, 
FILE
 * 
f
, 
bs
)

977 
	`f‹r_št_´št
(
Çme
, 
f‹r
->
pÜt
, 
f
, 
bs
);

978 
	}
}

980 
boŞ
 
	$f‹r_Ãtif_is_£t
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

982  
f‹r
->
Ãtif
 !ğ
NULL
;

983 
	}
}

985 
	$f‹r_Ãtif_suµÜt
(cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

987  
msg
->
ty³
 =ğ
SEAUDIT_MESSAGE_TYPE_AVC
 && msg->
d©a
.
avc
->
Ãtif
 !ğ
NULL
;

988 
	}
}

990 
	$f‹r_Ãtif_acû±
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

992  
	`¡rcmp
(
f‹r
->
Ãtif
, 
msg
->
d©a
.
avc
->netif) == 0;

993 
	}
}

995 
	$f‹r_Ãtif_»ad
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
xmlCh¬
 * 
ch
)

997  
	`f‹r_¡ršg_»ad
(&
f‹r
->
Ãtif
, 
ch
);

998 
	}
}

1000 
	$f‹r_Ãtif_´št
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ *
Çme
, 
FILE
 * 
f
, 
bs
)

1002 
	`f‹r_¡ršg_´št
(
Çme
, 
f‹r
->
Ãtif
, 
f
, 
bs
);

1003 
	}
}

1005 
boŞ
 
	$f‹r_key_is_£t
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

1007  
f‹r
->
key
 != 0;

1008 
	}
}

1010 
	$f‹r_key_suµÜt
(cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

1012  
msg
->
ty³
 =ğ
SEAUDIT_MESSAGE_TYPE_AVC
 && msg->
d©a
.
avc
->
is_key
;

1013 
	}
}

1015 
	$f‹r_key_acû±
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

1017  
f‹r
->
key
 =ğ
msg
->
d©a
.
avc
->key;

1018 
	}
}

1020 
	$f‹r_key_»ad
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
xmlCh¬
 * 
ch
)

1022  
	`f‹r_št_»ad
(&
f‹r
->
key
, 
ch
);

1023 
	}
}

1025 
	$f‹r_key_´št
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ *
Çme
, 
FILE
 * 
f
, 
bs
)

1027 
	`f‹r_št_´št
(
Çme
, 
f‹r
->
key
, 
f
, 
bs
);

1028 
	}
}

1030 
boŞ
 
	$f‹r_ÿp_is_£t
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

1032  
f‹r
->
ÿp
 != 0;

1033 
	}
}

1035 
	$f‹r_ÿp_suµÜt
(cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

1037  
msg
->
ty³
 =ğ
SEAUDIT_MESSAGE_TYPE_AVC
 && msg->
d©a
.
avc
->
is_ÿ·b™y
;

1038 
	}
}

1040 
	$f‹r_ÿp_acû±
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

1042  
f‹r
->
key
 =ğ
msg
->
d©a
.
avc
->
ÿ·b™y
;

1043 
	}
}

1045 
	$f‹r_ÿp_»ad
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
xmlCh¬
 * 
ch
)

1047  
	`f‹r_št_»ad
(&
f‹r
->
ÿp
, 
ch
);

1048 
	}
}

1050 
	$f‹r_ÿp_´št
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ *
Çme
, 
FILE
 * 
f
, 
bs
)

1052 
	`f‹r_št_´št
(
Çme
, 
f‹r
->
ÿp
, 
f
, 
bs
);

1053 
	}
}

1055 
boŞ
 
	$f‹r_avc_msg_ty³_is_£t
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

1057  
f‹r
->
avc_msg_ty³
 !ğ
SEAUDIT_AVC_UNKNOWN
;

1058 
	}
}

1060 
f‹r_avc_msg_ty³_suµÜt
(cÚ¡ 
£aud™_mes§ge_t
 * 
msg
 
__©Œibu‹__
 ((
unu£d
)))

1065 
	$f‹r_avc_msg_ty³_acû±
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

1067  
msg
->
ty³
 =ğ
SEAUDIT_MESSAGE_TYPE_AVC
 && 
f‹r
->
avc_msg_ty³
 =ğmsg->
d©a
.
avc
->msg;

1068 
	}
}

1070 
	$f‹r_avc_msg_ty³_»ad
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
xmlCh¬
 * 
ch
)

1072 *
s
;

1073 ià((
s
 = 
	`xmlURIUÃsÿ³SŒšg
((cÚ¡ *)
ch
, 0, 
NULL
)) == NULL) {

1076 
f‹r
->
avc_msg_ty³
 = 
	`©oi
(
s
);

1077 
	`ä“
(
s
);

1079 
	}
}

1081 
	$f‹r_avc_msg_ty³_´št
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ *
Çme
, 
FILE
 * 
f
, 
bs
)

1083 
i
;

1084 ià(
f‹r
->
avc_msg_ty³
 =ğ
SEAUDIT_AVC_UNKNOWN
) {

1087 
i
 = 0; i < 
bs
; i++)

1088 
	`årštf
(
f
, "\t");

1089 
	`årštf
(
f
, "<ü™”Ÿy³=\"%s\">\n", 
Çme
);

1090 
i
 = 0; i < 
bs
 + 1; i++) {

1091 
	`årštf
(
f
, "\t");

1093 
	`årštf
(
f
, "<™em>%d</™em>\n", 
f‹r
->
avc_msg_ty³
);

1094 
i
 = 0; i < 
bs
; i++)

1095 
	`årštf
(
f
, "\t");

1096 
	`årštf
(
f
, "</criteria>\n");

1097 
	}
}

1099 
boŞ
 
	$f‹r_d©e_is_£t
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

1101  
f‹r
->
¡¬t
 !ğ
NULL
;

1102 
	}
}

1104 
	$f‹r_d©e_suµÜt
(cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

1106  
msg
->
d©e_¡amp
 !ğ
NULL
;

1107 
	}
}

1113 
	$f‹r_d©e_comp
(cÚ¡ 
tm
 *
t1
, cÚ¡ tm *
t2
)

1117 
»tv®
;

1118 ià(
t1
->
tm_y—r
 !ğ0 && 
t2
->tm_y—¸!ğ0 && (
»tv®
 =1->tm_year -2->tm_year) != 0) {

1119  
»tv®
;

1121 ià((
»tv®
 = 
t1
->
tm_mÚ
 - 
t2
->tm_mon) != 0) {

1122  
»tv®
;

1124 ià((
»tv®
 = 
t1
->
tm_mday
 - 
t2
->tm_mday) != 0) {

1125  
»tv®
;

1127 ià((
»tv®
 = 
t1
->
tm_hour
 - 
t2
->tm_hour) != 0) {

1128  
»tv®
;

1130 ià((
»tv®
 = 
t1
->
tm_mš
 - 
t2
->tm_min) != 0) {

1131  
»tv®
;

1133 ià((
»tv®
 = 
t1
->
tm_£c
 - 
t2
->tm_sec) != 0) {

1134  
»tv®
;

1137 
	}
}

1139 
	$f‹r_d©e_acû±
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

1141 
compv®
 = 
	`f‹r_d©e_comp
(
f‹r
->
¡¬t
, 
msg
->
d©e_¡amp
);

1142 ià(
f‹r
->
d©e_m©ch
 =ğ
SEAUDIT_FILTER_DATE_MATCH_BEFORE
) {

1143  
compv®
 > 0;

1144 } ià(
f‹r
->
d©e_m©ch
 =ğ
SEAUDIT_FILTER_DATE_MATCH_AFTER
) {

1145  
compv®
 < 0;

1147 ià(
compv®
 > 0)

1149 
compv®
 = 
	`f‹r_d©e_comp
(
msg
->
d©e_¡amp
, 
f‹r
->
’d
);

1150  
compv®
 < 0;

1152 
	}
}

1154 
	$f‹r_d©e_»ad
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
xmlCh¬
 * 
ch
)

1156 *
s
;

1157 ià((
s
 = 
	`xmlURIUÃsÿ³SŒšg
((cÚ¡ *)
ch
, 0, 
NULL
)) == NULL) {

1160 ià(
f‹r
->
¡¬t
 =ğ
NULL
) {

1161 ià((
f‹r
->
¡¬t
 = 
	`ÿÎoc
(1, (*(f‹r->¡¬t)))è=ğ
NULL
) {

1162 
	`ä“
(
s
);

1165 
	`¡½time
(
s
, "%¨%b %d %T %Y", 
f‹r
->
¡¬t
);

1166 } ià(
f‹r
->
’d
 =ğ
NULL
) {

1167 ià((
f‹r
->
’d
 = 
	`ÿÎoc
(1, (*(f‹r->’d)))è=ğ
NULL
) {

1168 
	`ä“
(
s
);

1171 
	`¡½time
(
s
, "%¨%b %d %T %Y", 
f‹r
->
’d
);

1173 
f‹r
->
d©e_m©ch
 = 
	`©oi
(
s
);

1175 
	`ä“
(
s
);

1177 
	}
}

1179 
	$f‹r_d©e_´št
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ *
Çme
, 
FILE
 * 
f
, 
bs
)

1181 
i
;

1182 
xmlCh¬
 *
s
, *
esÿ³d
;

1183 ià(
f‹r
->
¡¬t
 =ğ
NULL
) {

1186 
i
 = 0; i < 
bs
; i++)

1187 
	`årštf
(
f
, "\t");

1188 
	`årštf
(
f
, "<ü™”Ÿy³=\"%s\">\n", 
Çme
);

1189 
s
 = 
	`xmlCh¬SŒdup
(
	`asùime
(
f‹r
->
¡¬t
));

1190 
esÿ³d
 = 
	`xmlURIEsÿ³SŒ
(
s
, 
NULL
);

1191 
i
 = 0; i < 
bs
 + 1; i++) {

1192 
	`årštf
(
f
, "\t");

1194 
	`årštf
(
f
, "<™em>%s</™em>\n", 
esÿ³d
);

1195 
	`ä“
(
s
);

1196 
	`ä“
(
esÿ³d
);

1197 
s
 = 
	`xmlCh¬SŒdup
(
	`asùime
(
f‹r
->
’d
));

1198 
esÿ³d
 = 
	`xmlURIEsÿ³SŒ
(
s
, 
NULL
);

1199 
i
 = 0; i < 
bs
 + 1; i++)

1200 
	`årštf
(
f
, "\t");

1201 
	`årštf
(
f
, "<™em>%s</™em>\n", 
esÿ³d
);

1202 
	`ä“
(
s
);

1203 
	`ä“
(
esÿ³d
);

1204 
i
 = 0; i < 
bs
 + 1; i++)

1205 
	`årštf
(
f
, "\t");

1206 
	`årštf
(
f
, "<™em>%d</™em>\n", 
f‹r
->
d©e_m©ch
);

1207 
i
 = 0; i < 
bs
; i++)

1208 
	`årštf
(
f
, "\t");

1209 
	`årštf
(
f
, "</criteria>\n");

1210 
	}
}

1212 
	$boŞ
(
	tf‹r_is_£t_func
è(cÚ¡ 
	t£aud™_f‹r_t
 * 
	tf‹r
);

1213 (
	tf‹r_suµÜt_func
è(cÚ¡ 
	t£aud™_mes§ge_t
 * 
	tmsg
);

1214 (
	tf‹r_acû±_func
è(cÚ¡ 
	t£aud™_f‹r_t
 * 
	tf‹r
, cÚ¡ 
	t£aud™_mes§ge_t
 * 
	tmsg
);

1215 (
	tf‹r_´št_func
è(cÚ¡ 
	t£aud™_f‹r_t
 * 
	tf‹r
, cÚ¡ *
	tÇme
, 
	tFILE
 * 
	tf
, 
	tbs
);

1217 
	sf‹r_ü™”Ÿ_t


1219 cÚ¡ *
Çme
;

1220 
f‹r_is_£t_func
 *
is_£t
;

1221 
f‹r_suµÜt_func
 *
suµÜt
;

1222 
f‹r_acû±_func
 *
acû±
;

1223 
f‹r_»ad_func
 *
»ad
;

1224 
f‹r_´št_func
 *
´št
;

1235 cÚ¡ 
f‹r_ü™”Ÿ_t
 
f‹r_ü™”Ÿ
[] = {

1236 {"¤c_u£r", 
f‹r_¤c_u£r_is_£t
, 
f‹r_¤c_u£r_suµÜt
, 
f‹r_¤c_u£r_acû±
, 
f‹r_¤c_u£r_»ad
,

1237 
f‹r_¤c_u£r_´št
},

1238 {"¤c_rŞe", 
f‹r_¤c_rŞe_is_£t
, 
f‹r_¤c_rŞe_suµÜt
, 
f‹r_¤c_rŞe_acû±
, 
f‹r_¤c_rŞe_»ad
,

1239 
f‹r_¤c_rŞe_´št
},

1240 {"¤c_ty³", 
f‹r_¤c_ty³_is_£t
, 
f‹r_¤c_ty³_suµÜt
, 
f‹r_¤c_ty³_acû±
, 
f‹r_¤c_ty³_»ad
,

1241 
f‹r_¤c_ty³_´št
},

1242 {"¤c_mls_lvl", 
f‹r_¤c_mls_lvl_is_£t
, 
f‹r_¤c_mls_lvl_suµÜt
, 
f‹r_¤c_mls_lvl_acû±
, 
f‹r_¤c_mls_lvl_»ad
,

1243 
f‹r_¤c_mls_lvl_´št
},

1244 {"¤c_mls_şr", 
f‹r_¤c_mls_şr_is_£t
, 
f‹r_¤c_mls_şr_suµÜt
, 
f‹r_¤c_mls_şr_acû±
, 
f‹r_¤c_mls_şr_»ad
,

1245 
f‹r_¤c_mls_şr_´št
},

1246 {"tgt_u£r", 
f‹r_tgt_u£r_is_£t
, 
f‹r_tgt_u£r_suµÜt
, 
f‹r_tgt_u£r_acû±
, 
f‹r_tgt_u£r_»ad
,

1247 
f‹r_tgt_u£r_´št
},

1248 {"tgt_rŞe", 
f‹r_tgt_rŞe_is_£t
, 
f‹r_tgt_rŞe_suµÜt
, 
f‹r_tgt_rŞe_acû±
, 
f‹r_tgt_rŞe_»ad
,

1249 
f‹r_tgt_rŞe_´št
},

1250 {"tgt_ty³", 
f‹r_tgt_ty³_is_£t
, 
f‹r_tgt_ty³_suµÜt
, 
f‹r_tgt_ty³_acû±
, 
f‹r_tgt_ty³_»ad
,

1251 
f‹r_tgt_ty³_´št
},

1252 {"tgt_mls_lvl", 
f‹r_tgt_mls_lvl_is_£t
, 
f‹r_tgt_mls_lvl_suµÜt
, 
f‹r_tgt_mls_lvl_acû±
, 
f‹r_tgt_mls_lvl_»ad
,

1253 
f‹r_¤c_mls_lvl_´št
},

1254 {"tgt_mls_şr", 
f‹r_tgt_mls_şr_is_£t
, 
f‹r_tgt_mls_şr_suµÜt
, 
f‹r_tgt_mls_şr_acû±
, 
f‹r_tgt_mls_şr_»ad
,

1255 
f‹r_¤c_mls_şr_´št
},

1256 {"obj_şass", 
f‹r_tgt_şass_is_£t
, 
f‹r_tgt_şass_suµÜt
, 
f‹r_tgt_şass_acû±
, 
f‹r_tgt_şass_»ad
,

1257 
f‹r_tgt_şass_´št
},

1258 {"³rm", 
f‹r_³rm_is_£t
, 
f‹r_³rm_suµÜt
, 
f‹r_³rm_acû±
, 
f‹r_³rm_»ad
, 
f‹r_³rm_´št
},

1259 {"exe", 
f‹r_exe_is_£t
, 
f‹r_exe_suµÜt
, 
f‹r_exe_acû±
, 
f‹r_exe_»ad
, 
f‹r_exe_´št
},

1260 {"ho¡", 
f‹r_ho¡_is_£t
, 
f‹r_ho¡_suµÜt
, 
f‹r_ho¡_acû±
, 
f‹r_ho¡_»ad
, 
f‹r_ho¡_´št
},

1261 {"·th", 
f‹r_·th_is_£t
, 
f‹r_·th_suµÜt
, 
f‹r_·th_acû±
, 
f‹r_·th_»ad
, 
f‹r_·th_´št
},

1262 {"šode", 
f‹r_šode_is_£t
, 
f‹r_šode_suµÜt
, 
f‹r_šode_acû±
, 
f‹r_šode_»ad
, 
f‹r_šode_´št
},

1263 {"pid", 
f‹r_pid_is_£t
, 
f‹r_pid_suµÜt
, 
f‹r_pid_acû±
, 
f‹r_pid_»ad
, 
f‹r_pid_´št
},

1264 {"comm", 
f‹r_comm_is_£t
, 
f‹r_comm_suµÜt
, 
f‹r_comm_acû±
, 
f‹r_comm_»ad
, 
f‹r_comm_´št
},

1265 {"addr", 
f‹r_ªyaddr_is_£t
, 
f‹r_ªyaddr_suµÜt
, 
f‹r_ªyaddr_acû±
, 
f‹r_ªyaddr_»ad
, 
f‹r_ªyaddr_´št
},

1266 {"ªypÜt", 
f‹r_ªypÜt_is_£t
, 
f‹r_ªypÜt_suµÜt
, 
f‹r_ªypÜt_acû±
, 
f‹r_ªypÜt_»ad
,

1267 
f‹r_ªypÜt_´št
},

1268 {"Ïddr", 
f‹r_Ïddr_is_£t
, 
f‹r_Ïddr_suµÜt
, 
f‹r_Ïddr_acû±
, 
f‹r_Ïddr_»ad
, 
f‹r_Ïddr_´št
},

1269 {"ÍÜt", 
f‹r_ÍÜt_is_£t
, 
f‹r_ÍÜt_suµÜt
, 
f‹r_ÍÜt_acû±
, 
f‹r_ÍÜt_»ad
, 
f‹r_ÍÜt_´št
},

1270 {"çddr", 
f‹r_çddr_is_£t
, 
f‹r_çddr_suµÜt
, 
f‹r_çddr_acû±
, 
f‹r_çddr_»ad
, 
f‹r_çddr_´št
},

1271 {"åÜt", 
f‹r_åÜt_is_£t
, 
f‹r_åÜt_suµÜt
, 
f‹r_åÜt_acû±
, 
f‹r_åÜt_»ad
, 
f‹r_åÜt_´št
},

1272 {"§ddr", 
f‹r_§ddr_is_£t
, 
f‹r_§ddr_suµÜt
, 
f‹r_§ddr_acû±
, 
f‹r_§ddr_»ad
, 
f‹r_§ddr_´št
},

1273 {"¥Üt", 
f‹r_¥Üt_is_£t
, 
f‹r_¥Üt_suµÜt
, 
f‹r_¥Üt_acû±
, 
f‹r_¥Üt_»ad
, 
f‹r_¥Üt_´št
},

1274 {"daddr", 
f‹r_daddr_is_£t
, 
f‹r_daddr_suµÜt
, 
f‹r_daddr_acû±
, 
f‹r_daddr_»ad
, 
f‹r_daddr_´št
},

1275 {"dpÜt", 
f‹r_dpÜt_is_£t
, 
f‹r_dpÜt_suµÜt
, 
f‹r_dpÜt_acû±
, 
f‹r_dpÜt_»ad
, 
f‹r_dpÜt_´št
},

1276 {"pÜt", 
f‹r_pÜt_is_£t
, 
f‹r_pÜt_suµÜt
, 
f‹r_pÜt_acû±
, 
f‹r_pÜt_»ad
, 
f‹r_pÜt_´št
},

1277 {"Ãtif", 
f‹r_Ãtif_is_£t
, 
f‹r_Ãtif_suµÜt
, 
f‹r_Ãtif_acû±
, 
f‹r_Ãtif_»ad
, 
f‹r_Ãtif_´št
},

1278 {"key", 
f‹r_key_is_£t
, 
f‹r_key_suµÜt
, 
f‹r_key_acû±
, 
f‹r_key_»ad
, 
f‹r_key_´št
},

1279 {"ÿp", 
f‹r_ÿp_is_£t
, 
f‹r_ÿp_suµÜt
, 
f‹r_ÿp_acû±
, 
f‹r_ÿp_»ad
, 
f‹r_ÿp_´št
},

1280 {"msg", 
f‹r_avc_msg_ty³_is_£t
, 
f‹r_avc_msg_ty³_suµÜt
, 
f‹r_avc_msg_ty³_acû±
, 
f‹r_avc_msg_ty³_»ad
,

1281 
f‹r_avc_msg_ty³_´št
},

1282 {"d©e_time", 
f‹r_d©e_is_£t
, 
f‹r_d©e_suµÜt
, 
f‹r_d©e_acû±
, 
f‹r_d©e_»ad
, 
f‹r_d©e_´št
}

1283 
	}
};

1287 
	$f‹r_is_acû±ed
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

1289 
boŞ
 
Œ›d_ü™”iÚ
 = 
çl£
;

1290 
acû±v®
;

1291 
size_t
 
i
;

1293 
i
 = 0; i < (
f‹r_ü™”Ÿ
) / (filter_criteria[0]); i++) {

1294 ià(
f‹r_ü™”Ÿ
[
i
].
	`is_£t
(
f‹r
)) {

1295 
Œ›d_ü™”iÚ
 = 
Œue
;

1296 ià(
f‹r_ü™”Ÿ
[
i
].
	`suµÜt
(
msg
)) {

1297 
acû±v®
 = 
f‹r_ü™”Ÿ
[
i
].
	`acû±
(
f‹r
, 
msg
);

1298 } ià(
f‹r
->
¡riù
) {

1302 
acû±v®
 = 0;

1309 ià(
f‹r
->
m©ch
 =ğ
SEAUDIT_FILTER_MATCH_ANY
 && 
acû±v®
 == 1) {

1312 ià(
f‹r
->
m©ch
 =ğ
SEAUDIT_FILTER_MATCH_ALL
 && 
acû±v®
 == 0) {

1317 ià(!
Œ›d_ü™”iÚ
) {

1319 ià(
f‹r
->
¡riù
) {

1325 ià(
f‹r
->
m©ch
 =ğ
SEAUDIT_FILTER_MATCH_ANY
) {

1331 
	}
}

1333 
boŞ
 
	$f‹r_·r£_is_v®id_g
(cÚ¡ 
xmlCh¬
 * 
g
)

1335 cÚ¡ *
·r£_v®id_gs
[] = { "™em", "ü™”Ÿ", "v›w", "f‹r", "desc", 
NULL
 };

1336 
size_t
 
i
;

1337 
i
 = 0; 
·r£_v®id_gs
[i] !ğ
NULL
; i++) {

1338 ià(
	`xmlSŒcmp
(
g
, (
xmlCh¬
 *è
·r£_v®id_gs
[
i
]) == 0) {

1343 
	}
}

1345 
f‹r_»ad_func
 *
	$f‹r_g‘_»ad_func
(cÚ¡ 
xmlCh¬
 * 
Çme
)

1347 
size_t
 
i
;

1348 
i
 = 0; i < (
f‹r_ü™”Ÿ
) / (filter_criteria[0]); i++) {

1349 ià(
	`xmlSŒcmp
(
Çme
, (
xmlCh¬
 *è
f‹r_ü™”Ÿ
[
i
].name) == 0) {

1350  
f‹r_ü™”Ÿ
[
i
].
»ad
;

1353  
NULL
;

1354 
	}
}

1356 
	$f‹r_·r£_¡¬t_–em’t
(*
u£r_d©a
, cÚ¡ 
xmlCh¬
 * 
Çme
, cÚ¡ xmlCh¬ ** 
©Œs
)

1358 
f‹r_·r£_¡©e
 *
¡©e
 = 
u£r_d©a
;

1359 
size_t
 
i
;

1360 ià(!
	`f‹r_·r£_is_v®id_g
(
Çme
)) {

1361 
¡©e
->
w¬nšgs
 = 1;

1364 ià(
	`xmlSŒcmp
(
Çme
, (
xmlCh¬
 *) "view") == 0) {

1365 
i
 = 0; 
©Œs
[i] !ğ
NULL
 &&‡ttrs[i + 1] != NULL; i += 2) {

1366 ià(
	`xmlSŒcmp
(
©Œs
[
i
], (
xmlCh¬
 *) "name") == 0) {

1367 
	`ä“
(
¡©e
->
v›w_Çme
);

1368 
¡©e
->
v›w_Çme
 = 
	`xmlURIUÃsÿ³SŒšg
((cÚ¡ *)
©Œs
[
i
 + 1], 0, 
NULL
);

1369 } ià(
	`xmlSŒcmp
(
©Œs
[
i
], (
xmlCh¬
 *) "match") == 0) {

1370 ià(
	`xmlSŒcmp
(
©Œs
[
i
 + 1], (
xmlCh¬
 *) "all") == 0) {

1371 
¡©e
->
v›w_m©ch
 = 
SEAUDIT_FILTER_MATCH_ALL
;

1372 } ià(
	`xmlSŒcmp
(
©Œs
[
i
 + 1], (
xmlCh¬
 *) "any") == 0) {

1373 
¡©e
->
v›w_m©ch
 = 
SEAUDIT_FILTER_MATCH_ANY
;

1375 } ià(
	`xmlSŒcmp
(
©Œs
[
i
], (
xmlCh¬
 *) "show") == 0) {

1376 ià(
	`xmlSŒcmp
(
©Œs
[
i
 + 1], (
xmlCh¬
 *) "true") == 0) {

1377 
¡©e
->
v›w_visibË
 = 
SEAUDIT_FILTER_VISIBLE_SHOW
;

1378 } ià(
	`xmlSŒcmp
(
©Œs
[
i
 + 1], (
xmlCh¬
 *) "hide") == 0) {

1379 
¡©e
->
v›w_visibË
 = 
SEAUDIT_FILTER_VISIBLE_HIDE
;

1383 } ià(
	`xmlSŒcmp
(
Çme
, (
xmlCh¬
 *) "filter") == 0) {

1385 *
f‹r_Çme
 = 
NULL
;

1386 
£aud™_f‹r_m©ch_e
 
m©ch
 = 
SEAUDIT_FILTER_MATCH_ALL
;

1387 
boŞ
 
¡riù
 = 
çl£
;

1388 
i
 = 0; 
©Œs
[i] !ğ
NULL
 &&‡ttrs[i + 1] != NULL; i += 2) {

1389 ià(
	`xmlSŒcmp
(
©Œs
[
i
], (
xmlCh¬
 *) "name") == 0) {

1390 
	`ä“
(
f‹r_Çme
);

1391 
f‹r_Çme
 = 
	`xmlURIUÃsÿ³SŒšg
((cÚ¡ *)
©Œs
[
i
 + 1], 0, 
NULL
);

1392 } ià(
	`xmlSŒcmp
(
©Œs
[
i
], (
xmlCh¬
 *) "match") == 0) {

1393 ià(
	`xmlSŒcmp
(
©Œs
[
i
 + 1], (
xmlCh¬
 *) "all") == 0) {

1394 
m©ch
 = 
SEAUDIT_FILTER_MATCH_ALL
;

1395 } ià(
	`xmlSŒcmp
(
©Œs
[
i
 + 1], (
xmlCh¬
 *) "any") == 0) {

1396 
m©ch
 = 
SEAUDIT_FILTER_MATCH_ANY
;

1398 } ià(
	`xmlSŒcmp
(
©Œs
[
i
], (
xmlCh¬
 *) "strict") == 0) {

1399 ià(
	`xmlSŒcmp
(
©Œs
[
i
 + 1], (
xmlCh¬
 *) "true") == 0) {

1400 
¡riù
 = 
Œue
;

1401 } ià(
	`xmlSŒcmp
(
©Œs
[
i
 + 1], (
xmlCh¬
 *) "false") == 0) {

1402 
¡riù
 = 
çl£
;

1406 ià((
¡©e
->
cur_f‹r
 = 
	`£aud™_f‹r_ü—‹
(
f‹r_Çme
)è!ğ
NULL
) {

1407 ià(
	`­Ş_veùÜ_­³nd
(
¡©e
->
f‹rs
, s‹->
cur_f‹r
) < 0) {

1408 
	`£aud™_f‹r_de¡roy
(&
¡©e
->
cur_f‹r
);

1410 
	`£aud™_f‹r_£t_m©ch
(
¡©e
->
cur_f‹r
, 
m©ch
);

1411 
	`£aud™_f‹r_£t_¡riù
(
¡©e
->
cur_f‹r
, 
¡riù
);

1414 
	`ä“
(
f‹r_Çme
);

1415 } ià(
	`xmlSŒcmp
(
Çme
, (
xmlCh¬
 *) "criteria") == 0) {

1416 
i
 = 0; 
©Œs
[i] !ğ
NULL
 &&‡ttrs[i + 1] != NULL; i += 2) {

1417 ià(
	`xmlSŒcmp
(
©Œs
[
i
], (
xmlCh¬
 *) "type") == 0) {

1418 
¡©e
->
cur_f‹r_»ad
 = 
	`f‹r_g‘_»ad_func
(
©Œs
[
i
 + 1]);

1422 
	`ä“
(
¡©e
->
cur_¡ršg
);

1423 
¡©e
->
cur_¡ršg
 = 
NULL
;

1424 
	}
}

1426 
	$f‹r_·r£_’d_–em’t
(*
u£r_d©a
, cÚ¡ 
xmlCh¬
 * 
Çme
)

1428 
f‹r_·r£_¡©e
 *
¡©e
 = 
u£r_d©a
;

1429 *
s
;

1430 ià(!
	`f‹r_·r£_is_v®id_g
(
Çme
)) {

1431 
¡©e
->
w¬nšgs
 = 1;

1434 ià(
	`xmlSŒcmp
(
Çme
, (
xmlCh¬
 *) "desc") == 0) {

1435 ià(
¡©e
->
cur_f‹r
 =ğ
NULL
) {

1436 
¡©e
->
w¬nšgs
 = 1;

1438 
s
 = 
	`xmlURIUÃsÿ³SŒšg
((cÚ¡ *)
¡©e
->
cur_¡ršg
, 0, 
NULL
);

1439 
	`£aud™_f‹r_£t_desütiÚ
(
¡©e
->
cur_f‹r
, 
s
);

1440 
	`ä“
(
s
);

1442 } ià(
	`xmlSŒcmp
(
Çme
, (
xmlCh¬
 *) "item") == 0) {

1443 ià(
¡©e
->
cur_f‹r
 =ğ
NULL
 || s‹->
cur_f‹r_»ad
 == NULL) {

1444 
¡©e
->
w¬nšgs
 = 1;

1446 
¡©e
->
	`cur_f‹r_»ad
(¡©e->
cur_f‹r
, s‹->
cur_¡ršg
);

1448 } ià(
	`xmlSŒcmp
(
Çme
, (
xmlCh¬
 *) "filter") == 0) {

1449 
¡©e
->
cur_f‹r
 = 
NULL
;

1450 } ià(
	`xmlSŒcmp
(
Çme
, (
xmlCh¬
 *) "criteria") == 0) {

1451 
¡©e
->
cur_f‹r_»ad
 = 
NULL
;

1453 
	`ä“
(
¡©e
->
cur_¡ršg
);

1454 
¡©e
->
cur_¡ršg
 = 
NULL
;

1455 
	}
}

1457 
	$f‹r_·r£_ch¬aù”s
(*
u£r_d©a
, cÚ¡ 
xmlCh¬
 * 
ch
, 
Ën
)

1459 
f‹r_·r£_¡©e
 *
¡©e
 = 
u£r_d©a
;

1460 
	`ä“
(
¡©e
->
cur_¡ršg
);

1461 
¡©e
->
cur_¡ršg
 = 
	`xmlSŒndup
(
ch
, 
Ën
);

1462 
	}
}

1464 
	$f‹r_·r£_xml
(
f‹r_·r£_¡©e
 *
¡©e
, cÚ¡ *
f’ame
)

1466 
xmlSAXHªdËr
 
hªdËr
;

1467 
”r
;

1469 
	`mem£t
(&
hªdËr
, 0, (
xmlSAXHªdËr
));

1470 
hªdËr
.
¡¬tEËm’t
 = 
f‹r_·r£_¡¬t_–em’t
;

1471 
hªdËr
.
’dEËm’t
 = 
f‹r_·r£_’d_–em’t
;

1472 
hªdËr
.
ch¬aù”s
 = 
f‹r_·r£_ch¬aù”s
;

1473 
”r
 = 
	`xmlSAXU£rP¬£Fe
(&
hªdËr
, 
¡©e
, 
f’ame
);

1474 
	`ä“
(
¡©e
->
cur_¡ršg
);

1475 
¡©e
->
cur_¡ršg
 = 
NULL
;

1476 ià(
”r
) {

1477 
”ºo
 = 
EIO
;

1480 ià(
¡©e
->
w¬nšgs
) {

1484 
	}
}

1486 
	$f‹r_­³nd_to_fe
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, 
FILE
 * 
fe
, 
bs
)

1488 
xmlCh¬
 *
esÿ³d
;

1489 
xmlCh¬
 *
¡r_xml
;

1490 
i
;

1491 
size_t
 
j
;

1493 ià(
f‹r
 =ğ
NULL
 || 
fe
 == NULL) {

1494 
”ºo
 = 
EINVAL
;

1498 ià(
f‹r
->
Çme
 =ğ
NULL
) {

1499 
¡r_xml
 = 
	`xmlCh¬SŒdup
("Unnamed");

1501 
¡r_xml
 = 
	`xmlCh¬SŒdup
(
f‹r
->
Çme
);

1503 
esÿ³d
 = 
	`xmlURIEsÿ³SŒ
(
¡r_xml
, 
NULL
);

1504 
i
 = 0; i < 
bs
; i++)

1505 
	`årštf
(
fe
, "\t");

1506 
	`årštf
(
fe
, "<f‹¸Çme=\"%s\" m©ch=\"%s\" sŒiù=\"%s\">\n", 
esÿ³d
,

1507 
f‹r
->
m©ch
 =ğ
SEAUDIT_FILTER_MATCH_ALL
 ? "®l" : "ªy", f‹r->
¡riù
 ? "true" : "false");

1508 
	`ä“
(
esÿ³d
);

1509 
	`ä“
(
¡r_xml
);

1511 ià(
f‹r
->
desc
 !ğ
NULL
) {

1512 
¡r_xml
 = 
	`xmlCh¬SŒdup
(
f‹r
->
desc
);

1513 
esÿ³d
 = 
	`xmlURIEsÿ³SŒ
(
¡r_xml
, 
NULL
);

1514 
i
 = 0; i < 
bs
 + 1; i++)

1515 
	`årštf
(
fe
, "\t");

1516 
	`årštf
(
fe
, "<desc>%s</desc>\n", 
esÿ³d
);

1517 
	`ä“
(
esÿ³d
);

1518 
	`ä“
(
¡r_xml
);

1520 
j
 = 0; j < (
f‹r_ü™”Ÿ
) / (filter_criteria[0]); j++) {

1521 
f‹r_ü™”Ÿ
[
j
].
	`´št
(
f‹r
, f‹r_ü™”Ÿ[j].
Çme
, 
fe
, 
bs
 + 1);

1523 
i
 = 0; i < 
bs
; i++)

1524 
	`årštf
(
fe
, "\t");

1525 
	`årštf
(
fe
, "</filter>\n");

1526 
	}
}

	@libseaudit/src/filter-internal.h

26 #iâdeà
SEAUDIT_FILTER_INTERNAL_H


27 
	#SEAUDIT_FILTER_INTERNAL_H


	)

29 
	~"£aud™_š‹º®.h
"

31 
	s£aud™_f‹r


33 
£aud™_f‹r_m©ch_e
 
	mm©ch
;

34 *
	mÇme
;

35 *
	mdesc
;

36 
boŞ
 
	m¡riù
;

38 
£aud™_mod–_t
 *
	mmod–
;

40 
­Ş_veùÜ_t
 *
	m¤c_u£rs
;

42 
­Ş_veùÜ_t
 *
	m¤c_rŞes
;

44 
­Ş_veùÜ_t
 *
	m¤c_ty³s
;

46 
­Ş_veùÜ_t
 *
	m¤c_mls_lvl
;

48 
­Ş_veùÜ_t
 *
	m¤c_mls_şr
;

50 
­Ş_veùÜ_t
 *
	mtgt_u£rs
;

52 
­Ş_veùÜ_t
 *
	mtgt_rŞes
;

54 
­Ş_veùÜ_t
 *
	mtgt_ty³s
;

56 
­Ş_veùÜ_t
 *
	mtgt_mls_lvl
;

58 
­Ş_veùÜ_t
 *
	mtgt_mls_şr
;

60 
­Ş_veùÜ_t
 *
	mtgt_şas£s
;

62 *
	m³rm
;

64 *
	mexe
;

66 *
	mho¡
;

68 *
	m·th
;

70 
	mšode
;

72 
	mpid
;

74 *
	mcomm
;

76 *
	mªyaddr
;

78 *
	mÏddr
;

80 *
	mçddr
;

82 *
	m§ddr
;

84 *
	mdaddr
;

86 
	mªypÜt
;

88 
	mÍÜt
;

90 
	måÜt
;

92 
	m¥Üt
;

94 
	mdpÜt
;

96 
	mpÜt
;

98 *
	mÃtif
;

100 
	mkey
;

102 
	mÿp
;

104 
£aud™_avc_mes§ge_ty³_e
 
	mavc_msg_ty³
;

105 
tm
 *
	m¡¬t
, *
	m’d
;

106 
£aud™_f‹r_d©e_m©ch_e
 
	md©e_m©ch
;

	@libseaudit/src/filter.c

38 
	~"£aud™_š‹º®.h
"

39 
	~"f‹r-š‹º®.h
"

41 
	~<­Ş/ut.h
>

43 
	~<”ºo.h
>

44 
	~<¡dlib.h
>

45 
	~<¡ršg.h
>

46 
	~<time.h
>

48 
£aud™_f‹r_t
 *
	$£aud™_f‹r_ü—‹
(cÚ¡ *
Çme
)

50 
£aud™_f‹r_t
 *
s
 = 
	`ÿÎoc
(1, (*s));

51 ià(
s
 =ğ
NULL
) {

52  
NULL
;

54 ià(
Çme
 =ğ
NULL
) {

55 
Çme
 = "Untitled";

57 ià((
s
->
Çme
 = 
	`¡rdup
Òame)è=ğ
NULL
) {

58 
”rÜ
 = 
”ºo
;

59 
	`£aud™_f‹r_de¡roy
(&
s
);

60 
”ºo
 = 
”rÜ
;

61  
NULL
;

63  
s
;

64 
	}
}

66 
£aud™_f‹r_t
 *
	$£aud™_f‹r_ü—‹_äom_f‹r
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

68 
£aud™_f‹r_t
 *
f
 = 
NULL
;

69 
”rÜ
 = 0;

70 ià(
f‹r
 =ğ
NULL
) {

71 
”rÜ
 = 
EINVAL
;

72 
ş—nup
;

74 ià((
f
 = 
	`£aud™_f‹r_ü—‹
(
f‹r
->
Çme
)è=ğ
NULL
 || (f‹r->
desc
 !ğNULL && (f->desøğ
	`¡rdup
(filter->desc)) == NULL)) {

75 
”rÜ
 = 
”ºo
;

76 
ş—nup
;

78 
f
->
¡riù
 = 
f‹r
->strict;

79 ià((
f‹r
->
¤c_u£rs
 !ğ
NULL


80 && (
f
->
¤c_u£rs
 = 
	`­Ş_veùÜ_ü—‹_äom_veùÜ
(
f‹r
->¤c_u£rs, 
­Ş_¡r_¡rdup
, 
NULL
, 
ä“
)) == NULL)

81 || (
f‹r
->
¤c_rŞes
 !ğ
NULL


82 && (
f
->
¤c_rŞes
 = 
	`­Ş_veùÜ_ü—‹_äom_veùÜ
(
f‹r
->¤c_rŞes, 
­Ş_¡r_¡rdup
, 
NULL
, 
ä“
)) == NULL)

83 || (
f‹r
->
¤c_ty³s
 !ğ
NULL


84 && (
f
->
¤c_ty³s
 = 
	`­Ş_veùÜ_ü—‹_äom_veùÜ
(
f‹r
->¤c_ty³s, 
­Ş_¡r_¡rdup
, 
NULL
, 
ä“
)) == NULL)

85 || (
f‹r
->
¤c_mls_lvl
 !ğ
NULL


86 && (
f
->
¤c_mls_lvl
 = 
	`­Ş_veùÜ_ü—‹_äom_veùÜ
(
f‹r
->¤c_mls_lvl, 
­Ş_¡r_¡rdup
, 
NULL
, 
ä“
)) == NULL)

87 || (
f‹r
->
¤c_mls_şr
 !ğ
NULL


88 && (
f
->
¤c_mls_şr
 = 
	`­Ş_veùÜ_ü—‹_äom_veùÜ
(
f‹r
->¤c_mls_şr, 
­Ş_¡r_¡rdup
, 
NULL
, 
ä“
)) == NULL)

89 || (
f‹r
->
tgt_u£rs
 !ğ
NULL


90 && (
f
->
tgt_u£rs
 = 
	`­Ş_veùÜ_ü—‹_äom_veùÜ
(
f‹r
->tgt_u£rs, 
­Ş_¡r_¡rdup
, 
NULL
, 
ä“
)) == NULL)

91 || (
f‹r
->
tgt_rŞes
 !ğ
NULL


92 && (
f
->
tgt_rŞes
 = 
	`­Ş_veùÜ_ü—‹_äom_veùÜ
(
f‹r
->tgt_rŞes, 
­Ş_¡r_¡rdup
, 
NULL
, 
ä“
)) == NULL)

93 || (
f‹r
->
tgt_ty³s
 !ğ
NULL


94 && (
f
->
tgt_ty³s
 = 
	`­Ş_veùÜ_ü—‹_äom_veùÜ
(
f‹r
->tgt_ty³s, 
­Ş_¡r_¡rdup
, 
NULL
, 
ä“
)) == NULL)

95 || (
f‹r
->
tgt_mls_lvl
 !ğ
NULL


96 && (
f
->
tgt_mls_lvl
 = 
	`­Ş_veùÜ_ü—‹_äom_veùÜ
(
f‹r
->tgt_mls_lvl, 
­Ş_¡r_¡rdup
, 
NULL
, 
ä“
)) == NULL)

97 || (
f‹r
->
tgt_mls_şr
 !ğ
NULL


98 && (
f
->
tgt_mls_şr
 = 
	`­Ş_veùÜ_ü—‹_äom_veùÜ
(
f‹r
->tgt_mls_şr, 
­Ş_¡r_¡rdup
, 
NULL
, 
ä“
)) == NULL)

99 || (
f‹r
->
tgt_şas£s
 !ğ
NULL


100 && (
f
->
tgt_şas£s
 = 
	`­Ş_veùÜ_ü—‹_äom_veùÜ
(
f‹r
->tgt_şas£s, 
­Ş_¡r_¡rdup
, 
NULL
, 
ä“
)) == NULL)) {

101 
”rÜ
 = 
”ºo
;

102 
ş—nup
;

104 ià((
f‹r
->
³rm
 !ğ
NULL
 && (
f
->³rm = 
	`¡rdup
(filter->perm)) == NULL) ||

105 (
f‹r
->
exe
 !ğ
NULL
 && (
f
->exğ
	`¡rdup
(filter->exe)) == NULL) ||

106 (
f‹r
->
ho¡
 !ğ
NULL
 && (
f
->ho¡ = 
	`¡rdup
(filter->host)) == NULL) ||

107 (
f‹r
->
·th
 !ğ
NULL
 && (
f
->·th = 
	`¡rdup
(filter->path)) == NULL) ||

108 (
f‹r
->
comm
 !ğ
NULL
 && (
f
->comm = 
	`¡rdup
(filter->comm)) == NULL) ||

109 (
f‹r
->
ªyaddr
 !ğ
NULL
 && (
f
->ªyadd¸ğ
	`¡rdup
(filter->anyaddr)) == NULL) ||

110 (
f‹r
->
Ãtif
 !ğ
NULL
 && (
f
->Ãtiàğ
	`¡rdup
(filter->netif)) == NULL)) {

111 
”rÜ
 = 
”ºo
;

112 
ş—nup
;

114 ià((
f‹r
->
Ïddr
 !ğ
NULL
 && (
f
->Ïdd¸ğ
	`¡rdup
(filter->laddr)) == NULL) ||

115 (
f‹r
->
çddr
 !ğ
NULL
 && (
f
->çdd¸ğ
	`¡rdup
(filter->faddr)) == NULL) ||

116 (
f‹r
->
§ddr
 !ğ
NULL
 && (
f
->§dd¸ğ
	`¡rdup
(filter->saddr)) == NULL) ||

117 (
f‹r
->
daddr
 !ğ
NULL
 && (
f
->dadd¸ğ
	`¡rdup
(filter->daddr)) == NULL)) {

118 
”rÜ
 = 
”ºo
;

119 
ş—nup
;

121 
f
->
m©ch
 = 
f‹r
->match;

122 
f
->
šode
 = 
f‹r
->inode;

123 
f
->
pid
 = 
f‹r
->pid;

124 
f
->
ªypÜt
 = 
f‹r
->anyport;

125 
f
->
ÍÜt
 = 
f‹r
->lport;

126 
f
->
åÜt
 = 
f‹r
->fport;

127 
f
->
¥Üt
 = 
f‹r
->sport;

128 
f
->
dpÜt
 = 
f‹r
->dport;

129 
f
->
pÜt
 = 
f‹r
->port;

130 
f
->
key
 = 
f‹r
->key;

131 
f
->
ÿp
 = 
f‹r
->cap;

132 
f
->
avc_msg_ty³
 = 
f‹r
->avc_msg_type;

133 ià(
f‹r
->
¡¬t
 !ğ
NULL
) {

134 ià((
f
->
¡¬t
 = 
	`ÿÎoc
(1, (*f->¡¬t))è=ğ
NULL
) {

135 
”rÜ
 = 
”ºo
;

136 
ş—nup
;

138 
	`memıy
(
f
->
¡¬t
, 
f‹r
->start, (*f->start));

140 ià(
f‹r
->
’d
 !ğ
NULL
) {

141 ià((
f
->
’d
 = 
	`ÿÎoc
(1, (*f->’d))è=ğ
NULL
) {

142 
”rÜ
 = 
”ºo
;

143 
ş—nup
;

145 
	`memıy
(
f
->
’d
, 
f‹r
->end, (*f->end));

147 
f
->
d©e_m©ch
 = 
f‹r
->date_match;

148 
f
->
mod–
 = 
NULL
;

149 
ş—nup
:

150 ià(
”rÜ
 != 0) {

151 
	`£aud™_f‹r_de¡roy
(&
f
);

152 
”ºo
 = 
”rÜ
;

153  
NULL
;

155  
f
;

156 
	}
}

163 
	$f‹r_ä“
(*
v
)

165 
£aud™_f‹r_t
 *
f
 = 
v
;

166 
	`£aud™_f‹r_de¡roy
(&
f
);

167 
	}
}

169 
­Ş_veùÜ_t
 *
	$£aud™_f‹r_ü—‹_äom_fe
(cÚ¡ *
f’ame
)

171 
f‹r_·r£_¡©e
 
¡©e
;

172 
»tv®
, 
”rÜ
;

173 
	`mem£t
(&
¡©e
, 0, (state));

174 ià((
¡©e
.
f‹rs
 = 
	`­Ş_veùÜ_ü—‹
(
f‹r_ä“
)è=ğ
NULL
) {

175  
NULL
;

177 
»tv®
 = 
	`f‹r_·r£_xml
(&
¡©e
, 
f’ame
);

178 
”rÜ
 = 
”ºo
;

179 
	`ä“
(
¡©e
.
v›w_Çme
);

180 ià(
»tv®
 < 0) {

181 
	`­Ş_veùÜ_de¡roy
(&
¡©e
.
f‹rs
);

182 
”ºo
 = 
”rÜ
;

183  
NULL
;

185  
¡©e
.
f‹rs
;

186 
	}
}

188 
	$£aud™_f‹r_de¡roy
(
£aud™_f‹r_t
 ** 
f‹r
)

190 ià(
f‹r
 !ğ
NULL
 && *filter != NULL) {

191 
	`ä“
((*
f‹r
)->
Çme
);

192 
	`ä“
((*
f‹r
)->
desc
);

193 
	`­Ş_veùÜ_de¡roy
(&(*
f‹r
)->
¤c_u£rs
);

194 
	`­Ş_veùÜ_de¡roy
(&(*
f‹r
)->
¤c_rŞes
);

195 
	`­Ş_veùÜ_de¡roy
(&(*
f‹r
)->
¤c_ty³s
);

196 
	`­Ş_veùÜ_de¡roy
(&(*
f‹r
)->
¤c_mls_lvl
);

197 
	`­Ş_veùÜ_de¡roy
(&(*
f‹r
)->
¤c_mls_şr
);

198 
	`­Ş_veùÜ_de¡roy
(&(*
f‹r
)->
tgt_u£rs
);

199 
	`­Ş_veùÜ_de¡roy
(&(*
f‹r
)->
tgt_rŞes
);

200 
	`­Ş_veùÜ_de¡roy
(&(*
f‹r
)->
tgt_ty³s
);

201 
	`­Ş_veùÜ_de¡roy
(&(*
f‹r
)->
tgt_mls_lvl
);

202 
	`­Ş_veùÜ_de¡roy
(&(*
f‹r
)->
tgt_mls_şr
);

203 
	`­Ş_veùÜ_de¡roy
(&(*
f‹r
)->
tgt_şas£s
);

204 
	`ä“
((*
f‹r
)->
³rm
);

205 
	`ä“
((*
f‹r
)->
exe
);

206 
	`ä“
((*
f‹r
)->
ho¡
);

207 
	`ä“
((*
f‹r
)->
·th
);

208 
	`ä“
((*
f‹r
)->
comm
);

209 
	`ä“
((*
f‹r
)->
ªyaddr
);

210 
	`ä“
((*
f‹r
)->
Ïddr
);

211 
	`ä“
((*
f‹r
)->
çddr
);

212 
	`ä“
((*
f‹r
)->
§ddr
);

213 
	`ä“
((*
f‹r
)->
daddr
);

214 
	`ä“
((*
f‹r
)->
Ãtif
);

215 
	`ä“
((*
f‹r
)->
¡¬t
);

216 
	`ä“
((*
f‹r
)->
’d
);

217 
	`ä“
(*
f‹r
);

218 *
f‹r
 = 
NULL
;

220 
	}
}

222 
	$£aud™_f‹r_£t_m©ch
(
£aud™_f‹r_t
 * 
f‹r
, 
£aud™_f‹r_m©ch_e
 
m©ch
)

224 ià(
f‹r
 =ğ
NULL
) {

225 
”ºo
 = 
EINVAL
;

228 
f‹r
->
m©ch
 = match;

229 ià(
f‹r
->
mod–
 !ğ
NULL
) {

230 
	`mod–_nÙify_f‹r_chªged
(
f‹r
->
mod–
, filter);

233 
	}
}

235 
£aud™_f‹r_m©ch_e
 
	$£aud™_f‹r_g‘_m©ch
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

237 ià(
f‹r
 =ğ
NULL
) {

238 
”ºo
 = 
EINVAL
;

241  
f‹r
->
m©ch
;

242 
	}
}

244 
	$£aud™_f‹r_£t_Çme
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ *
Çme
)

246 *
Ãw_Çme
 = 
NULL
;

247 ià(
f‹r
 =ğ
NULL
) {

248 
”ºo
 = 
EINVAL
;

251 ià(
Çme
 !ğ
f‹r
->name) {

252 ià(
Çme
 !ğ
NULL
 && (
Ãw_Çme
 = 
	`¡rdup
(name)) == NULL) {

255 
	`ä“
(
f‹r
->
Çme
);

256 
f‹r
->
Çme
 = 
Ãw_Çme
;;

259 
	}
}

261 cÚ¡ *
	$£aud™_f‹r_g‘_Çme
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

263 ià(
f‹r
 =ğ
NULL
) {

264 
”ºo
 = 
EINVAL
;

265  
NULL
;

267  
f‹r
->
Çme
;

268 
	}
}

270 
	$£aud™_f‹r_£t_desütiÚ
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ *
desc
)

272 *
Ãw_desc
 = 
NULL
;

273 ià(
f‹r
 =ğ
NULL
) {

274 
”ºo
 = 
EINVAL
;

277 ià(
desc
 !ğ
f‹r
->desc) {

278 ià(
desc
 !ğ
NULL
 && (
Ãw_desc
 = 
	`¡rdup
(desc)) == NULL) {

281 
	`ä“
(
f‹r
->
desc
);

282 
f‹r
->
desc
 = 
Ãw_desc
;

285 
	}
}

287 cÚ¡ *
	$£aud™_f‹r_g‘_desütiÚ
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

289 ià(
f‹r
 =ğ
NULL
) {

290 
”ºo
 = 
EINVAL
;

291  
NULL
;

293  
f‹r
->
desc
;

294 
	}
}

296 
	$£aud™_f‹r_£t_¡riù
(
£aud™_f‹r_t
 * 
f‹r
, 
boŞ
 
is_¡riù
)

298 ià(
f‹r
 =ğ
NULL
) {

299 
”ºo
 = 
EINVAL
;

302 ià(
f‹r
->
¡riù
 !ğ
is_¡riù
) {

303 
f‹r
->
¡riù
 = 
is_¡riù
;

304 ià(
f‹r
->
mod–
 !ğ
NULL
) {

305 
	`mod–_nÙify_f‹r_chªged
(
f‹r
->
mod–
, filter);

309 
	}
}

311 
boŞ
 
	$£aud™_f‹r_g‘_¡riù
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

313 ià(
f‹r
 =ğ
NULL
) {

314 
”ºo
 = 
EINVAL
;

315  
çl£
;

317  
f‹r
->
¡riù
;

318 
	}
}

325 
	$f‹r_£t_veùÜ
(
£aud™_f‹r_t
 * 
f‹r
, 
­Ş_veùÜ_t
 ** 
tgt
, cÚ¡‡pŞ_veùÜ_ˆ* 
v
)

327 
­Ş_veùÜ_t
 *
Ãw_v
 = 
NULL
;

328 ià(
v
 !ğ
NULL
) {

329 ià((
Ãw_v
 = 
	`­Ş_veùÜ_ü—‹_äom_veùÜ
(
v
, 
­Ş_¡r_¡rdup
, 
NULL
, 
ä“
)) == NULL) {

333 
	`­Ş_veùÜ_de¡roy
(
tgt
);

334 *
tgt
 = 
Ãw_v
;

335 ià(
f‹r
->
mod–
 !ğ
NULL
) {

336 
	`mod–_nÙify_f‹r_chªged
(
f‹r
->
mod–
, filter);

339 
	}
}

346 
	$f‹r_£t_¡ršg
(
£aud™_f‹r_t
 * 
f‹r
, **
de¡
, cÚ¡ *
¤c
)

348 ià(
¤c
 !ğ*
de¡
) {

349 *
Ãw_s
 = 
NULL
;

350 ià(
¤c
 !ğ
NULL
 && (
Ãw_s
 = 
	`¡rdup
(src)) == NULL) {

353 
	`ä“
(*
de¡
);

354 *
de¡
 = 
Ãw_s
;

355 ià(
f‹r
->
mod–
 !ğ
NULL
) {

356 
	`mod–_nÙify_f‹r_chªged
(
f‹r
->
mod–
, filter);

360 
	}
}

362 
	$f‹r_£t_ulÚg
(
£aud™_f‹r_t
 * 
f‹r
, *
de¡
, cÚ¡ 
ulÚg
 
¤c
)

364 ià(
¤c
 !ğ*
de¡
) {

365 *
de¡
 = 
¤c
;

366 ià(
f‹r
->
mod–
 !ğ
NULL
) {

367 
	`mod–_nÙify_f‹r_chªged
(
f‹r
->
mod–
, filter);

371 
	}
}

373 
	$f‹r_£t_ušt
(
£aud™_f‹r_t
 * 
f‹r
, *
de¡
, cÚ¡ 
ulÚg
 
¤c
)

375 ià(
¤c
 !ğ*
de¡
) {

376 *
de¡
 = 
¤c
;

377 ià(
f‹r
->
mod–
 !ğ
NULL
) {

378 
	`mod–_nÙify_f‹r_chªged
(
f‹r
->
mod–
, filter);

382 
	}
}

384 
	$f‹r_£t_št
(
£aud™_f‹r_t
 * 
f‹r
, *
de¡
, cÚ¡ 
¤c
)

386 
s
 = 
¤c
;

387 ià(
¤c
 <= 0) {

388 
s
 = 0;

390 ià(
s
 !ğ*
de¡
) {

391 *
de¡
 = 
s
;

392 ià(
f‹r
->
mod–
 !ğ
NULL
) {

393 
	`mod–_nÙify_f‹r_chªged
(
f‹r
->
mod–
, filter);

397 
	}
}

401 
	$£aud™_f‹r_£t_sourû_u£r
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
­Ş_veùÜ_t
 * 
v
)

403 ià(
f‹r
 =ğ
NULL
) {

404 
”ºo
 = 
EINVAL
;

407  
	`f‹r_£t_veùÜ
(
f‹r
, &f‹r->
¤c_u£rs
, 
v
);

408 
	}
}

410 cÚ¡ 
­Ş_veùÜ_t
 *
	$£aud™_f‹r_g‘_sourû_u£r
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

412 ià(
f‹r
 =ğ
NULL
) {

413 
”ºo
 = 
EINVAL
;

414  
NULL
;

416  
f‹r
->
¤c_u£rs
;

417 
	}
}

419 
	$£aud™_f‹r_£t_sourû_rŞe
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
­Ş_veùÜ_t
 * 
v
)

421 ià(
f‹r
 =ğ
NULL
) {

422 
”ºo
 = 
EINVAL
;

425  
	`f‹r_£t_veùÜ
(
f‹r
, &f‹r->
¤c_rŞes
, 
v
);

426 
	}
}

428 cÚ¡ 
­Ş_veùÜ_t
 *
	$£aud™_f‹r_g‘_sourû_rŞe
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

430 ià(
f‹r
 =ğ
NULL
) {

431 
”ºo
 = 
EINVAL
;

432  
NULL
;

434  
f‹r
->
¤c_rŞes
;

435 
	}
}

437 
	$£aud™_f‹r_£t_sourû_ty³
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
­Ş_veùÜ_t
 * 
v
)

439 ià(
f‹r
 =ğ
NULL
) {

440 
”ºo
 = 
EINVAL
;

443  
	`f‹r_£t_veùÜ
(
f‹r
, &f‹r->
¤c_ty³s
, 
v
);

444 
	}
}

446 cÚ¡ 
­Ş_veùÜ_t
 *
	$£aud™_f‹r_g‘_sourû_ty³
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

448 ià(
f‹r
 =ğ
NULL
) {

449 
”ºo
 = 
EINVAL
;

450  
NULL
;

452  
f‹r
->
¤c_ty³s
;

453 
	}
}

455 
	$£aud™_f‹r_£t_sourû_mls_lvl
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
­Ş_veùÜ_t
 * 
v
)

457 ià(
f‹r
 =ğ
NULL
) {

458 
”ºo
 = 
EINVAL
;

461  
	`f‹r_£t_veùÜ
(
f‹r
, &f‹r->
¤c_mls_lvl
, 
v
);

462 
	}
}

464 cÚ¡ 
­Ş_veùÜ_t
 *
	$£aud™_f‹r_g‘_sourû_mls_lvl
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

466 ià(
f‹r
 =ğ
NULL
) {

467 
”ºo
 = 
EINVAL
;

468  
NULL
;

470  
f‹r
->
¤c_mls_lvl
;

471 
	}
}

473 
	$£aud™_f‹r_£t_sourû_mls_şr
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
­Ş_veùÜ_t
 * 
v
)

475 ià(
f‹r
 =ğ
NULL
) {

476 
”ºo
 = 
EINVAL
;

479  
	`f‹r_£t_veùÜ
(
f‹r
, &f‹r->
¤c_mls_şr
, 
v
);

480 
	}
}

482 cÚ¡ 
­Ş_veùÜ_t
 *
	$£aud™_f‹r_g‘_sourû_mls_şr
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

484 ià(
f‹r
 =ğ
NULL
) {

485 
”ºo
 = 
EINVAL
;

486  
NULL
;

488  
f‹r
->
¤c_mls_şr
;

489 
	}
}

490 
	$£aud™_f‹r_£t_rg‘_u£r
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
­Ş_veùÜ_t
 * 
v
)

492 ià(
f‹r
 =ğ
NULL
) {

493 
”ºo
 = 
EINVAL
;

496  
	`f‹r_£t_veùÜ
(
f‹r
, &f‹r->
tgt_u£rs
, 
v
);

497 
	}
}

499 cÚ¡ 
­Ş_veùÜ_t
 *
	$£aud™_f‹r_g‘_rg‘_u£r
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

501 ià(
f‹r
 =ğ
NULL
) {

502 
”ºo
 = 
EINVAL
;

503  
NULL
;

505  
f‹r
->
tgt_u£rs
;

506 
	}
}

508 
	$£aud™_f‹r_£t_rg‘_rŞe
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
­Ş_veùÜ_t
 * 
v
)

510 ià(
f‹r
 =ğ
NULL
) {

511 
”ºo
 = 
EINVAL
;

514  
	`f‹r_£t_veùÜ
(
f‹r
, &f‹r->
tgt_rŞes
, 
v
);

515 
	}
}

517 cÚ¡ 
­Ş_veùÜ_t
 *
	$£aud™_f‹r_g‘_rg‘_rŞe
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

519 ià(
f‹r
 =ğ
NULL
) {

520 
”ºo
 = 
EINVAL
;

521  
NULL
;

523  
f‹r
->
tgt_rŞes
;

524 
	}
}

526 
	$£aud™_f‹r_£t_rg‘_ty³
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
­Ş_veùÜ_t
 * 
v
)

528 ià(
f‹r
 =ğ
NULL
) {

529 
”ºo
 = 
EINVAL
;

532  
	`f‹r_£t_veùÜ
(
f‹r
, &f‹r->
tgt_ty³s
, 
v
);

533 
	}
}

535 cÚ¡ 
­Ş_veùÜ_t
 *
	$£aud™_f‹r_g‘_rg‘_ty³
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

537 ià(
f‹r
 =ğ
NULL
) {

538 
”ºo
 = 
EINVAL
;

539  
NULL
;

541  
f‹r
->
tgt_ty³s
;

542 
	}
}

544 
	$£aud™_f‹r_£t_rg‘_mls_lvl
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
­Ş_veùÜ_t
 * 
v
)

546 ià(
f‹r
 =ğ
NULL
) {

547 
”ºo
 = 
EINVAL
;

550  
	`f‹r_£t_veùÜ
(
f‹r
, &f‹r->
tgt_mls_lvl
, 
v
);

551 
	}
}

553 cÚ¡ 
­Ş_veùÜ_t
 *
	$£aud™_f‹r_g‘_rg‘_mls_lvl
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

555 ià(
f‹r
 =ğ
NULL
) {

556 
”ºo
 = 
EINVAL
;

557  
NULL
;

559  
f‹r
->
tgt_mls_lvl
;

560 
	}
}

562 
	$£aud™_f‹r_£t_rg‘_mls_şr
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
­Ş_veùÜ_t
 * 
v
)

564 ià(
f‹r
 =ğ
NULL
) {

565 
”ºo
 = 
EINVAL
;

568  
	`f‹r_£t_veùÜ
(
f‹r
, &f‹r->
tgt_mls_şr
, 
v
);

569 
	}
}

571 cÚ¡ 
­Ş_veùÜ_t
 *
	$£aud™_f‹r_g‘_rg‘_mls_şr
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

573 ià(
f‹r
 =ğ
NULL
) {

574 
”ºo
 = 
EINVAL
;

575  
NULL
;

577  
f‹r
->
tgt_mls_şr
;

578 
	}
}

580 
	$£aud™_f‹r_£t_rg‘_şass
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
­Ş_veùÜ_t
 * 
v
)

582 ià(
f‹r
 =ğ
NULL
) {

583 
”ºo
 = 
EINVAL
;

586  
	`f‹r_£t_veùÜ
(
f‹r
, &f‹r->
tgt_şas£s
, 
v
);

587 
	}
}

589 cÚ¡ 
­Ş_veùÜ_t
 *
	$£aud™_f‹r_g‘_rg‘_şass
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

591 ià(
f‹r
 =ğ
NULL
) {

592 
”ºo
 = 
EINVAL
;

593  
NULL
;

595  
f‹r
->
tgt_şas£s
;

596 
	}
}

598 
	$£aud™_f‹r_£t_³rmissiÚ
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ *
³rm
)

600 ià(
f‹r
 =ğ
NULL
) {

601 
”ºo
 = 
EINVAL
;

604  
	`f‹r_£t_¡ršg
(
f‹r
, &f‹r->
³rm
,…erm);

605 
	}
}

607 cÚ¡ *
	$£aud™_f‹r_g‘_³rmissiÚ
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

609 ià(
f‹r
 =ğ
NULL
) {

610 
”ºo
 = 
EINVAL
;

611  
NULL
;

613  
f‹r
->
³rm
;

614 
	}
}

616 
	$£aud™_f‹r_£t_execubË
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ *
exe
)

618 ià(
f‹r
 =ğ
NULL
) {

619 
”ºo
 = 
EINVAL
;

622  
	`f‹r_£t_¡ršg
(
f‹r
, &f‹r->
exe
,ƒxe);

623 
	}
}

625 cÚ¡ *
	$£aud™_f‹r_g‘_execubË
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

627 ià(
f‹r
 =ğ
NULL
) {

628 
”ºo
 = 
EINVAL
;

629  
NULL
;

631  
f‹r
->
exe
;

632 
	}
}

634 
	$£aud™_f‹r_£t_ho¡
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ *
ho¡
)

636 ià(
f‹r
 =ğ
NULL
) {

637 
”ºo
 = 
EINVAL
;

640  
	`f‹r_£t_¡ršg
(
f‹r
, &f‹r->
ho¡
, host);

641 
	}
}

643 cÚ¡ *
	$£aud™_f‹r_g‘_ho¡
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

645 ià(
f‹r
 =ğ
NULL
) {

646 
”ºo
 = 
EINVAL
;

647  
NULL
;

649  
f‹r
->
ho¡
;

650 
	}
}

652 
	$£aud™_f‹r_£t_·th
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ *
·th
)

654 ià(
f‹r
 =ğ
NULL
) {

655 
”ºo
 = 
EINVAL
;

658  
	`f‹r_£t_¡ršg
(
f‹r
, &f‹r->
·th
,…ath);

659 
	}
}

661 cÚ¡ *
	$£aud™_f‹r_g‘_·th
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

663 ià(
f‹r
 =ğ
NULL
) {

664 
”ºo
 = 
EINVAL
;

665  
NULL
;

667  
f‹r
->
·th
;

668 
	}
}

670 
	$£aud™_f‹r_£t_šode
(
£aud™_f‹r_t
 * 
f‹r
, 
šode
)

672 ià(
f‹r
 =ğ
NULL
) {

673 
”ºo
 = 
EINVAL
;

676  
	`f‹r_£t_ulÚg
(
f‹r
, &f‹r->
šode
, inode);

678 
	}
}

680 
	$£aud™_f‹r_g‘_šode
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

682 ià(
f‹r
 =ğ
NULL
) {

683 
”ºo
 = 
EINVAL
;

686  
f‹r
->
šode
;

687 
	}
}

689 
	$£aud™_f‹r_£t_pid
(
£aud™_f‹r_t
 * 
f‹r
, 
pid
)

691 ià(
f‹r
 =ğ
NULL
) {

692 
”ºo
 = 
EINVAL
;

695  
	`f‹r_£t_ušt
(
f‹r
, &f‹r->
pid
,…id);

697 
	}
}

699 
	$£aud™_f‹r_g‘_pid
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

701 ià(
f‹r
 =ğ
NULL
) {

702 
”ºo
 = 
EINVAL
;

705  
f‹r
->
pid
;

706 
	}
}

708 
	$£aud™_f‹r_£t_commªd
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ *
commªd
)

710 ià(
f‹r
 =ğ
NULL
) {

711 
”ºo
 = 
EINVAL
;

714  
	`f‹r_£t_¡ršg
(
f‹r
, &f‹r->
comm
, 
commªd
);

715 
	}
}

717 cÚ¡ *
	$£aud™_f‹r_g‘_commªd
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

719 ià(
f‹r
 =ğ
NULL
) {

720 
”ºo
 = 
EINVAL
;

721  
NULL
;

723  
f‹r
->
comm
;

724 
	}
}

726 
	$£aud™_f‹r_£t_ªyaddr
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ *
addr
)

728 ià(
f‹r
 =ğ
NULL
) {

729 
”ºo
 = 
EINVAL
;

732  
	`f‹r_£t_¡ršg
(
f‹r
, &f‹r->
ªyaddr
, 
addr
);

733 
	}
}

735 cÚ¡ *
	$£aud™_f‹r_g‘_ªyaddr
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

737 ià(
f‹r
 =ğ
NULL
) {

738 
”ºo
 = 
EINVAL
;

739  
NULL
;

741  
f‹r
->
ªyaddr
;

742 
	}
}

744 
	$£aud™_f‹r_£t_ªypÜt
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
pÜt
)

746 ià(
f‹r
 =ğ
NULL
) {

747 
”ºo
 = 
EINVAL
;

750  
	`f‹r_£t_št
(
f‹r
, &f‹r->
ªypÜt
, 
pÜt
);

751 
	}
}

753 
	$£aud™_f‹r_g‘_ªypÜt
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

755 ià(
f‹r
 =ğ
NULL
) {

756 
”ºo
 = 
EINVAL
;

759  
f‹r
->
ªypÜt
;

760 
	}
}

762 
	$f‹r_£t_add»ss_v”s_4_1
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ *
addr
)

764  
	`£aud™_f‹r_£t_ªyaddr
(
f‹r
, 
addr
);

765 
	}
}

767 cÚ¡ *
	$f‹r_g‘_add»ss_v”s_4_1
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

769  
	`£aud™_f‹r_g‘_ªyaddr
(
f‹r
);

770 
	}
}

772 
	$f‹r_£t_pÜt_v”s_4_1
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
pÜt
)

774  
	`£aud™_f‹r_£t_ªypÜt
(
f‹r
, 
pÜt
);

775 
	}
}

777 
	$f‹r_g‘_pÜt_v”s_4_1
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

779  
	`£aud™_f‹r_g‘_ªypÜt
(
f‹r
);

780 
	}
}

782 #ià
LINK_SHARED
 == 1

783 
__asm__
(".symver filter_set_ipaddress_vers_4_1,seaudit_filter_set_ipaddress@VERS_4.1");

784 
__asm__
(".symver filter_get_ipaddress_vers_4_1,seaudit_filter_get_ipaddress@VERS_4.1");

785 
__asm__
(".symver filter_set_port_vers_4_1,seaudit_filter_set_port@VERS_4.1");

786 
__asm__
(".symver filter_get_port_vers_4_1,seaudit_filter_get_port@VERS_4.1");

789 
	$£aud™_f‹r_£t_Ïddr
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ *
Ïddr
)

791 ià(
f‹r
 =ğ
NULL
) {

792 
”ºo
 = 
EINVAL
;

795  
	`f‹r_£t_¡ršg
(
f‹r
, &f‹r->
Ïddr
,†addr);

796 
	}
}

798 cÚ¡ *
	$£aud™_f‹r_g‘_Ïddr
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

800 ià(
f‹r
 =ğ
NULL
) {

801 
”ºo
 = 
EINVAL
;

802  
NULL
;

804  
f‹r
->
Ïddr
;

805 
	}
}

807 
	$£aud™_f‹r_£t_ÍÜt
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
ÍÜt
)

809 ià(
f‹r
 =ğ
NULL
) {

810 
”ºo
 = 
EINVAL
;

813  
	`f‹r_£t_št
(
f‹r
, &f‹r->
ÍÜt
,†port);

814 
	}
}

816 
	$£aud™_f‹r_g‘_ÍÜt
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

818 ià(
f‹r
 =ğ
NULL
) {

819 
”ºo
 = 
EINVAL
;

822  
f‹r
->
ÍÜt
;

823 
	}
}

825 
	$£aud™_f‹r_£t_çddr
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ *
çddr
)

827 ià(
f‹r
 =ğ
NULL
) {

828 
”ºo
 = 
EINVAL
;

831  
	`f‹r_£t_¡ršg
(
f‹r
, &f‹r->
çddr
, faddr);

832 
	}
}

834 cÚ¡ *
	$£aud™_f‹r_g‘_çddr
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

836 ià(
f‹r
 =ğ
NULL
) {

837 
”ºo
 = 
EINVAL
;

838  
NULL
;

840  
f‹r
->
çddr
;

841 
	}
}

843 
	$£aud™_f‹r_£t_åÜt
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
åÜt
)

845 ià(
f‹r
 =ğ
NULL
) {

846 
”ºo
 = 
EINVAL
;

849  
	`f‹r_£t_št
(
f‹r
, &f‹r->
åÜt
, fport);

850 
	}
}

852 
	$£aud™_f‹r_g‘_åÜt
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

854 ià(
f‹r
 =ğ
NULL
) {

855 
”ºo
 = 
EINVAL
;

858  
f‹r
->
åÜt
;

859 
	}
}

861 
	$£aud™_f‹r_£t_§ddr
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ *
§ddr
)

863 ià(
f‹r
 =ğ
NULL
) {

864 
”ºo
 = 
EINVAL
;

867  
	`f‹r_£t_¡ršg
(
f‹r
, &f‹r->
§ddr
, saddr);

868 
	}
}

870 cÚ¡ *
	$£aud™_f‹r_g‘_§ddr
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

872 ià(
f‹r
 =ğ
NULL
) {

873 
”ºo
 = 
EINVAL
;

874  
NULL
;

876  
f‹r
->
§ddr
;

877 
	}
}

879 
	$£aud™_f‹r_£t_¥Üt
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
¥Üt
)

881 ià(
f‹r
 =ğ
NULL
) {

882 
”ºo
 = 
EINVAL
;

885  
	`f‹r_£t_št
(
f‹r
, &f‹r->
¥Üt
, sport);

886 
	}
}

888 
	$£aud™_f‹r_g‘_¥Üt
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

890 ià(
f‹r
 =ğ
NULL
) {

891 
”ºo
 = 
EINVAL
;

894  
f‹r
->
¥Üt
;

895 
	}
}

897 
	$£aud™_f‹r_£t_daddr
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ *
daddr
)

899 ià(
f‹r
 =ğ
NULL
) {

900 
”ºo
 = 
EINVAL
;

903  
	`f‹r_£t_¡ršg
(
f‹r
, &f‹r->
daddr
, daddr);

904 
	}
}

906 cÚ¡ *
	$£aud™_f‹r_g‘_daddr
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

908 ià(
f‹r
 =ğ
NULL
) {

909 
”ºo
 = 
EINVAL
;

910  
NULL
;

912  
f‹r
->
daddr
;

913 
	}
}

915 
	$£aud™_f‹r_£t_dpÜt
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
dpÜt
)

917 ià(
f‹r
 =ğ
NULL
) {

918 
”ºo
 = 
EINVAL
;

921  
	`f‹r_£t_št
(
f‹r
, &f‹r->
dpÜt
, dport);

922 
	}
}

924 
	$£aud™_f‹r_g‘_dpÜt
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

926 ià(
f‹r
 =ğ
NULL
) {

927 
”ºo
 = 
EINVAL
;

930  
f‹r
->
dpÜt
;

931 
	}
}

933 
	$f‹r_£t_pÜt_v”s_4_2
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
pÜt
)

935 ià(
f‹r
 =ğ
NULL
) {

936 
”ºo
 = 
EINVAL
;

939  
	`f‹r_£t_št
(
f‹r
, &f‹r->
pÜt
,…ort);

940 
	}
}

942 
	$f‹r_g‘_pÜt_v”s_4_2
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

944 ià(
f‹r
 =ğ
NULL
) {

945 
”ºo
 = 
EINVAL
;

948  
f‹r
->
pÜt
;

949 
	}
}

951 #ià
LINK_SHARED
 == 1

952 
__asm__
(".symver filter_set_port_vers_4_2,seaudit_filter_set_port@@VERS_4.2");

953 
__asm__
(".symver filter_get_port_vers_4_2,seaudit_filter_get_port@@VERS_4.2");

956 
	$£aud™_f‹r_£t_key
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
key
)

958 ià(
f‹r
 =ğ
NULL
) {

959 
”ºo
 = 
EINVAL
;

962  
	`f‹r_£t_št
(
f‹r
, &f‹r->
key
, key);

963 
	}
}

965 
	$£aud™_f‹r_g‘_key
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

967 ià(
f‹r
 =ğ
NULL
) {

968 
”ºo
 = 
EINVAL
;

971  
f‹r
->
key
;

972 
	}
}

974 
	$£aud™_f‹r_£t_ÿp
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
ÿp
)

976 ià(
f‹r
 =ğ
NULL
) {

977 
”ºo
 = 
EINVAL
;

980  
	`f‹r_£t_št
(
f‹r
, &f‹r->
ÿp
, cap);

981 
	}
}

983 
	$£aud™_f‹r_g‘_ÿp
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

985 ià(
f‹r
 =ğ
NULL
) {

986 
”ºo
 = 
EINVAL
;

989  
f‹r
->
ÿp
;

990 
	}
}

992 
	$£aud™_f‹r_£t_Ãtif
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ *
Ãtif
)

994 ià(
f‹r
 =ğ
NULL
) {

995 
”ºo
 = 
EINVAL
;

998  
	`f‹r_£t_¡ršg
(
f‹r
, &f‹r->
Ãtif
,‚etif);

999 
	}
}

1001 cÚ¡ *
	$£aud™_f‹r_g‘_Ãtif
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

1003 ià(
f‹r
 =ğ
NULL
) {

1004 
”ºo
 = 
EINVAL
;

1005  
NULL
;

1007  
f‹r
->
Ãtif
;

1008 
	}
}

1010 
	$£aud™_f‹r_£t_mes§ge_ty³
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
£aud™_avc_mes§ge_ty³_e
 
mes§ge_ty³
)

1012 ià(
f‹r
 =ğ
NULL
) {

1013 
”ºo
 = 
EINVAL
;

1016 
f‹r
->
avc_msg_ty³
 = 
mes§ge_ty³
;

1017 ià(
f‹r
->
mod–
 !ğ
NULL
) {

1018 
	`mod–_nÙify_f‹r_chªged
(
f‹r
->
mod–
, filter);

1021 
	}
}

1023 
£aud™_avc_mes§ge_ty³_e
 
	$£aud™_f‹r_g‘_mes§ge_ty³
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
)

1025 ià(
f‹r
 =ğ
NULL
) {

1026 
”ºo
 = 
EINVAL
;

1027  
SEAUDIT_AVC_UNKNOWN
;

1029  
f‹r
->
avc_msg_ty³
;

1030 
	}
}

1032 
	$£aud™_f‹r_£t_d©e
(
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
tm
 *
¡¬t
, cÚ¡ tm *
’d
,

1033 
£aud™_f‹r_d©e_m©ch_e
 
d©e_m©ch
)

1035 
tm
 *
Ãw_tm
 = 
NULL
;

1036 ià(
f‹r
 =ğ
NULL
) {

1037 
”ºo
 = 
EINVAL
;

1044 ià(
f‹r
->
¡¬t
 != start) {

1045 
Ãw_tm
 = 
NULL
;

1046 ià(
¡¬t
 !ğ
NULL
) {

1047 ià((
Ãw_tm
 = 
	`ÿÎoc
(1, (*Ãw_tm))è=ğ
NULL
) {

1050 
	`memıy
(
Ãw_tm
, 
¡¬t
, (*start));

1052 
	`ä“
(
f‹r
->
¡¬t
);

1053 
f‹r
->
¡¬t
 = 
Ãw_tm
;

1055 ià(
¡¬t
 !ğ
NULL
) {

1056 ià(
f‹r
->
’d
 !=ƒnd) {

1057 
Ãw_tm
 = 
NULL
;

1058 ià(
’d
 !ğ
NULL
) {

1059 ià((
Ãw_tm
 = 
	`ÿÎoc
(1, (*Ãw_tm))è=ğ
NULL
) {

1062 
	`memıy
(
Ãw_tm
, 
’d
, (*end));

1064 
	`ä“
(
f‹r
->
’d
);

1065 
f‹r
->
’d
 = 
Ãw_tm
;

1068 
	`ä“
(
f‹r
->
’d
);

1069 
f‹r
->
’d
 = 
NULL
;

1071 
f‹r
->
d©e_m©ch
 = date_match;

1072 ià(
f‹r
->
mod–
 !ğ
NULL
) {

1073 
	`mod–_nÙify_f‹r_chªged
(
f‹r
->
mod–
, filter);

1076 
	}
}

1078 
	$£aud™_f‹r_g‘_d©e
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
tm
 **
¡¬t
, cÚ¡ tm **
’d
,

1079 
£aud™_f‹r_d©e_m©ch_e
 * 
m©ch
)

1081 ià(
¡¬t
 !ğ
NULL
) {

1082 *
¡¬t
 = 
NULL
;

1084 ià(
’d
 !ğ
NULL
) {

1085 *
’d
 = 
NULL
;

1087 ià(
m©ch
 !ğ
NULL
) {

1088 *
m©ch
 = 
SEAUDIT_FILTER_DATE_MATCH_BEFORE
;

1090 ià(
f‹r
 =ğ
NULL
 || 
¡¬t
 =ğNULL || 
’d
 =ğNULL || 
m©ch
 == NULL) {

1091 
”ºo
 = 
EINVAL
;

1094 *
¡¬t
 = 
f‹r
->start;

1095 *
’d
 = 
f‹r
->end;

1096 *
m©ch
 = 
f‹r
->
d©e_m©ch
;

1097 
	}
}

1099 
	$£aud™_f‹r_§ve_to_fe
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ *
f’ame
)

1101 
FILE
 *
fe
;

1102 cÚ¡ *
XML_VER
 = "<?xml version=\"1.0\"?>\n";

1104 ià(
f‹r
 =ğ
NULL
 || 
f’ame
 == NULL) {

1105 
”ºo
 = 
EINVAL
;

1108 ià((
fe
 = 
	`fİ’
(
f’ame
, "w")è=ğ
NULL
) {

1111 
	`årštf
(
fe
, 
XML_VER
);

1112 
	`årštf
(
fe
, "<v›w xmÊs=\"h‰p://oss.Œesys.com/´ojeùs/£toŞs/£aud™-%s/\">\n", 
FILTER_FILE_FORMAT_VERSION
);

1113 
	`f‹r_­³nd_to_fe
(
f‹r
, 
fe
, 1);

1114 
	`årštf
(
fe
, "</view>\n");

1115 
	`fşo£
(
fe
);

1117 
	}
}

1121 
	$f‹r_£t_mod–
(
£aud™_f‹r_t
 * 
f‹r
, 
£aud™_mod–_t
 * 
mod–
)

1123 
f‹r
->
mod–
 = model;

1124 
	}
}

	@libseaudit/src/load_message.c

25 
	~"£aud™_š‹º®.h
"

27 
	~<”ºo.h
>

28 
	~<¡dio.h
>

29 
	~<¡dlib.h
>

33 
£aud™_lßd_mes§ge_t
 *
	$lßd_mes§ge_ü—‹
()

35  
	`ÿÎoc
(1, (
£aud™_lßd_mes§ge_t
));

36 
	}
}

38 
	$lßd_mes§ge_ä“
(
£aud™_lßd_mes§ge_t
 * 
msg
)

40 ià(
msg
 !ğ
NULL
) {

41 
	`ä“
(
msg
->
bš¬y
);

42 
	`ä“
(
msg
);

44 
	}
}

46 *
	$lßd_mes§ge_to_¡ršg
(cÚ¡ 
£aud™_mes§ge_t
 * 
msg
, cÚ¡ *
d©e
)

48 
£aud™_lßd_mes§ge_t
 *
lßd
 = 
msg
->
d©a
.load;

49 cÚ¡ *
ho¡
 = 
msg
->host;

50 cÚ¡ *
mªag”
 = 
msg
->manager;

51 *
s
 = 
NULL
;

52 ià(
	`a¥rštf
(&
s
,

55 
d©e
, 
ho¡
, 
mªag”
, 
lßd
->
u£rs
,†ßd->
rŞes
,†ßd->
ty³s
,†ßd->
boŞs
, d©e, ho¡, mªag”,†ßd->
şas£s
,

56 
lßd
->
ruËs
) < 0) {

57  
NULL
;

59  
s
;

60 
	}
}

62 *
	$lßd_mes§ge_to_¡ršg_html
(cÚ¡ 
£aud™_mes§ge_t
 * 
msg
, cÚ¡ *
d©e
)

64 
£aud™_lßd_mes§ge_t
 *
lßd
 = 
msg
->
d©a
.load;

65 cÚ¡ *
ho¡
 = 
msg
->host;

66 cÚ¡ *
mªag”
 = 
msg
->manager;

67 *
s
 = 
NULL
;

68 ià(
	`a¥rštf
(&
s
,

75 
d©e
, 
ho¡
, 
mªag”
, 
lßd
->
u£rs
,†ßd->
rŞes
,†ßd->
ty³s
,†ßd->
boŞs
, d©e, ho¡, mªag”,†ßd->
şas£s
,

76 
lßd
->
ruËs
) < 0) {

77  
NULL
;

79  
s
;

80 
	}
}

82 *
	$lßd_mes§ge_to_misc_¡ršg
(cÚ¡ 
£aud™_lßd_mes§ge_t
 * 
lßd
)

84 *
s
 = 
NULL
;

85 ià(
	`a¥rštf
(&
s
,

87 
lßd
->
u£rs
,†ßd->
rŞes
,†ßd->
ty³s
,†ßd->
boŞs
,†ßd->
şas£s
,†ßd->
ruËs
) < 0) {

88  
NULL
;

90  
s
;

91 
	}
}

	@libseaudit/src/log.c

26 
	~"£aud™_š‹º®.h
"

28 
	~<­Ş/ut.h
>

30 
	~<”ºo.h
>

31 
	~<¡d¬g.h
>

32 
	~<¡dio.h
>

33 
	~<¡dlib.h
>

34 
	~<¡ršg.h
>

36 
£aud™_log_t
 *
	$£aud™_log_ü—‹
(
£aud™_hªdË_â_t
 
â
, *
ÿÎback_¬g
)

38 
£aud™_log_t
 *
log
 = 
NULL
;

39 
”rÜ
;

40 ià((
log
 = 
	`ÿÎoc
(1, (*log))è=ğ
NULL
) {

41  
NULL
;

43 
log
->
â
 = fn;

44 
log
->
hªdË_¬g
 = 
ÿÎback_¬g
;

45 ià((
log
->
mes§ges
 = 
	`­Ş_veùÜ_ü—‹
(
mes§ge_ä“
)è=ğ
NULL
 ||

46 (
log
->
m®fÜmed_msgs
 = 
	`­Ş_veùÜ_ü—‹
(
ä“
)è=ğ
NULL
 ||

47 (
log
->
mod–s
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)) == NULL ||

48 (
log
->
ty³s
 = 
	`­Ş_b¡_ü—‹
(
­Ş_¡r_¡rcmp
, 
ä“
)è=ğ
NULL
 ||

49 (
log
->
şas£s
 = 
	`­Ş_b¡_ü—‹
(
­Ş_¡r_¡rcmp
, 
ä“
)è=ğ
NULL
 ||

50 (
log
->
rŞes
 = 
	`­Ş_b¡_ü—‹
(
­Ş_¡r_¡rcmp
, 
ä“
)è=ğ
NULL
 ||

51 (
log
->
u£rs
 = 
	`­Ş_b¡_ü—‹
(
­Ş_¡r_¡rcmp
, 
ä“
)è=ğ
NULL
 ||

52 (
log
->
³rms
 = 
	`­Ş_b¡_ü—‹
(
­Ş_¡r_¡rcmp
, 
ä“
)è=ğ
NULL
 ||

53 (
log
->
mls_lvl
 = 
	`­Ş_b¡_ü—‹
(
­Ş_¡r_¡rcmp
, 
ä“
)è=ğ
NULL
 ||

54 (
log
->
mls_şr
 = 
	`­Ş_b¡_ü—‹
(
­Ş_¡r_¡rcmp
, 
ä“
)è=ğ
NULL
 ||

55 (
log
->
ho¡s
 = 
	`­Ş_b¡_ü—‹
(
­Ş_¡r_¡rcmp
, 
ä“
)è=ğ
NULL


56 || (
log
->
boŞs
 = 
	`­Ş_b¡_ü—‹
(
­Ş_¡r_¡rcmp
, 
ä“
)è=ğ
NULL


57 || (
log
->
mªag”s
 = 
	`­Ş_b¡_ü—‹
(
­Ş_¡r_¡rcmp
, 
ä“
)è=ğ
NULL
) {

58 
”rÜ
 = 
”ºo
;

59 
	`£aud™_log_de¡roy
(&
log
);

60 
”ºo
 = 
”rÜ
;

61  
NULL
;

63  
log
;

64 
	}
}

66 
	$£aud™_log_de¡roy
(
£aud™_log_t
 ** 
log
)

68 
size_t
 
i
;

69 ià(
log
 =ğ
NULL
 || *log == NULL) {

72 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
((*
log
)->
mod–s
); i++) {

73 
£aud™_mod–_t
 *
m
 = 
	`­Ş_veùÜ_g‘_–em’t
((*
log
)->
mod–s
, 
i
);

74 
	`mod–_»move_log
(
m
, *
log
);

76 
	`­Ş_veùÜ_de¡roy
(&(*
log
)->
mes§ges
);

77 
	`­Ş_veùÜ_de¡roy
(&(*
log
)->
m®fÜmed_msgs
);

78 
	`­Ş_veùÜ_de¡roy
(&(*
log
)->
mod–s
);

79 
	`­Ş_b¡_de¡roy
(&(*
log
)->
ty³s
);

80 
	`­Ş_b¡_de¡roy
(&(*
log
)->
şas£s
);

81 
	`­Ş_b¡_de¡roy
(&(*
log
)->
rŞes
);

82 
	`­Ş_b¡_de¡roy
(&(*
log
)->
u£rs
);

83 
	`­Ş_b¡_de¡roy
(&(*
log
)->
³rms
);

84 
	`­Ş_b¡_de¡roy
(&(*
log
)->
ho¡s
);

85 
	`­Ş_b¡_de¡roy
(&(*
log
)->
boŞs
);

86 
	`­Ş_b¡_de¡roy
(&(*
log
)->
mªag”s
);

87 
	`­Ş_b¡_de¡roy
(&(*
log
)->
mls_lvl
);

88 
	`­Ş_b¡_de¡roy
(&(*
log
)->
mls_şr
);

89 
	`ä“
(*
log
);

90 *
log
 = 
NULL
;

91 
	}
}

93 
	$£aud™_log_ş—r
(
£aud™_log_t
 * 
log
)

95 ià(
log
 =ğ
NULL
) {

96 
”ºo
 = 
EINVAL
;

99 
	`­Ş_veùÜ_de¡roy
(&
log
->
mes§ges
);

100 
	`­Ş_veùÜ_de¡roy
(&
log
->
m®fÜmed_msgs
);

101 
	`­Ş_b¡_de¡roy
(&
log
->
ty³s
);

102 
	`­Ş_b¡_de¡roy
(&
log
->
şas£s
);

103 
	`­Ş_b¡_de¡roy
(&
log
->
rŞes
);

104 
	`­Ş_b¡_de¡roy
(&
log
->
u£rs
);

105 
	`­Ş_b¡_de¡roy
(&
log
->
³rms
);

106 
	`­Ş_b¡_de¡roy
(&
log
->
ho¡s
);

107 
	`­Ş_b¡_de¡roy
(&
log
->
boŞs
);

108 
	`­Ş_b¡_de¡roy
(&
log
->
mªag”s
);

109 
	`­Ş_b¡_de¡roy
(&
log
->
mls_lvl
);

110 
	`­Ş_b¡_de¡roy
(&
log
->
mls_şr
);

111 ià((
log
->
mes§ges
 = 
	`­Ş_veùÜ_ü—‹
(
mes§ge_ä“
)è=ğ
NULL
 ||

112 (
log
->
m®fÜmed_msgs
 = 
	`­Ş_veùÜ_ü—‹
(
ä“
)è=ğ
NULL
 ||

113 (
log
->
ty³s
 = 
	`­Ş_b¡_ü—‹
(
­Ş_¡r_¡rcmp
, 
ä“
)è=ğ
NULL
 ||

114 (
log
->
şas£s
 = 
	`­Ş_b¡_ü—‹
(
­Ş_¡r_¡rcmp
, 
ä“
)è=ğ
NULL
 ||

115 (
log
->
rŞes
 = 
	`­Ş_b¡_ü—‹
(
­Ş_¡r_¡rcmp
, 
ä“
)è=ğ
NULL
 ||

116 (
log
->
u£rs
 = 
	`­Ş_b¡_ü—‹
(
­Ş_¡r_¡rcmp
, 
ä“
)è=ğ
NULL
 ||

117 (
log
->
³rms
 = 
	`­Ş_b¡_ü—‹
(
­Ş_¡r_¡rcmp
, 
ä“
)è=ğ
NULL
 ||

118 (
log
->
mls_lvl
 = 
	`­Ş_b¡_ü—‹
(
­Ş_¡r_¡rcmp
, 
ä“
)è=ğ
NULL
 ||

119 (
log
->
mls_şr
 = 
	`­Ş_b¡_ü—‹
(
­Ş_¡r_¡rcmp
, 
ä“
)è=ğ
NULL
 ||

120 (
log
->
ho¡s
 = 
	`­Ş_b¡_ü—‹
(
­Ş_¡r_¡rcmp
, 
ä“
)è=ğ
NULL


121 || (
log
->
boŞs
 = 
	`­Ş_b¡_ü—‹
(
­Ş_¡r_¡rcmp
, 
ä“
)è=ğ
NULL


122 || (
log
->
mªag”s
 = 
	`­Ş_b¡_ü—‹
(
­Ş_¡r_¡rcmp
, 
ä“
)è=ğ
NULL
) {

126 
size_t
 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
log
->
mod–s
); i++) {

127 
£aud™_mod–_t
 *
m
 = 
	`­Ş_veùÜ_g‘_–em’t
(
log
->
mod–s
, 
i
);

128 
	`mod–_nÙify_log_chªged
(
m
, 
log
);

130 
	}
}

132 
­Ş_veùÜ_t
 *
	$£aud™_log_g‘_u£rs
(cÚ¡ 
£aud™_log_t
 * 
log
)

134 ià(
log
 =ğ
NULL
) {

135 
”ºo
 = 
EINVAL
;

136  
NULL
;

138  
	`­Ş_b¡_g‘_veùÜ
(
log
->
u£rs
, 0);

139 
	}
}

141 
­Ş_veùÜ_t
 *
	$£aud™_log_g‘_rŞes
(cÚ¡ 
£aud™_log_t
 * 
log
)

143 ià(
log
 =ğ
NULL
) {

144 
”ºo
 = 
EINVAL
;

145  
NULL
;

147  
	`­Ş_b¡_g‘_veùÜ
(
log
->
rŞes
, 0);

148 
	}
}

150 
­Ş_veùÜ_t
 *
	$£aud™_log_g‘_ty³s
(cÚ¡ 
£aud™_log_t
 * 
log
)

152 ià(
log
 =ğ
NULL
) {

153 
”ºo
 = 
EINVAL
;

154  
NULL
;

156  
	`­Ş_b¡_g‘_veùÜ
(
log
->
ty³s
, 0);

157 
	}
}

159 
­Ş_veùÜ_t
 *
	$£aud™_log_g‘_mls_lvl
(cÚ¡ 
£aud™_log_t
 * 
log
)

161 ià(
log
 =ğ
NULL
) {

162 
”ºo
 = 
EINVAL
;

163  
NULL
;

165  
	`­Ş_b¡_g‘_veùÜ
(
log
->
mls_lvl
, 0);

166 
	}
}

168 
­Ş_veùÜ_t
 *
	$£aud™_log_g‘_mls_şr
(cÚ¡ 
£aud™_log_t
 * 
log
)

170 ià(
log
 =ğ
NULL
) {

171 
”ºo
 = 
EINVAL
;

172  
NULL
;

174  
	`­Ş_b¡_g‘_veùÜ
(
log
->
mls_şr
, 0);

175 
	}
}

177 
­Ş_veùÜ_t
 *
	$£aud™_log_g‘_şas£s
(cÚ¡ 
£aud™_log_t
 * 
log
)

179 ià(
log
 =ğ
NULL
) {

180 
”ºo
 = 
EINVAL
;

181  
NULL
;

183  
	`­Ş_b¡_g‘_veùÜ
(
log
->
şas£s
, 0);

184 
	}
}

188 
	$log_­³nd_mod–
(
£aud™_log_t
 * 
log
, 
£aud™_mod–_t
 * 
mod–
)

190 ià(
	`­Ş_veùÜ_­³nd
(
log
->
mod–s
, 
mod–
) < 0) {

191 
”rÜ
 = 
”ºo
;

192 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
”rÜ
));

193 
”ºo
 = 
”rÜ
;

197 
	}
}

199 
	$log_»move_mod–
(
£aud™_log_t
 * 
log
, 
£aud™_mod–_t
 * 
mod–
)

201 
size_t
 
i
;

202 ià(
	`­Ş_veùÜ_g‘_šdex
(
log
->
mod–s
, 
mod–
, 
NULL
, NULL, &
i
) == 0) {

203 
	`­Ş_veùÜ_»move
(
log
->
mod–s
, 
i
);

205 
	}
}

207 cÚ¡ 
­Ş_veùÜ_t
 *
	$log_g‘_mes§ges
(cÚ¡ 
£aud™_log_t
 * 
log
)

209  
log
->
mes§ges
;

210 
	}
}

212 cÚ¡ 
­Ş_veùÜ_t
 *
	$log_g‘_m®fÜmed_mes§ges
(cÚ¡ 
£aud™_log_t
 * 
log
)

214  
log
->
m®fÜmed_msgs
;

215 
	}
}

217 
£aud™_hªdË_deçuÉ_ÿÎback
(*
¬g
 
__©Œibu‹__
 ((
unu£d
)),

218 cÚ¡ 
£aud™_log_t
 * 
log
 
__©Œibu‹__
 ((
unu£d
)),

219 
Ëv–
, cÚ¡ *
fmt
, 
va_li¡
 
va_¬gs
)

221 
	gËv–
) {

222 
	gSEAUDIT_MSG_INFO
:

227 
	gSEAUDIT_MSG_WARN
:

229 
årštf
(
¡d”r
, "WARNING: ");

232 
	gSEAUDIT_MSG_ERR
:

235 
årštf
(
¡d”r
, "ERROR: ");

239 
vårštf
(
¡d”r
, 
fmt
, 
va_¬gs
);

240 
årštf
(
¡d”r
, "\n");

243 
	$£aud™_hªdË_msg
(cÚ¡ 
£aud™_log_t
 * 
log
, 
Ëv–
, cÚ¡ *
fmt
, ...)

245 
va_li¡
 
­
;

246 
	`va_¡¬t
(
­
, 
fmt
);

247 ià(
log
 =ğ
NULL
 ||†og->
â
 == NULL) {

248 
	`£aud™_hªdË_deçuÉ_ÿÎback
(
NULL
, NULL, 
Ëv–
, 
fmt
, 
­
);

250 
log
->
	`â
Öog->
hªdË_¬g
,†og, 
Ëv–
, 
fmt
, 
­
);

252 
	`va_’d
(
­
);

253 
	}
}

	@libseaudit/src/message.c

26 
	~"£aud™_š‹º®.h
"

28 
	~<as£¹.h
>

29 
	~<”ºo.h
>

30 
	~<¡dlib.h
>

31 
	~<¡ršg.h
>

32 
	~<time.h
>

34 *
	$£aud™_mes§ge_g‘_d©a
(cÚ¡ 
£aud™_mes§ge_t
 * 
msg
, 
£aud™_mes§ge_ty³_e
 * 
ty³
)

36 ià(
ty³
 !ğ
NULL
) {

37 *
ty³
 = 
SEAUDIT_MESSAGE_TYPE_INVALID
;

39 ià(
msg
 =ğ
NULL
 || 
ty³
 =ğNULL || msg->ty³ =ğ
SEAUDIT_MESSAGE_TYPE_INVALID
) {

40 
”ºo
 = 
EINVAL
;

41  
NULL
;

43 (*
ty³
 = 
msg
->type)) {

44 
SEAUDIT_MESSAGE_TYPE_AVC
:

45  
msg
->
d©a
.
avc
;

46 
SEAUDIT_MESSAGE_TYPE_BOOL
:

47  
msg
->
d©a
.
boŞm
;

48 
SEAUDIT_MESSAGE_TYPE_LOAD
:

49  
msg
->
d©a
.
lßd
;

51 
”ºo
 = 
EINVAL
;

52  
NULL
;

54 
	}
}

56 cÚ¡ 
tm
 *
	$£aud™_mes§ge_g‘_time
(cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

58 ià(!
msg
) {

59 
”ºo
 = 
EINVAL
;

60  
NULL
;

62  
msg
->
d©e_¡amp
;

63 
	}
}

65 cÚ¡ *
	$£aud™_mes§ge_g‘_ho¡
(cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

67 ià(!
msg
) {

68 
”ºo
 = 
EINVAL
;

69  
NULL
;

71  
msg
->
ho¡
;

72 
	}
}

74 
	#DATE_STR_SIZE
 256

	)

76 *
	$£aud™_mes§ge_to_¡ršg
(cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

78 
d©e
[
DATE_STR_SIZE
];

79 ià(
msg
 =ğ
NULL
) {

80 
”ºo
 = 
EINVAL
;

81  
NULL
;

83 
	`¡ráime
(
d©e
, 
DATE_STR_SIZE
, "%b %d %H:%M:%S", 
msg
->
d©e_¡amp
);

84 
msg
->
ty³
) {

85 
SEAUDIT_MESSAGE_TYPE_AVC
:

86  
	`avc_mes§ge_to_¡ršg
(
msg
, 
d©e
);

87 
SEAUDIT_MESSAGE_TYPE_BOOL
:

88  
	`boŞ_mes§ge_to_¡ršg
(
msg
, 
d©e
);

89 
SEAUDIT_MESSAGE_TYPE_LOAD
:

90  
	`lßd_mes§ge_to_¡ršg
(
msg
, 
d©e
);

92 
”ºo
 = 
EINVAL
;

93  
NULL
;

95 
	}
}

97 *
	$£aud™_mes§ge_to_¡ršg_html
(cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

99 
d©e
[
DATE_STR_SIZE
];

100 ià(
msg
 =ğ
NULL
) {

101 
”ºo
 = 
EINVAL
;

102  
NULL
;

104 
	`¡ráime
(
d©e
, 
DATE_STR_SIZE
, "%b %d %H:%M:%S", 
msg
->
d©e_¡amp
);

105 
msg
->
ty³
) {

106 
SEAUDIT_MESSAGE_TYPE_AVC
:

107  
	`avc_mes§ge_to_¡ršg_html
(
msg
, 
d©e
);

108 
SEAUDIT_MESSAGE_TYPE_BOOL
:

109  
	`boŞ_mes§ge_to_¡ršg_html
(
msg
, 
d©e
);

110 
SEAUDIT_MESSAGE_TYPE_LOAD
:

111  
	`lßd_mes§ge_to_¡ršg_html
(
msg
, 
d©e
);

113 
”ºo
 = 
EINVAL
;

114  
NULL
;

116 
	}
}

118 *
	$£aud™_mes§ge_to_misc_¡ršg
(cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

120 ià(
msg
 =ğ
NULL
) {

121 
”ºo
 = 
EINVAL
;

122  
NULL
;

124 
msg
->
ty³
) {

125 
SEAUDIT_MESSAGE_TYPE_AVC
:

126  
	`avc_mes§ge_to_misc_¡ršg
(
msg
->
d©a
.
avc
);

127 
SEAUDIT_MESSAGE_TYPE_BOOL
:

128  
	`boŞ_mes§ge_to_misc_¡ršg
(
msg
->
d©a
.
boŞm
);

129 
SEAUDIT_MESSAGE_TYPE_LOAD
:

130  
	`lßd_mes§ge_to_misc_¡ršg
(
msg
->
d©a
.
lßd
);

132 
”ºo
 = 
EINVAL
;

133  
NULL
;

135 
	}
}

139 
£aud™_mes§ge_t
 *
	$mes§ge_ü—‹
(
£aud™_log_t
 * 
log
, 
£aud™_mes§ge_ty³_e
 
ty³
)

141 
£aud™_mes§ge_t
 *
m
;

142 
”rÜ
, 
¹
 = 0;

143 ià(
ty³
 =ğ
SEAUDIT_MESSAGE_TYPE_INVALID
) {

144 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
EINVAL
));

145 
”ºo
 = 
EINVAL
;

146  
NULL
;

148 ià((
m
 = 
	`ÿÎoc
(1, (*m))è=ğ
NULL
 || 
	`­Ş_veùÜ_­³nd
(
log
->
mes§ges
, m) < 0) {

149 
”rÜ
 = 
”ºo
;

150 
	`mes§ge_ä“
(
m
);

151 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
”rÜ
));

152 
”ºo
 =ƒrrno;

153  
NULL
;

155 
m
->
ty³
 =ype;

156 
m
->
ty³
) {

157 
SEAUDIT_MESSAGE_TYPE_AVC
:

158 ià((
m
->
d©a
.
avc
 = 
	`avc_mes§ge_ü—‹
()è=ğ
NULL
) {

159 
¹
 = -1;

162 
SEAUDIT_MESSAGE_TYPE_BOOL
:

163 ià((
m
->
d©a
.
boŞm
 = 
	`boŞ_mes§ge_ü—‹
()è=ğ
NULL
) {

164 
¹
 = -1;

167 
SEAUDIT_MESSAGE_TYPE_LOAD
:

168 ià((
m
->
d©a
.
lßd
 = 
	`lßd_mes§ge_ü—‹
()è=ğ
NULL
) {

169 
¹
 = -1;

173 
	`as£¹
(0);

175 ià(
¹
 < 0) {

176 
”rÜ
 = 
”ºo
;

177 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
”rÜ
));

178 
”ºo
 =ƒrrno;

179  
NULL
;

181  
m
;

182 
	}
}

184 
	$mes§ge_ä“
(*
msg
)

186 ià(
msg
 !ğ
NULL
) {

187 
£aud™_mes§ge_t
 *
m
 = (£aud™_mes§ge_ˆ*è
msg
;

188 
	`ä“
(
m
->
d©e_¡amp
);

189 
m
->
ty³
) {

190 
SEAUDIT_MESSAGE_TYPE_AVC
:

191 
	`avc_mes§ge_ä“
(
m
->
d©a
.
avc
);

193 
SEAUDIT_MESSAGE_TYPE_BOOL
:

194 
	`boŞ_mes§ge_ä“
(
m
->
d©a
.
boŞm
);

196 
SEAUDIT_MESSAGE_TYPE_LOAD
:

197 
	`lßd_mes§ge_ä“
(
m
->
d©a
.
lßd
);

202 
	`ä“
(
m
);

204 
	}
}

	@libseaudit/src/model.c

25 
	~"£aud™_š‹º®.h
"

27 
	~<­Ş/b¡.h
>

28 
	~<”ºo.h
>

29 
	~<¡dlib.h
>

30 
	~<¡ršg.h
>

31 
	~<libxml/uri.h
>

33 
	#DEFAULT_MODEL_NAME
 "UÁ™Ëd"

	)

35 
	s£aud™_mod–


37 *
	mÇme
;

40 
­Ş_veùÜ_t
 *
	mlogs
;

43 
­Ş_veùÜ_t
 *
	mmes§ges
;

46 
­Ş_veùÜ_t
 *
	mm®fÜmed_mes§ges
;

48 
­Ş_b¡_t
 *
	mhidd’_mes§ges
;

50 
­Ş_veùÜ_t
 *
	mf‹rs
;

53 
£aud™_f‹r_m©ch_e
 
	mm©ch
;

56 
£aud™_f‹r_visibË_e
 
	mvisibË
;

58 
­Ş_veùÜ_t
 *
	msÜts
;

60 
size_t
 
	mnum_®lows
;

62 
size_t
 
	mnum_d’›s
;

64 
size_t
 
	mnum_boŞs
;

66 
size_t
 
	mnum_lßds
;

68 
	mdœty
;

79 
	$mod–_f‹r_mes§ge
(
£aud™_mod–_t
 * 
mod–
, cÚ¡ 
£aud™_mes§ge_t
 * 
m
)

81 
size_t
 
i
;

82 
compv®
, 
f‹rs_·s£d
 = 0;

83 ià(
	`­Ş_veùÜ_g‘_size
(
mod–
->
f‹rs
) == 0) {

86 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
mod–
->
f‹rs
); i++) {

87 
£aud™_f‹r_t
 *
f
 = 
	`­Ş_veùÜ_g‘_–em’t
(
mod–
->
f‹rs
, 
i
);

88 
compv®
 = 
	`f‹r_is_acû±ed
(
f
, 
m
);

89 ià(
compv®
) {

90 ià(
mod–
->
m©ch
 =ğ
SEAUDIT_FILTER_MATCH_ANY
) {

93 
f‹rs_·s£d
++;

95 ià(
mod–
->
m©ch
 =ğ
SEAUDIT_FILTER_MATCH_ALL
) {

100 ià(
mod–
->
m©ch
 =ğ
SEAUDIT_FILTER_MATCH_ANY
) {

105 ià(
f‹rs_·s£d
) {

109 
	}
}

121 
	$mes§ge_comp
(cÚ¡ *
a
, cÚ¡ *
b
, *
d©a
)

123 cÚ¡ 
£aud™_mes§ge_t
 *
m1
 = 
a
;

124 cÚ¡ 
£aud™_mes§ge_t
 *
m2
 = 
b
;

125 
£aud™_mod–_t
 *
mod–
 = 
d©a
;

126 
size_t
 
i
;

127 
£aud™_sÜt_t
 *
s
;

128 
compv®
, 
s1
, 
s2
;

129 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
mod–
->
sÜts
); i++) {

130 
s
 = 
	`­Ş_veùÜ_g‘_–em’t
(
mod–
->
sÜts
, 
i
);

131 
s1
 = 
	`sÜt_is_suµÜ‹d
(
s
, 
m1
);

132 
s2
 = 
	`sÜt_is_suµÜ‹d
(
s
, 
m2
);

133 ià(!
s1
 && !
s2
) {

136 ià(!
s2
) {

139 ià(!
s1
) {

142 ià((
compv®
 = 
	`sÜt_comp
(
s
, 
m1
, 
m2
)) != 0) {

143  
compv®
;

147 
	}
}

161 
	$mod–_sÜt
(cÚ¡ 
£aud™_log_t
 * 
log
, 
£aud™_mod–_t
 * 
mod–
)

163 
size_t
 
i
, 
j
, 
num_mes§ges
 = 
	`­Ş_veùÜ_g‘_size
(
mod–
->
mes§ges
);

164 
­Ş_veùÜ_t
 *
sup
 = 
NULL
, *
unsup
 = NULL;

165 
£aud™_mes§ge_t
 *
m
;

166 
£aud™_sÜt_t
 *
s
;

167 
suµÜ‹d
 = 0, 
»tv®
 = -1, 
”rÜ
 = 0;

168 ià(
	`­Ş_veùÜ_g‘_size
(
mod–
->
sÜts
) == 0) {

169 
»tv®
 = 0;

170 
ş—nup
;

173 ià((
sup
 = 
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(
num_mes§ges
, 
NULL
)) == NULL ||

174 (
unsup
 = 
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(
num_mes§ges
, 
NULL
)) == NULL) {

175 
”rÜ
 = 
”ºo
;

176 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
”rÜ
));

177 
ş—nup
;

179 
i
 = 0; i < 
num_mes§ges
; i++) {

180 
m
 = 
	`­Ş_veùÜ_g‘_–em’t
(
mod–
->
mes§ges
, 
i
);

181 
suµÜ‹d
 = 0;

182 
j
 = 0; j < 
	`­Ş_veùÜ_g‘_size
(
mod–
->
sÜts
); j++) {

183 
s
 = 
	`­Ş_veùÜ_g‘_–em’t
(
mod–
->
sÜts
, 
j
);

184 ià((
suµÜ‹d
 = 
	`sÜt_is_suµÜ‹d
(
s
, 
m
)) != 0) {

188 ià((
suµÜ‹d
 && 
	`­Ş_veùÜ_­³nd
(
sup
, 
m
è< 0è|| (!suµÜ‹d &&‡pŞ_veùÜ_­³nd(
unsup
, m) < 0)) {

189 
”rÜ
 = 
”ºo
;

190 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
”rÜ
));

191 
ş—nup
;

194 
	`­Ş_veùÜ_sÜt
(
sup
, 
mes§ge_comp
, 
mod–
);

195 ià(
	`­Ş_veùÜ_ÿt
(
sup
, 
unsup
) < 0) {

196 
”rÜ
 = 
”ºo
;

197 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
”rÜ
));

198 
ş—nup
;

200 
	`­Ş_veùÜ_de¡roy
(&
mod–
->
mes§ges
);

201 
mod–
->
mes§ges
 = 
sup
;

202 
sup
 = 
NULL
;

203 
»tv®
 = 0;

204 
ş—nup
:

205 
	`­Ş_veùÜ_de¡roy
(&
sup
);

206 
	`­Ş_veùÜ_de¡roy
(&
unsup
);

207 ià(
»tv®
 != 0) {

208 
”ºo
 = 
”rÜ
;

210  
»tv®
;

211 
	}
}

219 
	$mod–_»ÿlc_¡©s
(
£aud™_mod–_t
 * 
mod–
)

221 
size_t
 
i
;

222 
£aud™_mes§ge_t
 *
msg
;

223 
£aud™_mes§ge_ty³_e
 
ty³
;

224 *
v
;

225 
£aud™_avc_mes§ge_t
 *
avc
;

226 
mod–
->
num_®lows
 = mod–->
num_d’›s
 = mod–->
num_boŞs
 = mod–->
num_lßds
 = 0;

227 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
mod–
->
mes§ges
); i++) {

228 
msg
 = 
	`­Ş_veùÜ_g‘_–em’t
(
mod–
->
mes§ges
, 
i
);

229 
v
 = 
	`£aud™_mes§ge_g‘_d©a
(
msg
, &
ty³
);

230 ià(
ty³
 =ğ
SEAUDIT_MESSAGE_TYPE_AVC
) {

231 
avc
 = (
£aud™_avc_mes§ge_t
 *è
v
;

232 ià(
avc
->
msg
 =ğ
SEAUDIT_AVC_DENIED
) {

233 
mod–
->
num_d’›s
++;

234 } ià(
avc
->
msg
 =ğ
SEAUDIT_AVC_GRANTED
) {

235 
mod–
->
num_®lows
++;

237 } ià(
ty³
 =ğ
SEAUDIT_MESSAGE_TYPE_BOOL
) {

238 
mod–
->
num_boŞs
++;

239 } ià(
ty³
 =ğ
SEAUDIT_MESSAGE_TYPE_LOAD
) {

240 
mod–
->
num_lßds
++;

243 
	}
}

255 
	$mod–_»äesh
(cÚ¡ 
£aud™_log_t
 * 
log
, 
£aud™_mod–_t
 * 
mod–
)

257 
size_t
 
i
, 
j
;

258 
£aud™_log_t
 *
l
;

259 cÚ¡ 
­Ş_veùÜ_t
 *
v
;

260 
£aud™_mes§ge_t
 *
mes§ge
;

261 *
»suÉ
;

262 
”rÜ
, 
f‹r_m©ch
;

264 ià(!
mod–
->
dœty
) {

267 
	`­Ş_veùÜ_de¡roy
(&
mod–
->
mes§ges
);

268 
	`­Ş_veùÜ_de¡roy
(&
mod–
->
m®fÜmed_mes§ges
);

269 ià((
mod–
->
mes§ges
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)è=ğNULL || (mod–->
m®fÜmed_mes§ges
 =‡pol_vector_create(NULL)) == NULL) {

270 
”rÜ
 = 
”ºo
;

271 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
”rÜ
));

272 
”ºo
 = 
”rÜ
;

275 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
mod–
->
logs
); i++) {

276 
l
 = 
	`­Ş_veùÜ_g‘_–em’t
(
mod–
->
logs
, 
i
);

277 
v
 = 
	`log_g‘_mes§ges
(
l
);

278 
j
 = 0; j < 
	`­Ş_veùÜ_g‘_size
(
v
); j++) {

279 
mes§ge
 = 
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
j
);

280 ià(
	`­Ş_b¡_g‘_–em’t
(
mod–
->
hidd’_mes§ges
, 
mes§ge
, 
NULL
, &
»suÉ
) == 0) {

283 
f‹r_m©ch
 = 
	`mod–_f‹r_mes§ge
(
mod–
, 
mes§ge
);

284 ià(((
f‹r_m©ch
 && 
mod–
->
visibË
 =ğ
SEAUDIT_FILTER_VISIBLE_SHOW
) ||

285 (!
f‹r_m©ch
 && 
mod–
->
visibË
 =ğ
SEAUDIT_FILTER_VISIBLE_HIDE
)) &&

286 
	`­Ş_veùÜ_­³nd
(
mod–
->
mes§ges
, 
mes§ge
) < 0) {

287 
”rÜ
 = 
”ºo
;

288 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
”rÜ
));

289 
”ºo
 = 
”rÜ
;

293 
v
 = 
	`log_g‘_m®fÜmed_mes§ges
(
l
);

294 ià(
	`­Ş_veùÜ_ÿt
(
mod–
->
m®fÜmed_mes§ges
, 
v
) < 0) {

295 
”rÜ
 = 
”ºo
;

296 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
”rÜ
));

297 
”ºo
 = 
”rÜ
;

301 ià(
	`mod–_sÜt
(
log
, 
mod–
) < 0) {

304 
	`mod–_»ÿlc_¡©s
(
mod–
);

305 
mod–
->
dœty
 = 0;

307 
	}
}

314 
	$f‹r_ä“
(*
v
)

316 
£aud™_f‹r_t
 *
f
 = 
v
;

317 
	`£aud™_f‹r_de¡roy
(&
f
);

318 
	}
}

325 
	$sÜt_ä“
(*
v
)

327 
£aud™_sÜt_t
 *
sÜt
 = 
v
;

328 
	`£aud™_sÜt_de¡roy
(&
sÜt
);

329 
	}
}

331 
£aud™_mod–_t
 *
	$£aud™_mod–_ü—‹
(cÚ¡ *
Çme
, 
£aud™_log_t
 * 
log
)

333 
£aud™_mod–_t
 *
m
 = 
NULL
;

334 
”rÜ
;

335 ià((
m
 = 
	`ÿÎoc
(1, (*m))è=ğ
NULL
) {

336 
”rÜ
 = 
”ºo
;

337 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
”rÜ
));

338 
”ºo
 = 
”rÜ
;

339  
NULL
;

341 ià(
Çme
 =ğ
NULL
) {

342 
Çme
 = 
DEFAULT_MODEL_NAME
;

344 ià((
m
->
Çme
 = 
	`¡rdup
Òame)è=ğ
NULL
 ||

345 (
m
->
logs
 = 
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(1, 
NULL
)) == NULL ||

346 (
m
->
hidd’_mes§ges
 = 
	`­Ş_b¡_ü—‹
(
NULL
, NULL)) == NULL ||

347 (
m
->
f‹rs
 = 
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(1, 
f‹r_ä“
)è=ğ
NULL
 ||

348 (
m
->
sÜts
 = 
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(1, 
sÜt_ä“
)è=ğ
NULL
) {

349 
”rÜ
 = 
”ºo
;

350 
	`£aud™_mod–_de¡roy
(&
m
);

351 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
”rÜ
));

352 
”ºo
 = 
”rÜ
;

353  
NULL
;

355 ià(
log
 !ğ
NULL
) {

356 ià(
	`­Ş_veùÜ_­³nd
(
m
->
logs
, 
log
è< 0 || 
	`log_­³nd_mod–
(log, m)) {

357 
”rÜ
 = 
”ºo
;

358 
	`£aud™_mod–_de¡roy
(&
m
);

359 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
”rÜ
));

360 
”ºo
 = 
”rÜ
;

361  
NULL
;

364 
m
->
dœty
 = 1;

365  
m
;

366 
	}
}

368 *
	$mod–_f‹r_dup
(cÚ¡ *
–em
, *
d©a
)

370 cÚ¡ 
£aud™_f‹r_t
 *
f‹r
 = 
–em
;

371 
£aud™_mod–_t
 *
mod–
 = 
d©a
;

372 
£aud™_f‹r_t
 *
f
;

373 ià((
f
 = 
	`£aud™_f‹r_ü—‹_äom_f‹r
(
f‹r
)è=ğ
NULL
) {

374  
NULL
;

376 
	`f‹r_£t_mod–
(
f
, 
mod–
);

377  
f
;

378 
	}
}

380 *
mod–_sÜt_dup
(cÚ¡ *
–em
, *
d©a
 
__©Œibu‹__
 ((
unu£d
)))

382 cÚ¡ 
£aud™_sÜt_t
 *
	gsÜt
 = 
–em
;

383 
£aud™_mod–_t
 *
	gmod–
 = 
d©a
;

384 
£aud™_sÜt_t
 *
	gs
;

385 ià((
	gs
 = 
sÜt_ü—‹_äom_sÜt
(
sÜt
)è=ğ
NULL
) {

386  
NULL
;

388 ià(
£aud™_mod–_­³nd_sÜt
(
mod–
, 
s
) < 0) {

389 
£aud™_sÜt_de¡roy
(&
s
);

390  
	gNULL
;

392  
	gs
;

395 
£aud™_mod–_t
 *
	$£aud™_mod–_ü—‹_äom_mod–
(cÚ¡ 
£aud™_mod–_t
 * 
mod–
)

397 
£aud™_mod–_t
 *
m
 = 
NULL
;

398 
”rÜ
 = 0;

399 
size_t
 
i
;

400 cÚ¡ *
Çme
;

402 ià(
mod–
 =ğ
NULL
) {

403 
”rÜ
 = 
EINVAL
;

404 
ş—nup
;

406 ià((
m
 = 
	`ÿÎoc
(1, (*m))è=ğ
NULL
) {

407 
”rÜ
 = 
”ºo
;

408 
ş—nup
;

410 ià((
Çme
 = 
mod–
->Çmeè=ğ
NULL
) {

411 
Çme
 = "Untitled";

413 ià((
m
->
Çme
 = 
	`¡rdup
Òame)è=ğ
NULL
) {

414 
”rÜ
 = 
”ºo
;

415 
ş—nup
;

417 
m
->
dœty
 = 1;

418 ià((
m
->
logs
 = 
	`­Ş_veùÜ_ü—‹_äom_veùÜ
(
mod–
->logs, 
NULL
, NULL, NULL)) == NULL) {

419 
”rÜ
 = 
”ºo
;

420 
ş—nup
;

422 ià((
m
->
f‹rs
 = 
	`­Ş_veùÜ_ü—‹_äom_veùÜ
(
mod–
->f‹rs, 
mod–_f‹r_dup
, (*)m, 
f‹r_ä“
)è=ğ
NULL
) {

423 
”rÜ
 = 
”ºo
;

424 
ş—nup
;

426 ià((
m
->
sÜts
 = 
	`­Ş_veùÜ_ü—‹_äom_veùÜ
(
mod–
->sÜts, 
mod–_sÜt_dup
, (*)m, 
sÜt_ä“
)è=ğ
NULL
) {

427 
”rÜ
 = 
”ºo
;

428 
ş—nup
;

430 
m
->
m©ch
 = 
mod–
->match;

431 
m
->
visibË
 = 
mod–
->visible;

433 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
m
->
logs
); i++) {

434 
£aud™_log_t
 *
log
 = 
	`­Ş_veùÜ_g‘_–em’t
(
m
->
logs
, 
i
);

435 ià(
	`log_­³nd_mod–
(
log
, 
m
) < 0) {

436 
”rÜ
 = 
”ºo
;

437 
ş—nup
;

440 
ş—nup
:

441 ià(
”rÜ
 != 0) {

442 
	`£aud™_mod–_de¡roy
(&
m
);

443 
”ºo
 = 
”rÜ
;

444  
NULL
;

446  
m
;

447 
	}
}

449 
£aud™_mod–_t
 *
	$£aud™_mod–_ü—‹_äom_fe
(cÚ¡ *
f’ame
)

451 
f‹r_·r£_¡©e
 
¡©e
;

452 
»tv®
, 
”rÜ
;

453 
£aud™_mod–_t
 *
m
;

454 
	`mem£t
(&
¡©e
, 0, (state));

455 ià((
¡©e
.
f‹rs
 = 
	`­Ş_veùÜ_ü—‹
(
f‹r_ä“
)è=ğ
NULL
) {

456  
NULL
;

458 
»tv®
 = 
	`f‹r_·r£_xml
(&
¡©e
, 
f’ame
);

459 ià(
»tv®
 < 0) {

460 
”rÜ
 = 
”ºo
;

461 
	`ä“
(
¡©e
.
v›w_Çme
);

462 
	`­Ş_veùÜ_de¡roy
(&
¡©e
.
f‹rs
);

463 
”ºo
 =ƒrrno;

464  
NULL
;

466 ià((
m
 = 
	`£aud™_mod–_ü—‹
(
¡©e
.
v›w_Çme
, 
NULL
)) == NULL) {

467 
”rÜ
 = 
”ºo
;

468 
	`ä“
(
¡©e
.
v›w_Çme
);

469 
	`­Ş_veùÜ_de¡roy
(&
¡©e
.
f‹rs
);

470 
”ºo
 = 
”rÜ
;

471  
NULL
;

473 
	`ä“
(
¡©e
.
v›w_Çme
);

474 
	`­Ş_veùÜ_de¡roy
(&
m
->
f‹rs
);

475 
m
->
f‹rs
 = 
¡©e
.filters;

476 
¡©e
.
f‹rs
 = 
NULL
;

477 
	`£aud™_mod–_£t_f‹r_m©ch
(
m
, 
¡©e
.
v›w_m©ch
);

478 
	`£aud™_mod–_£t_f‹r_visibË
(
m
, 
¡©e
.
v›w_visibË
);

479  
m
;

480 
	}
}

482 
	$£aud™_mod–_de¡roy
(
£aud™_mod–_t
 ** 
mod–
)

484 
size_t
 
i
;

485 ià(
mod–
 =ğ
NULL
 || *model == NULL) {

488 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
((*
mod–
)->
logs
); i++) {

489 
£aud™_log_t
 *
l
 = 
	`­Ş_veùÜ_g‘_–em’t
((*
mod–
)->
logs
, 
i
);

490 
	`log_»move_mod–
(
l
, *
mod–
);

492 
	`ä“
((*
mod–
)->
Çme
);

493 
	`­Ş_veùÜ_de¡roy
(&(*
mod–
)->
logs
);

494 
	`­Ş_veùÜ_de¡roy
(&(*
mod–
)->
f‹rs
);

495 
	`­Ş_veùÜ_de¡roy
(&(*
mod–
)->
sÜts
);

496 
	`­Ş_veùÜ_de¡roy
(&(*
mod–
)->
mes§ges
);

497 
	`­Ş_veùÜ_de¡roy
(&(*
mod–
)->
m®fÜmed_mes§ges
);

498 
	`­Ş_b¡_de¡roy
(&(*
mod–
)->
hidd’_mes§ges
);

499 
	`ä“
(*
mod–
);

500 *
mod–
 = 
NULL
;

501 
	}
}

503 
	$£aud™_mod–_§ve_to_fe
(cÚ¡ 
£aud™_mod–_t
 * 
mod–
, cÚ¡ *
f’ame
)

505 
FILE
 *
fe
;

506 cÚ¡ *
XML_VER
 = "<?xml version=\"1.0\"?>\n";

507 
£aud™_f‹r_t
 *
f‹r
;

508 
size_t
 
i
;

510 ià(
mod–
 =ğ
NULL
 || 
f’ame
 == NULL) {

511 
”ºo
 = 
EINVAL
;

514 ià((
fe
 = 
	`fİ’
(
f’ame
, "w")è=ğ
NULL
) {

517 
	`årštf
(
fe
, 
XML_VER
);

518 
	`årštf
(
fe
, "<view xmlns=\"http://oss.tresys.com/projects/setools/seaudit-%s/\"‚ame=\"%s\" match=\"%s\" show=\"%s\">\n",

519 
FILTER_FILE_FORMAT_VERSION
, 
mod–
->
Çme
,

520 
mod–
->
m©ch
 =ğ
SEAUDIT_FILTER_MATCH_ALL
 ? "all" : "any",

521 
mod–
->
visibË
 =ğ
SEAUDIT_FILTER_VISIBLE_SHOW
 ? "true" : "false");

522 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
mod–
->
f‹rs
); i++) {

523 
f‹r
 = 
	`­Ş_veùÜ_g‘_–em’t
(
mod–
->
f‹rs
, 
i
);

524 
	`f‹r_­³nd_to_fe
(
f‹r
, 
fe
, 1);

526 
	`årštf
(
fe
, "</view>\n");

527 
	`fşo£
(
fe
);

529 
	}
}

531 cÚ¡ *
	$£aud™_mod–_g‘_Çme
(cÚ¡ 
£aud™_mod–_t
 * 
mod–
)

533 ià(
mod–
 =ğ
NULL
) {

534 
”ºo
 = 
EINVAL
;

535  
NULL
;

537  
mod–
->
Çme
;

538 
	}
}

540 
	$£aud™_mod–_£t_Çme
(
£aud™_mod–_t
 * 
mod–
, cÚ¡ *
Çme
)

542 *
s
;

543 ià(
mod–
 =ğ
NULL
) {

544 
”ºo
 = 
EINVAL
;

547 ià(
Çme
 =ğ
NULL
) {

548 
Çme
 = 
DEFAULT_MODEL_NAME
;

550 ià((
s
 = 
	`¡rdup
(
Çme
)è=ğ
NULL
) {

553 
	`ä“
(
mod–
->
Çme
);

554 
mod–
->
Çme
 = 
s
;

556 
	}
}

558 
	$£aud™_mod–_­³nd_log
(
£aud™_mod–_t
 * 
mod–
, 
£aud™_log_t
 * 
log
)

560 ià(
mod–
 =ğ
NULL
 || 
log
 == NULL) {

561 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
EINVAL
));

562 
”ºo
 = 
EINVAL
;

565 ià(
	`­Ş_veùÜ_­³nd
(
mod–
->
logs
, 
log
è< 0 || 
	`log_­³nd_mod–
(log, model) < 0) {

566 
”rÜ
 = 
”ºo
;

567 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
”rÜ
));

568 
”ºo
 = 
”rÜ
;

571 
mod–
->
dœty
 = 1;

573 
	}
}

575 
	$£aud™_mod–_­³nd_f‹r
(
£aud™_mod–_t
 * 
mod–
, 
£aud™_f‹r_t
 * 
f‹r
)

577 ià(
mod–
 =ğ
NULL
 || 
f‹r
 == NULL) {

578 
”ºo
 = 
EINVAL
;

581 ià(
	`­Ş_veùÜ_­³nd
(
mod–
->
f‹rs
, 
f‹r
) < 0) {

584 
	`f‹r_£t_mod–
(
f‹r
, 
mod–
);

585 
mod–
->
dœty
 = 1;

587 
	}
}

589 cÚ¡ 
­Ş_veùÜ_t
 *
	$£aud™_mod–_g‘_f‹rs
(cÚ¡ 
£aud™_mod–_t
 * 
mod–
)

591 ià(
mod–
 =ğ
NULL
) {

592 
”ºo
 = 
EINVAL
;

593  
NULL
;

595  
mod–
->
f‹rs
;

596 
	}
}

598 
	$£aud™_mod–_»move_f‹r
(
£aud™_mod–_t
 * 
mod–
, 
£aud™_f‹r_t
 * 
f‹r
)

600 
size_t
 
i
;

601 ià(
mod–
 =ğ
NULL
 || 
f‹r
 == NULL) {

602 
”ºo
 = 
EINVAL
;

605 ià(
	`­Ş_veùÜ_g‘_šdex
(
mod–
->
f‹rs
, 
f‹r
, 
NULL
, NULL, &
i
) < 0) {

606 
”ºo
 = 
EINVAL
;

609 
	`£aud™_f‹r_de¡roy
(&
f‹r
);

610 
	`­Ş_veùÜ_»move
(
mod–
->
f‹rs
, 
i
);

611 
mod–
->
dœty
 = 1;

613 
	}
}

615 
	$£aud™_mod–_£t_f‹r_m©ch
(
£aud™_mod–_t
 * 
mod–
, 
£aud™_f‹r_m©ch_e
 
m©ch
)

617 ià(
mod–
 =ğ
NULL
) {

618 
”ºo
 = 
EINVAL
;

621 
mod–
->
m©ch
 = match;

622 
mod–
->
dœty
 = 1;

624 
	}
}

626 
£aud™_f‹r_m©ch_e
 
	$£aud™_mod–_g‘_f‹r_m©ch
(cÚ¡ 
£aud™_mod–_t
 * 
mod–
)

628 ià(
mod–
 =ğ
NULL
) {

629 
”ºo
 = 
EINVAL
;

630  
SEAUDIT_FILTER_MATCH_ALL
;

632  
mod–
->
m©ch
;

633 
	}
}

635 
	$£aud™_mod–_£t_f‹r_visibË
(
£aud™_mod–_t
 * 
mod–
, 
£aud™_f‹r_visibË_e
 
visibË
)

637 ià(
mod–
 =ğ
NULL
) {

638 
”ºo
 = 
EINVAL
;

641 
mod–
->
visibË
 = visible;

642 
mod–
->
dœty
 = 1;

644 
	}
}

646 
£aud™_f‹r_visibË_e
 
	$£aud™_mod–_g‘_f‹r_visibË
(cÚ¡ 
£aud™_mod–_t
 * 
mod–
)

648 ià(
mod–
 =ğ
NULL
) {

649 
”ºo
 = 
EINVAL
;

650  
SEAUDIT_FILTER_VISIBLE_SHOW
;

652  
mod–
->
visibË
;

653 
	}
}

655 
	$£aud™_mod–_­³nd_sÜt
(
£aud™_mod–_t
 * 
mod–
, 
£aud™_sÜt_t
 * 
sÜt
)

657 ià(
mod–
 =ğ
NULL
 || 
sÜt
 == NULL) {

658 
”ºo
 = 
EINVAL
;

661 ià(
	`­Ş_veùÜ_­³nd
(
mod–
->
sÜts
, 
sÜt
) < 0) {

664 
mod–
->
dœty
 = 1;

666 
	}
}

668 
	$£aud™_mod–_ş—r_sÜts
(
£aud™_mod–_t
 * 
mod–
)

670 ià(
mod–
 =ğ
NULL
) {

671 
”ºo
 = 
EINVAL
;

674 
	`­Ş_veùÜ_de¡roy
(&
mod–
->
sÜts
);

675 ià((
mod–
->
sÜts
 = 
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(1, 
sÜt_ä“
)è=ğ
NULL
) {

678 
mod–
->
dœty
 = 1;

680 
	}
}

682 
	$£aud™_mod–_is_chªged
(cÚ¡ 
£aud™_mod–_t
 * 
mod–
)

684 ià(
mod–
 =ğ
NULL
) {

685 
”ºo
 = 
EINVAL
;

688  
mod–
->
dœty
;

689 
	}
}

691 
­Ş_veùÜ_t
 *
	$£aud™_mod–_g‘_mes§ges
(cÚ¡ 
£aud™_log_t
 * 
log
, 
£aud™_mod–_t
 * 
mod–
)

693 ià(
log
 =ğ
NULL
 || 
mod–
 == NULL) {

694 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
EINVAL
));

695 
”ºo
 = 
EINVAL
;

696  
NULL
;

698 ià(
	`mod–_»äesh
(
log
, 
mod–
) < 0) {

699  
NULL
;

701  
	`­Ş_veùÜ_ü—‹_äom_veùÜ
(
mod–
->
mes§ges
, 
NULL
, NULL, NULL);

702 
	}
}

704 
­Ş_veùÜ_t
 *
	$£aud™_mod–_g‘_m®fÜmed_mes§ges
(cÚ¡ 
£aud™_log_t
 * 
log
, 
£aud™_mod–_t
 * 
mod–
)

706 ià(
log
 =ğ
NULL
 || 
mod–
 == NULL) {

707 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
EINVAL
));

708 
”ºo
 = 
EINVAL
;

709  
NULL
;

711 ià(
	`mod–_»äesh
(
log
, 
mod–
) < 0) {

712  
NULL
;

714  
	`­Ş_veùÜ_ü—‹_äom_veùÜ
(
mod–
->
m®fÜmed_mes§ges
, 
NULL
, NULL, NULL);

715 
	}
}

717 
	$£aud™_mod–_hide_mes§ge
(
£aud™_mod–_t
 * 
mod–
, cÚ¡ 
£aud™_mes§ge_t
 * 
mes§ge
)

719 ià(
mod–
 =ğ
NULL
) {

720 
”ºo
 = 
EINVAL
;

723 ià(
mes§ge
 =ğ
NULL
) {

726 ià(
	`­Ş_b¡_š£¹
(
mod–
->
hidd’_mes§ges
, (
£aud™_mes§ge_t
 *è
mes§ge
, 
NULL
) == 0) {

727 
mod–
->
dœty
 = 1;

729 
	}
}

731 
size_t
 
	$£aud™_mod–_g‘_num_®lows
(cÚ¡ 
£aud™_log_t
 * 
log
, 
£aud™_mod–_t
 * 
mod–
)

733 ià(
log
 =ğ
NULL
 || 
mod–
 == NULL) {

734 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
EINVAL
));

735 
”ºo
 = 
EINVAL
;

738 ià(
	`mod–_»äesh
(
log
, 
mod–
) < 0) {

741  
mod–
->
num_®lows
;

742 
	}
}

744 
size_t
 
	$£aud™_mod–_g‘_num_d’›s
(cÚ¡ 
£aud™_log_t
 * 
log
, 
£aud™_mod–_t
 * 
mod–
)

746 ià(
log
 =ğ
NULL
 || 
mod–
 == NULL) {

747 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
EINVAL
));

748 
”ºo
 = 
EINVAL
;

751 ià(
	`mod–_»äesh
(
log
, 
mod–
) < 0) {

754  
mod–
->
num_d’›s
;

755 
	}
}

757 
size_t
 
	$£aud™_mod–_g‘_num_boŞs
(cÚ¡ 
£aud™_log_t
 * 
log
, 
£aud™_mod–_t
 * 
mod–
)

759 ià(
log
 =ğ
NULL
 || 
mod–
 == NULL) {

760 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
EINVAL
));

761 
”ºo
 = 
EINVAL
;

764 ià(
	`mod–_»äesh
(
log
, 
mod–
) < 0) {

767  
mod–
->
num_boŞs
;

768 
	}
}

770 
size_t
 
	$£aud™_mod–_g‘_num_lßds
(cÚ¡ 
£aud™_log_t
 * 
log
, 
£aud™_mod–_t
 * 
mod–
)

772 ià(
log
 =ğ
NULL
 || 
mod–
 == NULL) {

773 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
EINVAL
));

774 
”ºo
 = 
EINVAL
;

777 ià(
	`mod–_»äesh
(
log
, 
mod–
) < 0) {

780  
mod–
->
num_lßds
;

781 
	}
}

785 
	$mod–_»move_log
(
£aud™_mod–_t
 * 
mod–
, 
£aud™_log_t
 * 
log
)

787 
size_t
 
i
;

788 ià(
	`­Ş_veùÜ_g‘_šdex
(
mod–
->
logs
, 
log
, 
NULL
, NULL, &
i
) == 0) {

789 
	`­Ş_veùÜ_»move
(
mod–
->
logs
, 
i
);

790 
mod–
->
dœty
 = 1;

792 
	}
}

794 
	$mod–_nÙify_log_chªged
(
£aud™_mod–_t
 * 
mod–
, 
£aud™_log_t
 * 
log
)

796 
size_t
 
i
;

797 ià(
	`­Ş_veùÜ_g‘_šdex
(
mod–
->
logs
, 
log
, 
NULL
, NULL, &
i
) == 0) {

798 
mod–
->
dœty
 = 1;

800 
	}
}

802 
	$mod–_nÙify_f‹r_chªged
(
£aud™_mod–_t
 * 
mod–
, 
£aud™_f‹r_t
 * 
f‹r
)

804 
size_t
 
i
;

805 ià(
	`­Ş_veùÜ_g‘_šdex
(
mod–
->
f‹rs
, 
f‹r
, 
NULL
, NULL, &
i
) == 0) {

806 
mod–
->
dœty
 = 1;

808 
	}
}

	@libseaudit/src/parse.c

27 
	~"£aud™_š‹º®.h
"

28 
	~<£aud™/·r£.h
>

29 
	~<­Ş/ut.h
>

31 
	~<as£¹.h
>

32 
	~<ùy³.h
>

33 
	~<”ºo.h
>

34 
	~<lim™s.h
>

35 
	~<¡dio.h
>

36 
	~<¡ršg.h
>

37 
	~<time.h
>

39 
	~<£lšux/cÚ‹xt.h
>

41 
	#ALT_SYSCALL_STRING
 "msg÷ud™("

	)

42 
	#AUDITD_MSG
 "ty³="

	)

43 
	#AVCMSG
 "‡vc: "

	)

44 
	#BOOLMSG
 "comm™‹d boŞ—ns"

	)

45 
	#LOADMSG
 " secur™y: "

	)

46 
	#NUM_TIME_COMPONENTS
 3

	)

47 
	#OLD_LOAD_POLICY_STRING
 "lßdšgpŞicycÚfigu¿tiÚäom"

	)

48 
	#PARSE_NUM_SYSCALL_FIELDS
 3

	)

49 
	#SYSCALL_STRING
 "aud™("

	)

57 
	$g‘_tok’s
(
£aud™_log_t
 * 
log
, *
lše
, 
­Ş_veùÜ_t
 ** 
tok’s
)

59 *
lše_±r
, *
Ãxt
;

60 *
tok’s
 = 
NULL
;

61 
”rÜ
 = 0;

63 ià((*
tok’s
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)) == NULL) {

64 
”rÜ
 = 
”ºo
;

65 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
”rÜ
));

66 
ş—nup
;

68 
lše_±r
 = 
lše
;

70 (
Ãxt
 = 
	`¡r£p
(&
lše_±r
, " ")è!ğ
NULL
) {

71 ià(
	`¡rcmp
(
Ãxt
, ""è&& !
	`­Ş_¡r_is_Úly_wh™e_¥aû
(next)) {

72 ià(
	`­Ş_veùÜ_­³nd
(*
tok’s
, 
Ãxt
) < 0) {

73 
”rÜ
 = 
”ºo
;

74 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
”rÜ
));

75 
ş—nup
;

79 
ş—nup
:

80 ià(
”rÜ
 != 0) {

81 
	`­Ş_veùÜ_de¡roy
(
tok’s
);

82 
”ºo
 = 
”rÜ
;

86 
	}
}

91 
£aud™_mes§ge_ty³_e
 
	$is_£lšux
(cÚ¡ *
lše
)

93 ià(
	`¡r¡r
(
lše
, 
BOOLMSG
è&& (¡r¡rÖše, "k”Ãl"è|| sŒ¡rÖše, 
AUDITD_MSG
)))

94  
SEAUDIT_MESSAGE_TYPE_BOOL
;

95 ià(
	`¡r¡r
(
lše
, 
LOADMSG
è&& (¡r¡rÖše, "k”Ãl"è|| sŒ¡rÖše, 
AUDITD_MSG
)))

96  
SEAUDIT_MESSAGE_TYPE_LOAD
;

97 ià(
	`¡r¡r
(
lše
, 
AVCMSG
è&& (¡r¡rÖše, "k”Ãl"è|| sŒ¡rÖše, 
AUDITD_MSG
)))

98  
SEAUDIT_MESSAGE_TYPE_AVC
;

100  
SEAUDIT_MESSAGE_TYPE_INVALID
;

101 
	}
}

103 
daylight
;

111 
	$š£¹_time
(cÚ¡ 
£aud™_log_t
 * 
log
, cÚ¡ 
­Ş_veùÜ_t
 * 
tok’s
, 
size_t
 * 
pos™iÚ
, 
£aud™_mes§ge_t
 * 
msg
)

113 *
t
 = 
NULL
;

114 
size_t
 
i
, 
Ëngth
 = 0;

115 
”rÜ
;

117 ià(*
pos™iÚ
 + 
NUM_TIME_COMPONENTS
 >ğ
	`­Ş_veùÜ_g‘_size
(
tok’s
)) {

118 
	`WARN
(
log
, "%s", "Notƒnoughokens forime.");

121 
i
 = 0; i < 
NUM_TIME_COMPONENTS
; i++) {

122 
Ëngth
 +ğ
	`¡¾’
((*)
	`­Ş_veùÜ_g‘_–em’t
(
tok’s
, 
i
 + *
pos™iÚ
));

126 
Ëngth
 +ğ
NUM_TIME_COMPONENTS
;

127 ià((
t
 = (*)
	`ÿÎoc
(1, 
Ëngth
)è=ğ
NULL
) {

128 
”rÜ
 = 
”ºo
;

129 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
”rÜ
));

130 
”ºo
 = 
”rÜ
;

134 
i
 = 0; i < 
NUM_TIME_COMPONENTS
; i++) {

135 ià(
i
 > 0) {

136 
	`¡rÿt
(
t
, " ");

138 
	`¡rÿt
(
t
, (*)
	`­Ş_veùÜ_g‘_–em’t
(
tok’s
, *
pos™iÚ
));

139 (*
pos™iÚ
)++;

142 ià(!
msg
->
d©e_¡amp
) {

143 ià((
msg
->
d©e_¡amp
 = (
tm
 *)
	`ÿÎoc
(1, (tm))è=ğ
NULL
) {

144 
”rÜ
 = 
”ºo
;

145 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
”rÜ
));

146 
	`ä“
(
t
);

147 
”ºo
 = 
”rÜ
;

152 ià(
	`¡½time
(
t
, "%b %d %T", 
msg
->
d©e_¡amp
è!ğ
NULL
) {

156 
msg
->
d©e_¡amp
->
tm_isd¡
 = 0;

157 
msg
->
d©e_¡amp
->
tm_y—r
 = 0;

159 
	`ä“
(
t
);

161 
	}
}

168 
	$š£¹_ho¡Çme
(cÚ¡ 
£aud™_log_t
 * 
log
, cÚ¡ 
­Ş_veùÜ_t
 * 
tok’s
, 
size_t
 * 
pos™iÚ
, 
£aud™_mes§ge_t
 * 
msg
)

170 *
s
, *
ho¡
;

171 ià(*
pos™iÚ
 >ğ
	`­Ş_veùÜ_g‘_size
(
tok’s
)) {

172 
	`WARN
(
log
, "%s", "Notƒnoughokens for hostname.");

175 
s
 = 
	`­Ş_veùÜ_g‘_–em’t
(
tok’s
, *
pos™iÚ
);

178 ià(
	`¡r¡r
(
s
, "kernel")) {

179 
msg
->
ho¡
 = 
NULL
;

182 (*
pos™iÚ
)++;

183 ià((
ho¡
 = 
	`¡rdup
(
s
)è=ğ
NULL
 || 
	`­Ş_b¡_š£¹_ªd_g‘
(
log
->
ho¡s
, (**)&host, NULL) < 0) {

184 
”rÜ
 = 
”ºo
;

185 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
”rÜ
));

186 
”ºo
 = 
”rÜ
;

189 
msg
->
ho¡
 = host;

191 
	}
}

193 
	$š£¹_¡ªd¬d_msg_h—d”
(cÚ¡ 
£aud™_log_t
 * 
log
, cÚ¡ 
­Ş_veùÜ_t
 * 
tok’s
, 
size_t
 * 
pos™iÚ
,

194 
£aud™_mes§ge_t
 * 
msg
)

196 
»t
 = 0;

197 ià((
»t
 = 
	`š£¹_time
(
log
, 
tok’s
, 
pos™iÚ
, 
msg
)) != 0) {

198  
»t
;

200 ià((
»t
 = 
	`š£¹_ho¡Çme
(
log
, 
tok’s
, 
pos™iÚ
, 
msg
)) != 0) {

201  
»t
;

203  
»t
;

204 
	}
}

209 
	$š£¹_mªag”
(cÚ¡ 
£aud™_log_t
 * 
log
, 
£aud™_mes§ge_t
 * 
msg
, cÚ¡ *
mªag”
)

211 *
m
;

212 ià((
m
 = 
	`¡rdup
(
mªag”
)è=ğ
NULL
 || 
	`­Ş_b¡_š£¹_ªd_g‘
(
log
->
mªag”s
, (**)&m, NULL) < 0) {

213 
”rÜ
 = 
”ºo
;

214 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
”rÜ
));

215 
”ºo
 = 
”rÜ
;

218 
msg
->
mªag”
 = 
m
;

220 
	}
}

226 
	$·r£_cÚ‹xt
(
£aud™_log_t
 * 
log
, *
tok’
, **
u£r
, **
rŞe
, **
ty³
, **
mls_lvl
, **
mls_şr
)

228 *
s
, *
¿nge
;

229 
”rÜ
, 
»t
 = 0;

230 
cÚ‹xt_t
 
cÚ
 = 
	`cÚ‹xt_Ãw
(
tok’
);

231 *
u£r
 = *
rŞe
 = *
ty³
 = *
mls_lvl
 = *
mls_şr
 = 
NULL
;

233 ià(
cÚ
 =ğ
NULL
) {

234 
	`WARN
(
log
, "%s", "Error…arsing context.");

235 
»t
 = 1;

236 
out
;

239 ià((
s
 = 
	`¡rdup
(
	`cÚ‹xt_u£r_g‘
(
cÚ
))è=ğ
NULL
 || 
	`­Ş_b¡_š£¹_ªd_g‘
(
log
->
u£rs
, (**)&s, NULL) < 0) {

240 
”rÜ
 = 
”ºo
;

241 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
”rÜ
));

242 
”ºo
 = 
”rÜ
;

243 
»t
 = -1;

244 
out
;

246 *
u£r
 = 
s
;

248 ià((
s
 = 
	`¡rdup
(
	`cÚ‹xt_rŞe_g‘
(
cÚ
))è=ğ
NULL
 || 
	`­Ş_b¡_š£¹_ªd_g‘
(
log
->
rŞes
, (**)&s, NULL) < 0) {

249 
”rÜ
 = 
”ºo
;

250 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
”rÜ
));

251 
”ºo
 = 
”rÜ
;

252 
»t
 = -1;

253 
out
;

255 *
rŞe
 = 
s
;

257 ià((
s
 = 
	`¡rdup
(
	`cÚ‹xt_ty³_g‘
(
cÚ
))è=ğ
NULL
 || 
	`­Ş_b¡_š£¹_ªd_g‘
(
log
->
ty³s
, (**)&s, NULL) < 0) {

258 
”rÜ
 = 
”ºo
;

259 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
”rÜ
));

260 
”ºo
 = 
”rÜ
;

261 
»t
 = -1;

262 
out
;

264 *
ty³
 = 
s
;

266 ià(
¿nge
 = 
	`cÚ‹xt_¿nge_g‘
(
cÚ
)) {

267 *
lvl
, *
şr
;

268 
lvl
 = 
	`¡r£p
(&
¿nge
, "-");

269 
şr
 = 
	`¡r£p
(&
¿nge
, "-");

270 ià(
şr
 =ğ
NULL
)

272 
şr
 = 
lvl
;

274 ià((
s
 = 
	`¡rdup
(
lvl
)è=ğ
NULL
 || 
	`­Ş_b¡_š£¹_ªd_g‘
(
log
->
mls_lvl
, (**)&s, NULL) < 0) {

275 
”rÜ
 = 
”ºo
;

276 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
”rÜ
));

277 
”ºo
 = 
”rÜ
;

278 
»t
 = -1;

279 
out
;

281 *
mls_lvl
 = 
s
;

283 ià((
s
 = 
	`¡rdup
(
şr
)è=ğ
NULL
 || 
	`­Ş_b¡_š£¹_ªd_g‘
(
log
->
mls_şr
, (**)&s, NULL) < 0) {

284 
”rÜ
 = 
”ºo
;

285 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
”rÜ
));

286 
”ºo
 = 
”rÜ
;

287 
»t
 = -1;

288 
out
;

290 *
mls_şr
 = 
s
;

293 
out
:

294 
	`cÚ‹xt_ä“
(
cÚ
);

295  
»t
;

296 
	}
}

303 
	$avc_msg_is_tok’_Ãw_aud™_h—d”
(cÚ¡ *
tok’
)

305  (
	`¡r¡r
(
tok’
, 
SYSCALL_STRING
) ? 1 : 0);

306 
	}
}

313 
	$avc_msg_is_´efix
(*
tok’
, *
´efix
, **
»suÉ
)

315 
size_t
 
i
 = 0, 
Ëngth
;

317 
Ëngth
 = 
	`¡¾’
(
´efix
);

318 ià(
	`¡¾’
(
tok’
è< 
Ëngth
)

321 
i
 = 0; i < 
Ëngth
; i++) {

322 ià(
tok’
[
i
] !ğ
´efix
[i]) {

327 *
»suÉ
 = 
tok’
 + 
Ëngth
;

329 
	}
}

339 
	$avc_msg_š£¹_³rms
(cÚ¡ 
£aud™_log_t
 * 
log
, 
­Ş_veùÜ_t
 * 
tok’s
, 
size_t
 * 
pos™iÚ
, 
£aud™_avc_mes§ge_t
 * 
avc
)

341 *
s
, *
³rm
;

342 
”rÜ
;

343 ià((
s
 = 
	`­Ş_veùÜ_g‘_–em’t
(
tok’s
, *
pos™iÚ
)è=ğ
NULL
 || 
	`¡rcmp
(s, "{") != 0) {

344 
	`WARN
(
log
, "%s", "Expected‡n opening brace while…arsing…ermissions.");

347 (*
pos™iÚ
)++;

349 *
pos™iÚ
 < 
	`­Ş_veùÜ_g‘_size
(
tok’s
)) {

350 
s
 = 
	`­Ş_veùÜ_g‘_–em’t
(
tok’s
, *
pos™iÚ
);

351 
	`as£¹
(
s
 !ğ
NULL
);

352 (*
pos™iÚ
)++;

353 ià(
	`¡rcmp
(
s
, "}") == 0) {

357 ià((
³rm
 = 
	`¡rdup
(
s
)è=ğ
NULL
 ||

358 
	`­Ş_b¡_š£¹_ªd_g‘
(
log
->
³rms
, (**)&
³rm
, 
NULL
è< 0 || 
	`­Ş_veùÜ_­³nd
(
avc
->perms,…erm) < 0) {

359 
”rÜ
 = 
”ºo
;

360 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
”rÜ
));

361 
”ºo
 = 
”rÜ
;

367 
	`WARN
(
log
, "%s", "Expected‡ closing brace while…arsing…ermissions.");

369 
	}
}

371 
	$avc_msg_š£¹_sysÿÎ_šfo
(cÚ¡ 
£aud™_log_t
 * 
log
, *
tok’
, 
£aud™_mes§ge_t
 * 
msg
, 
£aud™_avc_mes§ge_t
 * 
avc
)

373 
size_t
 
Ëngth
, 
h—d”_Ën
 = 0, 
i
 = 0;

374 *
f›lds
[
PARSE_NUM_SYSCALL_FIELDS
];

375 *
time_¡r
 = 
NULL
;

376 
time_t
 
‹mp
;

378 
Ëngth
 = 
	`¡¾’
(
tok’
);

381 ià(
tok’
[
Ëngth
 - 1] == ':') {

382 
tok’
[
Ëngth
 - 1] = '\0';

383 
Ëngth
--;

386 ià(
tok’
[
Ëngth
 - 1] == ')') {

387 
tok’
[
Ëngth
 - 1] = '\0';

388 
Ëngth
--;

390 
h—d”_Ën
 = 
	`¡¾’
(
SYSCALL_STRING
);

393 ià(
	`¡r¡r
(
tok’
, 
ALT_SYSCALL_STRING
)) {

394 
h—d”_Ën
 = 
	`¡¾’
(
ALT_SYSCALL_STRING
);

397 
time_¡r
 = 
tok’
 + 
h—d”_Ën
;

399 
i
 < 
PARSE_NUM_SYSCALL_FIELDS
 && (
f›lds
[i] = 
	`¡r£p
(&
time_¡r
, ".:")è!ğ
NULL
) {

400 
i
++;

403 ià(
i
 !ğ
PARSE_NUM_SYSCALL_FIELDS
) {

404 
	`WARN
(
log
, "%s", "Notƒnough fields for syscall info.");

408 
‹mp
 = (
time_t
è
	`©Ş
(
f›lds
[0]);

409 
avc
->
tm_¡mp_£c
 = 
‹mp
;

410 
avc
->
tm_¡mp_Çno
 = 
	`©oi
(
f›lds
[1]);

411 
avc
->
£rŸl
 = 
	`©oi
(
f›lds
[2]);

413 ià(
msg
->
d©e_¡amp
 =ğ
NULL
) {

414 ià((
msg
->
d©e_¡amp
 = (
tm
 *)
	`m®loc
((tm))è=ğ
NULL
) {

415 
”rÜ
 = 
”ºo
;

416 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
”rÜ
));

417 
”ºo
 = 
”rÜ
;

421 
	`loÿÉime_r
(&
‹mp
, 
msg
->
d©e_¡amp
);

423 
	}
}

425 
	$avc_msg_š£¹_acûss_ty³
(cÚ¡ 
£aud™_log_t
 * 
log
, cÚ¡ *
tok’
, 
£aud™_avc_mes§ge_t
 * 
avc
)

427 ià(
	`¡rcmp
(
tok’
, "granted") == 0) {

428 
avc
->
msg
 = 
SEAUDIT_AVC_GRANTED
;

430 } ià(
	`¡rcmp
(
tok’
, "denied") == 0) {

431 
avc
->
msg
 = 
SEAUDIT_AVC_DENIED
;

434 
	`WARN
(
log
, "%s", "No AVC messageype found,‡ssuming it was‡ denial.");

435 
avc
->
msg
 = 
SEAUDIT_AVC_DENIED
;

437 
	}
}

439 
	$avc_msg_š£¹_scÚ
(
£aud™_log_t
 * 
log
, 
£aud™_avc_mes§ge_t
 * 
avc
, *
tmp
)

441 *
u£r
, *
rŞe
, *
ty³
, *
mls_lvl
, *
mls_şr
;

442 
»tv®
;

443 ià(
tmp
 =ğ
NULL
) {

444 
	`WARN
(
log
, "%s", "Invalid source context.");

447 
»tv®
 = 
	`·r£_cÚ‹xt
(
log
, 
tmp
, &
u£r
, &
rŞe
, &
ty³
, &
mls_lvl
, &
mls_şr
);

448 ià(
»tv®
 != 0) {

449  
»tv®
;

451 
avc
->
su£r
 = 
u£r
;

452 
avc
->
¤Şe
 = 
rŞe
;

453 
avc
->
¡y³
 = 
ty³
;

454 
avc
->
smls_lvl
 = 
mls_lvl
;

455 
avc
->
smls_şr
 = 
mls_şr
;

457 
	}
}

459 
	$avc_msg_š£¹_tcÚ
(
£aud™_log_t
 * 
log
, 
£aud™_avc_mes§ge_t
 * 
avc
, *
tmp
)

461 *
u£r
, *
rŞe
, *
ty³
, *
mls_lvl
, *
mls_şr
;

462 
»tv®
;

463 ià(
tmp
 =ğ
NULL
) {

464 
	`WARN
(
log
, "%s", "Invalidarget context.");

467 
»tv®
 = 
	`·r£_cÚ‹xt
(
log
, 
tmp
, &
u£r
, &
rŞe
, &
ty³
, &
mls_lvl
, &
mls_şr
);

468 ià(
»tv®
 != 0) {

469  
»tv®
;

471 
avc
->
tu£r
 = 
u£r
;

472 
avc
->
ŒŞe
 = 
rŞe
;

473 
avc
->
‰y³
 = 
ty³
;

474 
avc
->
tmls_lvl
 = 
mls_lvl
;

475 
avc
->
tmls_şr
 = 
mls_şr
;

477 
	}
}

479 
	$avc_msg_š£¹_tşass
(
£aud™_log_t
 * 
log
, 
£aud™_avc_mes§ge_t
 * 
avc
, cÚ¡ *
tmp
)

481 *
tşass
;

482 ià((
tşass
 = 
	`¡rdup
(
tmp
)è=ğ
NULL
 || 
	`­Ş_b¡_š£¹_ªd_g‘
(
log
->
şas£s
, (**)&tclass, NULL) < 0) {

483 
”rÜ
 = 
”ºo
;

484 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
”rÜ
));

485 
”ºo
 = 
”rÜ
;

488 
avc
->
tşass
 =class;

490 
	}
}

492 
	$avc_msg_š£¹_¡ršg
(cÚ¡ 
£aud™_log_t
 * 
log
, *
¤c
, **
de¡
)

494 ià((*
de¡
 = 
	`¡rdup
(
¤c
)è=ğ
NULL
) {

495 
”rÜ
 = 
”ºo
;

496 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
”rÜ
));

497 
”ºo
 = 
”rÜ
;

501 
	}
}

507 
	$avc_msg_»move_quÙes_š£¹_¡ršg
(cÚ¡ 
£aud™_log_t
 * 
log
, *
¤c
, **
de¡
)

509 
size_t
 
i
, 
j
, 
l
;

511 
l
 = 
	`¡¾’
(
¤c
);

514 ià(
¤c
[0] =ğ'\"' && 
l
 > 0 && src[l - 1] == '\"') {

515 ià((*
de¡
 = 
	`ÿÎoc
(1, 
l
 + 1)è=ğ
NULL
) {

516 
”rÜ
 = 
”ºo
;

517 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
”rÜ
));

518 
”ºo
 = 
”rÜ
;

521 
i
 = 0, 
j
 = 0; i < 
l
; i++) {

522 ià(
¤c
[
i
] != '\"') {

523 (*
de¡
)[
j
] = 
¤c
[
i
];

524 
j
++;

529  
	`avc_msg_š£¹_¡ršg
(
log
, 
¤c
, 
de¡
);

530 
	}
}

536 
	$avc_msg_is_v®id_add™iÚ®_f›ld
(cÚ¡ *
Üig_tok’
)

538 *
fœ¡_eq
 = 
	`¡rchr
(
Üig_tok’
, '=');

540 ià(
fœ¡_eq
 =ğ
NULL
) {

543 ià(
	`¡rchr
(
fœ¡_eq
 + 1, '='è!ğ
NULL
) {

547 
	}
}

549 
	$avc_msg_»fÜm©_·th
(cÚ¡ 
£aud™_log_t
 * 
log
, 
£aud™_avc_mes§ge_t
 * 
avc
, cÚ¡ *
tok’
)

551 
”rÜ
;

552 ià(
avc
->
·th
 =ğ
NULL
) {

553 ià((
avc
->
·th
 = 
	`¡rdup
(
tok’
)è=ğ
NULL
) {

554 
”rÜ
 = 
”ºo
;

555 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
”rÜ
));

556 
”ºo
 = 
”rÜ
;

560 
size_t
 
Ën
 = 
	`¡¾’
(
avc
->
·th
è+ sŒËn(
tok’
) + 2;

561 *
s
 = 
	`»®loc
(
avc
->
·th
, 
Ën
);

562 ià(
s
 =ğ
NULL
) {

563 
”rÜ
 = 
”ºo
;

564 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
”rÜ
));

565 
”ºo
 = 
”rÜ
;

568 
avc
->
·th
 = 
s
;

569 
	`¡rÿt
(
avc
->
·th
, " ");

570 
	`¡rÿt
(
avc
->
·th
, 
tok’
);

573 
	}
}

581 
	$avc_msg_š£¹_add™iÚ®_f›ld_d©a
(
£aud™_log_t
 * 
log
, 
­Ş_veùÜ_t
 * 
tok’s
, 
£aud™_avc_mes§ge_t
 * 
avc
,

582 
size_t
 * 
pos™iÚ
)

584 *
tok’
, *
v
;

585 
»tv®
, 
has_w¬nšgs
 = 0;

587 
avc
->
avc_ty³
 = 
SEAUDIT_AVC_DATA_FS
;

588 ; (*
pos™iÚ
è< 
	`­Ş_veùÜ_g‘_size
(
tok’s
); (*position)++) {

589 
tok’
 = 
	`­Ş_veùÜ_g‘_–em’t
(
tok’s
, (*
pos™iÚ
));

590 
v
 = 
NULL
;

591 ià(
	`¡rcmp
(
tok’
, "") == 0) {

595 ià(!
avc
->
is_pid
 && 
	`avc_msg_is_´efix
(
tok’
, "pid=", &
v
)) {

596 
avc
->
pid
 = 
	`©oi
(
v
);

597 
avc
->
is_pid
 = 1;

601 ià(!
avc
->
exe
 && 
	`avc_msg_is_´efix
(
tok’
, "exe=", &
v
)) {

602 ià(
	`avc_msg_š£¹_¡ršg
(
log
, 
v
, &
avc
->
exe
) < 0) {

608 ià(!
avc
->
comm
 && 
	`avc_msg_is_´efix
(
tok’
, "comm=", &
v
)) {

609 ià(
	`avc_msg_»move_quÙes_š£¹_¡ršg
(
log
, 
v
, &
avc
->
comm
) < 0) {

621 ià(!
avc
->
·th
 && 
	`avc_msg_is_´efix
(
tok’
, "·th=", &
v
)) {

622 ià(
	`avc_msg_»fÜm©_·th
(
log
, 
avc
, 
v
) < 0) {

625 *
pos™iÚ
 + 1 < 
	`­Ş_veùÜ_g‘_size
(
tok’s
)) {

626 
tok’
 = 
	`­Ş_veùÜ_g‘_–em’t
(
tok’s
, *
pos™iÚ
 + 1);

627 ià(
	`avc_msg_is_v®id_add™iÚ®_f›ld
(
tok’
)) {

630 (*
pos™iÚ
)++;

631 ià(
	`avc_msg_»fÜm©_·th
(
log
, 
avc
, 
tok’
) < 0) {

638 ià(!
avc
->
Çme
 && 
	`avc_msg_is_´efix
(
tok’
, "Çme=", &
v
)) {

639 ià(
	`avc_msg_»move_quÙes_š£¹_¡ršg
(
log
, 
v
, &
avc
->
Çme
) < 0) {

645 ià(!
avc
->
dev
 && 
	`avc_msg_is_´efix
(
tok’
, "dev=", &
v
)) {

646 ià(
	`avc_msg_š£¹_¡ršg
(
log
, 
v
, &
avc
->
dev
) < 0) {

652 ià(!
avc
->
§ddr
 && 
	`avc_msg_is_´efix
(
tok’
, "§ddr=", &
v
)) {

653 ià(
	`avc_msg_š£¹_¡ršg
(
log
, 
v
, &
avc
->
§ddr
) < 0) {

659 ià(!
avc
->
sourû
 && (
	`avc_msg_is_´efix
(
tok’
, "sourû=", &
v
) ||‡vc_msg_is_prefix(token, "src=", &v))) {

660 
avc
->
sourû
 = 
	`©oi
(
v
);

664 ià(!
avc
->
daddr
 && 
	`avc_msg_is_´efix
(
tok’
, "daddr=", &
v
)) {

665 ià(
	`avc_msg_š£¹_¡ršg
(
log
, 
v
, &
avc
->
daddr
)) {

671 ià(!
avc
->
de¡
 && 
	`avc_msg_is_´efix
(
tok’
, "de¡=", &
v
)) {

672 
avc
->
de¡
 = 
	`©oi
(
v
);

676 ià(!
avc
->
Ãtif
 && 
	`avc_msg_is_´efix
(
tok’
, "Ãtif=", &
v
)) {

677 ià(
	`avc_msg_š£¹_¡ršg
(
log
, 
v
, &
avc
->
Ãtif
)) {

680 
avc
->
avc_ty³
 = 
SEAUDIT_AVC_DATA_NET
;

684 ià(!
avc
->
Ïddr
 && 
	`avc_msg_is_´efix
(
tok’
, "Ïddr=", &
v
)) {

685 ià(
	`avc_msg_š£¹_¡ršg
(
log
, 
v
, &
avc
->
Ïddr
)) {

691 ià(!
avc
->
ÍÜt
 && 
	`avc_msg_is_´efix
(
tok’
, "ÍÜt=", &
v
)) {

692 
avc
->
ÍÜt
 = 
	`©oi
(
v
);

693 
avc
->
avc_ty³
 = 
SEAUDIT_AVC_DATA_NET
;

697 ià(!
avc
->
çddr
 && 
	`avc_msg_is_´efix
(
tok’
, "çddr=", &
v
)) {

698 ià(
	`avc_msg_š£¹_¡ršg
(
log
, 
v
, &
avc
->
çddr
)) {

704 ià(!
avc
->
åÜt
 && 
	`avc_msg_is_´efix
(
tok’
, "åÜt=", &
v
)) {

705 
avc
->
åÜt
 = 
	`©oi
(
v
);

709 ià(!
avc
->
pÜt
 && 
	`avc_msg_is_´efix
(
tok’
, "pÜt=", &
v
)) {

710 
avc
->
pÜt
 = 
	`©oi
(
v
);

711 
avc
->
avc_ty³
 = 
SEAUDIT_AVC_DATA_NET
;

715 ià(!
avc
->
is_¤c_sid
 && 
	`avc_msg_is_´efix
(
tok’
, "ssid=", &
v
)) {

716 
avc
->
¤c_sid
 = ()
	`¡¹oul
(
v
, 
NULL
, 10);

717 
avc
->
is_¤c_sid
 = 1;

721 ià(!
avc
->
is_tgt_sid
 && 
	`avc_msg_is_´efix
(
tok’
, "tsid=", &
v
)) {

722 
avc
->
tgt_sid
 = ()
	`¡¹oul
(
v
, 
NULL
, 10);

723 
avc
->
is_tgt_sid
 = 1;

727 ià(!
avc
->
is_ÿ·b™y
 && 
	`avc_msg_is_´efix
(
tok’
, "ÿ·b™y=", &
v
)) {

728 
avc
->
ÿ·b™y
 = 
	`©oi
(
v
);

729 
avc
->
is_ÿ·b™y
 = 1;

730 
avc
->
avc_ty³
 = 
SEAUDIT_AVC_DATA_CAP
;

734 ià(!
avc
->
is_key
 && 
	`avc_msg_is_´efix
(
tok’
, "key=", &
v
)) {

735 
avc
->
key
 = 
	`©oi
(
v
);

736 
avc
->
is_key
 = 1;

737 
avc
->
avc_ty³
 = 
SEAUDIT_AVC_DATA_IPC
;

741 ià(!
avc
->
is_šode
 && 
	`avc_msg_is_´efix
(
tok’
, "šo=", &
v
)) {

742 
avc
->
šode
 = 
	`¡¹oul
(
v
, 
NULL
, 10);

743 
avc
->
is_šode
 = 1;

747 ià(!
avc
->
addr
 && 
	`avc_msg_is_´efix
(
tok’
, "addr=", &
v
)) {

748 ià(
	`avc_msg_š£¹_¡ršg
(
log
, 
v
, &
avc
->
addr
)) {

754 ià(!
avc
->
su£r
 && 
	`avc_msg_is_´efix
(
tok’
, "scÚ‹xt=", &
v
)) {

755 
»tv®
 = 
	`avc_msg_š£¹_scÚ
(
log
, 
avc
, 
v
);

756 ià(
»tv®
 < 0) {

757  
»tv®
;

758 } ià(
»tv®
 > 0) {

759 
has_w¬nšgs
 = 1;

764 ià(!
avc
->
tu£r
 && 
	`avc_msg_is_´efix
(
tok’
, "tcÚ‹xt=", &
v
)) {

765 
»tv®
 = 
	`avc_msg_š£¹_tcÚ
(
log
, 
avc
, 
v
);

766 ià(
»tv®
 < 0) {

767  
»tv®
;

768 } ià(
»tv®
 > 0) {

769 
has_w¬nšgs
 = 1;

774 ià(!
avc
->
tşass
 && 
	`avc_msg_is_´efix
(
tok’
, "tşass=", &
v
)) {

775 ià(
	`avc_msg_š£¹_tşass
(
log
, 
avc
, 
v
) < 0) {

782 
has_w¬nšgs
 = 1;

786 ià((
avc
->
is_¤c_sid
 &&‡vc->
su£r
è|| (avc->
is_tgt_sid
 &&‡vc->
tu£r
)) {

787 
has_w¬nšgs
 = 1;

790 ià(!
avc
->
tşass
) {

791 
has_w¬nšgs
 = 1;

794 ià(
has_w¬nšgs
) {

795 
avc
->
avc_ty³
 = 
SEAUDIT_AVC_DATA_MALFORMED
;

798  
has_w¬nšgs
;

799 
	}
}

801 
	$avc_·r£
(
£aud™_log_t
 * 
log
, 
­Ş_veùÜ_t
 * 
tok’s
)

803 
£aud™_mes§ge_t
 *
msg
;

804 
£aud™_avc_mes§ge_t
 *
avc
;

805 
£aud™_mes§ge_ty³_e
 
ty³
;

806 
»t
, 
has_w¬nšgs
 = 0;

807 
size_t
 
pos™iÚ
 = 0, 
num_tok’s
 = 
	`­Ş_veùÜ_g‘_size
(
tok’s
);

808 *
tok’
, *
t
;

810 ià((
msg
 = 
	`mes§ge_ü—‹
(
log
, 
SEAUDIT_MESSAGE_TYPE_AVC
)è=ğ
NULL
) {

813 
avc
 = 
	`£aud™_mes§ge_g‘_d©a
(
msg
, &
ty³
);

815 
tok’
 = 
	`­Ş_veùÜ_g‘_–em’t
(
tok’s
, 
pos™iÚ
);

818 ià(
	`¡r¡r
(
tok’
, 
AUDITD_MSG
)) {

819 
pos™iÚ
++;

820 ià(
pos™iÚ
 >ğ
num_tok’s
) {

821 
	`WARN
(
log
, "%s", "Notƒnoughokens for‡udit header.");

824 
log
->
logty³
 = 
SEAUDIT_LOG_TYPE_AUDITD
;

825 
tok’
 = 
	`­Ş_veùÜ_g‘_–em’t
(
tok’s
, 
pos™iÚ
);

829 ià(
	`avc_msg_is_tok’_Ãw_aud™_h—d”
(
tok’
)) {

830 
»t
 = 
	`avc_msg_š£¹_sysÿÎ_šfo
(
log
, 
tok’
, 
msg
, 
avc
);

831 ià(
»t
 < 0) {

832  
»t
;

833 } ià(
»t
 > 0) {

834 
has_w¬nšgs
 = 1;

836 
pos™iÚ
++;

837 ià(
pos™iÚ
 >ğ
num_tok’s
) {

838 
	`WARN
(
log
, "%s", "Notƒnoughokens for‚ew‡udit header.");

841 
tok’
 = 
	`­Ş_veùÜ_g‘_–em’t
(
tok’s
, 
pos™iÚ
);

844 
»t
 = 
	`š£¹_¡ªd¬d_msg_h—d”
(
log
, 
tok’s
, &
pos™iÚ
, 
msg
);

845 ià(
»t
 < 0) {

846  
»t
;

847 } ià(
»t
 > 0) {

848 
has_w¬nšgs
 = 1;

850 ià(
pos™iÚ
 >ğ
num_tok’s
) {

851 
	`WARN
(
log
, "%s", "Notƒnoughokens for‚ew‡udit header.");

854 
tok’
 = 
	`­Ş_veùÜ_g‘_–em’t
(
tok’s
, 
pos™iÚ
);

858 ià((
t
 = 
	`¡¼chr
(
tok’
, ':')è=ğ
NULL
) {

859 
	`WARN
(
log
, "%s", "Expectedo find‡n object manager here.");

860 
has_w¬nšgs
 = 1;

863 *
t
 = '\0';

864 ià((
»t
 = 
	`š£¹_mªag”
(
log
, 
msg
, 
tok’
)) < 0) {

865  
»t
;

867 
pos™iÚ
++;

868 ià(
pos™iÚ
 >ğ
num_tok’s
) {

869 
	`WARN
(
log
, "%s", "Notƒnoughokens for‚ew‡udit header.");

872 
tok’
 = 
	`­Ş_veùÜ_g‘_–em’t
(
tok’s
, 
pos™iÚ
);

881 ià(
	`avc_msg_is_tok’_Ãw_aud™_h—d”
(
tok’
)) {

882 
»t
 = 
	`avc_msg_š£¹_sysÿÎ_šfo
(
log
, 
tok’
, 
msg
, 
avc
);

883 ià(
»t
 < 0) {

884  
»t
;

885 } ià(
»t
 > 0) {

886 
has_w¬nšgs
 = 1;

888 
pos™iÚ
++;

889 ià(
pos™iÚ
 >ğ
num_tok’s
) {

890 
	`WARN
(
log
, "%s", "Notƒnoughokens for‚ew‡udit header.");

893 
tok’
 = 
	`­Ş_veùÜ_g‘_–em’t
(
tok’s
, 
pos™iÚ
);

899 ià(
	`¡rcmp
(
tok’
, "avc:") != 0) {

901 
has_w¬nšgs
 = 1;

902 
	`WARN
(
log
, "%s", "Expected‡n‡vc:oken here.");

904 
pos™iÚ
++;

905 ià(
pos™iÚ
 >ğ
num_tok’s
) {

906 
	`WARN
(
log
, "%s", "Notƒnoughokens for‚ew‡udit header.");

909 
tok’
 = 
	`­Ş_veùÜ_g‘_–em’t
(
tok’s
, 
pos™iÚ
);

913 ià(
	`avc_msg_š£¹_acûss_ty³
(
log
, 
tok’
, 
avc
)) {

914 
has_w¬nšgs
 = 1;

916 
pos™iÚ
++;

917 ià(
pos™iÚ
 >ğ
num_tok’s
) {

918 
	`WARN
(
log
, "%s", "Notƒnoughokens for‚ew‡udit header.");

921 
tok’
 = 
	`­Ş_veùÜ_g‘_–em’t
(
tok’s
, 
pos™iÚ
);

925 
»t
 = 
	`avc_msg_š£¹_³rms
(
log
, 
tok’s
, &
pos™iÚ
, 
avc
);

926 ià(
»t
 < 0) {

927  
»t
;

928 } ià(
»t
 > 0) {

929 
has_w¬nšgs
 = 1;

931 ià(
pos™iÚ
 >ğ
num_tok’s
) {

932 
	`WARN
(
log
, "%s", "Message‡ppearso beruncated.");

935 
tok’
 = 
	`­Ş_veùÜ_g‘_–em’t
(
tok’s
, 
pos™iÚ
);

937 ià(
	`¡rcmp
(
tok’
, "for") != 0) {

939 
has_w¬nšgs
 = 1;

940 
	`WARN
(
log
, "%s", "Expected‡ 'for'oken here.");

942 
pos™iÚ
++;

943 ià(
pos™iÚ
 >ğ
num_tok’s
) {

944 
	`WARN
(
log
, "%s", "Notƒnoughokens for‚ew‡udit header.");

947 
tok’
 = 
	`­Ş_veùÜ_g‘_–em’t
(
tok’s
, 
pos™iÚ
);

954 
»t
 = 
	`avc_msg_š£¹_add™iÚ®_f›ld_d©a
(
log
, 
tok’s
, 
avc
, &
pos™iÚ
);

955 ià(
»t
 < 0) {

956  
»t
;

957 } ià(
»t
 > 0) {

958 
has_w¬nšgs
 = 1;

961  
has_w¬nšgs
;

962 
	}
}

966 
	$boŞ—n_msg_š£¹_boŞ
(
£aud™_log_t
 * 
log
, 
£aud™_boŞ_mes§ge_t
 * 
boŞm
, *
tok’
)

968 
size_t
 
Ën
 = 
	`¡¾’
(
tok’
);

969 
v®ue
;

972 ià(
tok’
[
Ën
 - 1] == ',') {

973 
tok’
[
Ën
 - 1] = '\0';

974 
Ën
--;

977 ià(
tok’
[
Ën
 - 2] != ':') {

978 
	`WARN
(
log
, "%s", "Boolean change was‚ot in correct format.");

982 ià(
tok’
[
Ën
 - 1] == '0')

983 
v®ue
 = 0;

984 ià(
tok’
[
Ën
 - 1] == '1')

985 
v®ue
 = 1;

987 
	`WARN
(
log
, "%s", "Invalid‚ew boolean value.");

991 
tok’
[
Ën
 - 2] = '\0';

993  
	`boŞ_chªge_­³nd
(
log
, 
boŞm
, 
tok’
, 
v®ue
);

994 
	}
}

996 
	$boŞ_·r£
(
£aud™_log_t
 * 
log
, 
­Ş_veùÜ_t
 * 
tok’s
)

998 
£aud™_mes§ge_t
 *
msg
;

999 
£aud™_boŞ_mes§ge_t
 *
boŞm
;

1000 
£aud™_mes§ge_ty³_e
 
ty³
;

1001 
»t
, 
has_w¬nšgs
 = 0, 
Ãxt_lše
 = 
log
->next_line;

1002 
size_t
 
pos™iÚ
 = 0, 
num_tok’s
 = 
	`­Ş_veùÜ_g‘_size
(
tok’s
);

1003 *
tok’
;

1005 ià(
log
->
Ãxt_lše
) {

1008 
size_t
 
num_mes§ges
 = 
	`­Ş_veùÜ_g‘_size
(
log
->
mes§ges
);

1009 
	`as£¹
(
num_mes§ges
 > 0);

1010 
msg
 = 
	`­Ş_veùÜ_g‘_–em’t
(
log
->
mes§ges
, 
num_mes§ges
 - 1);

1011 
log
->
Ãxt_lše
 = 0;

1013 ià((
msg
 = 
	`mes§ge_ü—‹
(
log
, 
SEAUDIT_MESSAGE_TYPE_BOOL
)è=ğ
NULL
) {

1017 
boŞm
 = 
	`£aud™_mes§ge_g‘_d©a
(
msg
, &
ty³
);

1019 
»t
 = 
	`š£¹_¡ªd¬d_msg_h—d”
(
log
, 
tok’s
, &
pos™iÚ
, 
msg
);

1020 ià(
»t
 < 0) {

1021  
»t
;

1022 } ià(
»t
 > 0) {

1023 
has_w¬nšgs
 = 1;

1025 ià(
pos™iÚ
 >ğ
num_tok’s
) {

1026 
	`WARN
(
log
, "%s", "Notƒnoughokens for boolean change.");

1029 
tok’
 = 
	`­Ş_veùÜ_g‘_–em’t
(
tok’s
, 
pos™iÚ
);

1032 ià(!
	`¡r¡r
(
tok’
, "kernel:")) {

1033 
	`WARN
(
log
, "%s", "Expectedo see kernel here.");

1034 
has_w¬nšgs
 = 1;

1037 ià((
»t
 = 
	`š£¹_mªag”
(
log
, 
msg
, "kernel")) < 0) {

1038  
»t
;

1040 
pos™iÚ
++;

1041 ià(
pos™iÚ
 >ğ
num_tok’s
) {

1042 
	`WARN
(
log
, "%s", "Notƒnoughokens for boolean change.");

1045 
tok’
 = 
	`­Ş_veùÜ_g‘_–em’t
(
tok’s
, 
pos™iÚ
);

1048 ià(!
Ãxt_lše
) {

1049 ià(!
	`¡r¡r
(
tok’
, "security:")) {

1050 
	`WARN
(
log
, "%s", "Expectedo see security here.");

1051 
has_w¬nšgs
 = 1;

1054 
pos™iÚ
++;

1055 ià(
pos™iÚ
 >ğ
num_tok’s
) {

1056 
	`WARN
(
log
, "%s", "Notƒnoughokens for boolean change.");

1059 
tok’
 = 
	`­Ş_veùÜ_g‘_–em’t
(
tok’s
, 
pos™iÚ
);

1062 ià(!
	`¡r¡r
(
tok’
, "committed")) {

1063 
	`WARN
(
log
, "%s", "Expectedo see committed here.");

1064 
has_w¬nšgs
 = 1;

1067 
pos™iÚ
++;

1068 ià(
pos™iÚ
 >ğ
num_tok’s
) {

1069 
	`WARN
(
log
, "%s", "Notƒnoughokens for boolean change.");

1072 
tok’
 = 
	`­Ş_veùÜ_g‘_–em’t
(
tok’s
, 
pos™iÚ
);

1075 ià(!
	`¡r¡r
(
tok’
, "booleans")) {

1076 
	`WARN
(
log
, "%s", "Expectedo see booleans here.");

1077 
has_w¬nšgs
 = 1;

1080 
pos™iÚ
++;

1081 ià(
pos™iÚ
 >ğ
num_tok’s
) {

1082 
	`WARN
(
log
, "%s", "Notƒnoughokens for boolean change.");

1085 
tok’
 = 
	`­Ş_veùÜ_g‘_–em’t
(
tok’s
, 
pos™iÚ
);

1088 ià(!
	`¡r¡r
(
tok’
, "{")) {

1089 
	`WARN
(
log
, "%s", "Expectedo see '{' here.");

1090 
has_w¬nšgs
 = 1;

1093 
pos™iÚ
++;

1094 ià(
pos™iÚ
 >ğ
num_tok’s
) {

1095 
	`WARN
(
log
, "%s", "Notƒnoughokens for boolean change.");

1098 
tok’
 = 
	`­Ş_veùÜ_g‘_–em’t
(
tok’s
, 
pos™iÚ
);

1104 
pos™iÚ
 < 
num_tok’s
) {

1105 
tok’
 = 
	`­Ş_veùÜ_g‘_–em’t
(
tok’s
, 
pos™iÚ
);

1106 
pos™iÚ
++;

1108 ià(!
	`¡rcmp
(
tok’
, "}")) {

1109 ià(
pos™iÚ
 < 
num_tok’s
) {

1110 
	`WARN
(
log
, "%s", "Excessokens‡fter closing brace");

1111 
has_w¬nšgs
 = 1;

1113  
has_w¬nšgs
;

1116 
»t
 = 
	`boŞ—n_msg_š£¹_boŞ
(
log
, 
boŞm
, 
tok’
);

1117 ià(
»t
 < 0) {

1118  
»t
;

1119 } ià(
»t
 > 0) {

1120 
has_w¬nšgs
 = 1;

1125 
log
->
Ãxt_lše
 = 1;

1126  
has_w¬nšgs
;

1127 
	}
}

1139 
	$lßd_pŞicy_msg_is_Şd_lßd_pŞicy_¡ršg
(cÚ¡ 
£aud™_log_t
 * 
log
, cÚ¡ 
­Ş_veùÜ_t
 * 
tok’s
, 
size_t
 * 
pos™iÚ
)

1141 
size_t
 
i
, 
Ëngth
 = 0;

1142 
¹
;

1143 *
tmp
 = 
NULL
;

1144 ià(*
pos™iÚ
 + 4 >ğ
	`­Ş_veùÜ_g‘_size
(
tok’s
)) {

1148 
i
 = 0; i < 4; i++) {

1149 
Ëngth
 +ğ
	`¡¾’
((*)
	`­Ş_veùÜ_g‘_–em’t
(
tok’s
, 
i
 + *
pos™iÚ
));

1152 ià((
tmp
 = (*)
	`ÿÎoc
(
Ëngth
 + 1, ())è=ğ
NULL
) {

1153 
”rÜ
 = 
”ºo
;

1154 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1155 
”ºo
 = 
”rÜ
;

1159 
i
 = 0; i < 4; i++) {

1160 
	`¡rÿt
(
tmp
, (*)
	`­Ş_veùÜ_g‘_–em’t
(
tok’s
, 
i
 + *
pos™iÚ
));

1163 
¹
 = 
	`¡rcmp
(
tmp
, 
OLD_LOAD_POLICY_STRING
);

1164 
	`ä“
(
tmp
);

1166 ià(
¹
 == 0) {

1167 *
pos™iÚ
 += 4;

1171 
	}
}

1173 
	$lßd_pŞicy_msg_g‘_pŞicy_compÚ’ts
(
£aud™_lßd_mes§ge_t
 * 
lßd
, cÚ¡ 
­Ş_veùÜ_t
 * 
tok’s
, 
size_t
 * 
pos™iÚ
)

1175 *
¬g
 = 
	`­Ş_veùÜ_g‘_–em’t
(
tok’s
, *
pos™iÚ
);

1176 *
’d±r
;

1177 
v®
 = ()
	`¡¹oul
(
¬g
, &
’d±r
, 10);

1178 ià(*
’d±r
 != '\0') {

1181 (*
pos™iÚ
)++;

1184 *
id
 = 
	`­Ş_veùÜ_g‘_–em’t
(
tok’s
, *
pos™iÚ
 + 1);

1185 
	`as£¹
(
id
 !ğ
NULL
 && 
¬g
 != NULL);

1186 ià(
lßd
->
şas£s
 =ğ0 && 
	`¡r¡r
(
id
, "classes")) {

1187 
lßd
->
şas£s
 = 
v®
;

1188 } ià(
lßd
->
ruËs
 =ğ0 && 
	`¡r¡r
(
id
, "rules")) {

1189 
lßd
->
ruËs
 = 
v®
;

1190 } ià(
lßd
->
u£rs
 =ğ0 && 
	`¡r¡r
(
id
, "users")) {

1191 
lßd
->
u£rs
 = 
v®
;

1192 } ià(
lßd
->
rŞes
 =ğ0 && 
	`¡r¡r
(
id
, "roles")) {

1193 
lßd
->
rŞes
 = 
v®
;

1194 } ià(
lßd
->
ty³s
 =ğ0 && 
	`¡r¡r
(
id
, "types")) {

1195 
lßd
->
ty³s
 = 
v®
;

1196 } ià(
lßd
->
boŞs
 =ğ0 && 
	`¡r¡r
(
id
, "bools")) {

1197 
lßd
->
boŞs
 = 
v®
;

1199 *
pos™iÚ
 += 2;

1200 
	}
}

1202 
	$lßd_·r£
(
£aud™_log_t
 * 
log
, cÚ¡ 
­Ş_veùÜ_t
 * 
tok’s
)

1204 
£aud™_mes§ge_t
 *
msg
;

1205 
£aud™_lßd_mes§ge_t
 *
lßd
;

1206 
£aud™_mes§ge_ty³_e
 
ty³
;

1207 
»t
, 
”rÜ
, 
has_w¬nšgs
 = 0;

1208 
size_t
 
pos™iÚ
 = 0, 
num_tok’s
 = 
	`­Ş_veùÜ_g‘_size
(
tok’s
);

1209 *
tok’
;

1211 ià(
log
->
Ãxt_lše
) {

1214 
size_t
 
num_mes§ges
 = 
	`­Ş_veùÜ_g‘_size
(
log
->
mes§ges
);

1215 
	`as£¹
(
num_mes§ges
 > 0);

1216 
msg
 = 
	`­Ş_veùÜ_g‘_–em’t
(
log
->
mes§ges
, 
num_mes§ges
 - 1);

1217 
log
->
Ãxt_lše
 = 0;

1219 ià((
msg
 = 
	`mes§ge_ü—‹
(
log
, 
SEAUDIT_MESSAGE_TYPE_LOAD
)è=ğ
NULL
) {

1223 
lßd
 = 
	`£aud™_mes§ge_g‘_d©a
(
msg
, &
ty³
);

1225 
»t
 = 
	`š£¹_¡ªd¬d_msg_h—d”
(
log
, 
tok’s
, &
pos™iÚ
, 
msg
);

1226 ià(
»t
 < 0) {

1227  
»t
;

1228 } ià(
»t
 > 0) {

1229 
has_w¬nšgs
 = 1;

1231 ià(
pos™iÚ
 >ğ
num_tok’s
) {

1232 
	`WARN
(
log
, "%s", "Notƒnoughokens for…olicy†oad.");

1235 
tok’
 = 
	`­Ş_veùÜ_g‘_–em’t
(
tok’s
, 
pos™iÚ
);

1237 ià(
	`¡rcmp
(
tok’
, "invalidating") == 0) {

1238 
	`WARN
(
log
, "%s", "Got‡n unexpected invalidating message.");

1242 ià(
pos™iÚ
 + 1 >ğ
num_tok’s
) {

1243 
	`WARN
(
log
, "%s", "Notƒnoughokens for…olicy†oad.");

1246 ià(
	`¡rcmp
((*)
	`­Ş_veùÜ_g‘_–em’t
(
tok’s
, 
pos™iÚ
 + 1), "bools") == 0) {

1247 
	`WARN
(
log
, "%s", "Got‡n unexpected bools message.");

1252 ià(!
	`¡r¡r
(
tok’
, "kernel:")) {

1253 
	`WARN
(
log
, "%s", "Expectedo see kernel here.");

1254 
has_w¬nšgs
 = 1;

1257 ià((
»t
 = 
	`š£¹_mªag”
(
log
, 
msg
, "kernel")) < 0) {

1258  
»t
;

1260 
pos™iÚ
++;

1261 ià(
pos™iÚ
 >ğ
num_tok’s
) {

1262 
	`WARN
(
log
, "%s", "Notƒnoughokens for…olicy†oad.");

1265 
tok’
 = 
	`­Ş_veùÜ_g‘_–em’t
(
tok’s
, 
pos™iÚ
);

1268 ià(
	`¡rcmp
(
tok’
, "security:")) {

1269 
	`WARN
(
log
, "%s", "Expectedo see security here.");

1270 
has_w¬nšgs
 = 1;

1273 
pos™iÚ
++;

1274 ià(
pos™iÚ
 >ğ
num_tok’s
) {

1275 
	`WARN
(
log
, "%s", "Notƒnoughokens for…olicy†oad.");

1278 
tok’
 = 
	`­Ş_veùÜ_g‘_–em’t
(
tok’s
, 
pos™iÚ
);

1281 
»t
 = 
	`lßd_pŞicy_msg_is_Şd_lßd_pŞicy_¡ršg
(
log
, 
tok’s
, &
pos™iÚ
);

1282 ià(
»t
 < 0) {

1283  
»t
;

1284 } ià(
»t
 > 0) {

1285 ià(
pos™iÚ
 >ğ
num_tok’s
) {

1286 
	`WARN
(
log
, "%s", "Notƒnoughokens for…olicy†oad.");

1289 
tok’
 = 
	`­Ş_veùÜ_g‘_–em’t
(
tok’s
, 
pos™iÚ
);

1290 ià((
lßd
->
bš¬y
 = 
	`¡rdup
(
tok’
)è=ğ
NULL
) {

1291 
”rÜ
 = 
”ºo
;

1292 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1293 
”ºo
 = 
”rÜ
;

1296 
log
->
Ãxt_lše
 = 1;

1298 
pos™iÚ
 < 
num_tok’s
) {

1299 
	`lßd_pŞicy_msg_g‘_pŞicy_compÚ’ts
(
lßd
, 
tok’s
, &
pos™iÚ
);

1304 ià(
lßd
->
şas£s
 =ğ0 ||†ßd->
ruËs
 =ğ0 ||†ßd->
u£rs
 =ğ0 ||†ßd->
rŞes
 =ğ0 ||†ßd->
ty³s
 == 0) {

1305 
log
->
Ãxt_lše
 = 1;

1308  
has_w¬nšgs
;

1309 
	}
}

1314 
	$£aud™_log_·r£_lše
(
£aud™_log_t
 * 
log
, *
lše
)

1316 *
Üig_lše
 = 
NULL
;

1317 
£aud™_mes§ge_t
 *
´ev_mes§ge
;

1318 
£aud™_mes§ge_ty³_e
 
is_£l
, 
´ev_mes§ge_ty³
;

1319 
­Ş_veùÜ_t
 *
tok’s
 = 
NULL
;

1320 
»tv®
 = -1, 
»tv®2
, 
has_w¬nšgs
 = 0, 
”rÜ
 = 0;

1322 
is_£l
 = 
	`is_£lšux
(
lše
);

1323 ià(
log
->
Ãxt_lše
) {

1324 
´ev_mes§ge
 = 
	`­Ş_veùÜ_g‘_–em’t
(
log
->
mes§ges
, 
	`­Ş_veùÜ_g‘_size
(log->messages) - 1);

1325 
	`£aud™_mes§ge_g‘_d©a
(
´ev_mes§ge
, &
´ev_mes§ge_ty³
);

1326 ià(!(
is_£l
 =ğ
SEAUDIT_MESSAGE_TYPE_INVALID
 && 
´ev_mes§ge_ty³
 =ğ
SEAUDIT_MESSAGE_TYPE_BOOL
) &&

1327 !(
is_£l
 =ğ
SEAUDIT_MESSAGE_TYPE_LOAD
 && 
´ev_mes§ge_ty³
 == SEAUDIT_MESSAGE_TYPE_LOAD)) {

1328 
	`WARN
(
log
, "%s", "Parser was inhe middle of‡†ine, but‚ext message was‚othe correct format.");

1329 
has_w¬nšgs
 = 1;

1330 
log
->
Ãxt_lše
 = 0;

1332 
is_£l
 = 
´ev_mes§ge_ty³
;

1335 ià(
is_£l
 =ğ
SEAUDIT_MESSAGE_TYPE_INVALID
) {

1340 ià((
Üig_lše
 = 
	`¡rdup
(
lše
)è=ğ
NULL
) {

1341 
”rÜ
 = 
”ºo
;

1342 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1343 
ş—nup
;

1345 ià(
	`g‘_tok’s
(
log
, 
lše
, &
tok’s
) < 0) {

1346 
”rÜ
 = 
”ºo
;

1347 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1348 
ş—nup
;

1351 
is_£l
) {

1352 
SEAUDIT_MESSAGE_TYPE_AVC
:

1353 
»tv®2
 = 
	`avc_·r£
(
log
, 
tok’s
);

1355 
SEAUDIT_MESSAGE_TYPE_BOOL
:

1356 
»tv®2
 = 
	`boŞ_·r£
(
log
, 
tok’s
);

1358 
SEAUDIT_MESSAGE_TYPE_LOAD
:

1359 
»tv®2
 = 
	`lßd_·r£
(
log
, 
tok’s
);

1363 
	`as£¹
(0);

1364 
”ºo
 = 
EINVAL
;

1365 
»tv®2
 = -1;

1367 ià(
»tv®2
 < 0) {

1368 
”rÜ
 = 
”ºo
;

1369 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1370 
ş—nup
;

1371 } ià(
»tv®2
 > 0) {

1372 ià(
	`­Ş_veùÜ_­³nd
(
log
->
m®fÜmed_msgs
, 
Üig_lše
) < 0) {

1373 
”rÜ
 = 
”ºo
;

1374 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1375 
ş—nup
;

1377 
Üig_lše
 = 
NULL
;

1378 
has_w¬nšgs
 = 1;

1381 
»tv®
 = 0;

1382 
ş—nup
:

1383 
	`ä“
(
Üig_lše
);

1384 
	`­Ş_veùÜ_de¡roy
(&
tok’s
);

1385 ià(
»tv®
 < 0) {

1386 
”ºo
 = 
”rÜ
;

1389  
has_w¬nšgs
;

1390 
	}
}

1394 
	$£aud™_log_·r£
(
£aud™_log_t
 * 
log
, 
FILE
 * 
sy¦og
)

1396 
FILE
 *
aud™_fe
 = 
sy¦og
;

1397 *
lše
 = 
NULL
;

1398 
»tv®
 = -1, 
»tv®2
, 
has_w¬nšgs
 = 0, 
”rÜ
 = 0;

1399 
size_t
 
lše_size
 = 0, 
i
;

1401 ià(
log
 =ğ
NULL
 || 
sy¦og
 == NULL) {

1402 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
EINVAL
));

1403 
”rÜ
 = 
EINVAL
;

1404 
ş—nup
;

1407 ià(!
log
->
tz_š™Ÿlized
) {

1408 
	`tz£t
();

1409 
log
->
tz_š™Ÿlized
 = 1;

1412 
	`ş—»¼
(
aud™_fe
);

1415 ià(
	`g‘lše
(&
lše
, &
lše_size
, 
aud™_fe
) < 0) {

1416 
”rÜ
 = 
”ºo
;

1417 ià(!
	`ãof
(
aud™_fe
)) {

1418 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1419 
ş—nup
;

1423 
	`­Ş_¡r_Œim
(
lše
);

1424 
»tv®2
 = 
	`£aud™_log_·r£_lše
(
log
, 
lše
);

1425 ià(
»tv®2
 < 0) {

1426 
”rÜ
 = 
”ºo
;

1427 
ş—nup
;

1428 } ià(
»tv®2
 > 0) {

1429 
has_w¬nšgs
 = 1;

1433 
»tv®
 = 0;

1434 
ş—nup
:

1435 
	`ä“
(
lše
);

1436 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
log
->
mod–s
); i++) {

1437 
£aud™_mod–_t
 *
m
 = 
	`­Ş_veùÜ_g‘_–em’t
(
log
->
mod–s
, 
i
);

1438 
	`mod–_nÙify_log_chªged
(
m
, 
log
);

1440 ià(
»tv®
 < 0) {

1441 
”ºo
 = 
”rÜ
;

1444 ià(
has_w¬nšgs
) {

1445 
	`WARN
(
log
, "%s", "Audit†og was…arsed, buthere were one or more invalid message found within it.");

1447  
has_w¬nšgs
;

1448 
	}
}

1450 
	$£aud™_log_·r£_bufãr
(
£aud™_log_t
 * 
log
, cÚ¡ *
bufãr
, cÚ¡ 
size_t
 
bufsize
)

1452 cÚ¡ *
s
;

1453 *
lše
 = 
NULL
, *
l
;

1454 
»tv®
 = -1, 
»tv®2
, 
has_w¬nšgs
 = 0, 
”rÜ
 = 0;

1455 
size_t
 
off£t
 = 0, 
lše_size
, 
i
;

1457 ià(
log
 =ğ
NULL
 || 
bufãr
 == NULL) {

1458 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
EINVAL
));

1459 
”rÜ
 = 
EINVAL
;

1460 
ş—nup
;

1463 ià(!
log
->
tz_š™Ÿlized
) {

1464 
	`tz£t
();

1465 
log
->
tz_š™Ÿlized
 = 1;

1468 
off£t
 < 
bufsize
) {

1471 
s
 = 
bufãr
 + 
off£t
; s < bufã¸+ 
bufsize
 && *s != '\n'; s++) ;

1472 
lše_size
 = 
s
 - (
bufãr
 + 
off£t
);

1473 
	`as£¹
(
lše_size
 > 0);

1474 ià((
l
 = 
	`»®loc
(
lše
, 
lše_size
 + 1)è=ğ
NULL
) {

1475 
”rÜ
 = 
”ºo
;

1476 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1477 
ş—nup
;

1479 
lše
 = 
l
;

1480 
	`memıy
(
lše
, 
bufãr
 + 
off£t
, 
lše_size
);

1481 
lše
[
lše_size
] = '\0';

1482 
off£t
 +ğ
lše_size
;

1483 ià(
s
 < 
bufãr
 + 
bufsize
) {

1485 
	`as£¹
(*
s
 == '\n');

1486 
off£t
++;

1488 
	`­Ş_¡r_Œim
(
lše
);

1489 
»tv®2
 = 
	`£aud™_log_·r£_lše
(
log
, 
lše
);

1490 ià(
»tv®2
 < 0) {

1491 
”rÜ
 = 
”ºo
;

1492 
ş—nup
;

1493 } ià(
»tv®2
 > 0) {

1494 
has_w¬nšgs
 = 1;

1498 
»tv®
 = 0;

1499 
ş—nup
:

1500 
	`ä“
(
lše
);

1501 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
log
->
mod–s
); i++) {

1502 
£aud™_mod–_t
 *
m
 = 
	`­Ş_veùÜ_g‘_–em’t
(
log
->
mod–s
, 
i
);

1503 
	`mod–_nÙify_log_chªged
(
m
, 
log
);

1505 ià(
»tv®
 < 0) {

1506 
”ºo
 = 
”rÜ
;

1509 ià(
has_w¬nšgs
) {

1510 
	`WARN
(
log
, "%s", "Audit†og was…arsed, buthere were one or more invalid message found within it.");

1512  
has_w¬nšgs
;

1513 
	}
}

	@libseaudit/src/report.c

25 
	~"£aud™_š‹º®.h
"

27 
	~<£aud™/»pÜt.h
>

29 
	~<­Ş/ut.h
>

30 
	~<libxml/xmÌ—d”.h
>

32 
	~<as£¹.h
>

33 
	~<”ºo.h
>

34 
	~<¡dio.h
>

35 
	~<¡dlib.h
>

36 
	~<¡ršg.h
>

37 
	~<uni¡d.h
>

39 
	#CONFIG_FILE
 "£aud™-»pÜt.cÚf"

	)

40 
	#STYLESHEET_FILE
 "£aud™-»pÜt.css"

	)

41 
	#LINE_MAX
 1024

	)

43 
	s£aud™_»pÜt


46 
£aud™_»pÜt_fÜm©_e
 
	mfÜm©
;

48 *
	mcÚfig
;

50 *
	m¡yËsh“t
;

52 
	mu£_¡yËsh“t
;

54 
	mm®fÜmed
;

56 
£aud™_mod–_t
 *
	mmod–
;

59 cÚ¡ *
	g£aud™_»pÜt_node_Çmes
[] = {

64 
NULL


67 cÚ¡ *
	g£aud™_¡ªd¬d_£ùiÚ_Çmes
[] = {

74 
NULL


77 
£aud™_»pÜt_t
 *
	$£aud™_»pÜt_ü—‹
(
£aud™_mod–_t
 * 
mod–
)

79 
£aud™_»pÜt_t
 *
r
 = 
	`ÿÎoc
(1, (*r));

80 ià(
r
 =ğ
NULL
) {

81  
NULL
;

83 
r
->
mod–
 = model;

84  
r
;

85 
	}
}

87 
	$£aud™_»pÜt_de¡roy
(
£aud™_»pÜt_t
 ** 
»pÜt
)

89 ià(
»pÜt
 =ğ
NULL
 || *report == NULL) {

92 
	`ä“
((*
»pÜt
)->
cÚfig
);

93 
	`ä“
((*
»pÜt
)->
¡yËsh“t
);

94 
	`ä“
(*
»pÜt
);

95 *
»pÜt
 = 
NULL
;

96 
	}
}

98 
	$£aud™_»pÜt_£t_fÜm©
(cÚ¡ 
£aud™_log_t
 * 
log
, 
£aud™_»pÜt_t
 * 
»pÜt
, 
£aud™_»pÜt_fÜm©_e
 
fÜm©
)

100 ià(
»pÜt
 =ğ
NULL
) {

101 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
EINVAL
));

102 
”ºo
 = 
EINVAL
;

105 
»pÜt
->
fÜm©
 = format;

107 
	}
}

112 
	$»pÜt_£t_deçuÉ_cÚfigu¿tiÚ
(cÚ¡ 
£aud™_log_t
 * 
log
, 
£aud™_»pÜt_t
 * 
»pÜt
)

114 *
cÚfig_dœ
 = 
	`­Ş_fe_fšd
(
CONFIG_FILE
);

115 
”rÜ
;

117 ià(
cÚfig_dœ
 =ğ
NULL
) {

118 
”rÜ
 = 
”ºo
;

119 
	`ERR
(
log
, "%s", "Could‚ot find default configuration file.");

120 
”ºo
 = 
”rÜ
;

123 ià(
	`a¥rštf
(&
»pÜt
->
cÚfig
, "%s/%s", 
cÚfig_dœ
, 
CONFIG_FILE
) < 0) {

124 
”rÜ
 = 
”ºo
;

125 
»pÜt
->
cÚfig
 = 
NULL
;

126 
	`ä“
(
cÚfig_dœ
);

127 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
”rÜ
));

128 
”ºo
 = 
”rÜ
;

131 
	`ä“
(
cÚfig_dœ
);

134 ià(
	`acûss
(
»pÜt
->
cÚfig
, 
R_OK
) != 0) {

135 
”rÜ
 = 
”ºo
;

136 
	`ERR
(
log
, "Could‚Ù„—d deçuÉ cÚfig f%s.", 
»pÜt
->
cÚfig
);

137 
”ºo
 = 
”rÜ
;

141 
	}
}

143 
	$£aud™_»pÜt_£t_cÚfigu¿tiÚ
(cÚ¡ 
£aud™_log_t
 * 
log
, 
£aud™_»pÜt_t
 * 
»pÜt
, cÚ¡ *
fe
)

145 ià(
»pÜt
 =ğ
NULL
) {

146 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
EINVAL
));

147 
”ºo
 = 
EINVAL
;

150 
	`ä“
(
»pÜt
->
cÚfig
);

151 
»pÜt
->
cÚfig
 = 
NULL
;

152 ià(
fe
 =ğ
NULL
) {

153  
	`»pÜt_£t_deçuÉ_cÚfigu¿tiÚ
(
log
, 
»pÜt
);

155 ià((
»pÜt
->
cÚfig
 = 
	`¡rdup
(
fe
)è=ğ
NULL
) {

156 
”rÜ
 = 
”ºo
;

157 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
”rÜ
));

158 
”ºo
 = 
”rÜ
;

163 
	}
}

168 
	$»pÜt_£t_deçuÉ_¡yËsh“t
(cÚ¡ 
£aud™_log_t
 * 
log
, 
£aud™_»pÜt_t
 * 
»pÜt
)

170 *
dœ
 = 
	`­Ş_fe_fšd
(
STYLESHEET_FILE
);

171 
”rÜ
;

172 ià(
dœ
 =ğ
NULL
) {

173 
”rÜ
 = 
”ºo
;

174 
	`ERR
(
log
, "%s", "Could‚ot find default stylesheet.");

175 
”ºo
 = 
”rÜ
;

179 ià(
	`a¥rštf
(&
»pÜt
->
¡yËsh“t
, "%s/%s", 
dœ
, 
STYLESHEET_FILE
) < 0) {

180 
”rÜ
 = 
”ºo
;

181 
»pÜt
->
¡yËsh“t
 = 
NULL
;

182 
	`ä“
(
dœ
);

183 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
”rÜ
));

184 
”ºo
 = 
”rÜ
;

187 
	`ä“
(
dœ
);

190 
	}
}

192 
	$£aud™_»pÜt_£t_¡yËsh“t
(cÚ¡ 
£aud™_log_t
 * 
log
, 
£aud™_»pÜt_t
 * 
»pÜt
, cÚ¡ *
fe
, cÚ¡ 
u£_¡yËsh“t
)

194 ià(
»pÜt
 =ğ
NULL
) {

195 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
EINVAL
));

196 
”ºo
 = 
EINVAL
;

199 
	`ä“
(
»pÜt
->
¡yËsh“t
);

200 
»pÜt
->
¡yËsh“t
 = 
NULL
;

201 
»pÜt
->
u£_¡yËsh“t
 = use_stylesheet;

202 ià(
fe
 =ğ
NULL
) {

203  
	`»pÜt_£t_deçuÉ_¡yËsh“t
(
log
, 
»pÜt
);

205 ià((
»pÜt
->
¡yËsh“t
 = 
	`¡rdup
(
fe
)è=ğ
NULL
) {

207 
”rÜ
 = 
”ºo
;

208 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
”rÜ
));

209 
”ºo
 = 
”rÜ
;

214 
	}
}

216 
	$£aud™_»pÜt_£t_m®fÜmed
(cÚ¡ 
£aud™_log_t
 * 
log
, 
£aud™_»pÜt_t
 * 
»pÜt
, cÚ¡ 
do_m®fÜmed
)

218 ià(
»pÜt
 =ğ
NULL
) {

219 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
EINVAL
));

220 
”ºo
 = 
EINVAL
;

223 
»pÜt
->
m®fÜmed
 = 
do_m®fÜmed
;

225 
	}
}

232 
	$»pÜt_impÜt_html_¡yËsh“t
(cÚ¡ 
£aud™_log_t
 * 
log
, cÚ¡ 
£aud™_»pÜt_t
 * 
»pÜt
, 
FILE
 * 
outfe
)

234 
lše
[
LINE_MAX
], *
lše_±r
 = 
NULL
;

235 
FILE
 *
å
;

237 ià(
»pÜt
->
u£_¡yËsh“t
) {

238 
å
 = 
	`fİ’
(
»pÜt
->
¡yËsh“t
, "r");

239 ià(
å
 =ğ
NULL
) {

240 
	`WARN
(
log
, "CªnÙ o³À¡yËsh“ˆf%s.", 
»pÜt
->
¡yËsh“t
);

243 
	`årštf
(
outfe
, "<styleype=\"text/css\">\n");

245 
	`fg‘s
(
lše
, 
LINE_MAX
, 
å
è!ğ
NULL
) {

246 
	`ä“
(
lše_±r
);

247 
lše_±r
 = 
NULL
;

248 ià((
lše_±r
 = 
	`¡rdup
(
lše
)è=ğ
NULL
) {

249 
”rÜ
 = 
”ºo
;

250 
	`ä“
(
lše_±r
);

251 
	`fşo£
(
å
);

252 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
”rÜ
));

253 
”ºo
 = 
”rÜ
;

256 
	`­Ş_¡r_Œim
(
lše_±r
);

257 ià(
lše_±r
[0] =ğ'#' || 
	`­Ş_¡r_is_Úly_wh™e_¥aû
(line_ptr))

259 
	`årštf
(
outfe
, "%s\n", 
lše_±r
);

261 
	`årštf
(
outfe
, "</style>\n");

262 
	`fşo£
(
å
);

263 
	`ä“
(
lše_±r
);

266 
	}
}

268 
	$»pÜt_´št_h—d”
(cÚ¡ 
£aud™_log_t
 * 
log
, cÚ¡ 
£aud™_»pÜt_t
 * 
»pÜt
, 
FILE
 * 
outfe
)

270 
time_t
 
Éime
;

272 
	`time
(&
Éime
);

273 ià(
»pÜt
->
fÜm©
 =ğ
SEAUDIT_REPORT_FORMAT_HTML
) {

274 
	`årštf
(
outfe
, "<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 3.2 Final//EN\">\n");

275 
	`årštf
(
outfe
, "<html>\n<head>\n");

276 ià(
	`»pÜt_impÜt_html_¡yËsh“t
(
log
, 
»pÜt
, 
outfe
) < 0) {

279 
	`årštf
(
outfe
, "<title>seaudit-report</title>\n</head>\n");

280 
	`årštf
(
outfe
, "<body>\n");

281 
	`årštf
(
outfe
, "<b cÏss=\"»pÜt_d©e\"># R•Üˆg’”©ed by s—ud™-»pÜˆÚ %s</b><br>\n", 
	`ùime
(&
Éime
));

283 
	`årštf
(
outfe
, "# Begin\n\n");

284 
	`årštf
(
outfe
, "# R•Üˆg’”©ed by s—ud™-»pÜˆÚ %s\n", 
	`ùime
(&
Éime
));

287 
	}
}

289 
	$»pÜt_´št_foÙ”
(cÚ¡ 
£aud™_»pÜt_t
 * 
»pÜt
, 
FILE
 * 
outfe
)

291 ià(
»pÜt
->
fÜm©
 =ğ
SEAUDIT_REPORT_FORMAT_HTML
) {

292 
	`årštf
(
outfe
, "</body>\n</html>\n");

294 
	`årštf
(
outfe
, "# End\n");

297 
	}
}

299 
	$»pÜt_is_v®id_node_Çme
(cÚ¡ *
Çme
)

301 
size_t
 
i
;

302 
i
 = 0; 
£aud™_»pÜt_node_Çmes
[i] !ğ
NULL
; i++)

303 ià(
	`¡rcmp
(
£aud™_»pÜt_node_Çmes
[
i
], 
Çme
) == 0)

306 
	}
}

308 
	$»pÜt_is_v®id_£ùiÚ_Çme
(cÚ¡ *
Çme
)

310 
size_t
 
i
;

311 
i
 = 0; 
£aud™_¡ªd¬d_£ùiÚ_Çmes
[i] !ğ
NULL
; i++)

312 ià(
	`¡rcmp
(
£aud™_¡ªd¬d_£ùiÚ_Çmes
[
i
], 
Çme
) == 0)

315 
	}
}

317 
»pÜt_·r£_£aud™_»pÜt
(cÚ¡ 
£aud™_log_t
 * 
log
, cÚ¡ 
£aud™_»pÜt_t
 * 
»pÜt
 
__©Œibu‹__
 ((
unu£d
)),

318 
xmlTextR—d”PŒ
 
»ad”
, 
xmlCh¬
 ** 
id_v®ue


319 
__©Œibu‹__
 ((
unu£d
)), 
xmlCh¬
 ** 
t™Ë_v®ue
)

321 
	g¹
, 
	g”rÜ
;

322 
xmlCh¬
 *
	gÇme
 = 
NULL
;

324 ià(
xmlTextR—d”NodeTy³
(
»ad”
è=ğ1 && 
xmlTextR—d”A‰ribu‹CouÁ
(reader) > 0) {

326 
¹
 = 
xmlTextR—d”MoveToNextA‰ribu‹
(
»ad”
);

327 
	g¹
 > 0) {

328 
	gÇme
 = 
xmlTextR—d”Name
(
»ad”
);

329 ià(
	gÇme
 =ğ
NULL
) {

330 
”rÜ
 = 
”ºo
;

331 
ERR
(
log
, "%s", "Attribute‚ame unavailable.");

332 
	g”ºo
 = 
”rÜ
;

335 ià(
¡rcmp
((*)
Çme
, "title") == 0) {

336 *
t™Ë_v®ue
 = 
xmlTextR—d”V®ue
(
»ad”
);

339 
xmlF»e
(
Çme
);

340 
	g¹
 = 
xmlTextR—d”MoveToNextA‰ribu‹
(
»ad”
);

342 ià(
	g¹
 < 0) {

343 
	g”rÜ
 = 
”ºo
;

344 
ERR
(
log
, "%s", "Error…arsing‡ttribute for seaudit-report‚ode.");

345 
	g”ºo
 = 
”rÜ
;

352 
»pÜt_·r£_¡ªd¬d_©Œibs
(cÚ¡ 
£aud™_log_t
 * 
log
, cÚ¡ 
£aud™_»pÜt_t
 * 
»pÜt
 
__©Œibu‹__
 ((
unu£d
)),

353 
xmlTextR—d”PŒ
 
»ad”
, 
xmlCh¬
 ** 
id_v®ue
, xmlCh¬ ** 
t™Ë_v®ue
)

355 
	g¹
, 
	g”rÜ
;

356 
xmlCh¬
 *
	gÇme
 = 
NULL
;

358 ià(
xmlTextR—d”NodeTy³
(
»ad”
è=ğ1 && 
xmlTextR—d”A‰ribu‹CouÁ
(reader) > 0) {

360 
¹
 = 
xmlTextR—d”MoveToNextA‰ribu‹
(
»ad”
);

361 
	g¹
 > 0) {

362 
	gÇme
 = 
xmlTextR—d”Name
(
»ad”
);

363 ià(
	gÇme
 =ğ
NULL
) {

364 
”rÜ
 = 
”ºo
;

365 
ERR
(
log
, "%s", "Attribute‚ame unavailable.");

366 
	g”ºo
 = 
”rÜ
;

369 ià(
¡rcmp
((*)
Çme
, "id") == 0) {

370 *
id_v®ue
 = 
xmlTextR—d”V®ue
(
»ad”
);

371 } ià(
¡rcmp
((*)
Çme
, "title") == 0) {

372 *
t™Ë_v®ue
 = 
xmlTextR—d”V®ue
(
»ad”
);

374 
xmlF»e
(
Çme
);

375 
	g¹
 = 
xmlTextR—d”MoveToNextA‰ribu‹
(
»ad”
);

377 ià(
	g¹
 < 0) {

378 
	g”rÜ
 = 
”ºo
;

379 
ERR
(
log
, "%s", "Error…arsing‡ttribute for standard-section‚ode.");

380 
	g”ºo
 = 
”rÜ
;

387 
»pÜt_·r£_cu¡om_©Œibs
(cÚ¡ 
£aud™_log_t
 * 
log
, cÚ¡ 
£aud™_»pÜt_t
 * 
»pÜt
 
__©Œibu‹__
 ((
unu£d
)),

388 
xmlTextR—d”PŒ
 
»ad”
, 
xmlCh¬
 ** 
t™Ë_v®ue
)

390 
	g¹
, 
	g”rÜ
;

391 
xmlCh¬
 *
	gÇme
 = 
NULL
;

393 ià(
xmlTextR—d”NodeTy³
(
»ad”
è=ğ1 && 
xmlTextR—d”A‰ribu‹CouÁ
(reader) > 0) {

395 
¹
 = 
xmlTextR—d”MoveToNextA‰ribu‹
(
»ad”
);

396 
	g¹
 > 0) {

397 
	gÇme
 = 
xmlTextR—d”Name
(
»ad”
);

398 ià(
	gÇme
 =ğ
NULL
) {

399 
”rÜ
 = 
”ºo
;

400 
ERR
(
log
, "%s", "Attribute‚ame unavailable.");

401 
	g”ºo
 = 
”rÜ
;

404 ià(
¡rcmp
((*)
Çme
, "title") == 0) {

405 *
t™Ë_v®ue
 = 
xmlTextR—d”V®ue
(
»ad”
);

408 
xmlF»e
(
Çme
);

409 
	g¹
 = 
xmlTextR—d”MoveToNextA‰ribu‹
(
»ad”
);

411 ià(
	g¹
 < 0) {

412 
	g”rÜ
 = 
”ºo
;

413 
ERR
(
log
, "%s", "Error…arsing‡ttribute for custom-section‚ode.");

414 
	g”ºo
 = 
”rÜ
;

425 
£aud™_f‹r_t
 *
»pÜt_’fÜû_toggË_f‹r_ü—‹
(cÚ¡ 
£aud™_log_t
 * 
log
, cÚ¡ 
£aud™_»pÜt_t
 * 
»pÜt


426 
__©Œibu‹__
 ((
unu£d
)))

428 
£aud™_f‹r_t
 *
	gf‹r
 = 
NULL
;

429 
­Ş_veùÜ_t
 *
	gty³_v
 = 
NULL
, *
	gşass_v
;

430 
	g»tv®
 = -1, 
	g”rÜ
 = 0;

431 *
	gtgt_ty³
 = "security_t";

432 *
	gobj_şass
 = "security";

434 ià((
	gf‹r
 = 
£aud™_f‹r_ü—‹
(
NULL
)) == NULL) {

435 
”rÜ
 = 
”ºo
;

436 
ERR
(
log
, "%s", 
¡»¼Ü
(
”rÜ
));

437 
	gş—nup
;

439 ià((
	gty³_v
 = 
­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(1, 
NULL
)) == NULL ||

440 
­Ş_veùÜ_­³nd
(
ty³_v
, 
tgt_ty³
è< 0 || 
£aud™_f‹r_£t_rg‘_ty³
(
f‹r
,ype_v) < 0) {

441 
	g”rÜ
 = 
”ºo
;

442 
ERR
(
log
, "%s", 
¡»¼Ü
(
”rÜ
));

443 
	gş—nup
;

445 ià((
	gşass_v
 = 
­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(1, 
NULL
)) == NULL ||

446 
­Ş_veùÜ_­³nd
(
şass_v
, 
obj_şass
è< 0 || 
£aud™_f‹r_£t_rg‘_şass
(
f‹r
, class_v) < 0) {

447 
	g”rÜ
 = 
”ºo
;

448 
ERR
(
log
, "%s", 
¡»¼Ü
(
”rÜ
));

449 
	gş—nup
;

451 
	g»tv®
 = 0;

452 
	gş—nup
:

453 
­Ş_veùÜ_de¡roy
(&
ty³_v
);

454 
­Ş_veùÜ_de¡roy
(&
şass_v
);

455 ià(
	g»tv®
 != 0) {

456 
£aud™_f‹r_de¡roy
(&
f‹r
);

457 
	g”ºo
 = 
”rÜ
;

458  
	gNULL
;

460  
	gf‹r
;

463 
	$»pÜt_´št_’fÜû_toggËs
(cÚ¡ 
£aud™_log_t
 * 
log
, cÚ¡ 
£aud™_»pÜt_t
 * 
»pÜt
, 
FILE
 * 
outfe
)

465 
£aud™_f‹r_t
 *
f‹r
 = 
NULL
;

466 
£aud™_mod–_t
 *
dup_mod–
 = 
NULL
;

467 
size_t
 
i
, 
j
, 
num_£‹nfÜû
 = 0;

468 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

469 
£aud™_mes§ge_t
 *
msg
;

470 
£aud™_avc_mes§ge_t
 *
avc
;

471 
£aud™_mes§ge_ty³_e
 
ty³
;

472 *
s
;

473 *
³rm
 = "setenforce";

474 
»tv®
 = -1, 
”rÜ
 = 0;

476 ià((
f‹r
 = 
	`»pÜt_’fÜû_toggË_f‹r_ü—‹
(
log
, 
»pÜt
)è=ğ
NULL
) {

477 
”rÜ
 = 
”ºo
;

478 
ş—nup
;

480 ià((
dup_mod–
 = 
	`£aud™_mod–_ü—‹_äom_mod–
(
»pÜt
->
mod–
)è=ğ
NULL
 ||

481 
	`£aud™_mod–_­³nd_f‹r
(
dup_mod–
, 
f‹r
) < 0) {

482 
”rÜ
 = 
”ºo
;

483 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
”rÜ
));

484 
ş—nup
;

486 
f‹r
 = 
NULL
;

489 
v
 = 
	`£aud™_mod–_g‘_mes§ges
(
log
, 
dup_mod–
);

490 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v
); i++) {

491 
msg
 = 
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

492 
avc
 = 
	`£aud™_mes§ge_g‘_d©a
(
msg
, &
ty³
);

493 ià(
ty³
 !ğ
SEAUDIT_MESSAGE_TYPE_AVC
 || 
avc
->
msg
 =ğ
SEAUDIT_AVC_DENIED
)

495 ià(
	`­Ş_veùÜ_g‘_šdex
(
avc
->
³rms
, 
³rm
, 
­Ş_¡r_¡rcmp
, 
NULL
, &
j
) == 0) {

497 
num_£‹nfÜû
++;

503 ià(
»pÜt
->
fÜm©
 =ğ
SEAUDIT_REPORT_FORMAT_HTML
)

504 
	`årštf
(
outfe
,

506 
num_£‹nfÜû
);

508 
	`årštf
(
outfe
, "Numb” oàmes§ges: %zd\n\n", 
num_£‹nfÜû
);

510 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v
); i++) {

511 
msg
 = 
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

512 
avc
 = 
	`£aud™_mes§ge_g‘_d©a
(
msg
, &
ty³
);

513 ià(
ty³
 !ğ
SEAUDIT_MESSAGE_TYPE_AVC
 ||

514 
avc
->
msg
 =ğ
SEAUDIT_AVC_DENIED
 || 
	`­Ş_veùÜ_g‘_šdex
×vc->
³rms
, 
³rm
, 
­Ş_¡r_¡rcmp
, 
NULL
, &
j
) < 0) {

517 ià(
»pÜt
->
fÜm©
 =ğ
SEAUDIT_REPORT_FORMAT_HTML
) {

518 
s
 = 
	`£aud™_mes§ge_to_¡ršg_html
(
msg
);

520 
s
 = 
	`£aud™_mes§ge_to_¡ršg
(
msg
);

522 ià(
s
 =ğ
NULL
) {

523 
”rÜ
 = 
”ºo
;

524 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
”rÜ
));

525 
ş—nup
;

527 
	`åuts
(
s
, 
outfe
);

528 
	`åutc
('\n', 
outfe
);

529 
	`ä“
(
s
);

531 
»tv®
 = 0;

532 
ş—nup
:

533 
	`­Ş_veùÜ_de¡roy
(&
v
);

534 
	`£aud™_f‹r_de¡roy
(&
f‹r
);

535 
	`£aud™_mod–_de¡roy
(&
dup_mod–
);

536 ià(
”rÜ
 != 0) {

537 
”ºo
 = 
”rÜ
;

539  
»tv®
;

540 
	}
}

542 
	$»pÜt_´št_pŞicy_boŞ—ns
(cÚ¡ 
£aud™_log_t
 * 
log
, cÚ¡ 
£aud™_»pÜt_t
 * 
»pÜt
, 
FILE
 * 
outfe
)

544 
size_t
 
i
, 
num
 = 
	`£aud™_mod–_g‘_num_boŞs
(
log
, 
»pÜt
->
mod–
);

545 
­Ş_veùÜ_t
 *
v
 = 
	`£aud™_mod–_g‘_mes§ges
(
log
, 
»pÜt
->
mod–
);

546 
£aud™_mes§ge_t
 *
m
;

547 
£aud™_mes§ge_ty³_e
 
ty³
;

548 *
s
;

549 ià(
»pÜt
->
fÜm©
 =ğ
SEAUDIT_REPORT_FORMAT_HTML
)

550 
	`årštf
(
outfe
,

552 
num
);

554 
	`årštf
(
outfe
, "Numb” oàmes§ges: %zd\n\n", 
num
);

556 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v
); i++) {

557 
m
 = 
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

558 
	`£aud™_mes§ge_g‘_d©a
(
m
, &
ty³
);

559 ià(
ty³
 =ğ
SEAUDIT_MESSAGE_TYPE_BOOL
) {

560 ià(
»pÜt
->
fÜm©
 =ğ
SEAUDIT_REPORT_FORMAT_HTML
) {

561 
s
 = 
	`£aud™_mes§ge_to_¡ršg_html
(
m
);

563 
s
 = 
	`£aud™_mes§ge_to_¡ršg
(
m
);

565 ià(
s
 =ğ
NULL
) {

566 
”rÜ
 = 
”ºo
;

567 
	`­Ş_veùÜ_de¡roy
(&
v
);

568 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
”rÜ
));

569 
”ºo
 = 
”rÜ
;

572 
	`åuts
(
s
, 
outfe
);

573 
	`åutc
('\n', 
outfe
);

574 
	`ä“
(
s
);

577 
	`­Ş_veùÜ_de¡roy
(&
v
);

579 
	}
}

581 
	$»pÜt_´št_pŞicy_lßds
(cÚ¡ 
£aud™_log_t
 * 
log
, cÚ¡ 
£aud™_»pÜt_t
 * 
»pÜt
, 
FILE
 * 
outfe
)

583 
size_t
 
i
, 
num
 = 
	`£aud™_mod–_g‘_num_lßds
(
log
, 
»pÜt
->
mod–
);

584 
­Ş_veùÜ_t
 *
v
 = 
	`£aud™_mod–_g‘_mes§ges
(
log
, 
»pÜt
->
mod–
);

585 
£aud™_mes§ge_t
 *
m
;

586 
£aud™_mes§ge_ty³_e
 
ty³
;

587 *
s
;

588 ià(
»pÜt
->
fÜm©
 =ğ
SEAUDIT_REPORT_FORMAT_HTML
)

589 
	`årštf
(
outfe
,

591 
num
);

593 
	`årštf
(
outfe
, "Numb” oàmes§ges: %zd\n\n", 
num
);

595 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v
); i++) {

596 
m
 = 
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

597 
	`£aud™_mes§ge_g‘_d©a
(
m
, &
ty³
);

598 ià(
ty³
 =ğ
SEAUDIT_MESSAGE_TYPE_LOAD
) {

599 ià(
»pÜt
->
fÜm©
 =ğ
SEAUDIT_REPORT_FORMAT_HTML
) {

600 
s
 = 
	`£aud™_mes§ge_to_¡ršg_html
(
m
);

602 
s
 = 
	`£aud™_mes§ge_to_¡ršg
(
m
);

604 ià(
s
 =ğ
NULL
) {

605 
”rÜ
 = 
”ºo
;

606 
	`­Ş_veùÜ_de¡roy
(&
v
);

607 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
”rÜ
));

608 
”ºo
 = 
”rÜ
;

611 
	`åuts
(
s
, 
outfe
);

612 
	`åutc
('\n', 
outfe
);

613 
	`ä“
(
s
);

616 
	`­Ş_veùÜ_de¡roy
(&
v
);

618 
	}
}

620 
	$»pÜt_´št_avc_li¡šg
(cÚ¡ 
£aud™_log_t
 * 
log
, cÚ¡ 
£aud™_»pÜt_t
 * 
»pÜt
, 
£aud™_avc_mes§ge_ty³_e
 
avc_ty³
,

621 
FILE
 * 
outfe
)

623 
size_t
 
i
, 
num
;

624 
­Ş_veùÜ_t
 *
v
 = 
	`£aud™_mod–_g‘_mes§ges
(
log
, 
»pÜt
->
mod–
);

625 
£aud™_mes§ge_t
 *
m
;

626 
£aud™_avc_mes§ge_t
 *
avc
;

627 
£aud™_mes§ge_ty³_e
 
ty³
;

628 *
s
;

629 ià(
avc_ty³
 =ğ
SEAUDIT_AVC_GRANTED
) {

630 
num
 = 
	`£aud™_mod–_g‘_num_®lows
(
log
, 
»pÜt
->
mod–
);

632 
num
 = 
	`£aud™_mod–_g‘_num_d’›s
(
log
, 
»pÜt
->
mod–
);

634 ià(
»pÜt
->
fÜm©
 =ğ
SEAUDIT_REPORT_FORMAT_HTML
)

635 
	`årštf
(
outfe
,

637 
num
);

639 
	`årštf
(
outfe
, "Numb” oàmes§ges: %zd\n\n", 
num
);

641 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v
); i++) {

642 
m
 = 
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

643 
avc
 = 
	`£aud™_mes§ge_g‘_d©a
(
m
, &
ty³
);

644 ià(
ty³
 =ğ
SEAUDIT_MESSAGE_TYPE_AVC
 && 
avc
->
msg
 =ğ
avc_ty³
) {

645 ià(
»pÜt
->
fÜm©
 =ğ
SEAUDIT_REPORT_FORMAT_HTML
) {

646 
s
 = 
	`£aud™_mes§ge_to_¡ršg_html
(
m
);

648 
s
 = 
	`£aud™_mes§ge_to_¡ršg
(
m
);

650 ià(
s
 =ğ
NULL
) {

651 
”rÜ
 = 
”ºo
;

652 
	`­Ş_veùÜ_de¡roy
(&
v
);

653 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
”rÜ
));

654 
”ºo
 = 
”rÜ
;

657 
	`åuts
(
s
, 
outfe
);

658 
	`åutc
('\n', 
outfe
);

659 
	`ä“
(
s
);

662 
	`­Ş_veùÜ_de¡roy
(&
v
);

664 
	}
}

666 
	$»pÜt_´št_¡©s
(cÚ¡ 
£aud™_log_t
 * 
log
, cÚ¡ 
£aud™_»pÜt_t
 * 
»pÜt
, 
FILE
 * 
outfe
)

668 
­Ş_veùÜ_t
 *
v
 = 
	`£aud™_mod–_g‘_mes§ges
(
log
, 
»pÜt
->
mod–
);

669 
size_t
 
num_mes§ges
 = 
	`­Ş_veùÜ_g‘_size
(
v
);

670 
	`­Ş_veùÜ_de¡roy
(&
v
);

671 ià(
»pÜt
->
fÜm©
 =ğ
SEAUDIT_REPORT_FORMAT_HTML
) {

672 
	`årštf
(
outfe
,

674 
num_mes§ges
);

675 
	`årštf
(
outfe
,

677 
	`£aud™_mod–_g‘_num_lßds
(
log
, 
»pÜt
->
mod–
));

678 
	`årštf
(
outfe
,

680 
	`£aud™_mod–_g‘_num_boŞs
(
log
, 
»pÜt
->
mod–
));

681 
	`årštf
(
outfe
,

683 
	`£aud™_mod–_g‘_num_®lows
(
log
, 
»pÜt
->
mod–
));

684 
	`årštf
(
outfe
,

686 
	`£aud™_mod–_g‘_num_d’›s
(
log
, 
»pÜt
->
mod–
));

688 
	`årštf
(
outfe
, "Numb” oàtÙ® mes§ges: %zd\n", 
num_mes§ges
);

689 
	`årštf
(
outfe
, "Numb” oàpŞicy†ßd mes§ges: %zd\n", 
	`£aud™_mod–_g‘_num_lßds
(
log
, 
»pÜt
->
mod–
));

690 
	`årštf
(
outfe
, "Numb” oàpŞicy boŞ—Àmes§ges: %zd\n", 
	`£aud™_mod–_g‘_num_boŞs
(
log
, 
»pÜt
->
mod–
));

691 
	`årštf
(
outfe
, "Numb” oà®low mes§ges: %zd\n", 
	`£aud™_mod–_g‘_num_®lows
(
log
, 
»pÜt
->
mod–
));

692 
	`årštf
(
outfe
, "Numb” oàd’›d mes§ges: %zd\n", 
	`£aud™_mod–_g‘_num_d’›s
(
log
, 
»pÜt
->
mod–
));

695 
	}
}

697 
	$»pÜt_´št_¡ªd¬d_£ùiÚ
(cÚ¡ 
£aud™_log_t
 * 
log
, cÚ¡ 
£aud™_»pÜt_t
 * 
»pÜt
,

698 
xmlCh¬
 * 
id
, xmlCh¬ * 
t™Ë
, 
FILE
 * 
outfe
)

700 
size_t
 
sz
, 
Ën
, 
i
;

701 
¹
 = 0;

703 ià(!
	`»pÜt_is_v®id_£ùiÚ_Çme
((*)
id
)) {

704 
	`ERR
(
log
, "%s", "Invalid standard section ID.");

705 
”ºo
 = 
EINVAL
;

708 
sz
 = 
	`¡¾’
((*)
id
);

709 ià(
t™Ë
 !ğ
NULL
) {

710 ià(
»pÜt
->
fÜm©
 =ğ
SEAUDIT_REPORT_FORMAT_HTML
) {

711 
	`årštf
(
outfe
, "<h2 cÏss=\"¡ªd¬d_£ùiÚ_t™Ë\"><u>%s</h2></u>\n", 
t™Ë
);

713 
	`årštf
(
outfe
, "%s\n", 
t™Ë
);

714 
Ën
 = 
	`¡¾’
((*)
t™Ë
);

715 
i
 = 0; i < 
Ën
; i++) {

716 
	`årštf
(
outfe
, "-");

718 
	`årštf
(
outfe
, "\n");

721 ià(
	`¡ºÿ£cmp
((*)
id
, "PŞicyLßds", 
sz
) == 0) {

722 
¹
 = 
	`»pÜt_´št_pŞicy_lßds
(
log
, 
»pÜt
, 
outfe
);

723 } ià(
	`¡ºÿ£cmp
((*)
id
, "EnfÜûm’tToggËs", 
sz
) == 0) {

724 
¹
 = 
	`»pÜt_´št_’fÜû_toggËs
(
log
, 
»pÜt
, 
outfe
);

725 } ià(
	`¡ºÿ£cmp
((*)
id
, "PŞicyBoŞ—ns", 
sz
) == 0) {

726 
¹
 = 
	`»pÜt_´št_pŞicy_boŞ—ns
(
log
, 
»pÜt
, 
outfe
);

727 } ià(
	`¡ºÿ£cmp
((*)
id
, "AÎowLi¡šg", 
sz
) == 0) {

728 
¹
 = 
	`»pÜt_´št_avc_li¡šg
(
log
, 
»pÜt
, 
SEAUDIT_AVC_GRANTED
, 
outfe
);

729 } ià(
	`¡ºÿ£cmp
((*)
id
, "D’yLi¡šg", 
sz
) == 0) {

730 
¹
 = 
	`»pÜt_´št_avc_li¡šg
(
log
, 
»pÜt
, 
SEAUDIT_AVC_DENIED
, 
outfe
);

731 } ià(
	`¡ºÿ£cmp
((*)
id
, "Sti¡ics", 
sz
) == 0) {

732 
¹
 = 
	`»pÜt_´št_¡©s
(
log
, 
»pÜt
, 
outfe
);

734 ià(
¹
 < 0) {

735  
¹
;

738 ià(
»pÜt
->
fÜm©
 =ğ
SEAUDIT_REPORT_FORMAT_HTML
)

739 
	`årštf
(
outfe
, "<br>\n");

741 
	`årštf
(
outfe
, "\n");

744 
	}
}

746 
	$»pÜt_´št_lßded_v›w
(cÚ¡ 
£aud™_log_t
 * 
log
, cÚ¡ 
£aud™_»pÜt_t
 * 
»pÜt
, 
xmlCh¬
 * 
v›w_feP©h
,

747 
FILE
 * 
outfe
)

749 
size_t
 
i
, 
f‹rs_added
 = 0;

750 
­Ş_veùÜ_t
 *
lßded_f‹rs
 = 
NULL
;

751 
£aud™_mod–_t
 *
dup_mod–
 = 
NULL
;

752 
£aud™_f‹r_t
 *
f‹r
;

753 
£aud™_mes§ge_t
 *
msg
;

754 *
s
;

755 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

756 
»tv®
 = -1, 
”rÜ
 = 0;

758 ià((
lßded_f‹rs
 = 
	`£aud™_f‹r_ü—‹_äom_fe
((*)
v›w_feP©h
)è=ğ
NULL
) {

759 
”rÜ
 = 
”ºo
;

760 
	`ERR
(
log
, "E¼Ü…¬sšg f%s.", 
v›w_feP©h
);

761 
ş—nup
;

763 ià((
dup_mod–
 = 
	`£aud™_mod–_ü—‹_äom_mod–
(
»pÜt
->
mod–
)è=ğ
NULL
) {

764 
”rÜ
 = 
”ºo
;

765 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
”rÜ
));

766 
ş—nup
;

768 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
lßded_f‹rs
); i++, 
f‹rs_added
++) {

769 
f‹r
 = 
	`­Ş_veùÜ_g‘_–em’t
(
lßded_f‹rs
, 
i
);

770 ià(
	`£aud™_mod–_­³nd_f‹r
(
dup_mod–
, 
f‹r
) < 0) {

771 
”rÜ
 = 
”ºo
;

772 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
”rÜ
));

773 
ş—nup
;

776 ià((
v
 = 
	`£aud™_mod–_g‘_mes§ges
(
log
, 
dup_mod–
)è=ğ
NULL
) {

777 
”rÜ
 = 
”ºo
;

778 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
”rÜ
));

779 
ş—nup
;

781 ià(
»pÜt
->
fÜm©
 =ğ
SEAUDIT_REPORT_FORMAT_HTML
) {

782 
	`årštf
(
outfe
, "V›w fe: %s<br>\n", 
v›w_feP©h
);

783 
	`årštf
(
outfe
,

785 
	`­Ş_veùÜ_g‘_size
(
v
));

787 
	`årštf
(
outfe
, "V›w fe: %s\n", 
v›w_feP©h
);

788 
	`årštf
(
outfe
, "Numb” oàmes§ges: %zd\n\n", 
	`­Ş_veùÜ_g‘_size
(
v
));

791 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v
); i++) {

792 
msg
 = 
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

793 ià(
»pÜt
->
fÜm©
 =ğ
SEAUDIT_REPORT_FORMAT_HTML
) {

794 
s
 = 
	`£aud™_mes§ge_to_¡ršg_html
(
msg
);

796 
s
 = 
	`£aud™_mes§ge_to_¡ršg
(
msg
);

798 ià(
s
 =ğ
NULL
) {

799 
”rÜ
 = 
”ºo
;

800 
	`ERR
(
log
, "%s", 
	`¡»¼Ü
(
”rÜ
));

801 
ş—nup
;

803 
	`åuts
(
s
, 
outfe
);

804 
	`åutc
('\n', 
outfe
);

805 
	`ä“
(
s
);

807 
»tv®
 = 0;

808 
ş—nup
:

811 ià(
lßded_f‹rs
 !ğ
NULL
) {

812 
i
 = 
f‹rs_added
; i < 
	`­Ş_veùÜ_g‘_size
(
lßded_f‹rs
); i++) {

813 
f‹r
 = 
	`­Ş_veùÜ_g‘_–em’t
(
lßded_f‹rs
, 
i
);

814 
	`£aud™_f‹r_de¡roy
(&
f‹r
);

816 
	`­Ş_veùÜ_de¡roy
(&
lßded_f‹rs
);

818 
	`£aud™_mod–_de¡roy
(&
dup_mod–
);

819 
	`­Ş_veùÜ_de¡roy
(&
v
);

820 ià(
”rÜ
 != 0) {

821 
”ºo
 = 
”rÜ
;

823  
»tv®
;

824 
	}
}

826 
	$»pÜt_´št_cu¡om_£ùiÚ
(cÚ¡ 
£aud™_log_t
 * 
log
, cÚ¡ 
£aud™_»pÜt_t
 * 
»pÜt
,

827 
xmlTextR—d”PŒ
 
»ad”
, 
xmlCh¬
 * 
t™Ë
, 
FILE
 * 
outfe
)

829 
size_t
 
Ën
, 
i
;

830 
¹
, 
”rÜ
 = 0, 
»tv®
 = -1, 
’d_of_–em’t
 = 0;

831 
xmlCh¬
 *
v›w_feP©h
 = 
NULL
, *
Çme
 = NULL;

833 ià(
t™Ë
 !ğ
NULL
) {

834 ià(
»pÜt
->
fÜm©
 =ğ
SEAUDIT_REPORT_FORMAT_HTML
) {

835 
	`årštf
(
outfe
, "<h2 cÏss=\"cu¡om_£ùiÚ_t™Ë\"><u>%s</h2></u>\n", 
t™Ë
);

837 
	`årštf
(
outfe
, "%s\n", 
t™Ë
);

838 
Ën
 = 
	`¡¾’
((*)
t™Ë
);

839 
i
 = 0; i < 
Ën
; i++) {

840 
	`årštf
(
outfe
, "-");

842 
	`årštf
(
outfe
, "\n");

848 
¹
 = 
	`xmlTextR—d”R—d
(
»ad”
);

849 
¹
 == 1) {

851 
Çme
 = 
	`xmlTextR—d”Name
(
»ad”
);

852 ià(
Çme
 =ğ
NULL
) {

853 
”rÜ
 = 
”ºo
;

854 
	`ERR
(
log
, "%s", "Unavailable‚ode‚ame within.");

855 
ş—nup
;

859 ià(
	`¡rcmp
((*)
Çme
, "cu¡om-£ùiÚ"è=ğ0 && 
	`xmlTextR—d”NodeTy³
(
»ad”
) == 15) {

860 
	`xmlF»e
(
Çme
);

861 
’d_of_–em’t
 = 1;

864 ià(
	`¡rcmp
((*)
Çme
, "v›w"è=ğ0 && 
	`xmlTextR—d”NodeTy³
(
»ad”
è=ğ1 && 
	`xmlTextR—d”HasA‰ribu‹s
(reader)) {

865 
v›w_feP©h
 = 
	`xmlTextR—d”G‘A‰ribu‹
(
»ad”
, (cÚ¡ 
xmlCh¬
 *)"file");

866 ià(
v›w_feP©h
 =ğ
NULL
) {

867 
”rÜ
 = 
”ºo
;

868 
	`ERR
(
log
, "%s", "Error getting file‡ttribute for view‚ode.");

869 
ş—nup
;

871 ià(
	`»pÜt_´št_lßded_v›w
(
log
, 
»pÜt
, 
v›w_feP©h
, 
outfe
) < 0) {

872 
”rÜ
 = 
”ºo
;

873 
ş—nup
;

875 
	`xmlF»e
(
v›w_feP©h
);

877 
	`xmlF»e
(
Çme
);

878 
¹
 = 
	`xmlTextR—d”R—d
(
»ad”
);

880 ià(!
’d_of_–em’t
 && 
¹
 != 0) {

881 
”rÜ
 = 
EIO
;

882 
	`ERR
(
log
, "E¼Ü…¬sšg cÚfig f%s. (¹:%d)", 
»pÜt
->
cÚfig
, 
¹
);

883 
ş—nup
;

886 ià(!
’d_of_–em’t
) {

887 
”rÜ
 = 
EIO
;

888 
	`ERR
(
log
, "%s", "Encounteredƒnd of file before findingƒnd ofƒlement for custom-section‚ode.");

889 
ş—nup
;;

891 ià(
»pÜt
->
fÜm©
 =ğ
SEAUDIT_REPORT_FORMAT_HTML
)

892 
	`årštf
(
outfe
, "<br>\n");

894 
	`årštf
(
outfe
, "\n");

897 
ş—nup
:

898 ià(
v›w_feP©h
)

899 
	`xmlF»e
(
v›w_feP©h
);

900 ià(
Çme
)

901 
	`xmlF»e
(
Çme
);

902 ià(
”rÜ
 != 0) {

903 
”ºo
 = 
”rÜ
;

905  
»tv®
;

906 
	}
}

908 
	$»pÜt_´oûss_xmlNode
(cÚ¡ 
£aud™_log_t
 * 
log
, cÚ¡ 
£aud™_»pÜt_t
 * 
»pÜt
, 
xmlTextR—d”PŒ
 
»ad”
,

909 
FILE
 * 
outfe
)

911 
xmlCh¬
 *
Çme
 = 
NULL
, *
id_©Œ
 = NULL, *
t™Ë_©Œ
 = NULL;

912 
»tv®
 = -1, 
”rÜ
 = 0;

914 ià((
Çme
 = 
	`xmlTextR—d”Name
(
»ad”
)è=ğ
NULL
) {

915 
”rÜ
 = 
”ºo
;

916 
	`ERR
(
log
, "%s", "Unavailable‚ode‚ame.");

917 
ş—nup
;

920 ià(!
	`»pÜt_is_v®id_node_Çme
((*)
Çme
)) {

921 
»tv®
 = 0;

922 
ş—nup
;

925 ià(
	`¡rcmp
((*)
Çme
, "£aud™-»pÜt"è=ğ0 && 
	`xmlTextR—d”NodeTy³
(
»ad”
) == 1) {

926 ià(
	`»pÜt_·r£_£aud™_»pÜt
(
log
, 
»pÜt
, 
»ad”
, &
id_©Œ
, &
t™Ë_©Œ
) < 0) {

927 
”rÜ
 = 
”ºo
;

928 
ş—nup
;

930 ià(
»pÜt
->
fÜm©
 =ğ
SEAUDIT_REPORT_FORMAT_HTML
) {

931 
	`årštf
(
outfe
, "<h1 cÏss=\"»pÜt_t™Ë\">T™Ë: %s</h1>\n", 
t™Ë_©Œ
);

933 
	`årštf
(
outfe
, "T™Ë: %s\n", 
t™Ë_©Œ
);

935 } ià(
	`¡rcmp
((*)
Çme
, "¡ªd¬d-£ùiÚ"è=ğ0 && 
	`xmlTextR—d”NodeTy³
(
»ad”
) == 1) {

936 ià(
	`»pÜt_·r£_¡ªd¬d_©Œibs
(
log
, 
»pÜt
, 
»ad”
, &
id_©Œ
, &
t™Ë_©Œ
) < 0) {

937 
”rÜ
 = 
”ºo
;

938 
ş—nup
;

940 ià(
id_©Œ
 =ğ
NULL
) {

941 
	`ERR
(
log
, "%s", "Missing„equired id‡ttribute for standard section‚ode.");

942 
”rÜ
 = 
EIO
;

943 
ş—nup
;

946 ià(
	`»pÜt_´št_¡ªd¬d_£ùiÚ
(
log
, 
»pÜt
, 
id_©Œ
, 
t™Ë_©Œ
, 
outfe
) < 0) {

947 
”rÜ
 = 
”ºo
;

948 
ş—nup
;

950 } ià(
	`¡rcmp
((*)
Çme
, "cu¡om-£ùiÚ"è=ğ0 && 
	`xmlTextR—d”NodeTy³
(
»ad”
) == 1) {

951 ià(
	`»pÜt_·r£_cu¡om_©Œibs
(
log
, 
»pÜt
, 
»ad”
, &
t™Ë_©Œ
) < 0) {

952 
”rÜ
 = 
”ºo
;

953 
ş—nup
;

956 ià(
	`»pÜt_´št_cu¡om_£ùiÚ
(
log
, 
»pÜt
, 
»ad”
, 
t™Ë_©Œ
, 
outfe
) < 0) {

957 
”rÜ
 = 
”ºo
;

958 
ş—nup
;

962 
»tv®
 = 0;

963 
ş—nup
:

964 
	`xmlF»e
(
Çme
);

965 
	`xmlF»e
(
id_©Œ
);

966 
	`xmlF»e
(
t™Ë_©Œ
);

967 ià(
»tv®
 < 0) {

968 
”ºo
 = 
”rÜ
;

970  
»tv®
;

971 
	}
}

973 
	$»pÜt_´št_m®fÜmed
(cÚ¡ 
£aud™_log_t
 * 
log
, cÚ¡ 
£aud™_»pÜt_t
 * 
»pÜt
, 
FILE
 * 
outfe
)

975 
size_t
 
i
, 
Ën
;

976 
­Ş_veùÜ_t
 *
v
 = 
	`£aud™_mod–_g‘_m®fÜmed_mes§ges
(
log
, 
»pÜt
->
mod–
);

977 ià(
v
 =ğ
NULL
) {

980 ià(
»pÜt
->
fÜm©
 =ğ
SEAUDIT_REPORT_FORMAT_HTML
) {

981 
	`årštf
(
outfe
, "<b><u>Malformed messages</b></u>\n");

982 
	`årštf
(
outfe
, "<br>\n<br>\n");

984 
	`årštf
(
outfe
, "Malformed messages\n");

985 
Ën
 = 
	`¡¾’
("Malformed messages\n");

986 
i
 = 0; i < 
Ën
; i++) {

987 
	`årštf
(
outfe
, "-");

989 
	`årštf
(
outfe
, "\n");

991 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v
); i++) {

992 *
m®fÜmed_msg
;

993 
m®fÜmed_msg
 = 
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

994 ià(
»pÜt
->
fÜm©
 =ğ
SEAUDIT_REPORT_FORMAT_HTML
)

995 
	`årštf
(
outfe
, "%s<br>\n", 
m®fÜmed_msg
);

997 
	`årštf
(
outfe
, "%s\n", 
m®fÜmed_msg
);

999 
	`årštf
(
outfe
, "\n");

1000 
	`­Ş_veùÜ_de¡roy
(&
v
);

1002 
	}
}

1004 
	$£aud™_»pÜt_wr™e
(cÚ¡ 
£aud™_log_t
 * 
log
, cÚ¡ 
£aud™_»pÜt_t
 * 
»pÜt
, cÚ¡ *
out_fe
)

1006 
xmlTextR—d”PŒ
 
»ad”
;

1007 
FILE
 *
outfe
 = 
NULL
;

1008 
¹
, 
»tv®
 = -1, 
”rÜ
 = 0;

1011 ià(
out_fe
 =ğ
NULL
) {

1012 
outfe
 = 
¡dout
;

1014 ià((
outfe
 = 
	`fİ’
(
out_fe
, "w+")è=ğ
NULL
) {

1015 
”rÜ
 = 
”ºo
;

1016 
	`ERR
(
log
, "Could‚Ù o³À% fÜ wr™šg.", 
out_fe
);

1017 
ş—nup
;

1022 ià(
	`»pÜt_´št_h—d”
(
log
, 
»pÜt
, 
outfe
) < 0) {

1023 
”rÜ
 = 
”ºo
;

1024 
ş—nup
;

1028 
»ad”
 = 
	`xmlNewTextR—d”F’ame
(
»pÜt
->
cÚfig
);

1029 ià(
»ad”
 =ğ
NULL
) {

1030 
”rÜ
 = 
”ºo
;

1031 
	`ERR
(
log
, "UÇbËØİ’ cÚfig f(%s).", 
»pÜt
->
cÚfig
);

1032 
ş—nup
;

1034 
¹
 = 
	`xmlTextR—d”R—d
(
»ad”
);

1035 
¹
 == 1) {

1036 
	`»pÜt_´oûss_xmlNode
(
log
, 
»pÜt
, 
»ad”
, 
outfe
);

1037 
¹
 = 
	`xmlTextR—d”R—d
(
»ad”
);

1039 
”rÜ
 = 
”ºo
;

1040 
	`xmlF»eTextR—d”
(
»ad”
);

1041 ià(
¹
 != 0) {

1042 
	`ERR
(
log
, "FaedØ·r£ cÚfig f%s.", 
»pÜt
->
cÚfig
);

1043 
ş—nup
;

1045 ià(
»pÜt
->
m®fÜmed
 && 
	`»pÜt_´št_m®fÜmed
(
log
,„•Üt, 
outfe
) < 0) {

1046 
”rÜ
 = 
”ºo
;

1047 
ş—nup
;

1049 
	`»pÜt_´št_foÙ”
(
»pÜt
, 
outfe
);

1051 
»tv®
 = 0;

1052 
ş—nup
:

1053 ià(
outfe
 !ğ
NULL
) {

1054 
	`fşo£
(
outfe
);

1056 ià(
»tv®
 < 0) {

1057 
”ºo
 = 
”rÜ
;

1059  
»tv®
;

1060 
	}
}

	@libseaudit/src/seaudit_internal.h

26 #iâdeà
SEAUDIT_SEAUDIT_INTERNAL_H


27 
	#SEAUDIT_SEAUDIT_INTERNAL_H


	)

29 
	~<cÚfig.h
>

31 
	~<£aud™/avc_mes§ge.h
>

32 
	~<£aud™/boŞ_mes§ge.h
>

33 
	~<£aud™/f‹r.h
>

34 
	~<£aud™/lßd_mes§ge.h
>

35 
	~<£aud™/log.h
>

36 
	~<£aud™/mes§ge.h
>

37 
	~<£aud™/mod–.h
>

38 
	~<£aud™/sÜt.h
>

40 
	~<­Ş/b¡.h
>

41 
	~<­Ş/veùÜ.h
>

43 
	~<libxml/uri.h
>

45 
	#FILTER_FILE_FORMAT_VERSION
 "1.3"

	)

49 
	s£aud™_log


52 
­Ş_veùÜ_t
 *
	mmes§ges
;

55 
­Ş_veùÜ_t
 *
	mm®fÜmed_msgs
;

57 
­Ş_veùÜ_t
 *
	mmod–s
;

58 
­Ş_b¡_t
 *
	mty³s
, *
	mşas£s
, *
	mrŞes
, *
	mu£rs
;

59 
­Ş_b¡_t
 *
	m³rms
, *
	mho¡s
, *
	mboŞs
, *
	mmªag”s
;

60 
­Ş_b¡_t
 *
	mmls_lvl
, *
	mmls_şr
;

61 
£aud™_log_ty³_e
 
	mlogty³
;

62 
£aud™_hªdË_â_t
 
	mâ
;

63 *
	mhªdË_¬g
;

65 
	mtz_š™Ÿlized
;

67 
	mÃxt_lše
;

78 
log_­³nd_mod–
(
£aud™_log_t
 * 
log
, 
£aud™_mod–_t
 * 
mod–
);

86 
log_»move_mod–
(
£aud™_log_t
 * 
log
, 
£aud™_mod–_t
 * 
mod–
);

96 cÚ¡ 
­Ş_veùÜ_t
 *
log_g‘_mes§ges
(cÚ¡ 
£aud™_log_t
 * 
log
);

109 cÚ¡ 
­Ş_veùÜ_t
 *
log_g‘_m®fÜmed_mes§ges
(cÚ¡ 
£aud™_log_t
 * 
log
);

113 
	s£aud™_mes§ge


116 
tm
 *
	md©e_¡amp
;

119 *
	mho¡
;

122 *
	mmªag”
;

124 
£aud™_mes§ge_ty³_e
 
	mty³
;

128 
£aud™_avc_mes§ge_t
 *
	mavc
;

129 
£aud™_boŞ_mes§ge_t
 *
	mboŞm
;

130 
£aud™_lßd_mes§ge_t
 *
	mlßd
;

131 } 
	md©a
;

144 
£aud™_mes§ge_t
 *
mes§ge_ü—‹
(
£aud™_log_t
 * 
log
, 
£aud™_mes§ge_ty³_e
 
ty³
);

152 
mes§ge_ä“
(*
msg
);

156 
	e£aud™_avc_mes§ge_şass


158 
	mSEAUDIT_AVC_DATA_INVALID
 = 0,

159 
	mSEAUDIT_AVC_DATA_MALFORMED
,

160 
	mSEAUDIT_AVC_DATA_IPC
,

161 
	mSEAUDIT_AVC_DATA_CAP
,

162 
	mSEAUDIT_AVC_DATA_FS
,

163 
	mSEAUDIT_AVC_DATA_NET
,

164 } 
	t£aud™_avc_mes§ge_şass_e
;

170 
	s£aud™_avc_mes§ge


172 
£aud™_avc_mes§ge_ty³_e
 
	mmsg
;

175 
£aud™_avc_mes§ge_şass_e
 
	mavc_ty³
;

177 *
	mexe
;

179 *
	mcomm
;

181 *
	m·th
;

183 *
	mdev
;

185 *
	mÃtif
;

187 *
	mÏddr
;

189 *
	mçddr
;

191 *
	m§ddr
;

193 *
	mdaddr
;

195 *
	mÇme
;

197 *
	maddr
;

199 *
	msu£r
;

201 *
	m¤Şe
;

203 *
	m¡y³
;

205 *
	msmls_lvl
;

207 *
	msmls_şr
;

209 *
	mtu£r
;

211 *
	mŒŞe
;

213 *
	m‰y³
;

215 *
	mtmls_lvl
;

217 *
	mtmls_şr
;

219 *
	mtşass
;

221 
time_t
 
	mtm_¡mp_£c
;

223 
	mtm_¡mp_Çno
;

225 
	m£rŸl
;

227 
­Ş_veùÜ_t
 *
	m³rms
;

229 
	mkey
;

230 
	mis_key
;

232 
	mÿ·b™y
;

233 
	mis_ÿ·b™y
;

235 
	mšode
;

236 
	mis_šode
;

238 
	msourû
;

240 
	mde¡
;

242 
	mÍÜt
;

244 
	måÜt
;

245 
	mpÜt
;

247 
	m¤c_sid
;

248 
	mis_¤c_sid
;

250 
	mtgt_sid
;

251 
	mis_tgt_sid
;

253 
	mpid
;

254 
	mis_pid
;

263 
£aud™_avc_mes§ge_t
 *
avc_mes§ge_ü—‹
();

270 
avc_mes§ge_ä“
(
£aud™_avc_mes§ge_t
 * 
avc
);

282 *
avc_mes§ge_to_¡ršg
(cÚ¡ 
£aud™_mes§ge_t
 * 
msg
, cÚ¡ *
d©e
);

295 *
avc_mes§ge_to_¡ršg_html
(cÚ¡ 
£aud™_mes§ge_t
 * 
msg
, cÚ¡ *
d©e
);

307 *
avc_mes§ge_to_misc_¡ršg
(cÚ¡ 
£aud™_avc_mes§ge_t
 * 
avc
);

311 
	s£aud™_boŞ_mes§ge_chªge


314 *
	mboŞ—n
;

316 
	mv®ue
;

317 } 
	t£aud™_boŞ_mes§ge_chªge_t
;

319 
	s£aud™_boŞ_mes§ge


322 
­Ş_veùÜ_t
 *
	mchªges
;

331 
£aud™_boŞ_mes§ge_t
 *
boŞ_mes§ge_ü—‹
();

345 
boŞ_chªge_­³nd
(
£aud™_log_t
 * 
log
, 
£aud™_boŞ_mes§ge_t
 * 
boŞm
, cÚ¡ *
Çme
, 
v®ue
);

352 
boŞ_mes§ge_ä“
(
£aud™_boŞ_mes§ge_t
 * 
boŞm
);

364 *
boŞ_mes§ge_to_¡ršg
(cÚ¡ 
£aud™_mes§ge_t
 * 
msg
, cÚ¡ *
d©e
);

377 *
boŞ_mes§ge_to_¡ršg_html
(cÚ¡ 
£aud™_mes§ge_t
 * 
msg
, cÚ¡ *
d©e
);

390 *
boŞ_mes§ge_to_misc_¡ršg
(cÚ¡ 
£aud™_boŞ_mes§ge_t
 * 
boŞm
);

394 
	s£aud™_lßd_mes§ge


396 
	mu£rs
;

397 
	mrŞes
;

398 
	mty³s
;

399 
	mşas£s
;

400 
	mruËs
;

401 
	mboŞs
;

402 *
	mbš¬y
;

411 
£aud™_lßd_mes§ge_t
 *
lßd_mes§ge_ü—‹
();

418 
lßd_mes§ge_ä“
(
£aud™_lßd_mes§ge_t
 * 
msg
);

430 *
lßd_mes§ge_to_¡ršg
(cÚ¡ 
£aud™_mes§ge_t
 * 
msg
, cÚ¡ *
d©e
);

443 *
lßd_mes§ge_to_¡ršg_html
(cÚ¡ 
£aud™_mes§ge_t
 * 
msg
, cÚ¡ *
d©e
);

455 *
lßd_mes§ge_to_misc_¡ršg
(cÚ¡ 
£aud™_lßd_mes§ge_t
 * 
lßd
);

465 
mod–_»move_log
(
£aud™_mod–_t
 * 
mod–
, 
£aud™_log_t
 * 
log
);

474 
mod–_nÙify_log_chªged
(
£aud™_mod–_t
 * 
mod–
, 
£aud™_log_t
 * 
log
);

483 
mod–_nÙify_f‹r_chªged
(
£aud™_mod–_t
 * 
mod–
, 
£aud™_f‹r_t
 * 
f‹r
);

495 
f‹r_£t_mod–
(
£aud™_f‹r_t
 * 
f‹r
, 
£aud™_mod–_t
 * 
mod–
);

499 (
	tf‹r_»ad_func
è(
	t£aud™_f‹r_t
 * 
	tf‹r
, cÚ¡ 
	txmlCh¬
 * 
	tch
);

501 
	sf‹r_·r£_¡©e


505 
­Ş_veùÜ_t
 *
f‹rs
;

508 *
v›w_Çme
;

510 
£aud™_f‹r_m©ch_e
 
v›w_m©ch
;

512 
£aud™_f‹r_visibË_e
 
v›w_visibË
;

519 
xmlCh¬
 *
cur_¡ršg
;

520 
w¬nšgs
;

522 
£aud™_f‹r_t
 *
cur_f‹r
;

524 
f‹r_»ad_func
 *
cur_f‹r_»ad
;

538 
	`f‹r_is_acû±ed
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, cÚ¡ 
£aud™_mes§ge_t
 * 
msg
);

550 
	`f‹r_·r£_xml
(
f‹r_·r£_¡©e
 *
¡©e
, cÚ¡ *
f’ame
);

561 
	`f‹r_­³nd_to_fe
(cÚ¡ 
£aud™_f‹r_t
 * 
f‹r
, 
FILE
 * 
fe
, 
bs
);

575 
£aud™_sÜt_t
 *
	`sÜt_ü—‹_äom_sÜt
(cÚ¡ s—ud™_sÜt_ˆ* 
sÜt
);

589 
£aud™_sÜt_t
 *
	`sÜt_ü—‹_äom_Çme
(cÚ¡ *
Çme
, 
dœeùiÚ
);

601 
	`sÜt_is_suµÜ‹d
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt
, cÚ¡ 
£aud™_mes§ge_t
 * 
msg
);

613 
	`sÜt_comp
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt
, cÚ¡ 
£aud™_mes§ge_t
 * 
a
, cÚ¡ s—ud™_mes§ge_ˆ* 
b
);

623 cÚ¡ *
	`sÜt_g‘_Çme
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt
);

632 
	`sÜt_g‘_dœeùiÚ
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt
);

636 
	#SEAUDIT_MSG_ERR
 1

	)

637 
	#SEAUDIT_MSG_WARN
 2

	)

638 
	#SEAUDIT_MSG_INFO
 3

	)

651 
	`£aud™_hªdË_msg
(cÚ¡ 
£aud™_log_t
 * 
log
, 
Ëv–
, cÚ¡ *
fmt
, ...);

653 
	`__©Œibu‹__
 ((
	$fÜm©
(
´štf
, 3, 4)))

654 
	`£aud™_hªdË_msg
(cÚ¡ 
£aud™_log_t
 * 
log
, 
Ëv–
, cÚ¡ *
fmt
, ...);

656 #undeà
ERR


657 #undeà
WARN


658 #undeà
INFO


660 
	#ERR
(
hªdË
, 
fÜm©
, ...è
	`£aud™_hªdË_msg
(hªdË, 
SEAUDIT_MSG_ERR
, fÜm©, 
__VA_ARGS__
)

	)

661 
	#WARN
(
hªdË
, 
fÜm©
, ...è
	`£aud™_hªdË_msg
(hªdË, 
SEAUDIT_MSG_WARN
, fÜm©, 
__VA_ARGS__
)

	)

662 
	#INFO
(
hªdË
, 
fÜm©
, ...è
	`£aud™_hªdË_msg
(hªdË, 
SEAUDIT_MSG_INFO
, fÜm©, 
__VA_ARGS__
)

	)

	@libseaudit/src/sort.c

26 
	~"£aud™_š‹º®.h
"

28 
	~<­Ş/ut.h
>

30 
	~<”ºo.h
>

31 
	~<¡ršg.h
>

36 (
	tsÜt_comp_func
è(cÚ¡ 
	t£aud™_sÜt_t
 * 
	tsÜt
, cÚ¡ 
	t£aud™_mes§ge_t
 * 
	ta
, cÚ¡ s—ud™_mes§ge_ˆ* 
	tb
);

42 (
	tsÜt_suµÜ‹d_func
è(cÚ¡ 
	t£aud™_sÜt_t
 * 
	tsÜt
, cÚ¡ 
	t£aud™_mes§ge_t
 * 
	tm
);

44 
	s£aud™_sÜt


46 cÚ¡ *
Çme
;

47 
sÜt_comp_func
 *
comp
;

48 
sÜt_suµÜ‹d_func
 *
suµÜt
;

49 
dœeùiÚ
;

52 
£aud™_sÜt_t
 *
	$£aud™_sÜt_ü—‹_äom_sÜt
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt
)

54 
£aud™_sÜt_t
 *
s
;

55 ià(
sÜt
 =ğ
NULL
) {

56 
”ºo
 = 
EINVAL
;

57  
NULL
;

59 ià((
s
 = 
	`ÿÎoc
(1, (*s))è=ğ
NULL
) {

60  
NULL
;

62 
s
->
Çme
 = 
sÜt
->name;

63 
s
->
comp
 = 
sÜt
->comp;

64 
s
->
suµÜt
 = 
sÜt
->support;

65 
s
->
dœeùiÚ
 = 
sÜt
->direction;

66  
s
;

67 
	}
}

69 
	$£aud™_sÜt_de¡roy
(
£aud™_sÜt_t
 ** 
sÜt
)

71 ià(
sÜt
 !ğ
NULL
 && *sort != NULL) {

72 
	`ä“
(*
sÜt
);

73 *
sÜt
 = 
NULL
;

75 
	}
}

77 
£aud™_sÜt_t
 *
	$sÜt_ü—‹
(cÚ¡ *
Çme
, 
sÜt_comp_func
 * 
comp
, 
sÜt_suµÜ‹d_func
 
suµÜt
, cÚ¡ 
dœeùiÚ
)

79 
£aud™_sÜt_t
 *
s
 = 
	`ÿÎoc
(1, (*s));

80 ià(
s
 =ğ
NULL
) {

81  
NULL
;

83 
s
->
Çme
 =‚ame;

84 
s
->
comp
 = comp;

85 
s
->
suµÜt
 = support;

86 
s
->
dœeùiÚ
 = direction;

87  
s
;

88 
	}
}

90 
£aud™_sÜt_t
 *
	$sÜt_ü—‹_äom_sÜt
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt
)

92 ià(
sÜt
 =ğ
NULL
) {

93 
”ºo
 = 
EINVAL
;

94  
NULL
;

96  
	`sÜt_ü—‹
(
sÜt
->
Çme
, sÜt->
comp
, sÜt->
suµÜt
, sÜt->
dœeùiÚ
);

97 
	}
}

99 
sÜt_mes§ge_ty³_comp
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt


100 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£aud™_mes§ge_t
 * 
a
, cÚ¡ s—ud™_mes§ge_ˆ* 
b
)

102 ià(
	ga
->
	gty³
 !ğ
b
->
ty³
) {

103  
a
->
ty³
 - 
b
->type;

105 ià(
	ga
->
	gty³
 =ğ
SEAUDIT_MESSAGE_TYPE_AVC
) {

106  
a
->
d©a
.
avc
->
msg
 - 
b
->data.avc->msg;

111 
sÜt_mes§ge_ty³_suµÜt
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt
 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

113  
	gmsg
->
	gty³
 !ğ
SEAUDIT_MESSAGE_TYPE_INVALID
;

116 
£aud™_sÜt_t
 *
	$£aud™_sÜt_by_mes§ge_ty³
(cÚ¡ 
dœeùiÚ
)

118  
	`sÜt_ü—‹
("mes§ge_ty³", 
sÜt_mes§ge_ty³_comp
, 
sÜt_mes§ge_ty³_suµÜt
, 
dœeùiÚ
);

119 
	}
}

125 
sÜt_d©e_comp
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt


126 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£aud™_mes§ge_t
 * 
a
, cÚ¡ s—ud™_mes§ge_ˆ* 
b
)

130 
tm
 *
	gt1
 = 
a
->
d©e_¡amp
;

131 
tm
 *
	gt2
 = 
b
->
d©e_¡amp
;

132 
	g»tv®
;

133 ià(
	gt1
->
	gtm_y—r
 !ğ0 && 
t2
->
tm_y—r
 !ğ0 && (
»tv®
 = 
t1
->tm_year -2->tm_year) != 0) {

134  
»tv®
;

136 ià((
	g»tv®
 = 
t1
->
tm_mÚ
 - 
t2
->tm_mon) != 0) {

137  
»tv®
;

139 ià((
	g»tv®
 = 
t1
->
tm_mday
 - 
t2
->tm_mday) != 0) {

140  
»tv®
;

142 ià((
	g»tv®
 = 
t1
->
tm_hour
 - 
t2
->tm_hour) != 0) {

143  
»tv®
;

145 ià((
	g»tv®
 = 
t1
->
tm_mš
 - 
t2
->tm_min) != 0) {

146  
»tv®
;

148 ià((
	g»tv®
 = 
t1
->
tm_£c
 - 
t2
->tm_sec) != 0) {

149  
»tv®
;

154 
sÜt_d©e_suµÜt
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt
 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

156  
	gmsg
->
	gd©e_¡amp
 !ğ
NULL
;

159 
£aud™_sÜt_t
 *
	$£aud™_sÜt_by_d©e
(cÚ¡ 
dœeùiÚ
)

161  
	`sÜt_ü—‹
("d©e", 
sÜt_d©e_comp
, 
sÜt_d©e_suµÜt
, 
dœeùiÚ
);

162 
	}
}

164 
sÜt_ho¡_comp
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt


165 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£aud™_mes§ge_t
 * 
a
, cÚ¡ s—ud™_mes§ge_ˆ* 
b
)

167  
¡rcmp
(
a
->
ho¡
, 
b
->host);

170 
sÜt_ho¡_suµÜt
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt
 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

172  
	gmsg
->
	gho¡
 !ğ
NULL
;

175 
£aud™_sÜt_t
 *
	$£aud™_sÜt_by_ho¡
(cÚ¡ 
dœeùiÚ
)

177  
	`sÜt_ü—‹
("ho¡", 
sÜt_ho¡_comp
, 
sÜt_ho¡_suµÜt
, 
dœeùiÚ
);

178 
	}
}

180 
sÜt_³rm_comp
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt


181 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£aud™_mes§ge_t
 * 
a
, cÚ¡ s—ud™_mes§ge_ˆ* 
b
)

183 
size_t
 
	gi
;

184  
­Ş_veùÜ_com·»
(
a
->
d©a
.
avc
->
³rms
, 
b
->d©a.avc->³rms, 
­Ş_¡r_¡rcmp
, 
NULL
, &
i
);

187 
sÜt_³rm_suµÜt
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt
 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

189  
	gmsg
->
	gty³
 =ğ
SEAUDIT_MESSAGE_TYPE_AVC
 &&

190 
msg
->
d©a
.
avc
->
³rms
 !ğ
NULL
 && 
­Ş_veùÜ_g‘_size
(msg->data.avc->perms) >= 1;

193 
£aud™_sÜt_t
 *
	$£aud™_sÜt_by_³rmissiÚ
(cÚ¡ 
dœeùiÚ
)

195  
	`sÜt_ü—‹
("³rmissiÚ", 
sÜt_³rm_comp
, 
sÜt_³rm_suµÜt
, 
dœeùiÚ
);

196 
	}
}

198 
sÜt_sourû_u£r_comp
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt


199 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£aud™_mes§ge_t
 * 
a
, cÚ¡ s—ud™_mes§ge_ˆ* 
b
)

201  
¡rcmp
(
a
->
d©a
.
avc
->
su£r
, 
b
->data.avc->suser);

204 
sÜt_sourû_u£r_suµÜt
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt
 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

206  
	gmsg
->
	gty³
 =ğ
SEAUDIT_MESSAGE_TYPE_AVC
 && 
msg
->
d©a
.
avc
->
su£r
 !ğ
NULL
;

209 
£aud™_sÜt_t
 *
	$£aud™_sÜt_by_sourû_u£r
(cÚ¡ 
dœeùiÚ
)

211  
	`sÜt_ü—‹
("sourû_u£r", 
sÜt_sourû_u£r_comp
, 
sÜt_sourû_u£r_suµÜt
, 
dœeùiÚ
);

212 
	}
}

214 
sÜt_sourû_rŞe_comp
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt
 
__©Œibu‹
((
unu£d
)), cÚ¡ 
£aud™_mes§ge_t
 * 
a
,

215 cÚ¡ 
£aud™_mes§ge_t
 * 
b
)

217  
¡rcmp
(
a
->
d©a
.
avc
->
¤Şe
, 
b
->data.avc->srole);

220 
sÜt_sourû_rŞe_suµÜt
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt
 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

222  
	gmsg
->
	gty³
 =ğ
SEAUDIT_MESSAGE_TYPE_AVC
 && 
msg
->
d©a
.
avc
->
¤Şe
 !ğ
NULL
;

225 
£aud™_sÜt_t
 *
	$£aud™_sÜt_by_sourû_rŞe
(cÚ¡ 
dœeùiÚ
)

227  
	`sÜt_ü—‹
("sourû_rŞe", 
sÜt_sourû_rŞe_comp
, 
sÜt_sourû_rŞe_suµÜt
, 
dœeùiÚ
);

228 
	}
}

230 
sÜt_sourû_ty³_comp
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt


231 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£aud™_mes§ge_t
 * 
a
, cÚ¡ s—ud™_mes§ge_ˆ* 
b
)

233  
¡rcmp
(
a
->
d©a
.
avc
->
¡y³
, 
b
->data.avc->stype);

236 
sÜt_sourû_ty³_suµÜt
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt
 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

238  
	gmsg
->
	gty³
 =ğ
SEAUDIT_MESSAGE_TYPE_AVC
 && 
msg
->
d©a
.
avc
->
¡y³
 !ğ
NULL
;

241 
£aud™_sÜt_t
 *
	$£aud™_sÜt_by_sourû_ty³
(cÚ¡ 
dœeùiÚ
)

243  
	`sÜt_ü—‹
("sourû_ty³", 
sÜt_sourû_ty³_comp
, 
sÜt_sourû_ty³_suµÜt
, 
dœeùiÚ
);

244 
	}
}

246 
sÜt_sourû_mls_lvl_comp
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt


247 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£aud™_mes§ge_t
 * 
a
, cÚ¡ s—ud™_mes§ge_ˆ* 
b
)

249  
¡rcmp
(
a
->
d©a
.
avc
->
smls_lvl
, 
b
->data.avc->smls_lvl);

252 
sÜt_sourû_mls_lvl_suµÜt
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt
 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

254  
	gmsg
->
	gty³
 =ğ
SEAUDIT_MESSAGE_TYPE_AVC
 && 
msg
->
d©a
.
avc
->
smls_lvl
 !ğ
NULL
;

257 
£aud™_sÜt_t
 *
	$£aud™_sÜt_by_sourû_mls_lvl
(cÚ¡ 
dœeùiÚ
)

259  
	`sÜt_ü—‹
("sourû_mls_lvl", 
sÜt_sourû_mls_lvl_comp
, 
sÜt_sourû_mls_lvl_suµÜt
, 
dœeùiÚ
);

260 
	}
}

262 
sÜt_sourû_mls_şr_comp
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt


263 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£aud™_mes§ge_t
 * 
a
, cÚ¡ s—ud™_mes§ge_ˆ* 
b
)

265  
¡rcmp
(
a
->
d©a
.
avc
->
smls_şr
, 
b
->data.avc->smls_clr);

268 
sÜt_sourû_mls_şr_suµÜt
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt
 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

270  
	gmsg
->
	gty³
 =ğ
SEAUDIT_MESSAGE_TYPE_AVC
 && 
msg
->
d©a
.
avc
->
smls_şr
 !ğ
NULL
;

273 
£aud™_sÜt_t
 *
	$£aud™_sÜt_by_sourû_mls_şr
(cÚ¡ 
dœeùiÚ
)

275  
	`sÜt_ü—‹
("sourû_mls_şr", 
sÜt_sourû_mls_şr_comp
, 
sÜt_sourû_mls_şr_suµÜt
, 
dœeùiÚ
);

276 
	}
}

278 
sÜt_rg‘_u£r_comp
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt


279 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£aud™_mes§ge_t
 * 
a
, cÚ¡ s—ud™_mes§ge_ˆ* 
b
)

281  
¡rcmp
(
a
->
d©a
.
avc
->
tu£r
, 
b
->data.avc->tuser);

284 
sÜt_rg‘_u£r_suµÜt
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt
 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

286  
	gmsg
->
	gty³
 =ğ
SEAUDIT_MESSAGE_TYPE_AVC
 && 
msg
->
d©a
.
avc
->
tu£r
 !ğ
NULL
;

289 
£aud™_sÜt_t
 *
	$£aud™_sÜt_by_rg‘_u£r
(cÚ¡ 
dœeùiÚ
)

291  
	`sÜt_ü—‹
("rg‘_u£r", 
sÜt_rg‘_u£r_comp
, 
sÜt_rg‘_u£r_suµÜt
, 
dœeùiÚ
);

292 
	}
}

294 
sÜt_rg‘_rŞe_comp
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt


295 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£aud™_mes§ge_t
 * 
a
, cÚ¡ s—ud™_mes§ge_ˆ* 
b
)

297  
¡rcmp
(
a
->
d©a
.
avc
->
ŒŞe
, 
b
->data.avc->trole);

300 
sÜt_rg‘_rŞe_suµÜt
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt
 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

302  
	gmsg
->
	gty³
 =ğ
SEAUDIT_MESSAGE_TYPE_AVC
 && 
msg
->
d©a
.
avc
->
ŒŞe
 !ğ
NULL
;

305 
£aud™_sÜt_t
 *
	$£aud™_sÜt_by_rg‘_rŞe
(cÚ¡ 
dœeùiÚ
)

307  
	`sÜt_ü—‹
("rg‘_rŞe", 
sÜt_rg‘_rŞe_comp
, 
sÜt_rg‘_rŞe_suµÜt
, 
dœeùiÚ
);

308 
	}
}

310 
sÜt_rg‘_ty³_comp
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt


311 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£aud™_mes§ge_t
 * 
a
, cÚ¡ s—ud™_mes§ge_ˆ* 
b
)

313  
¡rcmp
(
a
->
d©a
.
avc
->
‰y³
, 
b
->data.avc->ttype);

316 
sÜt_rg‘_ty³_suµÜt
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt
 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

318  
	gmsg
->
	gty³
 =ğ
SEAUDIT_MESSAGE_TYPE_AVC
 && 
msg
->
d©a
.
avc
->
‰y³
 !ğ
NULL
;

321 
£aud™_sÜt_t
 *
	$£aud™_sÜt_by_rg‘_ty³
(cÚ¡ 
dœeùiÚ
)

323  
	`sÜt_ü—‹
("rg‘_ty³", 
sÜt_rg‘_ty³_comp
, 
sÜt_rg‘_ty³_suµÜt
, 
dœeùiÚ
);

324 
	}
}

326 
sÜt_rg‘_mls_lvl_comp
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt


327 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£aud™_mes§ge_t
 * 
a
, cÚ¡ s—ud™_mes§ge_ˆ* 
b
)

329  
¡rcmp
(
a
->
d©a
.
avc
->
tmls_lvl
, 
b
->data.avc->tmls_lvl);

332 
sÜt_rg‘_mls_lvl_suµÜt
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt
 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

334  
	gmsg
->
	gty³
 =ğ
SEAUDIT_MESSAGE_TYPE_AVC
 && 
msg
->
d©a
.
avc
->
tmls_lvl
 !ğ
NULL
;

337 
£aud™_sÜt_t
 *
	$£aud™_sÜt_by_rg‘_mls_lvl
(cÚ¡ 
dœeùiÚ
)

339  
	`sÜt_ü—‹
("rg‘_mls_lvl", 
sÜt_rg‘_mls_lvl_comp
, 
sÜt_rg‘_mls_lvl_suµÜt
, 
dœeùiÚ
);

340 
	}
}

342 
sÜt_rg‘_mls_şr_comp
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt


343 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£aud™_mes§ge_t
 * 
a
, cÚ¡ s—ud™_mes§ge_ˆ* 
b
)

345  
¡rcmp
(
a
->
d©a
.
avc
->
tmls_şr
, 
b
->data.avc->tmls_clr);

348 
sÜt_rg‘_mls_şr_suµÜt
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt
 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

350  
	gmsg
->
	gty³
 =ğ
SEAUDIT_MESSAGE_TYPE_AVC
 && 
msg
->
d©a
.
avc
->
tmls_şr
 !ğ
NULL
;

353 
£aud™_sÜt_t
 *
	$£aud™_sÜt_by_rg‘_mls_şr
(cÚ¡ 
dœeùiÚ
)

355  
	`sÜt_ü—‹
("rg‘_mls_şr", 
sÜt_rg‘_mls_şr_comp
, 
sÜt_rg‘_mls_şr_suµÜt
, 
dœeùiÚ
);

356 
	}
}

358 
sÜt_objeù_şass_comp
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt


359 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£aud™_mes§ge_t
 * 
a
, cÚ¡ s—ud™_mes§ge_ˆ* 
b
)

361  
¡rcmp
(
a
->
d©a
.
avc
->
tşass
, 
b
->data.avc->tclass);

364 
sÜt_objeù_şass_suµÜt
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt
 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

366  
	gmsg
->
	gty³
 =ğ
SEAUDIT_MESSAGE_TYPE_AVC
 && 
msg
->
d©a
.
avc
->
tşass
 !ğ
NULL
;

369 
£aud™_sÜt_t
 *
	$£aud™_sÜt_by_objeù_şass
(cÚ¡ 
dœeùiÚ
)

371  
	`sÜt_ü—‹
("objeù_şass", 
sÜt_objeù_şass_comp
, 
sÜt_objeù_şass_suµÜt
, 
dœeùiÚ
);

372 
	}
}

374 
sÜt_execubË_comp
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt


375 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£aud™_mes§ge_t
 * 
a
, cÚ¡ s—ud™_mes§ge_ˆ* 
b
)

377  
¡rcmp
(
a
->
d©a
.
avc
->
exe
, 
b
->data.avc->exe);

380 
sÜt_execubË_suµÜt
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt
 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

382  
	gmsg
->
	gty³
 =ğ
SEAUDIT_MESSAGE_TYPE_AVC
 && 
msg
->
d©a
.
avc
->
exe
 !ğ
NULL
;

385 
£aud™_sÜt_t
 *
	$£aud™_sÜt_by_execubË
(cÚ¡ 
dœeùiÚ
)

387  
	`sÜt_ü—‹
("execubË", 
sÜt_execubË_comp
, 
sÜt_execubË_suµÜt
, 
dœeùiÚ
);

388 
	}
}

390 
sÜt_commªd_comp
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt


391 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£aud™_mes§ge_t
 * 
a
, cÚ¡ s—ud™_mes§ge_ˆ* 
b
)

393  
¡rcmp
(
a
->
d©a
.
avc
->
comm
, 
b
->data.avc->comm);

396 
sÜt_commªd_suµÜt
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt
 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

398  
	gmsg
->
	gty³
 =ğ
SEAUDIT_MESSAGE_TYPE_AVC
 && 
msg
->
d©a
.
avc
->
comm
 !ğ
NULL
;

401 
£aud™_sÜt_t
 *
	$£aud™_sÜt_by_commªd
(cÚ¡ 
dœeùiÚ
)

403  
	`sÜt_ü—‹
("commªd", 
sÜt_commªd_comp
, 
sÜt_commªd_suµÜt
, 
dœeùiÚ
);

404 
	}
}

406 
sÜt_Çme_comp
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt


407 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£aud™_mes§ge_t
 * 
a
, cÚ¡ s—ud™_mes§ge_ˆ* 
b
)

409  
¡rcmp
(
a
->
d©a
.
avc
->
Çme
, 
b
->data.avc->name);

412 
sÜt_Çme_suµÜt
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt
 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

414  
	gmsg
->
	gty³
 =ğ
SEAUDIT_MESSAGE_TYPE_AVC
 && 
msg
->
d©a
.
avc
->
Çme
 !ğ
NULL
;

417 
£aud™_sÜt_t
 *
	$£aud™_sÜt_by_Çme
(cÚ¡ 
dœeùiÚ
)

419  
	`sÜt_ü—‹
("Çme", 
sÜt_Çme_comp
, 
sÜt_Çme_suµÜt
, 
dœeùiÚ
);

420 
	}
}

422 
sÜt_·th_comp
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt


423 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£aud™_mes§ge_t
 * 
a
, cÚ¡ s—ud™_mes§ge_ˆ* 
b
)

425  
¡rcmp
(
a
->
d©a
.
avc
->
·th
, 
b
->data.avc->path);

428 
sÜt_·th_suµÜt
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt
 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

430  
	gmsg
->
	gty³
 =ğ
SEAUDIT_MESSAGE_TYPE_AVC
 && 
msg
->
d©a
.
avc
->
·th
 !ğ
NULL
;

433 
£aud™_sÜt_t
 *
	$£aud™_sÜt_by_·th
(cÚ¡ 
dœeùiÚ
)

435  
	`sÜt_ü—‹
("·th", 
sÜt_·th_comp
, 
sÜt_·th_suµÜt
, 
dœeùiÚ
);

436 
	}
}

438 
sÜt_deviû_comp
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt


439 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£aud™_mes§ge_t
 * 
a
, cÚ¡ s—ud™_mes§ge_ˆ* 
b
)

441  
¡rcmp
(
a
->
d©a
.
avc
->
dev
, 
b
->data.avc->dev);

444 
sÜt_deviû_suµÜt
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt
 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

446  
	gmsg
->
	gty³
 =ğ
SEAUDIT_MESSAGE_TYPE_AVC
 && 
msg
->
d©a
.
avc
->
dev
 !ğ
NULL
;

449 
£aud™_sÜt_t
 *
	$£aud™_sÜt_by_deviû
(cÚ¡ 
dœeùiÚ
)

451  
	`sÜt_ü—‹
("deviû", 
sÜt_deviû_comp
, 
sÜt_deviû_suµÜt
, 
dœeùiÚ
);

452 
	}
}

454 
sÜt_šode_comp
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt


455 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£aud™_mes§ge_t
 * 
a
, cÚ¡ s—ud™_mes§ge_ˆ* 
b
)

459 ià(
	ga
->
	gd©a
.
	gavc
->
	gšode
 < 
	gb
->data.avc->inode) {

462  
	ga
->
	gd©a
.
	gavc
->
	gšode
 - 
	gb
->data.avc->inode;

465 
sÜt_šode_suµÜt
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt
 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

467  
	gmsg
->
	gty³
 =ğ
SEAUDIT_MESSAGE_TYPE_AVC
 && 
msg
->
d©a
.
avc
->
šode
 > 0;

470 
£aud™_sÜt_t
 *
	$£aud™_sÜt_by_šode
(cÚ¡ 
dœeùiÚ
)

472  
	`sÜt_ü—‹
("šode", 
sÜt_šode_comp
, 
sÜt_šode_suµÜt
, 
dœeùiÚ
);

473 
	}
}

475 
sÜt_pid_comp
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt


476 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£aud™_mes§ge_t
 * 
a
, cÚ¡ s—ud™_mes§ge_ˆ* 
b
)

480 ià(
	ga
->
	gd©a
.
	gavc
->
	gpid
 < 
	gb
->data.avc->pid) {

483  
	ga
->
	gd©a
.
	gavc
->
	gpid
 - 
	gb
->data.avc->pid;

486 
sÜt_pid_suµÜt
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt
 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

488  
	gmsg
->
	gty³
 =ğ
SEAUDIT_MESSAGE_TYPE_AVC
 && 
msg
->
d©a
.
avc
->
pid
 > 0;

491 
£aud™_sÜt_t
 *
	$£aud™_sÜt_by_pid
(cÚ¡ 
dœeùiÚ
)

493  
	`sÜt_ü—‹
("pid", 
sÜt_pid_comp
, 
sÜt_pid_suµÜt
, 
dœeùiÚ
);

494 
	}
}

496 
sÜt_pÜt_comp
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt


497 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£aud™_mes§ge_t
 * 
a
, cÚ¡ s—ud™_mes§ge_ˆ* 
b
)

499  
	ga
->
	gd©a
.
	gavc
->
	gpÜt
 - 
	gb
->data.avc->port;

502 
sÜt_pÜt_suµÜt
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt
 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

504  
	gmsg
->
	gty³
 =ğ
SEAUDIT_MESSAGE_TYPE_AVC
 && 
msg
->
d©a
.
avc
->
pÜt
 > 0;

507 
£aud™_sÜt_t
 *
	$£aud™_sÜt_by_pÜt
(cÚ¡ 
dœeùiÚ
)

509  
	`sÜt_ü—‹
("pÜt", 
sÜt_pÜt_comp
, 
sÜt_pÜt_suµÜt
, 
dœeùiÚ
);

510 
	}
}

512 
sÜt_Ïddr_comp
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt


513 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£aud™_mes§ge_t
 * 
a
, cÚ¡ s—ud™_mes§ge_ˆ* 
b
)

515  
¡rcmp
(
a
->
d©a
.
avc
->
Ïddr
, 
b
->data.avc->laddr);

518 
sÜt_Ïddr_suµÜt
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt
 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

520  
	gmsg
->
	gty³
 =ğ
SEAUDIT_MESSAGE_TYPE_AVC
 && 
msg
->
d©a
.
avc
->
Ïddr
 !ğ
NULL
;

523 
£aud™_sÜt_t
 *
	$£aud™_sÜt_by_Ïddr
(cÚ¡ 
dœeùiÚ
)

525  
	`sÜt_ü—‹
("Ïddr", 
sÜt_Ïddr_comp
, 
sÜt_Ïddr_suµÜt
, 
dœeùiÚ
);

526 
	}
}

528 
sÜt_ÍÜt_comp
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt


529 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£aud™_mes§ge_t
 * 
a
, cÚ¡ s—ud™_mes§ge_ˆ* 
b
)

531  
	ga
->
	gd©a
.
	gavc
->
	gÍÜt
 - 
	gb
->data.avc->lport;

534 
sÜt_ÍÜt_suµÜt
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt
 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

536  
	gmsg
->
	gty³
 =ğ
SEAUDIT_MESSAGE_TYPE_AVC
 && 
msg
->
d©a
.
avc
->
ÍÜt
 > 0;

539 
£aud™_sÜt_t
 *
	$£aud™_sÜt_by_ÍÜt
(cÚ¡ 
dœeùiÚ
)

541  
	`sÜt_ü—‹
("ÍÜt", 
sÜt_ÍÜt_comp
, 
sÜt_ÍÜt_suµÜt
, 
dœeùiÚ
);

542 
	}
}

544 
sÜt_çddr_comp
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt


545 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£aud™_mes§ge_t
 * 
a
, cÚ¡ s—ud™_mes§ge_ˆ* 
b
)

547  
¡rcmp
(
a
->
d©a
.
avc
->
çddr
, 
b
->data.avc->faddr);

550 
sÜt_çddr_suµÜt
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt
 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

552  
	gmsg
->
	gty³
 =ğ
SEAUDIT_MESSAGE_TYPE_AVC
 && 
msg
->
d©a
.
avc
->
çddr
 !ğ
NULL
;

555 
£aud™_sÜt_t
 *
	$£aud™_sÜt_by_çddr
(cÚ¡ 
dœeùiÚ
)

557  
	`sÜt_ü—‹
("çddr", 
sÜt_çddr_comp
, 
sÜt_çddr_suµÜt
, 
dœeùiÚ
);

558 
	}
}

560 
sÜt_åÜt_comp
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt


561 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£aud™_mes§ge_t
 * 
a
, cÚ¡ s—ud™_mes§ge_ˆ* 
b
)

563  
	ga
->
	gd©a
.
	gavc
->
	gåÜt
 - 
	gb
->data.avc->fport;

566 
sÜt_åÜt_suµÜt
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt
 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

568  
	gmsg
->
	gty³
 =ğ
SEAUDIT_MESSAGE_TYPE_AVC
 && 
msg
->
d©a
.
avc
->
åÜt
 > 0;

571 
£aud™_sÜt_t
 *
	$£aud™_sÜt_by_åÜt
(cÚ¡ 
dœeùiÚ
)

573  
	`sÜt_ü—‹
("åÜt", 
sÜt_åÜt_comp
, 
sÜt_åÜt_suµÜt
, 
dœeùiÚ
);

574 
	}
}

576 
sÜt_§ddr_comp
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt


577 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£aud™_mes§ge_t
 * 
a
, cÚ¡ s—ud™_mes§ge_ˆ* 
b
)

579  
¡rcmp
(
a
->
d©a
.
avc
->
§ddr
, 
b
->data.avc->saddr);

582 
sÜt_§ddr_suµÜt
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt
 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

584  
	gmsg
->
	gty³
 =ğ
SEAUDIT_MESSAGE_TYPE_AVC
 && 
msg
->
d©a
.
avc
->
§ddr
 !ğ
NULL
;

587 
£aud™_sÜt_t
 *
	$£aud™_sÜt_by_§ddr
(cÚ¡ 
dœeùiÚ
)

589  
	`sÜt_ü—‹
("§ddr", 
sÜt_§ddr_comp
, 
sÜt_§ddr_suµÜt
, 
dœeùiÚ
);

590 
	}
}

592 
sÜt_¥Üt_comp
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt


593 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£aud™_mes§ge_t
 * 
a
, cÚ¡ s—ud™_mes§ge_ˆ* 
b
)

595  
	ga
->
	gd©a
.
	gavc
->
	gsourû
 - 
	gb
->data.avc->source;

598 
sÜt_¥Üt_suµÜt
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt
 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

600  
	gmsg
->
	gty³
 =ğ
SEAUDIT_MESSAGE_TYPE_AVC
 && 
msg
->
d©a
.
avc
->
sourû
 > 0;

603 
£aud™_sÜt_t
 *
	$£aud™_sÜt_by_¥Üt
(cÚ¡ 
dœeùiÚ
)

605  
	`sÜt_ü—‹
("¥Üt", 
sÜt_¥Üt_comp
, 
sÜt_¥Üt_suµÜt
, 
dœeùiÚ
);

606 
	}
}

608 
sÜt_daddr_comp
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt


609 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£aud™_mes§ge_t
 * 
a
, cÚ¡ s—ud™_mes§ge_ˆ* 
b
)

611  
¡rcmp
(
a
->
d©a
.
avc
->
daddr
, 
b
->data.avc->daddr);

614 
sÜt_daddr_suµÜt
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt
 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

616  
	gmsg
->
	gty³
 =ğ
SEAUDIT_MESSAGE_TYPE_AVC
 && 
msg
->
d©a
.
avc
->
daddr
 !ğ
NULL
;

619 
£aud™_sÜt_t
 *
	$£aud™_sÜt_by_daddr
(cÚ¡ 
dœeùiÚ
)

621  
	`sÜt_ü—‹
("daddr", 
sÜt_daddr_comp
, 
sÜt_daddr_suµÜt
, 
dœeùiÚ
);

622 
	}
}

624 
sÜt_dpÜt_comp
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt


625 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£aud™_mes§ge_t
 * 
a
, cÚ¡ s—ud™_mes§ge_ˆ* 
b
)

627  
	ga
->
	gd©a
.
	gavc
->
	gde¡
 - 
	gb
->data.avc->dest;

630 
sÜt_dpÜt_suµÜt
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt
 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

632  
	gmsg
->
	gty³
 =ğ
SEAUDIT_MESSAGE_TYPE_AVC
 && 
msg
->
d©a
.
avc
->
de¡
 > 0;

635 
£aud™_sÜt_t
 *
	$£aud™_sÜt_by_dpÜt
(cÚ¡ 
dœeùiÚ
)

637  
	`sÜt_ü—‹
("dpÜt", 
sÜt_dpÜt_comp
, 
sÜt_dpÜt_suµÜt
, 
dœeùiÚ
);

638 
	}
}

640 
sÜt_key_comp
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt


641 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£aud™_mes§ge_t
 * 
a
, cÚ¡ s—ud™_mes§ge_ˆ* 
b
)

643  
	ga
->
	gd©a
.
	gavc
->
	gkey
 - 
	gb
->data.avc->key;

646 
sÜt_key_suµÜt
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt
 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

648  
	gmsg
->
	gty³
 =ğ
SEAUDIT_MESSAGE_TYPE_AVC
 && 
msg
->
d©a
.
avc
->
is_key
;

651 
£aud™_sÜt_t
 *
	$£aud™_sÜt_by_key
(cÚ¡ 
dœeùiÚ
)

653  
	`sÜt_ü—‹
("key", 
sÜt_key_comp
, 
sÜt_key_suµÜt
, 
dœeùiÚ
);

654 
	}
}

656 
sÜt_ÿp_comp
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt


657 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£aud™_mes§ge_t
 * 
a
, cÚ¡ s—ud™_mes§ge_ˆ* 
b
)

659  
	ga
->
	gd©a
.
	gavc
->
	gÿ·b™y
 - 
	gb
->data.avc->capability;

662 
sÜt_ÿp_suµÜt
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt
 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

664  
	gmsg
->
	gty³
 =ğ
SEAUDIT_MESSAGE_TYPE_AVC
 && 
msg
->
d©a
.
avc
->
is_ÿ·b™y
;

667 
£aud™_sÜt_t
 *
	$£aud™_sÜt_by_ÿp
(cÚ¡ 
dœeùiÚ
)

669  
	`sÜt_ü—‹
("ÿp", 
sÜt_ÿp_comp
, 
sÜt_ÿp_suµÜt
, 
dœeùiÚ
);

670 
	}
}

674 
	ssÜt_Çme_m­


676 cÚ¡ *
	mÇme
;

677 
	m£aud™_sÜt_t
 *(*
	mü—‹_â
) ();

680 cÚ¡ 
sÜt_Çme_m­
 
	gü—‹_m­
[] = {

681 {"mes§ge_ty³", 
£aud™_sÜt_by_mes§ge_ty³
},

682 {"d©e", 
£aud™_sÜt_by_d©e
},

683 {"ho¡", 
£aud™_sÜt_by_ho¡
},

684 {"³rmissiÚ", 
£aud™_sÜt_by_³rmissiÚ
},

685 {"sourû_u£r", 
£aud™_sÜt_by_sourû_u£r
},

686 {"sourû_rŞe", 
£aud™_sÜt_by_sourû_rŞe
},

687 {"sourû_ty³", 
£aud™_sÜt_by_sourû_ty³
},

688 {"rg‘_u£r", 
£aud™_sÜt_by_rg‘_u£r
},

689 {"rg‘_rŞe", 
£aud™_sÜt_by_rg‘_rŞe
},

690 {"rg‘_ty³", 
£aud™_sÜt_by_rg‘_ty³
},

691 {"objeù_şass", 
£aud™_sÜt_by_objeù_şass
},

692 {"execubË", 
£aud™_sÜt_by_execubË
},

693 {"Çme", 
£aud™_sÜt_by_Çme
},

694 {"commªd", 
£aud™_sÜt_by_commªd
},

695 {"·th", 
£aud™_sÜt_by_·th
},

696 {"deviû", 
£aud™_sÜt_by_deviû
},

697 {"šode", 
£aud™_sÜt_by_šode
},

698 {"pid", 
£aud™_sÜt_by_pid
},

699 {"pÜt", 
£aud™_sÜt_by_pÜt
},

700 {"Ïddr", 
£aud™_sÜt_by_Ïddr
},

701 {"ÍÜt", 
£aud™_sÜt_by_ÍÜt
},

702 {"çddr", 
£aud™_sÜt_by_çddr
},

703 {"åÜt", 
£aud™_sÜt_by_åÜt
},

704 {"§ddr", 
£aud™_sÜt_by_§ddr
},

705 {"¥Üt", 
£aud™_sÜt_by_¥Üt
},

706 {"daddr", 
£aud™_sÜt_by_daddr
},

707 {"dpÜt", 
£aud™_sÜt_by_dpÜt
},

708 {"key", 
£aud™_sÜt_by_key
},

709 {"ÿp", 
£aud™_sÜt_by_ÿp
},

710 {
NULL
, NULL}

713 
£aud™_sÜt_t
 *
	$sÜt_ü—‹_äom_Çme
(cÚ¡ *
Çme
, 
dœeùiÚ
)

715 
size_t
 
i
;

716 
i
 = 0; 
ü—‹_m­
[i].
Çme
 !ğ
NULL
; i++) {

717 ià(
	`¡rcmp
(
ü—‹_m­
[
i
].
Çme
,‚ame) == 0) {

718  
ü—‹_m­
[
i
].
	`ü—‹_â
(
dœeùiÚ
);

721 
”ºo
 = 
EINVAL
;

722  
NULL
;

723 
	}
}

725 
	$sÜt_is_suµÜ‹d
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt
, cÚ¡ 
£aud™_mes§ge_t
 * 
msg
)

727  
sÜt
->
	`suµÜt
(sÜt, 
msg
);

728 
	}
}

730 
	$sÜt_comp
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt
, cÚ¡ 
£aud™_mes§ge_t
 * 
a
, cÚ¡ s—ud™_mes§ge_ˆ* 
b
)

732 
»tv®
 = 
sÜt
->
	`comp
(sÜt, 
a
, 
b
);

733  (
sÜt
->
dœeùiÚ
 >ğ0 ? 
»tv®
 : -1 *„etval);

734 
	}
}

736 cÚ¡ *
	$sÜt_g‘_Çme
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt
)

738  
sÜt
->
Çme
;

739 
	}
}

741 
	$sÜt_g‘_dœeùiÚ
(cÚ¡ 
£aud™_sÜt_t
 * 
sÜt
)

743  
sÜt
->
dœeùiÚ
;

744 
	}
}

	@libseaudit/src/util.c

26 
	~<cÚfig.h
>

27 
	~<£aud™/ut.h
>

29 cÚ¡ *
	$lib£aud™_g‘_v”siÚ
()

31  
LIBSEAUDIT_VERSION_STRING
;

32 
	}
}

	@libseaudit/tests/filters.c

26 
	~<cÚfig.h
>

28 
	~<CUn™/CUn™.h
>

29 
	~<­Ş/ut.h
>

30 
	~<£aud™/log.h
>

31 
	~<£aud™/mes§ge.h
>

32 
	~<£aud™/mod–.h
>

33 
	~<£aud™/·r£.h
>

35 
	~<¡dboŞ.h
>

36 
	~<¡dio.h
>

38 
	#MESSAGES_NOWARNS
 
TEST_POLICIES
 "/£toŞs-3.1/£aud™/mes§ges-now¬ns"

	)

40 
£aud™_log_t
 *
	gl
 = 
NULL
;

41 
£aud™_mod–_t
 *
	gm
 = 
NULL
;

43 
	$f‹rs_sim¶e
()

45 
£aud™_f‹r_t
 *
f
 = 
	`£aud™_f‹r_ü—‹
("simple filter");

46 
	`CU_ASSERT_PTR_NOT_NULL_FATAL
(
f
);

48 
»tv®
;

49 
­Ş_veùÜ_t
 *
v
 = 
	`­Ş_¡r_¥l™
("system_u", ":");

50 
	`CU_ASSERT_PTR_NOT_NULL_FATAL
(
v
);

51 
»tv®
 = 
	`£aud™_f‹r_£t_sourû_u£r
(
f
, 
v
);

52 
	`CU_ASSERT
(
»tv®
 == 0);

53 
	`­Ş_veùÜ_de¡roy
(&
v
);

55 
»tv®
 = 
	`£aud™_mod–_­³nd_f‹r
(
m
, 
f
);

56 
	`CU_ASSERT
(
»tv®
 == 0);

58 
v
 = 
	`£aud™_mod–_g‘_mes§ges
(
l
, 
m
);

59 
	`CU_ASSERT_PTR_NOT_NULL_FATAL
(
v
);

60 
	`CU_ASSERT
(
	`­Ş_veùÜ_g‘_size
(
v
) == 5 + 5);

61 
	`­Ş_veùÜ_de¡roy
(&
v
);

63 
»tv®
 = 
	`£aud™_f‹r_£t_¡riù
(
f
, 
Œue
);

64 
	`CU_ASSERT
(
»tv®
 == 0);

65 
v
 = 
	`£aud™_mod–_g‘_mes§ges
(
l
, 
m
);

66 
	`CU_ASSERT_PTR_NOT_NULL_FATAL
(
v
);

67 
	`CU_ASSERT
(
	`­Ş_veùÜ_g‘_size
(
v
) == 5);

68 
	`­Ş_veùÜ_de¡roy
(&
v
);

70 
»tv®
 = 
	`£aud™_f‹r_£t_¡riù
(
f
, 
çl£
);

71 
	`CU_ASSERT
(
»tv®
 == 0);

72 
v
 = 
	`£aud™_mod–_g‘_mes§ges
(
l
, 
m
);

73 
	`CU_ASSERT_PTR_NOT_NULL_FATAL
(
v
);

74 
	`CU_ASSERT
(
	`­Ş_veùÜ_g‘_size
(
v
) == 5 + 5);

75 
	`­Ş_veùÜ_de¡roy
(&
v
);

76 
	}
}

78 
CU_Te¡Info
 
	gf‹rs_‹¡s
[] = {

79 {"sim¶f‹r", 
f‹rs_sim¶e
},

80 
CU_TEST_INFO_NULL


83 
	$f‹rs_š™
()

85 
l
 = 
	`£aud™_log_ü—‹
(
NULL
, NULL);

86 ià(
l
 =ğ
NULL
) {

89 
m
 = 
	`£aud™_mod–_ü—‹
("f‹rs", 
l
);

90 ià(
m
 =ğ
NULL
) {

94 
FILE
 *
f
 = 
	`fİ’
(
MESSAGES_NOWARNS
, "r");

95 ià(
f
 =ğ
NULL
) {

98 
»tv®
;

99 
»tv®
 = 
	`£aud™_log_·r£
(
l
, 
f
);

100 ià(
»tv®
 != 0) {

101 
	`fşo£
(
f
);

105 
	`fşo£
(
f
);

107 
	}
}

109 
	$f‹rs_ş—nup
()

111 
	`£aud™_log_de¡roy
(&
l
);

112 
	`£aud™_mod–_de¡roy
(&
m
);

114 
	}
}

	@libseaudit/tests/filters.h

26 #iâdeà
FILTERS_H


27 
	#FILTERS_H


	)

29 
	~<CUn™/CUn™.h
>

31 
CU_Te¡Info
 
f‹rs_‹¡s
[];

32 
f‹rs_š™
();

33 
f‹rs_ş—nup
();

	@libseaudit/tests/libseaudit-tests.c

26 
	~<cÚfig.h
>

28 
	~<CUn™/CUn™.h
>

29 
	~<CUn™/Basic.h
>

31 
	~"f‹rs.h
"

32 
	~"·r£_fe.h
"

34 
	$maš
()

36 ià(
	`CU_š™Ÿlize_»gi¡ry
(è!ğ
CUE_SUCCESS
) {

37  
	`CU_g‘_”rÜ
();

40 
CU_Su™eInfo
 
su™es
[] = {

41 {"P¬£ Fe", 
·r£_fe_š™
, 
·r£_fe_ş—nup
, 
·r£_fe_‹¡s
}

43 {"F‹rs", 
f‹rs_š™
, 
f‹rs_ş—nup
, 
f‹rs_‹¡s
}

45 
CU_SUITE_INFO_NULL


48 
	`CU_»gi¡”_su™es
(
su™es
);

49 
	`CU_basic_£t_mode
(
CU_BRM_VERBOSE
);

50 
	`CU_basic_run_‹¡s
();

51 
num_çu»s
 = 
	`CU_g‘_numb”_of_çu»_»cÜds
();

52 
	`CU_ş—nup_»gi¡ry
();

53  ()
num_çu»s
;

54 
	}
}

	@libseaudit/tests/parse_file.c

26 
	~<cÚfig.h
>

28 
	~<CUn™/CUn™.h
>

29 
	~<£aud™/log.h
>

30 
	~<£aud™/·r£.h
>

32 
	~<¡dboŞ.h
>

33 
	~<¡dio.h
>

35 
	slog_ªsw”


37 cÚ¡ *
	mlog_Çme
;

38 
boŞ
 
	mhas_w¬nšgs
;

41 
	$·r£_fe_‹¡
(cÚ¡ 
log_ªsw”
 *
Ï
)

43 
£aud™_log_t
 *
l
 = 
	`£aud™_log_ü—‹
(
NULL
, NULL);

44 
	`CU_ASSERT_PTR_NOT_NULL_FATAL
(
l
);

46 
FILE
 *
f
 = 
	`fİ’
(
Ï
->
log_Çme
, "r");

47 
	`CU_ASSERT_PTR_NOT_NULL_FATAL
(
f
);

49 
»tv®
;

50 
»tv®
 = 
	`£aud™_log_·r£
(
l
, 
f
);

51 ià(
Ï
->
has_w¬nšgs
) {

52 
	`CU_ASSERT
(
»tv®
 > 0);

54 
	`CU_ASSERT
(
»tv®
 == 0);

57 
	`fşo£
(
f
);

58 
	`£aud™_log_de¡roy
(&
l
);

59 
	}
}

61 
	$·r£_fe_fc4
()

63 
log_ªsw”
 
l
 = {

64 
TEST_POLICIES
 "/setools-3.0/seaudit/messages-FC4",

65 
çl£


67 
	`·r£_fe_‹¡
(&
l
);

68 
	}
}

70 
	$·r£_fe_fc5
()

72 
log_ªsw”
 
l
 = {

73 
TEST_POLICIES
 "/setools-3.0/seaudit/messages-FC5",

74 
çl£


76 
	`·r£_fe_‹¡
(&
l
);

77 
	}
}

79 
	$·r£_fe_now¬ns
()

81 
log_ªsw”
 
l
 = {

82 
TEST_POLICIES
 "/setools-3.1/seaudit/messages-nowarns",

83 
çl£


85 
	`·r£_fe_‹¡
(&
l
);

86 
	}
}

88 
	$·r£_fe_w¬nšgs
()

90 
log_ªsw”
 
l
 = {

91 
TEST_POLICIES
 "/setools-3.1/seaudit/messages-warnings",

92 
Œue


94 
	`·r£_fe_‹¡
(&
l
);

95 
	}
}

97 
CU_Te¡Info
 
	g·r£_fe_‹¡s
[] = {

98 {"FC4†og", 
·r£_fe_fc4
},

99 {"FC5†og", 
·r£_fe_fc5
},

100 {"mes§ges-now¬ns", 
·r£_fe_now¬ns
},

101 {"mes§ges-w¬nšgs", 
·r£_fe_w¬nšgs
},

102 
CU_TEST_INFO_NULL


105 
	$·r£_fe_š™
()

108 
	}
}

110 
	$·r£_fe_ş—nup
()

113 
	}
}

	@libseaudit/tests/parse_file.h

26 #iâdeà
PARSE_FILE_H


27 
	#PARSE_FILE_H


	)

29 
	~<CUn™/CUn™.h
>

31 
CU_Te¡Info
 
·r£_fe_‹¡s
[];

32 
·r£_fe_š™
();

33 
·r£_fe_ş—nup
();

	@libsefs/include/sefs/db.hh

25 #iâdeà
SEFS_DB_H


26 
	#SEFS_DB_H


	)

28 
	~<£fs/fşi¡.hh
>

29 
	~<£fs/fesy¡em.hh
>

31 #ifdeà
__ılu¥lus


35 
	~<time.h
>

36 
	~<­Ş/b¡.h
>

37 
	~<­Ş/veùÜ.h
>

39 #ifdeà
__ılu¥lus


42 
	~<¡dexû±
>

48 şas 
	c£fs_db
:
public
 
£fs_fşi¡


50 #iâdeà
SWIG_FRIENDS


53 
ä›nd
 
db_ü—‹_äom_fesy¡em
(
£fs_fşi¡
 * 
fşi¡
 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£fs_’Œy
 * 
’Œy
, *
¬g
);

54 
ä›nd
 
£fs_cÚ‹xt_node
 *
	$db_g‘_cÚ‹xt
(
£fs_db
 *, const *, const *, const *,

55 cÚ¡ *è
	`throw
(
¡d
::
bad_®loc
);

56 
ä›nd
 
£fs_’Œy
 *
	$db_g‘_’Œy
(
£fs_db
 *, cÚ¡ 
£fs_cÚ‹xt_node
 *, 
ušt32_t
, cÚ¡ *, 
šo64_t
,

57 cÚ¡ *è
	`throw
(
¡d
::
bad_®loc
);

60 
public
:

74 
	$£fs_db
(
£fs_fesy¡em
 * 
fs
, 
£fs_ÿÎback_â_t
 
msg_ÿÎback
, *
v¬g
è
	`throw
(
¡d
::
šv®id_¬gum’t
,

75 
¡d
::
ruÁime_”rÜ
);

89 
	$£fs_db
(cÚ¡ *
f’ame
, 
£fs_ÿÎback_â_t
 
msg_ÿÎback
, *
v¬g
è
	`throw
(
¡d
::
šv®id_¬gum’t
,

90 
¡d
::
ruÁime_”rÜ
);

92 ~
	`£fs_db
();

116 
	$runQu”yM­
(
£fs_qu”y
 * 
qu”y
, 
£fs_fşi¡_m­_â_t
 
â
, *
d©a
è
	`throw
(
¡d
::
ruÁime_”rÜ
, std::
šv®id_¬gum’t
);

124 
boŞ
 
	$isMLS
() const;

135 
	$§ve
(cÚ¡ *
f’ame
è
	`throw
(
¡d
::
šv®id_¬gum’t
, std::
ruÁime_”rÜ
);

141 
time_t
 
	$g‘CTime
() const;

150 
boŞ
 
	`isDB
(cÚ¡ *
f’ame
);

152 
´iv©e
:

156 
	$upg¿deToDB2
(è
	`throw
(
¡d
::
ruÁime_”rÜ
);

158 cÚ¡ 
£fs_cÚ‹xt_node
 *
	`g‘CÚ‹xtNode
(cÚ¡ 
£fs_’Œy
 * 
’Œy
);

159 
£fs_’Œy
 *
	$g‘EÁry
(cÚ¡ 
£fs_cÚ‹xt_node
 *
cÚ‹xt
, 
ušt32_t
 
objeùCÏss
, cÚ¡ *
·th
, 
šo64_t
 
šode
,

160 cÚ¡ *
dev
è
	`throw
(
¡d
::
bad_®loc
);

161 
sql™e3
 *
_db
;

162 
time_t
 
_ùime
;

171 #iâdeà
SWIG


173 
£fs_db
 
	t£fs_db_t
;

174 
£fs_fesy¡em
 
	t£fs_fesy¡em_t
;

180 
£fs_fşi¡_t
 *
	`£fs_db_ü—‹_äom_fesy¡em
(
£fs_fesy¡em_t
 * 
fs
, 
£fs_ÿÎback_â_t
 
msg_ÿÎback
, *
v¬g
);

187 
£fs_fşi¡_t
 *
	`£fs_db_ü—‹_äom_fe
(cÚ¡ *
·th
, 
£fs_ÿÎback_â_t
 
msg_ÿÎback
, *
v¬g
);

193 
	`£fs_db_§ve
(
£fs_db_t
 * 
db
, cÚ¡ *
f’ame
);

199 
time_t
 
	`£fs_db_g‘_ùime
(
£fs_db_t
 * 
db
);

205 
boŞ
 
	`£fs_db_is_db
(cÚ¡ *
f’ame
);

209 #ifdeà
__ılu¥lus


210 
	}
}

	@libsefs/include/sefs/entry.hh

25 #iâdeà
SEFS_ENTRY_H


26 
	#SEFS_ENTRY_H


	)

28 #ifdeà
__ılu¥lus


33 
	~<sys/ty³s.h
>

34 
	~<­Ş/cÚ‹xt-qu”y.h
>

35 
	~<­Ş/veùÜ.h
>

37 #ifdeà
__ılu¥lus


40 
	~<¡dexû±
>

42 
şass
 
£fs_fşi¡
;

43 
	g£fs_cÚ‹xt_node
;

51 şas 
	c£fs_’Œy


53 
ä›nd
 
şass
 
	m£fs_db
;

54 
ä›nd
 
şass
 
	m£fs_fcfe
;

55 
ä›nd
 
şass
 
	m£fs_fesy¡em
;

57 
	mpublic
:

62 
£fs_’Œy
(cÚ¡ sefs_’Œy * 
e
);

64 ~
£fs_’Œy
();

74 cÚ¡ 
­Ş_cÚ‹xt_t
 *
	$cÚ‹xt
() const;

82 
šo64_t
 
	$šode
() const;

93 cÚ¡ *
	$dev
() const;

106 
ušt32_t
 
	$objeùCÏss
() const;

114 cÚ¡ *
	$·th
() const;

124 cÚ¡ *
	$Üigš
() const;

134 *
	$toSŒšg
(ècÚ¡ 
	`throw
(
¡d
::
bad_®loc
);

136 
´iv©e
:

151 
	`£fs_’Œy
(
şass
 
£fs_fşi¡
 * 
fşi¡
, cÚ¡ 
£fs_cÚ‹xt_node
 *
Ãw_cÚ‹xt
, 
ušt32_t
 
Ãw_objeùCÏss
,

152 cÚ¡ *
Ãw_·th
, cÚ¡ *
Ãw_Üigš
 = 
NULL
);

156 
şass
 
£fs_fşi¡
 *
_fşi¡
;

157 cÚ¡ 
£fs_cÚ‹xt_node
 *
_cÚ‹xt
;

158 
šo64_t
 
_šode
;

159 cÚ¡ *
_dev
;

160 
ušt32_t
 
_objeùCÏss
;

161 cÚ¡ *
_·th
, *
_Üigš
;

170 #iâdeà
SWIG


172 
£fs_’Œy
 
	t£fs_’Œy_t
;

178 cÚ¡ 
­Ş_cÚ‹xt_t
 *
	`£fs_’Œy_g‘_cÚ‹xt
(cÚ¡ 
£fs_’Œy_t
 * 
’t
);

184 
šo64_t
 
	`£fs_’Œy_g‘_šode
(cÚ¡ 
£fs_’Œy_t
 * 
’t
);

190 cÚ¡ *
	`£fs_’Œy_g‘_dev
(cÚ¡ 
£fs_’Œy_t
 * 
’t
);

196 
ušt32_t
 
	`£fs_’Œy_g‘_objeù_şass
(cÚ¡ 
£fs_’Œy_t
 * 
’t
);

202 cÚ¡ *
	`£fs_’Œy_g‘_·th
(cÚ¡ 
£fs_’Œy_t
 * 
’t
);

208 cÚ¡ *
	`£fs_’Œy_g‘_Üigš
(cÚ¡ 
£fs_’Œy_t
 * 
’t
);

214 *
	`£fs_’Œy_to_¡ršg
(cÚ¡ 
£fs_’Œy_t
 * 
’t
);

218 #ifdeà
__ılu¥lus


219 
	}
}

	@libsefs/include/sefs/fcfile.hh

25 #iâdeà
SEFS_FCFILE_H


26 
	#SEFS_FCFILE_H


	)

28 
	~<£fs/fşi¡.hh
>

30 #ifdeà
__ılu¥lus


35 
	~<¡dlib.h
>

37 
	~<­Ş/veùÜ.h
>

39 #ifdeà
__ılu¥lus


42 
	~<¡dexû±
>

48 şas 
	c£fs_fcfe
:
public
 
£fs_fşi¡


50 
public
:

61 
	$£fs_fcfe
(
£fs_ÿÎback_â_t
 
msg_ÿÎback
, *
v¬g
è
	`throw
(
¡d
::
bad_®loc
);

76 
	$£fs_fcfe
(cÚ¡ *
fe
, 
£fs_ÿÎback_â_t
 
msg_ÿÎback
, *
v¬g
è
	`throw
(
¡d
::
bad_®loc
, std::
šv®id_¬gum’t
,

77 
¡d
::
ruÁime_”rÜ
);

93 
	$£fs_fcfe
(cÚ¡ 
­Ş_veùÜ_t
 * 
fes
, 
£fs_ÿÎback_â_t
 
msg_ÿÎback
, *
v¬g
è
	`throw
(
¡d
::
bad_®loc
,

94 
¡d
::
šv®id_¬gum’t
,

95 
¡d
::
ruÁime_”rÜ
);

97 ~
	`£fs_fcfe
();

122 
	$runQu”yM­
(
£fs_qu”y
 * 
qu”y
, 
£fs_fşi¡_m­_â_t
 
â
, *
d©a
è
	`throw
(
¡d
::
ruÁime_”rÜ
, std::
šv®id_¬gum’t
);

129 
boŞ
 
	$isMLS
() const;

145 
	$­³ndFe
(cÚ¡ *
fe
è
	`throw
(
¡d
::
bad_®loc
, std::
šv®id_¬gum’t
, std::
ruÁime_”rÜ
);

167 
size_t
 
	$­³ndFeLi¡
(cÚ¡ 
­Ş_veùÜ_t
 * 
fes
è
	`throw
(
¡d
::
bad_®loc
, std::
šv®id_¬gum’t
, std::
ruÁime_”rÜ
);

176 cÚ¡ 
­Ş_veùÜ_t
 *
	$feLi¡
() const;

178 
´iv©e
:

194 
	$·r£_lše
(cÚ¡ *
Üigš
, cÚ¡ *
lše
, 
»gex_t
 * 
lše_»gex
,„egex_ˆ* 
cÚ‹xt_»gex
è
	`throw
(
¡d
::
bad_®loc
,

195 
¡d
::

196 
ruÁime_”rÜ
);

198 
­Ş_veùÜ_t
 *
_fes
, *
_’Œ›s
;

199 
boŞ
 
_mls
, 
_mls_£t
;

208 #iâdeà
SWIG


210 
£fs_fcfe
 
	t£fs_fcfe_t
;

216 
£fs_fşi¡_t
 *
	`£fs_fcfe_ü—‹
(
£fs_ÿÎback_â_t
 
msg_ÿÎback
, *
v¬g
);

223 
£fs_fşi¡_t
 *
	`£fs_fcfe_ü—‹_äom_fe
(cÚ¡ *
fe
, 
£fs_ÿÎback_â_t
 
msg_ÿÎback
, *
v¬g
);

230 
£fs_fşi¡_t
 *
	`£fs_fcfe_ü—‹_äom_fe_li¡
(cÚ¡ 
­Ş_veùÜ_t
 * 
fes
, 
£fs_ÿÎback_â_t
 
msg_ÿÎback
,

231 *
v¬g
);

239 
	`£fs_fcfe_­³nd_fe
(
£fs_fcfe_t
 * 
fcfe
, cÚ¡ *
fe
);

246 
size_t
 
	`£fs_fcfe_­³nd_fe_li¡
(
£fs_fcfe_t
 * 
fcfe
, cÚ¡ 
­Ş_veùÜ_t
 * 
fes
);

253 cÚ¡ 
­Ş_veùÜ_t
 *
	`£fs_fcfe_g‘_fe_li¡
(cÚ¡ 
£fs_fcfe_t
 * 
fcfe
);

257 #ifdeà
__ılu¥lus


258 
	}
}

	@libsefs/include/sefs/fclist.hh

27 #iâdeà
SEFS_FCLIST_H


28 
	#SEFS_FCLIST_H


	)

30 
	~<£fs/’Œy.hh
>

31 
	~<£fs/qu”y.hh
>

33 #ifdeà
__ılu¥lus


38 
	~<£lšux/£lšux.h
>

39 
	~<¡d¬g.h
>

41 #iâdeà
__ılu¥lus


42 
	~<¡dboŞ.h
>

45 
	~<­Ş/pŞicy.h
>

47 
	#SEFS_MSG_ERR
 1

	)

48 
	#SEFS_MSG_WARN
 2

	)

49 
	#SEFS_MSG_INFO
 3

	)

51 
£fs_fşi¡
;

53 (*
£fs_ÿÎback_â_t
è(*
	tv¬g
, cÚ¡ 
	t£fs_fşi¡
 * 
	tfşi¡
, 
	tËv–
, cÚ¡ *
	tfmt
,

54 
	tva_li¡
 
	t¬gp
);

59 
	e£fs_fşi¡_ty³


61 
SEFS_FCLIST_TYPE_NONE
 = 0,

62 
SEFS_FCLIST_TYPE_FILESYSTEM
,

63 
SEFS_FCLIST_TYPE_FCFILE
,

64 
SEFS_FCLIST_TYPE_DB


65 } 
	t£fs_fşi¡_ty³_e
;

71 
	#SEFS_ERR
(
fşi¡
, 
fÜm©
, ...è
	`£fs_fşi¡_hªdËMsg
(fşi¡, 
SEFS_MSG_ERR
, fÜm©, 
__VA_ARGS__
)

	)

77 
	#SEFS_WARN
(
fşi¡
, 
fÜm©
, ...è
	`£fs_fşi¡_hªdËMsg
(fşi¡, 
SEFS_MSG_WARN
, fÜm©, 
__VA_ARGS__
)

	)

83 
	#SEFS_INFO
(
fşi¡
, 
fÜm©
, ...è
	`£fs_fşi¡_hªdËMsg
(fşi¡, 
SEFS_MSG_INFO
, fÜm©, 
__VA_ARGS__
)

	)

85 
£fs_fşi¡_hªdËMsg
(cÚ¡ 
£fs_fşi¡
 *
fşi¡
, 
Ëv–
, cÚ¡ *
fmt
, ...);

87 
__©Œibu‹__
 ((
fÜm©
(
´štf
, 3, 4))è
£fs_fşi¡_hªdËMsg
(cÚ¡ 
£fs_fşi¡
 *
fşi¡
, 
Ëv–
,

88 cÚ¡ *
fmt
, ...);

90 #ifdeà
__ılu¥lus


93 
	~<¡dexû±
>

95 
	g­Ş_b¡
;

96 
	gcÚ‹xt_node
;

98 
	#SEFS_MAP_FUNC_DEFINED


	)

103 (*
	t£fs_fşi¡_m­_â_t
è(
	t£fs_fşi¡
 *, cÚ¡ 
	t£fs_’Œy
 *, *);

109 şas 
	c£fs_fşi¡


111 #iâdeà
SWIG_FRIENDS


112 
ä›nd
 
	`£fs_fşi¡_hªdËMsg
(cÚ¡ 
£fs_fşi¡
 * 
fşi¡
, 
Ëv–
, cÚ¡ *
fmt
, ...);

113 
ä›nd
 
şass
 
£fs_’Œy
;

116 
public
:

117 
vœtu®
 ~
	`£fs_fşi¡
();

147 
vœtu®
 
	$runQu”yM­
(
£fs_qu”y
 * 
qu”y
, 
£fs_fşi¡_m­_â_t
 
â
, *
d©a
è
	`throw
(
¡d
::
ruÁime_”rÜ
,

148 
¡d
::
šv®id_¬gum’t
) = 0;

166 
­Ş_veùÜ_t
 *
	$runQu”y
(
£fs_qu”y
 * 
qu”y
è
	`throw
(
¡d
::
bad_®loc
, std::
ruÁime_”rÜ
, std::
šv®id_¬gum’t
);

173 
vœtu®
 
boŞ
 
	$isMLS
() const = 0;

187 
	`assocŸ‹PŞicy
(
­Ş_pŞicy_t
 * 
Ãw_pŞicy
);

196 
­Ş_pŞicy_t
 *
	$assocŸ‹PŞicy
() const;

203 
£fs_fşi¡_ty³_e
 
	$fşi¡_ty³
() const;

205 
´Ùeùed
:

206 
	$£fs_fşi¡
(
£fs_fşi¡_ty³_e
 
ty³
, 
£fs_ÿÎback_â_t
 
ÿÎback
, *
v¬g
è
	`throw
(
¡d
::
bad_®loc
);

224 
£fs_cÚ‹xt_node
 *
	$g‘CÚ‹xt
(cÚ¡ *
u£r
, cÚ¡ *
rŞe
, cÚ¡ *
ty³
,

225 cÚ¡ *
¿nge
è
	`throw
(
¡d
::
bad_®loc
);

237 
£fs_cÚ‹xt_node
 *
	$g‘CÚ‹xt
(cÚ¡ 
£cur™y_cÚ‹xt_t
 
scÚ
è
	`throw
(
¡d
::
bad_®loc
);

239 
­Ş_pŞicy_t
 *
pŞicy
;

240 
­Ş_b¡
 *
u£r_Œ“
, *
rŞe_Œ“
, *
ty³_Œ“
, *
¿nge_Œ“
, *
·th_Œ“
;

241 
­Ş_b¡
 *
dev_Œ“
;

242 
­Ş_b¡
 *
cÚ‹xt_Œ“
;

244 
´iv©e
:

254 
	$hªdËMsg
(
Ëv–
, cÚ¡ *
fmt
, 
va_li¡
 
va_¬gs
) const;

256 
£fs_ÿÎback_â_t
 
_ÿÎback
;

257 *
_v¬g
;

258 
£fs_fşi¡_ty³_e
 
_fşi¡_ty³
;

267 #iâdeà
SWIG


269 
£fs_fşi¡
 
	t£fs_fşi¡_t
;

271 #iâdeà
SEFS_MAP_FUNC_DEFINED


272 
£fs_fşi¡
;

273 
£fs_’Œy
;

274 (*
	t£fs_fşi¡_m­_â_t
è(
	t£fs_fşi¡
 *, cÚ¡ 
	t£fs_’Œy
 *, *);

283 
	`£fs_fşi¡_de¡roy
(
£fs_fşi¡_t
 ** 
fşi¡
);

289 
	`£fs_fşi¡_run_qu”y_m­
(
£fs_fşi¡_t
 * 
fşi¡
, 
£fs_qu”y_t
 * 
qu”y
, 
£fs_fşi¡_m­_â_t
 
â
, *
d©a
);

295 
­Ş_veùÜ_t
 *
	`£fs_fşi¡_run_qu”y
(
£fs_fşi¡_t
 * 
fşi¡
, 
£fs_qu”y_t
 * 
qu”y
);

301 
boŞ
 
	`£fs_fşi¡_g‘_is_mls
(cÚ¡ 
£fs_fşi¡_t
 * 
fşi¡
);

309 
	`£fs_fşi¡_assocŸ‹_pŞicy
(
£fs_fşi¡_t
 * 
fşi¡
, 
­Ş_pŞicy_t
 * 
pŞicy
);

315 
£fs_fşi¡_ty³_e
 
	`£fs_fşi¡_g‘_fşi¡_ty³
(cÚ¡ 
£fs_fşi¡_t
 * 
fşi¡
);

319 #ifdeà
__ılu¥lus


320 
	}
}

	@libsefs/include/sefs/filesystem.hh

25 #iâdeà
SEFS_FILESYSTEM_H


26 
	#SEFS_FILESYSTEM_H


	)

28 
	~<£fs/fşi¡.hh
>

30 #ifdeà
__ılu¥lus


35 
	~<­Ş/veùÜ.h
>

37 #ifdeà
__ılu¥lus


40 
	~<¡dexû±
>

49 şas 
	c£fs_fesy¡em
:
public
 
£fs_fşi¡


51 #iâdeà
SWIG_FRIENDS


54 
ä›nd
 
£fs_cÚ‹xt_node
 *
	$fesy¡em_g‘_cÚ‹xt
(
£fs_fesy¡em
 *, 
£cur™y_cÚ‹xt_t
è
	`throw
(
¡d
::
bad_®loc
);

55 
ä›nd
 
£fs_’Œy
 *
	$fesy¡em_g‘_’Œy
(
£fs_fesy¡em
 *, cÚ¡ 
£fs_cÚ‹xt_node
 *, 
ušt32_t
,

56 cÚ¡ *, 
šo64_t
, cÚ¡ *è
	`throw
(
¡d
::
bad_®loc
);

57 
ä›nd
 
boŞ
 
	$fesy¡em_is_qu”y_m©ch
(
£fs_fesy¡em
 *, cÚ¡ 
£fs_qu”y
 *, const *, const *,

58 cÚ¡ 
¡©64
 *, 
­Ş_veùÜ_t
 *, 
­Ş_mls_¿nge_t
 *è
	`throw
(
¡d
::
ruÁime_”rÜ
);

61 
public
:

79 
	$£fs_fesy¡em
(cÚ¡ *
Ãw_roÙ
, 
£fs_ÿÎback_â_t
 
msg_ÿÎback
, *
v¬g
è
	`throw
(
¡d
::
bad_®loc
,

80 
¡d
::
šv®id_¬gum’t
,

81 
¡d
::
ruÁime_”rÜ
);

83 ~
	`£fs_fesy¡em
();

108 
	$runQu”yM­
(
£fs_qu”y
 * 
qu”y
, 
£fs_fşi¡_m­_â_t
 
â
, *
d©a
è
	`throw
(
¡d
::
ruÁime_”rÜ
, std::
šv®id_¬gum’t
);

116 
boŞ
 
	$isMLS
() const;

123 cÚ¡ *
	$roÙ
() const;

133 cÚ¡ *
	$g‘DevName
(cÚ¡ 
dev_t
 
dev
è
	`throw
(
¡d
::
ruÁime_”rÜ
);

135 
´iv©e
:

136 
­Ş_veùÜ_t
 * 
	$budDevM­
(è
	`throw
(
¡d
::
ruÁime_”rÜ
);

137 
boŞ
 
	$isQu”yM©ch
(cÚ¡ 
£fs_qu”y
 * 
qu”y
, cÚ¡ *
·th
, cÚ¡ *
dev
, cÚ¡ 
¡©64
 *
sb
,

138 
­Ş_veùÜ_t
 * 
ty³_li¡
, 
­Ş_mls_¿nge_t
 * 
¿nge
è
	`throw
(
¡d
::
ruÁime_”rÜ
);

139 
£fs_’Œy
 *
	$g‘EÁry
(cÚ¡ 
£fs_cÚ‹xt_node
 *
cÚ‹xt
, 
ušt32_t
 
objeùCÏss
, cÚ¡ *
·th
, 
šo64_t
 
šo
,

140 cÚ¡ *
dev_Çme
è
	`throw
(
¡d
::
bad_®loc
);

141 *
_roÙ
;

142 
boŞ
 
_rw
, 
_mls
;

151 #iâdeà
SWIG


153 
£fs_fesy¡em
 
	t£fs_fesy¡em_t
;

160 
£fs_fesy¡em_t
 *
	`£fs_fesy¡em_ü—‹
(cÚ¡ *
roÙ
, 
£fs_ÿÎback_â_t
 
msg_ÿÎback
, *
v¬g
);

166 cÚ¡ *
	`£fs_fesy¡em_g‘_roÙ
(cÚ¡ 
£fs_fesy¡em_t
 * 
fs
);

173 cÚ¡ *
	`£fs_fesy¡em_g‘_dev_Çme
(
£fs_fesy¡em_t
 * 
fs
, cÚ¡ 
dev_t
 
dev
);

177 #ifdeà
__ılu¥lus


178 
	}
}

	@libsefs/include/sefs/query.hh

25 #iâdeà
SEFS_QUERY_H


26 
	#SEFS_QUERY_H


	)

28 #ifdeà
__ılu¥lus


33 
	~<sys/ty³s.h
>

34 
	~<»gex.h
>

36 #iâdeà
__ılu¥lus


37 
	~<¡dboŞ.h
>

40 
	~<­Ş/cÚ‹xt-qu”y.h
>

41 
	~<­Ş/mls-qu”y.h
>

42 
	~<­Ş/pŞicy-qu”y.h
>

43 
	~<­Ş/veùÜ.h
>

45 #ifdeà
__ılu¥lus


48 
	~<¡dexû±
>

57 şas 
	c£fs_qu”y


59 
ä›nd
 
şass
 
£fs_db
;

60 
ä›nd
 
şass
 
£fs_fcfe
;

61 
ä›nd
 
şass
 
£fs_fesy¡em
;

63 
public
:

70 
£fs_qu”y
();

72 ~
£fs_qu”y
();

81 
	$u£r
(cÚ¡ *
Çme
è
	`throw
(
¡d
::
bad_®loc
);

90 
	$rŞe
(cÚ¡ *
Çme
è
	`throw
(
¡d
::
bad_®loc
);

107 
	$ty³
(cÚ¡ *
Çme
, 
boŞ
 
šdœeù
è
	`throw
(
¡d
::
bad_®loc
);

129 
	$¿nge
(cÚ¡ *
Çme
, 
m©ch
è
	`throw
(
¡d
::
bad_®loc
);

145 
	`objeùCÏss
(
ušt32_t
 
objşass
);

157 
	`objeùCÏss
(cÚ¡ *
Çme
);

175 
	$·th
(cÚ¡ *
¡r
è
	`throw
(
¡d
::
bad_®loc
);

183 
	`šode
(
šo64_t
 
šo
);

195 
	$dev
(cÚ¡ *
¡r
è
	`throw
(
¡d
::
bad_®loc
);

203 
	`»gex
(
boŞ
 
r
);

205 
´iv©e
:

214 
	$compe
(è
	`throw
(
¡d
::
bad_®loc
, std::
šv®id_¬gum’t
);

216 *
_u£r
, *
_rŞe
, *
_ty³
, *
_¿nge
, *
_·th
, *
_dev
;

217 
ušt32_t
 
_objşass
;

218 
boŞ
 
_šdœeù
, 
_»gex
, 
_»cursive
;

219 
_¿ngeM©ch
;

220 
šo64_t
 
_šode
;

221 
boŞ
 
_»comped
;

222 
»gex_t
 *
_»u£r
, *
_»rŞe
, *
_»ty³
, *
_»¿nge
, *
_»·th
, *
_»dev
;

231 #iâdeà
SWIG


233 
£fs_qu”y
 
	t£fs_qu”y_t
;

239 
£fs_qu”y_t
 *
	`£fs_qu”y_ü—‹
();

247 
	`£fs_qu”y_de¡roy
(
£fs_qu”y_t
 ** 
qu”y
);

254 
	`£fs_qu”y_£t_u£r
(
£fs_qu”y_t
 * 
qu”y
, cÚ¡ *
Çme
);

261 
	`£fs_qu”y_£t_rŞe
(
£fs_qu”y_t
 * 
qu”y
, cÚ¡ *
Çme
);

270 
	`£fs_qu”y_£t_ty³
(
£fs_qu”y_t
 * 
qu”y
, cÚ¡ *
Çme
, 
boŞ
 
šdœeù
);

279 
	`£fs_qu”y_£t_¿nge
(
£fs_qu”y_t
 * 
qu”y
, cÚ¡ *
¿nge
, 
m©ch
);

287 
	`£fs_qu”y_£t_objeù_şass
(
£fs_qu”y_t
 * 
qu”y
, 
ušt32_t
 
objşass
);

294 
	`£fs_qu”y_£t_objeù_şass_¡r
(
£fs_qu”y_t
 * 
qu”y
, cÚ¡ *
Çme
);

300 
	`£fs_qu”y_£t_·th
(
£fs_qu”y_t
 * 
qu”y
, cÚ¡ *
·th
);

307 
	`£fs_qu”y_£t_šode
(
£fs_qu”y_t
 * 
qu”y
, 
šo64_t
 
šode
);

313 
	`£fs_qu”y_£t_dev
(
£fs_qu”y_t
 * 
qu”y
, cÚ¡ *
dev
);

321 
	`£fs_qu”y_£t_»gex
(
£fs_qu”y_t
 * 
qu”y
, 
boŞ
 
»gex
);

325 #ifdeà
__ılu¥lus


326 
	}
}

	@libsefs/include/sefs/util.h

26 #iâdeà
SEFS_UTIL_H


27 
	#SEFS_UTIL_H


	)

29 #ifdef 
__ılu¥lus


39 cÚ¡ *
lib£fs_g‘_v”siÚ
();

50 *
£fs_deçuÉ_fe_cÚ‹xts_g‘_·th
();

52 #ifdef 
__ılu¥lus


	@libsefs/src/db.cc

27 
	~<cÚfig.h
>

29 
	~"£fs_š‹º®.hh
"

31 
	~<£fs/db.hh
>

32 
	~<£fs/fesy¡em.hh
>

33 
	~<£fs/’Œy.hh
>

34 
	~<­Ş/ut.h
>

36 
	~<sql™e3.h
>

38 
	~<as£¹.h
>

39 
	~<”ºo.h
>

40 
	~<¡ršg.h
>

41 
	~<time.h
>

42 
	~<uni¡d.h
>

43 
	~<sys/¡©.h
>

44 
	~<sys/ty³s.h
>

46 
	#DB_MAX_VERSION
 "2"

	)

48 
	#DB_SCHEMA_NONMLS
 \

54 "CREATE TABLE infØ(key v¬ch¬, v®uv¬ch¬);"

	)

56 
	#DB_SCHEMA_MLS
 
DB_SCHEMA_NONMLS
 \

57 "CREATE TABLE ml (mls_id INTEGER PRIMARY KEY, mls_¿ngv¬ch¬ (64));"

	)

61 
šlše
 
£fs_cÚ‹xt_node
 *
	$db_g‘_cÚ‹xt
(
£fs_db
 * 
db
, cÚ¡ *
u£r
, cÚ¡ *
rŞe
, cÚ¡ *
ty³
,

62 cÚ¡ *
¿nge
è
	$throw
(
¡d
::
bad_®loc
)

64  
db
->
	`g‘CÚ‹xt
(
u£r
, 
rŞe
, 
ty³
, 
¿nge
);

65 
	}
}

67 
šlše
 
£fs_’Œy
 *
	$db_g‘_’Œy
(
£fs_db
 * 
db
, cÚ¡ 
£fs_cÚ‹xt_node
 * 
node
, 
ušt32_t
 
objCÏss
,

68 cÚ¡ *
·th
, 
šo64_t
 
šode
, cÚ¡ *
dev
)
	$throw
(
¡d
::
bad_®loc
)

70  
db
->
	`g‘EÁry
(
node
, 
objCÏss
, 
·th
, 
šode
, 
dev
);

71 
	}
}

75 
	sdb_ÿÎback_¬g


77 
sql™e3
 *
	mdb
;

78 *
	m”rmsg
;

79 cÚ¡ *
	msourû_db
, *
	mrg‘_db
;

82 
	sdb_qu”y_¬g


84 
£fs_db
 *
	mdb
;

85 *
	mu£r
, *
	mrŞe
, *
	mty³
, *
	m¿nge
, *
	m·th
, *
	mdev
;

86 
boŞ
 
	m»gex
, 
	mdb_is_mls
;

87 
»gex_t
 *
	m»u£r
, *
	m»rŞe
, *
	m»ty³
, *
	m»¿nge
, *
	m»·th
, *
	m»dev
;

88 
	m¿ngeM©ch
;

89 
£fs_fşi¡_m­_â_t
 
	mâ
;

90 *
	md©a
;

91 
­Ş_veùÜ_t
 *
	mty³_li¡
;

92 
­Ş_mls_¿nge_t
 *
	m­Ş_¿nge
;

93 
­Ş_pŞicy_t
 *
	mpŞicy
;

94 
boŞ
 
	mabÜ‹d
;

95 
	m»tv®
;

101 
db_cİy_schema
(*
¬g
, 
¬gc
 
__©Œibu‹__
 ((
unu£d
)), *
¬gv
[], *
cŞumn_Çmes
[] __attribute__ ((unused)))

105 
db_ÿÎback_¬g
 *
	gdb
 = 
¡©ic_ÿ¡
 < db_ÿÎback_¬g *>(
¬g
);

106 ià(
sql™e3_exec
(
db
->db, 
¬gv
[0], 
NULL
, NULL, &(db->
”rmsg
)è!ğ
SQLITE_OK
)

116 
db_cİy_bË
(*
¬g
, 
¬gc
 
__©Œibu‹__
 ((
unu£d
)), *
¬gv
[], *
cŞumn_Çmes
[] __attribute__ ((unused)))

119 
db_ÿÎback_¬g
 *
	gdb
 = 
¡©ic_ÿ¡
 < db_ÿÎback_¬g *>(
¬g
);

120 *
	gš£¹
 = 
NULL
;

121 ià(
a¥rštf
(&
š£¹
, "INSERT INTO %s% SELECT * FROM %s%s", 
db
->
rg‘_db
, 
¬gv
[0], db->
sourû_db
,‡rgv[0]) < 0)

123 
	gdb
->
	g”rmsg
 = 
¡rdup
(
¡»¼Ü
(
”ºo
));

126 
	grc
 = 
sql™e3_exec
(
db
->db, 
š£¹
, 
NULL
, NULL, &(db->
”rmsg
));

127 
ä“
(
š£¹
);

128 ià(
	grc
 !ğ
SQLITE_OK
)

138 
db_u£r_com·»
(
sql™e3_cÚ‹xt
 * 
cÚ‹xt
, 
¬gc
 
__©Œibu‹__
 ((
unu£d
)), 
sql™e3_v®ue
 ** 
¬gv
)

140 *
	g¬g
 = 
sql™e3_u£r_d©a
(
cÚ‹xt
);

141 
db_qu”y_¬g
 *
	gq
 = 
¡©ic_ÿ¡
 < db_qu”y_¬g *>(
¬g
);

142 
as£¹
(
sql™e3_v®ue_ty³
(
¬gv
[0]è=ğ
SQLITE_TEXT
);

143 cÚ¡ *
	g‹xt
 = 
»š‹½»t_ÿ¡
 < cÚ¡ *>(
sql™e3_v®ue_‹xt
(
¬gv
[0]));

144 
boŞ
 
	g»tv®
 = 
qu”y_¡r_com·»
(
‹xt
, 
q
->
u£r
, q->
»u£r
, q->
»gex
);

145 
sql™e3_»suÉ_št
(
cÚ‹xt
, (
»tv®
 ? 1 : 0));

151 
db_rŞe_com·»
(
sql™e3_cÚ‹xt
 * 
cÚ‹xt
, 
¬gc
 
__©Œibu‹__
 ((
unu£d
)), 
sql™e3_v®ue
 ** 
¬gv
)

153 *
	g¬g
 = 
sql™e3_u£r_d©a
(
cÚ‹xt
);

154 
db_qu”y_¬g
 *
	gq
 = 
¡©ic_ÿ¡
 < db_qu”y_¬g *>(
¬g
);

155 
as£¹
(
sql™e3_v®ue_ty³
(
¬gv
[0]è=ğ
SQLITE_TEXT
);

156 cÚ¡ *
	g‹xt
 = 
»š‹½»t_ÿ¡
 < cÚ¡ *>(
sql™e3_v®ue_‹xt
(
¬gv
[0]));

157 
boŞ
 
	g»tv®
 = 
qu”y_¡r_com·»
(
‹xt
, 
q
->
rŞe
, q->
»rŞe
, q->
»gex
);

158 
sql™e3_»suÉ_št
(
cÚ‹xt
, (
»tv®
 ? 1 : 0));

164 
db_ty³_com·»
(
sql™e3_cÚ‹xt
 * 
cÚ‹xt
, 
¬gc
 
__©Œibu‹__
 ((
unu£d
)), 
sql™e3_v®ue
 ** 
¬gv
)

166 *
	g¬g
 = 
sql™e3_u£r_d©a
(
cÚ‹xt
);

167 
db_qu”y_¬g
 *
	gq
 = 
¡©ic_ÿ¡
 < db_qu”y_¬g *>(
¬g
);

168 
as£¹
(
sql™e3_v®ue_ty³
(
¬gv
[0]è=ğ
SQLITE_TEXT
);

169 cÚ¡ *
	g‹xt
 = 
»š‹½»t_ÿ¡
 < cÚ¡ *>(
sql™e3_v®ue_‹xt
(
¬gv
[0]));

170 
boŞ
 
	g»tv®
;

171 ià(
	gq
->
	gty³_li¡
 !ğ
NULL
)

173 
as£¹
(
q
->
pŞicy
 !ğ
NULL
);

174 
size_t
 
	gšdex
;

175 
	g»tv®
 = (
­Ş_veùÜ_g‘_šdex
(
q
->
ty³_li¡
, 
‹xt
, 
­Ş_¡r_¡rcmp
, 
NULL
, &
šdex
) >= 0);

176 ià(
	g»tv®
)

178 
sql™e3_»suÉ_št
(
cÚ‹xt
, 1);

182 
	g»tv®
 = 
qu”y_¡r_com·»
(
‹xt
, 
q
->
ty³
, q->
»ty³
, q->
»gex
);

183 
sql™e3_»suÉ_št
(
cÚ‹xt
, (
»tv®
 ? 1 : 0));

189 
db_¿nge_com·»
(
sql™e3_cÚ‹xt
 * 
cÚ‹xt
, 
¬gc
 
__©Œibu‹__
 ((
unu£d
)), 
sql™e3_v®ue
 ** 
¬gv
)

191 *
	g¬g
 = 
sql™e3_u£r_d©a
(
cÚ‹xt
);

192 
db_qu”y_¬g
 *
	gq
 = 
¡©ic_ÿ¡
 < db_qu”y_¬g *>(
¬g
);

193 
as£¹
(
sql™e3_v®ue_ty³
(
¬gv
[0]è=ğ
SQLITE_TEXT
);

194 cÚ¡ *
	g‹xt
 = 
»š‹½»t_ÿ¡
 < cÚ¡ *>(
sql™e3_v®ue_‹xt
(
¬gv
[0]));

195 
boŞ
 
	g»tv®
;

196 ià(
	gq
->
	g­Ş_¿nge
 =ğ
NULL
)

198 
»tv®
 = 
qu”y_¡r_com·»
(
‹xt
, 
q
->
¿nge
, q->
»¿nge
, q->
»gex
);

202 
as£¹
(
q
->
pŞicy
 !ğ
NULL
);

203 
­Ş_mls_¿nge_t
 *
	gdb_¿nge
 = 
­Ş_mls_¿nge_ü—‹_äom_¡ršg
(
q
->
pŞicy
, 
‹xt
);

204 
	g»t
;

205 
	g»t
 = 
­Ş_mls_¿nge_com·»
(
q
->
pŞicy
, q->
­Ş_¿nge
, 
db_¿nge
, q->
¿ngeM©ch
);

206 
­Ş_mls_¿nge_de¡roy
(&
db_¿nge
);

207 
	g»tv®
 = (
»t
 > 0);

209 
sql™e3_»suÉ_št
(
cÚ‹xt
, (
»tv®
 ? 1 : 0));

215 
db_·th_com·»
(
sql™e3_cÚ‹xt
 * 
cÚ‹xt
, 
¬gc
 
__©Œibu‹__
 ((
unu£d
)), 
sql™e3_v®ue
 ** 
¬gv
)

217 *
	g¬g
 = 
sql™e3_u£r_d©a
(
cÚ‹xt
);

218 
db_qu”y_¬g
 *
	gq
 = 
¡©ic_ÿ¡
 < db_qu”y_¬g *>(
¬g
);

219 
as£¹
(
sql™e3_v®ue_ty³
(
¬gv
[0]è=ğ
SQLITE_TEXT
);

220 cÚ¡ *
	g‹xt
 = 
»š‹½»t_ÿ¡
 < cÚ¡ *>(
sql™e3_v®ue_‹xt
(
¬gv
[0]));

221 
boŞ
 
	g»tv®
 = 
qu”y_¡r_com·»
(
‹xt
, 
q
->
·th
, q->
»·th
, q->
»gex
);

222 
sql™e3_»suÉ_št
(
cÚ‹xt
, (
»tv®
 ? 1 : 0));

228 
db_dev_com·»
(
sql™e3_cÚ‹xt
 * 
cÚ‹xt
, 
¬gc
 
__©Œibu‹__
 ((
unu£d
)), 
sql™e3_v®ue
 ** 
¬gv
)

230 *
	g¬g
 = 
sql™e3_u£r_d©a
(
cÚ‹xt
);

231 
db_qu”y_¬g
 *
	gq
 = 
¡©ic_ÿ¡
 < db_qu”y_¬g *>(
¬g
);

232 
as£¹
(
sql™e3_v®ue_ty³
(
¬gv
[0]è=ğ
SQLITE_TEXT
);

233 cÚ¡ *
	g‹xt
 = 
»š‹½»t_ÿ¡
 < cÚ¡ *>(
sql™e3_v®ue_‹xt
(
¬gv
[0]));

234 
boŞ
 
	g»tv®
 = 
qu”y_¡r_com·»
(
‹xt
, 
q
->
dev
, q->
»dev
, q->
»gex
);

235 
sql™e3_»suÉ_št
(
cÚ‹xt
, (
»tv®
 ? 1 : 0));

241 
db_qu”y_ÿÎback
(*
¬g
, 
¬gc
, *
¬gv
[], *
cŞumn_Çmes
[] 
__©Œibu‹__
 ((
unu£d
)))

243 
db_qu”y_¬g
 *
	gq
 = 
¡©ic_ÿ¡
 < db_qu”y_¬g *>(
¬g
);

244 
as£¹
(
¬gc
 =ğ(
q
->
db_is_mls
 ? 9 : 8));

245 *
	g·th
 = 
¬gv
[0];

246 
šo64_t
 
	gšo
 = 
¡©ic_ÿ¡
 < ino64_ˆ> (
¡¹oul
(
¬gv
[1], 
NULL
, 10));

247 *
	gdev
 = 
¬gv
[2];

248 *
	gu£r
 = 
¬gv
[3];

249 *
	grŞe
 = 
¬gv
[4];

250 *
	gty³
 = 
¬gv
[5];

251 *
	g¿nge
, *
	gobjşass_¡r
, *
	glšk_rg‘
;

253 ià(
	gq
->
	gdb_is_mls
)

255 
	g¿nge
 = 
¬gv
[6];

256 
	gobjşass_¡r
 = 
¬gv
[7];

257 
	glšk_rg‘
 = 
¬gv
[8];

261 
	g¿nge
 = 
NULL
;

262 
	gobjşass_¡r
 = 
¬gv
[6];

263 
	glšk_rg‘
 = 
¬gv
[7];

265 
£fs_cÚ‹xt_node
 *
	gnode
 = 
NULL
;

266 
	gŒy


268 
	gnode
 = 
db_g‘_cÚ‹xt
(
q
->
db
, 
u£r
, 
rŞe
, 
ty³
, 
¿nge
);

270 
ÿtch
(...)

275 
ušt32_t
 
	gobjCÏss
 = 
¡©ic_ÿ¡
 < ušt32_ˆ> (
©oi
(
objşass_¡r
));

276 
£fs_’Œy
 *
	g’Œy
 = 
NULL
;

277 
	gŒy


279 
	g’Œy
 = 
db_g‘_’Œy
(
q
->
db
, 
node
, 
objCÏss
, 
·th
, 
šo
, 
dev
);

281 
ÿtch
(...)

287 
	gq
->
	g»tv®
 = 
q
->
â
(q->
db
, 
’Œy
, q->
d©a
);

288 
d–‘e
 
	g’Œy
;

289 ià(
	gq
->
	g»tv®
 < 0)

291 
	gq
->
	gabÜ‹d
 = 
Œue
;

301 
db_row_exi¡_ÿÎback
(*
¬g
,

302 
¬gc
 
__©Œibu‹__
 ((
unu£d
)),

303 **
¬gv
 
__©Œibu‹__
 ((
unu£d
)), **
cŞ_Çmes
 __attribute__ ((unused)))

305 
boŞ
 *
	gªsw”
 = 
¡©ic_ÿ¡
 < boŞ * >(
¬g
);

306 *
	gªsw”
 = 
Œue
;

313 
db_ùime_ÿÎback
(*
¬g
, 
¬gc
 
__©Œibu‹__
 ((
unu£d
)), **
¬gv
, **
cŞ_Çmes
 __attribute__ ((unused)))

315 
time_t
 *
	gùime
 = 
¡©ic_ÿ¡
 <ime_ˆ* >(
¬g
);

318 
tm
 
	gt
;

319 
mem£t
(&
t
, 0, (t));

320 ià(
¡½time
(
¬gv
[0], "%¨%b %d %T %Y", &
t
è=ğ
NULL
)

324 *
	gùime
 = 
mktime
(&
t
);

332 
db_couÁ_ÿÎback
(*
¬g
, 
¬gc
 
__©Œibu‹__
 ((
unu£d
)), **
¬gv
, **
cŞumn_Çmes


333 
__©Œibu‹__
 ((
unu£d
)))

335 *
	gcouÁ
 = 
¡©ic_ÿ¡
 < *>(
¬g
);

336 *
	gcouÁ
 = 
©oi
(
¬gv
[0]);

342 
	s¡ršdex


344 cÚ¡ *
	m¡r
;

345 
	mid
;

348 
db_¡ršdex_comp
(cÚ¡ *
a
, cÚ¡ *
b
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

350 cÚ¡ 
¡ršdex
 *
	gn1
 = 
¡©ic_ÿ¡
 < cÚ¡ ¡ršdex *>(
a
);

351 cÚ¡ 
¡ršdex
 *
	gn2
 = 
¡©ic_ÿ¡
 < cÚ¡ ¡ršdex *>(
b
);

352  
¡rcmp
(
n1
->
¡r
, 
n2
->str);

355 şas 
	cdb_cÚv”t


357 
	mpublic
:

358 
	$db_cÚv”t
(
£fs_db
 * 
db
, 
sql™e3
 * &
rg‘_db
)
	$throw
(
¡d
::
ruÁime_”rÜ
)

360 
_db
 = 
db
;

361 
_rg‘_db
 = 
rg‘_db
;

362 
_u£r
 = 
_rŞe
 = 
_ty³
 = 
_¿nge
 = 
_dev
 = 
NULL
;

363 
_u£r_id
 = 
_rŞe_id
 = 
_ty³_id
 = 
_¿nge_id
 = 
_dev_id
 = 0;

364 
_”rmsg
 = 
NULL
;

365 
Œy


367 ià((
_u£r
 = 
	`­Ş_b¡_ü—‹
(
db_¡ršdex_comp
, 
ä“
)è=ğ
NULL
)

369 
	`SEFS_ERR
(
_db
, "%s", 
	`¡»¼Ü
(
”ºo
));

370 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

372 ià((
_rŞe
 = 
	`­Ş_b¡_ü—‹
(
db_¡ršdex_comp
, 
ä“
)è=ğ
NULL
)

374 
	`SEFS_ERR
(
_db
, "%s", 
	`¡»¼Ü
(
”ºo
));

375 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

377 ià((
_ty³
 = 
	`­Ş_b¡_ü—‹
(
db_¡ršdex_comp
, 
ä“
)è=ğ
NULL
)

379 
	`SEFS_ERR
(
_db
, "%s", 
	`¡»¼Ü
(
”ºo
));

380 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

382 ià((
_¿nge
 = 
	`­Ş_b¡_ü—‹
(
db_¡ršdex_comp
, 
ä“
)è=ğ
NULL
)

384 
	`SEFS_ERR
(
_db
, "%s", 
	`¡»¼Ü
(
”ºo
));

385 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

387 ià((
_dev
 = 
	`­Ş_b¡_ü—‹
(
db_¡ršdex_comp
, 
ä“
)è=ğ
NULL
)

389 
	`SEFS_ERR
(
_db
, "%s", 
	`¡»¼Ü
(
”ºo
));

390 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

393 
	`ÿtch
(...)

395 
	`­Ş_b¡_de¡roy
(&
_u£r
);

396 
	`­Ş_b¡_de¡roy
(&
_rŞe
);

397 
	`­Ş_b¡_de¡roy
(&
_ty³
);

398 
	`­Ş_b¡_de¡roy
(&
_¿nge
);

399 
	`­Ş_b¡_de¡roy
(&
_dev
);

400 
throw
;

403 ~
	$db_cÚv”t
()

405 
	`­Ş_b¡_de¡roy
(&
_u£r
);

406 
	`­Ş_b¡_de¡roy
(&
_rŞe
);

407 
	`­Ş_b¡_de¡roy
(&
_ty³
);

408 
	`­Ş_b¡_de¡roy
(&
_¿nge
);

409 
	`­Ş_b¡_de¡roy
(&
_dev
);

410 
	`sql™e3_ä“
(
_”rmsg
);

411 
	}
}

412 
	$g‘ID
(cÚ¡ *
sym
, 
­Ş_b¡_t
 * 
Œ“
, &
id
, cÚ¡ *
bË
è
	$throw
(
¡d
::
bad_®loc
)

414 
¡ršdex
 
¡
 = { 
sym
, -1 }, *
»suÉ
;

415 ià(
	`­Ş_b¡_g‘_–em’t
(
Œ“
, &
¡
, 
NULL
, (**)&
»suÉ
) == 0)

417  
»suÉ
->
id
;

419 ià((
»suÉ
 = 
¡©ic_ÿ¡
 < 
¡ršdex
 * >(
	`m®loc
((*»suÉ)))è=ğ
NULL
)

421 
	`SEFS_ERR
(
_db
, "%s", 
	`¡»¼Ü
(
”ºo
));

422 
throw
 
¡d
::
	`bad_®loc
();

424 
»suÉ
->
¡r
 = 
sym
;

425 
»suÉ
->
id
 = id++;

426 ià(
	`­Ş_b¡_š£¹
(
Œ“
, 
»suÉ
, 
NULL
) < 0)

428 
	`SEFS_ERR
(
_db
, "%s", 
	`¡»¼Ü
(
”ºo
));

429 
	`ä“
(
»suÉ
);

430 
throw
 
¡d
::
	`bad_®loc
();

432 *
š£¹_¡mt
 = 
NULL
;

433 ià(
	`a¥rštf
(&
š£¹_¡mt
, "INSERT INTO % VALUES (%d, '%s')", 
bË
, 
»suÉ
->
id
,„esuÉ->
¡r
) < 0)

435 
	`SEFS_ERR
(
_db
, "%s", 
	`¡»¼Ü
(
”ºo
));

436 
throw
 
¡d
::
	`bad_®loc
();

438 ià(
	`sql™e3_exec
(
_rg‘_db
, 
š£¹_¡mt
, 
NULL
, NULL, &
_”rmsg
è!ğ
SQLITE_OK
)

440 
	`SEFS_ERR
(
_db
, "%s", 
_”rmsg
);

441 
	`ä“
(
š£¹_¡mt
);

442 
throw
 
¡d
::
	`ruÁime_”rÜ
(
_”rmsg
);

444 
	`ä“
(
š£¹_¡mt
);

445  
»suÉ
->
id
;

446 
	}
}

447 
­Ş_b¡_t
 *
	g_u£r
, *
	g_rŞe
, *
	g_ty³
, *
	g_¿nge
, *
	g_dev
;

448 
	g_u£r_id
, 
	g_rŞe_id
, 
	g_ty³_id
, 
	g_¿nge_id
, 
	g_dev_id
;

449 
boŞ
 
	g_isMLS
;

450 *
	g_”rmsg
;

451 
£fs_db
 *
	g_db
;

452 
sql™e3
 *
	g_rg‘_db
;

455 
db_ü—‹_äom_fesy¡em
(
£fs_fşi¡
 * 
fşi¡
 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£fs_’Œy
 * 
’Œy
, *
¬g
)

457 
db_cÚv”t
 *
	gdbc
 = 
¡©ic_ÿ¡
 < db_cÚv”ˆ* >(
¬g
);

459 cÚ¡ 
£fs_cÚ‹xt_node
 *
	gcÚ‹xt
 = 
dbc
->
_db
->
g‘CÚ‹xtNode
(
’Œy
);

460 
	gŒy


465 
	gu£r_id
 = 
dbc
->
g‘ID
(
cÚ‹xt
->
u£r
, dbc->
_u£r
, dbc->
_u£r_id
, "users");

466 
	grŞe_id
 = 
dbc
->
g‘ID
(
cÚ‹xt
->
rŞe
, dbc->
_rŞe
, dbc->
_rŞe_id
, "roles");

467 
	gty³_id
 = 
dbc
->
g‘ID
(
cÚ‹xt
->
ty³
, dbc->
_ty³
, dbc->
_ty³_id
, "types");

468 
	g¿nge_id
 = 0;

469 ià(
	gdbc
->
	g_isMLS
)

471 
	g¿nge_id
 = 
dbc
->
g‘ID
(
cÚ‹xt
->
¿nge
, dbc->
_¿nge
, dbc->
_¿nge_id
, "mls");

473 
	gdev_id
 = 
dbc
->
g‘ID
(
’Œy
->
dev
(), dbc->
_dev
, dbc->
_dev_id
, "devs");

474 cÚ¡ *
	g·th
 = 
’Œy
->
·th
();

475 cÚ¡ 
šo64_t
 
	gšode
 = 
’Œy
->
šode
();

476 cÚ¡ 
ušt32_t
 
	gobjşass
 = 
’Œy
->
objeùCÏss
();

477 
	glšk_rg‘
[128] = "";

479 
¡©64
 
	gsb
;

480 ià(
¡©64
(
·th
, &
sb
) == -1)

486 
lšk_rg‘
[127] = '\0';

487 
	gsb
.
	g¡_mode
 = 0;

488 
SEFS_WARN
(
dbc
->
_db
, "Could‚Ù sˆfe: % - ignÜšg", 
·th
);

490 ià(
S_ISLNK
(
sb
.
¡_mode
))

492 ià(
»adlšk
(
·th
, 
lšk_rg‘
, 128) == 0)

494 
SEFS_ERR
(
dbc
->
_db
, "%s", 
¡»¼Ü
(
”ºo
));

495 
throw
 
	g¡d
::
bad_®loc
();

497 
	glšk_rg‘
[127] = '\0';

500 *
	gš£¹_¡mt
 = 
NULL
;

501 ià(
	ga¥rštf


502 (&
	gš£¹_¡mt
, "INSERT INTO…©h VALUES ('%s', %lu, %d, %d, %d, %d, %d, %u, '%s')", 
	g·th
,

503 
	g¡©ic_ÿ¡
 < >(
	gšode
), 
	gdev_id
, 
	gu£r_id
, 
	grŞe_id
, 
	gty³_id
, 
	g¿nge_id
, 
	gobjşass
,

504 
	glšk_rg‘
) < 0)

506 
SEFS_ERR
(
dbc
->
_db
, "%s", 
¡»¼Ü
(
”ºo
));

507 
throw
 
	g¡d
::
bad_®loc
();

509 ià(
sql™e3_exec
(
dbc
->
_rg‘_db
, 
š£¹_¡mt
, 
NULL
, NULL, &dbc->
_”rmsg
è!ğ
SQLITE_OK
)

511 
SEFS_ERR
(
dbc
->
_db
, "%s", dbc->
_”rmsg
);

512 
ä“
(
š£¹_¡mt
);

513 
throw
 
	g¡d
::
ruÁime_”rÜ
(
dbc
->
_”rmsg
);

515 
ä“
(
š£¹_¡mt
);

517 
ÿtch
(...)

526 
	g£fs_db
::
	$£fs_db
(
£fs_fesy¡em
 * 
fs
, 
£fs_ÿÎback_â_t
 
msg_ÿÎback
, *
v¬g
)
	$throw
(
¡d
::
šv®id_¬gum’t
, std::
ruÁime_”rÜ
):
£fs_fşi¡


527 (
SEFS_FCLIST_TYPE_DB
, 
msg_ÿÎback
,

528 
v¬g
)

530 ià(
fs
 =ğ
NULL
)

532 
”ºo
 = 
EINVAL
;

533 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
EINVAL
));

534 
throw
 
¡d
::
	`šv®id_¬gum’t
(
	`¡»¼Ü
(
EINVAL
));

537 
	`SEFS_INFO
(
this
, "R—dšg cÚ‹xt äom fesy¡em %s.", 
fs
->
	`roÙ
());

538 *
”rmsg
 = 
NULL
;

539 
Œy


541 ià(
	`sql™e3_İ’
(":memÜy:", &
_db
è!ğ
SQLITE_OK
)

543 
	`SEFS_ERR
(
this
, "%s", 
	`sql™e3_”rmsg
(
_db
));

544 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`sql™e3_”rmsg
(
_db
));

546 
rc
;

547 ià(
fs
->
	`isMLS
())

549 
rc
 = 
	`sql™e3_exec
(
_db
, 
DB_SCHEMA_MLS
, 
NULL
, 0, &
”rmsg
);

553 
rc
 = 
	`sql™e3_exec
(
_db
, 
DB_SCHEMA_NONMLS
, 
NULL
, 0, &
”rmsg
);

555 ià(
rc
 !ğ
SQLITE_OK
)

557 
	`SEFS_ERR
(
this
, "%s", 
”rmsg
);

558 
throw
 
¡d
::
	`ruÁime_”rÜ
(
”rmsg
);

561 
db_cÚv”t
 
	`dbc
(
this
, 
_db
);

562 
dbc
.
_isMLS
 = 
fs
->
	`isMLS
();

563 ià(
fs
->
	`runQu”yM­
(
NULL
, 
db_ü—‹_äom_fesy¡em
, &
dbc
) < 0)

565 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

569 cÚ¡ *
dbv”siÚ
 = 
DB_MAX_VERSION
;

570 
ho¡Çme
[64];

571 
	`g‘ho¡Çme
(
ho¡Çme
, (hostname));

572 
ho¡Çme
[63] = '\0';

573 
_ùime
 = 
	`time
(
NULL
);

574 
d©‘ime
[32];

575 
	`ùime_r
(&
_ùime
, 
d©‘ime
);

577 *
šfo_š£¹
 = 
NULL
;

578 ià(
	`a¥rštf
(&
šfo_š£¹
,

581 "INSERT INTO infØ(key,v®ueèVALUES ('d©‘ime','%s');", 
dbv”siÚ
, 
ho¡Çme
, 
d©‘ime
) < 0)

583 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

584 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

586 
rc
 = 
	`sql™e3_exec
(
_db
, 
šfo_š£¹
, 
NULL
, NULL, &
”rmsg
);

587 
	`ä“
(
šfo_š£¹
);

588 ià(
rc
 !ğ
SQLITE_OK
)

590 
	`SEFS_ERR
(
this
, "%s", 
”rmsg
);

591 
throw
 
¡d
::
	`ruÁime_”rÜ
(
”rmsg
);

595 
	`ÿtch
(...)

597 ià(
”rmsg
 !ğ
NULL
)

599 
	`sql™e3_ä“
(
”rmsg
);

601 
	`sql™e3_şo£
(
_db
);

602 
throw
;

604 
	}
}

606 
	g£fs_db
::
	$£fs_db
(cÚ¡ *
f’ame
, 
£fs_ÿÎback_â_t
 
msg_ÿÎback
, *
v¬g
è
	$throw
(
¡d
::
šv®id_¬gum’t
,

607 
¡d
::

608 
ruÁime_”rÜ
):
£fs_fşi¡


609 (
SEFS_FCLIST_TYPE_DB
, 
msg_ÿÎback
, 
v¬g
)

611 ià(
f’ame
 =ğ
NULL
)

613 
”ºo
 = 
EINVAL
;

614 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
EINVAL
));

615 
throw
 
¡d
::
	`šv®id_¬gum’t
(
	`¡»¼Ü
(
EINVAL
));

618 ià(!
£fs_db
::
	`isDB
(
f’ame
))

620 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

621 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

624 ià(
	`sql™e3_İ’
(
f’ame
, &
_db
è!ğ
SQLITE_OK
)

626 
	`SEFS_ERR
(
this
, "%s", 
	`sql™e3_”rmsg
(
_db
));

627 
	`sql™e3_şo£
(
_db
);

628 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

631 *
”rmsg
 = 
NULL
;

633 cÚ¡ *
£Ëù_¡mt
 = "SELECT * FROM infØWHERE key = 'dbv”siÚ' AND v®u>ğ" 
DB_MAX_VERSION
;

634 
boŞ
 
ªsw”
 = 
çl£
;

635 ià(
	`sql™e3_exec
(
_db
, 
£Ëù_¡mt
, 
db_row_exi¡_ÿÎback
, &
ªsw”
, &
”rmsg
è!ğ
SQLITE_OK
)

637 
	`SEFS_ERR
(
this
, "%s", 
”rmsg
);

638 
	`sql™e3_ä“
(
”rmsg
);

639 
	`sql™e3_şo£
(
_db
);

640 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

642 ià(!
ªsw”
)

644 
	`SEFS_INFO
(
this
, "Upg¿dšg d©aba£ %s.", 
f’ame
);

645 
	`SEFS_WARN
(
this
, "% i ¨´e-lib£fs-4.0 d©aba£‡nd wÈbupg¿ded.", 
f’ame
);

646 
	`upg¿deToDB2
();

650 
_ùime
 = 0;

651 cÚ¡ *
ùime_¡mt
 = "SELECT value FROM info WHERE key='datetime'";

652 ià(
	`sql™e3_exec
(
_db
, 
ùime_¡mt
, 
db_ùime_ÿÎback
, &
_ùime
, &
”rmsg
è!ğ
SQLITE_OK
)

654 
	`SEFS_ERR
(
this
, "%s", 
”rmsg
);

655 
	`sql™e3_ä“
(
”rmsg
);

656 
	`sql™e3_şo£
(
_db
);

657 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

659 
	}
}

661 
	g£fs_db
::~
	$£fs_db
()

663 ià(
_db
 !ğ
NULL
)

665 
	`sql™e3_şo£
(
_db
);

666 
_db
 = 
NULL
;

668 
	}
}

670 
	g£fs_db
::
	$runQu”yM­
(
£fs_qu”y
 * 
qu”y
, 
£fs_fşi¡_m­_â_t
 
â
, *
d©a
è
	$throw
(
¡d
::
ruÁime_”rÜ
, std::
šv®id_¬gum’t
)

675 
db_qu”y_¬g
 
q
;

676 
	`mem£t
(&
q
, 0, (q));

678 
q
.
db
 = 
this
;

679 ià(
qu”y
 !ğ
NULL
)

681 
qu”y
->
	`compe
();

682 ià(
pŞicy
 !ğ
NULL
)

684 ià(
qu”y
->
_ty³
 !ğ
NULL
 && qu”y->
_šdœeù
)

686 
q
.
ty³_li¡
 =

687 
	`qu”y_ü—‹_ÿndid©e_ty³
(
pŞicy
, 
qu”y
->
_ty³
, qu”y->
_»ty³
, qu”y->
_»gex
,

688 
qu”y
->
_šdœeù
);

689 ià(
q
.
ty³_li¡
 =ğ
NULL
)

691 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

692 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

695 ià(
qu”y
->
_¿nge
 !ğ
NULL
 && qu”y->
_¿ngeM©ch
 != 0)

697 
q
.
­Ş_¿nge
 = 
	`­Ş_mls_¿nge_ü—‹_äom_¡ršg
(
pŞicy
, 
qu”y
->
_¿nge
);

698 ià(
q
.
­Ş_¿nge
 =ğ
NULL
)

700 
	`­Ş_veùÜ_de¡roy
(&
q
.
ty³_li¡
);

701 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

702 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

706 
q
.
u£r
 = 
qu”y
->
_u£r
;

707 
q
.
rŞe
 = 
qu”y
->
_rŞe
;

708 
q
.
ty³
 = 
qu”y
->
_ty³
;

709 
q
.
¿nge
 = 
qu”y
->
_¿nge
;

710 
q
.
·th
 = 
qu”y
->
_·th
;

711 
q
.
dev
 = 
qu”y
->
_dev
;

712 
q
.
»gex
 = 
qu”y
->
_»gex
;

713 
q
.
»u£r
 = 
qu”y
->
_»u£r
;

714 
q
.
»rŞe
 = 
qu”y
->
_»rŞe
;

715 
q
.
»ty³
 = 
qu”y
->
_»ty³
;

716 
q
.
»¿nge
 = 
qu”y
->
_»¿nge
;

717 
q
.
»·th
 = 
qu”y
->
_»·th
;

718 
q
.
»dev
 = 
qu”y
->
_»dev
;

719 
q
.
¿ngeM©ch
 = 
qu”y
->
_¿ngeM©ch
;

721 
q
.
pŞicy
 = 
this
->policy;

722 
q
.
db_is_mls
 = 
	`isMLS
();

723 
q
.
â
 = fn;

724 
q
.
d©a
 = data;

725 
q
.
»tv®
 = 0;

726 
q
.
abÜ‹d
 = 
çl£
;

728 *
£Ëù_¡mt
 = 
NULL
, *
”rmsg
 = NULL;

729 
size_t
 
Ën
 = 0;

731 
Œy


733 
boŞ
 
wh”e_added
 = 
çl£
;

735 ià(
­Ş_¡r_­³nd


736 (&
£Ëù_¡mt
, &
Ën
,

739 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

740 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

742 ià(
q
.
db_is_mls
 && 
	`­Ş_¡r_­³nd
(&
£Ëù_¡mt
, &
Ën
, ", mls.mls_range") < 0)

744 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

745 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

747 ià(
	`­Ş_¡r_­³nd
(&
£Ëù_¡mt
, &
Ën
,

750 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

751 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

753 ià(
q
.
db_is_mls
 && 
	`­Ş_¡r_­³nd
(&
£Ëù_¡mt
, &
Ën
, ", mls") < 0)

755 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

758 ià(
q
.
u£r
 !ğ
NULL
)

760 ià(
	`sql™e3_ü—‹_funùiÚ
(
_db
, "u£r_com·»", 1, 
SQLITE_UTF8
, &
q
, 
db_u£r_com·»
, 
NULL
, NULL) !=

761 
SQLITE_OK
)

763 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

764 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

766 ià(
	`­Ş_¡r_­³ndf
(&
£Ëù_¡mt
, &
Ën
,

767 "% (u£r_com·»(u£rs.u£r_Çme))", (
wh”e_added
 ? " AND" : " WHERE")) < 0)

769 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

770 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

772 
wh”e_added
 = 
Œue
;

775 ià(
q
.
rŞe
 !ğ
NULL
)

777 ià(
	`sql™e3_ü—‹_funùiÚ
(
_db
, "rŞe_com·»", 1, 
SQLITE_UTF8
, &
q
, 
db_rŞe_com·»
, 
NULL
, NULL) !=

778 
SQLITE_OK
)

780 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

781 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

783 ià(
	`­Ş_¡r_­³ndf
(&
£Ëù_¡mt
, &
Ën
,

784 "% ÔŞe_com·»ÔŞes.rŞe_Çme))", (
wh”e_added
 ? " AND" : " WHERE")) < 0)

786 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

787 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

789 
wh”e_added
 = 
Œue
;

792 ià(
q
.
ty³
 !ğ
NULL
)

794 ià(
	`sql™e3_ü—‹_funùiÚ
(
_db
, "ty³_com·»", 1, 
SQLITE_UTF8
, &
q
, 
db_ty³_com·»
, 
NULL
, NULL) !=

795 
SQLITE_OK
)

797 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

798 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

800 ià(
	`­Ş_¡r_­³ndf
(&
£Ëù_¡mt
, &
Ën
,

801 "% Ñy³_com·»Ñy³s.ty³_Çme))", (
wh”e_added
 ? " AND" : " WHERE")) < 0)

803 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

804 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

806 
wh”e_added
 = 
Œue
;

809 ià(
q
.
db_is_mls
 && q.
¿nge
 !ğ
NULL
)

811 ià(
	`sql™e3_ü—‹_funùiÚ
(
_db
, "¿nge_com·»", 1, 
SQLITE_UTF8
, &
q
, 
db_¿nge_com·»
, 
NULL
, NULL) !=

812 
SQLITE_OK
)

814 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

815 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

817 ià(
	`­Ş_¡r_­³ndf
(&
£Ëù_¡mt
, &
Ën
,

818 "% Ôªge_com·»(mls.mls_¿nge))", (
wh”e_added
 ? " AND" : " WHERE")) < 0)

820 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

821 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

823 
wh”e_added
 = 
Œue
;

826 ià(
qu”y
->
_objşass
 != 0)

828 ià(
	`­Ş_¡r_­³ndf
(&
£Ëù_¡mt
, &
Ën
,

829 "% Õ©hs.obj_şas ğ%d)", (
wh”e_added
 ? " AND" : " WHERE"), 
qu”y
->
_objşass
) < 0)

831 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

832 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

834 
wh”e_added
 = 
Œue
;

837 ià(
q
.
·th
 !ğ
NULL
)

839 ià(
	`sql™e3_ü—‹_funùiÚ
(
_db
, "·th_com·»", 1, 
SQLITE_UTF8
, &
q
, 
db_·th_com·»
, 
NULL
, NULL) !=

840 
SQLITE_OK
)

842 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

843 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

845 ià(
	`­Ş_¡r_­³ndf
(&
£Ëù_¡mt
, &
Ën
,

846 "% Õ©h_com·»Õ©hs.·th))", (
wh”e_added
 ? " AND" : " WHERE")) < 0)

848 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

849 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

851 
wh”e_added
 = 
Œue
;

854 ià(
qu”y
->
_šode
 != 0)

856 ià(
	`­Ş_¡r_­³ndf
(&
£Ëù_¡mt
, &
Ën
,

857 "% Õ©hs.šØğ%lu)", (
wh”e_added
 ? " AND" : " WHERE"),

858 
¡©ic_ÿ¡
 < >(
qu”y
->
_šode
)) < 0)

860 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

861 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

863 
wh”e_added
 = 
Œue
;

866 ià(
qu”y
->
_dev
 != 0)

868 ià(
	`sql™e3_ü—‹_funùiÚ
(
_db
, "dev_com·»", 1, 
SQLITE_UTF8
, &
q
, 
db_dev_com·»
, 
NULL
, NULL) !=

869 
SQLITE_OK
)

871 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

872 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

874 ià(
	`­Ş_¡r_­³ndf
(&
£Ëù_¡mt
, &
Ën
,

875 "% (dev_com·»(devs.dev_Çme)", (
wh”e_added
 ? " AND" : " WHERE")) < 0)

877 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

878 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

880 
wh”e_added
 = 
Œue
;

883 ià(
	`­Ş_¡r_­³ndf
(&
£Ëù_¡mt
, &
Ën
,

885 (
wh”e_added
 ? " AND" : " WHERE")) < 0)

887 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

888 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

890 ià(
q
.
db_is_mls
 && 
	`­Ş_¡r_­³ndf
(&
£Ëù_¡mt
, &
Ën
, " AND…aths.range = mls.mls_id") < 0)

892 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

893 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

895 ià(
	`­Ş_¡r_­³nd
(&
£Ëù_¡mt
, &
Ën
, " AND…aths.dev = devs.dev_id) ORDER BY…aths.path ASC") < 0)

897 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

898 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

901 
rc
 = 
	`sql™e3_exec
(
_db
, 
£Ëù_¡mt
, 
db_qu”y_ÿÎback
, &
q
, &
”rmsg
);

902 ià(
rc
 !ğ
SQLITE_OK
 && (rø!ğ
SQLITE_ABORT
 || !
q
.
abÜ‹d
))

904 
	`SEFS_ERR
(
this
, "%s", 
”rmsg
);

905 
throw
 
¡d
::
	`ruÁime_”rÜ
(
”rmsg
);

908 
	`ÿtch
(...)

910 
	`­Ş_veùÜ_de¡roy
(&
q
.
ty³_li¡
);

911 
	`­Ş_mls_¿nge_de¡roy
(&
q
.
­Ş_¿nge
);

912 
	`ä“
(
£Ëù_¡mt
);

913 
	`sql™e3_ä“
(
”rmsg
);

914 
throw
;

917 
	`­Ş_veùÜ_de¡roy
(&
q
.
ty³_li¡
);

918 
	`­Ş_mls_¿nge_de¡roy
(&
q
.
­Ş_¿nge
);

919 
	`ä“
(
£Ëù_¡mt
);

920 
	`sql™e3_ä“
(
”rmsg
);

921  
q
.
»tv®
;

922 
	}
}

924 
boŞ
 
	g£fs_db
::
	$isMLS
() const

926 
rc
;

927 
boŞ
 
ªsw”
 = 
çl£
;

928 *
”rmsg
 = 
NULL
;

929 cÚ¡ *
£Ëù_¡mt
 = "SELECT * FROM sqlite_master WHERE‚ame='mls'";

930 
rc
 = 
	`sql™e3_exec
(
_db
, 
£Ëù_¡mt
, 
db_row_exi¡_ÿÎback
, &
ªsw”
, &
”rmsg
);

931 ià(
rc
 !ğ
SQLITE_OK
)

933 
	`SEFS_ERR
(
this
, "%s", 
”rmsg
);

934 
	`sql™e3_ä“
(
”rmsg
);

935 
ªsw”
 = 
çl£
;

937  
ªsw”
;

938 
	}
}

940 
	g£fs_db
::
	$§ve
(cÚ¡ *
f’ame
è
	$throw
(
¡d
::
šv®id_¬gum’t
, std::
ruÁime_”rÜ
)

942 
FILE
 *
å
 = 
NULL
;

943 
db_ÿÎback_¬g
 
diskdb
;

944 
diskdb
.
db
 = 
NULL
;

945 
diskdb
.
”rmsg
 = 
NULL
;

946 
boŞ
 
š_Œª§ùiÚ
 = 
çl£
;

948 
Œy


950 ià(
f’ame
 =ğ
NULL
)

952 
”ºo
 = 
EINVAL
;

953 
throw
 
¡d
::
	`šv®id_¬gum’t
(
	`¡»¼Ü
(
”ºo
));

957 ià((
å
 = 
	`fİ’
(
f’ame
, "w")è=ğ
NULL
)

959 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

960 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

962 
	`fşo£
(
å
);

963 
å
 = 
NULL
;

966 ià(
	`sql™e3_İ’
(
f’ame
, &(
diskdb
.
db
)è!ğ
SQLITE_OK
)

968 
	`SEFS_ERR
(
this
, "%s", 
	`sql™e3_”rmsg
(
diskdb
.
db
));

969 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`sql™e3_”rmsg
(
diskdb
.
db
));

971 ià(
	`sql™e3_exec
(
_db
, "SELECT sqÈFROM sql™e_ma¡” WHERE sqÈNOT NULL", 
db_cİy_schema
, &
diskdb
, &diskdb.
”rmsg
)

972 !ğ
SQLITE_OK
)

974 
	`SEFS_ERR
(
this
, "%s", 
diskdb
.
”rmsg
);

975 
throw
 
¡d
::
	`ruÁime_”rÜ
(
diskdb
.
”rmsg
);

977 
	`sql™e3_şo£
(
diskdb
.
db
);

979 *
©ch
 = 
NULL
;

980 ià(
	`a¥rštf
(&
©ch
, "ATTACH '%s' AS diskdb", 
f’ame
) < 0)

982 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

983 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

985 
diskdb
.
db
 = 
_db
;

986 
diskdb
.
sourû_db
 = "";

987 
diskdb
.
rg‘_db
 = "diskdb.";

988 
rc
 = 
	`sql™e3_exec
(
_db
, 
©ch
, 
NULL
, NULL, &
diskdb
.
”rmsg
);

989 
	`ä“
(
©ch
);

990 ià(
rc
 !ğ
SQLITE_OK
)

992 
	`SEFS_ERR
(
this
, "%s", 
diskdb
.
”rmsg
);

993 
throw
 
¡d
::
	`ruÁime_”rÜ
(
diskdb
.
”rmsg
);

997 ià(
	`sql™e3_exec
(
_db
, "BEGIN TRANSACTION", 
NULL
, NULL, &(
diskdb
.
”rmsg
)è!ğ
SQLITE_OK
)

999 
	`SEFS_ERR
(
this
, "%s", 
diskdb
.
”rmsg
);

1000 
throw
 
¡d
::
	`ruÁime_”rÜ
(
diskdb
.
”rmsg
);

1002 
š_Œª§ùiÚ
 = 
Œue
;

1003 ià(
	`sql™e3_exec
(
_db
, "SELECT‚amFROM sql™e_ma¡” WHEREy³ ='bË'", 
db_cİy_bË
, &
diskdb
, &diskdb.
”rmsg
)

1004 !ğ
SQLITE_OK
)

1006 
	`SEFS_ERR
(
this
, "%s", 
diskdb
.
”rmsg
);

1007 
throw
 
¡d
::
	`ruÁime_”rÜ
(
diskdb
.
”rmsg
);

1010 
	`sql™e3_exec
(
_db
, "DETACH diskdb", 
NULL
, NULL, NULL);

1012 ià(
	`sql™e3_exec
(
_db
, "END TRANSACTION", 
NULL
, 0, &(
diskdb
.
”rmsg
)è!ğ
SQLITE_OK
)

1014 
	`SEFS_ERR
(
this
, "%s", 
diskdb
.
”rmsg
);

1015 
throw
 
¡d
::
	`ruÁime_”rÜ
(
diskdb
.
”rmsg
);

1017 
š_Œª§ùiÚ
 = 
çl£
;

1019 
	`ÿtch
(...)

1021 ià(
å
 !ğ
NULL
)

1023 
	`fşo£
(
å
);

1025 ià(
š_Œª§ùiÚ
)

1027 
	`sql™e3_exec
(
_db
, "ROLLBACK TRANSACTION", 
NULL
, NULL, NULL);

1029 ià(
diskdb
.
db
 !ğ
NULL
)

1031 
	`sql™e3_şo£
(
diskdb
.
db
);

1033 
	`sql™e3_ä“
(
diskdb
.
”rmsg
);

1034 
throw
;

1037 
	`sql™e3_ä“
(
diskdb
.
”rmsg
);

1038 
	}
}

1040 
time_t
 
	g£fs_db
::
	$g‘CTime
() const

1042  
_ùime
;

1043 
	}
}

1045 
boŞ
 
	g£fs_db
::
	$isDB
(cÚ¡ *
f’ame
)

1047 ià(
f’ame
 =ğ
NULL
)

1049 
”ºo
 = 
EINVAL
;

1050  
çl£
;

1053 
rc
 = 
	`acûss
(
f’ame
, 
R_OK
);

1054 ià(
rc
 != 0)

1056  
çl£
;

1059 
sql™e3
 *
db
 = 
NULL
;

1060 
rc
 = 
	`sql™e3_İ’
(
f’ame
, &
db
);

1061 ià(
rc
 !ğ
SQLITE_OK
)

1063 
	`sql™e3_şo£
(
db
);

1064 
”ºo
 = 
EIO
;

1065  
çl£
;

1069 
li¡_size
;

1070 *
”rmsg
 = 
NULL
;

1071 
rc
 = 
	`sql™e3_exec
(
db
, "SELECTy³_ÇmFROMy³s", 
db_couÁ_ÿÎback
, &
li¡_size
, &
”rmsg
);

1072 ià(
rc
 !ğ
SQLITE_OK
)

1074 
	`sql™e3_şo£
(
db
);

1075 
	`sql™e3_ä“
(
”rmsg
);

1076 
”ºo
 = 
EIO
;

1077  
çl£
;

1079 
	`sql™e3_şo£
(
db
);

1080  
Œue
;

1081 
	}
}

1085 cÚ¡ 
£fs_cÚ‹xt_node
 *
	g£fs_db
::
	$g‘CÚ‹xtNode
(cÚ¡ 
£fs_’Œy
 * 
’Œy
)

1087  
’Œy
->
_cÚ‹xt
;

1088 
	}
}

1096 
	$db_upg¿de_»š£¹
(*
¬g
, 
¬gc
, *
¬gv
[], *
cŞumn_Çmes
[])

1098 
sql™e3
 *
db
 = 
¡©ic_ÿ¡
 < sql™e3 *>(
¬g
);

1099 
boŞ
 
mls
 = (
¬gc
 == 7);

1100 
	`as£¹
(
¬gc
 >= 6 &&‡rgc <= 7);

1101 
ušt32_t
 
obj_şass
 = 
¡©ic_ÿ¡
 < ušt32_ˆ> (
	`©oi
(
¬gv
[(
mls
 ? 5 : 4)]));

1103 
obj_şass
)

1106 
obj_şass
 = 
QPOL_CLASS_BLK_FILE
;

1109 
obj_şass
 = 
QPOL_CLASS_CHR_FILE
;

1112 
obj_şass
 = 
QPOL_CLASS_DIR
;

1115 
obj_şass
 = 
QPOL_CLASS_FIFO_FILE
;

1118 
obj_şass
 = 
QPOL_CLASS_FILE
;

1121 
obj_şass
 = 
QPOL_CLASS_LNK_FILE
;

1124 
obj_şass
 = 
QPOL_CLASS_SOCK_FILE
;

1128 *
š£¹_¡mt
 = 
NULL
;

1129 ià(
mls
)

1131 ià(
	`a¥rštf
(&
š£¹_¡mt
,

1133 
¬gv
[0],‡rgv[1],‡rgv[2],‡rgv[3],‡rgv[4], 
obj_şass
,‡rgv[6]) < 0)

1140 ià(
	`a¥rštf
(&
š£¹_¡mt
,

1142 
¬gv
[0],‡rgv[1],‡rgv[2],‡rgv[3], 
obj_şass
,‡rgv[5]) < 0)

1147 ià(
	`sql™e3_exec
(
db
, 
š£¹_¡mt
, 
NULL
, NULL, NULLè!ğ
SQLITE_OK
)

1149 
	`ä“
(
š£¹_¡mt
);

1152 
	`ä“
(
š£¹_¡mt
);

1154 
	}
}

1156 
	g£fs_db
::
	$upg¿deToDB2
(è
	$throw
(
¡d
::
ruÁime_”rÜ
)

1158 *
”rmsg
;

1166 
_ùime
 = 
	`time
(
NULL
);

1167 
d©‘ime
[32];

1168 
	`ùime_r
(&
_ùime
, 
d©‘ime
);

1169 *
®‹r_¡mt
 = 
NULL
;

1170 ià(
	`a¥rštf
(&
®‹r_¡mt
, "BEGIN TRANSACTION;" "CREATE TABLE„oles (role_id INTEGER PRIMARY KEY,„ole_name varchar (24));"

1176 
	`isMLS
()? "inodes.range, " : "") < 0)

1178 
	`SEFS_ERR
(
this
, "%s", 
”rmsg
);

1179 
	`sql™e3_ä“
(
”rmsg
);

1180 
	`sql™e3_şo£
(
_db
);

1181 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

1183 ià(
	`sql™e3_exec
(
_db
, 
®‹r_¡mt
, 
db_upg¿de_»š£¹
, _db, &
”rmsg
è!ğ
SQLITE_OK
)

1185 
	`SEFS_ERR
(
this
, "%s", 
”rmsg
);

1186 
	`ä“
(
®‹r_¡mt
);

1187 
	`sql™e3_ä“
(
”rmsg
);

1188 
	`sql™e3_şo£
(
_db
);

1189 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

1192 
	`ä“
(
®‹r_¡mt
);

1193 
®‹r_¡mt
 = 
NULL
;

1195 ià(
	`a¥rštf
(&
®‹r_¡mt
, "DROP TABLE inodes; DROP TABLE…aths;"

1199 "END TRANSACTION;" "VACUUM", 
d©‘ime
, 
DB_MAX_VERSION
) < 0)

1201 
	`SEFS_ERR
(
this
, "%s", 
”rmsg
);

1202 
	`sql™e3_ä“
(
”rmsg
);

1203 
	`sql™e3_şo£
(
_db
);

1204 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

1206 ià(
	`sql™e3_exec
(
_db
, 
®‹r_¡mt
, 
NULL
, NULL, &
”rmsg
è!ğ
SQLITE_OK
)

1208 
	`SEFS_ERR
(
this
, "%s", 
”rmsg
);

1209 
	`ä“
(
®‹r_¡mt
);

1210 
	`sql™e3_ä“
(
”rmsg
);

1211 
	`sql™e3_şo£
(
_db
);

1212 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

1214 
	`ä“
(
®‹r_¡mt
);

1215 
	}
}

1217 
£fs_’Œy
 *
	g£fs_db
::
	$g‘EÁry
(cÚ¡ 
£fs_cÚ‹xt_node
 *
cÚ‹xt
, 
ušt32_t
 
objeùCÏss
, cÚ¡ *
·th
, 
šo64_t
 
šode
,

1218 cÚ¡ *
dev
è
	$throw
(
¡d
::
bad_®loc
)

1220 *
s
 = 
	`¡rdup
(
·th
);

1221 ià(
s
 =ğ
NULL
)

1223 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

1224 
throw
 
¡d
::
	`bad_®loc
();

1226 ià(
	`­Ş_b¡_š£¹_ªd_g‘
(
·th_Œ“
, (**)&
s
, 
NULL
) < 0)

1228 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

1229 
	`ä“
(
s
);

1230 
throw
 
¡d
::
	`bad_®loc
();

1232 
£fs_’Œy
 *
e
 = 
Ãw
 
	`£fs_’Œy
(
this
, 
cÚ‹xt
, 
objeùCÏss
, 
s
);

1233 
e
->
_šode
 = 
šode
;

1235 
s
 = 
NULL
;

1236 ià((
s
 = 
	`¡rdup
(
dev
)è=ğ
NULL
 || 
	`­Ş_b¡_š£¹_ªd_g‘
(
dev_Œ“
, (**)&s, NULL) < 0)

1238 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

1239 
	`ä“
(
s
);

1240 
throw
 
¡d
::
	`bad_®loc
();

1242 
e
->
_dev
 = 
dev
;

1243  
e
;

1244 
	}
}

1248 
£fs_fşi¡_t
 *
	$£fs_db_ü—‹_äom_fesy¡em
(
£fs_fesy¡em_t
 * 
fs
, 
£fs_ÿÎback_â_t
 
msg_ÿÎback
, *
v¬g
)

1250 
£fs_fşi¡_t
 *
fc
 = 
NULL
;

1251 
Œy


1253 
fc
 = 
Ãw
 
	`£fs_db
(
fs
, 
msg_ÿÎback
, 
v¬g
);

1255 
	`ÿtch
(...)

1257  
NULL
;

1259  
fc
;

1260 
	}
}

1262 
£fs_fşi¡_t
 *
	$£fs_db_ü—‹_äom_fe
(cÚ¡ *
f’ame
, 
£fs_ÿÎback_â_t
 
msg_ÿÎback
, *
v¬g
)

1264 
£fs_fşi¡_t
 *
fc
 = 
NULL
;

1265 
Œy


1267 
fc
 = 
Ãw
 
	`£fs_db
(
f’ame
, 
msg_ÿÎback
, 
v¬g
);

1269 
	`ÿtch
(...)

1271  
NULL
;

1273  
fc
;

1274 
	}
}

1276 
	$£fs_db_§ve
(
£fs_db_t
 * 
db
, cÚ¡ *
f’ame
)

1278 ià(
db
 =ğ
NULL
)

1280 
	`SEFS_ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
EINVAL
));

1281 
”ºo
 = 
EINVAL
;

1284 
Œy


1286 
db
->
	`§ve
(
f’ame
);

1288 
	`ÿtch
(...)

1293 
	}
}

1295 
time_t
 
	$£fs_db_g‘_ùime
(
£fs_db_t
 * 
db
)

1297 ià(
db
 =ğ
NULL
)

1299 
	`SEFS_ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
EINVAL
));

1300 
”ºo
 = 
EINVAL
;

1301  
¡©ic_ÿ¡
 < 
time_t
 > (-1);

1303  
db
->
	`g‘CTime
();

1304 
	}
}

1306 
boŞ
 
	$£fs_db_is_db
(cÚ¡ *
f’ame
)

1308  
£fs_db
::
	`isDB
(
f’ame
);

1309 
	}
}

	@libsefs/src/entry.cc

25 
	~<cÚfig.h
>

27 
	~"£fs_š‹º®.hh
"

29 
	~<£fs/’Œy.hh
>

30 
	~<­Ş/ut.h
>

31 
	~<qpŞ/g’fscÚ_qu”y.h
>

33 
	~<as£¹.h
>

34 
	~<”ºo.h
>

38 
	g£fs_’Œy
::
	$£fs_’Œy
(cÚ¡ 
£fs_’Œy
 * 
e
)

40 
_fşi¡
 = 
e
->_fclist;

41 
_cÚ‹xt
 = 
e
->_context;

42 
_šode
 = 
e
->_inode;

43 
_dev
 = 
e
->_dev;

44 
_objeùCÏss
 = 
e
->_objectClass;

45 
_·th
 = 
e
->_path;

46 
_Üigš
 = 
e
->_origin;

47 
	}
}

49 
	g£fs_’Œy
::~
	$£fs_’Œy
()

52 
	}
}

54 cÚ¡ 
­Ş_cÚ‹xt_t
 *
£fs_’Œy
::
	$cÚ‹xt
() const

56  
_cÚ‹xt
->
cÚ‹xt
;

57 
	}
}

59 
šo64_t
 
	g£fs_’Œy
::
	$šode
() const

61  
_šode
;

62 
	}
}

64 cÚ¡ *
	g£fs_’Œy
::
	$dev
() const

66  
_dev
;

67 
	}
}

69 
ušt32_t
 
	g£fs_’Œy
::
	$objeùCÏss
() const

71  
_objeùCÏss
;

72 
	}
}

74 cÚ¡ *
	g£fs_’Œy
::
	$·th
() const

76  
_·th
;

77 
	}
}

79 cÚ¡ *
	g£fs_’Œy
::
	$Üigš
() const

81  
_Üigš
;

82 
	}
}

84 *
	g£fs_’Œy
::
	$toSŒšg
(ècÚ¡ 
	$throw
(
¡d
::
bad_®loc
)

86 *
şass_¡r
;

88 
_objeùCÏss
)

90 
QPOL_CLASS_ALL
:

91 
şass_¡r
 = " ";

93 
QPOL_CLASS_BLK_FILE
:

94 
şass_¡r
 = "-b";

96 
QPOL_CLASS_CHR_FILE
:

97 
şass_¡r
 = "-c";

99 
QPOL_CLASS_DIR
:

100 
şass_¡r
 = "-d";

102 
QPOL_CLASS_FIFO_FILE
:

103 
şass_¡r
 = "-p";

105 
QPOL_CLASS_FILE
:

106 
şass_¡r
 = "--";

108 
QPOL_CLASS_LNK_FILE
:

109 
şass_¡r
 = "-l";

111 
QPOL_CLASS_SOCK_FILE
:

112 
şass_¡r
 = "-s";

116 
	`as£¹
(0);

117 
şass_¡r
 = "-?";

120 *
s
 = 
NULL
;

121 ià(
	`a¥rštf
(&
s
, "%s\t%s\t%s", 
_·th
, 
şass_¡r
, 
_cÚ‹xt
->
cÚ‹xt_¡r
) < 0)

123 
	`SEFS_ERR
(
_fşi¡
, "%s", 
	`¡»¼Ü
(
”ºo
));

124 
throw
 
¡d
::
	`bad_®loc
();

126  
s
;

127 
	}
}

131 
	g£fs_’Œy
::
	$£fs_’Œy
(
şass
 
£fs_fşi¡
 * 
fşi¡
, cÚ¡ 
£fs_cÚ‹xt_node
 * 
Ãw_cÚ‹xt
, 
ušt32_t
 
Ãw_objeùCÏss
,

132 cÚ¡ *
Ãw_·th
, cÚ¡ *
Ãw_Üigš
)

134 
_fşi¡
 = 
fşi¡
;

135 
_cÚ‹xt
 = 
Ãw_cÚ‹xt
;

136 
_objeùCÏss
 = 
Ãw_objeùCÏss
;

137 
_šode
 = 0;

138 
_dev
 = 
NULL
;

139 
_·th
 = 
Ãw_·th
;

140 
_Üigš
 = 
Ãw_Üigš
;

141 
	}
}

145 cÚ¡ 
­Ş_cÚ‹xt_t
 *
	$£fs_’Œy_g‘_cÚ‹xt
(cÚ¡ 
£fs_’Œy_t
 * 
’t
)

147 ià(
’t
 =ğ
NULL
)

149 
”ºo
 = 
EINVAL
;

150  
NULL
;

152  
’t
->
	`cÚ‹xt
();

153 
	}
}

155 
šo64_t
 
	$£fs_’Œy_g‘_šode
(cÚ¡ 
£fs_’Œy_t
 * 
’t
)

157 ià(
’t
 =ğ
NULL
)

159 
”ºo
 = 
EINVAL
;

162  
’t
->
	`šode
();

163 
	}
}

165 cÚ¡ *
	$£fs_’Œy_g‘_dev
(cÚ¡ 
£fs_’Œy_t
 * 
’t
)

167 ià(
’t
 =ğ
NULL
)

169 
”ºo
 = 
EINVAL
;

172  
’t
->
	`dev
();

173 
	}
}

175 
ušt32_t
 
	$£fs_’Œy_g‘_objeù_şass
(cÚ¡ 
£fs_’Œy_t
 * 
’t
)

177 ià(
’t
 =ğ
NULL
)

179 
”ºo
 = 
EINVAL
;

180  
QPOL_CLASS_ALL
;

182  
’t
->
	`objeùCÏss
();

183 
	}
}

185 cÚ¡ *
	$£fs_’Œy_g‘_·th
(cÚ¡ 
£fs_’Œy_t
 * 
’t
)

187 ià(
’t
 =ğ
NULL
)

189 
”ºo
 = 
EINVAL
;

190  
NULL
;

192  
’t
->
	`·th
();

193 
	}
}

195 cÚ¡ *
	$£fs_’Œy_g‘_Üigš
(cÚ¡ 
£fs_’Œy_t
 * 
’t
)

197 ià(
’t
 =ğ
NULL
)

199 
”ºo
 = 
EINVAL
;

200  
NULL
;

202  
’t
->
	`Üigš
();

203 
	}
}

205 *
	$£fs_’Œy_to_¡ršg
(cÚ¡ 
£fs_’Œy_t
 * 
’t
)

207 ià(
’t
 =ğ
NULL
)

209 
”ºo
 = 
EINVAL
;

210  
NULL
;

212  
’t
->
	`toSŒšg
();

213 
	}
}

	@libsefs/src/fcfile.cc

25 
	~<cÚfig.h
>

27 
	~"£fs_š‹º®.hh
"

29 
	~<£fs/’Œy.hh
>

30 
	~<£fs/fcfe.hh
>

31 
	~<­Ş/ut.h
>

32 
	~<qpŞ/g’fscÚ_qu”y.h
>

33 
	~<as£¹.h
>

34 
	~<ùy³.h
>

35 
	~<”ºo.h
>

36 
	~<»gex.h
>

37 
	~<¡dio.h
>

41 
	$fcfe_’Œy_ä“
(*
–em
)

43 ià(
–em
 !ğ
NULL
)

45 
£fs_’Œy
 *
’Œy
 = 
¡©ic_ÿ¡
 < sefs_’Œy * >(
–em
);

46 
d–‘e
 
’Œy
;

48 
	}
}

50 
	g£fs_fcfe
::
	$£fs_fcfe
(
£fs_ÿÎback_â_t
 
msg_ÿÎback
, *
v¬g
è
	$throw
(
¡d
::
bad_®loc
):
	$£fs_fşi¡
(
SEFS_FCLIST_TYPE_FCFILE
,

51 
msg_ÿÎback
, 
v¬g
)

53 
_fes
 = 
_’Œ›s
 = 
NULL
;

54 
_mls_£t
 = 
çl£
;

55 
Œy


57 ià((
_fes
 = 
	`­Ş_veùÜ_ü—‹
(
ä“
)è=ğ
NULL
)

59 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

60 
throw
 
¡d
::
	`bad_®loc
();

62 ià((
_’Œ›s
 = 
	`­Ş_veùÜ_ü—‹
(
fcfe_’Œy_ä“
)è=ğ
NULL
)

64 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

65 
throw
 
¡d
::
	`bad_®loc
();

68 
	`ÿtch
(...)

70 
	`­Ş_veùÜ_de¡roy
(&
_fes
);

71 
	`­Ş_veùÜ_de¡roy
(&
_’Œ›s
);

72 
throw
;

74 
	}
}

76 
	g£fs_fcfe
::
	$£fs_fcfe
(cÚ¡ *
fe
, 
£fs_ÿÎback_â_t
 
msg_ÿÎback
, *
v¬g
è
	$throw
(
¡d
::
bad_®loc
, std::
šv®id_¬gum’t
,

77 
¡d
::

78 
ruÁime_”rÜ
):
£fs_fşi¡


79 (
SEFS_FCLIST_TYPE_FCFILE
, 
msg_ÿÎback
, 
v¬g
)

81 
_fes
 = 
_’Œ›s
 = 
NULL
;

82 
_mls_£t
 = 
çl£
;

83 
Œy


85 ià((
_fes
 = 
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(1, 
ä“
)è=ğ
NULL
)

87 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

88 
throw
 
¡d
::
	`bad_®loc
();

90 ià((
_’Œ›s
 = 
	`­Ş_veùÜ_ü—‹
(
fcfe_’Œy_ä“
)è=ğ
NULL
)

92 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

93 
throw
 
¡d
::
	`bad_®loc
();

95 ià(
	`­³ndFe
(
fe
) < 0)

97 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

98 
throw
 
¡d
::
	`ruÁime_”rÜ
("Could‚ot construct fcfile withhe given file.");

101 
	`ÿtch
(...)

103 
	`­Ş_veùÜ_de¡roy
(&
_fes
);

104 
	`­Ş_veùÜ_de¡roy
(&
_’Œ›s
);

105 
throw
;

107 
	}
}

109 
	g£fs_fcfe
::
	$£fs_fcfe
(cÚ¡ 
­Ş_veùÜ_t
 * 
fes
, 
£fs_ÿÎback_â_t
 
msg_ÿÎback
, *
v¬g
è
	$throw
(
¡d
::
bad_®loc
,

110 
¡d
::
šv®id_¬gum’t
,

111 
¡d
::

112 
ruÁime_”rÜ
):
£fs_fşi¡


113 (
SEFS_FCLIST_TYPE_FCFILE
, 
msg_ÿÎback
, 
v¬g
)

115 
_fes
 = 
_’Œ›s
 = 
NULL
;

116 
_mls_£t
 = 
çl£
;

117 
Œy


119 ià(
fes
 =ğ
NULL
)

121 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
EINVAL
));

122 
”ºo
 = 
EINVAL
;

123 
throw
 
¡d
::
	`šv®id_¬gum’t
(
	`¡»¼Ü
(
EINVAL
));

125 ià((
_fes
 = 
	`­Ş_veùÜ_ü—‹_w™h_ÿ·c™y
(
	`­Ş_veùÜ_g‘_size
(
fes
), 
ä“
)è=ğ
NULL
)

127 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

128 
throw
 
¡d
::
	`bad_®loc
();

130 ià((
_’Œ›s
 = 
	`­Ş_veùÜ_ü—‹
(
fcfe_’Œy_ä“
)è=ğ
NULL
)

132 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

133 
throw
 
¡d
::
	`bad_®loc
();

135 ià(
	`­³ndFeLi¡
(
fes
è!ğ
	`­Ş_veùÜ_g‘_size
(files))

137 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

138 
throw
 
¡d
::
	`ruÁime_”rÜ
("Could‚ot construct fcfile withhe given vector.");

141 
	`ÿtch
(...)

143 
	`­Ş_veùÜ_de¡roy
(&
_fes
);

144 
	`­Ş_veùÜ_de¡roy
(&
_’Œ›s
);

145 
throw
;

147 
	}
}

149 
	g£fs_fcfe
::~
	$£fs_fcfe
()

151 
	`­Ş_veùÜ_de¡roy
(&
_fes
);

152 
	`­Ş_veùÜ_de¡roy
(&
_’Œ›s
);

153 
	}
}

155 
	g£fs_fcfe
::
	$runQu”yM­
(
£fs_qu”y
 * 
qu”y
, 
£fs_fşi¡_m­_â_t
 
â
, *
d©a
è
	$throw
(
¡d
::
ruÁime_”rÜ
,

156 
¡d
::
šv®id_¬gum’t
)

158 
­Ş_veùÜ_t
 *
ty³_li¡
 = 
NULL
;

159 
­Ş_mls_¿nge_t
 *
¿nge
 = 
NULL
;

160 
»tv®
 = 0;

161 
Œy


163 ià(
qu”y
 !ğ
NULL
)

165 
qu”y
->
	`compe
();

166 ià(
pŞicy
 !ğ
NULL
)

168 ià(
qu”y
->
_ty³
 !ğ
NULL
 && qu”y->
_šdœeù
 &&

169 (
ty³_li¡
 =

170 
	`qu”y_ü—‹_ÿndid©e_ty³
(
pŞicy
, 
qu”y
->
_ty³
, qu”y->
_»ty³
, qu”y->
_»gex
,

171 
qu”y
->
_šdœeù
)è=ğ
NULL
)

173 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

174 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

176 ià(
qu”y
->
_¿nge
 !ğ
NULL
 && qu”y->
_¿ngeM©ch
 != 0 &&

177 (
¿nge
 = 
	`­Ş_mls_¿nge_ü—‹_äom_¡ršg
(
pŞicy
, 
qu”y
->
_¿nge
)è=ğ
NULL
)

179 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

180 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

185 
size_t
 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
_’Œ›s
); i++)

187 
£fs_’Œy
 *
e
 = 
¡©ic_ÿ¡
 < sefs_’Œy * >(
	`­Ş_veùÜ_g‘_–em’t
(
_’Œ›s
, 
i
));

188 ià(
qu”y
 !ğ
NULL
)

190 cÚ¡ 
£fs_cÚ‹xt_node
 *
cÚ‹xt
 = 
e
->
_cÚ‹xt
;

191 ià(!
	`qu”y_¡r_com·»
(
cÚ‹xt
->
u£r
, 
qu”y
->
_u£r
, qu”y->
_»u£r
, qu”y->
_»gex
))

195 ià(!
	`qu”y_¡r_com·»
(
cÚ‹xt
->
rŞe
, 
qu”y
->
_rŞe
, qu”y->
_»rŞe
, qu”y->
_»gex
))

200 
boŞ
 
¡r_m©ched
 = 
çl£
, 
pŞ_m©ched
 = false;

201 
¡r_m©ched
 = 
	`qu”y_¡r_com·»
(
cÚ‹xt
->
ty³
, 
qu”y
->
_ty³
, qu”y->
_»ty³
, qu”y->
_»gex
);

202 ià(
ty³_li¡
 !ğ
NULL
 && !
¡r_m©ched
)

204 
size_t
 
šdex
;

205 
pŞ_m©ched
 =

206 (
	`­Ş_veùÜ_g‘_šdex
(
ty³_li¡
, 
cÚ‹xt
->
ty³
, 
­Ş_¡r_¡rcmp
, 
NULL
, &
šdex
) <

209 ià(!
¡r_m©ched
 && !
pŞ_m©ched
)

214 ià(
	`isMLS
())

216 ià(
¿nge
 =ğ
NULL
)

218 ià(!
qu”y_¡r_com·»


219 (
cÚ‹xt
->
¿nge
, 
qu”y
->
_¿nge
, qu”y->
_»¿nge
, qu”y->
_»gex
))

226 cÚ¡ 
­Ş_mls_¿nge_t
 *
cÚ‹xt_¿nge
 = 
	`­Ş_cÚ‹xt_g‘_¿nge
(
cÚ‹xt
->context);

227 
»t
;

228 
»t
 = 
	`­Ş_mls_¿nge_com·»
(
pŞicy
, 
cÚ‹xt_¿nge
, 
¿nge
, 
qu”y
->
_¿ngeM©ch
);

229 ià(
»t
 <= 0)

236 ià(
e
->
_objeùCÏss
 !ğ
QPOL_CLASS_ALL
 && 
qu”y
->
_objşass
 != QPOL_CLASS_ALL &&

237 
e
->
_objeùCÏss
 !ğ
qu”y
->
_objşass
)

242 
boŞ
 
·th_m©ched
;

244 ià(
qu”y
->
_·th
 =ğ
NULL
 || query->_path[0] == '\0')

246 
·th_m©ched
 = 
Œue
;

250 
·th_m©ched
 = 
çl£
;

251 *
ªchÜed_·th
 = 
NULL
;

252 ià(
	`a¥rštf
(&
ªchÜed_·th
, "^%s$", 
e
->
_·th
) < 0)

254 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

255 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

258 
»gex_t
 
»gex
;

259 ià(
	`»gcomp
(&
»gex
, 
ªchÜed_·th
, 
REG_EXTENDED
 | 
REG_NOSUB
) != 0)

261 
	`ä“
(
ªchÜed_·th
);

262 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

263 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

266 
boŞ
 
compv®
 = 
	`qu”y_¡r_com·»
(
qu”y
->
_·th
, 
ªchÜed_·th
, &
»gex
, 
Œue
);

267 
	`ä“
(
ªchÜed_·th
);

268 
	`»gä“
(&
»gex
);

269 ià(
compv®
)

271 
·th_m©ched
 = 
Œue
;

274 ià(!
·th_m©ched
)

283 ià((
»tv®
 = 
	`â
(
this
, 
e
, 
d©a
)) < 0)

285  
»tv®
;

289 
	`ÿtch
(...)

291 
	`­Ş_veùÜ_de¡roy
(&
ty³_li¡
);

292 
	`­Ş_mls_¿nge_de¡roy
(&
¿nge
);

293 
throw
;

295 
	`­Ş_veùÜ_de¡roy
(&
ty³_li¡
);

296  
»tv®
;

297 
	}
}

299 
boŞ
 
	g£fs_fcfe
::
	$isMLS
() const

301 ià(
_mls_£t
)

303  
_mls
;

305  
çl£
;

306 
	}
}

308 
	g£fs_fcfe
::
	$­³ndFe
(cÚ¡ *
fe
è
	$throw
(
¡d
::
bad_®loc
, std::
šv®id_¬gum’t
, std::
ruÁime_”rÜ
)

310 
FILE
 *
fc_fe
 = 
NULL
;

311 *
lše
 = 
NULL
, *
Çme_dup
 = NULL;

312 
size_t
 
lše_Ën
 = 0;

313 
size_t
 
Ï¡_’Œy
 = 
	`­Ş_veùÜ_g‘_size
(
_’Œ›s
);

314 
»tv®
, 
”rÜ
 = 0;

316 
»gex_t
 
lše_»gex
, 
cÚ‹xt_»gex
;

317 
boŞ
 
is_lše_comped
 = 
çl£
;

318 
boŞ
 
is_cÚ‹xt_comped
 = 
çl£
;

320 
Œy


322 ià(
fe
 =ğ
NULL
)

324 
”ºo
 = 
EINVAL
;

325 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
EINVAL
));

326 
throw
 
¡d
::
	`šv®id_¬gum’t
(
	`¡»¼Ü
(
EINVAL
));

329 
fc_fe
 = 
	`fİ’
(
fe
, "r");

330 ià(!
fc_fe
)

332 
	`SEFS_ERR
(
this
, "UÇbËØİ’ f%s", 
fe
);

333 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”rÜ
));

336 ià((
Çme_dup
 = 
	`¡rdup
(
fe
)è=ğ
NULL
)

338 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”rÜ
));

339 
throw
 
¡d
::
	`bad_®loc
();

342 ià(
	`»gcomp
(&
lše_»gex
, "^([^[:bÏnk:]]+)[[:bÏnk:]]+(-.[[:bÏnk:]]+)?([^-].+)$", 
REG_EXTENDED
) != 0)

344 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”rÜ
));

345 
throw
 
¡d
::
	`bad_®loc
();

347 
is_lše_comped
 = 
Œue
;

349 ià(
	`»gcomp
(&
cÚ‹xt_»gex
, "^([^:]+):([^:]+):([^:]+):?(.*)$", 
REG_EXTENDED
) != 0)

351 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”rÜ
));

352 
throw
 
¡d
::
	`bad_®loc
();

354 
is_cÚ‹xt_comped
 = 
Œue
;

356 !
	`ãof
(
fc_fe
))

358 ià(
	`g‘lše
(&
lše
, &
lše_Ën
, 
fc_fe
) == -1)

360 ià(
	`ãof
(
fc_fe
))

366 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”rÜ
));

367 
throw
 
¡d
::
	`bad_®loc
();

370 
	`·r£_lše
(
Çme_dup
, 
lše
, &
lše_»gex
, &
cÚ‹xt_»gex
);

373 ià(
	`­Ş_veùÜ_­³nd
(
_fes
, 
Çme_dup
) < 0)

375 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”rÜ
));

376 
throw
 
¡d
::
	`bad_®loc
();

378 
Çme_dup
 = 
NULL
;

380 
»tv®
 = 0;

382 
	`ÿtch
(...)

384 
”rÜ
 = 
”ºo
;

386 
size_t
 
i
 = 
	`­Ş_veùÜ_g‘_size
(
_’Œ›s
);

387 ; 
i
 > 
Ï¡_’Œy
; i--)

389 
£fs_’Œy
 *
e
 = 
¡©ic_ÿ¡
 < sefs_’Œy * >(
	`­Ş_veùÜ_g‘_–em’t
(
_’Œ›s
, 
i
 - 1));

390 
	`fcfe_’Œy_ä“
(
e
);

391 
	`­Ş_veùÜ_»move
(
_’Œ›s
, 
i
 - 1);

393 
»tv®
 = -1;

396 ià(
fc_fe
 !ğ
NULL
)

398 
	`fşo£
(
fc_fe
);

400 ià(
is_lše_comped
)

402 
	`»gä“
(&
lše_»gex
);

404 ià(
is_cÚ‹xt_comped
)

406 
	`»gä“
(&
cÚ‹xt_»gex
);

408 
	`ä“
(
Çme_dup
);

409 
	`ä“
(
lše
);

410 
”ºo
 = 
”rÜ
;

411  
»tv®
;

412 
	}
}

414 
size_t
 
	g£fs_fcfe
::
	$­³ndFeLi¡
(cÚ¡ 
­Ş_veùÜ_t
 * 
fes
)
	$throw
(
¡d
::
bad_®loc
, std::
šv®id_¬gum’t
, std::
ruÁime_”rÜ
)

416 
size_t
 
i
;

417 ià(
fes
 =ğ
NULL
)

419 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
EINVAL
));

420 
”ºo
 = 
EINVAL
;

421 
throw
 
Ãw
 
¡d
::
	`šv®id_¬gum’t
(
	`¡»¼Ü
(
EINVAL
));

423 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
fes
); i++)

425 ià(
	`­³ndFe
(
¡©ic_ÿ¡
 < *>(
	`­Ş_veùÜ_g‘_–em’t
(
fes
, 
i
))) < 0)

427  
i
;

430  
i
;

431 
	}
}

433 cÚ¡ 
­Ş_veùÜ_t
 *
	g£fs_fcfe
::
	$feLi¡
() const

435  
_fes
;

436 
	}
}

440 
	g£fs_fcfe
::
	$·r£_lše
(cÚ¡ *
Üigš
, cÚ¡ *
lše
, 
»gex_t
 * 
lše_»gex
,

441 
»gex_t
 * 
cÚ‹xt_»gex
è
	$throw
(
¡d
::
bad_®loc
, std::
ruÁime_”rÜ
)

443 
”rÜ
 = 0;

445 *
s
 = 
	`¡rdup
(
lše
);

446 *
·th
;

448 ià(
s
 =ğ
NULL
)

450 
”rÜ
 = 
”ºo
;

451 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”rÜ
));

452 
throw
 
¡d
::
	`bad_®loc
();

455 
	`­Ş_¡r_Œim
(
s
);

456 ià(
s
[0] == '#' || s[0] == '\0')

458 
	`ä“
(
s
);

462 
Œy


464 cÚ¡ 
size_t
 
nm©ch
 = 5;

465 
»gm©ch_t
 
pm©ch
[
nm©ch
];

467 ià(
	`»gexec
(
lše_»gex
, 
s
, 
nm©ch
, 
pm©ch
, 0) != 0)

469 
”rÜ
 = 
EIO
;

470 
	`SEFS_ERR
(
this
, "fcflši nÙ†eg®:\n%s", 
s
);

471 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”rÜ
));

474 
	`as£¹
(
pm©ch
[1].
rm_so
 == 0);

475 
s
[
pm©ch
[1].
rm_eo
] = '\0';

476 ià((
·th
 = 
	`¡rdup
(
s
)è=ğ
NULL
)

478 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

479 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”rÜ
));

481 ià(
	`­Ş_b¡_š£¹_ªd_g‘
(
·th_Œ“
, (**)&
·th
, 
NULL
) < 0)

483 
	`ä“
(
·th
);

484 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

485 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”rÜ
));

488 
ušt32_t
 
objşass
;

489 ià(
pm©ch
[2].
rm_so
 != -1)

491 
s
[
pm©ch
[2].
rm_so
 + 1])

494 
objşass
 = 
QPOL_CLASS_FILE
;

497 
objşass
 = 
QPOL_CLASS_DIR
;

500 
objşass
 = 
QPOL_CLASS_CHR_FILE
;

503 
objşass
 = 
QPOL_CLASS_BLK_FILE
;

506 
objşass
 = 
QPOL_CLASS_FIFO_FILE
;

509 
objşass
 = 
QPOL_CLASS_LNK_FILE
;

512 
objşass
 = 
QPOL_CLASS_SOCK_FILE
;

515 
”rÜ
 = 
EIO
;

516 
	`SEFS_ERR
(
this
, "%s", "Invalid file context object class.");

517 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”rÜ
));

523 
objşass
 = 
QPOL_CLASS_ALL
;

526 
	`as£¹
(
pm©ch
[3].
rm_so
 != -1);

527 *
cÚ‹xt_¡r
 = 
s
 + 
pm©ch
[3].
rm_so
;

528 *
u£r
, *
rŞe
, *
ty³
, *
¿nge
;

530 ià(
	`¡rcmp
(
cÚ‹xt_¡r
, "<<none>>") == 0)

532 
u£r
 = 
rŞe
 = 
ty³
 = 
¿nge
 = "";

536 ià(
	`»gexec
(
cÚ‹xt_»gex
, 
cÚ‹xt_¡r
, 
nm©ch
, 
pm©ch
, 0) != 0)

538 
”rÜ
 = 
EIO
;

539 
	`SEFS_ERR
(
this
, "fcfcÚ‹xˆi nÙ†eg®:\n%s", 
cÚ‹xt_¡r
);

540 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”rÜ
));

543 
	`as£¹
(
pm©ch
[1].
rm_so
 == 0);

544 
cÚ‹xt_¡r
[
pm©ch
[1].
rm_eo
] = '\0';

545 
u£r
 = 
cÚ‹xt_¡r
;

547 
	`as£¹
(
pm©ch
[2].
rm_so
 != -1);

548 
cÚ‹xt_¡r
[
pm©ch
[2].
rm_eo
] = '\0';

549 
rŞe
 = 
cÚ‹xt_¡r
 + 
pm©ch
[2].
rm_so
;

551 
	`as£¹
(
pm©ch
[3].
rm_so
 != -1);

552 
cÚ‹xt_¡r
[
pm©ch
[3].
rm_eo
] = '\0';

553 
ty³
 = 
cÚ‹xt_¡r
 + 
pm©ch
[3].
rm_so
;

555 
¿nge
 = 
NULL
;

556 ià(
pm©ch
[4].
rm_so
 != -1)

558 
¿nge
 = 
cÚ‹xt_¡r
 + 
pm©ch
[4].
rm_so
;

561 ià(
¿nge
 !ğ
NULL
 &„ange[0] != '\0')

563 ià(
_mls_£t
 && !
_mls
)

565 
”rÜ
 = 
EIO
;

566 
	`SEFS_ERR
(
this
, "fcfcÚ‹xˆi MLS, buˆfcfi nÙ:\n%s", 
cÚ‹xt_¡r
);

567 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”rÜ
));

569 
_mls
 = 
Œue
;

570 
_mls_£t
 = 
Œue
;

574 ià(
_mls_£t
 && !
_mls
 && 
	`¡rcmp
(
cÚ‹xt_¡r
, "<<none>>") != 0)

576 
”rÜ
 = 
EIO
;

577 
	`SEFS_ERR
(
this
, "fcfcÚ‹xˆi nÙ MLS, buˆfcfis:\n%s", 
cÚ‹xt_¡r
);

578 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”rÜ
));

580 
_mls
 = 
Œue
;

581 
_mls_£t
 = 
çl£
;

583 
£fs_cÚ‹xt_node
 *
cÚ‹xt
 = 
	`g‘CÚ‹xt
(
u£r
, 
rŞe
, 
ty³
, 
¿nge
);

584 
£fs_’Œy
 *
’Œy
 = 
Ãw
 
	`£fs_’Œy
(
this
, 
cÚ‹xt
, 
objşass
, 
·th
, 
Üigš
);

586 ià(
	`­Ş_veùÜ_­³nd
(
_’Œ›s
, 
¡©ic_ÿ¡
 < *>(
’Œy
)) < 0)

588 
”rÜ
 = 
”ºo
;

589 
d–‘e
 
’Œy
;

590 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”rÜ
));

591 
throw
 
¡d
::
	`bad_®loc
();

595 
	`ÿtch
(...)

597 
	`ä“
(
s
);

598 
”ºo
 = 
”rÜ
;

599 
throw
;

602 
	`ä“
(
s
);

603 
	}
}

607 
£fs_fşi¡_t
 *
	$£fs_fcfe_ü—‹
(
£fs_ÿÎback_â_t
 
msg_ÿÎback
, *
v¬g
)

609 
£fs_fşi¡
 *
fşi¡
;

610 
Œy


612 
fşi¡
 = 
Ãw
 
	`£fs_fcfe
(
msg_ÿÎback
, 
v¬g
);

614 
	`ÿtch
(...)

616 
”ºo
 = 
ENOMEM
;

617  
NULL
;

619  
fşi¡
;

620 
	}
}

622 
£fs_fşi¡_t
 *
	$£fs_fcfe_ü—‹_äom_fe
(cÚ¡ *
fe
, 
£fs_ÿÎback_â_t
 
msg_ÿÎback
, *
v¬g
)

624 
£fs_fşi¡
 *
fşi¡
;

625 
Œy


627 
fşi¡
 = 
Ãw
 
	`£fs_fcfe
(
fe
, 
msg_ÿÎback
, 
v¬g
);

629 
	`ÿtch
(...)

631 
”ºo
 = 
ENOMEM
;

632  
NULL
;

634  
fşi¡
;

635 
	}
}

637 
£fs_fşi¡_t
 *
	$£fs_fcfe_ü—‹_äom_fe_li¡
(cÚ¡ 
­Ş_veùÜ_t
 * 
fes
, 
£fs_ÿÎback_â_t
 
msg_ÿÎback
, *
v¬g
)

639 
£fs_fşi¡
 *
fşi¡
;

640 
Œy


642 
fşi¡
 = 
Ãw
 
	`£fs_fcfe
(
fes
, 
msg_ÿÎback
, 
v¬g
);

644 
	`ÿtch
(...)

646 
”ºo
 = 
ENOMEM
;

647  
NULL
;

649  
fşi¡
;

650 
	}
}

652 
	$£fs_fcfe_­³nd_fe
(
£fs_fcfe_t
 * 
fcfe
, cÚ¡ *
fe
)

654 ià(
fcfe
 =ğ
NULL
)

656 
	`SEFS_ERR
(
fcfe
, "%s", 
	`¡»¼Ü
(
EINVAL
));

657 
”ºo
 = 
EINVAL
;

660 
Œy


662 
fcfe
->
	`­³ndFe
(
fe
);

664 
	`ÿtch
(...)

669 
	}
}

671 
size_t
 
	$£fs_fcfe_­³nd_fe_li¡
(
£fs_fcfe_t
 * 
fcfe
, cÚ¡ 
­Ş_veùÜ_t
 * 
fes
)

673 ià(
fcfe
 =ğ
NULL
)

675 
	`SEFS_ERR
(
fcfe
, "%s", 
	`¡»¼Ü
(
EINVAL
));

676 
”ºo
 = 
EINVAL
;

679  
fcfe
->
	`­³ndFeLi¡
(
fes
);

680 
	}
}

682 cÚ¡ 
­Ş_veùÜ_t
 *
	$£fs_fcfe_g‘_fe_li¡
(cÚ¡ 
£fs_fcfe_t
 * 
fcfe
)

684 ià(
fcfe
 =ğ
NULL
)

686 
	`SEFS_ERR
(
fcfe
, "%s", 
	`¡»¼Ü
(
EINVAL
));

687 
”ºo
 = 
EINVAL
;

688  
NULL
;

690  
fcfe
->
	`feLi¡
();

691 
	}
}

	@libsefs/src/fclist.cc

25 
	~<cÚfig.h
>

27 
	~"£fs_š‹º®.hh
"

29 
	~<£fs/’Œy.hh
>

30 
	~<­Ş/ut.h
>

31 
	~<as£¹.h
>

32 
	~<”ºo.h
>

33 
	~<¡dio.h
>

34 
	~<¡ršg.h
>

35 
	~<£lšux/cÚ‹xt.h
>

36 
	~<sys/ty³s.h
>

38 
fşi¡_£fs_cÚ‹xt_node_comp
(cÚ¡ *
a
, cÚ¡ *
b
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

40 cÚ¡ 
£fs_cÚ‹xt_node
 *
	gn1
 = 
¡©ic_ÿ¡
 < cÚ¡ £fs_cÚ‹xt_nod*>(
a
);

41 cÚ¡ 
£fs_cÚ‹xt_node
 *
	gn2
 = 
¡©ic_ÿ¡
 < cÚ¡ £fs_cÚ‹xt_nod*>(
b
);

42 ià(
	gn1
->
	gty³
 !ğ
n2
->
ty³
)

44  
¡©ic_ÿ¡
 < >(
»š‹½»t_ÿ¡
 < 
ssize_t
 > (
n1
->
ty³
è-„eš‹½»t_ÿ¡ < ssize_ˆ> (
n2
->type));

46 ià(
	gn1
->
	gu£r
 !ğ
n2
->
u£r
)

48  
¡©ic_ÿ¡
 < >(
»š‹½»t_ÿ¡
 < 
ssize_t
 > (
n1
->
u£r
è-„eš‹½»t_ÿ¡ < ssize_ˆ> (
n2
->user));

50 ià(
	gn1
->
	grŞe
 !ğ
n2
->
rŞe
)

52  
¡©ic_ÿ¡
 < >(
»š‹½»t_ÿ¡
 < 
ssize_t
 > (
n1
->
rŞe
è-„eš‹½»t_ÿ¡ < ssize_ˆ> (
n2
->role));

54  
	g¡©ic_ÿ¡
 < >(
	g»š‹½»t_ÿ¡
 < 
	gssize_t
 > (
	gn1
->
	g¿nge
è-„eš‹½»t_ÿ¡ < ssize_ˆ> (
	gn2
->range));

57 
	$fşi¡_£fs_cÚ‹xt_node_ä“
(*
–em
)

59 ià(
–em
 !ğ
NULL
)

61 
£fs_cÚ‹xt_node
 *
node
 = 
¡©ic_ÿ¡
 < £fs_cÚ‹xt_nod*>(
–em
);

62 
	`­Ş_cÚ‹xt_de¡roy
(&
node
->
cÚ‹xt
);

63 
	`ä“
(
node
->
cÚ‹xt_¡r
);

64 
	`ä“
(
node
);

66 
	}
}

68 
	$fşi¡_£fs_node_make_¡ršg
(
£fs_cÚ‹xt_node
 *
node
)

70 
	`ä“
(
node
->
cÚ‹xt_¡r
);

71 
node
->
cÚ‹xt_¡r
 = 
NULL
;

72 ià(
node
->
u£r
[0] =ğ'\0' &&‚ode->
rŞe
[0] =ğ'\0' &&‚ode->
ty³
[0] == '\0' &&

73 (
node
->
¿nge
 =ğ
NULL
 ||‚ode->range[0] == '\0'))

75 ià((
node
->
cÚ‹xt_¡r
 = 
	`¡rdup
("<<nÚe>>")è=ğ
NULL
)

84 *
s
 = 
NULL
;

85 ià(
	`a¥rštf
(&
s
, "%s:%s:%s", 
node
->
u£r
,‚ode->
rŞe
,‚ode->
ty³
) < 0)

89 ià(
node
->
¿nge
 !ğ
NULL
)

91 
size_t
 
Ën
 = 
	`¡¾’
(
s
) + 1;

92 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, ":%s", 
node
->
¿nge
) < 0)

94 
	`ä“
(
s
);

98 
node
->
cÚ‹xt_¡r
 = 
s
;

101 
	}
}

103 
	$fşi¡_£fs_node_cÚv”t
(*
d©a
, *
¬g
)

105 
£fs_cÚ‹xt_node
 *
node
 = 
¡©ic_ÿ¡
 < £fs_cÚ‹xt_nod*>(
d©a
);

106 
£fs_fşi¡
 *
fşi¡
 = 
¡©ic_ÿ¡
 < sefs_fşi¡ * >(
¬g
);

107 
­Ş_pŞicy_t
 *
p
 = 
fşi¡
->
	`assocŸ‹PŞicy
();

108 ià(
p
 !ğ
NULL
)

110 
»tv®
 = 
	`­Ş_cÚ‹xt_cÚv”t
(
p
, 
node
->
cÚ‹xt
);

111 ià(
»tv®
 < 0)

113  
»tv®
;

115 ià((
»tv®
 = 
	`fşi¡_£fs_node_make_¡ršg
(
node
)) < 0)

117  
»tv®
;

121 
	}
}

125 
	g£fs_fşi¡
::~
	$£fs_fşi¡
()

127 
	`­Ş_b¡_de¡roy
(&
u£r_Œ“
);

128 
	`­Ş_b¡_de¡roy
(&
rŞe_Œ“
);

129 
	`­Ş_b¡_de¡roy
(&
ty³_Œ“
);

130 
	`­Ş_b¡_de¡roy
(&
¿nge_Œ“
);

131 
	`­Ş_b¡_de¡roy
(&
·th_Œ“
);

132 
	`­Ş_b¡_de¡roy
(&
dev_Œ“
);

133 
	`­Ş_b¡_de¡roy
(&
cÚ‹xt_Œ“
);

134 
	}
}

136 
	$m­_to_veùÜ
(
£fs_fşi¡
 * 
fşi¡
, cÚ¡ 
£fs_’Œy
 * 
’Œy
, *
d©a
)

138 
­Ş_veùÜ_t
 *
v
 = 
¡©ic_ÿ¡
 <‡pŞ_veùÜ_ˆ* >(
d©a
);

139 
£fs_’Œy
 *
Ãw_’Œy
 = 
Ãw
 
	`£fs_’Œy
(
’Œy
);

140 ià(
	`­Ş_veùÜ_­³nd
(
v
, 
Ãw_’Œy
) < 0)

145 
	}
}

147 
	$fşi¡_’Œy_ä“
(*
–em
)

149 ià(
–em
 !ğ
NULL
)

151 
£fs_’Œy
 *
’Œy
 = 
¡©ic_ÿ¡
 < sefs_’Œy * >(
–em
);

152 
d–‘e
 
’Œy
;

154 
	}
}

156 
­Ş_veùÜ_t
 *
	g£fs_fşi¡
::
	$runQu”y
(
£fs_qu”y
 * 
qu”y
è
	$throw
(
¡d
::
bad_®loc
, std::
ruÁime_”rÜ
, std::
šv®id_¬gum’t
)

158 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

159 
Œy


161 ià((
v
 = 
	`­Ş_veùÜ_ü—‹
(
fşi¡_’Œy_ä“
)è=ğ
NULL
)

163 
throw
 
¡d
::
	`bad_®loc
();

165 ià(
	`runQu”yM­
(
qu”y
, 
m­_to_veùÜ
, 
v
) < 0)

167 
throw
 
¡d
::
	`bad_®loc
();

170 
	`ÿtch
(...)

172 
	`­Ş_veùÜ_de¡roy
(&
v
);

173 
throw
;

175  
v
;

176 
	}
}

178 
	g£fs_fşi¡
::
	$assocŸ‹PŞicy
(
­Ş_pŞicy_t
 * 
Ãw_pŞicy
)

180 
pŞicy
 = 
Ãw_pŞicy
;

181 ià(
pŞicy
 !ğ
NULL
)

183 ià(
	`­Ş_b¡_šÜd”_m­
(
cÚ‹xt_Œ“
, 
fşi¡_£fs_node_cÚv”t
, 
pŞicy
) < 0)

185 
throw
 
Ãw
 
¡d
::
	`bad_®loc
();

188 
	}
}

190 
­Ş_pŞicy_t
 *
	g£fs_fşi¡
::
	$assocŸ‹PŞicy
() const

192  
pŞicy
;

193 
	}
}

195 
£fs_fşi¡_ty³_e
 
	g£fs_fşi¡
::
	$fşi¡_ty³
() const

197  
_fşi¡_ty³
;

198 
	}
}

202 
	g£fs_fşi¡
::
	$£fs_fşi¡
(
£fs_fşi¡_ty³_e
 
ty³
, 
£fs_ÿÎback_â_t
 
ÿÎback
, *
v¬g
)
	$throw
(
¡d
::
bad_®loc
)

204 
_fşi¡_ty³
 = 
ty³
;

205 
_ÿÎback
 = 
ÿÎback
;

206 
_v¬g
 = 
v¬g
;

207 
pŞicy
 = 
NULL
;

208 
u£r_Œ“
 = 
rŞe_Œ“
 = 
ty³_Œ“
 = 
¿nge_Œ“
 = 
·th_Œ“
 = 
NULL
;

209 
dev_Œ“
 = 
NULL
;

210 
cÚ‹xt_Œ“
 = 
NULL
;

211 
Œy


213 ià((
u£r_Œ“
 = 
	`­Ş_b¡_ü—‹
(
­Ş_¡r_¡rcmp
, 
ä“
)è=ğ
NULL
)

215 
throw
 
¡d
::
	`bad_®loc
();

217 ià((
rŞe_Œ“
 = 
	`­Ş_b¡_ü—‹
(
­Ş_¡r_¡rcmp
, 
ä“
)è=ğ
NULL
)

219 
throw
 
¡d
::
	`bad_®loc
();

221 ià((
ty³_Œ“
 = 
	`­Ş_b¡_ü—‹
(
­Ş_¡r_¡rcmp
, 
ä“
)è=ğ
NULL
)

223 
throw
 
¡d
::
	`bad_®loc
();

225 ià((
¿nge_Œ“
 = 
	`­Ş_b¡_ü—‹
(
­Ş_¡r_¡rcmp
, 
ä“
)è=ğ
NULL
)

227 
throw
 
¡d
::
	`bad_®loc
();

229 ià((
·th_Œ“
 = 
	`­Ş_b¡_ü—‹
(
­Ş_¡r_¡rcmp
, 
ä“
)è=ğ
NULL
)

231 
throw
 
¡d
::
	`bad_®loc
();

233 ià((
dev_Œ“
 = 
	`­Ş_b¡_ü—‹
(
­Ş_¡r_¡rcmp
, 
ä“
)è=ğ
NULL
)

235 
throw
 
¡d
::
	`bad_®loc
();

237 ià((
cÚ‹xt_Œ“
 = 
	`­Ş_b¡_ü—‹
(
fşi¡_£fs_cÚ‹xt_node_comp
, 
fşi¡_£fs_cÚ‹xt_node_ä“
)è=ğ
NULL
)

239 
throw
 
¡d
::
	`bad_®loc
();

242 
	`ÿtch
(...)

244 
	`­Ş_b¡_de¡roy
(&
u£r_Œ“
);

245 
	`­Ş_b¡_de¡roy
(&
rŞe_Œ“
);

246 
	`­Ş_b¡_de¡roy
(&
ty³_Œ“
);

247 
	`­Ş_b¡_de¡roy
(&
¿nge_Œ“
);

248 
	`­Ş_b¡_de¡roy
(&
·th_Œ“
);

249 
	`­Ş_b¡_de¡roy
(&
dev_Œ“
);

250 
	`­Ş_b¡_de¡roy
(&
cÚ‹xt_Œ“
);

251 
throw
;

253 
	}
}

255 
£fs_hªdË_deçuÉ_ÿÎback
(*
¬g
 
__©Œibu‹__
 ((
unu£d
)),

256 cÚ¡ 
£fs_fşi¡
 * 
f


257 
__©Œibu‹__
 ((
unu£d
)), 
Ëv–
, cÚ¡ *
fmt
, 
va_li¡
 
va_¬gs
)

259 
	gËv–
)

261 
	gSEFS_MSG_INFO
:

266 
	gSEFS_MSG_WARN
:

268 
årštf
(
¡d”r
, "WARNING: ");

271 
	gSEFS_MSG_ERR
:

274 
årštf
(
¡d”r
, "ERROR: ");

278 
vårštf
(
¡d”r
, 
fmt
, 
va_¬gs
);

279 
årštf
(
¡d”r
, "\n");

282 
£fs_cÚ‹xt_node
 *
	g£fs_fşi¡
::
	$g‘CÚ‹xt
(cÚ¡ *
u£r
, cÚ¡ *
rŞe
, cÚ¡ *
ty³
,

283 cÚ¡ *
¿nge
è
	$throw
(
¡d
::
bad_®loc
)

285 *
u
 = 
NULL
, *
r
 = NULL, *
t
 = NULL, *
m
 = NULL;

286 ià((
u
 = 
	`¡rdup
(
u£r
)è=ğ
NULL
)

288 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

289 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

291 ià(
	`­Ş_b¡_š£¹_ªd_g‘
(
u£r_Œ“
, (**)&
u
, 
NULL
) < 0)

293 
	`ä“
(
u
);

294 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

295 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

298 ià((
r
 = 
	`¡rdup
(
rŞe
)è=ğ
NULL
)

300 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

301 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

303 ià(
	`­Ş_b¡_š£¹_ªd_g‘
(
rŞe_Œ“
, (**)&
r
, 
NULL
) < 0)

305 
	`ä“
(
r
);

306 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

307 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

310 ià((
t
 = 
	`¡rdup
(
ty³
)è=ğ
NULL
)

312 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

313 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

315 ià(
	`­Ş_b¡_š£¹_ªd_g‘
(
ty³_Œ“
, (**)&
t
, 
NULL
) < 0)

317 
	`ä“
(
t
);

318 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

319 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

322 ià(
¿nge
 =ğ
NULL
 ||„ange[0] == '\0')

324 
m
 = 
NULL
;

328 ià((
m
 = 
	`¡rdup
(
¿nge
)è=ğ
NULL
)

330 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

331 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

333 ià(
	`­Ş_b¡_š£¹_ªd_g‘
(
¿nge_Œ“
, (**)&
m
, 
NULL
) < 0)

335 
	`ä“
(
m
);

336 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

337 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

341 
£fs_cÚ‹xt_node
 *
node
 = 
NULL
;

342 
­Ş_cÚ‹xt_t
 *
cÚ‹xt
 = 
NULL
;

343 
Œy


345 ià((
node
 = 
¡©ic_ÿ¡
 < 
£fs_cÚ‹xt_node
 * >(
	`ÿÎoc
(1, (*node)))è=ğ
NULL
)

347 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

348 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

351 
node
->
u£r
 = 
u
;

352 
node
->
rŞe
 = 
r
;

353 
node
->
ty³
 = 
t
;

354 
node
->
¿nge
 = 
m
;

356 *
v
;

357 ià(
	`­Ş_b¡_g‘_–em’t
(
cÚ‹xt_Œ“
, 
node
, 
NULL
, &
v
) == 0)

360 
	`fşi¡_£fs_cÚ‹xt_node_ä“
(
node
);

361  
¡©ic_ÿ¡
 < 
£fs_cÚ‹xt_node
 *>(
v
);

364 
­Ş_mls_¿nge_t
 *
­Ş_¿nge
 = 
NULL
;

365 ià(
m
 !ğ
NULL
)

367 ià((
­Ş_¿nge
 = 
	`­Ş_mls_¿nge_ü—‹_äom_l™”®
(
m
)è=ğ
NULL
)

369 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

370 
throw
 
¡d
::
	`bad_®loc
();

374 ià((
cÚ‹xt
 = 
	`­Ş_cÚ‹xt_ü—‹
()è=ğ
NULL
)

376 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

377 
	`­Ş_mls_¿nge_de¡roy
(&
­Ş_¿nge
);

378 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

380 ià(
	`­Ş_cÚ‹xt_£t_u£r
(
NULL
, 
cÚ‹xt
, 
u
) < 0 ||

381 
	`­Ş_cÚ‹xt_£t_rŞe
(
NULL
, 
cÚ‹xt
, 
r
è< 0 || 
	`­Ş_cÚ‹xt_£t_ty³
(NULL, cÚ‹xt, 
t
) < 0 ||

382 
	`­Ş_cÚ‹xt_£t_¿nge
(
NULL
, 
cÚ‹xt
, 
­Ş_¿nge
) < 0)

384 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

385 
	`­Ş_mls_¿nge_de¡roy
(&
­Ş_¿nge
);

386 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

389 
node
->
cÚ‹xt
 = context;

390 
cÚ‹xt
 = 
NULL
;

392 ià(
	`fşi¡_£fs_node_make_¡ršg
(
node
) < 0)

394 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

395 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

398 ià(
	`­Ş_b¡_š£¹
(
cÚ‹xt_Œ“
, 
node
, 
NULL
) != 0)

400 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

401 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

404 
	`ÿtch
(...)

406 
	`fşi¡_£fs_cÚ‹xt_node_ä“
(
node
);

407 
	`­Ş_cÚ‹xt_de¡roy
(&
cÚ‹xt
);

408 
throw
;

411  
node
;

412 
	}
}

414 
£fs_cÚ‹xt_node
 *
	g£fs_fşi¡
::
	$g‘CÚ‹xt
(cÚ¡ 
£cur™y_cÚ‹xt_t
 
scÚ
è
	$throw
(
¡d
::
bad_®loc
)

416 
cÚ‹xt_t
 
cÚ
;

417 ià((
cÚ
 = 
	`cÚ‹xt_Ãw
(
scÚ
)) == 0)

419 
throw
 
¡d
::
	`bad_®loc
();

421 cÚ¡ *
u£r
 = 
	`cÚ‹xt_u£r_g‘
(
cÚ
);

422 cÚ¡ *
rŞe
 = 
	`cÚ‹xt_rŞe_g‘
(
cÚ
);

423 cÚ¡ *
ty³
 = 
	`cÚ‹xt_ty³_g‘
(
cÚ
);

424 cÚ¡ *
¿nge
 = 
	`cÚ‹xt_¿nge_g‘
(
cÚ
);

425 
£fs_cÚ‹xt_node
 *
node
 = 
NULL
;

426 
Œy


428 
node
 = 
	`g‘CÚ‹xt
(
u£r
, 
rŞe
, 
ty³
, 
¿nge
);

430 
	`ÿtch
(...)

432 
	`cÚ‹xt_ä“
(
cÚ
);

433 
throw
;

435 
	`cÚ‹xt_ä“
(
cÚ
);

436  
node
;

437 
	}
}

441 
	g£fs_fşi¡
::
	$hªdËMsg
(
Ëv–
, cÚ¡ *
fmt
, 
va_li¡
 
va_¬gs
) const

443 ià(
_ÿÎback
 =ğ
NULL
)

445 
	`£fs_hªdË_deçuÉ_ÿÎback
(
NULL
, 
this
, 
Ëv–
, 
fmt
, 
va_¬gs
);

449 
	`_ÿÎback
(
_v¬g
, 
this
, 
Ëv–
, 
fmt
, 
va_¬gs
);

451 
	}
}

455 
	$£fs_fşi¡_hªdËMsg
(cÚ¡ 
£fs_fşi¡
 *
fşi¡
, 
Ëv–
, cÚ¡ *
fmt
, ...)

457 
va_li¡
 
­
;

458 
	`va_¡¬t
(
­
, 
fmt
);

459 ià(
fşi¡
 =ğ
NULL
)

461 
	`£fs_hªdË_deçuÉ_ÿÎback
(
NULL
, NULL, 
Ëv–
, 
fmt
, 
­
);

465 
fşi¡
->
	`hªdËMsg
(
Ëv–
, 
fmt
, 
­
);

467 
	`va_’d
(
­
);

468 
	}
}

470 
	$£fs_fşi¡_de¡roy
(
£fs_fşi¡_t
 ** 
fşi¡
)

472 ià(
fşi¡
 !ğ
NULL
 && *fclist != NULL)

474 
	`d–‘e
(*
fşi¡
);

475 *
fşi¡
 = 
NULL
;

477 
	}
}

479 
	$£fs_fşi¡_run_qu”y_m­
(
£fs_fşi¡_t
 * 
fşi¡
, 
£fs_qu”y_t
 * 
qu”y
, 
£fs_fşi¡_m­_â_t
 
â
, *
d©a
)

481 ià(
fşi¡
 =ğ
NULL
)

483 
	`SEFS_ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
EINVAL
));

484 
”ºo
 = 
EINVAL
;

487 
»tv®
;

488 
Œy


490 
»tv®
 = 
fşi¡
->
	`runQu”yM­
(
qu”y
, 
â
, 
d©a
);

492 
	`ÿtch
(...)

496  
»tv®
;

497 
	}
}

499 
­Ş_veùÜ_t
 *
	$£fs_fşi¡_run_qu”y
(
£fs_fşi¡_t
 * 
fşi¡
, 
£fs_qu”y_t
 * 
qu”y
)

501 ià(
fşi¡
 =ğ
NULL
)

503 
	`SEFS_ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
EINVAL
));

504 
”ºo
 = 
EINVAL
;

505  
NULL
;

507 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

508 
Œy


510 
v
 = 
fşi¡
->
	`runQu”y
(
qu”y
);

512 
	`ÿtch
(...)

514  
NULL
;

516  
v
;

517 
	}
}

519 
boŞ
 
	$£fs_fşi¡_g‘_is_mls
(cÚ¡ 
£fs_fşi¡_t
 * 
fşi¡
)

521 ià(
fşi¡
 =ğ
NULL
)

523 
	`SEFS_ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
EINVAL
));

524  
çl£
;

526  
fşi¡
->
	`isMLS
();

527 
	}
}

529 
	$£fs_fşi¡_assocŸ‹_pŞicy
(
£fs_fşi¡_t
 * 
fşi¡
, 
­Ş_pŞicy_t
 * 
pŞicy
)

531 ià(
fşi¡
 =ğ
NULL
)

533 
	`SEFS_ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
EINVAL
));

534 
”ºo
 = 
EINVAL
;

538 
fşi¡
->
	`assocŸ‹PŞicy
(
pŞicy
);

540 
	}
}

542 
£fs_fşi¡_ty³_e
 
	$£fs_fşi¡_g‘_fşi¡_ty³
(cÚ¡ 
£fs_fşi¡_t
 * 
fşi¡
)

544 ià(
fşi¡
 =ğ
NULL
)

546 
	`SEFS_ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
EINVAL
));

547  
SEFS_FCLIST_TYPE_NONE
;

549  
fşi¡
->
	`fşi¡_ty³
();

550 
	}
}

564 cÚ¡ 
qpŞ_ty³_t
 *
	$qu”y_g‘_ty³
(
­Ş_pŞicy_t
 * 
p
, cÚ¡ *
ty³_Çme
)

566 
i§lŸs
;

567 cÚ¡ 
qpŞ_ty³_t
 *
ty³
 = 
NULL
;

568 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
p
);

569 ià(
	`qpŞ_pŞicy_g‘_ty³_by_Çme
(
q
, 
ty³_Çme
, &
ty³
è< 0 || 
	`qpŞ_ty³_g‘_i§lŸs
(q,y³, &
i§lŸs
) < 0)

571  
NULL
;

573 ià(
i§lŸs
)

575 cÚ¡ *
´im¬y_Çme
;

576 ià(
	`qpŞ_ty³_g‘_Çme
(
q
, 
ty³
, &
´im¬y_Çme
è< 0 || 
	`qpŞ_pŞicy_g‘_ty³_by_Çme
(q,…rimary_name, &type) < 0)

578  
NULL
;

581  
ty³
;

582 
	}
}

595 
	$qu”y_­³nd_ty³
(
­Ş_pŞicy_t
 * 
p
, 
­Ş_veùÜ_t
 * 
v
, cÚ¡ 
qpŞ_ty³_t
 * 
ty³
)

597 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
p
);

598 
i§lŸs
;

599 cÚ¡ 
qpŞ_ty³_t
 *
»®_ty³
 = 
ty³
;

600 cÚ¡ *
Çme
;

601 ià(
	`qpŞ_ty³_g‘_i§‰r
(
q
, 
ty³
, &
i§lŸs
) < 0)

605 ià(
i§lŸs
)

607 ià(
	`qpŞ_ty³_g‘_Çme
(
q
, 
ty³
, &
Çme
è< 0 || 
	`qpŞ_pŞicy_g‘_ty³_by_Çme
(q,‚ame, &
»®_ty³
) < 0)

612 ià(
	`qpŞ_ty³_g‘_Çme
(
q
, 
ty³
, &
Çme
) < 0 ||

613 
	`­Ş_veùÜ_­³nd
(
v
, 
cÚ¡_ÿ¡
 < *>(
¡©ic_ÿ¡
 < cÚ¡ *>(
Çme
))) < 0)

618 
	}
}

620 
­Ş_veùÜ_t
 *
	$qu”y_ü—‹_ÿndid©e_ty³
(
­Ş_pŞicy_t
 * 
pŞicy
, cÚ¡ *
¡r
, cÚ¡ 
»gex_t
 * 
»gex
, cÚ¡ 
boŞ
 
»gex_æag
,

621 cÚ¡ 
boŞ
 
šdœeù
)

623 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicy
);

624 
­Ş_veùÜ_t
 *
li¡
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
);

625 cÚ¡ 
qpŞ_ty³_t
 *
ty³
;

626 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
, *
®Ÿs_™”
 = NULL;

627 cÚ¡ *
ty³_Çme
;

628 
boŞ
 
compv®
;

630 
Œy


632 ià(
li¡
 =ğ
NULL
)

634 
throw
 
Ãw
 
¡d
::
	`bad_®loc
();

637 ià(!
»gex_æag
 && (
ty³
 = 
	`qu”y_g‘_ty³
(
pŞicy
, 
¡r
)è!ğ
NULL
)

639 ià(
	`qu”y_­³nd_ty³
(
pŞicy
, 
li¡
, 
ty³
) < 0)

641 
throw
 
Ãw
 
¡d
::
	`bad_®loc
();

645 ià(
»gex_æag
)

647 ià(
	`qpŞ_pŞicy_g‘_ty³_™”
(
q
, &
™”
) < 0)

649 
throw
 
Ãw
 
¡d
::
	`bad_®loc
();

651 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter))

653 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
ty³
è< 0 || 
	`qpŞ_ty³_g‘_Çme
(
q
,y³, &
ty³_Çme
) < 0)

655 
throw
 
Ãw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

657 
compv®
 = 
	`qu”y_¡r_com·»
(
ty³_Çme
, 
¡r
, 
»gex
, 
Œue
);

658 ià(
compv®
)

660 ià(
	`qu”y_­³nd_ty³
(
pŞicy
, 
li¡
, 
ty³
) < 0)

662 
throw
 
Ãw
 
¡d
::
	`bad_®loc
();

666 ià(
	`qpŞ_ty³_g‘_®Ÿs_™”
(
q
, 
ty³
, &
®Ÿs_™”
) < 0)

668 
throw
 
Ãw
 
¡d
::
	`bad_®loc
();

670 ; !
	`qpŞ_™”©Ü_’d
(
®Ÿs_™”
); 
	`qpŞ_™”©Ü_Ãxt
(alias_iter))

672 ià(
	`qpŞ_™”©Ü_g‘_™em
(
®Ÿs_™”
, (**)&
ty³_Çme
) < 0)

674 
throw
 
Ãw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

676 
compv®
 = 
	`qu”y_¡r_com·»
(
ty³_Çme
, 
¡r
, 
»gex
, 
Œue
);

677 ià(
compv®
)

679 ià(
	`qu”y_­³nd_ty³
(
pŞicy
, 
li¡
, 
ty³
))

681 
throw
 
Ãw
 
¡d
::
	`bad_®loc
();

686 
	`qpŞ_™”©Ü_de¡roy
(&
®Ÿs_™”
);

688 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

691 ià(
šdœeù
)

693 
size_t
 
Üig_veùÜ_size
 = 
	`­Ş_veùÜ_g‘_size
(
li¡
);

694 
i§‰r
, 
i§lŸs
;

695 
size_t
 
i
 = 0; i < 
Üig_veùÜ_size
; i++)

697 
ty³_Çme
 = 
¡©ic_ÿ¡
 < *>(
	`­Ş_veùÜ_g‘_–em’t
(
li¡
, 
i
));

698 
	`qpŞ_pŞicy_g‘_ty³_by_Çme
(
q
, 
ty³_Çme
, &
ty³
);

699 
	`as£¹
(
ty³
 !ğ
NULL
);

700 ià(
	`qpŞ_ty³_g‘_i§lŸs
(
q
, 
ty³
, &
i§lŸs
è< 0 || 
	`qpŞ_ty³_g‘_i§‰r
(q,y³, &
i§‰r
) < 0)

702 
throw
 
Ãw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

704 ià(
i§lŸs
)

708 ià((
i§‰r
 &&

709 
	`qpŞ_ty³_g‘_ty³_™”
(
q
, 
ty³
, &
™”
) < 0) ||

710 (!
i§‰r
 && 
	`qpŞ_ty³_g‘_©Œ_™”
(
q
, 
ty³
, &
™”
) < 0))

712 
throw
 
Ãw
 
¡d
::
	`bad_®loc
();

714 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter))

716 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
ty³
) < 0)

718 
throw
 
Ãw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

720 ià(
	`qu”y_­³nd_ty³
(
pŞicy
, 
li¡
, 
ty³
))

722 
throw
 
Ãw
 
¡d
::
	`bad_®loc
();

725 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

729 
	`­Ş_veùÜ_sÜt_uniquify
(
li¡
, 
NULL
, NULL);

731 
	`ÿtch
(...)

733 
	`­Ş_veùÜ_de¡roy
(&
li¡
);

735 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

736 
	`qpŞ_™”©Ü_de¡roy
(&
®Ÿs_™”
);

737  
li¡
;

738 
	}
}

740 
boŞ
 
	$qu”y_¡r_com·»
(cÚ¡ *
rg‘
, cÚ¡ *
¡r
, cÚ¡ 
»gex_t
 * 
»gex
, cÚ¡ 
boŞ
 
»gex_æag
)

742 ià(
¡r
 =ğ
NULL
 || str[0] == '\0')

744  
Œue
;

746 ià(
rg‘
 =ğ
NULL
 ||arget[0] == '\0')

748  
çl£
;

750 ià(
»gex_æag
)

752 ià(
	`»gexec
(
»gex
, 
rg‘
, 0, 
NULL
, 0) == 0)

754  
Œue
;

756  
çl£
;

760 ià(
	`¡rcmp
(
rg‘
, 
¡r
) == 0)

762  
Œue
;

764  
çl£
;

766 
	}
}

	@libsefs/src/filesystem.cc

25 
	~<cÚfig.h
>

27 
	~"£fs_š‹º®.hh
"

28 
	~"Ãw_áw.h
"

30 
	~<£fs/’Œy.hh
>

31 
	~<£fs/fesy¡em.hh
>

32 
	~<­Ş/ut.h
>

33 
	~<£lšux/cÚ‹xt.h
>

34 
	~<£lšux/£lšux.h
>

35 
	~<as£¹.h
>

36 
	~<”ºo.h
>

37 
	~<mÁ’t.h
>

38 
	~<»gex.h
>

39 
	~<¡dio.h
>

40 
	~<¡ršg.h
>

41 
	~<uni¡d.h
>

42 
	~<sys/¡©.h
>

43 
	~<sys/ty³s.h
>

45 
	$lg‘fecÚ_¿w
(cÚ¡ *, 
£cur™y_cÚ‹xt_t
 *è
	`__©Œibu‹__
 ((
w—k
));

53 
	$fesy¡em_lg‘fecÚ
(cÚ¡ *
·th
, 
£cur™y_cÚ‹xt_t
 * 
cÚ‹xt
)

55 ià(
lg‘fecÚ_¿w
 !ğ
NULL
)

57  
	`lg‘fecÚ_¿w
(
·th
, 
cÚ‹xt
);

61  
	`lg‘fecÚ
(
·th
, 
cÚ‹xt
);

63 
	}
}

86 
­Ş_veùÜ_t
 *
	$fesy¡em_fšd_mouÁ_pošts
(cÚ¡ *
dœ
è
	$throw
(
¡d
::
bad_®loc
, std::
ruÁime_”rÜ
)

88 *
dœdup
 = 
NULL
;

89 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

90 
FILE
 *
mb
 = 
NULL
;

91 
mÁ’t
 *
’Œy
;

93 
Œy


95 ià((
dœdup
 = 
	`¡rdup
(
dœ
)è=ğ
NULL
)

97 
throw
 
¡d
::
	`bad_®loc
();

99 
size_t
 
Ën
 = 
	`¡¾’
(
dœdup
);

100 ià(
Ën
 > 1 && 
dœdup
[len - 1] == '/')

102 
dœdup
[
Ën
 - 1] = '\0';

104 ià((
v
 = 
	`­Ş_veùÜ_ü—‹
(
ä“
)è=ğ
NULL
)

106 
throw
 
¡d
::
	`bad_®loc
();

108 ià((
mb
 = 
	`fİ’
("/‘c/mb", "r")è=ğ
NULL
)

110 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

113 (
’Œy
 = 
	`g‘mÁ’t
(
mb
)è!ğ
NULL
)

115 ià(
	`¡r¡r
(
’Œy
->
mÁ_dœ
, 
dœ
) !=ƒntry->mnt_dir)

119 ià(
	`¡rcmp
(
’Œy
->
mÁ_dœ
, 
dœdup
) == 0)

123 ià(
	`¡r¡r
(
’Œy
->
mÁ_İts
, "bšd"è!ğ
NULL
)

125 *
s
 = 
	`¡rdup
(
’Œy
->
mÁ_dœ
);

126 ià(
s
 =ğ
NULL
)

128 
throw
 
¡d
::
	`bad_®loc
();

130 ià(
	`­Ş_veùÜ_­³nd
(
v
, 
s
) < 0)

132 
	`ä“
(
s
);

133 
throw
 
¡d
::
	`bad_®loc
();

139 
	`ÿtch
(...)

141 
	`ä“
(
dœdup
);

142 
	`­Ş_veùÜ_de¡roy
(&
v
);

143 ià(
mb
 !ğ
NULL
)

145 
	`fşo£
(
mb
);

147 
throw
;

149 
	`ä“
(
dœdup
);

150 
	`fşo£
(
mb
);

151  
v
;

152 
	}
}

158 
	g£fs_fesy¡em
::
	$£fs_fesy¡em
(cÚ¡ *
Ãw_roÙ
, 
£fs_ÿÎback_â_t
 
msg_ÿÎback
, *
v¬g
)
	$throw
(
¡d
::
bad_®loc
, std::
šv®id_¬gum’t
, std::
ruÁime_”rÜ
):
	$£fs_fşi¡
(
SEFS_FCLIST_TYPE_FILESYSTEM
,

159 
msg_ÿÎback
,

160 
v¬g
)

162 ià(
Ãw_roÙ
 =ğ
NULL
)

164 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
EINVAL
));

165 
”ºo
 = 
EINVAL
;

166 
throw
 
¡d
::
	`šv®id_¬gum’t
(
	`¡»¼Ü
(
EINVAL
));

168 
_roÙ
 = 
NULL
;

169 
_mls
 = 
çl£
;

170 
Œy


173 
¡©64
 
sb
;

174 ià(
	`¡©64
(
Ãw_roÙ
, &
sb
è!ğ0 && !
	`S_ISDIR
(sb.
¡_mode
))

176 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
EINVAL
));

177 
”ºo
 = 
EINVAL
;

178 
throw
 
¡d
::
	`šv®id_¬gum’t
(
	`¡»¼Ü
(
EINVAL
));

182 
£cur™y_cÚ‹xt_t
 
scÚ
;

183 ià(
	`fesy¡em_lg‘fecÚ
(
Ãw_roÙ
, &
scÚ
) < 0)

185 
	`SEFS_ERR
(
this
, "Could‚Ù„—d SELšux fcÚ‹xˆfÜ %s.", 
Ãw_roÙ
);

186 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

188 
cÚ‹xt_t
 
cÚ
;

189 ià((
cÚ
 = 
	`cÚ‹xt_Ãw
(
scÚ
)) == 0)

191 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

192 
	`ä“cÚ
(
scÚ
);

193 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

195 
	`ä“cÚ
(
scÚ
);

196 cÚ¡ *
¿nge
 = 
	`cÚ‹xt_¿nge_g‘
(
cÚ
);

197 ià(
¿nge
 !ğ
NULL
 &&„ange[0] != '\0')

199 
_mls
 = 
Œue
;

201 
	`cÚ‹xt_ä“
(
cÚ
);

203 ià((
_roÙ
 = 
	`¡rdup
(
Ãw_roÙ
)è=ğ
NULL
)

205 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

206 
throw
 
¡d
::
	`bad_®loc
();

209 
	`ÿtch
(...)

211 
	`ä“
(
_roÙ
);

212 
throw
;

214 
	}
}

216 
	g£fs_fesy¡em
::~
	$£fs_fesy¡em
()

218 
	`ä“
(
_roÙ
);

219 
	}
}

221 
	sfesy¡em_áw_¡ruù


223 
£fs_fesy¡em
 *
	mfs
;

224 
£fs_qu”y
 *
	mqu”y
;

225 
­Ş_veùÜ_t
 *
	mdev_m­
;

226 
­Ş_veùÜ_t
 *
	mty³_li¡
;

227 
­Ş_mls_¿nge_t
 *
	m¿nge
;

228 
£fs_fşi¡_m­_â_t
 
	mâ
;

229 *
	md©a
;

230 
boŞ
 
	mabÜ‹d
;

231 
	m»tv®
;

236 
šlše
 
£fs_cÚ‹xt_node
 *
	$fesy¡em_g‘_cÚ‹xt
(
£fs_fesy¡em
 * 
fs
, 
£cur™y_cÚ‹xt_t
 
scÚ
è
	$throw
(
¡d
::
bad_®loc
)

238  
fs
->
	`g‘CÚ‹xt
(
scÚ
);

239 
	}
}

241 
šlše
 
£fs_’Œy
 *
	$fesy¡em_g‘_’Œy
(
£fs_fesy¡em
 * 
fs
, cÚ¡ 
£fs_cÚ‹xt_node
 * 
node
, 
ušt32_t
 
objCÏss
,

242 cÚ¡ *
·th
, 
šo64_t
 
šo
, cÚ¡ *
dev_Çme
)
	$throw
(
¡d
::
bad_®loc
)

244  
fs
->
	`g‘EÁry
(
node
, 
objCÏss
, 
·th
, 
šo
, 
dev_Çme
);

245 
	}
}

247 
šlše
 
boŞ
 
	$fesy¡em_is_qu”y_m©ch
(
£fs_fesy¡em
 * 
fs
, cÚ¡ 
£fs_qu”y
 * 
qu”y
, cÚ¡ *
·th
, cÚ¡ *
dev
,

248 cÚ¡ 
¡©64
 * 
sb
, 
­Ş_veùÜ_t
 * 
ty³_li¡
,

249 
­Ş_mls_¿nge_t
 * 
¿nge
)
	$throw
(
¡d
::
ruÁime_”rÜ
)

251  
fs
->
	`isQu”yM©ch
(
qu”y
, 
·th
, 
dev
, 
sb
, 
ty³_li¡
, 
¿nge
);

252 
	}
}

254 
ušt32_t
 
	$fesy¡em_¡©_to_objşass
(cÚ¡ 
¡©64
 *
sb
)

256 ià(
	`S_ISREG
(
sb
->
¡_mode
))

258  
QPOL_CLASS_FILE
;

260 ià(
	`S_ISDIR
(
sb
->
¡_mode
))

262  
QPOL_CLASS_DIR
;

264 ià(
	`S_ISCHR
(
sb
->
¡_mode
))

266  
QPOL_CLASS_CHR_FILE
;

268 ià(
	`S_ISBLK
(
sb
->
¡_mode
))

270  
QPOL_CLASS_BLK_FILE
;

272 ià(
	`S_ISFIFO
(
sb
->
¡_mode
))

274  
QPOL_CLASS_FIFO_FILE
;

276 ià(
	`S_ISLNK
(
sb
->
¡_mode
))

278  
QPOL_CLASS_LNK_FILE
;

280 ià(
	`S_ISSOCK
(
sb
->
¡_mode
))

282  
QPOL_CLASS_SOCK_FILE
;

284 
	`as£¹
(0);

286 
	}
}

288 
	sfesy¡em_dev


290 
dev_t
 
	mdev
;

291 *
	mdev_Çme
;

294 
fesy¡em_dev_cmp
(cÚ¡ *
a
, cÚ¡ *
b
 
__©Œibu‹__
 ((
unu£d
)), *
¬g
)

296 cÚ¡ 
fesy¡em_dev
 *
	gd1
 = 
¡©ic_ÿ¡
 < cÚ¡ fesy¡em_dev *>(
a
);

297 
dev_t
 *
	gd2
 = 
¡©ic_ÿ¡
 < dev_ˆ* >(
¬g
);

298 ià(
	gd1
->
	gdev
 < *
	gd2
)

302 ià(
	gd1
->
	gdev
 > *
	gd2
)

309 
fesy¡em_áw_hªdËr
(cÚ¡ *
å©h
, cÚ¡ 
¡©64
 *
sb
, 
ty³æag


310 
__©Œibu‹__
 ((
unu£d
)), 
FTW
 *
áwbuf
 __©Œibu‹__ ((unu£d)), *
d©a
)

312 
fesy¡em_áw_¡ruù
 *
	gs
 = 
¡©ic_ÿ¡
 < fesy¡em_áw_¡ruù *>(
d©a
);

314 
size_t
 
	gi
;

315 *
	gdev_num
 = 
cÚ¡_ÿ¡
 < *>(
¡©ic_ÿ¡
 < cÚ¡ *>(&(
sb
->
¡_dev
)));

316 
	grc
 = 
­Ş_veùÜ_g‘_šdex
(
s
->
dev_m­
, 
NULL
, 
fesy¡em_dev_cmp
, 
dev_num
, &
i
);

317 cÚ¡ *
	gdev
 = "<unknown>";

318 ià(
	grc
 == 0)

322 
fesy¡em_dev
 *
d
 = 
¡©ic_ÿ¡
 < fesy¡em_dev *>(
­Ş_veùÜ_g‘_–em’t
(
s
->
dev_m­
, 
i
));

323 
	gdev
 = 
d
->
dev_Çme
;

327 
SEFS_WARN
(
s
->
fs
, "UnknowÀdeviû fÜ %s.", 
å©h
);

329 
	gŒy


331 ià(!
fesy¡em_is_qu”y_m©ch
(
s
->
fs
, s->
qu”y
, 
å©h
, 
dev
, 
sb
, s->
ty³_li¡
, s->
¿nge
))

336 
ÿtch
(...)

341 
£cur™y_cÚ‹xt_t
 
	gscÚ
;

342 ià(
fesy¡em_lg‘fecÚ
(
å©h
, &
scÚ
) < 0)

344 
SEFS_ERR
(
s
->
fs
, "Could‚Ù„—d SELšux fcÚ‹xˆfÜ %s.", 
å©h
);

347 
£fs_cÚ‹xt_node
 *
	gnode
 = 
NULL
;

348 
	gŒy


350 
	gnode
 = 
fesy¡em_g‘_cÚ‹xt
(
s
->
fs
, 
scÚ
);

352 
ÿtch
(...)

354 
ä“cÚ
(
scÚ
);

357 
ä“cÚ
(
scÚ
);

359 
ušt32_t
 
	gobjCÏss
 = 
fesy¡em_¡©_to_objşass
(
sb
);

361 
£fs_’Œy
 *
	g’Œy
 = 
NULL
;

362 
	gŒy


364 
	g’Œy
 = 
fesy¡em_g‘_’Œy
(
s
->
fs
, 
node
, 
objCÏss
, 
å©h
, 
sb
->
¡_šo
, 
dev
);

366 
ÿtch
(...)

372 
	gs
->
	g»tv®
 = 
s
->
â
(s->
fs
, 
’Œy
, s->
d©a
);

373 
d–‘e
 
	g’Œy
;

374 ià(
	gs
->
	g»tv®
 < 0)

376 
	gs
->
	gabÜ‹d
 = 
Œue
;

377  
	gs
->
	g»tv®
;

383 
	g£fs_fesy¡em
::
	$runQu”yM­
(
£fs_qu”y
 * 
qu”y
, 
£fs_fşi¡_m­_â_t
 
â
, *
d©a
è
	$throw
(
¡d
::
ruÁime_”rÜ
,

384 
¡d
::
šv®id_¬gum’t
)

386 
fesy¡em_áw_¡ruù
 
s
;

387 
s
.
dev_m­
 = 
NULL
;

388 
s
.
ty³_li¡
 = 
NULL
;

389 
s
.
¿nge
 = 
NULL
;

390 
Œy


392 
s
.
dev_m­
 = 
	`budDevM­
();

393 ià(
qu”y
 !ğ
NULL
)

395 
qu”y
->
	`compe
();

396 ià(
pŞicy
 !ğ
NULL
)

398 ià(
qu”y
->
_ty³
 !ğ
NULL
 && qu”y->
_šdœeù
 &&

399 (
s
.
ty³_li¡
 =

400 
	`qu”y_ü—‹_ÿndid©e_ty³
(
pŞicy
, 
qu”y
->
_ty³
, qu”y->
_»ty³
, qu”y->
_»gex
,

401 
qu”y
->
_šdœeù
)è=ğ
NULL
)

403 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

404 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

406 ià(
qu”y
->
_¿nge
 !ğ
NULL
 && qu”y->
_¿ngeM©ch
 != 0 &&

407 (
s
.
¿nge
 = 
	`­Ş_mls_¿nge_ü—‹_äom_¡ršg
(
pŞicy
, 
qu”y
->
_¿nge
)è=ğ
NULL
)

409 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

410 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

415 
	`ÿtch
(...)

417 
	`­Ş_veùÜ_de¡roy
(&
s
.
dev_m­
);

418 
	`­Ş_veùÜ_de¡roy
(&
s
.
ty³_li¡
);

419 
	`­Ş_mls_¿nge_de¡roy
(&
s
.
¿nge
);

420 
throw
;

422 
s
.
fs
 = 
this
;

423 
s
.
qu”y
 = query;

424 
s
.
â
 = fn;

425 
s
.
d©a
 = data;

426 
s
.
abÜ‹d
 = 
çl£
;

427 
s
.
»tv®
 = 0;

429 
»tv®
 = 
	`Ãw_náw64
(
_roÙ
, 
fesy¡em_áw_hªdËr
, 1024, 0, &
s
);

430 
	`­Ş_veùÜ_de¡roy
(&
s
.
dev_m­
);

431 
	`­Ş_veùÜ_de¡roy
(&
s
.
ty³_li¡
);

432 
	`­Ş_mls_¿nge_de¡roy
(&
s
.
¿nge
);

433 ià(
»tv®
 !ğ0 && !
s
.
abÜ‹d
)

437  
»tv®
;

439  
s
.
»tv®
;

440 
	}
}

442 
boŞ
 
	g£fs_fesy¡em
::
	$isMLS
() const

444  
_mls
;

445 
	}
}

447 cÚ¡ *
	g£fs_fesy¡em
::
	$roÙ
() const

449  
_roÙ
;

450 
	}
}

454 
	$fesy¡em_dev_ä“
(*
–em
)

456 ià(
–em
 !ğ
NULL
)

458 
fesy¡em_dev
 *
d
 = 
¡©ic_ÿ¡
 < fesy¡em_dev *>(
–em
);

461 
	`ä“
(
d
);

463 
	}
}

465 cÚ¡ *
	g£fs_fesy¡em
::
	$g‘DevName
(cÚ¡ 
dev_t
 
dev
è
	$throw
(
¡d
::
ruÁime_”rÜ
)

467 
­Ş_veùÜ_t
 *
dev_m­
 = 
	`budDevM­
();

468 
size_t
 
i
;

469 *
devp
 = 
cÚ¡_ÿ¡
 < 
dev_t
 * >(&
dev
);

470 
rc
 = 
	`­Ş_veùÜ_g‘_šdex
(
dev_m­
, 
NULL
, 
fesy¡em_dev_cmp
, 
devp
, &
i
);

471 ià(
rc
 < 0)

473 
	`­Ş_veùÜ_de¡roy
(&
dev_m­
);

474  
NULL
;

476 
fesy¡em_dev
 *
d
 = 
¡©ic_ÿ¡
 < fesy¡em_dev *>(
	`­Ş_veùÜ_g‘_–em’t
(
dev_m­
, 
i
));

477 cÚ¡ *
dev_Çme
 = 
d
->dev_name;

478 
	`­Ş_veùÜ_de¡roy
(&
dev_m­
);

479  
dev_Çme
;

480 
	}
}

492 
­Ş_veùÜ_t
 *
	g£fs_fesy¡em
::
	$budDevM­
()
	$throw
(
¡d
::
ruÁime_”rÜ
)

494 
­Ş_veùÜ_t
 *
dev_m­
;

495 ià((
dev_m­
 = 
	`­Ş_veùÜ_ü—‹
(
fesy¡em_dev_ä“
)è=ğ
NULL
)

497 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

498 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

500 
FILE
 *
f
 = 
NULL
;

501 
Œy


503 ià((
f
 = 
	`fİ’
("/‘c/mb", "r")è=ğ
NULL
)

505 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

506 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

508 
buf
[256];

509 
mÁ’t
 
mÁbuf
;

510 
	`g‘mÁ’t_r
(
f
, &
mÁbuf
, 
buf
, 256è!ğ
NULL
)

512 
¡©
 
sb
;

513 ià(
	`¡©
(
mÁbuf
.
mÁ_dœ
, &
sb
) == -1)

522 
fesy¡em_dev
 *
d
 = 
¡©ic_ÿ¡
 < fesy¡em_dev *>(
	`ÿÎoc
(1, (*d)));

523 ià(
d
 =ğ
NULL
)

525 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

526 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

528 ià(
	`­Ş_veùÜ_­³nd
(
dev_m­
, 
d
) < 0)

530 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

531 
	`fesy¡em_dev_ä“
(
d
);

532 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

534 
d
->
dev
 = 
sb
.
¡_dev
;

535 *
mÁ_f¢ame
 = 
	`¡rdup
(
mÁbuf
.mnt_fsname);

536 ià(
mÁ_f¢ame
 =ğ
NULL
)

538 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

539 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

541 ià(
	`­Ş_b¡_š£¹_ªd_g‘
(
dev_Œ“
, (**)&
mÁ_f¢ame
, 
NULL
) < 0)

543 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

544 
	`ä“
(
mÁ_f¢ame
);

545 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

547 
d
->
dev_Çme
 = 
mÁ_f¢ame
;

551 
	`ÿtch
(...)

553 
	`­Ş_veùÜ_de¡roy
(&
dev_m­
);

554 ià(
f
 !ğ
NULL
)

556 
	`fşo£
(
f
);

558 
throw
;

560 
	`fşo£
(
f
);

561  
dev_m­
;

562 
	}
}

564 
boŞ
 
	g£fs_fesy¡em
::
	$isQu”yM©ch
(cÚ¡ 
£fs_qu”y
 * 
qu”y
, cÚ¡ *
·th
, cÚ¡ *
dev
, cÚ¡ 
¡©64
 * 
sb
,

565 
­Ş_veùÜ_t
 * 
ty³_li¡
, 
­Ş_mls_¿nge_t
 * 
¿nge
)
	$throw
(
¡d
::
ruÁime_”rÜ
)

567 ià(
qu”y
 =ğ
NULL
)

569  
Œue
;

571 
£cur™y_cÚ‹xt_t
 
scÚ
;

572 ià(
	`fesy¡em_lg‘fecÚ
(
·th
, &
scÚ
) < 0)

574 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

575 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

577 
cÚ‹xt_t
 
cÚ
;

578 ià((
cÚ
 = 
	`cÚ‹xt_Ãw
(
scÚ
)) == 0)

580 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

581 
	`ä“cÚ
(
scÚ
);

582 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

584 
	`ä“cÚ
(
scÚ
);

586 ià(!
	`qu”y_¡r_com·»
(
	`cÚ‹xt_u£r_g‘
(
cÚ
), 
qu”y
->
_u£r
, qu”y->
_»u£r
, qu”y->
_»gex
))

588 
	`cÚ‹xt_ä“
(
cÚ
);

589  
çl£
;

591 ià(!
	`qu”y_¡r_com·»
(
	`cÚ‹xt_rŞe_g‘
(
cÚ
), 
qu”y
->
_rŞe
, qu”y->
_»rŞe
, qu”y->
_»gex
))

593 
	`cÚ‹xt_ä“
(
cÚ
);

594  
çl£
;

597 
boŞ
 
¡r_m©ched
 = 
çl£
, 
pŞ_m©ched
 = false;

598 
¡r_m©ched
 = 
	`qu”y_¡r_com·»
(
	`cÚ‹xt_ty³_g‘
(
cÚ
), 
qu”y
->
_ty³
, qu”y->
_»ty³
, qu”y->
_»gex
);

599 ià(
ty³_li¡
 !ğ
NULL
 && !
¡r_m©ched
)

601 
size_t
 
šdex
;

602 
pŞ_m©ched
 = (
	`­Ş_veùÜ_g‘_šdex
(
ty³_li¡
, 
	`cÚ‹xt_ty³_g‘
(
cÚ
), 
­Ş_¡r_¡rcmp
, 
NULL
, &
šdex
) < 0);

604 ià(!
¡r_m©ched
 && !
pŞ_m©ched
)

606 
	`cÚ‹xt_ä“
(
cÚ
);

607  
çl£
;

610 ià(
	`isMLS
())

612 ià(
¿nge
 =ğ
NULL
)

614 ià(!
	`qu”y_¡r_com·»
(
	`cÚ‹xt_¿nge_g‘
(
cÚ
), 
qu”y
->
_¿nge
, qu”y->
_»¿nge
, qu”y->
_»gex
))

616 
	`cÚ‹xt_ä“
(
cÚ
);

617  
çl£
;

622 
	`as£¹
(
pŞicy
 !ğ
NULL
);

623 
­Ş_mls_¿nge_t
 *
cÚ‹xt_¿nge
 = 
	`­Ş_mls_¿nge_ü—‹_äom_¡ršg
(
pŞicy
, 
	`cÚ‹xt_¿nge_g‘
(
cÚ
));

624 ià(
cÚ‹xt_¿nge
 =ğ
NULL
)

626 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

627 
	`cÚ‹xt_ä“
(
cÚ
);

628 
throw
 
¡d
::
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

630 
»t
;

631 
»t
 = 
	`­Ş_mls_¿nge_com·»
(
pŞicy
, 
¿nge
, 
cÚ‹xt_¿nge
, 
qu”y
->
_¿ngeM©ch
);

632 
	`­Ş_mls_¿nge_de¡roy
(&
cÚ‹xt_¿nge
);

633 ià(
»t
 <= 0)

635 
	`cÚ‹xt_ä“
(
cÚ
);

636  
çl£
;

641 
	`cÚ‹xt_ä“
(
cÚ
);

643 ià(
qu”y
->
_objşass
 !ğ0 && qu”y->_objşas !ğ
	`fesy¡em_¡©_to_objşass
(
sb
))

645  
çl£
;

648 ià(!
	`qu”y_¡r_com·»
(
·th
, 
qu”y
->
_·th
, qu”y->
_»·th
, qu”y->
_»gex
))

650  
çl£
;

653 ià(
qu”y
->
_šode
 !ğ0 && qu”y->_šod!ğ
sb
->
¡_šo
)

655  
çl£
;

658 ià(!
	`qu”y_¡r_com·»
(
dev
, 
qu”y
->
_dev
, qu”y->
_»dev
, qu”y->
_»gex
))

660  
çl£
;

663  
Œue
;

664 
	}
}

666 
£fs_’Œy
 *
	g£fs_fesy¡em
::
	$g‘EÁry
(cÚ¡ 
£fs_cÚ‹xt_node
 * 
cÚ‹xt
, 
ušt32_t
 
objeùCÏss
,

667 cÚ¡ *
·th
, 
šo64_t
 
šo
, cÚ¡ *
dev_Çme
)
	$throw
(
¡d
::
bad_®loc
)

669 *
s
 = 
	`¡rdup
(
·th
);

670 ià(
s
 =ğ
NULL
)

672 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

673 
throw
 
¡d
::
	`bad_®loc
();

675 ià(
	`­Ş_b¡_š£¹_ªd_g‘
(
·th_Œ“
, (**)&
s
, 
NULL
) < 0)

677 
	`SEFS_ERR
(
this
, "%s", 
	`¡»¼Ü
(
”ºo
));

678 
	`ä“
(
s
);

679 
throw
 
¡d
::
	`bad_®loc
();

681 
£fs_’Œy
 *
e
 = 
Ãw
 
	`£fs_’Œy
(
this
, 
cÚ‹xt
, 
objeùCÏss
, 
s
);

682 
e
->
_šode
 = 
šo
;

683 
e
->
_dev
 = 
dev_Çme
;

684  
e
;

685 
	}
}

689 
£fs_fesy¡em_t
 *
	$£fs_fesy¡em_ü—‹
(cÚ¡ *
roÙ
, 
£fs_ÿÎback_â_t
 
msg_ÿÎback
, *
v¬g
)

691 
£fs_fesy¡em_t
 *
fs
;

692 
Œy


694 
fs
 = 
Ãw
 
	`£fs_fesy¡em
(
roÙ
, 
msg_ÿÎback
, 
v¬g
);

696 
	`ÿtch
(...)

698 
”ºo
 = 
ENOMEM
;

699  
NULL
;

701  
fs
;

702 
	}
}

704 cÚ¡ *
	$£fs_fesy¡em_g‘_roÙ
(cÚ¡ 
£fs_fesy¡em_t
 * 
fs
)

706 ià(
fs
 =ğ
NULL
)

708 
	`SEFS_ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
EINVAL
));

709 
”ºo
 = 
EINVAL
;

710  
NULL
;

712  
fs
->
	`roÙ
();

713 
	}
}

715 cÚ¡ *
	$£fs_fesy¡em_g‘_dev_Çme
(
£fs_fesy¡em_t
 * 
fs
, cÚ¡ 
dev_t
 
dev
)

717 ià(
fs
 =ğ
NULL
)

719 
	`SEFS_ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
EINVAL
));

720 
”ºo
 = 
EINVAL
;

721  
NULL
;

723 cÚ¡ *
dev_Çme
 = 
NULL
;

724 
Œy


726 
dev_Çme
 = 
fs
->
	`g‘DevName
(
dev
);

728 
	`ÿtch
(...)

730  
NULL
;

732  
dev_Çme
;

733 
	}
}

	@libsefs/src/new_ftw.c

27 #ifdeà
HAVE_CONFIG_H


28 
	~<cÚfig.h
>

31 #ià
__GNUC__


32 
	#®loÿ
 
__butš_®loÿ


	)

34 #ià
HAVE_ALLOCA_H


35 
	~<®loÿ.h
>

37 #ifdeà
_AIX


38 #´agm¨
®loÿ


40 *
®loÿ
();

45 #ià
defšed
 
_LIBC


46 
	~<dœ’t.h
>

47 
	#NAMLEN
(
dœ’t
è
	`_D_EXACT_NAMLEN
 (dœ’t)

	)

49 #ià
HAVE_DIRENT_H


50 
	~<dœ’t.h
>

51 
	#NAMLEN
(
dœ’t
è
	`¡¾’
 ((dœ’t)->
d_Çme
)

	)

53 
	#dœ’t
 
dœeù


	)

54 
	#NAMLEN
(
dœ’t
è(dœ’t)->
d_ÇmËn


	)

55 #ià
HAVE_SYS_NDIR_H


56 
	~<sys/ndœ.h
>

58 #ià
HAVE_SYS_DIR_H


59 
	~<sys/dœ.h
>

61 #ià
HAVE_NDIR_H


62 
	~<ndœ.h
>

67 
	~<dœ’t.h
>

68 #undeà
NAMLEN


69 
	#NAMLEN
(
dœ’t
è
	`¡¾’
 ((dœ’t)->
d_Çme
)

	)

71 
	~<”ºo.h
>

72 
	~"Ãw_áw.h
"

73 
	~<lim™s.h
>

74 
	~<£¬ch.h
>

75 
	~<¡dlib.h
>

76 
	~<¡ršg.h
>

77 
	~<uni¡d.h
>

78 #ià
HAVE_SYS_PARAM_H
 || 
defšed
 
_LIBC


79 
	~<sys/·¿m.h
>

81 #ifdeà
_LIBC


82 
	~<šşude/sys/¡©.h
>

84 
	~<sys/¡©.h
>

87 #ià! 
_LIBC
 && !
HAVE_DECL_STPCPY
 && !
defšed
 
¡pıy


88 *
¡pıy
();

91 #ià! 
_LIBC
 && ! 
defšed
 
HAVE_MEMPCPY
 && ! defšed 
mempıy


93 
	#mempıy
(
D
, 
S
, 
N
è((*è((*è
	`memıy
 (D, S, Nè+ (N)))

	)

97 
	~<as£¹.h
>

99 #iâdeà
_LIBC


100 #undeà
__chdœ


101 
	#__chdœ
 
chdœ


	)

102 #undeà
__şo£dœ


103 
	#__şo£dœ
 
şo£dœ


	)

104 #undeà
__fchdœ


105 
	#__fchdœ
 
fchdœ


	)

106 #undeà
__g‘cwd


107 
	#__g‘cwd
(
P
, 
N
è
	`xg‘cwd
 ()

	)

108 *
xg‘cwd
();

109 #undeà
__mempıy


110 
	#__mempıy
 
mempıy


	)

111 #undeà
__İ’dœ


112 
	#__İ’dœ
 
İ’dœ


	)

113 #undeà
__»addœ64


114 
	#__»addœ64
 
»addœ


	)

115 #undeà
__¡pıy


116 
	#__¡pıy
 
¡pıy


	)

117 #undeà
__tde¡roy


118 
	#__tde¡roy
 
tde¡roy


	)

119 #undeà
__tfšd


120 
	#__tfšd
 
tfšd


	)

121 #undeà
__t£¬ch


122 
	#__t£¬ch
 
t£¬ch


	)

123 #undeà
š‹º®_funùiÚ


124 
	#š‹º®_funùiÚ


	)

125 #undeà
dœ’t64


126 
	#dœ’t64
 
dœ’t


	)

127 #undeà
MAX


128 
	#MAX
(
a
, 
b
è(×è> (bè? (aè: (b))

	)

138 #ià
_LIBC
 && ! 
LSTAT_FOLLOWS_SLASHED_SYMLINK


139 
½l_l¡©
(cÚ¡ *, 
¡©
 *);

140 #undeà
l¡©


141 
	#l¡©
(
Name
, 
St_buf
è
	`½l_l¡©
(Name, St_buf)

	)

144 #iâdeà
__£t_”ºo


145 
	#__£t_”ºo
(
V®
è
”ºo
 = (V®)

	)

149 #iâdeà
NEW_FTW_NAME


150 
	#NEW_FTW_NAME
 
Ãw_áw


	)

151 
	#NEW_NFTW_NAME
 
Ãw_náw


	)

152 
	#NEW_NFTW_OLD_NAME
 
__Ãw_Şd_náw


	)

153 
	#NEW_NFTW_NEW_NAME
 
__Ãw_Ãw_náw


	)

154 
	#INO_T
 
šo_t


	)

155 
	#STAT
 
¡©


	)

156 #ifdeà
_LIBC


157 
	#LXSTAT
 
__lx¡©


	)

158 
	#XSTAT
 
__x¡©


	)

160 
	#LXSTAT
(
V
,
f
,
sb
è
	`l¡©
 (f,sb)

	)

161 
	#XSTAT
(
V
,
f
,
sb
è
	`¡©
 (f,sb)

	)

163 
	#NEW_FTW_FUNC_T
 
__Ãw_áw_func_t


	)

164 
	#NEW_NFTW_FUNC_T
 
__Ãw_náw_func_t


	)

171 #iâdeà
PATH_MAX


172 
	#PATH_MAX
 1024

	)

175 
	sdœ_d©a


177 
DIR
 *
	m¡»am
;

178 *
	mcÚ‹Á
;

181 
	sknown_objeù


183 
dev_t
 
	mdev
;

184 
INO_T
 
	mšo
;

187 
	sÃw_áw_d©a


190 
dœ_d©a
 **
	mdœ¡»ams
;

191 
size_t
 
	maùdœ
;

192 
size_t
 
	mmaxdœ
;

195 *
	mdœbuf
;

196 
size_t
 
	mdœbufsize
;

200 
FTW
 
	máw
;

203 
	mæags
;

208 cÚ¡ *
	mcvt_¬r
;

211 
NEW_NFTW_FUNC_T
 
	mfunc
;

212 *
	md©a
;

215 
dev_t
 
	mdev
;

219 *
	mknown_objeùs
;

224 cÚ¡ 
	gnáw_¬r
[] = {

225 
FTW_F
, 
FTW_D
, 
FTW_DNR
, 
FTW_NS
, 
FTW_SL
, 
FTW_DP
, 
FTW_SLN


228 cÚ¡ 
	gáw_¬r
[] = {

229 
FTW_F
, 
FTW_D
, 
FTW_DNR
, 
FTW_NS
, FTW_F, FTW_D, FTW_NS

233 
	$áw_dœ
(
Ãw_áw_d©a
 *
d©a
, 
STAT
 *
¡
, 
dœ_d©a
 *
Şd_dœ
è
š‹º®_funùiÚ
;

235 
	$objeù_com·»
(cÚ¡ *
p1
, cÚ¡ *
p2
)

240 cÚ¡ 
known_objeù
 *
kp1
 = 
p1
, *
kp2
 = 
p2
;

241 
cmp1
;

242 
cmp1
 = (
kp1
->
šo
 > 
kp2
->ino) - (kp1->ino < kp2->ino);

243 ià(
cmp1
 != 0)

244  
cmp1
;

245  (
kp1
->
dev
 > 
kp2
->dev) - (kp1->dev < kp2->dev);

246 
	}
}

248 
šlše
 
	$add_objeù
(
Ãw_áw_d©a
 *
d©a
, 
STAT
 *
¡
)

250 
known_objeù
 *
Ãwp
 = 
	`m®loc
((known_object));

251 ià(
Ãwp
 =ğ
NULL
)

253 
Ãwp
->
dev
 = 
¡
->
¡_dev
;

254 
Ãwp
->
šo
 = 
¡
->
¡_šo
;

255  
	`__t£¬ch
(
Ãwp
, &
d©a
->
known_objeùs
, 
objeù_com·»
) ? 0 : -1;

256 
	}
}

258 
šlše
 
	$fšd_objeù
(
Ãw_áw_d©a
 *
d©a
, 
STAT
 *
¡
)

260 
known_objeù
 
obj
;

261 
obj
.
dev
 = 
¡
->
¡_dev
;

262 
obj
.
šo
 = 
¡
->
¡_šo
;

263  
	`__tfšd
(&
obj
, &
d©a
->
known_objeùs
, 
objeù_com·»
è!ğ
NULL
;

264 
	}
}

266 
šlše
 
__©Œibu‹
((
®ways_šlše
)è
	$İ’_dœ_¡»am
(
Ãw_áw_d©a
 *
d©a
, 
dœ_d©a
 *
dœp
)

268 
»suÉ
 = 0;

270 ià(
d©a
->
dœ¡»ams
[d©a->
aùdœ
] !ğ
NULL
) {

274 
size_t
 
bufsize
 = 1024;

275 *
buf
 = 
	`m®loc
(
bufsize
);

277 ià(
buf
 =ğ
NULL
)

278 
»suÉ
 = -1;

280 
DIR
 *
¡
 = 
d©a
->
dœ¡»ams
[d©a->
aùdœ
]->
¡»am
;

281 
dœ’t64
 *
d
;

282 
size_t
 
aùsize
 = 0;

284 (
d
 = 
	`__»addœ64
(
¡
)è!ğ
NULL
) {

285 
size_t
 
this_Ën
 = 
	`NAMLEN
(
d
);

286 ià(
aùsize
 + 
this_Ën
 + 2 >ğ
bufsize
) {

287 *
Ãwp
;

288 
bufsize
 +ğ
	`MAX
(1024, 2 * 
this_Ën
);

289 
Ãwp
 = (*)
	`»®loc
(
buf
, 
bufsize
);

290 ià(
Ãwp
 =ğ
NULL
) {

292 
§ve_”r
 = 
”ºo
;

293 
	`ä“
(
buf
);

294 
	`__£t_”ºo
(
§ve_”r
);

295 
»suÉ
 = -1;

298 
buf
 = 
Ãwp
;

301 *((*)
	`__mempıy
(
buf
 + 
aùsize
, 
d
->
d_Çme
, 
this_Ën
))

303 
aùsize
 +ğ
this_Ën
 + 1;

307 
buf
[
aùsize
++] = '\0';

310 
d©a
->
dœ¡»ams
[d©a->
aùdœ
]->
cÚ‹Á
 = 
	`»®loc
(
buf
, 
aùsize
);

311 ià(
d©a
->
dœ¡»ams
[d©a->
aùdœ
]->
cÚ‹Á
 =ğ
NULL
) {

312 
§ve_”r
 = 
”ºo
;

313 
	`ä“
(
buf
);

314 
	`__£t_”ºo
(
§ve_”r
);

315 
»suÉ
 = -1;

317 
	`__şo£dœ
(
¡
);

318 
d©a
->
dœ¡»ams
[d©a->
aùdœ
]->
¡»am
 = 
NULL
;

319 
d©a
->
dœ¡»ams
[d©a->
aùdœ
] = 
NULL
;

325 ià(
»suÉ
 == 0) {

326 cÚ¡ *
Çme
 = ((
d©a
->
æags
 & 
FTW_CHDIR
)

327 ? 
d©a
->
dœbuf
 + d©a->
áw
.
ba£
 : data->dirbuf);

328 
	`as£¹
(
d©a
->
dœ¡»ams
[d©a->
aùdœ
] =ğ
NULL
);

330 
dœp
->
¡»am
 = 
	`__İ’dœ
(
Çme
);

331 ià(
dœp
->
¡»am
 =ğ
NULL
)

332 
»suÉ
 = -1;

334 
dœp
->
cÚ‹Á
 = 
NULL
;

335 
d©a
->
dœ¡»ams
[d©a->
aùdœ
] = 
dœp
;

337 ià(++
d©a
->
aùdœ
 =ğd©a->
maxdœ
)

338 
d©a
->
aùdœ
 = 0;

342  
»suÉ
;

343 
	}
}

345 
š‹º®_funùiÚ
 
	$´oûss_’Œy
(
Ãw_áw_d©a
 *
d©a
, 
dœ_d©a
 *
dœ
, cÚ¡ *
Çme
, 
size_t
 
ÇmËn
)

347 
STAT
 
¡
;

348 
»suÉ
 = 0;

349 
æag
 = 0;

350 
size_t
 
Ãw_buæ’
;

352 ià(
Çme
[0] == '.' && (name[1] == '\0' || (name[1] == '.' &&‚ame[2] == '\0')))

356 
Ãw_buæ’
 = 
d©a
->
áw
.
ba£
 + 
ÇmËn
 + 2;

357 ià(
d©a
->
dœbufsize
 < 
Ãw_buæ’
) {

359 *
Ãwp
;

361 
d©a
->
dœbufsize
 = 2 * 
Ãw_buæ’
;

362 
Ãwp
 = (*)
	`»®loc
(
d©a
->
dœbuf
, d©a->
dœbufsize
);

363 ià(
Ãwp
 =ğ
NULL
)

365 
d©a
->
dœbuf
 = 
Ãwp
;

368 *((*)
	`__mempıy
(
d©a
->
dœbuf
 + d©a->
áw
.
ba£
, 
Çme
, 
ÇmËn
)) = '\0';

370 ià((
d©a
->
æags
 & 
FTW_CHDIR
) == 0)

371 
Çme
 = 
d©a
->
dœbuf
;

373 ià(((
d©a
->
æags
 & 
FTW_PHYS
)

374 ? 
	`LXSTAT
(
_STAT_VER
, 
Çme
, &
¡
)

375 : 
	`XSTAT
(
_STAT_VER
, 
Çme
, &
¡
)) < 0) {

376 ià(
”ºo
 !ğ
EACCES
 &&ƒ¼nØ!ğ
ENOENT
)

377 
»suÉ
 = -1;

378 ià(!(
d©a
->
æags
 & 
FTW_PHYS
)

379 && 
	`LXSTAT
(
_STAT_VER
, 
Çme
, &
¡
è=ğ0 && 
	`S_ISLNK
(¡.
¡_mode
))

380 
æag
 = 
FTW_SLN
;

382 
æag
 = 
FTW_NS
;

384 ià(
	`S_ISDIR
(
¡
.
¡_mode
))

385 
æag
 = 
FTW_D
;

386 ià(
	`S_ISLNK
(
¡
.
¡_mode
))

387 
æag
 = 
FTW_SL
;

389 
æag
 = 
FTW_F
;

392 ià(
»suÉ
 =ğ0 && (
æag
 =ğ
FTW_NS
 || !(
d©a
->
æags
 & 
FTW_MOUNT
è|| 
¡
.
¡_dev
 =ğd©a->
dev
)) {

393 ià(
æag
 =ğ
FTW_D
) {

394 ià((
d©a
->
æags
 & 
FTW_PHYS
)

395 || (!
	`fšd_objeù
(
d©a
, &
¡
)

397 && (
»suÉ
 = 
	`add_objeù
(
d©a
, &
¡
)) == 0))

398 
»suÉ
 = 
	`áw_dœ
(
d©a
, &
¡
, 
dœ
);

400 
»suÉ
 = (*
d©a
->
func
è(d©a->
dœbuf
, &
¡
, d©a->
cvt_¬r
[
æag
], &d©a->
áw
, data->data);

403 ià((
d©a
->
æags
 & 
FTW_ACTIONRETVAL
è&& 
»suÉ
 =ğ
FTW_SKIP_SUBTREE
)

404 
»suÉ
 = 0;

406  
»suÉ
;

407 
	}
}

409 
__©Œibu‹
((
nošlše
))

410 
š‹º®_funùiÚ
 
	$áw_dœ
(
Ãw_áw_d©a
 *
d©a
, 
STAT
 *
¡
, 
dœ_d©a
 *
Şd_dœ
)

412 
dœ_d©a
 
dœ
;

413 
dœ’t64
 *
d
;

414 
´evious_ba£
 = 
d©a
->
áw
.
ba£
;

415 
»suÉ
;

416 *
¡¬
;

420 
»suÉ
 = 
	`İ’_dœ_¡»am
(
d©a
, &
dœ
);

421 ià(
»suÉ
 != 0) {

422 ià(
”ºo
 =ğ
EACCES
)

424 
»suÉ
 = (*
d©a
->
func
è(d©a->
dœbuf
, 
¡
, 
FTW_DNR
, &d©a->
áw
, data->data);

426  
»suÉ
;

430 ià(!(
d©a
->
æags
 & 
FTW_DEPTH
)) {

431 
»suÉ
 = (*
d©a
->
func
è(d©a->
dœbuf
, 
¡
, 
FTW_D
, &d©a->
áw
, data->data);

432 ià(
»suÉ
 != 0) {

433 
§ve_”r
;

434 
ç
:

435 
§ve_”r
 = 
”ºo
;

436 
	`__şo£dœ
(
dœ
.
¡»am
);

437 
	`__£t_”ºo
(
§ve_”r
);

439 ià(
d©a
->
aùdœ
-- == 0)

440 
d©a
->
aùdœ
 = d©a->
maxdœ
 - 1;

441 
d©a
->
dœ¡»ams
[d©a->
aùdœ
] = 
NULL
;

442  
»suÉ
;

447 ià(
d©a
->
æags
 & 
FTW_CHDIR
) {

448 ià(
	`__fchdœ
(
	`dœfd
(
dœ
.
¡»am
)) < 0) {

449 
»suÉ
 = -1;

450 
ç
;

455 ++
d©a
->
áw
.
Ëv–
;

456 
¡¬
 = 
	`¡rchr
(
d©a
->
dœbuf
, '\0');

458 
	`as£¹
(
¡¬
 !ğ
d©a
->
dœbuf
);

459 ià(
¡¬
[-1] != '/')

460 *
¡¬
++ = '/';

461 
d©a
->
áw
.
ba£
 = 
¡¬
 - d©a->
dœbuf
;

463 
dœ
.
¡»am
 !ğ
NULL
 && (
d
 = 
	`__»addœ64
(dir.stream)) != NULL) {

464 
»suÉ
 = 
	`´oûss_’Œy
(
d©a
, &
dœ
, 
d
->
d_Çme
, 
	`NAMLEN
(d));

465 ià(
»suÉ
 != 0)

469 ià(
dœ
.
¡»am
 !ğ
NULL
) {

472 
§ve_”r
 = 
”ºo
;

474 
	`as£¹
(
dœ
.
cÚ‹Á
 =ğ
NULL
);

476 
	`__şo£dœ
(
dœ
.
¡»am
);

477 
	`__£t_”ºo
(
§ve_”r
);

479 ià(
d©a
->
aùdœ
-- == 0)

480 
d©a
->
aùdœ
 = d©a->
maxdœ
 - 1;

481 
d©a
->
dœ¡»ams
[d©a->
aùdœ
] = 
NULL
;

483 
§ve_”r
;

484 *
ruÅ
 = 
dœ
.
cÚ‹Á
;

486 
»suÉ
 =ğ0 && *
ruÅ
 != '\0') {

487 *
’dp
 = 
	`¡rchr
(
ruÅ
, '\0');

489 
»suÉ
 = 
	`´oûss_’Œy
(
d©a
, &
dœ
, 
ruÅ
, 
’dp
 -„unp);

491 
ruÅ
 = 
’dp
 + 1;

494 
§ve_”r
 = 
”ºo
;

495 
	`ä“
(
dœ
.
cÚ‹Á
);

496 
	`__£t_”ºo
(
§ve_”r
);

499 ià((
d©a
->
æags
 & 
FTW_ACTIONRETVAL
è&& 
»suÉ
 =ğ
FTW_SKIP_SIBLINGS
)

500 
»suÉ
 = 0;

503 
d©a
->
dœbuf
[d©a->
áw
.
ba£
 - 1] = '\0';

504 --
d©a
->
áw
.
Ëv–
;

505 
d©a
->
áw
.
ba£
 = 
´evious_ba£
;

508 ià(
»suÉ
 =ğ0 && (
d©a
->
æags
 & 
FTW_DEPTH
))

509 
»suÉ
 = (*
d©a
->
func
è(d©a->
dœbuf
, 
¡
, 
FTW_DP
, &d©a->
áw
, data->data);

511 ià(
Şd_dœ
 && (
d©a
->
æags
 & 
FTW_CHDIR
)

512 && (
»suÉ
 =ğ0 || ((
d©a
->
æags
 & 
FTW_ACTIONRETVAL
)

513 && (
»suÉ
 !ğ-1 &&„esuÉ !ğ
FTW_STOP
)))) {

515 
dÚe
 = 0;

516 ià(
Şd_dœ
->
¡»am
 !ğ
NULL
)

517 ià(
	`__fchdœ
(
	`dœfd
(
Şd_dœ
->
¡»am
)) == 0)

518 
dÚe
 = 1;

520 ià(!
dÚe
) {

521 ià(
d©a
->
áw
.
ba£
 == 1) {

522 ià(
	`__chdœ
("/") < 0)

523 
»suÉ
 = -1;

524 } ià(
	`__chdœ
("..") < 0)

525 
»suÉ
 = -1;

529  
»suÉ
;

530 
	}
}

532 
__©Œibu‹
((
nošlše
))

533 
š‹º®_funùiÚ
 
	$Ãw_áw_¡¬tup
(cÚ¡ *
dœ
, 
is_náw
, *
func
, 
desütÜs
, 
æags
, *
func_d©a
)

535 
Ãw_áw_d©a
 
d©a
;

536 
STAT
 
¡
;

537 
»suÉ
 = 0;

538 
§ve_”r
;

539 *
cwd
 = 
NULL
;

540 *
ı
;

543 ià(
dœ
[0] == '\0') {

544 
	`__£t_”ºo
(
ENOENT
);

548 
d©a
.
maxdœ
 = 
desütÜs
 < 1 ? 1 : descriptors;

549 
d©a
.
aùdœ
 = 0;

550 
d©a
.
dœ¡»ams
 = (
dœ_d©a
 **)
	`®loÿ
(d©a.
maxdœ
 * (dir_data *));

551 
	`mem£t
(
d©a
.
dœ¡»ams
, '\0', d©a.
maxdœ
 * (
dœ_d©a
 *));

554 
d©a
.
dœbufsize
 = 
	`MAX
(2 * 
	`¡¾’
(
dœ
), 
PATH_MAX
);

555 
d©a
.
dœbuf
 = (*)
	`m®loc
(d©a.
dœbufsize
);

556 ià(
d©a
.
dœbuf
 =ğ
NULL
)

558 
ı
 = 
	`__¡pıy
(
d©a
.
dœbuf
, 
dœ
);

560 
ı
 > 
d©a
.
dœbuf
 + 1 && cp[-1] == '/')

561 --
ı
;

562 *
ı
 = '\0';

564 
d©a
.
áw
.
Ëv–
 = 0;

567 
ı
 > 
d©a
.
dœbuf
 && cp[-1] != '/')

568 --
ı
;

569 
d©a
.
áw
.
ba£
 = 
ı
 - d©a.
dœbuf
;

571 
d©a
.
æags
 = flags;

579 
d©a
.
func
 = (
NEW_NFTW_FUNC_T
) func;

580 
d©a
.d©¨ğ
func_d©a
;

584 
d©a
.
cvt_¬r
 = 
is_náw
 ? 
náw_¬r
 : 
áw_¬r
;

587 
d©a
.
known_objeùs
 = 
NULL
;

590 ià(
æags
 & 
FTW_CHDIR
) {

592 
cwd
 = 
	`__g‘cwd
(
NULL
, 0);

593 ià(
cwd
 =ğ
NULL
)

594 
»suÉ
 = -1;

595 ià(
d©a
.
áw
.
ba£
 > 0) {

599 ià(
d©a
.
áw
.
ba£
 == 1)

601 
»suÉ
 = 
	`__chdœ
("/");

603 
ch
 = 
d©a
.
dœbuf
[d©a.
áw
.
ba£
 - 1];

604 
d©a
.
dœbuf
[d©a.
áw
.
ba£
 - 1] = '\0';

605 
»suÉ
 = 
	`__chdœ
(
d©a
.
dœbuf
);

606 
d©a
.
dœbuf
[d©a.
áw
.
ba£
 - 1] = 
ch
;

612 ià(
»suÉ
 == 0) {

613 cÚ¡ *
Çme
 = ((
d©a
.
æags
 & 
FTW_CHDIR
)

614 ? 
d©a
.
dœbuf
 + d©a.
áw
.
ba£
 : data.dirbuf);

616 ià(((
æags
 & 
FTW_PHYS
)

617 ? 
	`LXSTAT
(
_STAT_VER
, 
Çme
, &
¡
)

618 : 
	`XSTAT
(
_STAT_VER
, 
Çme
, &
¡
)) < 0) {

619 ià(!(
æags
 & 
FTW_PHYS
)

620 && 
”ºo
 =ğ
ENOENT
 && 
	`LXSTAT
(
_STAT_VER
, 
Çme
, &
¡
è=ğ0 && 
	`S_ISLNK
(¡.
¡_mode
))

621 
»suÉ
 = (*
d©a
.
func
è(d©a.
dœbuf
, &
¡
, d©a.
cvt_¬r
[
FTW_SLN
], &d©a.
áw
, data.data);

625 
»suÉ
 = -1;

627 ià(
	`S_ISDIR
(
¡
.
¡_mode
)) {

630 
d©a
.
dev
 = 
¡
.
¡_dev
;

633 ià(!(
æags
 & 
FTW_PHYS
))

634 
»suÉ
 = 
	`add_objeù
(&
d©a
, &
¡
);

636 ià(
»suÉ
 == 0)

637 
»suÉ
 = 
	`áw_dœ
(&
d©a
, &
¡
, 
NULL
);

639 
æag
 = 
	`S_ISLNK
(
¡
.
¡_mode
è? 
FTW_SL
 : 
FTW_F
;

641 
»suÉ
 = (*
d©a
.
func
è(d©a.
dœbuf
, &
¡
, d©a.
cvt_¬r
[
æag
], &d©a.
áw
, data.data);

645 ià((
æags
 & 
FTW_ACTIONRETVAL
)

646 && (
»suÉ
 =ğ
FTW_SKIP_SUBTREE
 ||„esuÉ =ğ
FTW_SKIP_SIBLINGS
))

647 
»suÉ
 = 0;

651 ià(
cwd
 !ğ
NULL
) {

652 
§ve_”r
 = 
”ºo
;

653 
	`__chdœ
(
cwd
);

654 
	`ä“
(
cwd
);

655 
	`__£t_”ºo
(
§ve_”r
);

659 
§ve_”r
 = 
”ºo
;

660 
	`__tde¡roy
(
d©a
.
known_objeùs
, 
ä“
);

661 
	`ä“
(
d©a
.
dœbuf
);

662 
	`__£t_”ºo
(
§ve_”r
);

664  
»suÉ
;

665 
	}
}

669 
	$NEW_FTW_NAME
(
·th
, 
func
, 
desütÜs
, 
d©a
)

670 cÚ¡ *
·th
;

671 
NEW_FTW_FUNC_T
 
func
;

672 
desütÜs
;

673 *
d©a
;

675  
	`Ãw_áw_¡¬tup
(
·th
, 0, 
func
, 
desütÜs
, 0, 
d©a
);

676 
	}
}

678 #iâdeà
_LIBC


679 
	$NEW_NFTW_NAME
(
·th
, 
func
, 
desütÜs
, 
æags
, 
d©a
)

680 cÚ¡ *
·th
;

681 
NEW_NFTW_FUNC_T
 
func
;

682 
desütÜs
;

683 
æags
;

684 *
d©a
;

686  
	`Ãw_áw_¡¬tup
(
·th
, 1, 
func
, 
desütÜs
, 
æags
, 
d©a
);

687 
	}
}

690 
	~<shlib-com·t.h
>

692 
NEW_NFTW_NEW_NAME
(cÚ¡ *, 
NEW_NFTW_FUNC_T
, , , *);

694 
	$NEW_NFTW_NEW_NAME
(
·th
, 
func
, 
desütÜs
, 
æags
, 
d©a
)

695 cÚ¡ *
·th
;

696 
NEW_NFTW_FUNC_T
 
func
;

697 
desütÜs
;

698 
æags
;

699 *
d©a
;

701 ià(
æags
 & ~(
FTW_PHYS
 | 
FTW_MOUNT
 | 
FTW_CHDIR
 | 
FTW_DEPTH
 | 
FTW_ACTIONRETVAL
)) {

702 
	`__£t_”ºo
(
EINVAL
);

705  
	`Ãw_áw_¡¬tup
(
·th
, 1, 
func
, 
desütÜs
, 
æags
, 
d©a
);

706 
	}
}

710 #ià
SHLIB_COMPAT
(
libc
, 
GLIBC_2_1
, 
GLIBC_2_3_3
)

714 
NEW_NFTW_OLD_NAME
(cÚ¡ *, 
NEW_NFTW_FUNC_T
, , , *);

716 
©Œibu‹_com·t_‹xt_£ùiÚ
 
	$NFTW_OLD_NAME
(
·th
, 
func
, 
desütÜs
, 
æags
, *)

717 cÚ¡ *
·th
;

718 
NFTW_FUNC_T
 
func
;

719 
desütÜs
;

720 
æags
;

721 *
d©a
;

723 
æags
 &ğ(
FTW_PHYS
 | 
FTW_MOUNT
 | 
FTW_CHDIR
 | 
FTW_DEPTH
);

724  
	`áw_¡¬tup
(
·th
, 1, 
func
, 
desütÜs
, 
æags
, 
d©a
);

725 
	}
}

727 
com·t_symbŞ
(
libc
, 
NFTW_OLD_NAME
, 
NFTW_NAME
, 
GLIBC_2_1
);

731 
	$½l_l¡©
(
fe
, 
sbuf
)

732 cÚ¡ *
fe
;

733 
¡©
 *
sbuf
;

735 ià(
fe
 && *file == 0) {

736 
”ºo
 = 
EINVAL
;

740  
	`l¡©
(
fe
, 
sbuf
);

741 
	}
}

743 
	~<¡dio.h
>

745 *
	$xg‘cwd
()

747 *
cwd
 = 
	`g‘cwd
(
NULL
, 0);

748 ià(!
cwd
 && 
”ºo
 =ğ
ENOMEM
) {

749 
	`årštf
(
¡d”r
, "out of memory\n");

750 
	`ex™
(1);

752  
cwd
;

753 
	}
}

	@libsefs/src/new_ftw.h

38 #iâdeà
_NEW_FTW_H


39 
	#_NEW_FTW_H
 1

	)

41 
	~<ã©u»s.h
>

43 
	~<sys/ty³s.h
>

44 
	~<sys/¡©.h
>

46 
__BEGIN_DECLS


51 
	mFTW_F
,

52 
	#FTW_F
 
FTW_F


	)

53 
	mFTW_D
,

54 
	#FTW_D
 
FTW_D


	)

55 
	mFTW_DNR
,

56 
	#FTW_DNR
 
FTW_DNR


	)

57 
	mFTW_NS
,

58 
	#FTW_NS
 
FTW_NS


	)

60 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


62 
	mFTW_SL
,

63 
	#FTW_SL
 
FTW_SL


	)

66 #ifdeà
__USE_XOPEN_EXTENDED


68 
	mFTW_DP
,

69 
	#FTW_DP
 
FTW_DP


	)

70 
	mFTW_SLN


71 
	#FTW_SLN
 
FTW_SLN


	)

75 #ifdeà
__USE_XOPEN_EXTENDED


79 
	mFTW_PHYS
 = 1,

80 
	#FTW_PHYS
 
FTW_PHYS


	)

81 
	mFTW_MOUNT
 = 2,

83 
	#FTW_MOUNT
 
FTW_MOUNT


	)

84 
	mFTW_CHDIR
 = 4,

85 
	#FTW_CHDIR
 
FTW_CHDIR


	)

86 
	mFTW_DEPTH
 = 8

87 
	#FTW_DEPTH
 
FTW_DEPTH


	)

88 #ifdeà
__USE_GNU


90 
	mFTW_ACTIONRETVAL
 = 16

92 
	#FTW_ACTIONRETVAL
 
FTW_ACTIONRETVAL


	)

96 #ifdeà
__USE_GNU


100 
	mFTW_CONTINUE
 = 0,

102 
	#FTW_CONTINUE
 
FTW_CONTINUE


	)

103 
	mFTW_STOP
 = 1,

105 
	#FTW_STOP
 
FTW_STOP


	)

106 
	mFTW_SKIP_SUBTREE
 = 2,

109 
	#FTW_SKIP_SUBTREE
 
FTW_SKIP_SUBTREE


	)

110 
	mFTW_SKIP_SIBLINGS
 = 3

112 
	#FTW_SKIP_SIBLINGS
 
FTW_SKIP_SIBLINGS


	)

117 
	sFTW


119 
	mba£
;

120 
	mËv–
;

125 (*
	t__Ãw_áw_func_t
è(
	t__cÚ¡
 *
	t__f’ame
, __cÚ¡ 
	t¡©
 * 
	t__¡©us
, 
	t__æag
, *
	t__d©a
);

126 #ifdeà
__USE_LARGEFILE64


127 (*
	t__Ãw_áw64_func_t
è(
	t__cÚ¡
 *
	t__f’ame
, __cÚ¡ 
	t¡©64
 * 
	t__¡©us
, 
	t__æag
, *
	t__d©a
);

129 #ifdeà
__USE_XOPEN_EXTENDED


130 (*
	t__Ãw_náw_func_t
è(
	t__cÚ¡
 *
	t__f’ame
,

131 
	t__cÚ¡
 
	t¡©
 * 
	t__¡©us
, 
	t__æag
, 
	tFTW
 * 
	t__šfo
, *
	t__d©a
);

132 #ifdeà
__USE_LARGEFILE64


133 (*
	t__Ãw_náw64_func_t
è(
	t__cÚ¡
 *
	t__f’ame
,

134 
	t__cÚ¡
 
	t¡©64
 * 
	t__¡©us
, 
	t__æag
, 
	tFTW
 * 
	t__šfo
, *
	t__d©a
);

142 #iâdeà
__USE_FILE_OFFSET64


143 
	$Ãw_áw
(
__cÚ¡
 *
__dœ
, 
__Ãw_áw_func_t
 
__func
, 
__desütÜs
, *
__d©a
è
	`__nÚnuÎ
((1, 2));

145 #ifdeà
__REDIRECT


146 
	`__REDIRECT
(
Ãw_áw
, (
__cÚ¡
 *
__dœ
, 
__Ãw_áw_func_t
 
__func
,

147 
__desütÜs
, *
__d©a
), 
Ãw_áw64
è
	`__nÚnuÎ
((1, 2));

149 
	#Ãw_áw
 
Ãw_áw64


	)

152 #ifdeà
__USE_LARGEFILE64


153 
	$Ãw_áw64
(
__cÚ¡
 *
__dœ
, 
__Ãw_áw64_func_t
 
__func
, 
__desütÜs
, *
__d©a
è
	`__nÚnuÎ
((1, 2));

156 #ifdeà
__USE_XOPEN_EXTENDED


162 #iâdeà
__USE_FILE_OFFSET64


163 
	$Ãw_náw
(
__cÚ¡
 *
__dœ
, 
__Ãw_náw_func_t
 
__func
, 
__desütÜs
, 
__æag
, *
__d©a
è
	`__nÚnuÎ
((1, 2));

165 #ifdeà
__REDIRECT


166 
	`__REDIRECT
(
Ãw_náw
, (
__cÚ¡
 *
__dœ
, 
__Ãw_náw_func_t
 
__func
,

167 
__desütÜs
, 
__æag
, *
__d©a
), 
Ãw_náw64
è
	`__nÚnuÎ
((1, 2));

169 
	#Ãw_náw
 
Ãw_náw64


	)

172 #ifdeà
__USE_LARGEFILE64


173 
	$Ãw_náw64
(
__cÚ¡
 *
__dœ
, 
__Ãw_náw64_func_t
 
__func
,

174 
__desütÜs
, 
__æag
, *
__d©a
è
	`__nÚnuÎ
((1, 2));

179 
	`__REDIRECT
(
Ãw_náw
, (
__cÚ¡
 *
__dœ
, 
__Ãw_náw_func_t
 
__func
,

180 
__desütÜs
, 
__æag
, *
__d©a
), 
Ãw_náw64
è
	`__nÚnuÎ
((1, 2));

182 
__END_DECLS


	@libsefs/src/query.cc

25 
	~<cÚfig.h
>

27 
	~"£fs_š‹º®.hh
"

29 
	~<£fs/qu”y.hh
>

30 
	~<­Ş/ut.h
>

31 
	~<qpŞ/g’fscÚ_qu”y.h
>

33 
	~<as£¹.h
>

34 
	~<”ºo.h
>

38 
	g£fs_qu”y
::
	$£fs_qu”y
()

40 
_u£r
 = 
_rŞe
 = 
_ty³
 = 
_¿nge
 = 
NULL
;

41 
_·th
 = 
_dev
 = 
NULL
;

42 
_objşass
 = 
QPOL_CLASS_ALL
;

43 
_šdœeù
 = 
_»gex
 = 
_»cursive
 = 
çl£
;

44 
_šode
 = 0;

45 
_»comped
 = 
çl£
;

46 
_»u£r
 = 
_»rŞe
 = 
_»ty³
 = 
_»¿nge
 = 
_»·th
 = 
_»dev
 = 
NULL
;

47 
	}
}

49 
	g£fs_qu”y
::~
	$£fs_qu”y
()

51 
	`ä“
(
_u£r
);

52 
	`ä“
(
_rŞe
);

53 
	`ä“
(
_ty³
);

54 
	`ä“
(
_¿nge
);

55 
	`ä“
(
_·th
);

56 
	`ä“
(
_dev
);

57 ià(
_»comped
)

59 
	`»gä“
(
_»u£r
);

60 
	`ä“
(
_»u£r
);

61 
	`»gä“
(
_»rŞe
);

62 
	`ä“
(
_»rŞe
);

63 
	`»gä“
(
_»ty³
);

64 
	`ä“
(
_»ty³
);

65 
	`»gä“
(
_»¿nge
);

66 
	`ä“
(
_»¿nge
);

67 
	`»gä“
(
_»·th
);

68 
	`ä“
(
_»·th
);

69 
	`»gä“
(
_»dev
);

70 
	`ä“
(
_»dev
);

72 
	}
}

74 
	g£fs_qu”y
::
	$u£r
(cÚ¡ *
Çme
è
	$throw
(
¡d
::
bad_®loc
)

76 ià(
Çme
 !ğ
_u£r
)

78 
	`ä“
(
_u£r
);

79 
_u£r
 = 
NULL
;

80 ià(
Çme
 !ğ
NULL
 && *Çm!ğ'\0' && (
_u£r
 = 
	`¡rdup
(name)) == NULL)

82 
throw
 
¡d
::
	`bad_®loc
();

85 
	}
}

87 
	g£fs_qu”y
::
	$rŞe
(cÚ¡ *
Çme
è
	$throw
(
¡d
::
bad_®loc
)

89 ià(
Çme
 !ğ
_rŞe
)

91 
	`ä“
(
_rŞe
);

92 
_rŞe
 = 
NULL
;

93 ià(
Çme
 !ğ
NULL
 && *Çm!ğ'\0' && (
_rŞe
 = 
	`¡rdup
(name)) == NULL)

95 
throw
 
¡d
::
	`bad_®loc
();

98 
	}
}

100 
	g£fs_qu”y
::
	$ty³
(cÚ¡ *
Çme
, 
boŞ
 
šdœeù
è
	$throw
(
¡d
::
bad_®loc
)

102 ià(
Çme
 !ğ
_ty³
)

104 
	`ä“
(
_ty³
);

105 
_ty³
 = 
NULL
;

106 ià(
Çme
 !ğ
NULL
 && *name != '\0')

108 ià((
_ty³
 = 
	`¡rdup
(
Çme
)è=ğ
NULL
)

110 
throw
 
¡d
::
	`bad_®loc
();

112 
_šdœeù
 = 
šdœeù
;

115 
	}
}

117 
	g£fs_qu”y
::
	$¿nge
(cÚ¡ *
Çme
, 
m©ch
è
	$throw
(
¡d
::
bad_®loc
)

119 ià(
Çme
 !ğ
_¿nge
)

121 
	`ä“
(
_¿nge
);

122 
_¿nge
 = 
NULL
;

123 ià(
Çme
 !ğ
NULL
 && *name != '\0')

125 ià((
_¿nge
 = 
	`¡rdup
(
Çme
)è=ğ
NULL
)

127 
throw
 
¡d
::
	`bad_®loc
();

129 
_¿ngeM©ch
 = 
m©ch
;

132 
	}
}

134 
	g£fs_qu”y
::
	$objeùCÏss
(
ušt32_t
 
objşass
)

136 
_objşass
 = 
objşass
;

137 
	}
}

139 
	g£fs_qu”y
::
	$objeùCÏss
(cÚ¡ *
Çme
)

141 ià(
Çme
 =ğ
NULL
 || *Çm=ğ'\0' || 
	`¡rcmp
(name, "any") == 0)

143 
_objşass
 = 
QPOL_CLASS_ALL
;

147 
ušt32_t
 
o
 = 
	`­Ş_¡r_to_objşass
(
Çme
);

148 ià(
o
 !ğ
QPOL_CLASS_ALL
)

150 
_objşass
 = 
o
;

153 
	}
}

155 
	g£fs_qu”y
::
	$·th
(cÚ¡ *
¡r
è
	$throw
(
¡d
::
bad_®loc
)

157 ià(
¡r
 !ğ
_·th
)

159 
	`ä“
(
_·th
);

160 
_·th
 = 
NULL
;

161 ià(
¡r
 !ğ
NULL
 && *¡¸!ğ'\0' && (
_·th
 = 
	`¡rdup
(str)) == NULL)

163 
throw
 
¡d
::
	`bad_®loc
();

166 
	}
}

168 
	g£fs_qu”y
::
	$šode
(
šo64_t
 
šo
)

170 
_šode
 = 
šo
;

171 
	}
}

173 
	g£fs_qu”y
::
	$dev
(cÚ¡ *
¡r
è
	$throw
(
¡d
::
bad_®loc
)

175 ià(
¡r
 !ğ
_dev
)

177 
	`ä“
(
_dev
);

178 
_dev
 = 
NULL
;

179 ià(
¡r
 !ğ
NULL
 && *¡¸!ğ'\0' && (
_dev
 = 
	`¡rdup
(str)) == NULL)

181 
throw
 
¡d
::
	`bad_®loc
();

184 
	}
}

186 
	g£fs_qu”y
::
	$»gex
(
boŞ
 
r
)

188 
_»gex
 = 
r
;

189 
	}
}

193 
	g£fs_qu”y
::
	$compe
(è
	$throw
(
¡d
::
bad_®loc
, std::
šv®id_¬gum’t
)

195 ià(
_»comped
)

197 
	`»gä“
(
_»u£r
);

198 
	`»gä“
(
_»rŞe
);

199 
	`»gä“
(
_»ty³
);

200 
	`»gä“
(
_»¿nge
);

201 
	`»gä“
(
_»·th
);

202 
	`»gä“
(
_»dev
);

206 ià((
_»u£r
 = 
¡©ic_ÿ¡
 < 
»gex_t
 * >(
	`m®loc
((*_»u£r)))è=ğ
NULL
)

208 
throw
 
¡d
::
	`bad_®loc
();

210 ià((
_»rŞe
 = 
¡©ic_ÿ¡
 < 
»gex_t
 * >(
	`m®loc
((*_»rŞe)))è=ğ
NULL
)

212 
throw
 
¡d
::
	`bad_®loc
();

214 ià((
_»ty³
 = 
¡©ic_ÿ¡
 < 
»gex_t
 * >(
	`m®loc
((*_»ty³)))è=ğ
NULL
)

216 
throw
 
¡d
::
	`bad_®loc
();

218 ià((
_»¿nge
 = 
¡©ic_ÿ¡
 < 
»gex_t
 * >(
	`m®loc
((*_»¿nge)))è=ğ
NULL
)

220 
throw
 
¡d
::
	`bad_®loc
();

222 ià((
_»·th
 = 
¡©ic_ÿ¡
 < 
»gex_t
 * >(
	`m®loc
((*_»·th)))è=ğ
NULL
)

224 
throw
 
¡d
::
	`bad_®loc
();

226 ià((
_»dev
 = 
¡©ic_ÿ¡
 < 
»gex_t
 * >(
	`m®loc
((*_»dev)))è=ğ
NULL
)

228 
throw
 
¡d
::
	`bad_®loc
();

231 
”rbuf
[1024] = { '\0' };

232 
»g»tv
;

233 cÚ¡ *
s
 = (
_u£r
 =ğ
NULL
 ? "" : _user);

234 ià((
»g»tv
 = 
	`»gcomp
(
_»u£r
, 
s
, 
REG_EXTENDED
 | 
REG_NOSUB
)))

236 
	`»g”rÜ
(
»g»tv
, 
_»u£r
, 
”rbuf
, 1024);

237 
throw
 
¡d
::
	`šv®id_¬gum’t
(
”rbuf
);

239 
s
 = (
_rŞe
 =ğ
NULL
 ? "" : _role);

240 ià((
»g»tv
 = 
	`»gcomp
(
_»rŞe
, 
s
, 
REG_EXTENDED
 | 
REG_NOSUB
)))

242 
	`»g”rÜ
(
»g»tv
, 
_»u£r
, 
”rbuf
, 1024);

243 
throw
 
¡d
::
	`šv®id_¬gum’t
(
”rbuf
);

245 
s
 = (
_ty³
 =ğ
NULL
 ? "" : _type);

246 ià((
»g»tv
 = 
	`»gcomp
(
_»ty³
, 
s
, 
REG_EXTENDED
 | 
REG_NOSUB
)))

248 
	`»g”rÜ
(
»g»tv
, 
_»u£r
, 
”rbuf
, 1024);

249 
throw
 
¡d
::
	`šv®id_¬gum’t
(
”rbuf
);

251 
s
 = (
_¿nge
 =ğ
NULL
 ? "" : _range);

252 ià((
»g»tv
 = 
	`»gcomp
(
_»¿nge
, 
s
, 
REG_EXTENDED
 | 
REG_NOSUB
)))

254 
	`»g”rÜ
(
»g»tv
, 
_»u£r
, 
”rbuf
, 1024);

255 
throw
 
¡d
::
	`šv®id_¬gum’t
(
”rbuf
);

257 
s
 = (
_·th
 =ğ
NULL
 ? "" : _path);

258 ià((
»g»tv
 = 
	`»gcomp
(
_»·th
, 
s
, 
REG_EXTENDED
 | 
REG_NOSUB
)))

260 
	`»g”rÜ
(
»g»tv
, 
_»u£r
, 
”rbuf
, 1024);

261 
throw
 
¡d
::
	`šv®id_¬gum’t
(
”rbuf
);

263 
s
 = (
_dev
 =ğ
NULL
 ? "" : _dev);

264 ià((
»g»tv
 = 
	`»gcomp
(
_»dev
, 
s
, 
REG_EXTENDED
 | 
REG_NOSUB
)))

266 
	`»g”rÜ
(
»g»tv
, 
_»u£r
, 
”rbuf
, 1024);

267 
throw
 
¡d
::
	`šv®id_¬gum’t
(
”rbuf
);

269 
_»comped
 = 
Œue
;

270 
	}
}

274 
£fs_qu”y_t
 *
	$£fs_qu”y_ü—‹
()

276  
Ãw
 
	`£fs_qu”y
();

277 
	}
}

279 
	$£fs_qu”y_de¡roy
(
£fs_qu”y_t
 ** 
qu”y
)

281 ià(
qu”y
 !ğ
NULL
 && *query != NULL)

283 
	`d–‘e
(*
qu”y
);

284 *
qu”y
 = 
NULL
;

286 
	}
}

288 
	$£fs_qu”y_£t_u£r
(
£fs_qu”y_t
 * 
qu”y
, cÚ¡ *
Çme
)

290 ià(
qu”y
 =ğ
NULL
)

292 
”ºo
 = 
EINVAL
;

295 
Œy


297 
qu”y
->
	`u£r
(
Çme
);

299 
	`ÿtch
(...)

304 
	}
}

306 
	$£fs_qu”y_£t_rŞe
(
£fs_qu”y_t
 * 
qu”y
, cÚ¡ *
Çme
)

308 ià(
qu”y
 =ğ
NULL
)

310 
”ºo
 = 
EINVAL
;

313 
Œy


315 
qu”y
->
	`rŞe
(
Çme
);

317 
	`ÿtch
(...)

322 
	}
}

324 
	$£fs_qu”y_£t_ty³
(
£fs_qu”y_t
 * 
qu”y
, cÚ¡ *
Çme
, 
boŞ
 
šdœeù
)

326 ià(
qu”y
 =ğ
NULL
)

328 
”ºo
 = 
EINVAL
;

331 
Œy


333 
qu”y
->
	`ty³
(
Çme
, 
šdœeù
);

335 
	`ÿtch
(...)

340 
	}
}

342 
	$£fs_qu”y_£t_¿nge
(
£fs_qu”y_t
 * 
qu”y
, cÚ¡ *
¿nge
, 
m©ch
)

344 ià(
qu”y
 =ğ
NULL
)

346 
”ºo
 = 
EINVAL
;

349 
qu”y
->
	`¿nge
(
¿nge
, 
m©ch
);

351 
	}
}

353 
	$£fs_qu”y_£t_objeù_şass
(
£fs_qu”y_t
 * 
qu”y
, 
ušt32_t
 
objşass
)

355 ià(
qu”y
 =ğ
NULL
)

357 
”ºo
 = 
EINVAL
;

360 
qu”y
->
	`objeùCÏss
(
objşass
);

362 
	}
}

364 
	$£fs_qu”y_£t_objeù_şass_¡r
(
£fs_qu”y_t
 * 
qu”y
, cÚ¡ *
Çme
)

366 ià(
qu”y
 =ğ
NULL
)

368 
”ºo
 = 
EINVAL
;

371 
qu”y
->
	`objeùCÏss
(
Çme
);

373 
	}
}

375 
	$£fs_qu”y_£t_·th
(
£fs_qu”y_t
 * 
qu”y
, cÚ¡ *
·th
)

377 ià(
qu”y
 =ğ
NULL
)

379 
”ºo
 = 
EINVAL
;

382 
Œy


384 
qu”y
->
	`·th
(
·th
);

386 
	`ÿtch
(...)

391 
	}
}

393 
	$£fs_qu”y_£t_šode
(
£fs_qu”y_t
 * 
qu”y
, 
šo64_t
 
šode
)

395 ià(
qu”y
 =ğ
NULL
)

397 
”ºo
 = 
EINVAL
;

400 
qu”y
->
	`šode
(
šode
);

402 
	}
}

404 
	$£fs_qu”y_£t_dev
(
£fs_qu”y_t
 * 
qu”y
, cÚ¡ *
dev
)

406 ià(
qu”y
 =ğ
NULL
)

408 
”ºo
 = 
EINVAL
;

411 
Œy


413 
qu”y
->
	`dev
(
dev
);

415 
	`ÿtch
(...)

420 
	}
}

422 
	$£fs_qu”y_£t_»gex
(
£fs_qu”y_t
 * 
qu”y
, 
boŞ
 
»gex
)

424 ià(
qu”y
 =ğ
NULL
)

426 
”ºo
 = 
EINVAL
;

429 
qu”y
->
	`»gex
(
»gex
);

431 
	}
}

	@libsefs/src/sefs_internal.hh

25 #iâdeà
SEFS_INTERNAL_HH


26 
	#SEFS_INTERNAL_HH


	)

28 
	~<­Ş/b¡.h
>

29 
	~<£fs/fşi¡.hh
>

30 
	~<»gex.h
>

47 
­Ş_veùÜ_t
 *
qu”y_ü—‹_ÿndid©e_ty³
(
­Ş_pŞicy_t
 * 
pŞicy
, cÚ¡ *
¡r
, cÚ¡ 
»gex_t
 * 
»gex
, cÚ¡ 
boŞ
 
»gex_æag
,

48 cÚ¡ 
boŞ
 
šdœeù
);

67 
boŞ
 
qu”y_¡r_com·»
(cÚ¡ *
rg‘
, cÚ¡ *
¡r
, cÚ¡ 
»gex_t
 * 
»gex
, cÚ¡ boŞ 
»gex_æag
);

71 
	s£fs_cÚ‹xt_node


73 
­Ş_cÚ‹xt_t
 *
	mcÚ‹xt
;

74 cÚ¡ *
	mu£r
, *
	mrŞe
, *
	mty³
, *
	m¿nge
;

75 *
	mcÚ‹xt_¡r
;

	@libsefs/src/util.c

26 
	~<cÚfig.h
>

28 
	~<¡ršg.h
>

30 #ifdeà
LIBSELINUX


31 
	~<£lšux/£lšux.h
>

34 cÚ¡ *
	$lib£fs_g‘_v”siÚ
()

36  
LIBSEFS_VERSION_STRING
;

37 
	}
}

39 *
	$£fs_deçuÉ_fe_cÚ‹xts_g‘_·th
()

41 #ifdeà
LIBSELINUX


42  
	`¡rdup
(
	`£lšux_fe_cÚ‹xt_·th
());

44  
	`¡rdup
("");

46 
	}
}

	@libsefs/tests/attic/fuse_non_mls.c

37 
	~<cÚfig.h
>

39 
	#FUSE_USE_VERSION
 25

	)

41 
	#XATTR_NAME_SELINUX
 "£cur™y.£lšux"

	)

43 
	~<­Ş/b¡.h
>

44 
	~<fu£.h
>

46 
	~<as£¹.h
>

47 
	~<”ºo.h
>

48 
	~<¡dio.h
>

49 
	~<¡ršg.h
>

53 
­Ş_b¡_t
 *
	gb¡
 = 
NULL
;

55 
	sfu£_’Œy


57 cÚ¡ *
	m·th
;

58 
mode_t
 
	mmode
;

59 cÚ¡ *
	mcÚ‹xt
;

62 
fu£_’Œy
 
	gfs
[] = {

63 {"/", 
S_IFDIR
, "user_r:object_r:system_t"},

64 {"/foo", 
S_IFREG
, "user_r:object_r:system_t"},

65 {
NULL
, 0, NULL}

68 
fu£_comp
(cÚ¡ *
a
, cÚ¡ *
b
, *
d©a
 
__©Œibu‹__
 ((
unu£d
)))

70 cÚ¡ 
fu£_’Œy
 *
	gf1
 = (cÚ¡ fu£_’Œy *)
a
;

71 cÚ¡ 
fu£_’Œy
 *
	gf2
 = (cÚ¡ fu£_’Œy *)
b
;

72  
¡rcmp
(
f1
->
·th
, 
f2
->path);

77 
	$fu£_g‘©Œ
(cÚ¡ *
·th
, 
¡©
 *
¡buf
)

79 
fu£_’Œy
 
key
 = { 
·th
, 0, 
NULL
 };

80 
fu£_’Œy
 *
e
;

81 
	`mem£t
(
¡buf
, 0, (*stbuf));

82 ià(
	`­Ş_b¡_g‘_–em’t
(
b¡
, &
key
, 
NULL
, (**)&
e
) < 0) {

83  -
ENOENT
;

85 ià(
e
->
mode
 =ğ
S_IFDIR
) {

86 
¡buf
->
¡_mode
 = 
S_IFDIR
 | 0755;

87 
¡buf
->
¡_Æšk
 = 2;

89 
¡buf
->
¡_mode
 = 
e
->
mode
 | 0444;

90 
¡buf
->
¡_Æšk
 = 1;

93 
	}
}

95 
	$fu£_g‘x©Œ
(cÚ¡ *
·th
, cÚ¡ *
©Œib_Çme
, *
buf
, 
size_t
 
buæ’
)

97 
fu£_’Œy
 
key
 = { 
·th
, 0, 
NULL
 };

98 
fu£_’Œy
 *
e
;

99 ià(
	`­Ş_b¡_g‘_–em’t
(
b¡
, &
key
, 
NULL
, (**)&
e
) < 0) {

100  -
ENOENT
;

102 ià(
	`¡rcmp
(
©Œib_Çme
, 
XATTR_NAME_SELINUX
) != 0) {

103  -
ENOSYS
;

105 
	`¡ºıy
(
buf
, 
e
->
cÚ‹xt
, 
buæ’
);

106  
	`¡¾’
(
e
->
cÚ‹xt
) + 1;

107 
	}
}

109 
fu£_İ’
(cÚ¡ *
·th
, 
fu£_fe_šfo
 *
fi
 
__©Œibu‹__
 ((
unu£d
)))

111 
fu£_’Œy
 
	gkey
 = { 
·th
, 0, 
NULL
 };

112 
fu£_’Œy
 *
	ge
;

113 ià(
­Ş_b¡_g‘_–em’t
(
b¡
, &
key
, 
NULL
, (**)&
e
) < 0) {

114  -
	gENOENT
;

117  -
	gEACCES
;

120 
fu£_»ad
(cÚ¡ *
·th
, *
buf
 
__©Œibu‹__
 ((
unu£d
)), 
size_t
 
size
, 
off_t
 
off£t
 __attribute__ ((unused)),

121 
fu£_fe_šfo
 *
fi
 
__©Œibu‹__
 ((
unu£d
)))

123 
fu£_’Œy
 
	gkey
 = { 
·th
, 0, 
NULL
 };

124 
fu£_’Œy
 *
	ge
;

125 ià(
­Ş_b¡_g‘_–em’t
(
b¡
, &
key
, 
NULL
, (**)&
e
) < 0) {

126  -
	gENOENT
;

128  
	gsize
;

131 
	s¡em_d©a


133 cÚ¡ *
	m¡em
;

134 *
	mbuf
;

135 
fu£_fl_dœ_t
 
	mfËr
;

138 
	$fu£_¡em_m©ch
(*
a
, *
d©a
)

140 cÚ¡ 
fu£_’Œy
 *
e
 = (cÚ¡ fu£_’Œy *)
a
;

141 
¡em_d©a
 *
sd
 = (¡em_d©¨*)
d©a
;

143 
size_t
 
e_Ën
 = 
	`¡¾’
(
e
->
·th
);

144 
size_t
 
¡em_Ën
 = 
	`¡¾’
(
sd
->
¡em
);

145 ià(
e_Ën
 <ğ
¡em_Ën
) {

149 ià(
	`¡ºcmp
(
e
->
·th
, 
sd
->
¡em
, 
¡em_Ën
) != 0) {

153 cÚ¡ *
fe
 = 
e
->
·th
 + 1;

154 ià(
	`¡rchr
(
fe
, '/'è!ğ
NULL
) {

158  -
sd
->
	`fËr
(sd->
buf
, 
fe
, 
NULL
, 0);

159 
	}
}

161 
fu£_»addœ
(cÚ¡ *
·th
, *
buf
, 
fu£_fl_dœ_t
 
fËr
,

162 
off_t
 
off£t
 
__©Œibu‹__
 ((
unu£d
)), 
fu£_fe_šfo
 *
fi
 __attribute__ ((unused)))

164 
fu£_’Œy
 
	gkey
 = { 
·th
, 0, 
NULL
 };

165 
fu£_’Œy
 *
	ge
;

166 ià(
­Ş_b¡_g‘_–em’t
(
b¡
, &
key
, 
NULL
, (**)&
e
) < 0) {

167  -
	gENOENT
;

170 
fËr
(
buf
, ".", 
NULL
, 0);

171 
fËr
(
buf
, "..", 
NULL
, 0);

172 
¡em_d©a
 
	gsd
 = { 
·th
, 
buf
, 
fËr
 };

173  -
­Ş_b¡_šÜd”_m­
(
b¡
, 
fu£_¡em_m©ch
, &
sd
);

176 
	$maš
(
¬gc
, *
¬gv
[])

178 ià((
b¡
 = 
	`­Ş_b¡_ü—‹
(
fu£_comp
, 
NULL
)) < 0) {

181 
size_t
 
i
 = 0; 
fs
[i].
·th
 !ğ
NULL
; i++) {

182 ià(
	`­Ş_b¡_š£¹
(
b¡
, &
fs
[
i
], 
NULL
) < 0) {

187 
fu£_İ”©iÚs
 
nÚ_mls_İ”
 = {

188 .
g‘©Œ
 = 
fu£_g‘©Œ
,

189 .
g‘x©Œ
 = 
fu£_g‘x©Œ
,

190 .
İ’
 = 
fu£_İ’
,

191 .
»ad
 = 
fu£_»ad
,

192 .
»addœ
 = 
fu£_»addœ
,

194  
	`fu£_maš
(
¬gc
, 
¬gv
, &
nÚ_mls_İ”
);

195 
	}
}

	@libsefs/tests/fcfile-tests.cc

26 
	~<cÚfig.h
>

28 
	~<CUn™/CUn™.h
>

29 
	~<£fs/fcfe.hh
>

30 
	~<¡ršg.h
>

32 
	#FC_CONFED
 
SRCDIR
 "/fe_cÚ‹xts.cÚãd"

	)

33 
	#FC_UNION
 
SRCDIR
 "/fe_cÚ‹xts.uniÚ"

	)

34 
	#FC_BROKEN
 
SRCDIR
 "/fe_cÚ‹xts.brok’"

	)

36 
	$fcfe_İ’
()

38 
£fs_fcfe
 *
fc1
 = 
NULL
, *
fc2
 = NULL;

39 
boŞ
 
İ’_çed
 = 
çl£
;

40 
­Ş_veùÜ_t
 *
fes
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
);

41 
	`CU_ASSERT_PTR_NOT_NULL_FATAL
(
fes
);

42 
	`­Ş_veùÜ_­³nd
(
fes
, (*)(
FC_CONFED
));

44 
Œy


46 
fc1
 = 
Ãw
 
	`£fs_fcfe
(
NULL
, NULL);

47 
fc2
 = 
Ãw
 
	`£fs_fcfe
(
fes
, 
NULL
, NULL);

49 
	`ÿtch
(...)

51 
	`CU_ASSERT
(0);

52 
İ’_çed
 = 
Œue
;

54 
d–‘e
 
fc1
;

55 
fc1
 = 
NULL
;

56 ià(
İ’_çed
)

58 
d–‘e
 
fc2
;

62 
	`­Ş_veùÜ_de¡roy
(&
fes
);

63 
fes
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
);

64 
	`CU_ASSERT_PTR_NOT_NULL_FATAL
(
fes
);

65 
	`­Ş_veùÜ_­³nd
(
fes
, (*)(
FC_UNION
));

66 
	`­Ş_veùÜ_­³nd
(
fes
, (*)(
FC_BROKEN
));

67 
size_t
 
num_m©ches
 = 0;

68 
Œy


70 
num_m©ches
 = 
fc2
->
	`­³ndFeLi¡
(
fes
);

71 
	`CU_ASSERT
(
num_m©ches
 == 1);

73 
	`ÿtch
(...)

75 
	`CU_ASSERT
(0);

77 
	`­Ş_veùÜ_de¡roy
(&
fes
);

79 
	`CU_ASSERT_FALSE
(
fc2
->
	`isMLS
());

80 
	`CU_ASSERT
(
fc2
->
	`fşi¡_ty³
(è=ğ
SEFS_FCLIST_TYPE_FCFILE
);

82 cÚ¡ 
­Ş_veùÜ_t
 *
feLi¡
 = 
fc2
->
	`feLi¡
();

83 
	`CU_ASSERT
(
	`­Ş_veùÜ_g‘_size
(
feLi¡
) == 2);

84 ià(
	`­Ş_veùÜ_g‘_size
(
feLi¡
) >= 1)

86 
	`CU_ASSERT_STRING_EQUAL
(
	`­Ş_veùÜ_g‘_–em’t
(
feLi¡
, 0), 
FC_CONFED
);

88 ià(
	`­Ş_veùÜ_g‘_size
(
feLi¡
) >= 2)

90 
	`CU_ASSERT_STRING_EQUAL
(
	`­Ş_veùÜ_g‘_–em’t
(
feLi¡
, 1), 
FC_UNION
);

93 
d–‘e
 
fc2
;

94 
	}
}

96 
fcfe_qu”y_m­_u£r_Ëe
(
£fs_fşi¡
 * 
fc
 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
£fs_’Œy
 * 
e
, *
d©a
)

98 cÚ¡ 
­Ş_cÚ‹xt_t
 *
	gcÚ
 = 
e
->
cÚ‹xt
();

99 ià(
¡rcmp
(
­Ş_cÚ‹xt_g‘_u£r
(
cÚ
), "lee_u") == 0)

101 
CU_ASSERT
(1);

102 *
	gnum_m©ches
 = 
¡©ic_ÿ¡
 < *>(
d©a
);

103 (*
	gnum_m©ches
)++;

104 
CU_ASSERT_STRING_EQUAL
(
e
->
Üigš
(), 
FC_CONFED
);

109 
CU_ASSERT
(0);

114 
	$fcfe_qu”y
()

116 
£fs_fcfe
 *
fc
 = 
NULL
;

117 
»tv®
;

118 
Œy


120 
fc
 = 
Ãw
 
	`£fs_fcfe
(
FC_CONFED
, 
NULL
, NULL);

121 
»tv®
 = 
fc
->
	`­³ndFe
(
FC_UNION
);

122 
	`CU_ASSERT
(
»tv®
 == 0);

124 
	`ÿtch
(...)

126 
	`CU_ASSERT_FATAL
(0);

129 
£fs_qu”y
 *
q
 = 
Ãw
 
	`£fs_qu”y
();

130 
q
->
	`u£r
("lee_u");

131 
num_m©ches
 = 0;

132 
»tv®
 = 
fc
->
	`runQu”yM­
(
q
, 
fcfe_qu”y_m­_u£r_Ëe
, &
num_m©ches
);

133 
	`CU_ASSERT
(
»tv®
 =ğ0 && 
num_m©ches
 == 2);

135 
q
->
	`u£r
(
NULL
);

136 
q
->
	`rŞe
("location_r");

137 
­Ş_veùÜ_t
 *
’Œ›s
 = 
fc
->
	`runQu”y
(
q
);

138 
	`CU_ASSERT_PTR_NOT_NULL
(
’Œ›s
);

139 
	`CU_ASSERT
(
	`­Ş_veùÜ_g‘_size
(
’Œ›s
) == 11);

140 
size_t
 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
’Œ›s
); i++)

142 
£fs_’Œy
 *
e
 = 
¡©ic_ÿ¡
 < sefs_’Œy * >(
	`­Ş_veùÜ_g‘_–em’t
(
’Œ›s
, 
i
));

143 cÚ¡ 
­Ş_cÚ‹xt_t
 *
cÚ
 = 
e
->
	`cÚ‹xt
();

144 cÚ¡ *
t
 = 
	`­Ş_cÚ‹xt_g‘_ty³
(
cÚ
);

145 
	`CU_ASSERT
(
	`¡rcmp
(
t
, "city_t") == 0 || strcmp(t, "state_t") == 0 || strcmp(t, "terrain_t") == 0);

146 *
s
 = 
e
->
	`toSŒšg
();

147 
	`´štf
("%s\n", 
s
);

148 
	`CU_ASSERT_PTR_NOT_NULL
(
s
);

149 
	`ä“
(
s
);

151 
	`­Ş_veùÜ_de¡roy
(&
’Œ›s
);

153 
q
->
	`ty³
("c™y_t", 
çl£
);

154 
’Œ›s
 = 
fc
->
	`runQu”y
(
q
);

155 
	`CU_ASSERT_PTR_NOT_NULL
(
’Œ›s
);

156 
	`CU_ASSERT
(
	`­Ş_veùÜ_g‘_size
(
’Œ›s
) == 3);

157 
boŞ
 
found_boÚsbÜo
 = 
çl£
, 
found_sh¬psburg
 = f®£, 
found_h¬³rs_ã¼y
 = false;

158 
size_t
 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
’Œ›s
); i++)

160 
£fs_’Œy
 *
e
 = 
¡©ic_ÿ¡
 < sefs_’Œy * >(
	`­Ş_veùÜ_g‘_–em’t
(
’Œ›s
, 
i
));

161 cÚ¡ *
p
 = 
e
->
	`·th
();

162 ià(
	`¡rcmp
(
p
, "/antietam/boonsboro") == 0)

164 
found_boÚsbÜo
 = 
Œue
;

166 ià(
	`¡rcmp
(
p
, "/sharpsburg") == 0)

168 
found_sh¬psburg
 = 
Œue
;

170 ià(
	`¡rcmp
(
p
, "/harpers_ferry") == 0)

172 
found_h¬³rs_ã¼y
 = 
Œue
;

176 
	`CU_ASSERT
(0);

179 
	`CU_ASSERT
(
found_boÚsbÜo
 && 
found_sh¬psburg
 && 
found_h¬³rs_ã¼y
);

180 
	`­Ş_veùÜ_de¡roy
(&
’Œ›s
);

182 
q
->
	`rŞe
(
NULL
);

183 
q
->
	`ty³
(
NULL
, 
çl£
);

184 
q
->
	`objeùCÏss
(
QPOL_CLASS_LNK_FILE
);

185 
’Œ›s
 = 
fc
->
	`runQu”y
(
q
);

186 
	`CU_ASSERT_PTR_NOT_NULL
(
’Œ›s
);

187 
	`CU_ASSERT
(
	`­Ş_veùÜ_g‘_size
(
’Œ›s
) == 6);

188 
size_t
 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
’Œ›s
); i++)

190 
£fs_’Œy
 *
e
 = 
¡©ic_ÿ¡
 < sefs_’Œy * >(
	`­Ş_veùÜ_g‘_–em’t
(
’Œ›s
, 
i
));

191 
ušt32_t
 
objşass
 = 
e
->
	`objeùCÏss
();

192 
	`CU_ASSERT
(
objşass
 =ğ
QPOL_CLASS_LNK_FILE
 || objşas =ğ
QPOL_CLASS_ALL
);

194 
	`­Ş_veùÜ_de¡roy
(&
’Œ›s
);

196 
q
->
	`objeùCÏss
("file");

197 
’Œ›s
 = 
fc
->
	`runQu”y
(
q
);

198 
	`CU_ASSERT_PTR_NOT_NULL
(
’Œ›s
);

199 
	`CU_ASSERT
(
	`­Ş_veùÜ_g‘_size
(
’Œ›s
) == 8);

200 
size_t
 
num_fes
 = 0, 
num_®ls
 = 0;

201 
size_t
 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
’Œ›s
); i++)

203 
£fs_’Œy
 *
e
 = 
¡©ic_ÿ¡
 < sefs_’Œy * >(
	`­Ş_veùÜ_g‘_–em’t
(
’Œ›s
, 
i
));

204 
ušt32_t
 
objşass
 = 
e
->
	`objeùCÏss
();

205 ià(
objşass
 =ğ
QPOL_CLASS_FILE
)

207 
num_fes
++;

209 ià(
objşass
 =ğ
QPOL_CLASS_ALL
)

211 
num_®ls
++;

215 
	`CU_ASSERT
(0);

218 
	`CU_ASSERT
(
num_fes
 =ğ4 && 
num_®ls
 == 4);

219 
	`­Ş_veùÜ_de¡roy
(&
’Œ›s
);

222 
q
->
	`¿nge
("s0", 
APOL_QUERY_EXACT
);

223 
q
->
	`šode
(42);

224 
q
->
	`dev
("first_maryland_campaign");

225 
’Œ›s
 = 
fc
->
	`runQu”y
(
q
);

226 
	`CU_ASSERT_PTR_NOT_NULL
(
’Œ›s
);

227 
	`CU_ASSERT
(
	`­Ş_veùÜ_g‘_size
(
’Œ›s
) == 8);

228 
num_fes
 = 0, 
num_®ls
 = 0;

229 
size_t
 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
’Œ›s
); i++)

231 
£fs_’Œy
 *
e
 = 
¡©ic_ÿ¡
 < sefs_’Œy * >(
	`­Ş_veùÜ_g‘_–em’t
(
’Œ›s
, 
i
));

232 
ušt32_t
 
objşass
 = 
e
->
	`objeùCÏss
();

233 ià(
objşass
 =ğ
QPOL_CLASS_FILE
)

235 
num_fes
++;

237 ià(
objşass
 =ğ
QPOL_CLASS_ALL
)

239 
num_®ls
++;

243 
	`CU_ASSERT
(0);

246 
	`CU_ASSERT
(
num_fes
 =ğ4 && 
num_®ls
 == 4);

247 
	`­Ş_veùÜ_de¡roy
(&
’Œ›s
);

249 
q
->
	`objeùCÏss
((cÚ¡ *)
NULL
);

250 
q
->
	`·th
("/sharpsburg/main_street");

251 
’Œ›s
 = 
fc
->
	`runQu”y
(
q
);

252 
	`CU_ASSERT_PTR_NOT_NULL
(
’Œ›s
);

253 
	`CU_ASSERT
(
	`­Ş_veùÜ_g‘_size
(
’Œ›s
) == 0);

254 
	`­Ş_veùÜ_de¡roy
(&
’Œ›s
);

256 
q
->
	`·th
("/sharpsburg/east_woods/hooker");

257 
’Œ›s
 = 
fc
->
	`runQu”y
(
q
);

258 
	`CU_ASSERT_PTR_NOT_NULL
(
’Œ›s
);

259 
	`CU_ASSERT
(
	`­Ş_veùÜ_g‘_size
(
’Œ›s
) == 2);

260 
boŞ
 
found_—¡_woods
 = 
çl£
, 
found_hook”
 = false;

261 
size_t
 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
’Œ›s
); i++)

263 
£fs_’Œy
 *
e
 = 
¡©ic_ÿ¡
 < sefs_’Œy * >(
	`­Ş_veùÜ_g‘_–em’t
(
’Œ›s
, 
i
));

264 cÚ¡ *
·th
 = 
e
->
	`·th
();

265 ià(
	`¡rcmp
(
·th
, "/sharpsburg/east_woods(/.*)?") == 0)

267 
found_—¡_woods
 = 
Œue
;

269 ià(
	`¡rcmp
(
·th
, "/sharpsburg/east_woods/hooker") == 0)

271 
found_hook”
 = 
Œue
;

275 
	`CU_ASSERT
(0);

278 
	`CU_ASSERT
(
found_—¡_woods
 && 
found_hook”
);

279 
	`­Ş_veùÜ_de¡roy
(&
’Œ›s
);

281 
q
->
	`·th
(
NULL
);

282 
q
->
	`u£r
("hill");

283 
q
->
	`»gex
(
Œue
);

284 
’Œ›s
 = 
fc
->
	`runQu”y
(
q
);

285 
	`CU_ASSERT_PTR_NOT_NULL
(
’Œ›s
);

286 
	`CU_ASSERT
(
	`­Ş_veùÜ_g‘_size
(
’Œ›s
) == 2);

287 
	`­Ş_veùÜ_de¡roy
(&
’Œ›s
);

289 
q
->
	`u£r
("hilly");

290 
’Œ›s
 = 
fc
->
	`runQu”y
(
q
);

291 
	`CU_ASSERT_PTR_NOT_NULL
(
’Œ›s
);

292 
	`CU_ASSERT
(
	`­Ş_veùÜ_g‘_size
(
’Œ›s
) == 0);

293 
	`­Ş_veùÜ_de¡roy
(&
’Œ›s
);

295 
q
->
	`u£r
(
NULL
);

296 
q
->
	`·th
("/sharpsburg/dunker");

297 
’Œ›s
 = 
fc
->
	`runQu”y
(
q
);

298 
	`CU_ASSERT_PTR_NOT_NULL
(
’Œ›s
);

299 
	`CU_ASSERT
(
	`­Ş_veùÜ_g‘_size
(
’Œ›s
) == 1);

300 
size_t
 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
’Œ›s
); i++)

302 
£fs_’Œy
 *
e
 = 
¡©ic_ÿ¡
 < sefs_’Œy * >(
	`­Ş_veùÜ_g‘_–em’t
(
’Œ›s
, 
i
));

303 cÚ¡ 
­Ş_cÚ‹xt_t
 *
cÚ
 = 
e
->
	`cÚ‹xt
();

304 
	`CU_ASSERT_PTR_NOT_NULL
(
cÚ
);

305 
	`CU_ASSERT_STRING_EQUAL
(
	`­Ş_cÚ‹xt_g‘_u£r
(
cÚ
), "");

306 
	`CU_ASSERT_STRING_EQUAL
(
	`­Ş_cÚ‹xt_g‘_rŞe
(
cÚ
), "");

307 
	`CU_ASSERT_STRING_EQUAL
(
	`­Ş_cÚ‹xt_g‘_ty³
(
cÚ
), "");

309 
	`­Ş_veùÜ_de¡roy
(&
’Œ›s
);

311 
d–‘e
 
q
;

312 
d–‘e
 
fc
;

313 
	}
}

317 
CU_Te¡Info
 
	gfcfe_‹¡s
[] = {

318 {"fcfİ’šg fes", 
fcfe_İ’
}

320 {"fcfqu”›s", 
fcfe_qu”y
}

322 
CU_TEST_INFO_NULL


325 
	$fcfe_š™
()

328 
	}
}

330 
	$fcfe_ş—nup
()

333 
	}
}

	@libsefs/tests/fcfile-tests.hh

26 #iâdeà
FCFILE_TESTS_H


27 
	#FCFILE_TESTS_H


	)

29 
	~<CUn™/CUn™.h
>

31 
CU_Te¡Info
 
fcfe_‹¡s
[];

32 
fcfe_š™
();

33 
fcfe_ş—nup
();

	@libsefs/tests/libsefs-tests.cc

26 
	~<cÚfig.h
>

28 
	~<CUn™/CUn™.h
>

29 
	~<CUn™/Basic.h
>

31 
	~"fcfe-‹¡s.hh
"

33 
	$maš
()

35 ià(
	`CU_š™Ÿlize_»gi¡ry
(è!ğ
CUE_SUCCESS
)

37  
	`CU_g‘_”rÜ
();

40 
CU_Su™eInfo
 
su™es
[] = {

41 {"fcfe", 
fcfe_š™
, 
fcfe_ş—nup
, 
fcfe_‹¡s
}

43 
CU_SUITE_INFO_NULL


46 
	`CU_»gi¡”_su™es
(
su™es
);

47 
	`CU_basic_£t_mode
(
CU_BRM_VERBOSE
);

48 
	`CU_basic_run_‹¡s
();

49 
num_çu»s
 = 
	`CU_g‘_numb”_of_çu»_»cÜds
();

50 
	`CU_ş—nup_»gi¡ry
();

51  ()
num_çu»s
;

52 
	}
}

	@python/setools/seinfo.c

33 
	~"PythÚ.h
"

36 
	~<­Ş/pŞicy.h
>

37 
	~<­Ş/pŞicy-qu”y.h
>

38 
	~<­Ş/»nd”.h
>

39 
	~<­Ş/ut.h
>

40 
	~<­Ş/veùÜ.h
>

43 
	~<qpŞ/pŞicy.h
>

44 
	~<qpŞ/ut.h
>

47 
	~<”ºo.h
>

48 
	~<¡dlib.h
>

49 
	~<¡dio.h
>

50 
	~<¡ršg.h
>

51 
	~<as£¹.h
>

53 
	#COPYRIGHT_INFO
 "Cİyrighˆ(Cè2003-2007 T»sy TechnŞogy, LLC"

	)

54 *
	gpŞicy_fe
 = 
NULL
;

56 
	ešput


58 
	mTYPE
, 
	mATTRIBUTE
, 
	mROLE
, 
	mUSER
, 
	mPORT
,

68 
PyObjeù
* 
	$g‘_©Œ
(cÚ¡ 
qpŞ_ty³_t
 * 
ty³_d©um
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicydb
)

70 
»tv®
 = -1;

71 
PyObjeù
 *
diù
 = 
	`PyDiù_New
();

72 cÚ¡ 
qpŞ_ty³_t
 *
©Œ_d©um
 = 
NULL
;

73 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

74 cÚ¡ *
©Œ_Çme
 = 
NULL
, *
ty³_Çme
 = NULL;

75 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicydb
);

76 
i§‰r
;

78 ià(
	`qpŞ_ty³_g‘_Çme
(
q
, 
ty³_d©um
, &
©Œ_Çme
))

79 
ş—nup
;

80 
PyObjeù
 *
obj
 = 
	`PySŒšg_FromSŒšg
(
©Œ_Çme
);

81 
	`PyDiù_S‘I‹mSŒšg
(
diù
, "Çme", 
obj
);

82 
	`Py_DECREF
(
obj
);

85 ià(
	`qpŞ_ty³_g‘_i§‰r
(
q
, 
ty³_d©um
, &
i§‰r
))

86 
ş—nup
;

87 ià(
i§‰r
) {

88 ià(
	`qpŞ_ty³_g‘_ty³_™”
(
q
, 
ty³_d©um
, &
™”
))

89 
ş—nup
;

90 
PyObjeù
 *
li¡
 = 
	`PyLi¡_New
(0);

91 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

92 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
©Œ_d©um
))

93 
ş—nup
;

94 ià(
	`qpŞ_ty³_g‘_Çme
(
q
, 
©Œ_d©um
, &
ty³_Çme
))

95 
ş—nup
;

96 
PyObjeù
 *
obj
 = 
	`PySŒšg_FromSŒšg
(
ty³_Çme
);

97 
	`PyLi¡_Aµ’d
(
li¡
, 
obj
);

98 
	`Py_DECREF
(
obj
);

100 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

101 
	`PyDiù_S‘I‹mSŒšg
(
diù
, "ty³s", 
li¡
);

102 
	`Py_DECREF
(
li¡
);

104 
ş—nup
;

106 
»tv®
 = 0;

107 
ş—nup
:

108 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

109 ià(
»tv®
) {

110 
	`Py_DECREF
(
diù
);

111  
NULL
;

113  
diù
;

114 
	}
}

129 
PyObjeù
* 
	$g‘_©Œibs
(cÚ¡ *
Çme
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicydb
)

131 
»tv®
 = -1;

132 
PyObjeù
 *
li¡
 = 
	`PyLi¡_New
(0);

133 
­Ş_©Œ_qu”y_t
 *
©Œ_qu”y
 = 
NULL
;

134 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

135 cÚ¡ 
qpŞ_ty³_t
 *
ty³_d©um
 = 
NULL
;

136 
size_t
 
n_©Œs
, 
i
;

139 ià(
Çme
 !ğ
NULL
) {

140 
©Œ_qu”y
 = 
	`­Ş_©Œ_qu”y_ü—‹
();

141 ià(!
©Œ_qu”y
)

142 
ş—nup
;

143 ià(
	`­Ş_©Œ_qu”y_£t_©Œ
(
pŞicydb
, 
©Œ_qu”y
, 
Çme
))

144 
ş—nup
;

145 ià(
	`­Ş_©Œ_g‘_by_qu”y
(
pŞicydb
, 
©Œ_qu”y
, &
v
))

146 
ş—nup
;

147 
	`­Ş_©Œ_qu”y_de¡roy
(&
©Œ_qu”y
);

148 ià(
	`­Ş_veùÜ_g‘_size
(
v
) == 0) {

149 
	`­Ş_veùÜ_de¡roy
(&
v
);

150 
”ºo
 = 
EINVAL
;

151 
ş—nup
;

154 
ty³_d©um
 = 
	`­Ş_veùÜ_g‘_–em’t
(
v
, (
size_t
) 0);

155 
PyObjeù
 *
obj
 = 
	`g‘_©Œ
(
ty³_d©um
, 
pŞicydb
);

156 
	`PyLi¡_Aµ’d
(
li¡
, 
obj
);

157 
	`Py_DECREF
(
obj
);

159 
©Œ_qu”y
 = 
	`­Ş_©Œ_qu”y_ü—‹
();

160 ià(!
©Œ_qu”y
)

161 
ş—nup
;

162 ià(
	`­Ş_©Œ_g‘_by_qu”y
(
pŞicydb
, 
©Œ_qu”y
, &
v
))

163 
ş—nup
;

164 
	`­Ş_©Œ_qu”y_de¡roy
(&
©Œ_qu”y
);

165 
n_©Œs
 = 
	`­Ş_veùÜ_g‘_size
(
v
);

167 
i
 = 0; i < 
n_©Œs
; i++) {

169 
ty³_d©um
 = (
qpŞ_ty³_t
 *è
	`­Ş_veùÜ_g‘_–em’t
(
v
, (
size_t
è
i
);

170 ià(!
ty³_d©um
)

171 
ş—nup
;

172 
PyObjeù
 *
obj
 = 
	`g‘_©Œ
(
ty³_d©um
, 
pŞicydb
);

173 
	`PyLi¡_Aµ’d
(
li¡
, 
obj
);

174 
	`Py_DECREF
(
obj
);

177 
	`­Ş_veùÜ_de¡roy
(&
v
);

179 
»tv®
 = 0;

180 
ş—nup
:

181 
	`­Ş_©Œ_qu”y_de¡roy
(&
©Œ_qu”y
);

182 
	`­Ş_veùÜ_de¡roy
(&
v
);

183 ià(
»tv®
) {

184 
	`Py_DECREF
(
li¡
);

185 
	`PyE¼_S‘SŒšg
(
PyExc_RuÁimeE¼Ü
,
	`¡»¼Ü
(
”ºo
));

186  
NULL
;

188  
li¡
;

189 
	}
}

198 
PyObjeù
* 
	$g‘_ty³_©Œs
(cÚ¡ 
qpŞ_ty³_t
 * 
ty³_d©um
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicydb
)

200 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

201 cÚ¡ *
©Œ_Çme
 = 
NULL
;

202 cÚ¡ 
qpŞ_ty³_t
 *
©Œ_d©um
 = 
NULL
;

203 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicydb
);

205 ià(
	`qpŞ_ty³_g‘_©Œ_™”
(
q
, 
ty³_d©um
, &
™”
))

206 
ş—nup
;

207 
PyObjeù
 *
li¡
 = 
	`PyLi¡_New
(0);

208 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

209 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
©Œ_d©um
))

210 
ş—nup
;

211 ià(
	`qpŞ_ty³_g‘_Çme
(
q
, 
©Œ_d©um
, &
©Œ_Çme
))

212 
ş—nup
;

213 
PyObjeù
 *
obj
 = 
	`PySŒšg_FromSŒšg
(
©Œ_Çme
);

214 
	`PyLi¡_Aµ’d
(
li¡
, 
obj
);

215 
	`Py_DECREF
(
obj
);

218 
ş—nup
:

219 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

220  
li¡
;

221 
	}
}

223 
PyObjeù
* 
	$g‘_ty³
ĞcÚ¡ 
qpŞ_ty³_t
 * 
ty³_d©um
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicydb
) {

225 
PyObjeù
 *
diù
 = 
	`PyDiù_New
();

226 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicydb
);

227 cÚ¡ *
ty³_Çme
 = 
NULL
;

229 
i§lŸs
, 
i¥”missive
, 
i§‰r
;

231 ià(
	`qpŞ_ty³_g‘_Çme
(
q
, 
ty³_d©um
, &
ty³_Çme
))

232 
ş—nup
;

233 ià(
	`qpŞ_ty³_g‘_i§lŸs
(
q
, 
ty³_d©um
, &
i§lŸs
))

234 
ş—nup
;

235 ià(
	`qpŞ_ty³_g‘_i§‰r
(
q
, 
ty³_d©um
, &
i§‰r
))

236 
ş—nup
;

237 ià(
	`qpŞ_ty³_g‘_i¥”missive
(
q
, 
ty³_d©um
, &
i¥”missive
))

238 
ş—nup
;

240 
PyObjeù
 *
obj
 = 
	`PySŒšg_FromSŒšg
(
ty³_Çme
);

241 
	`PyDiù_S‘I‹mSŒšg
(
diù
, "Çme", 
obj
);

242 
	`Py_DECREF
(
obj
);

243 
obj
 = 
	`PyBoŞ_FromLÚg
(
i¥”missive
);

244 
	`PyDiù_S‘I‹mSŒšg
(
diù
, "³rmissive", 
obj
);

245 
	`Py_DECREF
(
obj
);

246 ià(!
i§‰r
 && !
i§lŸs
) {

247 
obj
 = 
	`g‘_ty³_©Œs
(
ty³_d©um
, 
pŞicydb
);

248 
	`PyDiù_S‘I‹mSŒšg
(
diù
, "©Œibu‹s", 
obj
);

249 
	`Py_DECREF
(
obj
);

251  
diù
;

252 
ş—nup
:

253 
	`Py_DECREF
(
diù
);

254  
NULL
;

255 
	}
}

265 
PyObjeù
* 
	$g‘_u£r
(cÚ¡ 
qpŞ_u£r_t
 * 
u£r_d©um
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicydb
)

267 
PyObjeù
 *
diù
 = 
NULL
;

268 cÚ¡ 
qpŞ_rŞe_t
 *
rŞe_d©um
 = 
NULL
;

269 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

270 cÚ¡ 
qpŞ_mls_¿nge_t
 *
¿nge
 = 
NULL
;

271 cÚ¡ 
qpŞ_mls_Ëv–_t
 *
dæt_Ëv–
 = 
NULL
;

272 
­Ş_mls_Ëv–_t
 *
­_lvl
 = 
NULL
;

273 
­Ş_mls_¿nge_t
 *
­_¿nge
 = 
NULL
;

274 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicydb
);

275 *
tmp
;

276 cÚ¡ *
u£r_Çme
, *
rŞe_Çme
;

278 ià(
	`qpŞ_u£r_g‘_Çme
(
q
, 
u£r_d©um
, &
u£r_Çme
))

279 
ş—nup
;

281 
diù
 = 
	`PyDiù_New
();

282 
PyObjeù
 *
obj
 = 
	`PySŒšg_FromSŒšg
(
u£r_Çme
);

283 
	`PyDiù_S‘I‹mSŒšg
(
diù
, "Çme", 
obj
);

284 
	`Py_DECREF
(
obj
);

286 ià(
	`qpŞ_pŞicy_has_ÿ·b™y
(
q
, 
QPOL_CAP_MLS
)) {

287 ià(
	`qpŞ_u£r_g‘_dæev–
(
q
, 
u£r_d©um
, &
dæt_Ëv–
))

288 
ş—nup
;

289 
­_lvl
 = 
	`­Ş_mls_Ëv–_ü—‹_äom_qpŞ_mls_Ëv–
(
pŞicydb
, 
dæt_Ëv–
);

290 
tmp
 = 
	`­Ş_mls_Ëv–_»nd”
(
pŞicydb
, 
­_lvl
);

291 ià(!
tmp
)

292 
ş—nup
;

293 
obj
 = 
	`PySŒšg_FromSŒšg
(
tmp
);

294 
	`PyDiù_S‘I‹mSŒšg
(
diù
, "Ëv–", 
obj
);

295 
	`Py_DECREF
(
obj
);

296 
	`ä“
(
tmp
);

298 ià(
	`qpŞ_u£r_g‘_¿nge
(
q
, 
u£r_d©um
, &
¿nge
))

299 
ş—nup
;

300 
­_¿nge
 = 
	`­Ş_mls_¿nge_ü—‹_äom_qpŞ_mls_¿nge
(
pŞicydb
, 
¿nge
);

301 
tmp
 = 
	`­Ş_mls_¿nge_»nd”
(
pŞicydb
, 
­_¿nge
);

302 ià(!
tmp
)

303 
ş—nup
;

304 
obj
 = 
	`PySŒšg_FromSŒšg
(
tmp
);

305 
	`PyDiù_S‘I‹mSŒšg
(
diù
, "¿nge", 
obj
);

306 
	`Py_DECREF
(
obj
);

307 
	`ä“
(
tmp
);

310 ià(
	`qpŞ_u£r_g‘_rŞe_™”
(
q
, 
u£r_d©um
, &
™”
))

311 
ş—nup
;

312 
PyObjeù
 *
li¡
 = 
	`PyLi¡_New
(0);

313 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

314 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
rŞe_d©um
)) {

315 
	`Py_DECREF
(
li¡
);

316 
ş—nup
;

318 ià(
	`qpŞ_rŞe_g‘_Çme
(
q
, 
rŞe_d©um
, &
rŞe_Çme
)) {

319 
	`Py_DECREF
(
li¡
);

320 
ş—nup
;

322 
PyObjeù
 *
obj
 = 
	`PySŒšg_FromSŒšg
(
rŞe_Çme
);

323 
	`PyLi¡_Aµ’d
(
li¡
, 
obj
);

324 
	`Py_DECREF
(
obj
);

326 
	`PyDiù_S‘I‹mSŒšg
(
diù
, "rŞes", 
li¡
);

327 
	`Py_DECREF
(
li¡
);

329 
ş—nup
:

330 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

331 
	`­Ş_mls_Ëv–_de¡roy
(&
­_lvl
);

332 
	`­Ş_mls_¿nge_de¡roy
(&
­_¿nge
);

333  
diù
;

334 
	}
}

349 
PyObjeù
* 
	$g‘_u£rs
(cÚ¡ *
Çme
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicydb
)

351 
»tv®
 = -1;

352 
PyObjeù
 *
li¡
 = 
	`PyLi¡_New
(0);

353 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

354 cÚ¡ 
qpŞ_u£r_t
 *
u£r_d©um
 = 
NULL
;

355 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicydb
);

357 ià(
Çme
 !ğ
NULL
) {

358 ià(
	`qpŞ_pŞicy_g‘_u£r_by_Çme
(
q
, 
Çme
, &
u£r_d©um
)) {

359 
”ºo
 = 
EINVAL
;

360 
ş—nup
;

362 
PyObjeù
 *
obj
 = 
	`g‘_u£r
(
u£r_d©um
, 
pŞicydb
);

363 
	`PyLi¡_Aµ’d
(
li¡
, 
obj
);

364 
	`Py_DECREF
(
obj
);

366 ià(
	`qpŞ_pŞicy_g‘_u£r_™”
(
q
, &
™”
))

367 
ş—nup
;

369 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

370 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
u£r_d©um
))

371 
ş—nup
;

372 
PyObjeù
 *
obj
 = 
	`g‘_u£r
(
u£r_d©um
, 
pŞicydb
);

373 
	`PyLi¡_Aµ’d
(
li¡
, 
obj
);

374 
	`Py_DECREF
(
obj
);

376 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

379 
»tv®
 = 0;

380 
ş—nup
:

381 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

382 ià(
»tv®
) {

383 
	`Py_DECREF
(
li¡
);

384 
	`PyE¼_S‘SŒšg
(
PyExc_RuÁimeE¼Ü
,
	`¡»¼Ü
(
”ºo
));

385  
NULL
;

387  
li¡
;

388 
	}
}

398 
PyObjeù
* 
	$g‘_rŞe
(cÚ¡ 
qpŞ_rŞe_t
 * 
rŞe_d©um
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicydb
)

400 
»tv®
 = -1;

401 
PyObjeù
 *
diù
 = 
	`PyDiù_New
();

402 cÚ¡ *
rŞe_Çme
 = 
NULL
, *
ty³_Çme
 = NULL;

403 cÚ¡ 
qpŞ_rŞe_t
 *
dom_d©um
 = 
NULL
;

404 cÚ¡ 
qpŞ_ty³_t
 *
ty³_d©um
 = 
NULL
;

405 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

406 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicydb
);

407 
size_t
 
n_dom
 = 0, 
n_ty³s
 = 0;

409 ià(
	`qpŞ_rŞe_g‘_Çme
(
q
, 
rŞe_d©um
, &
rŞe_Çme
))

410 
ş—nup
;

412 
PyObjeù
 *
obj
 = 
	`PySŒšg_FromSŒšg
(
rŞe_Çme
);

413 
	`PyDiù_S‘I‹mSŒšg
(
diù
, "Çme", 
obj
);

414 
	`Py_DECREF
(
obj
);

416 ià(
	`qpŞ_rŞe_g‘_domš©e_™”
(
q
, 
rŞe_d©um
, &
™”
))

417 
ş—nup
;

418 ià(
	`qpŞ_™”©Ü_g‘_size
(
™”
, &
n_dom
))

419 
ş—nup
;

420 ià(()
n_dom
 > 0) {

421 
PyObjeù
 *
li¡
 = 
	`PyLi¡_New
(0);

422 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

423 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
dom_d©um
))

424 
ş—nup
;

425 ià(
	`qpŞ_rŞe_g‘_Çme
(
q
, 
dom_d©um
, &
rŞe_Çme
))

426 
ş—nup
;

427 
PyObjeù
 *
obj
 = 
	`PySŒšg_FromSŒšg
(
rŞe_Çme
);

428 
	`PyLi¡_Aµ’d
(
li¡
, 
obj
);

429 
	`Py_DECREF
(
obj
);

431 
	`PyDiù_S‘I‹mSŒšg
(
diù
, "domš©e", 
li¡
);

432 
	`Py_DECREF
(
li¡
);

434 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

436 ià(
	`qpŞ_rŞe_g‘_ty³_™”
(
q
, 
rŞe_d©um
, &
™”
))

437 
ş—nup
;

438 ià(
	`qpŞ_™”©Ü_g‘_size
(
™”
, &
n_ty³s
))

439 
ş—nup
;

440 ià(()
n_ty³s
 > 0) {

441 
PyObjeù
 *
li¡
 = 
	`PyLi¡_New
(0);

443 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

444 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
ty³_d©um
))

445 
ş—nup
;

446 ià(
	`qpŞ_ty³_g‘_Çme
(
q
, 
ty³_d©um
, &
ty³_Çme
))

447 
ş—nup
;

448 
PyObjeù
 *
obj
 = 
	`PySŒšg_FromSŒšg
(
ty³_Çme
);

449 
	`PyLi¡_Aµ’d
(
li¡
, 
obj
);

450 
	`Py_DECREF
(
obj
);

452 
	`PyDiù_S‘I‹mSŒšg
(
diù
, "ty³s", 
li¡
);

453 
	`Py_DECREF
(
li¡
);

456 
»tv®
 = 0;

457 
ş—nup
:

458 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

459 ià(
»tv®
) {

460 
	`Py_DECREF
(
diù
);

461 
	`PyE¼_S‘SŒšg
(
PyExc_RuÁimeE¼Ü
,
	`¡»¼Ü
(
”ºo
));

462  
NULL
;

464  
diù
;

465 
	}
}

479 
PyObjeù
* 
	$g‘_pÜts
(cÚ¡ *
num
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicydb
)

481 
PyObjeù
 *
li¡
 = 
	`PyLi¡_New
(0);

482 
»tv®
 = -1;

483 cÚ¡ 
qpŞ_pÜtcÚ_t
 *
pÜtcÚ
 = 
NULL
;

484 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

485 
ušt16_t
 
low_pÜt
, 
high_pÜt
;

486 
ušt8_t
 
ocÚ_´Ùo
;

487 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicydb
);

488 cÚ¡ 
qpŞ_cÚ‹xt_t
 *
ùxt
 = 
NULL
;

489 cÚ¡ *
´Ùo_¡r
;

490 
PyObjeù
 *
diù
;

491 cÚ¡ *
ty³
 = 
NULL
;

492 cÚ¡ 
­Ş_mls_¿nge_t
 *
¿nge
 = 
NULL
;

493 *
¿nge_¡r
 = 
NULL
;

494 
PyObjeù
 *
obj
 = 
NULL
;

495 
­Ş_cÚ‹xt_t
 *
c
 = 
NULL
;

497 ià(
	`qpŞ_pŞicy_g‘_pÜtcÚ_™”
(
q
, &
™”
))

498 
ş—nup
;

500 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

501 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
pÜtcÚ
))

502 
ş—nup
;

503 ià(
	`qpŞ_pÜtcÚ_g‘_low_pÜt
(
q
, 
pÜtcÚ
, &
low_pÜt
))

504 
ş—nup
;

505 ià(
	`qpŞ_pÜtcÚ_g‘_high_pÜt
(
q
, 
pÜtcÚ
, &
high_pÜt
))

506 
ş—nup
;

507 ià(
	`qpŞ_pÜtcÚ_g‘_´ÙocŞ
(
q
, 
pÜtcÚ
, &
ocÚ_´Ùo
))

508 
ş—nup
;

509 ià(
num
) {

510 ià(
	`©oi
(
num
è< 
low_pÜt
 ||‡toiÒumè> 
high_pÜt
)

514 ià((
ocÚ_´Ùo
 !ğ
IPPROTO_TCP
) &&

515 (
ocÚ_´Ùo
 !ğ
IPPROTO_UDP
))

516 
ş—nup
;

518 ià(
	`qpŞ_pÜtcÚ_g‘_cÚ‹xt
(
q
, 
pÜtcÚ
, &
ùxt
)) {

519 
	`PyE¼_S‘SŒšg
(
PyExc_RuÁimeE¼Ü
, "Could‚ot get for…ort context.");

520 
ş—nup
;

523 ià((
´Ùo_¡r
 = 
	`­Ş_´ÙocŞ_to_¡r
(
ocÚ_´Ùo
)è=ğ
NULL
) {

524 
	`PyE¼_S‘SŒšg
(
PyExc_RuÁimeE¼Ü
, "Invalid…rotocol for…ort");

525 
ş—nup
;

528 ià((
c
 = 
	`­Ş_cÚ‹xt_ü—‹_äom_qpŞ_cÚ‹xt
(
pŞicydb
, 
ùxt
)è=ğ
NULL
) {

529 
ş—nup
;

532 if((
ty³
 = 
	`­Ş_cÚ‹xt_g‘_ty³
(
c
)è=ğ
NULL
) {

533 
	`­Ş_cÚ‹xt_de¡roy
(&
c
);

534 
ş—nup
;

537 
diù
 = 
	`PyDiù_New
();

538 
obj
 = 
	`PySŒšg_FromSŒšg
(
ty³
);

539 
	`PyDiù_S‘I‹mSŒšg
(
diù
, "ty³", 
obj
);

540 
	`Py_DECREF
(
obj
);

542 if((
¿nge
 = 
	`­Ş_cÚ‹xt_g‘_¿nge
(
c
)è=ğ
NULL
) {

543 
ş—nup
;

546 
¿nge_¡r
 = 
	`­Ş_mls_¿nge_»nd”
(
pŞicydb
, 
¿nge
);

547 ià(
¿nge_¡r
 =ğ
NULL
) {

548 
ş—nup
;

550 
obj
 = 
	`PySŒšg_FromSŒšg
(
¿nge_¡r
);

551 
	`PyDiù_S‘I‹mSŒšg
(
diù
, "¿nge", 
obj
);

552 
	`Py_DECREF
(
obj
);

554 
obj
 = 
	`PySŒšg_FromSŒšg
(
´Ùo_¡r
);

555 
	`PyDiù_S‘I‹mSŒšg
(
diù
, "´ÙocŞ", 
obj
);

556 
	`Py_DECREF
(
obj
);

558 
obj
 = 
	`PyIÁ_FromLÚg
(
high_pÜt
);

559 
	`PyDiù_S‘I‹mSŒšg
(
diù
, "high", 
obj
);

560 
	`Py_DECREF
(
obj
);

562 
obj
 = 
	`PyIÁ_FromLÚg
(
low_pÜt
);

563 
	`PyDiù_S‘I‹mSŒšg
(
diù
, "low", 
obj
);

564 
	`Py_DECREF
(
obj
);

566 
	`PyLi¡_Aµ’d
(
li¡
, 
diù
);

567 
	`Py_DECREF
(
diù
);

569 
»tv®
 = 0;

570 
ş—nup
:

571 
	`ä“
(
¿nge_¡r
);

572 
	`­Ş_cÚ‹xt_de¡roy
(&
c
);

573 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

575 ià(
»tv®
) {

576 
	`Py_DECREF
(
li¡
);

577 
	`PyE¼_S‘SŒšg
(
PyExc_RuÁimeE¼Ü
,
	`¡»¼Ü
(
”ºo
));

578  
NULL
;

580  
li¡
;

581 
	}
}

595 
PyObjeù
* 
	$g‘_rŞes
(cÚ¡ *
Çme
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicydb
)

597 
»tv®
 = -1;

598 
PyObjeù
 *
li¡
 = 
	`PyLi¡_New
(0);

599 cÚ¡ 
qpŞ_rŞe_t
 *
rŞe_d©um
 = 
NULL
;

600 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

601 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicydb
);

603 ià(
Çme
 !ğ
NULL
) {

604 ià(
	`qpŞ_pŞicy_g‘_rŞe_by_Çme
(
q
, 
Çme
, &
rŞe_d©um
)) {

605 
”ºo
 = 
EINVAL
;

606 
ş—nup
;

608 
PyObjeù
 *
obj
 = 
	`g‘_rŞe
(
rŞe_d©um
, 
pŞicydb
);

609 
	`PyLi¡_Aµ’d
(
li¡
, 
obj
);

610 
	`Py_DECREF
(
obj
);

612 ià(
	`qpŞ_pŞicy_g‘_rŞe_™”
(
q
, &
™”
))

613 
ş—nup
;

615 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

616 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
rŞe_d©um
))

617 
ş—nup
;

618 
PyObjeù
 *
obj
 = 
	`g‘_rŞe
(
rŞe_d©um
, 
pŞicydb
);

619 
	`PyLi¡_Aµ’d
(
li¡
, 
obj
);

620 
	`Py_DECREF
(
obj
);

622 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

625 
»tv®
 = 0;

626 
ş—nup
:

627 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

628 ià(
»tv®
) {

629 
	`Py_DECREF
(
li¡
);

630 
	`PyE¼_S‘SŒšg
(
PyExc_RuÁimeE¼Ü
,
	`¡»¼Ü
(
”ºo
));

631  
NULL
;

633  
li¡
;

634 
	}
}

648 
PyObjeù
* 
	$g‘_ty³s
(cÚ¡ *
Çme
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicydb
)

650 
»tv®
 = -1;

651 
PyObjeù
 *
li¡
 = 
	`PyLi¡_New
(0);

652 cÚ¡ 
qpŞ_ty³_t
 *
ty³_d©um
 = 
NULL
;

653 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

654 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicydb
);

657 ià(
Çme
 !ğ
NULL
) {

658 ià(
	`qpŞ_pŞicy_g‘_ty³_by_Çme
(
q
, 
Çme
, &
ty³_d©um
)) {

659 
”ºo
 = 
EINVAL
;

660 
ş—nup
;

662 
PyObjeù
 *
obj
 = 
	`g‘_ty³
(
ty³_d©um
, 
pŞicydb
);

663 
	`PyLi¡_Aµ’d
(
li¡
, 
obj
);

664 
	`Py_DECREF
(
obj
);

666 ià(
	`qpŞ_pŞicy_g‘_ty³_™”
(
q
, &
™”
))

667 
ş—nup
;

669 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

670 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
ty³_d©um
))

671 
ş—nup
;

672 
PyObjeù
 *
obj
 = 
	`g‘_ty³
(
ty³_d©um
, 
pŞicydb
);

673 
	`PyLi¡_Aµ’d
(
li¡
, 
obj
);

674 
	`Py_DECREF
(
obj
);

677 
»tv®
 = 0;

678 
ş—nup
:

679 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

680 ià(
»tv®
) {

681 
	`Py_DECREF
(
li¡
);

682 
	`PyE¼_S‘SŒšg
(
PyExc_RuÁimeE¼Ü
,
	`¡»¼Ü
(
”ºo
));

683  
NULL
;

685  
li¡
;

686 
	}
}

688 
PyObjeù
* 
	$£šfo
(
ty³
, cÚ¡ *
Çme
)

690 
¹
 = -1;

692 
­Ş_pŞicy_t
 *
pŞicydb
 = 
NULL
;

693 
­Ş_pŞicy_·th_t
 *
pŞ_·th
 = 
NULL
;

694 
­Ş_veùÜ_t
 *
mod_·ths
 = 
NULL
;

695 
­Ş_pŞicy_·th_ty³_e
 
·th_ty³
 = 
APOL_POLICY_PATH_TYPE_MONOLITHIC
;

696 
PyObjeù
* 
ouut
 = 
NULL
;

698 
¹
 = 
	`qpŞ_deçuÉ_pŞicy_fšd
(&
pŞicy_fe
);

699 ià(
¹
 != 0) {

700 
	`PyE¼_S‘SŒšg
(
PyExc_RuÁimeE¼Ü
,"No default…olicy found.");

701  
NULL
;

704 
pŞ_·th
 = 
	`­Ş_pŞicy_·th_ü—‹
(
·th_ty³
, 
pŞicy_fe
, 
mod_·ths
);

705 ià(!
pŞ_·th
) {

706 
	`ä“
(
pŞicy_fe
);

707 
	`­Ş_veùÜ_de¡roy
(&
mod_·ths
);

708 
	`PyE¼_S‘SŒšg
(
PyExc_RuÁimeE¼Ü
,
	`¡»¼Ü
(
ENOMEM
));

709  
NULL
;

711 
	`­Ş_veùÜ_de¡roy
(&
mod_·ths
);

713 
pŞicy_lßd_İtiÚs
 = 0;

714 
pŞicy_lßd_İtiÚs
 |ğ
QPOL_POLICY_OPTION_MATCH_SYSTEM
;

715 
pŞicydb
 = 
	`­Ş_pŞicy_ü—‹_äom_pŞicy_·th
(
pŞ_·th
, 
pŞicy_lßd_İtiÚs
, 
NULL
, NULL);

716 ià(!
pŞicydb
) {

717 
	`ä“
(
pŞicy_fe
);

718 
	`­Ş_pŞicy_·th_de¡roy
(&
pŞ_·th
);

719 
	`PyE¼_S‘SŒšg
(
PyExc_RuÁimeE¼Ü
,
	`¡»¼Ü
(
”ºo
));

720  
NULL
;

722 
	`ä“
(
pŞicy_fe
);

725 ià(
ty³
 =ğ
TYPE
)

726 
ouut
 = 
	`g‘_ty³s
(
Çme
, 
pŞicydb
);

728 ià(
ty³
 =ğ
ATTRIBUTE
)

729 
ouut
 = 
	`g‘_©Œibs
(
Çme
, 
pŞicydb
);

731 ià(
ty³
 =ğ
ROLE
)

732 
ouut
 = 
	`g‘_rŞes
(
Çme
, 
pŞicydb
);

734 ià(
ty³
 =ğ
USER
)

735 
ouut
 = 
	`g‘_u£rs
(
Çme
, 
pŞicydb
);

737 ià(
ty³
 =ğ
PORT
)

738 
ouut
 = 
	`g‘_pÜts
(
Çme
, 
pŞicydb
);

740 
	`­Ş_pŞicy_de¡roy
(&
pŞicydb
);

741 
	`­Ş_pŞicy_·th_de¡roy
(&
pŞ_·th
);

742  
ouut
;

743 
	}
}

745 
PyObjeù
 *
	$w¿p_£šfo
(
PyObjeù
 *
£lf
, PyObjeù *
¬gs
){

746 
ty³
;

747 *
Çme
;

749 ià(!
	`PyArg_P¬£Tu¶e
(
¬gs
, "iz", &
ty³
, &
Çme
))

750  
NULL
;

752  
	`Py_BudV®ue
("O",
	`£šfo
(
ty³
, 
Çme
));

754 
	}
}

756 
PyM‘hodDef
 
	gm‘hods
[] = {

757 {"£šfo", (
PyCFunùiÚ
è
w¿p_£šfo
, 
METH_VARARGS
},

758 {
NULL
, NULL, 0, NULL}

761 
	$š™_£šfo
(){

762 
PyObjeù
 *
m
;

763 
m
 = 
	`Py_In™ModuË
("_£šfo", 
m‘hods
);

764 
	`PyModuË_AddIÁCÚ¡ªt
(
m
, "ATTRIBUTE", 
ATTRIBUTE
);

765 
	`PyModuË_AddIÁCÚ¡ªt
(
m
, "PORT", 
PORT
);

766 
	`PyModuË_AddIÁCÚ¡ªt
(
m
, "ROLE", 
ROLE
);

767 
	`PyModuË_AddIÁCÚ¡ªt
(
m
, "TYPE", 
TYPE
);

768 
	`PyModuË_AddIÁCÚ¡ªt
(
m
, "USER", 
USER
);

769 
	}
}

	@python/setools/sesearch.c

34 
	~"PythÚ.h
"

37 
	~<­Ş/pŞicy.h
>

38 
	~<­Ş/pŞicy-qu”y.h
>

39 
	~<­Ş/»nd”.h
>

40 
	~<­Ş/ut.h
>

41 
	~<­Ş/veùÜ.h
>

44 
	~<qpŞ/pŞicy.h
>

45 
	~<qpŞ/pŞicy_ex‹nd.h
>

46 
	~<qpŞ/syn_ruË_qu”y.h
>

47 
	~<qpŞ/ut.h
>

50 
	~<”ºo.h
>

51 
	~<¡dlib.h
>

52 
	~<¡dio.h
>

53 
	~<as£¹.h
>

54 
	~<g‘İt.h
>

55 
	~<¡ršg.h
>

56 
	~<¡dboŞ.h
>

58 
	#COPYRIGHT_INFO
 "Cİyrighˆ(Cè2003-2007 T»sy TechnŞogy, LLC"

	)

59 *
	gpŞicy_fe
 = 
NULL
;

61 
	eİt_v®ues


63 
	mRULE_NEVERALLOW
 = 256, 
	mRULE_AUDIT
, 
	mRULE_AUDITALLOW
, 
	mRULE_DONTAUDIT
,

64 
	mRULE_ROLE_ALLOW
, 
	mRULE_ROLE_TRANS
, 
	mRULE_RANGE_TRANS
, 
	mRULE_ALL
,

65 
	mEXPR_ROLE_SOURCE
, 
	mEXPR_ROLE_TARGET


70 
	sİtiÚs


72 *
	m¤c_Çme
;

73 *
	mtgt_Çme
;

74 *
	m¤c_rŞe_Çme
;

75 *
	mtgt_rŞe_Çme
;

76 *
	mşass_Çme
;

77 *
	m³rmli¡
;

78 *
	mboŞ_Çme
;

79 
­Ş_veùÜ_t
 *
	mşass_veùÜ
;

80 
boŞ
 
	m®l
;

81 
boŞ
 
	mlš’o
;

82 
boŞ
 
	m£mªtic
;

83 
boŞ
 
	mšdœeù
;

84 
boŞ
 
	m®low
;

85 
boŞ
 
	mÇÎow
;

86 
boŞ
 
	maud™®low
;

87 
boŞ
 
	mdÚud™
;

88 
boŞ
 
	mty³
;

89 
boŞ
 
	m¹¿ns
;

90 
boŞ
 
	mrŞe_®low
;

91 
boŞ
 
	mrŞe_Œªs
;

92 
boŞ
 
	mu£»gex
;

93 
boŞ
 
	mshow_cÚd
;

94 
­Ş_veùÜ_t
 *
	m³rm_veùÜ
;

95 } 
	tİtiÚs_t
;

97 
	$³rfÜm_av_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
, cÚ¡ 
İtiÚs_t
 * 
İt
, 
­Ş_veùÜ_t
 ** 
v
)

99 
­Ş_avruË_qu”y_t
 *
avq
 = 
NULL
;

100 
ruËs
 = 0;

101 
”rÜ
 = 0;

102 *
tmp
 = 
NULL
, *
tok
 = NULL, *
s
 = NULL;

104 ià(!
pŞicy
 || !
İt
 || !
v
) {

105 
	`PyE¼_S‘SŒšg
(
PyExc_RuÁimeE¼Ü
,
	`¡»¼Ü
(
EINVAL
));

106 
”ºo
 = 
EINVAL
;

110 ià(!
İt
->
®l
 && !İt->
®low
 && !İt->
ÇÎow
 && !İt->
aud™®low
 && !İt->
dÚud™
) {

111 *
v
 = 
NULL
;

115 
avq
 = 
	`­Ş_avruË_qu”y_ü—‹
();

116 ià(!
avq
) {

117 
	`PyE¼_S‘SŒšg
(
PyExc_RuÁimeE¼Ü
,
	`¡»¼Ü
(
ENOMEM
));

118 
”ºo
 = 
ENOMEM
;

122 ià(
İt
->
®low
 || o±->
®l
)

123 
ruËs
 |ğ
QPOL_RULE_ALLOW
;

124 ià((
İt
->
ÇÎow
 || o±->
®l
è&& 
	`qpŞ_pŞicy_has_ÿ·b™y
(
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicy
), 
QPOL_CAP_NEVERALLOW
))

125 
ruËs
 |ğ
QPOL_RULE_NEVERALLOW
;

126 ià(
İt
->
aud™®low
 || o±->
®l
)

127 
ruËs
 |ğ
QPOL_RULE_AUDITALLOW
;

128 ià(
İt
->
dÚud™
 || o±->
®l
)

129 
ruËs
 |ğ
QPOL_RULE_DONTAUDIT
;

130 
	`­Ş_avruË_qu”y_£t_ruËs
(
pŞicy
, 
avq
, 
ruËs
);

131 
	`­Ş_avruË_qu”y_£t_»gex
(
pŞicy
, 
avq
, 
İt
->
u£»gex
);

132 ià(
İt
->
¤c_Çme
)

133 
	`­Ş_avruË_qu”y_£t_sourû
(
pŞicy
, 
avq
, 
İt
->
¤c_Çme
, o±->
šdœeù
);

134 ià(
İt
->
tgt_Çme
)

135 
	`­Ş_avruË_qu”y_£t_rg‘
(
pŞicy
, 
avq
, 
İt
->
tgt_Çme
, o±->
šdœeù
);

136 ià(
İt
->
boŞ_Çme
)

137 
	`­Ş_avruË_qu”y_£t_boŞ
(
pŞicy
, 
avq
, 
İt
->
boŞ_Çme
);

138 ià(
İt
->
şass_Çme
) {

139 ià(
İt
->
şass_veùÜ
 =ğ
NULL
) {

140 ià(
	`­Ş_avruË_qu”y_­³nd_şass
(
pŞicy
, 
avq
, 
İt
->
şass_Çme
)) {

141 
”rÜ
 = 
”ºo
;

142 
”r
;

145 
size_t
 
i
;

146 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
İt
->
şass_veùÜ
); ++i) {

147 *
şass_Çme
;

148 
şass_Çme
 = 
	`­Ş_veùÜ_g‘_–em’t
(
İt
->
şass_veùÜ
, 
i
);

149 ià(!
şass_Çme
)

151 ià(
	`­Ş_avruË_qu”y_­³nd_şass
(
pŞicy
, 
avq
, 
şass_Çme
)) {

152 
”rÜ
 = 
”ºo
;

153 
”r
;

159 ià(
İt
->
³rmli¡
) {

160 
tmp
 = 
	`¡rdup
(
İt
->
³rmli¡
);

161 
tok
 = 
	`¡¹ok
(
tmp
, ",");ok;ok = sŒtok(
NULL
, ",")) {

162 ià(
	`­Ş_avruË_qu”y_­³nd_³rm
(
pŞicy
, 
avq
, 
tok
)) {

163 
”rÜ
 = 
”ºo
;

164 
”r
;

166 ià((
s
 = 
	`¡rdup
(
tok
)è=ğ
NULL
 || 
	`­Ş_veùÜ_­³nd
(
İt
->
³rm_veùÜ
, s) < 0) {

167 
”rÜ
 = 
”ºo
;

168 
”r
;

170 
s
 = 
NULL
;

172 
	`ä“
(
tmp
);

175 ià(!(
İt
->
£mªtic
è&& 
	`qpŞ_pŞicy_has_ÿ·b™y
(
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicy
), 
QPOL_CAP_SYN_RULES
)) {

176 ià(
	`­Ş_syn_avruË_g‘_by_qu”y
(
pŞicy
, 
avq
, 
v
)) {

177 
”rÜ
 = 
”ºo
;

178 
”r
;

181 ià(
	`­Ş_avruË_g‘_by_qu”y
(
pŞicy
, 
avq
, 
v
)) {

182 
”rÜ
 = 
”ºo
;

183 
”r
;

187 
	`­Ş_avruË_qu”y_de¡roy
(&
avq
);

190 
”r
:

191 
	`­Ş_veùÜ_de¡roy
(
v
);

192 
	`­Ş_avruË_qu”y_de¡roy
(&
avq
);

193 
	`ä“
(
tmp
);

194 
	`ä“
(
s
);

195 
	`PyE¼_S‘SŒšg
(
PyExc_RuÁimeE¼Ü
,
	`¡»¼Ü
(
”rÜ
));

196 
”ºo
 = 
”rÜ
;

198 
	}
}

202 
PyObjeù
* 
	$g‘_av_»suÉs
(cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
, cÚ¡ 
İtiÚs_t
 * 
İt
, cÚ¡ 
­Ş_veùÜ_t
 * 
v
)

204 
»tv®
 = -1;

205 
PyObjeù
 *
li¡
 = 
	`PyLi¡_New
(0);

206 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicy
);

207 
size_t
 
i
, 
num_ruËs
 = 0;

208 cÚ¡ 
qpŞ_avruË_t
 *
ruË
 = 
NULL
;

209 *
tmp
 = 
NULL
, *
ruË_¡r
 = NULL, *
ex´
 = NULL;

210 
’abË_ch¬
 = ' ', 
b¿nch_ch¬
 = ' ';

211 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

212 
ušt32_t
 
’abËd
 = 0;

214 ià(!
pŞicy
 || !
v
)

215  
NULL
;

217 ià(!(
num_ruËs
 = 
	`­Ş_veùÜ_g‘_size
(
v
)))

218  
NULL
;

220 
i
 = 0; i < 
num_ruËs
; i++) {

221 
’abË_ch¬
 = 
b¿nch_ch¬
 = ' ';

222 ià(!(
ruË
 = 
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
)))

223 
ş—nup
;

225 ià(
	`qpŞ_avruË_g‘_is_’abËd
(
q
, 
ruË
, &
’abËd
))

226 
ş—nup
;

227 ià(!
’abËd
)

230 cÚ¡ 
qpŞ_ty³_t
 *
ty³
;

231 cÚ¡ *
tmp_Çme
;

232 
ušt32_t
 
ruË_ty³
 = 0;

234 cÚ¡ 
qpŞ_şass_t
 *
obj_şass
 = 
NULL
;

236 
PyObjeù
 *
diù
 = 
	`PyDiù_New
();

238 
	`qpŞ_avruË_g‘_ruË_ty³
(
q
, 
ruË
, &
ruË_ty³
);

239 
tmp_Çme
 = 
	`­Ş_ruË_ty³_to_¡r
(
ruË_ty³
);

240 
PyObjeù
 *
obj
 = 
	`PySŒšg_FromSŒšg
(
tmp_Çme
);

241 
	`PyDiù_S‘I‹mSŒšg
(
diù
, "ty³", 
obj
);

242 
	`Py_DECREF
(
obj
);

244 
	`qpŞ_avruË_g‘_sourû_ty³
(
q
, 
ruË
, &
ty³
);

245 
	`qpŞ_ty³_g‘_Çme
(
q
, 
ty³
, &
tmp_Çme
);

246 
obj
 = 
	`PySŒšg_FromSŒšg
(
tmp_Çme
);

247 
	`PyDiù_S‘I‹mSŒšg
(
diù
, "scÚ‹xt", 
obj
);

248 
	`Py_DECREF
(
obj
);

250 
	`qpŞ_avruË_g‘_rg‘_ty³
(
q
, 
ruË
, &
ty³
);

251 
	`qpŞ_ty³_g‘_Çme
(
q
, 
ty³
, &
tmp_Çme
);

252 
obj
 = 
	`PySŒšg_FromSŒšg
(
tmp_Çme
);

253 
	`PyDiù_S‘I‹mSŒšg
(
diù
, "tcÚ‹xt", 
obj
);

254 
	`Py_DECREF
(
obj
);

256 
	`qpŞ_avruË_g‘_objeù_şass
(
q
, 
ruË
, &
obj_şass
);

257 
	`qpŞ_ty³_g‘_Çme
(
q
, 
ty³
, &
tmp_Çme
);

258 
obj
 = 
	`PySŒšg_FromSŒšg
(
tmp_Çme
);

259 
	`PyDiù_S‘I‹mSŒšg
(
diù
, "şass", 
obj
);

260 
	`Py_DECREF
(
obj
);

261 
	`qpŞ_avruË_g‘_³rm_™”
(
q
, 
ruË
, &
™”
);

262 
PyObjeù
 *
³rmli¡
 = 
	`PyLi¡_New
(0);

263 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

264 cÚ¡ *
³rm_Çme
 = 
NULL
;

265 
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
³rm_Çme
);

266 
obj
 = 
	`PySŒšg_FromSŒšg
(
³rm_Çme
);

267 
	`PyLi¡_Aµ’d
(
³rmli¡
, 
obj
);

268 
	`Py_DECREF
(
obj
);

270 
	`PyDiù_S‘I‹mSŒšg
(
diù
, "³rmli¡", 
³rmli¡
);

271 
	`Py_DECREF
(
³rmli¡
);

272 
	`PyLi¡_Aµ’d
(
li¡
, 
diù
);

273 
	`Py_DECREF
(
diù
);

275 
	`ä“
(
ruË_¡r
);

276 
ruË_¡r
 = 
NULL
;

277 
	`ä“
(
ex´
);

278 
ex´
 = 
NULL
;

280 
»tv®
 = 0;

281 
ş—nup
:

282 
	`ä“
(
tmp
);

283 
	`ä“
(
ruË_¡r
);

284 
	`ä“
(
ex´
);

285 ià(
»tv®
) {

286 
	`Py_DECREF
(
li¡
);

287  
NULL
;

289  
li¡
;

290 
	}
}

293 
PyObjeù
* 
	$££¬ch
(
boŞ
 
®low
,

294 
boŞ
 
Ãv”®low
,

295 
boŞ
 
aud™®low
,

296 
boŞ
 
dÚud™
,

297 cÚ¡ *
¤c_Çme
,

298 cÚ¡ *
tgt_Çme
,

299 cÚ¡ *
şass_Çme
,

300 cÚ¡ *
³rmli¡


303 
İtiÚs_t
 
cmd_İts
;

304 
¹
 = -1;

305 
PyObjeù
 *
ouut
 = 
NULL
;

307 
­Ş_pŞicy_t
 *
pŞicy
 = 
NULL
;

308 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

309 
­Ş_pŞicy_·th_t
 *
pŞ_·th
 = 
NULL
;

310 
­Ş_veùÜ_t
 *
mod_·ths
 = 
NULL
;

311 
­Ş_pŞicy_·th_ty³_e
 
·th_ty³
 = 
APOL_POLICY_PATH_TYPE_MONOLITHIC
;

313 
	`mem£t
(&
cmd_İts
, 0, (cmd_opts));

314 
cmd_İts
.
šdœeù
 = 
Œue
;

315 
cmd_İts
.
®low
 =‡llow;

316 
cmd_İts
.
ÇÎow
 = 
Ãv”®low
;

317 
cmd_İts
.
aud™®low
 =‡uditallow;

318 
cmd_İts
.
dÚud™
 = dontaudit;

319 ià(
¤c_Çme
)

320 
cmd_İts
.
¤c_Çme
 = 
	`¡rdup
(src_name);

321 ià(
tgt_Çme
)

322 
cmd_İts
.
tgt_Çme
 = 
	`¡rdup
(tgt_name);

323 ià(
şass_Çme
)

324 
cmd_İts
.
şass_Çme
 = 
	`¡rdup
(class_name);

325 ià(
³rmli¡
){

326 
cmd_İts
.
³rm_veùÜ
 = 
	`­Ş_veùÜ_ü—‹
(
ä“
);

327 
cmd_İts
.
³rmli¡
 = 
	`¡rdup
(permlist);

329 
pŞ_İt
 = 0;

330 ià(!(
cmd_İts
.
ÇÎow
 || cmd_İts.
®l
))

331 
pŞ_İt
 |ğ
QPOL_POLICY_OPTION_NO_NEVERALLOWS
;

334 
¹
 = 
	`qpŞ_deçuÉ_pŞicy_fšd
(&
pŞicy_fe
);

335 ià(
¹
) {

336 
	`PyE¼_S‘SŒšg
(
PyExc_RuÁimeE¼Ü
,"No default…olicy found.");

337  
NULL
;

339 
pŞ_İt
 |ğ
QPOL_POLICY_OPTION_MATCH_SYSTEM
;

341 ià(
	`­Ş_fe_is_pŞicy_·th_li¡
(
pŞicy_fe
) > 0) {

342 
pŞ_·th
 = 
	`­Ş_pŞicy_·th_ü—‹_äom_fe
(
pŞicy_fe
);

343 ià(!
pŞ_·th
) {

344 
	`ä“
(
pŞicy_fe
);

345 
	`PyE¼_S‘SŒšg
(
PyExc_RuÁimeE¼Ü
,"invalid…olicy†ist");

346  
NULL
;

350 ià(!
pŞ_·th
)

351 
pŞ_·th
 = 
	`­Ş_pŞicy_·th_ü—‹
(
·th_ty³
, 
pŞicy_fe
, 
mod_·ths
);

352 ià(!
pŞ_·th
) {

353 
	`ä“
(
pŞicy_fe
);

354 
	`PyE¼_S‘SŒšg
(
PyExc_RuÁimeE¼Ü
,
	`¡»¼Ü
(
ENOMEM
));

355  
NULL
;

357 
	`ä“
(
pŞicy_fe
);

358 
	`­Ş_veùÜ_de¡roy
(&
mod_·ths
);

360 
pŞicy
 = 
	`­Ş_pŞicy_ü—‹_äom_pŞicy_·th
(
pŞ_·th
, 
pŞ_İt
, 
NULL
, NULL);

361 ià(!
pŞicy
) {

362 
	`­Ş_pŞicy_·th_de¡roy
(&
pŞ_·th
);

363 
	`PyE¼_S‘SŒšg
(
PyExc_RuÁimeE¼Ü
,
	`¡»¼Ü
(
”ºo
));

364  
NULL
;

367 ià(
cmd_İts
.
u£»gex
 && cmd_İts.
şass_Çme
 !ğ
NULL
) {

368 
cmd_İts
.
şass_veùÜ
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
);

369 
­Ş_veùÜ_t
 *
qpŞ_m©chšg_şas£s
 = 
NULL
;

370 
­Ş_şass_qu”y_t
 *
»gex_m©ch_qu”y
 = 
	`­Ş_şass_qu”y_ü—‹
();

371 
	`­Ş_şass_qu”y_£t_»gex
(
pŞicy
, 
»gex_m©ch_qu”y
, 1);

372 
	`­Ş_şass_qu”y_£t_şass
(
pŞicy
, 
»gex_m©ch_qu”y
, 
cmd_İts
.
şass_Çme
);

373 ià(
	`­Ş_şass_g‘_by_qu”y
(
pŞicy
, 
»gex_m©ch_qu”y
, &
qpŞ_m©chšg_şas£s
)) {

374 
	`­Ş_şass_qu”y_de¡roy
(&
»gex_m©ch_qu”y
);

375 
	`PyE¼_S‘SŒšg
(
PyExc_RuÁimeE¼Ü
,"Query failed");

376 
ş—nup
;

378 cÚ¡ 
qpŞ_şass_t
 *
şass
 = 
NULL
;

379 
size_t
 
i
;

380 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
qpŞ_m©chšg_şas£s
); ++i) {

381 cÚ¡ *
şass_Çme
;

382 
şass
 = 
	`­Ş_veùÜ_g‘_–em’t
(
qpŞ_m©chšg_şas£s
, 
i
);

383 ià(!
şass
)

385 
	`qpŞ_şass_g‘_Çme
(
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicy
), 
şass
, &
şass_Çme
);

386 
	`­Ş_veùÜ_­³nd
(
cmd_İts
.
şass_veùÜ
, (*)
şass_Çme
);

388 ià(!
	`­Ş_veùÜ_g‘_size
(
qpŞ_m©chšg_şas£s
)) {

389 
	`­Ş_veùÜ_de¡roy
(&
qpŞ_m©chšg_şas£s
);

390 
	`­Ş_şass_qu”y_de¡roy
(&
»gex_m©ch_qu”y
);

391 
	`PyE¼_S‘SŒšg
(
PyExc_RuÁimeE¼Ü
,"No classes matchƒxpression");

392 
ş—nup
;

394 
	`­Ş_veùÜ_de¡roy
(&
qpŞ_m©chšg_şas£s
);

395 
	`­Ş_şass_qu”y_de¡roy
(&
»gex_m©ch_qu”y
);

398 ià(!
cmd_İts
.
£mªtic
 && 
	`qpŞ_pŞicy_has_ÿ·b™y
(
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicy
), 
QPOL_CAP_SYN_RULES
)) {

399 ià(
	`qpŞ_pŞicy_bud_syn_ruË_bË
(
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicy
))) {

400 
	`­Ş_pŞicy_de¡roy
(&
pŞicy
);

401 
	`PyE¼_S‘SŒšg
(
PyExc_RuÁimeE¼Ü
,"Query failed");

402 
ş—nup
;

407 ià(!
	`qpŞ_pŞicy_has_ÿ·b™y
(
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicy
), 
QPOL_CAP_SYN_RULES
)) {

408 
cmd_İts
.
£mªtic
 = 1;

412 ià(
cmd_İts
.
£mªtic
 || !
	`qpŞ_pŞicy_has_ÿ·b™y
(
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicy
), 
QPOL_CAP_LINE_NUMBERS
)) {

413 
cmd_İts
.
lš’o
 = 0;

415 ià(
	`³rfÜm_av_qu”y
(
pŞicy
, &
cmd_İts
, &
v
)) {

416 
ş—nup
;

418 ià(
v
) {

419 
ouut
 = 
	`g‘_av_»suÉs
(
pŞicy
, &
cmd_İts
, 
v
);

421 
	`­Ş_veùÜ_de¡roy
(&
v
);

422 
ş—nup
:

423 
	`­Ş_pŞicy_de¡roy
(&
pŞicy
);

424 
	`­Ş_pŞicy_·th_de¡roy
(&
pŞ_·th
);

425 
	`ä“
(
cmd_İts
.
¤c_Çme
);

426 
	`ä“
(
cmd_İts
.
tgt_Çme
);

427 
	`ä“
(
cmd_İts
.
şass_Çme
);

428 
	`ä“
(
cmd_İts
.
³rmli¡
);

429 
	`ä“
(
cmd_İts
.
boŞ_Çme
);

430 
	`ä“
(
cmd_İts
.
¤c_rŞe_Çme
);

431 
	`ä“
(
cmd_İts
.
tgt_rŞe_Çme
);

432 
	`­Ş_veùÜ_de¡roy
(&
cmd_İts
.
³rm_veùÜ
);

433 
	`­Ş_veùÜ_de¡roy
(&
cmd_İts
.
şass_veùÜ
);

435 ià(
ouut
)  output;

436  
Py_NÚe
;

437 
	}
}

438 
	$Diù_CÚšsIÁ
(
PyObjeù
 *
diù
, cÚ¡ *
key
){

439 
PyObjeù
 *
™em
 = 
	`PyDiù_G‘I‹mSŒšg
(
diù
, 
key
);

440 ià(
™em
)

441  
	`PyIÁ_AsLÚg
(
™em
);

442  
çl£
;

443 
	}
}

445 cÚ¡ *
	$Diù_CÚšsSŒšg
(
PyObjeù
 *
diù
, cÚ¡ *
key
){

446 
PyObjeù
 *
™em
 = 
	`PyDiù_G‘I‹mSŒšg
(
diù
, 
key
);

447 ià(
™em
)

448  
	`PySŒšg_AsSŒšg
(
™em
);

449  
NULL
;

450 
	}
}

452 
PyObjeù
 *
	$w¿p_££¬ch
(
PyObjeù
 *
£lf
, PyObjeù *
¬gs
){

453 
PyObjeù
 *
diù
;

454 ià(!
	`PyArg_P¬£Tu¶e
(
¬gs
, "O", &
diù
))

455  
NULL
;

456 
®low
 = 
	`Diù_CÚšsIÁ
(
diù
, "allow");

457 
Ãv”®low
 = 
	`Diù_CÚšsIÁ
(
diù
, "neverallow");

458 
aud™®low
 = 
	`Diù_CÚšsIÁ
(
diù
, "auditallow");

459 
dÚud™
 = 
	`Diù_CÚšsIÁ
(
diù
, "dontaudit");

461 cÚ¡ *
¤c_Çme
 = 
	`Diù_CÚšsSŒšg
(
diù
, "scontext");

462 cÚ¡ *
tgt_Çme
 = 
	`Diù_CÚšsSŒšg
(
diù
, "tcontext");

463 cÚ¡ *
şass_Çme
 = 
	`Diù_CÚšsSŒšg
(
diù
, "class");

464 cÚ¡ *
³rmli¡
 = 
	`Diù_CÚšsSŒšg
(
diù
, "permlist");

466  
	`Py_BudV®ue
("O",
	`££¬ch
(
®low
, 
Ãv”®low
, 
aud™®low
, 
dÚud™
, 
¤c_Çme
, 
tgt_Çme
, 
şass_Çme
, 
³rmli¡
));

468 
	}
}

470 
PyM‘hodDef
 
	gm‘hods
[] = {

471 {"££¬ch", (
PyCFunùiÚ
è
w¿p_££¬ch
, 
METH_VARARGS
},

472 {
NULL
, NULL, 0, NULL}

475 
	$š™_££¬ch
(){

476 
PyObjeù
 *
m
;

477 
m
 = 
	`Py_In™ModuË
("_££¬ch", 
m‘hods
);

478 
	}
}

	@seaudit/filter_view.c

26 
	~<cÚfig.h
>

28 
	~"f‹r_v›w.h
"

29 
	~"pŞicy_compÚ’ts_v›w.h
"

31 
	~<as£¹.h
>

32 
	~<”ºo.h
>

33 
	~<¡ršg.h
>

34 
	~<­Ş/pŞicy-qu”y.h
>

35 
	~<­Ş/mls-qu”y.h
>

36 
	~<­Ş/ut.h
>

37 
	~<gÏde/gÏde.h
>

39 
	scÚ‹xt_™em


41 
GtkBu‰Ú
 *
	mbu‰Ú
;

42 
GtkEÁry
 *
	m’Œy
;

43 
­Ş_veùÜ_t
 *
	m™ems
;

46 
	sd©e_™em


48 
GtkComboBox
 *
	mmÚth
;

49 
GtkSpšBu‰Ú
 *
	mday
, *
	mhour
, *
	mmšu‹
, *
	m£cÚd
;

50 
GtkF¿me
 *
	mäame
;

53 
	sf‹r_v›w


55 
tİËv–_t
 *
	mtİ
;

56 
£aud™_f‹r_t
 *
	mf‹r
;

57 
GÏdeXML
 *
	mxml
;

59 
GtkDŸlog
 *
	mdŸlog
;

61 
GtkEÁry
 *
	mÇme_’Œy
;

62 
GtkComboBox
 *
	mm©ch_combo
;

64 
cÚ‹xt_™em
 
	msu£r
, 
	m¤Şe
, 
	m¡y³
, 
	msmls_lvl
, 
	msmls_şr
, 
	mtu£r
, 
	mŒŞe
, 
	m‰y³
, 
	mtmls_lvl
, 
	mtmls_şr
, 
	mobj_şass
;

65 
GtkBu‰Ú
 *
	mcÚ‹xt_ş—r_bu‰Ú
;

67 
GtkEÁry
 *
	maddr_’Œy
, *
	mpÜt_’Œy
, *
	mÃtif_’Œy
, *
	mexe_’Œy
, *
	m·th_’Œy
, *
	mho¡_’Œy
, *
	mcomm_’Œy
;

68 
GtkComboBox
 *
	mmes§ge_combo
;

69 
GtkBu‰Ú
 *
	mÙh”_ş—r_bu‰Ú
;

71 
GtkRadioBu‰Ú
 *
	md©e_nÚe_¿dio
, *
	md©e_befÜe_¿dio
, *
	md©e_aá”_¿dio
, *
	md©e_b‘w“n_¿dio
;

72 
d©e_™em
 
	md©es
[2];

73 
GtkTextBufãr
 *
	mdesütiÚ_bufãr
;

79 
	$f‹r_v›w_š™_widg‘s_cÚ‹xt
(
f‹r_v›w
 *
fv
)

81 
fv
->
su£r
.
bu‰Ú
 = 
	`GTK_BUTTON
(
	`gÏde_xml_g‘_widg‘
(fv->
xml
, "FilterViewSUserButton"));

82 
fv
->
¤Şe
.
bu‰Ú
 = 
	`GTK_BUTTON
(
	`gÏde_xml_g‘_widg‘
(fv->
xml
, "FilterViewSRoleButton"));

83 
fv
->
¡y³
.
bu‰Ú
 = 
	`GTK_BUTTON
(
	`gÏde_xml_g‘_widg‘
(fv->
xml
, "FilterViewSTypeButton"));

84 
fv
->
smls_lvl
.
bu‰Ú
 = 
	`GTK_BUTTON
(
	`gÏde_xml_g‘_widg‘
(fv->
xml
, "FilterViewSMLSLVLButton"));

85 
fv
->
smls_şr
.
bu‰Ú
 = 
	`GTK_BUTTON
(
	`gÏde_xml_g‘_widg‘
(fv->
xml
, "FilterViewSMLSCLRButton"));

86 
fv
->
tu£r
.
bu‰Ú
 = 
	`GTK_BUTTON
(
	`gÏde_xml_g‘_widg‘
(fv->
xml
, "FilterViewTUserButton"));

87 
fv
->
ŒŞe
.
bu‰Ú
 = 
	`GTK_BUTTON
(
	`gÏde_xml_g‘_widg‘
(fv->
xml
, "FilterViewTRoleButton"));

88 
fv
->
‰y³
.
bu‰Ú
 = 
	`GTK_BUTTON
(
	`gÏde_xml_g‘_widg‘
(fv->
xml
, "FilterViewTTypeButton"));

89 
fv
->
tmls_lvl
.
bu‰Ú
 = 
	`GTK_BUTTON
(
	`gÏde_xml_g‘_widg‘
(fv->
xml
, "FilterViewTMLSLVLButton"));

90 
fv
->
tmls_şr
.
bu‰Ú
 = 
	`GTK_BUTTON
(
	`gÏde_xml_g‘_widg‘
(fv->
xml
, "FilterViewTMLSCLRButton"));

91 
fv
->
obj_şass
.
bu‰Ú
 = 
	`GTK_BUTTON
(
	`gÏde_xml_g‘_widg‘
(fv->
xml
, "FilterViewClassButton"));

92 
	`as£¹
(
fv
->
su£r
.
bu‰Ú
 !ğ
NULL
 && fv->
¤Şe
.bu‰Ú !ğNULL && fv->
¡y³
.bu‰Ú !ğNULL && fv->
smls_lvl
.bu‰Ú !ğNULL && fv->
smls_şr
.button != NULL &&

93 
fv
->
tu£r
.
bu‰Ú
 !ğ
NULL
 && fv->
ŒŞe
.bu‰Ú !ğNULL && fv->
‰y³
.bu‰Ú !ğNULL && fv->
tmls_lvl
.bu‰Ú !ğNULL && fv->
tmls_şr
.bu‰Ú !ğNULL && fv->
obj_şass
.button != NULL);

95 
fv
->
su£r
.
’Œy
 = 
	`GTK_ENTRY
(
	`gÏde_xml_g‘_widg‘
(fv->
xml
, "FilterViewSUserEntry"));

96 
fv
->
¤Şe
.
’Œy
 = 
	`GTK_ENTRY
(
	`gÏde_xml_g‘_widg‘
(fv->
xml
, "FilterViewSRoleEntry"));

97 
fv
->
¡y³
.
’Œy
 = 
	`GTK_ENTRY
(
	`gÏde_xml_g‘_widg‘
(fv->
xml
, "FilterViewSTypeEntry"));

98 
fv
->
smls_lvl
.
’Œy
 = 
	`GTK_ENTRY
(
	`gÏde_xml_g‘_widg‘
(fv->
xml
, "FilterViewSMLSLVLEntry"));

99 
fv
->
smls_şr
.
’Œy
 = 
	`GTK_ENTRY
(
	`gÏde_xml_g‘_widg‘
(fv->
xml
, "FilterViewSMLSCLREntry"));

100 
fv
->
tu£r
.
’Œy
 = 
	`GTK_ENTRY
(
	`gÏde_xml_g‘_widg‘
(fv->
xml
, "FilterViewTUserEntry"));

101 
fv
->
ŒŞe
.
’Œy
 = 
	`GTK_ENTRY
(
	`gÏde_xml_g‘_widg‘
(fv->
xml
, "FilterViewTRoleEntry"));

102 
fv
->
‰y³
.
’Œy
 = 
	`GTK_ENTRY
(
	`gÏde_xml_g‘_widg‘
(fv->
xml
, "FilterViewTTypeEntry"));

103 
fv
->
tmls_lvl
.
’Œy
 = 
	`GTK_ENTRY
(
	`gÏde_xml_g‘_widg‘
(fv->
xml
, "FilterViewTMLSLVLEntry"));

104 
fv
->
tmls_şr
.
’Œy
 = 
	`GTK_ENTRY
(
	`gÏde_xml_g‘_widg‘
(fv->
xml
, "FilterViewTMLSCLREntry"));

105 
fv
->
obj_şass
.
’Œy
 = 
	`GTK_ENTRY
(
	`gÏde_xml_g‘_widg‘
(fv->
xml
, "FilterViewClassEntry"));

106 
	`as£¹
(
fv
->
su£r
.
’Œy
 !ğ
NULL
 && fv->
¤Şe
.’Œy !ğNULL && fv->
¡y³
.’Œy !ğNULL && fv->
smls_lvl
.’Œy !ğNULL && fv->
smls_şr
.entry != NULL &&

107 
fv
->
tu£r
.
’Œy
 !ğ
NULL
 && fv->
ŒŞe
.’Œy !ğNULL && fv->
‰y³
.’Œy !ğNULL && fv->
tmls_lvl
.’Œy !ğNULL && fv->
tmls_şr
.’Œy !ğNULL && fv->
obj_şass
.entry != NULL);

108 
	`g_objeù_£t_d©a
(
	`G_OBJECT
(
fv
->
su£r
.
’Œy
), "data", &fv->suser);

109 
	`g_objeù_£t_d©a
(
	`G_OBJECT
(
fv
->
¤Şe
.
’Œy
), "data", &fv->srole);

110 
	`g_objeù_£t_d©a
(
	`G_OBJECT
(
fv
->
¡y³
.
’Œy
), "data", &fv->stype);

111 
	`g_objeù_£t_d©a
(
	`G_OBJECT
(
fv
->
smls_lvl
.
’Œy
), "data", &fv->smls_lvl);

112 
	`g_objeù_£t_d©a
(
	`G_OBJECT
(
fv
->
smls_şr
.
’Œy
), "data", &fv->smls_clr);

113 
	`g_objeù_£t_d©a
(
	`G_OBJECT
(
fv
->
tu£r
.
’Œy
), "data", &fv->tuser);

114 
	`g_objeù_£t_d©a
(
	`G_OBJECT
(
fv
->
ŒŞe
.
’Œy
), "data", &fv->trole);

115 
	`g_objeù_£t_d©a
(
	`G_OBJECT
(
fv
->
‰y³
.
’Œy
), "data", &fv->ttype);

116 
	`g_objeù_£t_d©a
(
	`G_OBJECT
(
fv
->
tmls_lvl
.
’Œy
), "data", &fv->tmls_lvl);

117 
	`g_objeù_£t_d©a
(
	`G_OBJECT
(
fv
->
tmls_şr
.
’Œy
), "data", &fv->tmls_clr);

118 
	`g_objeù_£t_d©a
(
	`G_OBJECT
(
fv
->
obj_şass
.
’Œy
), "data", &fv->obj_class);

120 
fv
->
cÚ‹xt_ş—r_bu‰Ú
 = 
	`GTK_BUTTON
(
	`gÏde_xml_g‘_widg‘
(fv->
xml
, "FilterViewContextClearButton"));

121 
	`as£¹
(
fv
->
cÚ‹xt_ş—r_bu‰Ú
 !ğ
NULL
);

122 
	}
}

127 
	$f‹r_v›w_š™_widg‘s_Ùh”
(
f‹r_v›w
 *
fv
)

129 
fv
->
addr_’Œy
 = 
	`GTK_ENTRY
(
	`gÏde_xml_g‘_widg‘
(fv->
xml
, "FilterViewIPAddrEntry"));

130 
fv
->
pÜt_’Œy
 = 
	`GTK_ENTRY
(
	`gÏde_xml_g‘_widg‘
(fv->
xml
, "FilterViewPortEntry"));

131 
fv
->
Ãtif_’Œy
 = 
	`GTK_ENTRY
(
	`gÏde_xml_g‘_widg‘
(fv->
xml
, "FilterViewNetIfEntry"));

132 
	`as£¹
(
fv
->
addr_’Œy
 !ğ
NULL
 && fv->
pÜt_’Œy
 !ğNULL && fv->
Ãtif_’Œy
 != NULL);

134 
fv
->
exe_’Œy
 = 
	`GTK_ENTRY
(
	`gÏde_xml_g‘_widg‘
(fv->
xml
, "FilterViewExeEntry"));

135 
fv
->
·th_’Œy
 = 
	`GTK_ENTRY
(
	`gÏde_xml_g‘_widg‘
(fv->
xml
, "FilterViewPathEntry"));

136 
fv
->
ho¡_’Œy
 = 
	`GTK_ENTRY
(
	`gÏde_xml_g‘_widg‘
(fv->
xml
, "FilterViewHostEntry"));

137 
fv
->
comm_’Œy
 = 
	`GTK_ENTRY
(
	`gÏde_xml_g‘_widg‘
(fv->
xml
, "FilterViewCommEntry"));

138 
	`as£¹
(
fv
->
exe_’Œy
 !ğ
NULL
 && fv->
·th_’Œy
 !ğNULL && fv->
ho¡_’Œy
 !ğNULL && fv->
comm_’Œy
 != NULL);

140 
fv
->
mes§ge_combo
 = 
	`GTK_COMBO_BOX
(
	`gÏde_xml_g‘_widg‘
(fv->
xml
, "FilterViewMessageCombo"));

141 
	`as£¹
(
fv
->
mes§ge_combo
 !ğ
NULL
);

143 
fv
->
Ùh”_ş—r_bu‰Ú
 = 
	`GTK_BUTTON
(
	`gÏde_xml_g‘_widg‘
(fv->
xml
, "FilterViewOtherClearButton"));

144 
	`as£¹
(
fv
->
Ùh”_ş—r_bu‰Ú
 !ğ
NULL
);

145 
	}
}

150 
	$f‹r_v›w_š™_widg‘s_d©e
(
f‹r_v›w
 *
fv
)

152 cÚ¡ *
widg‘s
[2][6] = {

158 
size_t
 
i
;

159 
fv
->
d©e_nÚe_¿dio
 = 
	`GTK_RADIO_BUTTON
(
	`gÏde_xml_g‘_widg‘
(fv->
xml
, "FilterViewDateNoneRadio"));

160 
fv
->
d©e_befÜe_¿dio
 = 
	`GTK_RADIO_BUTTON
(
	`gÏde_xml_g‘_widg‘
(fv->
xml
, "FilterViewDateBeforeRadio"));

161 
fv
->
d©e_aá”_¿dio
 = 
	`GTK_RADIO_BUTTON
(
	`gÏde_xml_g‘_widg‘
(fv->
xml
, "FilterViewDateAfterRadio"));

162 
fv
->
d©e_b‘w“n_¿dio
 = 
	`GTK_RADIO_BUTTON
(
	`gÏde_xml_g‘_widg‘
(fv->
xml
, "FilterViewDateBetweenRadio"));

163 
	`as£¹
(
fv
->
d©e_nÚe_¿dio
 !ğ
NULL
 && fv->
d©e_befÜe_¿dio
 !ğNULL && fv->
d©e_aá”_¿dio
 != NULL

164 && 
fv
->
d©e_b‘w“n_¿dio
 !ğ
NULL
);

166 
i
 = 0; i < 2; i++) {

167 
fv
->
d©es
[
i
].
äame
 = 
	`GTK_FRAME
(
	`gÏde_xml_g‘_widg‘
(fv->
xml
, 
widg‘s
[i][0]));

168 
fv
->
d©es
[
i
].
mÚth
 = 
	`GTK_COMBO_BOX
(
	`gÏde_xml_g‘_widg‘
(fv->
xml
, 
widg‘s
[i][1]));

169 
fv
->
d©es
[
i
].
day
 = 
	`GTK_SPIN_BUTTON
(
	`gÏde_xml_g‘_widg‘
(fv->
xml
, 
widg‘s
[i][2]));

170 
fv
->
d©es
[
i
].
hour
 = 
	`GTK_SPIN_BUTTON
(
	`gÏde_xml_g‘_widg‘
(fv->
xml
, 
widg‘s
[i][3]));

171 
fv
->
d©es
[
i
].
mšu‹
 = 
	`GTK_SPIN_BUTTON
(
	`gÏde_xml_g‘_widg‘
(fv->
xml
, 
widg‘s
[i][4]));

172 
fv
->
d©es
[
i
].
£cÚd
 = 
	`GTK_SPIN_BUTTON
(
	`gÏde_xml_g‘_widg‘
(fv->
xml
, 
widg‘s
[i][5]));

173 
	`as£¹
(
fv
->
d©es
[
i
].
äame
 !ğ
NULL
 && fv->d©es[i].
mÚth
 !ğNULL && fv->d©es[i].
day
 != NULL &&

174 
fv
->
d©es
[
i
].
hour
 !ğ
NULL
 && fv->d©es[i].
mšu‹
 !ğNULL && fv->d©es[i].
£cÚd
 != NULL);

176 
	}
}

178 
	$f‹r_v›w_š™_widg‘s
(
f‹r_v›w
 *
fv
, 
GtkWšdow
 * 
·»Á
)

180 
GtkTextV›w
 *
desütiÚ_v›w
;

182 
fv
->
dŸlog
 = 
	`GTK_DIALOG
(
	`gÏde_xml_g‘_widg‘
(fv->
xml
, "FilterWindow"));

183 
	`as£¹
(
fv
->
dŸlog
 !ğ
NULL
);

184 
	`gtk_wšdow_£t_Œªs›Á_fÜ
(
	`GTK_WINDOW
(
fv
->
dŸlog
), 
·»Á
);

186 
fv
->
Çme_’Œy
 = 
	`GTK_ENTRY
(
	`gÏde_xml_g‘_widg‘
(fv->
xml
, "FilterViewNameEntry"));

187 
fv
->
m©ch_combo
 = 
	`GTK_COMBO_BOX
(
	`gÏde_xml_g‘_widg‘
(fv->
xml
, "FilterViewMatchCombo"));

188 
	`as£¹
(
fv
->
Çme_’Œy
 !ğ
NULL
 && fv->
m©ch_combo
);

190 
	`f‹r_v›w_š™_widg‘s_cÚ‹xt
(
fv
);

191 
	`f‹r_v›w_š™_widg‘s_Ùh”
(
fv
);

192 
	`f‹r_v›w_š™_widg‘s_d©e
(
fv
);

194 
fv
->
desütiÚ_bufãr
 = 
	`gtk_‹xt_bufãr_Ãw
(
NULL
);

195 #ifdeà
GTK_2_8


196 
	`g_objeù_»f_sšk
(
fv
->
desütiÚ_bufãr
);

198 
desütiÚ_v›w
 = 
	`GTK_TEXT_VIEW
(
	`gÏde_xml_g‘_widg‘
(
fv
->
xml
, "FilterViewDescView"));

199 
	`as£¹
(
desütiÚ_v›w
 !ğ
NULL
);

200 
	`gtk_‹xt_v›w_£t_bufãr
(
desütiÚ_v›w
, 
fv
->
desütiÚ_bufãr
);

201 
	}
}

210 
	$f‹r_v›w_cÚ‹xt_™em_to_’Œy
(
f‹r_v›w
 *
fv
, 
cÚ‹xt_™em
 *
™em
)

212 ià(
™em
->
™ems
 =ğ
NULL
) {

213 
	`gtk_’Œy_£t_‹xt
(
™em
->
’Œy
, "");

215 
GSŒšg
 *
s
 = 
	`g_¡ršg_Ãw
("");

216 
size_t
 
i
;

217 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
™em
->
™ems
); i++) {

218 *
t
 = 
	`­Ş_veùÜ_g‘_–em’t
(
™em
->
™ems
, 
i
);

219 ià(
i
 > 0) {

220 
	`g_¡ršg_­³nd
(
s
, ", ");

222 
	`g_¡ršg_­³nd
(
s
, 
t
);

224 
	`gtk_’Œy_£t_‹xt
(
™em
->
’Œy
, 
s
->
¡r
);

225 
	`g_¡ršg_ä“
(
s
, 
TRUE
);

227 
	}
}

229 
	$f‹r_v›w_cÚ‹xt_™ems_to_’Œ›s
(
f‹r_v›w
 *
fv
)

231 
	`f‹r_v›w_cÚ‹xt_™em_to_’Œy
(
fv
, &fv->
su£r
);

232 
	`f‹r_v›w_cÚ‹xt_™em_to_’Œy
(
fv
, &fv->
¤Şe
);

233 
	`f‹r_v›w_cÚ‹xt_™em_to_’Œy
(
fv
, &fv->
¡y³
);

234 
	`f‹r_v›w_cÚ‹xt_™em_to_’Œy
(
fv
, &fv->
smls_lvl
);

235 
	`f‹r_v›w_cÚ‹xt_™em_to_’Œy
(
fv
, &fv->
smls_şr
);

236 
	`f‹r_v›w_cÚ‹xt_™em_to_’Œy
(
fv
, &fv->
tu£r
);

237 
	`f‹r_v›w_cÚ‹xt_™em_to_’Œy
(
fv
, &fv->
ŒŞe
);

238 
	`f‹r_v›w_cÚ‹xt_™em_to_’Œy
(
fv
, &fv->
‰y³
);

239 
	`f‹r_v›w_cÚ‹xt_™em_to_’Œy
(
fv
, &fv->
tmls_lvl
);

240 
	`f‹r_v›w_cÚ‹xt_™em_to_’Œy
(
fv
, &fv->
tmls_şr
);

241 
	`f‹r_v›w_cÚ‹xt_™em_to_’Œy
(
fv
, &fv->
obj_şass
);

242 
	}
}

244 
	$f‹r_v›w_š™_cÚ‹xt
(
f‹r_v›w
 *
fv
)

246 cÚ¡ 
­Ş_veùÜ_t
 *
v
;

247 
v
 = 
	`£aud™_f‹r_g‘_sourû_u£r
(
fv
->
f‹r
);

248 ià(
v
 !ğ
NULL
 && (
fv
->
su£r
.
™ems
 = 
	`­Ş_veùÜ_ü—‹_äom_veùÜ
(v, 
­Ş_¡r_¡rdup
, NULL, 
ä“
)) == NULL) {

249 
	`tİËv–_ERR
(
fv
->
tİ
, "E¼Ü in™Ÿlizšg cÚ‹xˆb: %s", 
	`¡»¼Ü
(
”ºo
));

252 
v
 = 
	`£aud™_f‹r_g‘_sourû_rŞe
(
fv
->
f‹r
);

253 ià(
v
 !ğ
NULL
 && (
fv
->
¤Şe
.
™ems
 = 
	`­Ş_veùÜ_ü—‹_äom_veùÜ
(v, 
­Ş_¡r_¡rdup
, NULL, 
ä“
)) == NULL) {

254 
	`tİËv–_ERR
(
fv
->
tİ
, "E¼Ü in™Ÿlizšg cÚ‹xˆb: %s", 
	`¡»¼Ü
(
”ºo
));

257 
v
 = 
	`£aud™_f‹r_g‘_sourû_ty³
(
fv
->
f‹r
);

258 ià(
v
 !ğ
NULL
 && (
fv
->
¡y³
.
™ems
 = 
	`­Ş_veùÜ_ü—‹_äom_veùÜ
(v, 
­Ş_¡r_¡rdup
, NULL, 
ä“
)) == NULL) {

259 
	`tİËv–_ERR
(
fv
->
tİ
, "E¼Ü in™Ÿlizšg cÚ‹xˆb: %s", 
	`¡»¼Ü
(
”ºo
));

262 
v
 = 
	`£aud™_f‹r_g‘_sourû_mls_lvl
(
fv
->
f‹r
);

263 ià(
v
 !ğ
NULL
 && (
fv
->
smls_lvl
.
™ems
 = 
	`­Ş_veùÜ_ü—‹_äom_veùÜ
(v, 
­Ş_¡r_¡rdup
, NULL, 
ä“
)) == NULL) {

264 
	`tİËv–_ERR
(
fv
->
tİ
, "E¼Ü in™Ÿlizšg cÚ‹xˆb: %s", 
	`¡»¼Ü
(
”ºo
));

267 
v
 = 
	`£aud™_f‹r_g‘_sourû_mls_şr
(
fv
->
f‹r
);

268 ià(
v
 !ğ
NULL
 && (
fv
->
smls_şr
.
™ems
 = 
	`­Ş_veùÜ_ü—‹_äom_veùÜ
(v, 
­Ş_¡r_¡rdup
, NULL, 
ä“
)) == NULL) {

269 
	`tİËv–_ERR
(
fv
->
tİ
, "E¼Ü in™Ÿlizšg cÚ‹xˆb: %s", 
	`¡»¼Ü
(
”ºo
));

273 
v
 = 
	`£aud™_f‹r_g‘_rg‘_u£r
(
fv
->
f‹r
);

274 ià(
v
 !ğ
NULL
 && (
fv
->
tu£r
.
™ems
 = 
	`­Ş_veùÜ_ü—‹_äom_veùÜ
(v, 
­Ş_¡r_¡rdup
, NULL, 
ä“
)) == NULL) {

275 
	`tİËv–_ERR
(
fv
->
tİ
, "E¼Ü in™Ÿlizšg cÚ‹xˆb: %s", 
	`¡»¼Ü
(
”ºo
));

278 
v
 = 
	`£aud™_f‹r_g‘_rg‘_rŞe
(
fv
->
f‹r
);

279 ià(
v
 !ğ
NULL
 && (
fv
->
ŒŞe
.
™ems
 = 
	`­Ş_veùÜ_ü—‹_äom_veùÜ
(v, 
­Ş_¡r_¡rdup
, NULL, 
ä“
)) == NULL) {

280 
	`tİËv–_ERR
(
fv
->
tİ
, "E¼Ü in™Ÿlizšg cÚ‹xˆb: %s", 
	`¡»¼Ü
(
”ºo
));

283 
v
 = 
	`£aud™_f‹r_g‘_rg‘_ty³
(
fv
->
f‹r
);

284 ià(
v
 !ğ
NULL
 && (
fv
->
‰y³
.
™ems
 = 
	`­Ş_veùÜ_ü—‹_äom_veùÜ
(v, 
­Ş_¡r_¡rdup
, NULL, 
ä“
)) == NULL) {

285 
	`tİËv–_ERR
(
fv
->
tİ
, "E¼Ü in™Ÿlizšg cÚ‹xˆb: %s", 
	`¡»¼Ü
(
”ºo
));

288 
v
 = 
	`£aud™_f‹r_g‘_rg‘_mls_lvl
(
fv
->
f‹r
);

289 ià(
v
 !ğ
NULL
 && (
fv
->
tmls_lvl
.
™ems
 = 
	`­Ş_veùÜ_ü—‹_äom_veùÜ
(v, 
­Ş_¡r_¡rdup
, NULL, 
ä“
)) == NULL) {

290 
	`tİËv–_ERR
(
fv
->
tİ
, "E¼Ü in™Ÿlizšg cÚ‹xˆb: %s", 
	`¡»¼Ü
(
”ºo
));

293 
v
 = 
	`£aud™_f‹r_g‘_rg‘_mls_şr
(
fv
->
f‹r
);

294 ià(
v
 !ğ
NULL
 && (
fv
->
tmls_şr
.
™ems
 = 
	`­Ş_veùÜ_ü—‹_äom_veùÜ
(v, 
­Ş_¡r_¡rdup
, NULL, 
ä“
)) == NULL) {

295 
	`tİËv–_ERR
(
fv
->
tİ
, "E¼Ü in™Ÿlizšg cÚ‹xˆb: %s", 
	`¡»¼Ü
(
”ºo
));

299 
v
 = 
	`£aud™_f‹r_g‘_rg‘_şass
(
fv
->
f‹r
);

300 ià(
v
 !ğ
NULL
 && (
fv
->
obj_şass
.
™ems
 = 
	`­Ş_veùÜ_ü—‹_äom_veùÜ
(v, 
­Ş_¡r_¡rdup
, NULL, 
ä“
)) == NULL) {

301 
	`tİËv–_ERR
(
fv
->
tİ
, "E¼Ü in™Ÿlizšg cÚ‹xˆb: %s", 
	`¡»¼Ü
(
”ºo
));

304 
	`f‹r_v›w_cÚ‹xt_™ems_to_’Œ›s
(
fv
);

305 
	}
}

312 
f‹r_v›w_š™_’Œy
(
f‹r_v›w
 *
fv
, cÚ¡ *(*
acûssÜ
è(cÚ¡ 
£aud™_f‹r_t
 *), 
GtkEÁry
 * 
’Œy
)

314 cÚ¡ *
	gs
 = 
acûssÜ
(
fv
->
f‹r
);

315 ià(
	gs
 =ğ
NULL
) {

316 
s
 = "";

318 
gtk_’Œy_£t_‹xt
(
’Œy
, 
s
);

321 
	$f‹r_v›w_š™_Ùh”
(
f‹r_v›w
 *
fv
)

323 
s
[32];

324 
	`f‹r_v›w_š™_’Œy
(
fv
, 
£aud™_f‹r_g‘_ªyaddr
, fv->
addr_’Œy
);

325 ià(
	`£aud™_f‹r_g‘_ªypÜt
(
fv
->
f‹r
) <= 0) {

326 
s
[0] = '\0';

328 
	`¢´štf
(
s
, 32, "%d", 
	`£aud™_f‹r_g‘_ªypÜt
(
fv
->
f‹r
));

330 
	`gtk_’Œy_£t_‹xt
(
fv
->
pÜt_’Œy
, 
s
);

331 
	`f‹r_v›w_š™_’Œy
(
fv
, 
£aud™_f‹r_g‘_Ãtif
, fv->
Ãtif_’Œy
);

332 
	`f‹r_v›w_š™_’Œy
(
fv
, 
£aud™_f‹r_g‘_execubË
, fv->
exe_’Œy
);

333 
	`f‹r_v›w_š™_’Œy
(
fv
, 
£aud™_f‹r_g‘_·th
, fv->
·th_’Œy
);

334 
	`f‹r_v›w_š™_’Œy
(
fv
, 
£aud™_f‹r_g‘_ho¡
, fv->
ho¡_’Œy
);

335 
	`f‹r_v›w_š™_’Œy
(
fv
, 
£aud™_f‹r_g‘_commªd
, fv->
comm_’Œy
);

336 
	`£aud™_f‹r_g‘_mes§ge_ty³
(
fv
->
f‹r
)) {

337 
SEAUDIT_AVC_DENIED
:

338 
	`gtk_combo_box_£t_aùive
(
fv
->
mes§ge_combo
, 1);

340 
SEAUDIT_AVC_GRANTED
:

341 
	`gtk_combo_box_£t_aùive
(
fv
->
mes§ge_combo
, 2);

344 
	`gtk_combo_box_£t_aùive
(
fv
->
mes§ge_combo
, 0);

346 
	}
}

348 
	$f‹r_v›w_š™_d©e
(
f‹r_v›w
 *
fv
)

350 cÚ¡ 
tm
 *
¡¬t
, *
’d
;

351 
tm
 
v®ues
[2];

352 
has_v®ue
[2] = { 0, 0 };

353 
£aud™_f‹r_d©e_m©ch_e
 
m©ch
;

354 
size_t
 
i
;

356 
	`£aud™_f‹r_g‘_d©e
(
fv
->
f‹r
, &
¡¬t
, &
’d
, &
m©ch
);

357 ià(
¡¬t
 =ğ
NULL
 && 
’d
 == NULL) {

358 
	`gtk_toggË_bu‰Ú_£t_aùive
(
	`GTK_TOGGLE_BUTTON
(
fv
->
d©e_nÚe_¿dio
), 
TRUE
);

360 ià(
m©ch
 =ğ
SEAUDIT_FILTER_DATE_MATCH_BEFORE
) {

361 
	`gtk_toggË_bu‰Ú_£t_aùive
(
	`GTK_TOGGLE_BUTTON
(
fv
->
d©e_befÜe_¿dio
), 
TRUE
);

362 } ià(
m©ch
 =ğ
SEAUDIT_FILTER_DATE_MATCH_AFTER
) {

363 
	`gtk_toggË_bu‰Ú_£t_aùive
(
	`GTK_TOGGLE_BUTTON
(
fv
->
d©e_aá”_¿dio
), 
TRUE
);

365 
	`memıy
(
v®ues
 + 0, 
¡¬t
, (values[0]));

366 
has_v®ue
[0] = 1;

368 ià(
m©ch
 =ğ
SEAUDIT_FILTER_DATE_MATCH_BETWEEN
) {

369 
	`gtk_toggË_bu‰Ú_£t_aùive
(
	`GTK_TOGGLE_BUTTON
(
fv
->
d©e_b‘w“n_¿dio
), 
TRUE
);

370 
	`memıy
(
v®ues
 + 1, 
’d
, (values[1]));

371 
has_v®ue
[1] = 1;

373 
i
 = 0; i < 2; i++) {

374 ià(
has_v®ue
[
i
]) {

375 
	`gtk_combo_box_£t_aùive
(
fv
->
d©es
[
i
].
mÚth
, 
v®ues
[i].
tm_mÚ
);

376 
	`gtk_¥š_bu‰Ú_£t_v®ue
(
fv
->
d©es
[
i
].
day
, 
v®ues
[i].
tm_mday
);

377 
	`gtk_¥š_bu‰Ú_£t_v®ue
(
fv
->
d©es
[
i
].
hour
, 
v®ues
[i].
tm_hour
);

378 
	`gtk_¥š_bu‰Ú_£t_v®ue
(
fv
->
d©es
[
i
].
mšu‹
, 
v®ues
[i].
tm_mš
);

379 
	`gtk_¥š_bu‰Ú_£t_v®ue
(
fv
->
d©es
[
i
].
£cÚd
, 
v®ues
[i].
tm_£c
);

381 
	`gtk_combo_box_£t_aùive
(
fv
->
d©es
[
i
].
mÚth
, 0);

384 
	}
}

389 
	$f‹r_v›w_š™_dŸlog
(
f‹r_v›w
 *
fv
)

391 cÚ¡ *
Çme
 = 
	`£aud™_f‹r_g‘_Çme
(
fv
->
f‹r
);

392 cÚ¡ *
desc
 = 
	`£aud™_f‹r_g‘_desütiÚ
(
fv
->
f‹r
);;

393 ià(
Çme
 =ğ
NULL
) {

394 
Çme
 = "Untitled";

396 
	`gtk_’Œy_£t_‹xt
(
fv
->
Çme_’Œy
, 
Çme
);

397 
	`gtk_combo_box_£t_aùive
(
fv
->
m©ch_combo
, 
	`£aud™_f‹r_g‘_m©ch
(fv->
f‹r
));

399 
	`f‹r_v›w_š™_cÚ‹xt
(
fv
);

400 
	`f‹r_v›w_š™_Ùh”
(
fv
);

401 
	`f‹r_v›w_š™_d©e
(
fv
);

403 ià(
desc
 =ğ
NULL
) {

404 
desc
 = "";

406 
	`gtk_‹xt_bufãr_£t_‹xt
(
fv
->
desütiÚ_bufãr
, 
desc
, -1);

407 
	}
}

411 
	$f‹r_v›w_­¶y_cÚ‹xt
(
f‹r_v›w
 *
fv
)

413 ià(
	`£aud™_f‹r_£t_sourû_u£r
(
fv
->
f‹r
, fv->
su£r
.
™ems
) < 0 ||

414 
	`£aud™_f‹r_£t_sourû_rŞe
(
fv
->
f‹r
, fv->
¤Şe
.
™ems
) < 0 ||

415 
	`£aud™_f‹r_£t_sourû_ty³
(
fv
->
f‹r
, fv->
¡y³
.
™ems
) < 0 ||

416 
	`£aud™_f‹r_£t_sourû_mls_lvl
(
fv
->
f‹r
, fv->
smls_lvl
.
™ems
) < 0 ||

417 
	`£aud™_f‹r_£t_sourû_mls_şr
(
fv
->
f‹r
, fv->
smls_şr
.
™ems
) < 0 ||

418 
	`£aud™_f‹r_£t_rg‘_u£r
(
fv
->
f‹r
, fv->
tu£r
.
™ems
) < 0 ||

419 
	`£aud™_f‹r_£t_rg‘_rŞe
(
fv
->
f‹r
, fv->
ŒŞe
.
™ems
) < 0 ||

420 
	`£aud™_f‹r_£t_rg‘_ty³
(
fv
->
f‹r
, fv->
‰y³
.
™ems
) < 0 ||

421 
	`£aud™_f‹r_£t_rg‘_mls_lvl
(
fv
->
f‹r
, fv->
tmls_lvl
.
™ems
) < 0 ||

422 
	`£aud™_f‹r_£t_rg‘_mls_şr
(
fv
->
f‹r
, fv->
tmls_şr
.
™ems
) < 0 ||

423 
	`£aud™_f‹r_£t_rg‘_şass
(
fv
->
f‹r
, fv->
obj_şass
.
™ems
) < 0) {

424 
	`tİËv–_ERR
(
fv
->
tİ
, "E¼Ü‡µlyšg cÚ‹xt: %s", 
	`¡»¼Ü
(
”ºo
));

426 
	}
}

433 
f‹r_v›w_­¶y_’Œy
(
f‹r_v›w
 *
fv
, 
GtkEÁry
 * 
’Œy
, (*
modif›r
è(
£aud™_f‹r_t
 *, const *))

435 cÚ¡ *
s
 = 
	`gtk_’Œy_g‘_‹xt
(
’Œy
);

436 ià(
	`¡rcmp
(
s
, "") == 0) {

437 
s
 = 
NULL
;

439 ià(
	`modif›r
(
fv
->
f‹r
, 
s
) < 0) {

440 
	`tİËv–_ERR
(
fv
->
tİ
, "E¼Ü‡µly s‘tšgs: %s", 
	`¡»¼Ü
(
”ºo
));

442 
	}
}

447 
	$f‹r_v›w_­¶y_Ùh”
(
f‹r_v›w
 *
fv
)

449 cÚ¡ *
s
;

450 
pÜt
 = 0;

451 
£aud™_avc_mes§ge_ty³_e
 
mes§ge_ty³
;

453 
	`f‹r_v›w_­¶y_’Œy
(
fv
, fv->
addr_’Œy
, 
£aud™_f‹r_£t_ªyaddr
);

454 
s
 = 
	`gtk_’Œy_g‘_‹xt
(
fv
->
pÜt_’Œy
);

455 ià(
	`¡rcmp
(
s
, "") != 0) {

456 
pÜt
 = 
	`©oi
(
s
);

458 ià(
	`£aud™_f‹r_£t_ªypÜt
(
fv
->
f‹r
, 
pÜt
) < 0) {

459 
	`tİËv–_ERR
(
fv
->
tİ
, "E¼Ü s‘tšg f‹r: %s", 
	`¡»¼Ü
(
”ºo
));

462 
	`f‹r_v›w_­¶y_’Œy
(
fv
, fv->
Ãtif_’Œy
, 
£aud™_f‹r_£t_Ãtif
);

463 
	`f‹r_v›w_­¶y_’Œy
(
fv
, fv->
exe_’Œy
, 
£aud™_f‹r_£t_execubË
);

464 
	`f‹r_v›w_­¶y_’Œy
(
fv
, fv->
·th_’Œy
, 
£aud™_f‹r_£t_·th
);

465 
	`f‹r_v›w_­¶y_’Œy
(
fv
, fv->
ho¡_’Œy
, 
£aud™_f‹r_£t_ho¡
);

466 
	`f‹r_v›w_­¶y_’Œy
(
fv
, fv->
comm_’Œy
, 
£aud™_f‹r_£t_commªd
);

467 
	`gtk_combo_box_g‘_aùive
(
fv
->
mes§ge_combo
)) {

469 
mes§ge_ty³
 = 
SEAUDIT_AVC_DENIED
;

472 
mes§ge_ty³
 = 
SEAUDIT_AVC_GRANTED
;

475 
mes§ge_ty³
 = 
SEAUDIT_AVC_UNKNOWN
;

477 ià(
	`£aud™_f‹r_£t_mes§ge_ty³
(
fv
->
f‹r
, 
mes§ge_ty³
) < 0) {

478 
	`tİËv–_ERR
(
fv
->
tİ
, "E¼Ü s‘tšg f‹r: %s", 
	`¡»¼Ü
(
”ºo
));

481 
	}
}

489 
	$f‹r_v›w_g‘_d©e_m©ch
(
f‹r_v›w
 *
fv
)

491 ià(
	`gtk_toggË_bu‰Ú_g‘_aùive
(
	`GTK_TOGGLE_BUTTON
(
fv
->
d©e_befÜe_¿dio
))) {

492  
SEAUDIT_FILTER_DATE_MATCH_BEFORE
;

494 ià(
	`gtk_toggË_bu‰Ú_g‘_aùive
(
	`GTK_TOGGLE_BUTTON
(
fv
->
d©e_aá”_¿dio
))) {

495  
SEAUDIT_FILTER_DATE_MATCH_AFTER
;

497 ià(
	`gtk_toggË_bu‰Ú_g‘_aùive
(
	`GTK_TOGGLE_BUTTON
(
fv
->
d©e_b‘w“n_¿dio
))) {

498  
SEAUDIT_FILTER_DATE_MATCH_BETWEEN
;

501 
	}
}

506 
	$f‹r_v›w_­¶y_d©e
(
f‹r_v›w
 *
fv
)

508 
tm
m[2];

509 
size_t
 
i
;

510 
d©e_m©ch
 = 
	`f‹r_v›w_g‘_d©e_m©ch
(
fv
);

511 
	`mem£t
(&
tm
, 0, (tm));

512 
i
 = 0; i < 2; i++) {

513 
tm
[
i
].
tm_mÚ
 = 
	`gtk_combo_box_g‘_aùive
(
fv
->
d©es
[i].
mÚth
);

514 
tm
[
i
].
tm_mday
 = 
	`gtk_¥š_bu‰Ú_g‘_v®ue_as_št
(
fv
->
d©es
[i].
day
);

515 
tm
[
i
].
tm_y—r
 = 0;

516 
tm
[
i
].
tm_hour
 = 
	`gtk_¥š_bu‰Ú_g‘_v®ue_as_št
(
fv
->
d©es
[i].
hour
);

517 
tm
[
i
].
tm_mš
 = 
	`gtk_¥š_bu‰Ú_g‘_v®ue_as_št
(
fv
->
d©es
[i].
mšu‹
);

518 
tm
[
i
].
tm_£c
 = 
	`gtk_¥š_bu‰Ú_g‘_v®ue_as_št
(
fv
->
d©es
[i].
£cÚd
);

520 ià(
d©e_m©ch
 < 0) {

521 
	`£aud™_f‹r_£t_d©e
(
fv
->
f‹r
, 
NULL
, NULL, 0);

523 
	`£aud™_f‹r_£t_d©e
(
fv
->
f‹r
, 
tm
 + 0,m + 1, (
£aud™_f‹r_d©e_m©ch_e
è
d©e_m©ch
);

525 
	}
}

530 
	$f‹r_v›w_­¶y
(
f‹r_v›w
 *
fv
)

532 
GtkTextI‹r
 
¡¬t
, 
’d
;

533 *
s
;

534 
£aud™_f‹r_m©ch_e
 
m©ch
 = 
SEAUDIT_FILTER_MATCH_ALL
;

536 
	`f‹r_v›w_­¶y_’Œy
(
fv
, fv->
Çme_’Œy
, 
£aud™_f‹r_£t_Çme
);

537 ià(
	`gtk_combo_box_g‘_aùive
(
fv
->
m©ch_combo
) == 1) {

538 
m©ch
 = 
SEAUDIT_FILTER_MATCH_ANY
;

540 ià(
	`£aud™_f‹r_£t_m©ch
(
fv
->
f‹r
, 
m©ch
) < 0) {

541 
	`tİËv–_ERR
(
fv
->
tİ
, "E¼Ü s‘tšg f‹r: %s", 
	`¡»¼Ü
(
”ºo
));

544 
	`f‹r_v›w_­¶y_cÚ‹xt
(
fv
);

545 
	`f‹r_v›w_­¶y_Ùh”
(
fv
);

546 
	`f‹r_v›w_­¶y_d©e
(
fv
);

548 
	`gtk_‹xt_bufãr_g‘_bounds
(
fv
->
desütiÚ_bufãr
, &
¡¬t
, &
’d
);

549 
s
 = 
	`gtk_‹xt_bufãr_g‘_‹xt
(
fv
->
desütiÚ_bufãr
, &
¡¬t
, &
’d
, 
FALSE
);

550 ià(
	`¡rcmp
(
s
, "") == 0) {

551 
	`ä“
(
s
);

552 
s
 = 
NULL
;

554 ià(
	`£aud™_f‹r_£t_desütiÚ
(
fv
->
f‹r
, 
s
) < 0) {

555 
	`tİËv–_ERR
(
fv
->
tİ
, "E¼Ü s‘tšg f‹r: %s", 
	`¡»¼Ü
(
”ºo
));

557 
	`ä“
(
s
);

558 
	}
}

566 
­Ş_veùÜ_t
 *
	$f‹r_v›w_g‘_pŞicy_u£rs
(
f‹r_v›w
 *
fv
)

568 
­Ş_veùÜ_t
 *
pŞicy_™ems
 = 
NULL
, *
v
 = NULL;

569 
­Ş_pŞicy_t
 *
p
 = 
	`tİËv–_g‘_pŞicy
(
fv
->
tİ
);

570 
size_t
 
i
;

571 ià(
p
 =ğ
NULL
) {

572  
NULL
;

574 ià(
	`­Ş_u£r_g‘_by_qu”y
(
p
, 
NULL
, &
v
è< 0 || (
pŞicy_™ems
 = 
	`­Ş_veùÜ_ü—‹
(NULL)) == NULL) {

575 
	`tİËv–_ERR
(
fv
->
tİ
, "E¼Ü g‘tšg‡†i¡ oàpŞicy u£rs: %s", 
	`¡»¼Ü
(
”ºo
));

576 
	`­Ş_veùÜ_de¡roy
(&
pŞicy_™ems
);

577  
NULL
;

579 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v
); i++) {

580 cÚ¡ 
qpŞ_u£r_t
 *
e
 = 
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

581 cÚ¡ *
Çme
;

582 
	`qpŞ_u£r_g‘_Çme
(
	`­Ş_pŞicy_g‘_qpŞ
(
p
), 
e
, &
Çme
);

583 ià(
	`­Ş_veùÜ_­³nd
(
pŞicy_™ems
, (*)
Çme
) < 0) {

584 
	`tİËv–_ERR
(
fv
->
tİ
, "E¼Ü g‘tšg‡†i¡ oàpŞicy u£rs: %s", 
	`¡»¼Ü
(
”ºo
));

585 
	`­Ş_veùÜ_de¡roy
(&
v
);

586 
	`­Ş_veùÜ_de¡roy
(&
pŞicy_™ems
);

589 
	`­Ş_veùÜ_de¡roy
(&
v
);

590 
	`­Ş_veùÜ_sÜt
(
pŞicy_™ems
, 
­Ş_¡r_¡rcmp
, 
NULL
);

591  
pŞicy_™ems
;

592 
	}
}

598 
­Ş_veùÜ_t
 *
	$f‹r_v›w_g‘_pŞicy_rŞes
(
f‹r_v›w
 *
fv
)

600 
­Ş_veùÜ_t
 *
pŞicy_™ems
 = 
NULL
, *
v
 = NULL;

601 
­Ş_pŞicy_t
 *
p
 = 
	`tİËv–_g‘_pŞicy
(
fv
->
tİ
);

602 
size_t
 
i
;

603 ià(
p
 =ğ
NULL
) {

604  
NULL
;

606 ià(
	`­Ş_rŞe_g‘_by_qu”y
(
p
, 
NULL
, &
v
è< 0 || (
pŞicy_™ems
 = 
	`­Ş_veùÜ_ü—‹
(NULL)) == NULL) {

607 
	`tİËv–_ERR
(
fv
->
tİ
, "E¼Ü g‘tšg‡†i¡ oàpŞicy„Şes: %s", 
	`¡»¼Ü
(
”ºo
));

608 
	`­Ş_veùÜ_de¡roy
(&
pŞicy_™ems
);

609  
NULL
;

611 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v
); i++) {

612 cÚ¡ 
qpŞ_rŞe_t
 *
e
 = 
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

613 cÚ¡ *
Çme
;

614 
	`qpŞ_rŞe_g‘_Çme
(
	`­Ş_pŞicy_g‘_qpŞ
(
p
), 
e
, &
Çme
);

615 ià(
	`­Ş_veùÜ_­³nd
(
pŞicy_™ems
, (*)
Çme
) < 0) {

616 
	`tİËv–_ERR
(
fv
->
tİ
, "E¼Ü g‘tšg‡†i¡ oàpŞicy„Şes: %s", 
	`¡»¼Ü
(
”ºo
));

617 
	`­Ş_veùÜ_de¡roy
(&
v
);

618 
	`­Ş_veùÜ_de¡roy
(&
pŞicy_™ems
);

621 
	`­Ş_veùÜ_de¡roy
(&
v
);

622 
	`­Ş_veùÜ_sÜt
(
pŞicy_™ems
, 
­Ş_¡r_¡rcmp
, 
NULL
);

623  
pŞicy_™ems
;

624 
	}
}

631 
­Ş_veùÜ_t
 *
	$f‹r_v›w_g‘_pŞicy_ty³s
(
f‹r_v›w
 *
fv
)

633 
­Ş_veùÜ_t
 *
pŞicy_™ems
 = 
NULL
, *
v
 = NULL;

634 
­Ş_pŞicy_t
 *
p
 = 
	`tİËv–_g‘_pŞicy
(
fv
->
tİ
);

635 
size_t
 
i
;

636 ià(
p
 =ğ
NULL
) {

637  
NULL
;

639 ià(
	`­Ş_ty³_g‘_by_qu”y
(
p
, 
NULL
, &
v
è< 0 || (
pŞicy_™ems
 = 
	`­Ş_veùÜ_ü—‹
(NULL)) == NULL) {

640 
	`tİËv–_ERR
(
fv
->
tİ
, "E¼Ü g‘tšg‡†i¡ oàpŞicyy³s: %s", 
	`¡»¼Ü
(
”ºo
));

641 
	`­Ş_veùÜ_de¡roy
(&
pŞicy_™ems
);

642  
NULL
;

644 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v
); i++) {

645 cÚ¡ 
qpŞ_ty³_t
 *
e
 = 
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

646 cÚ¡ *
Çme
;

647 
	`qpŞ_ty³_g‘_Çme
(
	`­Ş_pŞicy_g‘_qpŞ
(
p
), 
e
, &
Çme
);

648 ià(
	`­Ş_veùÜ_­³nd
(
pŞicy_™ems
, (*)
Çme
) < 0) {

649 
	`tİËv–_ERR
(
fv
->
tİ
, "E¼Ü g‘tšg‡†i¡ oàpŞicyy³s: %s", 
	`¡»¼Ü
(
”ºo
));

650 
	`­Ş_veùÜ_de¡roy
(&
v
);

651 
	`­Ş_veùÜ_de¡roy
(&
pŞicy_™ems
);

654 
	`­Ş_veùÜ_de¡roy
(&
v
);

655 
	`­Ş_veùÜ_sÜt
(
pŞicy_™ems
, 
­Ş_¡r_¡rcmp
, 
NULL
);

656  
pŞicy_™ems
;

657 
	}
}

664 
­Ş_veùÜ_t
 *
	$f‹r_v›w_g‘_pŞicy_mls_lvl
(
f‹r_v›w
 *
fv
)

666 
­Ş_veùÜ_t
 *
pŞicy_™ems
 = 
NULL
, *
v
 = NULL;

667 
­Ş_pŞicy_t
 *
p
 = 
	`tİËv–_g‘_pŞicy
(
fv
->
tİ
);

668 cÚ¡ 
qpŞ_™”©Ü_t
 **
ÿts
 = 
NULL
;

670 
size_t
 
i
;

672 ià(
p
 =ğ
NULL
) {

673  
NULL
;

676 ià(
	`­Ş_Ëv–_g‘_by_qu”y
(
p
, 
NULL
, &
v
è< 0 || (
pŞicy_™ems
 = 
	`­Ş_veùÜ_ü—‹
(&
ä“
)) == NULL) {

677 
	`tİËv–_ERR
(
fv
->
tİ
, "E¼Ü g‘tšg‡†i¡ oàpŞicy ml Ëv–s: %s", 
	`¡»¼Ü
(
”ºo
));

678 
	`­Ş_veùÜ_de¡roy
(&
pŞicy_™ems
);

679  
NULL
;

682 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v
); i++)

684 cÚ¡ *
Çme
 = 
NULL
;

685 cÚ¡ *
mls
 = 
	`m®loc
(100*(mls));

687 cÚ¡ *
ÿt_Çme1
 = 
NULL
, *
ÿt_Çme2
 = NULL;

688 
ušt32_t
 *
ÿt_v®1
, *
ÿt_v®2
;

689 cÚ¡ *
ÿt_low
 = 
NULL
;

690 cÚ¡ *
ÿt_high
 = 
NULL
;

691 
boŞ
 
i¤ªge
 = 
çl£
, 
i¤ªge_’d
 = f®£, 
i£m±y
 = 
Œue
;

692 
size_t
 
k
;

693 
qpŞ_ÿt_t
 *
c
 = 
NULL
;

694 cÚ¡ 
qpŞ_Ëv–_t
 *
e
 = 
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

696 
	`qpŞ_Ëv–_g‘_Çme
(
	`­Ş_pŞicy_g‘_qpŞ
(
p
), 
e
, &
Çme
);

697 
	`¡rıy
(
mls
, 
Çme
);

698 ià(
	`qpŞ_Ëv–_g‘_ÿt_™”
(
	`­Ş_pŞicy_g‘_qpŞ
(
p
), 
e
, &
ÿts
) < 0){

699 
	`tİËv–_ERR
(
fv
->
tİ
, "E¼Ü g‘tšg c©egÜ› fÜ†ev–: %s", 
	`¡»¼Ü
(
”ºo
));

700 
	`qpŞ_™”©Ü_de¡roy
(&
ÿts
);

702 
	`qpŞ_™”©Ü_g‘_size
(
ÿts
, &
k
);

704 ià(
k
 > 0){

705 
	`¡rÿt
(
mls
, ":");

706 
i£m±y
 = 
Œue
;

708 ià(
	`qpŞ_™”©Ü_g‘_™em
(
ÿts
, &
c
) < 0){

709 
	`tİËv–_ERR
(
fv
->
tİ
, "E¼Ü g‘tšg c©egÜy: %s", 
	`¡»¼Ü
(
”ºo
));

710 
	`qpŞ_™”©Ü_de¡roy
(&
ÿts
);

712 
	`qpŞ_ÿt_g‘_v®ue
(
	`­Ş_pŞicy_g‘_qpŞ
(
p
), 
c
, &
ÿt_v®1
);

713 
	`qpŞ_ÿt_g‘_Çme
(
	`­Ş_pŞicy_g‘_qpŞ
(
p
), 
c
, &
ÿt_Çme1
);

714 
i¤ªge
 = 
çl£
;

715 
i¤ªge_’d
 = 
çl£
;

717 ; !
	`qpŞ_™”©Ü_’d
(
ÿts
); 
	`qpŞ_™”©Ü_Ãxt
(cats))

719 ià(
	`qpŞ_™”©Ü_g‘_™em
(
ÿts
, &
c
) < 0){

720 
	`tİËv–_ERR
(
fv
->
tİ
, "E¼Ü g‘tšg c©egÜy: %s", 
	`¡»¼Ü
(
”ºo
));

721 
	`qpŞ_™”©Ü_de¡roy
(&
ÿts
);

723 
	`qpŞ_ÿt_g‘_v®ue
(
	`­Ş_pŞicy_g‘_qpŞ
(
p
), 
c
, &
ÿt_v®2
);

724 
	`qpŞ_ÿt_g‘_Çme
(
	`­Ş_pŞicy_g‘_qpŞ
(
p
), 
c
, &
ÿt_Çme2
);

725 ià((()
ÿt_v®2
 =ğ(()
ÿt_v®1
 + 1)è&& (
i¤ªge
 =ğ
çl£
))

727 
ÿt_low
 = 
ÿt_Çme1
;

728 
	`¡rÿt
(
mls
, 
ÿt_low
);

729 
	`¡rÿt
(
mls
, ".");

730 
i¤ªge
 = 
Œue
;

731 
i£m±y
 = 
çl£
;

733 ià((
i¤ªge
 =ğ
Œue
è&& (()
ÿt_v®2
 =ğ(()
ÿt_v®1
 + 1)))

735 
ÿt_high
 = 
ÿt_Çme2
;

737 ià((
i¤ªge
 =ğ
Œue
è&& (()
ÿt_v®2
 !ğ(()
ÿt_v®1
 + 1)))

739 
ÿt_high
 = 
ÿt_Çme1
;

740 
i¤ªge_’d
 = 
Œue
;

741 
	`¡rÿt
(
mls
, 
ÿt_high
);

742 
i£m±y
=
çl£
;

744 ià((
i¤ªge
 =ğ
çl£
è&& (
i£m±y
 =ğçl£è&& (()
ÿt_v®2
 !ğ(()
ÿt_v®1
 + 1)))

746 
	`¡rÿt
(
mls
, ",");

747 
	`¡rÿt
(
mls
, 
ÿt_Çme2
);

749 
ÿt_v®1
 = 
ÿt_v®2
;

750 
ÿt_Çme1
 = 
ÿt_Çme2
;

753 ià((
i¤ªge
 =ğ
Œue
è&& (
i¤ªge_’d
 =ğ
çl£
))

755 
	`¡rÿt
(
mls
, 
ÿt_high
);

757 ià(
	`­Ş_veùÜ_­³nd
(
pŞicy_™ems
, (*)
mls
) < 0) {

758 
	`tİËv–_ERR
(
fv
->
tİ
, "E¼Ü g‘tšg‡†i¡ oàpŞicy ml Ëv–s: %s", 
	`¡»¼Ü
(
”ºo
));

759 
	`­Ş_veùÜ_de¡roy
(&
v
);

760 
	`­Ş_veùÜ_de¡roy
(&
pŞicy_™ems
);

764 
	`­Ş_veùÜ_de¡roy
(&
v
);

765 
	`qpŞ_™”©Ü_de¡roy
(&
ÿts
);

766 
	`­Ş_veùÜ_sÜt
(
pŞicy_™ems
, 
­Ş_¡r_¡rcmp
, 
NULL
);

767  
pŞicy_™ems
;

768 
	}
}

775 
­Ş_veùÜ_t
 *
	$f‹r_v›w_g‘_pŞicy_şas£s
(
f‹r_v›w
 *
fv
)

777 
­Ş_veùÜ_t
 *
pŞicy_™ems
 = 
NULL
, *
v
 = NULL;

778 
­Ş_pŞicy_t
 *
p
 = 
	`tİËv–_g‘_pŞicy
(
fv
->
tİ
);

779 
size_t
 
i
;

780 ià(
p
 =ğ
NULL
) {

781  
NULL
;

783 ià(
	`­Ş_şass_g‘_by_qu”y
(
p
, 
NULL
, &
v
è< 0 || (
pŞicy_™ems
 = 
	`­Ş_veùÜ_ü—‹
(NULL)) == NULL) {

784 
	`tİËv–_ERR
(
fv
->
tİ
, "E¼Ü g‘tšg‡†i¡ oàpŞicy cÏs£s: %s", 
	`¡»¼Ü
(
”ºo
));

785 
	`­Ş_veùÜ_de¡roy
(&
pŞicy_™ems
);

786  
NULL
;

788 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v
); i++) {

789 cÚ¡ 
qpŞ_şass_t
 *
e
 = 
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

790 cÚ¡ *
Çme
;

791 
	`qpŞ_şass_g‘_Çme
(
	`­Ş_pŞicy_g‘_qpŞ
(
p
), 
e
, &
Çme
);

792 ià(
	`­Ş_veùÜ_­³nd
(
pŞicy_™ems
, (*)
Çme
) < 0) {

793 
	`tİËv–_ERR
(
fv
->
tİ
, "E¼Ü g‘tšg‡†i¡ oàpŞicy cÏs£s: %s", 
	`¡»¼Ü
(
”ºo
));

794 
	`­Ş_veùÜ_de¡roy
(&
v
);

795 
	`­Ş_veùÜ_de¡roy
(&
pŞicy_™ems
);

798 
	`­Ş_veùÜ_de¡roy
(&
v
);

799 
	`­Ş_veùÜ_sÜt
(
pŞicy_™ems
, 
­Ş_¡r_¡rcmp
, 
NULL
);

800  
pŞicy_™ems
;

801 
	}
}

803 
f‹r_v›w_Ú_su£r_cÚ‹xt_şick
(
GtkBu‰Ú
 * 
widg‘
 
__©Œibu‹__
 ((
unu£d
)), 
gpoš‹r
 
u£r_d©a
)

805 
f‹r_v›w
 *
	gfv
 = (f‹r_v›w *)
u£r_d©a
;

806 
­Ş_veùÜ_t
 *
	glog_™ems
 = 
tİËv–_g‘_log_u£rs
(
fv
->
tİ
);

807 
­Ş_veùÜ_t
 *
	gpŞicy_™ems
 = 
f‹r_v›w_g‘_pŞicy_u£rs
(
fv
);

808 
	gfv
->
	gsu£r
.
	g™ems
 =

809 
pŞicy_compÚ’ts_v›w_run
(
fv
->
tİ
, 
GTK_WINDOW
(fv->
dŸlog
), "Sourû U£¸I‹ms", 
log_™ems
, 
pŞicy_™ems
,

810 
fv
->
su£r
.
™ems
);

811 
­Ş_veùÜ_de¡roy
(&
log_™ems
);

812 
­Ş_veùÜ_de¡roy
(&
pŞicy_™ems
);

813 
f‹r_v›w_cÚ‹xt_™em_to_’Œy
(
fv
, &fv->
su£r
);

816 
f‹r_v›w_Ú_¤Şe_cÚ‹xt_şick
(
GtkBu‰Ú
 * 
widg‘
 
__©Œibu‹__
 ((
unu£d
)), 
gpoš‹r
 
u£r_d©a
)

818 
f‹r_v›w
 *
	gfv
 = (f‹r_v›w *)
u£r_d©a
;

819 
­Ş_veùÜ_t
 *
	glog_™ems
 = 
tİËv–_g‘_log_rŞes
(
fv
->
tİ
);

820 
­Ş_veùÜ_t
 *
	gpŞicy_™ems
 = 
f‹r_v›w_g‘_pŞicy_rŞes
(
fv
);

821 
	gfv
->
	g¤Şe
.
	g™ems
 =

822 
pŞicy_compÚ’ts_v›w_run
(
fv
->
tİ
, 
GTK_WINDOW
(fv->
dŸlog
), "Sourû RŞI‹ms", 
log_™ems
, 
pŞicy_™ems
,

823 
fv
->
¤Şe
.
™ems
);

824 
­Ş_veùÜ_de¡roy
(&
log_™ems
);

825 
­Ş_veùÜ_de¡roy
(&
pŞicy_™ems
);

826 
f‹r_v›w_cÚ‹xt_™em_to_’Œy
(
fv
, &fv->
¤Şe
);

829 
f‹r_v›w_Ú_¡y³_cÚ‹xt_şick
(
GtkBu‰Ú
 * 
widg‘
 
__©Œibu‹__
 ((
unu£d
)), 
gpoš‹r
 
u£r_d©a
)

831 
f‹r_v›w
 *
	gfv
 = (f‹r_v›w *)
u£r_d©a
;

832 
­Ş_veùÜ_t
 *
	glog_™ems
 = 
tİËv–_g‘_log_ty³s
(
fv
->
tİ
);

833 
­Ş_veùÜ_t
 *
	gpŞicy_™ems
 = 
f‹r_v›w_g‘_pŞicy_ty³s
(
fv
);

834 
	gfv
->
	g¡y³
.
	g™ems
 =

835 
pŞicy_compÚ’ts_v›w_run
(
fv
->
tİ
, 
GTK_WINDOW
(fv->
dŸlog
), "Sourû Ty³ I‹ms", 
log_™ems
, 
pŞicy_™ems
,

836 
fv
->
¡y³
.
™ems
);

837 
­Ş_veùÜ_de¡roy
(&
log_™ems
);

838 
­Ş_veùÜ_de¡roy
(&
pŞicy_™ems
);

839 
f‹r_v›w_cÚ‹xt_™em_to_’Œy
(
fv
, &fv->
¡y³
);

842 
f‹r_v›w_Ú_smls_lvl_cÚ‹xt_şick
(
GtkBu‰Ú
 * 
widg‘
 
__©Œibu‹__
 ((
unu£d
)), 
gpoš‹r
 
u£r_d©a
)

844 
f‹r_v›w
 *
	gfv
 = (f‹r_v›w *)
u£r_d©a
;

846 
­Ş_veùÜ_t
 *
	glog_™ems
 = 
tİËv–_g‘_log_mls_lvl
(
fv
->
tİ
);

847 
­Ş_veùÜ_t
 *
	gpŞicy_™ems
 = 
f‹r_v›w_g‘_pŞicy_mls_lvl
(
fv
);

848 
	gfv
->
	gsmls_lvl
.
	g™ems
 =

849 
pŞicy_compÚ’ts_v›w_run
(
fv
->
tİ
, 
GTK_WINDOW
(fv->
dŸlog
), "Sourû MLS Lev– I‹ms", 
log_™ems
, 
pŞicy_™ems
,

850 
fv
->
smls_lvl
.
™ems
);

851 
­Ş_veùÜ_de¡roy
(&
log_™ems
);

852 
­Ş_veùÜ_de¡roy
(&
pŞicy_™ems
);

853 
f‹r_v›w_cÚ‹xt_™em_to_’Œy
(
fv
, &fv->
smls_lvl
);

856 
f‹r_v›w_Ú_smls_şr_cÚ‹xt_şick
(
GtkBu‰Ú
 * 
widg‘
 
__©Œibu‹__
 ((
unu£d
)), 
gpoš‹r
 
u£r_d©a
)

858 
f‹r_v›w
 *
	gfv
 = (f‹r_v›w *)
u£r_d©a
;

859 
­Ş_veùÜ_t
 *
	glog_™ems
 = 
tİËv–_g‘_log_mls_şr
(
fv
->
tİ
);

860 
­Ş_veùÜ_t
 *
	gpŞicy_™ems
 = 
f‹r_v›w_g‘_pŞicy_mls_lvl
(
fv
);

861 
	gfv
->
	gsmls_şr
.
	g™ems
 =

862 
pŞicy_compÚ’ts_v›w_run
(
fv
->
tİ
, 
GTK_WINDOW
(fv->
dŸlog
), "Sourû MLS CË¬ªû I‹ms", 
log_™ems
, 
pŞicy_™ems
,

863 
fv
->
smls_şr
.
™ems
);

864 
­Ş_veùÜ_de¡roy
(&
log_™ems
);

865 
­Ş_veùÜ_de¡roy
(&
pŞicy_™ems
);

866 
f‹r_v›w_cÚ‹xt_™em_to_’Œy
(
fv
, &fv->
smls_şr
);

869 
f‹r_v›w_Ú_tu£r_cÚ‹xt_şick
(
GtkBu‰Ú
 * 
widg‘
 
__©Œibu‹__
 ((
unu£d
)), 
gpoš‹r
 
u£r_d©a
)

871 
f‹r_v›w
 *
	gfv
 = (f‹r_v›w *)
u£r_d©a
;

872 
­Ş_veùÜ_t
 *
	glog_™ems
 = 
tİËv–_g‘_log_u£rs
(
fv
->
tİ
);

873 
­Ş_veùÜ_t
 *
	gpŞicy_™ems
 = 
f‹r_v›w_g‘_pŞicy_u£rs
(
fv
);

874 
	gfv
->
	gtu£r
.
	g™ems
 =

875 
pŞicy_compÚ’ts_v›w_run
(
fv
->
tİ
, 
GTK_WINDOW
(fv->
dŸlog
), "T¬g‘ U£¸I‹ms", 
log_™ems
, 
pŞicy_™ems
,

876 
fv
->
tu£r
.
™ems
);

877 
­Ş_veùÜ_de¡roy
(&
log_™ems
);

878 
­Ş_veùÜ_de¡roy
(&
pŞicy_™ems
);

879 
f‹r_v›w_cÚ‹xt_™em_to_’Œy
(
fv
, &fv->
tu£r
);

882 
f‹r_v›w_Ú_ŒŞe_cÚ‹xt_şick
(
GtkBu‰Ú
 * 
widg‘
 
__©Œibu‹__
 ((
unu£d
)), 
gpoš‹r
 
u£r_d©a
)

884 
f‹r_v›w
 *
	gfv
 = (f‹r_v›w *)
u£r_d©a
;

885 
­Ş_veùÜ_t
 *
	glog_™ems
 = 
tİËv–_g‘_log_rŞes
(
fv
->
tİ
);

886 
­Ş_veùÜ_t
 *
	gpŞicy_™ems
 = 
f‹r_v›w_g‘_pŞicy_rŞes
(
fv
);

887 
	gfv
->
	gŒŞe
.
	g™ems
 =

888 
pŞicy_compÚ’ts_v›w_run
(
fv
->
tİ
, 
GTK_WINDOW
(fv->
dŸlog
), "T¬g‘ RŞI‹ms", 
log_™ems
, 
pŞicy_™ems
,

889 
fv
->
ŒŞe
.
™ems
);

890 
­Ş_veùÜ_de¡roy
(&
log_™ems
);

891 
­Ş_veùÜ_de¡roy
(&
pŞicy_™ems
);

892 
f‹r_v›w_cÚ‹xt_™em_to_’Œy
(
fv
, &fv->
ŒŞe
);

895 
f‹r_v›w_Ú_‰y³_cÚ‹xt_şick
(
GtkBu‰Ú
 * 
widg‘
 
__©Œibu‹__
 ((
unu£d
)), 
gpoš‹r
 
u£r_d©a
)

897 
f‹r_v›w
 *
	gfv
 = (f‹r_v›w *)
u£r_d©a
;

898 
­Ş_veùÜ_t
 *
	glog_™ems
 = 
tİËv–_g‘_log_ty³s
(
fv
->
tİ
);

899 
­Ş_veùÜ_t
 *
	gpŞicy_™ems
 = 
f‹r_v›w_g‘_pŞicy_ty³s
(
fv
);

900 
	gfv
->
	g‰y³
.
	g™ems
 =

901 
pŞicy_compÚ’ts_v›w_run
(
fv
->
tİ
, 
GTK_WINDOW
(fv->
dŸlog
), "T¬g‘ Ty³ I‹ms", 
log_™ems
, 
pŞicy_™ems
,

902 
fv
->
‰y³
.
™ems
);

903 
­Ş_veùÜ_de¡roy
(&
log_™ems
);

904 
­Ş_veùÜ_de¡roy
(&
pŞicy_™ems
);

905 
f‹r_v›w_cÚ‹xt_™em_to_’Œy
(
fv
, &fv->
‰y³
);

908 
f‹r_v›w_Ú_tmls_lvl_cÚ‹xt_şick
(
GtkBu‰Ú
 * 
widg‘
 
__©Œibu‹__
 ((
unu£d
)), 
gpoš‹r
 
u£r_d©a
)

910 
f‹r_v›w
 *
	gfv
 = (f‹r_v›w *)
u£r_d©a
;

911 
­Ş_veùÜ_t
 *
	glog_™ems
 = 
tİËv–_g‘_log_mls_lvl
(
fv
->
tİ
);

912 
­Ş_veùÜ_t
 *
	gpŞicy_™ems
 = 
f‹r_v›w_g‘_pŞicy_mls_lvl
(
fv
);

913 
	gfv
->
	gtmls_lvl
.
	g™ems
 =

914 
pŞicy_compÚ’ts_v›w_run
(
fv
->
tİ
, 
GTK_WINDOW
(fv->
dŸlog
), "T¬g‘ MLS Lev– I‹ms", 
log_™ems
, 
pŞicy_™ems
,

915 
fv
->
tmls_lvl
.
™ems
);

916 
­Ş_veùÜ_de¡roy
(&
log_™ems
);

917 
­Ş_veùÜ_de¡roy
(&
pŞicy_™ems
);

918 
f‹r_v›w_cÚ‹xt_™em_to_’Œy
(
fv
, &fv->
tmls_lvl
);

921 
f‹r_v›w_Ú_tmls_şr_cÚ‹xt_şick
(
GtkBu‰Ú
 * 
widg‘
 
__©Œibu‹__
 ((
unu£d
)), 
gpoš‹r
 
u£r_d©a
)

923 
f‹r_v›w
 *
	gfv
 = (f‹r_v›w *)
u£r_d©a
;

924 
­Ş_veùÜ_t
 *
	glog_™ems
 = 
tİËv–_g‘_log_mls_şr
(
fv
->
tİ
);

925 
­Ş_veùÜ_t
 *
	gpŞicy_™ems
 = 
f‹r_v›w_g‘_pŞicy_mls_lvl
(
fv
);

926 
	gfv
->
	gtmls_şr
.
	g™ems
 =

927 
pŞicy_compÚ’ts_v›w_run
(
fv
->
tİ
, 
GTK_WINDOW
(fv->
dŸlog
), "T¬g‘ MLS CË¬ªû I‹ms", 
log_™ems
, 
pŞicy_™ems
,

928 
fv
->
tmls_şr
.
™ems
);

929 
­Ş_veùÜ_de¡roy
(&
log_™ems
);

930 
­Ş_veùÜ_de¡roy
(&
pŞicy_™ems
);

931 
f‹r_v›w_cÚ‹xt_™em_to_’Œy
(
fv
, &fv->
tmls_şr
);

934 
f‹r_v›w_Ú_şass_cÚ‹xt_şick
(
GtkBu‰Ú
 * 
widg‘
 
__©Œibu‹__
 ((
unu£d
)), 
gpoš‹r
 
u£r_d©a
)

936 
f‹r_v›w
 *
	gfv
 = (f‹r_v›w *)
u£r_d©a
;

937 
­Ş_veùÜ_t
 *
	glog_™ems
 = 
tİËv–_g‘_log_şas£s
(
fv
->
tİ
);

938 
­Ş_veùÜ_t
 *
	gpŞicy_™ems
 = 
f‹r_v›w_g‘_pŞicy_şas£s
(
fv
);

939 
	gfv
->
	gobj_şass
.
	g™ems
 =

940 
pŞicy_compÚ’ts_v›w_run
(
fv
->
tİ
, 
GTK_WINDOW
(fv->
dŸlog
), "Objeù CÏs I‹ms", 
log_™ems
, 
pŞicy_™ems
,

941 
fv
->
obj_şass
.
™ems
);

942 
­Ş_veùÜ_de¡roy
(&
log_™ems
);

943 
­Ş_veùÜ_de¡roy
(&
pŞicy_™ems
);

944 
f‹r_v›w_cÚ‹xt_™em_to_’Œy
(
fv
, &fv->
obj_şass
);

951 
gboŞ—n
 
f‹r_v›w_Ú_’Œy_focus_out
(
GtkWidg‘
 * 
widg‘
, 
GdkEv’tFocus
 * 
ev’t


952 
__©Œibu‹__
 ((
unu£d
)), 
gpoš‹r
 
u£r_d©a
)

954 
cÚ‹xt_™em
 *
	g™em
 = 
g_objeù_g‘_d©a
(
G_OBJECT
(
widg‘
), "data");

955 
f‹r_v›w
 *
	gfv
 = (f‹r_v›w *)
u£r_d©a
;

956 
gch¬
 **
	g¡rs
 = 
g_¡r¥l™
(
gtk_’Œy_g‘_‹xt
(
GTK_ENTRY
(
widg‘
)), ",", -1);

957 
gch¬
 *
	gs
;

958 
size_t
 
	gi
 = 0;

959 *
	gt
;

960 
­Ş_veùÜ_t
 *
	gÃw_v
 = 
NULL
;

962 
	gs
 = 
¡rs
[
i
++];

963 ià(
	gs
 =ğ
NULL
) {

966 ià(
	gÃw_v
 =ğ
NULL
 && (
Ãw_v
 = 
­Ş_veùÜ_ü—‹
(
ä“
)) == NULL) {

967 
tİËv–_ERR
(
fv
->
tİ
, "Could‚Ù iÁ”´‘ƒÁry cÚ‹Ás: %s", 
¡»¼Ü
(
”ºo
));

970 ià((
	gt
 = 
¡rdup
(
s
)è=ğ
NULL
) {

971 
tİËv–_ERR
(
fv
->
tİ
, "Could‚Ù iÁ”´‘ƒÁry cÚ‹Ás: %s", 
¡»¼Ü
(
”ºo
));

972 
ä“
(
t
);

975 
­Ş_¡r_Œim
(
t
);

976 ià(
­Ş_veùÜ_­³nd
(
Ãw_v
, 
t
) < 0) {

977 
tİËv–_ERR
(
fv
->
tİ
, "Could‚Ù iÁ”´‘ƒÁry cÚ‹Ás: %s", 
¡»¼Ü
(
”ºo
));

978 
ä“
(
t
);

982 
g_¡rä“v
(
¡rs
);

983 
­Ş_veùÜ_de¡roy
(&
™em
->
™ems
);

984 
	g™em
->
	g™ems
 = 
Ãw_v
;

985 
f‹r_v›w_cÚ‹xt_™em_to_’Œy
(
fv
, 
™em
);

986  
	gFALSE
;

989 
	$f‹r_v›w_de¡roy_cÚ‹xt_veùÜs
(
f‹r_v›w
 *
fv
)

991 
	`­Ş_veùÜ_de¡roy
(&
fv
->
su£r
.
™ems
);

992 
	`­Ş_veùÜ_de¡roy
(&
fv
->
¤Şe
.
™ems
);

993 
	`­Ş_veùÜ_de¡roy
(&
fv
->
¡y³
.
™ems
);

994 
	`­Ş_veùÜ_de¡roy
(&
fv
->
smls_lvl
.
™ems
);

995 
	`­Ş_veùÜ_de¡roy
(&
fv
->
smls_şr
.
™ems
);

996 
	`­Ş_veùÜ_de¡roy
(&
fv
->
tu£r
.
™ems
);

997 
	`­Ş_veùÜ_de¡roy
(&
fv
->
ŒŞe
.
™ems
);

998 
	`­Ş_veùÜ_de¡roy
(&
fv
->
‰y³
.
™ems
);

999 
	`­Ş_veùÜ_de¡roy
(&
fv
->
tmls_lvl
.
™ems
);

1000 
	`­Ş_veùÜ_de¡roy
(&
fv
->
tmls_şr
.
™ems
);

1001 
	`­Ş_veùÜ_de¡roy
(&
fv
->
obj_şass
.
™ems
);

1002 
	}
}

1004 
f‹r_v›w_Ú_cÚ‹xt_ş—r_şick
(
GtkBu‰Ú
 * 
widg‘
 
__©Œibu‹__
 ((
unu£d
)), 
gpoš‹r
 
u£r_d©a
)

1006 
f‹r_v›w
 *
	gfv
 = (f‹r_v›w *)
u£r_d©a
;

1007 
f‹r_v›w_de¡roy_cÚ‹xt_veùÜs
(
fv
);

1008 
f‹r_v›w_cÚ‹xt_™ems_to_’Œ›s
(
fv
);

1011 
	$f‹r_v›w_š™_cÚ‹xt_sigÇls
(
f‹r_v›w
 *
fv
)

1013 
	`g_sigÇl_cÚÃù
(
fv
->
su£r
.
bu‰Ú
, "şicked", 
	`G_CALLBACK
(
f‹r_v›w_Ú_su£r_cÚ‹xt_şick
), fv);

1014 
	`g_sigÇl_cÚÃù
(
fv
->
su£r
.
’Œy
, "focus_out_ev’t", 
	`G_CALLBACK
(
f‹r_v›w_Ú_’Œy_focus_out
), fv);

1015 
	`g_sigÇl_cÚÃù
(
fv
->
¤Şe
.
bu‰Ú
, "şicked", 
	`G_CALLBACK
(
f‹r_v›w_Ú_¤Şe_cÚ‹xt_şick
), fv);

1016 
	`g_sigÇl_cÚÃù
(
fv
->
¤Şe
.
’Œy
, "focus_out_ev’t", 
	`G_CALLBACK
(
f‹r_v›w_Ú_’Œy_focus_out
), fv);

1017 
	`g_sigÇl_cÚÃù
(
fv
->
¡y³
.
bu‰Ú
, "şicked", 
	`G_CALLBACK
(
f‹r_v›w_Ú_¡y³_cÚ‹xt_şick
), fv);

1018 
	`g_sigÇl_cÚÃù
(
fv
->
¡y³
.
’Œy
, "focus_out_ev’t", 
	`G_CALLBACK
(
f‹r_v›w_Ú_’Œy_focus_out
), fv);

1019 
	`g_sigÇl_cÚÃù
(
fv
->
smls_lvl
.
bu‰Ú
, "şicked", 
	`G_CALLBACK
(
f‹r_v›w_Ú_smls_lvl_cÚ‹xt_şick
), fv);

1020 
	`g_sigÇl_cÚÃù
(
fv
->
smls_lvl
.
’Œy
, "focus_out_ev’t", 
	`G_CALLBACK
(
f‹r_v›w_Ú_’Œy_focus_out
), fv);

1021 
	`g_sigÇl_cÚÃù
(
fv
->
smls_şr
.
bu‰Ú
, "şicked", 
	`G_CALLBACK
(
f‹r_v›w_Ú_smls_şr_cÚ‹xt_şick
), fv);

1022 
	`g_sigÇl_cÚÃù
(
fv
->
smls_şr
.
’Œy
, "focus_out_ev’t", 
	`G_CALLBACK
(
f‹r_v›w_Ú_’Œy_focus_out
), fv);

1023 
	`g_sigÇl_cÚÃù
(
fv
->
tu£r
.
bu‰Ú
, "şicked", 
	`G_CALLBACK
(
f‹r_v›w_Ú_tu£r_cÚ‹xt_şick
), fv);

1024 
	`g_sigÇl_cÚÃù
(
fv
->
tu£r
.
’Œy
, "focus_out_ev’t", 
	`G_CALLBACK
(
f‹r_v›w_Ú_’Œy_focus_out
), fv);

1025 
	`g_sigÇl_cÚÃù
(
fv
->
ŒŞe
.
bu‰Ú
, "şicked", 
	`G_CALLBACK
(
f‹r_v›w_Ú_ŒŞe_cÚ‹xt_şick
), fv);

1026 
	`g_sigÇl_cÚÃù
(
fv
->
ŒŞe
.
’Œy
, "focus_out_ev’t", 
	`G_CALLBACK
(
f‹r_v›w_Ú_’Œy_focus_out
), fv);

1027 
	`g_sigÇl_cÚÃù
(
fv
->
‰y³
.
bu‰Ú
, "şicked", 
	`G_CALLBACK
(
f‹r_v›w_Ú_‰y³_cÚ‹xt_şick
), fv);

1028 
	`g_sigÇl_cÚÃù
(
fv
->
‰y³
.
’Œy
, "focus_out_ev’t", 
	`G_CALLBACK
(
f‹r_v›w_Ú_’Œy_focus_out
), fv);

1029 
	`g_sigÇl_cÚÃù
(
fv
->
tmls_lvl
.
bu‰Ú
, "şicked", 
	`G_CALLBACK
(
f‹r_v›w_Ú_tmls_lvl_cÚ‹xt_şick
), fv);

1030 
	`g_sigÇl_cÚÃù
(
fv
->
tmls_lvl
.
’Œy
, "focus_out_ev’t", 
	`G_CALLBACK
(
f‹r_v›w_Ú_’Œy_focus_out
), fv);

1031 
	`g_sigÇl_cÚÃù
(
fv
->
tmls_şr
.
bu‰Ú
, "şicked", 
	`G_CALLBACK
(
f‹r_v›w_Ú_tmls_şr_cÚ‹xt_şick
), fv);

1032 
	`g_sigÇl_cÚÃù
(
fv
->
tmls_şr
.
’Œy
, "focus_out_ev’t", 
	`G_CALLBACK
(
f‹r_v›w_Ú_’Œy_focus_out
), fv);

1033 
	`g_sigÇl_cÚÃù
(
fv
->
obj_şass
.
bu‰Ú
, "şicked", 
	`G_CALLBACK
(
f‹r_v›w_Ú_şass_cÚ‹xt_şick
), fv);

1034 
	`g_sigÇl_cÚÃù
(
fv
->
obj_şass
.
’Œy
, "focus_out_ev’t", 
	`G_CALLBACK
(
f‹r_v›w_Ú_’Œy_focus_out
), fv);

1035 
	`g_sigÇl_cÚÃù
(
fv
->
cÚ‹xt_ş—r_bu‰Ú
, "şicked", 
	`G_CALLBACK
(
f‹r_v›w_Ú_cÚ‹xt_ş—r_şick
), fv);

1036 
	}
}

1038 
f‹r_v›w_Ú_Ùh”_ş—r_şick
(
GtkBu‰Ú
 * 
widg‘
 
__©Œibu‹__
 ((
unu£d
)), 
gpoš‹r
 
u£r_d©a
)

1040 
f‹r_v›w
 *
	gfv
 = (f‹r_v›w *)
u£r_d©a
;

1041 
gtk_’Œy_£t_‹xt
(
fv
->
addr_’Œy
, "");

1042 
gtk_’Œy_£t_‹xt
(
fv
->
pÜt_’Œy
, "");

1043 
gtk_’Œy_£t_‹xt
(
fv
->
Ãtif_’Œy
, "");

1044 
gtk_’Œy_£t_‹xt
(
fv
->
exe_’Œy
, "");

1045 
gtk_’Œy_£t_‹xt
(
fv
->
·th_’Œy
, "");

1046 
gtk_’Œy_£t_‹xt
(
fv
->
ho¡_’Œy
, "");

1047 
gtk_’Œy_£t_‹xt
(
fv
->
comm_’Œy
, "");

1048 
gtk_combo_box_£t_aùive
(
fv
->
mes§ge_combo
, 0);

1051 
	$f‹r_v›w_Ú_d©e_toggË
(
GtkToggËBu‰Ú
 * 
widg‘
, 
gpoš‹r
 
u£r_d©a
)

1053 
f‹r_v›w
 *
fv
 = (f‹r_v›w *)
u£r_d©a
;

1054 
m©ch
;

1058 ià(!
	`gtk_toggË_bu‰Ú_g‘_aùive
(
widg‘
)) {

1061 
m©ch
 = 
	`f‹r_v›w_g‘_d©e_m©ch
(
fv
);

1062 
	`gtk_widg‘_£t_£ns™ive
(
	`GTK_WIDGET
(
fv
->
d©es
[0].
äame
), (
m©ch
 != -1));

1063 
	`gtk_widg‘_£t_£ns™ive
(
	`GTK_WIDGET
(
fv
->
d©es
[1].
äame
), (
m©ch
 =ğ
SEAUDIT_FILTER_DATE_MATCH_BETWEEN
));

1064 
	}
}

1068 
	$f‹r_v›w_d©e_£t_numb”_days
(
mÚth
, 
GtkSpšBu‰Ú
 * 
bu‰Ú
)

1070 cÚ¡ 
days
[] = { 31, 29, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31 };

1071 
cur_day
;

1075 
cur_day
 = 
	`gtk_¥š_bu‰Ú_g‘_v®ue_as_št
(
bu‰Ú
);

1076 
	`gtk_¥š_bu‰Ú_£t_¿nge
(
bu‰Ú
, 1, 
days
[
mÚth
]);

1078 
	`gtk_¥š_bu‰Ú_£t_v®ue
(
bu‰Ú
, 
cur_day
);

1079 
	}
}

1081 
	$f‹r_v›w_Ú_mÚth0_chªge
(
GtkComboBox
 * 
widg‘
, 
gpoš‹r
 
u£r_d©a
)

1083 
f‹r_v›w
 *
fv
 = (f‹r_v›w *)
u£r_d©a
;

1084 
	`f‹r_v›w_d©e_£t_numb”_days
(
	`gtk_combo_box_g‘_aùive
(
widg‘
), 
fv
->
d©es
[0].
day
);

1085 
	}
}

1087 
	$f‹r_v›w_Ú_mÚth1_chªge
(
GtkComboBox
 * 
widg‘
, 
gpoš‹r
 
u£r_d©a
)

1089 
f‹r_v›w
 *
fv
 = (f‹r_v›w *)
u£r_d©a
;

1090 
	`f‹r_v›w_d©e_£t_numb”_days
(
	`gtk_combo_box_g‘_aùive
(
widg‘
), 
fv
->
d©es
[1].
day
);

1091 
	}
}

1093 
	$f‹r_v›w_š™_sigÇls
(
f‹r_v›w
 *
fv
)

1095 
	`f‹r_v›w_š™_cÚ‹xt_sigÇls
(
fv
);

1096 
	`g_sigÇl_cÚÃù
(
fv
->
Ùh”_ş—r_bu‰Ú
, "şicked", 
	`G_CALLBACK
(
f‹r_v›w_Ú_Ùh”_ş—r_şick
), fv);

1097 
	`g_sigÇl_cÚÃù
(
fv
->
d©e_nÚe_¿dio
, "toggËd", 
	`G_CALLBACK
(
f‹r_v›w_Ú_d©e_toggË
), fv);

1098 
	`g_sigÇl_cÚÃù
(
fv
->
d©e_befÜe_¿dio
, "toggËd", 
	`G_CALLBACK
(
f‹r_v›w_Ú_d©e_toggË
), fv);

1099 
	`g_sigÇl_cÚÃù
(
fv
->
d©e_aá”_¿dio
, "toggËd", 
	`G_CALLBACK
(
f‹r_v›w_Ú_d©e_toggË
), fv);

1100 
	`g_sigÇl_cÚÃù
(
fv
->
d©e_b‘w“n_¿dio
, "toggËd", 
	`G_CALLBACK
(
f‹r_v›w_Ú_d©e_toggË
), fv);

1101 
	`g_sigÇl_cÚÃù
(
fv
->
d©es
[0].
mÚth
, "chªged", 
	`G_CALLBACK
(
f‹r_v›w_Ú_mÚth0_chªge
), fv);

1102 
	`g_sigÇl_cÚÃù
(
fv
->
d©es
[1].
mÚth
, "chªged", 
	`G_CALLBACK
(
f‹r_v›w_Ú_mÚth1_chªge
), fv);

1103 
	}
}

1107 
	$f‹r_v›w_run
(
£aud™_f‹r_t
 * 
f‹r
, 
tİËv–_t
 * 
tİ
, 
GtkWšdow
 * 
·»Á
)

1109 
f‹r_v›w
 
fv
;

1110 
gšt
 
»¥Ú£
;

1112 
	`mem£t
(&
fv
, 0, (fv));

1113 
fv
.
tİ
 =op;

1114 
fv
.
f‹r
 = filter;

1115 
fv
.
xml
 = 
	`gÏde_xml_Ãw
(
	`tİËv–_g‘_gÏde_xml
(
tİ
), "F‹rWšdow", 
NULL
);

1116 
	`f‹r_v›w_š™_widg‘s
(&
fv
, 
·»Á
);

1117 
	`f‹r_v›w_š™_sigÇls
(&
fv
);

1118 
	`f‹r_v›w_š™_dŸlog
(&
fv
);

1120 
»¥Ú£
 = 
	`gtk_dŸlog_run
(
fv
.
dŸlog
);

1121 } 
»¥Ú£
 !ğ
GTK_RESPONSE_CLOSE
);

1123 
	`f‹r_v›w_­¶y
(&
fv
);

1124 
	`g_objeù_uÄef
(
fv
.
desütiÚ_bufãr
);

1125 
	`gtk_widg‘_de¡roy
(
	`GTK_WIDGET
(
fv
.
dŸlog
));

1126 
	`f‹r_v›w_de¡roy_cÚ‹xt_veùÜs
(&
fv
);

1127 
	}
}

	@seaudit/filter_view.h

25 #iâdeà
FILTER_VIEW_H


26 
	#FILTER_VIEW_H


	)

28 
	~"tİËv–.h
"

29 
	~<£aud™/f‹r.h
>

30 
	~<gtk/gtk.h
>

40 
f‹r_v›w_run
(
£aud™_f‹r_t
 * 
f‹r
, 
tİËv–_t
 * 
tİ
, 
GtkWšdow
 * 
·»Á
);

	@seaudit/message_view.c

26 
	~<cÚfig.h
>

28 
	~"mes§ge_v›w.h
"

29 
	~"modify_v›w.h
"

30 
	~"utgui.h
"

32 
	~<as£¹.h
>

33 
	~<”ºo.h
>

34 
	~<¡dio.h
>

35 
	~<¡ršg.h
>

36 
	~<time.h
>

37 
	~<­Ş/ut.h
>

43 
	smes§ge_v›w_¡Üe


46 
GObjeù
 
	m·»Á
;

48 
mes§ge_v›w_t
 *
	mv›w
;

51 
­Ş_veùÜ_t
 *
	mmes§ges
;

54 
gšt
 
	msÜt_f›ld
;

57 
	msÜt_dœ
;

59 
gšt
 
	m¡amp
;

60 } 
	tmes§ge_v›w_¡Üe_t
;

62 
	smes§ge_v›w_¡Üe_şass


64 
GObjeùCÏss
 
	m·»Á_şass
;

65 } 
	tmes§ge_v›w_¡Üe_şass_t
;

67 
GTy³
 
mes§ge_v›w_¡Üe_g‘_ty³
();

68 
	#SEAUDIT_TYPE_MESSAGE_VIEW_STORE
 (
	`mes§ge_v›w_¡Üe_g‘_ty³
())

	)

69 
	#SEAUDIT_IS_MESSAGE_VIEW_STORE
(
obj
) \

70 (
	`G_TYPE_CHECK_INSTANCE_TYPE
 ((
obj
), 
SEAUDIT_TYPE_MESSAGE_VIEW_STORE
))

	)

72 
	smes§ge_v›w


74 
£aud™_mod–_t
 *
	mmod–
;

75 
tİËv–_t
 *
	mtİ
;

77 
GtkWidg‘
 *
	mw
;

80 
GtkT»eV›w
 *
	mv›w
;

82 
mes§ge_v›w_¡Üe_t
 *
	m¡Üe
;

84 *
	mf’ame
;

86 *
	mexpÜt_f’ame
;

89 
	g£aud™_sÜt_t
 *(*
	tsÜt_g’”©Ü_â_t
è(
	tdœeùiÚ
);

91 
	sv›w_cŞumn_»cÜd


93 
´eã»nû_f›ld_e
 
	mid
;

94 cÚ¡ *
	mÇme
;

95 cÚ¡ *
	m§m¶e_‹xt
;

96 
sÜt_g’”©Ü_â_t
 
	msÜt
;

99 cÚ¡ 
v›w_cŞumn_»cÜd
 
	gcŞumn_d©a
[] = {

100 {
HOST_FIELD
, "Ho¡Çme", "Ho¡Çme", 
£aud™_sÜt_by_ho¡
},

101 {
MESSAGE_FIELD
, "Mes§ge", "Mes§ge", 
£aud™_sÜt_by_mes§ge_ty³
},

102 {
DATE_FIELD
, "D©e", "Jª 01 00:00:00", 
£aud™_sÜt_by_d©e
},

103 {
SUSER_FIELD
, "Sourû\nU£r", "Sourû", 
£aud™_sÜt_by_sourû_u£r
},

104 {
SROLE_FIELD
, "Sourû\nRŞe", "Sourû", 
£aud™_sÜt_by_sourû_rŞe
},

105 {
STYPE_FIELD
, "Sourû\nTy³", "uÆab–ed_t", 
£aud™_sÜt_by_sourû_ty³
},

106 {
SMLS_LVL_FIELD
, "Sourû\nMLS Lev–", "MLS Lev–", 
£aud™_sÜt_by_sourû_mls_lvl
},

107 {
SMLS_CLR_FIELD
, "Sourû\nMLS CË¬ªû", "MLS CË¬ªû", 
£aud™_sÜt_by_sourû_mls_şr
},

108 {
TUSER_FIELD
, "T¬g‘\nU£r", "T¬g‘", 
£aud™_sÜt_by_rg‘_u£r
},

109 {
TROLE_FIELD
, "T¬g‘\nRŞe", "T¬g‘", 
£aud™_sÜt_by_rg‘_rŞe
},

110 {
TTYPE_FIELD
, "T¬g‘\nTy³", "uÆab–ed_t", 
£aud™_sÜt_by_rg‘_ty³
},

111 {
TMLS_LVL_FIELD
, "T¬g‘\nMLS Lev–", "MLS Lev–", 
£aud™_sÜt_by_rg‘_mls_lvl
},

112 {
TMLS_CLR_FIELD
, "T¬g‘\nMLS CË¬ªû", "MLS CË¬ªû", 
£aud™_sÜt_by_rg‘_mls_şr
},

113 {
OBJCLASS_FIELD
, "Objeù\nCÏss", "Objeù", 
£aud™_sÜt_by_objeù_şass
},

114 {
PERM_FIELD
, "P”missiÚ", "P”missiÚ", 
£aud™_sÜt_by_³rmissiÚ
},

115 {
EXECUTABLE_FIELD
, "ExecubË", "/u¤/bš/ÿt", 
£aud™_sÜt_by_execubË
},

116 {
COMMAND_FIELD
, "Commªd", "/u¤/bš/ÿt", 
£aud™_sÜt_by_commªd
},

117 {
NAME_FIELD
, "Name", "iûw—£l", 
£aud™_sÜt_by_Çme
},

118 {
PID_FIELD
, "PID", "12345", 
£aud™_sÜt_by_pid
},

119 {
INODE_FIELD
, "Inode", "123456", 
£aud™_sÜt_by_šode
},

120 {
PATH_FIELD
, "P©h", "/home/gburd–l/foo", 
£aud™_sÜt_by_·th
},

121 {
OTHER_FIELD
, "Oth”", "LÜem ipsum dŞÜ s™‡m‘, cÚ£ù‘ur", 
NULL
}

124 cÚ¡ 
size_t
 
	gnum_cŞumns
 = (
cŞumn_d©a
) / (column_data[0]);

131 
gboŞ—n
 
	$mes§ge_v›w_Ú_cŞumn_şick
(
GtkT»eV›wCŞumn
 * 
cŞumn
, 
gpoš‹r
 
u£r_d©a
)

133 
gšt
 
cŞumn_id
 = 
	`GPOINTER_TO_INT
(
	`g_objeù_g‘_d©a
(
	`G_OBJECT
(
cŞumn
), "column id"));

134 
mes§ge_v›w_t
 *
v›w
 = (mes§ge_v›w_ˆ*è
u£r_d©a
;

135 
dœ
 = 0;

136 
£aud™_sÜt_t
 *
sÜt
;

137 
GtkT»eV›wCŞumn
 *
´ev_cŞumn
;

138 ià(
cŞumn_id
 =ğ
v›w
->
¡Üe
->
sÜt_f›ld
) {

139 
dœ
 = 
v›w
->
¡Üe
->
sÜt_dœ
 * -1;

141 
dœ
 = 1;

144 ià((
sÜt
 = 
cŞumn_d©a
[(
´eã»nû_f›ld_e
è
cŞumn_id
].
	`sÜt
(
dœ
)è=ğ
NULL
) {

145 
	`tİËv–_ERR
(
v›w
->
tİ
, "%s", 
	`¡»¼Ü
(
”ºo
));

146  
TRUE
;

148 
	`£aud™_mod–_ş—r_sÜts
(
v›w
->
mod–
);

149 ià(
	`£aud™_mod–_­³nd_sÜt
(
v›w
->
mod–
, 
sÜt
) < 0) {

150 
	`£aud™_sÜt_de¡roy
(&
sÜt
);

151 
	`tİËv–_ERR
(
v›w
->
tİ
, "%s", 
	`¡»¼Ü
(
”ºo
));

153 
´ev_cŞumn
 = 
	`gtk_Œ“_v›w_g‘_cŞumn
(
v›w
->v›w, v›w->
¡Üe
->
sÜt_f›ld
);

154 ià(
´ev_cŞumn
 !ğ
NULL
) {

155 
	`gtk_Œ“_v›w_cŞumn_£t_sÜt_šdiÿtÜ
(
´ev_cŞumn
, 
FALSE
);

157 
	`gtk_Œ“_v›w_cŞumn_£t_sÜt_šdiÿtÜ
(
cŞumn
, 
TRUE
);

158 ià(
dœ
 > 0) {

159 
	`gtk_Œ“_v›w_cŞumn_£t_sÜt_Üd”
(
cŞumn
, 
GTK_SORT_ASCENDING
);

161 
	`gtk_Œ“_v›w_cŞumn_£t_sÜt_Üd”
(
cŞumn
, 
GTK_SORT_DESCENDING
);

164 
v›w
->
¡Üe
->
sÜt_f›ld
 = 
cŞumn_id
;

165 
v›w
->
¡Üe
->
sÜt_dœ
 = 
dœ
;

166 
	`mes§ge_v›w_upd©e_rows
(
v›w
);

167  
TRUE
;

168 
	}
}

172 
GObjeùCÏss
 *
	g·»Á_şass
 = 
NULL
;

174 
mes§ge_v›w_¡Üe_š™
(
mes§ge_v›w_¡Üe_t
 * 
m
);

175 
mes§ge_v›w_¡Üe_şass_š™
(
mes§ge_v›w_¡Üe_şass_t
 * 
c
);

176 
mes§ge_v›w_¡Üe_Œ“_š™
(
GtkT»eMod–Içû
 * 
içû
);

177 
mes§ge_v›w_¡Üe_fš®ize
(
GObjeù
 * 
objeù
);

178 
GtkT»eMod–FÏgs
 
mes§ge_v›w_¡Üe_g‘_æags
(
GtkT»eMod–
 * 
Œ“_mod–
);

179 
gšt
 
mes§ge_v›w_¡Üe_g‘_n_cŞumns
(
GtkT»eMod–
 * 
Œ“_mod–
);

180 
GTy³
 
mes§ge_v›w_¡Üe_g‘_cŞumn_ty³
(
GtkT»eMod–
 * 
Œ“_mod–
, 
gšt
 
šdex
);

181 
gboŞ—n
 
mes§ge_v›w_¡Üe_g‘_™”
(
GtkT»eMod–
 * 
Œ“_mod–
, 
GtkT»eI‹r
 * 
™”
, 
GtkT»eP©h
 * 
·th
);

182 
GtkT»eP©h
 *
mes§ge_v›w_¡Üe_g‘_·th
(
GtkT»eMod–
 * 
Œ“_mod–
, 
GtkT»eI‹r
 * 
™”
);

183 
mes§ge_v›w_¡Üe_g‘_v®ue
(
GtkT»eMod–
 * 
Œ“_mod–
, 
GtkT»eI‹r
 * 
™”
, 
gšt
 
cŞumn
, 
GV®ue
 * 
v®ue
);

184 
gboŞ—n
 
mes§ge_v›w_¡Üe_™”_Ãxt
(
GtkT»eMod–
 * 
Œ“_mod–
, 
GtkT»eI‹r
 * 
™”
);

185 
gboŞ—n
 
mes§ge_v›w_¡Üe_™”_chd»n
(
GtkT»eMod–
 * 
Œ“_mod–
, 
GtkT»eI‹r
 * 
™”
, GtkT»eI‹¸* 
·»Á
);

186 
gboŞ—n
 
mes§ge_v›w_¡Üe_™”_has_chd
(
GtkT»eMod–
 * 
Œ“_mod–
, 
GtkT»eI‹r
 * 
™”
);

187 
gšt
 
mes§ge_v›w_¡Üe_™”_n_chd»n
(
GtkT»eMod–
 * 
Œ“_mod–
, 
GtkT»eI‹r
 * 
™”
);

188 
gboŞ—n
 
mes§ge_v›w_¡Üe_™”_Áh_chd
(
GtkT»eMod–
 * 
Œ“_mod–
, 
GtkT»eI‹r
 * 
™”
, GtkT»eI‹¸* 
·»Á
, 
gšt
 
n
);

189 
gboŞ—n
 
mes§ge_v›w_¡Üe_™”_·»Á
(
GtkT»eMod–
 * 
Œ“_mod–
, 
GtkT»eI‹r
 * 
™”
, GtkT»eI‹¸* 
chd
);

191 
GTy³
 
	$mes§ge_v›w_¡Üe_g‘_ty³
()

193 
GTy³
 
¡Üe_ty³
 = 0;

194 cÚ¡ 
GTy³Info
 
¡Üe_šfo
 = {

195 (
mes§ge_v›w_¡Üe_şass_t
),

196 
NULL
,

197 
NULL
,

198 (
GCÏssIn™Func
è
mes§ge_v›w_¡Üe_şass_š™
,

199 
NULL
,

200 
NULL
,

201 (
mes§ge_v›w_¡Üe_t
),

203 (
GIn¡ªûIn™Func
è
mes§ge_v›w_¡Üe_š™


205 cÚ¡ 
GIÁ”çûInfo
 
Œ“_mod–_šfo
 = {

206 (
GIÁ”çûIn™Func
è
mes§ge_v›w_¡Üe_Œ“_š™
,

207 
NULL
,

208 
NULL


211 ià(
¡Üe_ty³
)

212  
¡Üe_ty³
;

214 
¡Üe_ty³
 = 
	`g_ty³_»gi¡”_¡©ic
(
G_TYPE_OBJECT
, "mes§ge_v›w_¡Üe", &
¡Üe_šfo
, (
GTy³FÏgs
) 0);

215 
	`g_ty³_add_š‹rçû_¡©ic
(
¡Üe_ty³
, 
GTK_TYPE_TREE_MODEL
, &
Œ“_mod–_šfo
);

216  
¡Üe_ty³
;

217 
	}
}

219 
	$mes§ge_v›w_¡Üe_š™
(
mes§ge_v›w_¡Üe_t
 * 
m
)

221 
Ãxt_¡amp
 = 0;

222 
m
->
mes§ges
 = 
NULL
;

223 
m
->
sÜt_f›ld
 = 
OTHER_FIELD
;

224 
m
->
sÜt_dœ
 = 1;

225 
m
->
¡amp
 = 
Ãxt_¡amp
++;

226 
	}
}

228 
	$mes§ge_v›w_¡Üe_şass_š™
(
mes§ge_v›w_¡Üe_şass_t
 * 
c
)

230 
GObjeùCÏss
 *
objeù_şass
;

231 
·»Á_şass
 = 
	`g_ty³_şass_³ek_·»Á
(
c
);

232 
objeù_şass
 = (
GObjeùCÏss
 *è
c
;

233 
objeù_şass
->
fš®ize
 = 
mes§ge_v›w_¡Üe_fš®ize
;

234 
	}
}

236 
	$mes§ge_v›w_¡Üe_Œ“_š™
(
GtkT»eMod–Içû
 * 
içû
)

238 
içû
->
g‘_æags
 = 
mes§ge_v›w_¡Üe_g‘_æags
;

239 
içû
->
g‘_n_cŞumns
 = 
mes§ge_v›w_¡Üe_g‘_n_cŞumns
;

240 
içû
->
g‘_cŞumn_ty³
 = 
mes§ge_v›w_¡Üe_g‘_cŞumn_ty³
;

241 
içû
->
g‘_™”
 = 
mes§ge_v›w_¡Üe_g‘_™”
;

242 
içû
->
g‘_·th
 = 
mes§ge_v›w_¡Üe_g‘_·th
;

243 
içû
->
g‘_v®ue
 = 
mes§ge_v›w_¡Üe_g‘_v®ue
;

244 
içû
->
™”_Ãxt
 = 
mes§ge_v›w_¡Üe_™”_Ãxt
;

245 
içû
->
™”_chd»n
 = 
mes§ge_v›w_¡Üe_™”_chd»n
;

246 
içû
->
™”_has_chd
 = 
mes§ge_v›w_¡Üe_™”_has_chd
;

247 
içû
->
™”_n_chd»n
 = 
mes§ge_v›w_¡Üe_™”_n_chd»n
;

248 
içû
->
™”_Áh_chd
 = 
mes§ge_v›w_¡Üe_™”_Áh_chd
;

249 
içû
->
™”_·»Á
 = 
mes§ge_v›w_¡Üe_™”_·»Á
;

250 
	}
}

252 
	$mes§ge_v›w_¡Üe_fš®ize
(
GObjeù
 * 
objeù
)

254 (*
·»Á_şass
->
fš®ize
è(
objeù
);

255 
	}
}

257 
GtkT»eMod–FÏgs
 
	$mes§ge_v›w_¡Üe_g‘_æags
(
GtkT»eMod–
 * 
Œ“_mod–
)

259 
	`g_»tuº_v®_if_ç
(
	`SEAUDIT_IS_MESSAGE_VIEW_STORE
(
Œ“_mod–
), 0);

260  
GTK_TREE_MODEL_ITERS_PERSIST
 | 
GTK_TREE_MODEL_LIST_ONLY
;

261 
	}
}

263 
gšt
 
mes§ge_v›w_¡Üe_g‘_n_cŞumns
(
GtkT»eMod–
 * 
Œ“_mod–
 
__©Œibu‹__
 ((
unu£d
)))

265  
	gOTHER_FIELD
 + 1;

268 
GTy³
 
mes§ge_v›w_¡Üe_g‘_cŞumn_ty³
(
GtkT»eMod–
 * 
Œ“_mod–
, 
gšt
 
idx
 
__©Œibu‹__
 ((
unu£d
)))

270 
g_»tuº_v®_if_ç
(
SEAUDIT_IS_MESSAGE_VIEW_STORE
(
Œ“_mod–
), 
G_TYPE_INVALID
);

272  
	gG_TYPE_STRING
;

275 
gboŞ—n
 
	$mes§ge_v›w_¡Üe_g‘_™”
(
GtkT»eMod–
 * 
Œ“_mod–
, 
GtkT»eI‹r
 * 
™”
, 
GtkT»eP©h
 * 
·th
)

277 
gšt
 
i
;

278 
mes§ge_v›w_¡Üe_t
 *
¡Üe
 = (mes§ge_v›w_¡Üe_ˆ*è
Œ“_mod–
;

279 
	`g_»tuº_v®_if_ç
(
	`SEAUDIT_IS_MESSAGE_VIEW_STORE
(
Œ“_mod–
), 
FALSE
);

280 
	`g_»tuº_v®_if_ç
(
	`gtk_Œ“_·th_g‘_d•th
(
·th
è> 0, 
FALSE
);

281 
i
 = 
	`gtk_Œ“_·th_g‘_šdiûs
(
·th
)[0];

282 ià(
i
 >ğ
	`­Ş_veùÜ_g‘_size
(
¡Üe
->
mes§ges
))

283  
FALSE
;

285 
™”
->
¡amp
 = 
¡Üe
->stamp;

286 
™”
->
u£r_d©a
 = 
	`­Ş_veùÜ_g‘_–em’t
(
¡Üe
->
mes§ges
, 
i
);

287 
™”
->
u£r_d©a2
 = 
	`GINT_TO_POINTER
(
i
);

288 
™”
->
u£r_d©a3
 = 
¡Üe
->
v›w
;

289  
TRUE
;

290 
	}
}

292 
GtkT»eP©h
 *
	$mes§ge_v›w_¡Üe_g‘_·th
(
GtkT»eMod–
 * 
Œ“_mod–
, 
GtkT»eI‹r
 * 
™”
)

294 
GtkT»eP©h
 *
»tv®
;

295 
mes§ge_v›w_¡Üe_t
 *
¡Üe
 = (mes§ge_v›w_¡Üe_ˆ*è
Œ“_mod–
;

296 
	`g_»tuº_v®_if_ç
(
	`SEAUDIT_IS_MESSAGE_VIEW_STORE
(
Œ“_mod–
), 
NULL
);

297 
	`g_»tuº_v®_if_ç
(
™”
->
¡amp
 =ğ
¡Üe
->¡amp, 
NULL
);

298 
»tv®
 = 
	`gtk_Œ“_·th_Ãw
();

299 
	`gtk_Œ“_·th_­³nd_šdex
(
»tv®
, 
	`GPOINTER_TO_INT
(
™”
->
u£r_d©a2
));

300  
»tv®
;

301 
	}
}

308 
	$mes§ge_v›w_to_utf8
(
GV®ue
 * 
v®ue
, cÚ¡ *
s
)

310 ià(
s
 =ğ
NULL
 || !
	`g_utf8_v®id©e
(s, -1, NULL)) {

311 
	`g_v®ue_£t_¡ršg
(
v®ue
, "");

313 
	`g_v®ue_£t_¡ršg
(
v®ue
, 
s
);

314 
	}
}

316 
	$mes§ge_v›w_¡Üe_g‘_v®ue
(
GtkT»eMod–
 * 
Œ“_mod–
, 
GtkT»eI‹r
 * 
™”
, 
gšt
 
cŞumn
, 
GV®ue
 * 
v®ue
)

318 
mes§ge_v›w_¡Üe_t
 *
¡Üe
;

319 
mes§ge_v›w_t
 *
v›w
;

320 
£aud™_mes§ge_t
 *
m
;

321 
£aud™_mes§ge_ty³_e
 
ty³
;

322 *
d©a
;

323 
£aud™_avc_mes§ge_t
 *
avc
;

324 
	`g_»tuº_if_ç
(
	`SEAUDIT_IS_MESSAGE_VIEW_STORE
(
Œ“_mod–
));

325 
	`g_»tuº_if_ç
(
™”
 !ğ
NULL
);

326 
	`g_»tuº_if_ç
(
cŞumn
 <ğ
OTHER_FIELD
);

327 
	`g_v®ue_š™
(
v®ue
, 
G_TYPE_STRING
);

328 
¡Üe
 = (
mes§ge_v›w_¡Üe_t
 *è
Œ“_mod–
;

329 
v›w
 = 
¡Üe
->view;

330 
m
 = (
£aud™_mes§ge_t
 *è
™”
->
u£r_d©a
;

331 
d©a
 = 
	`£aud™_mes§ge_g‘_d©a
(
m
, &
ty³
);

332 
´eã»nû_f›ld_e
 
f›ld
 = 
cŞumn
;

334 
f›ld
) {

335 
HOST_FIELD
:

337 
	`mes§ge_v›w_to_utf8
(
v®ue
, 
	`£aud™_mes§ge_g‘_ho¡
(
m
));

340 
MESSAGE_FIELD
:

342 *
mes§ge
 = "Invalid";

343 
ty³
) {

344 
SEAUDIT_MESSAGE_TYPE_BOOL
:

346 
mes§ge
 = "Boolean";

349 
SEAUDIT_MESSAGE_TYPE_LOAD
:

351 
mes§ge
 = "Load";

354 
SEAUDIT_MESSAGE_TYPE_AVC
:

356 
avc
 = (
£aud™_avc_mes§ge_t
 *è
d©a
;

357 
£aud™_avc_mes§ge_ty³_e
 
avc_ty³
;

358 
avc_ty³
 = 
	`£aud™_avc_mes§ge_g‘_mes§ge_ty³
(
avc
);

359 
avc_ty³
) {

360 
SEAUDIT_AVC_DENIED
:

362 
mes§ge
 = "Denied";

365 
SEAUDIT_AVC_GRANTED
:

367 
mes§ge
 = "Granted";

373 
	`tİËv–_ERR
(
v›w
->
tİ
, "GÙ‡Àšv®id AVC mes§gty³ %d!", 
avc_ty³
);

374 
	`as£¹
(0);

383 
	`tİËv–_ERR
(
v›w
->
tİ
, "GÙ‡Àšv®id mes§gty³ %d!", 
ty³
);

384 
	`as£¹
(0);

388 
	`mes§ge_v›w_to_utf8
(
v®ue
, 
mes§ge
);

391 
DATE_FIELD
:

393 cÚ¡ 
tm
 *tm = 
	`£aud™_mes§ge_g‘_time
(
m
);

394 
d©e
[256];

397 ià(
tm
->
tm_y—r
 == 0) {

398 
	`¡ráime
(
d©e
, 256, "%b %d %H:%M:%S", 
tm
);

400 
	`¡ráime
(
d©e
, 256, "%b %d %H:%M:%S %Y", 
tm
);

402 
	`mes§ge_v›w_to_utf8
(
v®ue
, 
d©e
);

405 
OTHER_FIELD
:

407 *
Ùh”
 = 
	`£aud™_mes§ge_to_misc_¡ršg
(
m
);;

408 ià(
Ùh”
 =ğ
NULL
) {

409 
	`tİËv–_ERR
(
v›w
->
tİ
, "%s", 
	`¡»¼Ü
(
”ºo
));

412 
	`mes§ge_v›w_to_utf8
(
v®ue
, 
Ùh”
);

413 
	`ä“
(
Ùh”
);

420 ià(
ty³
 !ğ
SEAUDIT_MESSAGE_TYPE_AVC
) {

423 
	`mes§ge_v›w_to_utf8
(
v®ue
, "");

426 
avc
 = (
£aud™_avc_mes§ge_t
 *è
d©a
;

428 
f›ld
) {

429 
SUSER_FIELD
:

431 
	`mes§ge_v›w_to_utf8
(
v®ue
, 
	`£aud™_avc_mes§ge_g‘_sourû_u£r
(
avc
));

434 
SROLE_FIELD
:

436 
	`mes§ge_v›w_to_utf8
(
v®ue
, 
	`£aud™_avc_mes§ge_g‘_sourû_rŞe
(
avc
));

439 
STYPE_FIELD
:

441 
	`mes§ge_v›w_to_utf8
(
v®ue
, 
	`£aud™_avc_mes§ge_g‘_sourû_ty³
(
avc
));

444 
SMLS_LVL_FIELD
:

446 
	`mes§ge_v›w_to_utf8
(
v®ue
, 
	`£aud™_avc_mes§ge_g‘_sourû_mls_lvl
(
avc
));

449 
SMLS_CLR_FIELD
:

451 
	`mes§ge_v›w_to_utf8
(
v®ue
, 
	`£aud™_avc_mes§ge_g‘_sourû_mls_şr
(
avc
));

454 
TUSER_FIELD
:

456 
	`mes§ge_v›w_to_utf8
(
v®ue
, 
	`£aud™_avc_mes§ge_g‘_rg‘_u£r
(
avc
));

459 
TROLE_FIELD
:

461 
	`mes§ge_v›w_to_utf8
(
v®ue
, 
	`£aud™_avc_mes§ge_g‘_rg‘_rŞe
(
avc
));

464 
TTYPE_FIELD
:

466 
	`mes§ge_v›w_to_utf8
(
v®ue
, 
	`£aud™_avc_mes§ge_g‘_rg‘_ty³
(
avc
));

469 
TMLS_LVL_FIELD
:

471 
	`mes§ge_v›w_to_utf8
(
v®ue
, 
	`£aud™_avc_mes§ge_g‘_rg‘_mls_lvl
(
avc
));

474 
TMLS_CLR_FIELD
:

476 
	`mes§ge_v›w_to_utf8
(
v®ue
, 
	`£aud™_avc_mes§ge_g‘_rg‘_mls_şr
(
avc
));

479 
OBJCLASS_FIELD
:

481 
	`mes§ge_v›w_to_utf8
(
v®ue
, 
	`£aud™_avc_mes§ge_g‘_objeù_şass
(
avc
));

484 
PERM_FIELD
:

486 cÚ¡ 
­Ş_veùÜ_t
 *
³rms
 = 
	`£aud™_avc_mes§ge_g‘_³rm
(
avc
);

487 *
³rm
 = 
NULL
;

488 
size_t
 
i
, 
Ën
 = 0;

489 
i
 = 0; 
³rms
 !ğ
NULL
 && i < 
	`­Ş_veùÜ_g‘_size
(perms); i++) {

490 *
p
 = 
	`­Ş_veùÜ_g‘_–em’t
(
³rms
, 
i
);

491 ià(
	`­Ş_¡r_­³ndf
(&
³rm
, &
Ën
, "%s%s", (
i
 > 0 ? "," : ""), 
p
) < 0) {

492 
	`tİËv–_ERR
(
v›w
->
tİ
, "%s", 
	`¡»¼Ü
(
”ºo
));

496 
	`mes§ge_v›w_to_utf8
(
v®ue
, 
³rm
);

497 
	`ä“
(
³rm
);

500 
EXECUTABLE_FIELD
:

502 
	`mes§ge_v›w_to_utf8
(
v®ue
, 
	`£aud™_avc_mes§ge_g‘_exe
(
avc
));

505 
COMMAND_FIELD
:

507 
	`mes§ge_v›w_to_utf8
(
v®ue
, 
	`£aud™_avc_mes§ge_g‘_comm
(
avc
));

510 
NAME_FIELD
:

512 
	`mes§ge_v›w_to_utf8
(
v®ue
, 
	`£aud™_avc_mes§ge_g‘_Çme
(
avc
));

515 
PID_FIELD
:

517 *
s
;

518 ià(
	`a¥rštf
(&
s
, "%u", 
	`£aud™_avc_mes§ge_g‘_pid
(
avc
)) < 0) {

519 
	`tİËv–_ERR
(
v›w
->
tİ
, "%s", 
	`¡»¼Ü
(
”ºo
));

522 
	`mes§ge_v›w_to_utf8
(
v®ue
, 
s
);

523 
	`ä“
(
s
);

526 
INODE_FIELD
:

528 *
s
;

529 ià(
	`a¥rštf
(&
s
, "%lu", 
	`£aud™_avc_mes§ge_g‘_šode
(
avc
)) < 0) {

530 
	`tİËv–_ERR
(
v›w
->
tİ
, "%s", 
	`¡»¼Ü
(
”ºo
));

533 
	`mes§ge_v›w_to_utf8
(
v®ue
, 
s
);

534 
	`ä“
(
s
);

537 
PATH_FIELD
:

539 
	`mes§ge_v›w_to_utf8
(
v®ue
, 
	`£aud™_avc_mes§ge_g‘_·th
(
avc
));

546 
	`tİËv–_ERR
(
v›w
->
tİ
, "GÙ‡Àšv®id cŞumÀ%d!", 
f›ld
);

547 
	`as£¹
(0);

548 
	}
}

550 
gboŞ—n
 
	$mes§ge_v›w_¡Üe_™”_Ãxt
(
GtkT»eMod–
 * 
Œ“_mod–
, 
GtkT»eI‹r
 * 
™”
)

552 
gšt
 
i
;

553 
mes§ge_v›w_¡Üe_t
 *
¡Üe
 = (mes§ge_v›w_¡Üe_ˆ*è
Œ“_mod–
;

554 
	`g_»tuº_v®_if_ç
(
	`SEAUDIT_IS_MESSAGE_VIEW_STORE
(
Œ“_mod–
), 
FALSE
);

555 
	`g_»tuº_v®_if_ç
(
™”
->
¡amp
 =ğ
¡Üe
->¡amp, 
FALSE
);

556 ià(
™”
 =ğ
NULL
 || i‹r->
u£r_d©a
 == NULL)

557  
FALSE
;

558 
i
 = 
	`GPOINTER_TO_INT
(
™”
->
u£r_d©a2
) + 1;

559 ià(
i
 >ğ
	`­Ş_veùÜ_g‘_size
(
¡Üe
->
mes§ges
)) {

560  
FALSE
;

562 
™”
->
u£r_d©a
 = 
	`­Ş_veùÜ_g‘_–em’t
(
¡Üe
->
mes§ges
, 
i
);

563 
™”
->
u£r_d©a2
 = 
	`GINT_TO_POINTER
(
i
);

564 
™”
->
u£r_d©a3
 = 
¡Üe
->
v›w
;

565  
TRUE
;

566 
	}
}

568 
gboŞ—n
 
	$mes§ge_v›w_¡Üe_™”_chd»n
(
GtkT»eMod–
 * 
Œ“_mod–
, 
GtkT»eI‹r
 * 
™”
, GtkT»eI‹¸* 
·»Á
)

570 
mes§ge_v›w_¡Üe_t
 *
¡Üe
;

571 
	`g_»tuº_v®_if_ç
(
·»Á
 =ğ
NULL
 ||…¬’t->
u£r_d©a
 !ğNULL, 
FALSE
);

572 ià(
·»Á
)

573  
FALSE
;

574 
	`g_»tuº_v®_if_ç
(
	`SEAUDIT_IS_MESSAGE_VIEW_STORE
(
Œ“_mod–
), 
FALSE
);

577 
¡Üe
 = (
mes§ge_v›w_¡Üe_t
 *è
Œ“_mod–
;

578 ià(
¡Üe
->
mes§ges
 =ğ
NULL
 || 
	`­Ş_veùÜ_g‘_size
(store->messages) == 0)

579  
FALSE
;

581 
™”
->
¡amp
 = 
¡Üe
->stamp;

582 
™”
->
u£r_d©a
 = 
	`­Ş_veùÜ_g‘_–em’t
(
¡Üe
->
mes§ges
, 0);

583 
™”
->
u£r_d©a2
 = 
	`GINT_TO_POINTER
(0);

584 
™”
->
u£r_d©a3
 = 
¡Üe
->
v›w
;

585  
TRUE
;

586 
	}
}

588 
gboŞ—n
 
mes§ge_v›w_¡Üe_™”_has_chd
(
GtkT»eMod–
 * 
Œ“_mod–
 
__©Œibu‹__
 ((
unu£d
)), 
GtkT»eI‹r
 * 
™”


589 
__©Œibu‹__
 ((
unu£d
)))

591  
	gFALSE
;

594 
gšt
 
	$mes§ge_v›w_¡Üe_™”_n_chd»n
(
GtkT»eMod–
 * 
Œ“_mod–
, 
GtkT»eI‹r
 * 
™”
)

596 
mes§ge_v›w_¡Üe_t
 *
¡Üe
;

597 
	`g_»tuº_v®_if_ç
(
	`SEAUDIT_IS_MESSAGE_VIEW_STORE
(
Œ“_mod–
), -1);

598 
	`g_»tuº_v®_if_ç
(
™”
 =ğ
NULL
 || i‹r->
u£r_d©a
 != NULL, 0);

599 
¡Üe
 = (
mes§ge_v›w_¡Üe_t
 *è
Œ“_mod–
;

602 ià(
™”
 !ğ
NULL
 || 
¡Üe
->
mes§ges
 == NULL) {

605  
	`­Ş_veùÜ_g‘_size
(
¡Üe
->
mes§ges
);

606 
	}
}

608 
gboŞ—n
 
	$mes§ge_v›w_¡Üe_™”_Áh_chd
(
GtkT»eMod–
 * 
Œ“_mod–
, 
GtkT»eI‹r
 * 
™”
, GtkT»eI‹¸* 
·»Á
, 
gšt
 
n
)

610 
mes§ge_v›w_¡Üe_t
 *
¡Üe
;

611 
	`g_»tuº_v®_if_ç
(
	`SEAUDIT_IS_MESSAGE_VIEW_STORE
(
Œ“_mod–
), 
FALSE
);

612 
¡Üe
 = (
mes§ge_v›w_¡Üe_t
 *è
Œ“_mod–
;

613 ià(
¡Üe
->
mes§ges
 =ğ
NULL
 || 
·»Á
 != NULL) {

614  
FALSE
;

616 ià(
n
 >ğ
	`­Ş_veùÜ_g‘_size
(
¡Üe
->
mes§ges
)) {

617  
FALSE
;

619 
™”
->
¡amp
 = 
¡Üe
->stamp;

620 
™”
->
u£r_d©a
 = 
	`­Ş_veùÜ_g‘_–em’t
(
¡Üe
->
mes§ges
, 
n
);

621 
™”
->
u£r_d©a2
 = 
	`GINT_TO_POINTER
(
n
);

622 
™”
->
u£r_d©a3
 = 
¡Üe
->
v›w
;

623  
TRUE
;

624 
	}
}

626 
gboŞ—n
 
mes§ge_v›w_¡Üe_™”_·»Á
(
GtkT»eMod–
 * 
Œ“_mod–
 
__©Œibu‹__
 ((
unu£d
)), 
GtkT»eI‹r
 * 
™”


627 
__©Œibu‹__
 ((
unu£d
)), 
GtkT»eI‹r
 * 
chd
 __attribute__ ((unused)))

629  
	gFALSE
;

635 
	#LBACK
 1

	)

636 
	#LFORWARD
 2

	)

637 
	#LNOOP
 255

	)

639 
	s_msg_u£r_d©a


641 
mes§ge_v›w_t
 *
	mv›w
;

642 
­Ş_veùÜ_t
 *
	mmes§ges
;

643 
GtkDŸlog
 *
	mdŸlog
;

644 
GtkTextBufãr
 *
	mbufãr
;

645 
gšt
 
	mhªdË_id
;

646 } 
	t_msg_u£r_d©a_t
;

648 
mes§ge_v›w_dŸlog_chªge
(
GtkT»eMod–
 * 
Œ“_mod–
,

649 
GtkT»eP©h
 * 
·th
 
__©Œibu‹__
 ((
unu£d
)),

650 
GtkT»eI‹r
 * 
™”
 
__©Œibu‹__
 ((
unu£d
)), 
gpoš‹r
 
u£r_d©a
)

652 
_msg_u£r_d©a_t
 *
	gd
 = (_msg_u£r_d©a_ˆ*è
u£r_d©a
;

657 
g_sigÇl_hªdËr_discÚÃù
(
Œ“_mod–
, 
d
->
hªdË_id
);

658 
	gd
->
	gv›w
 = 
NULL
;

659 
gtk_dŸlog_£t_»¥Ú£_£ns™ive
(
d
->
dŸlog
, 
LBACK
, 
FALSE
);

660 
gtk_dŸlog_£t_»¥Ú£_£ns™ive
(
d
->
dŸlog
, 
LFORWARD
, 
FALSE
);

663 
	$mes§ge_v›w_dŸlog_»¥Ú£
(
GtkDŸlog
 * 
dŸlog
, 
gšt
 
»¥Ú£
, 
gpoš‹r
 
u£r_d©a
)

665 
_msg_u£r_d©a_t
 *
d
 = (_msg_u£r_d©a_ˆ*è
u£r_d©a
;

666 
GtkT»eP©h
 *
p
;

667 
GtkT»eI‹r
 
Œ“_™”
;

668 
GtkTextI‹r
 
‹xt_™”
;

669 
size_t
 
i
;

670 
gboŞ—n
 
go_back
 = 
FALSE
;

671 
gboŞ—n
 
go_fÜw¬d
 = 
FALSE
;

673 
	`gtk_‹xt_bufãr_£t_‹xt
(
d
->
bufãr
, "", -1);

674 
p
 = 
	`­Ş_veùÜ_g‘_–em’t
(
d
->
mes§ges
, 0);

675 
	`as£¹
(
p
 !ğ
NULL
);

676 
»¥Ú£
) {

677 
LNOOP
:

679 
LBACK
:

680 
	`gtk_Œ“_·th_´ev
(
p
);

682 
LFORWARD
:

683 
	`gtk_Œ“_·th_Ãxt
(
p
);

685 
GTK_RESPONSE_DELETE_EVENT
:

686 
GTK_RESPONSE_CLOSE
:

687 
	`­Ş_veùÜ_de¡roy
(&
d
->
mes§ges
);

688 ià(
d
->
v›w
 !ğ
NULL
) {

689 
	`g_sigÇl_hªdËr_discÚÃù
(
d
->
v›w
->
¡Üe
, d->
hªdË_id
);

691 
	`ä“
(
d
);

692 
	`gtk_widg‘_de¡roy
(
	`GTK_WIDGET
(
dŸlog
));

696 
	`tİËv–_ERR
(
d
->
v›w
->
tİ
, "UnhªdËd„e¥Ú£y³ (%d).\n", 
»¥Ú£
);

697 
	`as£¹
(0);

700 
	`as£¹
(
d
->
v›w
 !ğ
NULL
);

704 ià(
	`­Ş_veùÜ_g‘_size
(
d
->
mes§ges
) == 1) {

705 
GtkT»eP©h
 *
du³_p
 = 
	`gtk_Œ“_·th_cİy
(
p
);

706 ià(
du³_p
 =ğ
NULL
) {

707 
	`tİËv–_ERR
(
d
->
v›w
->
tİ
, "%s", 
	`¡»¼Ü
(
”ºo
));

710 
go_back
 = 
	`gtk_Œ“_·th_´ev
(
du³_p
);

711 
	`gtk_Œ“_·th_ä“
(
du³_p
);

713 
	`mes§ge_v›w_¡Üe_g‘_™”
(
	`GTK_TREE_MODEL
(
d
->
v›w
->
¡Üe
), &
Œ“_™”
, 
p
);

714 
go_fÜw¬d
 = 
	`gtk_Œ“_mod–_™”_Ãxt
(
	`GTK_TREE_MODEL
(
d
->
v›w
->
¡Üe
), &
Œ“_™”
);

716 
	`gtk_dŸlog_£t_»¥Ú£_£ns™ive
(
dŸlog
, 
LBACK
, 
go_back
);

717 
	`gtk_dŸlog_£t_»¥Ú£_£ns™ive
(
dŸlog
, 
LFORWARD
, 
go_fÜw¬d
);

719 
	`gtk_‹xt_bufãr_g‘_¡¬t_™”
(
d
->
bufãr
, &
‹xt_™”
);

720 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
d
->
mes§ges
); i++) {

721 *
s
;

722 
p
 = 
	`­Ş_veùÜ_g‘_–em’t
(
d
->
mes§ges
, 
i
);

723 
	`mes§ge_v›w_¡Üe_g‘_™”
(
	`GTK_TREE_MODEL
(
d
->
v›w
->
¡Üe
), &
Œ“_™”
, 
p
);

724 ià((
s
 = 
	`£aud™_mes§ge_to_¡ršg
(
Œ“_™”
.
u£r_d©a
)è=ğ
NULL
) {

725 
	`tİËv–_ERR
(
d
->
v›w
->
tİ
, "%s", 
	`¡»¼Ü
(
”ºo
));

729 
	`gtk_‹xt_bufãr_š£¹
(
d
->
bufãr
, &
‹xt_™”
, 
s
, -1);

730 
	`gtk_‹xt_bufãr_š£¹
(
d
->
bufãr
, &
‹xt_™”
, "\n", -1);

731 
	`ä“
(
s
);

733 
	}
}

742 
	$mes§ge_v›w_mes§ges_veùÜ
(
mes§ge_v›w_t
 * 
v›w
, 
­Ş_veùÜ_t
 * 
mes§ges
)

744 
GtkWidg‘
 *
wšdow
 = 
NULL
;

745 
GtkWidg‘
 *
süŞl
;

746 
GtkWidg‘
 *
‹xt_v›w
;

747 
GtkTextBufãr
 *
bufãr
;

748 
_msg_u£r_d©a_t
 *
¡©e
;

750 
¡©e
 = 
	`m®loc
((
_msg_u£r_d©a_t
));

751 ià(
¡©e
 =ğ
NULL
) {

752 
	`tİËv–_ERR
(
v›w
->
tİ
, "%s", 
	`¡»¼Ü
(
”ºo
));

753 
	`­Ş_veùÜ_de¡roy
(&
mes§ges
);

757 
wšdow
 = 
	`gtk_dŸlog_Ãw_w™h_bu‰Ús
("View Messages",

758 
	`tİËv–_g‘_wšdow
(
v›w
->
tİ
),

759 
GTK_DIALOG_DESTROY_WITH_PARENT
,

760 
GTK_STOCK_GO_BACK
, 
LBACK
,

761 
GTK_STOCK_GO_FORWARD
, 
LFORWARD
, 
GTK_STOCK_CLOSE
, 
GTK_RESPONSE_CLOSE
, 
NULL
);

762 
	`gtk_dŸlog_£t_deçuÉ_»¥Ú£
(
	`GTK_DIALOG
(
wšdow
), 
GTK_RESPONSE_CLOSE
);

763 
	`gtk_wšdow_£t_mod®
(
	`GTK_WINDOW
(
wšdow
), 
FALSE
);

764 
süŞl
 = 
	`gtk_süŞËd_wšdow_Ãw
(
NULL
, NULL);

765 
‹xt_v›w
 = 
	`gtk_‹xt_v›w_Ãw
();

766 
	`gtk_wšdow_£t_deçuÉ_size
(
	`GTK_WINDOW
(
wšdow
), 480, 300);

767 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
	`GTK_DIALOG
(
wšdow
)->
vbox
), 
süŞl
);

768 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
süŞl
), 
‹xt_v›w
);

769 
	`gtk_‹xt_v›w_£t_w¿p_mode
(
	`GTK_TEXT_VIEW
(
‹xt_v›w
), 
GTK_WRAP_WORD
);

770 
	`gtk_widg‘_show
(
‹xt_v›w
);

771 
	`gtk_widg‘_show
(
süŞl
);

773 
	`gtk_‹xt_v›w_£t_ed™abË
(
	`GTK_TEXT_VIEW
(
‹xt_v›w
), 
FALSE
);

774 
	`gtk_wšdow_£t_pos™iÚ
(
	`GTK_WINDOW
(
wšdow
), 
GTK_WIN_POS_CENTER_ON_PARENT
);

776 
bufãr
 = 
	`gtk_‹xt_v›w_g‘_bufãr
(
	`GTK_TEXT_VIEW
(
‹xt_v›w
));

777 
¡©e
->
v›w
 = view;

778 
¡©e
->
mes§ges
 = messages;

779 
¡©e
->
dŸlog
 = 
	`GTK_DIALOG
(
wšdow
);

780 
¡©e
->
bufãr
 = buffer;

781 
	`g_sigÇl_cÚÃù
(
wšdow
, "»¥Ú£", 
	`G_CALLBACK
(
mes§ge_v›w_dŸlog_»¥Ú£
), 
¡©e
);

782 
¡©e
->
hªdË_id
 = 
	`g_sigÇl_cÚÃù
(
v›w
->
¡Üe
, "row-chªged", 
	`G_CALLBACK
(
mes§ge_v›w_dŸlog_chªge
), state);

783 
	`mes§ge_v›w_dŸlog_»¥Ú£
(
	`GTK_DIALOG
(
wšdow
), 
LNOOP
, 
¡©e
);

785 
	`gtk_widg‘_show_®l
(
	`GTK_WIDGET
(
wšdow
));

786 
	}
}

790 
mes§ge_v›w_pİup_Ú_v›w_mes§ge_aùiv©e
(
GtkM’uI‹m
 * 
m’u™em
, 
gpoš‹r
 
u£r_d©a
 
__©Œibu‹__
 ((
unu£d
)))

792 
mes§ge_v›w_t
 *
	gv
 = 
g_objeù_g‘_d©a
(
G_OBJECT
(
m’u™em
), "view-object");

793 
mes§ge_v›w_’tœe_mes§ge
(
v
);

796 
	$mes§ge_v›w_pİup_Ú_fšd_‹ruËs_aùiv©e
(
GtkM’uI‹m
 * 
m’u™em
, 
gpoš‹r
 
u£r_d©a
)

798 
mes§ge_v›w_t
 *
v
 = 
	`g_objeù_g‘_d©a
(
	`G_OBJECT
(
m’u™em
), "view-object");

799 
	`tİËv–_fšd_‹ruËs
(
v
->
tİ
, (
£aud™_mes§ge_t
 *è
u£r_d©a
);

800 
	}
}

802 
mes§ge_v›w_pİup_Ú_expÜt_£Ëùed_mes§ges_aùiv©e
(
GtkM’uI‹m
 * 
m’u™em
, 
gpoš‹r
 
u£r_d©a


803 
__©Œibu‹__
 ((
unu£d
)))

805 
mes§ge_v›w_t
 *
	gv
 = 
g_objeù_g‘_d©a
(
G_OBJECT
(
m’u™em
), "view-object");

806 
mes§ge_v›w_expÜt_£Ëùed_mes§ges
(
v
);

809 
	$mes§ge_v›w_pİup_m’u
(
GtkWidg‘
 * 
Œ“v›w
, 
GdkEv’tBu‰Ú
 * 
ev’t
, 
mes§ge_v›w_t
 * 
v›w
,

810 
£aud™_mes§ge_t
 * 
mes§ge
)

812 
GtkT»eS–eùiÚ
 *
£ËùiÚ
 = 
	`gtk_Œ“_v›w_g‘_£ËùiÚ
(
	`GTK_TREE_VIEW
(
Œ“v›w
));

813 
gšt
 
num_£Ëùed_rows
 = 
	`gtk_Œ“_£ËùiÚ_couÁ_£Ëùed_rows
(
£ËùiÚ
);

814 
GtkWidg‘
 *
m’u
, *
m’u™em
, *
m’u™em2
, *
m’u™em3
;

815 
bu‰Ú
, 
ev’t_time
;

817 
m’u
 = 
	`gtk_m’u_Ãw
();

818 ià(
num_£Ëùed_rows
 == 1) {

819 
m’u™em
 = 
	`gtk_m’u_™em_Ãw_w™h_Ïb–
("View Selected Message");

820 
m’u™em3
 = 
	`gtk_m’u_™em_Ãw_w™h_Ïb–
("Export Selected Message...");

822 
m’u™em
 = 
	`gtk_m’u_™em_Ãw_w™h_Ïb–
("View Selected Messages");

823 
m’u™em3
 = 
	`gtk_m’u_™em_Ãw_w™h_Ïb–
("Export Selected Messages...");

825 
m’u™em2
 = 
	`gtk_m’u_™em_Ãw_w™h_Ïb–
("Find TERules using Message...");

826 
	`g_sigÇl_cÚÃù
(
m’u™em
, "aùiv©e", (
GC®lback
è
mes§ge_v›w_pİup_Ú_v›w_mes§ge_aùiv©e
, 
mes§ge
);

827 
	`g_sigÇl_cÚÃù
(
m’u™em2
, "aùiv©e", (
GC®lback
è
mes§ge_v›w_pİup_Ú_fšd_‹ruËs_aùiv©e
, 
mes§ge
);

828 
	`g_sigÇl_cÚÃù
(
m’u™em3
, "aùiv©e", (
GC®lback
è
mes§ge_v›w_pİup_Ú_expÜt_£Ëùed_mes§ges_aùiv©e
, 
NULL
);

829 
	`g_objeù_£t_d©a
(
	`G_OBJECT
(
m’u™em
), "v›w-objeù", 
v›w
);

830 
	`g_objeù_£t_d©a
(
	`G_OBJECT
(
m’u™em2
), "v›w-objeù", 
v›w
);

831 
	`g_objeù_£t_d©a
(
	`G_OBJECT
(
m’u™em3
), "v›w-objeù", 
v›w
);

832 
	`gtk_m’u_sh–l_­³nd
(
	`GTK_MENU_SHELL
(
m’u
), 
m’u™em
);

833 
	`gtk_m’u_sh–l_­³nd
(
	`GTK_MENU_SHELL
(
m’u
), 
m’u™em2
);

834 
	`gtk_m’u_sh–l_­³nd
(
	`GTK_MENU_SHELL
(
m’u
), 
m’u™em3
);

835 
	`gtk_widg‘_show_®l
(
m’u
);

836 ià(
	`tİËv–_g‘_pŞicy
(
v›w
->
tİ
è=ğ
NULL
) {

837 
	`gtk_widg‘_£t_£ns™ive
(
m’u™em2
, 
FALSE
);

840 ià(
ev’t
) {

841 
bu‰Ú
 = 
ev’t
->button;

842 
ev’t_time
 = 
ev’t
->
time
;

844 
bu‰Ú
 = 0;

845 
ev’t_time
 = 
	`gtk_g‘_cu¼’t_ev’t_time
();

847 
	`gtk_m’u_©ch_to_widg‘
(
	`GTK_MENU
(
m’u
), 
Œ“v›w
, 
NULL
);

848 
	`gtk_m’u_pİup
(
	`GTK_MENU
(
m’u
), 
NULL
, NULL, NULL, NULL, 
bu‰Ú
, 
ev’t_time
);

849 
	}
}

851 
gboŞ—n
 
	$mes§ge_v›w_d–ayed_£ËùiÚ_m’u_™em
(
gpoš‹r
 
d©a
)

853 
mes§ge_v›w_t
 *
v›w
 = (mes§ge_v›w_ˆ*è
d©a
;

854 
	`tİËv–_upd©e_£ËùiÚ_m’u_™em
(
v›w
->
tİ
);

855  
FALSE
;

856 
	}
}

858 
gboŞ—n
 
	$mes§ge_v›w_Ú_bu‰Ú_´ess
(
GtkWidg‘
 * 
Œ“v›w
, 
GdkEv’tBu‰Ú
 * 
ev’t
, 
gpoš‹r
 
u£r_d©a
)

860 
mes§ge_v›w_t
 *
v›w
 = (mes§ge_v›w_ˆ*è
u£r_d©a
;

861 ià(
ev’t
->
ty³
 =ğ
GDK_BUTTON_PRESS
 &&ƒv’t->
bu‰Ú
 == 3) {

862 
GtkT»eP©h
 *
·th
 = 
NULL
;

863 
GtkT»eI‹r
 
™”
;

864 
GtkT»eS–eùiÚ
 *
£ËùiÚ
 = 
	`gtk_Œ“_v›w_g‘_£ËùiÚ
(
	`GTK_TREE_VIEW
(
Œ“v›w
));

865 ià(!
	`gtk_Œ“_v›w_g‘_·th_©_pos
(
	`GTK_TREE_VIEW
(
Œ“v›w
), 
ev’t
->
x
,ƒv’t->
y
, &
·th
, 
NULL
, NULL, NULL)) {

866  
FALSE
;

870 ià(!
	`gtk_Œ“_£ËùiÚ_·th_is_£Ëùed
(
£ËùiÚ
, 
·th
)) {

871 
	`gtk_Œ“_£ËùiÚ_un£Ëù_®l
(
£ËùiÚ
);

872 
	`gtk_Œ“_£ËùiÚ_£Ëù_·th
(
£ËùiÚ
, 
·th
);

874 
	`mes§ge_v›w_¡Üe_g‘_™”
(
	`GTK_TREE_MODEL
(
v›w
->
¡Üe
), &
™”
, 
·th
);

876 
	`mes§ge_v›w_pİup_m’u
(
Œ“v›w
, 
ev’t
, 
v›w
, (
£aud™_mes§ge_t
 *è
™”
.
u£r_d©a
);

877  
TRUE
;

878 } ià(
ev’t
->
ty³
 =ğ
GDK_BUTTON_PRESS
 &&ƒv’t->
bu‰Ú
 == 1) {

882 
	`g_idË_add
(&
mes§ge_v›w_d–ayed_£ËùiÚ_m’u_™em
, 
v›w
);

883  
FALSE
;

884 } ià(
ev’t
->
ty³
 =ğ
GDK_2BUTTON_PRESS
 &&ƒv’t->
bu‰Ú
 == 1){

886 
	`mes§ge_v›w_’tœe_mes§ge
(
v›w
);

888  
FALSE
;

889 
	}
}

891 
mes§ge_v›w_gtk_Œ“_·th_ä“
(
gpoš‹r
 
d©a
, gpoš‹¸
u£r_d©a
 
__©Œibu‹__
 ((
unu£d
)))

893 
gtk_Œ“_·th_ä“
((
GtkT»eP©h
 *è
d©a
);

896 
gboŞ—n
 
	$mes§ge_v›w_Ú_pİup_m’u
(
GtkWidg‘
 * 
Œ“v›w
, 
gpoš‹r
 
u£r_d©a
)

898 
GtkT»eS–eùiÚ
 *
£ËùiÚ
 = 
	`gtk_Œ“_v›w_g‘_£ËùiÚ
(
	`GTK_TREE_VIEW
(
Œ“v›w
));

899 
GLi¡
 *
gli¡
 = 
	`gtk_Œ“_£ËùiÚ_g‘_£Ëùed_rows
(
£ËùiÚ
, 
NULL
);

900 
mes§ge_v›w_t
 *
v›w
 = (mes§ge_v›w_ˆ*è
u£r_d©a
;

901 
GtkT»eP©h
 *
·th
;

902 
GtkT»eI‹r
 
™”
;

903 ià(
gli¡
 =ğ
NULL
) {

904  
FALSE
;

906 
·th
 = 
	`g_li¡_Áh_d©a
(
gli¡
, 0);

907 
	`mes§ge_v›w_¡Üe_g‘_™”
(
	`GTK_TREE_MODEL
(
v›w
->
¡Üe
), &
™”
, 
·th
);

908 
	`g_li¡_fÜ—ch
(
gli¡
, 
mes§ge_v›w_gtk_Œ“_·th_ä“
, 
NULL
);

909 
	`g_li¡_ä“
(
gli¡
);

910 
	`mes§ge_v›w_pİup_m’u
(
Œ“v›w
, 
NULL
, 
v›w
, (
£aud™_mes§ge_t
 *è
™”
.
u£r_d©a
);

911  
TRUE
;

912 
	}
}

914 
mes§ge_v›w_Ú_row_aùiv©e
(
GtkT»eV›w
 * 
Œ“_v›w
 
__©Œibu‹__
 ((
unu£d
)), 
GtkT»eP©h
 * 
·th


915 
__©Œibu‹__
 ((
unu£d
)), 
GtkT»eV›wCŞumn
 * 
cŞumn


916 
__©Œibu‹__
 ((
unu£d
)), 
gpoš‹r
 
u£r_d©a
)

918 
mes§ge_v›w_t
 *
	gv›w
 = (mes§ge_v›w_ˆ*è
u£r_d©a
;

919 
tİËv–_upd©e_£ËùiÚ_m’u_™em
(
v›w
->
tİ
);

924 
mes§ge_v›w_t
 *
	$mes§ge_v›w_ü—‹
(
tİËv–_t
 * 
tİ
, 
£aud™_mod–_t
 * 
mod–
, cÚ¡ *
f’ame
)

926 
mes§ge_v›w_t
 *
v›w
;

927 
GtkT»eS–eùiÚ
 *
£ËùiÚ
;

928 
GtkC–lR’d””
 *
»nd””
;

929 
size_t
 
i
;

931 ià((
v›w
 = 
	`ÿÎoc
(1, (*v›w))è=ğ
NULL
 || (
f’ame
 !ğNULL && (v›w->f’amğ
	`¡rdup
(filename)) == NULL)) {

932 
”rÜ
 = 
”ºo
;

933 
	`tİËv–_ERR
(
tİ
, "%s", 
	`¡»¼Ü
(
”rÜ
));

934 
	`mes§ge_v›w_de¡roy
(&
v›w
);

935 
”ºo
 = 
”rÜ
;

936  
NULL
;

938 
v›w
->
tİ
 =op;

939 
v›w
->
mod–
 = model;

940 
v›w
->
¡Üe
 = (
mes§ge_v›w_¡Üe_t
 *è
	`g_objeù_Ãw
(
SEAUDIT_TYPE_MESSAGE_VIEW_STORE
, 
NULL
);

941 
v›w
->
¡Üe
->view = view;

942 
v›w
->
¡Üe
->
sÜt_f›ld
 = 
OTHER_FIELD
;

943 
v›w
->
¡Üe
->
sÜt_dœ
 = 1;

944 
v›w
->
w
 = 
	`gtk_süŞËd_wšdow_Ãw
(
NULL
, NULL);

945 
v›w
->v›w = 
	`GTK_TREE_VIEW
(
	`gtk_Œ“_v›w_Ãw_w™h_mod–
(
	`GTK_TREE_MODEL
(v›w->
¡Üe
)));

946 
£ËùiÚ
 = 
	`gtk_Œ“_v›w_g‘_£ËùiÚ
(
v›w
->view);

947 
	`gtk_Œ“_£ËùiÚ_£t_mode
(
£ËùiÚ
, 
GTK_SELECTION_MULTIPLE
);

948 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
v›w
->
w
), 
	`GTK_WIDGET
(view->view));

949 
	`gtk_widg‘_show
(
	`GTK_WIDGET
(
v›w
->view));

950 
	`gtk_widg‘_show
(
v›w
->
w
);

952 
»nd””
 = 
	`gtk_ûÎ_»nd””_‹xt_Ãw
();

953 
i
 = 0; i < 
num_cŞumns
; i++) {

954 
v›w_cŞumn_»cÜd
 
r
 = 
cŞumn_d©a
[
i
];

955 
PªgoLayout
 *
Ïyout
 = 
	`gtk_widg‘_ü—‹_·ngo_Ïyout
(
	`GTK_WIDGET
(
v›w
->v›w), 
r
.
§m¶e_‹xt
);

956 
gšt
 
width
;

957 
GtkT»eV›wCŞumn
 *
cŞumn
;

958 
	`·ngo_Ïyout_g‘_pix–_size
(
Ïyout
, &
width
, 
NULL
);

959 
	`g_objeù_uÄef
(
	`G_OBJECT
(
Ïyout
));

960 
width
 += 12;

961 
cŞumn
 = 
	`gtk_Œ“_v›w_cŞumn_Ãw_w™h_©Œibu‹s
(
r
.
Çme
, 
»nd””
, "‹xt",„.
id
, 
NULL
);

962 
	`gtk_Œ“_v›w_cŞumn_£t_şickabË
(
cŞumn
, 
TRUE
);

963 
	`gtk_Œ“_v›w_cŞumn_£t_»sizabË
(
cŞumn
, 
TRUE
);

964 ià(
r
.
sÜt
 !ğ
NULL
) {

965 
	`g_objeù_£t_d©a
(
	`G_OBJECT
(
cŞumn
), "cŞumÀid", 
	`GINT_TO_POINTER
(
r
.
id
));

966 
	`g_sigÇl_cÚÃù_aá”
(
	`G_OBJECT
(
cŞumn
), "şicked", 
	`G_CALLBACK
(
mes§ge_v›w_Ú_cŞumn_şick
), 
v›w
);

968 
	`gtk_Œ“_v›w_cŞumn_£t_sizšg
(
cŞumn
, 
GTK_TREE_VIEW_COLUMN_FIXED
);

969 
	`gtk_Œ“_v›w_cŞumn_£t_fixed_width
(
cŞumn
, 
width
);

970 
	`gtk_Œ“_v›w_­³nd_cŞumn
(
v›w
->v›w, 
cŞumn
);

973 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
(
v›w
->v›w), "bu‰Ú-´ess-ev’t", 
	`G_CALLBACK
(
mes§ge_v›w_Ú_bu‰Ú_´ess
), view);

974 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
(
v›w
->v›w), "pİup-m’u", 
	`G_CALLBACK
(
mes§ge_v›w_Ú_pİup_m’u
), view);

975 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
(
v›w
->v›w), "row-aùiv©ed", 
	`G_CALLBACK
(
mes§ge_v›w_Ú_row_aùiv©e
), view);

976 
	`mes§ge_v›w_upd©e_visibË_cŞumns
(
v›w
);

977 
	`mes§ge_v›w_upd©e_rows
(
v›w
);

978  
v›w
;

979 
	}
}

981 
	$mes§ge_v›w_de¡roy
(
mes§ge_v›w_t
 ** 
v›w
)

983 ià(
v›w
 !ğ
NULL
 && *view != NULL) {

988 
GtkT»eP©h
 *
·th
 = 
	`gtk_Œ“_·th_Ãw_fœ¡
();

989 
GtkT»eI‹r
 
™”
;

990 
	`gtk_Œ“_mod–_g‘_™”
(
	`GTK_TREE_MODEL
((*
v›w
)->
¡Üe
), &
™”
, 
·th
);

991 
	`g_sigÇl_em™_by_Çme
((*
v›w
)->
¡Üe
, "row-chªged", 
·th
, &
™”
);

992 
	`gtk_Œ“_·th_ä“
(
·th
);

993 
	`£aud™_mod–_de¡roy
(&(*
v›w
)->
mod–
);

994 
	`­Ş_veùÜ_de¡roy
(&((*
v›w
)->
¡Üe
->
mes§ges
));

995 
	`g_ä“
((*
v›w
)->
f’ame
);

996 
	`g_ä“
((*
v›w
)->
expÜt_f’ame
);

998 
	`g_objeù_uÄef
((*
v›w
)->
¡Üe
);

999 
	`ä“
(*
v›w
);

1000 *
v›w
 = 
NULL
;

1002 
	}
}

1004 
£aud™_mod–_t
 *
	$mes§ge_v›w_g‘_mod–
(
mes§ge_v›w_t
 * 
v›w
)

1006  
v›w
->
mod–
;

1007 
	}
}

1009 
	$mes§ge_v›w_£t_mod–
(
mes§ge_v›w_t
 * 
v›w
, 
£aud™_mod–_t
 * 
mod–
)

1011 
	`£aud™_mod–_de¡roy
(&
v›w
->
mod–
);

1012 
v›w
->
mod–
 = model;

1013 
	`tİËv–_upd©e_bs
(
v›w
->
tİ
);

1014 
	`mes§ge_v›w_upd©e_rows
(
v›w
);

1015 
	}
}

1017 
GtkWidg‘
 *
	$mes§ge_v›w_g‘_v›w
(
mes§ge_v›w_t
 * 
v›w
)

1019  
v›w
->
w
;

1020 
	}
}

1022 
size_t
 
	$mes§ge_v›w_g‘_num_log_mes§ges
(
mes§ge_v›w_t
 * 
v›w
)

1024 ià(
v›w
->
¡Üe
->
mes§ges
 =ğ
NULL
) {

1027  
	`­Ş_veùÜ_g‘_size
(
v›w
->
¡Üe
->
mes§ges
);

1028 
	}
}

1030 
gboŞ—n
 
	$mes§ge_v›w_is_mes§ge_£Ëùed
(
mes§ge_v›w_t
 * 
v›w
)

1032 
GtkT»eS–eùiÚ
 *
£ËùiÚ
 = 
	`gtk_Œ“_v›w_g‘_£ËùiÚ
(
v›w
->view);

1033 
GLi¡
 *
gli¡
 = 
	`gtk_Œ“_£ËùiÚ_g‘_£Ëùed_rows
(
£ËùiÚ
, 
NULL
);

1034 ià(
gli¡
 =ğ
NULL
) {

1035  
FALSE
;

1037 
	`g_li¡_fÜ—ch
(
gli¡
, 
mes§ge_v›w_gtk_Œ“_·th_ä“
, 
NULL
);

1038 
	`g_li¡_ä“
(
gli¡
);

1039  
TRUE
;

1040 
	}
}

1042 
	$mes§ge_v›w_veùÜ_gtk_Œ“_·th_ä“
(*
–em
)

1044 
GtkT»eP©h
 *
·th
 = (GtkT»eP©h *è
–em
;

1045 
	`gtk_Œ“_·th_ä“
(
·th
);

1046 
	}
}

1048 
	$mes§ge_v›w_’tœe_mes§ge
(
mes§ge_v›w_t
 * 
v›w
)

1050 
GtkT»eS–eùiÚ
 *
£ËùiÚ
 = 
	`gtk_Œ“_v›w_g‘_£ËùiÚ
(
v›w
->view);

1051 
GLi¡
 *
gli¡
 = 
	`gtk_Œ“_£ËùiÚ_g‘_£Ëùed_rows
(
£ËùiÚ
, 
NULL
);

1052 
GLi¡
 *
l
;

1053 
­Ş_veùÜ_t
 *
mes§ges
;

1054 ià(
gli¡
 =ğ
NULL
) {

1057 ià((
mes§ges
 = 
	`­Ş_veùÜ_ü—‹
(
mes§ge_v›w_veùÜ_gtk_Œ“_·th_ä“
)è=ğ
NULL
) {

1058 
	`tİËv–_ERR
(
v›w
->
tİ
, "%s", 
	`¡»¼Ü
(
”ºo
));

1059 
	`g_li¡_fÜ—ch
(
gli¡
, 
mes§ge_v›w_gtk_Œ“_·th_ä“
, 
NULL
);

1060 
	`g_li¡_ä“
(
gli¡
);

1063 
l
 = 
gli¡
;† !ğ
NULL
;† =†->
Ãxt
) {

1064 
GtkT»eP©h
 *
·th
 = 
	`gtk_Œ“_·th_cİy
((GtkT»eP©h *è
l
->
d©a
);

1065 ià(
·th
 =ğ
NULL
 || 
	`­Ş_veùÜ_­³nd
(
mes§ges
,…ath) < 0) {

1066 
	`tİËv–_ERR
(
v›w
->
tİ
, "%s", 
	`¡»¼Ü
(
”ºo
));

1067 
	`gtk_Œ“_·th_ä“
(
·th
);

1068 
	`g_li¡_fÜ—ch
(
gli¡
, 
mes§ge_v›w_gtk_Œ“_·th_ä“
, 
NULL
);

1069 
	`g_li¡_ä“
(
gli¡
);

1070 
	`­Ş_veùÜ_de¡roy
(&
mes§ges
);

1075 
	`mes§ge_v›w_mes§ges_veùÜ
(
v›w
, 
mes§ges
);

1076 
	`g_li¡_fÜ—ch
(
gli¡
, 
mes§ge_v›w_gtk_Œ“_·th_ä“
, 
NULL
);

1077 
	`g_li¡_ä“
(
gli¡
);

1078 
	}
}

1080 
	$mes§ge_v›w_§ve
(
mes§ge_v›w_t
 * 
v›w
)

1082 ià(
v›w
->
f’ame
 =ğ
NULL
) {

1083 
GtkWšdow
 *
·»Á
 = 
	`tİËv–_g‘_wšdow
(
v›w
->
tİ
);

1084 *
·th
 = 
	`ut_§ve_fe
(
·»Á
, "SavV›w", 
NULL
);

1085 ià(
·th
 =ğ
NULL
) {

1088 
v›w
->
f’ame
 = 
·th
;

1090 ià(
	`£aud™_mod–_§ve_to_fe
(
v›w
->
mod–
, v›w->
f’ame
) < 0) {

1091 
	`tİËv–_ERR
(
v›w
->
tİ
, "E¼Ü savšg v›w: %s", 
	`¡»¼Ü
(
”ºo
));

1093 
	}
}

1095 
	$mes§ge_v›w_§v—s
(
mes§ge_v›w_t
 * 
v›w
)

1097 
GtkWšdow
 *
·»Á
 = 
	`tİËv–_g‘_wšdow
(
v›w
->
tİ
);

1098 *
·th
 = 
	`ut_§ve_fe
(
·»Á
, "SavV›w As", 
v›w
->
f’ame
);

1099 ià(
·th
 =ğ
NULL
) {

1102 
	`g_ä“
(
v›w
->
f’ame
);

1103 
v›w
->
f’ame
 = 
·th
;

1104 ià(
	`£aud™_mod–_§ve_to_fe
(
v›w
->
mod–
, v›w->
f’ame
) < 0) {

1105 
	`tİËv–_ERR
(
v›w
->
tİ
, "E¼Ü savšg v›w: %s", 
	`¡»¼Ü
(
”ºo
));

1107 
	}
}

1109 
	$mes§ge_v›w_modify
(
mes§ge_v›w_t
 * 
v›w
)

1111 ià(
	`modify_v›w_run
(
v›w
->
tİ
, view)) {

1112 
	`tİËv–_upd©e_¡©us_b¬
(
v›w
->
tİ
);

1114 
	}
}

1116 
	$mes§ge_v›w_ş—r
(
mes§ge_v›w_t
 * 
v›w
)

1118 
size_t
 
i
;

1119 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v›w
->
¡Üe
->
mes§ges
); i++) {

1120 
£aud™_mes§ge_t
 *
m
 = 
	`­Ş_veùÜ_g‘_–em’t
(
v›w
->
¡Üe
->
mes§ges
, 
i
);

1121 
	`£aud™_mod–_hide_mes§ge
(
v›w
->
mod–
, 
m
);

1123 
	`mes§ge_v›w_upd©e_rows
(
v›w
);

1124 
	}
}

1135 
	$mes§ge_v›w_expÜt_mes§ges_veùÜ
(
mes§ge_v›w_t
 * 
v›w
, *
·th
, 
­Ş_veùÜ_t
 * 
mes§ges
)

1137 
FILE
 *
f
 = 
NULL
;

1138 
size_t
 
i
;

1139 
	`g_ä“
(
v›w
->
expÜt_f’ame
);

1140 
v›w
->
expÜt_f’ame
 = 
·th
;

1141 ià((
f
 = 
	`fİ’
(
·th
, "w")è=ğ
NULL
) {

1142 
	`tİËv–_ERR
(
v›w
->
tİ
, "Could‚Ù o³À% fÜ wr™šg.", 
·th
);

1143 
ş—nup
;

1145 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
mes§ges
); i++) {

1146 
£aud™_mes§ge_t
 *
m
 = 
	`­Ş_veùÜ_g‘_–em’t
(
mes§ges
, 
i
);

1147 *
s
 = 
	`£aud™_mes§ge_to_¡ršg
(
m
);

1148 ià(
s
 =ğ
NULL
 || 
	`årštf
(
f
, "%s\n", s) < 0) {

1149 
	`tİËv–_ERR
(
v›w
->
tİ
, "E¼Ü wr™šg sŒšg: %s", 
	`¡»¼Ü
(
”ºo
));

1150 
ş—nup
;

1152 
	`ä“
(
s
);

1154 
ş—nup
:

1155 ià(
f
 !ğ
NULL
) {

1156 
	`fşo£
(
f
);

1158 
	}
}

1160 
	$mes§ge_v›w_expÜt_®l_mes§ges
(
mes§ge_v›w_t
 * 
v›w
)

1162 
GtkWšdow
 *
·»Á
 = 
	`tİËv–_g‘_wšdow
(
v›w
->
tİ
);

1163 *
·th
 = 
	`ut_§ve_fe
(
·»Á
, "ExpÜˆMes§ges", 
v›w
->
expÜt_f’ame
);

1164 
­Ş_veùÜ_t
 *
mes§ges
 = 
v›w
->
¡Üe
->messages;

1165 ià(
·th
 =ğ
NULL
) {

1168 
	`mes§ge_v›w_expÜt_mes§ges_veùÜ
(
v›w
, 
·th
, 
mes§ges
);

1169 
	}
}

1171 
	$mes§ge_v›w_expÜt_£Ëùed_mes§ges
(
mes§ge_v›w_t
 * 
v›w
)

1173 
GtkWšdow
 *
·»Á
 = 
	`tİËv–_g‘_wšdow
(
v›w
->
tİ
);

1174 *
·th
;

1175 
GtkT»eS–eùiÚ
 *
£ËùiÚ
 = 
	`gtk_Œ“_v›w_g‘_£ËùiÚ
(
v›w
->view);

1176 
GLi¡
 *
gli¡
 = 
	`gtk_Œ“_£ËùiÚ_g‘_£Ëùed_rows
(
£ËùiÚ
, 
NULL
);

1177 
GLi¡
 *
l
;

1178 
­Ş_veùÜ_t
 *
mes§ges
;

1179 ià(
gli¡
 =ğ
NULL
) {

1182 
·th
 = 
	`ut_§ve_fe
(
·»Á
, "ExpÜˆS–eùed Mes§ges", 
v›w
->
expÜt_f’ame
);

1183 ià(
·th
 =ğ
NULL
) {

1186 ià((
mes§ges
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)) == NULL) {

1187 
	`tİËv–_ERR
(
v›w
->
tİ
, "%s", 
	`¡»¼Ü
(
”ºo
));

1188 
	`g_li¡_fÜ—ch
(
gli¡
, 
mes§ge_v›w_gtk_Œ“_·th_ä“
, 
NULL
);

1189 
	`g_li¡_ä“
(
gli¡
);

1192 
l
 = 
gli¡
;† !ğ
NULL
;† =†->
Ãxt
) {

1193 
GtkT»eP©h
 *
Œ“_·th
 = (GtkT»eP©h *è
l
->
d©a
;

1194 
GtkT»eI‹r
 
™”
;

1195 
	`mes§ge_v›w_¡Üe_g‘_™”
(
	`GTK_TREE_MODEL
(
v›w
->
¡Üe
), &
™”
, 
Œ“_·th
);

1196 ià(
	`­Ş_veùÜ_­³nd
(
mes§ges
, 
™”
.
u£r_d©a
) < 0) {

1197 
	`tİËv–_ERR
(
v›w
->
tİ
, "%s", 
	`¡»¼Ü
(
”ºo
));

1198 
	`g_li¡_fÜ—ch
(
gli¡
, 
mes§ge_v›w_gtk_Œ“_·th_ä“
, 
NULL
);

1199 
	`g_li¡_ä“
(
gli¡
);

1200 
	`­Ş_veùÜ_de¡roy
(&
mes§ges
);

1204 
	`mes§ge_v›w_expÜt_mes§ges_veùÜ
(
v›w
, 
·th
, 
mes§ges
);

1205 
	`g_li¡_fÜ—ch
(
gli¡
, 
mes§ge_v›w_gtk_Œ“_·th_ä“
, 
NULL
);

1206 
	`g_li¡_ä“
(
gli¡
);

1207 
	`­Ş_veùÜ_de¡roy
(&
mes§ges
);

1208 
	}
}

1213 cÚ¡ 
v›w_cŞumn_»cÜd
 *
	$g‘_»cÜd
(cÚ¡ *
Çme
)

1215 
size_t
 
i
;

1216 
i
 = 0; i < 
num_cŞumns
; i++) {

1217 cÚ¡ 
v›w_cŞumn_»cÜd
 *
r
 = 
cŞumn_d©a
 + 
i
;

1218 ià(
	`¡rcmp
(
r
->
Çme
,‚ame) == 0) {

1219  
r
;

1222  
NULL
;

1223 
	}
}

1225 
	$mes§ge_v›w_upd©e_visibË_cŞumns
(
mes§ge_v›w_t
 * 
v›w
)

1227 
GLi¡
 *
cŞumns
, *
c
;

1228 
´eã»nûs_t
 *
´efs
 = 
	`tİËv–_g‘_´efs
(
v›w
->
tİ
);

1229 
cŞumns
 = 
	`gtk_Œ“_v›w_g‘_cŞumns
(
v›w
->view);

1230 
c
 = 
cŞumns
;

1231 
c
 !ğ
NULL
) {

1232 
GtkT»eV›wCŞumn
 *
vc
 = 
	`GTK_TREE_VIEW_COLUMN
(
c
->
d©a
);

1233 cÚ¡ 
gch¬
 *
t™Ë
 = 
	`gtk_Œ“_v›w_cŞumn_g‘_t™Ë
(
vc
);

1234 cÚ¡ 
v›w_cŞumn_»cÜd
 *
r
 = 
	`g‘_»cÜd
(
t™Ë
);

1235 ià(
	`´eã»nûs_is_cŞumn_visibË
(
´efs
, 
r
->
id
)) {

1236 
	`gtk_Œ“_v›w_cŞumn_£t_visibË
(
vc
, 
TRUE
);

1238 
	`gtk_Œ“_v›w_cŞumn_£t_visibË
(
vc
, 
FALSE
);

1240 
c
 = 
	`g_li¡_Ãxt
(c);

1242 
	`g_li¡_ä“
(
cŞumns
);

1243 
	}
}

1245 
	$mes§ge_v›w_upd©e_rows
(
mes§ge_v›w_t
 * 
v›w
)

1250 
GtkT»eS–eùiÚ
 *
£ËùiÚ
;

1251 
GLi¡
 *
rows
, *
r
, *
£Ëùed
 = 
NULL
;

1252 
GtkT»eP©h
 *
·th
;

1253 
GtkT»eI‹r
 
™”
;

1254 
£aud™_log_t
 *
log
;

1255 
size_t
 
i
, 
num_Şd_mes§ges
 = 0, 
num_Ãw_mes§ges
 = 0, 
num_chªged
;

1256 
fœ¡_süŞl
 = 0;

1258 ià(!
	`£aud™_mod–_is_chªged
(
v›w
->
mod–
)) {

1264 
£ËùiÚ
 = 
	`gtk_Œ“_v›w_g‘_£ËùiÚ
(
v›w
->view);

1265 
rows
 = 
	`gtk_Œ“_£ËùiÚ_g‘_£Ëùed_rows
(
£ËùiÚ
, 
NULL
);

1266 
r
 = 
rows
;„ !ğ
NULL
;„ =„->
Ãxt
) {

1267 
·th
 = (
GtkT»eP©h
 *è
r
->
d©a
;

1268 
	`mes§ge_v›w_¡Üe_g‘_™”
(
	`GTK_TREE_MODEL
(
v›w
->
¡Üe
), &
™”
, 
·th
);

1269 
£Ëùed
 = 
	`g_li¡_´•’d
(£Ëùed, 
™”
.
u£r_d©a
);

1271 
	`g_li¡_fÜ—ch
(
rows
, 
mes§ge_v›w_gtk_Œ“_·th_ä“
, 
NULL
);

1272 
	`g_li¡_ä“
(
rows
);

1274 
log
 = 
	`tİËv–_g‘_log
(
v›w
->
tİ
);

1275 ià(
v›w
->
¡Üe
->
mes§ges
 !ğ
NULL
) {

1276 
num_Şd_mes§ges
 = 
	`­Ş_veùÜ_g‘_size
(
v›w
->
¡Üe
->
mes§ges
);

1278 
	`­Ş_veùÜ_de¡roy
(&
v›w
->
¡Üe
->
mes§ges
);

1279 ià(
log
 !ğ
NULL
) {

1280 
v›w
->
¡Üe
->
mes§ges
 = 
	`£aud™_mod–_g‘_mes§ges
(
log
, v›w->
mod–
);

1281 
num_Ãw_mes§ges
 = 
	`­Ş_veùÜ_g‘_size
(
v›w
->
¡Üe
->
mes§ges
);

1283 
	`gtk_Œ“_£ËùiÚ_un£Ëù_®l
(
£ËùiÚ
);

1288 
num_chªged
 = 
num_Şd_mes§ges
;

1289 ià(
num_Ãw_mes§ges
 < 
num_chªged
) {

1290 
num_chªged
 = 
num_Ãw_mes§ges
;

1292 
i
 = 0; i < 
num_chªged
; i++) {

1293 
·th
 = 
	`gtk_Œ“_·th_Ãw
();

1294 
	`gtk_Œ“_·th_­³nd_šdex
(
·th
, 
i
);

1295 
™”
.
u£r_d©a
 = 
	`­Ş_veùÜ_g‘_–em’t
(
v›w
->
¡Üe
->
mes§ges
, 
i
);

1296 
™”
.
u£r_d©a2
 = 
	`GINT_TO_POINTER
(
i
);

1297 
™”
.
u£r_d©a3
 = 
v›w
;

1298 
	`gtk_Œ“_mod–_row_chªged
(
	`GTK_TREE_MODEL
(
v›w
->
¡Üe
), 
·th
, &
™”
);

1299 
r
 = 
£Ëùed
;„ !ğ
NULL
;„ =„->
Ãxt
) {

1300 ià(
r
->
d©a
 =ğ
™”
.
u£r_d©a
) {

1301 
	`gtk_Œ“_£ËùiÚ_£Ëù_™”
(
£ËùiÚ
, &
™”
);

1302 ià(!
fœ¡_süŞl
) {

1303 
	`gtk_Œ“_v›w_süŞl_to_ûÎ
(
v›w
->v›w, 
·th
, 
NULL
, 
FALSE
, 0.0, 0.0);

1304 
fœ¡_süŞl
 = 1;

1309 
	`gtk_Œ“_·th_ä“
(
·th
);

1311 ià(
num_Şd_mes§ges
 > 
num_chªged
) {

1313 
i
 = 
num_Şd_mes§ges
; i > 
num_chªged
; i--) {

1314 
·th
 = 
	`gtk_Œ“_·th_Ãw
();

1315 
	`gtk_Œ“_·th_­³nd_šdex
(
·th
, 
i
 - 1);

1316 
	`gtk_Œ“_mod–_row_d–‘ed
(
	`GTK_TREE_MODEL
(
v›w
->
¡Üe
), 
·th
);

1317 
	`gtk_Œ“_·th_ä“
(
·th
);

1320 ; 
i
 < 
num_Ãw_mes§ges
; i++) {

1321 
·th
 = 
	`gtk_Œ“_·th_Ãw
();

1322 
	`gtk_Œ“_·th_­³nd_šdex
(
·th
, 
i
);

1323 
™”
.
u£r_d©a
 = 
	`­Ş_veùÜ_g‘_–em’t
(
v›w
->
¡Üe
->
mes§ges
, 
i
);

1324 
™”
.
u£r_d©a2
 = 
	`GINT_TO_POINTER
(
i
);

1325 
™”
.
u£r_d©a3
 = 
v›w
;

1326 
	`gtk_Œ“_mod–_row_š£¹ed
(
	`GTK_TREE_MODEL
(
v›w
->
¡Üe
), 
·th
, &
™”
);

1327 
r
 = 
£Ëùed
;„ !ğ
NULL
;„ =„->
Ãxt
) {

1328 ià(
r
->
d©a
 =ğ
™”
.
u£r_d©a
) {

1329 
	`gtk_Œ“_£ËùiÚ_£Ëù_™”
(
£ËùiÚ
, &
™”
);

1330 ià(!
fœ¡_süŞl
) {

1331 
	`gtk_Œ“_v›w_süŞl_to_ûÎ
(
v›w
->v›w, 
·th
, 
NULL
, 
FALSE
, 0.0, 0.0);

1332 
fœ¡_süŞl
 = 1;

1337 
	`gtk_Œ“_·th_ä“
(
·th
);

1340 
	`g_li¡_ä“
(
£Ëùed
);

1341 
	}
}

	@seaudit/message_view.h

26 #iâdeà
MESSAGE_VIEW_H


27 
	#MESSAGE_VIEW_H


	)

29 
	~"tİËv–.h
"

31 
	~<gtk/gtk.h
>

32 
	~<£aud™/mod–.h
>

34 
mes§ge_v›w
 
	tmes§ge_v›w_t
;

48 
mes§ge_v›w_t
 *
mes§ge_v›w_ü—‹
(
tİËv–_t
 * 
tİ
, 
£aud™_mod–_t
 * 
mod–
, cÚ¡ *
f’ame
);

57 
mes§ge_v›w_de¡roy
(
mes§ge_v›w_t
 ** 
v›w
);

68 
£aud™_mod–_t
 *
mes§ge_v›w_g‘_mod–
(
mes§ge_v›w_t
 * 
v›w
);

79 
mes§ge_v›w_£t_mod–
(
mes§ge_v›w_t
 * 
v›w
, 
£aud™_mod–_t
 * 
mod–
);

89 
GtkWidg‘
 *
mes§ge_v›w_g‘_v›w
(
mes§ge_v›w_t
 * 
v›w
);

99 
size_t
 
mes§ge_v›w_g‘_num_log_mes§ges
(
mes§ge_v›w_t
 * 
v›w
);

109 
gboŞ—n
 
mes§ge_v›w_is_mes§ge_£Ëùed
(
mes§ge_v›w_t
 * 
v›w
);

116 
mes§ge_v›w_§ve
(
mes§ge_v›w_t
 * 
v›w
);

123 
mes§ge_v›w_§v—s
(
mes§ge_v›w_t
 * 
v›w
);

130 
mes§ge_v›w_modify
(
mes§ge_v›w_t
 * 
v›w
);

137 
mes§ge_v›w_ş—r
(
mes§ge_v›w_t
 * 
v›w
);

144 
mes§ge_v›w_expÜt_®l_mes§ges
(
mes§ge_v›w_t
 * 
v›w
);

151 
mes§ge_v›w_expÜt_£Ëùed_mes§ges
(
mes§ge_v›w_t
 * 
v›w
);

159 
mes§ge_v›w_’tœe_mes§ge
(
mes§ge_v›w_t
 * 
v›w
);

167 
mes§ge_v›w_upd©e_visibË_cŞumns
(
mes§ge_v›w_t
 * 
v›w
);

176 
mes§ge_v›w_upd©e_rows
(
mes§ge_v›w_t
 * 
v›w
);

	@seaudit/modify_view.c

25 
	~<cÚfig.h
>

27 
	~"f‹r_v›w.h
"

28 
	~"modify_v›w.h
"

29 
	~"utgui.h
"

31 
	~<as£¹.h
>

32 
	~<”ºo.h
>

33 
	~<¡ršg.h
>

34 
	~<gÏde/gÏde.h
>

36 
	smodify_v›w


38 
tİËv–_t
 *
	mtİ
;

39 
mes§ge_v›w_t
 *
	mv›w
;

40 
GÏdeXML
 *
	mxml
;

43 
£aud™_mod–_t
 *
	mmod–
;

47 
GtkLi¡StÜe
 *
	mf‹r_¡Üe
;

48 
GtkDŸlog
 *
	mdŸlog
;

49 
GtkEÁry
 *
	mÇme_’Œy
;

50 
GtkComboBox
 *
	mvisibË_combo
, *
	mm©ch_combo
;

51 
GtkT»eV›w
 *
	mf‹r_v›w
;

52 
GtkBu‰Ú
 *
	madd_bu‰Ú
, *
	med™_bu‰Ú
, *
	m»move_bu‰Ú
, *
	mimpÜt_bu‰Ú
, *
	mexpÜt_bu‰Ú
;

55 *
	mf‹r_f’ame
;

62 
£aud™_f‹r_t
 *
	$modify_v›w_g‘_cu¼’t_f‹r
(
modify_v›w
 *
mv
)

64 
GtkT»eS–eùiÚ
 *
£ËùiÚ
 = 
	`gtk_Œ“_v›w_g‘_£ËùiÚ
(
mv
->
f‹r_v›w
);

65 
GtkT»eI‹r
 
™”
;

66 
£aud™_f‹r_t
 *
f‹r
;

67 ià(!
	`gtk_Œ“_£ËùiÚ_g‘_£Ëùed
(
£ËùiÚ
, 
NULL
, &
™”
)) {

68  
NULL
;

70 
	`gtk_Œ“_mod–_g‘
(
	`GTK_TREE_MODEL
(
mv
->
f‹r_¡Üe
), &
™”
, 0, &
f‹r
, -1);

71  
f‹r
;

72 
	}
}

78 
	$modify_v›w_upd©e_f‹r_¡Üe
(
modify_v›w
 *
mv
)

80 
GtkT»eS–eùiÚ
 *
£ËùiÚ
 = 
	`gtk_Œ“_v›w_g‘_£ËùiÚ
(
mv
->
f‹r_v›w
);

81 
GtkT»eI‹r
 
Şd_™”
, 
™”
;

82 
gboŞ—n
 
£ËùiÚ_exi¡ed
 = 
	`gtk_Œ“_£ËùiÚ_g‘_£Ëùed
(
£ËùiÚ
, 
NULL
, &
Şd_™”
);

83 cÚ¡ 
­Ş_veùÜ_t
 *
f‹rs
 = 
	`£aud™_mod–_g‘_f‹rs
(
mv
->
mod–
);

84 
size_t
 
i
;

85 
	`gtk_li¡_¡Üe_ş—r
(
mv
->
f‹r_¡Üe
);

86 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
f‹rs
); i++) {

87 
£aud™_f‹r_t
 *
f‹r
 = 
	`­Ş_veùÜ_g‘_–em’t
(
f‹rs
, 
i
);

88 
	`gtk_li¡_¡Üe_­³nd
(
mv
->
f‹r_¡Üe
, &
™”
);

89 
	`gtk_li¡_¡Üe_£t
(
mv
->
f‹r_¡Üe
, &
™”
, 0, 
f‹r
, 1, 
	`£aud™_f‹r_g‘_Çme
(filter), -1);

92 ià(
i
 > 0) {

93 
	`gtk_Œ“_£ËùiÚ_£Ëù_™”
(
£ËùiÚ
, &
™”
);

95 ià(
£ËùiÚ_exi¡ed
 && 
	`gtk_li¡_¡Üe_™”_is_v®id
(
mv
->
f‹r_¡Üe
, &
Şd_™”
)) {

96 
	`gtk_Œ“_£ËùiÚ_£Ëù_™”
(
£ËùiÚ
, &
Şd_™”
);

98 
	}
}

100 
	$modify_v›w_Ú_£ËùiÚ_chªge
(
GtkT»eS–eùiÚ
 * 
£ËùiÚ
, 
gpoš‹r
 
u£r_d©a
)

102 
modify_v›w
 *
mv
 = (modify_v›w *)
u£r_d©a
;

103 
gboŞ—n
 
£ns
 = 
	`gtk_Œ“_£ËùiÚ_g‘_£Ëùed
(
£ËùiÚ
, 
NULL
, NULL);

104 
	`gtk_widg‘_£t_£ns™ive
(
	`GTK_WIDGET
(
mv
->
ed™_bu‰Ú
), 
£ns
);

105 
	`gtk_widg‘_£t_£ns™ive
(
	`GTK_WIDGET
(
mv
->
»move_bu‰Ú
), 
£ns
);

106 
	`gtk_widg‘_£t_£ns™ive
(
	`GTK_WIDGET
(
mv
->
expÜt_bu‰Ú
), 
£ns
);

107 
	}
}

109 
modify_v›w_Ú_add_şick
(
GtkBu‰Ú
 * 
bu‰Ú
 
__©Œibu‹__
 ((
unu£d
)), 
gpoš‹r
 
u£r_d©a
)

111 
modify_v›w
 *
	gmv
 = (modify_v›w *)
u£r_d©a
;

112 
£aud™_f‹r_t
 *
	gf‹r
 = 
NULL
;

113 
GtkT»eS–eùiÚ
 *
	g£ËùiÚ
 = 
gtk_Œ“_v›w_g‘_£ËùiÚ
(
mv
->
f‹r_v›w
);

115 ià((
	gf‹r
 = 
£aud™_f‹r_ü—‹
("UÁ™Ëd")è=ğ
NULL
 || (
£aud™_mod–_­³nd_f‹r
(
mv
->
mod–
, 
f‹r
) < 0)) {

116 
tİËv–_ERR
(
mv
->
tİ
, "E¼Ü‡ddšg‚ew f‹r: %s", 
¡»¼Ü
(
”ºo
));

117 
£aud™_f‹r_de¡roy
(&
f‹r
);

122 
gtk_Œ“_£ËùiÚ_un£Ëù_®l
(
£ËùiÚ
);

123 
modify_v›w_upd©e_f‹r_¡Üe
(
mv
);

124 
f‹r_v›w_run
(
f‹r
, 
mv
->
tİ
, 
GTK_WINDOW
(mv->
dŸlog
));

125 
modify_v›w_upd©e_f‹r_¡Üe
(
mv
);

128 
modify_v›w_Ú_ed™_şick
(
GtkBu‰Ú
 * 
bu‰Ú
 
__©Œibu‹__
 ((
unu£d
)), 
gpoš‹r
 
u£r_d©a
)

130 
modify_v›w
 *
	gmv
 = (modify_v›w *)
u£r_d©a
;

131 
£aud™_f‹r_t
 *
	gf‹r
 = 
modify_v›w_g‘_cu¼’t_f‹r
(
mv
);

132 
as£¹
(
f‹r
 !ğ
NULL
);

133 
f‹r_v›w_run
(
f‹r
, 
mv
->
tİ
, 
GTK_WINDOW
(mv->
dŸlog
));

134 
modify_v›w_upd©e_f‹r_¡Üe
(
mv
);

137 
modify_v›w_Ú_»move_şick
(
GtkBu‰Ú
 * 
bu‰Ú
 
__©Œibu‹__
 ((
unu£d
)), 
gpoš‹r
 
u£r_d©a
)

139 
modify_v›w
 *
	gmv
 = (modify_v›w *)
u£r_d©a
;

140 
£aud™_f‹r_t
 *
	gf‹r
 = 
modify_v›w_g‘_cu¼’t_f‹r
(
mv
);

141 
as£¹
(
f‹r
 !ğ
NULL
);

142 
£aud™_mod–_»move_f‹r
(
mv
->
mod–
, 
f‹r
);

143 
modify_v›w_upd©e_f‹r_¡Üe
(
mv
);

146 
modify_v›w_Ú_impÜt_şick
(
GtkBu‰Ú
 * 
bu‰Ú
 
__©Œibu‹__
 ((
unu£d
)), 
gpoš‹r
 
u£r_d©a
)

148 
modify_v›w
 *
	gmv
 = (modify_v›w *)
u£r_d©a
;

149 
­Ş_veùÜ_t
 *
	g·ths
 = 
ut_İ’_fe
(
GTK_WINDOW
(
mv
->
dŸlog
), "ImpÜˆF‹r", mv->
f‹r_f’ame
, 0);

150 
­Ş_veùÜ_t
 *
	gf‹rs
;

151 
size_t
 
	gi
;

152 ià(
	g·ths
 =ğ
NULL
) {

155 
ä“
(
mv
->
f‹r_f’ame
);

156 ià((
	gmv
->
	gf‹r_f’ame
 = 
¡rdup
(
­Ş_veùÜ_g‘_–em’t
(
·ths
, 0))è=ğ
NULL
) {

157 
tİËv–_ERR
(
mv
->
tİ
, "E¼Ü impÜtšg f‹r: %s", 
¡»¼Ü
(
”ºo
));

158 
­Ş_veùÜ_de¡roy
(&
·ths
);

161 
­Ş_veùÜ_de¡roy
(&
·ths
);

162 ià((
	gf‹rs
 = 
£aud™_f‹r_ü—‹_äom_fe
(
mv
->
f‹r_f’ame
)è=ğ
NULL
) {

163 
tİËv–_ERR
(
mv
->
tİ
, "E¼Ü impÜtšg f‹r: %s", 
¡»¼Ü
(
”ºo
));

164 
­Ş_veùÜ_de¡roy
(&
·ths
);

167 
	gi
 = 0; i < 
­Ş_veùÜ_g‘_size
(
f‹rs
); i++) {

168 
£aud™_f‹r_t
 *
	gf‹r
 = 
­Ş_veùÜ_g‘_–em’t
(
f‹rs
, 
i
);

169 
£aud™_f‹r_t
 *
	gÃw_f
 = 
NULL
;

170 ià((
	gÃw_f
 = 
£aud™_f‹r_ü—‹_äom_f‹r
(
f‹r
)è=ğ
NULL
 ||

171 
£aud™_mod–_­³nd_f‹r
(
mv
->
mod–
, 
Ãw_f
) < 0) {

172 
tİËv–_ERR
(
mv
->
tİ
, "E¼Ü impÜtšg f‹r: %s", 
¡»¼Ü
(
”ºo
));

173 
£aud™_f‹r_de¡roy
(&
Ãw_f
);

174 
­Ş_veùÜ_de¡roy
(&
f‹rs
);

177 
modify_v›w_upd©e_f‹r_¡Üe
(
mv
);

179 
­Ş_veùÜ_de¡roy
(&
f‹rs
);

182 
modify_v›w_Ú_expÜt_şick
(
GtkBu‰Ú
 * 
bu‰Ú
 
__©Œibu‹__
 ((
unu£d
)), 
gpoš‹r
 
u£r_d©a
)

184 
modify_v›w
 *
	gmv
 = (modify_v›w *)
u£r_d©a
;

185 *
	g·th
 = 
ut_§ve_fe
(
GTK_WINDOW
(
mv
->
dŸlog
), "ExpÜˆF‹r", mv->
f‹r_f’ame
);

186 
£aud™_f‹r_t
 *
	gf‹r
 = 
modify_v›w_g‘_cu¼’t_f‹r
(
mv
);

187 
as£¹
(
f‹r
 !ğ
NULL
);

188 ià(
	g·th
 =ğ
NULL
) {

191 
g_ä“
(
mv
->
f‹r_f’ame
);

192 
	gmv
->
	gf‹r_f’ame
 = 
·th
;

193 ià(
£aud™_f‹r_§ve_to_fe
(
f‹r
, 
mv
->
f‹r_f’ame
) < 0) {

194 
tİËv–_ERR
(
mv
->
tİ
, "E¼ÜƒxpÜtšg f‹r: %s", 
¡»¼Ü
(
”ºo
));

202 
	$modify_v›w_š™_widg‘s
(
modify_v›w
 *
mv
)

204 
mv
->
dŸlog
 = 
	`GTK_DIALOG
(
	`gÏde_xml_g‘_widg‘
(mv->
xml
, "ModifyViewWindow"));

205 
	`as£¹
(
mv
->
dŸlog
 !ğ
NULL
);

206 
	`gtk_wšdow_£t_Œªs›Á_fÜ
(
	`GTK_WINDOW
(
mv
->
dŸlog
), 
	`tİËv–_g‘_wšdow
(mv->
tİ
));

208 
mv
->
Çme_’Œy
 = 
	`GTK_ENTRY
(
	`gÏde_xml_g‘_widg‘
(mv->
xml
, "ModifyViewNameEntry"));

209 
	`as£¹
(
mv
->
Çme_’Œy
 !ğ
NULL
);

211 
mv
->
visibË_combo
 = 
	`GTK_COMBO_BOX
(
	`gÏde_xml_g‘_widg‘
(mv->
xml
, "ModifyViewVisibleCombo"));

212 
mv
->
m©ch_combo
 = 
	`GTK_COMBO_BOX
(
	`gÏde_xml_g‘_widg‘
(mv->
xml
, "ModifyViewMatchCombo"));

213 
	`as£¹
(
mv
->
visibË_combo
 !ğ
NULL
 && mv->
m©ch_combo
 != NULL);

215 
mv
->
f‹r_v›w
 = 
	`GTK_TREE_VIEW
(
	`gÏde_xml_g‘_widg‘
(mv->
xml
, "ModifyViewFilterView"));

216 
	`as£¹
(
mv
->
f‹r_v›w
 !ğ
NULL
);

217 
mv
->
f‹r_¡Üe
 = 
	`gtk_li¡_¡Üe_Ãw
(2, 
G_TYPE_POINTER
, 
G_TYPE_STRING
);

218 
	`gtk_Œ“_v›w_£t_mod–
(
mv
->
f‹r_v›w
, 
	`GTK_TREE_MODEL
(mv->
f‹r_¡Üe
));

220 
mv
->
add_bu‰Ú
 = 
	`GTK_BUTTON
(
	`gÏde_xml_g‘_widg‘
(mv->
xml
, "ModifyViewAddButton"));

221 
mv
->
ed™_bu‰Ú
 = 
	`GTK_BUTTON
(
	`gÏde_xml_g‘_widg‘
(mv->
xml
, "ModifyViewEditButton"));

222 
mv
->
»move_bu‰Ú
 = 
	`GTK_BUTTON
(
	`gÏde_xml_g‘_widg‘
(mv->
xml
, "ModifyViewRemoveButton"));

223 
mv
->
impÜt_bu‰Ú
 = 
	`GTK_BUTTON
(
	`gÏde_xml_g‘_widg‘
(mv->
xml
, "ModifyViewImportButton"));

224 
mv
->
expÜt_bu‰Ú
 = 
	`GTK_BUTTON
(
	`gÏde_xml_g‘_widg‘
(mv->
xml
, "ModifyViewExportButton"));

225 
	`as£¹
(
mv
->
add_bu‰Ú
 !ğ
NULL
 && mv->
ed™_bu‰Ú
 !ğNULL && mv->
»move_bu‰Ú
 != NULL &&

226 
mv
->
impÜt_bu‰Ú
 !ğ
NULL
 && mv->
expÜt_bu‰Ú
 != NULL);

227 
	}
}

229 
	$modify_v›w_š™_sigÇls
(
modify_v›w
 *
mv
)

231 
GtkC–lR’d””
 *
»nd””
;

232 
GtkT»eV›wCŞumn
 *
cŞumn
;

233 
GtkT»eS–eùiÚ
 *
£ËùiÚ
;

235 
»nd””
 = 
	`gtk_ûÎ_»nd””_‹xt_Ãw
();

236 
cŞumn
 = 
	`gtk_Œ“_v›w_cŞumn_Ãw_w™h_©Œibu‹s
("F‹¸Çmes", 
»nd””
, "‹xt", 1, 
NULL
);

237 
	`gtk_Œ“_v›w_cŞumn_£t_şickabË
(
cŞumn
, 
FALSE
);

238 
	`gtk_Œ“_v›w_cŞumn_£t_»sizabË
(
cŞumn
, 
FALSE
);

239 
	`gtk_Œ“_v›w_cŞumn_£t_sizšg
(
cŞumn
, 
GTK_TREE_VIEW_COLUMN_AUTOSIZE
);

240 
	`gtk_Œ“_v›w_cŞumn_£t_visibË
(
cŞumn
, 
TRUE
);

241 
	`gtk_Œ“_v›w_­³nd_cŞumn
(
mv
->
f‹r_v›w
, 
cŞumn
);

243 
£ËùiÚ
 = 
	`gtk_Œ“_v›w_g‘_£ËùiÚ
(
mv
->
f‹r_v›w
);

244 
	`gtk_Œ“_£ËùiÚ_£t_mode
(
£ËùiÚ
, 
GTK_SELECTION_BROWSE
);

245 
	`g_sigÇl_cÚÃù
(
£ËùiÚ
, "chªged", 
	`G_CALLBACK
(
modify_v›w_Ú_£ËùiÚ_chªge
), 
mv
);

247 
	`g_sigÇl_cÚÃù
(
mv
->
add_bu‰Ú
, "şicked", 
	`G_CALLBACK
(
modify_v›w_Ú_add_şick
), mv);

248 
	`g_sigÇl_cÚÃù
(
mv
->
ed™_bu‰Ú
, "şicked", 
	`G_CALLBACK
(
modify_v›w_Ú_ed™_şick
), mv);

249 
	`g_sigÇl_cÚÃù
(
mv
->
»move_bu‰Ú
, "şicked", 
	`G_CALLBACK
(
modify_v›w_Ú_»move_şick
), mv);

250 
	`g_sigÇl_cÚÃù
(
mv
->
impÜt_bu‰Ú
, "şicked", 
	`G_CALLBACK
(
modify_v›w_Ú_impÜt_şick
), mv);

251 
	`g_sigÇl_cÚÃù
(
mv
->
expÜt_bu‰Ú
, "şicked", 
	`G_CALLBACK
(
modify_v›w_Ú_expÜt_şick
), mv);

252 
	}
}

257 
	$modify_v›w_š™_dŸlog
(
modify_v›w
 *
mv
)

259 
GtkT»eS–eùiÚ
 *
£ËùiÚ
 = 
	`gtk_Œ“_v›w_g‘_£ËùiÚ
(
mv
->
f‹r_v›w
);

260 
GtkT»eI‹r
 
™”
;

262 
	`gtk_’Œy_£t_‹xt
(
mv
->
Çme_’Œy
, 
	`£aud™_mod–_g‘_Çme
(mv->
mod–
));

264 
	`gtk_combo_box_£t_aùive
(
mv
->
visibË_combo
, 
	`£aud™_mod–_g‘_f‹r_visibË
(mv->
mod–
));

265 
	`gtk_combo_box_£t_aùive
(
mv
->
m©ch_combo
, 
	`£aud™_mod–_g‘_f‹r_m©ch
(mv->
mod–
));

267 
	`gtk_Œ“_£ËùiÚ_un£Ëù_®l
(
£ËùiÚ
);

268 
	`modify_v›w_upd©e_f‹r_¡Üe
(
mv
);

272 ià(
	`gtk_Œ“_mod–_g‘_™”_fœ¡
(
	`GTK_TREE_MODEL
(
mv
->
f‹r_¡Üe
), &
™”
)) {

273 
	`gtk_Œ“_£ËùiÚ_£Ëù_™”
(
£ËùiÚ
, &
™”
);

275 
	}
}

277 
	$modify_v›w_run
(
tİËv–_t
 * 
tİ
, 
mes§ge_v›w_t
 * 
v›w
)

279 
modify_v›w
 
mv
;

280 
£aud™_mod–_t
 *
Üig_mod–
 = 
	`mes§ge_v›w_g‘_mod–
(
v›w
);

281 
gšt
 
»¥Ú£
;

282 
»tv®
;

284 
	`mem£t
(&
mv
, 0, (mv));

285 
mv
.
tİ
 =op;

286 
mv
.
v›w
 = view;

287 
mv
.
xml
 = 
	`gÏde_xml_Ãw
(
	`tİËv–_g‘_gÏde_xml
(
tİ
), "ModifyV›wWšdow", 
NULL
);

288 
mv
.
f‹r_f’ame
 = 
NULL
;

289 ià((
mv
.
mod–
 = 
	`£aud™_mod–_ü—‹_äom_mod–
(
Üig_mod–
)è=ğ
NULL
) {

290 
	`tİËv–_ERR
(
mv
.
tİ
, "E¼Ü du¶iÿtšg mod–: %s", 
	`¡»¼Ü
(
”ºo
));

293 
	`modify_v›w_š™_widg‘s
(&
mv
);

294 
	`modify_v›w_š™_sigÇls
(&
mv
);

295 
	`modify_v›w_š™_dŸlog
(&
mv
);

298 
»¥Ú£
 = 
	`gtk_dŸlog_run
(
mv
.
dŸlog
);

299 cÚ¡ 
gch¬
 *
‹xt
 = 
	`gtk_’Œy_g‘_‹xt
(
mv
.
Çme_’Œy
);

301 ià(
	`£aud™_mod–_£t_Çme
(
mv
.
mod–
, 
‹xt
) < 0) {

302 
	`tİËv–_ERR
(
mv
.
tİ
, "Could‚Ù s‘‚ame: %s", 
	`¡»¼Ü
(
”ºo
));

304 
	`£aud™_mod–_£t_f‹r_visibË
(
mv
.
mod–
, 
	`gtk_combo_box_g‘_aùive
(mv.
visibË_combo
));

305 
	`£aud™_mod–_£t_f‹r_m©ch
(
mv
.
mod–
, 
	`gtk_combo_box_g‘_aùive
(mv.
m©ch_combo
));

306 ià(
»¥Ú£
 =ğ
GTK_RESPONSE_APPLY
) {

307 
£aud™_mod–_t
 *
Ãw_mod–
;

308 ià((
Ãw_mod–
 = 
	`£aud™_mod–_ü—‹_äom_mod–
(
mv
.
mod–
)è=ğ
NULL
) {

309 
	`tİËv–_ERR
(
mv
.
tİ
, "E¼Ü‡µlyšg mod–: %s", 
	`¡»¼Ü
(
”ºo
));

312 
	`mes§ge_v›w_£t_mod–
(
mv
.
v›w
, 
Ãw_mod–
);

313 
	`tİËv–_upd©e_¡©us_b¬
(
mv
.
tİ
);

315 } 
»¥Ú£
 =ğ
GTK_RESPONSE_APPLY
);

317 ià(
»¥Ú£
 =ğ
GTK_RESPONSE_OK
) {

318 
	`mes§ge_v›w_£t_mod–
(
mv
.
v›w
, mv.
mod–
);

319 
»tv®
 = 1;

321 
	`£aud™_mod–_de¡roy
(&
mv
.
mod–
);

322 
»tv®
 = 0;

324 
	`gtk_widg‘_de¡roy
(
	`GTK_WIDGET
(
mv
.
dŸlog
));

325 
	`g_objeù_uÄef
(
mv
.
f‹r_¡Üe
);

326  
»tv®
;

327 
	}
}

	@seaudit/modify_view.h

25 #iâdeà
MODIFY_VIEW_H


26 
	#MODIFY_VIEW_H


	)

28 
	~"tİËv–.h
"

29 
	~"mes§ge_v›w.h
"

39 
modify_v›w_run
(
tİËv–_t
 * 
tİ
, 
mes§ge_v›w_t
 * 
v›w
);

	@seaudit/open_policy_window.c

25 
	~<cÚfig.h
>

27 
	~"İ’_pŞicy_wšdow.h
"

28 
	~"utgui.h
"

30 
	~<as£¹.h
>

31 
	~<”ºo.h
>

32 
	~<¡ršg.h
>

33 
	~<­Ş/ut.h
>

34 
	~<­Ş/veùÜ.h
>

35 
	~<gÏde/gÏde.h
>

36 
	~<gtk/gtk.h
>

38 
	sİ’_pŞicy


40 
GÏdeXML
 *
	mxml
;

41 
tİËv–_t
 *
	mtİ
;

42 *
	mÏ¡_moduË_·th
;

43 
GtkDŸlog
 *
	mdŸlog
;

45 
GtkRadioBu‰Ú
 *
	mmÚŞ™hic_¿dio
, *
	mmoduÏr_¿dio
;

46 
GtkLab–
 *
	mmaš_Ïb–
;

48 
GtkHBox
 *
	mbÙtom_hbox
;

49 
GtkLi¡StÜe
 *
	mmoduË_¡Üe
;

51 
GtkEÁry
 *
	mba£_’Œy
;

52 
GtkBu‰Ú
 *
	mba£_brow£_bu‰Ú
;

54 
GtkT»eV›w
 *
	mmoduË_v›w
;

55 
GtkBu‰Ú
 *
	madd_bu‰Ú
, *
	m»move_bu‰Ú
, *
	mimpÜt_bu‰Ú
, *
	mexpÜt_bu‰Ú
;

56 
GtkBu‰Ú
 *
	mok_bu‰Ú
;

59 
	emoduË_cŞumns


61 
	mPATH_COLUMN
 = 0, 
	mNAME_COLUMN
, 
	mVERSION_COLUMN
, 
	mNUM_COLUMNS


67 
gšt
 
	$İ’_pŞicy_sÜt
(
GtkT»eMod–
 * 
mod–
, 
GtkT»eI‹r
 * 
a
, GtkT»eI‹¸* 
b
, 
gpoš‹r
 
u£r_d©a
)

69 
GV®ue
 
v®ue_a
 = { 0 }, 
v®ue_b
 = {

71 cÚ¡ *
Çme_a
, *
Çme_b
;

72 
»tv®
, 
cŞumn_id
 = 
	`GPOINTER_TO_INT
(
u£r_d©a
);

74 
	`gtk_Œ“_mod–_g‘_v®ue
(
mod–
, 
a
, 
cŞumn_id
, &
v®ue_a
);

75 
	`gtk_Œ“_mod–_g‘_v®ue
(
mod–
, 
b
, 
cŞumn_id
, &
v®ue_b
);

76 
Çme_a
 = 
	`g_v®ue_g‘_¡ršg
(&
v®ue_a
);

77 
Çme_b
 = 
	`g_v®ue_g‘_¡ršg
(&
v®ue_b
);

78 
»tv®
 = 
	`¡rcmp
(
Çme_a
, 
Çme_b
);

79 
	`g_v®ue_un£t
(&
v®ue_a
);

80 
	`g_v®ue_un£t
(&
v®ue_b
);

81  
»tv®
;

82 
	}
}

84 
	$İ’_pŞicy_š™_widg‘s
(
İ’_pŞicy
 *
İ
)

86 
GtkC–lR’d””
 *
»nd””
 = 
	`gtk_ûÎ_»nd””_‹xt_Ãw
();

87 
GtkT»eV›wCŞumn
 *
cŞumn
;

88 
GtkT»eS–eùiÚ
 *
£ËùiÚ
;

90 
İ
->
dŸlog
 = 
	`GTK_DIALOG
(
	`gÏde_xml_g‘_widg‘
(İ->
xml
, "PolicyOpenWindow"));

91 
	`as£¹
(
İ
->
dŸlog
 !ğ
NULL
);

92 
	`gtk_wšdow_£t_Œªs›Á_fÜ
(
	`GTK_WINDOW
(
İ
->
dŸlog
), 
	`tİËv–_g‘_wšdow
(İ->
tİ
));

94 
İ
->
mÚŞ™hic_¿dio
 = 
	`GTK_RADIO_BUTTON
(
	`gÏde_xml_g‘_widg‘
(İ->
xml
, "monolithic„adio"));

95 
İ
->
moduÏr_¿dio
 = 
	`GTK_RADIO_BUTTON
(
	`gÏde_xml_g‘_widg‘
(İ->
xml
, "modular„adio"));

96 
İ
->
maš_Ïb–
 = 
	`GTK_LABEL
(
	`gÏde_xml_g‘_widg‘
(İ->
xml
, "main filename†abel"));

97 
	`as£¹
(
İ
->
mÚŞ™hic_¿dio
 !ğ
NULL
 && op->
moduÏr_¿dio
 !ğNULL && op->
maš_Ïb–
 != NULL);

99 
İ
->
ba£_’Œy
 = 
	`GTK_ENTRY
(
	`gÏde_xml_g‘_widg‘
(İ->
xml
, "baseƒntry"));

100 
İ
->
ba£_brow£_bu‰Ú
 = 
	`GTK_BUTTON
(
	`gÏde_xml_g‘_widg‘
(İ->
xml
, "base browse"));

101 
	`as£¹
(
İ
->
ba£_’Œy
 !ğ
NULL
 && op->
ba£_brow£_bu‰Ú
 != NULL);

103 
İ
->
bÙtom_hbox
 = 
	`GTK_HBOX
(
	`gÏde_xml_g‘_widg‘
(İ->
xml
, "hbox.3"));

104 
	`as£¹
(
İ
->
bÙtom_hbox
 !ğ
NULL
);

106 
İ
->
moduË_v›w
 = 
	`GTK_TREE_VIEW
(
	`gÏde_xml_g‘_widg‘
(İ->
xml
, "module view"));

107 
	`as£¹
(
İ
->
moduË_v›w
 !ğ
NULL
);

108 
İ
->
moduË_¡Üe
 = 
	`gtk_li¡_¡Üe_Ãw
(
NUM_COLUMNS
, 
G_TYPE_STRING
, G_TYPE_STRING, G_TYPE_STRING);

109 
	`gtk_Œ“_v›w_£t_mod–
(
İ
->
moduË_v›w
, 
	`GTK_TREE_MODEL
(İ->
moduË_¡Üe
));

111 
İ
->
add_bu‰Ú
 = 
	`GTK_BUTTON
(
	`gÏde_xml_g‘_widg‘
(İ->
xml
, "module‡dd button"));

112 
İ
->
»move_bu‰Ú
 = 
	`GTK_BUTTON
(
	`gÏde_xml_g‘_widg‘
(İ->
xml
, "module„emove button"));

113 
İ
->
impÜt_bu‰Ú
 = 
	`GTK_BUTTON
(
	`gÏde_xml_g‘_widg‘
(İ->
xml
, "module†ist import button"));

114 
İ
->
expÜt_bu‰Ú
 = 
	`GTK_BUTTON
(
	`gÏde_xml_g‘_widg‘
(İ->
xml
, "module†istƒxport button"));

115 
İ
->
ok_bu‰Ú
 = 
	`GTK_BUTTON
(
	`gÏde_xml_g‘_widg‘
(İ->
xml
, "ok button"));

116 
	`as£¹
(
İ
->
add_bu‰Ú
 !ğ
NULL
 && op->
»move_bu‰Ú
 != NULL &&

117 
İ
->
impÜt_bu‰Ú
 !ğ
NULL
 && op->
expÜt_bu‰Ú
 !ğNULL && op->
ok_bu‰Ú
 != NULL);

119 
£ËùiÚ
 = 
	`gtk_Œ“_v›w_g‘_£ËùiÚ
(
İ
->
moduË_v›w
);

120 
	`gtk_Œ“_£ËùiÚ_£t_mode
(
£ËùiÚ
, 
GTK_SELECTION_BROWSE
);

122 
cŞumn
 = 
	`gtk_Œ“_v›w_cŞumn_Ãw_w™h_©Œibu‹s
("ModuË", 
»nd””
, "‹xt", 
NAME_COLUMN
, 
NULL
);

123 
	`gtk_Œ“_v›w_cŞumn_£t_sÜt_cŞumn_id
(
cŞumn
, 
NAME_COLUMN
);

124 
	`gtk_Œ“_v›w_cŞumn_£t_»sizabË
(
cŞumn
, 
TRUE
);

125 
	`gtk_Œ“_v›w_­³nd_cŞumn
(
İ
->
moduË_v›w
, 
cŞumn
);

126 
	`gtk_Œ“_sÜbË_£t_sÜt_func
(
	`GTK_TREE_SORTABLE
(
İ
->
moduË_¡Üe
), 
NAME_COLUMN
, 
İ’_pŞicy_sÜt
, (
gpoš‹r
) NAME_COLUMN,

127 
NULL
);

129 
cŞumn
 = 
	`gtk_Œ“_v›w_cŞumn_Ãw_w™h_©Œibu‹s
("V”siÚ", 
»nd””
, "‹xt", 
VERSION_COLUMN
, 
NULL
);

130 
	`gtk_Œ“_v›w_cŞumn_£t_sÜt_cŞumn_id
(
cŞumn
, 
VERSION_COLUMN
);

131 
	`gtk_Œ“_v›w_cŞumn_£t_»sizabË
(
cŞumn
, 
TRUE
);

132 
	`gtk_Œ“_v›w_­³nd_cŞumn
(
İ
->
moduË_v›w
, 
cŞumn
);

133 
	`gtk_Œ“_sÜbË_£t_sÜt_func
(
	`GTK_TREE_SORTABLE
(
İ
->
moduË_¡Üe
), 
VERSION_COLUMN
, 
İ’_pŞicy_sÜt
,

134 (
gpoš‹r
è
VERSION_COLUMN
, 
NULL
);

136 
cŞumn
 = 
	`gtk_Œ“_v›w_cŞumn_Ãw_w™h_©Œibu‹s
("P©h", 
»nd””
, "‹xt", 
PATH_COLUMN
, 
NULL
);

137 
	`gtk_Œ“_v›w_cŞumn_£t_sÜt_cŞumn_id
(
cŞumn
, 
PATH_COLUMN
);

138 
	`gtk_Œ“_v›w_cŞumn_£t_»sizabË
(
cŞumn
, 
TRUE
);

139 
	`gtk_Œ“_v›w_­³nd_cŞumn
(
İ
->
moduË_v›w
, 
cŞumn
);

140 
	`gtk_Œ“_sÜbË_£t_sÜt_func
(
	`GTK_TREE_SORTABLE
(
İ
->
moduË_¡Üe
), 
PATH_COLUMN
, 
İ’_pŞicy_sÜt
, (
gpoš‹r
) PATH_COLUMN,

141 
NULL
);

143 
	`gtk_Œ“_sÜbË_£t_sÜt_cŞumn_id
(
	`GTK_TREE_SORTABLE
(
İ
->
moduË_¡Üe
), 
NAME_COLUMN
, 
GTK_SORT_ASCENDING
);

144 
	}
}

146 
	$İ’_pŞicy_Ú_pŞicy_ty³_toggË
(
GtkToggËBu‰Ú
 * 
widg‘
, 
gpoš‹r
 
u£r_d©a
)

148 
İ’_pŞicy
 *
İ
 = (İ’_pŞicy *)
u£r_d©a
;

152 ià(!
	`gtk_toggË_bu‰Ú_g‘_aùive
(
widg‘
)) {

155 ià(
	`gtk_toggË_bu‰Ú_g‘_aùive
(
	`GTK_TOGGLE_BUTTON
(
İ
->
mÚŞ™hic_¿dio
))) {

156 
	`gtk_widg‘_£t_£ns™ive
(
	`GTK_WIDGET
(
İ
->
bÙtom_hbox
), 
FALSE
);

157 
	`gtk_Ïb–_£t_m¬kup
(
İ
->
maš_Ïb–
, "<b>Policy Filename:</b>");

159 
	`gtk_widg‘_£t_£ns™ive
(
	`GTK_WIDGET
(
İ
->
bÙtom_hbox
), 
TRUE
);

160 
	`gtk_Ïb–_£t_m¬kup
(
İ
->
maš_Ïb–
, "<b>Base Filename:</b>");

162 
	}
}

164 
İ’_pŞicy_Ú_’Œy_ev’t_aá”
(
GtkWidg‘
 * 
widg‘
 
__©Œibu‹__
 ((
unu£d
)), 
GdkEv’t
 * 
ev’t


165 
__©Œibu‹__
 ((
unu£d
)), 
gpoš‹r
 
u£r_d©a
)

167 
İ’_pŞicy
 *
	gİ
 = (İ’_pŞicy *)
u£r_d©a
;

168 
gboŞ—n
 
	g£ns
 = 
FALSE
;

169 ià(
¡rcmp
(
gtk_’Œy_g‘_‹xt
(
İ
->
ba£_’Œy
), "") != 0) {

170 
£ns
 = 
TRUE
;

172 
gtk_widg‘_£t_£ns™ive
(
GTK_WIDGET
(
İ
->
expÜt_bu‰Ú
), 
£ns
);

173 
gtk_widg‘_£t_£ns™ive
(
GTK_WIDGET
(
İ
->
ok_bu‰Ú
), 
£ns
);

176 
İ’_pŞicy_Ú_ba£_brow£_şick
(
GtkBu‰Ú
 * 
bu‰Ú
 
__©Œibu‹__
 ((
unu£d
)), 
gpoš‹r
 
u£r_d©a
)

178 
İ’_pŞicy
 *
	gİ
 = (İ’_pŞicy *)
u£r_d©a
;

179 cÚ¡ *
	gcu¼’t_·th
 = 
gtk_’Œy_g‘_‹xt
(
İ
->
ba£_’Œy
);

180 *
	gt™Ë
;

181 
­Ş_veùÜ_t
 *
	g·ths
;

182 ià(
gtk_toggË_bu‰Ú_g‘_aùive
(
GTK_TOGGLE_BUTTON
(
İ
->
mÚŞ™hic_¿dio
))) {

183 
	gt™Ë
 = "Open Monolithic Policy";

185 
	gt™Ë
 = "Open Modular Policy";

187 ià(
¡rcmp
(
cu¼’t_·th
, "") == 0) {

188 
cu¼’t_·th
 = 
NULL
;

190 ià((
	g·ths
 = 
ut_İ’_fe
(
GTK_WINDOW
(
İ
->
dŸlog
), 
t™Ë
, 
cu¼’t_·th
, 0)è=ğ
NULL
) {

193 
gtk_’Œy_£t_‹xt
(
İ
->
ba£_’Œy
, 
­Ş_veùÜ_g‘_–em’t
(
·ths
, 0));

194 
­Ş_veùÜ_de¡roy
(&
·ths
);

203 
	$İ’_pŞicy_lßd_moduË
(
İ’_pŞicy
 *
İ
, cÚ¡ *
·th
)

205 cÚ¡ *
moduË_Çme
, *
v”siÚ_¡ršg
;

206 
moduË_ty³
;

207 
qpŞ_moduË_t
 *
moduË
 = 
NULL
;

208 
GtkT»eI‹r
 
™”
;

211 
gboŞ—n
 
™”_v®id
 = 
	`gtk_Œ“_mod–_g‘_™”_fœ¡
(
	`GTK_TREE_MODEL
(
İ
->
moduË_¡Üe
), &
™”
);

212 
™”_v®id
) {

213 *
s
;

214 
	`gtk_Œ“_mod–_g‘
(
	`GTK_TREE_MODEL
(
İ
->
moduË_¡Üe
), &
™”
, 
PATH_COLUMN
, &
s
, -1);

215 ià(
	`¡rcmp
(
s
, 
·th
) == 0) {

216 
	`tİËv–_ERR
(
İ
->
tİ
, "ModuË % wa ®»ady‡dded.", 
·th
);

219 
™”_v®id
 = 
	`gtk_Œ“_mod–_™”_Ãxt
(
	`GTK_TREE_MODEL
(
İ
->
moduË_¡Üe
), &
™”
);

221 ià((
	`qpŞ_moduË_ü—‹_äom_fe
(
·th
, &
moduË
)) < 0) {

222 
	`tİËv–_ERR
(
İ
->
tİ
, "E¼Ü o³nšg moduË %s: %s", 
·th
, 
	`¡»¼Ü
(
”ºo
));

225 ià(
	`qpŞ_moduË_g‘_Çme
(
moduË
, &
moduË_Çme
) < 0 ||

226 
	`qpŞ_moduË_g‘_v”siÚ
(
moduË
, &
v”siÚ_¡ršg
è< 0 || 
	`qpŞ_moduË_g‘_ty³
(moduË, &
moduË_ty³
) < 0) {

227 
	`tİËv–_ERR
(
İ
->
tİ
, "E¼Ü„—dšg moduË %s: %s", 
·th
, 
	`¡»¼Ü
(
”ºo
));

228 
	`qpŞ_moduË_de¡roy
(&
moduË
);

231 ià(
moduË_ty³
 !ğ
QPOL_MODULE_OTHER
) {

232 
	`tİËv–_ERR
(
İ
->
tİ
, "% i nÙ‡†ßdabË moduË.", 
·th
);

233 
	`qpŞ_moduË_de¡roy
(&
moduË
);

236 
	`gtk_li¡_¡Üe_­³nd
(
İ
->
moduË_¡Üe
, &
™”
);

237 
	`gtk_li¡_¡Üe_£t
(
İ
->
moduË_¡Üe
, &
™”
, 
PATH_COLUMN
, 
·th
, 
NAME_COLUMN
, 
moduË_Çme
, 
VERSION_COLUMN
, 
v”siÚ_¡ršg
,

239 
	`qpŞ_moduË_de¡roy
(&
moduË
);

241 
	}
}

243 
İ’_pŞicy_Ú_add_şick
(
GtkBu‰Ú
 * 
bu‰Ú
 
__©Œibu‹__
 ((
unu£d
)), 
gpoš‹r
 
u£r_d©a
)

245 
İ’_pŞicy
 *
	gİ
 = (İ’_pŞicy *)
u£r_d©a
;

246 
­Ş_veùÜ_t
 *
	g·ths
;

247 cÚ¡ *
	g·th
 = 
NULL
, *
	g´ev_·th
;

248 
size_t
 
	gi
;

249 ià((
	g´ev_·th
 = 
İ
->
Ï¡_moduË_·th
è=ğ
NULL
) {

250 
´ev_·th
 = 
gtk_’Œy_g‘_‹xt
(
İ
->
ba£_’Œy
);

251 ià(
¡rcmp
(
´ev_·th
, "") == 0) {

252 
´ev_·th
 = 
NULL
;

255 
	g·ths
 = 
ut_İ’_fe
(
GTK_WINDOW
(
İ
->
dŸlog
), "O³ÀModuË", 
´ev_·th
, 1);

256 ià(
	g·ths
 =ğ
NULL
) {

259 
	g®l_sucûed
 = 1;

260 
	gi
 = 0; i < 
­Ş_veùÜ_g‘_size
(
·ths
); i++) {

261 
	g·th
 = 
­Ş_veùÜ_g‘_–em’t
(
·ths
, 
i
);

262 ià(
İ’_pŞicy_lßd_moduË
(
İ
, 
·th
) < 0) {

263 
	g®l_sucûed
 = 0;

266 ià(
	g®l_sucûed
) {

267 
as£¹
(
·th
 !ğ
NULL
);

268 
ä“
(
İ
->
Ï¡_moduË_·th
);

269 
	gİ
->
	gÏ¡_moduË_·th
 = 
¡rdup
(
·th
);

271 
­Ş_veùÜ_de¡roy
(&
·ths
);

274 
İ’_pŞicy_Ú_»move_şick
(
GtkBu‰Ú
 * 
bu‰Ú
 
__©Œibu‹__
 ((
unu£d
)), 
gpoš‹r
 
u£r_d©a
)

276 
İ’_pŞicy
 *
	gİ
 = (İ’_pŞicy *)
u£r_d©a
;

277 
GtkT»eS–eùiÚ
 *
	g£ËùiÚ
 = 
gtk_Œ“_v›w_g‘_£ËùiÚ
(
İ
->
moduË_v›w
);

278 
GtkT»eI‹r
 
	g™”
;

279 *
	g·th
;

280 ià(!
gtk_Œ“_£ËùiÚ_g‘_£Ëùed
(
£ËùiÚ
, 
NULL
, &
™”
)) {

283 
gtk_Œ“_mod–_g‘
(
GTK_TREE_MODEL
(
İ
->
moduË_¡Üe
), &
™”
, 0, &
·th
, -1);

284 
gtk_li¡_¡Üe_»move
(
İ
->
moduË_¡Üe
, &
™”
);

287 
İ’_pŞicy_Ú_impÜt_şick
(
GtkBu‰Ú
 * 
bu‰Ú
 
__©Œibu‹__
 ((
unu£d
)), 
gpoš‹r
 
u£r_d©a
);

288 
İ’_pŞicy_Ú_expÜt_şick
(
GtkBu‰Ú
 * 
bu‰Ú
 
__©Œibu‹__
 ((
unu£d
)), 
gpoš‹r
 
u£r_d©a
);

290 
	$İ’_pŞicy_Ú_£ËùiÚ_chªge
(
GtkT»eS–eùiÚ
 * 
£ËùiÚ
, 
gpoš‹r
 
u£r_d©a
)

292 
İ’_pŞicy
 *
İ
 = (İ’_pŞicy *)
u£r_d©a
;

293 
gboŞ—n
 
£ns
 = 
	`gtk_Œ“_£ËùiÚ_g‘_£Ëùed
(
£ËùiÚ
, 
NULL
, NULL);

294 
	`gtk_widg‘_£t_£ns™ive
(
	`GTK_WIDGET
(
İ
->
»move_bu‰Ú
), 
£ns
);

295 
	}
}

297 
	$İ’_pŞicy_š™_sigÇls
(
İ’_pŞicy
 *
İ
)

299 
GtkT»eS–eùiÚ
 *
£ËùiÚ
 = 
	`gtk_Œ“_v›w_g‘_£ËùiÚ
(
İ
->
moduË_v›w
);

300 
	`g_sigÇl_cÚÃù
(
İ
->
mÚŞ™hic_¿dio
, "toggËd", 
	`G_CALLBACK
(
İ’_pŞicy_Ú_pŞicy_ty³_toggË
), op);

301 
	`g_sigÇl_cÚÃù
(
İ
->
moduÏr_¿dio
, "toggËd", 
	`G_CALLBACK
(
İ’_pŞicy_Ú_pŞicy_ty³_toggË
), op);

302 
	`g_sigÇl_cÚÃù
(
İ
->
ba£_’Œy
, "ev’t-aá”", 
	`G_CALLBACK
(
İ’_pŞicy_Ú_’Œy_ev’t_aá”
), op);

303 
	`g_sigÇl_cÚÃù
(
İ
->
ba£_brow£_bu‰Ú
, "şicked", 
	`G_CALLBACK
(
İ’_pŞicy_Ú_ba£_brow£_şick
), op);

304 
	`g_sigÇl_cÚÃù
(
£ËùiÚ
, "chªged", 
	`G_CALLBACK
(
İ’_pŞicy_Ú_£ËùiÚ_chªge
), 
İ
);

305 
	`g_sigÇl_cÚÃù
(
İ
->
add_bu‰Ú
, "şicked", 
	`G_CALLBACK
(
İ’_pŞicy_Ú_add_şick
), op);

306 
	`g_sigÇl_cÚÃù
(
İ
->
»move_bu‰Ú
, "şicked", 
	`G_CALLBACK
(
İ’_pŞicy_Ú_»move_şick
), op);

307 
	`g_sigÇl_cÚÃù
(
İ
->
impÜt_bu‰Ú
, "şicked", 
	`G_CALLBACK
(
İ’_pŞicy_Ú_impÜt_şick
), op);

308 
	`g_sigÇl_cÚÃù
(
İ
->
expÜt_bu‰Ú
, "şicked", 
	`G_CALLBACK
(
İ’_pŞicy_Ú_expÜt_şick
), op);

309 
	}
}

311 
	$İ’_pŞicy_š™_v®ues
(
İ’_pŞicy
 *
İ
, cÚ¡ 
­Ş_pŞicy_·th_t
 * 
·th
)

313 ià(
·th
 !ğ
NULL
) {

314 
­Ş_pŞicy_·th_ty³_e
 
·th_ty³
 = 
	`­Ş_pŞicy_·th_g‘_ty³
(
·th
);

315 cÚ¡ *
´im¬y_·th
 = 
	`­Ş_pŞicy_·th_g‘_´im¬y
(
·th
);

316 
	`gtk_’Œy_£t_‹xt
(
İ
->
ba£_’Œy
, 
´im¬y_·th
);

317 
	`gtk_li¡_¡Üe_ş—r
(
İ
->
moduË_¡Üe
);

318 ià(
·th_ty³
 =ğ
APOL_POLICY_PATH_TYPE_MONOLITHIC
) {

319 
	`gtk_toggË_bu‰Ú_£t_aùive
(
	`GTK_TOGGLE_BUTTON
(
İ
->
mÚŞ™hic_¿dio
), 
TRUE
);

320 } ià(
·th_ty³
 =ğ
APOL_POLICY_PATH_TYPE_MODULAR
) {

321 cÚ¡ 
­Ş_veùÜ_t
 *
moduËs
 = 
	`­Ş_pŞicy_·th_g‘_moduËs
(
·th
);

322 
size_t
 
i
;

323 
	`gtk_toggË_bu‰Ú_£t_aùive
(
	`GTK_TOGGLE_BUTTON
(
İ
->
moduÏr_¿dio
), 
TRUE
);

324 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
moduËs
); i++) {

325 *
moduË_·th
 = 
	`­Ş_veùÜ_g‘_–em’t
(
moduËs
, 
i
);

326 ià(
	`İ’_pŞicy_lßd_moduË
(
İ
, 
moduË_·th
) < 0) {

332 
	`tİËv–_ERR
(
İ
->
tİ
, "UnknowÀpŞicy…©hy³ %d.", 
·th_ty³
);

335 
	}
}

344 
­Ş_pŞicy_·th_t
 *
	$İ’_pŞicy_bud_·th
(
İ’_pŞicy
 *
İ
)

346 cÚ¡ *
´im¬y_·th
 = 
	`gtk_’Œy_g‘_‹xt
(
İ
->
ba£_’Œy
);

347 
­Ş_pŞicy_·th_ty³_e
 
·th_ty³
 = 
APOL_POLICY_PATH_TYPE_MONOLITHIC
;

348 
­Ş_veùÜ_t
 *
moduËs
 = 
NULL
;

349 
­Ş_pŞicy_·th_t
 *
·th
 = 
NULL
;

350 ià(
	`gtk_toggË_bu‰Ú_g‘_aùive
(
	`GTK_TOGGLE_BUTTON
(
İ
->
moduÏr_¿dio
))) {

351 
·th_ty³
 = 
APOL_POLICY_PATH_TYPE_MODULAR
;

352 
GtkT»eI‹r
 
™”
;

353 ià((
moduËs
 = 
	`­Ş_veùÜ_ü—‹
(
ä“
)è=ğ
NULL
) {

354 
	`tİËv–_ERR
(
İ
->
tİ
, "%s", 
	`¡»¼Ü
(
”ºo
));

355  
NULL
;

357 ià(
	`gtk_Œ“_mod–_g‘_™”_fœ¡
(
	`GTK_TREE_MODEL
(
İ
->
moduË_¡Üe
), &
™”
)) {

359 
GV®ue
 
v®ue
 = { 0 };

360 *
moduË_·th
;

361 
	`gtk_Œ“_mod–_g‘_v®ue
(
	`GTK_TREE_MODEL
(
İ
->
moduË_¡Üe
), &
™”
, 
PATH_COLUMN
, &
v®ue
);

362 
moduË_·th
 = 
	`g_v®ue_dup_¡ršg
(&
v®ue
);

363 
	`g_v®ue_un£t
(&
v®ue
);

364 ià(
	`­Ş_veùÜ_­³nd
(
moduËs
, 
moduË_·th
) < 0) {

365 
	`tİËv–_ERR
(
İ
->
tİ
, "%s", 
	`¡»¼Ü
(
”ºo
));

366 
	`ä“
(
moduË_·th
);

367 
	`­Ş_veùÜ_de¡roy
(&
moduËs
);

368  
NULL
;

370 } 
	`gtk_Œ“_mod–_™”_Ãxt
(
	`GTK_TREE_MODEL
(
İ
->
moduË_¡Üe
), &
™”
));

373 
·th
 = 
	`­Ş_pŞicy_·th_ü—‹
(
·th_ty³
, 
´im¬y_·th
, 
moduËs
);

374 
	`­Ş_veùÜ_de¡roy
(&
moduËs
);

375 ià(
·th
 =ğ
NULL
) {

376 
	`tİËv–_ERR
(
İ
->
tİ
, "%s", 
	`¡»¼Ü
(
”ºo
));

377  
NULL
;

379  
·th
;

380 
	}
}

382 
İ’_pŞicy_Ú_impÜt_şick
(
GtkBu‰Ú
 * 
bu‰Ú
 
__©Œibu‹__
 ((
unu£d
)), 
gpoš‹r
 
u£r_d©a
)

384 
İ’_pŞicy
 *
	gİ
 = (İ’_pŞicy *)
u£r_d©a
;

385 
­Ş_veùÜ_t
 *
	g·ths
 = 
NULL
;

386 
­Ş_pŞicy_·th_t
 *
	gµ©h
 = 
NULL
;

387 cÚ¡ *
	g·th
 = 
NULL
, *
	g´ev_·th
;

388 ià((
	g´ev_·th
 = 
İ
->
Ï¡_moduË_·th
è=ğ
NULL
) {

389 
´ev_·th
 = 
gtk_’Œy_g‘_‹xt
(
İ
->
ba£_’Œy
);

390 ià(
¡rcmp
(
´ev_·th
, "") == 0) {

391 
´ev_·th
 = 
NULL
;

394 
	g·ths
 = 
ut_İ’_fe
(
GTK_WINDOW
(
İ
->
dŸlog
), "ImpÜˆPŞicy Li¡", 
´ev_·th
, 1);

395 ià(
	g·ths
 =ğ
NULL
) {

398 
	g·th
 = 
­Ş_veùÜ_g‘_–em’t
(
·ths
, 0);

399 
	gµ©h
 = 
­Ş_pŞicy_·th_ü—‹_äom_fe
(
·th
);

400 ià(
	gµ©h
 =ğ
NULL
) {

401 
tİËv–_ERR
(
İ
->
tİ
, "E¼Ü impÜtšg…Şicy†i¡ %s: %s", 
·th
, 
¡»¼Ü
(
”ºo
));

402 
	gş—nup
;

404 
İ’_pŞicy_š™_v®ues
(
İ
, 
µ©h
);

405 
ä“
(
İ
->
Ï¡_moduË_·th
);

406 
	gİ
->
	gÏ¡_moduË_·th
 = 
¡rdup
(
·th
);

407 
	gş—nup
:

408 
­Ş_veùÜ_de¡roy
(&
·ths
);

409 
­Ş_pŞicy_·th_de¡roy
(&
µ©h
);

412 
İ’_pŞicy_Ú_expÜt_şick
(
GtkBu‰Ú
 * 
bu‰Ú
 
__©Œibu‹__
 ((
unu£d
)), 
gpoš‹r
 
u£r_d©a
)

414 
İ’_pŞicy
 *
	gİ
 = (İ’_pŞicy *)
u£r_d©a
;

415 *
	g·th
 = 
ut_§ve_fe
(
GTK_WINDOW
(
İ
->
dŸlog
), "ExpÜˆPŞicy Li¡", 
NULL
);

416 
­Ş_pŞicy_·th_t
 *
	gµ©h
 = 
NULL
;

417 ià(
	g·th
 =ğ
NULL
) {

420 
	gµ©h
 = 
İ’_pŞicy_bud_·th
(
İ
);

421 ià(
	gµ©h
 =ğ
NULL
) {

422 
ş—nup
;

424 ià(
­Ş_pŞicy_·th_to_fe
(
µ©h
, 
·th
) < 0) {

425 
tİËv–_ERR
(
İ
->
tİ
, "E¼ÜƒxpÜtšg…Şicy†i¡ %s: %s", 
·th
, 
¡»¼Ü
(
”ºo
));

427 
	gş—nup
:

428 
g_ä“
(
·th
);

429 
­Ş_pŞicy_·th_de¡roy
(&
µ©h
);

432 
	$İ’_pŞicy_wšdow_run
(
tİËv–_t
 * 
tİ
, cÚ¡ 
­Ş_pŞicy_·th_t
 * 
·th
,‡pŞ_pŞicy_·th_ˆ** 
£ËùiÚ
)

434 
İ’_pŞicy
 
İ
;

435 
gšt
 
»¥Ú£
;

436 
­Ş_pŞicy_·th_t
 *
šput
;

438 
	`mem£t
(&
İ
, 0, (op));

439 
İ
.
tİ
 =op;

440 
İ
.
xml
 = 
	`gÏde_xml_Ãw
(
	`tİËv–_g‘_gÏde_xml
(
tİ
), "PŞicyO³nWšdow", 
NULL
);

442 
	`İ’_pŞicy_š™_widg‘s
(&
İ
);

443 
	`İ’_pŞicy_š™_sigÇls
(&
İ
);

444 
	`İ’_pŞicy_š™_v®ues
(&
İ
, 
·th
);

445 ià(
£ËùiÚ
 !ğ
NULL
) {

446 *
£ËùiÚ
 = 
NULL
;

450 
»¥Ú£
 = 
	`gtk_dŸlog_run
(
İ
.
dŸlog
);

451 ià(
»¥Ú£
 =ğ
GTK_RESPONSE_CANCEL
 ||„e¥Ú£ =ğ
GTK_RESPONSE_DELETE_EVENT
) {

454 ià((
šput
 = 
	`İ’_pŞicy_bud_·th
(&
İ
)è=ğ
NULL
) {

457 ià(
£ËùiÚ
 =ğ
NULL
) {

458 ià(
	`tİËv–_İ’_pŞicy
(
İ
.
tİ
, 
šput
) == 0) {

462 *
£ËùiÚ
 = 
šput
;

466 
	`gtk_widg‘_de¡roy
(
	`GTK_WIDGET
(
İ
.
dŸlog
));

467 
	`ä“
(
İ
.
Ï¡_moduË_·th
);

468 
	`g_objeù_uÄef
(
İ
.
moduË_¡Üe
);

469 
	}
}

	@seaudit/open_policy_window.h

27 #iâdeà
OPEN_POLICY_WINDOW_H


28 
	#OPEN_POLICY_WINDOW_H


	)

30 
	~"tİËv–.h
"

31 
	~<­Ş/pŞicy-·th.h
>

44 
İ’_pŞicy_wšdow_run
(
tİËv–_t
 * 
tİ
, cÚ¡ 
­Ş_pŞicy_·th_t
 * 
·th
,‡pŞ_pŞicy_·th_ˆ** 
£ËùiÚ
);

	@seaudit/policy_components_view.c

25 
	~<cÚfig.h
>

27 
	~"pŞicy_compÚ’ts_v›w.h
"

29 
	~<as£¹.h
>

30 
	~<”ºo.h
>

31 
	~<¡ršg.h
>

32 
	~<­Ş/ut.h
>

33 
	~<gÏde/gÏde.h
>

35 
	spŞcomp_v›w


37 
GÏdeXML
 *
	mxml
;

38 
tİËv–_t
 *
	mtİ
;

39 
­Ş_veùÜ_t
 *
	mlog_™ems
, *
	mpŞicy_™ems
, *
	mbÙh_™ems
, *
	mšşuded_™ems
;

40 
GtkDŸlog
 *
	mdŸlog
;

42 
GtkRadioBu‰Ú
 *
	mlog_¿dio
, *
	mpŞicy_¿dio
, *
	mbÙh_¿dio
;

44 
GtkLi¡StÜe
 *
	mma¡”_¡Üe
;

45 
GtkT»eMod–
 *
	mšc_¡Üe
, *
	mexc_¡Üe
;

46 
GtkT»eV›w
 *
	mšc_v›w
, *
	mexc_v›w
;

47 
GtkBu‰Ú
 *
	mšc_£Ëù_bu‰Ú
, *
	mšc_un£Ëù_bu‰Ú
, *
	mexc_£Ëù_bu‰Ú
, *
	mexc_un£Ëù_bu‰Ú
;

49 
GtkBu‰Ú
 *
	mto_exc_bu‰Ú
, *
	mto_šc_bu‰Ú
;

52 
	epŞcom_cŞumns


54 
	mPOINTER_COLUMN
 = 0, 
	mNAME_COLUMN
, 
	mISLOG_COLUMN
, 
	mISPOLICY_COLUMN
, 
	mISINC_COLUMN


57 
	$pŞicy_compÚ’ts_v›w_š™_widg‘s
(
pŞcomp_v›w
 *
pv
)

59 
pv
->
dŸlog
 = 
	`GTK_DIALOG
(
	`gÏde_xml_g‘_widg‘
Õv->
xml
, "PolicyComponentListsWindow"));

60 
	`as£¹
(
pv
->
dŸlog
 !ğ
NULL
);

61 
	`gtk_wšdow_£t_Œªs›Á_fÜ
(
	`GTK_WINDOW
(
pv
->
dŸlog
), 
	`tİËv–_g‘_wšdow
Õv->
tİ
));

63 
pv
->
log_¿dio
 = 
	`GTK_RADIO_BUTTON
(
	`gÏde_xml_g‘_widg‘
Õv->
xml
, "PolicyCompLogRadio"));

64 
pv
->
pŞicy_¿dio
 = 
	`GTK_RADIO_BUTTON
(
	`gÏde_xml_g‘_widg‘
Õv->
xml
, "PolicyCompPolicyRadio"));

65 
pv
->
bÙh_¿dio
 = 
	`GTK_RADIO_BUTTON
(
	`gÏde_xml_g‘_widg‘
Õv->
xml
, "PolicyCompBothRadio"));

66 
	`as£¹
(
pv
->
log_¿dio
 !ğ
NULL
 &&…v->
pŞicy_¿dio
 !ğNULL &&…v->
bÙh_¿dio
 != NULL);

68 
pv
->
šc_v›w
 = 
	`GTK_TREE_VIEW
(
	`gÏde_xml_g‘_widg‘
Õv->
xml
, "PolicyCompIncView"));

69 
pv
->
exc_v›w
 = 
	`GTK_TREE_VIEW
(
	`gÏde_xml_g‘_widg‘
Õv->
xml
, "PolicyCompExcView"));

70 
	`as£¹
(
pv
->
šc_v›w
 !ğ
NULL
 &&…v->
exc_v›w
 != NULL);

72 
pv
->
šc_£Ëù_bu‰Ú
 = 
	`GTK_BUTTON
(
	`gÏde_xml_g‘_widg‘
Õv->
xml
, "PolicyCompIncSelectButton"));

73 
pv
->
šc_un£Ëù_bu‰Ú
 = 
	`GTK_BUTTON
(
	`gÏde_xml_g‘_widg‘
Õv->
xml
, "PolicyCompIncUnselectButton"));

74 
pv
->
exc_£Ëù_bu‰Ú
 = 
	`GTK_BUTTON
(
	`gÏde_xml_g‘_widg‘
Õv->
xml
, "PolicyCompExcSelectButton"));

75 
pv
->
exc_un£Ëù_bu‰Ú
 = 
	`GTK_BUTTON
(
	`gÏde_xml_g‘_widg‘
Õv->
xml
, "PolicyCompExcUnselectButton"));

76 
	`as£¹
(
pv
->
šc_£Ëù_bu‰Ú
 !ğ
NULL
 &&…v->
šc_un£Ëù_bu‰Ú
 &&

77 
pv
->
exc_£Ëù_bu‰Ú
 !ğ
NULL
 &&…v->
exc_un£Ëù_bu‰Ú
);

79 
pv
->
to_exc_bu‰Ú
 = 
	`GTK_BUTTON
(
	`gÏde_xml_g‘_widg‘
Õv->
xml
, "PolicyCompToExcButton"));

80 
pv
->
to_šc_bu‰Ú
 = 
	`GTK_BUTTON
(
	`gÏde_xml_g‘_widg‘
Õv->
xml
, "PolicyCompToIncButton"));

81 
	`as£¹
(
pv
->
to_exc_bu‰Ú
 !ğ
NULL
 &&…v->
to_šc_bu‰Ú
);

82 
	}
}

93 
gboŞ—n
 
	$pŞicy_compÚ’ts_v›w_is_visibË_¿dio
(
pŞcomp_v›w
 *
pv
, 
gboŞ—n
 
i¦og
, gboŞ—À
i¥Şicy
)

95 ià(
	`gtk_toggË_bu‰Ú_g‘_aùive
(
	`GTK_TOGGLE_BUTTON
(
pv
->
log_¿dio
))) {

96  
i¦og
;

97 } ià(
	`gtk_toggË_bu‰Ú_g‘_aùive
(
	`GTK_TOGGLE_BUTTON
(
pv
->
pŞicy_¿dio
))) {

98  
i¥Şicy
;

100  
TRUE
;

101 
	}
}

107 
gboŞ—n
 
	$pŞicy_compÚ’ts_v›w_is_visibË_šşuded
(
GtkT»eMod–
 * 
mod–
, 
GtkT»eI‹r
 * 
™”
, 
gpoš‹r
 
d©a
)

109 
pŞcomp_v›w
 *
pv
 = (pŞcomp_v›w *)
d©a
;

110 
gboŞ—n
 
i¦og
, 
i¥Şicy
, 
isšc
;

111 
	`gtk_Œ“_mod–_g‘
(
mod–
, 
™”
, 
ISLOG_COLUMN
, &
i¦og
, 
ISPOLICY_COLUMN
, &
i¥Şicy
, 
ISINC_COLUMN
, &
isšc
, -1);

112 ià(!
isšc
) {

113  
FALSE
;

115  
	`pŞicy_compÚ’ts_v›w_is_visibË_¿dio
(
pv
, 
i¦og
, 
i¥Şicy
);

116 
	}
}

122 
gboŞ—n
 
	$pŞicy_compÚ’ts_v›w_is_visibË_exşuded
(
GtkT»eMod–
 * 
mod–
, 
GtkT»eI‹r
 * 
™”
, 
gpoš‹r
 
d©a
)

124 
pŞcomp_v›w
 *
pv
 = (pŞcomp_v›w *)
d©a
;

125 
gboŞ—n
 
i¦og
, 
i¥Şicy
, 
isšc
;

126 
	`gtk_Œ“_mod–_g‘
(
mod–
, 
™”
, 
ISLOG_COLUMN
, &
i¦og
, 
ISPOLICY_COLUMN
, &
i¥Şicy
, 
ISINC_COLUMN
, &
isšc
, -1);

127 ià(
isšc
) {

128  
FALSE
;

130  
	`pŞicy_compÚ’ts_v›w_is_visibË_¿dio
(
pv
, 
i¦og
, 
i¥Şicy
);

131 
	}
}

133 
	$pŞicy_compÚ’ts_v›w_š™_li¡s
(
pŞcomp_v›w
 *
pv
)

135 
GtkT»eI‹r
 
™”
;

136 
size_t
 
i
, 
j
;

137 
GtkC–lR’d””
 *
»nd””
;

138 
GtkT»eV›wCŞumn
 *
cŞumn
;

139 
GtkT»eS–eùiÚ
 *
£ËùiÚ
;

141 ià((
pv
->
bÙh_™ems
 = 
	`­Ş_veùÜ_ü—‹_äom_veùÜ
Õv->
log_™ems
, 
NULL
, NULL, NULL)) == NULL) {

142 
	`tİËv–_ERR
(
pv
->
tİ
, "E¼Ü g’”©šg uniÚ†i¡: %s", 
	`¡»¼Ü
(
”ºo
));

145 ià(
pv
->
pŞicy_™ems
 =ğ
NULL
) {

146 
	`gtk_widg‘_£t_£ns™ive
(
	`GTK_WIDGET
(
pv
->
pŞicy_¿dio
), 
FALSE
);

147 
	`gtk_widg‘_£t_£ns™ive
(
	`GTK_WIDGET
(
pv
->
bÙh_¿dio
), 
FALSE
);

149 ià(
	`­Ş_veùÜ_ÿt
(
pv
->
bÙh_™ems
,…v->
pŞicy_™ems
) < 0) {

150 
	`tİËv–_ERR
(
pv
->
tİ
, "E¼Ü g’”©šg uniÚ†i¡: %s", 
	`¡»¼Ü
(
”ºo
));

153 
	`­Ş_veùÜ_sÜt_uniquify
(
pv
->
bÙh_™ems
, 
­Ş_¡r_¡rcmp
, 
NULL
);

155 
pv
->
ma¡”_¡Üe
 =

156 
	`gtk_li¡_¡Üe_Ãw
(
ISINC_COLUMN
 + 1, 
G_TYPE_POINTER
, 
G_TYPE_STRING
, 
G_TYPE_BOOLEAN
, G_TYPE_BOOLEAN, G_TYPE_BOOLEAN);

157 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
pv
->
bÙh_™ems
); i++) {

158 *
s
 = 
	`­Ş_veùÜ_g‘_–em’t
(
pv
->
bÙh_™ems
, 
i
);

159 
gboŞ—n
 
is_log
 = 
FALSE
, 
is_pŞicy
 = FALSE, 
is_šşuded
 = FALSE;

160 ià(
	`­Ş_veùÜ_g‘_šdex
(
pv
->
log_™ems
, 
s
, 
NULL
, NULL, &
j
) == 0) {

161 
is_log
 = 
TRUE
;

163 ià(
pv
->
pŞicy_™ems
 !ğ
NULL
 && 
	`­Ş_veùÜ_g‘_šdex
Õv->pŞicy_™ems, 
s
, NULL, NULL, &
j
) == 0) {

164 
is_pŞicy
 = 
TRUE
;

166 ià(
	`­Ş_veùÜ_g‘_šdex
(
pv
->
šşuded_™ems
, 
s
, 
­Ş_¡r_¡rcmp
, 
NULL
, &
j
) == 0) {

167 
is_šşuded
 = 
TRUE
;

169 
	`gtk_li¡_¡Üe_­³nd
(
pv
->
ma¡”_¡Üe
, &
™”
);

170 
	`gtk_li¡_¡Üe_£t
(
pv
->
ma¡”_¡Üe
, &
™”
,

171 
POINTER_COLUMN
, 
s
,

172 
NAME_COLUMN
, 
s
, 
ISLOG_COLUMN
, 
is_log
, 
ISPOLICY_COLUMN
, 
is_pŞicy
, 
ISINC_COLUMN
, 
is_šşuded
, -1);

175 
pv
->
šc_¡Üe
 = 
	`gtk_Œ“_mod–_f‹r_Ãw
(
	`GTK_TREE_MODEL
Õv->
ma¡”_¡Üe
), 
NULL
);

176 
	`gtk_Œ“_mod–_f‹r_£t_visibË_func
(
	`GTK_TREE_MODEL_FILTER
(
pv
->
šc_¡Üe
), 
pŞicy_compÚ’ts_v›w_is_visibË_šşuded
,…v,

177 
NULL
);

178 
pv
->
exc_¡Üe
 = 
	`gtk_Œ“_mod–_f‹r_Ãw
(
	`GTK_TREE_MODEL
Õv->
ma¡”_¡Üe
), 
NULL
);

179 
	`gtk_Œ“_mod–_f‹r_£t_visibË_func
(
	`GTK_TREE_MODEL_FILTER
(
pv
->
exc_¡Üe
), 
pŞicy_compÚ’ts_v›w_is_visibË_exşuded
,…v,

180 
NULL
);

181 
	`gtk_Œ“_v›w_£t_mod–
(
pv
->
šc_v›w
,…v->
šc_¡Üe
);

182 
	`gtk_Œ“_v›w_£t_mod–
(
pv
->
exc_v›w
,…v->
exc_¡Üe
);

184 
»nd””
 = 
	`gtk_ûÎ_»nd””_‹xt_Ãw
();

185 
cŞumn
 = 
	`gtk_Œ“_v›w_cŞumn_Ãw_w™h_©Œibu‹s
("I‹m‚ames", 
»nd””
, "‹xt", 
NAME_COLUMN
, 
NULL
);

186 
	`gtk_Œ“_v›w_cŞumn_£t_şickabË
(
cŞumn
, 
FALSE
);

187 
	`gtk_Œ“_v›w_cŞumn_£t_»sizabË
(
cŞumn
, 
FALSE
);

188 
	`gtk_Œ“_v›w_cŞumn_£t_sizšg
(
cŞumn
, 
GTK_TREE_VIEW_COLUMN_AUTOSIZE
);

189 
	`gtk_Œ“_v›w_cŞumn_£t_visibË
(
cŞumn
, 
TRUE
);

190 
	`gtk_Œ“_v›w_­³nd_cŞumn
(
pv
->
šc_v›w
, 
cŞumn
);

191 
»nd””
 = 
	`gtk_ûÎ_»nd””_‹xt_Ãw
();

192 
cŞumn
 = 
	`gtk_Œ“_v›w_cŞumn_Ãw_w™h_©Œibu‹s
("I‹m‚ames", 
»nd””
, "‹xt", 
NAME_COLUMN
, 
NULL
);

193 
	`gtk_Œ“_v›w_cŞumn_£t_şickabË
(
cŞumn
, 
FALSE
);

194 
	`gtk_Œ“_v›w_cŞumn_£t_»sizabË
(
cŞumn
, 
FALSE
);

195 
	`gtk_Œ“_v›w_cŞumn_£t_sizšg
(
cŞumn
, 
GTK_TREE_VIEW_COLUMN_AUTOSIZE
);

196 
	`gtk_Œ“_v›w_cŞumn_£t_visibË
(
cŞumn
, 
TRUE
);

197 
	`gtk_Œ“_v›w_­³nd_cŞumn
(
pv
->
exc_v›w
, 
cŞumn
);

199 
£ËùiÚ
 = 
	`gtk_Œ“_v›w_g‘_£ËùiÚ
(
pv
->
šc_v›w
);

200 
	`gtk_Œ“_£ËùiÚ_£t_mode
(
£ËùiÚ
, 
GTK_SELECTION_MULTIPLE
);

201 
£ËùiÚ
 = 
	`gtk_Œ“_v›w_g‘_£ËùiÚ
(
pv
->
exc_v›w
);

202 
	`gtk_Œ“_£ËùiÚ_£t_mode
(
£ËùiÚ
, 
GTK_SELECTION_MULTIPLE
);

203 
	}
}

207 
	$pŞicy_compÚ’ts_v›w_Ú_sourû_toggË
(
GtkToggËBu‰Ú
 * 
widg‘
, 
gpoš‹r
 
u£r_d©a
)

209 
pŞcomp_v›w
 *
pv
 = (pŞcomp_v›w *)
u£r_d©a
;

213 ià(!
	`gtk_toggË_bu‰Ú_g‘_aùive
(
widg‘
)) {

216 
	`gtk_Œ“_mod–_f‹r_»f‹r
(
	`GTK_TREE_MODEL_FILTER
(
pv
->
šc_¡Üe
));

217 
	`gtk_Œ“_mod–_f‹r_»f‹r
(
	`GTK_TREE_MODEL_FILTER
(
pv
->
exc_¡Üe
));

218 
	}
}

220 
pŞicy_compÚ’ts_gtk_Œ“_·th_ä“
(
gpoš‹r
 
d©a
, gpoš‹¸
u£r_d©a
 
__©Œibu‹__
 ((
unu£d
)))

222 
gtk_Œ“_·th_ä“
((
GtkT»eP©h
 *è
d©a
);

225 
pŞicy_compÚ’ts_gtk_Œ“_row_»ã»nû_ä“
(
gpoš‹r
 
d©a
, gpoš‹¸
u£r_d©a
 
__©Œibu‹__
 ((
unu£d
)))

227 
gtk_Œ“_row_»ã»nû_ä“
((
GtkT»eRowReã»nû
 *è
d©a
);

230 
pŞicy_compÚ’ts_v›w_Ú_to_exc_şick
(
GtkBu‰Ú
 * 
widg‘
 
__©Œibu‹__
 ((
unu£d
)), 
gpoš‹r
 
u£r_d©a
)

232 
pŞcomp_v›w
 *
	gpv
 = (pŞcomp_v›w *)
u£r_d©a
;

233 
GtkT»eS–eùiÚ
 *
	g£ËùiÚ
 = 
gtk_Œ“_v›w_g‘_£ËùiÚ
(
pv
->
šc_v›w
);

234 
GLi¡
 *
	gr
, *
	grows
 = 
gtk_Œ“_£ËùiÚ_g‘_£Ëùed_rows
(
£ËùiÚ
, 
NULL
);

235 
GLi¡
 *
	g»fs
 = 
NULL
;

239 
	gr
 = 
rows
;„ !ğ
NULL
;„ = 
r
->
Ãxt
) {

240 
GtkT»eP©h
 *
·th
 = (GtkT»eP©h *è
r
->
d©a
;

241 
GtkT»eRowReã»nû
 *
	g»f
 = 
gtk_Œ“_row_»ã»nû_Ãw
(
pv
->
šc_¡Üe
, 
·th
);

242 
	g»fs
 = 
g_li¡_´•’d
(
»fs
, 
»f
);

245 
	gr
 = 
»fs
;„ !ğ
NULL
;„ = 
r
->
Ãxt
) {

246 
GtkT»eRowReã»nû
 *
»f
 = (GtkT»eRowReã»nû *è
r
->
d©a
;

247 
GtkT»eP©h
 *
	g·th
 = 
gtk_Œ“_row_»ã»nû_g‘_·th
(
»f
);

248 
GtkT»eI‹r
 
	g™”
, 
	gchd_™”
;

249 *
	gÇme
;

250 
size_t
 
	gi
 = 0;

251 
	g»tv®
;

252 
gtk_Œ“_mod–_g‘_™”
(
pv
->
šc_¡Üe
, &
™”
, 
·th
);

253 
gtk_Œ“_mod–_f‹r_cÚv”t_™”_to_chd_™”
(
GTK_TREE_MODEL_FILTER
(
pv
->
šc_¡Üe
), &
chd_™”
, &
™”
);

254 
gtk_Œ“_mod–_g‘
(
GTK_TREE_MODEL
(
pv
->
ma¡”_¡Üe
), &
chd_™”
, 
NAME_COLUMN
, &
Çme
, -1);

255 
gtk_li¡_¡Üe_£t
(
pv
->
ma¡”_¡Üe
, &
chd_™”
, 
ISINC_COLUMN
, 
FALSE
, -1);

256 
	g»tv®
 = 
­Ş_veùÜ_g‘_šdex
(
pv
->
šşuded_™ems
, 
Çme
, 
­Ş_¡r_¡rcmp
, 
NULL
, &
i
);

257 
as£¹
(
»tv®
 == 0);

258 
	gÇme
 = 
­Ş_veùÜ_g‘_–em’t
(
pv
->
šşuded_™ems
, 
i
);

259 
ä“
(
Çme
);

260 
­Ş_veùÜ_»move
(
pv
->
šşuded_™ems
, 
i
);

263 
g_li¡_fÜ—ch
(
»fs
, 
pŞicy_compÚ’ts_gtk_Œ“_row_»ã»nû_ä“
, 
NULL
);

264 
g_li¡_ä“
(
»fs
);

265 
g_li¡_fÜ—ch
(
rows
, 
pŞicy_compÚ’ts_gtk_Œ“_·th_ä“
, 
NULL
);

266 
g_li¡_ä“
(
rows
);

267 
gtk_Œ“_mod–_f‹r_»f‹r
(
GTK_TREE_MODEL_FILTER
(
pv
->
šc_¡Üe
));

268 
gtk_Œ“_mod–_f‹r_»f‹r
(
GTK_TREE_MODEL_FILTER
(
pv
->
exc_¡Üe
));

271 
pŞicy_compÚ’ts_v›w_Ú_to_šc_şick
(
GtkBu‰Ú
 * 
widg‘
 
__©Œibu‹__
 ((
unu£d
)), 
gpoš‹r
 
u£r_d©a
)

273 
pŞcomp_v›w
 *
	gpv
 = (pŞcomp_v›w *)
u£r_d©a
;

274 
GtkT»eS–eùiÚ
 *
	g£ËùiÚ
 = 
gtk_Œ“_v›w_g‘_£ËùiÚ
(
pv
->
exc_v›w
);

275 
GLi¡
 *
	gr
, *
	grows
 = 
gtk_Œ“_£ËùiÚ_g‘_£Ëùed_rows
(
£ËùiÚ
, 
NULL
);

279 
GLi¡
 *
	g»fs
 = 
NULL
;

280 
	gr
 = 
rows
;„ !ğ
NULL
;„ = 
r
->
Ãxt
) {

281 
GtkT»eP©h
 *
·th
 = (GtkT»eP©h *è
r
->
d©a
;

282 
GtkT»eRowReã»nû
 *
	g»f
 = 
gtk_Œ“_row_»ã»nû_Ãw
(
pv
->
exc_¡Üe
, 
·th
);

283 
	g»fs
 = 
g_li¡_´•’d
(
»fs
, 
»f
);

286 
	gr
 = 
»fs
;„ !ğ
NULL
;„ = 
r
->
Ãxt
) {

287 
GtkT»eRowReã»nû
 *
»f
 = (GtkT»eRowReã»nû *è
r
->
d©a
;

288 
GtkT»eP©h
 *
	g·th
 = 
gtk_Œ“_row_»ã»nû_g‘_·th
(
»f
);

289 
GtkT»eI‹r
 
	g™”
, 
	gchd_™”
;

290 *
	gÇme
;

291 
gtk_Œ“_mod–_g‘_™”
(
pv
->
exc_¡Üe
, &
™”
, 
·th
);

292 
gtk_Œ“_mod–_f‹r_cÚv”t_™”_to_chd_™”
(
GTK_TREE_MODEL_FILTER
(
pv
->
exc_¡Üe
), &
chd_™”
, &
™”
);

293 
gtk_Œ“_mod–_g‘
(
GTK_TREE_MODEL
(
pv
->
ma¡”_¡Üe
), &
chd_™”
, 
NAME_COLUMN
, &
Çme
, -1);

294 
gtk_li¡_¡Üe_£t
(
pv
->
ma¡”_¡Üe
, &
chd_™”
, 
ISINC_COLUMN
, 
TRUE
, -1);

295 
­Ş_veùÜ_­³nd
(
pv
->
šşuded_™ems
, 
¡rdup
(
Çme
));

297 
­Ş_veùÜ_sÜt_uniquify
(
pv
->
šşuded_™ems
, 
­Ş_¡r_¡rcmp
, 
NULL
);

298 
g_li¡_fÜ—ch
(
»fs
, 
pŞicy_compÚ’ts_gtk_Œ“_row_»ã»nû_ä“
, 
NULL
);

299 
g_li¡_ä“
(
»fs
);

300 
g_li¡_fÜ—ch
(
rows
, 
pŞicy_compÚ’ts_gtk_Œ“_·th_ä“
, 
NULL
);

301 
g_li¡_ä“
(
rows
);

302 
gtk_Œ“_mod–_f‹r_»f‹r
(
GTK_TREE_MODEL_FILTER
(
pv
->
šc_¡Üe
));

303 
gtk_Œ“_mod–_f‹r_»f‹r
(
GTK_TREE_MODEL_FILTER
(
pv
->
exc_¡Üe
));

306 
pŞicy_compÚ’ts_v›w_Ú_£Ëù_şick
(
GtkBu‰Ú
 * 
widg‘
 
__©Œibu‹__
 ((
unu£d
)), 
gpoš‹r
 
u£r_d©a
)

308 
GtkT»eV›w
 *
	gtv
 = 
GTK_TREE_VIEW
(
u£r_d©a
);

309 
GtkT»eS–eùiÚ
 *
	g£ËùiÚ
 = 
gtk_Œ“_v›w_g‘_£ËùiÚ
(
tv
);

310 
gtk_Œ“_£ËùiÚ_£Ëù_®l
(
£ËùiÚ
);

313 
pŞicy_compÚ’ts_v›w_Ú_un£Ëù_şick
(
GtkBu‰Ú
 * 
widg‘
 
__©Œibu‹__
 ((
unu£d
)), 
gpoš‹r
 
u£r_d©a
)

315 
GtkT»eV›w
 *
	gtv
 = 
GTK_TREE_VIEW
(
u£r_d©a
);

316 
GtkT»eS–eùiÚ
 *
	g£ËùiÚ
 = 
gtk_Œ“_v›w_g‘_£ËùiÚ
(
tv
);

317 
gtk_Œ“_£ËùiÚ_un£Ëù_®l
(
£ËùiÚ
);

320 
	$pŞicy_compÚ’ts_v›w_š™_sigÇls
(
pŞcomp_v›w
 *
pv
)

322 
	`g_sigÇl_cÚÃù
(
pv
->
log_¿dio
, "toggËd", 
	`G_CALLBACK
(
pŞicy_compÚ’ts_v›w_Ú_sourû_toggË
),…v);

323 
	`g_sigÇl_cÚÃù
(
pv
->
pŞicy_¿dio
, "toggËd", 
	`G_CALLBACK
(
pŞicy_compÚ’ts_v›w_Ú_sourû_toggË
),…v);

324 
	`g_sigÇl_cÚÃù
(
pv
->
bÙh_¿dio
, "toggËd", 
	`G_CALLBACK
(
pŞicy_compÚ’ts_v›w_Ú_sourû_toggË
),…v);

325 
	`g_sigÇl_cÚÃù
(
pv
->
to_exc_bu‰Ú
, "şicked", 
	`G_CALLBACK
(
pŞicy_compÚ’ts_v›w_Ú_to_exc_şick
),…v);

326 
	`g_sigÇl_cÚÃù
(
pv
->
to_šc_bu‰Ú
, "şicked", 
	`G_CALLBACK
(
pŞicy_compÚ’ts_v›w_Ú_to_šc_şick
),…v);

327 
	`g_sigÇl_cÚÃù
(
pv
->
šc_£Ëù_bu‰Ú
, "şicked", 
	`G_CALLBACK
(
pŞicy_compÚ’ts_v›w_Ú_£Ëù_şick
),…v->
šc_v›w
);

328 
	`g_sigÇl_cÚÃù
(
pv
->
šc_un£Ëù_bu‰Ú
, "şicked", 
	`G_CALLBACK
(
pŞicy_compÚ’ts_v›w_Ú_un£Ëù_şick
),…v->
šc_v›w
);

329 
	`g_sigÇl_cÚÃù
(
pv
->
exc_£Ëù_bu‰Ú
, "şicked", 
	`G_CALLBACK
(
pŞicy_compÚ’ts_v›w_Ú_£Ëù_şick
),…v->
exc_v›w
);

330 
	`g_sigÇl_cÚÃù
(
pv
->
exc_un£Ëù_bu‰Ú
, "şicked", 
	`G_CALLBACK
(
pŞicy_compÚ’ts_v›w_Ú_un£Ëù_şick
),…v->
exc_v›w
);

331 
	}
}

333 
­Ş_veùÜ_t
 *
pŞicy_compÚ’ts_v›w_run
(
tİËv–_t
 * 
tİ
, 
GtkWšdow
 * 
·»Á
 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ *
t™Ë
,

334 
­Ş_veùÜ_t
 * 
log_™ems
,‡pŞ_veùÜ_ˆ* 
pŞicy_™ems
,‡pŞ_veùÜ_ˆ* 
šşuded
)

336 
pŞcomp_v›w
 
	gpv
;

337 
gšt
 
	g»¥Ú£
;

339 
mem£t
(&
pv
, 0, (pv));

340 
	gpv
.
	gtİ
 = 
tİ
;

341 
	gpv
.
	gxml
 = 
gÏde_xml_Ãw
(
tİËv–_g‘_gÏde_xml
(
tİ
), "PŞicyCompÚ’tLi¡sWšdow", 
NULL
);

342 
	gpv
.
	glog_™ems
 = 
log_™ems
;

343 
	gpv
.
	gpŞicy_™ems
 = 
pŞicy_™ems
;

344 ià(
	gšşuded
 =ğ
NULL
) {

345 
pv
.
šşuded_™ems
 = 
­Ş_veùÜ_ü—‹
(
ä“
);

347 
	gpv
.
	gšşuded_™ems
 = 
­Ş_veùÜ_ü—‹_äom_veùÜ
(
šşuded
, 
­Ş_¡r_¡rdup
, 
NULL
, 
ä“
);

349 
­Ş_veùÜ_de¡roy
(&
šşuded
);

350 ià(
	gpv
.
	gšşuded_™ems
 =ğ
NULL
) {

351 
tİËv–_ERR
(
pv
.
tİ
, "E¼Ü c»©šg dŸlog: %s", 
¡»¼Ü
(
”ºo
));

352  
	gNULL
;

355 
pŞicy_compÚ’ts_v›w_š™_widg‘s
(&
pv
);

356 
pŞicy_compÚ’ts_v›w_š™_li¡s
(&
pv
);

357 
pŞicy_compÚ’ts_v›w_š™_sigÇls
(&
pv
);

358 
gtk_wšdow_£t_t™Ë
(
GTK_WINDOW
(
pv
.
dŸlog
), 
t™Ë
);

360 
	g»¥Ú£
 = 
gtk_dŸlog_run
(
pv
.
dŸlog
);

361 } 
	g»¥Ú£
 !ğ
GTK_RESPONSE_CLOSE
);

363 
gtk_widg‘_de¡roy
(
GTK_WIDGET
(
pv
.
dŸlog
));

364 
g_objeù_uÄef
(
pv
.
ma¡”_¡Üe
);

365 
g_objeù_uÄef
(
pv
.
šc_¡Üe
);

366 
g_objeù_uÄef
(
pv
.
exc_¡Üe
);

367 
­Ş_veùÜ_de¡roy
(&
pv
.
bÙh_™ems
);

368 ià(
­Ş_veùÜ_g‘_size
(
pv
.
šşuded_™ems
) == 0) {

369 
­Ş_veùÜ_de¡roy
(&
pv
.
šşuded_™ems
);

370  
	gNULL
;

372  
	gpv
.
	gšşuded_™ems
;

	@seaudit/policy_components_view.h

26 #iâdeà
POLICY_COMPONENTS_VIEW_H


27 
	#POLICY_COMPONENTS_VIEW_H


	)

29 
	~"tİËv–.h
"

30 
	~<­Ş/veùÜ.h
>

31 
	~<gtk/gtk.h
>

53 
­Ş_veùÜ_t
 *
pŞicy_compÚ’ts_v›w_run
(
tİËv–_t
 * 
tİ
, 
GtkWšdow
 * 
·»Á
, cÚ¡ *
t™Ë
,

54 
­Ş_veùÜ_t
 * 
log_™ems
,‡pŞ_veùÜ_ˆ* 
pŞicy_™ems
,‡pŞ_veùÜ_ˆ* 
šşuded
);

	@seaudit/policy_view.c

25 
	~<cÚfig.h
>

27 
	~"pŞicy_v›w.h
"

28 
	~"utgui.h
"

30 
	~<as£¹.h
>

31 
	~<”ºo.h
>

32 
	~<¡ršg.h
>

33 
	~<­Ş/pŞicy-qu”y.h
>

34 
	~<­Ş/ut.h
>

35 
	~<gÏde/gÏde.h
>

36 
	~<qpŞ/pŞicy.h
>

37 
	~<qpŞ/pŞicy_ex‹nd.h
>

38 
	~<£aud™/avc_mes§ge.h
>

41 
	~<fú.h
>

42 
	~<uni¡d.h
>

43 
	~<sys/mmª.h
>

44 
	~<sys/¡©.h
>

45 
	~<sys/ty³s.h
>

47 
	spŞicy_v›w


49 
tİËv–_t
 *
	mtİ
;

50 
GÏdeXML
 *
	mxml
;

51 
GtkWšdow
 *
	mwšdow
;

52 
GtkNÙebook
 *
	mnÙebook
;

53 
GtkToggËBu‰Ú
 *
	m¡y³_check
, *
	m‰y³_check
, *
	mşass_check
;

54 
GtkComboBoxEÁry
 *
	m¡y³_combo
, *
	m‰y³_combo
, *
	mşass_combo
;

55 
GtkToggËBu‰Ú
 *
	m¡y³_dœeù
, *
	m‰y³_dœeù
;

56 
GtkLi¡StÜe
 *
	mty³_mod–
, *
	mşass_mod–
;

57 
­Ş_veùÜ_t
 *
	mty³_li¡
, *
	mşass_li¡
;

58 
GtkTextBufãr
 *
	mruËs_‹xt
, *
	mpŞicy_‹xt
;

59 *
	mpŞicy_‹xt_mm­
;

60 
size_t
 
	mpŞicy_‹xt_Ën
;

67 
	$pŞicy_v›w_di¥Ïy_avruË_»suÉs
(
pŞicy_v›w_t
 * 
pv
, 
­Ş_veùÜ_t
 * 
»suÉs
, 
is_syn_ruËs
)

69 
­Ş_pŞicy_t
 *
pŞicy
 = 
	`tİËv–_g‘_pŞicy
(
pv
->
tİ
);

70 
qpŞ_pŞicy_t
 *
qp
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicy
);

71 
GtkTextI‹r
 
¡¬t
, 
’d
;

72 *
¡ršg
, 
buf
[64];

73 
size_t
 
i
;

75 
	`gtk_‹xt_bufãr_g‘_¡¬t_™”
(
pv
->
ruËs_‹xt
, &
¡¬t
);

76 
	`gtk_‹xt_bufãr_g‘_’d_™”
(
pv
->
ruËs_‹xt
, &
’d
);

77 
	`gtk_‹xt_bufãr_d–‘e
(
pv
->
ruËs_‹xt
, &
¡¬t
, &
’d
);

79 
	`¢´štf
(
buf
, 64, "%zd„uË(sèm©chh£¬ch cr™”Ÿ.\n\n", 
	`­Ş_veùÜ_g‘_size
(
»suÉs
));

80 
	`gtk_‹xt_bufãr_š£¹_w™h_gs_by_Çme
(
pv
->
ruËs_‹xt
, &
’d
, 
buf
, -1, "summ¬y", 
NULL
);

81 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
»suÉs
); i++) {

82 ià(!
is_syn_ruËs
) {

83 
qpŞ_avruË_t
 *
ruË
 = 
	`­Ş_veùÜ_g‘_–em’t
(
»suÉs
, 
i
);

84 
¡ršg
 = 
	`­Ş_avruË_»nd”
(
pŞicy
, 
ruË
);

86 
qpŞ_syn_avruË_t
 *
ruË
 = 
	`­Ş_veùÜ_g‘_–em’t
(
»suÉs
, 
i
);

87 
¡ršg
 = 
	`­Ş_syn_avruË_»nd”
(
pŞicy
, 
ruË
);

88 
lš’o
;

89 ià(
	`qpŞ_pŞicy_has_ÿ·b™y
(
qp
, 
QPOL_CAP_LINE_NUMBERS
)) {

90 
	`qpŞ_syn_avruË_g‘_lš’o
(
qp
, 
ruË
, &
lš’o
);

91 
	`¥rštf
(
buf
, "%ld", 
lš’o
);

92 
	`gtk_‹xt_bufãr_š£¹_w™h_gs_by_Çme
(
pv
->
ruËs_‹xt
, &
’d
, "[", -1, "ruË", 
NULL
);

93 
	`gtk_‹xt_bufãr_š£¹_w™h_gs_by_Çme
(
pv
->
ruËs_‹xt
, &
’d
, 
buf
, -1, "lše-numb”", 
NULL
);

94 
	`gtk_‹xt_bufãr_š£¹_w™h_gs_by_Çme
(
pv
->
ruËs_‹xt
, &
’d
, "] ", -1, "ruË", 
NULL
);

97 ià(
¡ršg
 =ğ
NULL
) {

98 
	`tİËv–_ERR
(
pv
->
tİ
, "E¼Ü di¥Ïyšg„uË: %s", 
	`¡»¼Ü
(
”ºo
));

101 
	`gtk_‹xt_bufãr_š£¹_w™h_gs_by_Çme
(
pv
->
ruËs_‹xt
, &
’d
, 
¡ršg
, -1, "ruË", 
NULL
);

102 
	`ä“
(
¡ršg
);

103 
	`gtk_‹xt_bufãr_š£¹
(
pv
->
ruËs_‹xt
, &
’d
, "\n", -1);

105 
	}
}

107 
	sfšd_‹ruËs_d©um


109 
­Ş_pŞicy_t
 *
	mpŞicy
;

110 
­Ş_avruË_qu”y_t
 *
	mqu”y
;

111 
­Ş_veùÜ_t
 *
	m»suÉs
;

112 
	mis_syn_ruËs
, 
	m»tv®
;

113 
´og»ss_t
 *
	m´og»ss
;

119 
gpoš‹r
 
	$pŞicy_v›w_fšd_‹ruËs_ruÂ”
(
gpoš‹r
 
d©a
)

121 
fšd_‹ruËs_d©um
 *
run
 = (fšd_‹ruËs_d©um *)
d©a
;

122 
run
->
»suÉs
 = 
NULL
;

123 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
run
->
pŞicy
);

124 ià(!
	`qpŞ_pŞicy_has_ÿ·b™y
(
q
, 
QPOL_CAP_SYN_RULES
)) {

125 
	`´og»ss_upd©e
(
run
->
´og»ss
, "Searching AV„ules");

126 
run
->
»tv®
 = 
	`­Ş_avruË_g‘_by_qu”y
Ôun->
pŞicy
,„un->
qu”y
, &run->
»suÉs
);

127 
run
->
is_syn_ruËs
 = 0;

129 
	`qpŞ_pŞicy_bud_syn_ruË_bË
(
q
);

130 
	`´og»ss_upd©e
(
run
->
´og»ss
, "Searching syntactic AV„ules");

131 
run
->
»tv®
 = 
	`­Ş_syn_avruË_g‘_by_qu”y
Ôun->
pŞicy
,„un->
qu”y
, &run->
»suÉs
);

132 
run
->
is_syn_ruËs
 = 1;

134 ià(
run
->
»tv®
 == 0) {

135 
	`´og»ss_dÚe
(
run
->
´og»ss
);

137 
	`´og»ss_abÜt
(
run
->
´og»ss
, 
NULL
);

139  
NULL
;

140 
	}
}

146 
pŞicy_v›w_Ú_fšd_‹ruËs_şick
(
GtkBu‰Ú
 * 
bu‰Ú
 
__©Œibu‹__
 ((
unu£d
)), 
gpoš‹r
 
u£r_d©a
)

148 
pŞicy_v›w_t
 *
	gpv
 = (pŞicy_v›w_ˆ*è
u£r_d©a
;

149 
­Ş_pŞicy_t
 *
	gpŞicy
 = 
tİËv–_g‘_pŞicy
(
pv
->
tİ
);

150 
­Ş_avruË_qu”y_t
 *
	gqu”y
 = 
­Ş_avruË_qu”y_ü—‹
();

151 
­Ş_avruË_qu”y_£t_»gex
(
pŞicy
, 
qu”y
, 1);

152 
fšd_‹ruËs_d©um
 
	grun
;

153 cÚ¡ *
	gs
;

154 
gboŞ—n
 
	gÚly_dœeù
;

155 
­Ş_avruË_qu”y_£t_ruËs
(
pŞicy
, 
qu”y
, 
QPOL_RULE_ALLOW
);

156 ià(
gtk_toggË_bu‰Ú_g‘_aùive
(
GTK_TOGGLE_BUTTON
(
pv
->
¡y³_check
))) {

157 
	gs
 = 
ut_combo_box_g‘_aùive_‹xt
(
GTK_COMBO_BOX
(
pv
->
¡y³_combo
));

158 
	gÚly_dœeù
 = 
gtk_toggË_bu‰Ú_g‘_aùive
(
pv
->
¡y³_dœeù
);

159 ià(
¡rcmp
(
s
, "") == 0) {

160 
tİËv–_ERR
(
pv
->
tİ
, "No sourceype was selected.");

163 
­Ş_avruË_qu”y_£t_sourû
(
pŞicy
, 
qu”y
, 
s
, 
Úly_dœeù
 =ğ
FALSE
);

164 
­Ş_avruË_qu”y_£t_sourû_compÚ’t
(
pŞicy
, 
qu”y
, 
APOL_QUERY_SYMBOL_IS_TYPE
);

166 ià(
gtk_toggË_bu‰Ú_g‘_aùive
(
GTK_TOGGLE_BUTTON
(
pv
->
‰y³_check
))) {

167 
	gs
 = 
ut_combo_box_g‘_aùive_‹xt
(
GTK_COMBO_BOX
(
pv
->
‰y³_combo
));

168 
	gÚly_dœeù
 = 
gtk_toggË_bu‰Ú_g‘_aùive
(
pv
->
‰y³_dœeù
);

169 ià(
¡rcmp
(
s
, "") == 0) {

170 
tİËv–_ERR
(
pv
->
tİ
, "Noargetype was selected.");

173 
­Ş_avruË_qu”y_£t_rg‘
(
pŞicy
, 
qu”y
, 
s
, 
Úly_dœeù
 =ğ
FALSE
);

174 
­Ş_avruË_qu”y_£t_sourû_compÚ’t
(
pŞicy
, 
qu”y
, 
APOL_QUERY_SYMBOL_IS_TYPE
);

176 ià(
gtk_toggË_bu‰Ú_g‘_aùive
(
GTK_TOGGLE_BUTTON
(
pv
->
şass_check
))) {

177 
	gs
 = 
ut_combo_box_g‘_aùive_‹xt
(
GTK_COMBO_BOX
(
pv
->
şass_combo
));

178 ià(
¡rcmp
(
s
, "") == 0) {

179 
tİËv–_ERR
(
pv
->
tİ
, "No object class was selected.");

182 
­Ş_avruË_qu”y_­³nd_şass
(
pŞicy
, 
qu”y
, 
s
);

185 
ut_cursÜ_wa™
(
GTK_WIDGET
(
pv
->
wšdow
));

186 
	grun
.
	gpŞicy
 = 
pŞicy
;

187 
	grun
.
	gqu”y
 = 
qu”y
;

188 
	grun
.
	g´og»ss
 = 
tİËv–_g‘_´og»ss
(
pv
->
tİ
);

189 
´og»ss_show
(
run
.
´og»ss
, "Finding TE Rules");

190 
g_th»ad_ü—‹
(
pŞicy_v›w_fšd_‹ruËs_ruÂ”
, &
run
, 
FALSE
, 
NULL
);

191 
´og»ss_wa™
(
run
.
´og»ss
);

192 
´og»ss_hide
(
run
.
´og»ss
);

193 
ut_cursÜ_ş—r
(
GTK_WIDGET
(
pv
->
wšdow
));

194 
­Ş_avruË_qu”y_de¡roy
(&
qu”y
);

195 ià(
	grun
.
	g»tv®
 == 0) {

196 
pŞicy_v›w_di¥Ïy_avruË_»suÉs
(
pv
, 
run
.
»suÉs
,„un.
is_syn_ruËs
);

198 
­Ş_veùÜ_de¡roy
(&
run
.
»suÉs
);

201 
pŞicy_v›w_şo£
(
GtkBu‰Ú
 * 
bu‰Ú
 
__©Œibu‹__
 ((
unu£d
)), 
gpoš‹r
 
u£r_d©a
)

203 
pŞicy_v›w_t
 *
	gpv
 = (pŞicy_v›w_ˆ*è
u£r_d©a
;

204 
gtk_widg‘_hide
(
GTK_WIDGET
(
pv
->
wšdow
));

207 
gboŞ—n
 
pŞicy_v›w_Ú_d–‘e_ev’t
(
GtkWidg‘
 * 
widg‘
, 
GdkEv’t
 * 
ev’t
 
__©Œibu‹__
 ((
unu£d
)), 
gpoš‹r
 
u£r_d©a


208 
__©Œibu‹__
 ((
unu£d
)))

210 
gtk_widg‘_hide
(
widg‘
);

211  
	gTRUE
;

214 
	$pŞicy_v›w_Ú_¡y³_toggË
(
GtkToggËBu‰Ú
 * 
toggË
, 
gpoš‹r
 
u£r_d©a
)

216 
gboŞ—n
 
£ns
 = 
	`gtk_toggË_bu‰Ú_g‘_aùive
(
toggË
);

217 
pŞicy_v›w_t
 *
pv
 = (pŞicy_v›w_ˆ*è
u£r_d©a
;

218 
	`gtk_widg‘_£t_£ns™ive
(
	`GTK_WIDGET
(
pv
->
¡y³_combo
), 
£ns
);

219 
	`gtk_widg‘_£t_£ns™ive
(
	`GTK_WIDGET
(
pv
->
¡y³_dœeù
), 
£ns
);

220 
	}
}

222 
	$pŞicy_v›w_Ú_‰y³_toggË
(
GtkToggËBu‰Ú
 * 
toggË
, 
gpoš‹r
 
u£r_d©a
)

224 
gboŞ—n
 
£ns
 = 
	`gtk_toggË_bu‰Ú_g‘_aùive
(
toggË
);

225 
pŞicy_v›w_t
 *
pv
 = (pŞicy_v›w_ˆ*è
u£r_d©a
;

226 
	`gtk_widg‘_£t_£ns™ive
(
	`GTK_WIDGET
(
pv
->
‰y³_combo
), 
£ns
);

227 
	`gtk_widg‘_£t_£ns™ive
(
	`GTK_WIDGET
(
pv
->
‰y³_dœeù
), 
£ns
);

228 
	}
}

230 
	$pŞicy_v›w_Ú_şass_toggË
(
GtkToggËBu‰Ú
 * 
toggË
, 
gpoš‹r
 
u£r_d©a
)

232 
gboŞ—n
 
£ns
 = 
	`gtk_toggË_bu‰Ú_g‘_aùive
(
toggË
);

233 
pŞicy_v›w_t
 *
pv
 = (pŞicy_v›w_ˆ*è
u£r_d©a
;

234 
	`gtk_widg‘_£t_£ns™ive
(
	`GTK_WIDGET
(
pv
->
şass_combo
), 
£ns
);

236 
	}
}

238 
gboŞ—n
 
pŞicy_v›w_Ú_lše_ev’t
(
GtkTextTag
 * 
g


239 
__©Œibu‹__
 ((
unu£d
)), 
GObjeù
 * 
ev’t_objeù


240 
__©Œibu‹__
 ((
unu£d
)), 
GdkEv’t
 * 
ev’t
, cÚ¡ 
GtkTextI‹r
 * 
™”
, 
gpoš‹r
 
u£r_d©a
)

242 
pŞicy_v›w_t
 *
	gpv
 = (pŞicy_v›w_ˆ*è
u£r_d©a
;

243 
GtkTextI‹r
 
	g¡¬t
, 
	g’d
;

244 
	glše
;

245 
GtkTextV›w
 *
	gv›w
;

246 ià(
	gev’t
->
	gty³
 !ğ
GDK_BUTTON_PRESS
) {

247  
FALSE
;

249 
	g¡¬t
 = *
™”
;

250 !
gtk_‹xt_™”_¡¬ts_wÜd
(&
¡¬t
))

251 
gtk_‹xt_™”_backw¬d_ch¬
(&
¡¬t
);

252 
	g’d
 = 
¡¬t
;

253 !
gtk_‹xt_™”_’ds_wÜd
(&
’d
))

254 
gtk_‹xt_™”_fÜw¬d_ch¬
(&
’d
);

256 
	glše
 = 
©oi
(
gtk_‹xt_™”_g‘_¦iû
(&
¡¬t
, &
’d
)) - 1;

257 
	gv›w
 = 
GTK_TEXT_VIEW
(
gÏde_xml_g‘_widg‘
(
pv
->
xml
, "PolicyWindowPolicyText"));

258 
as£¹
(
v›w
 !ğ
NULL
);

259 
gtk_nÙebook_£t_cu¼’t_·ge
(
pv
->
nÙebook
, 1);

260 
gtk_‹xt_bufãr_g‘_¡¬t_™”
(
pv
->
pŞicy_‹xt
, &
¡¬t
);

261 
gtk_‹xt_™”_£t_lše
(&
¡¬t
, 
lše
);

262 
gtk_‹xt_v›w_süŞl_to_™”
(
v›w
, &
¡¬t
, 0.0001, 
TRUE
, 0.0, 0.5);

263 
gtk_‹xt_bufãr_¶aû_cursÜ
(
pv
->
pŞicy_‹xt
, &
¡¬t
);

264 
gtk_‹xt_v›w_£t_cursÜ_visibË
(
v›w
, 
TRUE
);

265  
	gTRUE
;

268 
gboŞ—n
 
pŞicy_v›w_Ú_ruËs_mÙiÚ
(
GtkWidg‘
 * 
widg‘
, 
GdkEv’tMÙiÚ
 * 
ev’t
, 
gpoš‹r
 
u£r_d©a
 
__©Œibu‹__
 ((
unu£d
)))

270 
GtkTextV›w
 *
	g‹xtv›w
 = 
GTK_TEXT_VIEW
(
widg‘
);

271 
gšt
 
	gx
, 
	gex
, 
	gy
, 
	gey
;

272 
GtkTextI‹r
 
	g™”
;

273 
GSLi¡
 *
	ggs
, *
	ggp
;

274 
	ghov”šg
 = 0;

275 ià(
	gev’t
->
	gis_hšt
) {

276 
gdk_wšdow_g‘_poš‹r
(
ev’t
->
wšdow
, &
ex
, &
ey
, 
NULL
);

278 
	gex
 = 
ev’t
->
x
;

279 
	gey
 = 
ev’t
->
y
;

281 
gtk_‹xt_v›w_wšdow_to_bufãr_coÜds
(
‹xtv›w
, 
GTK_TEXT_WINDOW_WIDGET
, 
ex
, 
ey
, &
x
, &
y
);

282 
gtk_‹xt_v›w_g‘_™”_©_loÿtiÚ
(
‹xtv›w
, &
™”
, 
x
, 
y
);

283 
	ggs
 = 
gtk_‹xt_™”_g‘_gs
(&
™”
);

284 
	ggp
 = 
gs
;ag°!ğ
NULL
;ag°ğ
gp
->
Ãxt
) {

285 ià(
¡rcmp
(
GTK_TEXT_TAG
(
gp
->
d©a
)->
Çme
, "line-number") == 0) {

286 
hov”šg
 = 
TRUE
;

290 ià(
	ghov”šg
) {

291 
GdkCursÜ
 *
	gcursÜ
 = 
gdk_cursÜ_Ãw
(
GDK_HAND2
);

292 
gdk_wšdow_£t_cursÜ
(
ev’t
->
wšdow
, 
cursÜ
);

293 
gdk_cursÜ_uÄef
(
cursÜ
);

294 
gdk_æush
();

296 
gdk_wšdow_£t_cursÜ
(
ev’t
->
wšdow
, 
NULL
);

298 
g_¦i¡_ä“
(
gs
);

299  
	gFALSE
;

308 
	$pŞicy_v›w_ü—‹_ruËs_bufãr
(
pŞicy_v›w_t
 * 
pv
)

310 
GtkTextV›w
 *
ruËs_‹xtv›w
;

311 
GtkTextTagTabË
 *
bË
;

312 
GtkTextTag
 *
g
;

313 
ruËs_‹xtv›w
 = 
	`GTK_TEXT_VIEW
(
	`gÏde_xml_g‘_widg‘
(
pv
->
xml
, "PolicyWindowTERulesResults"));

314 
	`as£¹
(
ruËs_‹xtv›w
 !ğ
NULL
);

315 
pv
->
ruËs_‹xt
 = 
	`gtk_‹xt_bufãr_Ãw
(
NULL
);

316 
	`gtk_‹xt_v›w_£t_bufãr
(
ruËs_‹xtv›w
, 
pv
->
ruËs_‹xt
);

317 
bË
 = 
	`gtk_‹xt_bufãr_g‘_g_bË
(
pv
->
ruËs_‹xt
);

318 
	`gtk_‹xt_bufãr_ü—‹_g
(
pv
->
ruËs_‹xt
, "summ¬y", "çmy", "mÚo¥aû", "weight", "bŞd", 
NULL
);

319 
g
 = 
	`gtk_‹xt_bufãr_ü—‹_g
(
pv
->
ruËs_‹xt
, "line-number",

320 "çmy", "mÚo¥aû", "fÜeground", "blue", "und”lše", 
PANGO_UNDERLINE_SINGLE
, 
NULL
);

321 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
(
g
), "ev’t", 
	`G_CALLBACK
(
pŞicy_v›w_Ú_lše_ev’t
), 
pv
);

322 
	`g_sigÇl_cÚÃù
(
ruËs_‹xtv›w
, "mÙiÚ-nÙify-ev’t", 
	`G_CALLBACK
(
pŞicy_v›w_Ú_ruËs_mÙiÚ
), 
NULL
);

323 
	`gtk_‹xt_bufãr_ü—‹_g
(
pv
->
ruËs_‹xt
, "ruË", "çmy", "mÚo¥aû", 
NULL
);

324 
	}
}

326 
pŞicy_v›w_t
 *
	$pŞicy_v›w_ü—‹
(
tİËv–_t
 * 
tİ
)

328 
GtkWidg‘
 *
w
;

329 
GtkTextV›w
 *
pŞicy_‹xtv›w
;

330 
pŞicy_v›w_t
 *
pv
;

331 ià((
pv
 = 
	`ÿÎoc
(1, (*pv))è=ğ
NULL
) {

332  
NULL
;

334 
pv
->
tİ
 =op;

335 
pv
->
xml
 = 
	`gÏde_xml_Ãw
(
	`tİËv–_g‘_gÏde_xml
(
tİ
), "PŞicyWšdow", 
NULL
);

336 
pv
->
wšdow
 = 
	`GTK_WINDOW
(
	`gÏde_xml_g‘_widg‘
Õv->
xml
, "PolicyWindow"));

337 
	`as£¹
(
pv
->
wšdow
 !ğ
NULL
);

338 
	`gtk_wšdow_£t_Œªs›Á_fÜ
(
pv
->
wšdow
, 
	`tİËv–_g‘_wšdow
(
tİ
));

339 
pv
->
nÙebook
 = 
	`GTK_NOTEBOOK
(
	`gÏde_xml_g‘_widg‘
Õv->
xml
, "PolicyWindowNotebook"));

340 
	`as£¹
(
pv
->
nÙebook
 !ğ
NULL
);

342 
pv
->
¡y³_check
 = 
	`GTK_TOGGLE_BUTTON
(
	`gÏde_xml_g‘_widg‘
Õv->
xml
, "PolicyWindowSTypeCheck"));

343 
pv
->
‰y³_check
 = 
	`GTK_TOGGLE_BUTTON
(
	`gÏde_xml_g‘_widg‘
Õv->
xml
, "PolicyWindowTTypeCheck"));

344 
pv
->
şass_check
 = 
	`GTK_TOGGLE_BUTTON
(
	`gÏde_xml_g‘_widg‘
Õv->
xml
, "PolicyWindowClassCheck"));

345 
	`as£¹
(
pv
->
¡y³_check
 !ğ
NULL
 &&…v->
‰y³_check
 !ğNULL &&…v->
şass_check
 != NULL);

346 
	`g_sigÇl_cÚÃù
(
pv
->
¡y³_check
, "toggËd", 
	`G_CALLBACK
(
pŞicy_v›w_Ú_¡y³_toggË
),…v);

347 
	`g_sigÇl_cÚÃù
(
pv
->
‰y³_check
, "toggËd", 
	`G_CALLBACK
(
pŞicy_v›w_Ú_‰y³_toggË
),…v);

348 
	`g_sigÇl_cÚÃù
(
pv
->
şass_check
, "toggËd", 
	`G_CALLBACK
(
pŞicy_v›w_Ú_şass_toggË
),…v);

350 
pv
->
¡y³_combo
 = 
	`GTK_COMBO_BOX_ENTRY
(
	`gÏde_xml_g‘_widg‘
Õv->
xml
, "PolicyWindowSTypeCombo"));

351 
pv
->
‰y³_combo
 = 
	`GTK_COMBO_BOX_ENTRY
(
	`gÏde_xml_g‘_widg‘
Õv->
xml
, "PolicyWindowTTypeCombo"));

352 
pv
->
şass_combo
 = 
	`GTK_COMBO_BOX_ENTRY
(
	`gÏde_xml_g‘_widg‘
Õv->
xml
, "PolicyWindowClassCombo"));

353 
	`as£¹
(
pv
->
¡y³_combo
 !ğ
NULL
 &&…v->
‰y³_combo
 !ğNULL &&…v->
şass_combo
 != NULL);

354 
pv
->
ty³_mod–
 = 
	`gtk_li¡_¡Üe_Ãw
(1, 
G_TYPE_STRING
);

355 
pv
->
şass_mod–
 = 
	`gtk_li¡_¡Üe_Ãw
(1, 
G_TYPE_STRING
);

356 
	`gtk_combo_box_£t_mod–
(
	`GTK_COMBO_BOX
(
pv
->
¡y³_combo
), 
	`GTK_TREE_MODEL
Õv->
ty³_mod–
));

357 
	`gtk_combo_box_£t_mod–
(
	`GTK_COMBO_BOX
(
pv
->
‰y³_combo
), 
	`GTK_TREE_MODEL
Õv->
ty³_mod–
));

358 
	`gtk_combo_box_£t_mod–
(
	`GTK_COMBO_BOX
(
pv
->
şass_combo
), 
	`GTK_TREE_MODEL
Õv->
şass_mod–
));

359 
	`gtk_combo_box_’Œy_£t_‹xt_cŞumn
(
pv
->
¡y³_combo
, 0);

360 
	`gtk_combo_box_’Œy_£t_‹xt_cŞumn
(
pv
->
‰y³_combo
, 0);

361 
	`gtk_combo_box_’Œy_£t_‹xt_cŞumn
(
pv
->
şass_combo
, 0);

363 
pv
->
¡y³_dœeù
 = 
	`GTK_TOGGLE_BUTTON
(
	`gÏde_xml_g‘_widg‘
Õv->
xml
, "PolicyWindowSTypeDirectCheck"));

364 
pv
->
‰y³_dœeù
 = 
	`GTK_TOGGLE_BUTTON
(
	`gÏde_xml_g‘_widg‘
Õv->
xml
, "PolicyWindowTTypeDirectCheck"));

365 
	`as£¹
(
pv
->
¡y³_dœeù
 !ğ
NULL
 &&…v->
‰y³_dœeù
 != NULL);

367 
	`pŞicy_v›w_ü—‹_ruËs_bufãr
(
pv
);

369 
pŞicy_‹xtv›w
 = 
	`GTK_TEXT_VIEW
(
	`gÏde_xml_g‘_widg‘
(
pv
->
xml
, "PolicyWindowPolicyText"));

370 
	`as£¹
(
pŞicy_‹xtv›w
 !ğ
NULL
);

371 
pv
->
pŞicy_‹xt
 = 
	`gtk_‹xt_bufãr_Ãw
(
NULL
);

372 
	`gtk_‹xt_v›w_£t_bufãr
(
pŞicy_‹xtv›w
, 
pv
->
pŞicy_‹xt
);

376 
w
 = 
	`gÏde_xml_g‘_widg‘
(
pv
->
xml
, "PolicyWindowFindTERulesButton");

377 
	`as£¹
(
w
 !ğ
NULL
);

378 
	`g_sigÇl_cÚÃù
(
w
, "şicked", 
	`G_CALLBACK
(
pŞicy_v›w_Ú_fšd_‹ruËs_şick
), 
pv
);

380 
w
 = 
	`gÏde_xml_g‘_widg‘
(
pv
->
xml
, "PolicyWindowCloseButton");

381 
	`as£¹
(
w
 !ğ
NULL
);

382 
	`g_sigÇl_cÚÃù
(
w
, "şicked", 
	`G_CALLBACK
(
pŞicy_v›w_şo£
), 
pv
);

383 
	`g_sigÇl_cÚÃù
(
pv
->
wšdow
, "d–‘e_ev’t", 
	`G_CALLBACK
(
pŞicy_v›w_Ú_d–‘e_ev’t
), 
NULL
);

385 
	`pŞicy_v›w_upd©e
(
pv
, 
NULL
);

386  
pv
;

387 
	}
}

389 
	$pŞicy_v›w_de¡roy
(
pŞicy_v›w_t
 ** 
pv
)

391 ià(
pv
 !ğ
NULL
 && *pv != NULL) {

392 
	`­Ş_veùÜ_de¡roy
(&(*
pv
)->
ty³_li¡
);

393 
	`­Ş_veùÜ_de¡roy
(&(*
pv
)->
şass_li¡
);

394 
	`ä“
(*
pv
);

395 *
pv
 = 
NULL
;

397 
	}
}

408 
	$pŞicy_v›w_lßd_pŞicy_sourû
(
pŞicy_v›w_t
 * 
pv
, 
­Ş_pŞicy_·th_t
 * 
·th
)

410 
­Ş_pŞicy_t
 *
pŞicy
 = 
	`tİËv–_g‘_pŞicy
(
pv
->
tİ
);

411 cÚ¡ *
´im¬y_·th
;

412 ià(
·th
 =ğ
NULL
) {

413 
	`gtk_‹xt_bufãr_£t_‹xt
(
pv
->
pŞicy_‹xt
, "No…olicy has been†oaded.", -1);

416 
´im¬y_·th
 = 
	`­Ş_pŞicy_·th_g‘_´im¬y
(
·th
);

417 ià(!
	`qpŞ_pŞicy_has_ÿ·b™y
(
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicy
), 
QPOL_CAP_SOURCE
)) {

418 
GSŒšg
 *
¡ršg
 = 
	`g_¡ršg_Ãw
("");

419 
	`g_¡ršg_´štf
(
¡ršg
, "PŞicy f% i nÙ‡ sourû…Şicy.", 
´im¬y_·th
);

420 
	`gtk_‹xt_bufãr_£t_‹xt
(
pv
->
pŞicy_‹xt
, 
¡ršg
->
¡r
, -1);

421 
	`g_¡ršg_ä“
(
¡ršg
, 
TRUE
);

424 
¡©
 
¡©buf
;

425 
fd
;

426 ià(
pv
->
pŞicy_‹xt_mm­
 !ğ
NULL
) {

427 
	`munm­
(
pv
->
pŞicy_‹xt_mm­
,…v->
pŞicy_‹xt_Ën
);

430 
pv
->
pŞicy_‹xt_mm­
 = 
NULL
;

431 
pv
->
pŞicy_‹xt_Ën
 = 0;

433 ià((
fd
 = 
	`İ’
(
´im¬y_·th
, 
O_RDONLY
)) < 0) {

434 
	`tİËv–_ERR
(
pv
->
tİ
, "Could‚Ù o³À% fÜ„—dšg.", 
´im¬y_·th
);

437 ià(
	`f¡©
(
fd
, &
¡©buf
) < 0) {

438 
	`şo£
(
fd
);

439 
	`tİËv–_ERR
(
pv
->
tİ
, "Could‚Ù sˆ%s.", 
´im¬y_·th
);

443 
pv
->
pŞicy_‹xt_Ën
 = 
¡©buf
.
¡_size
;

444 ià((
pv
->
pŞicy_‹xt_mm­
 = 
	`mm­
(0, 
¡©buf
.
¡_size
, 
PROT_READ
, 
MAP_PRIVATE
, 
fd
, 0)è=ğ
MAP_FAILED
) {

445 
	`şo£
(
fd
);

446 
pv
->
pŞicy_‹xt_mm­
 = 
NULL
;

447 
	`tİËv–_ERR
(
pv
->
tİ
, "Could‚Ù mm­ %s.", 
´im¬y_·th
);

450 
	`şo£
(
fd
);

451 
	`gtk_‹xt_bufãr_£t_‹xt
(
pv
->
pŞicy_‹xt
,…v->
pŞicy_‹xt_mm­
,…v->
pŞicy_‹xt_Ën
);

453 
	}
}

462 
	$pŞicy_v›w_pİuÏ‹_combo_boxes
(
pŞicy_v›w_t
 * 
pv
)

464 
­Ş_pŞicy_t
 *
pŞicy
 = 
	`tİËv–_g‘_pŞicy
(
pv
->
tİ
);

465 
	`gtk_li¡_¡Üe_ş—r
(
pv
->
ty³_mod–
);

466 
	`gtk_li¡_¡Üe_ş—r
(
pv
->
şass_mod–
);

467 
	`­Ş_veùÜ_de¡roy
(&
pv
->
ty³_li¡
);

468 
	`­Ş_veùÜ_de¡roy
(&
pv
->
şass_li¡
);

469 
pv
->
ty³_li¡
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
);

470 
pv
->
şass_li¡
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
);

471 ià(
pŞicy
 !ğ
NULL
) {

472 
qpŞ_pŞicy_t
 *
qp
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicy
);

473 
size_t
 
i
;

474 cÚ¡ 
qpŞ_ty³_t
 *
ty³
;

475 cÚ¡ 
qpŞ_şass_t
 *
obj_şass
;

476 cÚ¡ *
s
;

477 
GtkT»eI‹r
 
™”
;

478 
­Ş_veùÜ_t
 *
v
;

479 
	`­Ş_ty³_g‘_by_qu”y
(
pŞicy
, 
NULL
, &
v
);

480 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v
); i++) {

481 
ty³
 = 
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

482 
	`qpŞ_ty³_g‘_Çme
(
qp
, 
ty³
, &
s
);

483 
	`­Ş_veùÜ_­³nd
(
pv
->
ty³_li¡
, (*)
s
);

485 
	`­Ş_veùÜ_de¡roy
(&
v
);

486 
	`­Ş_veùÜ_sÜt
(
pv
->
ty³_li¡
, 
­Ş_¡r_¡rcmp
, 
NULL
);

487 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
pv
->
ty³_li¡
); i++) {

488 
s
 = 
	`­Ş_veùÜ_g‘_–em’t
(
pv
->
ty³_li¡
, 
i
);

489 #ifdeà
GTK_2_8


490 
	`gtk_li¡_¡Üe_š£¹_w™h_v®ues
(
pv
->
ty³_mod–
, &
™”
, 
i
, 0, 
s
, -1);

492 
	`gtk_li¡_¡Üe_š£¹
(
pv
->
ty³_mod–
, &
™”
, 
i
);

493 
	`gtk_li¡_¡Üe_£t
(
pv
->
ty³_mod–
, &
™”
, 0, 
s
, -1);

496 
	`­Ş_şass_g‘_by_qu”y
(
pŞicy
, 
NULL
, &
v
);

497 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v
); i++) {

498 
obj_şass
 = 
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

499 
	`qpŞ_şass_g‘_Çme
(
qp
, 
obj_şass
, &
s
);

500 
	`­Ş_veùÜ_­³nd
(
pv
->
şass_li¡
, (*)
s
);

502 
	`­Ş_veùÜ_de¡roy
(&
v
);

503 
	`­Ş_veùÜ_sÜt
(
pv
->
şass_li¡
, 
­Ş_¡r_¡rcmp
, 
NULL
);

504 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
pv
->
şass_li¡
); i++) {

505 
s
 = 
	`­Ş_veùÜ_g‘_–em’t
(
pv
->
şass_li¡
, 
i
);

506 #ifdeà
GTK_2_8


507 
	`gtk_li¡_¡Üe_š£¹_w™h_v®ues
(
pv
->
şass_mod–
, &
™”
, 
i
, 0, 
s
, -1);

509 
	`gtk_li¡_¡Üe_š£¹
(
pv
->
şass_mod–
, &
™”
, 
i
);

510 
	`gtk_li¡_¡Üe_£t
(
pv
->
şass_mod–
, &
™”
, 0, 
s
, -1);

514 
	}
}

516 
	$pŞicy_v›w_upd©e
(
pŞicy_v›w_t
 * 
pv
, 
­Ş_pŞicy_·th_t
 * 
·th
)

518 
GtkTextI‹r
 
¡¬t
, 
’d
;

519 
	`pŞicy_v›w_lßd_pŞicy_sourû
(
pv
, 
·th
);

520 
	`pŞicy_v›w_pİuÏ‹_combo_boxes
(
pv
);

521 
	`gtk_‹xt_bufãr_g‘_¡¬t_™”
(
pv
->
ruËs_‹xt
, &
¡¬t
);

522 
	`gtk_‹xt_bufãr_g‘_’d_™”
(
pv
->
ruËs_‹xt
, &
’d
);

523 
	`gtk_‹xt_bufãr_d–‘e
(
pv
->
ruËs_‹xt
, &
¡¬t
, &
’d
);

525 
	}
}

527 
	$pŞicy_v›w_fšd_‹ruËs
(
pŞicy_v›w_t
 * 
pv
, 
£aud™_mes§ge_t
 * 
mes§ge
)

529 
£aud™_mes§ge_ty³_e
 
ty³
 = 
SEAUDIT_MESSAGE_TYPE_INVALID
;

530 *
d©a
 = 
NULL
;

531 cÚ¡ *
¡y³
 = "", *
‰y³
 = "", *
obj_şass
 = "";

532 
size_t
 
i
;

533 
	`as£¹
(
pv
->
ty³_li¡
 !ğ
NULL
);

534 
	`as£¹
(
pv
->
şass_li¡
 !ğ
NULL
);

535 ià(
mes§ge
 !ğ
NULL
) {

536 
d©a
 = 
	`£aud™_mes§ge_g‘_d©a
(
mes§ge
, &
ty³
);

538 ià(
ty³
 =ğ
SEAUDIT_MESSAGE_TYPE_AVC
) {

539 
£aud™_avc_mes§ge_t
 *
avc
 = 
d©a
;

540 ià((
¡y³
 = 
	`£aud™_avc_mes§ge_g‘_sourû_ty³
(
avc
)è=ğ
NULL
) {

541 
¡y³
 = "";

543 ià((
‰y³
 = 
	`£aud™_avc_mes§ge_g‘_rg‘_ty³
(
avc
)è=ğ
NULL
) {

544 
‰y³
 = "";

546 ià((
obj_şass
 = 
	`£aud™_avc_mes§ge_g‘_objeù_şass
(
avc
)è=ğ
NULL
) {

547 
obj_şass
 = "";

550 ià(
	`¡rcmp
(
¡y³
, ""è=ğ0 || 
	`­Ş_veùÜ_g‘_šdex
(
pv
->
ty³_li¡
, sty³, 
­Ş_¡r_¡rcmp
, 
NULL
, &
i
) < 0) {

551 
	`gtk_combo_box_£t_aùive
(
	`GTK_COMBO_BOX
(
pv
->
¡y³_combo
), -1);

552 
	`gtk_toggË_bu‰Ú_£t_aùive
(
pv
->
¡y³_check
, 
FALSE
);

554 
	`gtk_combo_box_£t_aùive
(
	`GTK_COMBO_BOX
(
pv
->
¡y³_combo
), 
i
);

555 
	`gtk_toggË_bu‰Ú_£t_aùive
(
pv
->
¡y³_check
, 
TRUE
);

557 ià(
	`¡rcmp
(
‰y³
, ""è=ğ0 || 
	`­Ş_veùÜ_g‘_šdex
(
pv
->
ty³_li¡
,ty³, 
­Ş_¡r_¡rcmp
, 
NULL
, &
i
) < 0) {

558 
	`gtk_combo_box_£t_aùive
(
	`GTK_COMBO_BOX
(
pv
->
‰y³_combo
), -1);

559 
	`gtk_toggË_bu‰Ú_£t_aùive
(
pv
->
‰y³_check
, 
FALSE
);

561 
	`gtk_combo_box_£t_aùive
(
	`GTK_COMBO_BOX
(
pv
->
‰y³_combo
), 
i
);

562 
	`gtk_toggË_bu‰Ú_£t_aùive
(
pv
->
‰y³_check
, 
TRUE
);

564 ià(
	`¡rcmp
(
obj_şass
, ""è=ğ0 || 
	`­Ş_veùÜ_g‘_šdex
(
pv
->
şass_li¡
, obj_şass, 
­Ş_¡r_¡rcmp
, 
NULL
, &
i
) < 0) {

565 
	`gtk_combo_box_£t_aùive
(
	`GTK_COMBO_BOX
(
pv
->
şass_combo
), -1);

566 
	`gtk_toggË_bu‰Ú_£t_aùive
(
pv
->
şass_check
, 
FALSE
);

568 
	`gtk_combo_box_£t_aùive
(
	`GTK_COMBO_BOX
(
pv
->
şass_combo
), 
i
);

569 
	`gtk_toggË_bu‰Ú_£t_aùive
(
pv
->
şass_check
, 
TRUE
);

571 
	`gtk_nÙebook_£t_cu¼’t_·ge
(
pv
->
nÙebook
, 0);

572 
	`gtk_widg‘_show
(
	`GTK_WIDGET
(
pv
->
wšdow
));

573 
	}
}

	@seaudit/policy_view.h

25 #iâdeà
POLICY_VIEW_H


26 
	#POLICY_VIEW_H


	)

28 
	~"tİËv–.h
"

30 
	~<£aud™/mes§ge.h
>

32 
pŞicy_v›w
 
	tpŞicy_v›w_t
;

44 
pŞicy_v›w_t
 *
pŞicy_v›w_ü—‹
(
tİËv–_t
 * 
tİ
);

53 
pŞicy_v›w_de¡roy
(
pŞicy_v›w_t
 ** 
pv
);

63 
pŞicy_v›w_upd©e
(
pŞicy_v›w_t
 * 
pv
, 
­Ş_pŞicy_·th_t
 * 
·th
);

75 
pŞicy_v›w_fšd_‹ruËs
(
pŞicy_v›w_t
 * 
pv
, 
£aud™_mes§ge_t
 * 
mes§ge
);

	@seaudit/preferences.c

26 
	~<cÚfig.h
>

28 
	~"´eã»nûs.h
"

30 
	~<­Ş/ut.h
>

31 
	~<as£¹.h
>

32 
	~<”ºo.h
>

33 
	~<¡dlib.h
>

34 
	~<¡ršg.h
>

37 
	#DEFAULT_LOG_UPDATE_INTERVAL
 1000

	)

40 
	#MAX_RECENT_ENTRIES
 5

	)

43 
	#USER_SEAUDIT_CONF
 ".£aud™"

	)

46 
	#SYSTEM_SEAUDIT_CONF
 "dÙ_£aud™"

	)

48 
	svisibË_f›ld


50 
´eã»nû_f›ld_e
 
	mid
;

51 cÚ¡ *
	mf›ld
;

52 
	mvisibË
;

55 cÚ¡ 
visibË_f›ld
 
	gdeçuÉ_visibË_f›lds
[] = {

56 {
HOST_FIELD
, "host_field", 1},

57 {
MESSAGE_FIELD
, "msg_field", 1},

58 {
DATE_FIELD
, "date_field", 1},

59 {
SUSER_FIELD
, "src_usr_field", 0},

60 {
SROLE_FIELD
, "src_role_field", 0},

61 {
STYPE_FIELD
, "src_type_field", 1},

62 {
SMLS_LVL_FIELD
, "src_mls_lvl_field", 0},

63 {
SMLS_CLR_FIELD
, "src_mls_clr_field", 0},

64 {
TUSER_FIELD
, "tgt_usr_field", 0},

65 {
TROLE_FIELD
, "tgt_role_field", 0},

66 {
TTYPE_FIELD
, "tgt_type_field", 1},

67 {
TMLS_LVL_FIELD
, "tgt_mls_lvl_field", 0},

68 {
TMLS_CLR_FIELD
, "tgt_mls_clr_field", 0},

69 {
OBJCLASS_FIELD
, "obj_class_field", 1},

70 {
PERM_FIELD
, "perm_field", 1},

71 {
EXECUTABLE_FIELD
, "exe_field", 1},

72 {
COMMAND_FIELD
, "comm_field", 1},

73 {
NAME_FIELD
, "name_field", 0},

74 {
PID_FIELD
, "pid_field", 0},

75 {
INODE_FIELD
, "inode_field", 0},

76 {
PATH_FIELD
, "path_field", 0},

77 {
OTHER_FIELD
, "other_field", 1}

80 cÚ¡ 
size_t
 
	gnum_visibË_f›lds
 = (
deçuÉ_visibË_f›lds
) / (default_visible_fields[0]);

82 
	s´eã»nûs


85 *
	mlog
;

87 
­Ş_pŞicy_·th_t
 *
	mpŞicy
;

89 *
	m»pÜt
;

91 *
	m¡yËsh“t
;

93 
­Ş_veùÜ_t
 *
	m»ûÁ_log_fes
;

96 
­Ş_veùÜ_t
 *
	m»ûÁ_pŞicy_fes
;

98 
	m»®_time_log
;

100 
	m»®_time_š‹rv®
;

101 
visibË_f›ld
 *
	mf›lds
;

104 
	$´eã»nûs_­Ş_pŞicy_·th_ä“
(*
–em
)

106 
­Ş_pŞicy_·th_t
 *
·th
 = 
–em
;

107 
	`­Ş_pŞicy_·th_de¡roy
(&
·th
);

108 
	}
}

114 
	$´eã»nûs_·r£_Şd_»ûÁ_fes
(
´eã»nûs_t
 * 
´efs
, cÚ¡ *
s
)

116 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

117 
size_t
 
i
;

118 *
ba£
;

119 
­Ş_pŞicy_·th_t
 *
·th
;

120 
”rÜ
 = 0;

122 ià((
v
 = 
	`­Ş_¡r_¥l™
(
s
, ":")è=ğ
NULL
) {

123 
”rÜ
 = 
”ºo
;

124 
ş—nup
;

126 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v
); i++) {

127 
ba£
 = 
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

128 ià((
·th
 = 
	`­Ş_pŞicy_·th_ü—‹
(
APOL_POLICY_PATH_TYPE_MONOLITHIC
, 
ba£
, 
NULL
)) == NULL ||

129 
	`­Ş_veùÜ_­³nd
(
´efs
->
»ûÁ_pŞicy_fes
, 
·th
) < 0) {

130 
”rÜ
 = 
”ºo
;

131 
	`­Ş_pŞicy_·th_de¡roy
(&
·th
);

132 
ş—nup
;

136 
ş—nup
:

137 
	`­Ş_veùÜ_de¡roy
(&
v
);

138 ià(
”rÜ
 != 0) {

139 
”ºo
 = 
”rÜ
;

143 
	}
}

149 
	$´eã»nûs_·r£_Ãw_»ûÁ_fes
(
´eã»nûs_t
 * 
´efs
, 
FILE
 * 
f
, 
num_fes
)

151 
couÁ
;

152 
couÁ
 = 0; couÁ < 
num_fes
; count++) {

153 *
v¬_Çme
, *
v®ue
 = 
NULL
;

154 
­Ş_pŞicy_·th_t
 *
p
 = 
NULL
;

155 ià(
	`a¥rštf
(&
v¬_Çme
, "RECENT_POLICY_PATH_%d", 
couÁ
) < 0) {

158 
v®ue
 = 
	`­Ş_cÚfig_g‘_v¬
(
v¬_Çme
, 
f
);

159 
	`ä“
(
v¬_Çme
);

160 ià(
v®ue
 =ğ
NULL
 ||

161 (
p
 = 
	`­Ş_pŞicy_·th_ü—‹_äom_¡ršg
(
v®ue
)è=ğ
NULL
 ||

162 
	`­Ş_veùÜ_­³nd
(
´efs
->
»ûÁ_pŞicy_fes
, 
p
) < 0) {

163 
	`ä“
(
v®ue
);

164 
	`­Ş_pŞicy_·th_de¡roy
(&
p
);

167 
	`ä“
(
v®ue
);

170 
	}
}

172 
´eã»nûs_t
 *
	$´eã»nûs_ü—‹
()

174 
´eã»nûs_t
 *
´efs
 = 
NULL
;

175 
FILE
 *
fe
 = 
NULL
;

176 *
·th
 = 
NULL
, *
v®ue
;

177 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

178 
size_t
 
i
, 
j
;

179 
”rÜ
 = 0;

181 ià((
´efs
 = 
	`ÿÎoc
(1, (*´efs))è=ğ
NULL
 ||

182 (
´efs
->
log
 = 
	`¡rdup
("")è=ğ
NULL
 ||

183 (
´efs
->
»pÜt
 = 
	`¡rdup
("")è=ğ
NULL
 ||

184 (
´efs
->
¡yËsh“t
 = 
	`¡rdup
("")è=ğ
NULL
 ||

185 (
´efs
->
»ûÁ_log_fes
 = 
	`­Ş_veùÜ_ü—‹
(
ä“
)è=ğ
NULL
 ||

186 (
´efs
->
»ûÁ_pŞicy_fes
 = 
	`­Ş_veùÜ_ü—‹
(
´eã»nûs_­Ş_pŞicy_·th_ä“
)è=ğ
NULL
 ||

187 (
´efs
->
f›lds
 = 
	`ÿÎoc
(
num_visibË_f›lds
, (
visibË_f›ld
))è=ğ
NULL
) {

188 
”rÜ
 = 
”ºo
;

189 
ş—nup
;

191 
´efs
->
»®_time_š‹rv®
 = 
DEFAULT_LOG_UPDATE_INTERVAL
;

192 
	`memıy
(
´efs
->
f›lds
, 
deçuÉ_visibË_f›lds
, 
num_visibË_f›lds
 * (
visibË_f›ld
));

193 
·th
 = 
	`­Ş_fe_fšd_u£r_cÚfig
(
USER_SEAUDIT_CONF
);

194 ià(!
·th
) {

195 ià((
·th
 = 
	`­Ş_fe_fšd_·th
(
SYSTEM_SEAUDIT_CONF
)è=ğ
NULL
) {

196  
´efs
;

199 ià((
fe
 = 
	`fİ’
(
·th
, "r")è=ğ
NULL
) {

200 
”rÜ
 = 
”ºo
;

201 
ş—nup
;

203 ià((
v®ue
 = 
	`­Ş_cÚfig_g‘_v¬
("DEFAULT_LOG_FILE", 
fe
)è!ğ
NULL
) {

204 
	`ä“
(
´efs
->
log
);

205 
´efs
->
log
 = 
v®ue
;

207 ià((
v®ue
 = 
	`­Ş_cÚfig_g‘_v¬
("DEFAULT_POLICY_FILE", 
fe
)è!ğ
NULL
) {

208 
	`­Ş_pŞicy_·th_de¡roy
(&
´efs
->
pŞicy
);

209 ià(
	`­Ş_pŞicy_·th_ü—‹
(
APOL_POLICY_PATH_TYPE_MONOLITHIC
, 
v®ue
, 
NULL
) == NULL) {

210 
”rÜ
 = 
”ºo
;

211 
	`ä“
(
v®ue
);

212 
ş—nup
;

214 
	`ä“
(
v®ue
);

216 ià((
v®ue
 = 
	`­Ş_cÚfig_g‘_v¬
("DEFAULT_POLICY_PATH", 
fe
)è!ğ
NULL
) {

217 
	`­Ş_pŞicy_·th_de¡roy
(&
´efs
->
pŞicy
);

218 ià((
´efs
->
pŞicy
 = 
	`­Ş_pŞicy_·th_ü—‹_äom_¡ršg
(
v®ue
)è=ğ
NULL
) {

219 
”rÜ
 = 
”ºo
;

220 
	`ä“
(
v®ue
);

221 
ş—nup
;

223 
	`ä“
(
v®ue
);

225 ià((
v®ue
 = 
	`­Ş_cÚfig_g‘_v¬
("DEFAULT_REPORT_CONFIG_FILE", 
fe
)è!ğ
NULL
) {

226 
	`ä“
(
´efs
->
»pÜt
);

227 
´efs
->
»pÜt
 = 
v®ue
;

229 ià((
v®ue
 = 
	`­Ş_cÚfig_g‘_v¬
("DEFAULT_REPORT_CSS_FILE", 
fe
)è!ğ
NULL
) {

230 
	`ä“
(
´efs
->
¡yËsh“t
);

231 
´efs
->
¡yËsh“t
 = 
v®ue
;

233 ià((
v®ue
 = 
	`­Ş_cÚfig_g‘_v¬
("RECENT_LOG_FILES", 
fe
)è=ğ
NULL
 || (
v
 = 
	`­Ş_¡r_¥l™
(value, ":")) == NULL) {

234 
”rÜ
 = 
”ºo
;

235 
	`ä“
(
v®ue
);

236 
ş—nup
;

238 
	`ä“
(
v®ue
);

239 
	`­Ş_veùÜ_de¡roy
(&
´efs
->
»ûÁ_log_fes
);

240 
´efs
->
»ûÁ_log_fes
 = 
v
;

244 ià((
v®ue
 = 
	`­Ş_cÚfig_g‘_v¬
("RECENT_POLICY_PATH_FILES", 
fe
)è!ğ
NULL
) {

245 ià(
	`´eã»nûs_·r£_Ãw_»ûÁ_fes
(
´efs
, 
fe
, 
	`©oi
(
v®ue
)) < 0) {

246 
”rÜ
 = 
”ºo
;

247 
	`ä“
(
v®ue
);

248 
ş—nup
;

252 ià((
v®ue
 = 
	`­Ş_cÚfig_g‘_v¬
("RECENT_POLICY_FILES", 
fe
)è=ğ
NULL


253 || 
	`´eã»nûs_·r£_Şd_»ûÁ_fes
(
´efs
, 
v®ue
) < 0) {

254 
”rÜ
 = 
”ºo
;

255 
	`ä“
(
v®ue
);

256 
ş—nup
;

259 
	`ä“
(
v®ue
);

261 ià((
v®ue
 = 
	`­Ş_cÚfig_g‘_v¬
("LOG_COLUMNS_HIDDEN", 
fe
)è=ğ
NULL
 || (
v
 = 
	`­Ş_¡r_¥l™
(value, ":")) == NULL) {

262 
”rÜ
 = 
”ºo
;

263 
ş—nup
;

265 
j
 = 0; j < 
num_visibË_f›lds
; j++) {

266 
´efs
->
f›lds
[
j
].
visibË
 = 1;

268 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v
); i++) {

269 *
s
 = 
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

270 
j
 = 0; j < 
num_visibË_f›lds
; j++) {

271 ià(
	`¡rcmp
(
s
, 
´efs
->
f›lds
[
j
].
f›ld
) == 0) {

272 
´efs
->
f›lds
[
j
].
visibË
 = 0;

277 
	`ä“
(
v®ue
);

278 
	`­Ş_veùÜ_de¡roy
(&
v
);

279 
v®ue
 = 
	`­Ş_cÚfig_g‘_v¬
("REAL_TIME_LOG_MONITORING", 
fe
);

280 ià(
v®ue
 !ğ
NULL
 && value[0] != '0') {

281 
´efs
->
»®_time_log
 = 1;

283 
	`ä“
(
v®ue
);

284 
v®ue
 = 
	`­Ş_cÚfig_g‘_v¬
("REAL_TIME_LOG_UPDATE_INTERVAL", 
fe
);

285 ià(
v®ue
 !ğ
NULL
) {

286 
´efs
->
»®_time_š‹rv®
 = 
	`©oi
(
v®ue
);

288 
	`ä“
(
v®ue
);

289 
ş—nup
:

290 
	`ä“
(
·th
);

291 ià(
fe
 !ğ
NULL
) {

292 
	`fşo£
(
fe
);

294 ià(
”rÜ
 != 0) {

295 
	`´eã»nûs_de¡roy
(&
´efs
);

296 
”ºo
 = 
”rÜ
;

297  
NULL
;

299  
´efs
;

300 
	}
}

302 
	$´eã»nûs_de¡roy
(
´eã»nûs_t
 ** 
´efs
)

304 ià(
´efs
 !ğ
NULL
 && *prefs != NULL) {

305 
	`ä“
((*
´efs
)->
log
);

306 
	`­Ş_pŞicy_·th_de¡roy
(&(*
´efs
)->
pŞicy
);

307 
	`ä“
((*
´efs
)->
»pÜt
);

308 
	`ä“
((*
´efs
)->
¡yËsh“t
);

309 
	`­Ş_veùÜ_de¡roy
(&(*
´efs
)->
»ûÁ_log_fes
);

310 
	`­Ş_veùÜ_de¡roy
(&(*
´efs
)->
»ûÁ_pŞicy_fes
);

311 
	`ä“
((*
´efs
)->
f›lds
);

312 
	`ä“
(*
´efs
);

313 *
´efs
 = 
NULL
;

315 
	}
}

317 
	$´eã»nûs_wr™e_to_cÚf_fe
(
´eã»nûs_t
 * 
´efs
)

319 
FILE
 *
fe
 = 
NULL
;

320 *
home
, *
cÚf_fe
 = 
NULL
, *
v®ue
;

321 
­Ş_veùÜ_t
 *
hidd’_f›lds
 = 
NULL
;

322 
size_t
 
i
;

323 
»tv®
 = 0, 
”rÜ
 = 0;

326 
home
 = 
	`g‘’v
("HOME");

327 ià(!
home
) {

328 
”rÜ
 = 
EBADRQC
;

329 
ş—nup
;

331 ià(
	`a¥rštf
(&
cÚf_fe
, "%s/%s", 
home
, 
USER_SEAUDIT_CONF
) < 0) {

332 
”rÜ
 = 
”ºo
;

333 
ş—nup
;

336 ià((
fe
 = 
	`fİ’
(
cÚf_fe
, "w")è=ğ
NULL
) {

337 
”rÜ
 = 
”ºo
;

338 
ş—nup
;

341 
	`årštf
(
fe
, "# configuration file for seaudit -‡n‡udit†ogool for Security Enhanced Linux.\n");

342 
	`årštf
(
fe
, "#his file is‡uto-generated\n\n");

344 ià(
	`¡rcmp
(
´efs
->
log
, "") != 0) {

345 
	`årštf
(
fe
, "DEFAULT_LOG_FILE %s\n", 
´efs
->
log
);

347 ià(
´efs
->
pŞicy
 !ğ
NULL
) {

348 
v®ue
 = 
	`­Ş_pŞicy_·th_to_¡ršg
(
´efs
->
pŞicy
);

349 ià(
v®ue
 =ğ
NULL
) {

350 
”rÜ
 = 
”ºo
;

351 
ş—nup
;

353 
	`årštf
(
fe
, "DEFAULT_POLICY_PATH %s\n", 
v®ue
);

354 
	`ä“
(
v®ue
);

356 ià(
	`¡rcmp
(
´efs
->
»pÜt
, "") != 0) {

357 
	`årštf
(
fe
, "DEFAULT_REPORT_CONFIG_FILE %s\n", 
´efs
->
»pÜt
);

359 ià(
	`¡rcmp
(
´efs
->
¡yËsh“t
, "") != 0) {

360 
	`årštf
(
fe
, "DEFAULT_REPORT_CSS_FILE %s\n", 
´efs
->
¡yËsh“t
);

362 ià((
v®ue
 = 
	`­Ş_¡r_još
(
´efs
->
»ûÁ_log_fes
, ":")è=ğ
NULL
) {

363 
”rÜ
 = 
”ºo
;

364 
ş—nup
;

366 
	`årštf
(
fe
, "RECENT_LOG_FILES %s\n", 
v®ue
);

367 
	`ä“
(
v®ue
);

369 
	`årštf
(
fe
, "RECENT_POLICY_PATH_FILES %zd\n", 
	`­Ş_veùÜ_g‘_size
(
´efs
->
»ûÁ_pŞicy_fes
));

370 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
´efs
->
»ûÁ_pŞicy_fes
); i++) {

371 
­Ş_pŞicy_·th_t
 *
p
 = 
	`­Ş_veùÜ_g‘_–em’t
(
´efs
->
»ûÁ_pŞicy_fes
, 
i
);

372 ià((
v®ue
 = 
	`­Ş_pŞicy_·th_to_¡ršg
(
p
)è=ğ
NULL
) {

373 
”rÜ
 = 
”ºo
;

374 
ş—nup
;

376 
	`årštf
(
fe
, "RECENT_POLICY_PATH_%zd %s\n", 
i
, 
v®ue
);

377 
	`ä“
(
v®ue
);

380 ià((
hidd’_f›lds
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)) == NULL) {

381 
”rÜ
 = 
”ºo
;

382 
ş—nup
;

384 
i
 = 0; i < 
num_visibË_f›lds
; i++) {

385 ià(!
´efs
->
f›lds
[
i
].
visibË
 && 
	`­Ş_veùÜ_­³nd
(
hidd’_f›lds
, (*í»fs->f›lds[i].
f›ld
) < 0) {

386 
”rÜ
 = 
”ºo
;

387 
ş—nup
;

390 ià((
v®ue
 = 
	`­Ş_¡r_još
(
hidd’_f›lds
, ":")è=ğ
NULL
) {

391 
”rÜ
 = 
”ºo
;

392 
ş—nup
;

394 
	`årštf
(
fe
, "LOG_COLUMNS_HIDDEN %s\n", 
v®ue
);

395 
	`ä“
(
v®ue
);

396 
	`årštf
(
fe
, "REAL_TIME_LOG_MONITORING %d\n", 
´efs
->
»®_time_log
);

397 
	`årštf
(
fe
, "REAL_TIME_LOG_UPDATE_INTERVAL %d\n", 
´efs
->
»®_time_š‹rv®
);

398 
»tv®
 = 0;

399 
ş—nup
:

400 
	`ä“
(
cÚf_fe
);

401 
	`­Ş_veùÜ_de¡roy
(&
hidd’_f›lds
);

402 ià(
fe
 !ğ
NULL
) {

403 
	`fşo£
(
fe
);

405 
”ºo
 = 
”rÜ
;

406  
»tv®
;

407 
	}
}

409 
	$´eã»nûs_is_cŞumn_visibË
(
´eã»nûs_t
 * 
´efs
, 
´eã»nû_f›ld_e
 
id
)

411 
size_t
 
i
;

412 
i
 = 0; i < 
num_visibË_f›lds
; i++) {

413 ià(
´efs
->
f›lds
[
i
].
id
 == id) {

414  
´efs
->
f›lds
[
i
].
visibË
;

417 
	`as£¹
(0);

419 
	}
}

421 
	$´eã»nûs_£t_cŞumn_visibË
(
´eã»nûs_t
 * 
´efs
, 
´eã»nû_f›ld_e
 
id
, 
visibË
)

423 
size_t
 
i
;

424 
i
 = 0; i < 
num_visibË_f›lds
; i++) {

425 ià(
´efs
->
f›lds
[
i
].
id
 == id) {

426 
´efs
->
f›lds
[
i
].
visibË
 = visible;

430 
	`as£¹
(0);

431 
	}
}

433 
	$´eã»nûs_£t_log
(
´eã»nûs_t
 * 
´efs
, cÚ¡ *
log
)

435 *
s
;

436 ià((
s
 = 
	`¡rdup
(
log
)è=ğ
NULL
) {

439 
	`ä“
(
´efs
->
log
);

440 
´efs
->
log
 = 
s
;

442 
	}
}

444 cÚ¡ *
	$´eã»nûs_g‘_log
(
´eã»nûs_t
 * 
´efs
)

446  
´efs
->
log
;

447 
	}
}

449 
	$´eã»nûs_£t_pŞicy
(
´eã»nûs_t
 * 
´efs
, cÚ¡ 
­Ş_pŞicy_·th_t
 * 
pŞicy
)

451 
­Ş_pŞicy_·th_t
 *
Ãw_pŞicy
;

452 ià((
Ãw_pŞicy
 = 
	`­Ş_pŞicy_·th_ü—‹_äom_pŞicy_·th
(
pŞicy
)è=ğ
NULL
) {

455 
	`­Ş_pŞicy_·th_de¡roy
(&
´efs
->
pŞicy
);

456 
´efs
->
pŞicy
 = 
Ãw_pŞicy
;

458 
	}
}

460 cÚ¡ 
­Ş_pŞicy_·th_t
 *
	$´eã»nûs_g‘_pŞicy
(
´eã»nûs_t
 * 
´efs
)

462  
´efs
->
pŞicy
;

463 
	}
}

465 
	$´eã»nûs_£t_»pÜt
(
´eã»nûs_t
 * 
´efs
, cÚ¡ *
»pÜt
)

467 *
s
;

468 ià((
s
 = 
	`¡rdup
(
»pÜt
)è=ğ
NULL
) {

471 
	`ä“
(
´efs
->
»pÜt
);

472 
´efs
->
»pÜt
 = 
s
;

474 
	}
}

476 cÚ¡ *
	$´eã»nûs_g‘_»pÜt
(
´eã»nûs_t
 * 
´efs
)

478  
´efs
->
»pÜt
;

479 
	}
}

481 
	$´eã»nûs_£t_¡yËsh“t
(
´eã»nûs_t
 * 
´efs
, cÚ¡ *
¡yËsh“t
)

483 *
s
;

484 ià((
s
 = 
	`¡rdup
(
¡yËsh“t
)è=ğ
NULL
) {

487 
	`ä“
(
´efs
->
¡yËsh“t
);

488 
´efs
->
¡yËsh“t
 = 
s
;

490 
	}
}

492 cÚ¡ *
	$´eã»nûs_g‘_¡yËsh“t
(
´eã»nûs_t
 * 
´efs
)

494  
´efs
->
¡yËsh“t
;

495 
	}
}

497 
	$´eã»nûs_£t_»®_time_©_¡¬tup
(
´eã»nûs_t
 * 
´efs
, 
¡¬tup
)

499 
´efs
->
»®_time_log
 = 
¡¬tup
;

500 
	}
}

502 
	$´eã»nûs_g‘_»®_time_©_¡¬tup
(
´eã»nûs_t
 * 
´efs
)

504  
´efs
->
»®_time_log
;

505 
	}
}

507 
	$´eã»nûs_£t_»®_time_š‹rv®
(
´eã»nûs_t
 * 
´efs
, 
š‹rv®
)

509 ià(
š‹rv®
 <= 0) {

510 
´efs
->
»®_time_š‹rv®
 = 0;

512 
´efs
->
»®_time_š‹rv®
 = 
š‹rv®
;

514 
	}
}

516 
	$´eã»nûs_g‘_»®_time_š‹rv®
(
´eã»nûs_t
 * 
´efs
)

518  
´efs
->
»®_time_š‹rv®
;

519 
	}
}

525 
	$´efs_add_»ûÁ_veùÜ
(
­Ş_veùÜ_t
 * 
v
, cÚ¡ *
’Œy
)

527 
size_t
 
i
;

528 *
s
;

529 ià(
	`­Ş_veùÜ_g‘_šdex
(
v
, (*)
’Œy
, 
­Ş_¡r_¡rcmp
, 
NULL
, &
i
) == 0) {

532 ià((
s
 = 
	`¡rdup
(
’Œy
)è=ğ
NULL
 || 
	`­Ş_veùÜ_­³nd
(
v
, s) < 0) {

533 
”rÜ
 = 
”ºo
;

534 
	`ä“
(
s
);

535 
”ºo
 = 
”rÜ
;

538 ià(
	`­Ş_veùÜ_g‘_size
(
v
è>ğ
MAX_RECENT_ENTRIES
) {

539 
s
 = 
	`­Ş_veùÜ_g‘_–em’t
(
v
, 0);

540 
	`ä“
(
s
);

541  
	`­Ş_veùÜ_»move
(
v
, 0);

544 
	}
}

546 
	$´eã»nûs_add_»ûÁ_log
(
´eã»nûs_t
 * 
´efs
, cÚ¡ *
log
)

548  
	`´efs_add_»ûÁ_veùÜ
(
´efs
->
»ûÁ_log_fes
, 
log
);

549 
	}
}

551 
­Ş_veùÜ_t
 *
	$´eã»nûs_g‘_»ûÁ_logs
(
´eã»nûs_t
 * 
´efs
)

553  
´efs
->
»ûÁ_log_fes
;

554 
	}
}

556 
´eã»nûs_pŞicy_·th_com·»
(cÚ¡ *
a
, cÚ¡ *
b
, *
d©a
 
__©Œibu‹__
 ((
unu£d
)))

558  
­Ş_pŞicy_·th_com·»
((cÚ¡ 
­Ş_pŞicy_·th_t
 *)
a
, (cÚ¡‡pŞ_pŞicy_·th_ˆ*)
b
);

561 
	$´eã»nûs_add_»ûÁ_pŞicy
(
´eã»nûs_t
 * 
´efs
, cÚ¡ 
­Ş_pŞicy_·th_t
 * 
pŞicy
)

563 
size_t
 
i
;

564 
­Ş_pŞicy_·th_t
 *
p
 = 
NULL
;

565 ià(
	`­Ş_veùÜ_g‘_šdex
(
´efs
->
»ûÁ_pŞicy_fes
, 
pŞicy
, 
´eã»nûs_pŞicy_·th_com·»
, 
NULL
, &
i
) == 0) {

568 ià((
p
 = 
	`­Ş_pŞicy_·th_ü—‹_äom_pŞicy_·th
(
pŞicy
)è=ğ
NULL
 || 
	`­Ş_veùÜ_­³nd
(
´efs
->
»ûÁ_pŞicy_fes
,…) < 0) {

569 
”rÜ
 = 
”ºo
;

570 
	`­Ş_pŞicy_·th_de¡roy
(&
p
);

571 
”ºo
 = 
”rÜ
;

574 ià(
	`­Ş_veùÜ_g‘_size
(
´efs
->
»ûÁ_pŞicy_fes
è>ğ
MAX_RECENT_ENTRIES
) {

575 
p
 = 
	`­Ş_veùÜ_g‘_–em’t
(
´efs
->
»ûÁ_pŞicy_fes
, 0);

576 
	`­Ş_pŞicy_·th_de¡roy
(&
p
);

577  
	`­Ş_veùÜ_»move
(
´efs
->
»ûÁ_pŞicy_fes
, 0);

580 
	}
}

582 
­Ş_veùÜ_t
 *
	$´eã»nûs_g‘_»ûÁ_pŞic›s
(
´eã»nûs_t
 * 
´efs
)

584  
´efs
->
»ûÁ_pŞicy_fes
;

585 
	}
}

	@seaudit/preferences.h

27 #iâdeà
PREFERENCES_H


28 
	#PREFERENCES_H


	)

30 
	~<­Ş/pŞicy-·th.h
>

31 
	~<­Ş/veùÜ.h
>

33 
´eã»nûs
 
	t´eã»nûs_t
;

37 
	e´eã»nû_f›ld


39 
	mHOST_FIELD
, 
	mMESSAGE_FIELD
, 
	mDATE_FIELD
,

40 
	mSUSER_FIELD
, 
	mSROLE_FIELD
, 
	mSTYPE_FIELD
, 
	mSMLS_LVL_FIELD
, 
	mSMLS_CLR_FIELD
,

41 
	mTUSER_FIELD
, 
	mTROLE_FIELD
, 
	mTTYPE_FIELD
, 
	mTMLS_LVL_FIELD
, 
	mTMLS_CLR_FIELD
,

42 
	mOBJCLASS_FIELD
, 
	mPERM_FIELD
,

43 
	mEXECUTABLE_FIELD
, 
	mCOMMAND_FIELD
, 
	mNAME_FIELD
,

44 
	mPID_FIELD
, 
	mINODE_FIELD
, 
	mPATH_FIELD
, 
	mOTHER_FIELD


45 } 
	t´eã»nû_f›ld_e
;

56 
´eã»nûs_t
 *
´eã»nûs_ü—‹
();

65 
´eã»nûs_de¡roy
(
´eã»nûs_t
 ** 
´efs
);

75 
´eã»nûs_wr™e_to_cÚf_fe
(
´eã»nûs_t
 * 
´efs
);

85 
´eã»nûs_is_cŞumn_visibË
(
´eã»nûs_t
 * 
´efs
, 
´eã»nû_f›ld_e
 
id
);

98 
´eã»nûs_£t_cŞumn_visibË
(
´eã»nûs_t
 * 
´efs
, 
´eã»nû_f›ld_e
 
id
, 
visibË
);

110 
´eã»nûs_£t_log
(
´eã»nûs_t
 * 
´efs
, cÚ¡ *
log
);

121 cÚ¡ *
´eã»nûs_g‘_log
(
´eã»nûs_t
 * 
´efs
);

133 
´eã»nûs_£t_pŞicy
(
´eã»nûs_t
 * 
´efs
, cÚ¡ 
­Ş_pŞicy_·th_t
 * 
pŞicy
);

144 cÚ¡ 
­Ş_pŞicy_·th_t
 *
´eã»nûs_g‘_pŞicy
(
´eã»nûs_t
 * 
´efs
);

154 
´eã»nûs_£t_»pÜt
(
´eã»nûs_t
 * 
´efs
, cÚ¡ *
»pÜt
);

164 cÚ¡ *
´eã»nûs_g‘_»pÜt
(
´eã»nûs_t
 * 
´efs
);

175 
´eã»nûs_£t_¡yËsh“t
(
´eã»nûs_t
 * 
´efs
, cÚ¡ *
¡yËsh“t
);

185 cÚ¡ *
´eã»nûs_g‘_¡yËsh“t
(
´eã»nûs_t
 * 
´efs
);

195 
´eã»nûs_£t_»®_time_©_¡¬tup
(
´eã»nûs_t
 * 
´efs
, 
¡¬tup
);

204 
´eã»nûs_g‘_»®_time_©_¡¬tup
(
´eã»nûs_t
 * 
´efs
);

213 
´eã»nûs_£t_»®_time_š‹rv®
(
´eã»nûs_t
 * 
´efs
, 
š‹rv®
);

223 
´eã»nûs_g‘_»®_time_š‹rv®
(
´eã»nûs_t
 * 
´efs
);

237 
´eã»nûs_add_»ûÁ_log
(
´eã»nûs_t
 * 
´efs
, cÚ¡ *
log
);

247 
­Ş_veùÜ_t
 *
´eã»nûs_g‘_»ûÁ_logs
(
´eã»nûs_t
 * 
´efs
);

261 
´eã»nûs_add_»ûÁ_pŞicy
(
´eã»nûs_t
 * 
´efs
, cÚ¡ 
­Ş_pŞicy_·th_t
 * 
pŞicy
);

272 
­Ş_veùÜ_t
 *
´eã»nûs_g‘_»ûÁ_pŞic›s
(
´eã»nûs_t
 * 
´efs
);

	@seaudit/preferences_view.c

26 
	~<cÚfig.h
>

28 
	~"İ’_pŞicy_wšdow.h
"

29 
	~"´eã»nûs_v›w.h
"

30 
	~"utgui.h
"

31 
	~<as£¹.h
>

32 
	~<¡ršg.h
>

33 
	~<gÏde/gÏde.h
>

35 
	s´ef_v›w


37 
GÏdeXML
 *
	mxml
;

38 
tİËv–_t
 *
	mtİ
;

39 
´eã»nûs_t
 *
	m´efs
;

40 
GtkDŸlog
 *
	mdŸlog
;

41 cÚ¡ *
	mcu¼’t_log
;

42 cÚ¡ 
­Ş_pŞicy_·th_t
 *
	mcu¼’t_pŞicy
;

43 
­Ş_pŞicy_·th_t
 *
	mpŞicy_·th
;

46 
	s´ef_’Œy


48 cÚ¡ *
	m’Œy_Çme
, *
	mbrow£_Çme
;

49 cÚ¡ *(*
	macûssÜ
è(
	m´eã»nûs_t
 *);

50 (*
	mmodif›r
è(
	m´eã»nûs_t
 *, const *);

51 cÚ¡ *
	mt™Ë
;

53 
´ef_v›w
 *
	mpv
;

56 
´ef_’Œy
 
	g´ef_’Œy_d©a
[] = {

57 {"P»fsV›wLogEÁry", "P»fsV›wLogBrow£Bu‰Ú", 
´eã»nûs_g‘_log
, 
´eã»nûs_£t_log
, "Select Default Log"},

58 {"P»fsV›wCÚfigEÁry", "P»fsV›wCÚfigBrow£Bu‰Ú", 
´eã»nûs_g‘_»pÜt
, 
´eã»nûs_£t_»pÜt
,

60 {"P»fsV›wStyËsh“tEÁry", "P»fsV›wStyËsh“tBrow£Bu‰Ú", 
´eã»nûs_g‘_¡yËsh“t
, 
´eã»nûs_£t_¡yËsh“t
,

63 cÚ¡ 
size_t
 
	gnum_’Œ›s
 = (
´ef_’Œy_d©a
) / (pref_entry_data[0]);

65 
	s´ef_toggË


67 cÚ¡ *
	mwidg‘_Çme
;

68 
´eã»nû_f›ld_e
 
	m´eã»nû_f›ld
;

71 cÚ¡ 
´ef_toggË
 
	g´ef_toggË_m­
[] = {

72 {"Ho¡Check", 
HOST_FIELD
},

73 {"Mes§geCheck", 
MESSAGE_FIELD
},

74 {"D©eCheck", 
DATE_FIELD
},

75 {"SourûU£rCheck", 
SUSER_FIELD
},

76 {"SourûRŞeCheck", 
SROLE_FIELD
},

77 {"SourûTy³Check", 
STYPE_FIELD
},

78 {"SourûMLSLVLCheck", 
SMLS_LVL_FIELD
},

79 {"SourûMLSCLRCheck", 
SMLS_CLR_FIELD
},

80 {"T¬g‘U£rCheck", 
TUSER_FIELD
},

81 {"T¬g‘RŞeCheck", 
TROLE_FIELD
},

82 {"T¬g‘Ty³Check", 
TTYPE_FIELD
},

83 {"T¬g‘MLSLVLCheck", 
TMLS_LVL_FIELD
},

84 {"T¬g‘MLSCLRCheck", 
TMLS_CLR_FIELD
},

85 {"ObjeùCÏssCheck", 
OBJCLASS_FIELD
},

86 {"P”missiÚCheck", 
PERM_FIELD
},

87 {"ExecubËCheck", 
EXECUTABLE_FIELD
},

88 {"CommªdCheck", 
COMMAND_FIELD
},

89 {"NameCheck", 
NAME_FIELD
},

90 {"PIDCheck", 
PID_FIELD
},

91 {"InodeCheck", 
INODE_FIELD
},

92 {"P©hCheck", 
PATH_FIELD
},

93 {"Oth”Check", 
OTHER_FIELD
}

95 cÚ¡ 
size_t
 
	gnum_toggËs
 = (
´ef_toggË_m­
) / (pref_toggle_map[0]);

97 
´eã»nûs_v›w_Ú_brow£_şick
(
GtkWidg‘
 * 
widg‘
 
__©Œibu‹__
 ((
unu£d
)), 
gpoš‹r
 
u£r_d©a
)

99 cÚ¡ 
´ef_’Œy
 *
	g³
 = (cÚ¡ ´ef_’Œy *)
u£r_d©a
;

100 
´ef_v›w
 *
	gpv
 = 
³
->
pv
;

101 
GtkEÁry
 *
	g’Œy
 = 
GTK_ENTRY
(
gÏde_xml_g‘_widg‘
(
pv
->
xml
, 
³
->
’Œy_Çme
));

102 cÚ¡ *
	gcu¼’t_·th
 = 
gtk_’Œy_g‘_‹xt
(
’Œy
);

103 
GtkWšdow
 *
	g·»Á
 = 
GTK_WINDOW
(
pv
->
dŸlog
);

104 cÚ¡ *
	gt™Ë
 = 
³
->
t™Ë
;

105 
­Ş_veùÜ_t
 *
	gÃw_·ths
 = 
ut_İ’_fe
(
·»Á
, 
t™Ë
, 
cu¼’t_·th
, 0);

106 ià(
	gÃw_·ths
 !ğ
NULL
) {

107 
gtk_’Œy_£t_‹xt
(
’Œy
, 
­Ş_veùÜ_g‘_–em’t
(
Ãw_·ths
, 0));

108 
­Ş_veùÜ_de¡roy
(&
Ãw_·ths
);

112 
´eã»nûs_v›w_Ú_log_cu¼’t_şick
(
GtkWidg‘
 * 
widg‘
 
__©Œibu‹__
 ((
unu£d
)), 
gpoš‹r
 
u£r_d©a
)

114 
´ef_v›w
 *
	gpv
 = (´ef_v›w *)
u£r_d©a
;

115 
GtkEÁry
 *
	g’Œy
 = 
GTK_ENTRY
(
gÏde_xml_g‘_widg‘
(
pv
->
xml
, "PrefsViewLogEntry"));

116 
as£¹
(
’Œy
 !ğ
NULL
);

117 ià(
	gpv
->
	gcu¼’t_log
 =ğ
NULL
) {

118 
gtk_’Œy_£t_‹xt
(
’Œy
, "");

120 
gtk_’Œy_£t_‹xt
(
’Œy
, 
pv
->
cu¼’t_log
);

124 
´eã»nûs_v›w_Ú_pŞicy_brow£_şick
(
GtkWidg‘
 * 
widg‘
 
__©Œibu‹__
 ((
unu£d
)), 
gpoš‹r
 
u£r_d©a
)

126 
´ef_v›w
 *
	gpv
 = (´ef_v›w *)
u£r_d©a
;

127 
GtkEÁry
 *
	g’Œy
 = 
GTK_ENTRY
(
gÏde_xml_g‘_widg‘
(
pv
->
xml
, "PrefsViewPolicyEntry"));

128 
as£¹
(
’Œy
 !ğ
NULL
);

129 
­Ş_pŞicy_·th_t
 *
	gÃw_·th
;

131 
İ’_pŞicy_wšdow_run
(
pv
->
tİ
,…v->
pŞicy_·th
, &
Ãw_·th
);

132 ià(
	gÃw_·th
 !ğ
NULL
) {

133 
­Ş_pŞicy_·th_de¡roy
(&
pv
->
pŞicy_·th
);

134 
	gpv
->
	gpŞicy_·th
 = 
Ãw_·th
;

135 *
	g·th_¡ršg
 = 
ut_pŞicy_·th_to_¡ršg
(
pv
->
pŞicy_·th
);

136 
gtk_’Œy_£t_‹xt
(
’Œy
, 
·th_¡ršg
);

137 
ä“
(
·th_¡ršg
);

141 
´eã»nûs_v›w_Ú_pŞicy_cu¼’t_şick
(
GtkWidg‘
 * 
widg‘
 
__©Œibu‹__
 ((
unu£d
)), 
gpoš‹r
 
u£r_d©a
)

143 
´ef_v›w
 *
	gpv
 = (´ef_v›w *)
u£r_d©a
;

144 
GtkEÁry
 *
	g’Œy
 = 
GTK_ENTRY
(
gÏde_xml_g‘_widg‘
(
pv
->
xml
, "PrefsViewPolicyEntry"));

145 
as£¹
(
’Œy
 !ğ
NULL
);

146 
­Ş_pŞicy_·th_de¡roy
(&
pv
->
pŞicy_·th
);

147 ià(
	gpv
->
	gcu¼’t_pŞicy
 !ğ
NULL
) {

148 
pv
->
pŞicy_·th
 = 
­Ş_pŞicy_·th_ü—‹_äom_pŞicy_·th
Õv->
cu¼’t_pŞicy
);

149 *
	g·th_¡ršg
 = 
ut_pŞicy_·th_to_¡ršg
(
pv
->
pŞicy_·th
);

150 
gtk_’Œy_£t_‹xt
(
’Œy
, 
·th_¡ršg
);

151 
ä“
(
·th_¡ršg
);

153 
gtk_’Œy_£t_‹xt
(
’Œy
, "");

157 
	$´eã»nûs_v›w_š™_widg‘s
(
´ef_v›w
 *
pv
)

159 
GtkWidg‘
 *
w
;

160 
size_t
 
i
;

162 
w
 = 
	`gÏde_xml_g‘_widg‘
(
pv
->
xml
, "PreferencesWindow");

163 
	`as£¹
(
w
 !ğ
NULL
);

164 
pv
->
dŸlog
 = 
	`GTK_DIALOG
(
w
);

165 
	`gtk_wšdow_£t_Œªs›Á_fÜ
(
	`GTK_WINDOW
(
pv
->
dŸlog
), 
	`tİËv–_g‘_wšdow
Õv->
tİ
));

167 
i
 = 0; i < 
num_’Œ›s
; i++) {

168 
´ef_’Œy
 *
³
 = 
´ef_’Œy_d©a
 + 
i
;

169 
w
 = 
	`gÏde_xml_g‘_widg‘
(
pv
->
xml
, 
³
->
brow£_Çme
);

170 
	`as£¹
(
w
 !ğ
NULL
);

171 
³
->
pv
 =…v;

172 
	`g_sigÇl_cÚÃù
(
w
, "şicked", 
	`G_CALLBACK
(
´eã»nûs_v›w_Ú_brow£_şick
), 
³
);

175 
w
 = 
	`gÏde_xml_g‘_widg‘
(
pv
->
xml
, "PrefsViewLogCurrentButton");

176 
	`as£¹
(
w
 !ğ
NULL
);

177 ià(
pv
->
cu¼’t_log
 =ğ
NULL
) {

178 
	`gtk_widg‘_£t_£ns™ive
(
w
, 
FALSE
);

180 
	`g_sigÇl_cÚÃù
(
w
, "şicked", 
	`G_CALLBACK
(
´eã»nûs_v›w_Ú_log_cu¼’t_şick
), 
pv
);

182 
w
 = 
	`gÏde_xml_g‘_widg‘
(
pv
->
xml
, "PrefsViewPolicyModifyButton");

183 
	`as£¹
(
w
 !ğ
NULL
);

184 
	`g_sigÇl_cÚÃù
(
w
, "şicked", 
	`G_CALLBACK
(
´eã»nûs_v›w_Ú_pŞicy_brow£_şick
), 
pv
);

185 
w
 = 
	`gÏde_xml_g‘_widg‘
(
pv
->
xml
, "PrefsViewPolicyCurrentButton");

186 
	`as£¹
(
w
 !ğ
NULL
);

187 ià(
pv
->
cu¼’t_pŞicy
 =ğ
NULL
) {

188 
	`gtk_widg‘_£t_£ns™ive
(
w
, 
FALSE
);

190 
	`g_sigÇl_cÚÃù
(
w
, "şicked", 
	`G_CALLBACK
(
´eã»nûs_v›w_Ú_pŞicy_cu¼’t_şick
), 
pv
);

191 
	}
}

196 
	$´eã»nûs_v›w_š™_v®ues
(
´ef_v›w
 *
pv
)

198 
GtkWidg‘
 *
w
;

199 cÚ¡ *
cu¼’t_v®ue
;

200 cÚ¡ 
­Ş_pŞicy_·th_t
 *
cu¼’t_·th
;

201 *
s
;

202 
size_t
 
i
;

204 
i
 = 0; i < 
num_’Œ›s
; i++) {

205 cÚ¡ 
´ef_’Œy
 *
³
 = 
´ef_’Œy_d©a
 + 
i
;

206 
w
 = 
	`gÏde_xml_g‘_widg‘
(
pv
->
xml
, 
³
->
’Œy_Çme
);

207 
	`as£¹
(
w
 !ğ
NULL
);

208 
cu¼’t_v®ue
 = 
³
->
	`acûssÜ
(
pv
->
´efs
);

209 
	`gtk_’Œy_£t_‹xt
(
	`GTK_ENTRY
(
w
), 
cu¼’t_v®ue
);

211 ià((
cu¼’t_·th
 = 
	`´eã»nûs_g‘_pŞicy
(
pv
->
´efs
)è!ğ
NULL
) {

212 
pv
->
pŞicy_·th
 = 
	`­Ş_pŞicy_·th_ü—‹_äom_pŞicy_·th
(
cu¼’t_·th
);

213 
w
 = 
	`gÏde_xml_g‘_widg‘
(
pv
->
xml
, "PrefsViewPolicyEntry");

214 *
·th_¡ršg
 = 
	`ut_pŞicy_·th_to_¡ršg
(
pv
->
pŞicy_·th
);

215 
	`as£¹
(
w
 !ğ
NULL
);

216 
	`gtk_’Œy_£t_‹xt
(
	`GTK_ENTRY
(
w
), 
·th_¡ršg
);

217 
	`ä“
(
·th_¡ršg
);

219 
i
 = 0; i < 
num_toggËs
; i++) {

220 
visibË
;

221 
w
 = 
	`gÏde_xml_g‘_widg‘
(
pv
->
xml
, 
´ef_toggË_m­
[
i
].
widg‘_Çme
);

222 
	`as£¹
(
w
 !ğ
NULL
);

223 
visibË
 = 
	`´eã»nûs_is_cŞumn_visibË
(
pv
->
´efs
, 
´ef_toggË_m­
[
i
].
´eã»nû_f›ld
);

224 ià(
visibË
) {

225 
	`gtk_toggË_bu‰Ú_£t_aùive
(
	`GTK_TOGGLE_BUTTON
(
w
), 
TRUE
);

227 
	`gtk_toggË_bu‰Ú_£t_aùive
(
	`GTK_TOGGLE_BUTTON
(
w
), 
FALSE
);

230 
w
 = 
	`gÏde_xml_g‘_widg‘
(
pv
->
xml
, "PrefsViewIntervalEntry");

231 
	`as£¹
(
w
 !ğ
NULL
);

232 ià(
	`a¥rštf
(&
s
, "%d", 
	`´eã»nûs_g‘_»®_time_š‹rv®
(
pv
->
´efs
)) >= 0) {

233 
	`gtk_’Œy_£t_‹xt
(
	`GTK_ENTRY
(
w
), 
s
);

234 
	`ä“
(
s
);

236 
	`gtk_’Œy_£t_‹xt
(
	`GTK_ENTRY
(
w
), "");

238 
w
 = 
	`gÏde_xml_g‘_widg‘
(
pv
->
xml
, "RealTimeCheck");

239 
	`as£¹
(
w
 !ğ
NULL
);

240 ià(
	`´eã»nûs_g‘_»®_time_©_¡¬tup
(
pv
->
´efs
)) {

241 
	`gtk_toggË_bu‰Ú_£t_aùive
(
	`GTK_TOGGLE_BUTTON
(
w
), 
TRUE
);

243 
	`gtk_toggË_bu‰Ú_£t_aùive
(
	`GTK_TOGGLE_BUTTON
(
w
), 
FALSE
);

245 
	}
}

250 
	$´eã»nûs_v›w_g‘_äom_dŸlog
(
´ef_v›w
 *
pv
)

252 
GtkWidg‘
 *
w
;

253 cÚ¡ 
gch¬
 *
’Œy
;

254 
size_t
 
i
;

256 
i
 = 0; i < 
num_’Œ›s
; i++) {

257 cÚ¡ 
´ef_’Œy
 *
³
 = 
´ef_’Œy_d©a
 + 
i
;

258 
w
 = 
	`gÏde_xml_g‘_widg‘
(
pv
->
xml
, 
³
->
’Œy_Çme
);

259 
’Œy
 = 
	`gtk_’Œy_g‘_‹xt
(
	`GTK_ENTRY
(
w
));

260 
³
->
	`modif›r
(
pv
->
´efs
, 
’Œy
);

262 
	`´eã»nûs_£t_pŞicy
(
pv
->
´efs
,…v->
pŞicy_·th
);

263 
i
 = 0; i < 
num_toggËs
; i++) {

264 
gboŞ—n
 
aùive
;

265 
w
 = 
	`gÏde_xml_g‘_widg‘
(
pv
->
xml
, 
´ef_toggË_m­
[
i
].
widg‘_Çme
);

266 
aùive
 = 
	`gtk_toggË_bu‰Ú_g‘_aùive
(
	`GTK_TOGGLE_BUTTON
(
w
));

267 ià(
aùive
) {

268 
	`´eã»nûs_£t_cŞumn_visibË
(
pv
->
´efs
, 
´ef_toggË_m­
[
i
].
´eã»nû_f›ld
, 1);

270 
	`´eã»nûs_£t_cŞumn_visibË
(
pv
->
´efs
, 
´ef_toggË_m­
[
i
].
´eã»nû_f›ld
, 0);

273 
w
 = 
	`gÏde_xml_g‘_widg‘
(
pv
->
xml
, "PrefsViewIntervalEntry");

274 
’Œy
 = 
	`gtk_’Œy_g‘_‹xt
(
	`GTK_ENTRY
(
w
));

275 ià(
	`¡rcmp
(
’Œy
, "") == 0) {

276 
’Œy
 = "0";

278 
	`´eã»nûs_£t_»®_time_š‹rv®
(
pv
->
´efs
, 
	`©oi
(
’Œy
));

279 
w
 = 
	`gÏde_xml_g‘_widg‘
(
pv
->
xml
, "RealTimeCheck");

280 ià(
	`gtk_toggË_bu‰Ú_g‘_aùive
(
	`GTK_TOGGLE_BUTTON
(
w
))) {

281 
	`´eã»nûs_£t_»®_time_©_¡¬tup
(
pv
->
´efs
, 1);

283 
	`´eã»nûs_£t_»®_time_©_¡¬tup
(
pv
->
´efs
, 0);

285 
	}
}

287 
	$´eã»nûs_v›w_run
(
tİËv–_t
 * 
tİ
, cÚ¡ *
cu¼’t_log
, cÚ¡ 
­Ş_pŞicy_·th_t
 * 
cu¼’t_pŞicy
)

289 
´ef_v›w
 
pv
;

290 
gšt
 
»¥Ú£
;

292 
	`mem£t
(&
pv
, 0, (pv));

293 
pv
.
tİ
 =op;

294 
pv
.
xml
 = 
	`gÏde_xml_Ãw
(
	`tİËv–_g‘_gÏde_xml
(
tİ
), "P»ã»nûsWšdow", 
NULL
);

295 
pv
.
´efs
 = 
	`tİËv–_g‘_´efs
(
tİ
);

296 
pv
.
cu¼’t_log
 = current_log;

297 
pv
.
cu¼’t_pŞicy
 = current_policy;

299 
	`´eã»nûs_v›w_š™_widg‘s
(&
pv
);

300 
	`´eã»nûs_v›w_š™_v®ues
(&
pv
);

302 
»¥Ú£
 = 
	`gtk_dŸlog_run
(
pv
.
dŸlog
);

303 ià(
»¥Ú£
 !ğ
GTK_RESPONSE_OK
) {

304 
	`gtk_widg‘_de¡roy
(
	`GTK_WIDGET
(
pv
.
dŸlog
));

307 
	`´eã»nûs_v›w_g‘_äom_dŸlog
(&
pv
);

308 
	`gtk_widg‘_de¡roy
(
	`GTK_WIDGET
(
pv
.
dŸlog
));

310 
	}
}

	@seaudit/preferences_view.h

25 #iâdeà
PREFERENCES_VIEW_H


26 
	#PREFERENCES_VIEW_H


	)

28 
	~"tİËv–.h
"

29 
	~<gtk/gtk.h
>

42 
´eã»nûs_v›w_run
(
tİËv–_t
 * 
tİ
, cÚ¡ *
cu¼’t_log
, cÚ¡ 
­Ş_pŞicy_·th_t
 * 
cu¼’t_pŞicy
);

	@seaudit/progress.c

26 
	~<cÚfig.h
>

28 
	~"´og»ss.h
"

29 
	~"utgui.h
"

31 
	~<gtk/gtk.h
>

32 
	~<glib.h
>

33 
	~<glib/g´štf.h
>

35 
	s´og»ss


37 
tİËv–_t
 *
	mtİ
;

38 
GtkWidg‘
 *
	m´og»ss
;

39 
GtkWidg‘
 *
	mÏb–1
, *
	mÏb–2
;

40 *
	ms
;

41 
	mdÚe
;

42 
GCÚd
 *
	mcÚd
;

43 
GMu‹x
 *
	mmu‹x
;

46 
´og»ss_t
 *
	$´og»ss_ü—‹
(
tİËv–_t
 * 
tİ
)

48 
´og»ss_t
 *
p
;

49 
GtkWidg‘
 *
vbox
;

51 ià((
p
 = 
	`ÿÎoc
(1, (*p))è=ğ
NULL
) {

52  
NULL
;

54 
p
->
tİ
 =op;

55 
p
->
´og»ss
 = 
	`gtk_wšdow_Ãw
(
GTK_WINDOW_TOPLEVEL
);

56 
	`gtk_wšdow_£t_mod®
(
	`GTK_WINDOW
(
p
->
´og»ss
), 
TRUE
);

57 
	`gtk_wšdow_£t_Œªs›Á_fÜ
(
	`GTK_WINDOW
(
p
->
´og»ss
), 
	`tİËv–_g‘_wšdow
(
tİ
));

58 
	`gtk_wšdow_£t_deçuÉ_size
(
	`GTK_WINDOW
(
p
->
´og»ss
), 300, 100);

59 
vbox
 = 
	`gtk_vbox_Ãw
(
FALSE
, 2);

60 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
p
->
´og»ss
), 
vbox
);

61 
p
->
Ïb–1
 = 
	`gtk_Ïb–_Ãw
(
NULL
);

62 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
vbox
), 
p
->
Ïb–1
);

63 
p
->
Ïb–2
 = 
	`gtk_Ïb–_Ãw
(
NULL
);

64 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
vbox
), 
p
->
Ïb–2
);

65 
	`gtk_widg‘_show
(
p
->
Ïb–1
);

66 
	`gtk_widg‘_show
(
p
->
Ïb–2
);

67 
	`gtk_widg‘_show
(
vbox
);

68 
	`ut_cursÜ_wa™
(
p
->
´og»ss
);

69 
p
->
cÚd
 = 
	`g_cÚd_Ãw
();

70 
p
->
mu‹x
 = 
	`g_mu‹x_Ãw
();

71  
p
;

72 
	}
}

74 
	$´og»ss_de¡roy
(
´og»ss_t
 ** 
´og»ss
)

76 ià(
´og»ss
 !ğ
NULL
 && *progress != NULL) {

77 
	`ä“
((*
´og»ss
)->
s
);

78 
	`g_cÚd_ä“
((*
´og»ss
)->
cÚd
);

79 
	`g_mu‹x_ä“
((*
´og»ss
)->
mu‹x
);

80 
	`ä“
(*
´og»ss
);

81 *
´og»ss
 = 
NULL
;

83 
	}
}

85 
	$´og»ss_show
(
´og»ss_t
 * 
´og»ss
, cÚ¡ *
t™Ë
)

87 
	`gtk_Ïb–_£t_‹xt
(
	`GTK_LABEL
(
´og»ss
->
Ïb–1
), 
t™Ë
);

88 
	`gtk_Ïb–_£t_‹xt
(
	`GTK_LABEL
(
´og»ss
->
Ïb–2
), "");

89 
	`gtk_widg‘_show
(
´og»ss
->progress);

90 
	`gtk_wšdow_deicÚify
(
	`GTK_WINDOW
(
´og»ss
->progress));

91 
	`gtk_wšdow_£t_t™Ë
(
	`GTK_WINDOW
(
´og»ss
->´og»ss), 
t™Ë
);

92 
´og»ss
->
dÚe
 = 0;

93 
	}
}

95 
	$´og»ss_hide
(
´og»ss_t
 * 
´og»ss
)

97 
	`gtk_widg‘_hide
(
´og»ss
->progress);

98 
	}
}

100 
	$´og»ss_wa™
(
´og»ss_t
 * 
´og»ss
)

102 
gšt64
 
’d_time
;

103 
	`g_mu‹x_lock
(
´og»ss
->
mu‹x
);

104 !
´og»ss
->
dÚe
) {

105 
’d_time
 = 
	`g_g‘_mÚÙÚic_time
 () + 50000;

106 
	`g_cÚd_wa™_uÁ
(
´og»ss
->
cÚd
,…rog»ss->
mu‹x
, 
’d_time
);

107 ià(
´og»ss
->
s
 !ğ
NULL
) {

108 
	`gtk_Ïb–_£t_‹xt
(
	`GTK_LABEL
(
´og»ss
->
Ïb–2
),…rog»ss->
s
);

109 
	`ä“
(
´og»ss
->
s
);

110 
´og»ss
->
s
 = 
NULL
;

112 
	`gtk_ev’ts_³ndšg
())

113 
	`gtk_maš_™”©iÚ
();

115 
	`g_mu‹x_uÆock
(
´og»ss
->
mu‹x
);

116 ià(
´og»ss
->
dÚe
 < 0) {

117 
	`tİËv–_ERR
(
´og»ss
->
tİ
, 
	`GTK_LABEL
Õrog»ss->
Ïb–2
)->
Ïb–
);

118  
´og»ss
->
dÚe
;

119 } ià(
´og»ss
->
dÚe
 > 1) {

120 
	`tİËv–_WARN
(
´og»ss
->
tİ
, 
	`GTK_LABEL
Õrog»ss->
Ïb–2
)->
Ïb–
);

121  
´og»ss
->
dÚe
 - 1;

123 
´og»ss
->
dÚe
 = 0;

126 
	}
}

128 
	$´og»ss_dÚe
(
´og»ss_t
 * 
´og»ss
)

130 
	`g_mu‹x_lock
(
´og»ss
->
mu‹x
);

131 
´og»ss
->
dÚe
 = 1;

132 
	`g_cÚd_sigÇl
(
´og»ss
->
cÚd
);

133 
	`g_mu‹x_uÆock
(
´og»ss
->
mu‹x
);

134 
	}
}

136 
	$´og»ss_w¬n
(
´og»ss_t
 * 
´og»ss
, *
»asÚ
, ...)

138 
gch¬
 *
s
;

139 
va_li¡
 
­
;

140 
	`g_mu‹x_lock
(
´og»ss
->
mu‹x
);

141 ià(
»asÚ
 !ğ
NULL
) {

142 
	`va_¡¬t
(
­
, 
»asÚ
);

143 
	`g_va¥rštf
(&
s
, 
»asÚ
, 
­
);

144 
	`ä“
(
´og»ss
->
s
);

145 
´og»ss
->
s
 = s;

146 
	`va_’d
(
­
);

148 
´og»ss
->
dÚe
 = 2;

149 
	`g_cÚd_sigÇl
(
´og»ss
->
cÚd
);

150 
	`g_mu‹x_uÆock
(
´og»ss
->
mu‹x
);

151 
	}
}

153 
	$´og»ss_abÜt
(
´og»ss_t
 * 
´og»ss
, *
»asÚ
, ...)

155 
gch¬
 *
s
;

156 
va_li¡
 
­
;

157 
	`g_mu‹x_lock
(
´og»ss
->
mu‹x
);

158 ià(
»asÚ
 !ğ
NULL
) {

159 
	`va_¡¬t
(
­
, 
»asÚ
);

160 
	`g_va¥rštf
(&
s
, 
»asÚ
, 
­
);

161 
	`ä“
(
´og»ss
->
s
);

162 
´og»ss
->
s
 = s;

163 
	`va_’d
(
­
);

165 
´og»ss
->
dÚe
 = -1;

166 
	`g_cÚd_sigÇl
(
´og»ss
->
cÚd
);

167 
	`g_mu‹x_uÆock
(
´og»ss
->
mu‹x
);

168 
	}
}

170 
	$´og»ss_upd©e_Ïb–
(
´og»ss_t
 * 
´og»ss
, cÚ¡ *
fmt
, 
va_li¡
 
va_¬gs
)

172 
gch¬
 *
s
 = 
NULL
;

173 
	`g_va¥rštf
(&
s
, 
fmt
, 
va_¬gs
);

174 
	`g_mu‹x_lock
(
´og»ss
->
mu‹x
);

175 
	`ä“
(
´og»ss
->
s
);

176 
´og»ss
->
s
 = s;

177 
	`g_cÚd_sigÇl
(
´og»ss
->
cÚd
);

178 
	`g_mu‹x_uÆock
(
´og»ss
->
mu‹x
);

179 
	}
}

181 
	$´og»ss_upd©e
(
´og»ss_t
 * 
´og»ss
, *
fmt
, ...)

183 
va_li¡
 
­
;

184 
	`va_¡¬t
(
­
, 
fmt
);

185 
	`´og»ss_upd©e_Ïb–
(
´og»ss
, 
fmt
, 
­
);

186 
	`va_’d
(
­
);

187 
	}
}

189 
´og»ss_£aud™_hªdË_func
(*
¬g
, cÚ¡ 
£aud™_log_t
 * 
log
 
__©Œibu‹__
 ((
unu£d
)), 
Ëv–


190 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ *
fmt
, 
va_li¡
 
va_¬gs
)

192 
´og»ss_t
 *
	g´og»ss
 = 
¬g
;

193 
´og»ss_upd©e_Ïb–
(
´og»ss
, 
fmt
, 
va_¬gs
);

196 
´og»ss_­Ş_hªdË_func
(*
v¬g
, cÚ¡ 
­Ş_pŞicy_t
 * 
p
 
__©Œibu‹__
 ((
unu£d
)), 
Ëv–


197 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ *
fmt
, 
va_li¡
 
¬gp
)

199 
´og»ss_t
 *
	g´og»ss
 = 
v¬g
;

200 
´og»ss_upd©e_Ïb–
(
´og»ss
, 
fmt
, 
¬gp
);

	@seaudit/progress.h

24 #iâdeà
PROGRESS_H


25 
	#PROGRESS_H


	)

27 
´og»ss
 
	t´og»ss_t
;

29 
	~"tİËv–.h
"

31 
	~<­Ş/pŞicy.h
>

32 
	~<£aud™/log.h
>

42 
´og»ss_t
 *
´og»ss_ü—‹
(
tİËv–_t
 * 
tİ
);

51 
´og»ss_de¡roy
(
´og»ss_t
 ** 
´og»ss
);

59 
´og»ss_show
(
´og»ss_t
 * 
´og»ss
, cÚ¡ *
t™Ë
);

67 
´og»ss_hide
(
´og»ss_t
 * 
´og»ss
);

82 
´og»ss_wa™
(
´og»ss_t
 * 
´og»ss
);

91 
´og»ss_dÚe
(
´og»ss_t
 * 
´og»ss
);

102 
	$´og»ss_w¬n
(
´og»ss_t
 * 
´og»ss
, *
»asÚ
, ...è
	`__©Œibu‹__
 ((
	`fÜm©
(
´štf
, 2, 3)));

113 
	$´og»ss_abÜt
(
´og»ss_t
 * 
´og»ss
, *
»asÚ
, ...è
	`__©Œibu‹__
 ((
	`fÜm©
(
´štf
, 2, 3)));

121 
	$´og»ss_upd©e
(
´og»ss_t
 * 
´og»ss
, *
fmt
, ...è
	`__©Œibu‹__
 ((
	`fÜm©
(
´štf
, 2, 3)));

129 
	`´og»ss_£aud™_hªdË_func
(*
¬g
, cÚ¡ 
£aud™_log_t
 * 
log
, 
Ëv–
, cÚ¡ *
fmt
, 
va_li¡
 
va_¬gs
);

137 
	`´og»ss_­Ş_hªdË_func
(*
v¬g
, cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
Ëv–
, cÚ¡ *
fmt
, 
va_li¡
 
¬gp
);

	@seaudit/report_window.c

25 
	~<cÚfig.h
>

27 
	~"»pÜt_wšdow.h
"

28 
	~"utgui.h
"

29 
	~<as£¹.h
>

30 
	~<”ºo.h
>

31 
	~<¡ršg.h
>

32 
	~<gÏde/gÏde.h
>

33 
	~<£aud™/»pÜt.h
>

35 
	s»pÜt_wšdow


37 
GÏdeXML
 *
	mxml
;

38 
GtkDŸlog
 *
	mdŸlog
;

39 
GtkRadioBu‰Ú
 *
	m®l_mes§ges_¿dio
, *
	m‹xt_¿dio
;

40 
GtkToggËBu‰Ú
 *
	mm®fÜmed_toggË
, *
	mu£_¡yËsh“t_toggË
;

41 
GtkWidg‘
 *
	m¡yËsh“t_Ïb–
, *
	m¡yËsh“t_brow£
, *
	mcÚfig_brow£
;

42 
GtkEÁry
 *
	m¡yËsh“t_’Œy
, *
	mcÚfig_’Œy
;

43 *
	mf’ame
;

44 
mes§ge_v›w_t
 *
	mcu¼’t_v›w
;

45 
£aud™_log_t
 *
	mlog
;

46 
	m»suÉ
;

47 
´og»ss_t
 *
	m´og»ss
;

50 
	$»pÜt_wšdow_Ú_®l_mes§ges_toggË
(
GtkToggËBu‰Ú
 * 
toggË
, 
gpoš‹r
 
u£r_d©a
)

52 
gboŞ—n
 
£ns
 = 
	`gtk_toggË_bu‰Ú_g‘_aùive
(
toggË
);

53 
»pÜt_wšdow
 *
rw
 = (»pÜt_wšdow *)
u£r_d©a
;

54 
	`gtk_widg‘_£t_£ns™ive
(
	`GTK_WIDGET
(
rw
->
m®fÜmed_toggË
), 
£ns
);

55 
	}
}

57 
	$»pÜt_wšdow_Ú_u£_¡yËsh“t_toggË
(
GtkToggËBu‰Ú
 * 
toggË
, 
gpoš‹r
 
u£r_d©a
)

59 
gboŞ—n
 
£ns
 = 
	`gtk_toggË_bu‰Ú_g‘_aùive
(
toggË
);

60 
»pÜt_wšdow
 *
rw
 = (»pÜt_wšdow *)
u£r_d©a
;

61 
	`gtk_widg‘_£t_£ns™ive
(
rw
->
¡yËsh“t_Ïb–
, 
£ns
);

62 
	`gtk_widg‘_£t_£ns™ive
(
	`GTK_WIDGET
(
rw
->
¡yËsh“t_’Œy
), 
£ns
);

63 
	`gtk_widg‘_£t_£ns™ive
(
rw
->
¡yËsh“t_brow£
, 
£ns
);

64 
	}
}

66 
	$»pÜt_wšdow_Ú_ouut_fÜm©_toggË
(
GtkToggËBu‰Ú
 * 
toggË
, 
gpoš‹r
 
u£r_d©a
)

68 
gboŞ—n
 
£ns
 = 
	`gtk_toggË_bu‰Ú_g‘_aùive
(
toggË
);

69 
»pÜt_wšdow
 *
rw
 = (»pÜt_wšdow *)
u£r_d©a
;

70 
	`gtk_widg‘_£t_£ns™ive
(
	`GTK_WIDGET
(
rw
->
u£_¡yËsh“t_toggË
), !
£ns
);

71 ià(
£ns
 =ğ
TRUE
) {

72 
	`gtk_widg‘_£t_£ns™ive
(
rw
->
¡yËsh“t_Ïb–
, 
FALSE
);

73 
	`gtk_widg‘_£t_£ns™ive
(
	`GTK_WIDGET
(
rw
->
¡yËsh“t_’Œy
), 
FALSE
);

74 
	`gtk_widg‘_£t_£ns™ive
(
rw
->
¡yËsh“t_brow£
, 
FALSE
);

76 
	`»pÜt_wšdow_Ú_u£_¡yËsh“t_toggË
(
rw
->
u£_¡yËsh“t_toggË
,„w);

78 
	}
}

80 
	$»pÜt_wšdow_brow£
(
GtkEÁry
 * 
’Œy
, 
GtkWšdow
 * 
·»Á
, cÚ¡ *
t™Ë
)

82 cÚ¡ *
cu¼’t_·th
 = 
	`gtk_’Œy_g‘_‹xt
(
’Œy
);

83 
­Ş_veùÜ_t
 *
Ãw_·ths
 = 
	`ut_İ’_fe
(
·»Á
, 
t™Ë
, 
cu¼’t_·th
, 0);

84 ià(
Ãw_·ths
 !ğ
NULL
) {

85 
	`gtk_’Œy_£t_‹xt
(
’Œy
, 
	`­Ş_veùÜ_g‘_–em’t
(
Ãw_·ths
, 0));

86 
	`­Ş_veùÜ_de¡roy
(&
Ãw_·ths
);

88 
	}
}

90 
»pÜt_wšdow_Ú_¡yËsh“t_brow£_şick
(
GtkWidg‘
 * 
widg‘
 
__©Œibu‹__
 ((
unu£d
)), 
gpoš‹r
 
u£r_d©a
)

92 
»pÜt_wšdow
 *
	grw
 = (»pÜt_wšdow *)
u£r_d©a
;

93 
»pÜt_wšdow_brow£
(
rw
->
¡yËsh“t_’Œy
, 
GTK_WINDOW
Ôw->
dŸlog
), "Select Style Sheet");

96 
»pÜt_wšdow_Ú_cÚfig_brow£_şick
(
GtkWidg‘
 * 
widg‘
 
__©Œibu‹__
 ((
unu£d
)), 
gpoš‹r
 
u£r_d©a
)

98 
»pÜt_wšdow
 *
	grw
 = (»pÜt_wšdow *)
u£r_d©a
;

99 
»pÜt_wšdow_brow£
(
rw
->
cÚfig_’Œy
, 
GTK_WINDOW
Ôw->
dŸlog
), "Select Report Configuration");

105 
	$»pÜt_wšdow_š™_dŸlog
(
»pÜt_wšdow
 *
rw
, 
tİËv–_t
 * 
tİ
)

107 
rw
->
dŸlog
 = 
	`GTK_DIALOG
(
	`gÏde_xml_g‘_widg‘
Ôw->
xml
, "ReportWindow"));

108 
	`as£¹
(
rw
->
dŸlog
 !ğ
NULL
);

109 
	`gtk_wšdow_£t_Œªs›Á_fÜ
(
	`GTK_WINDOW
(
rw
->
dŸlog
), 
	`tİËv–_g‘_wšdow
(
tİ
));

111 
rw
->
®l_mes§ges_¿dio
 = 
	`GTK_RADIO_BUTTON
(
	`gÏde_xml_g‘_widg‘
Ôw->
xml
, "ReportWindowAllMessagesRadio"));

112 
rw
->
m®fÜmed_toggË
 = 
	`GTK_TOGGLE_BUTTON
(
	`gÏde_xml_g‘_widg‘
Ôw->
xml
, "ReportWindowMalformedCheck"));

113 
	`as£¹
(
rw
->
®l_mes§ges_¿dio
 !ğ
NULL
 &&„w->
m®fÜmed_toggË
 != NULL);

115 
rw
->
‹xt_¿dio
 = 
	`GTK_RADIO_BUTTON
(
	`gÏde_xml_g‘_widg‘
Ôw->
xml
, "ReportWindowTextRadio"));

116 
rw
->
u£_¡yËsh“t_toggË
 = 
	`GTK_TOGGLE_BUTTON
(
	`gÏde_xml_g‘_widg‘
Ôw->
xml
, "ReportWindowUseStylesheetCheck"));

117 
	`as£¹
(
rw
->
‹xt_¿dio
 !ğ
NULL
 &&„w->
u£_¡yËsh“t_toggË
 != NULL);

119 
rw
->
¡yËsh“t_Ïb–
 = 
	`gÏde_xml_g‘_widg‘
Ôw->
xml
, "ReportWindowStylesheetLabel");

120 
rw
->
¡yËsh“t_’Œy
 = 
	`GTK_ENTRY
(
	`gÏde_xml_g‘_widg‘
Ôw->
xml
, "ReportWindowStylesheetEntry"));

121 
rw
->
¡yËsh“t_brow£
 = 
	`gÏde_xml_g‘_widg‘
Ôw->
xml
, "ReportWindowStylesheetBrowse");

122 
	`as£¹
(
rw
->
¡yËsh“t_Ïb–
 !ğ
NULL
 &&„w->
¡yËsh“t_’Œy
 &&„w->
¡yËsh“t_brow£
);

124 
rw
->
cÚfig_’Œy
 = 
	`GTK_ENTRY
(
	`gÏde_xml_g‘_widg‘
Ôw->
xml
, "ReportWindowConfigEntry"));

125 
rw
->
cÚfig_brow£
 = 
	`gÏde_xml_g‘_widg‘
Ôw->
xml
, "ReportWindowConfigBrowse");

126 
	`as£¹
(
rw
->
cÚfig_’Œy
 !ğ
NULL
 &&„w->
cÚfig_brow£
 != NULL);

129 
	`g_sigÇl_cÚÃù
(
rw
->
®l_mes§ges_¿dio
, "toggËd", 
	`G_CALLBACK
(
»pÜt_wšdow_Ú_®l_mes§ges_toggË
),„w);

130 
	`g_sigÇl_cÚÃù
(
rw
->
‹xt_¿dio
, "toggËd", 
	`G_CALLBACK
(
»pÜt_wšdow_Ú_ouut_fÜm©_toggË
),„w);

131 
	`g_sigÇl_cÚÃù
(
rw
->
u£_¡yËsh“t_toggË
, "toggËd", 
	`G_CALLBACK
(
»pÜt_wšdow_Ú_u£_¡yËsh“t_toggË
),„w);

132 
	`g_sigÇl_cÚÃù
(
rw
->
¡yËsh“t_brow£
, "şicked", 
	`G_CALLBACK
(
»pÜt_wšdow_Ú_¡yËsh“t_brow£_şick
),„w);

133 
	`g_sigÇl_cÚÃù
(
rw
->
cÚfig_brow£
, "şicked", 
	`G_CALLBACK
(
»pÜt_wšdow_Ú_cÚfig_brow£_şick
),„w);

135 
	}
}

142 
	$»pÜt_wšdow_cİy_´efs
(
»pÜt_wšdow
 *
rw
, 
tİËv–_t
 * 
tİ
)

144 
»pÜt_wšdow_š™Ÿlized
 = 0;

145 ià(!
»pÜt_wšdow_š™Ÿlized
) {

146 
´eã»nûs_t
 *
´efs
 = 
	`tİËv–_g‘_´efs
(
tİ
);

147 
	`gtk_’Œy_£t_‹xt
(
rw
->
¡yËsh“t_’Œy
, 
	`´eã»nûs_g‘_¡yËsh“t
(
´efs
));

148 
	`gtk_’Œy_£t_‹xt
(
rw
->
cÚfig_’Œy
, 
	`´eã»nûs_g‘_»pÜt
(
´efs
));

150 
»pÜt_wšdow_š™Ÿlized
 = 1;

151 
	}
}

153 
gpoš‹r
 
	$»pÜt_wšdow_ü—‹_»pÜt_ruÂ”
(
gpoš‹r
 
d©a
)

155 
»pÜt_wšdow
 *
rw
 = (»pÜt_wšdow *)
d©a
;

156 
£aud™_mod–_t
 *
mod–
 = 
NULL
;

157 
£aud™_»pÜt_t
 *
»pÜt
 = 
NULL
;

158 
£aud™_»pÜt_fÜm©_e
 
fÜm©
 = 
SEAUDIT_REPORT_FORMAT_TEXT
;

159 
do_m®fÜmed
 = 0, 
do_¡yËsh“t
 = 0;

160 cÚ¡ *
cÚfig_Çme
 = 
NULL
, *
¡yËsh“t_Çme
 = NULL;

162 
rw
->
»suÉ
 = -1;

163 ià(
	`gtk_toggË_bu‰Ú_g‘_aùive
(
	`GTK_TOGGLE_BUTTON
(
rw
->
®l_mes§ges_¿dio
))) {

164 
mod–
 = 
	`£aud™_mod–_ü—‹
("AÎ Mes§ges", 
rw
->
log
);

165 ià(
	`gtk_toggË_bu‰Ú_g‘_aùive
(
rw
->
m®fÜmed_toggË
)) {

166 
do_m®fÜmed
 = 1;

169 
£aud™_mod–_t
 *
v›w_mod–
 = 
	`mes§ge_v›w_g‘_mod–
(
rw
->
cu¼’t_v›w
);

170 
mod–
 = 
	`£aud™_mod–_ü—‹_äom_mod–
(
v›w_mod–
);

172 ià(
mod–
 =ğ
NULL
) {

173 
	`´og»ss_abÜt
(
rw
->
´og»ss
, "%s", 
	`¡»¼Ü
(
”ºo
));

174 
ş—nup
;

176 ià(!
	`gtk_toggË_bu‰Ú_g‘_aùive
(
	`GTK_TOGGLE_BUTTON
(
rw
->
‹xt_¿dio
))) {

177 
fÜm©
 = 
SEAUDIT_REPORT_FORMAT_HTML
;

179 ià(
	`gtk_toggË_bu‰Ú_g‘_aùive
(
rw
->
u£_¡yËsh“t_toggË
)) {

180 
do_¡yËsh“t
 = 1;

182 
¡yËsh“t_Çme
 = 
	`gtk_’Œy_g‘_‹xt
(
rw
->
¡yËsh“t_’Œy
);

183 ià(
	`¡rcmp
(
¡yËsh“t_Çme
, "") == 0) {

184 
¡yËsh“t_Çme
 = 
NULL
;

186 
cÚfig_Çme
 = 
	`gtk_’Œy_g‘_‹xt
(
rw
->
cÚfig_’Œy
);

187 ià(
	`¡rcmp
(
cÚfig_Çme
, "") == 0) {

188 
cÚfig_Çme
 = 
NULL
;

191 ià((
»pÜt
 = 
	`£aud™_»pÜt_ü—‹
(
mod–
)è=ğ
NULL
) {

192 
	`´og»ss_abÜt
(
rw
->
´og»ss
, "%s", 
	`¡»¼Ü
(
”ºo
));

193 
ş—nup
;

195 ià(
	`£aud™_»pÜt_£t_fÜm©
(
rw
->
log
, 
»pÜt
, 
fÜm©
) < 0 ||

196 
	`£aud™_»pÜt_£t_cÚfigu¿tiÚ
(
rw
->
log
, 
»pÜt
, 
cÚfig_Çme
) < 0 ||

197 
	`£aud™_»pÜt_£t_¡yËsh“t
(
rw
->
log
, 
»pÜt
, 
¡yËsh“t_Çme
, 
do_¡yËsh“t
) < 0 ||

198 
	`£aud™_»pÜt_£t_m®fÜmed
(
rw
->
log
, 
»pÜt
, 
do_m®fÜmed
) < 0) {

199 
ş—nup
;

201 
	`´og»ss_upd©e
(
rw
->
´og»ss
, "Writing");

202 ià(
	`£aud™_»pÜt_wr™e
(
rw
->
log
, 
»pÜt
,„w->
f’ame
) < 0) {

203 
ş—nup
;

205 
rw
->
»suÉ
 = 0;

206 
ş—nup
:

207 
	`£aud™_»pÜt_de¡roy
(&
»pÜt
);

208 
	`£aud™_mod–_de¡roy
(&
mod–
);

209 ià(
rw
->
»suÉ
 == 0) {

210 
	`´og»ss_dÚe
(
rw
->
´og»ss
);

212 
	`´og»ss_abÜt
(
rw
->
´og»ss
, 
NULL
);

214  
NULL
;

215 
	}
}

217 
	$»pÜt_wšdow_run
(
tİËv–_t
 * 
tİ
, 
mes§ge_v›w_t
 * 
v›w
)

219 
»pÜt_wšdow
 
rw
;

221 *
f’ame
 = 
NULL
;

223 
	`mem£t
(&
rw
, 0, (rw));

224 
rw
.
xml
 = 
	`gÏde_xml_Ãw
(
	`tİËv–_g‘_gÏde_xml
(
tİ
), "R•ÜtWšdow", 
NULL
);

225 
	`»pÜt_wšdow_š™_dŸlog
(&
rw
, 
tİ
);

226 
	`»pÜt_wšdow_cİy_´efs
(&
rw
, 
tİ
);

228 
rw
.
cu¼’t_v›w
 = 
v›w
;

229 
rw
.
log
 = 
	`tİËv–_g‘_log
(
tİ
);

230 
rw
.
´og»ss
 = 
	`tİËv–_g‘_´og»ss
(
tİ
);

231 
rw
.
f’ame
 = filename;

233 
gšt
 
»¥Ú£
 = 
	`gtk_dŸlog_run
(
rw
.
dŸlog
);

234 ià(
»¥Ú£
 !ğ
GTK_RESPONSE_OK
) {

237 ià((
f’ame
 = 
	`ut_§ve_fe
(
	`GTK_WINDOW
(
rw
.
dŸlog
), "SavR•ÜˆtØFe",„w.f’ame)è=ğ
NULL
) {

240 
	`g_ä“
(
rw
.
f’ame
);

241 
rw
.
f’ame
 = filename;

242 
	`ut_cursÜ_wa™
(
	`GTK_WIDGET
(
rw
.
dŸlog
));

243 
	`´og»ss_show
(
rw
.
´og»ss
, "Creating Report");

244 
	`g_th»ad_ü—‹
(
»pÜt_wšdow_ü—‹_»pÜt_ruÂ”
, &
rw
, 
FALSE
, 
NULL
);

245 
	`´og»ss_wa™
(
rw
.
´og»ss
);

246 
	`´og»ss_hide
(
rw
.
´og»ss
);

255 ià(
rw
.
»suÉ
 == 0) {

258 
	`ut_cursÜ_ş—r
(
	`GTK_WIDGET
(
rw
.
dŸlog
));

260 
	`gtk_widg‘_de¡roy
(
	`GTK_WIDGET
(
rw
.
dŸlog
));

261 
	}
}

	@seaudit/report_window.h

26 #iâdeà
REPORT_WINDOW_H


27 
	#REPORT_WINDOW_H


	)

29 
	~"tİËv–.h
"

30 
	~"mes§ge_v›w.h
"

39 
»pÜt_wšdow_run
(
tİËv–_t
 * 
tİ
, 
mes§ge_v›w_t
 * 
v›w
);

	@seaudit/seaudit-report.c

32 
	~<cÚfig.h
>

34 
	~<£aud™/log.h
>

35 
	~<£aud™/·r£.h
>

36 
	~<£aud™/»pÜt.h
>

38 
	~<­Ş/veùÜ.h
>

40 
	~<”ºo.h
>

41 
	~<g‘İt.h
>

42 
	~<¡dio.h
>

43 
	~<¡dlib.h
>

44 
	~<¡ršg.h
>

46 
	#COPYRIGHT_INFO
 "Cİyrighˆ(Cè2004-2007 T»sy TechnŞogy, LLC"

	)

48 
	eİts


50 
	mOPT_HTML
 = 256, 
	mOPT_STYLESHEET


53 
İtiÚ
 cÚ¡ 
	glÚgİts
[] = {

54 {"html", 
no_¬gum’t
, 
NULL
, 
OPT_HTML
},

55 {"m®fÜmed", 
no_¬gum’t
, 
NULL
, 'm'},

56 {"ouut", 
»quœed_¬gum’t
, 
NULL
, 'o'},

57 {"¡yËsh“t", 
»quœed_¬gum’t
, 
NULL
, 
OPT_STYLESHEET
},

58 {"¡dš", 
no_¬gum’t
, 
NULL
, 's'},

59 {"cÚfig", 
»quœed_¬gum’t
, 
NULL
, 'c'},

60 {"h–p", 
no_¬gum’t
, 
NULL
, 'h'},

61 {"v”siÚ", 
no_¬gum’t
, 
NULL
, 'V'},

62 {
NULL
, 0, NULL, 0}

69 
­Ş_veùÜ_t
 *
	glogs
 = 
NULL
;

74 
£aud™_log_t
 *
	gfœ¡_log
 = 
NULL
;

79 
£aud™_mod–_t
 *
	gmod–
 = 
NULL
;

84 
£aud™_»pÜt_t
 *
	g»pÜt
 = 
NULL
;

90 *
	goutfe
 = 
NULL
;

92 
	$£aud™_»pÜt_šfo_u§ge
(cÚ¡ *
´og¿m_Çme
, 
br›f
)

94 
	`´štf
("U§ge: % [OPTIONS] LOGFILE ...\n\n", 
´og¿m_Çme
);

95 ià(
br›f
) {

96 
	`´štf
("\tTry % --h–°fÜ mÜh–p.\n\n", 
´og¿m_Çme
);

99 
	`´štf
("Generate‡ customized SELinux†og„eport.\n\n");

100 
	`´štf
(" -s, --stdin„ead†og data from standard input\n");

101 
	`´štf
(" -m, --malformed include malformed†og messages\n");

102 
	`´štf
(" -o FILE, --output=FILE outputo FILE\n");

103 
	`´štf
(" -c FILE, --config=FILE„ead configuration from FILE\n");

104 
	`´štf
(" --html set output formato HTML\n");

105 
	`´štf
(" --stylesheet=FILE HTML style sheet for formatting HTML„eport\n");

106 
	`´štf
(" (ignored if --html is‚ot given)\n");

107 
	`´štf
(" -h, --help…rinthis helpext‡ndƒxit\n");

108 
	`´štf
(" -V, --version…rint version information‡ndƒxit\n");

109 
	`´štf
("\n");

110 
	`´štf
("DeçuÉ styË sh“ˆi © %s.\n", 
APOL_INSTALL_DIR
);

111 
	}
}

113 
	$·r£_commªd_lše_¬gs
(
¬gc
, **
¬gv
)

115 
İtc
, 
i
;

116 
do_m®fÜmed
 = 0, 
do_¡yË
 = 0, 
»ad_¡dš
 = 0;

117 
£aud™_»pÜt_fÜm©_e
 
fÜm©
 = 
SEAUDIT_REPORT_FORMAT_TEXT
;

118 *
cÚfigfe
 = 
NULL
, *
¡yËsh“t
 = NULL;

121 (
İtc
 = 
	`g‘İt_lÚg
(
¬gc
, 
¬gv
, "smo:c:hV", 
lÚgİts
, 
NULL
)) != -1) {

122 
İtc
) {

124 
»ad_¡dš
 = 1;

127 
do_m®fÜmed
 = 1;

130 
outfe
 = 
İrg
;

133 
cÚfigfe
 = 
İrg
;

135 
OPT_HTML
:

136 
fÜm©
 = 
SEAUDIT_REPORT_FORMAT_HTML
;

137 
do_¡yË
 = 1;

139 
OPT_STYLESHEET
:

140 
¡yËsh“t
 = 
İrg
;

141 
do_¡yË
 = 1;

145 
	`£aud™_»pÜt_šfo_u§ge
(
¬gv
[0], 0);

146 
	`ex™
(0);

149 
	`´štf
("£aud™-»pÜˆ%s\n%s\n", 
VERSION
, 
COPYRIGHT_INFO
);

150 
	`ex™
(0);

153 
	`£aud™_»pÜt_šfo_u§ge
(
¬gv
[0], 1);

154 
	`ex™
(-1);

160 ià(
¡yËsh“t
 !ğ
NULL
 && 
fÜm©
 !ğ
SEAUDIT_REPORT_FORMAT_HTML
) {

161 
	`årštf
(
¡d”r
, "Warning: The --html option was‚ot specified.\n");

162 
	`ex™
(-1);

165 ià(!
»ad_¡dš
 && 
İtšd
 >ğ
¬gc
) {

167 
	`£aud™_»pÜt_šfo_u§ge
(
¬gv
[0], 1);

168 
	`ex™
(-1);

171 ià((
mod–
 = 
	`£aud™_mod–_ü—‹
("£aud™-»pÜt", 
NULL
)) == NULL) {

172 
	`ex™
(-1);

174 ià((
fœ¡_log
 = 
	`£aud™_log_ü—‹
(
NULL
, NULL)è=ğNULL || 
	`£aud™_mod–_­³nd_log
(
mod–
, first_log) < 0) {

175 
	`årštf
(
¡d”r
, "ERROR: %s\n", 
	`¡»¼Ü
(
”ºo
));

176 
	`ex™
(-1);

178 ià((
logs
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)è=ğNULL || 
	`­Ş_veùÜ_­³nd
Öogs, 
fœ¡_log
) < 0) {

179 
	`årštf
(
¡d”r
, "ERROR: %s\n", 
	`¡»¼Ü
(
”ºo
));

180 
	`ex™
(-1);

182 ià(
»ad_¡dš
) {

185 ià(
İtšd
 < 
¬gc
) {

186 
	`årštf
(
¡d”r
, "WARNING: %s\n", "Command†ine filename(s) will be ignored. Reading from stdin.");

188 ià(
	`£aud™_log_·r£
(
fœ¡_log
, 
¡dš
) < 0) {

189 
	`ex™
(-1);

193 
FILE
 *
f
;

194 
£aud™_log_t
 *
l
;

195 ià((
f
 = 
	`fİ’
(
¬gv
[
İtšd
], "r")è=ğ
NULL
) {

196 
	`årštf
(
¡d”r
, "ERROR: %s\n", 
	`¡»¼Ü
(
”ºo
));

197 
	`ex™
(-1);

199 ià(
	`£aud™_log_·r£
(
fœ¡_log
, 
f
) < 0) {

200 
	`ex™
(-1);

202 
	`fşo£
(
f
);

203 
i
 = 
İtšd
 + 1; i < 
¬gc
; i++) {

204 ià((
l
 = 
	`£aud™_log_ü—‹
(
NULL
, NULL)è=ğNULL || 
	`£aud™_mod–_­³nd_log
(
mod–
,†) < 0) {

205 
	`ex™
(-1);

207 ià(
	`­Ş_veùÜ_­³nd
(
logs
, 
l
) < 0) {

208 
	`årštf
(
¡d”r
, "ERROR: %s\n", 
	`¡»¼Ü
(
”ºo
));

209 
	`ex™
(-1);

211 ià((
f
 = 
	`fİ’
(
¬gv
[
i
], "r")è=ğ
NULL
) {

212 
	`årštf
(
¡d”r
, "ERROR: %s\n", 
	`¡»¼Ü
(
”ºo
));

213 
	`ex™
(-1);

215 ià(
	`£aud™_log_·r£
(
l
, 
f
) < 0) {

216 
	`ex™
(-1);

218 
	`fşo£
(
f
);

222 ià((
»pÜt
 = 
	`£aud™_»pÜt_ü—‹
(
mod–
)è=ğ
NULL
 ||

223 
	`£aud™_»pÜt_£t_fÜm©
(
fœ¡_log
, 
»pÜt
, 
fÜm©
) < 0 ||

224 
	`£aud™_»pÜt_£t_cÚfigu¿tiÚ
(
fœ¡_log
, 
»pÜt
, 
cÚfigfe
) < 0 ||

225 
	`£aud™_»pÜt_£t_¡yËsh“t
(
fœ¡_log
, 
»pÜt
, 
¡yËsh“t
, 
do_¡yË
) < 0 ||

226 
	`£aud™_»pÜt_£t_m®fÜmed
(
fœ¡_log
, 
»pÜt
, 
do_m®fÜmed
) < 0) {

227 
	`ex™
(-1);

229 
	}
}

231 
	$maš
(
¬gc
, **
¬gv
)

233 
size_t
 
i
;

234 
	`·r£_commªd_lše_¬gs
(
¬gc
, 
¬gv
);

235 ià(
	`£aud™_»pÜt_wr™e
(
fœ¡_log
, 
»pÜt
, 
outfe
) < 0) {

238 
	`£aud™_»pÜt_de¡roy
(&
»pÜt
);

239 
	`£aud™_mod–_de¡roy
(&
mod–
);

240 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
logs
); i++) {

241 
£aud™_log_t
 *
l
 = 
	`­Ş_veùÜ_g‘_–em’t
(
logs
, 
i
);

242 
	`£aud™_log_de¡roy
(&
l
);

244 
	`­Ş_veùÜ_de¡roy
(&
logs
);

246 
	}
}

	@seaudit/seaudit.c

27 
	~<cÚfig.h
>

29 
	~"£aud™.h
"

30 
	~"tİËv–.h
"

32 
	~<­Ş/ut.h
>

33 
	~<£aud™/mod–.h
>

34 
	~<£aud™/·r£.h
>

35 
	~<£aud™/ut.h
>

37 
	~<”ºo.h
>

38 
	~<g‘İt.h
>

39 
	~<¡dlib.h
>

40 
	~<¡ršg.h
>

41 
	~<gÏde/gÏde.h
>

42 
	~<glib.h
>

43 
	~<gtk/gtk.h
>

45 
	s£aud™


47 
´eã»nûs_t
 *
	m´efs
;

48 
­Ş_pŞicy_t
 *
	mpŞicy
;

49 
­Ş_pŞicy_·th_t
 *
	mpŞicy_·th
;

50 
£aud™_log_t
 *
	mlog
;

51 
FILE
 *
	mfe
;

52 *
	mlog_·th
;

53 
size_t
 
	mnum_log_mes§ges
;

54 cÚ¡ 
tm
 *
	mfœ¡
, *
	mÏ¡
;

55 
tİËv–_t
 *
	mtİ
;

58 
İtiÚ
 cÚ¡ 
	gİts
[] = {

59 {"log", 
»quœed_¬gum’t
, 
NULL
, 'l'},

60 {"h–p", 
no_¬gum’t
, 
NULL
, 'h'},

61 {"v”siÚ", 
no_¬gum’t
, 
NULL
, 'V'},

62 {
NULL
, 0, NULL, 0}

65 
´eã»nûs_t
 *
	$£aud™_g‘_´efs
(
£aud™_t
 * 
s
)

67  
s
->
´efs
;

68 
	}
}

70 
	$£aud™_£t_pŞicy
(
£aud™_t
 * 
s
, 
­Ş_pŞicy_t
 * 
pŞicy
, 
­Ş_pŞicy_·th_t
 * 
·th
)

72 ià(
pŞicy
 !ğ
NULL
) {

73 ià(
	`´eã»nûs_add_»ûÁ_pŞicy
(
s
->
´efs
, 
·th
) < 0) {

74 
	`tİËv–_ERR
(
s
->
tİ
, "%s", 
	`¡»¼Ü
(
”ºo
));

75 
	`­Ş_pŞicy_de¡roy
(&
pŞicy
);

78 
	`­Ş_pŞicy_de¡roy
(&
s
->
pŞicy
);

79 
s
->
pŞicy
 =…olicy;

80 ià(
·th
 !ğ
s
->
pŞicy_·th
) {

81 
	`­Ş_pŞicy_·th_de¡roy
(&
s
->
pŞicy_·th
);

83 
s
->
pŞicy_·th
 = 
·th
;

85 
	`­Ş_pŞicy_de¡roy
(&
s
->
pŞicy
);

86 
	`­Ş_pŞicy_·th_de¡roy
(&
s
->
pŞicy_·th
);

88 
	}
}

90 
­Ş_pŞicy_t
 *
	$£aud™_g‘_pŞicy
(
£aud™_t
 * 
s
)

92  
s
->
pŞicy
;

93 
	}
}

95 
­Ş_pŞicy_·th_t
 *
	$£aud™_g‘_pŞicy_·th
(
£aud™_t
 * 
s
)

97  
s
->
pŞicy_·th
;

98 
	}
}

100 
	$£aud™_£t_log
(
£aud™_t
 * 
s
, 
£aud™_log_t
 * 
log
, 
FILE
 * 
f
, cÚ¡ *
f’ame
)

102 ià(
s
->
fe
 !ğ
NULL
) {

103 
	`fşo£
(
s
->
fe
);

104 
s
->
fe
 = 
NULL
;

106 ià(
log
 !ğ
NULL
) {

107 
£aud™_mod–_t
 *
mod–
 = 
NULL
;

108 
­Ş_veùÜ_t
 *
mes§ges
 = 
NULL
;

109 *
t
 = 
NULL
;

110 ià((
mod–
 = 
	`£aud™_mod–_ü—‹
(
NULL
, 
log
)) == NULL ||

111 (
mes§ges
 = 
	`£aud™_mod–_g‘_mes§ges
(
log
, 
mod–
)è=ğ
NULL
 ||

112 (
t
 = 
	`¡rdup
(
f’ame
)è=ğ
NULL
 || 
	`´eã»nûs_add_»ûÁ_log
(
s
->
´efs
, filename) < 0) {

113 
	`tİËv–_ERR
(
s
->
tİ
, "%s", 
	`¡»¼Ü
(
”ºo
));

114 
	`£aud™_log_de¡roy
(&
log
);

115 
	`£aud™_mod–_de¡roy
(&
mod–
);

116 
	`­Ş_veùÜ_de¡roy
(&
mes§ges
);

117 
	`ä“
(
t
);

122 
	`£aud™_log_de¡roy
(&
s
->
log
);

123 
s
->
log
 =†og;

124 
s
->
fe
 = 
f
;

125 
	`ä“
(
s
->
log_·th
);

126 
s
->
log_·th
 = 
t
;

127 
s
->
num_log_mes§ges
 = 
	`­Ş_veùÜ_g‘_size
(
mes§ges
);

128 ià(
s
->
num_log_mes§ges
 == 0) {

129 
s
->
fœ¡
 = s->
Ï¡
 = 
NULL
;

131 
£aud™_mes§ge_t
 *
mes§ge
 = 
	`­Ş_veùÜ_g‘_–em’t
(
mes§ges
, 0);

132 
s
->
fœ¡
 = 
	`£aud™_mes§ge_g‘_time
(
mes§ge
);

133 
mes§ge
 = 
	`­Ş_veùÜ_g‘_–em’t
(
mes§ges
, 
s
->
num_log_mes§ges
 - 1);

134 
s
->
Ï¡
 = 
	`£aud™_mes§ge_g‘_time
(
mes§ge
);

136 
	`£aud™_mod–_de¡roy
(&
mod–
);

137 
	`­Ş_veùÜ_de¡roy
(&
mes§ges
);

139 
	`£aud™_log_de¡roy
(&
s
->
log
);

140 
	`ä“
(
s
->
log_·th
);

141 
s
->
log_·th
 = 
NULL
;

142 
s
->
num_log_mes§ges
 = 0;

143 
s
->
fœ¡
 = s->
Ï¡
 = 
NULL
;

145 
	}
}

147 
	$£aud™_·r£_log
(
£aud™_t
 * 
s
)

149  
	`£aud™_log_·r£
(
s
->
log
, s->
fe
);

150 
	}
}

152 
£aud™_log_t
 *
	$£aud™_g‘_log
(
£aud™_t
 * 
s
)

154  
s
->
log
;

155 
	}
}

157 *
	$£aud™_g‘_log_·th
(
£aud™_t
 * 
s
)

159  
s
->
log_·th
;

160 
	}
}

162 
­Ş_veùÜ_t
 *
	$£aud™_g‘_log_u£rs
(
£aud™_t
 * 
s
)

164 ià(
s
->
log
 =ğ
NULL
) {

165  
NULL
;

167  
	`£aud™_log_g‘_u£rs
(
s
->
log
);

169 
	}
}

171 
­Ş_veùÜ_t
 *
	$£aud™_g‘_log_rŞes
(
£aud™_t
 * 
s
)

173 ià(
s
->
log
 =ğ
NULL
) {

174  
NULL
;

176  
	`£aud™_log_g‘_rŞes
(
s
->
log
);

178 
	}
}

180 
­Ş_veùÜ_t
 *
	$£aud™_g‘_log_ty³s
(
£aud™_t
 * 
s
)

182 ià(
s
->
log
 =ğ
NULL
) {

183  
NULL
;

185  
	`£aud™_log_g‘_ty³s
(
s
->
log
);

187 
	}
}

189 
­Ş_veùÜ_t
 *
	$£aud™_g‘_log_mls_lvl
(
£aud™_t
 * 
s
)

191 ià(
s
->
log
 =ğ
NULL
) {

192  
NULL
;

194  
	`£aud™_log_g‘_mls_lvl
(
s
->
log
);

196 
	}
}

198 
­Ş_veùÜ_t
 *
	$£aud™_g‘_log_mls_şr
(
£aud™_t
 * 
s
)

200 ià(
s
->
log
 =ğ
NULL
) {

201  
NULL
;

203  
	`£aud™_log_g‘_mls_şr
(
s
->
log
);

205 
	}
}

207 
­Ş_veùÜ_t
 *
	$£aud™_g‘_log_şas£s
(
£aud™_t
 * 
s
)

209 ià(
s
->
log
 =ğ
NULL
) {

210  
NULL
;

212  
	`£aud™_log_g‘_şas£s
(
s
->
log
);

214 
	}
}

216 
size_t
 
	$£aud™_g‘_num_log_mes§ges
(
£aud™_t
 * 
s
)

218  
s
->
num_log_mes§ges
;

219 
	}
}

221 cÚ¡ 
tm
 *
	$£aud™_g‘_log_fœ¡
(
£aud™_t
 * 
s
)

223  
s
->
fœ¡
;

224 
	}
}

226 cÚ¡ 
tm
 *
	$£aud™_g‘_log_Ï¡
(
£aud™_t
 * 
s
)

228  
s
->
Ï¡
;

229 
	}
}

231 
£aud™_t
 *
	$£aud™_ü—‹
(
´eã»nûs_t
 * 
´efs
)

233 
£aud™_t
 *
s
 = 
	`ÿÎoc
(1, (*s));

234 ià(
s
 !ğ
NULL
) {

235 
s
->
´efs
 =…refs;

237  
s
;

238 
	}
}

240 
	$£aud™_de¡roy
(
£aud™_t
 ** 
s
)

242 ià(
s
 !ğ
NULL
 && *s != NULL) {

243 
	`­Ş_pŞicy_de¡roy
(&(*
s
)->
pŞicy
);

244 
	`£aud™_log_de¡roy
(&(*
s
)->
log
);

245 ià((*
s
)->
fe
 !ğ
NULL
) {

246 
	`fşo£
((*
s
)->
fe
);

248 
	`´eã»nûs_de¡roy
(&(*
s
)->
´efs
);

249 
	`tİËv–_de¡roy
(&(*
s
)->
tİ
);

250 
	`ä“
((*
s
)->
pŞicy_·th
);

251 
	`ä“
((*
s
)->
log_·th
);

252 
	`ä“
(*
s
);

253 *
s
 = 
NULL
;

255 
	}
}

257 
	$´št_v”siÚ_šfo
()

259 
	`´štf
("£aud™ %s\n%s\n", 
VERSION
, 
COPYRIGHT_INFO
);

260 
	}
}

262 
	$´št_u§ge_šfo
(cÚ¡ *
´og¿m_Çme
, 
br›f
)

264 
	`´štf
("U§ge: % [OPTIONS] [POLICY ...]\n\n", 
´og¿m_Çme
);

265 ià(
br›f
) {

266 
	`´štf
("\tTry % --h–°fÜ mÜh–p.\n\n", 
´og¿m_Çme
);

269 
	`´štf
("Audit Log‡nalysisool for Security Enhanced Linux.\n\n");

270 
	`´štf
(" -l FILE, --log=FILE openhe†og FILE\n");

271 
	`´štf
(" -h, --help…rinthis helpext‡ndƒxit\n");

272 
	`´štf
(" -V, --version…rint version information‡ndƒxit\n\n");

273 
	}
}

275 
	$£aud™_·r£_commªd_lše
(
£aud™_t
 * 
£aud™
, 
¬gc
, **
¬gv
, cÚ¡ **
log
, 
­Ş_pŞicy_·th_t
 ** 
pŞicy
)

277 
İtc
;

278 *
log
 = 
NULL
;

279 *
pŞicy
 = 
NULL
;

280 
­Ş_pŞicy_·th_ty³_e
 
·th_ty³
 = 
APOL_POLICY_PATH_TYPE_MONOLITHIC
;

281 *
´im¬y_·th
 = 
NULL
;

282 
­Ş_veùÜ_t
 *
moduËs
 = 
NULL
;

283 (
İtc
 = 
	`g‘İt_lÚg
(
¬gc
, 
¬gv
, "l:hV", 
İts
, 
NULL
)) != -1) {

284 
İtc
) {

287 *
log
 = 
İrg
;

292 
	`´št_u§ge_šfo
(
¬gv
[0], 0);

293 
	`£aud™_de¡roy
(&
£aud™
);

294 
	`ex™
(
EXIT_SUCCESS
);

298 
	`´št_v”siÚ_šfo
();

299 
	`£aud™_de¡roy
(&
£aud™
);

300 
	`ex™
(
EXIT_SUCCESS
);

305 
	`´št_u§ge_šfo
(
¬gv
[0], 1);

306 
	`£aud™_de¡roy
(&
£aud™
);

307 
	`ex™
(
EXIT_FAILURE
);

311 ià(
İtšd
 < 
¬gc
) {

312 ià((
moduËs
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)) == NULL) {

313 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

314 
	`£aud™_de¡roy
(&
£aud™
);

315 
	`ex™
(
EXIT_FAILURE
);

317 
·th_ty³
 = 
APOL_POLICY_PATH_TYPE_MONOLITHIC
;

318 
´im¬y_·th
 = 
¬gv
[
İtšd
++];

319 
¬gc
 - 
İtšd
) {

320 ià(
	`­Ş_veùÜ_­³nd
(
moduËs
, 
¬gv
[
İtšd
])) {

321 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

322 
	`£aud™_de¡roy
(&
£aud™
);

323 
	`ex™
(
EXIT_FAILURE
);

325 
·th_ty³
 = 
APOL_POLICY_PATH_TYPE_MODULAR
;

326 
İtšd
++;

329 ià(*
log
 =ğ
NULL
) {

330 *
log
 = 
	`´eã»nûs_g‘_log
(
£aud™
->
´efs
);

332 ià(
´im¬y_·th
 !ğ
NULL
 && 
	`¡rcmp
(primary_path, "") != 0) {

333 ià(
	`­Ş_fe_is_pŞicy_·th_li¡
(
´im¬y_·th
)) {

334 ià((*
pŞicy
 = 
	`­Ş_pŞicy_·th_ü—‹_äom_fe
(
´im¬y_·th
)è=ğ
NULL
) {

335 
	`ERR
(
NULL
, "%s", "invalid…olicy†ist");

336 
	`£aud™_de¡roy
(&
£aud™
);

337 
	`ex™
(
EXIT_FAILURE
);

340 ià((*
pŞicy
 = 
	`­Ş_pŞicy_·th_ü—‹
(
·th_ty³
, 
´im¬y_·th
, 
moduËs
)è=ğ
NULL
) {

341 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

342 
	`£aud™_de¡roy
(&
£aud™
);

343 
	`ex™
(
EXIT_FAILURE
);

347 cÚ¡ 
­Ş_pŞicy_·th_t
 *
·th
 = 
	`´eã»nûs_g‘_pŞicy
(
£aud™
->
´efs
);

348 ià(
·th
 !ğ
NULL
 && (*
pŞicy
 = 
	`­Ş_pŞicy_·th_ü—‹_äom_pŞicy_·th
(path)) == NULL) {

349 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

350 
	`£aud™_de¡roy
(&
£aud™
);

351 
	`ex™
(
EXIT_FAILURE
);

354 
	`­Ş_veùÜ_de¡roy
(&
moduËs
);

355 
	}
}

363 
	sd–ay_fe_d©a


365 
tİËv–_t
 *
	mtİ
;

366 cÚ¡ *
	mlog_f’ame
;

367 
­Ş_pŞicy_·th_t
 *
	mpŞicy_·th
;

370 
gboŞ—n
 
	$d–ayed_maš
(
gpoš‹r
 
d©a
)

372 
d–ay_fe_d©a
 *
dfd
 = (d–ay_fe_d©¨*)
d©a
;

373 ià(
dfd
->
log_f’ame
 !ğ
NULL
 && 
	`¡rcmp
(dfd->log_filename, "") != 0) {

374 
	`tİËv–_İ’_log
(
dfd
->
tİ
, dfd->
log_f’ame
);

376 ià(
dfd
->
pŞicy_·th
 !ğ
NULL
) {

377 
	`tİËv–_İ’_pŞicy
(
dfd
->
tİ
, dfd->
pŞicy_·th
);

379  
FALSE
;

380 
	}
}

382 
	$maš
(
¬gc
, **
¬gv
)

384 
´eã»nûs_t
 *
´efs
;

385 
£aud™_t
 *
­p
;

386 cÚ¡ *
log
;

387 
­Ş_pŞicy_·th_t
 *
pŞicy
;

388 
d–ay_fe_d©a
 
fe_d©a
;

390 
	`gtk_š™
(&
¬gc
, &
¬gv
);

391 
	`gÏde_š™
();

392 ià(!
	`g_th»ad_suµÜ‹d
())

393 
	`g_th»ad_š™
(
NULL
);

394 ià((
´efs
 = 
	`´eã»nûs_ü—‹
()è=ğ
NULL
) {

395 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

396 
	`ex™
(
EXIT_FAILURE
);

398 ià((
­p
 = 
	`£aud™_ü—‹
(
´efs
)è=ğ
NULL
) {

399 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

400 
	`ex™
(
EXIT_FAILURE
);

402 
	`£aud™_·r£_commªd_lše
(
­p
, 
¬gc
, 
¬gv
, &
log
, &
pŞicy
);

403 ià((
­p
->
tİ
 = 
	`tİËv–_ü—‹
×µ)è=ğ
NULL
) {

404 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

405 
	`£aud™_de¡roy
(&
­p
);

406 
	`ex™
(
EXIT_FAILURE
);

408 
fe_d©a
.
tİ
 = 
­p
->top;

409 
fe_d©a
.
log_f’ame
 = 
log
;

410 
fe_d©a
.
pŞicy_·th
 = 
pŞicy
;

411 
	`g_idË_add
(&
d–ayed_maš
, &
fe_d©a
);

412 
	`gtk_maš
();

413 ià(
	`´eã»nûs_wr™e_to_cÚf_fe
(
­p
->
´efs
) < 0) {

414 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

416 
	`£aud™_de¡roy
(&
­p
);

417 
	`ex™
(
EXIT_SUCCESS
);

418 
	}
}

	@seaudit/seaudit.h

26 #iâdeà
SEAUDIT_H


27 
	#SEAUDIT_H


	)

29 
	~"´eã»nûs.h
"

30 
	~<­Ş/pŞicy.h
>

31 
	~<­Ş/pŞicy-·th.h
>

32 
	~<£aud™/log.h
>

33 
	~<¡dio.h
>

34 
	~<time.h
>

36 
£aud™
 
	t£aud™_t
;

38 
	#COPYRIGHT_INFO
 "Cİyrighˆ(cè2003-2007 T»sy TechnŞogy, LLC"

	)

47 
´eã»nûs_t
 *
£aud™_g‘_´efs
(
£aud™_t
 * 
s
);

61 
£aud™_£t_pŞicy
(
£aud™_t
 * 
s
, 
­Ş_pŞicy_t
 * 
pŞicy
, 
­Ş_pŞicy_·th_t
 * 
·th
);

71 
­Ş_pŞicy_t
 *
£aud™_g‘_pŞicy
(
£aud™_t
 * 
s
);

82 
­Ş_pŞicy_·th_t
 *
£aud™_g‘_pŞicy_·th
(
£aud™_t
 * 
s
);

96 
£aud™_£t_log
(
£aud™_t
 * 
s
, 
£aud™_log_t
 * 
log
, 
FILE
 * 
f
, cÚ¡ *
f’ame
);

106 
£aud™_·r£_log
(
£aud™_t
 * 
s
);

116 
£aud™_log_t
 *
£aud™_g‘_log
(
£aud™_t
 * 
s
);

126 *
£aud™_g‘_log_·th
(
£aud™_t
 * 
s
);

138 
­Ş_veùÜ_t
 *
£aud™_g‘_log_u£rs
(
£aud™_t
 * 
s
);

150 
­Ş_veùÜ_t
 *
£aud™_g‘_log_rŞes
(
£aud™_t
 * 
s
);

162 
­Ş_veùÜ_t
 *
£aud™_g‘_log_ty³s
(
£aud™_t
 * 
s
);

174 
­Ş_veùÜ_t
 *
£aud™_g‘_log_mls_lvl
(
£aud™_t
 * 
s
);

186 
­Ş_veùÜ_t
 *
£aud™_g‘_log_mls_şr
(
£aud™_t
 * 
s
);

198 
­Ş_veùÜ_t
 *
£aud™_g‘_log_şas£s
(
£aud™_t
 * 
s
);

207 
size_t
 
£aud™_g‘_num_log_mes§ges
(
£aud™_t
 * 
s
);

218 cÚ¡ 
tm
 *
£aud™_g‘_log_fœ¡
(
£aud™_t
 * 
s
);

229 cÚ¡ 
tm
 *
£aud™_g‘_log_Ï¡
(
£aud™_t
 * 
s
);

	@seaudit/toplevel.c

26 
	~<cÚfig.h
>

28 
	~"mes§ge_v›w.h
"

29 
	~"İ’_pŞicy_wšdow.h
"

30 
	~"pŞicy_v›w.h
"

31 
	~"´eã»nûs_v›w.h
"

32 
	~"»pÜt_wšdow.h
"

33 
	~"tİËv–.h
"

34 
	~"utgui.h
"

36 
	~<as£¹.h
>

37 
	~<”ºo.h
>

38 
	~<¡ršg.h
>

39 
	~<­Ş/ut.h
>

40 
	~<gdk-pixbuf/gdk-pixbuf.h
>

41 
	~<gtk/gtk.h
>

42 
	~<gÏde/gÏde.h
>

43 
	~<£aud™/·r£.h
>

45 
	stİËv–


47 
£aud™_t
 *
	ms
;

48 
pŞicy_v›w_t
 *
	mpv
;

49 
´og»ss_t
 *
	m´og»ss
;

51 
­Ş_veùÜ_t
 *
	mv›ws
;

52 
GÏdeXML
 *
	mxml
;

54 *
	mxml_f’ame
;

56 
GtkWšdow
 *
	mw
;

57 
GtkNÙebook
 *
	mnÙebook
;

59 
	mdo_mÚ™Ü_log
;

61 
gušt
 
	mmÚ™Ü_id
;

64 
	mÃxt_mod–_numb”
;

66 *
	mv›w_f’ame
;

77 
gšt
 
	$tİËv–_nÙebook_fšd_v›w
(
tİËv–_t
 * 
tİ
, 
mes§ge_v›w_t
 * 
v›w
)

79 
gšt
 
num_·ges
 = 
	`gtk_nÙebook_g‘_n_·ges
(
tİ
->
nÙebook
);

80 
num_·ges
 >= 1) {

81 
GtkWidg‘
 *
chd
 = 
	`gtk_nÙebook_g‘_Áh_·ge
(
tİ
->
nÙebook
, 
num_·ges
 - 1);

82 
GtkWidg‘
 *
b
 = 
	`gtk_nÙebook_g‘_b_Ïb–
(
tİ
->
nÙebook
, 
chd
);

83 
mes§ge_v›w_t
 *
v
 = 
	`g_objeù_g‘_d©a
(
	`G_OBJECT
(
b
), "view-object");

84 ià(
v
 =ğ
v›w
) {

85  
num_·ges
 - 1;

87 
num_·ges
--;

90 
	}
}

96 
mes§ge_v›w_t
 *
	$tİËv–_g‘_cu¼’t_v›w
(
tİËv–_t
 * 
tİ
)

98 
gšt
 
cu¼’t
 = 
	`gtk_nÙebook_g‘_cu¼’t_·ge
(
tİ
->
nÙebook
);

99 ià(
cu¼’t
 >= 0) {

100 
GtkWidg‘
 *
chd
 = 
	`gtk_nÙebook_g‘_Áh_·ge
(
tİ
->
nÙebook
, 
cu¼’t
);

101 
GtkWidg‘
 *
b
 = 
	`gtk_nÙebook_g‘_b_Ïb–
(
tİ
->
nÙebook
, 
chd
);

102  
	`g_objeù_g‘_d©a
(
	`G_OBJECT
(
b
), "view-object");

104  
NULL
;

105 
	}
}

107 
tİËv–_Ú_nÙebook_sw™ch_·ge
(
GtkNÙebook
 * 
nÙebook
 
__©Œibu‹__
 ((
unu£d
)), 
GtkNÙebookPage
 * 
·ge


108 
__©Œibu‹__
 ((
unu£d
)), 
gušt
 
·g’um
 __©Œibu‹__ ((unu£d)), 
tİËv–_t
 * 
tİ
)

110 
tİËv–_upd©e_£ËùiÚ_m’u_™em
(
tİ
);

111 
tİËv–_upd©e_¡©us_b¬
(
tİ
);

117 
	$tİËv–_Ú_b_şo£
(
GtkBu‰Ú
 * 
bu‰Ú
, 
tİËv–_t
 * 
tİ
)

120 ià(
tİ
->
v›ws
 =ğ
NULL
 || 
	`­Ş_veùÜ_g‘_size
(top->views) <= 1) {

123 
mes§ge_v›w_t
 *
v›w
 = 
	`g_objeù_g‘_d©a
(
	`G_OBJECT
(
bu‰Ú
), "view-object");

124 
gšt
 
idx
 = 
	`tİËv–_nÙebook_fšd_v›w
(
tİ
, 
v›w
);

125 
size_t
 
i
;

126 
	`as£¹
(
idx
 >= 0);

127 
	`gtk_nÙebook_»move_·ge
(
tİ
->
nÙebook
, 
idx
);

128 
	`­Ş_veùÜ_g‘_šdex
(
tİ
->
v›ws
, 
v›w
, 
NULL
, NULL, &
i
);

129 
	`mes§ge_v›w_de¡roy
(&
v›w
);

130 
	`­Ş_veùÜ_»move
(
tİ
->
v›ws
, 
i
);

132 
	}
}

142 
	$tİËv–_add_Ãw_v›w
(
tİËv–_t
 * 
tİ
, 
£aud™_mod–_t
 * 
mod–
, cÚ¡ *
f’ame
)

144 
mes§ge_v›w_t
 *
v›w
;

145 
GtkWidg‘
 *
b
, *
bu‰Ú
, *
Ïb–
, *
image
;

146 
gšt
 
idx
;

147 ià((
v›w
 = 
	`mes§ge_v›w_ü—‹
(
tİ
, 
mod–
, 
f’ame
)è=ğ
NULL
) {

150 ià(
	`­Ş_veùÜ_­³nd
(
tİ
->
v›ws
, 
v›w
) < 0) {

151 
	`tİËv–_ERR
(
tİ
, "%s", 
	`¡»¼Ü
(
”ºo
));

152 
	`mes§ge_v›w_de¡roy
(&
v›w
);

155 
b
 = 
	`gtk_hbox_Ãw
(
FALSE
, 5);

156 
	`g_objeù_£t_d©a
(
	`G_OBJECT
(
b
), "v›w-objeù", 
v›w
);

157 
bu‰Ú
 = 
	`gtk_bu‰Ú_Ãw
();

158 
	`g_objeù_£t_d©a
(
	`G_OBJECT
(
bu‰Ú
), "v›w-objeù", 
v›w
);

159 
image
 = 
	`gtk_image_Ãw_äom_¡ock
(
GTK_STOCK_CLOSE
, 
GTK_ICON_SIZE_MENU
);

160 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
bu‰Ú
), 
image
);

161 
	`gtk_widg‘_£t_size_»que¡
(
image
, 8, 8);

162 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
(
bu‰Ú
), "´es£d", 
	`G_CALLBACK
(
tİËv–_Ú_b_şo£
), 
tİ
);

163 
Ïb–
 = 
	`gtk_Ïb–_Ãw
(
	`£aud™_mod–_g‘_Çme
(
mod–
));

164 
	`g_objeù_£t_d©a
(
	`G_OBJECT
(
b
), "Ïb–", 
Ïb–
);

165 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
b
), 
Ïb–
, 
TRUE
, TRUE, 5);

166 
	`gtk_box_·ck_’d
(
	`GTK_BOX
(
b
), 
bu‰Ú
, 
FALSE
, FALSE, 5);

167 
	`gtk_widg‘_show
(
Ïb–
);

168 
	`gtk_widg‘_show
(
bu‰Ú
);

169 
	`gtk_widg‘_show
(
image
);

170 
idx
 = 
	`gtk_nÙebook_­³nd_·ge
(
tİ
->
nÙebook
, 
	`mes§ge_v›w_g‘_v›w
(
v›w
), 
b
);

171 
	`gtk_nÙebook_£t_cu¼’t_·ge
(
tİ
->
nÙebook
, 
idx
);

172 
	}
}

178 
	$tİËv–_add_Ãw_mod–
(
tİËv–_t
 * 
tİ
)

180 
£aud™_log_t
 *
log
 = 
	`£aud™_g‘_log
(
tİ
->
s
);

181 *
mod–_Çme
 = 
NULL
;

182 
£aud™_mod–_t
 *
mod–
 = 
NULL
;

183 ià(
	`a¥rštf
(&
mod–_Çme
, "UÁ™Ëd %d", 
tİ
->
Ãxt_mod–_numb”
) < 0) {

184 
	`tİËv–_ERR
(
tİ
, "%s", 
	`¡»¼Ü
(
”ºo
));

187 
mod–
 = 
	`£aud™_mod–_ü—‹
(
mod–_Çme
, 
log
);

188 
	`ä“
(
mod–_Çme
);

189 ià(
mod–
 =ğ
NULL
) {

190 
	`tİËv–_ERR
(
tİ
, "%s", 
	`¡»¼Ü
(
”ºo
));

193 
tİ
->
Ãxt_mod–_numb”
++;

194 
	`tİËv–_add_Ãw_v›w
(
tİ
, 
mod–
, 
NULL
);

196 
	}
}

201 
	$tİËv–_Ú_İ’_»ûÁ_log_aùiv©e
(
GtkWidg‘
 * 
widg‘
, 
gpoš‹r
 
u£r_d©a
)

203 
GtkWidg‘
 *
Ïb–
 = 
	`gtk_bš_g‘_chd
(
	`GTK_BIN
(
widg‘
));

204 cÚ¡ *
·th
 = 
	`gtk_Ïb–_g‘_‹xt
(
	`GTK_LABEL
(
Ïb–
));

205 
tİËv–_t
 *
tİ
 = (tİËv–_ˆ*è
u£r_d©a
;

206 
	`tİËv–_İ’_log
(
tİ
, 
·th
);

207 
	}
}

213 
	$tİËv–_£t_»ûÁ_logs_subm’u
(
tİËv–_t
 * 
tİ
)

215 
GtkM’uI‹m
 *
»ûÁ
 = 
	`GTK_MENU_ITEM
(
	`gÏde_xml_g‘_widg‘
(
tİ
->
xml
, "OpenRecentLog"));

216 
­Ş_veùÜ_t
 *
·ths
 = 
	`´eã»nûs_g‘_»ûÁ_logs
(
	`tİËv–_g‘_´efs
(
tİ
));

217 
GtkWidg‘
 *
subm’u
, *
subm’u_™em
;

218 
size_t
 
i
;

220 
	`gtk_m’u_™em_»move_subm’u
(
»ûÁ
);

221 
subm’u
 = 
	`gtk_m’u_Ãw
();

222 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
·ths
); i++) {

223 *
·th
 = (*)
	`­Ş_veùÜ_g‘_–em’t
(
·ths
, 
i
);

224 
subm’u_™em
 = 
	`gtk_m’u_™em_Ãw_w™h_Ïb–
(
·th
);

225 
	`gtk_m’u_sh–l_´•’d
(
	`GTK_MENU_SHELL
(
subm’u
), 
subm’u_™em
);

226 
	`gtk_widg‘_show
(
subm’u_™em
);

227 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
(
subm’u_™em
), "aùiv©e", 
	`G_CALLBACK
(
tİËv–_Ú_İ’_»ûÁ_log_aùiv©e
), 
tİ
);

229 
	`gtk_m’u_™em_£t_subm’u
(
	`GTK_MENU_ITEM
(
»ûÁ
), 
subm’u
);

230 
	}
}

236 
	$tİËv–_Ú_İ’_»ûÁ_pŞicy_aùiv©e
(
GtkM’uI‹m
 * 
m’u™em
, 
gpoš‹r
 
u£r_d©a
)

238 
­Ş_pŞicy_·th_t
 *
·th
 = 
	`g_objeù_g‘_d©a
(
	`G_OBJECT
(
m’u™em
), "path");

239 
tİËv–_t
 *
tİ
 = (tİËv–_ˆ*è
u£r_d©a
;

240 
­Ş_pŞicy_·th_t
 *
dup_·th
 = 
	`­Ş_pŞicy_·th_ü—‹_äom_pŞicy_·th
(
·th
);

241 ià(
dup_·th
 =ğ
NULL
) {

242 
	`tİËv–_ERR
(
tİ
, "%s", 
	`¡»¼Ü
(
”ºo
));

245 
	`tİËv–_İ’_pŞicy
(
tİ
, 
dup_·th
);

246 
	}
}

252 
	$tİËv–_£t_»ûÁ_pŞic›s_subm’u
(
tİËv–_t
 * 
tİ
)

254 
GtkM’uI‹m
 *
»ûÁ
 = 
	`GTK_MENU_ITEM
(
	`gÏde_xml_g‘_widg‘
(
tİ
->
xml
, "OpenRecentPolicy"));

255 
­Ş_veùÜ_t
 *
·ths
 = 
	`´eã»nûs_g‘_»ûÁ_pŞic›s
(
	`tİËv–_g‘_´efs
(
tİ
));

256 
GtkWidg‘
 *
subm’u
, *
subm’u_™em
;

257 
size_t
 
i
;

259 
GtkToŞtsD©a
 *
ts_d©a
 = 
	`gtk_toŞts_d©a_g‘
(
	`GTK_WIDGET
(
»ûÁ
));

260 
	`as£¹
(
ts_d©a
 !ğ
NULL
);

261 
GtkToŞts
 *
toŞts
 = 
ts_d©a
->tooltips;

263 
	`gtk_m’u_™em_»move_subm’u
(
»ûÁ
);

264 
subm’u
 = 
	`gtk_m’u_Ãw
();

265 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
·ths
); i++) {

266 
­Ş_pŞicy_·th_t
 *
·th
 = 
	`­Ş_veùÜ_g‘_–em’t
(
·ths
, 
i
);

267 *
m’u_Ïb–
 = 
NULL
;

268 cÚ¡ *
´im¬y_·th
 = 
	`­Ş_pŞicy_·th_g‘_´im¬y
(
·th
);

269 
GSŒšg
 *
t
 = 
	`g_¡ršg_Ãw
(
NULL
);

270 ià((
m’u_Ïb–
 = 
	`ut_pŞicy_·th_to_¡ršg
(
·th
)è=ğ
NULL
) {

271 
	`tİËv–_ERR
(
tİ
, "%s", 
	`¡»¼Ü
(
”ºo
));

272 
	`g_¡ršg_ä“
(
t
, 
TRUE
);

275 
subm’u_™em
 = 
	`gtk_m’u_™em_Ãw_w™h_Ïb–
(
m’u_Ïb–
);

276 
	`ä“
(
m’u_Ïb–
);

277 ià(
	`­Ş_pŞicy_·th_g‘_ty³
(
·th
è=ğ
APOL_POLICY_PATH_TYPE_MONOLITHIC
) {

278 
	`g_¡ršg_­³nd_´štf
(
t
, "mÚŞ™hiøpŞicy: %s", 
´im¬y_·th
);

280 *
s
 = 
NULL
;

281 cÚ¡ 
­Ş_veùÜ_t
 *
moduËs
 = 
	`­Ş_pŞicy_·th_g‘_moduËs
(
·th
);

282 
size_t
 
num_moduËs
 = 
	`­Ş_veùÜ_g‘_size
(
moduËs
);

283 
	`g_¡ršg_­³nd_´štf
(
t
, "ba£…Şicy: %s", 
´im¬y_·th
);

284 ià(
num_moduËs
 > 0) {

285 ià((
s
 = 
	`­Ş_¡r_još
(
moduËs
, "\À ")è=ğ
NULL
) {

286 
	`tİËv–_ERR
(
tİ
, "%s", 
	`¡»¼Ü
(
”ºo
));

289 
	`g_¡ršg_­³nd_´štf
(
t
, "\À %s", 
s
);

290 
	`ä“
(
s
);

293 
	`gtk_toŞts_£t_t
(
toŞts
, 
	`GTK_WIDGET
(
subm’u_™em
), 
t
->
¡r
, "");

294 
	`g_¡ršg_ä“
(
t
, 
TRUE
);

295 
	`g_objeù_£t_d©a
(
	`G_OBJECT
(
subm’u_™em
), "·th", 
·th
);

296 
	`gtk_m’u_sh–l_´•’d
(
	`GTK_MENU_SHELL
(
subm’u
), 
subm’u_™em
);

297 
	`gtk_widg‘_show
(
subm’u_™em
);

298 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
(
subm’u_™em
), "aùiv©e", 
	`G_CALLBACK
(
tİËv–_Ú_İ’_»ûÁ_pŞicy_aùiv©e
), 
tİ
);

300 
	`gtk_m’u_™em_£t_subm’u
(
	`GTK_MENU_ITEM
(
»ûÁ
), 
subm’u
);

301 
	}
}

310 
	$tİËv–_’abË_log_™ems
(
tİËv–_t
 * 
tİ
, 
gboŞ—n
 
£ns
)

312 cÚ¡ *
™ems
[] = {

317 
NULL


319 
size_t
 
i
;

320 cÚ¡ *
s
;

321 
i
 = 0, 
s
 = 
™ems
[0]; s !ğ
NULL
; s = items[++i]) {

322 
GtkWidg‘
 *
w
 = 
	`gÏde_xml_g‘_widg‘
(
tİ
->
xml
, 
s
);

323 
	`as£¹
(
w
 !ğ
NULL
);

324 
	`gtk_widg‘_£t_£ns™ive
(
w
, 
£ns
);

326 
	}
}

335 
	$tİËv–_’abË_pŞicy_™ems
(
tİËv–_t
 * 
tİ
, 
gboŞ—n
 
£ns
)

337 cÚ¡ *
™ems
[] = {

339 
NULL


341 
size_t
 
i
;

342 cÚ¡ *
s
;

343 
i
 = 0, 
s
 = 
™ems
[0]; s !ğ
NULL
; s = items[++i]) {

344 
GtkWidg‘
 *
w
 = 
	`gÏde_xml_g‘_widg‘
(
tİ
->
xml
, 
s
);

345 
	`as£¹
(
w
 !ğ
NULL
);

346 
	`gtk_widg‘_£t_£ns™ive
(
w
, 
£ns
);

348 
	}
}

356 
	$tİËv–_upd©e_t™Ë_b¬
(
tİËv–_t
 * 
tİ
)

358 *
log_·th
 = 
	`£aud™_g‘_log_·th
(
tİ
->
s
);

359 
­Ş_pŞicy_·th_t
 *
pŞicy_·th
 = 
	`£aud™_g‘_pŞicy_·th
(
tİ
->
s
);

360 *
pŞicy_ty³_¡r
 = "Policy";

361 cÚ¡ *
´im¬y_·th
;

362 *
s
;

364 ià(
log_·th
 =ğ
NULL
) {

365 
log_·th
 = "No Log";

367 ià(
pŞicy_·th
 =ğ
NULL
) {

368 
´im¬y_·th
 = "No Policy";

370 ià(
	`­Ş_pŞicy_·th_g‘_ty³
(
pŞicy_·th
è=ğ
APOL_POLICY_PATH_TYPE_MODULAR
) {

371 
pŞicy_ty³_¡r
 = "Base";

373 
´im¬y_·th
 = 
	`­Ş_pŞicy_·th_g‘_´im¬y
(
pŞicy_·th
);

375 ià(
	`a¥rštf
(&
s
, "£aud™ - [Log fe: %s] [% fe: %s]", 
log_·th
, 
pŞicy_ty³_¡r
, 
´im¬y_·th
) < 0) {

376 
	`tİËv–_ERR
(
tİ
, "%s", 
	`¡»¼Ü
(
”ºo
));

379 
	`gtk_wšdow_£t_t™Ë
(
tİ
->
w
, 
s
);

380 
	`ä“
(
s
);

381 
	}
}

392 
	$š™_icÚs
(
tİËv–_t
 * 
tİ
)

394 cÚ¡ *
icÚ_Çmes
[] = { "seaudit-small.png", "seaudit.png" };

395 
GdkPixbuf
 *
icÚ
;

396 *
·th
;

397 
GLi¡
 *
icÚ_li¡
 = 
NULL
;

398 
size_t
 
i
;

399 
i
 = 0; i < (
icÚ_Çmes
) / (icon_names[0]); i++) {

400 ià((
·th
 = 
	`­Ş_fe_fšd_·th
(
icÚ_Çmes
[
i
])è=ğ
NULL
) {

403 
icÚ
 = 
	`gdk_pixbuf_Ãw_äom_fe
(
·th
, 
NULL
);

404 
	`ä“
(
·th
);

405 ià(
icÚ
 =ğ
NULL
) {

408 
icÚ_li¡
 = 
	`g_li¡_­³nd
(icÚ_li¡, 
icÚ
);

410 
	`gtk_wšdow_£t_deçuÉ_icÚ_li¡
(
icÚ_li¡
);

411 
	`gtk_wšdow_£t_icÚ_li¡
(
tİ
->
w
, 
icÚ_li¡
);

412 
	}
}

414 
	$mes§ge_v›w_ä“
(*
–em
)

416 
mes§ge_v›w_t
 *
v›w
 = 
–em
;

417 
	`mes§ge_v›w_de¡roy
(&
v›w
);

418 
	}
}

420 
tİËv–_t
 *
	$tİËv–_ü—‹
(
£aud™_t
 * 
s
)

422 
tİËv–_t
 *
tİ
;

423 
GtkWidg‘
 *
vbox
;

424 
”rÜ
 = 0;

426 ià((
tİ
 = 
	`ÿÎoc
(1, (*tİ))è=ğ
NULL
 || (tİ->
v›ws
 = 
	`­Ş_veùÜ_ü—‹
(
mes§ge_v›w_ä“
)) == NULL) {

427 
”rÜ
 = 
”ºo
;

428 
ş—nup
;

430 
tİ
->
s
 = s;

431 
tİ
->
Ãxt_mod–_numb”
 = 1;

433 ià((
tİ
->
xml_f’ame
 = 
	`­Ş_fe_fšd_·th
("£aud™.gÏde")è=ğ
NULL
 ||

434 (
tİ
->
xml
 = 
	`gÏde_xml_Ãw
Ñİ->
xml_f’ame
, "TİLev–", 
NULL
)) == NULL) {

435 
	`årštf
(
¡d”r
, "Could‚ot open seaudit.glade.\n");

436 
”rÜ
 = 
EIO
;

437 
ş—nup
;

439 
tİ
->
w
 = 
	`GTK_WINDOW
(
	`gÏde_xml_g‘_widg‘
Ñİ->
xml
, "TopLevel"));

440 
	`g_objeù_£t_d©a
(
	`G_OBJECT
(
tİ
->
w
), "toplevel",op);

441 
	`š™_icÚs
(
tİ
);

442 
tİ
->
nÙebook
 = 
	`GTK_NOTEBOOK
(
	`gtk_nÙebook_Ãw
());

443 
	`g_sigÇl_cÚÃù_aá”
(
	`G_OBJECT
(
tİ
->
nÙebook
), "sw™ch-·ge", 
	`G_CALLBACK
(
tİËv–_Ú_nÙebook_sw™ch_·ge
),op);

444 
vbox
 = 
	`gÏde_xml_g‘_widg‘
(
tİ
->
xml
, "NotebookVBox");

445 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
vbox
), 
	`GTK_WIDGET
(
tİ
->
nÙebook
));

446 
	`gtk_widg‘_show
(
	`GTK_WIDGET
(
tİ
->
nÙebook
));

447 
	`gtk_widg‘_show
(
	`GTK_WIDGET
(
tİ
->
w
));

448 
	`tİËv–_£t_»ûÁ_logs_subm’u
(
tİ
);

449 
	`tİËv–_£t_»ûÁ_pŞic›s_subm’u
(
tİ
);

451 
	`gÏde_xml_sigÇl_autocÚÃù
(
tİ
->
xml
);

454 
	`tİËv–_add_Ãw_mod–
(
tİ
);

458 ià((
tİ
->
pv
 = 
	`pŞicy_v›w_ü—‹
Ñİ)è=ğ
NULL
 || (tİ->
´og»ss
 = 
	`´og»ss_ü—‹
(top)) == NULL) {

459 
”rÜ
 = 
”ºo
;

460 
ş—nup
;

462 
ş—nup
:

463 ià(
”rÜ
 != 0) {

464 
	`tİËv–_de¡roy
(&
tİ
);

465 
”ºo
 = 
”rÜ
;

466  
NULL
;

468  
tİ
;

469 
	}
}

471 
	$tİËv–_de¡roy
(
tİËv–_t
 ** 
tİ
)

473 ià(
tİ
 !ğ
NULL
 && *top != NULL) {

474 ià((*
tİ
)->
mÚ™Ü_id
 > 0) {

475 
	`g_sourû_»move
((*
tİ
)->
mÚ™Ü_id
);

477 
	`pŞicy_v›w_de¡roy
(&(*
tİ
)->
pv
);

478 
	`­Ş_veùÜ_de¡roy
(&(*
tİ
)->
v›ws
);

479 
	`ä“
((*
tİ
)->
xml_f’ame
);

480 
	`g_ä“
((*
tİ
)->
v›w_f’ame
);

481 
	`´og»ss_de¡roy
(&(*
tİ
)->
´og»ss
);

482 ià((*
tİ
)->
w
 !ğ
NULL
) {

483 
	`gtk_widg‘_de¡roy
(
	`GTK_WIDGET
((*
tİ
)->
w
));

485 
	`ä“
(*
tİ
);

486 *
tİ
 = 
NULL
;

488 
	}
}

490 
	slog_run_d©um


492 
tİËv–_t
 *
	mtİ
;

493 
FILE
 *
	mfe
;

494 cÚ¡ *
	mf’ame
;

495 
£aud™_log_t
 *
	mlog
;

496 
	m»suÉ
;

515 
gboŞ—n
 
	$tİËv–_mÚ™Ü_log_tim”
(
gpoš‹r
 
d©a
)

517 
tİËv–_t
 *
tİ
 = (tİËv–_ˆ*è
d©a
;

518 ià(
tİ
->
do_mÚ™Ü_log
) {

519 
»tv®
;

520 
gšt
 
i
 = 
	`gtk_nÙebook_g‘_n_·ges
(
tİ
->
nÙebook
) - 1;

521 
ušt
 
d–ay
;

522 
»tv®
 = 
	`£aud™_·r£_log
(
tİ
->
s
);

523 ià(
»tv®
 < 0) {

524 
GtkCheckM’uI‹m
 *
w
;

525 
	`tİËv–_ERR
(
tİ
, "E¼Ü whmÚ™Üšg†og: %s", 
	`¡»¼Ü
(
”ºo
));

526 
w
 = 
	`GTK_CHECK_MENU_ITEM
(
	`gÏde_xml_g‘_widg‘
(
tİ
->
xml
, "MonitorLog"));

527 
tİ
->
mÚ™Ü_id
 = 0;

528 
	`gtk_check_m’u_™em_£t_aùive
(
w
, 0);

529  
FALSE
;

531 
i
 >= 0) {

532 
GtkWidg‘
 *
chd
 = 
	`gtk_nÙebook_g‘_Áh_·ge
(
tİ
->
nÙebook
, 
i
);

533 
GtkWidg‘
 *
b
 = 
	`gtk_nÙebook_g‘_b_Ïb–
(
tİ
->
nÙebook
, 
chd
);

534 
mes§ge_v›w_t
 *
v
 = 
	`g_objeù_g‘_d©a
(
	`G_OBJECT
(
b
), "view-object");

535 
	`mes§ge_v›w_upd©e_rows
(
v
);

536 
i
--;

540 
d–ay
 = 
	`´eã»nûs_g‘_»®_time_š‹rv®
(
	`tİËv–_g‘_´efs
(
tİ
));

541 
tİ
->
mÚ™Ü_id
 = 
	`g_timeout_add
(
d–ay
, 
tİËv–_mÚ™Ü_log_tim”
,op);

543 
tİ
->
mÚ™Ü_id
 = 0;

545  
FALSE
;

546 
	}
}

556 
	$tİËv–_mÚ™Ü_log
(
tİËv–_t
 * 
tİ
)

558 
GtkLab–
 *
Ïb–
 = 
	`GTK_LABEL
(
	`gÏde_xml_g‘_widg‘
(
tİ
->
xml
, "MonitorLogLabel"));

559 
	`as£¹
(
Ïb–
 !ğ
NULL
);

560 ià(
tİ
->
do_mÚ™Ü_log
) {

561 
	`gtk_Ïb–_£t_m¬kup
(
Ïb–
, "Monitor Status: <span foreground=\"green\">ON</span>");

562 ià(
tİ
->
mÚ™Ü_id
 == 0) {

563 
ušt
 
d–ay
 = 
	`´eã»nûs_g‘_»®_time_š‹rv®
(
	`tİËv–_g‘_´efs
(
tİ
));

564 
tİ
->
mÚ™Ü_id
 = 
	`g_timeout_add
(
d–ay
, 
tİËv–_mÚ™Ü_log_tim”
,op);

567 ià(
tİ
->
mÚ™Ü_id
 > 0) {

568 
	`g_sourû_»move
(
tİ
->
mÚ™Ü_id
);

569 
tİ
->
mÚ™Ü_id
 = 0;

571 
	`gtk_Ïb–_£t_m¬kup
(
Ïb–
, "Monitor Status: <span foreground=\"red\">OFF</span>");

573 
	}
}

585 
gpoš‹r
 
	$tİËv–_İ’_log_ruÂ”
(
gpoš‹r
 
d©a
)

587 
log_run_d©um
 *
run
 = (log_run_d©um *)
d©a
;

588 
	`´og»ss_upd©e
(
run
->
tİ
->
´og»ss
, "P¬sšg %s",„un->
f’ame
);

589 ià((
run
->
fe
 = 
	`fİ’
Ôun->
f’ame
, "r")è=ğ
NULL
) {

590 
	`´og»ss_upd©e
(
run
->
tİ
->
´og»ss
, "Could‚Ù o³À% fÜ„—dšg.",„un->
f’ame
);

591 
run
->
»suÉ
 = -1;

592 
ş—nup
;

594 ià((
run
->
log
 = 
	`£aud™_log_ü—‹
(
´og»ss_£aud™_hªdË_func
,„un->
tİ
->
´og»ss
)è=ğ
NULL
) {

595 
	`´og»ss_upd©e
(
run
->
tİ
->
´og»ss
, "%s", 
	`¡»¼Ü
(
”ºo
));

596 
run
->
»suÉ
 = -1;

597 
ş—nup
;

599 
run
->
»suÉ
 = 
	`£aud™_log_·r£
Ôun->
log
,„un->
fe
);

600 
ş—nup
:

601 ià(
run
->
»suÉ
 < 0) {

602 ià(
run
->
fe
 !ğ
NULL
) {

603 
	`fşo£
(
run
->
fe
);

605 
run
->
fe
 = 
NULL
;

606 
	`£aud™_log_de¡roy
(&
run
->
log
);

607 
	`´og»ss_abÜt
(
run
->
tİ
->
´og»ss
, 
NULL
);

608 } ià(
run
->
»suÉ
 > 0) {

609 
	`´og»ss_w¬n
(
run
->
tİ
->
´og»ss
, 
NULL
);

611 
	`´og»ss_dÚe
(
run
->
tİ
->
´og»ss
);

613  
NULL
;

614 
	}
}

619 
	$tİËv–_de¡roy_v›ws
(
tİËv–_t
 * 
tİ
)

621 
gšt
 
num_·ges
 = 
	`gtk_nÙebook_g‘_n_·ges
(
tİ
->
nÙebook
);

622 
num_·ges
 >= 1) {

623 
mes§ge_v›w_t
 *
v›w
 = 
	`­Ş_veùÜ_g‘_–em’t
(
tİ
->
v›ws
, 
num_·ges
 - 1);

624 
	`gtk_nÙebook_»move_·ge
(
tİ
->
nÙebook
, 
num_·ges
 - 1);

625 
	`mes§ge_v›w_de¡roy
(&
v›w
);

626 
	`­Ş_veùÜ_»move
(
tİ
->
v›ws
, 
num_·ges
 - 1);

627 
num_·ges
--;

629 
	}
}

631 
	$tİËv–_İ’_log
(
tİËv–_t
 * 
tİ
, cÚ¡ *
f’ame
)

633 
log_run_d©um
 
run
 = { 
tİ
, 
NULL
, 
f’ame
, NULL, 0 };

634 
was_mÚ™Ü_ruÂšg
;

635 
GtkCheckM’uI‹m
 *
w
;

638 
was_mÚ™Ü_ruÂšg
 = 
tİ
->
do_mÚ™Ü_log
;

639 
tİ
->
do_mÚ™Ü_log
 = 0;

640 
	`tİËv–_mÚ™Ü_log
(
tİ
);

642 
	`ut_cursÜ_wa™
(
	`GTK_WIDGET
(
tİ
->
w
));

643 
	`´og»ss_show
(
tİ
->
´og»ss
, "Opening Log");

644 
	`g_th»ad_ü—‹
(
tİËv–_İ’_log_ruÂ”
, &
run
, 
FALSE
, 
NULL
);

645 
	`´og»ss_wa™
(
tİ
->
´og»ss
);

646 
	`´og»ss_hide
(
tİ
->
´og»ss
);

647 
	`ut_cursÜ_ş—r
(
	`GTK_WIDGET
(
tİ
->
w
));

649 ià(
run
.
»suÉ
 < 0) {

650 
tİ
->
do_mÚ™Ü_log
 = 
was_mÚ™Ü_ruÂšg
;

651 
	`tİËv–_mÚ™Ü_log
(
tİ
);

655 
	`tİËv–_de¡roy_v›ws
(
tİ
);

656 
tİ
->
Ãxt_mod–_numb”
 = 1;

657 
	`£aud™_£t_log
(
tİ
->
s
, 
run
.
log
,„un.
fe
, 
f’ame
);

658 
	`tİËv–_£t_»ûÁ_logs_subm’u
(
tİ
);

659 
	`tİËv–_’abË_log_™ems
(
tİ
, 
TRUE
);

660 
	`tİËv–_add_Ãw_mod–
(
tİ
);

661 
	`tİËv–_upd©e_t™Ë_b¬
(
tİ
);

662 
	`tİËv–_upd©e_¡©us_b¬
(
tİ
);

663 
	`tİËv–_upd©e_£ËùiÚ_m’u_™em
(
tİ
);

664 
tİ
->
do_mÚ™Ü_log
 = 
	`´eã»nûs_g‘_»®_time_©_¡¬tup
(
	`tİËv–_g‘_´efs
(top));

666 
w
 = 
	`GTK_CHECK_MENU_ITEM
(
	`gÏde_xml_g‘_widg‘
(
tİ
->
xml
, "MonitorLog"));

668 
	`gtk_check_m’u_™em_£t_aùive
(
w
, 
tİ
->
do_mÚ™Ü_log
);

671 
	`tİËv–_mÚ™Ü_log
(
tİ
);

672 
	}
}

674 
	spŞicy_run_d©um


676 
tİËv–_t
 *
	mtİ
;

677 
­Ş_pŞicy_·th_t
 *
	m·th
;

678 
­Ş_pŞicy_t
 *
	mpŞicy
;

679 
	m»suÉ
;

689 
gpoš‹r
 
	$tİËv–_İ’_pŞicy_ruÂ”
(
gpoš‹r
 
d©a
)

691 
pŞicy_run_d©um
 *
run
 = (pŞicy_run_d©um *)
d©a
;

692 
	`´og»ss_upd©e
(
run
->
tİ
->
´og»ss
, "Opening…olicy.");

693 
run
->
pŞicy
 =

694 
	`­Ş_pŞicy_ü—‹_äom_pŞicy_·th
(
run
->
·th
, 
QPOL_POLICY_OPTION_NO_NEVERALLOWS
, 
´og»ss_­Ş_hªdË_func
,

695 
run
->
tİ
->
´og»ss
);

696 ià(
run
->
pŞicy
 =ğ
NULL
) {

697 
run
->
»suÉ
 = -1;

698 
	`´og»ss_abÜt
(
run
->
tİ
->
´og»ss
, 
NULL
);

699  
NULL
;

701 
run
->
»suÉ
 = 0;

702 
	`´og»ss_dÚe
(
run
->
tİ
->
´og»ss
);

703  
NULL
;

704 
	}
}

706 
	$tİËv–_İ’_pŞicy
(
tİËv–_t
 * 
tİ
, 
­Ş_pŞicy_·th_t
 * 
·th
)

708 
pŞicy_run_d©um
 
run
 = { 
tİ
, 
·th
, 
NULL
, 0 };

710 
	`ut_cursÜ_wa™
(
	`GTK_WIDGET
(
tİ
->
w
));

711 
	`´og»ss_show
(
tİ
->
´og»ss
, 
	`­Ş_pŞicy_·th_g‘_´im¬y
(
·th
));

712 
	`g_th»ad_ü—‹
(
tİËv–_İ’_pŞicy_ruÂ”
, &
run
, 
FALSE
, 
NULL
);

713 
	`´og»ss_wa™
(
tİ
->
´og»ss
);

714 
	`´og»ss_hide
(
tİ
->
´og»ss
);

715 
	`ut_cursÜ_ş—r
(
	`GTK_WIDGET
(
tİ
->
w
));

716 ià(
run
.
»suÉ
 < 0) {

717 
	`­Ş_pŞicy_·th_de¡roy
(&
·th
);

718  
run
.
»suÉ
;

720 
	`£aud™_£t_pŞicy
(
tİ
->
s
, 
run
.
pŞicy
, 
·th
);

721 
	`tİËv–_£t_»ûÁ_pŞic›s_subm’u
(
tİ
);

722 
	`tİËv–_’abË_pŞicy_™ems
(
tİ
, 
TRUE
);

723 
	`tİËv–_upd©e_t™Ë_b¬
(
tİ
);

724 
	`tİËv–_upd©e_¡©us_b¬
(
tİ
);

725 
	`pŞicy_v›w_upd©e
(
tİ
->
pv
, 
·th
);

727 
	}
}

729 
	$tİËv–_upd©e_¡©us_b¬
(
tİËv–_t
 * 
tİ
)

731 
­Ş_pŞicy_t
 *
pŞicy
 = 
	`£aud™_g‘_pŞicy
(
tİ
->
s
);

732 
GtkLab–
 *
pŞicy_v”siÚ
 = (GtkLab– *è
	`gÏde_xml_g‘_widg‘
(
tİ
->
xml
, "PolicyVersionLabel");

733 
GtkLab–
 *
log_num
 = (GtkLab– *è
	`gÏde_xml_g‘_widg‘
(
tİ
->
xml
, "LogNumLabel");

734 
GtkLab–
 *
log_d©es
 = (GtkLab– *è
	`gÏde_xml_g‘_widg‘
(
tİ
->
xml
, "LogDateLabel");

735 
£aud™_log_t
 *
log
 = 
	`tİËv–_g‘_log
(
tİ
);

737 ià(
pŞicy
 =ğ
NULL
) {

738 
	`gtk_Ïb–_£t_‹xt
(
pŞicy_v”siÚ
, "Policy: No…olicy");

740 *
pŞicy_¡r
 = 
	`­Ş_pŞicy_g‘_v”siÚ_ty³_mls_¡r
(
pŞicy
);

741 ià(
pŞicy_¡r
 =ğ
NULL
) {

742 
	`tİËv–_ERR
(
tİ
, "%s", 
	`¡»¼Ü
(
”ºo
));

744 *
s
;

745 ià(
	`a¥rštf
(&
s
, "PŞicy: %s", 
pŞicy_¡r
) < 0) {

746 
	`tİËv–_ERR
(
tİ
, "%s", 
	`¡»¼Ü
(
”ºo
));

748 
	`gtk_Ïb–_£t_‹xt
(
pŞicy_v”siÚ
, 
s
);

749 
	`ä“
(
s
);

751 
	`ä“
(
pŞicy_¡r
);

755 ià(
log
 =ğ
NULL
) {

756 
	`gtk_Ïb–_£t_‹xt
(
log_num
, "Log Messages: No†og");

757 
	`gtk_Ïb–_£t_‹xt
(
log_d©es
, "Dates: No†og");

759 
mes§ge_v›w_t
 *
v›w
 = 
	`tİËv–_g‘_cu¼’t_v›w
(
tİ
);

760 
size_t
 
num_mes§ges
 = 
	`£aud™_g‘_num_log_mes§ges
(
tİ
->
s
);

761 
size_t
 
num_v›w_mes§ges
;

762 cÚ¡ 
tm
 *
fœ¡
 = 
	`£aud™_g‘_log_fœ¡
(
tİ
->
s
);

763 cÚ¡ 
tm
 *
Ï¡
 = 
	`£aud™_g‘_log_Ï¡
(
tİ
->
s
);

764 
	`as£¹
(
v›w
 !ğ
NULL
);

765 
num_v›w_mes§ges
 = 
	`mes§ge_v›w_g‘_num_log_mes§ges
(
v›w
);

766 *
s
, 
t1
[256], 
t2
[256];

767 ià(
	`a¥rštf
(&
s
, "Log Mes§ges: %zd/%zd", 
num_v›w_mes§ges
, 
num_mes§ges
) < 0) {

768 
	`tİËv–_ERR
(
tİ
, "%s", 
	`¡»¼Ü
(
”ºo
));

770 
	`gtk_Ïb–_£t_‹xt
(
log_num
, 
s
);

771 
	`ä“
(
s
);

773 ià(
fœ¡
 =ğ
NULL
 || 
Ï¡
 == NULL) {

774 
	`gtk_Ïb–_£t_‹xt
(
log_d©es
, "Dates: No messages");

776 
	`¡ráime
(
t1
, 256, "%b %d %H:%M:%S", 
fœ¡
);

777 
	`¡ráime
(
t2
, 256, "%b %d %H:%M:%S", 
Ï¡
);

778 ià(
	`a¥rštf
(&
s
, "D©es: % - %s", 
t1
, 
t2
) < 0) {

779 
	`tİËv–_ERR
(
tİ
, "%s", 
	`¡»¼Ü
(
”ºo
));

781 
	`gtk_Ïb–_£t_‹xt
(
log_d©es
, 
s
);

782 
	`ä“
(
s
);

786 
	}
}

788 
	$tİËv–_upd©e_bs
(
tİËv–_t
 * 
tİ
)

790 
gšt
 
i
 = 
	`gtk_nÙebook_g‘_n_·ges
(
tİ
->
nÙebook
) - 1;

791 
i
 >= 0) {

792 
GtkWidg‘
 *
chd
 = 
	`gtk_nÙebook_g‘_Áh_·ge
(
tİ
->
nÙebook
, 
i
);

793 
GtkWidg‘
 *
b
 = 
	`gtk_nÙebook_g‘_b_Ïb–
(
tİ
->
nÙebook
, 
chd
);

794 
GtkWidg‘
 *
Ïb–
 = 
	`g_objeù_g‘_d©a
(
	`G_OBJECT
(
b
), "label");

795 
mes§ge_v›w_t
 *
v
 = 
	`g_objeù_g‘_d©a
(
	`G_OBJECT
(
b
), "view-object");

796 
£aud™_mod–_t
 *
mod–
 = 
	`mes§ge_v›w_g‘_mod–
(
v
);

797 cÚ¡ *
Çme
 = 
	`£aud™_mod–_g‘_Çme
(
mod–
);

798 
	`gtk_Ïb–_£t_‹xt
(
	`GTK_LABEL
(
Ïb–
), 
Çme
);

799 
i
--;

801 
	}
}

803 
	$tİËv–_upd©e_£ËùiÚ_m’u_™em
(
tİËv–_t
 * 
tİ
)

805 cÚ¡ *
™ems
[] = {

807 
NULL


809 
mes§ge_v›w_t
 *
v›w
 = 
	`tİËv–_g‘_cu¼’t_v›w
(
tİ
);

810 
gboŞ—n
 
£ns
 = 
FALSE
;

811 
size_t
 
i
;

812 cÚ¡ *
s
;

813 ià(
v›w
 !ğ
NULL
) {

814 
£ns
 = 
	`mes§ge_v›w_is_mes§ge_£Ëùed
(
v›w
);

816 
i
 = 0, 
s
 = 
™ems
[0]; s !ğ
NULL
; s = items[++i]) {

817 
GtkWidg‘
 *
w
 = 
	`gÏde_xml_g‘_widg‘
(
tİ
->
xml
, 
s
);

818 
	`as£¹
(
s
 !ğ
NULL
);

819 
	`gtk_widg‘_£t_£ns™ive
(
w
, 
£ns
);

821 
	}
}

823 
´eã»nûs_t
 *
	$tİËv–_g‘_´efs
(
tİËv–_t
 * 
tİ
)

825  
	`£aud™_g‘_´efs
(
tİ
->
s
);

826 
	}
}

828 
£aud™_log_t
 *
	$tİËv–_g‘_log
(
tİËv–_t
 * 
tİ
)

830  
	`£aud™_g‘_log
(
tİ
->
s
);

831 
	}
}

833 
­Ş_veùÜ_t
 *
	$tİËv–_g‘_log_u£rs
(
tİËv–_t
 * 
tİ
)

835  
	`£aud™_g‘_log_u£rs
(
tİ
->
s
);

836 
	}
}

838 
­Ş_veùÜ_t
 *
	$tİËv–_g‘_log_rŞes
(
tİËv–_t
 * 
tİ
)

840  
	`£aud™_g‘_log_rŞes
(
tİ
->
s
);

841 
	}
}

843 
­Ş_veùÜ_t
 *
	$tİËv–_g‘_log_ty³s
(
tİËv–_t
 * 
tİ
)

845  
	`£aud™_g‘_log_ty³s
(
tİ
->
s
);

846 
	}
}

848 
­Ş_veùÜ_t
 *
	$tİËv–_g‘_log_mls_lvl
(
tİËv–_t
 * 
tİ
)

850  
	`£aud™_g‘_log_mls_lvl
(
tİ
->
s
);

851 
	}
}

853 
­Ş_veùÜ_t
 *
	$tİËv–_g‘_log_mls_şr
(
tİËv–_t
 * 
tİ
)

855  
	`£aud™_g‘_log_mls_şr
(
tİ
->
s
);

856 
	}
}

858 
­Ş_veùÜ_t
 *
	$tİËv–_g‘_log_şas£s
(
tİËv–_t
 * 
tİ
)

860  
	`£aud™_g‘_log_şas£s
(
tİ
->
s
);

861 
	}
}

863 
­Ş_pŞicy_t
 *
	$tİËv–_g‘_pŞicy
(
tİËv–_t
 * 
tİ
)

865  
	`£aud™_g‘_pŞicy
(
tİ
->
s
);

866 
	}
}

868 *
	$tİËv–_g‘_gÏde_xml
(
tİËv–_t
 * 
tİ
)

870  
tİ
->
xml_f’ame
;

871 
	}
}

873 
´og»ss_t
 *
	$tİËv–_g‘_´og»ss
(
tİËv–_t
 * 
tİ
)

875  
tİ
->
´og»ss
;

876 
	}
}

878 
GtkWšdow
 *
	$tİËv–_g‘_wšdow
(
tİËv–_t
 * 
tİ
)

880  
tİ
->
w
;

881 
	}
}

883 
	$tİËv–_fšd_‹ruËs
(
tİËv–_t
 * 
tİ
, 
£aud™_mes§ge_t
 * 
mes§ge
)

885 
	`pŞicy_v›w_fšd_‹ruËs
(
tİ
->
pv
, 
mes§ge
);

886 
	}
}

897 
	$tİËv–_mes§ge
(
tİËv–_t
 * 
tİ
, 
GtkMes§geTy³
 
msg_ty³
, cÚ¡ *
fmt
, 
va_li¡
 
­
)

899 
GtkWidg‘
 *
dŸlog
;

900 *
msg
;

901 ià(
	`va¥rštf
(&
msg
, 
fmt
, 
­
) < 0) {

902 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
”ºo
));

905 
dŸlog
 = 
	`gtk_mes§ge_dŸlog_Ãw
(
tİ
->
w
, 
GTK_DIALOG_DESTROY_WITH_PARENT
, 
msg_ty³
, 
GTK_BUTTONS_CLOSE
, 
msg
);

906 
	`ä“
(
msg
);

907 
	`gtk_dŸlog_run
(
	`GTK_DIALOG
(
dŸlog
));

908 
	`gtk_widg‘_de¡roy
(
dŸlog
);

909 
	}
}

911 
	$tİËv–_ERR
(
tİËv–_t
 * 
tİ
, cÚ¡ *
fÜm©
, ...)

913 
	`va_li¡
(
­
);

914 
	`va_¡¬t
(
­
, 
fÜm©
);

915 
	`tİËv–_mes§ge
(
tİ
, 
GTK_MESSAGE_ERROR
, 
fÜm©
, 
­
);

916 
	`va_’d
(
­
);

917 
	}
}

919 
	$tİËv–_WARN
(
tİËv–_t
 * 
tİ
, cÚ¡ *
fÜm©
, ...)

921 
	`va_li¡
(
­
);

922 
	`va_¡¬t
(
­
, 
fÜm©
);

923 
	`tİËv–_mes§ge
(
tİ
, 
GTK_MESSAGE_WARNING
, 
fÜm©
, 
­
);

924 
	`va_’d
(
­
);

925 
	}
}

929 
tİËv–_Ú_de¡roy
(
gpoš‹r
 
u£r_d©a
, 
GtkObjeù
 * 
objeù
 
__©Œibu‹__
 ((
unu£d
)))

931 
tİËv–_t
 *
	gtİ
 = 
g_objeù_g‘_d©a
(
G_OBJECT
(
u£r_d©a
), "toplevel");

932 
	gtİ
->
	gw
 = 
NULL
;

933 
gtk_maš_qu™
();

936 
tİËv–_Ú_İ’_log_aùiv©e
(
gpoš‹r
 
u£r_d©a
, 
GtkWidg‘
 * 
widg‘
 
__©Œibu‹__
 ((
unu£d
)))

938 
tİËv–_t
 *
	gtİ
 = 
g_objeù_g‘_d©a
(
G_OBJECT
(
u£r_d©a
), "toplevel");

939 
­Ş_veùÜ_t
 *
	g·ths
 = 
ut_İ’_fe
(
tİ
->
w
, "O³ÀLog", 
£aud™_g‘_log_·th
Ñİ->
s
), 0);

940 ià(
	g·ths
 !ğ
NULL
) {

941 
tİËv–_İ’_log
(
tİ
, 
­Ş_veùÜ_g‘_–em’t
(
·ths
, 0));

942 
­Ş_veùÜ_de¡roy
(&
·ths
);

946 
tİËv–_Ú_İ’_pŞicy_aùiv©e
(
gpoš‹r
 
u£r_d©a
, 
GtkWidg‘
 * 
widg‘
 
__©Œibu‹__
 ((
unu£d
)))

948 
tİËv–_t
 *
	gtİ
 = 
g_objeù_g‘_d©a
(
G_OBJECT
(
u£r_d©a
), "toplevel");

949 
İ’_pŞicy_wšdow_run
(
tİ
, 
£aud™_g‘_pŞicy_·th
Ñİ->
s
), 
NULL
);

952 
tİËv–_Ú_´eã»nûs_aùiv©e
(
gpoš‹r
 
u£r_d©a
, 
GtkWidg‘
 * 
widg‘
 
__©Œibu‹__
 ((
unu£d
)))

954 
tİËv–_t
 *
	gtİ
 = 
g_objeù_g‘_d©a
(
G_OBJECT
(
u£r_d©a
), "toplevel");

955 ià(
´eã»nûs_v›w_run
(
tİ
, 
£aud™_g‘_log_·th
Ñİ->
s
), 
£aud™_g‘_pŞicy_·th
(top->s))) {

956 
size_t
 
	gi
;

957 
	gi
 = 0; i < 
­Ş_veùÜ_g‘_size
(
tİ
->
v›ws
); i++) {

958 
mes§ge_v›w_t
 *
	gv
 = 
­Ş_veùÜ_g‘_–em’t
(
tİ
->
v›ws
, 
i
);

959 
mes§ge_v›w_upd©e_visibË_cŞumns
(
v
);

964 
tİËv–_Ú_qu™_aùiv©e
(
gpoš‹r
 
u£r_d©a
, 
GtkWidg‘
 * 
widg‘
 
__©Œibu‹__
 ((
unu£d
)))

966 
tİËv–_t
 *
	gtİ
 = 
g_objeù_g‘_d©a
(
G_OBJECT
(
u£r_d©a
), "toplevel");

967 
	gtİ
->
	gw
 = 
NULL
;

968 
gtk_maš_qu™
();

971 
tİËv–_Ú_Ãw_v›w_aùiv©e
(
gpoš‹r
 
u£r_d©a
, 
GtkWidg‘
 * 
widg‘
 
__©Œibu‹__
 ((
unu£d
)))

973 
tİËv–_t
 *
	gtİ
 = 
g_objeù_g‘_d©a
(
G_OBJECT
(
u£r_d©a
), "toplevel");

974 
tİËv–_add_Ãw_mod–
(
tİ
);

977 
tİËv–_Ú_İ’_v›w_aùiv©e
(
gpoš‹r
 
u£r_d©a
, 
GtkWidg‘
 * 
widg‘
 
__©Œibu‹__
 ((
unu£d
)))

979 
tİËv–_t
 *
	gtİ
 = 
g_objeù_g‘_d©a
(
G_OBJECT
(
u£r_d©a
), "toplevel");

980 
­Ş_veùÜ_t
 *
	g·ths
 = 
ut_İ’_fe
(
tİ
->
w
, "O³ÀV›w",İ->
v›w_f’ame
, 0);

981 
£aud™_mod–_t
 *
	gmod–
 = 
NULL
;

982 ià(
	g·ths
 =ğ
NULL
) {

985 
ä“
(
tİ
->
v›w_f’ame
);

986 
	gtİ
->
	gv›w_f’ame
 = 
¡rdup
(
­Ş_veùÜ_g‘_–em’t
(
·ths
, 0));

987 
­Ş_veùÜ_de¡roy
(&
·ths
);

988 ià(
	gtİ
->
	gv›w_f’ame
 =ğ
NULL
 ||

989 (
mod–
 = 
£aud™_mod–_ü—‹_äom_fe
(
tİ
->
v›w_f’ame
)è=ğ
NULL
 ||

990 
£aud™_mod–_­³nd_log
(
mod–
, 
£aud™_g‘_log
(
tİ
->
s
)) < 0) {

991 
tİËv–_ERR
(
tİ
, "E¼Ü o³nšg v›w: %s", 
¡»¼Ü
(
”ºo
));

992 
£aud™_mod–_de¡roy
(&
mod–
);

994 
tİËv–_add_Ãw_v›w
(
tİ
, 
mod–
,İ->
v›w_f’ame
);

998 
tİËv–_Ú_§ve_v›w_aùiv©e
(
gpoš‹r
 
u£r_d©a
, 
GtkWidg‘
 * 
widg‘
 
__©Œibu‹__
 ((
unu£d
)))

1000 
tİËv–_t
 *
	gtİ
 = 
g_objeù_g‘_d©a
(
G_OBJECT
(
u£r_d©a
), "toplevel");

1001 
mes§ge_v›w_t
 *
	gv›w
 = 
tİËv–_g‘_cu¼’t_v›w
(
tİ
);

1002 
as£¹
(
v›w
 !ğ
NULL
);

1003 
mes§ge_v›w_§ve
(
v›w
);

1006 
tİËv–_Ú_§ve_v›was_aùiv©e
(
gpoš‹r
 
u£r_d©a
, 
GtkWidg‘
 * 
widg‘
 
__©Œibu‹__
 ((
unu£d
)))

1008 
tİËv–_t
 *
	gtİ
 = 
g_objeù_g‘_d©a
(
G_OBJECT
(
u£r_d©a
), "toplevel");

1009 
mes§ge_v›w_t
 *
	gv›w
 = 
tİËv–_g‘_cu¼’t_v›w
(
tİ
);

1010 
as£¹
(
v›w
 !ğ
NULL
);

1011 
mes§ge_v›w_§v—s
(
v›w
);

1014 
tİËv–_Ú_modify_v›w_aùiv©e
(
gpoš‹r
 
u£r_d©a
, 
GtkWidg‘
 * 
widg‘
 
__©Œibu‹__
 ((
unu£d
)))

1016 
tİËv–_t
 *
	gtİ
 = 
g_objeù_g‘_d©a
(
G_OBJECT
(
u£r_d©a
), "toplevel");

1017 
mes§ge_v›w_t
 *
	gv›w
 = 
tİËv–_g‘_cu¼’t_v›w
(
tİ
);

1018 
as£¹
(
v›w
 !ğ
NULL
);

1019 
mes§ge_v›w_modify
(
v›w
);

1022 
tİËv–_Ú_expÜt_®l_mes§ges_aùiv©e
(
gpoš‹r
 
u£r_d©a
, 
GtkWidg‘
 * 
widg‘
 
__©Œibu‹__
 ((
unu£d
)))

1024 
tİËv–_t
 *
	gtİ
 = 
g_objeù_g‘_d©a
(
G_OBJECT
(
u£r_d©a
), "toplevel");

1025 
mes§ge_v›w_t
 *
	gv›w
 = 
tİËv–_g‘_cu¼’t_v›w
(
tİ
);

1026 
as£¹
(
v›w
 !ğ
NULL
);

1027 
mes§ge_v›w_expÜt_®l_mes§ges
(
v›w
);

1030 
tİËv–_Ú_expÜt_£Ëùed_mes§ges_aùiv©e
(
gpoš‹r
 
u£r_d©a
, 
GtkWidg‘
 * 
widg‘
 
__©Œibu‹__
 ((
unu£d
)))

1032 
tİËv–_t
 *
	gtİ
 = 
g_objeù_g‘_d©a
(
G_OBJECT
(
u£r_d©a
), "toplevel");

1033 
mes§ge_v›w_t
 *
	gv›w
 = 
tİËv–_g‘_cu¼’t_v›w
(
tİ
);

1034 
as£¹
(
v›w
 !ğ
NULL
);

1035 
mes§ge_v›w_expÜt_£Ëùed_mes§ges
(
v›w
);

1038 
tİËv–_Ú_v›w_’tœe_mes§ge_aùiv©e
(
gpoš‹r
 
u£r_d©a
, 
GtkWidg‘
 * 
widg‘
 
__©Œibu‹__
 ((
unu£d
)))

1040 
tİËv–_t
 *
	gtİ
 = 
g_objeù_g‘_d©a
(
G_OBJECT
(
u£r_d©a
), "toplevel");

1041 
mes§ge_v›w_t
 *
	gv›w
 = 
tİËv–_g‘_cu¼’t_v›w
(
tİ
);

1042 
as£¹
(
v›w
 !ğ
NULL
);

1043 
mes§ge_v›w_’tœe_mes§ge
(
v›w
);

1046 
tİËv–_Ú_fšd_‹ruËs_aùiv©e
(
gpoš‹r
 
u£r_d©a
, 
GtkWidg‘
 * 
widg‘
 
__©Œibu‹__
 ((
unu£d
)))

1048 
tİËv–_t
 *
	gtİ
 = 
g_objeù_g‘_d©a
(
G_OBJECT
(
u£r_d©a
), "toplevel");

1049 
tİËv–_fšd_‹ruËs
(
tİ
, 
NULL
);

1052 
tİËv–_Ú_ü—‹_»pÜt_aùiv©e
(
gpoš‹r
 
u£r_d©a
, 
GtkM’uI‹m
 * 
widg‘
 
__©Œibu‹__
 ((
unu£d
)))

1054 
tİËv–_t
 *
	gtİ
 = 
g_objeù_g‘_d©a
(
G_OBJECT
(
u£r_d©a
), "toplevel");

1055 
mes§ge_v›w_t
 *
	gv›w
 = 
tİËv–_g‘_cu¼’t_v›w
(
tİ
);

1056 
as£¹
(
v›w
 !ğ
NULL
);

1057 
»pÜt_wšdow_run
(
tİ
, 
v›w
);

1060 
	$tİËv–_Ú_mÚ™Ü_log_aùiv©e
(
gpoš‹r
 
u£r_d©a
, 
GtkM’uI‹m
 * 
widg‘
)

1062 
tİËv–_t
 *
tİ
 = 
	`g_objeù_g‘_d©a
(
	`G_OBJECT
(
u£r_d©a
), "toplevel");

1063 ià(
	`gtk_check_m’u_™em_g‘_aùive
(
	`GTK_CHECK_MENU_ITEM
(
widg‘
))) {

1064 
tİ
->
do_mÚ™Ü_log
 = 1;

1066 
tİ
->
do_mÚ™Ü_log
 = 0;

1068 
	`tİËv–_mÚ™Ü_log
(
tİ
);

1069 
	}
}

1071 
tİËv–_Ú_ş—r_v›w_aùiv©e
(
gpoš‹r
 
u£r_d©a
, 
GtkM’uI‹m
 * 
widg‘
 
__©Œibu‹__
 ((
unu£d
)))

1073 
tİËv–_t
 *
	gtİ
 = 
g_objeù_g‘_d©a
(
G_OBJECT
(
u£r_d©a
), "toplevel");

1074 
mes§ge_v›w_t
 *
	gv›w
 = 
tİËv–_g‘_cu¼’t_v›w
(
tİ
);

1075 
as£¹
(
v›w
 !ğ
NULL
);

1076 
mes§ge_v›w_ş—r
(
v›w
);

1079 
tİËv–_Ú_h–p_aùiv©e
(
gpoš‹r
 
u£r_d©a
, 
GtkM’uI‹m
 * 
widg‘
 
__©Œibu‹__
 ((
unu£d
)))

1081 
tİËv–_t
 *
	gtİ
 = 
g_objeù_g‘_d©a
(
G_OBJECT
(
u£r_d©a
), "toplevel");

1082 
GtkWidg‘
 *
	gwšdow
;

1083 
GtkWidg‘
 *
	gsüŞl
;

1084 
GtkWidg‘
 *
	g‹xt_v›w
;

1085 
GtkTextBufãr
 *
	gbufãr
;

1086 *
	gh–p_‹xt
 = 
NULL
;

1087 
size_t
 
	gËn
;

1088 
	g¹
;

1089 *
	gdœ
;

1091 
	gwšdow
 = 
gtk_dŸlog_Ãw_w™h_bu‰Ús
("seaudit Help",

1092 
GTK_WINDOW
(
tİ
->
w
),

1093 
GTK_DIALOG_DESTROY_WITH_PARENT
, 
GTK_STOCK_CLOSE
, 
GTK_RESPONSE_CLOSE
, 
NULL
);

1094 
gtk_dŸlog_£t_deçuÉ_»¥Ú£
(
GTK_DIALOG
(
wšdow
), 
GTK_RESPONSE_CLOSE
);

1095 
g_sigÇl_cÚÃù_sw­³d
(
wšdow
, "»¥Ú£", 
G_CALLBACK
(
gtk_widg‘_de¡roy
), window);

1096 
	gsüŞl
 = 
gtk_süŞËd_wšdow_Ãw
(
NULL
, NULL);

1097 
	g‹xt_v›w
 = 
gtk_‹xt_v›w_Ãw
();

1098 
gtk_wšdow_£t_deçuÉ_size
(
GTK_WINDOW
(
wšdow
), 520, 300);

1099 
gtk_cÚš”_add
(
GTK_CONTAINER
(
GTK_DIALOG
(
wšdow
)->
vbox
), 
süŞl
);

1100 
gtk_cÚš”_add
(
GTK_CONTAINER
(
süŞl
), 
‹xt_v›w
);

1101 
gtk_‹xt_v›w_£t_w¿p_mode
(
GTK_TEXT_VIEW
(
‹xt_v›w
), 
GTK_WRAP_NONE
);

1102 
	gbufãr
 = 
gtk_‹xt_v›w_g‘_bufãr
(
GTK_TEXT_VIEW
(
‹xt_v›w
));

1103 
	gdœ
 = 
­Ş_fe_fšd_·th
("seaudit_help.txt");

1104 ià(!
	gdœ
) {

1105 
tİËv–_ERR
(
tİ
, "Cannot find help file.");

1108 
	g¹
 = 
­Ş_fe_»ad_to_bufãr
(
dœ
, &
h–p_‹xt
, &
Ën
);

1109 
ä“
(
dœ
);

1110 ià(
	g¹
 != 0) {

1111 
ä“
(
h–p_‹xt
);

1114 
gtk_‹xt_bufãr_£t_‹xt
(
bufãr
, 
h–p_‹xt
, 
Ën
);

1115 
gtk_‹xt_v›w_£t_ed™abË
(
GTK_TEXT_VIEW
(
‹xt_v›w
), 
FALSE
);

1116 
gtk_wšdow_£t_pos™iÚ
(
GTK_WINDOW
(
wšdow
), 
GTK_WIN_POS_CENTER_ON_PARENT
);

1117 
gtk_widg‘_show
(
‹xt_v›w
);

1118 
gtk_widg‘_show
(
süŞl
);

1119 
gtk_widg‘_show
(
wšdow
);

1122 
tİËv–_Ú_about_£aud™_aùiv©e
(
gpoš‹r
 
u£r_d©a
, 
GtkM’uI‹m
 * 
widg‘
 
__©Œibu‹__
 ((
unu£d
)))

1124 
tİËv–_t
 *
	gtİ
 = 
g_objeù_g‘_d©a
(
G_OBJECT
(
u£r_d©a
), "toplevel");

1125 #ifdeà
GTK_2_8


1126 
gtk_show_about_dŸlog
(
tİ
->
w
,

1128 "cİyright", 
COPYRIGHT_INFO
,

1129 "Çme", "£aud™", "v”siÚ", 
VERSION
, "webs™e", "h‰p://oss.Œesys.com/´ojeùs/£toŞs", 
NULL
);

1131 
GtkWidg‘
 *
	gw
 = 
gtk_mes§ge_dŸlog_Ãw
(
tİ
->
w
,

1132 
GTK_DIALOG_DESTROY_WITH_PARENT
,

1133 
GTK_MESSAGE_INFO
,

1134 
GTK_BUTTONS_CLOSE
,

1136 "£aud™", 
VERSION
,

1138 
COPYRIGHT_INFO
,

1140 
gtk_dŸlog_run
(
GTK_DIALOG
(
w
));

1141 
gtk_widg‘_de¡roy
(
w
);

1145 
tİËv–_Ú_fšd_‹ruËs_şick
(
gpoš‹r
 
u£r_d©a
, 
GtkWidg‘
 * 
widg‘
 
__©Œibu‹__
 ((
unu£d
)), 
GdkEv’t
 * 
ev’t


1146 
__©Œibu‹__
 ((
unu£d
)))

1148 
tİËv–_t
 *
	gtİ
 = 
g_objeù_g‘_d©a
(
G_OBJECT
(
u£r_d©a
), "toplevel");

1149 
tİËv–_fšd_‹ruËs
(
tİ
, 
NULL
);

1152 
tİËv–_Ú_modify_v›w_şick
(
gpoš‹r
 
u£r_d©a
, 
GtkWidg‘
 * 
widg‘
 
__©Œibu‹__
 ((
unu£d
)), 
GdkEv’t
 * 
ev’t


1153 
__©Œibu‹__
 ((
unu£d
)))

1155 
tİËv–_t
 *
	gtİ
 = 
g_objeù_g‘_d©a
(
G_OBJECT
(
u£r_d©a
), "toplevel");

1156 
mes§ge_v›w_t
 *
	gv›w
 = 
tİËv–_g‘_cu¼’t_v›w
(
tİ
);

1157 
as£¹
(
v›w
 !ğ
NULL
);

1158 
mes§ge_v›w_modify
(
v›w
);

1161 
tİËv–_Ú_mÚ™Ü_log_şick
(
gpoš‹r
 
u£r_d©a
, 
GtkWidg‘
 * 
widg‘
 
__©Œibu‹__
 ((
unu£d
)), 
GdkEv’t
 * 
ev’t


1162 
__©Œibu‹__
 ((
unu£d
)))

1164 
tİËv–_t
 *
	gtİ
 = 
g_objeù_g‘_d©a
(
G_OBJECT
(
u£r_d©a
), "toplevel");

1165 
GtkCheckM’uI‹m
 *
	gw
 = 
GTK_CHECK_MENU_ITEM
(
gÏde_xml_g‘_widg‘
(
tİ
->
xml
, "MonitorLog"));

1166 
gboŞ—n
 
	gŞd_¡©e
;

1167 
as£¹
(
w
 !ğ
NULL
);

1168 
	gŞd_¡©e
 = 
gtk_check_m’u_™em_g‘_aùive
(
w
);

1169 
gtk_check_m’u_™em_£t_aùive
(
w
, !
Şd_¡©e
);

1172 
tİËv–_Ú_ş—r_v›w_şick
(
gpoš‹r
 
u£r_d©a
, 
GtkWidg‘
 * 
widg‘
 
__©Œibu‹__
 ((
unu£d
)), 
GdkEv’t
 * 
ev’t


1173 
__©Œibu‹__
 ((
unu£d
)))

1175 
tİËv–_t
 *
	gtİ
 = 
g_objeù_g‘_d©a
(
G_OBJECT
(
u£r_d©a
), "toplevel");

1176 
mes§ge_v›w_t
 *
	gv›w
 = 
tİËv–_g‘_cu¼’t_v›w
(
tİ
);

1177 
as£¹
(
v›w
 !ğ
NULL
);

1178 
mes§ge_v›w_ş—r
(
v›w
);

	@seaudit/toplevel.h

26 #iâdeà
TOPLEVEL_H


27 
	#TOPLEVEL_H


	)

29 
tİËv–
 
	ttİËv–_t
;

31 
	~"´og»ss.h
"

32 
	~"£aud™.h
"

33 
	~<­Ş/pŞicy-·th.h
>

34 
	~<gtk/gtk.h
>

35 
	~<£aud™/mes§ge.h
>

47 
tİËv–_t
 *
tİËv–_ü—‹
(
£aud™_t
 * 
s
);

57 
tİËv–_de¡roy
(
tİËv–_t
 ** 
tİ
);

66 
tİËv–_İ’_log
(
tİËv–_t
 * 
tİ
, cÚ¡ *
f’ame
);

77 
tİËv–_İ’_pŞicy
(
tİËv–_t
 * 
tİ
, 
­Ş_pŞicy_·th_t
 * 
·th
);

86 
tİËv–_upd©e_¡©us_b¬
(
tİËv–_t
 * 
tİ
);

95 
tİËv–_upd©e_£ËùiÚ_m’u_™em
(
tİËv–_t
 * 
tİ
);

102 
tİËv–_upd©e_bs
(
tİËv–_t
 * 
tİ
);

111 
´eã»nûs_t
 *
tİËv–_g‘_´efs
(
tİËv–_t
 * 
tİ
);

122 
£aud™_log_t
 *
tİËv–_g‘_log
(
tİËv–_t
 * 
tİ
);

133 
­Ş_veùÜ_t
 *
tİËv–_g‘_log_u£rs
(
tİËv–_t
 * 
tİ
);

144 
­Ş_veùÜ_t
 *
tİËv–_g‘_log_rŞes
(
tİËv–_t
 * 
tİ
);

155 
­Ş_veùÜ_t
 *
tİËv–_g‘_log_ty³s
(
tİËv–_t
 * 
tİ
);

167 
­Ş_veùÜ_t
 *
tİËv–_g‘_log_mls_lvl
(
tİËv–_t
 * 
tİ
);

179 
­Ş_veùÜ_t
 *
tİËv–_g‘_log_mls_şr
(
tİËv–_t
 * 
tİ
);

191 
­Ş_veùÜ_t
 *
tİËv–_g‘_log_şas£s
(
tİËv–_t
 * 
tİ
);

201 
­Ş_pŞicy_t
 *
tİËv–_g‘_pŞicy
(
tİËv–_t
 * 
tİ
);

210 *
tİËv–_g‘_gÏde_xml
(
tİËv–_t
 * 
tİ
);

220 
´og»ss_t
 *
tİËv–_g‘_´og»ss
(
tİËv–_t
 * 
tİ
);

230 
GtkWšdow
 *
tİËv–_g‘_wšdow
(
tİËv–_t
 * 
tİ
);

241 
tİËv–_fšd_‹ruËs
(
tİËv–_t
 * 
tİ
, 
£aud™_mes§ge_t
 * 
mes§ge
);

251 
	$tİËv–_ERR
(
tİËv–_t
 * 
tİ
, cÚ¡ *
fÜm©
, ...è
	`__©Œibu‹__
 ((
	`fÜm©
(
´štf
, 2, 3)));

261 
	$tİËv–_WARN
(
tİËv–_t
 * 
tİ
, cÚ¡ *
fÜm©
, ...è
	`__©Œibu‹__
 ((
	`fÜm©
(
´štf
, 2, 3)));

	@seaudit/utilgui.c

25 
	~<cÚfig.h
>

27 
	~"utgui.h
"

28 
	~<¡ršg.h
>

30 
	$ut_mes§ge
(
GtkWšdow
 * 
·»Á
, 
GtkMes§geTy³
 
msg_ty³
, cÚ¡ *
msg
)

32 
GtkWidg‘
 *
dŸlog
;

33 
dŸlog
 = 
	`gtk_mes§ge_dŸlog_Ãw
(
·»Á
, 
GTK_DIALOG_DESTROY_WITH_PARENT
, 
msg_ty³
, 
GTK_BUTTONS_CLOSE
, 
msg
);

34 
	`gtk_dŸlog_run
(
	`GTK_DIALOG
(
dŸlog
));

35 
	`gtk_widg‘_de¡roy
(
dŸlog
);

36 
	}
}

38 
	$ut_cursÜ_wa™
(
GtkWidg‘
 * 
widg‘
)

40 
GdkCursÜ
 *
cursÜ
;

41 ià(
widg‘
->
wšdow
 !ğ
NULL
) {

42 
cursÜ
 = 
	`gdk_cursÜ_Ãw
(
GDK_WATCH
);

43 
	`gdk_wšdow_£t_cursÜ
(
widg‘
->
wšdow
, 
cursÜ
);

44 
	`gdk_cursÜ_uÄef
(
cursÜ
);

46 
	}
}

56 
gboŞ—n
 
	$poš‹r_»£t
(
gpoš‹r
 
d©a
)

58 
	`gdk_wšdow_£t_cursÜ
(
	`GTK_WIDGET
(
d©a
)->
wšdow
, 
NULL
);

59  
FALSE
;

60 
	}
}

62 
	$ut_cursÜ_ş—r
(
GtkWidg‘
 * 
widg‘
)

64 
	`g_idË_add
(&
poš‹r_»£t
, 
widg‘
);

65 
	}
}

67 
­Ş_veùÜ_t
 *
	$ut_İ’_fe
(
GtkWšdow
 * 
·»Á
, cÚ¡ *
t™Ë
, cÚ¡ *
š™_·th
, 
gboŞ—n
 
muÉË
)

69 
GtkWidg‘
 *
dŸlog
 = 
	`gtk_fe_choo£r_dŸlog_Ãw
(
t™Ë
, 
·»Á
, 
GTK_FILE_CHOOSER_ACTION_OPEN
, 
GTK_STOCK_CANCEL
,

70 
GTK_RESPONSE_CANCEL
,

71 
GTK_STOCK_OPEN
, 
GTK_RESPONSE_ACCEPT
, 
NULL
);

72 
­Ş_veùÜ_t
 *
·ths
 = 
NULL
;

73 ià(
š™_·th
 !ğ
NULL
) {

74 
	`gtk_fe_choo£r_£t_f’ame
(
	`GTK_FILE_CHOOSER
(
dŸlog
), 
š™_·th
);

76 
	`gtk_fe_choo£r_£t_£Ëù_muÉË
(
	`GTK_FILE_CHOOSER
(
dŸlog
), 
muÉË
);

77 ià(
	`gtk_dŸlog_run
(
	`GTK_DIALOG
(
dŸlog
)è=ğ
GTK_RESPONSE_ACCEPT
) {

78 
GSLi¡
 *
fes
 = 
	`gtk_fe_choo£r_g‘_f’ames
(
	`GTK_FILE_CHOOSER
(
dŸlog
));

79 
GSLi¡
 *
f
;

80 
·ths
 = 
	`­Ş_veùÜ_ü—‹
(
g_ä“
);

81 
f
 = 
fes
; f !ğ
NULL
; f = f->
Ãxt
) {

82 
	`­Ş_veùÜ_­³nd
(
·ths
, 
f
->
d©a
);

84 
	`g_¦i¡_ä“
(
fes
);

86 
	`gtk_widg‘_de¡roy
(
dŸlog
);

87  
·ths
;

88 
	}
}

90 *
	$ut_§ve_fe
(
GtkWšdow
 * 
·»Á
, cÚ¡ *
t™Ë
, cÚ¡ *
š™_·th
)

92 
GtkWidg‘
 *
dŸlog
 = 
	`gtk_fe_choo£r_dŸlog_Ãw
(
t™Ë
, 
·»Á
, 
GTK_FILE_CHOOSER_ACTION_SAVE
, 
GTK_STOCK_CANCEL
,

93 
GTK_RESPONSE_CANCEL
,

94 
GTK_STOCK_SAVE
, 
GTK_RESPONSE_ACCEPT
, 
NULL
);

95 *
·th
 = 
NULL
;

96 #ifdeà
GTK_2_8


97 
	`gtk_fe_choo£r_£t_do_ov”wr™e_cÚfœm©iÚ
(
	`GTK_FILE_CHOOSER
(
dŸlog
), 
TRUE
);

99 ià(
š™_·th
 !ğ
NULL
) {

100 
	`gtk_fe_choo£r_£t_f’ame
(
	`GTK_FILE_CHOOSER
(
dŸlog
), 
š™_·th
);

102 
	`gtk_fe_choo£r_£t_cu¼’t_Çme
(
	`GTK_FILE_CHOOSER
(
dŸlog
), "Untitled");

104 ià(
	`gtk_dŸlog_run
(
	`GTK_DIALOG
(
dŸlog
)è=ğ
GTK_RESPONSE_ACCEPT
) {

105 
·th
 = 
	`gtk_fe_choo£r_g‘_f’ame
(
	`GTK_FILE_CHOOSER
(
dŸlog
));

107 
	`gtk_widg‘_de¡roy
(
dŸlog
);

108  
·th
;

109 
	}
}

111 *
	$ut_pŞicy_·th_to_¡ršg
(cÚ¡ 
­Ş_pŞicy_·th_t
 * 
·th
)

113 *
s
;

114 cÚ¡ *
´im¬y_·th
 = 
	`­Ş_pŞicy_·th_g‘_´im¬y
(
·th
);

115 ià(
	`­Ş_pŞicy_·th_g‘_ty³
(
·th
è=ğ
APOL_POLICY_PATH_TYPE_MONOLITHIC
) {

116  
	`¡rdup
(
´im¬y_·th
);

118 cÚ¡ 
­Ş_veùÜ_t
 *
moduËs
 = 
	`­Ş_pŞicy_·th_g‘_moduËs
(
·th
);

119 
size_t
 
num_moduËs
 = 
	`­Ş_veùÜ_g‘_size
(
moduËs
);

120 ià(
	`a¥rštf
(&
s
, "% + %zd moduË%s", 
´im¬y_·th
, 
num_moduËs
,‚um_modules == 1 ? "" : "s") < 0) {

121  
NULL
;

123  
s
;

125 
	}
}

127 cÚ¡ 
gch¬
 *
	$ut_combo_box_g‘_aùive_‹xt
(
GtkComboBox
 * 
w
)

129 #ifdeà
GTK_2_8


130  
	`gtk_combo_box_g‘_aùive_‹xt
(
w
);

132  
	`gtk_’Œy_g‘_‹xt
(
	`GTK_ENTRY
(
	`GTK_BIN
(
w
)->
chd
));

134 
	}
}

	@seaudit/utilgui.h

25 #iâdeà
UTILGUI_H


26 
	#UTILGUI_H


	)

28 
	~<­Ş/pŞicy-·th.h
>

29 
	~<gtk/gtk.h
>

40 
ut_mes§ge
(
GtkWšdow
 * 
·»Á
, 
GtkMes§geTy³
 
msg_ty³
, cÚ¡ *
msg
);

46 
ut_cursÜ_wa™
(
GtkWidg‘
 * 
widg‘
);

53 
ut_cursÜ_ş—r
(
GtkWidg‘
 * 
widg‘
);

70 
­Ş_veùÜ_t
 *
ut_İ’_fe
(
GtkWšdow
 * 
·»Á
, cÚ¡ *
t™Ë
, cÚ¡ *
š™_·th
, 
gboŞ—n
 
muÉË
);

84 *
ut_§ve_fe
(
GtkWšdow
 * 
·»Á
, cÚ¡ *
t™Ë
, cÚ¡ *
š™_·th
);

96 *
ut_pŞicy_·th_to_¡ršg
(cÚ¡ 
­Ş_pŞicy_·th_t
 * 
·th
);

104 cÚ¡ 
gch¬
 *
ut_combo_box_g‘_aùive_‹xt
(
GtkComboBox
 * 
w
);

	@sechecker/modules/attribs_wo_rules.c

26 
	~"©Œibs_wo_ruËs.h
"

27 
	~<­Ş/ty³-qu”y.h
>

29 
	~<¡dio.h
>

30 
	~<¡ršg.h
>

31 
	~<”ºo.h
>

36 cÚ¡ *cÚ¡ 
	gmod_Çme
 = "attribs_wo_rules";

40 
	$©Œibs_wo_ruËs_»gi¡”
(
£chk_lib_t
 * 
lib
)

42 
£chk_moduË_t
 *
mod
 = 
NULL
;

43 
£chk_â_t
 *
â_¡ruù
 = 
NULL
;

45 ià(!
lib
) {

46 
	`ERR
(
NULL
, "%s", "No†ibrary");

47 
”ºo
 = 
EINVAL
;

54 
mod
 = 
	`£chk_lib_g‘_moduË
(
mod_Çme
, 
lib
);

55 ià(!
mod
) {

56 
	`ERR
(
NULL
, "%s", "Module unknown");

57 
”ºo
 = 
EINVAL
;

60 
mod
->
·»Á_lib
 = 
lib
;

63 
mod
->
br›f_desütiÚ
 = "attributes‚ot used in‡ny„ule";

64 
mod
->
d‘aed_desütiÚ
 =

69 
mod
->
İt_desütiÚ
 =

72 
mod
->
£v”™y
 = 
SECHK_SEV_LOW
;

74 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
»quœem’ts
, 
	`£chk_Çme_v®ue_Ãw
(
SECHK_REQ_POLICY_CAP
, 
SECHK_REQ_CAP_ATTRIB_NAMES
)) < 0) {

75 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

76 
”ºo
 = 
ENOMEM
;

81 
â_¡ruù
 = 
	`£chk_â_Ãw
();

82 ià(!
â_¡ruù
) {

83 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

84 
”ºo
 = 
ENOMEM
;

87 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_INIT
);

88 ià(!
â_¡ruù
->
Çme
) {

89 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

90 
”ºo
 = 
ENOMEM
;

93 
â_¡ruù
->
â
 = 
©Œibs_wo_ruËs_š™
;

94 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
) < 0) {

95 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

96 
”ºo
 = 
ENOMEM
;

100 
â_¡ruù
 = 
	`£chk_â_Ãw
();

101 ià(!
â_¡ruù
) {

102 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

103 
”ºo
 = 
ENOMEM
;

106 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_RUN
);

107 ià(!
â_¡ruù
->
Çme
) {

108 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

109 
”ºo
 = 
ENOMEM
;

112 
â_¡ruù
->
â
 = 
©Œibs_wo_ruËs_run
;

113 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
) < 0) {

114 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

115 
”ºo
 = 
ENOMEM
;

119 
mod
->
d©a_ä“
 = 
NULL
;

121 
â_¡ruù
 = 
	`£chk_â_Ãw
();

122 ià(!
â_¡ruù
) {

123 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

124 
”ºo
 = 
ENOMEM
;

127 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_PRINT
);

128 ià(!
â_¡ruù
->
Çme
) {

129 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

130 
”ºo
 = 
ENOMEM
;

133 
â_¡ruù
->
â
 = 
©Œibs_wo_ruËs_´št
;

134 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
) < 0) {

135 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

136 
”ºo
 = 
ENOMEM
;

140 
â_¡ruù
 = 
	`£chk_â_Ãw
();

141 ià(!
â_¡ruù
) {

142 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

143 
”ºo
 = 
ENOMEM
;

146 
â_¡ruù
->
Çme
 = 
	`¡rdup
("get_list");

147 ià(!
â_¡ruù
->
Çme
) {

148 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

149 
”ºo
 = 
ENOMEM
;

152 
â_¡ruù
->
â
 = &
©Œibs_wo_ruËs_g‘_li¡
;

153 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
) < 0) {

154 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

155 
”ºo
 = 
ENOMEM
;

160 
	}
}

165 
©Œibs_wo_ruËs_š™
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

167 ià(!
	gmod
 || !
	gpŞicy
) {

168 
ERR
(
pŞicy
, "%s", "Invalid…arameters");

169 
	g”ºo
 = 
EINVAL
;

172 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

173 
ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

174 
	g”ºo
 = 
EINVAL
;

178 
	gmod
->
	gd©a
 = 
NULL
;

187 
©Œibs_wo_ruËs_run
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

189 
£chk_»suÉ_t
 *
	g»s
 = 
NULL
;

190 
£chk_™em_t
 *
	g™em
 = 
NULL
;

191 
£chk_´oof_t
 *
	g´oof
 = 
NULL
;

192 
size_t
 
	gi
;

193 
­Ş_veùÜ_t
 *
	g©Œ_veùÜ
;

194 
­Ş_rŞe_qu”y_t
 *
	grŞe_qu”y
 = 
NULL
;

195 
­Ş_avruË_qu”y_t
 *
	gavruË_qu”y
 = 
NULL
;

196 
­Ş_‹ruË_qu”y_t
 *
	g‹ruË_qu”y
 = 
NULL
;

197 
­Ş_veùÜ_t
 *
	gavruË_veùÜ
;

198 
­Ş_veùÜ_t
 *
	g‹ruË_veùÜ
;

199 
­Ş_veùÜ_t
 *
	grŞe_veùÜ
;

200 
qpŞ_™”©Ü_t
 *
	gcÚ¡¿št_™”
;

201 
qpŞ_™”©Ü_t
 *
	gnode_™”
 = 
NULL
;

202 
qpŞ_™”©Ü_t
 *
	gÇme_™”
 = 
NULL
;

203 
qpŞ_pŞicy_t
 *
	gq
 = 
­Ş_pŞicy_g‘_qpŞ
(
pŞicy
);

204 
	gfound
 = 0, 
	g”rÜ
 = 0;

206 ià(!
	gmod
 || !
	gpŞicy
) {

207 
ERR
(
pŞicy
, "%s", "Invalid…arameters");

208 
	g”ºo
 = 
EINVAL
;

211 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

212 
ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

213 
	g”ºo
 = 
EINVAL
;

218 ià(
	gmod
->
	g»suÉ
)

221 
	g»s
 = 
£chk_»suÉ_Ãw
();

222 ià(!
	g»s
) {

223 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

224 
	g”ºo
 = 
ENOMEM
;

227 
	g»s
->
	g‹¡_Çme
 = 
¡rdup
(
mod_Çme
);

228 ià(!
	g»s
->
	g‹¡_Çme
) {

229 
	g”rÜ
 = 
”ºo
;

230 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

231 
	g©Œibs_wo_ruËs_run_ç
;

233 
	g»s
->
	g™em_ty³
 = 
SECHK_ITEM_ATTRIB
;

234 ià(!(
	g»s
->
	g™ems
 = 
­Ş_veùÜ_ü—‹
(
£chk_™em_ä“
))) {

235 
”rÜ
 = 
”ºo
;

236 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

237 
	g©Œibs_wo_ruËs_run_ç
;

240 ià(!(
	gavruË_qu”y
 = 
­Ş_avruË_qu”y_ü—‹
())) {

241 
”rÜ
 = 
”ºo
;

242 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

243 
	g©Œibs_wo_ruËs_run_ç
;

245 ià(!(
	g‹ruË_qu”y
 = 
­Ş_‹ruË_qu”y_ü—‹
())) {

246 
”rÜ
 = 
”ºo
;

247 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

248 
	g©Œibs_wo_ruËs_run_ç
;

250 ià(!(
	grŞe_qu”y
 = 
­Ş_rŞe_qu”y_ü—‹
())) {

251 
”rÜ
 = 
”ºo
;

252 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

253 
	g©Œibs_wo_ruËs_run_ç
;

256 
­Ş_©Œ_g‘_by_qu”y
(
pŞicy
, 
NULL
, &
©Œ_veùÜ
);

257 
	gi
 = 0; i < 
­Ş_veùÜ_g‘_size
(
©Œ_veùÜ
); i++) {

258 
qpŞ_ty³_t
 *
	g©Œ
;

259 cÚ¡ *
	g©Œ_Çme
;

260 
	g©Œ
 = 
­Ş_veùÜ_g‘_–em’t
(
©Œ_veùÜ
, 
i
);

261 
qpŞ_ty³_g‘_Çme
(
q
, 
©Œ
, &
©Œ_Çme
);

264 
­Ş_avruË_qu”y_£t_sourû
(
pŞicy
, 
avruË_qu”y
, 
©Œ_Çme
, 0);

265 
­Ş_avruË_g‘_by_qu”y
(
pŞicy
, 
avruË_qu”y
, &
avruË_veùÜ
);

266 ià(
­Ş_veùÜ_g‘_size
(
avruË_veùÜ
) > 0) {

267 
­Ş_veùÜ_de¡roy
(&
avruË_veùÜ
);

270 
­Ş_veùÜ_de¡roy
(&
avruË_veùÜ
);

272 
­Ş_avruË_qu”y_£t_sourû
(
pŞicy
, 
avruË_qu”y
, 
NULL
, 0);

273 
­Ş_avruË_qu”y_£t_rg‘
(
pŞicy
, 
avruË_qu”y
, 
©Œ_Çme
, 0);

274 
­Ş_avruË_g‘_by_qu”y
(
pŞicy
, 
avruË_qu”y
, &
avruË_veùÜ
);

275 ià(
­Ş_veùÜ_g‘_size
(
avruË_veùÜ
) > 0) {

276 
­Ş_veùÜ_de¡roy
(&
avruË_veùÜ
);

279 
­Ş_avruË_qu”y_£t_rg‘
(
pŞicy
, 
avruË_qu”y
, 
NULL
, 0);

280 
­Ş_veùÜ_de¡roy
(&
avruË_veùÜ
);

283 
­Ş_‹ruË_qu”y_£t_sourû
(
pŞicy
, 
‹ruË_qu”y
, 
©Œ_Çme
, 0);

284 
­Ş_‹ruË_g‘_by_qu”y
(
pŞicy
, 
‹ruË_qu”y
, &
‹ruË_veùÜ
);

285 ià(
­Ş_veùÜ_g‘_size
(
‹ruË_veùÜ
) > 0) {

286 
­Ş_veùÜ_de¡roy
(&
‹ruË_veùÜ
);

289 
­Ş_veùÜ_de¡roy
(&
‹ruË_veùÜ
);

291 
­Ş_‹ruË_qu”y_£t_sourû
(
pŞicy
, 
‹ruË_qu”y
, 
NULL
, 0);

292 
­Ş_‹ruË_qu”y_£t_rg‘
(
pŞicy
, 
‹ruË_qu”y
, 
©Œ_Çme
, 0);

293 
­Ş_‹ruË_g‘_by_qu”y
(
pŞicy
, 
‹ruË_qu”y
, &
‹ruË_veùÜ
);

294 ià(
­Ş_veùÜ_g‘_size
(
‹ruË_veùÜ
) > 0) {

295 
­Ş_veùÜ_de¡roy
(&
‹ruË_veùÜ
);

298 
­Ş_‹ruË_qu”y_£t_rg‘
(
pŞicy
, 
‹ruË_qu”y
, 
NULL
, 0);

299 
­Ş_veùÜ_de¡roy
(&
‹ruË_veùÜ
);

302 
­Ş_rŞe_qu”y_£t_ty³
(
pŞicy
, 
rŞe_qu”y
, 
©Œ_Çme
);

303 
­Ş_rŞe_g‘_by_qu”y
(
pŞicy
, 
rŞe_qu”y
, &
rŞe_veùÜ
);

304 ià(
­Ş_veùÜ_g‘_size
(
rŞe_veùÜ
) > 0) {

305 
­Ş_veùÜ_de¡roy
(&
rŞe_veùÜ
);

308 
­Ş_veùÜ_de¡roy
(&
rŞe_veùÜ
);

311 
	gcÚ¡¿št_™”
 = 
NULL
;

312 
	gnode_™”
 = 
NULL
;

313 
	gÇme_™”
 = 
NULL
;

314 
	gfound
 = 0;

315 
qpŞ_pŞicy_g‘_cÚ¡¿št_™”
(
q
, &
cÚ¡¿št_™”
);

316 ; !
qpŞ_™”©Ü_’d
(
cÚ¡¿št_™”
); 
qpŞ_™”©Ü_Ãxt
(constraint_iter)) {

317 
qpŞ_cÚ¡¿št_t
 *
	gcÚ¡¿št
;

319 
qpŞ_™”©Ü_g‘_™em
(
cÚ¡¿št_™”
, (**)&
cÚ¡¿št
);

320 
qpŞ_cÚ¡¿št_g‘_ex´_™”
(
q
, 
cÚ¡¿št
, &
node_™”
);

322 ; !
qpŞ_™”©Ü_’d
(
node_™”
); 
qpŞ_™”©Ü_Ãxt
(node_iter)) {

323 
qpŞ_cÚ¡¿št_ex´_node_t
 *
	gcÚ¡¿št_node
;

324 
ušt32_t
 
	gnode_ty³
;

326 
qpŞ_™”©Ü_g‘_™em
(
node_™”
, (**)&
cÚ¡¿št_node
);

327 
qpŞ_cÚ¡¿št_ex´_node_g‘_ex´_ty³
(
q
, 
cÚ¡¿št_node
, &
node_ty³
);

329 ià(
	gnode_ty³
 =ğ
QPOL_CEXPR_TYPE_NAMES
) {

330 
qpŞ_cÚ¡¿št_ex´_node_g‘_Çmes_™”
(
q
, 
cÚ¡¿št_node
, &
Çme_™”
);

332 ; !
qpŞ_™”©Ü_’d
(
Çme_™”
); 
qpŞ_™”©Ü_Ãxt
(name_iter)) {

333 *
	gÇme
;

335 
qpŞ_™”©Ü_g‘_™em
(
Çme_™”
, (**)&
Çme
);

336 ià(!
¡rcmp
(
Çme
, 
©Œ_Çme
)) {

337 
	gfound
 = 1;

338 
ä“
(
Çme
);

339 
	gÇme
 = 
NULL
;

342 
ä“
(
Çme
);

343 
	gÇme
 = 
NULL
;

345 
qpŞ_™”©Ü_de¡roy
(&
Çme_™”
);

346 ià(
	gfound
)

350 
qpŞ_™”©Ü_de¡roy
(&
node_™”
);

351 
ä“
(
cÚ¡¿št
);

352 ià(
	gfound
)

355 
qpŞ_™”©Ü_de¡roy
(&
cÚ¡¿št_™”
);

356 ià(
	gfound
)

360 
	g™em
 = 
£chk_™em_Ãw
(
NULL
);

361 ià(!
	g™em
) {

362 
	g”rÜ
 = 
”ºo
;

363 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

364 
	g©Œibs_wo_ruËs_run_ç
;

366 
	g™em
->
	g‹¡_»suÉ
 = 1;

367 
	g™em
->™em = (*)
©Œ
;

368 
	g´oof
 = 
£chk_´oof_Ãw
(
NULL
);

369 ià(!
	g´oof
) {

370 
	g”rÜ
 = 
”ºo
;

371 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

372 
	g©Œibs_wo_ruËs_run_ç
;

374 
	g´oof
->
	gty³
 = 
SECHK_ITEM_ATTRIB
;

375 
	g´oof
->
	g‹xt
 = 
¡rdup
("attribute was‚ot used in‡ny„ules.");

376 ià(!
	g´oof
->
	g‹xt
) {

377 
	g”rÜ
 = 
”ºo
;

378 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

379 
	g©Œibs_wo_ruËs_run_ç
;

381 ià(!
	g™em
->
	g´oof
) {

382 ià(!(
	g™em
->
	g´oof
 = 
­Ş_veùÜ_ü—‹
(
£chk_´oof_ä“
))) {

383 
”rÜ
 = 
”ºo
;

384 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

385 
	g©Œibs_wo_ruËs_run_ç
;

388 ià(
­Ş_veùÜ_­³nd
(
™em
->
´oof
, (*)proof) < 0) {

389 
	g”rÜ
 = 
”ºo
;

390 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

391 
	g©Œibs_wo_ruËs_run_ç
;

393 ià(
­Ş_veùÜ_­³nd
(
»s
->
™ems
, (*)
™em
) < 0) {

394 
	g”rÜ
 = 
”ºo
;

395 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

396 
	g©Œibs_wo_ruËs_run_ç
;

399 
­Ş_avruË_qu”y_de¡roy
(&
avruË_qu”y
);

400 
­Ş_rŞe_qu”y_de¡roy
(&
rŞe_qu”y
);

401 
­Ş_‹ruË_qu”y_de¡roy
(&
‹ruË_qu”y
);

402 
­Ş_veùÜ_de¡roy
(&
©Œ_veùÜ
);

404 
	gmod
->
	g»suÉ
 = 
»s
;

406 ià(
­Ş_veùÜ_g‘_size
(
»s
->
™ems
))

410 
	g©Œibs_wo_ruËs_run_ç
:

411 
£chk_´oof_ä“
(
´oof
);

412 
£chk_™em_ä“
(
™em
);

413 
£chk_»suÉ_de¡roy
(&
»s
);

414 
	g”ºo
 = 
”rÜ
;

420 
©Œibs_wo_ruËs_´št
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

422 
	goutfÜm©
 = 0x00;

423 
£chk_™em_t
 *
	g™em
 = 
NULL
;

424 
£chk_´oof_t
 *
	g´oof
 = 
NULL
;

425 
size_t
 
	gi
 = 0, 
	gj
 = 0, 
	gk
 = 0, 
	gl
 = 0, 
	gnum_™ems
;

426 
qpŞ_ty³_t
 *
	gty³
;

427 
qpŞ_pŞicy_t
 *
	gq
 = 
­Ş_pŞicy_g‘_qpŞ
(
pŞicy
);

428 cÚ¡ *
	gty³_Çme
;

430 ià(!
	gmod
 || !
	gpŞicy
) {

431 
ERR
(
pŞicy
, "%s", "Invalid…arameters");

432 
	g”ºo
 = 
EINVAL
;

435 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

436 
ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

437 
	g”ºo
 = 
EINVAL
;

441 
	goutfÜm©
 = 
mod
->
ouutfÜm©
;

442 
	gnum_™ems
 = 
­Ş_veùÜ_g‘_size
(
mod
->
»suÉ
->
™ems
);

444 ià(!
	gmod
->
	g»suÉ
) {

445 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

446 
	g”ºo
 = 
ENOMEM
;

450 ià(!
	goutfÜm©
 || (outfÜm© & 
	gSECHK_OUT_QUIET
))

453 ià(
	goutfÜm©
 & 
	gSECHK_OUT_STATS
) {

454 
´štf
("Found %zd‡‰ribu‹s.\n", 
num_™ems
);

456 ià(
	goutfÜm©
 & 
	gSECHK_OUT_PROOF
) {

457 
´štf
("\nThe following‡ttributes do‚ot‡ppear in‡ny„ules.\n");

461 ià(
	goutfÜm©
 & 
	gSECHK_OUT_LIST
) {

462 
´štf
("\n");

463 
	gi
 = 0; i < 
	gnum_™ems
; i++) {

464 
	gj
++;

465 
	g™em
 = 
­Ş_veùÜ_g‘_–em’t
(
mod
->
»suÉ
->
™ems
, 
i
);

466 
	gty³
 = 
™em
->item;

467 
qpŞ_ty³_g‘_Çme
(
q
, 
ty³
, &
ty³_Çme
);

468 
	gj
 %= 4;

469 
´štf
("%s%s", 
ty³_Çme
, (*)((
j
 && 
i
 !ğ
num_™ems
 - 1) ? ", " : "\n"));

471 
´štf
("\n");

474 ià(
	goutfÜm©
 & 
	gSECHK_OUT_PROOF
) {

475 
´štf
("\n");

476 
	gk
 = 0; k < 
	gnum_™ems
; k++) {

477 
	g™em
 = 
­Ş_veùÜ_g‘_–em’t
(
mod
->
»suÉ
->
™ems
, 
k
);

478 ià(
	g™em
) {

479 
	gty³
 = 
™em
->item;

480 
qpŞ_ty³_g‘_Çme
(
q
, 
ty³
, &
ty³_Çme
);

481 
´štf
("%s\n", 
ty³_Çme
);

482 
	gl
 = 0;† < 
­Ş_veùÜ_g‘_size
(
™em
->
´oof
);†++) {

483 
	g´oof
 = 
­Ş_veùÜ_g‘_–em’t
(
™em
->
´oof
, 
l
);

484 ià(
	g´oof
)

485 
´štf
("\t%s\n", 
´oof
->
‹xt
);

489 
´štf
("\n");

491 
	gty³
 = 
NULL
;

492 
	gty³_Çme
 = 
NULL
;

497 
©Œibs_wo_ruËs_g‘_li¡
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
 
__©Œibu‹__
 ((
unu£d
)), *
¬g
)

499 
­Ş_veùÜ_t
 **
	gv
 = 
¬g
;

501 ià(!
	gmod
 || !
	g¬g
) {

502 
ERR
(
NULL
, "%s", "Invalid…arameters");

503 
	g”ºo
 = 
EINVAL
;

506 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

507 
ERR
(
NULL
, "WrÚg moduË (%s)", 
mod
->
Çme
);

508 
	g”ºo
 = 
EINVAL
;

511 ià(!
	gmod
->
	g»suÉ
) {

512 
ERR
(
NULL
, "%s", "Module has‚ot been„un");

513 
	g”ºo
 = 
EINVAL
;

517 
	gv
 = &
mod
->
»suÉ
->
™ems
;

	@sechecker/modules/attribs_wo_rules.h

26 #iâdeà
ATTRIBS_WO_RULES


27 
	#ATTRIBS_WO_RULES


	)

29 #ifdef 
__ılu¥lus


34 
	~"£check”.h
"

35 
	~<­Ş/pŞicy.h
>

36 
	~<­Ş/rŞe-qu”y.h
>

37 
	~<­Ş/avruË-qu”y.h
>

38 
	~<­Ş/‹ruË-qu”y.h
>

39 
	~<­Ş/ty³-qu”y.h
>

47 
©Œibs_wo_ruËs_»gi¡”
(
£chk_lib_t
 * 
lib
);

48 
©Œibs_wo_ruËs_š™
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

49 
©Œibs_wo_ruËs_run
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

50 
©Œibs_wo_ruËs_´št
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

57 
©Œibs_wo_ruËs_g‘_li¡
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

59 #ifdef 
__ılu¥lus


	@sechecker/modules/attribs_wo_types.c

26 
	~"©Œibs_wo_ty³s.h
"

28 
	~<¡dio.h
>

29 
	~<¡ršg.h
>

30 
	~<”ºo.h
>

35 cÚ¡ *cÚ¡ 
	gmod_Çme
 = "attribs_wo_types";

39 
	$©Œibs_wo_ty³s_»gi¡”
(
£chk_lib_t
 * 
lib
)

41 
£chk_moduË_t
 *
mod
 = 
NULL
;

42 
£chk_â_t
 *
â_¡ruù
 = 
NULL
;

44 ià(!
lib
) {

45 
	`ERR
(
NULL
, "%s", "No†ibrary");

46 
”ºo
 = 
EINVAL
;

53 
mod
 = 
	`£chk_lib_g‘_moduË
(
mod_Çme
, 
lib
);

54 ià(!
mod
) {

55 
	`ERR
(
NULL
, "%s", "Module unknown");

56 
”ºo
 = 
EINVAL
;

59 
mod
->
·»Á_lib
 = 
lib
;

62 
mod
->
br›f_desütiÚ
 = "attributes with‚oypes";

63 
mod
->
d‘aed_desütiÚ
 =

68 
mod
->
İt_desütiÚ
 =

71 
mod
->
£v”™y
 = 
SECHK_SEV_LOW
;

73 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
»quœem’ts
, 
	`£chk_Çme_v®ue_Ãw
(
SECHK_REQ_POLICY_CAP
, 
SECHK_REQ_CAP_ATTRIB_NAMES
)) < 0) {

74 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

75 
”ºo
 = 
ENOMEM
;

80 
â_¡ruù
 = 
	`£chk_â_Ãw
();

81 ià(!
â_¡ruù
) {

82 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

83 
”ºo
 = 
ENOMEM
;

86 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_INIT
);

87 ià(!
â_¡ruù
->
Çme
) {

88 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

89 
”ºo
 = 
ENOMEM
;

92 
â_¡ruù
->
â
 = 
©Œibs_wo_ty³s_š™
;

93 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
) < 0) {

94 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

95 
”ºo
 = 
ENOMEM
;

99 
â_¡ruù
 = 
	`£chk_â_Ãw
();

100 ià(!
â_¡ruù
) {

101 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

102 
”ºo
 = 
ENOMEM
;

105 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_RUN
);

106 ià(!
â_¡ruù
->
Çme
) {

107 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

108 
”ºo
 = 
ENOMEM
;

111 
â_¡ruù
->
â
 = 
©Œibs_wo_ty³s_run
;

112 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
) < 0) {

113 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

114 
”ºo
 = 
ENOMEM
;

118 
mod
->
d©a_ä“
 = 
NULL
;

120 
â_¡ruù
 = 
	`£chk_â_Ãw
();

121 ià(!
â_¡ruù
) {

122 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

123 
”ºo
 = 
ENOMEM
;

126 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_PRINT
);

127 ià(!
â_¡ruù
->
Çme
) {

128 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

129 
”ºo
 = 
ENOMEM
;

132 
â_¡ruù
->
â
 = 
©Œibs_wo_ty³s_´št
;

133 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
) < 0) {

134 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

135 
”ºo
 = 
ENOMEM
;

139 
â_¡ruù
 = 
	`£chk_â_Ãw
();

140 ià(!
â_¡ruù
) {

141 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

142 
”ºo
 = 
ENOMEM
;

145 
â_¡ruù
->
Çme
 = 
	`¡rdup
("get_list");

146 ià(!
â_¡ruù
->
Çme
) {

147 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

148 
”ºo
 = 
ENOMEM
;

151 
â_¡ruù
->
â
 = 
©Œibs_wo_ty³s_g‘_li¡
;

152 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
) < 0) {

153 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

154 
”ºo
 = 
ENOMEM
;

159 
	}
}

164 
©Œibs_wo_ty³s_š™
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹
((
unu£d
)))

166 ià(!
	gmod
 || !
	gpŞicy
) {

167 
ERR
(
pŞicy
, "%s", "Invalid…arameters");

168 
	g”ºo
 = 
EINVAL
;

171 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

172 
ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

173 
	g”ºo
 = 
EINVAL
;

177 
	gmod
->
	gd©a
 = 
NULL
;

185 
©Œibs_wo_ty³s_run
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹
((
unu£d
)))

187 
£chk_»suÉ_t
 *
	g»s
 = 
NULL
;

188 
£chk_™em_t
 *
	g™em
 = 
NULL
;

189 
£chk_´oof_t
 *
	g´oof
 = 
NULL
;

190 
size_t
 
	gi
;

191 
­Ş_veùÜ_t
 *
	g©Œ_veùÜ
 = 
NULL
;

192 
qpŞ_™”©Ü_t
 *
	gty³s
 = 
NULL
;

193 
qpŞ_pŞicy_t
 *
	gq
 = 
­Ş_pŞicy_g‘_qpŞ
(
pŞicy
);

194 
	g”rÜ
 = 0;

196 ià(!
	gmod
 || !
	gpŞicy
) {

197 
ERR
(
pŞicy
, "%s", "Invalid…arameters");

198 
	g”ºo
 = 
EINVAL
;

201 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

202 
ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

203 
	g”ºo
 = 
EINVAL
;

208 ià(
	gmod
->
	g»suÉ
)

211 
	g»s
 = 
£chk_»suÉ_Ãw
();

212 ià(!
	g»s
) {

213 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

214 
	g”ºo
 = 
ENOMEM
;

217 
	g»s
->
	g‹¡_Çme
 = 
¡rdup
(
mod_Çme
);

218 ià(!
	g»s
->
	g‹¡_Çme
) {

219 
	g”rÜ
 = 
”ºo
;

220 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

221 
	g©Œibs_wo_ty³s_run_ç
;

223 
	g»s
->
	g™em_ty³
 = 
SECHK_ITEM_ATTRIB
;

224 ià(!(
	g»s
->
	g™ems
 = 
­Ş_veùÜ_ü—‹
(
£chk_™em_ä“
))) {

225 
”rÜ
 = 
”ºo
;

226 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

227 
	g©Œibs_wo_ty³s_run_ç
;

230 
­Ş_©Œ_g‘_by_qu”y
(
pŞicy
, 
NULL
, &
©Œ_veùÜ
);

231 
	gi
 = 0; i < 
­Ş_veùÜ_g‘_size
(
©Œ_veùÜ
); i++) {

232 
qpŞ_ty³_t
 *
	g©Œ
;

233 cÚ¡ *
	g©Œ_Çme
;

234 
	g©_’d
;

236 
	g©Œ
 = 
­Ş_veùÜ_g‘_–em’t
(
©Œ_veùÜ
, 
i
);

237 
qpŞ_ty³_g‘_Çme
(
q
, 
©Œ
, &
©Œ_Çme
);

238 
qpŞ_ty³_g‘_ty³_™”
(
q
, 
©Œ
, &
ty³s
);

239 
	g©_’d
 = 
qpŞ_™”©Ü_’d
(
ty³s
);

240 
qpŞ_™”©Ü_de¡roy
(&
ty³s
);

241 ià(!
	g©_’d
)

244 
	g´oof
 = 
£chk_´oof_Ãw
(
NULL
);

245 ià(!
	g´oof
) {

246 
	g”rÜ
 = 
”ºo
;

247 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

248 
	g©Œibs_wo_ty³s_run_ç
;

250 
	g´oof
->
	gty³
 = 
SECHK_ITEM_ATTRIB
;

251 
	g´oof
->
	g‹xt
 = (*)
ÿÎoc
(
¡¾’
("©Œibu‹ ha nØty³s"è+ sŒËn(
©Œ_Çme
) + 1, ());

252 
¥rštf
(
´oof
->
‹xt
, "©Œibu‹ % ha nØty³s", 
©Œ_Çme
);

253 
	g™em
 = 
£chk_™em_Ãw
(
NULL
);

254 ià(!
	g™em
) {

255 
	g”rÜ
 = 
”ºo
;

256 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

257 
	g©Œibs_wo_ty³s_run_ç
;

259 ià(!
	g™em
->
	g´oof
) {

260 ià(!(
	g™em
->
	g´oof
 = 
­Ş_veùÜ_ü—‹
(
£chk_´oof_ä“
))) {

261 
”rÜ
 = 
”ºo
;

262 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

263 
	g©Œibs_wo_ty³s_run_ç
;

266 
	g™em
->™em = (*)
©Œ
;

267 
	g™em
->
	g‹¡_»suÉ
 = 1;

268 ià(
­Ş_veùÜ_­³nd
(
™em
->
´oof
, (*)proof) < 0) {

269 
	g”rÜ
 = 
”ºo
;

270 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

271 
	g©Œibs_wo_ty³s_run_ç
;

273 ià(
­Ş_veùÜ_­³nd
(
»s
->
™ems
, (*)
™em
) < 0) {

274 
	g”rÜ
 = 
”ºo
;

275 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

276 
	g©Œibs_wo_ty³s_run_ç
;

279 
qpŞ_™”©Ü_de¡roy
(&
ty³s
);

280 
­Ş_veùÜ_de¡roy
(&
©Œ_veùÜ
);

282 
	gmod
->
	g»suÉ
 = 
»s
;

284 ià(
­Ş_veùÜ_g‘_size
(
»s
->
™ems
))

288 
	g©Œibs_wo_ty³s_run_ç
:

289 
£chk_´oof_ä“
(
´oof
);

290 
£chk_™em_ä“
(
™em
);

291 
£chk_»suÉ_de¡roy
(&
»s
);

292 
	g”ºo
 = 
”rÜ
;

298 
©Œibs_wo_ty³s_´št
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

300 
	goutfÜm©
 = 0x00;

301 
£chk_™em_t
 *
	g™em
 = 
NULL
;

302 
£chk_´oof_t
 *
	g´oof
 = 
NULL
;

303 
size_t
 
	gi
 = 0, 
	gj
 = 0, 
	gk
 = 0, 
	gl
 = 0, 
	gnum_™ems
;

304 
qpŞ_ty³_t
 *
	gty³
;

305 
qpŞ_pŞicy_t
 *
	gq
 = 
­Ş_pŞicy_g‘_qpŞ
(
pŞicy
);

306 cÚ¡ *
	gty³_Çme
;

308 ià(!
	gmod
 || !
	gpŞicy
) {

309 
ERR
(
pŞicy
, "%s", "Invalid…arameters");

310 
	g”ºo
 = 
EINVAL
;

313 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

314 
ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

315 
	g”ºo
 = 
EINVAL
;

319 
	goutfÜm©
 = 
mod
->
ouutfÜm©
;

320 
	gnum_™ems
 = 
­Ş_veùÜ_g‘_size
(
mod
->
»suÉ
->
™ems
);

322 ià(!
	gmod
->
	g»suÉ
) {

323 
ERR
(
pŞicy
, "%s", "Module has‚ot been„un");

324 
	g”ºo
 = 
EINVAL
;

328 ià(!
	goutfÜm©
 || (outfÜm© & 
	gSECHK_OUT_QUIET
))

332 ià(
	goutfÜm©
 & 
	gSECHK_OUT_STATS
) {

333 
´štf
("Found %zd‡‰ribu‹s.\n", 
num_™ems
);

335 ià(
	goutfÜm©
 & 
	gSECHK_OUT_PROOF
) {

336 
´štf
("\nThe following‡ttributes‡re‚ot‡ssociated with‡nyypes.\n");

340 ià(
	goutfÜm©
 & 
	gSECHK_OUT_LIST
) {

341 
´štf
("\n");

342 
	gi
 = 0; i < 
	gnum_™ems
; i++) {

343 
	gj
++;

344 
	g™em
 = 
­Ş_veùÜ_g‘_–em’t
(
mod
->
»suÉ
->
™ems
, 
i
);

345 
	gty³
 = 
™em
->item;

346 
qpŞ_ty³_g‘_Çme
(
q
, 
ty³
, &
ty³_Çme
);

347 
	gj
 %= 4;

348 
´štf
("%s%s", 
ty³_Çme
, (*)((
j
 && 
i
 !ğ
num_™ems
 - 1) ? ", " : "\n"));

350 
´štf
("\n");

353 ià(
	goutfÜm©
 & 
	gSECHK_OUT_PROOF
) {

354 
´štf
("\n");

355 
	gk
 = 0; k < 
	gnum_™ems
; k++) {

356 
	g™em
 = 
­Ş_veùÜ_g‘_–em’t
(
mod
->
»suÉ
->
™ems
, 
k
);

357 ià(
	g™em
) {

358 
	gty³
 = 
™em
->item;

359 
qpŞ_ty³_g‘_Çme
(
q
, 
ty³
, &
ty³_Çme
);

360 
´štf
("%s\n", 
ty³_Çme
);

361 
	gl
 = 0;† < 
­Ş_veùÜ_g‘_size
(
™em
->
´oof
);†++) {

362 
	g´oof
 = 
­Ş_veùÜ_g‘_–em’t
(
™em
->
´oof
, 
l
);

363 ià(
	g´oof
)

364 
´štf
("\t%s\n", 
´oof
->
‹xt
);

368 
´štf
("\n");

370 
	gty³
 = 
NULL
;

371 
	gty³_Çme
 = 
NULL
;

376 
©Œibs_wo_ty³s_g‘_li¡
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞciy
 
__©Œibu‹__
 ((
unu£d
)), *
¬g
)

378 
­Ş_veùÜ_t
 **
	gv
 = 
¬g
;

380 ià(!
	gmod
 || !
	g¬g
) {

381 
ERR
(
NULL
, "%s", "Invalid…arameters");

382 
	g”ºo
 = 
EINVAL
;

385 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

386 
ERR
(
NULL
, "WrÚg moduË (%s)", 
mod
->
Çme
);

387 
	g”ºo
 = 
EINVAL
;

390 ià(!
	gmod
->
	g»suÉ
) {

391 
ERR
(
NULL
, "%s", "Module has‚ot been„un");

392 
	g”ºo
 = 
EINVAL
;

396 
	gv
 = &
mod
->
»suÉ
->
™ems
;

	@sechecker/modules/attribs_wo_types.h

26 #iâdeà
ATTRIBS_WO_TYPES


27 
	#ATTRIBS_WO_TYPES


	)

29 #ifdef 
__ılu¥lus


34 
	~"£check”.h
"

35 
	~<­Ş/pŞicy.h
>

36 
	~<­Ş/ty³-qu”y.h
>

38 
©Œibs_wo_ty³s_»gi¡”
(
£chk_lib_t
 * 
lib
);

39 
©Œibs_wo_ty³s_š™
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

40 
©Œibs_wo_ty³s_run
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

41 
©Œibs_wo_ty³s_´št
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

42 
©Œibs_wo_ty³s_g‘_li¡
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

44 #ifdef 
__ılu¥lus


	@sechecker/modules/domain_and_file.c

26 
	~"domaš_ªd_fe.h
"

28 
	~<¡dio.h
>

29 
	~<¡ršg.h
>

30 
	~<”ºo.h
>

32 cÚ¡ *cÚ¡ 
	gmod_Çme
 = "domain_and_file";

34 
	$domaš_ªd_fe_»gi¡”
(
£chk_lib_t
 * 
lib
)

36 
£chk_moduË_t
 *
mod
 = 
NULL
;

37 
£chk_â_t
 *
â_¡ruù
 = 
NULL
;

38 
£chk_Çme_v®ue_t
 *
nv
 = 
NULL
;

40 ià(!
lib
) {

41 
	`ERR
(
NULL
, "%s", "No†ibrary");

42 
”ºo
 = 
EINVAL
;

46 
mod
 = 
	`£chk_lib_g‘_moduË
(
mod_Çme
, 
lib
);

47 ià(!
mod
) {

48 
	`ERR
(
NULL
, "%s", "Module unknown");

49 
”ºo
 = 
EINVAL
;

52 
mod
->
·»Á_lib
 = 
lib
;

55 
mod
->
br›f_desütiÚ
 = "typesreated‡s‡ domain‡nd fileype";

56 
mod
->
d‘aed_desütiÚ
 =

63 
mod
->
İt_desütiÚ
 = "Module„equirements:\n" "‡ttribute‚ames\n"

66 
mod
->
£v”™y
 = 
SECHK_SEV_LOW
;

68 
nv
 = 
	`£chk_Çme_v®ue_Ãw
(
SECHK_REQ_POLICY_CAP
, 
SECHK_REQ_CAP_ATTRIB_NAMES
);

69 
	`­Ş_veùÜ_­³nd
(
mod
->
»quœem’ts
, (*)
nv
);

70 
nv
 = 
	`£chk_Çme_v®ue_Ãw
(
SECHK_REQ_FILE_CONTEXTS
, 
NULL
);

71 
	`­Ş_veùÜ_­³nd
(
mod
->
»quœem’ts
, (*)
nv
);

74 
	`­Ş_veùÜ_­³nd
(
mod
->
d•’d’c›s
, 
	`£chk_Çme_v®ue_Ãw
("module", "find_domains"));

75 
	`­Ş_veùÜ_­³nd
(
mod
->
d•’d’c›s
, 
	`£chk_Çme_v®ue_Ãw
("module", "find_file_types"));

78 
â_¡ruù
 = 
	`£chk_â_Ãw
();

79 ià(!
â_¡ruù
) {

80 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

81 
”ºo
 = 
ENOMEM
;

84 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_INIT
);

85 ià(!
â_¡ruù
->
Çme
) {

86 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

87 
”ºo
 = 
ENOMEM
;

90 
â_¡ruù
->
â
 = &
domaš_ªd_fe_š™
;

91 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
) < 0) {

92 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

93 
”ºo
 = 
ENOMEM
;

97 
â_¡ruù
 = 
	`£chk_â_Ãw
();

98 ià(!
â_¡ruù
) {

99 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

100 
”ºo
 = 
ENOMEM
;

103 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_RUN
);

104 ià(!
â_¡ruù
->
Çme
) {

105 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

106 
”ºo
 = 
ENOMEM
;

109 
â_¡ruù
->
â
 = 
domaš_ªd_fe_run
;

110 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
) < 0) {

111 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

112 
”ºo
 = 
ENOMEM
;

116 
mod
->
d©a_ä“
 = 
NULL
;

118 
â_¡ruù
 = 
	`£chk_â_Ãw
();

119 ià(!
â_¡ruù
) {

120 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

121 
”ºo
 = 
ENOMEM
;

124 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_PRINT
);

125 ià(!
â_¡ruù
->
Çme
) {

126 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

127 
”ºo
 = 
ENOMEM
;

130 
â_¡ruù
->
â
 = 
domaš_ªd_fe_´št
;

131 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
) < 0) {

132 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

133 
”ºo
 = 
ENOMEM
;

138 
	}
}

140 
domaš_ªd_fe_š™
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

142 ià(!
	gmod
 || !
	gpŞicy
) {

143 
ERR
(
pŞicy
, "%s", "Invalid…arameters");

144 
	g”ºo
 = 
EINVAL
;

147 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

148 
ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

149 
	g”ºo
 = 
EINVAL
;

153 
	gmod
->
	gd©a
 = 
NULL
;

158 
domaš_ªd_fe_run
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

160 
£chk_»suÉ_t
 *
	g»s
 = 
NULL
;

161 
£chk_™em_t
 *
	g™em
 = 
NULL
;

162 
£chk_´oof_t
 *
	g´oof
 = 
NULL
;

163 
£chk_»suÉ_t
 *
	gdomaš_»s
 = 
NULL
, *
	gfe_ty³_»s
 = NULL;

164 
size_t
 
	gi
, 
	gj
, 
	gk
;

165 
£chk_mod_â_t
 
	grun_â
 = 
NULL
;

166 
£chk_Çme_v®ue_t
 *
	gd•
 = 
NULL
;

167 
­Ş_veùÜ_t
 *
	gdomaš_veùÜ
;

168 
­Ş_veùÜ_t
 *
	gty³_veùÜ
;

169 
qpŞ_pŞicy_t
 *
	gq
 = 
­Ş_pŞicy_g‘_qpŞ
(
pŞicy
);

170 
	g”rÜ
 = 0;

172 ià(!
	gmod
 || !
	gpŞicy
) {

173 
ERR
(
pŞicy
, "%s", "Invalid…arameters");

174 
	g”ºo
 = 
EINVAL
;

177 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

178 
ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

179 
	g”ºo
 = 
EINVAL
;

184 ià(
	gmod
->
	g»suÉ
)

187 
	g»s
 = 
£chk_»suÉ_Ãw
();

188 ià(!
	g»s
) {

189 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

190 
	g”ºo
 = 
ENOMEM
;

193 
	g»s
->
	g‹¡_Çme
 = 
¡rdup
(
mod_Çme
);

194 ià(!
	g»s
->
	g‹¡_Çme
) {

195 
	g”rÜ
 = 
”ºo
;

196 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

197 
	gdomaš_ªd_fe_run_ç
;

199 
	g»s
->
	g™em_ty³
 = 
SECHK_ITEM_TYPE
;

200 ià(!(
	g»s
->
	g™ems
 = 
­Ş_veùÜ_ü—‹
(
£chk_™em_ä“
))) {

201 
”rÜ
 = 
”ºo
;

202 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

203 
	gdomaš_ªd_fe_run_ç
;

207 
	gi
 = 0; i < 
­Ş_veùÜ_g‘_size
(
mod
->
d•’d’c›s
); i++) {

208 
	gd•
 = 
­Ş_veùÜ_g‘_–em’t
(
mod
->
d•’d’c›s
, 
i
);

209 
	grun_â
 = 
£chk_lib_g‘_moduË_funùiÚ
(
d•
->
v®ue
, 
SECHK_MOD_FN_RUN
, 
mod
->
·»Á_lib
);

210 
run_â
(
£chk_lib_g‘_moduË
(
d•
->
v®ue
, 
mod
->
·»Á_lib
), 
pŞicy
, 
NULL
);

214 
	gdomaš_»s
 = 
£chk_lib_g‘_moduË_»suÉ
("fšd_domašs", 
mod
->
·»Á_lib
);

215 ià(!
	gdomaš_»s
) {

216 
	g”rÜ
 = 
”ºo
;

217 
ERR
(
pŞicy
, "%s", "Unableo get„esults for module find_domains");

218 
	gdomaš_ªd_fe_run_ç
;

220 
	gfe_ty³_»s
 = 
£chk_lib_g‘_moduË_»suÉ
("fšd_fe_ty³s", 
mod
->
·»Á_lib
);

221 ià(!
	gfe_ty³_»s
) {

222 
	g”rÜ
 = 
”ºo
;

223 
ERR
(
pŞicy
, "%s", "Unableo get„esults for module find_file_types");

224 
	gdomaš_ªd_fe_run_ç
;

228 
	gdomaš_veùÜ
 = (
­Ş_veùÜ_t
 *è
domaš_»s
->
™ems
;

229 
	gty³_veùÜ
 = (
­Ş_veùÜ_t
 *è
fe_ty³_»s
->
™ems
;

232 
	gi
 = 0; i < 
­Ş_veùÜ_g‘_size
(
ty³_veùÜ
); i++) {

233 
£chk_™em_t
 *
	gty³_™em
;

234 
qpŞ_ty³_t
 *
	gty³
;

235 cÚ¡ *
	gty³_Çme
;

237 
	gty³_™em
 = 
­Ş_veùÜ_g‘_–em’t
(
ty³_veùÜ
, 
i
);

238 
	gty³
 = 
ty³_™em
->
™em
;

239 
qpŞ_ty³_g‘_Çme
(
q
, 
ty³
, &
ty³_Çme
);

240 
	gj
 = 0; j < 
­Ş_veùÜ_g‘_size
(
domaš_veùÜ
); j++) {

241 
£chk_™em_t
 *
	gdomaš_™em
;

242 
qpŞ_ty³_t
 *
	gdomaš
;

243 cÚ¡ *
	gdomaš_Çme
;

245 
	gdomaš_™em
 = 
­Ş_veùÜ_g‘_–em’t
(
domaš_veùÜ
, 
j
);

246 
	gdomaš
 = 
domaš_™em
->
™em
;

247 
qpŞ_ty³_g‘_Çme
(
q
, 
domaš
, &
domaš_Çme
);

248 ià(!
¡rcmp
(
domaš_Çme
, 
ty³_Çme
)) {

249 
	g™em
 = 
£chk_™em_Ãw
(
NULL
);

250 ià(!
	g™em
) {

251 
	g”rÜ
 = 
”ºo
;

252 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

253 
	gdomaš_ªd_fe_run_ç
;

255 
	g™em
->™em = (*)
domaš
;

256 ià(!(
	g™em
->
	g´oof
 = 
­Ş_veùÜ_ü—‹
(
£chk_´oof_ä“
))) {

257 
”rÜ
 = 
”ºo
;

258 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

259 
	gdomaš_ªd_fe_run_ç
;

261 
	gk
 = 0; k < 
­Ş_veùÜ_g‘_size
(
domaš_™em
->
´oof
); k++) {

262 
£chk_´oof_t
 *
	gdomaš_´oof
;

264 
	gdomaš_´oof
 = 
­Ş_veùÜ_g‘_–em’t
(
domaš_™em
->
´oof
, 
k
);

265 
	g´oof
 = 
£chk_´oof_Ãw
(
NULL
);

266 ià(!
	g´oof
) {

267 
	g”rÜ
 = 
”ºo
;

268 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

269 
	gdomaš_ªd_fe_run_ç
;

271 
	g´oof
->
	gty³
 = 
SECHK_ITEM_TYPE
;

272 
	g´oof
->
	g‹xt
 = 
¡rdup
(
domaš_´oof
->
‹xt
);

273 ià(!
	g´oof
->
	g‹xt
) {

274 
	g”rÜ
 = 
”ºo
;

275 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

276 
	gdomaš_ªd_fe_run_ç
;

278 ià(
­Ş_veùÜ_­³nd
(
™em
->
´oof
, (*)proof) < 0) {

279 
	g”rÜ
 = 
”ºo
;

280 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

281 
	gdomaš_ªd_fe_run_ç
;

284 
	gk
 = 0; k < 
­Ş_veùÜ_g‘_size
(
ty³_™em
->
´oof
); k++) {

285 
£chk_´oof_t
 *
	gty³_´oof
;

287 
	gty³_´oof
 = 
­Ş_veùÜ_g‘_–em’t
(
ty³_™em
->
´oof
, 
k
);

288 
	g´oof
 = 
£chk_´oof_Ãw
(
NULL
);

289 ià(!
	g´oof
) {

290 
	g”rÜ
 = 
”ºo
;

291 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

292 
	gdomaš_ªd_fe_run_ç
;

294 
	g´oof
->
	gty³
 = 
SECHK_ITEM_TYPE
;

295 
	g´oof
->
	g‹xt
 = 
¡rdup
(
ty³_´oof
->
‹xt
);

296 ià(!
	g´oof
->
	g‹xt
) {

297 
	g”rÜ
 = 
”ºo
;

298 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

299 
	gdomaš_ªd_fe_run_ç
;

301 ià(
­Ş_veùÜ_­³nd
(
™em
->
´oof
, (*)proof) < 0) {

302 
	g”rÜ
 = 
”ºo
;

303 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

304 
	gdomaš_ªd_fe_run_ç
;

307 ià(
­Ş_veùÜ_­³nd
(
»s
->
™ems
, (*)
™em
) < 0) {

308 
	g”rÜ
 = 
”ºo
;

309 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

310 
	gdomaš_ªd_fe_run_ç
;

316 
	gmod
->
	g»suÉ
 = 
»s
;

318 ià(
­Ş_veùÜ_g‘_size
(
»s
->
™ems
))

322 
	gdomaš_ªd_fe_run_ç
:

323 
£chk_´oof_ä“
(
´oof
);

324 
£chk_™em_ä“
(
™em
);

325 
£chk_»suÉ_de¡roy
(&
»s
);

326 
	g”ºo
 = 
”rÜ
;

330 
domaš_ªd_fe_´št
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

332 
	goutfÜm©
 = 0x00;

333 
£chk_™em_t
 *
	g™em
 = 
NULL
;

334 
£chk_´oof_t
 *
	g´oof
 = 
NULL
;

335 
size_t
 
	gi
 = 0, 
	gj
 = 0, 
	gk
 = 0, 
	gl
 = 0, 
	gnum_™ems
;

336 
qpŞ_ty³_t
 *
	gty³
;

337 
qpŞ_pŞicy_t
 *
	gq
 = 
­Ş_pŞicy_g‘_qpŞ
(
pŞicy
);

338 cÚ¡ *
	gty³_Çme
;

340 ià(!
	gmod
 || !
	gpŞicy
) {

341 
ERR
(
pŞicy
, "%s", "Invalid…arameters");

342 
	g”ºo
 = 
EINVAL
;

345 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

346 
ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

347 
	g”ºo
 = 
EINVAL
;

351 
	goutfÜm©
 = 
mod
->
ouutfÜm©
;

352 
	gnum_™ems
 = 
­Ş_veùÜ_g‘_size
(
mod
->
»suÉ
->
™ems
);

354 ià(!
	gmod
->
	g»suÉ
) {

355 
ERR
(
pŞicy
, "%s", "Module has‚ot been„un");

356 
	g”ºo
 = 
EINVAL
;

360 ià(!
	goutfÜm©
 || (outfÜm© & 
	gSECHK_OUT_QUIET
))

363 ià(
	goutfÜm©
 & 
	gSECHK_OUT_STATS
) {

364 
´štf
("Found %zdy³s.\n", 
num_™ems
);

366 ià(
	goutfÜm©
 & 
	gSECHK_OUT_LIST
) {

367 
´štf
("\n");

368 
	gi
 = 0; i < 
	gnum_™ems
; i++) {

369 
	gj
++;

370 
	gj
 %= 4;

371 
	g™em
 = 
­Ş_veùÜ_g‘_–em’t
(
mod
->
»suÉ
->
™ems
, 
i
);

372 
	gty³
 = (
qpŞ_ty³_t
 *è
™em
->item;

373 
qpŞ_ty³_g‘_Çme
(
q
, 
ty³
, &
ty³_Çme
);

374 
´štf
("%s%s", 
ty³_Çme
, (*)((
j
 && 
i
 !ğ
num_™ems
 - 1) ? ", " : "\n"));

376 
´štf
("\n");

379 ià(
	goutfÜm©
 & 
	gSECHK_OUT_PROOF
) {

380 
´štf
("\n");

381 
	gk
 = 0; k < 
	gnum_™ems
; k++) {

382 
	g™em
 = 
­Ş_veùÜ_g‘_–em’t
(
mod
->
»suÉ
->
™ems
, 
k
);

383 ià(
	g™em
) {

384 
	gty³
 = 
™em
->item;

385 
qpŞ_ty³_g‘_Çme
(
q
, 
ty³
, &
ty³_Çme
);

386 
´štf
("%s\n", (*)
ty³_Çme
);

387 
	gl
 = 0;† < 
­Ş_veùÜ_g‘_size
(
™em
->
´oof
);†++) {

388 
	g´oof
 = 
­Ş_veùÜ_g‘_–em’t
(
™em
->
´oof
, 
l
);

389 ià(
	g´oof
)

390 
´štf
("\t%s\n", 
´oof
->
‹xt
);

394 
´štf
("\n");

	@sechecker/modules/domain_and_file.h

26 #iâdeà
DOMAIN_AND_FILE


27 
	#DOMAIN_AND_FILE


	)

29 #ifdef 
__ılu¥lus


34 
	~"£check”.h
"

35 
	~<­Ş/pŞicy.h
>

37 
domaš_ªd_fe_»gi¡”
(
£chk_lib_t
 * 
lib
);

38 
domaš_ªd_fe_š™
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

39 
domaš_ªd_fe_run
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

40 
domaš_ªd_fe_´št
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

42 #ifdef 
__ılu¥lus


	@sechecker/modules/domains_wo_roles.c

25 
	~"domašs_wo_rŞes.h
"

27 
	~<¡dio.h
>

28 
	~<¡ršg.h
>

29 
	~<”ºo.h
>

34 cÚ¡ *cÚ¡ 
	gmod_Çme
 = "domains_wo_roles";

38 
	$domašs_wo_rŞes_»gi¡”
(
£chk_lib_t
 * 
lib
)

40 
£chk_moduË_t
 *
mod
 = 
NULL
;

41 
£chk_â_t
 *
â_¡ruù
 = 
NULL
;

43 ià(!
lib
) {

44 
	`ERR
(
NULL
, "%s", "No†ibrary");

45 
”ºo
 = 
EINVAL
;

52 
mod
 = 
	`£chk_lib_g‘_moduË
(
mod_Çme
, 
lib
);

53 ià(!
mod
) {

54 
	`ERR
(
NULL
, "%s", "Module unknown");

55 
”ºo
 = 
EINVAL
;

58 
mod
->
·»Á_lib
 = 
lib
;

61 
mod
->
br›f_desütiÚ
 = "domains with‚o„oles";

62 
mod
->
d‘aed_desütiÚ
 =

66 
mod
->
İt_desütiÚ
 =

69 
mod
->
£v”™y
 = 
SECHK_SEV_MED
;

71 
	`­Ş_veùÜ_­³nd
(
mod
->
»quœem’ts
, 
	`£chk_Çme_v®ue_Ãw
(
SECHK_REQ_POLICY_CAP
, 
SECHK_REQ_CAP_ATTRIB_NAMES
));

74 
	`­Ş_veùÜ_­³nd
(
mod
->
d•’d’c›s
, 
	`£chk_Çme_v®ue_Ãw
("module", "find_domains"));

77 
â_¡ruù
 = 
	`£chk_â_Ãw
();

78 ià(!
â_¡ruù
) {

79 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

80 
”ºo
 = 
ENOMEM
;

83 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_INIT
);

84 ià(!
â_¡ruù
->
Çme
) {

85 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

86 
”ºo
 = 
ENOMEM
;

89 
â_¡ruù
->
â
 = 
domašs_wo_rŞes_š™
;

90 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
) < 0) {

91 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

92 
”ºo
 = 
ENOMEM
;

96 
â_¡ruù
 = 
	`£chk_â_Ãw
();

97 ià(!
â_¡ruù
) {

98 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

99 
”ºo
 = 
ENOMEM
;

102 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_RUN
);

103 ià(!
â_¡ruù
->
Çme
) {

104 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

105 
”ºo
 = 
ENOMEM
;

108 
â_¡ruù
->
â
 = 
domašs_wo_rŞes_run
;

109 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
) < 0) {

110 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

111 
”ºo
 = 
ENOMEM
;

115 
mod
->
d©a_ä“
 = 
NULL
;

117 
â_¡ruù
 = 
	`£chk_â_Ãw
();

118 ià(!
â_¡ruù
) {

119 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

120 
”ºo
 = 
ENOMEM
;

123 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_PRINT
);

124 ià(!
â_¡ruù
->
Çme
) {

125 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

126 
”ºo
 = 
ENOMEM
;

129 
â_¡ruù
->
â
 = 
domašs_wo_rŞes_´št
;

130 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
) < 0) {

131 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

132 
”ºo
 = 
ENOMEM
;

137 
	}
}

142 
domašs_wo_rŞes_š™
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

144 ià(!
	gmod
 || !
	gpŞicy
) {

145 
ERR
(
pŞicy
, "%s", "Invalid…arameters");

146 
	g”ºo
 = 
EINVAL
;

149 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

150 
ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

151 
	g”ºo
 = 
EINVAL
;

155 
	gmod
->
	gd©a
 = 
NULL
;

162 
domašs_wo_rŞes_run
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

164 
£chk_»suÉ_t
 *
	g»s
 = 
NULL
;

165 
£chk_™em_t
 *
	g™em
 = 
NULL
;

166 
£chk_´oof_t
 *
	g´oof
 = 
NULL
;

167 
	g»tv
, 
	g”rÜ
;

168 
size_t
 
	gi
;

169 
£chk_moduË_t
 *
	gmod_±r
 = 
NULL
;

170 
£chk_mod_â_t
 
	grun_â
 = 
NULL
;

171 
­Ş_veùÜ_t
 *
	gdomaš_veùÜ
;

172 
­Ş_veùÜ_t
 *
	grŞe_veùÜ
;

173 
qpŞ_pŞicy_t
 *
	gq
 = 
­Ş_pŞicy_g‘_qpŞ
(
pŞicy
);

174 
­Ş_rŞe_qu”y_t
 *
	grŞe_qu”y
 = 
NULL
;

175 
£chk_»suÉ_t
 *
	gfšd_domašs_»s
 = 
NULL
;

177 ià(!
	gmod
 || !
	gpŞicy
) {

178 
ERR
(
pŞicy
, "%s", "Invalid…arameters");

179 
	g”ºo
 = 
EINVAL
;

182 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

183 
ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

184 
	g”ºo
 = 
EINVAL
;

189 ià(
	gmod
->
	g»suÉ
)

192 
	g»s
 = 
£chk_»suÉ_Ãw
();

193 ià(!
	g»s
) {

194 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

195 
	g”ºo
 = 
ENOMEM
;

198 
	g»s
->
	g‹¡_Çme
 = 
¡rdup
(
mod_Çme
);

199 ià(!
	g»s
->
	g‹¡_Çme
) {

200 
	g”rÜ
 = 
”ºo
;

201 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

202 
	gdomašs_wo_rŞes_run_ç
;

204 
	g»s
->
	g™em_ty³
 = 
SECHK_ITEM_TYPE
;

205 ià(!(
	g»s
->
	g™ems
 = 
­Ş_veùÜ_ü—‹
(
£chk_™em_ä“
))) {

206 
”rÜ
 = 
”ºo
;

207 
ERR
(
pŞicy
, "E¼Ü: %s\n", 
¡»¼Ü
(
”rÜ
));

208 
	gdomašs_wo_rŞes_run_ç
;

211 
	grun_â
 = 
£chk_lib_g‘_moduË_funùiÚ
("fšd_domašs", 
SECHK_MOD_FN_RUN
, 
mod
->
·»Á_lib
);

212 ià(!
	grun_â
) {

213 
	g”rÜ
 = 
”ºo
;

214 
ERR
(
pŞicy
, "%s", "Unableo find„un function for module find_domains");

215 
	gdomašs_wo_rŞes_run_ç
;

218 
	g»tv
 = 
run_â
((
mod_±r
 = 
£chk_lib_g‘_moduË
("fšd_domašs", 
mod
->
·»Á_lib
)), 
pŞicy
, 
NULL
);

219 ià(
	g»tv
) {

220 
	g”rÜ
 = 
”ºo
;

221 
ERR
(
pŞicy
, "%s", "Unableo„un module find_domains");

222 
	gdomašs_wo_rŞes_run_ç
;

225 ià(!(
	gfšd_domašs_»s
 = 
£chk_lib_g‘_moduË_»suÉ
("fšd_domašs", 
mod
->
·»Á_lib
))) {

226 
	g”rÜ
 = 
”ºo
;

227 
ERR
(
pŞicy
, "%s", "Unableo get„esults for module find_domains");

228 
	gdomašs_wo_rŞes_run_ç
;

231 
	gdomaš_veùÜ
 = (
­Ş_veùÜ_t
 *è
fšd_domašs_»s
->
™ems
;

233 ià(!(
	grŞe_qu”y
 = 
­Ş_rŞe_qu”y_ü—‹
())) {

234 
”rÜ
 = 
”ºo
;

235 
ERR
(
pŞicy
, "E¼Ü: %s\n", 
¡»¼Ü
(
”rÜ
));

236 
	gdomašs_wo_rŞes_run_ç
;

239 
	gi
 = 0; i < 
­Ş_veùÜ_g‘_size
(
domaš_veùÜ
); i++) {

240 
qpŞ_ty³_t
 *
	gdomaš
;

241 cÚ¡ *
	gdomaš_Çme
;

243 
	g™em
 = 
­Ş_veùÜ_g‘_–em’t
(
domaš_veùÜ
, 
i
);

244 
	gdomaš
 = 
™em
->item;

245 
qpŞ_ty³_g‘_Çme
(
q
, 
domaš
, &
domaš_Çme
);

247 
­Ş_rŞe_qu”y_£t_ty³
(
pŞicy
, 
rŞe_qu”y
, 
domaš_Çme
);

248 
­Ş_rŞe_g‘_by_qu”y
(
pŞicy
, 
rŞe_qu”y
, &
rŞe_veùÜ
);

249 ià(
­Ş_veùÜ_g‘_size
(
rŞe_veùÜ
) > 0) {

250 
­Ş_veùÜ_de¡roy
(&
rŞe_veùÜ
);

253 
­Ş_veùÜ_de¡roy
(&
rŞe_veùÜ
);

255 
	g´oof
 = 
£chk_´oof_Ãw
(
NULL
);

256 ià(!
	g´oof
) {

257 
	g”rÜ
 = 
”ºo
;

258 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

259 
	gdomašs_wo_rŞes_run_ç
;

261 
	g´oof
->
	gty³
 = 
SECHK_ITEM_NONE
;

262 
	g´oof
->
	g‹xt
 = 
¡rdup
("Domain has‚o„ole.\n");

263 ià(!
	g´oof
->
	g‹xt
) {

264 
	g”rÜ
 = 
”ºo
;

265 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

266 
	gdomašs_wo_rŞes_run_ç
;

269 
	g™em
 = 
£chk_™em_Ãw
(
NULL
);

270 ià(!
	g™em
) {

271 
	g”rÜ
 = 
”ºo
;

272 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

273 
	gdomašs_wo_rŞes_run_ç
;

275 
	g™em
->™em = (*)
domaš
;

276 ià(!
	g™em
->
	g´oof
) {

277 ià(!(
	g™em
->
	g´oof
 = 
­Ş_veùÜ_ü—‹
(
£chk_´oof_ä“
))) {

278 
”rÜ
 = 
”ºo
;

279 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

280 
	gdomašs_wo_rŞes_run_ç
;

283 ià(
­Ş_veùÜ_­³nd
(
™em
->
´oof
, (*)proof) < 0) {

284 
	g”rÜ
 = 
”ºo
;

285 
ERR
(
NULL
, "%s", 
¡»¼Ü
(
ENOMEM
));

286 
	gdomašs_wo_rŞes_run_ç
;

288 ià(
­Ş_veùÜ_­³nd
(
»s
->
™ems
, (*)
™em
) < 0) {

289 
	g”rÜ
 = 
”ºo
;

290 
ERR
(
NULL
, "%s", 
¡»¼Ü
(
ENOMEM
));

291 
	gdomašs_wo_rŞes_run_ç
;

294 
­Ş_rŞe_qu”y_de¡roy
(&
rŞe_qu”y
);

295 
	gmod
->
	g»suÉ
 = 
»s
;

297 ià(
­Ş_veùÜ_g‘_size
(
»s
->
™ems
))

301 
	gdomašs_wo_rŞes_run_ç
:

302 
£chk_´oof_ä“
(
´oof
);

303 
£chk_™em_ä“
(
™em
);

304 
£chk_»suÉ_de¡roy
(&
»s
);

305 
	g”ºo
 = 
”rÜ
;

311 
domašs_wo_rŞes_´št
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

313 
	goutfÜm©
 = 0x00;

314 
£chk_™em_t
 *
	g™em
 = 
NULL
;

315 
£chk_´oof_t
 *
	g´oof
 = 
NULL
;

316 
size_t
 
	gi
 = 0, 
	gj
 = 0, 
	gk
 = 0, 
	gl
 = 0, 
	gnum_™ems
;

317 
qpŞ_ty³_t
 *
	gty³
;

318 
qpŞ_pŞicy_t
 *
	gq
 = 
­Ş_pŞicy_g‘_qpŞ
(
pŞicy
);

319 cÚ¡ *
	gty³_Çme
;

321 ià(!
	gmod
 || !
	gpŞicy
) {

322 
ERR
(
pŞicy
, "%s", "Invalid…arameters");

323 
	g”ºo
 = 
EINVAL
;

326 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

327 
ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

328 
	g”ºo
 = 
EINVAL
;

332 
	goutfÜm©
 = 
mod
->
ouutfÜm©
;

333 
	gnum_™ems
 = 
­Ş_veùÜ_g‘_size
(
mod
->
»suÉ
->
™ems
);

335 ià(!
	gmod
->
	g»suÉ
) {

336 
ERR
(
pŞicy
, "%s", "Module has‚ot been„un");

337 
	g”ºo
 = 
EINVAL
;

341 ià(!
	goutfÜm©
 || (outfÜm© & 
	gSECHK_OUT_QUIET
))

344 ià(
	goutfÜm©
 & 
	gSECHK_OUT_STATS
) {

345 
´štf
("Found %zdy³s.\n", 
num_™ems
);

347 ià(
	goutfÜm©
 & 
	gSECHK_OUT_PROOF
) {

348 
´štf
("\nThe followingypes‡re domains but‚ot‡ssociated with‡ny„oles.\n");

352 ià(
	goutfÜm©
 & (
	gSECHK_OUT_LIST
)) {

353 
´štf
("\n");

354 
	gi
 = 0; i < 
	gnum_™ems
; i++) {

355 
	gj
++;

356 
	gj
 %= 4;

357 
	g™em
 = 
­Ş_veùÜ_g‘_–em’t
(
mod
->
»suÉ
->
™ems
, 
i
);

358 
	gty³
 = (
qpŞ_ty³_t
 *è
™em
->item;

359 
qpŞ_ty³_g‘_Çme
(
q
, 
ty³
, &
ty³_Çme
);

360 
´štf
("%s%s", 
ty³_Çme
, (*)((
j
 && 
i
 !ğ
num_™ems
 - 1) ? ", " : "\n"));

362 
´štf
("\n");

365 ià(
	goutfÜm©
 & 
	gSECHK_OUT_PROOF
) {

366 
´štf
("\n");

367 
	gk
 = 0; k < 
	gnum_™ems
; k++) {

368 
	g™em
 = 
­Ş_veùÜ_g‘_–em’t
(
mod
->
»suÉ
->
™ems
, 
k
);

369 ià(
	g™em
) {

370 
	gty³
 = 
™em
->item;

371 
qpŞ_ty³_g‘_Çme
(
q
, 
ty³
, &
ty³_Çme
);

372 
´štf
("%s\n", 
ty³_Çme
);

373 
	gl
 = 0;† < 
­Ş_veùÜ_g‘_size
(
™em
->
´oof
);†++) {

374 
	g´oof
 = 
­Ş_veùÜ_g‘_–em’t
(
™em
->
´oof
, 
l
);

375 ià(
	g´oof
)

376 
´štf
("\t%s\n", 
´oof
->
‹xt
);

380 
´štf
("\n");

382 
	gty³
 = 
NULL
;

383 
	gty³_Çme
 = 
NULL
;

	@sechecker/modules/domains_wo_roles.h

26 #iâdeà
DOMAINS_WO_ROLES


27 
	#DOMAINS_WO_ROLES


	)

29 #ifdef 
__ılu¥lus


34 
	~"£check”.h
"

35 
	~<­Ş/pŞicy.h
>

36 
	~<­Ş/rŞe-qu”y.h
>

38 
domašs_wo_rŞes_»gi¡”
(
£chk_lib_t
 * 
lib
);

39 
domašs_wo_rŞes_š™
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

40 
domašs_wo_rŞes_run
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

41 
domašs_wo_rŞes_´št
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

43 #ifdef 
__ılu¥lus


	@sechecker/modules/find_assoc_types.c

27 
	~"fšd_assoc_ty³s.h
"

29 
	~<¡dio.h
>

30 
	~<¡ršg.h
>

31 
	~<”ºo.h
>

33 cÚ¡ *cÚ¡ 
	gmod_Çme
 = "find_assoc_types";

35 
	$fšd_assoc_ty³s_»gi¡”
(
£chk_lib_t
 * 
lib
)

37 
£chk_moduË_t
 *
mod
 = 
NULL
;

38 
£chk_â_t
 *
â_¡ruù
 = 
NULL
;

40 ià(!
lib
) {

41 
	`ERR
(
NULL
, "%s", "No†ibrary");

42 
”ºo
 = 
EINVAL
;

49 
mod
 = 
	`£chk_lib_g‘_moduË
(
mod_Çme
, 
lib
);

50 ià(!
mod
) {

51 
	`ERR
(
NULL
, "%s", "Module unknown");

52 
”ºo
 = 
EINVAL
;

55 
mod
->
·»Á_lib
 = 
lib
;

58 
mod
->
br›f_desütiÚ
 = "utility module";

59 
mod
->
d‘aed_desütiÚ
 =

62 
mod
->
İt_desütiÚ
 =

64 
mod
->
£v”™y
 = 
SECHK_SEV_NONE
;

67 
â_¡ruù
 = 
	`£chk_â_Ãw
();

68 ià(!
â_¡ruù
) {

69 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

70 
”ºo
 = 
ENOMEM
;

73 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_INIT
);

74 ià(!
â_¡ruù
->
Çme
) {

75 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

76 
”ºo
 = 
ENOMEM
;

79 
â_¡ruù
->
â
 = 
fšd_assoc_ty³s_š™
;

80 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
) < 0) {

81 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

82 
”ºo
 = 
ENOMEM
;

86 
â_¡ruù
 = 
	`£chk_â_Ãw
();

87 ià(!
â_¡ruù
) {

88 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

89 
”ºo
 = 
ENOMEM
;

92 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_RUN
);

93 ià(!
â_¡ruù
->
Çme
) {

94 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

95 
”ºo
 = 
ENOMEM
;

98 
â_¡ruù
->
â
 = 
fšd_assoc_ty³s_run
;

99 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
) < 0) {

100 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

101 
”ºo
 = 
ENOMEM
;

105 
mod
->
d©a_ä“
 = 
NULL
;

107 
â_¡ruù
 = 
	`£chk_â_Ãw
();

108 ià(!
â_¡ruù
) {

109 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

110 
”ºo
 = 
ENOMEM
;

113 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_PRINT
);

114 ià(!
â_¡ruù
->
Çme
) {

115 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

116 
”ºo
 = 
ENOMEM
;

119 
â_¡ruù
->
â
 = 
fšd_assoc_ty³s_´št
;

120 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
) < 0) {

121 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

122 
”ºo
 = 
ENOMEM
;

126 
â_¡ruù
 = 
	`£chk_â_Ãw
();

127 ià(!
â_¡ruù
) {

128 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

129 
”ºo
 = 
ENOMEM
;

132 
â_¡ruù
->
Çme
 = 
	`¡rdup
("get_list");

133 ià(!
â_¡ruù
->
Çme
) {

134 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

135 
”ºo
 = 
ENOMEM
;

138 
â_¡ruù
->
â
 = 
fšd_assoc_ty³s_g‘_li¡
;

139 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
) < 0) {

140 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

141 
”ºo
 = 
ENOMEM
;

146 
	}
}

151 
fšd_assoc_ty³s_š™
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

153 ià(!
	gmod
 || !
	gpŞicy
) {

154 
ERR
(
pŞicy
, "%s", "Invalid…arameters");

155 
	g”ºo
 = 
EINVAL
;

158 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

159 
ERR
(
pŞicy
, "WrÚg moduË (%s)\n", 
mod
->
Çme
);

160 
	g”ºo
 = 
EINVAL
;

164 
	gmod
->
	gd©a
 = 
NULL
;

177 
fšd_assoc_ty³s_run
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

179 
£chk_»suÉ_t
 *
	g»s
 = 
NULL
;

180 
£chk_™em_t
 *
	g™em
 = 
NULL
;

181 
£chk_´oof_t
 *
	g´oof
 = 
NULL
;

182 *
	gbuff
 = 
NULL
;

183 
size_t
 
	gbuff_sz
 = 0;

184 cÚ¡ 
qpŞ_isid_t
 *
	gisid
;

185 cÚ¡ *
	gty³_Çme
 = 
NULL
;

186 cÚ¡ 
qpŞ_ty³_t
 *
	gty³
;

187 cÚ¡ 
qpŞ_cÚ‹xt_t
 *
	gcÚ‹xt
;

188 
qpŞ_pŞicy_t
 *
	gq
 = 
­Ş_pŞicy_g‘_qpŞ
(
pŞicy
);

189 
	g”rÜ
 = 0;

191 ià(!
	gmod
 || !
	gpŞicy
) {

192 
ERR
(
pŞicy
, "%s", "Invalid…arameters");

193 
	g”ºo
 = 
EINVAL
;

196 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

197 
ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

198 
	g”ºo
 = 
EINVAL
;

203 ià(
	gmod
->
	g»suÉ
)

206 
	g»s
 = 
£chk_»suÉ_Ãw
();

207 ià(!
	g»s
) {

208 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

209 
	g”ºo
 = 
ENOMEM
;

212 
	g»s
->
	g‹¡_Çme
 = 
¡rdup
(
mod_Çme
);

213 ià(!
	g»s
->
	g‹¡_Çme
) {

214 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

215 
	g”rÜ
 = 
ENOMEM
;

216 
	gfšd_assoc_ty³s_run_ç
;

218 
	g»s
->
	g™em_ty³
 = 
SECHK_ITEM_TYPE
;

222 
qpŞ_pŞicy_g‘_isid_by_Çme
(
q
, "uÆab–ed", &
isid
);

223 ià(!
	gisid
) {

224 
	g”rÜ
 = 
”ºo
;

225 
	gfšd_assoc_ty³s_run_ç
;

228 ià(
­Ş_¡r_­³nd
(&
buff
, &
buff_sz
, "sid unlabeled ") != 0) {

229 
”rÜ
 = 
”ºo
;

230 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

231 
	gfšd_assoc_ty³s_run_ç
;

234 
qpŞ_isid_g‘_cÚ‹xt
(
q
, 
isid
, &
cÚ‹xt
);

235 
qpŞ_cÚ‹xt_g‘_ty³
(
q
, 
cÚ‹xt
, &
ty³
);

236 
qpŞ_ty³_g‘_Çme
(
q
, 
ty³
, &
ty³_Çme
);

238 ià(
­Ş_¡r_­³nd
(&
buff
, &
buff_sz
, 
ty³_Çme
) != 0) {

239 
”rÜ
 = 
”ºo
;

240 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

241 
	gfšd_assoc_ty³s_run_ç
;

244 ià(!
	g™em
) {

245 
	g™em
 = 
£chk_™em_Ãw
(
NULL
);

246 ià(!
	g™em
) {

247 
	g”rÜ
 = 
”ºo
;

248 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

249 
	gfšd_assoc_ty³s_run_ç
;

253 
	g´oof
 = 
£chk_´oof_Ãw
(
NULL
);

254 ià(!
	g´oof
) {

255 
	g”rÜ
 = 
”ºo
;

256 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

257 
	gfšd_assoc_ty³s_run_ç
;

260 
	g™em
->
	g‹¡_»suÉ
 = 1;

261 
	g™em
->™em = (*)
ty³
;

262 
	g´oof
->
	gty³
 = 
SECHK_ITEM_TYPE
;

263 
	g´oof
->
	g‹xt
 = 
buff
;

264 ià(!(
	g»s
->
	g™ems
 = 
­Ş_veùÜ_ü—‹
(
£chk_™em_ä“
))) {

265 
”rÜ
 = 
”ºo
;

266 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

267 
	gfšd_assoc_ty³s_run_ç
;

269 ià(!(
	g™em
->
	g´oof
 = 
­Ş_veùÜ_ü—‹
(
£chk_´oof_ä“
))) {

270 
”rÜ
 = 
”ºo
;

271 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

272 
	gfšd_assoc_ty³s_run_ç
;

274 ià(
­Ş_veùÜ_­³nd
(
™em
->
´oof
, (*)proof) < 0) {

275 
	g”rÜ
 = 
”ºo
;

276 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

277 
	gfšd_assoc_ty³s_run_ç
;

279 ià(
­Ş_veùÜ_­³nd
(
»s
->
™ems
, (*)
™em
) < 0) {

280 
	g”rÜ
 = 
”ºo
;

281 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

282 
	gfšd_assoc_ty³s_run_ç
;

285 
	gmod
->
	g»suÉ
 = 
»s
;

289 
	gfšd_assoc_ty³s_run_ç
:

290 
£chk_´oof_ä“
(
´oof
);

291 
£chk_™em_ä“
(
™em
);

292 
ä“
(
buff
);

293 
£chk_»suÉ_de¡roy
(&
»s
);

294 
	g”ºo
 = 
”rÜ
;

300 
fšd_assoc_ty³s_´št
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

302 
	goutfÜm©
 = 0x00;

303 
£chk_™em_t
 *
	g™em
 = 
NULL
;

304 
£chk_´oof_t
 *
	g´oof
 = 
NULL
;

305 
size_t
 
	gi
 = 0, 
	gj
 = 0, 
	gk
 = 0, 
	gnum_™ems
;

306 cÚ¡ 
qpŞ_ty³_t
 *
	gty³
;

307 
qpŞ_pŞicy_t
 *
	gq
 = 
­Ş_pŞicy_g‘_qpŞ
(
pŞicy
);

308 cÚ¡ *
	gty³_Çme
;

310 ià(!
	gmod
 || !
	gpŞicy
) {

311 
ERR
(
pŞicy
, "%s", "Invalid…arameters");

312 
	g”ºo
 = 
EINVAL
;

315 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

316 
ERR
(
pŞicy
, "E¼Ü: wrÚg moduË (%s)\n", 
mod
->
Çme
);

317 
	g”ºo
 = 
EINVAL
;

321 
	goutfÜm©
 = 
mod
->
ouutfÜm©
;

322 
	gnum_™ems
 = 
­Ş_veùÜ_g‘_size
(
mod
->
»suÉ
->
™ems
);

324 ià(!
	gmod
->
	g»suÉ
) {

325 
ERR
(
pŞicy
, "%s", "Module has‚ot been„un");

326 
	g”ºo
 = 
EINVAL
;

330 ià(!
	goutfÜm©
 || (outfÜm© & 
	gSECHK_OUT_QUIET
))

333 ià(
	goutfÜm©
 & 
	gSECHK_OUT_STATS
) {

334 
´štf
("Found %zd‡ssoøty³(s).\n", 
num_™ems
);

340 ià(
	goutfÜm©
 & 
	gSECHK_OUT_LIST
) {

341 
´štf
("\n");

342 
	gj
 = 0; j < 
	gnum_™ems
; j++) {

343 
	gi
++;

344 
	gi
 %= 4;

345 
	g™em
 = 
­Ş_veùÜ_g‘_–em’t
(
mod
->
»suÉ
->
™ems
, 
j
);

346 
	gty³
 = 
™em
->item;

347 
qpŞ_ty³_g‘_Çme
(
q
, 
ty³
, &
ty³_Çme
);

348 ià(
	g™em
)

349 
´štf
("%s%s", 
ty³_Çme
, (*)((
j
 && 
i
 !ğ
num_™ems
 - 1) ? ", " : "\n"));

351 
´štf
("\n");

361 ià(
	goutfÜm©
 & 
	gSECHK_OUT_PROOF
) {

362 
´štf
("\n");

363 
	gj
 = 0; j < 
­Ş_veùÜ_g‘_size
(
mod
->
»suÉ
->
™ems
); j++) {

364 
	g™em
 = 
­Ş_veùÜ_g‘_–em’t
(
mod
->
»suÉ
->
™ems
, 
j
);

365 ià(
	g™em
) {

366 
	gty³
 = 
™em
->item;

367 
qpŞ_ty³_g‘_Çme
(
q
, 
ty³
, &
ty³_Çme
);

368 
´štf
("%s\n", 
ty³_Çme
);

369 
	gk
 = 0; k < 
­Ş_veùÜ_g‘_size
(
™em
->
´oof
); k++) {

370 
	g´oof
 = 
­Ş_veùÜ_g‘_–em’t
(
™em
->
´oof
, 
k
);

371 ià(
	g´oof
)

372 
´štf
("\t%s\n", 
´oof
->
‹xt
);

376 
´štf
("\n");

378 
	gty³
 = 
NULL
;

379 
	gty³_Çme
 = 
NULL
;

384 
	$fšd_assoc_ty³s_g‘_li¡
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
)

386 
­Ş_veùÜ_t
 **
v
 = 
¬g
;

388 ià(!
mod
 || !
¬g
) {

389 
	`ERR
(
pŞicy
, "%s", "Invalid…arameters");

390 
”ºo
 = 
EINVAL
;

393 ià(
	`¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

394 
	`ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

395 
”ºo
 = 
EINVAL
;

398 ià(!
mod
->
»suÉ
) {

399 
	`ERR
(
pŞicy
, "%s", "Module has‚ot been„un");

400 
”ºo
 = 
EINVAL
;

404 
v
 = &
mod
->
»suÉ
->
™ems
;

407 
	}
}

	@sechecker/modules/find_assoc_types.h

27 #iâdeà
FIND_ASSOC_TYPES


28 
	#FIND_ASSOC_TYPES


	)

30 #ifdef 
__ılu¥lus


35 
	~"£check”.h
"

36 
	~<­Ş/pŞicy.h
>

41 
fšd_assoc_ty³s_»gi¡”
(
£chk_lib_t
 * 
lib
);

42 
fšd_assoc_ty³s_š™
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

43 
fšd_assoc_ty³s_run
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

44 
fšd_assoc_ty³s_´št
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

45 
fšd_assoc_ty³s_g‘_li¡
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

47 #ifdef 
__ılu¥lus


	@sechecker/modules/find_domains.c

26 
	~"fšd_domašs.h
"

28 
	~<¡dio.h
>

29 
	~<¡ršg.h
>

30 
	~<”ºo.h
>

32 cÚ¡ *cÚ¡ 
	gmod_Çme
 = "find_domains";

34 
	$fšd_domašs_»gi¡”
(
£chk_lib_t
 * 
lib
)

36 
£chk_moduË_t
 *
mod
 = 
NULL
;

37 
£chk_â_t
 *
â_¡ruù
 = 
NULL
;

39 ià(!
lib
) {

40 
	`ERR
(
NULL
, "%s", "No†ibrary");

41 
”ºo
 = 
EINVAL
;

45 
mod
 = 
	`£chk_lib_g‘_moduË
(
mod_Çme
, 
lib
);

46 ià(!
mod
) {

47 
	`ERR
(
NULL
, "%s", "Module has‚ot been„un");

48 
”ºo
 = 
EINVAL
;

51 
mod
->
·»Á_lib
 = 
lib
;

54 
mod
->
br›f_desütiÚ
 = "utility module";

55 
mod
->
d‘aed_desütiÚ
 =

64 
mod
->
İt_desütiÚ
 =

68 
mod
->
£v”™y
 = 
SECHK_SEV_NONE
;

70 
	`­Ş_veùÜ_­³nd
(
mod
->
»quœem’ts
, 
	`£chk_Çme_v®ue_Ãw
(
SECHK_REQ_POLICY_CAP
, 
SECHK_REQ_CAP_ATTRIB_NAMES
));

73 
	`­Ş_veùÜ_­³nd
(
mod
->
İtiÚs
, 
	`£chk_Çme_v®ue_Ãw
("domain_attribute", "domain"));

76 
â_¡ruù
 = 
	`£chk_â_Ãw
();

77 ià(!
â_¡ruù
) {

78 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

79 
”ºo
 = 
ENOMEM
;

82 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_INIT
);

83 ià(!
â_¡ruù
->
Çme
) {

84 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

85 
”ºo
 = 
ENOMEM
;

88 
â_¡ruù
->
â
 = 
fšd_domašs_š™
;

89 
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, 
â_¡ruù
);

91 
â_¡ruù
 = 
	`£chk_â_Ãw
();

92 ià(!
â_¡ruù
) {

93 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

94 
”ºo
 = 
ENOMEM
;

97 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_RUN
);

98 ià(!
â_¡ruù
->
Çme
) {

99 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

100 
”ºo
 = 
ENOMEM
;

103 
â_¡ruù
->
â
 = 
fšd_domašs_run
;

104 
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, 
â_¡ruù
);

106 
mod
->
d©a_ä“
 = 
fšd_domašs_d©a_ä“
;

108 
â_¡ruù
 = 
	`£chk_â_Ãw
();

109 ià(!
â_¡ruù
) {

110 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

111 
”ºo
 = 
ENOMEM
;

114 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_PRINT
);

115 ià(!
â_¡ruù
->
Çme
) {

116 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

117 
”ºo
 = 
ENOMEM
;

120 
â_¡ruù
->
â
 = 
fšd_domašs_´št
;

121 
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, 
â_¡ruù
);

123 
â_¡ruù
 = 
	`£chk_â_Ãw
();

124 ià(!
â_¡ruù
) {

125 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

126 
”ºo
 = 
ENOMEM
;

129 
â_¡ruù
->
Çme
 = 
	`¡rdup
("get_list");

130 ià(!
â_¡ruù
->
Çme
) {

131 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

132 
”ºo
 = 
ENOMEM
;

135 
â_¡ruù
->
â
 = 
fšd_domašs_g‘_li¡
;

136 
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, 
â_¡ruù
);

139 
	}
}

141 
fšd_domašs_š™
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

143 
£chk_Çme_v®ue_t
 *
	gİt
 = 
NULL
;

144 
fšd_domašs_d©a_t
 *
	gd©um
 = 
NULL
;

145 
size_t
 
	gi
, 
	gj
;

146 
qpŞ_ty³_t
 *
	g©Œ
 = 
NULL
;

147 
­Ş_veùÜ_t
 *
	g©Œ_veùÜ
 = 
NULL
;

148 
­Ş_©Œ_qu”y_t
 *
	g©Œ_qu”y
 = 
­Ş_©Œ_qu”y_ü—‹
();

149 
qpŞ_pŞicy_t
 *
	gq
 = 
­Ş_pŞicy_g‘_qpŞ
(
pŞicy
);

151 ià(!
	gmod
 || !
	gpŞicy
) {

152 
ERR
(
pŞicy
, "%s", "Invalid…arameters");

153 
	g”ºo
 = 
EINVAL
;

156 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

157 
ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

158 
	g”ºo
 = 
EINVAL
;

162 
	gd©um
 = 
fšd_domašs_d©a_Ãw
();

163 ià(!
	gd©um
) {

164 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

165 
	g”ºo
 = 
ENOMEM
;

169 ià(!(
	gd©um
->
	gdomaš_©Œibs
 = 
­Ş_veùÜ_ü—‹
(
NULL
))) {

170 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

171 
	g”ºo
 = 
ENOMEM
;

175 
	gmod
->
	gd©a
 = 
d©um
;

177 
	gi
 = 0; i < 
­Ş_veùÜ_g‘_size
(
mod
->
İtiÚs
); i++) {

178 
	gİt
 = 
­Ş_veùÜ_g‘_–em’t
(
mod
->
İtiÚs
, 
i
);

179 ià(!
¡rcmp
(
İt
->
Çme
, "domain_attribute")) {

180 
­Ş_©Œ_qu”y_£t_©Œ
(
pŞicy
, 
©Œ_qu”y
, 
İt
->
v®ue
);

181 
­Ş_©Œ_g‘_by_qu”y
(
pŞicy
, 
©Œ_qu”y
, &
©Œ_veùÜ
);

182 
	gj
 = 0; j < 
­Ş_veùÜ_g‘_size
(
©Œ_veùÜ
); j++) {

183 cÚ¡ *
	gdomaš_©Œib
;

184 
	g©Œ
 = 
­Ş_veùÜ_g‘_–em’t
(
©Œ_veùÜ
, 
j
);

185 
qpŞ_ty³_g‘_Çme
(
q
, 
©Œ
, &
domaš_©Œib
);

186 ià(
­Ş_veùÜ_­³nd
(
d©um
->
domaš_©Œibs
, (*)
domaš_©Œib
) < 0) {

187 
­Ş_veùÜ_de¡roy
(&
©Œ_veùÜ
);

188 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

189 
	g”ºo
 = 
ENOMEM
;

194 
­Ş_veùÜ_de¡roy
(&
©Œ_veùÜ
);

197 
­Ş_©Œ_qu”y_de¡roy
(&
©Œ_qu”y
);

201 
fšd_domašs_run
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

203 
	g”rÜ
 = 0;

204 
£chk_»suÉ_t
 *
	g»s
 = 
NULL
;

205 
£chk_™em_t
 *
	g™em
 = 
NULL
;

206 
£chk_´oof_t
 *
	g´oof
 = 
NULL
;

207 cÚ¡ *
	gty³_Çme
 = 
NULL
;

208 
fšd_domašs_d©a_t
 *
	gd©um
 = 
NULL
;

209 
size_t
 
	gi
, 
	gj
, 
	g´oof_idx
;

210 
­Ş_veùÜ_t
 *
	gdomaš_veùÜ
 = 
NULL
, *
	gavruË_veùÜ
 = NULL, *
	g‹ruË_veùÜ
 = NULL, *
	grŞe_veùÜ
 = NULL;

211 
­Ş_‹ruË_qu”y_t
 *
	g‹ruË_qu”y
 = 
NULL
;

212 
­Ş_avruË_qu”y_t
 *
	gavruË_qu”y
 = 
NULL
;

213 
­Ş_rŞe_qu”y_t
 *
	grŞe_qu”y
 = 
NULL
;

214 
qpŞ_™”©Ü_t
 *
	gdomaš_©Œ_™”
 = 
NULL
;

215 
qpŞ_pŞicy_t
 *
	gq
 = 
­Ş_pŞicy_g‘_qpŞ
(
pŞicy
);

217 ià(!
	gmod
 || !
	gpŞicy
) {

218 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
EINVAL
));

219 
	g”ºo
 = 
EINVAL
;

222 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

223 
ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

224 
	g”ºo
 = 
EINVAL
;

229 ià(
	gmod
->
	g»suÉ
)

232 
	gd©um
 = (
fšd_domašs_d©a_t
 *è
mod
->
d©a
;

233 
	g»s
 = 
£chk_»suÉ_Ãw
();

234 ià(!
	g»s
) {

235 
	g”rÜ
 = 
”ºo
;

236 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

237 
	g”ºo
 = 
”rÜ
;

240 
	g»s
->
	g™em_ty³
 = 
SECHK_ITEM_TYPE
;

241 
	g»s
->
	g‹¡_Çme
 = 
¡rdup
(
mod_Çme
);

242 ià(!
	g»s
->
	g‹¡_Çme
) {

243 
	g”rÜ
 = 
”ºo
;

244 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

245 
	gfšd_domašs_run_ç
;

248 ià(!(
	g»s
->
	g™ems
 = 
­Ş_veùÜ_ü—‹
(
£chk_™em_ä“
))) {

249 
”rÜ
 = 
”ºo
;

250 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

251 
	gfšd_domašs_run_ç
;

254 ià(
­Ş_ty³_g‘_by_qu”y
(
pŞicy
, 
NULL
, &
domaš_veùÜ
) < 0) {

255 
	gfšd_domašs_run_ç
;

258 
	gi
 = 0; i < 
­Ş_veùÜ_g‘_size
(
domaš_veùÜ
); i++) {

259 
qpŞ_ty³_t
 *
	gty³
 = 
­Ş_veùÜ_g‘_–em’t
(
domaš_veùÜ
, 
i
);

260 
qpŞ_ty³_g‘_Çme
(
q
, 
ty³
, &
ty³_Çme
);

262 ià(
qpŞ_ty³_g‘_©Œ_™”
(
q
, 
ty³
, &
domaš_©Œ_™”
) < 0) {

263 
	g”rÜ
 = 
”ºo
;

264 
ERR
(
pŞicy
, "Cª'ˆg‘‡‰ribu‹ fÜy³ %s", 
ty³_Çme
);

265 
	gfšd_domašs_run_ç
;

268 ; !
qpŞ_™”©Ü_’d
(
domaš_©Œ_™”
); 
qpŞ_™”©Ü_Ãxt
(domain_attr_iter)) {

269 cÚ¡ *
	g©Œ_Çme
;

270 cÚ¡ 
qpŞ_ty³_t
 *
	g©Œ
;

271 
size_t
 
	gnáa
;

273 
qpŞ_™”©Ü_g‘_™em
(
domaš_©Œ_™”
, (**)&
©Œ
);

274 
qpŞ_ty³_g‘_Çme
(
q
, 
©Œ
, &
©Œ_Çme
);

275 
	gnáa
 = 0;‚á¨< 
­Ş_veùÜ_g‘_size
(
d©um
->
domaš_©Œibs
);‚fta++) {

276 cÚ¡ *
	gdomaš_©Œib
;

278 
	gdomaš_©Œib
 = 
­Ş_veùÜ_g‘_–em’t
(
d©um
->
domaš_©Œibs
, 
náa
);

279 ià(!
¡rcmp
(
©Œ_Çme
, 
domaš_©Œib
)) {

280 
	g´oof
 = 
£chk_´oof_Ãw
(
NULL
);

281 ià(!
	g´oof
) {

282 
	g”rÜ
 = 
”ºo
;

283 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

284 
	gfšd_domašs_run_ç
;

286 
	g´oof
->
	gty³
 = 
SECHK_ITEM_ATTRIB
;

287 
	g´oof
->
	g–em
 = (*)
©Œ
;

288 
a¥rštf
(&
´oof
->
‹xt
, "% ha ©Œibu‹ %s", 
ty³_Çme
, 
©Œ_Çme
);

289 ià(!
	g´oof
->
	g‹xt
) {

290 
	g”rÜ
 = 
”ºo
;

291 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

292 
	gfšd_domašs_run_ç
;

294 ià(!
	g™em
) {

295 
	g™em
 = 
£chk_™em_Ãw
(
NULL
);

296 ià(!
	g™em
) {

297 
	g”rÜ
 = 
”ºo
;

298 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

299 
	gfšd_domašs_run_ç
;

301 
	g™em
->
	g‹¡_»suÉ
 = 1;

303 ià(!
	g™em
->
	g´oof
) {

304 ià(!(
	g™em
->
	g´oof
 = 
­Ş_veùÜ_ü—‹
(
£chk_´oof_ä“
))) {

305 
”rÜ
 = 
”ºo
;

306 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

307 
	gfšd_domašs_run_ç
;

310 ià(
­Ş_veùÜ_­³nd
(
™em
->
´oof
, (*)proof) < 0) {

311 
	g”rÜ
 = 
”ºo
;

312 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

313 
	gfšd_domašs_run_ç
;

318 
qpŞ_™”©Ü_de¡roy
(&
domaš_©Œ_™”
);

321 ià(!(
	gavruË_qu”y
 = 
­Ş_avruË_qu”y_ü—‹
())) {

322 
”rÜ
 = 
”ºo
;

323 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

324 
	gfšd_domašs_run_ç
;

326 
­Ş_avruË_qu”y_£t_sourû
(
pŞicy
, 
avruË_qu”y
, 
ty³_Çme
, 0);

327 ià(
­Ş_avruË_g‘_by_qu”y
(
pŞicy
, 
avruË_qu”y
, &
avruË_veùÜ
) < 0) {

328 
	g”rÜ
 = 
”ºo
;

329 
ERR
(
pŞicy
, "%s", "Unableo„etrieve AV„ules");

330 
	gfšd_domašs_run_ç
;

332 
	gj
 = 0; j < 
­Ş_veùÜ_g‘_size
(
avruË_veùÜ
); j++) {

333 cÚ¡ 
qpŞ_avruË_t
 *
	gavruË
 = 
NULL
;

334 cÚ¡ 
qpŞ_şass_t
 *
	gşass
 = 
NULL
;

335 cÚ¡ *
	gşass_Çme
 = 
NULL
;

337 
	gavruË
 = 
­Ş_veùÜ_g‘_–em’t
(
avruË_veùÜ
, 
j
);

338 
qpŞ_avruË_g‘_objeù_şass
(
q
, 
avruË
, &
şass
);

339 
qpŞ_şass_g‘_Çme
(
q
, 
şass
, &
şass_Çme
);

340 ià(
¡rcmp
("fesy¡em", 
şass_Çme
)) {

341 
	g´oof
 = 
£chk_´oof_Ãw
(
NULL
);

342 ià(!
	g´oof
) {

343 
	g”rÜ
 = 
”ºo
;

344 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

345 
	gfšd_domašs_run_ç
;

347 
	g´oof
->
	gty³
 = 
SECHK_ITEM_AVRULE
;

348 
	g´oof
->
	g‹xt
 = 
­Ş_avruË_»nd”
(
pŞicy
, 
avruË
);

349 ià(!
	g™em
) {

350 
	g™em
 = 
£chk_™em_Ãw
(
NULL
);

351 ià(!
	g™em
) {

352 
	g”rÜ
 = 
”ºo
;

353 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

354 
	gfšd_domašs_run_ç
;

356 
	g™em
->
	g‹¡_»suÉ
 = 1;

358 ià(!
	g™em
->
	g´oof
) {

359 ià(!(
	g™em
->
	g´oof
 = 
­Ş_veùÜ_ü—‹
(
£chk_´oof_ä“
))) {

360 
”rÜ
 = 
”ºo
;

361 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

362 
	gfšd_domašs_run_ç
;

365 ià(
­Ş_veùÜ_­³nd
(
™em
->
´oof
, (*)proof) < 0) {

366 
	g”rÜ
 = 
”ºo
;

367 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

368 
	gfšd_domašs_run_ç
;

372 
­Ş_veùÜ_de¡roy
(&
avruË_veùÜ
);

373 
­Ş_avruË_qu”y_de¡roy
(&
avruË_qu”y
);

376 ià(!(
	g‹ruË_qu”y
 = 
­Ş_‹ruË_qu”y_ü—‹
())) {

377 
”rÜ
 = 
”ºo
;

378 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

379 
	gfšd_domašs_run_ç
;

381 
­Ş_‹ruË_qu”y_£t_deçuÉ
(
pŞicy
, 
‹ruË_qu”y
, 
ty³_Çme
);

382 
­Ş_‹ruË_qu”y_­³nd_şass
(
pŞicy
, 
‹ruË_qu”y
, "process");

383 ià(
­Ş_‹ruË_g‘_by_qu”y
(
pŞicy
, 
‹ruË_qu”y
, &
‹ruË_veùÜ
) < 0) {

384 
	g”rÜ
 = 
”ºo
;

385 
ERR
(
pŞicy
, "%s", "Unableo„etrieve TE„ules");

386 
	gfšd_domašs_run_ç
;

388 
	gj
 = 0; j < 
­Ş_veùÜ_g‘_size
(
‹ruË_veùÜ
); j++) {

389 
qpŞ_‹ruË_t
 *
	g‹ruË
 = 
NULL
;

390 
	g‹ruË
 = 
­Ş_veùÜ_g‘_–em’t
(
‹ruË_veùÜ
, 
j
);

392 ià(
­Ş_veùÜ_g‘_šdex
(
™em
->
´oof
, 
‹ruË
, 
£chk_´oof_w™h_–em’t_com·»
, 
NULL
, &
´oof_idx
) == 0)

395 
	g´oof
 = 
£chk_´oof_Ãw
(
NULL
);

396 ià(!
	g´oof
) {

397 
	g”rÜ
 = 
”ºo
;

398 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

399 
	gfšd_domašs_run_ç
;

401 
	g´oof
->
	gty³
 = 
SECHK_ITEM_TERULE
;

402 
	g´oof
->
	g–em
 = 
‹ruË
;

403 
	g´oof
->
	g‹xt
 = 
­Ş_‹ruË_»nd”
(
pŞicy
, 
‹ruË
);

404 ià(!
	g™em
) {

405 
	g™em
 = 
£chk_™em_Ãw
(
NULL
);

406 ià(!
	g™em
) {

407 
	g”rÜ
 = 
”ºo
;

408 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

409 
	gfšd_domašs_run_ç
;

411 
	g™em
->
	g‹¡_»suÉ
 = 1;

413 ià(!
	g™em
->
	g´oof
) {

414 ià(!(
	g™em
->
	g´oof
 = 
­Ş_veùÜ_ü—‹
(
£chk_´oof_ä“
))) {

415 
”rÜ
 = 
”ºo
;

416 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

417 
	gfšd_domašs_run_ç
;

420 ià(
­Ş_veùÜ_­³nd
(
™em
->
´oof
, (*)proof) < 0) {

421 
	g”rÜ
 = 
”ºo
;

422 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

423 
	gfšd_domašs_run_ç
;

426 
­Ş_veùÜ_de¡roy
(&
‹ruË_veùÜ
);

427 
­Ş_‹ruË_qu”y_de¡roy
(&
‹ruË_qu”y
);

430 ià(!(
	grŞe_qu”y
 = 
­Ş_rŞe_qu”y_ü—‹
())) {

431 
”rÜ
 = 
”ºo
;

432 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

433 
	gfšd_domašs_run_ç
;

435 
­Ş_rŞe_qu”y_£t_ty³
(
pŞicy
, 
rŞe_qu”y
, 
ty³_Çme
);

436 
­Ş_rŞe_g‘_by_qu”y
(
pŞicy
, 
rŞe_qu”y
, &
rŞe_veùÜ
);

437 
	gj
 = 0; j < 
­Ş_veùÜ_g‘_size
(
rŞe_veùÜ
); j++) {

438 cÚ¡ 
qpŞ_rŞe_t
 *
	grŞe
;

439 cÚ¡ *
	grŞe_Çme
;

441 
	grŞe
 = (
qpŞ_rŞe_t
 *è
­Ş_veùÜ_g‘_–em’t
(
rŞe_veùÜ
, 
j
);

442 
qpŞ_rŞe_g‘_Çme
(
q
, 
rŞe
, &
rŞe_Çme
);

443 ià(!
¡rcmp
("objeù_r", 
rŞe_Çme
))

445 
	g´oof
 = 
£chk_´oof_Ãw
(
NULL
);

446 ià(!
	g´oof
) {

447 
	g”rÜ
 = 
”ºo
;

448 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

449 
	gfšd_domašs_run_ç
;

451 
	g´oof
->
	gty³
 = 
SECHK_ITEM_ROLE
;

452 
	g´oof
->
	g–em
 = (*)
rŞe
;

453 
a¥rštf
(&
´oof
->
‹xt
, "rŞ% ty³ %s;", 
rŞe_Çme
, 
ty³_Çme
);

454 ià(!
	g™em
) {

455 
	g™em
 = 
£chk_™em_Ãw
(
NULL
);

456 ià(!
	g™em
) {

457 
	g”rÜ
 = 
”ºo
;

458 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

459 
	gfšd_domašs_run_ç
;

461 
	g™em
->
	g‹¡_»suÉ
 = 1;

463 ià(!
	g™em
->
	g´oof
) {

464 ià(!(
	g™em
->
	g´oof
 = 
­Ş_veùÜ_ü—‹
(
£chk_´oof_ä“
))) {

465 
”rÜ
 = 
”ºo
;

466 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

467 
	gfšd_domašs_run_ç
;

471 ià(
­Ş_veùÜ_­³nd
(
™em
->
´oof
, (*)proof) < 0) {

472 
	g”rÜ
 = 
”ºo
;

473 
ERR
(
pŞicy
, "E¼Ü: %s\n", 
¡»¼Ü
(
”rÜ
));

474 
	gfšd_domašs_run_ç
;

477 
­Ş_veùÜ_de¡roy
(&
rŞe_veùÜ
);

478 
­Ş_rŞe_qu”y_de¡roy
(&
rŞe_qu”y
);

481 ià(
	g™em
) {

482 
	g™em
->™em = 
ty³
;

483 ià(
­Ş_veùÜ_­³nd
(
»s
->
™ems
, (*)
™em
) < 0) {

484 
	g”rÜ
 = 
”ºo
;

485 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

486 
	gfšd_domašs_run_ç
;

489 
	g™em
 = 
NULL
;

490 
	gty³
 = 
NULL
;

491 
	gty³_Çme
 = 
NULL
;

493 
­Ş_veùÜ_de¡roy
(&
domaš_veùÜ
);

496 
	gmod
->
	g»suÉ
 = 
»s
;

499 
	gfšd_domašs_run_ç
:

500 
qpŞ_™”©Ü_de¡roy
(&
domaš_©Œ_™”
);

501 
­Ş_veùÜ_de¡roy
(&
domaš_veùÜ
);

502 
­Ş_veùÜ_de¡roy
(&
avruË_veùÜ
);

503 
­Ş_veùÜ_de¡roy
(&
‹ruË_veùÜ
);

504 
­Ş_veùÜ_de¡roy
(&
rŞe_veùÜ
);

505 
­Ş_avruË_qu”y_de¡roy
(&
avruË_qu”y
);

506 
­Ş_‹ruË_qu”y_de¡roy
(&
‹ruË_qu”y
);

507 
­Ş_rŞe_qu”y_de¡roy
(&
rŞe_qu”y
);

508 
£chk_´oof_ä“
(
´oof
);

509 
£chk_™em_ä“
(
™em
);

510 
£chk_»suÉ_de¡roy
(&
»s
);

511 
	g”ºo
 = 
”rÜ
;

515 
	$fšd_domašs_d©a_ä“
(*
d©a
)

517 
fšd_domašs_d©a_t
 *
d©um
 = (fšd_domašs_d©a_ˆ*è
d©a
;

519 ià(
d©um
) {

520 
	`­Ş_veùÜ_de¡roy
(&
d©um
->
domaš_©Œibs
);

522 
	`ä“
(
d©a
);

523 
	}
}

525 
fšd_domašs_´št
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

527 
fšd_domašs_d©a_t
 *
	gd©um
 = 
NULL
;

528 
	goutfÜm©
 = 0x00;

529 
£chk_™em_t
 *
	g™em
 = 
NULL
;

530 
size_t
 
	gi
 = 0, 
	gj
 = 0, 
	gk
 = 0, 
	gl
 = 0, 
	gnum_™ems
;

531 
£chk_´oof_t
 *
	g´oof
 = 
NULL
;

532 cÚ¡ 
qpŞ_ty³_t
 *
	gty³
;

533 
qpŞ_pŞicy_t
 *
	gq
 = 
­Ş_pŞicy_g‘_qpŞ
(
pŞicy
);

534 cÚ¡ *
	gty³_Çme
;

536 ià(!
	gmod
 || !
	gpŞicy
) {

537 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
EINVAL
));

538 
	g”ºo
 = 
EINVAL
;

541 ià(
¡rcmp
("fšd_domašs", 
mod
->
Çme
)) {

542 
ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

543 
	g”ºo
 = 
EINVAL
;

547 
	gd©um
 = (
fšd_domašs_d©a_t
 *è
mod
->
d©a
;

548 
	goutfÜm©
 = 
mod
->
ouutfÜm©
;

549 
	gnum_™ems
 = 
­Ş_veùÜ_g‘_size
(
mod
->
»suÉ
->
™ems
);

551 ià(!
	gmod
->
	g»suÉ
) {

552 
ERR
(
pŞicy
, "%s", "Module has‚ot been„un");

553 
	g”ºo
 = 
EINVAL
;

557 ià(!
	goutfÜm©
 || (outfÜm© & 
	gSECHK_OUT_QUIET
)) {

560 ià(
	goutfÜm©
 & 
	gSECHK_OUT_STATS
) {

561 
´štf
("Found %˜domašy³s.\n", 
num_™ems
);

563 ià(
	goutfÜm©
 & 
	gSECHK_OUT_PROOF
) {

564 
´štf
("\nThe followingypes‡re domains.\n");

567 ià(
	goutfÜm©
 & 
	gSECHK_OUT_LIST
) {

568 
´štf
("\n");

569 
	gi
 = 0; i < 
	gnum_™ems
; i++) {

570 
	gj
++;

571 
	g™em
 = 
­Ş_veùÜ_g‘_–em’t
(
mod
->
»suÉ
->
™ems
, 
i
);

572 
	gty³
 = 
™em
->item;

573 
qpŞ_ty³_g‘_Çme
(
q
, 
ty³
, &
ty³_Çme
);

574 
	gj
 %= 4;

575 
´štf
("%s%s", 
ty³_Çme
, (*)((
j
 && 
i
 !ğ
num_™ems
 - 1) ? ", " : "\n"));

577 
´štf
("\n");

580 ià(
	goutfÜm©
 & 
	gSECHK_OUT_PROOF
) {

581 
´štf
("\n");

582 
	gk
 = 0; k < 
	gnum_™ems
; k++) {

583 
	g™em
 = 
­Ş_veùÜ_g‘_–em’t
(
mod
->
»suÉ
->
™ems
, 
k
);

584 ià(
	g™em
) {

585 
	gty³
 = 
™em
->item;

586 
qpŞ_ty³_g‘_Çme
(
q
, 
ty³
, &
ty³_Çme
);

587 
´štf
("%s\n", (*)
ty³_Çme
);

588 
	gl
 = 0;† < 
­Ş_veùÜ_g‘_size
(
™em
->
´oof
);†++) {

589 
	g´oof
 = 
­Ş_veùÜ_g‘_–em’t
(
™em
->
´oof
, 
l
);

590 ià(
	g´oof
)

591 
´štf
("\t%s\n", 
´oof
->
‹xt
);

595 
´štf
("\n");

601 
	$fšd_domašs_g‘_li¡
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
)

603 
­Ş_veùÜ_t
 **
v
 = 
¬g
;

605 ià(!
mod
 || !
¬g
) {

606 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

607 
”ºo
 = 
EINVAL
;

610 ià(
	`¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

611 
	`ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

612 
”ºo
 = 
EINVAL
;

615 ià(!
mod
->
»suÉ
) {

616 
	`ERR
(
pŞicy
, "%s", "Module has‚ot been„un");

617 
”ºo
 = 
EINVAL
;

621 
v
 = &
mod
->
»suÉ
->
™ems
;

624 
	}
}

626 
fšd_domašs_d©a_t
 *
	$fšd_domašs_d©a_Ãw
()

628 
fšd_domašs_d©a_t
 *
d©um
 = 
NULL
;

630 
d©um
 = (
fšd_domašs_d©a_t
 *è
	`ÿÎoc
(1, (find_domains_data_t));

632  
d©um
;

633 
	}
}

	@sechecker/modules/find_domains.h

26 #iâdeà
FIND_DOMAINS


27 
	#FIND_DOMAINS


	)

29 #ifdef 
__ılu¥lus


34 
	~"£check”.h
"

35 
	~<­Ş/pŞicy.h
>

36 
	~<­Ş/ty³-qu”y.h
>

37 
	~<­Ş/rŞe-qu”y.h
>

38 
	~<­Ş/‹ruË-qu”y.h
>

39 
	~<­Ş/avruË-qu”y.h
>

41 
	sfšd_domašs_d©a


43 
­Ş_veùÜ_t
 *
domaš_©Œibs
;

44 
num_domaš_©Œibs
;

45 } 
	tfšd_domašs_d©a_t
;

47 
fšd_domašs_d©a_ä“
(*
d©a
);

48 
fšd_domašs_d©a_t
 *
fšd_domašs_d©a_Ãw
();

50 
fšd_domašs_»gi¡”
(
£chk_lib_t
 * 
lib
);

51 
fšd_domašs_š™
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

52 
fšd_domašs_run
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

53 
fšd_domašs_´št
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

54 
fšd_domašs_g‘_li¡
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

56 #ifdef 
__ılu¥lus


	@sechecker/modules/find_file_types.c

27 
	~"fšd_fe_ty³s.h
"

29 
	~<qpŞ/g’fscÚ_qu”y.h
>

31 
	~<¡dio.h
>

32 
	~<¡ršg.h
>

33 
	~<uni¡d.h
>

34 
	~<”ºo.h
>

36 cÚ¡ *cÚ¡ 
	gmod_Çme
 = "find_file_types";

38 
	$fšd_fe_ty³s_»gi¡”
(
£chk_lib_t
 * 
lib
)

40 
£chk_moduË_t
 *
mod
 = 
NULL
;

41 
£chk_â_t
 *
â_¡ruù
 = 
NULL
;

42 
£chk_Çme_v®ue_t
 *
nv
 = 
NULL
;

44 ià(!
lib
) {

45 
	`ERR
(
NULL
, "%s", "No†ibrary");

46 
”ºo
 = 
EINVAL
;

50 
mod
 = 
	`£chk_lib_g‘_moduË
(
mod_Çme
, 
lib
);

51 ià(!
mod
) {

52 
	`ERR
(
NULL
, "%s", "Module unknown");

53 
”ºo
 = 
EINVAL
;

56 
mod
->
·»Á_lib
 = 
lib
;

60 
mod
->
br›f_desütiÚ
 = "utility module";

61 
mod
->
d‘aed_desütiÚ
 =

70 
mod
->
İt_desütiÚ
 = "Module„equirements:\n" "‡ttribute‚ames\n"

73 
mod
->
£v”™y
 = 
SECHK_SEV_NONE
;

75 
nv
 = 
	`£chk_Çme_v®ue_Ãw
(
SECHK_REQ_POLICY_CAP
, 
SECHK_REQ_CAP_ATTRIB_NAMES
);

76 
	`­Ş_veùÜ_­³nd
(
mod
->
»quœem’ts
, (*)
nv
);

77 
nv
 = 
	`£chk_Çme_v®ue_Ãw
(
SECHK_REQ_FILE_CONTEXTS
, 
NULL
);

78 
	`­Ş_veùÜ_­³nd
(
mod
->
»quœem’ts
, (*)
nv
);

81 
nv
 = 
	`£chk_Çme_v®ue_Ãw
("file_type_attribute", "file_type");

82 
	`­Ş_veùÜ_­³nd
(
mod
->
İtiÚs
, (*)
nv
);

85 
â_¡ruù
 = 
	`£chk_â_Ãw
();

86 ià(!
â_¡ruù
) {

87 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

88 
”ºo
 = 
ENOMEM
;

91 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_INIT
);

92 ià(!
â_¡ruù
->
Çme
) {

93 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

94 
”ºo
 = 
ENOMEM
;

97 
â_¡ruù
->
â
 = 
fšd_fe_ty³s_š™
;

98 
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
);

100 
â_¡ruù
 = 
	`£chk_â_Ãw
();

101 ià(!
â_¡ruù
) {

102 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

103 
”ºo
 = 
ENOMEM
;

106 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_RUN
);

107 ià(!
â_¡ruù
->
Çme
) {

108 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

109 
”ºo
 = 
ENOMEM
;

112 
â_¡ruù
->
â
 = 
fšd_fe_ty³s_run
;

113 
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
);

115 
mod
->
d©a_ä“
 = 
fšd_fe_ty³s_d©a_ä“
;

117 
â_¡ruù
 = 
	`£chk_â_Ãw
();

118 ià(!
â_¡ruù
) {

119 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

120 
”ºo
 = 
ENOMEM
;

123 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_PRINT
);

124 ià(!
â_¡ruù
->
Çme
) {

125 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

126 
”ºo
 = 
ENOMEM
;

129 
â_¡ruù
->
â
 = 
fšd_fe_ty³s_´št
;

130 
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
);

132 
â_¡ruù
 = 
	`£chk_â_Ãw
();

133 ià(!
â_¡ruù
) {

134 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

135 
”ºo
 = 
ENOMEM
;

138 
â_¡ruù
->
Çme
 = 
	`¡rdup
("get_list");

139 ià(!
â_¡ruù
->
Çme
) {

140 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

141 
”ºo
 = 
ENOMEM
;

144 
â_¡ruù
->
â
 = 
fšd_fe_ty³s_g‘_li¡
;

145 
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
);

148 
	}
}

150 
fšd_fe_ty³s_š™
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

152 
£chk_Çme_v®ue_t
 *
	gİt
 = 
NULL
;

153 
fšd_fe_ty³s_d©a_t
 *
	gd©um
 = 
NULL
;

154 
­Ş_veùÜ_t
 *
	g©Œ_veùÜ
 = 
NULL
;

155 
­Ş_©Œ_qu”y_t
 *
	g©Œ_qu”y
 = 
­Ş_©Œ_qu”y_ü—‹
();

156 
qpŞ_ty³_t
 *
	g©Œ
 = 
NULL
;

157 
qpŞ_pŞicy_t
 *
	gq
 = 
­Ş_pŞicy_g‘_qpŞ
(
pŞicy
);

158 
size_t
 
	gi
 = 0, 
	gj
 = 0;

160 ià(!
	gmod
 || !
	gpŞicy
) {

161 
ERR
(
pŞicy
, "%s", "Invalid…arameters");

162 
	g”ºo
 = 
EINVAL
;

165 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

166 
ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

167 
	g”ºo
 = 
EINVAL
;

171 
	gd©um
 = 
fšd_fe_ty³s_d©a_Ãw
();

172 ià(!
	gd©um
) {

173 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

174 
	g”ºo
 = 
ENOMEM
;

177 ià(!(
	gd©um
->
	gfe_ty³_©Œibs
 = 
­Ş_veùÜ_ü—‹
(
NULL
))) {

178 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

179 
	g”ºo
 = 
ENOMEM
;

182 
	gmod
->
	gd©a
 = 
d©um
;

184 
	gi
 = 0; i < 
­Ş_veùÜ_g‘_size
(
mod
->
İtiÚs
); i++) {

185 
	gİt
 = 
­Ş_veùÜ_g‘_–em’t
(
mod
->
İtiÚs
, 
i
);

186 ià(!
¡rcmp
(
İt
->
Çme
, "file_type_attribute")) {

187 
­Ş_©Œ_qu”y_£t_©Œ
(
pŞicy
, 
©Œ_qu”y
, 
İt
->
v®ue
);

188 
­Ş_©Œ_g‘_by_qu”y
(
pŞicy
, 
©Œ_qu”y
, &
©Œ_veùÜ
);

189 
	gj
 = 0; j < 
­Ş_veùÜ_g‘_size
(
©Œ_veùÜ
); j++) {

190 cÚ¡ *
	gfe_©Œib
;

191 
	g©Œ
 = 
­Ş_veùÜ_g‘_–em’t
(
©Œ_veùÜ
, 
j
);

192 
qpŞ_ty³_g‘_Çme
(
q
, 
©Œ
, &
fe_©Œib
);

193 ià(
­Ş_veùÜ_­³nd
(
d©um
->
fe_ty³_©Œibs
, (*)
fe_©Œib
) < 0) {

194 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

195 
	g”ºo
 = 
ENOMEM
;

199 
­Ş_veùÜ_de¡roy
(&
©Œ_veùÜ
);

202 
­Ş_©Œ_qu”y_de¡roy
(&
©Œ_qu”y
);

206 
fšd_fe_ty³s_run
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

208 
fšd_fe_ty³s_d©a_t
 *
	gd©um
;

209 
£chk_™em_t
 *
	g™em
 = 
NULL
;

210 
£chk_´oof_t
 *
	g´oof
 = 
NULL
;

211 
£chk_»suÉ_t
 *
	g»s
 = 
NULL
;

212 cÚ¡ *
	gty³_Çme
 = 
NULL
;

213 
­Ş_avruË_qu”y_t
 *
	gavruË_qu”y
 = 
NULL
;

214 
­Ş_‹ruË_qu”y_t
 *
	g‹ruË_qu”y
 = 
NULL
;

215 
­Ş_veùÜ_t
 *
	gavruË_veùÜ
 = 
NULL
;

216 
­Ş_veùÜ_t
 *
	g‹ruË_veùÜ
 = 
NULL
;

217 
qpŞ_pŞicy_t
 *
	gq
 = 
­Ş_pŞicy_g‘_qpŞ
(
pŞicy
);

218 
size_t
 
	gi
, 
	gj
, 
	gx
;

219 *
	gbuff
 = 
NULL
;

220 
	g”rÜ
 = 0;

223 
size_t
 
	gnum_fc_’Œ›s
 = 0;

224 
­Ş_veùÜ_t
 *
	gty³_veùÜ
 = 
NULL
;

225 
­Ş_veùÜ_t
 *
	gfc_’Œy_veùÜ
 = 
NULL
;

227 ià(!
	gmod
 || !
	gpŞicy
) {

228 
ERR
(
pŞicy
, "%s", "Invalid…arameters");

229 
	g”ºo
 = 
EINVAL
;

232 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

233 
ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

234 
	g”ºo
 = 
EINVAL
;

239 ià(
	gmod
->
	g»suÉ
)

242 
	g»s
 = 
£chk_»suÉ_Ãw
();

243 ià(!
	g»s
) {

244 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

245 
	g”ºo
 = 
ENOMEM
;

249 
	gd©um
 = (
fšd_fe_ty³s_d©a_t
 *è
mod
->
d©a
;

250 
	g»s
->
	g™em_ty³
 = 
SECHK_ITEM_TYPE
;

251 
	g»s
->
	g‹¡_Çme
 = 
¡rdup
(
mod_Çme
);

252 ià(!
	g»s
->
	g‹¡_Çme
) {

253 
	g”rÜ
 = 
”ºo
;

254 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

255 
	gfšd_fe_ty³s_run_ç
;

257 ià(!(
	g»s
->
	g™ems
 = 
­Ş_veùÜ_ü—‹
(
£chk_™em_ä“
))) {

258 
”rÜ
 = 
”ºo
;

259 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

260 
	gfšd_fe_ty³s_run_ç
;

262 ià(
	gmod
->
	g·»Á_lib
->
	gfc_’Œ›s
) {

263 ià(
	gmod
->
	g·»Á_lib
->
	gfc_·th
) {

264 
	gfc_’Œy_veùÜ
 = 
mod
->
·»Á_lib
->
fc_’Œ›s
;

265 
	gnum_fc_’Œ›s
 = 
­Ş_veùÜ_g‘_size
(
fc_’Œy_veùÜ
);

267 
	g”rÜ
 = 
ENOENT
;

268 
ERR
(
pŞicy
, "%s", "Unableo find file contexts file");

269 
	gfšd_fe_ty³s_run_ç
;

274 ià(
­Ş_ty³_g‘_by_qu”y
(
pŞicy
, 
NULL
, &
ty³_veùÜ
) < 0) {

275 
	g”rÜ
 = 
”ºo
;

276 
ERR
(
pŞicy
, "%s", "Unableo„etrieveypes");

280 
	gi
 = 0; i < 
­Ş_veùÜ_g‘_size
(
ty³_veùÜ
); i++) {

281 
qpŞ_™”©Ü_t
 *
	gfe_©Œ_™”
;

283 cÚ¡ 
qpŞ_ty³_t
 *
	gty³
 = 
­Ş_veùÜ_g‘_–em’t
(
ty³_veùÜ
, 
i
);

284 
qpŞ_ty³_g‘_Çme
(
q
, 
ty³
, &
ty³_Çme
);

286 ià(
qpŞ_ty³_g‘_©Œ_™”
(
q
, 
ty³
, &
fe_©Œ_™”
) < 0) {

287 
	g”rÜ
 = 
”ºo
;

288 
ERR
(
pŞicy
, "Could‚Ù g‘‡‰ribu‹ fÜ %s\n", 
ty³_Çme
);

289 
	gfšd_fe_ty³s_run_ç
;

292 ; !
qpŞ_™”©Ü_’d
(
fe_©Œ_™”
); 
qpŞ_™”©Ü_Ãxt
(file_attr_iter)) {

293 cÚ¡ *
	g©Œ_Çme
;

294 cÚ¡ 
qpŞ_ty³_t
 *
	g©Œ
;

295 
size_t
 
	gnáa
;

297 
qpŞ_™”©Ü_g‘_™em
(
fe_©Œ_™”
, (**)&
©Œ
);

298 
qpŞ_ty³_g‘_Çme
(
q
, 
©Œ
, &
©Œ_Çme
);

299 
	gnáa
 = 0;‚á¨< 
­Ş_veùÜ_g‘_size
(
d©um
->
fe_ty³_©Œibs
);‚fta++) {

300 cÚ¡ *
	gfe_ty³_©Œib
;

302 
	gfe_ty³_©Œib
 = 
­Ş_veùÜ_g‘_–em’t
(
d©um
->
fe_ty³_©Œibs
, 
náa
);

303 ià(!
¡rcmp
(
©Œ_Çme
, 
fe_ty³_©Œib
)) {

304 
	g´oof
 = 
£chk_´oof_Ãw
(
NULL
);

305 ià(!
	g´oof
) {

306 
	g”rÜ
 = 
”ºo
;

307 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

308 
	gfšd_fe_ty³s_run_ç
;

310 
	g´oof
->
	gty³
 = 
SECHK_ITEM_ATTRIB
;

311 
	g´oof
->
	g–em
 = (*)
©Œ
;

312 
a¥rštf
(&
´oof
->
‹xt
, "ha ©Œibu‹ %s", 
©Œ_Çme
);

313 ià(!
	g™em
) {

314 
	g™em
 = 
£chk_™em_Ãw
(
NULL
);

315 ià(!
	g™em
) {

316 
	g”rÜ
 = 
”ºo
;

317 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

318 
	gfšd_fe_ty³s_run_ç
;

320 
	g™em
->
	g‹¡_»suÉ
 = 1;

322 ià(!
	g™em
->
	g´oof
) {

323 ià(!(
	g™em
->
	g´oof
 = 
­Ş_veùÜ_ü—‹
(
£chk_´oof_ä“
))) {

324 
”rÜ
 = 
”ºo
;

325 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

326 
	gfšd_fe_ty³s_run_ç
;

329 ià(
­Ş_veùÜ_­³nd
(
™em
->
´oof
, (*)proof) < 0) {

330 
	g”rÜ
 = 
”ºo
;

331 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

332 
	gfšd_fe_ty³s_run_ç
;

337 
qpŞ_™”©Ü_de¡roy
(&
fe_©Œ_™”
);

340 ià(!(
	gavruË_qu”y
 = 
­Ş_avruË_qu”y_ü—‹
())) {

341 
”rÜ
 = 
”ºo
;

342 
ERR
(
pŞicy
, "%s", "Could‚ot„etrieve AV„ules");

343 
	gfšd_fe_ty³s_run_ç
;

345 
­Ş_avruË_qu”y_£t_sourû
(
pŞicy
, 
avruË_qu”y
, 
ty³_Çme
, 0);

346 
­Ş_avruË_qu”y_­³nd_şass
(
pŞicy
, 
avruË_qu”y
, "filesystem");

347 
­Ş_avruË_qu”y_­³nd_³rm
(
pŞicy
, 
avruË_qu”y
, "associate");

348 
­Ş_avruË_g‘_by_qu”y
(
pŞicy
, 
avruË_qu”y
, &
avruË_veùÜ
);

349 
	gx
 = 0; x < 
­Ş_veùÜ_g‘_size
(
avruË_veùÜ
); x++) {

350 
qpŞ_avruË_t
 *
	gavruË
;

351 
	gavruË
 = 
­Ş_veùÜ_g‘_–em’t
(
avruË_veùÜ
, 
x
);

352 ià(
	gavruË
) {

353 
	g´oof
 = 
£chk_´oof_Ãw
(
NULL
);

354 ià(!
	g´oof
) {

355 
	g”rÜ
 = 
”ºo
;

356 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

357 
	gfšd_fe_ty³s_run_ç
;

359 
	g´oof
->
	gty³
 = 
SECHK_ITEM_AVRULE
;

360 
	g´oof
->
	g–em
 = 
avruË
;

361 
	g´oof
->
	g‹xt
 = 
­Ş_avruË_»nd”
(
pŞicy
, 
avruË
);

362 ià(!
	g™em
) {

363 
	g™em
 = 
£chk_™em_Ãw
(
NULL
);

364 ià(!
	g™em
) {

365 
	g”rÜ
 = 
”ºo
;

366 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

367 
	gfšd_fe_ty³s_run_ç
;

369 
	g™em
->
	g‹¡_»suÉ
 = 1;

371 ià(!
	g™em
->
	g´oof
) {

372 ià(!(
	g™em
->
	g´oof
 = 
­Ş_veùÜ_ü—‹
(
£chk_´oof_ä“
))) {

373 
”rÜ
 = 
”ºo
;

374 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

375 
	gfšd_fe_ty³s_run_ç
;

378 
	g™em
->
	g‹¡_»suÉ
 = 1;

379 ià(
­Ş_veùÜ_­³nd
(
™em
->
´oof
, (*)proof) < 0) {

380 
	g”rÜ
 = 
”ºo
;

381 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

382 
	gfšd_fe_ty³s_run_ç
;

386 
­Ş_veùÜ_de¡roy
(&
avruË_veùÜ
);

387 
­Ş_avruË_qu”y_de¡roy
(&
avruË_qu”y
);

390 ià(!(
	g‹ruË_qu”y
 = 
­Ş_‹ruË_qu”y_ü—‹
())) {

391 
”rÜ
 = 
”ºo
;

392 
ERR
(
pŞicy
, "%s", "Could‚ot„etrieve TE„ules");

393 
	gfšd_fe_ty³s_run_ç
;

395 
­Ş_‹ruË_qu”y_£t_deçuÉ
(
pŞicy
, 
‹ruË_qu”y
, 
ty³_Çme
);

396 
­Ş_‹ruË_g‘_by_qu”y
(
pŞicy
, 
‹ruË_qu”y
, &
‹ruË_veùÜ
);

397 
	gx
 = 0; x < 
­Ş_veùÜ_g‘_size
(
‹ruË_veùÜ
); x++) {

398 cÚ¡ 
qpŞ_‹ruË_t
 *
	g‹ruË
;

399 cÚ¡ 
qpŞ_şass_t
 *
	gobjşass
;

400 cÚ¡ *
	gşass_Çme
;

402 
	g‹ruË
 = 
­Ş_veùÜ_g‘_–em’t
(
‹ruË_veùÜ
, 
x
);

403 
qpŞ_‹ruË_g‘_objeù_şass
(
q
, 
‹ruË
, &
objşass
);

404 
qpŞ_şass_g‘_Çme
(
q
, 
objşass
, &
şass_Çme
);

405 ià(
¡rcmp
(
şass_Çme
, "process")) {

406 
	g´oof
 = 
£chk_´oof_Ãw
(
NULL
);

407 ià(!
	g´oof
) {

408 
	g”rÜ
 = 
”ºo
;

409 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

410 
	gfšd_fe_ty³s_run_ç
;

412 
	g´oof
->
	gty³
 = 
SECHK_ITEM_TERULE
;

413 
	g´oof
->
	g–em
 = (*)
‹ruË
;

414 
	g´oof
->
	g‹xt
 = 
­Ş_‹ruË_»nd”
(
pŞicy
, 
‹ruË
);

415 ià(!
	g™em
) {

416 
	g™em
 = 
£chk_™em_Ãw
(
NULL
);

417 ià(!
	g™em
) {

418 
	g”rÜ
 = 
”ºo
;

419 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

420 
	gfšd_fe_ty³s_run_ç
;

422 
	g™em
->
	g‹¡_»suÉ
 = 1;

424 ià(!
	g™em
->
	g´oof
) {

425 ià(!(
	g™em
->
	g´oof
 = 
­Ş_veùÜ_ü—‹
(
£chk_´oof_ä“
))) {

426 
”rÜ
 = 
”ºo
;

427 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

428 
	gfšd_fe_ty³s_run_ç
;

431 
	g™em
->
	g‹¡_»suÉ
 = 1;

432 ià(
­Ş_veùÜ_­³nd
(
™em
->
´oof
, (*)proof) < 0) {

433 
	g”rÜ
 = 
”ºo
;

434 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

435 
	gfšd_fe_ty³s_run_ç
;

439 
­Ş_veùÜ_de¡roy
(&
‹ruË_veùÜ
);

440 
­Ş_‹ruË_qu”y_de¡roy
(&
‹ruË_qu”y
);

443 ià(
	gfc_’Œy_veùÜ
) {

444 
	gbuff
 = 
NULL
;

445 
	gj
 = 0; j < 
	gnum_fc_’Œ›s
; j++) {

446 
£fs_’Œy_t
 *
	gfc_’Œy
;

447 cÚ¡ *
	gfc_ty³_Çme
 = 
NULL
;

448 
	gfc_’Œy
 = 
­Ş_veùÜ_g‘_–em’t
(
fc_’Œy_veùÜ
, 
j
);

449 cÚ¡ 
­Ş_cÚ‹xt_t
 *
	gcÚ‹xt
 = 
£fs_’Œy_g‘_cÚ‹xt
(
fc_’Œy
);

450 ià(!
	gcÚ‹xt
)

452 
	gfc_ty³_Çme
 = 
­Ş_cÚ‹xt_g‘_ty³
(
cÚ‹xt
);

453 ià(!
¡rcmp
(
ty³_Çme
, 
fc_ty³_Çme
)) {

454 
	gbuff
 = 
£fs_’Œy_to_¡ršg
(
fc_’Œy
);

455 
	g´oof
 = 
£chk_´oof_Ãw
(
NULL
);

456 ià(!
	g´oof
) {

457 
	g”rÜ
 = 
”ºo
;

458 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

459 
	gfšd_fe_ty³s_run_ç
;

461 
	g´oof
->
	gty³
 = 
SECHK_ITEM_FCENT
;

462 
	g´oof
->
	g–em
 = 
fc_’Œy
;

463 
	g´oof
->
	g‹xt
 = 
buff
;

464 
	gbuff
 = 
NULL
;

465 ià(!
	g™em
) {

466 
	g™em
 = 
£chk_™em_Ãw
(
NULL
);

467 ià(!
	g™em
) {

468 
	g”rÜ
 = 
”ºo
;

469 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

470 
	gfšd_fe_ty³s_run_ç
;

472 
	g™em
->
	g‹¡_»suÉ
 = 1;

474 ià(!
	g™em
->
	g´oof
) {

475 ià(!(
	g™em
->
	g´oof
 = 
­Ş_veùÜ_ü—‹
(
£chk_´oof_ä“
))) {

476 
”rÜ
 = 
”ºo
;

477 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

478 
	gfšd_fe_ty³s_run_ç
;

481 ià(
­Ş_veùÜ_­³nd
(
™em
->
´oof
, (*)proof) < 0) {

482 
	g”rÜ
 = 
”ºo
;

483 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

484 
	gfšd_fe_ty³s_run_ç
;

490 ià(
	g™em
) {

491 
	g™em
->™em = (*)
ty³
;

492 ià(
­Ş_veùÜ_­³nd
(
»s
->
™ems
, (*)
™em
) < 0) {

493 
	g”rÜ
 = 
”ºo
;

494 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

495 
	gfšd_fe_ty³s_run_ç
;

498 
	g™em
 = 
NULL
;

499 
	gty³
 = 
NULL
;

500 
	gty³_Çme
 = 
NULL
;

502 
­Ş_veùÜ_de¡roy
(&
ty³_veùÜ
);

505 
	gmod
->
	g»suÉ
 = 
»s
;

509 
	gfšd_fe_ty³s_run_ç
:

510 
£chk_´oof_ä“
(
´oof
);

511 
£chk_™em_ä“
(
™em
);

512 
ä“
(
buff
);

513 
­Ş_veùÜ_de¡roy
(&
ty³_veùÜ
);

514 
£chk_»suÉ_de¡roy
(&
»s
);

515 
	g”ºo
 = 
”rÜ
;

519 
	$fšd_fe_ty³s_d©a_ä“
(*
d©a
)

521 
fšd_fe_ty³s_d©a_t
 *
d©um
 = (fšd_fe_ty³s_d©a_ˆ*è
d©a
;

523 ià(
d©um
) {

524 
	`­Ş_veùÜ_de¡roy
(&
d©um
->
fe_ty³_©Œibs
);

526 
	`ä“
(
d©a
);

527 
	}
}

529 
fšd_fe_ty³s_´št
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

531 
fšd_fe_ty³s_d©a_t
 *
	gd©um
 = 
NULL
;

532 
	goutfÜm©
 = 0x00;

533 
£chk_™em_t
 *
	g™em
 = 
NULL
;

534 
£chk_´oof_t
 *
	g´oof
 = 
NULL
;

535 
size_t
 
	gi
 = 0, 
	gj
 = 0, 
	gk
 = 0, 
	gl
 = 0, 
	gnum_™ems
 = 0;

536 cÚ¡ 
qpŞ_ty³_t
 *
	gty³
;

537 
qpŞ_pŞicy_t
 *
	gq
 = 
­Ş_pŞicy_g‘_qpŞ
(
pŞicy
);

538 cÚ¡ *
	gty³_Çme
;

540 ià(!
	gmod
 || !
	gpŞicy
) {

541 
ERR
(
pŞicy
, "%s", "Invalid…arameters");

542 
	g”ºo
 = 
EINVAL
;

545 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

546 
ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

547 
	g”ºo
 = 
EINVAL
;

551 
	gd©um
 = (
fšd_fe_ty³s_d©a_t
 *è
mod
->
d©a
;

552 
	goutfÜm©
 = 
mod
->
ouutfÜm©
;

554 ià(!
	gmod
->
	g»suÉ
) {

555 
ERR
(
pŞicy
, "%s", "Module has‚ot been„un");

556 
	g”ºo
 = 
EINVAL
;

560 ià(!
	goutfÜm©
 || (outfÜm© & 
	gSECHK_OUT_QUIET
))

562 ià(
	goutfÜm©
 & 
	gSECHK_OUT_STATS
) {

563 
	gnum_™ems
 = 
­Ş_veùÜ_g‘_size
(
mod
->
»suÉ
->
™ems
);

564 
´štf
("Found %zd fty³s.\n", 
num_™ems
);

566 ià(
	goutfÜm©
 & 
	gSECHK_OUT_PROOF
) {

567 
´štf
("\nThe followingypes‡re fileypes.\n\n");

569 ià(
	goutfÜm©
 & 
	gSECHK_OUT_LIST
) {

570 
´štf
("\n");

571 
	gi
 = 0; i < 
­Ş_veùÜ_g‘_size
(
mod
->
»suÉ
->
™ems
); i++) {

572 
	gj
++;

573 
	g™em
 = 
­Ş_veùÜ_g‘_–em’t
(
mod
->
»suÉ
->
™ems
, 
i
);

574 
	gty³
 = 
™em
->item;

575 
qpŞ_ty³_g‘_Çme
(
q
, 
ty³
, &
ty³_Çme
);

576 
	gj
 %= 4;

577 
´štf
("%s%s", 
ty³_Çme
, (*)((
j
 && 
i
 !ğ
num_™ems
 - 1) ? ", " : "\n"));

579 
´štf
("\n");

582 ià(
	goutfÜm©
 & 
	gSECHK_OUT_PROOF
) {

583 
´štf
("\n");

584 
	gk
 = 0; k < 
­Ş_veùÜ_g‘_size
(
mod
->
»suÉ
->
™ems
); k++) {

585 
	g™em
 = 
­Ş_veùÜ_g‘_–em’t
(
mod
->
»suÉ
->
™ems
, 
k
);

586 ià(
	g™em
) {

587 
	gty³
 = 
™em
->item;

588 
qpŞ_ty³_g‘_Çme
(
q
, 
ty³
, &
ty³_Çme
);

589 
´štf
("%s\n", (*)
ty³_Çme
);

590 
	gl
 = 0;† < 
­Ş_veùÜ_g‘_size
(
™em
->
´oof
);†++) {

591 
	g´oof
 = 
­Ş_veùÜ_g‘_–em’t
(
™em
->
´oof
, 
l
);

592 ià(
	g´oof
)

593 
´štf
("\t%s\n", 
´oof
->
‹xt
);

597 
´štf
("\n");

603 
fšd_fe_ty³s_g‘_li¡
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
 
__©Œibu‹__
 ((
unu£d
)), *
¬g


604 
__©Œibu‹__
 ((
unu£d
)))

606 
­Ş_veùÜ_t
 **
	gv
 = 
¬g
;

608 ià(!
	gmod
 || !
	g¬g
) {

609 
ERR
(
NULL
, "%s", 
¡»¼Ü
(
EINVAL
));

610 
	g”ºo
 = 
EINVAL
;

613 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

614 
ERR
(
NULL
, "WrÚg moduË (%s)", 
mod
->
Çme
);

615 
	g”ºo
 = 
EINVAL
;

618 ià(!
	gmod
->
	g»suÉ
) {

619 
ERR
(
NULL
, "%s", "Module has‚ot been„un");

620 
	g”ºo
 = 
EINVAL
;

624 
	gv
 = &
mod
->
»suÉ
->
™ems
;

629 
fšd_fe_ty³s_d©a_t
 *
	$fšd_fe_ty³s_d©a_Ãw
()

631 
fšd_fe_ty³s_d©a_t
 *
d©um
 = 
NULL
;

633 
d©um
 = (
fšd_fe_ty³s_d©a_t
 *è
	`ÿÎoc
(1, (find_file_types_data_t));

635  
d©um
;

636 
	}
}

	@sechecker/modules/find_file_types.h

27 #iâdeà
FIND_FILE_TYPES


28 
	#FIND_FILE_TYPES


	)

30 #ifdef 
__ılu¥lus


35 
	~"£check”.h
"

36 
	~<­Ş/pŞicy.h
>

37 
	~<­Ş/ty³-qu”y.h
>

38 
	~<­Ş/avruË-qu”y.h
>

39 
	~<­Ş/‹ruË-qu”y.h
>

41 
	sfšd_fe_ty³s_d©a


43 
­Ş_veùÜ_t
 *
fe_ty³_©Œibs
;

44 
num_fe_ty³_©Œibs
;

45 } 
	tfšd_fe_ty³s_d©a_t
;

47 
fšd_fe_ty³s_d©a_ä“
(*
d©a
);

48 
fšd_fe_ty³s_d©a_t
 *
fšd_fe_ty³s_d©a_Ãw
();

50 
fšd_fe_ty³s_»gi¡”
(
£chk_lib_t
 * 
lib
);

51 
fšd_fe_ty³s_š™
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

52 
fšd_fe_ty³s_run
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

53 
fšd_fe_ty³s_´št
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

54 
fšd_fe_ty³s_g‘_li¡
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

56 #ifdef 
__ılu¥lus


	@sechecker/modules/find_net_domains.c

27 
	~"fšd_Ãt_domašs.h
"

29 
	~<¡dio.h
>

30 
	~<¡ršg.h
>

31 
	~<”ºo.h
>

33 cÚ¡ *cÚ¡ 
	gmod_Çme
 = "find_net_domains";

35 
	$fšd_Ãt_domašs_»gi¡”
(
£chk_lib_t
 * 
lib
)

37 
£chk_moduË_t
 *
mod
 = 
NULL
;

38 
£chk_â_t
 *
â_¡ruù
 = 
NULL
;

40 ià(!
lib
) {

41 
	`ERR
(
NULL
, "%s", "No†ibrary");

42 
”ºo
 = 
EINVAL
;

49 
mod
 = 
	`£chk_lib_g‘_moduË
(
mod_Çme
, 
lib
);

50 ià(!
mod
) {

51 
	`ERR
(
NULL
, "%s", "Module unknown");

52 
”ºo
 = 
EINVAL
;

55 
mod
->
·»Á_lib
 = 
lib
;

58 
mod
->
br›f_desütiÚ
 = "utility module";

59 
mod
->
d‘aed_desütiÚ
 =

68 
mod
->
İt_desütiÚ
 =

71 
mod
->
£v”™y
 = 
SECHK_SEV_NONE
;

74 
	`­Ş_veùÜ_­³nd
(
mod
->
İtiÚs
, 
	`£chk_Çme_v®ue_Ãw
("net_obj", "netif"));

75 
	`­Ş_veùÜ_­³nd
(
mod
->
İtiÚs
, 
	`£chk_Çme_v®ue_Ãw
("net_obj", "tcp_socket"));

76 
	`­Ş_veùÜ_­³nd
(
mod
->
İtiÚs
, 
	`£chk_Çme_v®ue_Ãw
("net_obj", "udp_socket"));

77 
	`­Ş_veùÜ_­³nd
(
mod
->
İtiÚs
, 
	`£chk_Çme_v®ue_Ãw
("net_obj", "node"));

78 
	`­Ş_veùÜ_­³nd
(
mod
->
İtiÚs
, 
	`£chk_Çme_v®ue_Ãw
("net_obj", "association"));

81 
â_¡ruù
 = 
	`£chk_â_Ãw
();

82 ià(!
â_¡ruù
) {

83 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

84 
”ºo
 = 
ENOMEM
;

87 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_INIT
);

88 ià(!
â_¡ruù
->
Çme
) {

89 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

90 
”ºo
 = 
ENOMEM
;

93 
â_¡ruù
->
â
 = 
fšd_Ãt_domašs_š™
;

94 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
) < 0) {

95 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

96 
”ºo
 = 
ENOMEM
;

100 
â_¡ruù
 = 
	`£chk_â_Ãw
();

101 ià(!
â_¡ruù
) {

102 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

103 
”ºo
 = 
ENOMEM
;

106 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_RUN
);

107 ià(!
â_¡ruù
->
Çme
) {

108 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

109 
”ºo
 = 
ENOMEM
;

112 
â_¡ruù
->
â
 = 
fšd_Ãt_domašs_run
;

113 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
) < 0) {

114 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

115 
”ºo
 = 
ENOMEM
;

119 
mod
->
d©a_ä“
 = 
fšd_Ãt_domašs_d©a_ä“
;

121 
â_¡ruù
 = 
	`£chk_â_Ãw
();

122 ià(!
â_¡ruù
) {

123 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

124 
”ºo
 = 
ENOMEM
;

127 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_PRINT
);

128 ià(!
â_¡ruù
->
Çme
) {

129 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

130 
”ºo
 = 
ENOMEM
;

133 
â_¡ruù
->
â
 = 
fšd_Ãt_domašs_´št
;

134 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
) < 0) {

135 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

136 
”ºo
 = 
ENOMEM
;

140 
â_¡ruù
 = 
	`£chk_â_Ãw
();

141 ià(!
â_¡ruù
) {

142 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

143 
”ºo
 = 
ENOMEM
;

146 
â_¡ruù
->
Çme
 = 
	`¡rdup
("get_list");

147 ià(!
â_¡ruù
->
Çme
) {

148 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

149 
”ºo
 = 
ENOMEM
;

152 
â_¡ruù
->
â
 = 
fšd_Ãt_domašs_g‘_li¡
;

153 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
) < 0) {

154 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

155 
”ºo
 = 
ENOMEM
;

160 
	}
}

165 
fšd_Ãt_domašs_š™
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

167 
£chk_Çme_v®ue_t
 *
	gİt
 = 
NULL
;

168 
fšd_Ãt_domašs_d©a_t
 *
	gd©um
 = 
NULL
;

169 
size_t
 
	gi
;

171 ià(!
	gmod
 || !
	gpŞicy
) {

172 
ERR
(
pŞicy
, "%s", "Invalid…arameters");

173 
	g”ºo
 = 
EINVAL
;

176 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

177 
ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

178 
	g”ºo
 = 
EINVAL
;

182 
	gd©um
 = 
fšd_Ãt_domašs_d©a_Ãw
();

183 ià(!
	gd©um
) {

184 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

185 
	g”ºo
 = 
ENOMEM
;

189 ià(!(
	gd©um
->
	gÃt_objs
 = 
­Ş_veùÜ_ü—‹
(
NULL
))) {

190 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

191 
	g”ºo
 = 
ENOMEM
;

195 
	gmod
->
	gd©a
 = 
d©um
;

197 
	gi
 = 0; i < 
­Ş_veùÜ_g‘_size
(
mod
->
İtiÚs
); i++) {

198 
	gİt
 = 
­Ş_veùÜ_g‘_–em’t
(
mod
->
İtiÚs
, 
i
);

199 ià(!
¡rcmp
(
İt
->
Çme
, "net_obj")) {

200 ià(
­Ş_veùÜ_­³nd
(
d©um
->
Ãt_objs
, (*)
İt
->
v®ue
) < 0) {

201 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

202 
	g”ºo
 = 
ENOMEM
;

219 
fšd_Ãt_domašs_run
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

221 
fšd_Ãt_domašs_d©a_t
 *
	gd©um
;

222 
£chk_»suÉ_t
 *
	g»s
 = 
NULL
;

223 
£chk_™em_t
 *
	g™em
 = 
NULL
;

224 
£chk_´oof_t
 *
	g´oof
 = 
NULL
;

225 
	g”rÜ
 = 0;

226 
size_t
 
	gi
 = 0, 
	gj
 = 0, 
	gk
 = 0;

227 
­Ş_veùÜ_t
 *
	gavruË_veùÜ
;

228 
­Ş_avruË_qu”y_t
 *
	gavruË_qu”y
 = 
NULL
;

229 
qpŞ_pŞicy_t
 *
	gq
 = 
­Ş_pŞicy_g‘_qpŞ
(
pŞicy
);

231 ià(!
	gmod
 || !
	gpŞicy
) {

232 
ERR
(
pŞicy
, "%s", "Invalid…arameters");

233 
	g”ºo
 = 
EINVAL
;

236 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

237 
ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

238 
	g”ºo
 = 
EINVAL
;

243 ià(
	gmod
->
	g»suÉ
)

246 
	gd©um
 = (
fšd_Ãt_domašs_d©a_t
 *è
mod
->
d©a
;

247 
	g»s
 = 
£chk_»suÉ_Ãw
();

248 ià(!
	g»s
) {

249 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

250 
	g”ºo
 = 
ENOMEM
;

253 
	g»s
->
	g‹¡_Çme
 = 
¡rdup
(
mod_Çme
);

254 ià(!
	g»s
->
	g‹¡_Çme
) {

255 
	g”rÜ
 = 
”ºo
;

256 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

257 
	gfšd_Ãt_domašs_run_ç
;

259 
	g»s
->
	g™em_ty³
 = 
SECHK_ITEM_TYPE
;

260 ià(!(
	g»s
->
	g™ems
 = 
­Ş_veùÜ_ü—‹
(
£chk_™em_ä“
))) {

261 
”rÜ
 = 
”ºo
;

262 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

263 
	gfšd_Ãt_domašs_run_ç
;

266 ià(!(
	gavruË_qu”y
 = 
­Ş_avruË_qu”y_ü—‹
())) {

267 
”rÜ
 = 
”ºo
;

268 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

269 
	gfšd_Ãt_domašs_run_ç
;

271 
­Ş_avruË_qu”y_£t_ruËs
(
pŞicy
, 
avruË_qu”y
, 
QPOL_RULE_ALLOW
);

272 
­Ş_avruË_g‘_by_qu”y
(
pŞicy
, 
avruË_qu”y
, &
avruË_veùÜ
);

273 
	gk
 = 0; k < 
­Ş_veùÜ_g‘_size
(
avruË_veùÜ
); k++) {

274 cÚ¡ 
qpŞ_avruË_t
 *
	gavruË
;

275 cÚ¡ 
qpŞ_şass_t
 *
	gşass
;

276 cÚ¡ *
	gşass_Çme
;

278 
	gavruË
 = 
­Ş_veùÜ_g‘_–em’t
(
avruË_veùÜ
, 
k
);

279 
qpŞ_avruË_g‘_objeù_şass
(
q
, 
avruË
, &
şass
);

280 
qpŞ_şass_g‘_Çme
(
q
, 
şass
, &
şass_Çme
);

281 
	gi
 = 0; i < 
­Ş_veùÜ_g‘_size
(
d©um
->
Ãt_objs
); i++) {

282 cÚ¡ *
	gÃt_obj_Çme
;

284 
	gÃt_obj_Çme
 = 
­Ş_veùÜ_g‘_–em’t
(
d©um
->
Ãt_objs
, 
i
);

285 ià(!
¡rcmp
(
şass_Çme
, 
Ãt_obj_Çme
)) {

286 cÚ¡ 
qpŞ_ty³_t
 *
	gsourû
;

287 cÚ¡ *
	gsourû_Çme
;

289 
qpŞ_avruË_g‘_sourû_ty³
(
q
, 
avruË
, &
sourû
);

290 
qpŞ_ty³_g‘_Çme
(
q
, 
sourû
, &
sourû_Çme
);

292 
	g´oof
 = 
£chk_´oof_Ãw
(
NULL
);

293 ià(!
	g´oof
) {

294 
	g”rÜ
 = 
”ºo
;

295 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

296 
	gfšd_Ãt_domašs_run_ç
;

298 
	g´oof
->
	gty³
 = 
SECHK_ITEM_AVRULE
;

299 
	g´oof
->
	g–em
 = (*)
avruË
;

300 
	g´oof
->
	g‹xt
 = 
­Ş_avruË_»nd”
(
pŞicy
, 
avruË
);

301 ià(!
	g´oof
->
	g‹xt
) {

302 
	g”rÜ
 = 
”ºo
;

303 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

304 
	gfšd_Ãt_domašs_run_ç
;

306 
	g™em
 = 
NULL
;

308 
	gj
 = 0; j < 
­Ş_veùÜ_g‘_size
(
»s
->
™ems
); j++) {

309 
£chk_™em_t
 *
	g»s_™em
 = 
NULL
;

310 cÚ¡ 
qpŞ_ty³_t
 *
	g»s_ty³
;

311 cÚ¡ *
	g»s_ty³_Çme
;

313 
	g»s_™em
 = 
­Ş_veùÜ_g‘_–em’t
(
»s
->
™ems
, 
j
);

314 
	g»s_ty³
 = 
»s_™em
->
™em
;

315 
qpŞ_ty³_g‘_Çme
(
q
, 
»s_ty³
, &
»s_ty³_Çme
);

316 ià(!
¡rcmp
(
»s_ty³_Çme
, 
sourû_Çme
))

317 
	g™em
 = 
»s_™em
;

320 ià(!
	g™em
) {

321 
	g™em
 = 
£chk_™em_Ãw
(
NULL
);

322 ià(!
	g™em
) {

323 
	g”rÜ
 = 
”ºo
;

324 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

325 
	gfšd_Ãt_domašs_run_ç
;

327 
	g™em
->
	g‹¡_»suÉ
 = 1;

328 
	g™em
->™em = (*)
sourû
;

329 ià(
­Ş_veùÜ_­³nd
(
»s
->
™ems
, (*)
™em
) < 0) {

330 
	g”rÜ
 = 
”ºo
;

331 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

332 
	gfšd_Ãt_domašs_run_ç
;

335 ià(!
	g™em
->
	g´oof
) {

336 ià(!(
	g™em
->
	g´oof
 = 
­Ş_veùÜ_ü—‹
(
£chk_´oof_ä“
))) {

337 
”rÜ
 = 
”ºo
;

338 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

339 
	gfšd_Ãt_domašs_run_ç
;

342 ià(
­Ş_veùÜ_­³nd
(
™em
->
´oof
, (*)proof) < 0) {

343 
	g”rÜ
 = 
”ºo
;

344 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

345 
	gfšd_Ãt_domašs_run_ç
;

347 
	g™em
 = 
NULL
;

351 
­Ş_avruË_qu”y_de¡roy
(&
avruË_qu”y
);

352 
­Ş_veùÜ_de¡roy
(&
avruË_veùÜ
);

353 
	gmod
->
	g»suÉ
 = 
»s
;

357 
	gfšd_Ãt_domašs_run_ç
:

358 
£chk_´oof_ä“
(
´oof
);

359 
£chk_™em_ä“
(
™em
);

360 
£chk_»suÉ_de¡roy
(&
»s
);

361 
	g”ºo
 = 
”rÜ
;

366 
	$fšd_Ãt_domašs_d©a_ä“
(*
d©a
)

368 
fšd_Ãt_domašs_d©a_t
 *
d
 = 
d©a
;

369 
	`­Ş_veùÜ_de¡roy
(&
d
->
Ãt_objs
);

370 
	`ä“
(
d©a
);

371 
	}
}

375 
fšd_Ãt_domašs_´št
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

377 
fšd_Ãt_domašs_d©a_t
 *
	gd©um
 = 
NULL
;

378 
	goutfÜm©
 = 0x00;

379 
£chk_™em_t
 *
	g™em
 = 
NULL
;

380 
£chk_´oof_t
 *
	g´oof
 = 
NULL
;

381 
size_t
 
	gi
 = 0, 
	gj
 = 0, 
	gk
 = 0, 
	gl
 = 0, 
	gnum_™ems
;

382 cÚ¡ 
qpŞ_ty³_t
 *
	gty³
;

383 
qpŞ_pŞicy_t
 *
	gq
 = 
­Ş_pŞicy_g‘_qpŞ
(
pŞicy
);

384 cÚ¡ *
	gty³_Çme
;

386 ià(!
	gmod
 || !
	gpŞicy
) {

387 
ERR
(
pŞicy
, "%s", "Invalid…arameters");

388 
	g”ºo
 = 
EINVAL
;

391 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

392 
ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

393 
	g”ºo
 = 
EINVAL
;

397 
	gd©um
 = (
fšd_Ãt_domašs_d©a_t
 *è
mod
->
d©a
;

398 
	goutfÜm©
 = 
mod
->
ouutfÜm©
;

399 
	gnum_™ems
 = 
­Ş_veùÜ_g‘_size
(
mod
->
»suÉ
->
™ems
);

401 ià(!
	gmod
->
	g»suÉ
) {

402 
ERR
(
pŞicy
, "%s", "Module has‚ot been„un");

403 
	g”ºo
 = 
EINVAL
;

407 ià(!
	goutfÜm©
 || (outfÜm© & 
	gSECHK_OUT_QUIET
))

410 ià(
	goutfÜm©
 & 
	gSECHK_OUT_STATS
) {

411 
´štf
("\nFound %˜ÃtwÜk domašs.", 
num_™ems
);

418 ià(
	goutfÜm©
 & 
	gSECHK_OUT_LIST
) {

419 
´štf
("\n");

420 
	gi
 = 0; i < 
	gnum_™ems
; i++) {

421 
	gj
++;

422 
	g™em
 = 
­Ş_veùÜ_g‘_–em’t
(
mod
->
»suÉ
->
™ems
, 
i
);

423 
	gty³
 = 
™em
->item;

424 
qpŞ_ty³_g‘_Çme
(
q
, 
ty³
, &
ty³_Çme
);

425 
	gj
 %= 4;

426 
´štf
("%s%s", 
ty³_Çme
, (*)((
j
 && 
i
 !ğ
num_™ems
 - 1) ? ", " : "\n"));

428 
´štf
("\n");

439 ià(
	goutfÜm©
 & 
	gSECHK_OUT_PROOF
) {

440 
´štf
("\n");

441 
	gk
 = 0; k < 
	gnum_™ems
; k++) {

442 
	g™em
 = 
­Ş_veùÜ_g‘_–em’t
(
mod
->
»suÉ
->
™ems
, 
k
);

443 ià(
	g™em
) {

444 
	gty³
 = 
™em
->item;

445 
qpŞ_ty³_g‘_Çme
(
q
, 
ty³
, &
ty³_Çme
);

446 
´štf
("%s\n", (*)
ty³_Çme
);

447 
	gl
 = 0;† < 
­Ş_veùÜ_g‘_size
(
™em
->
´oof
);†++) {

448 
	g´oof
 = 
­Ş_veùÜ_g‘_–em’t
(
™em
->
´oof
, 
l
);

449 ià(
	g´oof
)

450 
´štf
("\t%s\n", 
´oof
->
‹xt
);

454 
´štf
("\n");

460 
	$fšd_Ãt_domašs_g‘_li¡
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
)

462 
­Ş_veùÜ_t
 **
v
 = 
¬g
;

464 ià(!
mod
 || !
¬g
) {

465 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

466 
”ºo
 = 
EINVAL
;

469 ià(
	`¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

470 
	`ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

471 
”ºo
 = 
EINVAL
;

474 ià(!
mod
->
»suÉ
) {

475 
	`ERR
(
pŞicy
, "%s", "Module has‚ot been„un");

476 
”ºo
 = 
EINVAL
;

480 
v
 = &
mod
->
»suÉ
->
™ems
;

483 
	}
}

494 
fšd_Ãt_domašs_d©a_t
 *
	$fšd_Ãt_domašs_d©a_Ãw
()

496 
fšd_Ãt_domašs_d©a_t
 *
d©um
 = 
NULL
;

498 
d©um
 = (
fšd_Ãt_domašs_d©a_t
 *è
	`ÿÎoc
(1, (find_net_domains_data_t));

500  
d©um
;

501 
	}
}

	@sechecker/modules/find_net_domains.h

27 #iâdeà
FIND_NET_DOMAINS


28 
	#FIND_NET_DOMAINS


	)

30 #ifdef 
__ılu¥lus


35 
	~"£check”.h
"

36 
	~<­Ş/pŞicy.h
>

37 
	~<­Ş/avruË-qu”y.h
>

41 
	sfšd_Ãt_domašs_d©a


43 
­Ş_veùÜ_t
 *
Ãt_objs
;

44 } 
	tfšd_Ãt_domašs_d©a_t
;

46 
fšd_Ãt_domašs_d©a_t
 *
fšd_Ãt_domašs_d©a_Ãw
();

47 
fšd_Ãt_domašs_d©a_ä“
(*
d©a
);

49 
fšd_Ãt_domašs_»gi¡”
(
£chk_lib_t
 * 
lib
);

50 
fšd_Ãt_domašs_š™
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

51 
fšd_Ãt_domašs_run
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

52 
fšd_Ãt_domašs_´št
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

53 
fšd_Ãt_domašs_g‘_li¡
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

55 #ifdef 
__ılu¥lus


	@sechecker/modules/find_netif_types.c

27 
	~"fšd_Ãtif_ty³s.h
"

28 
	~<­Ş/ÃtcÚ-qu”y.h
>

30 
	~<¡dio.h
>

31 
	~<¡ršg.h
>

32 
	~<”ºo.h
>

34 cÚ¡ *cÚ¡ 
	gmod_Çme
 = "find_netif_types";

38 
	$fšd_Ãtif_ty³s_»gi¡”
(
£chk_lib_t
 * 
lib
)

40 
£chk_moduË_t
 *
mod
 = 
NULL
;

41 
£chk_â_t
 *
â_¡ruù
 = 
NULL
;

43 ià(!
lib
) {

44 
	`ERR
(
NULL
, "%s", "No†ibrary");

45 
”ºo
 = 
EINVAL
;

52 
mod
 = 
	`£chk_lib_g‘_moduË
(
mod_Çme
, 
lib
);

53 ià(!
mod
) {

54 
	`ERR
(
NULL
, "%s", "Module unknown");

55 
”ºo
 = 
EINVAL
;

58 
mod
->
·»Á_lib
 = 
lib
;

61 
mod
->
br›f_desütiÚ
 = "utility module";

62 
mod
->
d‘aed_desütiÚ
 =

67 
mod
->
İt_desütiÚ
 =

69 
mod
->
£v”™y
 = 
SECHK_SEV_NONE
;

72 
â_¡ruù
 = 
	`£chk_â_Ãw
();

73 ià(!
â_¡ruù
) {

74 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

75 
”ºo
 = 
ENOMEM
;

78 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_INIT
);

79 ià(!
â_¡ruù
->
Çme
) {

80 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

81 
”ºo
 = 
ENOMEM
;

84 
â_¡ruù
->
â
 = 
fšd_Ãtif_ty³s_š™
;

85 
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
);

87 
â_¡ruù
 = 
	`£chk_â_Ãw
();

88 ià(!
â_¡ruù
) {

89 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

90 
”ºo
 = 
ENOMEM
;

93 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_RUN
);

94 ià(!
â_¡ruù
->
Çme
) {

95 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

96 
”ºo
 = 
ENOMEM
;

99 
â_¡ruù
->
â
 = 
fšd_Ãtif_ty³s_run
;

100 
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
);

102 
mod
->
d©a_ä“
 = 
NULL
;

104 
â_¡ruù
 = 
	`£chk_â_Ãw
();

105 ià(!
â_¡ruù
) {

106 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

107 
”ºo
 = 
ENOMEM
;

110 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_PRINT
);

111 ià(!
â_¡ruù
->
Çme
) {

112 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

113 
”ºo
 = 
ENOMEM
;

116 
â_¡ruù
->
â
 = 
fšd_Ãtif_ty³s_´št
;

117 
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
);

119 
â_¡ruù
 = 
	`£chk_â_Ãw
();

120 ià(!
â_¡ruù
) {

121 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

122 
”ºo
 = 
ENOMEM
;

125 
â_¡ruù
->
Çme
 = 
	`¡rdup
("get_list");

126 ià(!
â_¡ruù
->
Çme
) {

127 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

128 
”ºo
 = 
ENOMEM
;

131 
â_¡ruù
->
â
 = 
fšd_Ãtif_ty³s_g‘_li¡
;

132 
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
);

135 
	}
}

140 
fšd_Ãtif_ty³s_š™
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

142 ià(!
	gmod
 || !
	gpŞicy
) {

143 
ERR
(
pŞicy
, "%s", "Invalid…arameters");

144 
	g”ºo
 = 
EINVAL
;

147 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

148 
ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

149 
	g”ºo
 = 
EINVAL
;

164 
fšd_Ãtif_ty³s_run
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

166 
£chk_»suÉ_t
 *
	g»s
 = 
NULL
;

167 
£chk_™em_t
 *
	g™em
 = 
NULL
;

168 
£chk_´oof_t
 *
	g´oof
 = 
NULL
;

169 *
	gbuff
 = 
NULL
;

170 
size_t
 
	gi
, 
	gbuff_sz
 = 0;

171 
­Ş_veùÜ_t
 *
	gÃtifcÚ_veùÜ
;

172 
qpŞ_pŞicy_t
 *
	gq
 = 
­Ş_pŞicy_g‘_qpŞ
(
pŞicy
);

173 
	g”rÜ
 = 0;

175 ià(!
	gmod
 || !
	gpŞicy
) {

176 
ERR
(
pŞicy
, "%s", "Invalid…arameters");

177 
	g”ºo
 = 
EINVAL
;

180 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

181 
ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

182 
	g”ºo
 = 
EINVAL
;

187 ià(
	gmod
->
	g»suÉ
)

190 
	g»s
 = 
£chk_»suÉ_Ãw
();

191 ià(!
	g»s
) {

192 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

193 
	g”ºo
 = 
ENOMEM
;

196 
	g»s
->
	g‹¡_Çme
 = 
¡rdup
(
mod_Çme
);

197 ià(!
	g»s
->
	g‹¡_Çme
) {

198 
	g”rÜ
 = 
”ºo
;

199 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

200 
	gfšd_Ãtif_ty³s_run_ç
;

202 
	g»s
->
	g™em_ty³
 = 
SECHK_ITEM_TYPE
;

203 ià(!(
	g»s
->
	g™ems
 = 
­Ş_veùÜ_ü—‹
(
£chk_™em_ä“
))) {

204 
”rÜ
 = 
”ºo
;

205 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

206 
	gfšd_Ãtif_ty³s_run_ç
;

210 cÚ¡ 
qpŞ_isid_t
 *
	gisid
 = 
NULL
;

212 
	gbuff
 = 
NULL
;

213 
qpŞ_pŞicy_g‘_isid_by_Çme
(
q
, "Ãtif", &
isid
);

214 ià(
	gisid
) {

215 cÚ¡ 
qpŞ_cÚ‹xt_t
 *
	gcÚ‹xt
;

216 
­Ş_cÚ‹xt_t
 *
	ga_cÚ‹xt
;

217 cÚ¡ 
qpŞ_ty³_t
 *
	gcÚ‹xt_ty³
;

218 cÚ¡ *
	gcÚ‹xt_ty³_Çme
;

219 *
	gtmp
;

221 
	g´oof
 = 
NULL
;

222 
qpŞ_isid_g‘_cÚ‹xt
(
q
, 
isid
, &
cÚ‹xt
);

223 
qpŞ_cÚ‹xt_g‘_ty³
(
q
, 
cÚ‹xt
, &
cÚ‹xt_ty³
);

224 
qpŞ_ty³_g‘_Çme
(
q
, 
cÚ‹xt_ty³
, &
cÚ‹xt_ty³_Çme
);

225 
	ga_cÚ‹xt
 = 
­Ş_cÚ‹xt_ü—‹_äom_qpŞ_cÚ‹xt
(
pŞicy
, 
cÚ‹xt
);

227 ià(
­Ş_¡r_­³nd
(&
buff
, &
buff_sz
, "sid‚etif ") != 0) {

228 
”rÜ
 = 
”ºo
;

229 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

230 
­Ş_cÚ‹xt_de¡roy
(&
a_cÚ‹xt
);

231 
	gfšd_Ãtif_ty³s_run_ç
;

234 
	gtmp
 = 
­Ş_cÚ‹xt_»nd”
(
pŞicy
, 
a_cÚ‹xt
);

235 ià(
­Ş_¡r_­³nd
(&
buff
, &
buff_sz
, 
tmp
) != 0) {

236 
”rÜ
 = 
”ºo
;

237 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

238 
ä“
(
tmp
);

239 
­Ş_cÚ‹xt_de¡roy
(&
a_cÚ‹xt
);

240 
	gfšd_Ãtif_ty³s_run_ç
;

242 
­Ş_cÚ‹xt_de¡roy
(&
a_cÚ‹xt
);

243 
ä“
(
tmp
);

244 
	gtmp
 = 
NULL
;

246 
	g™em
 = 
£chk_™em_Ãw
(
NULL
);

247 ià(!
	g™em
) {

248 
	g”rÜ
 = 
”ºo
;

249 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

250 
	gfšd_Ãtif_ty³s_run_ç
;

252 
	g™em
->
	g‹¡_»suÉ
 = 1;

254 
	g´oof
 = 
£chk_´oof_Ãw
(
NULL
);

255 ià(!
	g´oof
) {

256 
	g”rÜ
 = 
”ºo
;

257 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

258 
	gfšd_Ãtif_ty³s_run_ç
;

261 
	g´oof
->
	gty³
 = 
SECHK_ITEM_ISID
;

262 
	g´oof
->
	g–em
 = (*)
isid
;

263 
	g´oof
->
	g‹xt
 = 
buff
;

265 
	g™em
->™em = (*)
cÚ‹xt_ty³
;

266 ià(!
	g™em
->
	g´oof
) {

267 ià(!(
	g™em
->
	g´oof
 = 
­Ş_veùÜ_ü—‹
(
£chk_´oof_ä“
))) {

268 
”rÜ
 = 
”ºo
;

269 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

270 
	gfšd_Ãtif_ty³s_run_ç
;

273 ià(
­Ş_veùÜ_­³nd
(
™em
->
´oof
, (*)proof) < 0) {

274 
	g”rÜ
 = 
”ºo
;

275 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

276 
	gfšd_Ãtif_ty³s_run_ç
;

278 ià(
­Ş_veùÜ_­³nd
(
»s
->
™ems
, (*)
™em
) < 0) {

279 
	g”rÜ
 = 
”ºo
;

280 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

281 
	gfšd_Ãtif_ty³s_run_ç
;

285 ià(
­Ş_ÃtifcÚ_g‘_by_qu”y
(
pŞicy
, 
NULL
, &
ÃtifcÚ_veùÜ
) < 0) {

286 
	g”rÜ
 = 
”ºo
;

287 
	gfšd_Ãtif_ty³s_run_ç
;

290 
	gi
 = 0; i < 
­Ş_veùÜ_g‘_size
(
ÃtifcÚ_veùÜ
); i++) {

291 cÚ¡ *
	gmsg_cÚ_Çme
 = 
NULL
;

292 cÚ¡ *
	gif_cÚ_Çme
 = 
NULL
;

293 
qpŞ_ÃtifcÚ_t
 *
	gÃtifcÚ
 = 
NULL
;

294 cÚ¡ 
qpŞ_cÚ‹xt_t
 *
	gmsg_cÚ
 = 
NULL
;

295 cÚ¡ 
qpŞ_cÚ‹xt_t
 *
	gif_cÚ
 = 
NULL
;

296 cÚ¡ 
qpŞ_ty³_t
 *
	gmsg_ty³
 = 
NULL
;

297 cÚ¡ 
qpŞ_ty³_t
 *
	gif_ty³
 = 
NULL
;

298 
size_t
 
	gj
 = 0;

300 
	gÃtifcÚ
 = 
­Ş_veùÜ_g‘_–em’t
(
ÃtifcÚ_veùÜ
, 
i
);

301 
qpŞ_ÃtifcÚ_g‘_msg_cÚ
(
q
, 
ÃtifcÚ
, &
msg_cÚ
);

302 
qpŞ_ÃtifcÚ_g‘_if_cÚ
(
q
, 
ÃtifcÚ
, &
if_cÚ
);

303 
qpŞ_cÚ‹xt_g‘_ty³
(
q
, 
msg_cÚ
, &
msg_ty³
);

304 
qpŞ_cÚ‹xt_g‘_ty³
(
q
, 
if_cÚ
, &
if_ty³
);

305 
qpŞ_ty³_g‘_Çme
(
q
, 
msg_ty³
, &
msg_cÚ_Çme
);

306 
qpŞ_ty³_g‘_Çme
(
q
, 
if_ty³
, &
if_cÚ_Çme
);

308 
	g´oof
 = 
£chk_´oof_Ãw
(
NULL
);

309 ià(!
	g´oof
) {

310 
	g”rÜ
 = 
”ºo
;

311 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

312 
	gfšd_Ãtif_ty³s_run_ç
;

314 
	g´oof
->
	gty³
 = 
SECHK_ITEM_NETIFCON
;

315 
	g´oof
->
	g–em
 = 
ÃtifcÚ
;

316 
	g´oof
->
	g‹xt
 = 
­Ş_ÃtifcÚ_»nd”
(
pŞicy
, 
ÃtifcÚ
);

317 
	g™em
 = 
NULL
;

319 
	gj
 = 0; j < 
­Ş_veùÜ_g‘_size
(
»s
->
™ems
); j++) {

320 
£chk_™em_t
 *
	g»s_™em
 = 
NULL
;

321 cÚ¡ 
qpŞ_ty³_t
 *
	g»s_ty³
;

322 cÚ¡ *
	g»s_ty³_Çme
;

324 
	g»s_™em
 = 
­Ş_veùÜ_g‘_–em’t
(
»s
->
™ems
, 
j
);

325 
	g»s_ty³
 = (
qpŞ_ty³_t
 *è
»s_™em
->
™em
;

326 
qpŞ_ty³_g‘_Çme
(
q
, 
»s_ty³
, &
»s_ty³_Çme
);

327 ià(!
¡rcmp
(
»s_ty³_Çme
, 
if_cÚ_Çme
))

328 
	g™em
 = 
»s_™em
;

331 ià(!
	g™em
) {

332 
	g™em
 = 
£chk_™em_Ãw
(
NULL
);

333 ià(!
	g™em
) {

334 
	g”rÜ
 = 
”ºo
;

335 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

336 
	gfšd_Ãtif_ty³s_run_ç
;

338 
	g™em
->
	g‹¡_»suÉ
 = 1;

339 
	g™em
->™em = (*)
if_ty³
;

340 ià(
­Ş_veùÜ_­³nd
(
»s
->
™ems
, (*)
™em
) < 0) {

341 
	g”rÜ
 = 
”ºo
;

342 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

343 
	gfšd_Ãtif_ty³s_run_ç
;

346 ià(!
	g™em
->
	g´oof
) {

347 ià(!(
	g™em
->
	g´oof
 = 
­Ş_veùÜ_ü—‹
(
£chk_´oof_ä“
))) {

348 
”rÜ
 = 
”ºo
;

349 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

350 
	gfšd_Ãtif_ty³s_run_ç
;

353 ià(
­Ş_veùÜ_­³nd
(
™em
->
´oof
, (*)proof) < 0) {

354 
	g”rÜ
 = 
”ºo
;

355 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

356 
	gfšd_Ãtif_ty³s_run_ç
;

358 
	g™em
 = 
NULL
;

360 
­Ş_veùÜ_de¡roy
(&
ÃtifcÚ_veùÜ
);

362 
	gmod
->
	g»suÉ
 = 
»s
;

366 
	gfšd_Ãtif_ty³s_run_ç
:

367 
£chk_´oof_ä“
(
´oof
);

368 
£chk_™em_ä“
(
™em
);

369 
ä“
(
buff
);

370 
£chk_»suÉ_de¡roy
(&
»s
);

371 
	g”ºo
 = 
”rÜ
;

382 
fšd_Ãtif_ty³s_´št
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

384 
	goutfÜm©
 = 0x00;

385 
£chk_™em_t
 *
	g™em
 = 
NULL
;

386 
£chk_´oof_t
 *
	g´oof
 = 
NULL
;

387 
size_t
 
	gi
 = 0, 
	gj
 = 0, 
	gk
 = 0, 
	gnum_™ems
 = 0;

388 cÚ¡ 
qpŞ_ty³_t
 *
	gty³
;

389 
qpŞ_pŞicy_t
 *
	gq
 = 
­Ş_pŞicy_g‘_qpŞ
(
pŞicy
);

390 cÚ¡ *
	gty³_Çme
;

392 ià(!
	gmod
 || !
	gpŞicy
) {

393 
ERR
(
pŞicy
, "%s", "Invalid…arameters");

394 
	g”ºo
 = 
EINVAL
;

397 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

398 
ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

399 
	g”ºo
 = 
EINVAL
;

403 
	goutfÜm©
 = 
mod
->
ouutfÜm©
;

405 
	gnum_™ems
 = 
­Ş_veùÜ_g‘_size
(
mod
->
»suÉ
->
™ems
);

407 ià(!
	gmod
->
	g»suÉ
) {

408 
ERR
(
pŞicy
, "%s", "Module has‚ot been„un");

409 
	g”ºo
 = 
EINVAL
;

413 ià(!
	goutfÜm©
 || (outfÜm© & 
	gSECHK_OUT_QUIET
))

416 ià(
	goutfÜm©
 & 
	gSECHK_OUT_STATS
) {

417 
´štf
("Found %˜Ãtiàty³s.\n", 
num_™ems
);

424 ià(
	goutfÜm©
 & 
	gSECHK_OUT_LIST
) {

425 
´štf
("\n");

426 
	gi
 = 0; i < 
	gnum_™ems
; i++) {

427 
	gj
++;

428 
	gj
 %= 4;

429 
	g™em
 = 
­Ş_veùÜ_g‘_–em’t
(
mod
->
»suÉ
->
™ems
, 
i
);

430 
	gty³
 = (
qpŞ_ty³_t
 *è
™em
->item;

431 
qpŞ_ty³_g‘_Çme
(
q
, 
ty³
, &
ty³_Çme
);

432 
´štf
("%s%s", 
ty³_Çme
, (*)((
j
 && 
i
 !ğ
num_™ems
 - 1) ? ", " : "\n"));

434 
´štf
("\n");

445 ià(
	goutfÜm©
 & 
	gSECHK_OUT_PROOF
) {

446 
´štf
("\n");

447 
	gj
 = 0; j < 
	gnum_™ems
; j++) {

448 
	g™em
 = 
­Ş_veùÜ_g‘_–em’t
(
mod
->
»suÉ
->
™ems
, 
j
);

449 
	gty³
 = (
qpŞ_ty³_t
 *è
™em
->item;

450 
qpŞ_ty³_g‘_Çme
(
q
, 
ty³
, &
ty³_Çme
);

451 ià(
	g™em
) {

452 
´štf
("%s\n", 
ty³_Çme
);

453 
	gk
 = 0; k < 
­Ş_veùÜ_g‘_size
(
™em
->
´oof
); k++) {

454 
	g´oof
 = 
­Ş_veùÜ_g‘_–em’t
(
™em
->
´oof
, 
k
);

455 ià(
	g´oof
)

456 
´štf
("\t%s\n", 
´oof
->
‹xt
);

460 
´štf
("\n");

466 
	$fšd_Ãtif_ty³s_g‘_li¡
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
)

468 
­Ş_veùÜ_t
 **
v
 = 
¬g
;

470 ià(!
mod
 || !
¬g
) {

471 
	`ERR
(
pŞicy
, "%s", "Invalid…arameters");

472 
”ºo
 = 
EINVAL
;

475 ià(
	`¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

476 
	`ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

477 
”ºo
 = 
EINVAL
;

480 ià(!
mod
->
»suÉ
) {

481 
	`ERR
(
pŞicy
, "%s", "Module has‚ot been„un");

482 
”ºo
 = 
EINVAL
;

486 
v
 = &
mod
->
»suÉ
->
™ems
;

489 
	}
}

	@sechecker/modules/find_netif_types.h

27 #iâdeà
FIND_NETIF_TYPES_H


28 
	#FIND_NETIF_TYPES_H


	)

30 #ifdef 
__ılu¥lus


35 
	~"£check”.h
"

36 
	~<­Ş/pŞicy.h
>

37 
	~<­Ş/cÚ‹xt-qu”y.h
>

38 
	~<­Ş/ÃtcÚ-qu”y.h
>

43 
fšd_Ãtif_ty³s_»gi¡”
(
£chk_lib_t
 * 
lib
);

44 
fšd_Ãtif_ty³s_š™
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

45 
fšd_Ãtif_ty³s_run
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

46 
fšd_Ãtif_ty³s_´št
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

47 
fšd_Ãtif_ty³s_g‘_li¡
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

49 #ifdef 
__ılu¥lus


	@sechecker/modules/find_node_types.c

27 
	~"fšd_node_ty³s.h
"

28 
	~<­Ş/ÃtcÚ-qu”y.h
>

30 
	~<¡dio.h
>

31 
	~<¡ršg.h
>

32 
	~<”ºo.h
>

34 cÚ¡ *cÚ¡ 
	gmod_Çme
 = "find_node_types";

40 
	$fšd_node_ty³s_»gi¡”
(
£chk_lib_t
 * 
lib
)

42 
£chk_moduË_t
 *
mod
 = 
NULL
;

43 
£chk_â_t
 *
â_¡ruù
 = 
NULL
;

45 ià(!
lib
) {

46 
	`ERR
(
NULL
, "%s", "No†ibrary");

47 
”ºo
 = 
EINVAL
;

51 
mod
 = 
	`£chk_lib_g‘_moduË
(
mod_Çme
, 
lib
);

52 ià(!
mod
) {

53 
	`ERR
(
NULL
, "%s", "Unknown module");

54 
”ºo
 = 
EINVAL
;

57 
mod
->
·»Á_lib
 = 
lib
;

64 
mod
->
br›f_desütiÚ
 = "utility module";

65 
mod
->
d‘aed_desütiÚ
 =

70 
mod
->
İt_desütiÚ
 =

72 
mod
->
£v”™y
 = 
SECHK_SEV_NONE
;

75 
â_¡ruù
 = 
	`£chk_â_Ãw
();

76 ià(!
â_¡ruù
) {

77 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

78 
”ºo
 = 
ENOMEM
;

81 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_INIT
);

82 ià(!
â_¡ruù
->
Çme
) {

83 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

84 
”ºo
 = 
ENOMEM
;

87 
â_¡ruù
->
â
 = 
fšd_node_ty³s_š™
;

88 
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
);

90 
â_¡ruù
 = 
	`£chk_â_Ãw
();

91 ià(!
â_¡ruù
) {

92 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

93 
”ºo
 = 
ENOMEM
;

96 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_RUN
);

97 ià(!
â_¡ruù
->
Çme
) {

98 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

99 
”ºo
 = 
ENOMEM
;

102 
â_¡ruù
->
â
 = 
fšd_node_ty³s_run
;

103 
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
);

105 
mod
->
d©a_ä“
 = 
NULL
;

107 
â_¡ruù
 = 
	`£chk_â_Ãw
();

108 ià(!
â_¡ruù
) {

109 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

110 
”ºo
 = 
ENOMEM
;

113 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_PRINT
);

114 ià(!
â_¡ruù
->
Çme
) {

115 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

116 
”ºo
 = 
ENOMEM
;

119 
â_¡ruù
->
â
 = 
fšd_node_ty³s_´št
;

120 
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
);

122 
â_¡ruù
 = 
	`£chk_â_Ãw
();

123 ià(!
â_¡ruù
) {

124 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

125 
”ºo
 = 
ENOMEM
;

128 
â_¡ruù
->
Çme
 = 
	`¡rdup
("get_list");

129 ià(!
â_¡ruù
->
Çme
) {

130 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

131 
”ºo
 = 
ENOMEM
;

134 
â_¡ruù
->
â
 = 
fšd_node_ty³s_g‘_li¡
;

135 
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
);

138 
	}
}

144 
fšd_node_ty³s_š™
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

146 ià(!
	gmod
 || !
	gpŞicy
) {

147 
ERR
(
pŞicy
, "%s", "Invalid…arameters");

148 
	g”ºo
 = 
EINVAL
;

151 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

152 
ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

153 
	g”ºo
 = 
EINVAL
;

168 
fšd_node_ty³s_run
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

170 
£chk_»suÉ_t
 *
	g»s
 = 
NULL
;

171 
£chk_™em_t
 *
	g™em
 = 
NULL
;

172 
£chk_´oof_t
 *
	g´oof
 = 
NULL
;

173 *
	gbuff
 = 
NULL
;

174 
size_t
 
	gi
, 
	gbuff_sz
 = 0;

175 
­Ş_veùÜ_t
 *
	gnodecÚ_veùÜ
 = 
NULL
;

176 
qpŞ_pŞicy_t
 *
	gq
 = 
­Ş_pŞicy_g‘_qpŞ
(
pŞicy
);

177 
	g”rÜ
 = 0;

179 ià(!
	gmod
 || !
	gpŞicy
) {

180 
ERR
(
pŞicy
, "%s", "Invalid…arameters");

181 
	g”ºo
 = 
EINVAL
;

184 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

185 
ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

186 
	g”ºo
 = 
EINVAL
;

191 ià(
	gmod
->
	g»suÉ
)

194 
	g»s
 = 
£chk_»suÉ_Ãw
();

195 ià(!
	g»s
) {

196 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

197 
	g”ºo
 = 
ENOMEM
;

200 
	g»s
->
	g‹¡_Çme
 = 
¡rdup
(
mod_Çme
);

201 ià(!
	g»s
->
	g‹¡_Çme
) {

202 
	g”rÜ
 = 
”ºo
;

203 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

204 
	gfšd_node_ty³s_run_ç
;

206 
	g»s
->
	g™em_ty³
 = 
SECHK_ITEM_TYPE
;

207 ià(!(
	g»s
->
	g™ems
 = 
­Ş_veùÜ_ü—‹
(
£chk_™em_ä“
))) {

208 
”rÜ
 = 
”ºo
;

209 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

210 
	gfšd_node_ty³s_run_ç
;

214 cÚ¡ 
qpŞ_isid_t
 *
	gisid
 = 
NULL
;

216 
	gbuff
 = 
NULL
;

217 
qpŞ_pŞicy_g‘_isid_by_Çme
(
q
, "node", &
isid
);

218 ià(
	gisid
) {

219 cÚ¡ 
qpŞ_cÚ‹xt_t
 *
	gcÚ‹xt
;

220 
­Ş_cÚ‹xt_t
 *
	ga_cÚ‹xt
;

221 cÚ¡ 
qpŞ_ty³_t
 *
	gcÚ‹xt_ty³
;

222 cÚ¡ *
	gcÚ‹xt_ty³_Çme
;

223 *
	gtmp
;

225 
	g´oof
 = 
NULL
;

226 
qpŞ_isid_g‘_cÚ‹xt
(
q
, 
isid
, &
cÚ‹xt
);

227 
qpŞ_cÚ‹xt_g‘_ty³
(
q
, 
cÚ‹xt
, &
cÚ‹xt_ty³
);

228 
qpŞ_ty³_g‘_Çme
(
q
, 
cÚ‹xt_ty³
, &
cÚ‹xt_ty³_Çme
);

229 
	ga_cÚ‹xt
 = 
­Ş_cÚ‹xt_ü—‹_äom_qpŞ_cÚ‹xt
(
pŞicy
, 
cÚ‹xt
);

231 ià(
­Ş_¡r_­³nd
(&
buff
, &
buff_sz
, "sid‚ode ") != 0) {

232 
”rÜ
 = 
”ºo
;

233 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

234 
­Ş_cÚ‹xt_de¡roy
(&
a_cÚ‹xt
);

235 
	gfšd_node_ty³s_run_ç
;

238 
	gtmp
 = 
­Ş_cÚ‹xt_»nd”
(
pŞicy
, 
a_cÚ‹xt
);

239 ià(
­Ş_¡r_­³nd
(&
buff
, &
buff_sz
, 
tmp
) != 0) {

240 
”rÜ
 = 
”ºo
;

241 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

242 
­Ş_cÚ‹xt_de¡roy
(&
a_cÚ‹xt
);

243 
ä“
(
tmp
);

244 
	gfšd_node_ty³s_run_ç
;

246 
­Ş_cÚ‹xt_de¡roy
(&
a_cÚ‹xt
);

247 
ä“
(
tmp
);

248 
	gtmp
 = 
NULL
;

250 ià(!
	g™em
) {

251 
	g™em
 = 
£chk_™em_Ãw
(
NULL
);

252 ià(!
	g™em
) {

253 
	g”rÜ
 = 
”ºo
;

254 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

255 
	gfšd_node_ty³s_run_ç
;

257 
	g™em
->
	g‹¡_»suÉ
 = 1;

260 
	g´oof
 = 
£chk_´oof_Ãw
(
NULL
);

261 ià(!
	g´oof
) {

262 
	g”rÜ
 = 
”ºo
;

263 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

264 
	gfšd_node_ty³s_run_ç
;

267 
	g´oof
->
	gty³
 = 
SECHK_ITEM_ISID
;

268 
	g´oof
->
	g–em
 = (*)
isid
;

269 
	g´oof
->
	g‹xt
 = 
buff
;

271 
	g™em
->™em = (*)
cÚ‹xt_ty³
;

272 ià(!
	g™em
->
	g´oof
) {

273 ià(!(
	g™em
->
	g´oof
 = 
­Ş_veùÜ_ü—‹
(
£chk_´oof_ä“
))) {

274 
”rÜ
 = 
”ºo
;

275 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

276 
	gfšd_node_ty³s_run_ç
;

279 ià(
­Ş_veùÜ_­³nd
(
™em
->
´oof
, (*)proof) < 0) {

280 
	g”rÜ
 = 
”ºo
;

281 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

282 
	gfšd_node_ty³s_run_ç
;

284 ià(
­Ş_veùÜ_­³nd
(
»s
->
™ems
, (*)
™em
) < 0) {

285 
	g”rÜ
 = 
”ºo
;

286 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

287 
	gfšd_node_ty³s_run_ç
;

291 ià(
­Ş_nodecÚ_g‘_by_qu”y
(
pŞicy
, 
NULL
, &
nodecÚ_veùÜ
) < 0) {

292 
	g”rÜ
 = 
”ºo
;

293 
	gfšd_node_ty³s_run_ç
;

296 
	gi
 = 0; i < 
­Ş_veùÜ_g‘_size
(
nodecÚ_veùÜ
); i++) {

297 cÚ¡ *
	gty³_Çme
;

298 
size_t
 
	gj
;

299 cÚ¡ 
qpŞ_cÚ‹xt_t
 *
	gcÚ‹xt
;

300 cÚ¡ 
qpŞ_ty³_t
 *
	gcÚ‹xt_ty³
;

301 
qpŞ_nodecÚ_t
 *
	gnodecÚ
 = 
­Ş_veùÜ_g‘_–em’t
(
nodecÚ_veùÜ
, 
i
);

302 
qpŞ_nodecÚ_g‘_cÚ‹xt
(
q
, 
nodecÚ
, &
cÚ‹xt
);

303 
qpŞ_cÚ‹xt_g‘_ty³
(
q
, 
cÚ‹xt
, &
cÚ‹xt_ty³
);

304 
qpŞ_ty³_g‘_Çme
(
q
, 
cÚ‹xt_ty³
, &
ty³_Çme
);

306 
	g´oof
 = 
£chk_´oof_Ãw
(
NULL
);

307 ià(!
	g´oof
) {

308 
	g”rÜ
 = 
”ºo
;

309 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

310 
	gfšd_node_ty³s_run_ç
;

312 
	g´oof
->
	gty³
 = 
SECHK_ITEM_NONE
;

313 
	g´oof
->
	g‹xt
 = 
­Ş_nodecÚ_»nd”
(
pŞicy
, 
nodecÚ
);

315 
	gj
 = 0; j < 
­Ş_veùÜ_g‘_size
(
»s
->
™ems
); j++) {

316 
£chk_™em_t
 *
	g»s_™em
;

317 cÚ¡ 
qpŞ_ty³_t
 *
	g»s_ty³
;

318 cÚ¡ *
	g»s_ty³_Çme
;

320 
	g»s_™em
 = 
­Ş_veùÜ_g‘_–em’t
(
»s
->
™ems
, 
j
);

321 
	g»s_ty³
 = 
»s_™em
->
™em
;

322 
qpŞ_ty³_g‘_Çme
(
q
, 
»s_ty³
, &
»s_ty³_Çme
);

323 ià(!
¡rcmp
(
»s_ty³_Çme
, 
ty³_Çme
))

324 
	g™em
 = 
»s_™em
;

326 ià(!
	g™em
) {

327 
	g™em
 = 
£chk_™em_Ãw
(
NULL
);

328 ià(!
	g™em
) {

329 
	g”rÜ
 = 
”ºo
;

330 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

331 
	gfšd_node_ty³s_run_ç
;

333 
	g™em
->
	g‹¡_»suÉ
 = 1;

334 
	g™em
->™em = (*)
cÚ‹xt_ty³
;

335 ià(
­Ş_veùÜ_­³nd
(
»s
->
™ems
, (*)
™em
) < 0) {

336 
	g”rÜ
 = 
”ºo
;

337 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

338 
	gfšd_node_ty³s_run_ç
;

341 ià(!
	g™em
->
	g´oof
) {

342 ià(!(
	g™em
->
	g´oof
 = 
­Ş_veùÜ_ü—‹
(
£chk_´oof_ä“
))) {

343 
”rÜ
 = 
”ºo
;

344 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

345 
	gfšd_node_ty³s_run_ç
;

348 ià(
­Ş_veùÜ_­³nd
(
™em
->
´oof
, (*)proof) < 0) {

349 
	g”rÜ
 = 
”ºo
;

350 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

351 
	gfšd_node_ty³s_run_ç
;

353 
	g™em
 = 
NULL
;

355 
­Ş_veùÜ_de¡roy
(&
nodecÚ_veùÜ
);

357 
	gmod
->
	g»suÉ
 = 
»s
;

361 
	gfšd_node_ty³s_run_ç
:

362 
­Ş_veùÜ_de¡roy
(&
nodecÚ_veùÜ
);

363 
£chk_´oof_ä“
(
´oof
);

364 
£chk_™em_ä“
(
™em
);

365 
ä“
(
buff
);

366 
£chk_»suÉ_de¡roy
(&
»s
);

367 
	g”ºo
 = 
”rÜ
;

372 
fšd_node_ty³s_´št
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹
((
unu£d
)))

374 
	goutfÜm©
 = 0x00;

375 
£chk_™em_t
 *
	g™em
 = 
NULL
;

376 
£chk_´oof_t
 *
	g´oof
 = 
NULL
;

377 
size_t
 
	gi
 = 0, 
	gj
 = 0, 
	gk
 = 0, 
	gnum_™ems
 = 0;

378 cÚ¡ 
qpŞ_ty³_t
 *
	gty³
;

379 
qpŞ_pŞicy_t
 *
	gq
 = 
­Ş_pŞicy_g‘_qpŞ
(
pŞicy
);

380 cÚ¡ *
	gty³_Çme
;

382 ià(!
	gmod
 || !
	gpŞicy
) {

383 
ERR
(
pŞicy
, "%s", "Invalid…arameters");

384 
	g”ºo
 = 
EINVAL
;

387 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

388 
ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

389 
	g”ºo
 = 
EINVAL
;

393 
	goutfÜm©
 = 
mod
->
ouutfÜm©
;

395 
	gnum_™ems
 = 
­Ş_veùÜ_g‘_size
(
mod
->
»suÉ
->
™ems
);

397 ià(!
	gmod
->
	g»suÉ
) {

398 
ERR
(
pŞicy
, "%s", "Module has‚ot been„un");

399 
	g”ºo
 = 
EINVAL
;

403 ià(!
	goutfÜm©
 || (outfÜm© & 
	gSECHK_OUT_QUIET
))

406 ià(
	goutfÜm©
 & 
	gSECHK_OUT_STATS
) {

407 
´štf
("Found %˜nodty³s.\n", 
num_™ems
);

414 ià(
	goutfÜm©
 & 
	gSECHK_OUT_LIST
) {

415 
´štf
("\n");

416 
	gi
 = 0; i < 
	gnum_™ems
; i++) {

417 
	gj
++;

418 
	gj
 %= 4;

419 
	g™em
 = 
­Ş_veùÜ_g‘_–em’t
(
mod
->
»suÉ
->
™ems
, 
i
);

420 
	gty³
 = (
qpŞ_ty³_t
 *è
™em
->item;

421 
qpŞ_ty³_g‘_Çme
(
q
, 
ty³
, &
ty³_Çme
);

422 
´štf
("%s%s", 
ty³_Çme
, (*)((
j
 && 
i
 !ğ
num_™ems
 - 1) ? ", " : "\n"));

424 
´štf
("\n");

435 ià(
	goutfÜm©
 & 
	gSECHK_OUT_PROOF
) {

436 
´štf
("\n");

437 
	gj
 = 0; j < 
	gnum_™ems
; j++) {

438 
	g™em
 = 
­Ş_veùÜ_g‘_–em’t
(
mod
->
»suÉ
->
™ems
, 
j
);

439 
	gty³
 = (
qpŞ_ty³_t
 *è
™em
->item;

440 
qpŞ_ty³_g‘_Çme
(
q
, 
ty³
, &
ty³_Çme
);

441 ià(
	g™em
) {

442 
´štf
("%s\n", 
ty³_Çme
);

443 
	gk
 = 0; k < 
­Ş_veùÜ_g‘_size
(
™em
->
´oof
); k++) {

444 
	g´oof
 = 
­Ş_veùÜ_g‘_–em’t
(
™em
->
´oof
, 
k
);

445 ià(
	g´oof
)

446 
´štf
("\t%s\n", 
´oof
->
‹xt
);

450 
´štf
("\n");

456 
fšd_node_ty³s_g‘_li¡
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
 
__©Œibu‹__
 ((
unu£d
)), *
¬g
)

458 
­Ş_veùÜ_t
 **
	gv
 = 
¬g
;

460 ià(!
	gmod
 || !
	g¬g
) {

461 
ERR
(
NULL
, "%s", "Invalid…arameters");

462 
	g”ºo
 = 
EINVAL
;

465 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

466 
ERR
(
NULL
, "WrÚg moduË (%s)", 
mod
->
Çme
);

467 
	g”ºo
 = 
EINVAL
;

470 ià(!
	gmod
->
	g»suÉ
) {

471 
ERR
(
NULL
, "%s", "Module has‚ot been„un");

472 
	g”ºo
 = 
EINVAL
;

476 
	gv
 = &
mod
->
»suÉ
->
™ems
;

	@sechecker/modules/find_node_types.h

27 #iâdeà
FIND_NODE_TYPES_H


28 
	#FINE_NODE_TYPES_H


	)

30 #ifdef 
__ılu¥lus


35 
	~"£check”.h
"

36 
	~<­Ş/pŞicy.h
>

37 
	~<­Ş/cÚ‹xt-qu”y.h
>

38 
	~<­Ş/ÃtcÚ-qu”y.h
>

43 
fšd_node_ty³s_»gi¡”
(
£chk_lib_t
 * 
lib
);

44 
fšd_node_ty³s_š™
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

45 
fšd_node_ty³s_run
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

46 
fšd_node_ty³s_´št
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

47 
fšd_node_ty³s_g‘_li¡
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

49 #ifdef 
__ılu¥lus


	@sechecker/modules/find_port_types.c

27 
	~"fšd_pÜt_ty³s.h
"

28 
	~<­Ş/ÃtcÚ-qu”y.h
>

30 
	~<¡dio.h
>

31 
	~<¡ršg.h
>

32 
	~<”ºo.h
>

34 cÚ¡ *cÚ¡ 
	gmod_Çme
 = "find_port_types";

38 
	$fšd_pÜt_ty³s_»gi¡”
(
£chk_lib_t
 * 
lib
)

40 
£chk_moduË_t
 *
mod
 = 
NULL
;

41 
£chk_â_t
 *
â_¡ruù
 = 
NULL
;

43 ià(!
lib
) {

44 
	`ERR
(
NULL
, "%s", "No†ibrary");

45 
”ºo
 = 
EINVAL
;

52 
mod
 = 
	`£chk_lib_g‘_moduË
(
mod_Çme
, 
lib
);

53 ià(!
mod
) {

54 
	`ERR
(
NULL
, "%s", "Module unknown");

55 
”ºo
 = 
EINVAL
;

59 
mod
->
·»Á_lib
 = 
lib
;

62 
mod
->
br›f_desütiÚ
 = "utility module";

63 
mod
->
d‘aed_desütiÚ
 =

68 
mod
->
İt_desütiÚ
 =

70 
mod
->
£v”™y
 = 
SECHK_SEV_NONE
;

73 
â_¡ruù
 = 
	`£chk_â_Ãw
();

74 ià(!
â_¡ruù
) {

75 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

76 
”ºo
 = 
ENOMEM
;

79 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_INIT
);

80 ià(!
â_¡ruù
->
Çme
) {

81 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

82 
”ºo
 = 
ENOMEM
;

85 
â_¡ruù
->
â
 = 
fšd_pÜt_ty³s_š™
;

86 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
) < 0) {

87 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

88 
”ºo
 = 
ENOMEM
;

92 
â_¡ruù
 = 
	`£chk_â_Ãw
();

93 ià(!
â_¡ruù
) {

94 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

95 
”ºo
 = 
ENOMEM
;

98 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_RUN
);

99 ià(!
â_¡ruù
->
Çme
) {

100 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

101 
”ºo
 = 
ENOMEM
;

104 
â_¡ruù
->
â
 = 
fšd_pÜt_ty³s_run
;

105 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
) < 0) {

106 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

107 
”ºo
 = 
ENOMEM
;

111 
mod
->
d©a_ä“
 = 
NULL
;

113 
â_¡ruù
 = 
	`£chk_â_Ãw
();

114 ià(!
â_¡ruù
) {

115 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

116 
”ºo
 = 
ENOMEM
;

119 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_PRINT
);

120 ià(!
â_¡ruù
->
Çme
) {

121 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

122 
”ºo
 = 
ENOMEM
;

125 
â_¡ruù
->
â
 = 
fšd_pÜt_ty³s_´št
;

126 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
) < 0) {

127 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

128 
”ºo
 = 
ENOMEM
;

132 
â_¡ruù
 = 
	`£chk_â_Ãw
();

133 ià(!
â_¡ruù
) {

134 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

135 
”ºo
 = 
ENOMEM
;

138 
â_¡ruù
->
Çme
 = 
	`¡rdup
("get_list");

139 ià(!
â_¡ruù
->
Çme
) {

140 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

141 
”ºo
 = 
ENOMEM
;

144 
â_¡ruù
->
â
 = &
fšd_pÜt_ty³s_g‘_li¡
;

145 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
) < 0) {

146 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

147 
”ºo
 = 
ENOMEM
;

152 
	}
}

158 
fšd_pÜt_ty³s_š™
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

160 ià(!
	gmod
 || !
	gpŞicy
) {

161 
ERR
(
pŞicy
, "%s", "Invalid…arameters");

162 
	g”ºo
 = 
EINVAL
;

165 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

166 
ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

167 
	g”ºo
 = 
EINVAL
;

182 
fšd_pÜt_ty³s_run
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

184 
£chk_»suÉ_t
 *
	g»s
 = 
NULL
;

185 
£chk_™em_t
 *
	g™em
 = 
NULL
;

186 
£chk_´oof_t
 *
	g´oof
 = 
NULL
;

187 *
	gbuff
 = 
NULL
;

188 
size_t
 
	gbuff_sz
 = 0, 
	gi
, 
	gj
;

189 
­Ş_veùÜ_t
 *
	gpÜtcÚ_veùÜ
;

190 
qpŞ_pŞicy_t
 *
	gq
 = 
­Ş_pŞicy_g‘_qpŞ
(
pŞicy
);

191 
	g”rÜ
 = 0;

193 ià(!
	gmod
 || !
	gpŞicy
) {

194 
ERR
(
pŞicy
, "%s", "Invalid…arameters");

195 
	g”ºo
 = 
EINVAL
;

198 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

199 
ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

200 
	g”ºo
 = 
EINVAL
;

205 ià(
	gmod
->
	g»suÉ
)

208 
	g»s
 = 
£chk_»suÉ_Ãw
();

209 ià(!
	g»s
) {

210 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

211 
	g”ºo
 = 
ENOMEM
;

214 
	g»s
->
	g‹¡_Çme
 = 
¡rdup
(
mod_Çme
);

215 ià(!
	g»s
->
	g‹¡_Çme
) {

216 
	g”rÜ
 = 
”ºo
;

217 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

218 
	gfšd_pÜt_ty³s_run_ç
;

220 
	g»s
->
	g™em_ty³
 = 
SECHK_ITEM_TYPE
;

221 ià(!(
	g»s
->
	g™ems
 = 
­Ş_veùÜ_ü—‹
(
£chk_™em_ä“
))) {

222 
”rÜ
 = 
”ºo
;

223 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

224 
	gfšd_pÜt_ty³s_run_ç
;

228 cÚ¡ 
qpŞ_isid_t
 *
	gisid
 = 
NULL
;

229 
	gbuff
 = 
NULL
;

230 
qpŞ_pŞicy_g‘_isid_by_Çme
(
q
, "pÜt", &
isid
);

231 ià(
	gisid
) {

232 cÚ¡ 
qpŞ_cÚ‹xt_t
 *
	gcÚ‹xt
;

233 
­Ş_cÚ‹xt_t
 *
	ga_cÚ‹xt
;

234 cÚ¡ 
qpŞ_ty³_t
 *
	gcÚ‹xt_ty³
;

235 cÚ¡ *
	gcÚ‹xt_ty³_Çme
;

236 *
	gtmp
;

238 
	g´oof
 = 
NULL
;

239 
qpŞ_isid_g‘_cÚ‹xt
(
q
, 
isid
, &
cÚ‹xt
);

240 
qpŞ_cÚ‹xt_g‘_ty³
(
q
, 
cÚ‹xt
, &
cÚ‹xt_ty³
);

241 
qpŞ_ty³_g‘_Çme
(
q
, 
cÚ‹xt_ty³
, &
cÚ‹xt_ty³_Çme
);

242 
	ga_cÚ‹xt
 = 
­Ş_cÚ‹xt_ü—‹_äom_qpŞ_cÚ‹xt
(
pŞicy
, 
cÚ‹xt
);

244 ià(
­Ş_¡r_­³nd
(&
buff
, &
buff_sz
, "sid…ort ") != 0) {

245 
”rÜ
 = 
”ºo
;

246 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

247 
­Ş_cÚ‹xt_de¡roy
(&
a_cÚ‹xt
);

248 
	gfšd_pÜt_ty³s_run_ç
;

251 
	gtmp
 = 
­Ş_cÚ‹xt_»nd”
(
pŞicy
, 
a_cÚ‹xt
);

252 ià(
­Ş_¡r_­³nd
(&
buff
, &
buff_sz
, 
tmp
) != 0) {

253 
”rÜ
 = 
”ºo
;

254 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

255 
­Ş_cÚ‹xt_de¡roy
(&
a_cÚ‹xt
);

256 
ä“
(
tmp
);

257 
	gfšd_pÜt_ty³s_run_ç
;

259 
ä“
(
tmp
);

260 
	gtmp
 = 
NULL
;

261 
­Ş_cÚ‹xt_de¡roy
(&
a_cÚ‹xt
);

263 
	g´oof
 = 
£chk_´oof_Ãw
(
NULL
);

264 ià(!
	g´oof
) {

265 
	g”rÜ
 = 
”ºo
;

266 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

267 
	gfšd_pÜt_ty³s_run_ç
;

270 
	g´oof
->
	gty³
 = 
SECHK_ITEM_ISID
;

271 
	g´oof
->
	g–em
 = (*)
isid
;

272 
	g´oof
->
	g‹xt
 = 
buff
;

275 
	gj
 = 0; j < 
­Ş_veùÜ_g‘_size
(
»s
->
™ems
); j++) {

276 
£chk_™em_t
 *
	g»s_™em
 = 
NULL
;

277 cÚ¡ 
qpŞ_ty³_t
 *
	g»s_ty³
;

278 cÚ¡ *
	g»s_ty³_Çme
;

280 
	g»s_™em
 = 
­Ş_veùÜ_g‘_–em’t
(
»s
->
™ems
, 
j
);

281 
	g»s_ty³
 = 
»s_™em
->
™em
;

282 
qpŞ_ty³_g‘_Çme
(
q
, 
»s_ty³
, &
»s_ty³_Çme
);

283 ià(!
¡rcmp
(
»s_ty³_Çme
, 
cÚ‹xt_ty³_Çme
))

284 
	g™em
 = 
»s_™em
;

288 ià(!
	g™em
) {

289 
	g™em
 = 
£chk_™em_Ãw
(
NULL
);

290 ià(!
	g™em
) {

291 
	g”rÜ
 = 
”ºo
;

292 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

293 
	gfšd_pÜt_ty³s_run_ç
;

295 
	g™em
->
	g‹¡_»suÉ
 = 1;

296 
	g™em
->™em = (*)
cÚ‹xt_ty³
;

297 ià(
­Ş_veùÜ_­³nd
(
»s
->
™ems
, (*)
™em
) < 0) {

298 
	g”rÜ
 = 
”ºo
;

299 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

300 
	gfšd_pÜt_ty³s_run_ç
;

304 ià(!
	g™em
->
	g´oof
) {

305 ià(!(
	g™em
->
	g´oof
 = 
­Ş_veùÜ_ü—‹
(
£chk_´oof_ä“
))) {

306 
”rÜ
 = 
”ºo
;

307 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

308 
	gfšd_pÜt_ty³s_run_ç
;

311 ià(
­Ş_veùÜ_­³nd
(
™em
->
´oof
, (*)proof) < 0) {

312 
	g”rÜ
 = 
”ºo
;

313 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

314 
	gfšd_pÜt_ty³s_run_ç
;

318 ià(
­Ş_pÜtcÚ_g‘_by_qu”y
(
pŞicy
, 
NULL
, &
pÜtcÚ_veùÜ
) < 0) {

319 
	g”rÜ
 = 
”ºo
;

320 
	gfšd_pÜt_ty³s_run_ç
;

323 
	gi
 = 0; i < 
­Ş_veùÜ_g‘_size
(
pÜtcÚ_veùÜ
); i++) {

324 cÚ¡ *
	gpÜtcÚ_Çme
 = 
NULL
;

325 cÚ¡ 
qpŞ_pÜtcÚ_t
 *
	gpÜtcÚ
 = 
NULL
;

326 cÚ¡ 
qpŞ_cÚ‹xt_t
 *
	gpÜtcÚ_cÚ‹xt
 = 
NULL
;

327 cÚ¡ 
qpŞ_ty³_t
 *
	gpÜtcÚ_ty³
 = 
NULL
;

329 
	gpÜtcÚ
 = 
­Ş_veùÜ_g‘_–em’t
(
pÜtcÚ_veùÜ
, 
i
);

330 
qpŞ_pÜtcÚ_g‘_cÚ‹xt
(
q
, 
pÜtcÚ
, &
pÜtcÚ_cÚ‹xt
);

331 
qpŞ_cÚ‹xt_g‘_ty³
(
q
, 
pÜtcÚ_cÚ‹xt
, &
pÜtcÚ_ty³
);

332 
qpŞ_ty³_g‘_Çme
(
q
, 
pÜtcÚ_ty³
, &
pÜtcÚ_Çme
);

334 
	g´oof
 = 
£chk_´oof_Ãw
(
NULL
);

335 ià(!
	g´oof
) {

336 
	g”rÜ
 = 
”ºo
;

337 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

338 
	gfšd_pÜt_ty³s_run_ç
;

340 
	g´oof
->
	gty³
 = 
SECHK_ITEM_PORTCON
;

341 
	g´oof
->
	g–em
 = (*)
pÜtcÚ
;

342 
	g´oof
->
	g‹xt
 = 
­Ş_pÜtcÚ_»nd”
(
pŞicy
, 
pÜtcÚ
);

343 
	g™em
 = 
NULL
;

346 
	gj
 = 0; j < 
­Ş_veùÜ_g‘_size
(
»s
->
™ems
); j++) {

347 
£chk_™em_t
 *
	g»s_™em
 = 
NULL
;

348 cÚ¡ 
qpŞ_ty³_t
 *
	g»s_ty³
;

349 cÚ¡ *
	g»s_ty³_Çme
;

351 
	g»s_™em
 = 
­Ş_veùÜ_g‘_–em’t
(
»s
->
™ems
, 
j
);

352 
	g»s_ty³
 = 
»s_™em
->
™em
;

353 
qpŞ_ty³_g‘_Çme
(
q
, 
»s_ty³
, &
»s_ty³_Çme
);

354 ià(!
¡rcmp
(
»s_ty³_Çme
, 
pÜtcÚ_Çme
))

355 
	g™em
 = 
»s_™em
;

359 ià(!
	g™em
) {

360 
	g™em
 = 
£chk_™em_Ãw
(
NULL
);

361 ià(!
	g™em
) {

362 
	g”rÜ
 = 
”ºo
;

363 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

364 
	gfšd_pÜt_ty³s_run_ç
;

366 
	g™em
->
	g‹¡_»suÉ
 = 1;

367 
	g™em
->™em = (*)
pÜtcÚ_ty³
;

368 ià(
­Ş_veùÜ_­³nd
(
»s
->
™ems
, (*)
™em
) < 0) {

369 
	g”rÜ
 = 
”ºo
;

370 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

371 
	gfšd_pÜt_ty³s_run_ç
;

375 ià(!
	g™em
->
	g´oof
) {

376 ià(!(
	g™em
->
	g´oof
 = 
­Ş_veùÜ_ü—‹
(
£chk_´oof_ä“
))) {

377 
”rÜ
 = 
”ºo
;

378 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

379 
	gfšd_pÜt_ty³s_run_ç
;

382 ià(
­Ş_veùÜ_­³nd
(
™em
->
´oof
, (*)proof) < 0) {

383 
	g”rÜ
 = 
”ºo
;

384 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

385 
	gfšd_pÜt_ty³s_run_ç
;

387 
	g™em
 = 
NULL
;

389 
­Ş_veùÜ_de¡roy
(&
pÜtcÚ_veùÜ
);

391 
	gmod
->
	g»suÉ
 = 
»s
;

395 
	gfšd_pÜt_ty³s_run_ç
:

396 
£chk_´oof_ä“
(
´oof
);

397 
£chk_™em_ä“
(
™em
);

398 
ä“
(
buff
);

399 
£chk_»suÉ_de¡roy
(&
»s
);

400 
	g”ºo
 = 
”rÜ
;

406 
fšd_pÜt_ty³s_´št
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

408 
	goutfÜm©
 = 0x00;

409 
£chk_™em_t
 *
	g™em
 = 
NULL
;

410 
£chk_´oof_t
 *
	g´oof
 = 
NULL
;

411 
size_t
 
	gi
 = 0, 
	gj
 = 0, 
	gk
 = 0, 
	gnum_™ems
 = 0;

412 cÚ¡ 
qpŞ_ty³_t
 *
	gty³
;

413 
qpŞ_pŞicy_t
 *
	gq
 = 
­Ş_pŞicy_g‘_qpŞ
(
pŞicy
);

414 cÚ¡ *
	gty³_Çme
;

416 ià(!
	gmod
 || !
	gpŞicy
) {

417 
ERR
(
pŞicy
, "%s", "Invalid…arameters");

418 
	g”ºo
 = 
EINVAL
;

421 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

422 
ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

423 
	g”ºo
 = 
EINVAL
;

427 
	goutfÜm©
 = 
mod
->
ouutfÜm©
;

429 
	gnum_™ems
 = 
­Ş_veùÜ_g‘_size
(
mod
->
»suÉ
->
™ems
);

431 ià(!
	gmod
->
	g»suÉ
) {

432 
ERR
(
pŞicy
, "%s", "Module has‚ot been„un");

433 
	g”ºo
 = 
EINVAL
;

437 ià(!
	goutfÜm©
 || (outfÜm© & 
	gSECHK_OUT_QUIET
))

440 ià(
	goutfÜm©
 & 
	gSECHK_OUT_STATS
) {

441 
´štf
("Found %˜pÜˆty³s.\n", 
num_™ems
);

448 ià(
	goutfÜm©
 & 
	gSECHK_OUT_LIST
) {

449 
´štf
("\n");

450 
	gi
 = 0; i < 
	gnum_™ems
; i++) {

451 
	gj
++;

452 
	gj
 %= 4;

453 
	g™em
 = 
­Ş_veùÜ_g‘_–em’t
(
mod
->
»suÉ
->
™ems
, 
i
);

454 
	gty³
 = (
qpŞ_ty³_t
 *è
™em
->item;

455 
qpŞ_ty³_g‘_Çme
(
q
, 
ty³
, &
ty³_Çme
);

456 
´štf
("%s%s", 
ty³_Çme
, (*)((
j
 && 
i
 !ğ
num_™ems
 - 1) ? ", " : "\n"));

458 
´štf
("\n");

469 ià(
	goutfÜm©
 & 
	gSECHK_OUT_PROOF
) {

470 
´štf
("\n");

471 
	gj
 = 0; j < 
	gnum_™ems
; j++) {

472 
	g™em
 = 
­Ş_veùÜ_g‘_–em’t
(
mod
->
»suÉ
->
™ems
, 
j
);

473 
	gty³
 = (
qpŞ_ty³_t
 *è
™em
->item;

474 
qpŞ_ty³_g‘_Çme
(
q
, 
ty³
, &
ty³_Çme
);

475 ià(
	g™em
) {

476 
´štf
("%s\n", 
ty³_Çme
);

477 
	gk
 = 0; k < 
­Ş_veùÜ_g‘_size
(
™em
->
´oof
); k++) {

478 
	g´oof
 = 
­Ş_veùÜ_g‘_–em’t
(
™em
->
´oof
, 
k
);

479 ià(
	g´oof
)

480 
´štf
("\t%s\n", 
´oof
->
‹xt
);

484 
´štf
("\n");

490 
fšd_pÜt_ty³s_g‘_li¡
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
 
__©Œibu‹__
 ((
unu£d
)), *
¬g
)

492 
­Ş_veùÜ_t
 **
	gv
 = 
¬g
;

494 ià(!
	gmod
 || !
	g¬g
) {

495 
ERR
(
NULL
, "%s", "Invalid…arameters");

496 
	g”ºo
 = 
EINVAL
;

499 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

500 
ERR
(
NULL
, "WrÚg moduË (%s)", 
mod
->
Çme
);

501 
	g”ºo
 = 
EINVAL
;

504 ià(!
	gmod
->
	g»suÉ
) {

505 
ERR
(
NULL
, "%s", "Module has‚ot been„un");

506 
	g”ºo
 = 
EINVAL
;

510 
	gv
 = &
mod
->
»suÉ
->
™ems
;

	@sechecker/modules/find_port_types.h

27 #iâdeà
FIND_PORT_TYPES


28 
	#FIND_PORT_TYPES


	)

30 #ifdef 
__ılu¥lus


35 
	~"£check”.h
"

36 
	~<­Ş/pŞicy.h
>

37 
	~<­Ş/cÚ‹xt-qu”y.h
>

38 
	~<­Ş/ÃtcÚ-qu”y.h
>

40 
fšd_pÜt_ty³s_»gi¡”
(
£chk_lib_t
 * 
lib
);

41 
fšd_pÜt_ty³s_š™
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

42 
fšd_pÜt_ty³s_run
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

43 
fšd_pÜt_ty³s_´št
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

44 
fšd_pÜt_ty³s_g‘_li¡
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

46 #ifdef 
__ılu¥lus


	@sechecker/modules/imp_range_trans.c

27 
	~"imp_¿nge_Œªs.h
"

29 
	~<¡dio.h
>

30 
	~<¡ršg.h
>

31 
	~<”ºo.h
>

33 
	#SECHK_NO_ROLES
 0x000002

	)

34 
	#SECHK_BAD_USER_MLS_LOW
 0x000040

	)

35 
	#SECHK_BAD_USER_MLS_HIGH
 0x000600

	)

36 
	#SECHK_NO_USERS
 0x008000

	)

37 
	#SECHK_NO_EXEC_PERMS
 0x020000

	)

39 cÚ¡ *cÚ¡ 
	gmod_Çme
 = "imp_range_trans";

41 
	$imp_¿nge_Œªs_»gi¡”
(
£chk_lib_t
 * 
lib
)

43 
£chk_moduË_t
 *
mod
 = 
NULL
;

44 
£chk_â_t
 *
â_¡ruù
 = 
NULL
;

46 ià(!
lib
) {

47 
	`ERR
(
NULL
, "%s", "No†ibrary");

48 
”ºo
 = 
EINVAL
;

52 
mod
 = 
	`£chk_lib_g‘_moduË
(
mod_Çme
, 
lib
);

53 ià(!
mod
) {

54 
	`ERR
(
NULL
, "%s", "Module unknown");

55 
”ºo
 = 
EINVAL
;

58 
mod
->
·»Á_lib
 = 
lib
;

61 
mod
->
br›f_desütiÚ
 = "finds impossible„angeransitions";

62 
mod
->
d‘aed_desütiÚ
 =

70 
mod
->
İt_desütiÚ
 =

73 
mod
->
£v”™y
 = 
SECHK_SEV_MED
;

76 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
»quœem’ts
, 
	`£chk_Çme_v®ue_Ãw
(
SECHK_REQ_POLICY_CAP
, 
SECHK_REQ_CAP_MLS
)) < 0) {

77 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

78 
”ºo
 = 
ENOMEM
;

82 
â_¡ruù
 = 
	`£chk_â_Ãw
();

83 ià(!
â_¡ruù
) {

84 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

85 
”ºo
 = 
ENOMEM
;

88 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_INIT
);

89 ià(!
â_¡ruù
->
Çme
) {

90 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

91 
”ºo
 = 
ENOMEM
;

94 
â_¡ruù
->
â
 = 
imp_¿nge_Œªs_š™
;

95 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
) < 0) {

96 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

97 
”ºo
 = 
ENOMEM
;

101 
â_¡ruù
 = 
	`£chk_â_Ãw
();

102 ià(!
â_¡ruù
) {

103 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

104 
”ºo
 = 
ENOMEM
;

107 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_RUN
);

108 ià(!
â_¡ruù
->
Çme
) {

109 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

110 
”ºo
 = 
ENOMEM
;

113 
â_¡ruù
->
â
 = 
imp_¿nge_Œªs_run
;

114 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
) < 0) {

115 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

116 
”ºo
 = 
ENOMEM
;

120 
mod
->
d©a_ä“
 = 
NULL
;

122 
â_¡ruù
 = 
	`£chk_â_Ãw
();

123 ià(!
â_¡ruù
) {

124 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

125 
”ºo
 = 
ENOMEM
;

128 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_PRINT
);

129 ià(!
â_¡ruù
->
Çme
) {

130 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

131 
”ºo
 = 
ENOMEM
;

134 
â_¡ruù
->
â
 = 
imp_¿nge_Œªs_´št
;

135 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
) < 0) {

136 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

137 
”ºo
 = 
ENOMEM
;

142 
	}
}

147 
imp_¿nge_Œªs_š™
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

149 ià(!
	gmod
 || !
	gpŞicy
) {

150 
ERR
(
pŞicy
, "%s", "Invalid…arameters");

151 
	g”ºo
 = 
EINVAL
;

154 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

155 
ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

156 
	g”ºo
 = 
EINVAL
;

160 
	gmod
->
	gd©a
 = 
NULL
;

173 
imp_¿nge_Œªs_run
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

175 
£chk_»suÉ_t
 *
	g»s
 = 
NULL
;

176 
£chk_™em_t
 *
	g™em
 = 
NULL
;

177 
£chk_´oof_t
 *
	g´oof
 = 
NULL
;

178 
size_t
 
	gi
, 
	gj
;

179 
­Ş_veùÜ_t
 *
	g¿nge_Œªs_veùÜ
 = 
NULL
, *
	grŞe_veùÜ
 = NULL, *
	gtmp_v
 = NULL;

180 
­Ş_veùÜ_t
 *
	gu£r_veùÜ
 = 
NULL
, *
	gu£rs_w_rŞes
 = NULL, *
	gu£rs_w_¿nge
 = NULL;

181 
­Ş_veùÜ_t
 *
	gruË_veùÜ
 = 
NULL
;

182 cÚ¡ 
qpŞ_¿nge_Œªs_t
 *
	gruË
;

183 cÚ¡ 
qpŞ_ty³_t
 *
	gsourû
 = 
NULL
;

184 cÚ¡ 
qpŞ_ty³_t
 *
	grg‘
 = 
NULL
;

185 cÚ¡ 
qpŞ_rŞe_t
 *
	grŞe
 = 
NULL
;

186 cÚ¡ *
	gsourû_Çme
 = 
NULL
, *
	grg‘_Çme
 = NULL, *
	grŞe_Çme
 = NULL;

187 
­Ş_rŞe_qu”y_t
 *
	grŞe_qu”y
 = 
NULL
;

188 
­Ş_u£r_qu”y_t
 *
	gu£r_qu”y
 = 
NULL
;

189 
­Ş_avruË_qu”y_t
 *
	gavruË_qu”y
 = 
NULL
;

190 
­Ş_mls_¿nge_t
 *
	g¿nge
;

191 cÚ¡ 
qpŞ_mls_¿nge_t
 *
	gqpŞ_¿nge
;

192 
qpŞ_pŞicy_t
 *
	gq
 = 
­Ş_pŞicy_g‘_qpŞ
(
pŞicy
);

193 
	g”rÜ
 = 0;

195 ià(!
	gmod
 || !
	gpŞicy
) {

196 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
EINVAL
));

197 
	g”ºo
 = 
EINVAL
;

200 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

201 
ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

202 
	g”ºo
 = 
EINVAL
;

207 ià(
	gmod
->
	g»suÉ
)

210 
	g»s
 = 
£chk_»suÉ_Ãw
();

211 ià(!
	g»s
) {

212 
	g”rÜ
 = 
”ºo
;

213 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

214 
	g”ºo
 = 
”rÜ
;

217 
	g»s
->
	g‹¡_Çme
 = 
¡rdup
(
mod_Çme
);

218 ià(!
	g»s
->
	g‹¡_Çme
) {

219 
	g”rÜ
 = 
”ºo
;

220 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

221 
	gimp_¿nge_Œªs_run_ç
;

223 
	g»s
->
	g™em_ty³
 = 
SECHK_ITEM_RANGETRANS
;

224 ià(!(
	g»s
->
	g™ems
 = 
­Ş_veùÜ_ü—‹
(
£chk_™em_ä“
))) {

225 
”rÜ
 = 
”ºo
;

226 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

227 
	gimp_¿nge_Œªs_run_ç
;

230 ià(
­Ş_¿nge_Œªs_g‘_by_qu”y
(
pŞicy
, 
NULL
, &
¿nge_Œªs_veùÜ
) < 0) {

231 
	g”rÜ
 = 
”ºo
;

232 
ERR
(
pŞicy
, "%s", "Unableo„etrieve„angeransitions");

233 
	gimp_¿nge_Œªs_run_ç
;

236 
	gi
 = 0; i < 
­Ş_veùÜ_g‘_size
(
¿nge_Œªs_veùÜ
); i++) {

238 
	gruË
 = 
­Ş_veùÜ_g‘_–em’t
(
¿nge_Œªs_veùÜ
, 
i
);

239 
qpŞ_¿nge_Œªs_g‘_sourû_ty³
(
q
, 
ruË
, &
sourû
);

240 
qpŞ_¿nge_Œªs_g‘_rg‘_ty³
(
q
, 
ruË
, &
rg‘
);

241 
qpŞ_ty³_g‘_Çme
(
q
, 
sourû
, &
sourû_Çme
);

242 
qpŞ_ty³_g‘_Çme
(
q
, 
rg‘
, &
rg‘_Çme
);

243 
qpŞ_¿nge_Œªs_g‘_¿nge
(
q
, 
ruË
, &
qpŞ_¿nge
);

244 
	g¿nge
 = 
­Ş_mls_¿nge_ü—‹_äom_qpŞ_mls_¿nge
(
pŞicy
, 
qpŞ_¿nge
);

247 
	grŞe_qu”y
 = 
­Ş_rŞe_qu”y_ü—‹
();

248 
­Ş_rŞe_qu”y_£t_ty³
(
pŞicy
, 
rŞe_qu”y
, 
sourû_Çme
);

249 
­Ş_rŞe_g‘_by_qu”y
(
pŞicy
, 
rŞe_qu”y
, &
rŞe_veùÜ
);

250 
­Ş_rŞe_qu”y_de¡roy
(&
rŞe_qu”y
);

253 ià((
	gu£rs_w_rŞes
 = 
­Ş_veùÜ_ü—‹
(
NULL
)) == NULL) {

254 
”rÜ
 = 
”ºo
;

255 
	gimp_¿nge_Œªs_run_ç
;

257 
	gu£r_qu”y
 = 
­Ş_u£r_qu”y_ü—‹
();

258 
	gj
 = 0; j < 
­Ş_veùÜ_g‘_size
(
rŞe_veùÜ
); j++) {

259 
	grŞe
 = 
­Ş_veùÜ_g‘_–em’t
(
rŞe_veùÜ
, 
j
);

260 
qpŞ_rŞe_g‘_Çme
(
q
, 
rŞe
, &
rŞe_Çme
);

261 
­Ş_u£r_qu”y_£t_rŞe
(
pŞicy
, 
u£r_qu”y
, 
rŞe_Çme
);

262 
­Ş_u£r_g‘_by_qu”y
(
pŞicy
, 
u£r_qu”y
, &
tmp_v
);

263 
­Ş_veùÜ_ÿt
(
u£rs_w_rŞes
, 
tmp_v
);

264 
­Ş_veùÜ_de¡roy
(&
tmp_v
);

266 
­Ş_veùÜ_sÜt_uniquify
(
u£rs_w_rŞes
, 
NULL
, NULL);

267 
­Ş_u£r_qu”y_de¡roy
(&
u£r_qu”y
);

270 
	gu£r_qu”y
 = 
­Ş_u£r_qu”y_ü—‹
();

271 
­Ş_u£r_qu”y_£t_¿nge
(
pŞicy
, 
u£r_qu”y
, 
¿nge
, 
APOL_QUERY_SUB
);

272 
­Ş_u£r_g‘_by_qu”y
(
pŞicy
, 
u£r_qu”y
, &
u£rs_w_¿nge
);

273 
­Ş_u£r_qu”y_de¡roy
(&
u£r_qu”y
);

276 
	gu£r_veùÜ
 = 
­Ş_veùÜ_ü—‹_äom_š‹r£ùiÚ
(
u£rs_w_rŞes
, 
u£rs_w_¿nge
, 
NULL
, NULL);

279 
	gavruË_qu”y
 = 
­Ş_avruË_qu”y_ü—‹
();

280 
­Ş_avruË_qu”y_£t_ruËs
(
pŞicy
, 
avruË_qu”y
, 
QPOL_RULE_ALLOW
);

281 
­Ş_avruË_qu”y_£t_sourû
(
pŞicy
, 
avruË_qu”y
, 
sourû_Çme
, 1);

282 
­Ş_avruË_qu”y_£t_rg‘
(
pŞicy
, 
avruË_qu”y
, 
rg‘_Çme
, 1);

283 
­Ş_avruË_qu”y_­³nd_şass
(
pŞicy
, 
avruË_qu”y
, "file");

284 
­Ş_avruË_qu”y_­³nd_³rm
(
pŞicy
, 
avruË_qu”y
, "execute");

285 
­Ş_avruË_g‘_by_qu”y
(
pŞicy
, 
avruË_qu”y
, &
ruË_veùÜ
);

286 
­Ş_avruË_qu”y_de¡roy
(&
avruË_qu”y
);

289 ià(!
­Ş_veùÜ_g‘_size
(
ruË_veùÜ
)) {

290 
	g´oof
 = 
£chk_´oof_Ãw
(
NULL
);

291 ià(!
	g´oof
) {

292 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

293 
	g”rÜ
 = 
ENOMEM
;

294 
	gimp_¿nge_Œªs_run_ç
;

296 
	g´oof
->
	gty³
 = 
SECHK_ITEM_NONE
;

297 
a¥rštf
(&
´oof
->
‹xt
, "Missšg:‡Îow % % : fexecu‹;", 
sourû_Çme
, 
rg‘_Çme
);

298 ià(!
	g´oof
->
	g‹xt
) {

299 
	g”rÜ
 = 
”ºo
;

300 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

301 
	gimp_¿nge_Œªs_run_ç
;

303 
	g™em
 = 
£chk_™em_Ãw
(
NULL
);

304 ià(!
	g™em
) {

305 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

306 
	g”rÜ
 = 
ENOMEM
;

307 
	gimp_¿nge_Œªs_run_ç
;

309 
	g™em
->™em = (*)
ruË
;

310 
	g™em
->
	g‹¡_»suÉ
 = 1;

311 ià(!
	g™em
->
	g´oof
) {

312 ià(!(
	g™em
->
	g´oof
 = 
­Ş_veùÜ_ü—‹
(
£chk_´oof_ä“
))) {

313 
”rÜ
 = 
”ºo
;

314 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

315 
	gimp_¿nge_Œªs_run_ç
;

318 ià(
­Ş_veùÜ_­³nd
(
™em
->
´oof
, (*)proof) < 0) {

319 
	g”rÜ
 = 
”ºo
;

320 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

321 
	gimp_¿nge_Œªs_run_ç
;

323 
	g´oof
 = 
NULL
;

325 
­Ş_veùÜ_de¡roy
(&
ruË_veùÜ
);

328 ià(!
­Ş_veùÜ_g‘_size
(
rŞe_veùÜ
)) {

329 
	g´oof
 = 
£chk_´oof_Ãw
(
NULL
);

330 ià(!
	g´oof
) {

331 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

332 
	g”rÜ
 = 
ENOMEM
;

333 
	gimp_¿nge_Œªs_run_ç
;

335 
	g´oof
->
	gty³
 = 
SECHK_ITEM_NONE
;

336 
a¥rštf
(&
´oof
->
‹xt
, "NØrŞassocŸ‹d w™hy³ %s", 
sourû_Çme
);

337 ià(!
	g´oof
->
	g‹xt
) {

338 
	g”rÜ
 = 
”ºo
;

339 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

340 
	gimp_¿nge_Œªs_run_ç
;

342 ià(!
	g™em
) {

343 
	g™em
 = 
£chk_™em_Ãw
(
NULL
);

344 ià(!
	g™em
) {

345 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

346 
	g”rÜ
 = 
ENOMEM
;

347 
	gimp_¿nge_Œªs_run_ç
;

349 
	g™em
->™em = (*)
ruË
;

350 
	g™em
->
	g‹¡_»suÉ
 = 1;

352 ià(!
	g™em
->
	g´oof
) {

353 ià(!(
	g™em
->
	g´oof
 = 
­Ş_veùÜ_ü—‹
(
£chk_´oof_ä“
))) {

354 
”rÜ
 = 
”ºo
;

355 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

356 
	gimp_¿nge_Œªs_run_ç
;

359 ià(
­Ş_veùÜ_­³nd
(
™em
->
´oof
, (*)proof) < 0) {

360 
	g”rÜ
 = 
”ºo
;

361 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

362 
	gimp_¿nge_Œªs_run_ç
;

364 
	g´oof
 = 
NULL
;

368 ià(!
­Ş_veùÜ_g‘_size
(
u£r_veùÜ
)) {

369 
	g´oof
 = 
£chk_´oof_Ãw
(
NULL
);

370 ià(!
	g´oof
) {

371 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

372 
	g”rÜ
 = 
ENOMEM
;

373 
	gimp_¿nge_Œªs_run_ç
;

375 
	g´oof
->
	gty³
 = 
SECHK_ITEM_NONE
;

376 ià(!
­Ş_veùÜ_g‘_size
(
rŞe_veùÜ
)) {

377 
	g´oof
->
	g‹xt
 = 
¡rdup
("No„ole‡lso means‚o user");

378 } ià(!
­Ş_veùÜ_g‘_size
(
u£rs_w_rŞes
)) {

379 
a¥rštf
(&
´oof
->
‹xt
, "NØu£r assocŸ‹d w™h„Şe fÜ %s", 
sourû_Çme
);

380 } ià(!
­Ş_veùÜ_g‘_size
(
u£rs_w_¿nge
)) {

381 
	g´oof
->
	g‹xt
 = 
¡rdup
("No user has‡ccesso specified MLS„ange");

383 
	g´oof
->
	g‹xt
 = 
¡rdup
("No user meets MLS‡nd RBAC„equirements.");

385 ià(!
	g´oof
->
	g‹xt
) {

386 
	g”rÜ
 = 
”ºo
;

387 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

388 
	gimp_¿nge_Œªs_run_ç
;

390 ià(!
	g™em
) {

391 
	g™em
 = 
£chk_™em_Ãw
(
NULL
);

392 ià(!
	g™em
) {

393 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

394 
	g”rÜ
 = 
ENOMEM
;

395 
	gimp_¿nge_Œªs_run_ç
;

397 
	g™em
->™em = (*)
ruË
;

398 
	g™em
->
	g‹¡_»suÉ
 = 1;

400 ià(!
	g™em
->
	g´oof
) {

401 ià(!(
	g™em
->
	g´oof
 = 
­Ş_veùÜ_ü—‹
(
£chk_´oof_ä“
))) {

402 
”rÜ
 = 
”ºo
;

403 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

404 
	gimp_¿nge_Œªs_run_ç
;

407 ià(
­Ş_veùÜ_­³nd
(
™em
->
´oof
, (*)proof) < 0) {

408 
	g”rÜ
 = 
”ºo
;

409 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

410 
	gimp_¿nge_Œªs_run_ç
;

413 
­Ş_veùÜ_de¡roy
(&
rŞe_veùÜ
);

414 
­Ş_veùÜ_de¡roy
(&
u£r_veùÜ
);

415 
­Ş_veùÜ_de¡roy
(&
u£rs_w_rŞes
);

416 
­Ş_veùÜ_de¡roy
(&
u£rs_w_¿nge
);

418 ià(
	g™em
) {

419 ià(
­Ş_veùÜ_­³nd
(
»s
->
™ems
, (*)
™em
) < 0) {

420 
	g”rÜ
 = 
”ºo
;

421 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

422 
	gimp_¿nge_Œªs_run_ç
;

425 
	g™em
 = 
NULL
;

427 
­Ş_veùÜ_de¡roy
(&
¿nge_Œªs_veùÜ
);

428 
	gmod
->
	g»suÉ
 = 
»s
;

430 ià(
­Ş_veùÜ_g‘_size
(
»s
->
™ems
))

434 
	gimp_¿nge_Œªs_run_ç
:

435 
­Ş_veùÜ_de¡roy
(&
¿nge_Œªs_veùÜ
);

436 
­Ş_veùÜ_de¡roy
(&
rŞe_veùÜ
);

437 
­Ş_veùÜ_de¡roy
(&
ruË_veùÜ
);

438 
­Ş_veùÜ_de¡roy
(&
u£r_veùÜ
);

439 
­Ş_veùÜ_de¡roy
(&
u£rs_w_rŞes
);

440 
­Ş_veùÜ_de¡roy
(&
u£rs_w_¿nge
);

441 
£chk_´oof_ä“
(
´oof
);

442 
£chk_™em_ä“
(
™em
);

443 
£chk_»suÉ_de¡roy
(&
»s
);

444 
	g”ºo
 = 
”rÜ
;

450 
imp_¿nge_Œªs_´št
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

452 
	goutfÜm©
 = 0x00;

453 
£chk_™em_t
 *
	g™em
 = 
NULL
;

454 
£chk_´oof_t
 *
	g´oof
 = 
NULL
;

455 
qpŞ_¿nge_Œªs_t
 *
	g¹
;

456 *
	gtmp
;

457 
size_t
 
	gi
 = 0, 
	gk
 = 0, 
	gj
 = 0, 
	gnum_™ems
;

459 ià(!
	gmod
 || !
	gpŞicy
) {

460 
ERR
(
pŞicy
, "%s", "Invalid…arameters");

461 
	g”ºo
 = 
EINVAL
;

464 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

465 
ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

466 
	g”ºo
 = 
EINVAL
;

470 
	goutfÜm©
 = 
mod
->
ouutfÜm©
;

471 
	gnum_™ems
 = 
­Ş_veùÜ_g‘_size
(
mod
->
»suÉ
->
™ems
);

473 ià(!
	gmod
->
	g»suÉ
) {

474 
ERR
(
pŞicy
, "%s", "Module has‚ot been„un");

475 
	g”ºo
 = 
EINVAL
;

479 ià(!
	goutfÜm©
 || (outfÜm© & 
	gSECHK_OUT_QUIET
))

482 ià(
	goutfÜm©
 & 
	gSECHK_OUT_STATS
) {

483 
´štf
("Found %˜impossibË„ªgŒªs™iÚs.\n", 
num_™ems
);

486 ià(
	goutfÜm©
 & 
	gSECHK_OUT_LIST
) {

487 
´štf
("\n");

488 
	gi
 = 0; i < 
	gnum_™ems
; i++) {

489 
	g™em
 = 
­Ş_veùÜ_g‘_–em’t
(
mod
->
»suÉ
->
™ems
, 
i
);

490 
	g¹
 = 
™em
->item;

491 
´štf
("%s\n", (
tmp
 = 
­Ş_¿nge_Œªs_»nd”
(
pŞicy
, 
¹
)));

492 
ä“
(
tmp
);

494 
´štf
("\n");

497 ià(
	goutfÜm©
 & 
	gSECHK_OUT_PROOF
) {

498 
´štf
("\n");

499 
	gk
 = 0; k < 
	gnum_™ems
; k++) {

500 
	g™em
 = 
­Ş_veùÜ_g‘_–em’t
(
mod
->
»suÉ
->
™ems
, 
k
);

501 
	g¹
 = 
™em
->item;

502 
´štf
("%s\n", (
tmp
 = 
­Ş_¿nge_Œªs_»nd”
(
pŞicy
, 
¹
)));

503 
ä“
(
tmp
);

504 
	gj
 = 0; j < 
­Ş_veùÜ_g‘_size
(
™em
->
´oof
); j++) {

505 
	g´oof
 = 
­Ş_veùÜ_g‘_–em’t
(
™em
->
´oof
, 
j
);

506 
´štf
("\t%s\n", 
´oof
->
‹xt
);

509 
´štf
("\n");

	@sechecker/modules/imp_range_trans.h

26 #iâdeà
IMP_RANGE_TRANS


27 
	#IMP_RANGE_TRANS


	)

29 #ifdef 
__ılu¥lus


34 
	~"£check”.h
"

35 
	~<­Ş/pŞicy.h
>

36 
	~<­Ş/rŞe-qu”y.h
>

37 
	~<­Ş/u£r-qu”y.h
>

38 
	~<­Ş/¿nge_Œªs-qu”y.h
>

39 
	~<­Ş/rbaüuË-qu”y.h
>

40 
	~<­Ş/domaš-Œªs-ª®ysis.h
>

41 
	~<­Ş/pŞicy-qu”y.h
>

43 
imp_¿nge_Œªs_»gi¡”
(
£chk_lib_t
 * 
lib
);

44 
imp_¿nge_Œªs_š™
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

45 
imp_¿nge_Œªs_run
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

46 
imp_¿nge_Œªs_´št
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

48 #ifdef 
__ılu¥lus


	@sechecker/modules/inc_dom_trans.c

26 
	~"šc_dom_Œªs.h
"

28 
	~<¡dio.h
>

29 
	~<¡ršg.h
>

30 
	~<”ºo.h
>

35 cÚ¡ *cÚ¡ 
	gmod_Çme
 = "inc_dom_trans";

39 
	$šc_dom_Œªs_»gi¡”
(
£chk_lib_t
 * 
lib
)

41 
£chk_moduË_t
 *
mod
 = 
NULL
;

42 
£chk_â_t
 *
â_¡ruù
 = 
NULL
;

44 ià(!
lib
) {

45 
	`ERR
(
NULL
, "%s", "No†ibrary");

46 
”ºo
 = 
EINVAL
;

53 
mod
 = 
	`£chk_lib_g‘_moduË
(
mod_Çme
, 
lib
);

54 ià(!
mod
) {

55 
	`ERR
(
NULL
, "%s", "Module unknown");

56 
”ºo
 = 
EINVAL
;

59 
mod
->
·»Á_lib
 = 
lib
;

62 
mod
->
br›f_desütiÚ
 = "domains with…artialransition…ermissions";

63 
mod
->
d‘aed_desütiÚ
 =

72 
mod
->
İt_desütiÚ
 =

75 
mod
->
£v”™y
 = 
SECHK_SEV_MED
;

77 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
»quœem’ts
, 
	`£chk_Çme_v®ue_Ãw
(
SECHK_REQ_POLICY_CAP
, 
SECHK_REQ_CAP_ATTRIB_NAMES
)) < 0) {

78 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

79 
”ºo
 = 
ENOMEM
;

83 
	`­Ş_veùÜ_­³nd
(
mod
->
d•’d’c›s
, 
	`£chk_Çme_v®ue_Ãw
("module", "find_domains"));

86 
â_¡ruù
 = 
	`£chk_â_Ãw
();

87 ià(!
â_¡ruù
) {

88 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

89 
”ºo
 = 
ENOMEM
;

92 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_INIT
);

93 ià(!
â_¡ruù
->
Çme
) {

94 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

95 
”ºo
 = 
ENOMEM
;

98 
â_¡ruù
->
â
 = 
šc_dom_Œªs_š™
;

99 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
) < 0) {

100 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

101 
”ºo
 = 
ENOMEM
;

105 
â_¡ruù
 = 
	`£chk_â_Ãw
();

106 ià(!
â_¡ruù
) {

107 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

108 
”ºo
 = 
ENOMEM
;

111 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_RUN
);

112 ià(!
â_¡ruù
->
Çme
) {

113 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

114 
”ºo
 = 
ENOMEM
;

117 
â_¡ruù
->
â
 = 
šc_dom_Œªs_run
;

118 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
) < 0) {

119 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

120 
”ºo
 = 
ENOMEM
;

124 
mod
->
d©a_ä“
 = 
NULL
;

126 
â_¡ruù
 = 
	`£chk_â_Ãw
();

127 ià(!
â_¡ruù
) {

128 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

129 
”ºo
 = 
ENOMEM
;

132 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_PRINT
);

133 ià(!
â_¡ruù
->
Çme
) {

134 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

135 
”ºo
 = 
ENOMEM
;

138 
â_¡ruù
->
â
 = 
šc_dom_Œªs_´št
;

139 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
) < 0) {

140 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

141 
”ºo
 = 
ENOMEM
;

146 
	}
}

151 
šc_dom_Œªs_š™
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

153 ià(!
	gmod
 || !
	gpŞicy
) {

154 
ERR
(
pŞicy
, "%s", "Invalid…aramaters");

155 
	g”ºo
 = 
EINVAL
;

158 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

159 
ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

160 
	g”ºo
 = 
EINVAL
;

164 
	gmod
->
	gd©a
 = 
NULL
;

170 
	$dŒ_ä“_w¿p
(*
x
)

172 
	`­Ş_domaš_Œªs_»suÉ_de¡roy
((
­Ş_domaš_Œªs_»suÉ_t
 **è& 
x
);

173 
	}
}

177 
šc_dom_Œªs_run
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

179 
£chk_»suÉ_t
 *
	g»s
 = 
NULL
;

180 
£chk_™em_t
 *
	g™em
 = 
NULL
, *
	gtmp_™em
 = NULL;

181 
£chk_´oof_t
 *
	g´oof
 = 
NULL
;

182 
size_t
 
	gi
, 
	gj
, 
	gk
, 
	g»tv
;

183 
£chk_moduË_t
 *
	gmod_±r
 = 
NULL
;

184 
£chk_mod_â_t
 
	grun_â
 = 
NULL
;

185 
£chk_»suÉ_t
 *
	gfšd_domašs_»s
 = 
NULL
;

186 
­Ş_domaš_Œªs_ª®ysis_t
 *
	gdomaš_Œªs
 = 
NULL
;

187 
­Ş_veùÜ_t
 *
	gdomaš_veùÜ
 = 
NULL
, *
	grŞe_veùÜ
 = NULL, *
	gu£r_veùÜ
 = NULL, *
	grbac_veùÜ
 = NULL;

188 
­Ş_veùÜ_t
 *
	gdomaš_Œªs_veùÜ
 = 
NULL
, *
	grŞe_®low_veùÜ
 = NULL;

189 
­Ş_u£r_qu”y_t
 *
	gu£r_qu”y
 = 
NULL
;

190 
­Ş_rŞe_qu”y_t
 *
	g¡¬t_rŞe_qu”y
 = 
NULL
, *
	g’d_rŞe_qu”y
 = NULL;

191 
­Ş_rŞe_Œªs_qu”y_t
 *
	grŞe_Œªs_qu”y
 = 
NULL
;

192 
­Ş_rŞe_®low_qu”y_t
 *
	grŞe_®low_qu”y
 = 
NULL
;

193 *
	gbuff
 = 
NULL
;

194 
	gbuff_sz
, 
	g”rÜ
 = 0;

195 cÚ¡ 
qpŞ_ty³_t
 *
	gdomaš
 = 
NULL
;

196 
qpŞ_pŞicy_t
 *
	gq
 = 
­Ş_pŞicy_g‘_qpŞ
(
pŞicy
);

197 cÚ¡ *
	gdomaš_Çme
 = 
NULL
;

199 ià(!
	gmod
 || !
	gpŞicy
) {

200 
ERR
(
pŞicy
, "%s", "Invalid…arameters");

201 
	g”ºo
 = 
EINVAL
;

204 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

205 
ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

206 
	g”ºo
 = 
EINVAL
;

211 ià(
	gmod
->
	g»suÉ
)

214 
	g»s
 = 
£chk_»suÉ_Ãw
();

215 ià(!
	g»s
) {

216 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

217 
	g”ºo
 = 
EINVAL
;

220 
	g»s
->
	g‹¡_Çme
 = 
¡rdup
(
mod_Çme
);

221 ià(!
	g»s
->
	g‹¡_Çme
) {

222 
	g”rÜ
 = 
”ºo
;

223 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

224 
	gšc_dom_Œªs_run_ç
;

226 
	g»s
->
	g™em_ty³
 = 
SECHK_ITEM_DTR
;

227 ià(!(
	g»s
->
	g™ems
 = 
­Ş_veùÜ_ü—‹
(
£chk_™em_ä“
))) {

228 
”rÜ
 = 
”ºo
;

229 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

230 
	gšc_dom_Œªs_run_ç
;

233 ià(
­Ş_pŞicy_bud_domaš_Œªs_bË
(
pŞicy
) < 0) {

234 
	g”rÜ
 = 
”ºo
;

235 
ERR
(
pŞicy
, "%s", "Unableo build domainransitionable");

236 
	gšc_dom_Œªs_run_ç
;

239 ià(!(
	gdomaš_Œªs
 = 
­Ş_domaš_Œªs_ª®ysis_ü—‹
())) {

240 
”rÜ
 = 
”ºo
;

241 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

242 
	gšc_dom_Œªs_run_ç
;

245 ià(!(
	gu£r_qu”y
 = 
­Ş_u£r_qu”y_ü—‹
())) {

246 
”rÜ
 = 
”ºo
;

247 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

248 
	gšc_dom_Œªs_run_ç
;

251 ià(!(
	grŞe_Œªs_qu”y
 = 
­Ş_rŞe_Œªs_qu”y_ü—‹
())) {

252 
”rÜ
 = 
”ºo
;

253 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

254 
	gšc_dom_Œªs_run_ç
;

257 ià(!(
	grŞe_®low_qu”y
 = 
­Ş_rŞe_®low_qu”y_ü—‹
())) {

258 
”rÜ
 = 
”ºo
;

259 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

260 
	gšc_dom_Œªs_run_ç
;

263 ià(!(
	g¡¬t_rŞe_qu”y
 = 
­Ş_rŞe_qu”y_ü—‹
())) {

264 
”rÜ
 = 
”ºo
;

265 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

266 
	gšc_dom_Œªs_run_ç
;

269 ià(!(
	g’d_rŞe_qu”y
 = 
­Ş_rŞe_qu”y_ü—‹
())) {

270 
”rÜ
 = 
”ºo
;

271 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

272 
	gšc_dom_Œªs_run_ç
;

275 
	grun_â
 = 
£chk_lib_g‘_moduË_funùiÚ
("fšd_domašs", 
SECHK_MOD_FN_RUN
, 
mod
->
·»Á_lib
);

276 ià(!
	grun_â
) {

277 
	g”rÜ
 = 
”ºo
;

278 
	gšc_dom_Œªs_run_ç
;

281 
	g»tv
 = 
run_â
((
mod_±r
 = 
£chk_lib_g‘_moduË
("fšd_domašs", 
mod
->
·»Á_lib
)), 
pŞicy
, 
NULL
);

282 ià(
	g»tv
) {

283 
	g”rÜ
 = 
”ºo
;

284 
ERR
(
pŞicy
, "%s", "Unableo find module find_domains");

285 
	gšc_dom_Œªs_run_ç
;

288 ià(!(
	gfšd_domašs_»s
 = 
£chk_lib_g‘_moduË_»suÉ
("fšd_domašs", 
mod
->
·»Á_lib
))) {

289 
	g”rÜ
 = 
”ºo
;

290 
ERR
(
pŞicy
, "%s", "Unableo get„esults from module find_domains");

291 
	gšc_dom_Œªs_run_ç
;

294 
	gdomaš_veùÜ
 = (
­Ş_veùÜ_t
 *è
fšd_domašs_»s
->
™ems
;

296 
	gi
 = 0; i < 
­Ş_veùÜ_g‘_size
(
domaš_veùÜ
); i++) {

297 
	gtmp_™em
 = 
­Ş_veùÜ_g‘_–em’t
(
domaš_veùÜ
, 
i
);

298 
	gdomaš
 = 
tmp_™em
->
™em
;

299 
qpŞ_ty³_g‘_Çme
(
q
, 
domaš
, &
domaš_Çme
);

300 
­Ş_domaš_Œªs_ª®ysis_£t_¡¬t_ty³
(
pŞicy
, 
domaš_Œªs
, 
domaš_Çme
);

301 
­Ş_domaš_Œªs_ª®ysis_£t_dœeùiÚ
(
pŞicy
, 
domaš_Œªs
, 
APOL_DOMAIN_TRANS_DIRECTION_FORWARD
);

302 
­Ş_domaš_Œªs_ª®ysis_£t_v®id
(
pŞicy
, 
domaš_Œªs
, 
APOL_DOMAIN_TRANS_SEARCH_BOTH
);

303 
­Ş_domaš_Œªs_ª®ysis_do
(
pŞicy
, 
domaš_Œªs
, &
domaš_Œªs_veùÜ
);

305 
	gj
 = 0; j < 
­Ş_veùÜ_g‘_size
(
domaš_Œªs_veùÜ
); j++) {

306 
­Ş_domaš_Œªs_»suÉ_t
 *
	gdŒ
 = 
NULL
;

307 cÚ¡ 
qpŞ_ty³_t
 *
	g¡¬t
;

308 cÚ¡ 
qpŞ_ty³_t
 *
	g•
;

309 cÚ¡ 
qpŞ_ty³_t
 *
	g’d
;

310 cÚ¡ *
	g¡¬t_Çme
;

311 cÚ¡ *
	g’d_Çme
;

312 cÚ¡ *
	g•_Çme
;

313 
	g»suÉ
;

314 
boŞ
 
	gok
;

316 
	gok
 = 
çl£
;

317 
	gdŒ
 = 
­Ş_veùÜ_g‘_–em’t
(
domaš_Œªs_veùÜ
, 
j
);

318 
	g¡¬t
 = 
­Ş_domaš_Œªs_»suÉ_g‘_¡¬t_ty³
(
dŒ
);

319 
	g•
 = 
­Ş_domaš_Œªs_»suÉ_g‘_’Œypošt_ty³
(
dŒ
);

320 
	g’d
 = 
­Ş_domaš_Œªs_»suÉ_g‘_’d_ty³
(
dŒ
);

321 ià(
	g¡¬t
)

322 
qpŞ_ty³_g‘_Çme
(
q
, 
¡¬t
, &
¡¬t_Çme
);

324 
	g¡¬t_Çme
 = "<start_type>";

325 ià(
	g’d
)

326 
qpŞ_ty³_g‘_Çme
(
q
, 
’d
, &
’d_Çme
);

328 
	g’d_Çme
 = "<end_type>";

329 ià(
	g•
)

330 
qpŞ_ty³_g‘_Çme
(
q
, 
•
, &
•_Çme
);

332 
	g•_Çme
 = "<entrypoint_type>";

334 
	g»suÉ
 = 
­Ş_domaš_Œªs_bË_v”ify_Œªs
(
pŞicy
, 
¡¬t
, 
•
, 
’d
);

335 ià(!
	g»suÉ
) {

336 
­Ş_veùÜ_t
 *
	g¡¬t_rŞe_veùÜ
, *
	g’d_rŞe_veùÜ
, *
	gcommÚ_rŞe_veùÜ
;

337 
­Ş_rŞe_qu”y_£t_ty³
(
pŞicy
, 
¡¬t_rŞe_qu”y
, 
¡¬t_Çme
);

338 
­Ş_rŞe_g‘_by_qu”y
(
pŞicy
, 
¡¬t_rŞe_qu”y
, &
¡¬t_rŞe_veùÜ
);

339 
­Ş_rŞe_qu”y_£t_ty³
(
pŞicy
, 
’d_rŞe_qu”y
, 
’d_Çme
);

340 
­Ş_rŞe_g‘_by_qu”y
(
pŞicy
, 
’d_rŞe_qu”y
, &
’d_rŞe_veùÜ
);

341 ià(!
­Ş_veùÜ_g‘_size
(
¡¬t_rŞe_veùÜ
è|| !­Ş_veùÜ_g‘_size(
’d_rŞe_veùÜ
)) {

342 
	g™em
 = 
£chk_™em_Ãw
(
dŒ_ä“_w¿p
);

343 ià(!
	g™em
) {

344 
	g”rÜ
 = 
”ºo
;

345 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

346 
	gšc_dom_Œªs_run_ç
;

348 
	g™em
->
	g‹¡_»suÉ
 = 1;

349 
	g™em
->™em = (*)
­Ş_domaš_Œªs_»suÉ_ü—‹_äom_domaš_Œªs_»suÉ
(
dŒ
);

350 ià(
­Ş_veùÜ_­³nd
(
»s
->
™ems
, (*)
™em
) < 0) {

351 
	g”rÜ
 = 
”ºo
;

352 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

353 
	gšc_dom_Œªs_run_ç
;

355 ià(!(
	g™em
->
	g´oof
 = 
­Ş_veùÜ_ü—‹
(
£chk_´oof_ä“
))) {

356 
”rÜ
 = 
”ºo
;

357 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

358 
	gšc_dom_Œªs_run_ç
;

360 ià(!
­Ş_veùÜ_g‘_size
(
¡¬t_rŞe_veùÜ
)) {

361 
	g´oof
 = 
£chk_´oof_Ãw
(
NULL
);

362 
	g´oof
->
	gty³
 = 
SECHK_ITEM_OTHER
;

363 
a¥rštf
(&
´oof
->
‹xt
, "N“d„ŞfÜ %s", 
¡¬t_Çme
);

364 ià(!
	g´oof
->
	g‹xt
) {

365 
	g”rÜ
 = 
”ºo
;

366 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

367 
	gšc_dom_Œªs_run_ç
;

369 ià(
­Ş_veùÜ_­³nd
(
™em
->
´oof
, (*)proof) < 0) {

370 
	g”rÜ
 = 
”ºo
;

371 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

372 
	gšc_dom_Œªs_run_ç
;

375 ià(!
­Ş_veùÜ_g‘_size
(
’d_rŞe_veùÜ
)) {

376 
	g´oof
 = 
£chk_´oof_Ãw
(
NULL
);

377 
	g´oof
->
	gty³
 = 
SECHK_ITEM_OTHER
;

378 
a¥rštf
(&
´oof
->
‹xt
, "N“d„ŞfÜ %s", 
’d_Çme
);

379 ià(!
	g´oof
->
	g‹xt
) {

380 
	g”rÜ
 = 
”ºo
;

381 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

382 
	gšc_dom_Œªs_run_ç
;

384 ià(
­Ş_veùÜ_­³nd
(
™em
->
´oof
, (*)proof) < 0) {

385 
	g”rÜ
 = 
”ºo
;

386 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

387 
	gšc_dom_Œªs_run_ç
;

390 
	g™em
 = 
NULL
;

392 
­Ş_veùÜ_de¡roy
(&
¡¬t_rŞe_veùÜ
);

393 
­Ş_veùÜ_de¡roy
(&
’d_rŞe_veùÜ
);

396 
	gcommÚ_rŞe_veùÜ
 =

397 
­Ş_veùÜ_ü—‹_äom_š‹r£ùiÚ
(
¡¬t_rŞe_veùÜ
, 
’d_rŞe_veùÜ
, 
NULL
, NULL);

398 cÚ¡ *
	grŞe_Çme
 = 
NULL
;

399 ià(
­Ş_veùÜ_g‘_size
(
commÚ_rŞe_veùÜ
)) {

400 
	gk
 = 0; k < 
­Ş_veùÜ_g‘_size
(
commÚ_rŞe_veùÜ
); k++) {

401 cÚ¡ 
qpŞ_rŞe_t
 *
	gcommÚ_rŞe
;

403 
	gcommÚ_rŞe
 = 
­Ş_veùÜ_g‘_–em’t
(
commÚ_rŞe_veùÜ
, 
k
);

404 
qpŞ_rŞe_g‘_Çme
(
q
, 
commÚ_rŞe
, &
rŞe_Çme
);

405 
­Ş_u£r_qu”y_£t_rŞe
(
pŞicy
, 
u£r_qu”y
, 
rŞe_Çme
);

406 
­Ş_u£r_g‘_by_qu”y
(
pŞicy
, 
u£r_qu”y
, &
u£r_veùÜ
);

407 ià(
­Ş_veùÜ_g‘_size
(
u£r_veùÜ
)) {

408 
	gok
 = 
Œue
;

409 
­Ş_veùÜ_de¡roy
(&
u£r_veùÜ
);

412 
­Ş_veùÜ_de¡roy
(&
u£r_veùÜ
);

414 ià(!
	gok
) {

415 
	g™em
 = 
£chk_™em_Ãw
(
dŒ_ä“_w¿p
);

416 ià(!
	g™em
) {

417 
	g”rÜ
 = 
”ºo
;

418 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

419 
	gšc_dom_Œªs_run_ç
;

421 
	g™em
->
	g‹¡_»suÉ
 = 1;

422 
	g™em
->™em = (*)
­Ş_domaš_Œªs_»suÉ_ü—‹_äom_domaš_Œªs_»suÉ
(
dŒ
);

423 ià(
­Ş_veùÜ_­³nd
(
»s
->
™ems
, (*)
™em
) < 0) {

424 
	g”rÜ
 = 
”ºo
;

425 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

426 
	gšc_dom_Œªs_run_ç
;

428 ià(!(
	g™em
->
	g´oof
 = 
­Ş_veùÜ_ü—‹
(
£chk_´oof_ä“
))) {

429 
”rÜ
 = 
”ºo
;

430 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

431 
	gšc_dom_Œªs_run_ç
;

433 
	g´oof
 = 
£chk_´oof_Ãw
(
NULL
);

434 
	g´oof
->
	gty³
 = 
SECHK_ITEM_OTHER
;

435 
a¥rštf
(&
´oof
->
‹xt
, "N“d u£¸fÜ„Ş%s", 
rŞe_Çme
);

436 ià(!
	g´oof
->
	g‹xt
) {

437 
	g”rÜ
 = 
”ºo
;

438 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

439 
	gšc_dom_Œªs_run_ç
;

441 ià(
­Ş_veùÜ_­³nd
(
™em
->
´oof
, (*)proof) < 0) {

442 
	g”rÜ
 = 
”ºo
;

443 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

444 
	gšc_dom_Œªs_run_ç
;

446 
	g™em
 = 
NULL
;

449 
­Ş_veùÜ_t
 *
	grŞe_Œªs_veùÜ
;

450 
boŞ
 
	gÃed_¿
 = 0, 
	gÃed_u£r
 = 0;

451 *
	g¿¡ršg
 = 
NULL
, *
	gu£r¡ršg
 = NULL;

452 
­Ş_rŞe_Œªs_qu”y_£t_rg‘
(
pŞicy
, 
rŞe_Œªs_qu”y
, 
•_Çme
, 1);

453 
­Ş_rŞe_Œªs_g‘_by_qu”y
(
pŞicy
, 
rŞe_Œªs_qu”y
, &
rŞe_Œªs_veùÜ
);

454 cÚ¡ *
	gsourû_rŞe_Çme
 = 
NULL
, *
	gdeçuÉ_rŞe_Çme
 = NULL;

455 
	gk
 = 0; k < 
­Ş_veùÜ_g‘_size
(
rŞe_Œªs_veùÜ
); k++) {

456 
qpŞ_rŞe_Œªs_t
 *
	grŞe_Œªs
;

457 cÚ¡ 
qpŞ_rŞe_t
 *
	gsourû_rŞe
;

458 cÚ¡ 
qpŞ_rŞe_t
 *
	gdeçuÉ_rŞe
;

459 
	gšdex
;

461 
	grŞe_Œªs
 = 
­Ş_veùÜ_g‘_–em’t
(
rŞe_Œªs_veùÜ
, 
k
);

462 
qpŞ_rŞe_Œªs_g‘_sourû_rŞe
(
q
, 
rŞe_Œªs
, &
sourû_rŞe
);

463 
qpŞ_rŞe_Œªs_g‘_deçuÉ_rŞe
(
q
, 
rŞe_Œªs
, &
deçuÉ_rŞe
);

464 ià((
­Ş_veùÜ_g‘_šdex
(
¡¬t_rŞe_veùÜ
, 
sourû_rŞe
, 
NULL
, NULL, &
šdex
) == 0)

465 && (
­Ş_veùÜ_g‘_šdex
(
’d_rŞe_veùÜ
, 
deçuÉ_rŞe
, 
NULL
, NULL, &
šdex
) ==

467 
­Ş_veùÜ_t
 *
sourû_rŞe_u£r
, *
deçuÉ_rŞe_u£r
, *
commÚ_rŞe_u£r
;

469 
qpŞ_rŞe_g‘_Çme
(
q
, 
sourû_rŞe
, &
sourû_rŞe_Çme
);

470 
qpŞ_rŞe_g‘_Çme
(
q
, 
deçuÉ_rŞe
, &
deçuÉ_rŞe_Çme
);

471 
­Ş_rŞe_®low_qu”y_£t_sourû
(
pŞicy
, 
rŞe_®low_qu”y
,

472 
sourû_rŞe_Çme
);

473 
­Ş_rŞe_®low_qu”y_£t_rg‘
(
pŞicy
, 
rŞe_®low_qu”y
,

474 
deçuÉ_rŞe_Çme
);

475 
­Ş_rŞe_®low_g‘_by_qu”y
(
pŞicy
, 
rŞe_®low_qu”y
, &
rŞe_®low_veùÜ
);

477 
­Ş_u£r_qu”y_£t_rŞe
(
pŞicy
, 
u£r_qu”y
, 
sourû_rŞe_Çme
);

478 
­Ş_u£r_g‘_by_qu”y
(
pŞicy
, 
u£r_qu”y
, &
sourû_rŞe_u£r
);

479 
­Ş_u£r_qu”y_£t_rŞe
(
pŞicy
, 
u£r_qu”y
, 
deçuÉ_rŞe_Çme
);

480 
­Ş_u£r_g‘_by_qu”y
(
pŞicy
, 
u£r_qu”y
, &
deçuÉ_rŞe_u£r
);

482 
	gcommÚ_rŞe_u£r
 =

483 
­Ş_veùÜ_ü—‹_äom_š‹r£ùiÚ
(
sourû_rŞe_u£r
,

484 
deçuÉ_rŞe_u£r
, 
NULL
, NULL);

485 
­Ş_veùÜ_de¡roy
(&
sourû_rŞe_u£r
);

486 
­Ş_veùÜ_de¡roy
(&
deçuÉ_rŞe_u£r
);

487 ià(
­Ş_veùÜ_g‘_size
(
rŞe_®low_veùÜ
) &&

488 
­Ş_veùÜ_g‘_size
(
commÚ_rŞe_u£r
)) {

489 
	gok
 = 
Œue
;

490 
­Ş_veùÜ_de¡roy
(&
rŞe_®low_veùÜ
);

491 
­Ş_veùÜ_de¡roy
(&
commÚ_rŞe_u£r
);

494 ià(!
­Ş_veùÜ_g‘_size
(
rŞe_®low_veùÜ
)) {

496 
a¥rštf
(&
¿¡ršg
, "®low % %s;", 
sourû_rŞe_Çme
,

497 
deçuÉ_rŞe_Çme
);

498 ià(!
	g¿¡ršg
) {

499 
	g”rÜ
 = 
”ºo
;

500 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

501 
	gšc_dom_Œªs_run_ç
;

504 
­Ş_veùÜ_de¡roy
(&
rŞe_®low_veùÜ
);

505 ià(!
­Ş_veùÜ_g‘_size
(
commÚ_rŞe_u£r
)) {

507 
a¥rštf
(&
u£r¡ršg
, "need user with„oles %s‡nd %s",

508 
sourû_rŞe_Çme
, 
deçuÉ_rŞe_Çme
);

509 ià(!
	gu£r¡ršg
) {

510 
	g”rÜ
 = 
”ºo
;

511 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

512 
	gšc_dom_Œªs_run_ç
;

515 
­Ş_veùÜ_de¡roy
(&
commÚ_rŞe_u£r
);

518 
­Ş_veùÜ_de¡roy
(&
rŞe_Œªs_veùÜ
);

519 ià(!
	gok
) {

520 ià(!
	gÃed_¿
 && !
	gÃed_u£r
) {

521 cÚ¡ 
qpŞ_rŞe_t
 *
	gsourû_rŞe
 =

522 
­Ş_veùÜ_g‘_–em’t
(
¡¬t_rŞe_veùÜ
, 0);

523 cÚ¡ 
qpŞ_rŞe_t
 *
	gdeçuÉ_rŞe
 =

524 
­Ş_veùÜ_g‘_–em’t
(
’d_rŞe_veùÜ
, 0);

525 
qpŞ_rŞe_g‘_Çme
(
q
, 
sourû_rŞe
, &
sourû_rŞe_Çme
);

526 
qpŞ_rŞe_g‘_Çme
(
q
, 
deçuÉ_rŞe
, &
deçuÉ_rŞe_Çme
);

528 
	g™em
 = 
£chk_™em_Ãw
(
dŒ_ä“_w¿p
);

529 ià(!
	g™em
) {

530 
	g”rÜ
 = 
”ºo
;

531 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

532 
	gšc_dom_Œªs_run_ç
;

534 
	g™em
->
	g‹¡_»suÉ
 = 1;

535 
	g™em
->item = (*)

536 
­Ş_domaš_Œªs_»suÉ_ü—‹_äom_domaš_Œªs_»suÉ
(
dŒ
);

537 ià(
­Ş_veùÜ_­³nd
(
»s
->
™ems
, (*)
™em
) < 0) {

538 
	g”rÜ
 = 
”ºo
;

539 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

540 
	gšc_dom_Œªs_run_ç
;

542 ià(!(
	g™em
->
	g´oof
 = 
­Ş_veùÜ_ü—‹
(
£chk_´oof_ä“
))) {

543 
”rÜ
 = 
”ºo
;

544 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

545 
	gšc_dom_Œªs_run_ç
;

547 
	g´oof
 = 
£chk_´oof_Ãw
(
NULL
);

548 
	g´oof
->
	gty³
 = 
SECHK_ITEM_OTHER
;

549 
a¥rštf
(&
´oof
->
‹xt
, "rŞe_Œªs™iÚ % % %s;", 
sourû_rŞe_Çme
,

550 
•_Çme
, 
deçuÉ_rŞe_Çme
);

551 ià(!
	g´oof
->
	g‹xt
) {

552 
	g”rÜ
 = 
”ºo
;

553 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

554 
	gšc_dom_Œªs_run_ç
;

556 ià(
­Ş_veùÜ_­³nd
(
™em
->
´oof
, (*)proof) < 0) {

557 
	g”rÜ
 = 
”ºo
;

558 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

559 
	gšc_dom_Œªs_run_ç
;

561 
	g™em
 = 
NULL
;

564 
	g™em
 = 
£chk_™em_Ãw
(
dŒ_ä“_w¿p
);

565 ià(!
	g™em
) {

566 
	g”rÜ
 = 
”ºo
;

567 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

568 
	gšc_dom_Œªs_run_ç
;

570 
	g™em
->
	g‹¡_»suÉ
 = 1;

571 
	g™em
->item = (*)

572 
­Ş_domaš_Œªs_»suÉ_ü—‹_äom_domaš_Œªs_»suÉ
(
dŒ
);

573 ià(
­Ş_veùÜ_­³nd
(
»s
->
™ems
, (*)
™em
) < 0) {

574 
	g”rÜ
 = 
”ºo
;

575 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

576 
	gšc_dom_Œªs_run_ç
;

578 ià(!(
	g™em
->
	g´oof
 = 
­Ş_veùÜ_ü—‹
(
£chk_´oof_ä“
))) {

579 
”rÜ
 = 
”ºo
;

580 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

581 
	gšc_dom_Œªs_run_ç
;

583 ià(
	gÃed_¿
) {

585 
	g´oof
 = 
£chk_´oof_Ãw
(
NULL
);

586 
	g´oof
->
	gty³
 = 
SECHK_ITEM_OTHER
;

587 
	g´oof
->
	g‹xt
 = 
¿¡ršg
;

588 
	g¿¡ršg
 = 
NULL
;

589 ià(
­Ş_veùÜ_­³nd
(
™em
->
´oof
, (*)proof) < 0) {

590 
	g”rÜ
 = 
”ºo
;

591 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

592 
	gšc_dom_Œªs_run_ç
;

595 ià(
	gÃed_u£r
) {

597 
	g´oof
 = 
£chk_´oof_Ãw
(
NULL
);

598 
	g´oof
->
	gty³
 = 
SECHK_ITEM_OTHER
;

599 
	g´oof
->
	g‹xt
 = 
u£r¡ršg
;

600 
	gu£r¡ršg
 = 
NULL
;

601 ià(
­Ş_veùÜ_­³nd
(
™em
->
´oof
, (*)proof) < 0) {

602 
	g”rÜ
 = 
”ºo
;

603 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

604 
	gšc_dom_Œªs_run_ç
;

607 
	g™em
 = 
NULL
;

611 
­Ş_veùÜ_de¡roy
(&
¡¬t_rŞe_veùÜ
);

612 
­Ş_veùÜ_de¡roy
(&
’d_rŞe_veùÜ
);

613 
­Ş_veùÜ_de¡roy
(&
commÚ_rŞe_veùÜ
);

615 
	g™em
 = 
£chk_™em_Ãw
(
dŒ_ä“_w¿p
);

616 ià(!
	g™em
) {

617 
	g”rÜ
 = 
”ºo
;

618 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

619 
	gšc_dom_Œªs_run_ç
;

621 
	g™em
->
	g‹¡_»suÉ
 = 1;

622 
	g™em
->™em = (*)
­Ş_domaš_Œªs_»suÉ_ü—‹_äom_domaš_Œªs_»suÉ
(
dŒ
);

623 ià(
­Ş_veùÜ_­³nd
(
»s
->
™ems
, (*)
™em
) < 0) {

624 
	g”rÜ
 = 
”ºo
;

625 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

626 
	gšc_dom_Œªs_run_ç
;

628 ià(!(
	g™em
->
	g´oof
 = 
­Ş_veùÜ_ü—‹
(
£chk_´oof_ä“
))) {

629 
”rÜ
 = 
”ºo
;

630 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

631 
	gšc_dom_Œªs_run_ç
;

634 ià(
	g»suÉ
 & 
	gAPOL_DOMAIN_TRANS_RULE_PROC_TRANS
) {

635 
	g´oof
 = 
£chk_´oof_Ãw
(
NULL
);

636 
	g´oof
->
	gty³
 = 
SECHK_ITEM_OTHER
;

637 
	gbuff
 = 
NULL
;

638 
	gbuff_sz
 =

639 10 + 
¡¾’
("®low :…roûs Œªs™iÚ;"è+ sŒËn(
¡¬t_Çme
è+ sŒËn(
’d_Çme
);

640 
	gbuff
 = (*)
ÿÎoc
(
buff_sz
, ());

641 ià(!
	gbuff
) {

642 
	g”rÜ
 = 
”ºo
;

643 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

644 
	gšc_dom_Œªs_run_ç
;

646 
¢´štf
(
buff
, 
buff_sz
, "®low % % :…roûs Œªs™iÚ;", 
¡¬t_Çme
, 
’d_Çme
);

647 
	g´oof
->
	g‹xt
 = 
¡rdup
(
buff
);

648 
ä“
(
buff
);

649 
	gbuff
 = 
NULL
;

650 ià(!
	g´oof
->
	g‹xt
) {

651 
	g”rÜ
 = 
”ºo
;

652 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

653 
	gšc_dom_Œªs_run_ç
;

655 ià(
­Ş_veùÜ_­³nd
(
™em
->
´oof
, (*)proof) < 0) {

656 
	g”rÜ
 = 
”ºo
;

657 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

658 
	gšc_dom_Œªs_run_ç
;

662 ià(
	g»suÉ
 & 
	gAPOL_DOMAIN_TRANS_RULE_EXEC
) {

663 
	g´oof
 = 
£chk_´oof_Ãw
(
NULL
);

664 
	g´oof
->
	gty³
 = 
SECHK_ITEM_OTHER
;

665 
	gbuff
 = 
NULL
;

666 
	gbuff_sz
 = 10 + 
¡¾’
("®low : fexecu‹;"è+ sŒËn(
¡¬t_Çme
è+ sŒËn(
•_Çme
);

667 
	gbuff
 = (*)
ÿÎoc
(
buff_sz
, ());

668 ià(!
	gbuff
) {

669 
	g”rÜ
 = 
”ºo
;

670 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

671 
	gšc_dom_Œªs_run_ç
;

673 
¢´štf
(
buff
, 
buff_sz
, "®low % % : fexecu‹;", 
¡¬t_Çme
, 
•_Çme
);

674 
	g´oof
->
	g‹xt
 = 
¡rdup
(
buff
);

675 
ä“
(
buff
);

676 
	gbuff
 = 
NULL
;

677 ià(!
	g´oof
->
	g‹xt
) {

678 
	g”rÜ
 = 
”ºo
;

679 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

680 
	gšc_dom_Œªs_run_ç
;

682 ià(
­Ş_veùÜ_­³nd
(
™em
->
´oof
, (*)proof) < 0) {

683 
	g”rÜ
 = 
”ºo
;

684 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

685 
	gšc_dom_Œªs_run_ç
;

689 ià(
	g»suÉ
 & 
	gAPOL_DOMAIN_TRANS_RULE_ENTRYPOINT
) {

690 
	g´oof
 = 
£chk_´oof_Ãw
(
NULL
);

691 
	g´oof
->
	gty³
 = 
SECHK_ITEM_OTHER
;

692 
	gbuff
 = 
NULL
;

693 
	gbuff_sz
 = 10 + 
¡¾’
("®low : f’Œypošt;"è+ sŒËn(
’d_Çme
è+ sŒËn(
•_Çme
);

694 
	gbuff
 = (*)
ÿÎoc
(
buff_sz
, ());

695 ià(!
	gbuff
) {

696 
	g”rÜ
 = 
”ºo
;

697 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

698 
	gšc_dom_Œªs_run_ç
;

700 
¢´štf
(
buff
, 
buff_sz
, "®low % % : f’Œypošt;", 
’d_Çme
, 
•_Çme
);

701 
	g´oof
->
	g‹xt
 = 
¡rdup
(
buff
);

702 
ä“
(
buff
);

703 
	gbuff
 = 
NULL
;

704 ià(!
	g´oof
->
	g‹xt
) {

705 
	g”rÜ
 = 
”ºo
;

706 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

707 
	gšc_dom_Œªs_run_ç
;

709 ià(
­Ş_veùÜ_­³nd
(
™em
->
´oof
, (*)proof) < 0) {

710 
	g”rÜ
 = 
”ºo
;

711 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

712 
	gšc_dom_Œªs_run_ç
;

716 ià(
	g»suÉ
 & 
	gAPOL_DOMAIN_TRANS_RULE_TYPE_TRANS
) {

717 
	g´oof
 = 
£chk_´oof_Ãw
(
NULL
);

718 
	g´oof
->
	gty³
 = 
SECHK_ITEM_OTHER
;

719 
	gbuff
 = 
NULL
;

720 
	gbuff_sz
 =

721 10 + 
¡¾’
("ty³_Œªs™iÚ :´oûs ;"è+ sŒËn(
¡¬t_Çme
è+ sŒËn(
’d_Çme
) +

722 
¡¾’
(
•_Çme
);

723 
	gbuff
 = (*)
ÿÎoc
(
buff_sz
, ());

724 ià(!
	gbuff
) {

725 
	g”rÜ
 = 
”ºo
;

726 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

727 
	gšc_dom_Œªs_run_ç
;

729 
¢´štf
(
buff
, 
buff_sz
, "ty³_Œªs™iÚ % % :…roûs %s;", 
¡¬t_Çme
, 
•_Çme
,

730 
’d_Çme
);

731 
	g´oof
->
	g‹xt
 = 
¡rdup
(
buff
);

732 
ä“
(
buff
);

733 
	gbuff
 = 
NULL
;

734 ià(!
	g´oof
->
	g‹xt
) {

735 
	g”rÜ
 = 
”ºo
;

736 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

737 
	gšc_dom_Œªs_run_ç
;

739 ià(
­Ş_veùÜ_­³nd
(
™em
->
´oof
, (*)proof) < 0) {

740 
	g”rÜ
 = 
”ºo
;

741 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

742 
	gšc_dom_Œªs_run_ç
;

746 ià(
	g»suÉ
 & 
	gAPOL_DOMAIN_TRANS_RULE_SETEXEC
) {

747 
	g´oof
 = 
£chk_´oof_Ãw
(
NULL
);

748 
	g´oof
->
	gty³
 = 
SECHK_ITEM_OTHER
;

749 
	gbuff
 = 
NULL
;

750 
	gbuff_sz
 = 10 + 
¡¾’
("®low s–à:…roûs £‹xec;"è+ sŒËn(
¡¬t_Çme
);

751 
	gbuff
 = (*)
ÿÎoc
(
buff_sz
, ());

752 ià(!
	gbuff
) {

753 
	g”rÜ
 = 
”ºo
;

754 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

755 
	gšc_dom_Œªs_run_ç
;

757 
¢´štf
(
buff
, 
buff_sz
, "®low % £là:…roûs £‹xec;", 
¡¬t_Çme
);

758 
	g´oof
->
	g‹xt
 = 
¡rdup
(
buff
);

759 
ä“
(
buff
);

760 
	gbuff
 = 
NULL
;

761 ià(!
	g´oof
->
	g‹xt
) {

762 
	g”rÜ
 = 
”ºo
;

763 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

764 
	gšc_dom_Œªs_run_ç
;

766 ià(
­Ş_veùÜ_­³nd
(
™em
->
´oof
, (*)proof) < 0) {

767 
	g”rÜ
 = 
”ºo
;

768 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

769 
	gšc_dom_Œªs_run_ç
;

774 
­Ş_veùÜ_de¡roy
(&
domaš_Œªs_veùÜ
);

777 
	gmod
->
	g»suÉ
 = 
»s
;

778 
­Ş_domaš_Œªs_ª®ysis_de¡roy
(&
domaš_Œªs
);

779 
­Ş_u£r_qu”y_de¡roy
(&
u£r_qu”y
);

780 
­Ş_rŞe_Œªs_qu”y_de¡roy
(&
rŞe_Œªs_qu”y
);

781 
­Ş_rŞe_qu”y_de¡roy
(&
¡¬t_rŞe_qu”y
);

782 
­Ş_rŞe_qu”y_de¡roy
(&
’d_rŞe_qu”y
);

783 
­Ş_rŞe_®low_qu”y_de¡roy
(&
rŞe_®low_qu”y
);

785 ià(
­Ş_veùÜ_g‘_size
(
»s
->
™ems
))

789 
	gšc_dom_Œªs_run_ç
:

790 
£chk_™em_ä“
(
™em
);

791 
­Ş_veùÜ_de¡roy
(&
u£r_veùÜ
);

792 
­Ş_veùÜ_de¡roy
(&
domaš_Œªs_veùÜ
);

793 
£chk_»suÉ_de¡roy
(&
»s
);

794 
	g”ºo
 = 
”rÜ
;

800 
šc_dom_Œªs_´št
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

802 
	goutfÜm©
 = 0x00;

803 
£chk_™em_t
 *
	g™em
 = 
NULL
;

804 
qpŞ_pŞicy_t
 *
	gq
 = 
­Ş_pŞicy_g‘_qpŞ
(
pŞicy
);

805 
size_t
 
	gi
 = 0, 
	gj
 = 0, 
	gnum_™ems
;

807 ià(!
	gmod
 || !
	gpŞicy
) {

808 
ERR
(
pŞicy
, "%s", "Invalid…arameters");

809 
	g”ºo
 = 
EINVAL
;

812 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

813 
ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

814 
	g”ºo
 = 
EINVAL
;

818 
	goutfÜm©
 = 
mod
->
ouutfÜm©
;

819 
	gnum_™ems
 = 
­Ş_veùÜ_g‘_size
(
mod
->
»suÉ
->
™ems
);

821 ià(!
	gmod
->
	g»suÉ
) {

822 
ERR
(
pŞicy
, "%s", "Module has‚ot been„un");

823 
	g”ºo
 = 
EINVAL
;

827 ià(!
	goutfÜm©
 || (outfÜm© & 
	gSECHK_OUT_QUIET
))

830 ià(
	goutfÜm©
 & 
	gSECHK_OUT_STATS
) {

831 
´štf
("Found %˜šcom¶‘Œªs™iÚs.\n", 
num_™ems
);

835 ià(
	goutfÜm©
 & 
	gSECHK_OUT_LIST
) {

840 
´štf
("\n");

841 
	gi
 = 0; i < 
	gnum_™ems
; i++) {

842 cÚ¡ 
qpŞ_ty³_t
 *
	g¡¬t
;

843 cÚ¡ 
qpŞ_ty³_t
 *
	g’d
;

844 cÚ¡ 
qpŞ_ty³_t
 *
	g•
;

845 cÚ¡ *
	g¡¬t_Çme
, *
	g’d_Çme
, *
	g•_Çme
;

846 
­Ş_domaš_Œªs_»suÉ_t
 *
	gdŒ
;

848 
	g™em
 = 
­Ş_veùÜ_g‘_–em’t
(
mod
->
»suÉ
->
™ems
, 
i
);

849 
	gdŒ
 = 
™em
->item;

850 
	g¡¬t
 = 
­Ş_domaš_Œªs_»suÉ_g‘_¡¬t_ty³
(
dŒ
);

851 
	g•
 = 
­Ş_domaš_Œªs_»suÉ_g‘_’Œypošt_ty³
(
dŒ
);

852 
	g’d
 = 
­Ş_domaš_Œªs_»suÉ_g‘_’d_ty³
(
dŒ
);

853 ià(
	g¡¬t
)

854 
qpŞ_ty³_g‘_Çme
(
q
, 
¡¬t
, &
¡¬t_Çme
);

856 
	g¡¬t_Çme
 = "<start_type>";

857 ià(
	g’d
)

858 
qpŞ_ty³_g‘_Çme
(
q
, 
’d
, &
’d_Çme
);

860 
	g’d_Çme
 = "<end_type>";

861 ià(
	g•
)

862 
qpŞ_ty³_g‘_Çme
(
q
, 
•
, &
•_Çme
);

864 
	g•_Çme
 = "<entrypoint_type>";

866 
´štf
("% -> %s\‹Árypošt: %s\n", 
¡¬t_Çme
, 
’d_Çme
, 
•_Çme
);

868 
´štf
("\n");

873 ià(
	goutfÜm©
 & 
	gSECHK_OUT_PROOF
) {

874 
´štf
("\n");

875 
	gi
 = 0; i < 
	gnum_™ems
; i++) {

876 cÚ¡ 
qpŞ_ty³_t
 *
	g¡¬t
;

877 cÚ¡ 
qpŞ_ty³_t
 *
	g’d
;

878 cÚ¡ 
qpŞ_ty³_t
 *
	g•
;

879 cÚ¡ *
	g¡¬t_Çme
, *
	g’d_Çme
, *
	g•_Çme
;

880 
­Ş_domaš_Œªs_»suÉ_t
 *
	gdŒ
;

882 
	g™em
 = 
­Ş_veùÜ_g‘_–em’t
(
mod
->
»suÉ
->
™ems
, 
i
);

883 
	gdŒ
 = 
™em
->item;

884 
	g¡¬t
 = 
­Ş_domaš_Œªs_»suÉ_g‘_¡¬t_ty³
(
dŒ
);

885 
	g•
 = 
­Ş_domaš_Œªs_»suÉ_g‘_’Œypošt_ty³
(
dŒ
);

886 
	g’d
 = 
­Ş_domaš_Œªs_»suÉ_g‘_’d_ty³
(
dŒ
);

887 ià(
	g¡¬t
)

888 
qpŞ_ty³_g‘_Çme
(
q
, 
¡¬t
, &
¡¬t_Çme
);

890 
	g¡¬t_Çme
 = "<start_type>";

891 ià(
	g’d
)

892 
qpŞ_ty³_g‘_Çme
(
q
, 
’d
, &
’d_Çme
);

894 
	g’d_Çme
 = "<end_type>";

895 ià(
	g•
)

896 
qpŞ_ty³_g‘_Çme
(
q
, 
•
, &
•_Çme
);

898 
	g•_Çme
 = "<entrypoint_type>";

900 
´štf
("% -> %s\‹Árypošt: %s\n\tMissšg:\n", 
¡¬t_Çme
, 
’d_Çme
, 
•_Çme
);

901 
	gj
 = 0; j < 
­Ş_veùÜ_g‘_size
(
™em
->
´oof
); j++) {

902 
£chk_´oof_t
 *
	g´oof
;

904 
	g´oof
 = 
­Ş_veùÜ_g‘_–em’t
(
™em
->
´oof
, 
j
);

905 ià(
	g´oof
) {

906 
´štf
("\t%s\n", 
´oof
->
‹xt
);

	@sechecker/modules/inc_dom_trans.h

26 #iâdeà
INC_DOM_TRANS


27 
	#INC_DOM_TRANS


	)

29 #ifdef 
__ılu¥lus


34 
	~"£check”.h
"

35 
	~<­Ş/pŞicy.h
>

36 
	~<­Ş/domaš-Œªs-ª®ysis.h
>

37 
	~<­Ş/u£r-qu”y.h
>

38 
	~<­Ş/rbaüuË-qu”y.h
>

39 
	~<­Ş/rŞe-qu”y.h
>

41 
	#SECHK_INC_DOM_TRANS_HAS_TT
 0x08

	)

42 
	#SECHK_INC_DOM_TRANS_HAS_EXEC
 0x04

	)

43 
	#SECHK_INC_DOM_TRANS_HAS_TRANS
 0x02

	)

44 
	#SECHK_INC_DOM_TRANS_HAS_EP
 0x01

	)

45 
	#SECHK_INC_DOM_TRANS_COMPLETE
 (
SECHK_INC_DOM_TRANS_HAS_EP
|
SECHK_INC_DOM_TRANS_HAS_TRANS
|
SECHK_INC_DOM_TRANS_HAS_EXEC
)

	)

47 
šc_dom_Œªs_»gi¡”
(
£chk_lib_t
 * 
lib
);

48 
šc_dom_Œªs_š™
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

49 
šc_dom_Œªs_run
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

50 
šc_dom_Œªs_´št
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

52 #ifdef 
__ılu¥lus


	@sechecker/modules/inc_mount.c

26 
	~"šc_mouÁ.h
"

28 
	~<¡dio.h
>

29 
	~<¡ršg.h
>

30 
	~<”ºo.h
>

35 cÚ¡ *cÚ¡ 
	gmod_Çme
 = "inc_mount";

39 
	$šc_mouÁ_»gi¡”
(
£chk_lib_t
 * 
lib
)

41 
£chk_moduË_t
 *
mod
 = 
NULL
;

42 
£chk_â_t
 *
â_¡ruù
 = 
NULL
;

44 ià(!
lib
) {

45 
	`ERR
(
NULL
, "%s", "no†ibrary");

46 
”ºo
 = 
EINVAL
;

53 
mod
 = 
	`£chk_lib_g‘_moduË
(
mod_Çme
, 
lib
);

54 ià(!
mod
) {

55 
	`ERR
(
NULL
, "%s", "Module unknown");

56 
”ºo
 = 
EINVAL
;

59 
mod
->
·»Á_lib
 = 
lib
;

62 
mod
->
br›f_desütiÚ
 = "domains with…artial mount…ermissions";

63 
mod
->
d‘aed_desütiÚ
 =

72 
mod
->
İt_desütiÚ
 =

74 
mod
->
£v”™y
 = 
SECHK_SEV_MED
;

76 
â_¡ruù
 = 
	`£chk_â_Ãw
();

77 ià(!
â_¡ruù
) {

78 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

79 
”ºo
 = 
ENOMEM
;

82 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_INIT
);

83 ià(!
â_¡ruù
->
Çme
) {

84 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

85 
”ºo
 = 
ENOMEM
;

88 
â_¡ruù
->
â
 = 
šc_mouÁ_š™
;

89 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
) < 0) {

90 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

91 
”ºo
 = 
ENOMEM
;

95 
â_¡ruù
 = 
	`£chk_â_Ãw
();

96 ià(!
â_¡ruù
) {

97 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

98 
”ºo
 = 
ENOMEM
;

101 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_RUN
);

102 ià(!
â_¡ruù
->
Çme
) {

103 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

104 
”ºo
 = 
ENOMEM
;

107 
â_¡ruù
->
â
 = 
šc_mouÁ_run
;

108 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
) < 0) {

109 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

110 
”ºo
 = 
ENOMEM
;

114 
mod
->
d©a_ä“
 = 
NULL
;

116 
â_¡ruù
 = 
	`£chk_â_Ãw
();

117 ià(!
â_¡ruù
) {

118 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

119 
”ºo
 = 
ENOMEM
;

122 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_PRINT
);

123 ià(!
â_¡ruù
->
Çme
) {

124 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

125 
”ºo
 = 
ENOMEM
;

128 
â_¡ruù
->
â
 = 
šc_mouÁ_´št
;

129 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
) < 0) {

130 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

131 
”ºo
 = 
ENOMEM
;

136 
	}
}

141 
šc_mouÁ_š™
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

143 ià(!
	gmod
 || !
	gpŞicy
) {

144 
ERR
(
pŞicy
, "%s", "Invalid…arameters");

145 
	g”ºo
 = 
EINVAL
;

148 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

149 
ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

150 
	g”ºo
 = 
EINVAL
;

154 
	gmod
->
	gd©a
 = 
NULL
;

163 
šc_mouÁ_run
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

165 
£chk_»suÉ_t
 *
	g»s
 = 
NULL
;

166 
£chk_™em_t
 *
	g™em
 = 
NULL
;

167 
£chk_´oof_t
 *
	g´oof
 = 
NULL
;

168 
size_t
 
	gi
, 
	gj
;

169 
boŞ
 
	gbÙh
 = 
çl£
, 
	gadd_´oof
 = false;

170 
	g”rÜ
 = 0;

171 *
	gtmp
 = 
NULL
;

172 
­Ş_veùÜ_t
 *
	gmouÁ_veùÜ
;

173 
­Ş_veùÜ_t
 *
	gmouÁÚ_veùÜ
;

174 
­Ş_avruË_qu”y_t
 *
	gmouÁ_avruË_qu”y
 = 
NULL
;

175 
­Ş_avruË_qu”y_t
 *
	gmouÁÚ_avruË_qu”y
 = 
NULL
;

176 
qpŞ_pŞicy_t
 *
	gq
 = 
­Ş_pŞicy_g‘_qpŞ
(
pŞicy
);

178 ià(!
	gmod
 || !
	gpŞicy
) {

179 
ERR
(
pŞicy
, "%s", "Invalid…arameters");

180 
	g”ºo
 = 
EINVAL
;

183 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

184 
ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

185 
	g”ºo
 = 
EINVAL
;

190 ià(
	gmod
->
	g»suÉ
)

193 
	g»s
 = 
£chk_»suÉ_Ãw
();

194 ià(!
	g»s
) {

195 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

196 
	g”ºo
 = 
ENOMEM
;

199 
	g»s
->
	g‹¡_Çme
 = 
¡rdup
(
mod_Çme
);

200 ià(!
	g»s
->
	g‹¡_Çme
) {

201 
	g”rÜ
 = 
”ºo
;

202 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

203 
	gšc_mouÁ_run_ç
;

205 
	g»s
->
	g™em_ty³
 = 
SECHK_ITEM_TYPE
;

206 ià(!(
	g»s
->
	g™ems
 = 
­Ş_veùÜ_ü—‹
(
£chk_™em_ä“
))) {

207 
”rÜ
 = 
”ºo
;

208 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

209 
	gšc_mouÁ_run_ç
;

212 ià(!(
	gmouÁ_avruË_qu”y
 = 
­Ş_avruË_qu”y_ü—‹
())) {

213 
”rÜ
 = 
”ºo
;

214 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

215 
	gšc_mouÁ_run_ç
;

218 ià(!(
	gmouÁÚ_avruË_qu”y
 = 
­Ş_avruË_qu”y_ü—‹
())) {

219 
”rÜ
 = 
”ºo
;

220 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

221 
	gšc_mouÁ_run_ç
;

225 
­Ş_avruË_qu”y_£t_ruËs
(
pŞicy
, 
mouÁ_avruË_qu”y
, 
QPOL_RULE_ALLOW
);

226 
­Ş_avruË_qu”y_­³nd_şass
(
pŞicy
, 
mouÁ_avruË_qu”y
, "filesystem");

227 
­Ş_avruË_qu”y_­³nd_³rm
(
pŞicy
, 
mouÁ_avruË_qu”y
, "mount");

228 
­Ş_avruË_g‘_by_qu”y
(
pŞicy
, 
mouÁ_avruË_qu”y
, &
mouÁ_veùÜ
);

231 
­Ş_avruË_qu”y_£t_ruËs
(
pŞicy
, 
mouÁÚ_avruË_qu”y
, 
QPOL_RULE_ALLOW
);

232 
­Ş_avruË_qu”y_­³nd_şass
(
pŞicy
, 
mouÁÚ_avruË_qu”y
, "dir");

233 
­Ş_avruË_qu”y_­³nd_³rm
(
pŞicy
, 
mouÁÚ_avruË_qu”y
, "mounton");

234 
­Ş_avruË_g‘_by_qu”y
(
pŞicy
, 
mouÁÚ_avruË_qu”y
, &
mouÁÚ_veùÜ
);

236 
	gi
 = 0; i < 
­Ş_veùÜ_g‘_size
(
mouÁ_veùÜ
); i++) {

237 cÚ¡ 
qpŞ_avruË_t
 *
	gmouÁ_ruË
;

238 cÚ¡ 
qpŞ_ty³_t
 *
	gmouÁ_sourû
;

239 cÚ¡ 
qpŞ_ty³_t
 *
	gmouÁ_rg‘
;

240 cÚ¡ *
	gmouÁ_sourû_Çme
, *
	gmouÁ_rg‘_Çme
;

242 
	gbÙh
 = 
çl£
;

243 
	gadd_´oof
 = 
Œue
;

244 
	gmouÁ_ruË
 = 
­Ş_veùÜ_g‘_–em’t
(
mouÁ_veùÜ
, 
i
);

245 
qpŞ_avruË_g‘_sourû_ty³
(
q
, 
mouÁ_ruË
, &
mouÁ_sourû
);

246 
qpŞ_avruË_g‘_rg‘_ty³
(
q
, 
mouÁ_ruË
, &
mouÁ_rg‘
);

247 
qpŞ_ty³_g‘_Çme
(
q
, 
mouÁ_sourû
, &
mouÁ_sourû_Çme
);

248 
qpŞ_ty³_g‘_Çme
(
q
, 
mouÁ_rg‘
, &
mouÁ_rg‘_Çme
);

250 
	gj
 = 0; j < 
­Ş_veùÜ_g‘_size
(
mouÁÚ_veùÜ
); j++) {

251 cÚ¡ 
qpŞ_avruË_t
 *
	gmouÁÚ_ruË
;

252 cÚ¡ 
qpŞ_ty³_t
 *
	gmouÁÚ_sourû
;

253 cÚ¡ 
qpŞ_ty³_t
 *
	gmouÁÚ_rg‘
;

254 cÚ¡ *
	gmouÁÚ_sourû_Çme
, *
	gmouÁÚ_rg‘_Çme
;

256 
	gmouÁÚ_ruË
 = 
­Ş_veùÜ_g‘_–em’t
(
mouÁÚ_veùÜ
, 
j
);

257 
qpŞ_avruË_g‘_sourû_ty³
(
q
, 
mouÁÚ_ruË
, &
mouÁÚ_sourû
);

258 
qpŞ_avruË_g‘_rg‘_ty³
(
q
, 
mouÁÚ_ruË
, &
mouÁÚ_rg‘
);

259 
qpŞ_ty³_g‘_Çme
(
q
, 
mouÁÚ_sourû
, &
mouÁÚ_sourû_Çme
);

260 
qpŞ_ty³_g‘_Çme
(
q
, 
mouÁÚ_rg‘
, &
mouÁÚ_rg‘_Çme
);

263 ià(!
¡rcmp
(
mouÁ_sourû_Çme
, 
mouÁÚ_sourû_Çme
è&& !¡rcmp(
mouÁ_rg‘_Çme
, 
mouÁÚ_rg‘_Çme
))

264 
	gbÙh
 = 
Œue
;

266 ià(!
	gbÙh
) {

267 
	g´oof
 = 
£chk_´oof_Ãw
(
NULL
);

268 ià(!
	g´oof
) {

269 
	g”rÜ
 = 
”ºo
;

270 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

271 
	gšc_mouÁ_run_ç
;

273 
	g´oof
->
	gty³
 = 
SECHK_ITEM_AVRULE
;

274 
	g´oof
->
	g–em
 = (*)
mouÁ_ruË
;

275 
	gtmp
 = 
­Ş_avruË_»nd”
(
pŞicy
, 
mouÁ_ruË
);

276 
a¥rštf
(&
´oof
->
‹xt
, "Have Rule:\n\t\t%s\n\tMissing:\n\t\tallow %s %s : dir mounton ;\n",

277 
tmp
, 
mouÁ_sourû_Çme
, 
mouÁ_rg‘_Çme
);

278 
ä“
(
tmp
);

279 ià(!
	g´oof
->
	g‹xt
) {

280 
	g”rÜ
 = 
”ºo
;

281 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

282 
	gšc_mouÁ_run_ç
;

284 
	gj
 = 0; j < 
­Ş_veùÜ_g‘_size
(
»s
->
™ems
); j++) {

285 
£chk_™em_t
 *
	g»s_™em
;

286 cÚ¡ 
qpŞ_ty³_t
 *
	g»s_ty³
;

287 cÚ¡ *
	g»s_ty³_Çme
;

289 
	g»s_™em
 = 
­Ş_veùÜ_g‘_–em’t
(
»s
->
™ems
, 
j
);

290 
	g»s_ty³
 = 
»s_™em
->
™em
;

291 
qpŞ_ty³_g‘_Çme
(
q
, 
»s_ty³
, &
»s_ty³_Çme
);

292 ià(!
¡rcmp
(
mouÁ_sourû_Çme
, 
»s_ty³_Çme
è|| !¡rcmp(
mouÁ_rg‘_Çme
,„es_type_name))

293 
	gadd_´oof
 = 
çl£
;

295 ià(
	gadd_´oof
) {

296 ià(!
	g™em
) {

297 
	g™em
 = 
£chk_™em_Ãw
(
NULL
);

298 ià(!
	g™em
) {

299 
	g”rÜ
 = 
”ºo
;

300 
ERR
(
NULL
, "%s", 
¡»¼Ü
(
ENOMEM
));

301 
	gšc_mouÁ_run_ç
;

303 
	g™em
->™em = (*)
mouÁ_sourû
;

305 ià(!
	g™em
->
	g´oof
) {

306 ià(!(
	g™em
->
	g´oof
 = 
­Ş_veùÜ_ü—‹
(
£chk_´oof_ä“
))) {

307 
”rÜ
 = 
”ºo
;

308 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

309 
	gšc_mouÁ_run_ç
;

312 ià(
­Ş_veùÜ_­³nd
(
™em
->
´oof
, (*)proof) < 0) {

313 
	g”rÜ
 = 
”ºo
;

314 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

315 
	gšc_mouÁ_run_ç
;

317 ià(
­Ş_veùÜ_­³nd
(
»s
->
™ems
, (*)
™em
) < 0) {

318 
	g”rÜ
 = 
”ºo
;

319 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

320 
	gšc_mouÁ_run_ç
;

322 
	g™em
 = 
NULL
;

323 
	g´oof
 = 
NULL
;

325 
£chk_´oof_ä“
(
´oof
);

326 
	g´oof
 = 
NULL
;

330 
	gi
 = 0; i < 
­Ş_veùÜ_g‘_size
(
mouÁÚ_veùÜ
); i++) {

331 cÚ¡ 
qpŞ_avruË_t
 *
	gmouÁÚ_ruË
;

332 cÚ¡ 
qpŞ_ty³_t
 *
	gmouÁÚ_sourû
;

333 cÚ¡ 
qpŞ_ty³_t
 *
	gmouÁÚ_rg‘
;

334 cÚ¡ *
	gmouÁÚ_sourû_Çme
, *
	gmouÁÚ_rg‘_Çme
;

336 
	gbÙh
 = 
çl£
;

337 
	gadd_´oof
 = 
Œue
;

338 
	gmouÁÚ_ruË
 = 
­Ş_veùÜ_g‘_–em’t
(
mouÁÚ_veùÜ
, 
i
);

339 
qpŞ_avruË_g‘_sourû_ty³
(
q
, 
mouÁÚ_ruË
, &
mouÁÚ_sourû
);

340 
qpŞ_avruË_g‘_rg‘_ty³
(
q
, 
mouÁÚ_ruË
, &
mouÁÚ_rg‘
);

341 
qpŞ_ty³_g‘_Çme
(
q
, 
mouÁÚ_sourû
, &
mouÁÚ_sourû_Çme
);

342 
qpŞ_ty³_g‘_Çme
(
q
, 
mouÁÚ_rg‘
, &
mouÁÚ_rg‘_Çme
);

344 
	gj
 = 0; j < 
­Ş_veùÜ_g‘_size
(
mouÁ_veùÜ
); j++) {

345 cÚ¡ 
qpŞ_avruË_t
 *
	gmouÁ_ruË
;

346 cÚ¡ 
qpŞ_ty³_t
 *
	gmouÁ_sourû
;

347 cÚ¡ 
qpŞ_ty³_t
 *
	gmouÁ_rg‘
;

348 cÚ¡ *
	gmouÁ_sourû_Çme
, *
	gmouÁ_rg‘_Çme
;

350 
	gmouÁ_ruË
 = 
­Ş_veùÜ_g‘_–em’t
(
mouÁ_veùÜ
, 
j
);

351 
qpŞ_avruË_g‘_sourû_ty³
(
q
, 
mouÁ_ruË
, &
mouÁ_sourû
);

352 
qpŞ_avruË_g‘_rg‘_ty³
(
q
, 
mouÁ_ruË
, &
mouÁ_rg‘
);

353 
qpŞ_ty³_g‘_Çme
(
q
, 
mouÁ_sourû
, &
mouÁ_sourû_Çme
);

354 
qpŞ_ty³_g‘_Çme
(
q
, 
mouÁ_rg‘
, &
mouÁ_rg‘_Çme
);

356 ià(!
¡rcmp
(
mouÁ_sourû_Çme
, 
mouÁÚ_sourû_Çme
è&& !¡rcmp(
mouÁ_rg‘_Çme
, 
mouÁÚ_rg‘_Çme
))

357 
	gbÙh
 = 
Œue
;

359 ià(!
	gbÙh
) {

360 
	g´oof
 = 
£chk_´oof_Ãw
(
NULL
);

361 ià(!
	g´oof
) {

362 
	g”rÜ
 = 
”ºo
;

363 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

364 
	gšc_mouÁ_run_ç
;

366 
	g´oof
->
	gty³
 = 
SECHK_ITEM_AVRULE
;

367 
	g´oof
->
	g–em
 = (*)
mouÁÚ_ruË
;

368 
	gtmp
 = 
­Ş_avruË_»nd”
(
pŞicy
, 
mouÁÚ_ruË
);

369 
a¥rštf
(&
´oof
->
‹xt
, "Have Rule:\n\t\t%s\n\tMissing:\n\t\tallow %s %s : filesystem mount ;\n",

370 
tmp
, 
mouÁÚ_sourû_Çme
, 
mouÁÚ_rg‘_Çme
);

371 
ä“
(
tmp
);

372 
	gj
 = 0; j < 
­Ş_veùÜ_g‘_size
(
»s
->
™ems
); j++) {

373 
£chk_™em_t
 *
	g»s_™em
;

374 cÚ¡ 
qpŞ_ty³_t
 *
	g»s_ty³
;

375 cÚ¡ *
	g»s_ty³_Çme
;

377 
	g»s_™em
 = 
­Ş_veùÜ_g‘_–em’t
(
»s
->
™ems
, 
j
);

378 
	g»s_ty³
 = 
»s_™em
->
™em
;

379 
qpŞ_ty³_g‘_Çme
(
q
, 
»s_ty³
, &
»s_ty³_Çme
);

380 ià(!
¡rcmp
(
mouÁÚ_sourû_Çme
, 
»s_ty³_Çme
è|| !¡rcmp(
mouÁÚ_rg‘_Çme
,„es_type_name))

381 
	gadd_´oof
 = 
çl£
;

383 ià(
	gadd_´oof
) {

384 ià(!
	g™em
) {

385 
	g™em
 = 
£chk_™em_Ãw
(
NULL
);

386 ià(!
	g™em
) {

387 
	g”rÜ
 = 
”ºo
;

388 
ERR
(
NULL
, "%s", 
¡»¼Ü
(
ENOMEM
));

389 
	gšc_mouÁ_run_ç
;

391 
	g™em
->™em = (*)
mouÁÚ_sourû
;

393 ià(!
	g™em
->
	g´oof
) {

394 ià(!(
	g™em
->
	g´oof
 = 
­Ş_veùÜ_ü—‹
(
£chk_´oof_ä“
))) {

395 
”rÜ
 = 
”ºo
;

396 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

397 
	gšc_mouÁ_run_ç
;

400 ià(
­Ş_veùÜ_­³nd
(
™em
->
´oof
, (*)proof) < 0) {

401 
	g”rÜ
 = 
”ºo
;

402 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

403 
	gšc_mouÁ_run_ç
;

405 ià(
­Ş_veùÜ_­³nd
(
»s
->
™ems
, (*)
™em
) < 0) {

406 
	g”rÜ
 = 
”ºo
;

407 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

408 
	gšc_mouÁ_run_ç
;

410 
	g™em
 = 
NULL
;

411 
	g´oof
 = 
NULL
;

413 
£chk_´oof_ä“
(
´oof
);

414 
	g´oof
 = 
NULL
;

417 
­Ş_veùÜ_de¡roy
(&
mouÁ_veùÜ
);

418 
­Ş_veùÜ_de¡roy
(&
mouÁÚ_veùÜ
);

420 
	gmod
->
	g»suÉ
 = 
»s
;

421 
­Ş_avruË_qu”y_de¡roy
(&
mouÁ_avruË_qu”y
);

422 
­Ş_avruË_qu”y_de¡roy
(&
mouÁÚ_avruË_qu”y
);

424 ià(
­Ş_veùÜ_g‘_size
(
»s
->
™ems
))

428 
	gšc_mouÁ_run_ç
:

429 
­Ş_veùÜ_de¡roy
(&
mouÁ_veùÜ
);

430 
­Ş_veùÜ_de¡roy
(&
mouÁÚ_veùÜ
);

431 
­Ş_avruË_qu”y_de¡roy
(&
mouÁ_avruË_qu”y
);

432 
­Ş_avruË_qu”y_de¡roy
(&
mouÁÚ_avruË_qu”y
);

433 
£chk_´oof_ä“
(
´oof
);

434 
£chk_™em_ä“
(
™em
);

435 
ä“
(
tmp
);

436 
£chk_»suÉ_de¡roy
(&
»s
);

437 
	g”ºo
 = 
”rÜ
;

443 
šc_mouÁ_´št
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

445 
	goutfÜm©
 = 0x00;

446 
£chk_™em_t
 *
	g™em
 = 
NULL
;

447 
£chk_´oof_t
 *
	g´oof
 = 
NULL
;

448 
size_t
 
	gi
 = 0, 
	gj
 = 0, 
	gk
, 
	gl
, 
	gnum_™ems
;

449 cÚ¡ 
qpŞ_ty³_t
 *
	gty³
;

450 
qpŞ_pŞicy_t
 *
	gq
 = 
­Ş_pŞicy_g‘_qpŞ
(
pŞicy
);

451 cÚ¡ *
	gty³_Çme
;

453 ià(!
	gmod
 || !
	gpŞicy
) {

454 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
EINVAL
));

455 
	g”ºo
 = 
EINVAL
;

458 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

459 
ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

460 
	g”ºo
 = 
EINVAL
;

464 
	goutfÜm©
 = 
mod
->
ouutfÜm©
;

465 
	gnum_™ems
 = 
­Ş_veùÜ_g‘_size
(
mod
->
»suÉ
->
™ems
);

467 ià(!
	gmod
->
	g»suÉ
) {

468 
ERR
(
pŞicy
, "%s", "Module has‚ot been„un");

469 
	g”ºo
 = 
EINVAL
;

473 ià(!
	goutfÜm©
 || (outfÜm© & 
	gSECHK_OUT_QUIET
))

476 ià(
	goutfÜm©
 & 
	gSECHK_OUT_STATS
) {

477 
´štf
("Found %zdy³s.\n", 
num_™ems
);

481 ià(
	goutfÜm©
 & 
	gSECHK_OUT_LIST
) {

482 
´štf
("\n");

483 
	gi
 = 0; i < 
	gnum_™ems
; i++) {

484 
	gj
++;

485 
	g™em
 = 
­Ş_veùÜ_g‘_–em’t
(
mod
->
»suÉ
->
™ems
, 
i
);

486 
	gty³
 = 
™em
->item;

487 
qpŞ_ty³_g‘_Çme
(
q
, 
ty³
, &
ty³_Çme
);

488 
	gj
 %= 4;

489 
´štf
("%s%s", 
ty³_Çme
, (*)((
j
 && 
i
 !ğ
num_™ems
 - 1) ? ", " : "\n"));

491 
´štf
("\n");

501 ià(
	goutfÜm©
 & 
	gSECHK_OUT_PROOF
) {

502 
´štf
("\n");

503 
	gk
 = 0; k < 
	gnum_™ems
; k++) {

504 
	g™em
 = 
­Ş_veùÜ_g‘_–em’t
(
mod
->
»suÉ
->
™ems
, 
k
);

505 ià(
	g™em
) {

506 
	gty³
 = 
™em
->item;

507 
qpŞ_ty³_g‘_Çme
(
q
, 
ty³
, &
ty³_Çme
);

508 
´štf
("%s\n", (*)
ty³_Çme
);

509 
	gl
 = 0;† < 
­Ş_veùÜ_g‘_size
(
™em
->
´oof
);†++) {

510 
	g´oof
 = 
­Ş_veùÜ_g‘_–em’t
(
™em
->
´oof
, 
l
);

511 ià(
	g´oof
)

512 
´štf
("\t%s\n", 
´oof
->
‹xt
);

516 
´štf
("\n");

	@sechecker/modules/inc_mount.h

26 #iâdeà
INC_MOUNT


27 
	#INC_MOUNT


	)

29 #ifdef 
__ılu¥lus


34 
	~"£check”.h
"

35 
	~<­Ş/pŞicy.h
>

36 
	~<­Ş/avruË-qu”y.h
>

38 
	#SECHK_MOUNT_ONLY_MOUNT
 0x01

	)

39 
	#SECHK_MOUNT_ONLY_MOUNTON
 0x02

	)

45 
šc_mouÁ_»gi¡”
(
£chk_lib_t
 * 
lib
);

46 
šc_mouÁ_š™
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

47 
šc_mouÁ_run
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

48 
šc_mouÁ_´št
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

50 #ifdef 
__ılu¥lus


	@sechecker/modules/inc_net_access.c

27 
	~"šc_Ãt_acûss.h
"

29 
	~<¡dio.h
>

30 
	~<¡ršg.h
>

31 
	~<”ºo.h
>

33 cÚ¡ *cÚ¡ 
	gmod_Çme
 = "inc_net_access";

39 
	$šc_Ãt_acûss_»gi¡”
(
£chk_lib_t
 * 
lib
)

41 
£chk_moduË_t
 *
mod
 = 
NULL
;

42 
£chk_â_t
 *
â_¡ruù
 = 
NULL
;

44 ià(!
lib
) {

45 
	`ERR
(
NULL
, "%s", "No†ibrary");

46 
”ºo
 = 
EINVAL
;

53 
mod
 = 
	`£chk_lib_g‘_moduË
(
mod_Çme
, 
lib
);

54 ià(!
mod
) {

55 
	`ERR
(
NULL
, "%s", "Module unknown");

56 
”ºo
 = 
EINVAL
;

59 
mod
->
·»Á_lib
 = 
lib
;

62 
mod
->
br›f_desütiÚ
 = "finds‚etwork domains with inadequate…ermissions";

63 
mod
->
d‘aed_desütiÚ
 =

78 
mod
->
İt_desütiÚ
 =

81 
mod
->
£v”™y
 = 
SECHK_SEV_MED
;

83 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
d•’d’c›s
, 
	`£chk_Çme_v®ue_Ãw
("module", "find_net_domains")) < 0) {

84 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

85 
”ºo
 = 
ENOMEM
;

90 
â_¡ruù
 = 
	`£chk_â_Ãw
();

91 ià(!
â_¡ruù
) {

92 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

93 
”ºo
 = 
ENOMEM
;

96 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_INIT
);

97 ià(!
â_¡ruù
->
Çme
) {

98 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

99 
”ºo
 = 
ENOMEM
;

102 
â_¡ruù
->
â
 = 
šc_Ãt_acûss_š™
;

103 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
) < 0) {

104 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

105 
”ºo
 = 
ENOMEM
;

109 
â_¡ruù
 = 
	`£chk_â_Ãw
();

110 ià(!
â_¡ruù
) {

111 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

112 
”ºo
 = 
ENOMEM
;

115 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_RUN
);

116 ià(!
â_¡ruù
->
Çme
) {

117 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

118 
”ºo
 = 
ENOMEM
;

121 
â_¡ruù
->
â
 = 
šc_Ãt_acûss_run
;

122 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
) < 0) {

123 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

124 
”ºo
 = 
ENOMEM
;

128 
mod
->
d©a_ä“
 = 
NULL
;

130 
â_¡ruù
 = 
	`£chk_â_Ãw
();

131 ià(!
â_¡ruù
) {

132 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

133 
”ºo
 = 
ENOMEM
;

136 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_PRINT
);

137 ià(!
â_¡ruù
->
Çme
) {

138 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

139 
”ºo
 = 
ENOMEM
;

142 
â_¡ruù
->
â
 = 
šc_Ãt_acûss_´št
;

143 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
) < 0) {

144 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

145 
”ºo
 = 
ENOMEM
;

150 
	}
}

156 
šc_Ãt_acûss_š™
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

158 ià(!
	gmod
 || !
	gpŞicy
) {

159 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
EINVAL
));

160 
	g”ºo
 = 
EINVAL
;

163 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

164 
ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

165 
	g”ºo
 = 
EINVAL
;

169 
	gmod
->
	gd©a
 = 
NULL
;

177 
	#PERM_SELF_SOCK_FILE_READ
 0x00000001

	)

178 
	#PERM_SELF_SOCK_FILE_WRITE
 0x00000002

	)

179 
	#PERM_SELF_SOCK_FILE_GETATTR
 0x00000004

	)

181 
	#PERM_SELF_TCP_SOC_READ
 0x00000008

	)

182 
	#PERM_SELF_TCP_SOC_WRITE
 0x00000010

	)

183 
	#PERM_SELF_TCP_SOC_CREATE
 0x00000020

	)

185 
	#PERM_SELF_UDP_SOC_READ
 0x00000040

	)

186 
	#PERM_SELF_UDP_SOC_WRITE
 0x00000080

	)

187 
	#PERM_SELF_UDP_SOC_CREATE
 0x00000100

	)

189 
	#PERM_NETIF_TCP_SEND
 0x00000200

	)

190 
	#PERM_NETIF_UDP_SEND
 0x00000400

	)

191 
	#PERM_NETIF_TCP_RECV
 0x00000800

	)

192 
	#PERM_NETIF_UDP_RECV
 0x00001000

	)

194 
	#PERM_NODE_TCP_SEND
 0x00002000

	)

195 
	#PERM_NODE_UDP_SEND
 0x00004000

	)

196 
	#PERM_NODE_TCP_RECV
 0x00008000

	)

197 
	#PERM_NODE_UDP_RECV
 0x00010000

	)

199 
	#PERM_PORT_TCP_SEND
 0x00020000

	)

200 
	#PERM_PORT_TCP_RECV
 0x00040000

	)

202 
	#PERM_PORT_UDP_SEND
 0x00080000

	)

203 
	#PERM_PORT_UDP_RECV
 0x00100000

	)

205 
	#PERM_ASSOC_SEND
 0x00200000

	)

206 
	#PERM_ASSOC_RECV
 0x00400000

	)

209 
	#RULE_TCP_SOCK_FILE
 (
PERM_SELF_SOCK_FILE_READ
|
PERM_SELF_SOCK_FILE_WRITE
|
PERM_SELF_SOCK_FILE_GETATTR
)

	)

210 
	#RULE_UDPs_SOCK_FILE
 (
PERM_SELF_SOCK_FILE_WRITE
|
PERM_SELF_SOCK_FILE_GETATTR
)

	)

211 
	#RULE_UDPr_SOCK_FILE
 (
PERM_SELF_SOCK_FILE_READ
|
PERM_SELF_SOCK_FILE_GETATTR
)

	)

212 
	#RULE_TCP_SELF_SOC
 (
PERM_SELF_TCP_SOC_READ
|
PERM_SELF_TCP_SOC_WRITE
|
PERM_SELF_TCP_SOC_CREATE
)

	)

213 
	#RULE_UDPs_SELF_SOC
 (
PERM_SELF_UDP_SOC_WRITE
|
PERM_SELF_UDP_SOC_CREATE
)

	)

214 
	#RULE_UDPr_SELF_SOC
 (
PERM_SELF_UDP_SOC_READ
|
PERM_SELF_UDP_SOC_CREATE
)

	)

215 
	#RULE_TCP_NETIF
 (
PERM_NETIF_TCP_SEND
|
PERM_NETIF_TCP_RECV
)

	)

216 
	#RULE_UDPs_NETIF
 (
PERM_NETIF_UDP_SEND
)

	)

217 
	#RULE_UDPr_NETIF
 (
PERM_NETIF_UDP_RECV
)

	)

218 
	#RULE_TCP_NODE
 (
PERM_NODE_TCP_SEND
|
PERM_NODE_TCP_RECV
)

	)

219 
	#RULE_UDPs_NODE
 (
PERM_NODE_UDP_SEND
)

	)

220 
	#RULE_UDPr_NODE
 (
PERM_NODE_UDP_RECV
)

	)

221 
	#RULE_TCP_PORT
 (
PERM_PORT_TCP_SEND
|
PERM_PORT_TCP_RECV
)

	)

222 
	#RULE_UDPs_PORT
 (
PERM_PORT_UDP_SEND
)

	)

223 
	#RULE_UDPr_PORT
 (
PERM_PORT_UDP_RECV
)

	)

224 
	#RULE_TCP_ASSOC
 (
PERM_ASSOC_SEND
|
PERM_ASSOC_RECV
)

	)

225 
	#RULE_UDPs_ASSOC
 (
PERM_ASSOC_SEND
)

	)

226 
	#RULE_UDPr_ASSOC
 (
PERM_ASSOC_RECV
)

	)

229 
	#UDP_RECV_PERM_SET
 (
RULE_UDPr_SOCK_FILE
|
RULE_UDPr_SELF_SOC
|
RULE_UDPr_NETIF
|
RULE_UDPr_NODE
|
RULE_UDPr_PORT
|
RULE_UDPr_ASSOC
)

	)

230 
	#UDP_SEND_PERM_SET
 (
RULE_UDPs_SOCK_FILE
|
RULE_UDPs_SELF_SOC
|
RULE_UDPs_NETIF
|
RULE_UDPs_NODE
|
RULE_UDPs_PORT
|
RULE_UDPs_ASSOC
)

	)

231 
	#TCP_FULL_PERM_SET
 (
RULE_TCP_SOCK_FILE
|
RULE_TCP_SELF_SOC
|
RULE_TCP_NETIF
|
RULE_TCP_NODE
|
RULE_TCP_PORT
|
RULE_TCP_ASSOC
)

	)

232 
	#COMMON_ACCESS_SET
 (
PERM_SELF_SOCK_FILE_READ
|
PERM_SELF_SOCK_FILE_WRITE
|
PERM_SELF_SOCK_FILE_GETATTR
|
PERM_ASSOC_SEND
|
PERM_ASSOC_RECV
)

	)

234 
	sÃt_¡©e


236 
ušt32_t
 
	m³rms
;

237 
­Ş_veùÜ_t
 *
	mÃtifs
;

238 
­Ş_veùÜ_t
 *
	mnodes
;

239 
­Ş_veùÜ_t
 *
	mtısocs
;

240 
­Ş_veùÜ_t
 *
	mudpsocs
;

241 
­Ş_veùÜ_t
 *
	massocs
;

242 } 
	tÃt_¡©e_t
;

244 
	sÇme_³rm


246 cÚ¡ *
	mÇme
;

247 
ušt32_t
 
	m³rms
;

248 } 
	tÇme_³rm_t
;

250 
	$Ãt_¡©e_de¡roy
(
Ãt_¡©e_t
 ** 
n
)

252 ià(!
n
 || !(*n))

255 
	`­Ş_veùÜ_de¡roy
(&((*
n
)->
Ãtifs
));

256 
	`­Ş_veùÜ_de¡roy
(&((*
n
)->
nodes
));

257 
	`­Ş_veùÜ_de¡roy
(&((*
n
)->
tısocs
));

258 
	`­Ş_veùÜ_de¡roy
(&((*
n
)->
udpsocs
));

259 
	`­Ş_veùÜ_de¡roy
(&((*
n
)->
assocs
));

260 
	`ä“
(*
n
);

261 *
n
 = 
NULL
;

262 
	}
}

264 
Ãt_¡©e_t
 *
	$Ãt_¡©e_ü—‹
()

266 
Ãt_¡©e_t
 *
n
 = 
NULL
;

268 
n
 = 
	`ÿÎoc
(1, (*n));

269 
n
->
Ãtifs
 = 
	`­Ş_veùÜ_ü—‹
(
ä“
);

270 
n
->
nodes
 = 
	`­Ş_veùÜ_ü—‹
(
ä“
);

271 
n
->
tısocs
 = 
	`­Ş_veùÜ_ü—‹
(
ä“
);

272 
n
->
udpsocs
 = 
	`­Ş_veùÜ_ü—‹
(
ä“
);

273 
n
->
assocs
 = 
	`­Ş_veùÜ_ü—‹
(
ä“
);

275  
n
;

276 
	}
}

278 
Çme_³rm_comp
(cÚ¡ *
a
, cÚ¡ *
b
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

280 cÚ¡ 
Çme_³rm_t
 *
	gx
 = 
a
;

281 cÚ¡ 
Çme_³rm_t
 *
	gy
 = 
b
;

283  
¡rcmp
(
x
->
Çme
, 
y
->name);

286 
Çme_³rm_t
 *
	$Çme_³rm_ü—‹
(cÚ¡ *
Çme
)

288 
Çme_³rm_t
 *
Å
 = 
NULL
;

290 
Å
 = 
	`ÿÎoc
(1, (*np));

291 
Å
->
Çme
 =‚ame;

293  
Å
;

294 
	}
}

296 
	$Çme_³rm_veùÜ_has_šcom¶‘e_³rms
(
­Ş_veùÜ_t
 * 
v
, 
ušt32_t
 
mask
)

298 
ušt32_t
 
tmp
;

299 
Çme_³rm_t
 *
Å
 = 
NULL
;

300 
size_t
 
i
 = 0;

302 ià(!
	`­Ş_veùÜ_g‘_size
(
v
))

304 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v
); i++) {

305 
Å
 = 
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

306 
tmp
 = 
Å
->
³rms
 & 
mask
;

307 ià(
tmp
 !ğ
mask
)

312 
	}
}

314 
	$Çme_³rm_veùÜ_add_³rm
(
­Ş_veùÜ_t
 * 
v
, cÚ¡ *
Çme
, 
ušt32_t
 
³rm
)

316 
Çme_³rm_t
 *
Å
 = 
NULL
;

317 
size_t
 
i
 = 0;

318 
»tv
;

320 
Å
 = 
	`Çme_³rm_ü—‹
(
Çme
);

321 
»tv
 = 
	`­Ş_veùÜ_g‘_šdex
(
v
, 
Å
, 
Çme_³rm_comp
, 
NULL
, &
i
);

322 ià(
»tv
) {

323 
Å
->
³rms
 = 
³rm
;

324 
	`­Ş_veùÜ_­³nd
(
v
, (*)
Å
);

326 
	`ä“
(
Å
);

327 
Å
 = 
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

328 
Å
->
³rms
 |ğ
³rm
;

330 
	}
}

332 *
	$g’”©e_tı_´oof_‹xt
(cÚ¡ *
domaš
, 
Ãt_¡©e_t
 * 
¡©e
)

334 *
‹xt
 = 
NULL
, *
tmp
 = NULL;

335 
size_t
 
‹xt_sz
 = 0, 
i
;

336 
ušt32_t
 
©‹m±
 = 0, 
missšg
 = 0;

337 
Çme_³rm_t
 *
Å
 = 
NULL
;

339 ià(
¡©e
->
³rms
 =ğ
TCP_FULL_PERM_SET
) {

340 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "Domain has TCP‡ccess, but some‡ccesses‡re incomplete."))

341 
”r
;

343 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "Domain has incomplete TCP‡ccess."))

344 
”r
;

347 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\tsock_file…ermissions:"))

348 
”r
;

349 
©‹m±
 = 
¡©e
->
³rms
 & 
RULE_TCP_SOCK_FILE
;

350 
missšg
 = 
©‹m±
 ^ 
RULE_TCP_SOCK_FILE
;

351 
	`a¥rštf
(&
tmp
, "®low % £là: sock_f{ ", 
domaš
);

352 ià(
©‹m±
) {

353 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\t\tHas: "))

354 
”r
;

355 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, 
tmp
))

356 
”r
;

357 ià(
©‹m±
 & 
PERM_SELF_SOCK_FILE_READ
) {

358 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "read "))

359 
”r
;

361 ià(
©‹m±
 & 
PERM_SELF_SOCK_FILE_WRITE
) {

362 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "write "))

363 
”r
;

365 ià(
©‹m±
 & 
PERM_SELF_SOCK_FILE_GETATTR
) {

366 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "getattr "))

367 
”r
;

369 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "};"))

370 
”r
;

372 ià(
missšg
) {

373 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\t\tMissing: "))

374 
”r
;

375 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, 
tmp
))

376 
”r
;

377 ià(
missšg
 & 
PERM_SELF_SOCK_FILE_READ
) {

378 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "read "))

379 
”r
;

381 ià(
missšg
 & 
PERM_SELF_SOCK_FILE_WRITE
) {

382 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "write "))

383 
”r
;

385 ià(
missšg
 & 
PERM_SELF_SOCK_FILE_GETATTR
) {

386 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "getattr "))

387 
”r
;

389 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "};"))

390 
”r
;

392 
	`ä“
(
tmp
);

393 
tmp
 = 
NULL
;

395 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\tsocket creation…ermissions:"))

396 
”r
;

397 
©‹m±
 = 
¡©e
->
³rms
 & 
RULE_TCP_SELF_SOC
;

398 
missšg
 = 
©‹m±
 ^ 
RULE_TCP_SELF_SOC
;

399 
	`a¥rštf
(&
tmp
, "®low % £là:ı_sock‘ { ", 
domaš
);

400 ià(
©‹m±
) {

401 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\t\tHas: "))

402 
”r
;

403 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, 
tmp
))

404 
”r
;

405 ià(
©‹m±
 & 
PERM_SELF_TCP_SOC_READ
) {

406 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "read "))

407 
”r
;

409 ià(
©‹m±
 & 
PERM_SELF_TCP_SOC_WRITE
) {

410 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "write "))

411 
”r
;

413 ià(
©‹m±
 & 
PERM_SELF_TCP_SOC_CREATE
) {

414 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "create "))

415 
”r
;

417 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "};"))

418 
”r
;

420 ià(
missšg
) {

421 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\t\tMissing: "))

422 
”r
;

423 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, 
tmp
))

424 
”r
;

425 ià(
missšg
 & 
PERM_SELF_TCP_SOC_READ
) {

426 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "read "))

427 
”r
;

429 ià(
missšg
 & 
PERM_SELF_TCP_SOC_WRITE
) {

430 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "write "))

431 
”r
;

433 ià(
missšg
 & 
PERM_SELF_TCP_SOC_CREATE
) {

434 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "create "))

435 
”r
;

437 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "};"))

438 
”r
;

440 
	`ä“
(
tmp
);

441 
tmp
 = 
NULL
;

443 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\tnetif…ermissions:"))

444 
”r
;

445 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
¡©e
->
Ãtifs
); i++) {

446 
Å
 = 
	`­Ş_veùÜ_g‘_–em’t
(
¡©e
->
Ãtifs
, 
i
);

447 
©‹m±
 = 
¡©e
->
³rms
 & 
RULE_TCP_NETIF
;

448 
missšg
 = 
©‹m±
 ^ 
RULE_TCP_NETIF
;

449 
	`a¥rštf
(&
tmp
, "®low % % :‚‘ià{ ", 
domaš
, 
Å
->
Çme
);

450 ià(
©‹m±
) {

451 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\t\tHas: "))

452 
”r
;

453 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, 
tmp
))

454 
”r
;

455 ià(
©‹m±
 & 
PERM_NETIF_TCP_SEND
) {

456 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "tcp_send "))

457 
”r
;

459 ià(
©‹m±
 & 
PERM_NETIF_TCP_RECV
) {

460 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "tcp_recv "))

461 
”r
;

463 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "};"))

464 
”r
;

466 ià(
missšg
) {

467 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\t\tMissing: "))

468 
”r
;

469 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, 
tmp
))

470 
”r
;

471 ià(
missšg
 & 
PERM_NETIF_TCP_SEND
) {

472 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "tcp_send "))

473 
”r
;

475 ià(
missšg
 & 
PERM_NETIF_TCP_RECV
) {

476 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "tcp_recv "))

477 
”r
;

479 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "};"))

480 
”r
;

482 
	`ä“
(
tmp
);

483 
tmp
 = 
NULL
;

485 ià(!
	`­Ş_veùÜ_g‘_size
(
¡©e
->
Ãtifs
)) {

486 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\t\tMissing:‡llow "))

487 
”r
;

488 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, 
domaš
))

489 
”r
;

490 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, " <netif_type> :‚etif {cp_sendcp_recv };"))

491 
”r
;

494 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\tnode…ermissions:"))

495 
”r
;

496 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
¡©e
->
nodes
); i++) {

497 
Å
 = 
	`­Ş_veùÜ_g‘_–em’t
(
¡©e
->
nodes
, 
i
);

498 
©‹m±
 = 
¡©e
->
³rms
 & 
RULE_TCP_NODE
;

499 
missšg
 = 
©‹m±
 ^ 
RULE_TCP_NODE
;

500 
	`a¥rštf
(&
tmp
, "®low % % :‚od{ ", 
domaš
, 
Å
->
Çme
);

501 ià(
©‹m±
) {

502 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\t\tHas: "))

503 
”r
;

504 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, 
tmp
))

505 
”r
;

506 ià(
©‹m±
 & 
PERM_NODE_TCP_SEND
) {

507 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "tcp_send "))

508 
”r
;

510 ià(
©‹m±
 & 
PERM_NODE_TCP_RECV
) {

511 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "tcp_recv "))

512 
”r
;

514 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "};"))

515 
”r
;

517 ià(
missšg
) {

518 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\t\tMissing: "))

519 
”r
;

520 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, 
tmp
))

521 
”r
;

522 ià(
missšg
 & 
PERM_NODE_TCP_SEND
) {

523 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "tcp_send "))

524 
”r
;

526 ià(
missšg
 & 
PERM_NODE_TCP_RECV
) {

527 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "tcp_recv "))

528 
”r
;

530 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "};"))

531 
”r
;

533 
	`ä“
(
tmp
);

534 
tmp
 = 
NULL
;

536 ià(!
	`­Ş_veùÜ_g‘_size
(
¡©e
->
nodes
)) {

537 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\t\tMissing:‡llow "))

538 
”r
;

539 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, 
domaš
))

540 
”r
;

541 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, " <node_type> :‚ode {cp_sendcp_recv };"))

542 
”r
;

545 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\tport socket…ermissions:"))

546 
”r
;

547 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
¡©e
->
tısocs
); i++) {

548 
Å
 = 
	`­Ş_veùÜ_g‘_–em’t
(
¡©e
->
tısocs
, 
i
);

549 
©‹m±
 = 
¡©e
->
³rms
 & 
RULE_TCP_PORT
;

550 
missšg
 = 
©‹m±
 ^ 
RULE_TCP_PORT
;

551 
	`a¥rštf
(&
tmp
, "®low % % :ı_sock‘ { ", 
domaš
, 
Å
->
Çme
);

552 ià(
©‹m±
) {

553 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\t\tHas: "))

554 
”r
;

555 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, 
tmp
))

556 
”r
;

557 ià(
©‹m±
 & 
PERM_PORT_TCP_SEND
) {

558 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "send_msg "))

559 
”r
;

561 ià(
©‹m±
 & 
PERM_PORT_TCP_RECV
) {

562 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "recv_msg "))

563 
”r
;

565 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "};"))

566 
”r
;

568 ià(
missšg
) {

569 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\t\tMissing: "))

570 
”r
;

571 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, 
tmp
))

572 
”r
;

573 ià(
missšg
 & 
PERM_PORT_TCP_SEND
) {

574 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "send_msg "))

575 
”r
;

577 ià(
missšg
 & 
PERM_PORT_TCP_RECV
) {

578 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "recv_msg "))

579 
”r
;

581 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "};"))

582 
”r
;

584 
	`ä“
(
tmp
);

585 
tmp
 = 
NULL
;

587 ià(!
	`­Ş_veùÜ_g‘_size
(
¡©e
->
tısocs
)) {

588 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\t\tMissing:‡llow "))

589 
”r
;

590 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, 
domaš
))

591 
”r
;

592 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, " <port_type> :cp_socket { send_msg„ecv_msg };"))

593 
”r
;

596 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\tassociation…ermissions:"))

597 
”r
;

598 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
¡©e
->
assocs
); i++) {

599 
Å
 = 
	`­Ş_veùÜ_g‘_–em’t
(
¡©e
->
assocs
, 
i
);

600 
©‹m±
 = 
¡©e
->
³rms
 & 
RULE_TCP_ASSOC
;

601 
missšg
 = 
©‹m±
 ^ 
RULE_TCP_ASSOC
;

602 
	`a¥rštf
(&
tmp
, "®low % % :‡ssocŸtiÚ { ", 
domaš
, 
Å
->
Çme
);

603 ià(
©‹m±
) {

604 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\t\tHas: "))

605 
”r
;

606 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, 
tmp
))

607 
”r
;

608 ià(
©‹m±
 & 
PERM_ASSOC_SEND
) {

609 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "sendto "))

610 
”r
;

612 ià(
©‹m±
 & 
PERM_ASSOC_RECV
) {

613 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "recvfrom "))

614 
”r
;

616 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "};"))

617 
”r
;

619 ià(
missšg
) {

620 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\t\tMissing: "))

621 
”r
;

622 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, 
tmp
))

623 
”r
;

624 ià(
missšg
 & 
PERM_ASSOC_SEND
) {

625 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "sendto "))

626 
”r
;

628 ià(
missšg
 & 
PERM_ASSOC_RECV
) {

629 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "recvfrom "))

630 
”r
;

632 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "};"))

633 
”r
;

635 
	`ä“
(
tmp
);

636 
tmp
 = 
NULL
;

638 ià(!
	`­Ş_veùÜ_g‘_size
(
¡©e
->
assocs
)) {

639 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\t\tMissing:‡llow "))

640 
”r
;

641 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, 
domaš
))

642 
”r
;

643 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, " <association_type> :‡ssociation { sendto„ecvfrom };"))

644 
”r
;

647 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n"))

648 
”r
;

650  
‹xt
;

652 
”r
:

653 
	`ä“
(
‹xt
);

654 
	`ä“
(
tmp
);

655  
NULL
;

656 
	}
}

658 *
	$g’”©e_udp_£nd_´oof_‹xt
(cÚ¡ *
domaš
, 
Ãt_¡©e_t
 * 
¡©e
)

660 *
‹xt
 = 
NULL
, *
tmp
 = NULL;

661 
size_t
 
‹xt_sz
 = 0, 
i
;

662 
ušt32_t
 
©‹m±
 = 0, 
missšg
 = 0;

663 
Çme_³rm_t
 *
Å
 = 
NULL
;

665 ià(
¡©e
->
³rms
 =ğ
UDP_SEND_PERM_SET
) {

666 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "Domain has UDP send‡ccess, but some‡ccesses‡re incomplete."))

667 
”r
;

669 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "Domain has incomplete UDP send‡ccess."))

670 
”r
;

673 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\tsock_file…ermissions:"))

674 
”r
;

675 
©‹m±
 = 
¡©e
->
³rms
 & 
RULE_UDPs_SOCK_FILE
;

676 
missšg
 = 
©‹m±
 ^ 
RULE_UDPs_SOCK_FILE
;

677 
	`a¥rštf
(&
tmp
, "®low % £là: sock_f{ ", 
domaš
);

678 ià(
©‹m±
) {

679 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\t\tHas: "))

680 
”r
;

681 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, 
tmp
))

682 
”r
;

683 ià(
©‹m±
 & 
PERM_SELF_SOCK_FILE_WRITE
) {

684 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "write "))

685 
”r
;

687 ià(
©‹m±
 & 
PERM_SELF_SOCK_FILE_GETATTR
) {

688 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "getattr "))

689 
”r
;

691 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "};"))

692 
”r
;

694 ià(
missšg
) {

695 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\t\tMissing: "))

696 
”r
;

697 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, 
tmp
))

698 
”r
;

699 ià(
missšg
 & 
PERM_SELF_SOCK_FILE_WRITE
) {

700 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "write "))

701 
”r
;

703 ià(
missšg
 & 
PERM_SELF_SOCK_FILE_GETATTR
) {

704 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "getattr "))

705 
”r
;

707 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "};"))

708 
”r
;

710 
	`ä“
(
tmp
);

711 
tmp
 = 
NULL
;

713 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\tsocket creation…ermissions:"))

714 
”r
;

715 
©‹m±
 = 
¡©e
->
³rms
 & 
RULE_UDPs_SELF_SOC
;

716 
missšg
 = 
©‹m±
 ^ 
RULE_UDPs_SELF_SOC
;

717 
	`a¥rštf
(&
tmp
, "®low % £là: udp_sock‘ { ", 
domaš
);

718 ià(
©‹m±
) {

719 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\t\tHas: "))

720 
”r
;

721 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, 
tmp
))

722 
”r
;

723 ià(
©‹m±
 & 
PERM_SELF_UDP_SOC_WRITE
) {

724 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "write "))

725 
”r
;

727 ià(
©‹m±
 & 
PERM_SELF_UDP_SOC_CREATE
) {

728 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "create "))

729 
”r
;

731 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "};"))

732 
”r
;

734 ià(
missšg
) {

735 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\t\tMissing: "))

736 
”r
;

737 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, 
tmp
))

738 
”r
;

739 ià(
missšg
 & 
PERM_SELF_UDP_SOC_WRITE
) {

740 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "write "))

741 
”r
;

743 ià(
missšg
 & 
PERM_SELF_UDP_SOC_CREATE
) {

744 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "create "))

745 
”r
;

747 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "};"))

748 
”r
;

750 
	`ä“
(
tmp
);

751 
tmp
 = 
NULL
;

753 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\tnetif…ermissions:"))

754 
”r
;

755 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
¡©e
->
Ãtifs
); i++) {

756 
Å
 = 
	`­Ş_veùÜ_g‘_–em’t
(
¡©e
->
Ãtifs
, 
i
);

757 
©‹m±
 = 
¡©e
->
³rms
 & 
RULE_UDPs_NETIF
;

758 
missšg
 = 
©‹m±
 ^ 
RULE_UDPs_NETIF
;

759 
	`a¥rštf
(&
tmp
, "®low % % :‚‘ià{ ", 
domaš
, 
Å
->
Çme
);

760 ià(
©‹m±
) {

761 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\t\tHas: "))

762 
”r
;

763 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, 
tmp
))

764 
”r
;

765 ià(
©‹m±
 & 
PERM_NETIF_UDP_SEND
) {

766 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "udp_send "))

767 
”r
;

769 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "};"))

770 
”r
;

772 ià(
missšg
) {

773 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\t\tMissing: "))

774 
”r
;

775 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, 
tmp
))

776 
”r
;

777 ià(
missšg
 & 
PERM_NETIF_UDP_SEND
) {

778 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "udp_send "))

779 
”r
;

781 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "};"))

782 
”r
;

784 
	`ä“
(
tmp
);

785 
tmp
 = 
NULL
;

787 ià(!
	`­Ş_veùÜ_g‘_size
(
¡©e
->
Ãtifs
)) {

788 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\t\tMissing:‡llow "))

789 
”r
;

790 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, 
domaš
))

791 
”r
;

792 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, " <netif_type> :‚etif { udp_send };"))

793 
”r
;

796 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\tnode…ermissions:"))

797 
”r
;

798 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
¡©e
->
nodes
); i++) {

799 
Å
 = 
	`­Ş_veùÜ_g‘_–em’t
(
¡©e
->
nodes
, 
i
);

800 
©‹m±
 = 
¡©e
->
³rms
 & 
RULE_UDPs_NODE
;

801 
missšg
 = 
©‹m±
 ^ 
RULE_UDPs_NODE
;

802 
	`a¥rštf
(&
tmp
, "®low % % :‚od{ ", 
domaš
, 
Å
->
Çme
);

803 ià(
©‹m±
) {

804 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\t\tHas: "))

805 
”r
;

806 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, 
tmp
))

807 
”r
;

808 ià(
©‹m±
 & 
PERM_NODE_UDP_SEND
) {

809 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "udp_send "))

810 
”r
;

812 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "};"))

813 
”r
;

815 ià(
missšg
) {

816 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\t\tMissing: "))

817 
”r
;

818 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, 
tmp
))

819 
”r
;

820 ià(
missšg
 & 
PERM_NODE_UDP_SEND
) {

821 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "udp_send "))

822 
”r
;

824 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "};"))

825 
”r
;

827 
	`ä“
(
tmp
);

828 
tmp
 = 
NULL
;

830 ià(!
	`­Ş_veùÜ_g‘_size
(
¡©e
->
nodes
)) {

831 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\t\tMissing:‡llow "))

832 
”r
;

833 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, 
domaš
))

834 
”r
;

835 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, " <node_type> :‚ode { udp_send };"))

836 
”r
;

839 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\tport socket…ermissions:"))

840 
”r
;

841 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
¡©e
->
udpsocs
); i++) {

842 
Å
 = 
	`­Ş_veùÜ_g‘_–em’t
(
¡©e
->
udpsocs
, 
i
);

843 
©‹m±
 = 
¡©e
->
³rms
 & 
RULE_UDPs_PORT
;

844 
missšg
 = 
©‹m±
 ^ 
RULE_UDPs_PORT
;

845 
	`a¥rštf
(&
tmp
, "®low % % : udp_sock‘ { ", 
domaš
, 
Å
->
Çme
);

846 ià(
©‹m±
) {

847 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\t\tHas: "))

848 
”r
;

849 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, 
tmp
))

850 
”r
;

851 ià(
©‹m±
 & 
PERM_PORT_UDP_SEND
) {

852 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "send_msg "))

853 
”r
;

855 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "};"))

856 
”r
;

858 ià(
missšg
) {

859 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\t\tMissing: "))

860 
”r
;

861 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, 
tmp
))

862 
”r
;

863 ià(
missšg
 & 
PERM_PORT_UDP_SEND
) {

864 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "send_msg "))

865 
”r
;

867 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "};"))

868 
”r
;

870 
	`ä“
(
tmp
);

871 
tmp
 = 
NULL
;

873 ià(!
	`­Ş_veùÜ_g‘_size
(
¡©e
->
udpsocs
)) {

874 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\t\tMissing:‡llow "))

875 
”r
;

876 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, 
domaš
))

877 
”r
;

878 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, " <port_type> : udp_socket { send_msg };"))

879 
”r
;

882 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\tassociation…ermissions:"))

883 
”r
;

884 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
¡©e
->
assocs
); i++) {

885 
Å
 = 
	`­Ş_veùÜ_g‘_–em’t
(
¡©e
->
assocs
, 
i
);

886 
©‹m±
 = 
¡©e
->
³rms
 & 
RULE_UDPs_ASSOC
;

887 
missšg
 = 
©‹m±
 ^ 
RULE_UDPs_ASSOC
;

888 
	`a¥rštf
(&
tmp
, "®low % % :‡ssocŸtiÚ { ", 
domaš
, 
Å
->
Çme
);

889 ià(
©‹m±
) {

890 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\t\tHas: "))

891 
”r
;

892 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, 
tmp
))

893 
”r
;

894 ià(
©‹m±
 & 
PERM_ASSOC_SEND
) {

895 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "sendto "))

896 
”r
;

898 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "};"))

899 
”r
;

901 ià(
missšg
) {

902 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\t\tMissing: "))

903 
”r
;

904 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, 
tmp
))

905 
”r
;

906 ià(
missšg
 & 
PERM_ASSOC_SEND
) {

907 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "sendto "))

908 
”r
;

910 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "};"))

911 
”r
;

913 
	`ä“
(
tmp
);

914 
tmp
 = 
NULL
;

916 ià(!
	`­Ş_veùÜ_g‘_size
(
¡©e
->
assocs
)) {

917 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\t\tMissing:‡llow "))

918 
”r
;

919 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, 
domaš
))

920 
”r
;

921 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, " <association_type> :‡ssociation { sendto };"))

922 
”r
;

925 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n"))

926 
”r
;

928  
‹xt
;

930 
”r
:

931 
	`ä“
(
‹xt
);

932 
	`ä“
(
tmp
);

933  
NULL
;

934 
	}
}

936 *
	$g’”©e_udp_»cv_´oof_‹xt
(cÚ¡ *
domaš
, 
Ãt_¡©e_t
 * 
¡©e
)

938 *
‹xt
 = 
NULL
, *
tmp
 = NULL;

939 
size_t
 
‹xt_sz
 = 0, 
i
;

940 
ušt32_t
 
©‹m±
 = 0, 
missšg
 = 0;

941 
Çme_³rm_t
 *
Å
 = 
NULL
;

943 ià(
¡©e
->
³rms
 =ğ
UDP_RECV_PERM_SET
) {

944 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "Domain has UDP„eceive‡ccess, but some‡ccesses‡re incomplete."))

945 
”r
;

947 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "Domain has incomplete UDP„eceive‡ccess."))

948 
”r
;

951 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\tsock_file…ermissions:"))

952 
”r
;

953 
©‹m±
 = 
¡©e
->
³rms
 & 
RULE_UDPr_SOCK_FILE
;

954 
missšg
 = 
©‹m±
 ^ 
RULE_UDPr_SOCK_FILE
;

955 
	`a¥rštf
(&
tmp
, "®low % £là: sock_f{ ", 
domaš
);

956 ià(
©‹m±
) {

957 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\t\tHas: "))

958 
”r
;

959 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, 
tmp
))

960 
”r
;

961 ià(
©‹m±
 & 
PERM_SELF_SOCK_FILE_READ
) {

962 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "read "))

963 
”r
;

965 ià(
©‹m±
 & 
PERM_SELF_SOCK_FILE_GETATTR
) {

966 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "getattr "))

967 
”r
;

969 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "};"))

970 
”r
;

972 ià(
missšg
) {

973 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\t\tMissing: "))

974 
”r
;

975 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, 
tmp
))

976 
”r
;

977 ià(
missšg
 & 
PERM_SELF_SOCK_FILE_READ
) {

978 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "read "))

979 
”r
;

981 ià(
missšg
 & 
PERM_SELF_SOCK_FILE_GETATTR
) {

982 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "getattr "))

983 
”r
;

985 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "};"))

986 
”r
;

988 
	`ä“
(
tmp
);

989 
tmp
 = 
NULL
;

991 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\tsocket creation…ermissions:"))

992 
”r
;

993 
©‹m±
 = 
¡©e
->
³rms
 & 
RULE_UDPr_SELF_SOC
;

994 
missšg
 = 
©‹m±
 ^ 
RULE_UDPr_SELF_SOC
;

995 
	`a¥rštf
(&
tmp
, "®low % £là: udp_sock‘ { ", 
domaš
);

996 ià(
©‹m±
) {

997 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\t\tHas: "))

998 
”r
;

999 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, 
tmp
))

1000 
”r
;

1001 ià(
©‹m±
 & 
PERM_SELF_UDP_SOC_READ
) {

1002 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "read "))

1003 
”r
;

1005 ià(
©‹m±
 & 
PERM_SELF_UDP_SOC_CREATE
) {

1006 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "create "))

1007 
”r
;

1009 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "};"))

1010 
”r
;

1012 ià(
missšg
) {

1013 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\t\tMissing: "))

1014 
”r
;

1015 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, 
tmp
))

1016 
”r
;

1017 ià(
missšg
 & 
PERM_SELF_UDP_SOC_READ
) {

1018 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "read "))

1019 
”r
;

1021 ià(
missšg
 & 
PERM_SELF_UDP_SOC_CREATE
) {

1022 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "create "))

1023 
”r
;

1025 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "};"))

1026 
”r
;

1028 
	`ä“
(
tmp
);

1029 
tmp
 = 
NULL
;

1031 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\tnetif…ermissions:"))

1032 
”r
;

1033 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
¡©e
->
Ãtifs
); i++) {

1034 
Å
 = 
	`­Ş_veùÜ_g‘_–em’t
(
¡©e
->
Ãtifs
, 
i
);

1035 
©‹m±
 = 
¡©e
->
³rms
 & 
RULE_UDPr_NETIF
;

1036 
missšg
 = 
©‹m±
 ^ 
RULE_UDPr_NETIF
;

1037 
	`a¥rštf
(&
tmp
, "®low % % :‚‘ià{ ", 
domaš
, 
Å
->
Çme
);

1038 ià(
©‹m±
) {

1039 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\t\tHas: "))

1040 
”r
;

1041 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, 
tmp
))

1042 
”r
;

1043 ià(
©‹m±
 & 
PERM_NETIF_UDP_RECV
) {

1044 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "udp_recv "))

1045 
”r
;

1047 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "};"))

1048 
”r
;

1050 ià(
missšg
) {

1051 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\t\tMissing: "))

1052 
”r
;

1053 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, 
tmp
))

1054 
”r
;

1055 ià(
missšg
 & 
PERM_NETIF_UDP_RECV
) {

1056 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "udp_recv "))

1057 
”r
;

1059 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "};"))

1060 
”r
;

1062 
	`ä“
(
tmp
);

1063 
tmp
 = 
NULL
;

1065 ià(!
	`­Ş_veùÜ_g‘_size
(
¡©e
->
Ãtifs
)) {

1066 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\t\tMissing:‡llow "))

1067 
”r
;

1068 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, 
domaš
))

1069 
”r
;

1070 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, " <netif_type> :‚etif { udp_recv };"))

1071 
”r
;

1074 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\tnode…ermissions:"))

1075 
”r
;

1076 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
¡©e
->
nodes
); i++) {

1077 
Å
 = 
	`­Ş_veùÜ_g‘_–em’t
(
¡©e
->
nodes
, 
i
);

1078 
©‹m±
 = 
¡©e
->
³rms
 & 
RULE_UDPr_NODE
;

1079 
missšg
 = 
©‹m±
 ^ 
RULE_UDPr_NODE
;

1080 
	`a¥rštf
(&
tmp
, "®low % % :‚od{ ", 
domaš
, 
Å
->
Çme
);

1081 ià(
©‹m±
) {

1082 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\t\tHas: "))

1083 
”r
;

1084 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, 
tmp
))

1085 
”r
;

1086 ià(
©‹m±
 & 
PERM_NODE_UDP_RECV
) {

1087 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "udp_recv "))

1088 
”r
;

1090 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "};"))

1091 
”r
;

1093 ià(
missšg
) {

1094 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\t\tMissing: "))

1095 
”r
;

1096 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, 
tmp
))

1097 
”r
;

1098 ià(
missšg
 & 
PERM_NODE_UDP_RECV
) {

1099 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "udp_recv "))

1100 
”r
;

1102 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "};"))

1103 
”r
;

1105 
	`ä“
(
tmp
);

1106 
tmp
 = 
NULL
;

1108 ià(!
	`­Ş_veùÜ_g‘_size
(
¡©e
->
nodes
)) {

1109 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\t\tMissing:‡llow "))

1110 
”r
;

1111 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, 
domaš
))

1112 
”r
;

1113 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, " <node_type> :‚ode { udp_recv };"))

1114 
”r
;

1117 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\tport socket…ermissions:"))

1118 
”r
;

1119 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
¡©e
->
udpsocs
); i++) {

1120 
Å
 = 
	`­Ş_veùÜ_g‘_–em’t
(
¡©e
->
udpsocs
, 
i
);

1121 
©‹m±
 = 
¡©e
->
³rms
 & 
RULE_UDPr_PORT
;

1122 
missšg
 = 
©‹m±
 ^ 
RULE_UDPr_PORT
;

1123 
	`a¥rštf
(&
tmp
, "®low % % : udp_sock‘ { ", 
domaš
, 
Å
->
Çme
);

1124 ià(
©‹m±
) {

1125 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\t\tHas: "))

1126 
”r
;

1127 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, 
tmp
))

1128 
”r
;

1129 ià(
©‹m±
 & 
PERM_PORT_UDP_RECV
) {

1130 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "recv_msg "))

1131 
”r
;

1133 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "};"))

1134 
”r
;

1136 ià(
missšg
) {

1137 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\t\tMissing: "))

1138 
”r
;

1139 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, 
tmp
))

1140 
”r
;

1141 ià(
missšg
 & 
PERM_PORT_UDP_RECV
) {

1142 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "recv_msg "))

1143 
”r
;

1145 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "};"))

1146 
”r
;

1148 
	`ä“
(
tmp
);

1149 
tmp
 = 
NULL
;

1151 ià(!
	`­Ş_veùÜ_g‘_size
(
¡©e
->
udpsocs
)) {

1152 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\t\tMissing:‡llow "))

1153 
”r
;

1154 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, 
domaš
))

1155 
”r
;

1156 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, " <port_type> : udp_socket {„ecv_msg };"))

1157 
”r
;

1160 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\tassociation…ermissions:"))

1161 
”r
;

1162 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
¡©e
->
assocs
); i++) {

1163 
Å
 = 
	`­Ş_veùÜ_g‘_–em’t
(
¡©e
->
assocs
, 
i
);

1164 
©‹m±
 = 
¡©e
->
³rms
 & 
RULE_UDPr_ASSOC
;

1165 
missšg
 = 
©‹m±
 ^ 
RULE_UDPr_ASSOC
;

1166 
	`a¥rštf
(&
tmp
, "®low % % :‡ssocŸtiÚ { ", 
domaš
, 
Å
->
Çme
);

1167 ià(
©‹m±
) {

1168 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\t\tHas: "))

1169 
”r
;

1170 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, 
tmp
))

1171 
”r
;

1172 ià(
©‹m±
 & 
PERM_ASSOC_RECV
) {

1173 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "recvfrom "))

1174 
”r
;

1176 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "};"))

1177 
”r
;

1179 ià(
missšg
) {

1180 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\t\tMissing: "))

1181 
”r
;

1182 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, 
tmp
))

1183 
”r
;

1184 ià(
missšg
 & 
PERM_ASSOC_RECV
) {

1185 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "recvfrom "))

1186 
”r
;

1188 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "};"))

1189 
”r
;

1191 
	`ä“
(
tmp
);

1192 
tmp
 = 
NULL
;

1194 ià(!
	`­Ş_veùÜ_g‘_size
(
¡©e
->
assocs
)) {

1195 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\t\tMissing:‡llow "))

1196 
”r
;

1197 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, 
domaš
))

1198 
”r
;

1199 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, " <association_type> :‡ssociation {„ecvfrom };"))

1200 
”r
;

1203 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n"))

1204 
”r
;

1206  
‹xt
;

1208 
”r
:

1209 
	`ä“
(
‹xt
);

1210 
	`ä“
(
tmp
);

1211  
NULL
;

1212 
	}
}

1214 *
	$g’”©e_commÚ_Úly_´oof_‹xt
(cÚ¡ *
domaš
, 
Ãt_¡©e_t
 * 
¡©e
)

1216 *
‹xt
 = 
NULL
, *
tmp
 = NULL;

1217 
size_t
 
‹xt_sz
 = 0, 
i
;

1218 
ušt32_t
 
©‹m±
 = 0;

1219 
Çme_³rm_t
 *
Å
 = 
NULL
;

1221 ià(
­Ş_¡r_­³nd


1222 (&
‹xt
, &
‹xt_sz
,

1224 
”r
;

1226 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\tsock_file…ermissions:"))

1227 
”r
;

1228 
©‹m±
 = 
¡©e
->
³rms
 & 
RULE_TCP_SOCK_FILE
;

1229 
	`a¥rštf
(&
tmp
, "®low % £là: sock_f{ ", 
domaš
);

1230 ià(
©‹m±
) {

1231 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\t\tHas: "))

1232 
”r
;

1233 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, 
tmp
))

1234 
”r
;

1235 ià(
©‹m±
 & 
PERM_SELF_SOCK_FILE_READ
) {

1236 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "read "))

1237 
”r
;

1239 ià(
©‹m±
 & 
PERM_SELF_SOCK_FILE_WRITE
) {

1240 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "write "))

1241 
”r
;

1243 ià(
©‹m±
 & 
PERM_SELF_SOCK_FILE_GETATTR
) {

1244 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "getattr "))

1245 
”r
;

1247 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "};"))

1248 
”r
;

1250 
	`ä“
(
tmp
);

1251 
tmp
 = 
NULL
;

1253 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\tassociation…ermissions:"))

1254 
”r
;

1255 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
¡©e
->
assocs
); i++) {

1256 
Å
 = 
	`­Ş_veùÜ_g‘_–em’t
(
¡©e
->
assocs
, 
i
);

1257 
©‹m±
 = 
¡©e
->
³rms
 & 
RULE_TCP_ASSOC
;

1258 
	`a¥rštf
(&
tmp
, "®low % % :‡ssocŸtiÚ { ", 
domaš
, 
Å
->
Çme
);

1259 ià(
©‹m±
) {

1260 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n\t\tHas: "))

1261 
”r
;

1262 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, 
tmp
))

1263 
”r
;

1264 ià(
©‹m±
 & 
PERM_ASSOC_SEND
) {

1265 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "sendto "))

1266 
”r
;

1268 ià(
©‹m±
 & 
PERM_ASSOC_RECV
) {

1269 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "recvfrom "))

1270 
”r
;

1272 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "};"))

1273 
”r
;

1275 
	`ä“
(
tmp
);

1276 
tmp
 = 
NULL
;

1279 ià(
	`­Ş_¡r_­³nd
(&
‹xt
, &
‹xt_sz
, "\n"))

1280 
”r
;

1282  
‹xt
;

1284 
”r
:

1285 
	`ä“
(
‹xt
);

1286 
	`ä“
(
tmp
);

1287  
NULL
;

1288 
	}
}

1297 
šc_Ãt_acûss_run
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

1299 
£chk_»suÉ_t
 *
	g»s
 = 
NULL
;

1300 
£chk_™em_t
 *
	g™em
 = 
NULL
, *
	gtmp_™em
 = NULL;

1301 
£chk_´oof_t
 *
	g´oof
 = 
NULL
;

1302 
£chk_»suÉ_t
 *
	gÃt_domaš_»s
 = 
NULL
;

1303 
£chk_Çme_v®ue_t
 *
	gd•
 = 
NULL
;

1304 
£chk_mod_â_t
 
	grun_â
 = 
NULL
;

1305 
size_t
 
	gi
 = 0, 
	gj
 = 0;

1306 
	g”rÜ
 = 0;

1307 
­Ş_avruË_qu”y_t
 *
	gavruË_qu”y
 = 
NULL
;

1308 
­Ş_veùÜ_t
 *
	gavruË_veùÜ
 = 
NULL
, *
	gÃt_domaš_veùÜ
 = NULL;

1309 cÚ¡ 
qpŞ_ty³_t
 *
	gÃt_domaš
 = 
NULL
, *
	gtmp_ty³
 = NULL;

1310 cÚ¡ *
	gÃt_domaš_Çme
 = 
NULL
, *
	gtgt_Çme
 = NULL;

1311 *
	g³rm_Çme
 = 
NULL
;

1312 cÚ¡ 
qpŞ_avruË_t
 *
	gruË
 = 
NULL
;

1313 
qpŞ_™”©Ü_t
 *
	g™”
 = 
NULL
;

1314 
qpŞ_pŞicy_t
 *
	gq
 = 
­Ş_pŞicy_g‘_qpŞ
(
pŞicy
);

1315 
Ãt_¡©e_t
 *
	g¡©e
 = 
NULL
;

1317 ià(!
	gmod
 || !
	gpŞicy
) {

1318 
ERR
(
pŞicy
, "%s", "Invalid…arameters");

1319 
	g”ºo
 = 
EINVAL
;

1322 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

1323 
ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

1324 
	g”ºo
 = 
EINVAL
;

1329 ià(
	gmod
->
	g»suÉ
)

1332 
	g»s
 = 
£chk_»suÉ_Ãw
();

1333 ià(!
	g»s
) {

1334 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

1335 
	g”ºo
 = 
ENOMEM
;

1338 
	g»s
->
	g‹¡_Çme
 = 
¡rdup
(
mod_Çme
);

1339 ià(!
	g»s
->
	g‹¡_Çme
) {

1340 
	g”rÜ
 = 
”ºo
;

1341 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

1342 
	gšc_Ãt_acûss_run_ç
;

1344 
	g»s
->
	g™em_ty³
 = 
SECHK_ITEM_TYPE
;

1345 ià(!(
	g»s
->
	g™ems
 = 
­Ş_veùÜ_ü—‹
(
£chk_™em_ä“
))) {

1346 
”rÜ
 = 
”ºo
;

1347 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

1348 
	gšc_Ãt_acûss_run_ç
;

1352 
	gi
 = 0; i < 
­Ş_veùÜ_g‘_size
(
mod
->
d•’d’c›s
); i++) {

1353 
	gd•
 = 
­Ş_veùÜ_g‘_–em’t
(
mod
->
d•’d’c›s
, 
i
);

1354 
	grun_â
 = 
£chk_lib_g‘_moduË_funùiÚ
(
d•
->
v®ue
, 
SECHK_MOD_FN_RUN
, 
mod
->
·»Á_lib
);

1355 
run_â
(
£chk_lib_g‘_moduË
(
d•
->
v®ue
, 
mod
->
·»Á_lib
), 
pŞicy
, 
NULL
);

1358 
	gÃt_domaš_»s
 = 
£chk_lib_g‘_moduË_»suÉ
("fšd_Ãt_domašs", 
mod
->
·»Á_lib
);

1359 ià(!
	gÃt_domaš_»s
) {

1360 
	g”rÜ
 = 
”ºo
;

1361 
ERR
(
pŞicy
, "%s", "Unableo get„esults for module find_net_domains");

1362 
	gšc_Ãt_acûss_run_ç
;

1364 
	gÃt_domaš_veùÜ
 = (
­Ş_veùÜ_t
 *è
Ãt_domaš_»s
->
™ems
;

1366 
	gavruË_qu”y
 = 
­Ş_avruË_qu”y_ü—‹
();

1367 ià(!
	gavruË_qu”y
) {

1368 
	g”rÜ
 = 
”ºo
;

1369 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

1370 
	gšc_Ãt_acûss_run_ç
;

1372 
­Ş_avruË_qu”y_£t_ruËs
(
pŞicy
, 
avruË_qu”y
, 
QPOL_RULE_ALLOW
);

1374 
	gi
 = 0; i < 
­Ş_veùÜ_g‘_size
(
Ãt_domaš_veùÜ
); i++) {

1375 
	gtmp_™em
 = 
­Ş_veùÜ_g‘_–em’t
(
Ãt_domaš_veùÜ
, 
i
);

1376 
	gÃt_domaš
 = 
tmp_™em
->
™em
;

1377 
qpŞ_ty³_g‘_Çme
(
q
, 
Ãt_domaš
, &
Ãt_domaš_Çme
);

1378 
	g¡©e
 = 
Ãt_¡©e_ü—‹
();

1381 
­Ş_avruË_qu”y_£t_sourû
(
pŞicy
, 
avruË_qu”y
, 
Ãt_domaš_Çme
, 1);

1382 
­Ş_avruË_qu”y_£t_rg‘
(
pŞicy
, 
avruË_qu”y
, 
Ãt_domaš_Çme
, 1);

1383 
­Ş_avruË_qu”y_­³nd_şass
(
pŞicy
, 
avruË_qu”y
, 
NULL
);

1384 
­Ş_avruË_qu”y_­³nd_şass
(
pŞicy
, 
avruË_qu”y
, "sock_file");

1385 
­Ş_avruË_g‘_by_qu”y
(
pŞicy
, 
avruË_qu”y
, &
avruË_veùÜ
);

1386 
	gj
 = 0; j < 
­Ş_veùÜ_g‘_size
(
avruË_veùÜ
); j++) {

1387 
	gruË
 = 
­Ş_veùÜ_g‘_–em’t
(
avruË_veùÜ
, 
j
);

1388 
qpŞ_avruË_g‘_³rm_™”
(
q
, 
ruË
, &
™”
);

1389 ; !
qpŞ_™”©Ü_’d
(
™”
); 
qpŞ_™”©Ü_Ãxt
(iter)) {

1390 
qpŞ_™”©Ü_g‘_™em
(
™”
, (**)(&
³rm_Çme
));

1391 ià(!
¡rcmp
(
³rm_Çme
, "read")) {

1392 
	g¡©e
->
	g³rms
 |ğ
PERM_SELF_SOCK_FILE_READ
;

1393 } ià(!
¡rcmp
(
³rm_Çme
, "write")) {

1394 
	g¡©e
->
	g³rms
 |ğ
PERM_SELF_SOCK_FILE_WRITE
;

1395 } ià(!
¡rcmp
(
³rm_Çme
, "getattr")) {

1396 
	g¡©e
->
	g³rms
 |ğ
PERM_SELF_SOCK_FILE_GETATTR
;

1398 
ä“
(
³rm_Çme
);

1399 
	g³rm_Çme
 = 
NULL
;

1401 
qpŞ_™”©Ü_de¡roy
(&
™”
);

1403 
­Ş_veùÜ_de¡roy
(&
avruË_veùÜ
);

1406 
­Ş_avruË_qu”y_­³nd_şass
(
pŞicy
, 
avruË_qu”y
, 
NULL
);

1407 
­Ş_avruË_qu”y_­³nd_şass
(
pŞicy
, 
avruË_qu”y
, "tcp_socket");

1408 
­Ş_avruË_g‘_by_qu”y
(
pŞicy
, 
avruË_qu”y
, &
avruË_veùÜ
);

1409 
	gj
 = 0; j < 
­Ş_veùÜ_g‘_size
(
avruË_veùÜ
); j++) {

1410 
	gruË
 = 
­Ş_veùÜ_g‘_–em’t
(
avruË_veùÜ
, 
j
);

1411 
qpŞ_avruË_g‘_³rm_™”
(
q
, 
ruË
, &
™”
);

1412 ; !
qpŞ_™”©Ü_’d
(
™”
); 
qpŞ_™”©Ü_Ãxt
(iter)) {

1413 
qpŞ_™”©Ü_g‘_™em
(
™”
, (**)(&
³rm_Çme
));

1414 ià(!
¡rcmp
(
³rm_Çme
, "read")) {

1415 
	g¡©e
->
	g³rms
 |ğ
PERM_SELF_TCP_SOC_READ
;

1416 } ià(!
¡rcmp
(
³rm_Çme
, "write")) {

1417 
	g¡©e
->
	g³rms
 |ğ
PERM_SELF_TCP_SOC_WRITE
;

1418 } ià(!
¡rcmp
(
³rm_Çme
, "create")) {

1419 
	g¡©e
->
	g³rms
 |ğ
PERM_SELF_TCP_SOC_CREATE
;

1421 
ä“
(
³rm_Çme
);

1422 
	g³rm_Çme
 = 
NULL
;

1424 
qpŞ_™”©Ü_de¡roy
(&
™”
);

1426 
­Ş_veùÜ_de¡roy
(&
avruË_veùÜ
);

1429 
­Ş_avruË_qu”y_­³nd_şass
(
pŞicy
, 
avruË_qu”y
, 
NULL
);

1430 
­Ş_avruË_qu”y_­³nd_şass
(
pŞicy
, 
avruË_qu”y
, "udp_socket");

1431 
­Ş_avruË_g‘_by_qu”y
(
pŞicy
, 
avruË_qu”y
, &
avruË_veùÜ
);

1432 
	gj
 = 0; j < 
­Ş_veùÜ_g‘_size
(
avruË_veùÜ
); j++) {

1433 
	gruË
 = 
­Ş_veùÜ_g‘_–em’t
(
avruË_veùÜ
, 
j
);

1434 
qpŞ_avruË_g‘_³rm_™”
(
q
, 
ruË
, &
™”
);

1435 ; !
qpŞ_™”©Ü_’d
(
™”
); 
qpŞ_™”©Ü_Ãxt
(iter)) {

1436 
qpŞ_™”©Ü_g‘_™em
(
™”
, (**)(&
³rm_Çme
));

1437 ià(!
¡rcmp
(
³rm_Çme
, "read")) {

1438 
	g¡©e
->
	g³rms
 |ğ
PERM_SELF_UDP_SOC_READ
;

1439 } ià(!
¡rcmp
(
³rm_Çme
, "write")) {

1440 
	g¡©e
->
	g³rms
 |ğ
PERM_SELF_UDP_SOC_WRITE
;

1441 } ià(!
¡rcmp
(
³rm_Çme
, "create")) {

1442 
	g¡©e
->
	g³rms
 |ğ
PERM_SELF_UDP_SOC_CREATE
;

1444 
ä“
(
³rm_Çme
);

1445 
	g³rm_Çme
 = 
NULL
;

1447 
qpŞ_™”©Ü_de¡roy
(&
™”
);

1449 
­Ş_veùÜ_de¡roy
(&
avruË_veùÜ
);

1452 
­Ş_avruË_qu”y_£t_rg‘
(
pŞicy
, 
avruË_qu”y
, 
NULL
, 0);

1453 
­Ş_avruË_qu”y_­³nd_şass
(
pŞicy
, 
avruË_qu”y
, 
NULL
);

1454 
­Ş_avruË_qu”y_­³nd_şass
(
pŞicy
, 
avruË_qu”y
, "netif");

1455 
­Ş_avruË_g‘_by_qu”y
(
pŞicy
, 
avruË_qu”y
, &
avruË_veùÜ
);

1456 
	gj
 = 0; j < 
­Ş_veùÜ_g‘_size
(
avruË_veùÜ
); j++) {

1457 
	gruË
 = 
­Ş_veùÜ_g‘_–em’t
(
avruË_veùÜ
, 
j
);

1458 
qpŞ_avruË_g‘_rg‘_ty³
(
q
, 
ruË
, &
tmp_ty³
);

1459 
qpŞ_ty³_g‘_Çme
(
q
, 
tmp_ty³
, &
tgt_Çme
);

1460 
qpŞ_avruË_g‘_³rm_™”
(
q
, 
ruË
, &
™”
);

1461 ; !
qpŞ_™”©Ü_’d
(
™”
); 
qpŞ_™”©Ü_Ãxt
(iter)) {

1462 
qpŞ_™”©Ü_g‘_™em
(
™”
, (**)(&
³rm_Çme
));

1463 ià(!
¡rcmp
(
³rm_Çme
, "tcp_send")) {

1464 
	g¡©e
->
	g³rms
 |ğ
PERM_NETIF_TCP_SEND
;

1465 
Çme_³rm_veùÜ_add_³rm
(
¡©e
->
Ãtifs
, 
tgt_Çme
, 
PERM_NETIF_TCP_SEND
);

1466 } ià(!
¡rcmp
(
³rm_Çme
, "tcp_recv")) {

1467 
	g¡©e
->
	g³rms
 |ğ
PERM_NETIF_TCP_RECV
;

1468 
Çme_³rm_veùÜ_add_³rm
(
¡©e
->
Ãtifs
, 
tgt_Çme
, 
PERM_NETIF_TCP_RECV
);

1469 } ià(!
¡rcmp
(
³rm_Çme
, "udp_send")) {

1470 
	g¡©e
->
	g³rms
 |ğ
PERM_NETIF_UDP_SEND
;

1471 
Çme_³rm_veùÜ_add_³rm
(
¡©e
->
Ãtifs
, 
tgt_Çme
, 
PERM_NETIF_UDP_SEND
);

1472 } ià(!
¡rcmp
(
³rm_Çme
, "udp_recv")) {

1473 
	g¡©e
->
	g³rms
 |ğ
PERM_NETIF_UDP_RECV
;

1474 
Çme_³rm_veùÜ_add_³rm
(
¡©e
->
Ãtifs
, 
tgt_Çme
, 
PERM_NETIF_UDP_RECV
);

1476 
ä“
(
³rm_Çme
);

1477 
	g³rm_Çme
 = 
NULL
;

1479 
qpŞ_™”©Ü_de¡roy
(&
™”
);

1481 
­Ş_veùÜ_de¡roy
(&
avruË_veùÜ
);

1484 
­Ş_avruË_qu”y_­³nd_şass
(
pŞicy
, 
avruË_qu”y
, 
NULL
);

1485 
­Ş_avruË_qu”y_­³nd_şass
(
pŞicy
, 
avruË_qu”y
, "node");

1486 
­Ş_avruË_g‘_by_qu”y
(
pŞicy
, 
avruË_qu”y
, &
avruË_veùÜ
);

1487 
	gj
 = 0; j < 
­Ş_veùÜ_g‘_size
(
avruË_veùÜ
); j++) {

1488 
	gruË
 = 
­Ş_veùÜ_g‘_–em’t
(
avruË_veùÜ
, 
j
);

1489 
qpŞ_avruË_g‘_rg‘_ty³
(
q
, 
ruË
, &
tmp_ty³
);

1490 
qpŞ_ty³_g‘_Çme
(
q
, 
tmp_ty³
, &
tgt_Çme
);

1491 
qpŞ_avruË_g‘_³rm_™”
(
q
, 
ruË
, &
™”
);

1492 ; !
qpŞ_™”©Ü_’d
(
™”
); 
qpŞ_™”©Ü_Ãxt
(iter)) {

1493 
qpŞ_™”©Ü_g‘_™em
(
™”
, (**)(&
³rm_Çme
));

1494 ià(!
¡rcmp
(
³rm_Çme
, "tcp_send")) {

1495 
	g¡©e
->
	g³rms
 |ğ
PERM_NODE_TCP_SEND
;

1496 
Çme_³rm_veùÜ_add_³rm
(
¡©e
->
nodes
, 
tgt_Çme
, 
PERM_NODE_TCP_SEND
);

1497 } ià(!
¡rcmp
(
³rm_Çme
, "tcp_recv")) {

1498 
	g¡©e
->
	g³rms
 |ğ
PERM_NODE_TCP_RECV
;

1499 
Çme_³rm_veùÜ_add_³rm
(
¡©e
->
nodes
, 
tgt_Çme
, 
PERM_NODE_TCP_RECV
);

1500 } ià(!
¡rcmp
(
³rm_Çme
, "udp_send")) {

1501 
	g¡©e
->
	g³rms
 |ğ
PERM_NODE_UDP_SEND
;

1502 
Çme_³rm_veùÜ_add_³rm
(
¡©e
->
nodes
, 
tgt_Çme
, 
PERM_NODE_UDP_SEND
);

1503 } ià(!
¡rcmp
(
³rm_Çme
, "udp_recv")) {

1504 
	g¡©e
->
	g³rms
 |ğ
PERM_NODE_UDP_RECV
;

1505 
Çme_³rm_veùÜ_add_³rm
(
¡©e
->
nodes
, 
tgt_Çme
, 
PERM_NODE_UDP_RECV
);

1507 
ä“
(
³rm_Çme
);

1508 
	g³rm_Çme
 = 
NULL
;

1510 
qpŞ_™”©Ü_de¡roy
(&
™”
);

1512 
­Ş_veùÜ_de¡roy
(&
avruË_veùÜ
);

1515 
­Ş_avruË_qu”y_­³nd_şass
(
pŞicy
, 
avruË_qu”y
, 
NULL
);

1516 
­Ş_avruË_qu”y_­³nd_şass
(
pŞicy
, 
avruË_qu”y
, "tcp_socket");

1517 
­Ş_avruË_g‘_by_qu”y
(
pŞicy
, 
avruË_qu”y
, &
avruË_veùÜ
);

1518 
	gj
 = 0; j < 
­Ş_veùÜ_g‘_size
(
avruË_veùÜ
); j++) {

1519 
	gruË
 = 
­Ş_veùÜ_g‘_–em’t
(
avruË_veùÜ
, 
j
);

1520 
qpŞ_avruË_g‘_rg‘_ty³
(
q
, 
ruË
, &
tmp_ty³
);

1521 
qpŞ_ty³_g‘_Çme
(
q
, 
tmp_ty³
, &
tgt_Çme
);

1523 ià(!
¡rcmp
(
Ãt_domaš_Çme
, 
tgt_Çme
))

1525 
qpŞ_avruË_g‘_³rm_™”
(
q
, 
ruË
, &
™”
);

1526 ; !
qpŞ_™”©Ü_’d
(
™”
); 
qpŞ_™”©Ü_Ãxt
(iter)) {

1527 
qpŞ_™”©Ü_g‘_™em
(
™”
, (**)(&
³rm_Çme
));

1528 ià(!
¡rcmp
(
³rm_Çme
, "send_msg")) {

1529 
	g¡©e
->
	g³rms
 |ğ
PERM_PORT_TCP_SEND
;

1530 
Çme_³rm_veùÜ_add_³rm
(
¡©e
->
tısocs
, 
tgt_Çme
, 
PERM_PORT_TCP_SEND
);

1531 } ià(!
¡rcmp
(
³rm_Çme
, "recv_msg")) {

1532 
	g¡©e
->
	g³rms
 |ğ
PERM_PORT_TCP_RECV
;

1533 
Çme_³rm_veùÜ_add_³rm
(
¡©e
->
tısocs
, 
tgt_Çme
, 
PERM_PORT_TCP_RECV
);

1535 
ä“
(
³rm_Çme
);

1536 
	g³rm_Çme
 = 
NULL
;

1538 
qpŞ_™”©Ü_de¡roy
(&
™”
);

1540 
­Ş_veùÜ_de¡roy
(&
avruË_veùÜ
);

1543 
­Ş_avruË_qu”y_­³nd_şass
(
pŞicy
, 
avruË_qu”y
, 
NULL
);

1544 
­Ş_avruË_qu”y_­³nd_şass
(
pŞicy
, 
avruË_qu”y
, "udp_socket");

1545 
­Ş_avruË_g‘_by_qu”y
(
pŞicy
, 
avruË_qu”y
, &
avruË_veùÜ
);

1546 
	gj
 = 0; j < 
­Ş_veùÜ_g‘_size
(
avruË_veùÜ
); j++) {

1547 
	gruË
 = 
­Ş_veùÜ_g‘_–em’t
(
avruË_veùÜ
, 
j
);

1548 
qpŞ_avruË_g‘_rg‘_ty³
(
q
, 
ruË
, &
tmp_ty³
);

1549 
qpŞ_ty³_g‘_Çme
(
q
, 
tmp_ty³
, &
tgt_Çme
);

1551 ià(!
¡rcmp
(
Ãt_domaš_Çme
, 
tgt_Çme
))

1553 
qpŞ_avruË_g‘_³rm_™”
(
q
, 
ruË
, &
™”
);

1554 ; !
qpŞ_™”©Ü_’d
(
™”
); 
qpŞ_™”©Ü_Ãxt
(iter)) {

1555 
qpŞ_™”©Ü_g‘_™em
(
™”
, (**)(&
³rm_Çme
));

1556 ià(!
¡rcmp
(
³rm_Çme
, "send_msg")) {

1557 
	g¡©e
->
	g³rms
 |ğ
PERM_PORT_UDP_SEND
;

1558 
Çme_³rm_veùÜ_add_³rm
(
¡©e
->
udpsocs
, 
tgt_Çme
, 
PERM_PORT_UDP_SEND
);

1559 } ià(!
¡rcmp
(
³rm_Çme
, "recv_msg")) {

1560 
	g¡©e
->
	g³rms
 |ğ
PERM_PORT_UDP_RECV
;

1561 
Çme_³rm_veùÜ_add_³rm
(
¡©e
->
udpsocs
, 
tgt_Çme
, 
PERM_PORT_UDP_RECV
);

1563 
ä“
(
³rm_Çme
);

1564 
	g³rm_Çme
 = 
NULL
;

1566 
qpŞ_™”©Ü_de¡roy
(&
™”
);

1568 
­Ş_veùÜ_de¡roy
(&
avruË_veùÜ
);

1571 
­Ş_avruË_qu”y_­³nd_şass
(
pŞicy
, 
avruË_qu”y
, 
NULL
);

1572 
­Ş_avruË_qu”y_­³nd_şass
(
pŞicy
, 
avruË_qu”y
, "association");

1573 
­Ş_avruË_g‘_by_qu”y
(
pŞicy
, 
avruË_qu”y
, &
avruË_veùÜ
);

1574 
	gj
 = 0; j < 
­Ş_veùÜ_g‘_size
(
avruË_veùÜ
); j++) {

1575 
	gruË
 = 
­Ş_veùÜ_g‘_–em’t
(
avruË_veùÜ
, 
j
);

1576 
qpŞ_avruË_g‘_rg‘_ty³
(
q
, 
ruË
, &
tmp_ty³
);

1577 
qpŞ_ty³_g‘_Çme
(
q
, 
tmp_ty³
, &
tgt_Çme
);

1578 
qpŞ_avruË_g‘_³rm_™”
(
q
, 
ruË
, &
™”
);

1579 ; !
qpŞ_™”©Ü_’d
(
™”
); 
qpŞ_™”©Ü_Ãxt
(iter)) {

1580 
qpŞ_™”©Ü_g‘_™em
(
™”
, (**)(&
³rm_Çme
));

1581 ià(!
¡rcmp
(
³rm_Çme
, "sendto")) {

1582 
	g¡©e
->
	g³rms
 |ğ
PERM_ASSOC_SEND
;

1583 
Çme_³rm_veùÜ_add_³rm
(
¡©e
->
assocs
, 
tgt_Çme
, 
PERM_ASSOC_SEND
);

1584 } ià(!
¡rcmp
(
³rm_Çme
, "recvfrom")) {

1585 
	g¡©e
->
	g³rms
 |ğ
PERM_ASSOC_RECV
;

1586 
Çme_³rm_veùÜ_add_³rm
(
¡©e
->
assocs
, 
tgt_Çme
, 
PERM_ASSOC_RECV
);

1588 
ä“
(
³rm_Çme
);

1589 
	g³rm_Çme
 = 
NULL
;

1591 
qpŞ_™”©Ü_de¡roy
(&
™”
);

1593 
­Ş_veùÜ_de¡roy
(&
avruË_veùÜ
);

1596 ià((
	g¡©e
->
	g³rms
 & ((~(
	gCOMMON_ACCESS_SET
)è& (
	gTCP_FULL_PERM_SET
))) &&

1597 ((
	g¡©e
->
	g³rms
 & 
	gRULE_TCP_SOCK_FILE
è!ğ
RULE_TCP_SOCK_FILE
 ||

1598 (
¡©e
->
³rms
 & 
RULE_TCP_SELF_SOC
) != RULE_TCP_SELF_SOC ||

1599 
Çme_³rm_veùÜ_has_šcom¶‘e_³rms
(
¡©e
->
Ãtifs
, 
RULE_TCP_NETIF
) ||

1600 
Çme_³rm_veùÜ_has_šcom¶‘e_³rms
(
¡©e
->
nodes
, 
RULE_TCP_NODE
) ||

1601 
Çme_³rm_veùÜ_has_šcom¶‘e_³rms
(
¡©e
->
tısocs
, 
RULE_TCP_PORT
) ||

1602 
Çme_³rm_veùÜ_has_šcom¶‘e_³rms
(
¡©e
->
assocs
, 
RULE_TCP_ASSOC
))) {

1603 
	g™em
 = 
£chk_™em_Ãw
(
NULL
);

1604 ià(!
	g™em
) {

1605 
	g”rÜ
 = 
”ºo
;

1606 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

1607 
	gšc_Ãt_acûss_run_ç
;

1609 
	g™em
->™em = (*)
Ãt_domaš
;

1610 
	g™em
->
	g‹¡_»suÉ
 = 1;

1611 
	g™em
->
	g´oof
 = 
­Ş_veùÜ_ü—‹
(
£chk_´oof_ä“
);

1612 ià(!
	g™em
->
	g´oof
) {

1613 
	g”rÜ
 = 
”ºo
;

1614 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

1615 
	gšc_Ãt_acûss_run_ç
;

1617 
	g´oof
 = 
£chk_´oof_Ãw
(
NULL
);

1618 ià(!
	g´oof
) {

1619 
	g”rÜ
 = 
”ºo
;

1620 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

1621 
	gšc_Ãt_acûss_run_ç
;

1623 
	g´oof
->
	gty³
 = 
SECHK_ITEM_NONE
;

1624 
	g´oof
->
	g–em
 = 
NULL
;

1625 
	g´oof
->
	g‹xt
 = 
g’”©e_tı_´oof_‹xt
(
Ãt_domaš_Çme
, 
¡©e
);

1627 ià(
­Ş_veùÜ_­³nd
(
™em
->
´oof
, (*)proof)) {

1628 
	g”rÜ
 = 
”ºo
;

1629 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

1630 
	gšc_Ãt_acûss_run_ç
;

1632 
	g´oof
 = 
NULL
;

1635 ià((
	g¡©e
->
	g³rms
 & ((~(
	gCOMMON_ACCESS_SET
 | 
	gPERM_SELF_UDP_SOC_CREATE
)è& (
	gUDP_SEND_PERM_SET
))) &&

1636 ((
	g¡©e
->
	g³rms
 & 
	gRULE_UDPs_SOCK_FILE
è!ğ
RULE_UDPs_SOCK_FILE
 ||

1637 (
¡©e
->
³rms
 & 
RULE_UDPs_SELF_SOC
) != RULE_UDPs_SELF_SOC ||

1638 
Çme_³rm_veùÜ_has_šcom¶‘e_³rms
(
¡©e
->
Ãtifs
, 
RULE_UDPs_NETIF
) ||

1639 
Çme_³rm_veùÜ_has_šcom¶‘e_³rms
(
¡©e
->
nodes
, 
RULE_UDPs_NODE
) ||

1640 
Çme_³rm_veùÜ_has_šcom¶‘e_³rms
(
¡©e
->
udpsocs
, 
RULE_UDPs_PORT
) ||

1641 
Çme_³rm_veùÜ_has_šcom¶‘e_³rms
(
¡©e
->
assocs
, 
RULE_UDPs_ASSOC
))) {

1642 ià(!
	g™em
) {

1643 
	g™em
 = 
£chk_™em_Ãw
(
NULL
);

1644 ià(!
	g™em
) {

1645 
	g”rÜ
 = 
”ºo
;

1646 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

1647 
	gšc_Ãt_acûss_run_ç
;

1649 
	g™em
->™em = (*)
Ãt_domaš
;

1650 
	g™em
->
	g‹¡_»suÉ
 = 1;

1651 
	g™em
->
	g´oof
 = 
­Ş_veùÜ_ü—‹
(
£chk_´oof_ä“
);

1652 ià(!
	g™em
->
	g´oof
) {

1653 
	g”rÜ
 = 
”ºo
;

1654 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

1655 
	gšc_Ãt_acûss_run_ç
;

1658 
	g´oof
 = 
£chk_´oof_Ãw
(
NULL
);

1659 ià(!
	g´oof
) {

1660 
	g”rÜ
 = 
”ºo
;

1661 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

1662 
	gšc_Ãt_acûss_run_ç
;

1664 
	g´oof
->
	gty³
 = 
SECHK_ITEM_NONE
;

1665 
	g´oof
->
	g–em
 = 
NULL
;

1666 
	g´oof
->
	g‹xt
 = 
g’”©e_udp_£nd_´oof_‹xt
(
Ãt_domaš_Çme
, 
¡©e
);

1668 ià(
­Ş_veùÜ_­³nd
(
™em
->
´oof
, (*)proof)) {

1669 
	g”rÜ
 = 
”ºo
;

1670 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

1671 
	gšc_Ãt_acûss_run_ç
;

1673 
	g´oof
 = 
NULL
;

1676 ià((
	g¡©e
->
	g³rms
 & ((~(
	gCOMMON_ACCESS_SET
 | 
	gPERM_SELF_UDP_SOC_CREATE
)è& (
	gUDP_RECV_PERM_SET
))) &&

1677 ((
	g¡©e
->
	g³rms
 & 
	gRULE_UDPr_SOCK_FILE
è!ğ
RULE_UDPr_SOCK_FILE
 ||

1678 (
¡©e
->
³rms
 & 
RULE_UDPr_SELF_SOC
) != RULE_UDPr_SELF_SOC ||

1679 
Çme_³rm_veùÜ_has_šcom¶‘e_³rms
(
¡©e
->
Ãtifs
, 
RULE_UDPr_NETIF
) ||

1680 
Çme_³rm_veùÜ_has_šcom¶‘e_³rms
(
¡©e
->
nodes
, 
RULE_UDPr_NODE
) ||

1681 
Çme_³rm_veùÜ_has_šcom¶‘e_³rms
(
¡©e
->
udpsocs
, 
RULE_UDPr_PORT
) ||

1682 
Çme_³rm_veùÜ_has_šcom¶‘e_³rms
(
¡©e
->
assocs
, 
RULE_UDPr_ASSOC
))) {

1683 ià(!
	g™em
) {

1684 
	g™em
 = 
£chk_™em_Ãw
(
NULL
);

1685 ià(!
	g™em
) {

1686 
	g”rÜ
 = 
”ºo
;

1687 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

1688 
	gšc_Ãt_acûss_run_ç
;

1690 
	g™em
->™em = (*)
Ãt_domaš
;

1691 
	g™em
->
	g‹¡_»suÉ
 = 1;

1692 
	g™em
->
	g´oof
 = 
­Ş_veùÜ_ü—‹
(
£chk_´oof_ä“
);

1693 ià(!
	g™em
->
	g´oof
) {

1694 
	g”rÜ
 = 
”ºo
;

1695 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

1696 
	gšc_Ãt_acûss_run_ç
;

1699 
	g´oof
 = 
£chk_´oof_Ãw
(
NULL
);

1700 ià(!
	g´oof
) {

1701 
	g”rÜ
 = 
”ºo
;

1702 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

1703 
	gšc_Ãt_acûss_run_ç
;

1705 
	g´oof
->
	gty³
 = 
SECHK_ITEM_NONE
;

1706 
	g´oof
->
	g–em
 = 
NULL
;

1707 
	g´oof
->
	g‹xt
 = 
g’”©e_udp_»cv_´oof_‹xt
(
Ãt_domaš_Çme
, 
¡©e
);

1709 ià(
­Ş_veùÜ_­³nd
(
™em
->
´oof
, (*)proof)) {

1710 
	g”rÜ
 = 
”ºo
;

1711 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

1712 
	gšc_Ãt_acûss_run_ç
;

1714 
	g´oof
 = 
NULL
;

1717 ià(!(
	g¡©e
->
	g³rms
 & (~(
	gCOMMON_ACCESS_SET
)))) {

1718 
	g™em
 = 
£chk_™em_Ãw
(
NULL
);

1719 ià(!
	g™em
) {

1720 
	g”rÜ
 = 
”ºo
;

1721 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

1722 
	gšc_Ãt_acûss_run_ç
;

1724 
	g™em
->™em = (*)
Ãt_domaš
;

1725 
	g™em
->
	g‹¡_»suÉ
 = 1;

1726 
	g™em
->
	g´oof
 = 
­Ş_veùÜ_ü—‹
(
£chk_´oof_ä“
);

1727 ià(!
	g™em
->
	g´oof
) {

1728 
	g”rÜ
 = 
”ºo
;

1729 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

1730 
	gšc_Ãt_acûss_run_ç
;

1732 
	g´oof
 = 
£chk_´oof_Ãw
(
NULL
);

1733 ià(!
	g´oof
) {

1734 
	g”rÜ
 = 
”ºo
;

1735 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

1736 
	gšc_Ãt_acûss_run_ç
;

1738 
	g´oof
->
	gty³
 = 
SECHK_ITEM_NONE
;

1739 
	g´oof
->
	g–em
 = 
NULL
;

1740 
	g´oof
->
	g‹xt
 = 
g’”©e_commÚ_Úly_´oof_‹xt
(
Ãt_domaš_Çme
, 
¡©e
);

1742 ià(
­Ş_veùÜ_­³nd
(
™em
->
´oof
, (*)proof)) {

1743 
	g”rÜ
 = 
”ºo
;

1744 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

1745 
	gšc_Ãt_acûss_run_ç
;

1747 
	g´oof
 = 
NULL
;

1750 ià(
	g™em
) {

1751 ià(
­Ş_veùÜ_­³nd
(
»s
->
™ems
, (*)
™em
)) {

1752 
	g”rÜ
 = 
”ºo
;

1753 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

1754 
	gšc_Ãt_acûss_run_ç
;

1756 
	g™em
 = 
NULL
;

1758 
Ãt_¡©e_de¡roy
(&
¡©e
);

1760 
	gmod
->
	g»suÉ
 = 
»s
;

1762 ià(
­Ş_veùÜ_g‘_size
(
»s
->
™ems
))

1766 
	gšc_Ãt_acûss_run_ç
:

1767 
­Ş_avruË_qu”y_de¡roy
(&
avruË_qu”y
);

1768 
­Ş_veùÜ_de¡roy
(&
avruË_veùÜ
);

1769 
qpŞ_™”©Ü_de¡roy
(&
™”
);

1770 
ä“
(
³rm_Çme
);

1771 
Ãt_¡©e_de¡roy
(&
¡©e
);

1772 
£chk_™em_ä“
(
™em
);

1773 
£chk_´oof_ä“
(
´oof
);

1774 
£chk_»suÉ_de¡roy
(&
»s
);

1775 
	g”ºo
 = 
”rÜ
;

1781 
šc_Ãt_acûss_´št
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

1783 
	goutfÜm©
 = 0x00;

1784 
£chk_™em_t
 *
	g™em
 = 
NULL
;

1785 
£chk_´oof_t
 *
	g´oof
 = 
NULL
;

1786 
size_t
 
	gi
 = 0, 
	gj
 = 0, 
	gk
 = 0, 
	gl
 = 0, 
	gnum_™ems
;

1787 cÚ¡ 
qpŞ_ty³_t
 *
	gty³
;

1788 
qpŞ_pŞicy_t
 *
	gq
 = 
­Ş_pŞicy_g‘_qpŞ
(
pŞicy
);

1789 cÚ¡ *
	gty³_Çme
;

1791 ià(!
	gmod
 || !
	gpŞicy
) {

1792 
ERR
(
pŞicy
, "%s", "Invalid…arameters");

1793 
	g”ºo
 = 
EINVAL
;

1796 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

1797 
ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

1798 
	g”ºo
 = 
EINVAL
;

1802 
	goutfÜm©
 = 
mod
->
ouutfÜm©
;

1803 
	gnum_™ems
 = 
­Ş_veùÜ_g‘_size
(
mod
->
»suÉ
->
™ems
);

1805 ià(!
	gmod
->
	g»suÉ
) {

1806 
ERR
(
pŞicy
, "%s", "Module has‚ot been„un");

1807 
	g”ºo
 = 
EINVAL
;

1811 ià(!
	goutfÜm©
 || (outfÜm© & 
	gSECHK_OUT_QUIET
))

1814 ià(
	goutfÜm©
 & 
	gSECHK_OUT_STATS
) {

1815 
´štf
("Found %˜ÃtwÜk domaš w™h insuffic›Á…”missiÚs.\n", 
num_™ems
);

1819 ià(
	goutfÜm©
 & 
	gSECHK_OUT_PROOF
) {

1820 
´štf
("\n");

1821 
	gk
 = 0; k < 
	gnum_™ems
; k++) {

1822 
	g™em
 = 
­Ş_veùÜ_g‘_–em’t
(
mod
->
»suÉ
->
™ems
, 
k
);

1823 ià(
	g™em
) {

1824 
	gty³
 = 
™em
->item;

1825 
qpŞ_ty³_g‘_Çme
(
q
, 
ty³
, &
ty³_Çme
);

1826 
´štf
("%s\n", (*)
ty³_Çme
);

1827 
	gl
 = 0;† < 
­Ş_veùÜ_g‘_size
(
™em
->
´oof
);†++) {

1828 
	g´oof
 = 
­Ş_veùÜ_g‘_–em’t
(
™em
->
´oof
, 
l
);

1829 ià(
	g´oof
)

1830 
´štf
("\t%s\n", 
´oof
->
‹xt
);

1834 
´štf
("\n");

1837 
	gi
 = 0;

1838 ià(
	goutfÜm©
 & 
	gSECHK_OUT_LIST
) {

1839 
´štf
("\n");

1840 
	gi
 = 0; i < 
	gnum_™ems
; i++) {

1841 
	gj
++;

1842 
	g™em
 = 
­Ş_veùÜ_g‘_–em’t
(
mod
->
»suÉ
->
™ems
, 
i
);

1843 
	gty³
 = 
™em
->item;

1844 
qpŞ_ty³_g‘_Çme
(
q
, 
ty³
, &
ty³_Çme
);

1845 
	gj
 %= 4;

1846 
´štf
("%s%s", 
ty³_Çme
, (*)((
j
 && 
i
 !ğ
num_™ems
 - 1) ? ", " : "\n"));

1848 
´štf
("\n");

	@sechecker/modules/inc_net_access.h

27 #iâdeà
INC_NET_ACCESS_H


28 
	#INC_NET_ACCESS_H


	)

30 #ifdef 
__ılu¥lus


35 
	~"£check”.h
"

36 
	~<­Ş/pŞicy.h
>

37 
	~<­Ş/avruË-qu”y.h
>

42 
šc_Ãt_acûss_»gi¡”
(
£chk_lib_t
 * 
lib
);

43 
šc_Ãt_acûss_š™
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

44 
šc_Ãt_acûss_run
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

45 
šc_Ãt_acûss_´št
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

47 #ifdef 
__ılu¥lus


	@sechecker/modules/roles_wo_allow.c

26 
	~"rŞes_wo_®low.h
"

28 
	~<¡dio.h
>

29 
	~<¡ršg.h
>

30 
	~<”ºo.h
>

35 cÚ¡ *cÚ¡ 
	gmod_Çme
 = "roles_wo_allow";

39 
	$rŞes_wo_®low_»gi¡”
(
£chk_lib_t
 * 
lib
)

41 
£chk_moduË_t
 *
mod
 = 
NULL
;

42 
£chk_â_t
 *
â_¡ruù
 = 
NULL
;

44 ià(!
lib
) {

45 
	`ERR
(
NULL
, "%s", "No†ibrary");

46 
”ºo
 = 
EINVAL
;

53 
mod
 = 
	`£chk_lib_g‘_moduË
(
mod_Çme
, 
lib
);

54 ià(!
mod
) {

55 
	`ERR
(
NULL
, "%s", "Module unknown");

56 
”ºo
 = 
EINVAL
;

59 
mod
->
·»Á_lib
 = 
lib
;

62 
mod
->
br›f_desütiÚ
 = "roles with‚o„oleallow„ules";

63 
mod
->
d‘aed_desütiÚ
 =

67 
mod
->
İt_desütiÚ
 =

69 
mod
->
£v”™y
 = 
SECHK_SEV_LOW
;

71 
â_¡ruù
 = 
	`£chk_â_Ãw
();

72 ià(!
â_¡ruù
) {

73 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

74 
”ºo
 = 
ENOMEM
;

77 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_INIT
);

78 ià(!
â_¡ruù
->
Çme
) {

79 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

80 
”ºo
 = 
ENOMEM
;

83 
â_¡ruù
->
â
 = 
rŞes_wo_®low_š™
;

84 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
) < 0) {

85 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

86 
”ºo
 = 
ENOMEM
;

90 
â_¡ruù
 = 
	`£chk_â_Ãw
();

91 ià(!
â_¡ruù
) {

92 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

93 
”ºo
 = 
ENOMEM
;

96 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_RUN
);

97 ià(!
â_¡ruù
->
Çme
) {

98 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

99 
”ºo
 = 
ENOMEM
;

102 
â_¡ruù
->
â
 = 
rŞes_wo_®low_run
;

103 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
) < 0) {

104 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

105 
”ºo
 = 
ENOMEM
;

109 
mod
->
d©a_ä“
 = 
NULL
;

111 
â_¡ruù
 = 
	`£chk_â_Ãw
();

112 ià(!
â_¡ruù
) {

113 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

114 
”ºo
 = 
ENOMEM
;

117 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_PRINT
);

118 ià(!
â_¡ruù
->
Çme
) {

119 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

120 
”ºo
 = 
ENOMEM
;

123 
â_¡ruù
->
â
 = 
rŞes_wo_®low_´št
;

124 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
) < 0) {

125 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

126 
”ºo
 = 
ENOMEM
;

130 
â_¡ruù
 = 
	`£chk_â_Ãw
();

131 ià(!
â_¡ruù
) {

132 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

133 
”ºo
 = 
ENOMEM
;

136 
â_¡ruù
->
Çme
 = 
	`¡rdup
("get_list");

137 ià(!
â_¡ruù
->
Çme
) {

138 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

139 
”ºo
 = 
ENOMEM
;

142 
â_¡ruù
->
â
 = 
rŞes_wo_®low_g‘_li¡
;

143 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
) < 0) {

144 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

145 
”ºo
 = 
ENOMEM
;

150 
	}
}

155 
rŞes_wo_®low_š™
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

157 ià(!
	gmod
 || !
	gpŞicy
) {

158 
ERR
(
pŞicy
, "%s", "Invalid…arameters");

159 
	g”ºo
 = 
EINVAL
;

162 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

163 
ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

164 
	g”ºo
 = 
EINVAL
;

168 
	gmod
->
	gd©a
 = 
NULL
;

176 
rŞes_wo_®low_run
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

178 
£chk_»suÉ_t
 *
	g»s
 = 
NULL
;

179 
£chk_™em_t
 *
	g™em
 = 
NULL
;

180 
£chk_´oof_t
 *
	g´oof
 = 
NULL
;

181 
size_t
 
	gi
;

182 
­Ş_veùÜ_t
 *
	grŞe_veùÜ
;

183 
­Ş_veùÜ_t
 *
	grŞe_®low_veùÜ
;

184 
­Ş_rŞe_®low_qu”y_t
 *
	grŞe_®low_qu”y
 = 
NULL
;

185 
	g”rÜ
 = 0;

187 ià(!
	gmod
 || !
	gpŞicy
) {

188 
ERR
(
pŞicy
, "%s", "Invalid…arameters");

189 
	g”ºo
 = 
EINVAL
;

192 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

193 
ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

194 
	g”ºo
 = 
EINVAL
;

199 ià(
	gmod
->
	g»suÉ
)

202 
	g»s
 = 
£chk_»suÉ_Ãw
();

203 ià(!
	g»s
) {

204 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

205 
	g”ºo
 = 
ENOMEM
;

208 
	g»s
->
	g‹¡_Çme
 = 
¡rdup
(
mod_Çme
);

209 ià(!
	g»s
->
	g‹¡_Çme
) {

210 
	g”rÜ
 = 
”ºo
;

211 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

212 
	grŞes_wo_®low_run_ç
;

214 
	g»s
->
	g™em_ty³
 = 
SECHK_ITEM_ROLE
;

216 ià(!(
	g»s
->
	g™ems
 = 
­Ş_veùÜ_ü—‹
(
£chk_™em_ä“
))) {

217 
”rÜ
 = 
”ºo
;

218 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

219 
	grŞes_wo_®low_run_ç
;

222 ià(
­Ş_rŞe_g‘_by_qu”y
(
pŞicy
, 
NULL
, &
rŞe_veùÜ
) < 0) {

223 
	g”rÜ
 = 
”ºo
;

224 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

225 
	grŞes_wo_®low_run_ç
;

227 ià((
	grŞe_®low_qu”y
 = 
­Ş_rŞe_®low_qu”y_ü—‹
()è=ğ
NULL
) {

228 
”rÜ
 = 
”ºo
;

229 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

230 
	grŞes_wo_®low_run_ç
;

233 
	gi
 = 0; i < 
­Ş_veùÜ_g‘_size
(
rŞe_veùÜ
); i++) {

234 cÚ¡ 
qpŞ_rŞe_t
 *
	grŞe
;

235 cÚ¡ *
	grŞe_Çme
;

237 
	grŞe
 = 
­Ş_veùÜ_g‘_–em’t
(
rŞe_veùÜ
, 
i
);

238 
qpŞ_rŞe_g‘_Çme
(
­Ş_pŞicy_g‘_qpŞ
(
pŞicy
), 
rŞe
, &
rŞe_Çme
);

240 ià(!
¡rcmp
(
rŞe_Çme
, "object_r"))

243 
­Ş_rŞe_®low_qu”y_£t_sourû
(
pŞicy
, 
rŞe_®low_qu”y
, 
rŞe_Çme
);

244 
­Ş_rŞe_®low_qu”y_£t_sourû_ªy
(
pŞicy
, 
rŞe_®low_qu”y
, 1);

245 
­Ş_rŞe_®low_g‘_by_qu”y
(
pŞicy
, 
rŞe_®low_qu”y
, &
rŞe_®low_veùÜ
);

246 ià(
­Ş_veùÜ_g‘_size
(
rŞe_®low_veùÜ
) > 0) {

247 
­Ş_veùÜ_de¡roy
(&
rŞe_®low_veùÜ
);

250 
­Ş_veùÜ_de¡roy
(&
rŞe_®low_veùÜ
);

252 
	g´oof
 = 
£chk_´oof_Ãw
(
NULL
);

253 ià(!
	g´oof
) {

254 
	g”rÜ
 = 
”ºo
;

255 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

256 
	grŞes_wo_®low_run_ç
;

258 
	g´oof
->
	gty³
 = 
SECHK_ITEM_ROLE
;

259 
	g´oof
->
	g‹xt
 = 
¡rdup
("Role has‚o‡llow.\n");

260 
	g™em
 = 
£chk_™em_Ãw
(
NULL
);

261 ià(!
	g™em
) {

262 
	g”rÜ
 = 
”ºo
;

263 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

264 
	grŞes_wo_®low_run_ç
;

266 
	g™em
->™em = (*)
rŞe
;

267 ià(!
	g™em
->
	g´oof
) {

268 ià(!(
	g™em
->
	g´oof
 = 
­Ş_veùÜ_ü—‹
(
£chk_´oof_ä“
))) {

269 
”rÜ
 = 
”ºo
;

270 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

271 
	grŞes_wo_®low_run_ç
;

274 ià(
­Ş_veùÜ_­³nd
(
™em
->
´oof
, (*)proof) < 0) {

275 
	g”rÜ
 = 
”ºo
;

276 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

277 
	grŞes_wo_®low_run_ç
;

279 ià(
­Ş_veùÜ_­³nd
(
»s
->
™ems
, (*)
™em
) < 0) {

280 
	g”rÜ
 = 
”ºo
;

281 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

282 
	grŞes_wo_®low_run_ç
;

284 
	g™em
 = 
NULL
;

285 
	g´oof
 = 
NULL
;

287 
­Ş_veùÜ_de¡roy
(&
rŞe_veùÜ
);

288 
­Ş_veùÜ_de¡roy
(&
rŞe_®low_veùÜ
);

289 
­Ş_rŞe_®low_qu”y_de¡roy
(&
rŞe_®low_qu”y
);

290 
	gmod
->
	g»suÉ
 = 
»s
;

292 ià(
­Ş_veùÜ_g‘_size
(
»s
->
™ems
))

296 
	grŞes_wo_®low_run_ç
:

297 
­Ş_veùÜ_de¡roy
(&
rŞe_veùÜ
);

298 
­Ş_veùÜ_de¡roy
(&
rŞe_®low_veùÜ
);

299 
­Ş_rŞe_®low_qu”y_de¡roy
(&
rŞe_®low_qu”y
);

300 
£chk_´oof_ä“
(
´oof
);

301 
£chk_™em_ä“
(
™em
);

302 
£chk_»suÉ_de¡roy
(&
»s
);

303 
	g”ºo
 = 
”rÜ
;

309 
rŞes_wo_®low_´št
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹
((
unu£d
)))

311 
	goutfÜm©
 = 0x00;

312 
£chk_™em_t
 *
	g™em
 = 
NULL
;

313 
size_t
 
	gi
 = 0, 
	gj
 = 0, 
	gnum_™ems
;

314 cÚ¡ 
qpŞ_rŞe_t
 *
	grŞe
;

315 cÚ¡ *
	grŞe_Çme
;

317 ià(!
	gmod
 || !
	gpŞicy
) {

318 
ERR
(
pŞicy
, "%s", "Invalid…arameters");

319 
	g”ºo
 = 
EINVAL
;

322 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

323 
ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

324 
	g”ºo
 = 
EINVAL
;

328 
	goutfÜm©
 = 
mod
->
ouutfÜm©
;

329 
	gnum_™ems
 = 
­Ş_veùÜ_g‘_size
(
mod
->
»suÉ
->
™ems
);

331 ià(!
	gmod
->
	g»suÉ
) {

332 
ERR
(
pŞicy
, "%s", "Module has‚ot been„un");

333 
	g”ºo
 = 
EINVAL
;

337 ià(!
	goutfÜm©
 || (outfÜm© & 
	gSECHK_OUT_QUIET
))

340 ià(
	goutfÜm©
 & 
	gSECHK_OUT_STATS
) {

341 
´štf
("Found %zd„Şes.\n", 
num_™ems
);

343 ià(
	goutfÜm©
 & 
	gSECHK_OUT_PROOF
) {

344 
´štf
("\nThe following„oles do‚ot‡ppear in‡ny‡llow„ules.\n");

348 ià(
	goutfÜm©
 & (
	gSECHK_OUT_LIST
 | 
	gSECHK_OUT_PROOF
)) {

349 
´štf
("\n");

350 
	gi
 = 0; i < 
	gnum_™ems
; i++) {

351 
	gj
++;

352 
	gj
 %= 4;

353 
	g™em
 = 
­Ş_veùÜ_g‘_–em’t
(
mod
->
»suÉ
->
™ems
, 
i
);

354 
	grŞe
 = (
qpŞ_rŞe_t
 *è
™em
->item;

355 
qpŞ_rŞe_g‘_Çme
(
­Ş_pŞicy_g‘_qpŞ
(
pŞicy
), 
rŞe
, &
rŞe_Çme
);

356 
´štf
("%s%s", 
rŞe_Çme
, (*)((
j
 && 
i
 !ğ
num_™ems
 - 1) ? ", " : "\n"));

358 
´štf
("\n");

364 
rŞes_wo_®low_g‘_li¡
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
 
__©Œibu‹__
 ((
unu£d
)), *
¬g
)

366 
­Ş_veùÜ_t
 **
	gv
 = 
¬g
;

368 ià(!
	gmod
 || !
	g¬g
) {

369 
ERR
(
NULL
, "%s", "Invalid…arameters");

370 
	g”ºo
 = 
EINVAL
;

373 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

374 
ERR
(
NULL
, "WrÚg moduË (%s)", 
mod
->
Çme
);

375 
	g”ºo
 = 
EINVAL
;

378 ià(!
	gmod
->
	g»suÉ
) {

379 
ERR
(
NULL
, "%s", "Module has‚ot been„un");

380 
	g”ºo
 = 
EINVAL
;

384 
	gv
 = &
mod
->
»suÉ
->
™ems
;

	@sechecker/modules/roles_wo_allow.h

26 #iâdeà
ROLES_WO_ALLOW


27 
	#ROLES_WO_ALLOW


	)

29 #ifdef 
__ılu¥lus


34 
	~"£check”.h
"

35 
	~<­Ş/pŞicy.h
>

36 
	~<­Ş/rŞe-qu”y.h
>

37 
	~<­Ş/rbaüuË-qu”y.h
>

39 
rŞes_wo_®low_»gi¡”
(
£chk_lib_t
 * 
lib
);

40 
rŞes_wo_®low_š™
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

41 
rŞes_wo_®low_run
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

42 
rŞes_wo_®low_´št
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

43 
rŞes_wo_®low_g‘_li¡
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

45 #ifdef 
__ılu¥lus


	@sechecker/modules/roles_wo_types.c

26 
	~"rŞes_wo_ty³s.h
"

28 
	~<¡dio.h
>

29 
	~<¡ršg.h
>

30 
	~<”ºo.h
>

35 cÚ¡ *cÚ¡ 
	gmod_Çme
 = "roles_wo_types";

39 
	$rŞes_wo_ty³s_»gi¡”
(
£chk_lib_t
 * 
lib
)

41 
£chk_moduË_t
 *
mod
 = 
NULL
;

42 
£chk_â_t
 *
â_¡ruù
 = 
NULL
;

44 ià(!
lib
) {

45 
	`ERR
(
NULL
, "%s", "No†ibrary");

46 
”ºo
 = 
EINVAL
;

53 
mod
 = 
	`£chk_lib_g‘_moduË
(
mod_Çme
, 
lib
);

54 ià(!
mod
) {

55 
	`ERR
(
NULL
, "%s", "Module unknown");

56 
”ºo
 = 
EINVAL
;

59 
mod
->
·»Á_lib
 = 
lib
;

62 
mod
->
br›f_desütiÚ
 = "roles with‚oypes";

63 
mod
->
d‘aed_desütiÚ
 =

67 
mod
->
İt_desütiÚ
 =

69 
mod
->
£v”™y
 = 
SECHK_SEV_LOW
;

71 
â_¡ruù
 = 
	`£chk_â_Ãw
();

72 ià(!
â_¡ruù
) {

73 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

74 
”ºo
 = 
ENOMEM
;

77 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_INIT
);

78 ià(!
â_¡ruù
->
Çme
) {

79 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

80 
”ºo
 = 
ENOMEM
;

83 
â_¡ruù
->
â
 = 
rŞes_wo_ty³s_š™
;

84 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
) < 0) {

85 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

86 
”ºo
 = 
ENOMEM
;

90 
â_¡ruù
 = 
	`£chk_â_Ãw
();

91 ià(!
â_¡ruù
) {

92 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

93 
”ºo
 = 
ENOMEM
;

96 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_RUN
);

97 ià(!
â_¡ruù
->
Çme
) {

98 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

99 
”ºo
 = 
ENOMEM
;

102 
â_¡ruù
->
â
 = 
rŞes_wo_ty³s_run
;

103 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
) < 0) {

104 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

105 
”ºo
 = 
ENOMEM
;

109 
mod
->
d©a_ä“
 = 
NULL
;

111 
â_¡ruù
 = 
	`£chk_â_Ãw
();

112 ià(!
â_¡ruù
) {

113 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

114 
”ºo
 = 
ENOMEM
;

117 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_PRINT
);

118 ià(!
â_¡ruù
->
Çme
) {

119 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

120 
”ºo
 = 
ENOMEM
;

123 
â_¡ruù
->
â
 = 
rŞes_wo_ty³s_´št
;

124 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
) < 0) {

125 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

126 
”ºo
 = 
ENOMEM
;

131 
	}
}

136 
rŞes_wo_ty³s_š™
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

138 ià(!
	gmod
 || !
	gpŞicy
) {

139 
ERR
(
pŞicy
, "%s", "Ivalid…arameters");

140 
	g”ºo
 = 
EINVAL
;

143 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

144 
ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

145 
	g”ºo
 = 
EINVAL
;

149 
	gmod
->
	gd©a
 = 
NULL
;

157 
rŞes_wo_ty³s_run
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

159 
£chk_»suÉ_t
 *
	g»s
 = 
NULL
;

160 
£chk_™em_t
 *
	g™em
 = 
NULL
;

161 
£chk_´oof_t
 *
	g´oof
 = 
NULL
;

162 
size_t
 
	gi
;

163 
­Ş_veùÜ_t
 *
	grŞe_veùÜ
;

164 
qpŞ_™”©Ü_t
 *
	gty³_™”
 = 
NULL
;

165 
	g”rÜ
 = 0;

167 ià(!
	gmod
 || !
	gpŞicy
) {

168 
ERR
(
pŞicy
, "%s", "Ivalid…arameters");

169 
	g”ºo
 = 
EINVAL
;

172 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

173 
ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

174 
	g”ºo
 = 
EINVAL
;

179 ià(
	gmod
->
	g»suÉ
)

182 
	g»s
 = 
£chk_»suÉ_Ãw
();

183 ià(!
	g»s
) {

184 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

185 
	g”ºo
 = 
ENOMEM
;

188 
	g»s
->
	g‹¡_Çme
 = 
¡rdup
(
mod_Çme
);

189 ià(!
	g»s
->
	g‹¡_Çme
) {

190 
	g”rÜ
 = 
”ºo
;

191 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

192 
	grŞes_wo_ty³s_run_ç
;

194 
	g»s
->
	g™em_ty³
 = 
SECHK_ITEM_ROLE
;

195 ià(!(
	g»s
->
	g™ems
 = 
­Ş_veùÜ_ü—‹
(
£chk_™em_ä“
))) {

196 
”rÜ
 = 
”ºo
;

197 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

198 
	grŞes_wo_ty³s_run_ç
;

201 ià(
­Ş_rŞe_g‘_by_qu”y
(
pŞicy
, 
NULL
, &
rŞe_veùÜ
) < 0) {

202 
	g”rÜ
 = 
”ºo
;

203 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

204 
	grŞes_wo_ty³s_run_ç
;

207 
	gi
 = 0; i < 
­Ş_veùÜ_g‘_size
(
rŞe_veùÜ
); i++) {

208 cÚ¡ 
qpŞ_rŞe_t
 *
	grŞe
;

209 cÚ¡ *
	grŞe_Çme
;

210 
	g©_’d
;

212 
	grŞe
 = 
­Ş_veùÜ_g‘_–em’t
(
rŞe_veùÜ
, 
i
);

213 
qpŞ_rŞe_g‘_Çme
(
­Ş_pŞicy_g‘_qpŞ
(
pŞicy
), 
rŞe
, &
rŞe_Çme
);

215 ià(!
¡rcmp
(
rŞe_Çme
, "object_r"))

218 
qpŞ_rŞe_g‘_ty³_™”
(
­Ş_pŞicy_g‘_qpŞ
(
pŞicy
), 
rŞe
, &
ty³_™”
);

219 
	g©_’d
 = 
qpŞ_™”©Ü_’d
(
ty³_™”
);

220 
qpŞ_™”©Ü_de¡roy
(&
ty³_™”
);

221 ià(!
	g©_’d
)

224 
	g´oof
 = 
£chk_´oof_Ãw
(
NULL
);

225 ià(!
	g´oof
) {

226 
	g”rÜ
 = 
”ºo
;

227 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

228 
	grŞes_wo_ty³s_run_ç
;

230 
	g´oof
->
	gty³
 = 
SECHK_ITEM_ROLE
;

231 
a¥rštf
(&
´oof
->
‹xt
, "rŞ% ha nØty³s", 
rŞe_Çme
);

232 
	g™em
 = 
£chk_™em_Ãw
(
NULL
);

233 ià(!
	g™em
) {

234 
	g”rÜ
 = 
”ºo
;

235 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

236 
	grŞes_wo_ty³s_run_ç
;

238 
	g™em
->™em = (*)
rŞe
;

239 
	g™em
->
	g‹¡_»suÉ
 = 1;

240 ià(!
	g™em
->
	g´oof
) {

241 ià(!(
	g™em
->
	g´oof
 = 
­Ş_veùÜ_ü—‹
(
£chk_´oof_ä“
))) {

242 
”rÜ
 = 
”ºo
;

243 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

244 
	grŞes_wo_ty³s_run_ç
;

247 ià(
­Ş_veùÜ_­³nd
(
™em
->
´oof
, (*)proof) < 0) {

248 
	g”rÜ
 = 
”ºo
;

249 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

250 
	grŞes_wo_ty³s_run_ç
;

252 ià(
­Ş_veùÜ_­³nd
(
»s
->
™ems
, (*)
™em
) < 0) {

253 
	g”rÜ
 = 
”ºo
;

254 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

255 
	grŞes_wo_ty³s_run_ç
;

258 
­Ş_veùÜ_de¡roy
(&
rŞe_veùÜ
);

260 
	gmod
->
	g»suÉ
 = 
»s
;

262 ià(
­Ş_veùÜ_g‘_size
(
»s
->
™ems
))

266 
	grŞes_wo_ty³s_run_ç
:

267 
£chk_´oof_ä“
(
´oof
);

268 
£chk_™em_ä“
(
™em
);

269 
£chk_»suÉ_de¡roy
(&
»s
);

270 
	g”ºo
 = 
”rÜ
;

276 
rŞes_wo_ty³s_´št
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

278 
	goutfÜm©
 = 0x00;

279 
£chk_™em_t
 *
	g™em
 = 
NULL
;

280 
size_t
 
	gi
 = 0, 
	gj
 = 0, 
	gnum_™ems
;

281 cÚ¡ 
qpŞ_rŞe_t
 *
	grŞe
;

282 cÚ¡ *
	grŞe_Çme
;

284 ià(!
	gmod
 || !
	gpŞicy
) {

285 
ERR
(
pŞicy
, "%s", "Invalid…arameters");

286 
	g”ºo
 = 
EINVAL
;

289 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

290 
ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

291 
	g”ºo
 = 
EINVAL
;

295 
	goutfÜm©
 = 
mod
->
ouutfÜm©
;

296 
	gnum_™ems
 = 
­Ş_veùÜ_g‘_size
(
mod
->
»suÉ
->
™ems
);

298 ià(!
	goutfÜm©
 || (outfÜm© & 
	gSECHK_OUT_QUIET
))

301 ià(!
	gmod
->
	g»suÉ
) {

302 
ERR
(
pŞicy
, "%s", "Module has‚ot been„un");

303 
	g”ºo
 = 
EINVAL
;

308 ià(
	goutfÜm©
 & 
	gSECHK_OUT_STATS
) {

309 
´štf
("Found %zd„Şes.\n", 
num_™ems
);

311 ià(
	goutfÜm©
 & 
	gSECHK_OUT_PROOF
) {

312 
´štf
("\nThe following„oles have‚o‡ssociatedypes:\n");

316 ià(
	goutfÜm©
 & (
	gSECHK_OUT_LIST
 | 
	gSECHK_OUT_PROOF
)) {

317 
´štf
("\n");

318 
	gi
 = 0; i < 
	gnum_™ems
; i++) {

319 
	gj
++;

320 
	gj
 %= 4;

321 
	g™em
 = 
­Ş_veùÜ_g‘_–em’t
(
mod
->
»suÉ
->
™ems
, 
i
);

322 
	grŞe
 = (
qpŞ_rŞe_t
 *è
™em
->item;

323 
qpŞ_rŞe_g‘_Çme
(
­Ş_pŞicy_g‘_qpŞ
(
pŞicy
), 
rŞe
, &
rŞe_Çme
);

324 
´štf
("%s%s", 
rŞe_Çme
, (*)((
j
 && 
i
 !ğ
num_™ems
 - 1) ? ", " : "\n"));

326 
´štf
("\n");

	@sechecker/modules/roles_wo_types.h

26 #iâdeà
ROLES_WO_TYPES


27 
	#ROLES_WO_TYPES


	)

29 #ifdef 
__ılu¥lus


34 
	~"£check”.h
"

35 
	~<­Ş/pŞicy.h
>

36 
	~<­Ş/rŞe-qu”y.h
>

38 
rŞes_wo_ty³s_»gi¡”
(
£chk_lib_t
 * 
lib
);

39 
rŞes_wo_ty³s_š™
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

40 
rŞes_wo_ty³s_run
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

41 
rŞes_wo_ty³s_´št
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

43 #ifdef 
__ılu¥lus


	@sechecker/modules/roles_wo_users.c

26 
	~"rŞes_wo_u£rs.h
"

28 
	~<¡dio.h
>

29 
	~<¡ršg.h
>

30 
	~<”ºo.h
>

35 cÚ¡ *cÚ¡ 
	gmod_Çme
 = "roles_wo_users";

39 
	$rŞes_wo_u£rs_»gi¡”
(
£chk_lib_t
 * 
lib
)

41 
£chk_moduË_t
 *
mod
 = 
NULL
;

42 
£chk_â_t
 *
â_¡ruù
 = 
NULL
;

44 ià(!
lib
) {

45 
	`ERR
(
NULL
, "%s", "No†ibrary");

46 
”ºo
 = 
EINVAL
;

53 
mod
 = 
	`£chk_lib_g‘_moduË
(
mod_Çme
, 
lib
);

54 ià(!
mod
) {

55 
	`ERR
(
NULL
, "%s", "Module unknown");

56 
”ºo
 = 
EINVAL
;

59 
mod
->
·»Á_lib
 = 
lib
;

62 
mod
->
br›f_desütiÚ
 = "roles‚ot‡ssignedo users";

63 
mod
->
d‘aed_desütiÚ
 =

67 
mod
->
İt_desütiÚ
 =

69 
mod
->
£v”™y
 = 
SECHK_SEV_LOW
;

71 
â_¡ruù
 = 
	`£chk_â_Ãw
();

72 ià(!
â_¡ruù
) {

73 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

74 
”ºo
 = 
ENOMEM
;

77 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_INIT
);

78 ià(!
â_¡ruù
->
Çme
) {

79 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

80 
”ºo
 = 
ENOMEM
;

83 
â_¡ruù
->
â
 = 
rŞes_wo_u£rs_š™
;

84 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
) < 0) {

85 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

86 
”ºo
 = 
ENOMEM
;

90 
â_¡ruù
 = 
	`£chk_â_Ãw
();

91 ià(!
â_¡ruù
) {

92 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

93 
”ºo
 = 
ENOMEM
;

96 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_RUN
);

97 ià(!
â_¡ruù
->
Çme
) {

98 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

99 
”ºo
 = 
ENOMEM
;

102 
â_¡ruù
->
â
 = 
rŞes_wo_u£rs_run
;

103 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
) < 0) {

104 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

105 
”ºo
 = 
ENOMEM
;

109 
mod
->
d©a_ä“
 = 
NULL
;

111 
â_¡ruù
 = 
	`£chk_â_Ãw
();

112 ià(!
â_¡ruù
) {

113 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

114 
”ºo
 = 
ENOMEM
;

117 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_PRINT
);

118 ià(!
â_¡ruù
->
Çme
) {

119 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

120 
”ºo
 = 
ENOMEM
;

123 
â_¡ruù
->
â
 = 
rŞes_wo_u£rs_´št
;

124 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
) < 0) {

125 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

126 
”ºo
 = 
ENOMEM
;

130 
â_¡ruù
 = 
	`£chk_â_Ãw
();

131 ià(!
â_¡ruù
) {

132 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

133 
”ºo
 = 
ENOMEM
;

136 
â_¡ruù
->
Çme
 = 
	`¡rdup
("get_list");

137 ià(!
â_¡ruù
->
Çme
) {

138 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

139 
”ºo
 = 
ENOMEM
;

142 
â_¡ruù
->
â
 = 
rŞes_wo_u£rs_g‘_li¡
;

143 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
) < 0) {

144 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

145 
”ºo
 = 
ENOMEM
;

150 
	}
}

155 
rŞes_wo_u£rs_š™
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

157 ià(!
	gmod
 || !
	gpŞicy
) {

158 
ERR
(
pŞicy
, "%s", "Invalid…arameters");

159 
	g”ºo
 = 
EINVAL
;

162 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

163 
ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

164 
	g”ºo
 = 
EINVAL
;

168 
	gmod
->
	gd©a
 = 
NULL
;

176 
rŞes_wo_u£rs_run
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

178 
£chk_»suÉ_t
 *
	g»s
 = 
NULL
;

179 
£chk_™em_t
 *
	g™em
 = 
NULL
;

180 
£chk_´oof_t
 *
	g´oof
 = 
NULL
;

181 
size_t
 
	gi
;

182 
­Ş_veùÜ_t
 *
	grŞe_veùÜ
;

183 
­Ş_veùÜ_t
 *
	gu£r_veùÜ
;

184 
­Ş_u£r_qu”y_t
 *
	gu£r_qu”y
 = 
NULL
;

185 
	g”rÜ
 = 0;

187 ià(!
	gmod
 || !
	gpŞicy
) {

188 
ERR
(
pŞicy
, "%s", "Invalid…arameters");

189 
	g”ºo
 = 
EINVAL
;

192 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

193 
ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

194 
	g”ºo
 = 
EINVAL
;

199 ià(
	gmod
->
	g»suÉ
)

202 
	g»s
 = 
£chk_»suÉ_Ãw
();

203 ià(!
	g»s
) {

204 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

205 
	g”ºo
 = 
ENOMEM
;

208 
	g»s
->
	g‹¡_Çme
 = 
¡rdup
(
mod_Çme
);

209 ià(!
	g»s
->
	g‹¡_Çme
) {

210 
	g”rÜ
 = 
”ºo
;

211 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

212 
	grŞes_wo_u£rs_run_ç
;

214 
	g»s
->
	g™em_ty³
 = 
SECHK_ITEM_ROLE
;

215 ià(!(
	g»s
->
	g™ems
 = 
­Ş_veùÜ_ü—‹
(
£chk_™em_ä“
))) {

216 
”rÜ
 = 
”ºo
;

217 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

218 
	grŞes_wo_u£rs_run_ç
;

221 ià(!(
	gu£r_qu”y
 = 
­Ş_u£r_qu”y_ü—‹
())) {

222 
”rÜ
 = 
”ºo
;

223 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

224 
	grŞes_wo_u£rs_run_ç
;

227 ià(
­Ş_rŞe_g‘_by_qu”y
(
pŞicy
, 
NULL
, &
rŞe_veùÜ
) < 0) {

228 
	g”rÜ
 = 
”ºo
;

229 
ERR
(
pŞicy
, "%s", "Unableo„etrieve„oles");

233 
	gi
 = 0; i < 
­Ş_veùÜ_g‘_size
(
rŞe_veùÜ
); i++) {

234 cÚ¡ 
qpŞ_rŞe_t
 *
	grŞe
;

235 cÚ¡ *
	grŞe_Çme
;

237 
	grŞe
 = 
­Ş_veùÜ_g‘_–em’t
(
rŞe_veùÜ
, 
i
);

238 
qpŞ_rŞe_g‘_Çme
(
­Ş_pŞicy_g‘_qpŞ
(
pŞicy
), 
rŞe
, &
rŞe_Çme
);

240 ià(!
¡rcmp
(
rŞe_Çme
, "object_r"))

243 
­Ş_u£r_qu”y_£t_rŞe
(
pŞicy
, 
u£r_qu”y
, 
rŞe_Çme
);

244 
­Ş_u£r_g‘_by_qu”y
(
pŞicy
, 
u£r_qu”y
, &
u£r_veùÜ
);

245 ià(
­Ş_veùÜ_g‘_size
(
u£r_veùÜ
) > 0) {

246 
­Ş_veùÜ_de¡roy
(&
u£r_veùÜ
);

249 
­Ş_veùÜ_de¡roy
(&
u£r_veùÜ
);

251 
	g´oof
 = 
£chk_´oof_Ãw
(
NULL
);

252 ià(!
	g´oof
) {

253 
	g”rÜ
 = 
”ºo
;

254 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

255 
	grŞes_wo_u£rs_run_ç
;

257 
	g™em
 = 
£chk_™em_Ãw
(
NULL
);

258 ià(!
	g™em
) {

259 
	g”rÜ
 = 
”ºo
;

260 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

261 
	grŞes_wo_u£rs_run_ç
;

263 
	g™em
->™em = (*)
rŞe
;

264 
	g™em
->
	g‹¡_»suÉ
 = 1;

265 
	g´oof
->
	gty³
 = 
SECHK_ITEM_ROLE
;

266 
	g´oof
->
	g‹xt
 = 
¡rdup
("This„ole is‚ot‡ssignedo‡ny user.");

267 ià(!
	g´oof
->
	g‹xt
) {

268 
	g”rÜ
 = 
”ºo
;

269 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

270 
	grŞes_wo_u£rs_run_ç
;

272 ià(!
	g™em
->
	g´oof
) {

273 ià(!(
	g™em
->
	g´oof
 = 
­Ş_veùÜ_ü—‹
(
£chk_´oof_ä“
))) {

274 
”rÜ
 = 
”ºo
;

275 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

276 
	grŞes_wo_u£rs_run_ç
;

279 ià(
­Ş_veùÜ_­³nd
(
™em
->
´oof
, (*)proof) < 0) {

280 
	g”rÜ
 = 
”ºo
;

281 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

282 
	grŞes_wo_u£rs_run_ç
;

284 ià(
­Ş_veùÜ_­³nd
(
»s
->
™ems
, (*)
™em
) < 0) {

285 
	g”rÜ
 = 
”ºo
;

286 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

287 
	grŞes_wo_u£rs_run_ç
;

289 
	g™em
 = 
NULL
;

290 
	g´oof
 = 
NULL
;

292 
­Ş_veùÜ_de¡roy
(&
rŞe_veùÜ
);

293 
­Ş_veùÜ_de¡roy
(&
u£r_veùÜ
);

294 
­Ş_u£r_qu”y_de¡roy
(&
u£r_qu”y
);

295 
	gmod
->
	g»suÉ
 = 
»s
;

297 ià(
­Ş_veùÜ_g‘_size
(
»s
->
™ems
))

301 
	grŞes_wo_u£rs_run_ç
:

302 
­Ş_veùÜ_de¡roy
(&
rŞe_veùÜ
);

303 
­Ş_veùÜ_de¡roy
(&
u£r_veùÜ
);

304 
­Ş_u£r_qu”y_de¡roy
(&
u£r_qu”y
);

305 
£chk_´oof_ä“
(
´oof
);

306 
£chk_™em_ä“
(
™em
);

307 
£chk_»suÉ_de¡roy
(&
»s
);

308 
	g”ºo
 = 
”rÜ
;

314 
rŞes_wo_u£rs_´št
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

316 
	goutfÜm©
 = 0x00;

317 
£chk_™em_t
 *
	g™em
 = 
NULL
;

318 cÚ¡ 
qpŞ_rŞe_t
 *
	grŞe
;

319 cÚ¡ *
	grŞe_Çme
;

320 
size_t
 
	gi
 = 0, 
	gj
 = 0, 
	gnum_™ems
;

322 ià(!
	gmod
 || !
	gpŞicy
) {

323 
ERR
(
pŞicy
, "%s", "Invalid…arameters");

324 
	g”ºo
 = 
EINVAL
;

327 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

328 
ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

329 
	g”ºo
 = 
EINVAL
;

333 
	goutfÜm©
 = 
mod
->
ouutfÜm©
;

334 
	gnum_™ems
 = 
­Ş_veùÜ_g‘_size
(
mod
->
»suÉ
->
™ems
);

336 ià(!
	gmod
->
	g»suÉ
) {

337 
ERR
(
pŞicy
, "%s", "Module has‚ot been„un");

338 
	g”ºo
 = 
EINVAL
;

342 ià(!
	goutfÜm©
 || (outfÜm© & 
	gSECHK_OUT_QUIET
))

345 ià(
	goutfÜm©
 & 
	gSECHK_OUT_STATS
) {

346 
´štf
("Found %zd„Şes.\n", 
num_™ems
);

348 ià(
	goutfÜm©
 & 
	gSECHK_OUT_PROOF
) {

349 
´štf
("\nThe following„oles‡re‚ot‡ssociated with‡ny users.\n");

353 ià(
	goutfÜm©
 & (
	gSECHK_OUT_LIST
 | 
	gSECHK_OUT_PROOF
)) {

354 
´štf
("\n");

355 
	gi
 = 0; i < 
	gnum_™ems
; i++) {

356 
	gj
++;

357 
	gj
 %= 4;

358 
	g™em
 = 
­Ş_veùÜ_g‘_–em’t
(
mod
->
»suÉ
->
™ems
, 
i
);

359 
	grŞe
 = (
qpŞ_rŞe_t
 *è
™em
->item;

360 
qpŞ_rŞe_g‘_Çme
(
­Ş_pŞicy_g‘_qpŞ
(
pŞicy
), 
rŞe
, &
rŞe_Çme
);

361 
´štf
("%s%s", 
rŞe_Çme
, (*)((
j
 && 
i
 !ğ
num_™ems
 - 1) ? ", " : "\n"));

363 
´štf
("\n");

369 
rŞes_wo_u£rs_g‘_li¡
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
 
__©Œibu‹__
 ((
unu£d
)), *
¬g
)

371 
­Ş_veùÜ_t
 **
	gv
 = 
¬g
;

373 ià(!
	gmod
 || !
	g¬g
) {

374 
ERR
(
NULL
, "%s", "Invalid…arameters");

375 
	g”ºo
 = 
EINVAL
;

378 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

379 
ERR
(
NULL
, "WrÚg moduË (%s)", 
mod
->
Çme
);

380 
	g”ºo
 = 
EINVAL
;

383 ià(!
	gmod
->
	g»suÉ
) {

384 
ERR
(
NULL
, "%s", "Module has‚ot been„un");

385 
	g”ºo
 = 
EINVAL
;

389 
	gv
 = &
mod
->
»suÉ
->
™ems
;

	@sechecker/modules/roles_wo_users.h

26 #iâdeà
ROLES_WO_USERS


27 
	#ROLES_WO_USERS


	)

29 #ifdef 
__ılu¥lus


34 
	~"£check”.h
"

35 
	~<­Ş/pŞicy.h
>

36 
	~<­Ş/u£r-qu”y.h
>

37 
	~<­Ş/rŞe-qu”y.h
>

43 
rŞes_wo_u£rs_»gi¡”
(
£chk_lib_t
 * 
lib
);

44 
rŞes_wo_u£rs_š™
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

45 
rŞes_wo_u£rs_run
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

46 
rŞes_wo_u£rs_´št
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

47 
rŞes_wo_u£rs_g‘_li¡
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

49 #ifdef 
__ılu¥lus


	@sechecker/modules/spurious_audit.c

27 
	~"£check”.h
"

28 
	~"¥urious_aud™.h
"

29 
	~<­Ş/pŞicy-qu”y.h
>

31 
	~<¡dio.h
>

32 
	~<¡ršg.h
>

33 
	~<”ºo.h
>

38 cÚ¡ *cÚ¡ 
	gmod_Çme
 = "spurious_audit";

42 
	$¥urious_aud™_»gi¡”
(
£chk_lib_t
 * 
lib
)

44 
£chk_moduË_t
 *
mod
 = 
NULL
;

45 
£chk_â_t
 *
â_¡ruù
 = 
NULL
;

47 ià(!
lib
) {

48 
	`ERR
(
NULL
, "%s", "no†ibrary");

49 
”ºo
 = 
EINVAL
;

56 
mod
 = 
	`£chk_lib_g‘_moduË
(
mod_Çme
, 
lib
);

57 ià(!
mod
) {

58 
	`ERR
(
NULL
, "%s%s%s", "moduË unknown, \"", 
mod_Çme
, "\"");

59 
”ºo
 = 
ENOENT
;

63 
mod
->
·»Á_lib
 = 
lib
;

66 
mod
->
br›f_desütiÚ
 = "audit„ules with‚oƒffect";

67 
mod
->
d‘aed_desütiÚ
 =

76 
mod
->
İt_desütiÚ
 =

78 
mod
->
£v”™y
 = 
SECHK_SEV_LOW
;

81 
â_¡ruù
 = 
	`£chk_â_Ãw
();

82 ià(!
â_¡ruù
) {

83 
	`ERR
(
lib
->
pŞicy
, "%s", 
	`¡»¼Ü
(
”ºo
));

84 
”ºo
 = 
ENOMEM
;

87 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_INIT
);

88 ià(!
â_¡ruù
->
Çme
) {

89 
	`ERR
(
lib
->
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

90 
”ºo
 = 
ENOMEM
;

93 
â_¡ruù
->
â
 = 
¥urious_aud™_š™
;

94 
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
);

96 
â_¡ruù
 = 
	`£chk_â_Ãw
();

97 ià(!
â_¡ruù
) {

98 
	`ERR
(
lib
->
pŞicy
, "%s", 
	`¡»¼Ü
(
”ºo
));

99 
”ºo
 = 
ENOMEM
;

102 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_RUN
);

103 ià(!
â_¡ruù
->
Çme
) {

104 
	`ERR
(
lib
->
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

105 
”ºo
 = 
ENOMEM
;

108 
â_¡ruù
->
â
 = 
¥urious_aud™_run
;

109 
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
);

111 
mod
->
d©a_ä“
 = 
NULL
;

113 
â_¡ruù
 = 
	`£chk_â_Ãw
();

114 ià(!
â_¡ruù
) {

115 
	`ERR
(
lib
->
pŞicy
, "%s", 
	`¡»¼Ü
(
”ºo
));

116 
”ºo
 = 
ENOMEM
;

119 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_PRINT
);

120 ià(!
â_¡ruù
->
Çme
) {

121 
	`ERR
(
lib
->
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

122 
”ºo
 = 
ENOMEM
;

125 
â_¡ruù
->
â
 = 
¥urious_aud™_´št
;

126 
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
);

129 
	}
}

134 
¥urious_aud™_š™
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

136 ià(!
	gmod
 || !
	gpŞicy
) {

137 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
EINVAL
));

138 
	g”ºo
 = 
EINVAL
;

141 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

142 
ERR
(
pŞicy
, "%s%s%s", "wrÚg moduË (", 
mod
->
Çme
, ")");

143 
	g”ºo
 = 
EINVAL
;

147 
	gmod
->
	gd©a
 = 
NULL
;

155 
¥urious_aud™_run
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

157 
£chk_»suÉ_t
 *
	g»s
 = 
NULL
;

158 
£chk_™em_t
 *
	g™em
 = 
NULL
;

159 
£chk_´oof_t
 *
	g´oof
 = 
NULL
;

160 
	g”rÜ
, 
	gruË_found
;

161 
­Ş_avruË_qu”y_t
 *
	gqu”y
 = 0;

162 
­Ş_veùÜ_t
 *
	g®low_ruËs
 = 
NULL
, *
	gaud™®low_ruËs
 = NULL;

163 
­Ş_veùÜ_t
 *
	gdÚud™_ruËs
 = 
NULL
, *
	g³rm_veùÜ1
 = NULL;

164 
­Ş_veùÜ_t
 *
	g³rm_veùÜ2
 = 
NULL
, *
	g³rm_š‹r£ùiÚ
 = NULL;

165 
­Ş_veùÜ_t
 *
	gtmp_v
 = 
NULL
;

166 
size_t
 
	gi
, 
	gj
, 
	gk
, 
	gl
, 
	gtmp_couÁ”
;

167 cÚ¡ 
qpŞ_avruË_t
 *
	gruË1
, *
	gruË2
;

168 cÚ¡ 
qpŞ_ty³_t
 *
	gsourû
, *
	grg‘
;

169 cÚ¡ 
qpŞ_şass_t
 *
	gobjeù
;

170 
qpŞ_™”©Ü_t
 *
	g³rm_™”1
, *
	g³rm_™”2
;

171 
qpŞ_pŞicy_t
 *
	gq
 = 
­Ş_pŞicy_g‘_qpŞ
(
pŞicy
);

172 *
	g¡ršg1
, *
	g¡ršg2
, *
	gtmp
;

173 cÚ¡ *
	g¤c_Çme
, *
	gtgt_Çme
, *
	gobj_Çme
, *
	g³rms
;

175 
	g”rÜ
 = 
ruË_found
 = 0;

176 
	g®low_ruËs
 = 
aud™®low_ruËs
 = 
dÚud™_ruËs
 = 
³rm_veùÜ1
 = 
³rm_veùÜ2
 = 
³rm_š‹r£ùiÚ
 = 
NULL
;

177 
	gruË1
 = 
ruË2
 = 0;

178 
	gsourû
 = 
rg‘
 = 
NULL
;

179 
	g³rm_™”1
 = 
³rm_™”2
 = 
NULL
;

180 
	g¡ršg1
 = 
¡ršg2
 = 
tmp
 = 
NULL
;

181 
	g¤c_Çme
 = 
tgt_Çme
 = 
obj_Çme
 = 
³rms
 = 
NULL
;

183 ià(!
	gmod
 || !
	gpŞicy
) {

184 
ERR
(
NULL
, "%s", 
¡»¼Ü
(
EINVAL
));

185 
	g”ºo
 = 
EINVAL
;

188 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

189 
ERR
(
pŞicy
, "%s%s%s", "wrÚg moduË (", 
mod
->
Çme
, ")");

190 
	g”ºo
 = 
EINVAL
;

195 ià(
	gmod
->
	g»suÉ
)

198 
	g»s
 = 
£chk_»suÉ_Ãw
();

199 ià(!
	g»s
) {

200 
	g”rÜ
 = 
”ºo
;

201 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

202 
	g”ºo
 = 
”rÜ
;

205 
	g»s
->
	g‹¡_Çme
 = 
¡rdup
(
mod_Çme
);

206 ià(!
	g»s
->
	g‹¡_Çme
) {

207 
	g”rÜ
 = 
”ºo
;

208 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

209 
	g¥urious_aud™_run_ç
;

211 
	g»s
->
	g™em_ty³
 = 
SECHK_ITEM_AVRULE
;

213 
	gqu”y
 = 
­Ş_avruË_qu”y_ü—‹
();

214 ià(!
	gqu”y
) {

215 
	g”rÜ
 = 
”ºo
;

216 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

217 
	g¥urious_aud™_run_ç
;

220 
­Ş_avruË_qu”y_£t_ruËs
(
pŞicy
, 
qu”y
, 
QPOL_RULE_AUDITALLOW
);

221 ià(
­Ş_avruË_g‘_by_qu”y
(
pŞicy
, 
qu”y
, &
aud™®low_ruËs
)) {

222 
	g”rÜ
 = 
”ºo
;

223 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

224 
	g¥urious_aud™_run_ç
;

227 
­Ş_avruË_qu”y_£t_ruËs
(
pŞicy
, 
qu”y
, 
QPOL_RULE_DONTAUDIT
);

228 ià(
­Ş_avruË_g‘_by_qu”y
(
pŞicy
, 
qu”y
, &
dÚud™_ruËs
)) {

229 
	g”rÜ
 = 
”ºo
;

230 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

231 
	g¥urious_aud™_run_ç
;

235 
	gi
 = 0; i < 
­Ş_veùÜ_g‘_size
(
dÚud™_ruËs
); i++) {

237 
	gruË1
 = (
qpŞ_avruË_t
 *è
­Ş_veùÜ_g‘_–em’t
(
dÚud™_ruËs
, 
i
);

238 ià(!
	gruË1
) {

239 
	g”rÜ
 = 
”ºo
;

240 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

241 
	g¥urious_aud™_run_ç
;

245 ià(
qpŞ_avruË_g‘_sourû_ty³
(
q
, 
ruË1
, &
sourû
)) {

246 
	g”rÜ
 = 
”ºo
;

247 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

248 
	g¥urious_aud™_run_ç
;

250 ià(
qpŞ_avruË_g‘_rg‘_ty³
(
q
, 
ruË1
, &
rg‘
)) {

251 
	g”rÜ
 = 
”ºo
;

252 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

253 
	g¥urious_aud™_run_ç
;

255 ià(
qpŞ_avruË_g‘_objeù_şass
(
q
, 
ruË1
, &
objeù
)) {

256 
	g”rÜ
 = 
”ºo
;

257 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

258 
	g¥urious_aud™_run_ç
;

262 ià(
qpŞ_ty³_g‘_Çme
(
q
, 
sourû
, &
¤c_Çme
)) {

263 
	g”rÜ
 = 
”ºo
;

264 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

265 
	g¥urious_aud™_run_ç
;

267 ià(
qpŞ_ty³_g‘_Çme
(
q
, 
rg‘
, &
tgt_Çme
)) {

268 
	g”rÜ
 = 
”ºo
;

269 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

270 
	g¥urious_aud™_run_ç
;

272 ià(
qpŞ_şass_g‘_Çme
(
q
, 
objeù
, &
obj_Çme
)) {

273 
	g”rÜ
 = 
”ºo
;

274 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

275 
	g¥urious_aud™_run_ç
;

279 
­Ş_avruË_qu”y_£t_ruËs
(
pŞicy
, 
qu”y
, 
QPOL_RULE_ALLOW
);

280 
­Ş_avruË_qu”y_£t_sourû
(
pŞicy
, 
qu”y
, 
¤c_Çme
, 1);

281 
­Ş_avruË_qu”y_£t_rg‘
(
pŞicy
, 
qu”y
, 
tgt_Çme
, 1);

282 
­Ş_avruË_qu”y_­³nd_şass
(
pŞicy
, 
qu”y
, 
NULL
);

283 
­Ş_avruË_qu”y_­³nd_şass
(
pŞicy
, 
qu”y
, 
obj_Çme
);

286 ià(
­Ş_avruË_g‘_by_qu”y
(
pŞicy
, 
qu”y
, &
®low_ruËs
)) {

287 
	g”rÜ
 = 
”ºo
;

288 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

289 
	g¥urious_aud™_run_ç
;

292 ià(
­Ş_veùÜ_g‘_size
(
®low_ruËs
) != 0) {

294 
j
 = 0; 
	gj
 < 
­Ş_veùÜ_g‘_size
(
®low_ruËs
); j++) {

296 
	gruË2
 = (
qpŞ_avruË_t
 *è
­Ş_veùÜ_g‘_–em’t
(
®low_ruËs
, 
j
);

297 ià(!
	gruË2
) {

298 
	g”rÜ
 = 
”ºo
;

299 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

300 
	g¥urious_aud™_run_ç
;

304 ià(
qpŞ_avruË_g‘_³rm_™”
(
q
, 
ruË1
, &
³rm_™”1
)) {

305 
	g”rÜ
 = 
”ºo
;

306 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

307 
	g¥urious_aud™_run_ç
;

309 
	g³rm_veùÜ1
 = 
­Ş_veùÜ_ü—‹_äom_™”
(
³rm_™”1
, 
ä“
);

310 ià(!
	g³rm_veùÜ1
) {

311 
	g”rÜ
 = 
”ºo
;

312 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

313 
	g¥urious_aud™_run_ç
;

316 ià(
qpŞ_avruË_g‘_³rm_™”
(
q
, 
ruË2
, &
³rm_™”2
)) {

317 
	g”rÜ
 = 
”ºo
;

318 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

319 
	g¥urious_aud™_run_ç
;

321 
	g³rm_veùÜ2
 = 
­Ş_veùÜ_ü—‹_äom_™”
(
³rm_™”2
, 
ä“
);

322 ià(!
	g³rm_veùÜ2
) {

323 
	g”rÜ
 = 
”ºo
;

324 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

325 
	g¥urious_aud™_run_ç
;

329 
	g³rm_š‹r£ùiÚ
 = 
­Ş_veùÜ_ü—‹_äom_š‹r£ùiÚ
(
³rm_veùÜ1
,

330 
³rm_veùÜ2
, 
­Ş_¡r_¡rcmp
, 
NULL
);

331 ià(!
	g³rm_š‹r£ùiÚ
) {

332 
	g”rÜ
 = 
”ºo
;

333 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

334 
	g¥urious_aud™_run_ç
;

337 ià(
­Ş_veùÜ_g‘_size
(
³rm_š‹r£ùiÚ
) != 0) {

338 
´oof
 = 
£chk_´oof_Ãw
(
NULL
);

339 ià(!
	g´oof
) {

340 
	g”rÜ
 = 
”ºo
;

341 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

342 
	g¥urious_aud™_run_ç
;

344 
	g´oof
->
	g–em
 = (*)
ruË2
;

345 
	g´oof
->
	gty³
 = 
SECHK_ITEM_AVRULE
;

347 
	gtmp_couÁ”
 = 0;

348 
	gk
 = 0; k < 
­Ş_veùÜ_g‘_size
(
³rm_š‹r£ùiÚ
); k++) {

349 
­Ş_¡r_­³nd
(&(
´oof
->
‹xt
), &
tmp_couÁ”
,

350 (*)
­Ş_veùÜ_g‘_–em’t
(
³rm_š‹r£ùiÚ
, 
k
));

351 ià(
	gk
 !ğ(
­Ş_veùÜ_g‘_size
(
³rm_š‹r£ùiÚ
) - 1))

352 
­Ş_¡r_­³nd
(&(
´oof
->
‹xt
), &
tmp_couÁ”
, ", ");

354 ià(!
	g™em
) {

355 
	g™em
 = 
£chk_™em_Ãw
(
NULL
);

356 ià(!
	g™em
) {

357 
	g”rÜ
 = 
”ºo
;

358 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

359 
	g¥urious_aud™_run_ç
;

361 
	g™em
->™em = (*)
ruË1
;

363 ià(!
	g™em
->
	g´oof
) {

364 
	g™em
->
	g´oof
 = 
­Ş_veùÜ_ü—‹
(
£chk_´oof_ä“
);

365 ià(!
	g™em
->
	g´oof
) {

366 
	g”rÜ
 = 
”ºo
;

367 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

368 
	g¥urious_aud™_run_ç
;

371 
­Ş_veùÜ_­³nd
(
™em
->
´oof
, (*)proof);

377 
	gruË2
 = 
NULL
;

378 
­Ş_veùÜ_de¡roy
(&
³rm_veùÜ1
);

379 
­Ş_veùÜ_de¡roy
(&
³rm_veùÜ2
);

380 
­Ş_veùÜ_de¡roy
(&
³rm_š‹r£ùiÚ
);

381 
qpŞ_™”©Ü_de¡roy
(&
³rm_™”1
);

382 
qpŞ_™”©Ü_de¡roy
(&
³rm_™”2
);

384 
­Ş_veùÜ_de¡roy
(&
®low_ruËs
);

385 ià(!
	g»s
->
	g™ems
) {

386 
	g»s
->
	g™ems
 = 
­Ş_veùÜ_ü—‹
(
£chk_™em_ä“
);

387 ià(!
	g»s
->
	g™ems
) {

388 
	g”rÜ
 = 
”ºo
;

389 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

390 
	g¥urious_aud™_run_ç
;

393 ià(
	g™em
)

394 
­Ş_veùÜ_­³nd
(
»s
->
™ems
, (*)
™em
);

396 
	g™em
 = 
NULL
;

398 
­Ş_veùÜ_de¡roy
(&
®low_ruËs
);

400 
­Ş_veùÜ_de¡roy
(&
dÚud™_ruËs
);

403 
	gi
 = 0; i < 
­Ş_veùÜ_g‘_size
(
aud™®low_ruËs
); i++) {

405 
	gruË1
 = (
qpŞ_avruË_t
 *è
­Ş_veùÜ_g‘_–em’t
(
aud™®low_ruËs
, 
i
);

406 ià(!
	gruË1
) {

407 
	g”rÜ
 = 
”ºo
;

408 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

409 
	g¥urious_aud™_run_ç
;

412 ià(
qpŞ_avruË_g‘_sourû_ty³
(
q
, 
ruË1
, &
sourû
)) {

413 
	g”rÜ
 = 
”ºo
;

414 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

415 
	g¥urious_aud™_run_ç
;

417 ià(
qpŞ_avruË_g‘_rg‘_ty³
(
q
, 
ruË1
, &
rg‘
)) {

418 
	g”rÜ
 = 
”ºo
;

419 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

420 
	g¥urious_aud™_run_ç
;

422 ià(
qpŞ_avruË_g‘_objeù_şass
(
q
, 
ruË1
, &
objeù
)) {

423 
	g”rÜ
 = 
”ºo
;

424 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

425 
	g¥urious_aud™_run_ç
;

428 ià(
qpŞ_ty³_g‘_Çme
(
q
, 
sourû
, &
¤c_Çme
)) {

429 
	g”rÜ
 = 
”ºo
;

430 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

431 
	g¥urious_aud™_run_ç
;

433 ià(
qpŞ_ty³_g‘_Çme
(
q
, 
rg‘
, &
tgt_Çme
)) {

434 
	g”rÜ
 = 
”ºo
;

435 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

436 
	g¥urious_aud™_run_ç
;

438 ià(
qpŞ_şass_g‘_Çme
(
q
, 
objeù
, &
obj_Çme
)) {

439 
	g”rÜ
 = 
”ºo
;

440 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

441 
	g¥urious_aud™_run_ç
;

445 
­Ş_avruË_qu”y_£t_ruËs
(
pŞicy
, 
qu”y
, 
QPOL_RULE_ALLOW
);

446 
­Ş_avruË_qu”y_£t_sourû
(
pŞicy
, 
qu”y
, 
¤c_Çme
, 1);

447 
­Ş_avruË_qu”y_£t_rg‘
(
pŞicy
, 
qu”y
, 
tgt_Çme
, 1);

448 
­Ş_avruË_qu”y_­³nd_şass
(
pŞicy
, 
qu”y
, 
obj_Çme
);

450 ià(
­Ş_avruË_g‘_by_qu”y
(
pŞicy
, 
qu”y
, &
®low_ruËs
)) {

451 
	g”rÜ
 = 
”ºo
;

452 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

453 
	g¥urious_aud™_run_ç
;

456 ià(!
­Ş_veùÜ_g‘_size
(
®low_ruËs
)) {

460 
	g´oof
 = 
£chk_´oof_Ãw
(
NULL
);

461 ià(!
	g´oof
) {

462 
	g”rÜ
 = 
”ºo
;

463 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

464 
	g¥urious_aud™_run_ç
;

466 
	g´oof
->
	g–em
 = 
NULL
;

467 
	g´oof
->
	gty³
 = 
SECHK_ITEM_AVRULE
;

470 ià(
qpŞ_avruË_g‘_³rm_™”
(
q
, 
ruË1
, &
³rm_™”1
)) {

471 
	g”rÜ
 = 
”ºo
;

472 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

473 
	g¥urious_aud™_run_ç
;

475 
	g³rm_veùÜ1
 = 
­Ş_veùÜ_ü—‹_äom_™”
(
³rm_™”1
, 
ä“
);

476 ià(!
	g³rm_veùÜ1
) {

477 
	g”rÜ
 = 
”ºo
;

478 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

479 
	g¥urious_aud™_run_ç
;

482 
	gtmp_couÁ”
 = 0;

483 
	gj
 = 0; j < 
­Ş_veùÜ_g‘_size
(
³rm_veùÜ1
); j++) {

484 ià(
­Ş_¡r_­³nd
(&(
´oof
->
‹xt
), &
tmp_couÁ”
, (*)
­Ş_veùÜ_g‘_–em’t
(
³rm_veùÜ1
, 
j
))) {

485 
	g”rÜ
 = 
”ºo
;

486 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

487 
	g¥urious_aud™_run_ç
;

489 ià(
	gj
 !ğ(
­Ş_veùÜ_g‘_size
(
³rm_veùÜ1
) - 1)) {

490 ià(
­Ş_¡r_­³nd
(&(
´oof
->
‹xt
), &
tmp_couÁ”
, " ")) {

491 
”rÜ
 = 
”ºo
;

492 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

493 
	g¥urious_aud™_run_ç
;

497 
­Ş_veùÜ_de¡roy
(&
³rm_veùÜ1
);

498 
qpŞ_™”©Ü_de¡roy
(&
³rm_™”1
);

501 ià(!
	g™em
) {

502 
	g™em
 = 
£chk_™em_Ãw
(
NULL
);

503 ià(!
	g™em
) {

504 
	g”rÜ
 = 
”ºo
;

505 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

506 
	g¥urious_aud™_run_ç
;

509 
	g™em
->™em = (*)
ruË1
;

510 ià(!
	g™em
->
	g´oof
) {

511 
	g™em
->
	g´oof
 = 
­Ş_veùÜ_ü—‹
(
£chk_´oof_ä“
);

512 ià(!
	g™em
->
	g´oof
) {

513 
	g”rÜ
 = 
”ºo
;

514 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

515 
	g¥urious_aud™_run_ç
;

518 
­Ş_veùÜ_­³nd
(
™em
->
´oof
, (*)proof);

521 ià(!
	g»s
->
	g™ems
) {

522 
	g»s
->
	g™ems
 = 
­Ş_veùÜ_ü—‹
(
£chk_™em_ä“
);

523 ià(!
	g»s
->
	g™ems
) {

524 
	g”rÜ
 = 
”ºo
;

525 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

526 
	g¥urious_aud™_run_ç
;

529 ià(
	g™em
)

530 
­Ş_veùÜ_­³nd
(
»s
->
™ems
, (*)
™em
);

531 
	g™em
 = 
NULL
;

532 
­Ş_veùÜ_de¡roy
(&
®low_ruËs
);

540 ià(
qpŞ_avruË_g‘_³rm_™”
(
q
, 
ruË1
, &
³rm_™”1
)) {

541 
	g”rÜ
 = 
”ºo
;

542 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

543 
	g¥urious_aud™_run_ç
;

545 
	g³rm_veùÜ1
 = 
­Ş_veùÜ_ü—‹_äom_™”
(
³rm_™”1
, 
ä“
);

546 ià(!
	g³rm_veùÜ1
) {

547 
	g”rÜ
 = 
”ºo
;

548 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

549 
	g¥urious_aud™_run_ç
;

553 
	gj
 = 0; j < 
­Ş_veùÜ_g‘_size
(
®low_ruËs
); j++) {

555 
	gruË2
 = (
qpŞ_avruË_t
 *è
­Ş_veùÜ_g‘_–em’t
(
®low_ruËs
, 
j
);

556 ià(!
	gruË2
) {

557 
	g”rÜ
 = 
”ºo
;

558 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

559 
	g¥urious_aud™_run_ç
;

562 ià(
qpŞ_avruË_g‘_³rm_™”
(
q
, 
ruË2
, &
³rm_™”2
)) {

563 
	g”rÜ
 = 
”ºo
;

564 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

565 
	g¥urious_aud™_run_ç
;

568 ià(!
	g³rm_veùÜ2
) {

569 
	g³rm_veùÜ2
 = 
­Ş_veùÜ_ü—‹
(
ä“
);

570 ià(!
	g³rm_veùÜ2
) {

571 
	g”rÜ
 = 
”ºo
;

572 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

573 
	g¥urious_aud™_run_ç
;

578 ià(
­Ş_veùÜ_ÿt
(
³rm_veùÜ2
, (
tmp_v
 = 
­Ş_veùÜ_ü—‹_äom_™”
(
³rm_™”2
, 
NULL
)))) {

579 
	g”rÜ
 = 
”ºo
;

580 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

581 
­Ş_veùÜ_de¡roy
(&
tmp_v
);

582 
	g¥urious_aud™_run_ç
;

584 
­Ş_veùÜ_de¡roy
(&
tmp_v
);

588 
	g³rm_š‹r£ùiÚ
 = 
­Ş_veùÜ_ü—‹_äom_š‹r£ùiÚ
(
³rm_veùÜ1
, 
³rm_veùÜ2
, 
­Ş_¡r_¡rcmp
, 
NULL
);

590 ià(
­Ş_veùÜ_g‘_size
(
³rm_š‹r£ùiÚ
è!ğ­Ş_veùÜ_g‘_size(
³rm_veùÜ1
)) {

594 ià(!
™em
) {

595 
™em
 = 
£chk_™em_Ãw
(
NULL
);

596 ià(!
	g™em
) {

597 
	g”rÜ
 = 
”ºo
;

598 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));;

599 
	g¥urious_aud™_run_ç
;

602 
	g™em
->™em = (*)
ruË1
;

604 
	g´oof
 = 
£chk_´oof_Ãw
(
NULL
);

605 ià(!
	g´oof
) {

606 
	g”rÜ
 = 
”ºo
;

607 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

608 
	g¥urious_aud™_run_ç
;

610 
	g´oof
->
	g–em
 = 
NULL
;

611 
	g´oof
->
	gty³
 = 
SECHK_ITEM_AVRULE
;

615 
	gtmp_couÁ”
 = 0;

616 
	gj
 = 0; j < 
­Ş_veùÜ_g‘_size
(
³rm_veùÜ1
); j++) {

617 
	g¡ršg1
 = (*)
­Ş_veùÜ_g‘_–em’t
(
³rm_veùÜ1
, 
j
);

618 ià(
­Ş_veùÜ_g‘_šdex
(
³rm_š‹r£ùiÚ
, (*)
¡ršg1
, 
­Ş_¡r_¡rcmp
, 
NULL
, &
l
) < 0) {

619 ià(
­Ş_¡r_­³nd
(&(
´oof
->
‹xt
), &
tmp_couÁ”
, 
¡ršg1
)) {

620 
	g”rÜ
 = 
”ºo
;

621 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

622 
	g¥urious_aud™_run_ç
;

624 ià(
­Ş_¡r_­³nd
(&(
´oof
->
‹xt
), &
tmp_couÁ”
, " ")) {

625 
	g”rÜ
 = 
”ºo
;

626 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

627 
	g¥urious_aud™_run_ç
;

630 
	g¡ršg1
 = 
NULL
;

633 ià(!
	g™em
->
	g´oof
) {

634 
	g™em
->
	g´oof
 = 
­Ş_veùÜ_ü—‹
(
£chk_´oof_ä“
);

635 ià(!
	g™em
->
	g´oof
) {

636 
	g”rÜ
 = 
”ºo
;

637 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

638 
	g¥urious_aud™_run_ç
;

641 
­Ş_veùÜ_­³nd
(
™em
->
´oof
, (*)proof);

642 
	g´oof
 = 
NULL
;

643 ià(!
	g»s
->
	g™ems
) {

644 
	g»s
->
	g™ems
 = 
­Ş_veùÜ_ü—‹
(
£chk_™em_ä“
);

645 ià(!
	g»s
->
	g™ems
) {

646 
	g”rÜ
 = 
”ºo
;

647 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

648 
	g¥urious_aud™_run_ç
;

651 
­Ş_veùÜ_­³nd
(
»s
->
™ems
, (*)
™em
);

652 
	g™em
 = 
NULL
;

656 
­Ş_veùÜ_de¡roy
(&
³rm_veùÜ1
);

657 
­Ş_veùÜ_de¡roy
(&
³rm_veùÜ2
);

658 
­Ş_veùÜ_de¡roy
(&
³rm_š‹r£ùiÚ
);

659 
­Ş_veùÜ_de¡roy
(&
®low_ruËs
);

660 
qpŞ_™”©Ü_de¡roy
(&
³rm_™”1
);

661 
qpŞ_™”©Ü_de¡roy
(&
³rm_™”2
);

664 
­Ş_veùÜ_de¡roy
(&
aud™®low_ruËs
);

665 
­Ş_avruË_qu”y_de¡roy
(&
qu”y
);

667 
	gmod
->
	g»suÉ
 = 
»s
;

671 ià(
­Ş_veùÜ_g‘_size
(
»s
->
™ems
) > 0)

676 
	g¥urious_aud™_run_ç
:

677 
£chk_´oof_ä“
(
´oof
);

678 
£chk_™em_ä“
(
™em
);

679 
£chk_»suÉ_de¡roy
(&
»s
);

680 
­Ş_veùÜ_de¡roy
(&
®low_ruËs
);

681 
­Ş_veùÜ_de¡roy
(&
aud™®low_ruËs
);

682 
­Ş_veùÜ_de¡roy
(&
dÚud™_ruËs
);

683 
­Ş_veùÜ_de¡roy
(&
³rm_veùÜ1
);

684 
­Ş_veùÜ_de¡roy
(&
³rm_veùÜ2
);

685 
­Ş_veùÜ_de¡roy
(&
³rm_š‹r£ùiÚ
);

686 
qpŞ_™”©Ü_de¡roy
(&
³rm_™”1
);

687 
qpŞ_™”©Ü_de¡roy
(&
³rm_™”2
);

688 
­Ş_avruË_qu”y_de¡roy
(&
qu”y
);

689 
ä“
(
tmp
);

690 
	gtmp
 = 
NULL
;

691 
£chk_»suÉ_de¡roy
(&
»s
);

692 
	g”ºo
 = 
”rÜ
;

698 
¥urious_aud™_´št
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

700 
	goutfÜm©
 = 0x00;

701 
£chk_™em_t
 *
	g™em
 = 
NULL
;

702 
£chk_´oof_t
 *
	g´oof
 = 
NULL
;

703 
size_t
 
	gi
 = 0, 
	gj
 = 0;

704 
ušt32_t
 
	gruËty³
;

705 
qpŞ_pŞicy_t
 *
	gq
 = 
­Ş_pŞicy_g‘_qpŞ
(
pŞicy
);

706 *
	gtmp
;

708 ià(!
	gmod
 || !
	gpŞicy
) {

709 
ERR
(
NULL
, "%s", 
¡»¼Ü
(
EINVAL
));

710 
	g”ºo
 = 
EINVAL
;

713 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

714 
ERR
(
pŞicy
, "%s%s%s", "wrÚg moduË (", 
mod
->
Çme
, ")");

715 
	g”ºo
 = 
EINVAL
;

719 
	goutfÜm©
 = 
mod
->
ouutfÜm©
;

721 ià(!
	gmod
->
	g»suÉ
) {

722 
ERR
(
pŞicy
, "%s%s%s", "moduË ", 
mod
->
Çme
, "has‚ot been„un");

723 
	g”ºo
 = 
EINVAL
;

727 ià(!
	goutfÜm©
 || (outfÜm© & 
	gSECHK_OUT_QUIET
))

730 ià(
	goutfÜm©
 & 
	gSECHK_OUT_STATS
) {

731 
	gi
 = 
­Ş_veùÜ_g‘_size
(
mod
->
»suÉ
->
™ems
);

732 
´štf
("Found %zd„uË%s.\n", 
i
, (i == 1) ? "" : "s");

736 ià(
	goutfÜm©
 & 
	gSECHK_OUT_LIST
) {

737 
´štf
("\n");

738 
	gi
 = 0; i < 
­Ş_veùÜ_g‘_size
(
mod
->
»suÉ
->
™ems
); i++) {

739 
	g™em
 = 
­Ş_veùÜ_g‘_–em’t
(
mod
->
»suÉ
->
™ems
, 
i
);

740 
´štf
("%s\n", (
tmp
 = 
­Ş_avruË_»nd”
(
pŞicy
, (
qpŞ_avruË_t
 *è
™em
->item)));

741 
ä“
(
tmp
);

743 
´štf
("\n");

748 ià(
	goutfÜm©
 & 
	gSECHK_OUT_PROOF
) {

749 
´štf
("\n");

750 
	gi
 = 0; i < 
­Ş_veùÜ_g‘_size
(
mod
->
»suÉ
->
™ems
); i++) {

751 
	g™em
 = 
­Ş_veùÜ_g‘_–em’t
(
mod
->
»suÉ
->
™ems
, 
i
);

752 
´štf
("%s\n", (
tmp
 = 
­Ş_avruË_»nd”
(
pŞicy
, (
qpŞ_avruË_t
 *è
™em
->item)));

754 
qpŞ_avruË_g‘_ruË_ty³
(
q
, (
qpŞ_avruË_t
 *è
™em
->™em, &
ruËty³
);

755 ià(
	gruËty³
 =ğ
QPOL_RULE_DONTAUDIT
) {

756 
j
 = 0; 
	gj
 < 
­Ş_veùÜ_g‘_size
(
™em
->
´oof
); j++) {

757 
	g´oof
 = 
­Ş_veùÜ_g‘_–em’t
(
™em
->
´oof
, 
j
);

758 
´štf
("\tinconsistent: ");

759 
´štf
("%s\n", 
­Ş_avruË_»nd”
(
pŞicy
, (
qpŞ_avruË_t
 *è
´oof
->
–em
));

760 
´štf
("\tinconsistent…ermissions:\n");

761 
´štf
("\t%s\n", 
´oof
->
‹xt
);

763 } ià(
	gruËty³
 =ğ
QPOL_RULE_AUDITALLOW
) {

764 
´štf
("\tmissing: ");

765 
´štf
("%s\n", 
¡r¡r
(
­Ş_avruË_»nd”
(
pŞicy
, (
qpŞ_avruË_t
 *è
™em
->item), "allow"));

766 
´štf
("\tmissing…ermissions:\n");

767 
	gj
 = 0; j < 
­Ş_veùÜ_g‘_size
(
™em
->
´oof
); j++) {

768 
	g´oof
 = 
­Ş_veùÜ_g‘_–em’t
(
™em
->
´oof
, 
j
);

769 
´štf
("\t%s\n", 
´oof
->
‹xt
);

772 
´štf
("\n");

774 
´štf
("\n");

	@sechecker/modules/spurious_audit.h

27 #iâdeà
SPURIOUS_AUDIT


28 
	#SPURIOUS_AUDIT


	)

30 #ifdef 
__ılu¥lus


35 
	~"£check”.h
"

36 
	~<­Ş/pŞicy.h
>

38 
	#SECHK_SPUR_AU_AA_MISS
 0x01

	)

39 
	#SECHK_SPUR_AU_AA_PART
 0x02

	)

40 
	#SECHK_SPUR_AU_DA_FULL
 0x04

	)

41 
	#SECHK_SPUR_AU_DA_PART
 0x08

	)

44 
¥urious_aud™_»gi¡”
(
£chk_lib_t
 * 
lib
);

45 
¥urious_aud™_š™
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

46 
¥urious_aud™_run
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

47 
¥urious_aud™_´št
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

49 #ifdef 
__ılu¥lus


	@sechecker/modules/template/xx.c

29 
	~<cÚfig.h
>

31 
	~"£check”.h
"

32 
	~<­Ş/pŞicy.h
>

33 
	~"xx.h
"

35 
	~<¡dio.h
>

36 
	~<¡ršg.h
>

37 
	~<”ºo.h
>

42 cÚ¡ *cÚ¡ 
	gmod_Çme
 = "xx";

50 
	$xx_»gi¡”
(
£chk_lib_t
 * 
lib
)

52 
£chk_moduË_t
 *
mod
 = 
NULL
;

53 
£chk_â_t
 *
â_¡ruù
 = 
NULL
;

54 
£chk_Çme_v®ue_t
 *
nv
 = 
NULL
;

56 ià(!
lib
) {

57 
	`ERR
(
NULL
, "No†ibrary");

58 
”ºo
 = 
EINVAL
;

65 
mod
 = 
	`£chk_lib_g‘_moduË
(
mod_Çme
, 
lib
);

66 ià(!
mod
) {

67 
	`ERR
(
lib
->
pŞicy
, "ModuË unknowÀ\"%s\"", 
mod_Çme
);

68 
”ºo
 = 
ENOENT
;

72 
mod
->
·»Á_lib
 = 
lib
;

75 
mod
->
br›f_desütiÚ
 = "";

76 
mod
->
d‘aed_desütiÚ
 =

79 
mod
->
İt_desütiÚ
 =

81 
mod
->
£v”™y
 = "TODO: set…roper severity";

85 
nv
 = 
	`£chk_Çme_v®ue_Ãw
("", "");

86 
	`­Ş_veùÜ_­³nd
(
mod
->
İtiÚs
, (*)
nv
);

90 
nv
 = 
	`£chk_Çme_v®ue_Ãw
("", "");

91 
	`­Ş_veùÜ_­³nd
(
mod
->
»quœem’ts
, (*)
nv
);

95 
nv
 = 
	`£chk_Çme_v®ue_Ãw
("", "");

96 
	`­Ş_veùÜ_­³nd
(
mod
->
d•’d’c›s
, (*)
nv
);

99 
â_¡ruù
 = 
	`£chk_â_Ãw
();

100 ià(!
â_¡ruù
) {

101 
	`ERR
(
lib
->
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

102 
”ºo
 = 
ENOMEM
;

105 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_INIT
);

106 ià(!
â_¡ruù
->
Çme
) {

107 
	`ERR
(
lib
->
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

108 
”ºo
 = 
ENOMEM
;

111 
â_¡ruù
->
â
 = 
xx_š™
;

112 
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
);

114 
â_¡ruù
 = 
	`£chk_â_Ãw
();

115 ià(!
â_¡ruù
) {

116 
	`ERR
(
lib
->
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

117 
”ºo
 = 
ENOMEM
;

120 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_RUN
);

121 ià(!
â_¡ruù
->
Çme
) {

122 
	`ERR
(
lib
->
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

123 
”ºo
 = 
ENOMEM
;

126 
â_¡ruù
->
â
 = 
xx_run
;

127 
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
);

131 
mod
->
d©a_ä“
 = 
xx_d©a_ä“
;

133 
â_¡ruù
 = 
	`£chk_â_Ãw
();

134 ià(!
â_¡ruù
) {

135 
	`ERR
(
lib
->
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

136 
”ºo
 = 
ENOMEM
;

139 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_PRINT
);

140 ià(!
â_¡ruù
->
Çme
) {

141 
	`ERR
(
lib
->
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

142 
”ºo
 = 
ENOMEM
;

145 
â_¡ruù
->
â
 = 
xx_´št
;

146 
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
);

152 
	}
}

157 
xx_š™
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

159 
£chk_Çme_v®ue_t
 *
	gİt
 = 
NULL
;

160 
xx_d©a_t
 *
	gd©um
 = 
NULL
;

161 
	g”rÜ
 = 0;

162 
size_t
 
	gi
 = 0;

164 ià(!
	gmod
 || !
	gpŞicy
) {

165 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
EINVAL
));

166 
	g”ºo
 = 
EINVAL
;

169 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

170 
ERR
(
pŞicy
, "WrÚg moduË (%s)\n", 
mod
->
Çme
);

171 
	g”ºo
 = 
EINVAL
;

177 
	gd©um
 = 
xx_d©a_Ãw
();

178 ià(!
	gd©um
) {

179 
	g”rÜ
 = 
”ºo
;

180 
ERR
(
pŞicy
, "E¼Ü: %s\n", 
¡»¼Ü
(
”rÜ
));

181 
	g”ºo
 = 
”rÜ
;

184 
	gmod
->
	gd©a
 = 
d©um
;

186 
	gi
 = 0; i < 
­Ş_veùÜ_g‘_size
(
mod
->
İtiÚs
); i++) {

187 
	gİt
 = 
­Ş_veùÜ_g‘_–em’t
(
mod
->
İtiÚs
, 
i
);

211 
xx_run
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

213 
xx_d©a_t
 *
	gd©um
;

214 
£chk_»suÉ_t
 *
	g»s
 = 
NULL
;

215 
£chk_™em_t
 *
	g™em
 = 
NULL
;

216 
£chk_´oof_t
 *
	g´oof
 = 
NULL
;

217 
	g”rÜ
 = 0;

221 ià(!
	gmod
 || !
	gpŞicy
) {

222 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
EINVAL
));

223 
	g”ºo
 = 
EINVAL
;

226 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

227 
ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

232 ià(
	gmod
->
	g»suÉ
)

235 
	gd©um
 = (
xx_d©a_t
 *è
mod
->
d©a
;

236 
	g»s
 = 
£chk_»suÉ_Ãw
();

237 ià(!
	g»s
) {

238 
	g”rÜ
 = 
”ºo
;

239 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

240 
	g”ºo
 = 
”rÜ
;

243 
	g»s
->
	g‹¡_Çme
 = 
¡rdup
(
mod_Çme
);

244 ià(!
	g»s
->
	g‹¡_Çme
) {

245 
	g”rÜ
 = 
”ºo
;

246 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

247 
	gxx_run_ç
;

257 
	gmod
->
	g»suÉ
 = 
»s
;

261 ià(
­Ş_veùÜ_g‘_size
(
»s
->
™ems
) > 0)

266 
	gxx_run_ç
:

268 
£chk_´oof_ä“
(
´oof
);

269 
£chk_™em_ä“
(
™em
);

270 
£chk_»suÉ_de¡roy
(&
»s
);

271 
	g”ºo
 = 
”rÜ
;

277 
	$xx_d©a_ä“
(*
d©a
)

279 
xx_d©a_t
 *
d©um
 = (xx_d©a_ˆ*è
d©a
;

281 ià(
d©um
) {

286 
	`ä“
(
d©a
);

287 
	}
}

297 
xx_´št
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

299 
xx_d©a_t
 *
	gd©um
 = 
NULL
;

300 
	goutfÜm©
 = 0x00;

301 
£chk_™em_t
 *
	g™em
 = 
NULL
;

302 
£chk_´oof_t
 *
	g´oof
 = 
NULL
;

303 
size_t
 
	gi
 = 0, 
	gj
 = 0;

305 ià(!
	gmod
 || !
	gpŞicy
) {

306 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
EINVAL
));

307 
	g”ºo
 = 
EINVAL
;

310 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

311 
ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

312 
	g”ºo
 = 
EINVAL
;

316 
	gd©um
 = (
xx_d©a_t
 *è
mod
->
d©a
;

317 
	goutfÜm©
 = 
mod
->
ouutfÜm©
;

319 ià(!
	gmod
->
	g»suÉ
) {

320 
ERR
(
pŞicy
, "ModuË % ha nÙ b“Àrun", 
mod
->
Çme
);

321 
	g”ºo
 = 
EINVAL
;

325 ià(!
	goutfÜm©
 || (outfÜm© & 
	gSECHK_OUT_QUIET
))

332 ià(
	goutfÜm©
 & 
	gSECHK_OUT_STATS
) {

334 
´štf
("Found %zd .\n", 
­Ş_veùÜ_g‘_size
(
mod
->
»suÉ
->
™ems
));

344 ià(
	goutfÜm©
 & 
	gSECHK_OUT_LIST
) {

345 
´štf
("\n");

346 
	gi
 = 0; i < 
­Ş_veùÜ_g‘_size
(
mod
->
»suÉ
->
™ems
); i++) {

347 
	g™em
 = 
­Ş_veùÜ_g‘_–em’t
(
mod
->
»suÉ
->
™ems
, 
i
);

348 
	gi
++;

351 
	gi
 %= 4;

353 
´štf
("%s%s", "", (
i
 ? ", " : "\n"));

355 
´štf
("\n");

364 ià(
	goutfÜm©
 & 
	gSECHK_OUT_PROOF
) {

365 
´štf
("\n");

366 
	gi
 = 0; i < 
­Ş_veùÜ_g‘_size
(
mod
->
»suÉ
->
™ems
); i++) {

367 
	g™em
 = 
­Ş_veùÜ_g‘_–em’t
(
mod
->
»suÉ
->
™ems
, 
i
);

368 
´štf
("%s", "");

369 
´štf
(" - sev”™y: %s\n", 
£chk_™em_£v
(
™em
));

370 
	gj
 = 0; j < 
­Ş_veùÜ_g‘_size
(
™em
->
´oof
); j++) {

371 
	g´oof
 = 
­Ş_veùÜ_g‘_–em’t
(
™em
->
´oof
, 
j
);

372 
´štf
("\t%s\n", 
´oof
->
‹xt
);

375 
´štf
("\n");

384 
xx_d©a_t
 *
	$xx_d©a_Ãw
()

386 
xx_d©a_t
 *
d©um
 = 
NULL
;

388 
d©um
 = (
xx_d©a_t
 *è
	`ÿÎoc
(1, (xx_data_t));

392  
d©um
;

393 
	}
}

	@sechecker/modules/template/xx.h

31 
	~"£check”.h
"

32 
	~<­Ş/pŞicy.h
>

39 
	sxx_d©a


43 } 
	gxx_d©a_t
;

47 
xx_d©a_t
 *
xx_d©a_Ãw
();

48 
xx_d©a_ä“
(*
d©a
);

53 
xx_»gi¡”
(
£chk_lib_t
 * 
lib
);

61 
xx_š™
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

62 
xx_run
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

63 
xx_´št
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

	@sechecker/modules/types_wo_allow.c

26 
	~"ty³s_wo_®low.h
"

28 
	~<¡dio.h
>

29 
	~<¡ršg.h
>

30 
	~<”ºo.h
>

35 cÚ¡ *cÚ¡ 
	gmod_Çme
 = "types_wo_allow";

39 
	$ty³s_wo_®low_»gi¡”
(
£chk_lib_t
 * 
lib
)

41 
£chk_moduË_t
 *
mod
 = 
NULL
;

42 
£chk_â_t
 *
â_¡ruù
 = 
NULL
;

44 ià(!
lib
) {

45 
	`ERR
(
NULL
, "%s", "No†ibrary");

46 
”ºo
 = 
EINVAL
;

53 
mod
 = 
	`£chk_lib_g‘_moduË
(
mod_Çme
, 
lib
);

54 ià(!
mod
) {

55 
	`ERR
(
NULL
, "%s", "Module unknown");

56 
”ºo
 = 
EINVAL
;

59 
mod
->
·»Á_lib
 = 
lib
;

62 
mod
->
br›f_desütiÚ
 = "types with‚o‡llow„ules";

63 
mod
->
d‘aed_desütiÚ
 =

70 
mod
->
İt_desütiÚ
 =

72 
mod
->
£v”™y
 = 
SECHK_SEV_LOW
;

74 
â_¡ruù
 = 
	`£chk_â_Ãw
();

75 ià(!
â_¡ruù
) {

76 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

77 
”ºo
 = 
ENOMEM
;

80 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_INIT
);

81 ià(!
â_¡ruù
->
Çme
) {

82 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

83 
”ºo
 = 
ENOMEM
;

86 
â_¡ruù
->
â
 = 
ty³s_wo_®low_š™
;

87 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
) < 0) {

88 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

89 
”ºo
 = 
ENOMEM
;

93 
â_¡ruù
 = 
	`£chk_â_Ãw
();

94 ià(!
â_¡ruù
) {

95 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

96 
”ºo
 = 
ENOMEM
;

99 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_RUN
);

100 ià(!
â_¡ruù
->
Çme
) {

101 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

102 
”ºo
 = 
ENOMEM
;

105 
â_¡ruù
->
â
 = 
ty³s_wo_®low_run
;

106 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
) < 0) {

107 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

108 
”ºo
 = 
ENOMEM
;

112 
mod
->
d©a_ä“
 = 
NULL
;

114 
â_¡ruù
 = 
	`£chk_â_Ãw
();

115 ià(!
â_¡ruù
) {

116 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

117 
”ºo
 = 
ENOMEM
;

120 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_PRINT
);

121 ià(!
â_¡ruù
->
Çme
) {

122 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

123 
”ºo
 = 
ENOMEM
;

126 
â_¡ruù
->
â
 = 
ty³s_wo_®low_´št
;

127 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
) < 0) {

128 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

129 
”ºo
 = 
ENOMEM
;

133 
â_¡ruù
 = 
	`£chk_â_Ãw
();

134 ià(!
â_¡ruù
) {

135 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

136 
”ºo
 = 
ENOMEM
;

139 
â_¡ruù
->
Çme
 = 
	`¡rdup
("get_list");

140 ià(!
â_¡ruù
->
Çme
) {

141 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

142 
”ºo
 = 
ENOMEM
;

145 
â_¡ruù
->
â
 = 
ty³s_wo_®low_g‘_li¡
;

146 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
) < 0) {

147 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

148 
”ºo
 = 
ENOMEM
;

153 
	}
}

158 
ty³s_wo_®low_š™
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

160 ià(!
	gmod
 || !
	gpŞicy
) {

161 
ERR
(
pŞicy
, "%s", "Invalid…arameters");

162 
	g”ºo
 = 
EINVAL
;

165 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

166 
ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

167 
	g”ºo
 = 
EINVAL
;

171 
	gmod
->
	gd©a
 = 
NULL
;

179 
ty³s_wo_®low_run
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

181 
£chk_»suÉ_t
 *
	g»s
 = 
NULL
;

182 
£chk_™em_t
 *
	g™em
 = 
NULL
;

183 
£chk_´oof_t
 *
	g´oof
 = 
NULL
;

184 
size_t
 
	gi
;

185 
boŞ
 
	gu£d
 = 
çl£
;

186 
­Ş_veùÜ_t
 *
	gty³_veùÜ
;

187 
­Ş_veùÜ_t
 *
	gavruË_veùÜ
;

188 
­Ş_avruË_qu”y_t
 *
	gavruË_qu”y
 = 
NULL
;

189 
qpŞ_pŞicy_t
 *
	gq
 = 
­Ş_pŞicy_g‘_qpŞ
(
pŞicy
);

190 
	g”rÜ
 = 0;

192 ià(!
	gmod
 || !
	gpŞicy
) {

193 
ERR
(
pŞicy
, "%s", "Invalid…arameters");

194 
	g”ºo
 = 
EINVAL
;

197 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

198 
ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

199 
	g”ºo
 = 
EINVAL
;

204 ià(
	gmod
->
	g»suÉ
)

207 
	g»s
 = 
£chk_»suÉ_Ãw
();

208 ià(!
	g»s
) {

209 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

210 
	g”ºo
 = 
ENOMEM
;

213 
	g»s
->
	g‹¡_Çme
 = 
¡rdup
(
mod_Çme
);

214 ià(!
	g»s
->
	g‹¡_Çme
) {

215 
	g”rÜ
 = 
”ºo
;

216 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

217 
	gty³s_wo_®low_run_ç
;

219 
	g»s
->
	g™em_ty³
 = 
SECHK_ITEM_TYPE
;

220 ià(!(
	g»s
->
	g™ems
 = 
­Ş_veùÜ_ü—‹
(
£chk_™em_ä“
))) {

221 
”rÜ
 = 
”ºo
;

222 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

223 
	gty³s_wo_®low_run_ç
;

226 ià(!(
	gavruË_qu”y
 = 
­Ş_avruË_qu”y_ü—‹
())) {

227 
”rÜ
 = 
”ºo
;

228 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

229 
	gty³s_wo_®low_run_ç
;

232 ià(
­Ş_ty³_g‘_by_qu”y
(
pŞicy
, 
NULL
, &
ty³_veùÜ
) < 0) {

233 
	g”rÜ
 = 
”ºo
;

234 
	gty³s_wo_®low_run_ç
;

237 
	gi
 = 0; i < 
­Ş_veùÜ_g‘_size
(
ty³_veùÜ
); i++) {

238 cÚ¡ 
qpŞ_ty³_t
 *
	gty³
;

239 cÚ¡ *
	gty³_Çme
;

240 
size_t
 
	gj
;

242 
	gu£d
 = 
çl£
;

243 
	gty³
 = 
­Ş_veùÜ_g‘_–em’t
(
ty³_veùÜ
, 
i
);

244 
qpŞ_ty³_g‘_Çme
(
q
, 
ty³
, &
ty³_Çme
);

247 
­Ş_avruË_qu”y_£t_sourû
(
pŞicy
, 
avruË_qu”y
, 
ty³_Çme
, 1);

248 
­Ş_avruË_g‘_by_qu”y
(
pŞicy
, 
avruË_qu”y
, &
avruË_veùÜ
);

249 
	gj
 = 0; j < 
­Ş_veùÜ_g‘_size
(
avruË_veùÜ
); j++) {

250 
ušt32_t
 
	gruË_ty³
;

251 
qpŞ_avruË_t
 *
	gruË
;

253 
	gruË
 = 
­Ş_veùÜ_g‘_–em’t
(
avruË_veùÜ
, 
j
);

254 
qpŞ_avruË_g‘_ruË_ty³
(
q
, 
ruË
, &
ruË_ty³
);

255 ià(
	gruË_ty³
 =ğ
QPOL_RULE_ALLOW
)

256 
u£d
 = 
Œue
;

258 
­Ş_veùÜ_de¡roy
(&
avruË_veùÜ
);

259 ià(
	gu£d
)

263 
­Ş_avruË_qu”y_£t_sourû
(
pŞicy
, 
avruË_qu”y
, 
NULL
, 0);

264 
­Ş_avruË_qu”y_£t_rg‘
(
pŞicy
, 
avruË_qu”y
, 
ty³_Çme
, 1);

265 
­Ş_avruË_g‘_by_qu”y
(
pŞicy
, 
avruË_qu”y
, &
avruË_veùÜ
);

266 
	gj
 = 0; j < 
­Ş_veùÜ_g‘_size
(
avruË_veùÜ
); j++) {

267 
ušt32_t
 
	gruË_ty³
;

268 
qpŞ_avruË_t
 *
	gruË
;

270 
	gruË
 = 
­Ş_veùÜ_g‘_–em’t
(
avruË_veùÜ
, 
j
);

271 
qpŞ_avruË_g‘_ruË_ty³
(
q
, 
ruË
, &
ruË_ty³
);

272 ià(
	gruË_ty³
 =ğ
QPOL_RULE_ALLOW
)

273 
u£d
 = 
Œue
;

275 
­Ş_veùÜ_de¡roy
(&
avruË_veùÜ
);

276 
­Ş_avruË_qu”y_£t_rg‘
(
pŞicy
, 
avruË_qu”y
, 
NULL
, 0);

277 ià(
	gu£d
)

281 
	g™em
 = 
£chk_™em_Ãw
(
NULL
);

282 ià(!
	g™em
) {

283 
	g”rÜ
 = 
”ºo
;

284 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

285 
	gty³s_wo_®low_run_ç
;

287 
	g™em
->
	g‹¡_»suÉ
 = 1;

288 
	g™em
->™em = (*)
ty³
;

289 
	g´oof
 = 
£chk_´oof_Ãw
(
NULL
);

290 ià(!
	g´oof
) {

291 
	g”rÜ
 = 
”ºo
;

292 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

293 
	gty³s_wo_®low_run_ç
;

295 
	g´oof
->
	gty³
 = 
SECHK_ITEM_TYPE
;

296 
	g´oof
->
	g‹xt
 = 
¡rdup
("Thisype does‚ot‡ppear in‡ny‡llow„ules.");

297 ià(!
	g´oof
->
	g‹xt
) {

298 
	g”rÜ
 = 
”ºo
;

299 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

300 
	gty³s_wo_®low_run_ç
;

302 ià(!
	g™em
->
	g´oof
) {

303 ià(!(
	g™em
->
	g´oof
 = 
­Ş_veùÜ_ü—‹
(
£chk_´oof_ä“
))) {

304 
”rÜ
 = 
”ºo
;

305 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

306 
	gty³s_wo_®low_run_ç
;

309 ià(
­Ş_veùÜ_­³nd
(
™em
->
´oof
, (*)proof) < 0) {

310 
	g”rÜ
 = 
”ºo
;

311 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

312 
	gty³s_wo_®low_run_ç
;

314 ià(
­Ş_veùÜ_­³nd
(
»s
->
™ems
, (*)
™em
) < 0) {

315 
	g”rÜ
 = 
”ºo
;

316 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

317 
	gty³s_wo_®low_run_ç
;

320 
­Ş_veùÜ_de¡roy
(&
ty³_veùÜ
);

321 
­Ş_veùÜ_de¡roy
(&
avruË_veùÜ
);

322 
­Ş_avruË_qu”y_de¡roy
(&
avruË_qu”y
);

324 
	gmod
->
	g»suÉ
 = 
»s
;

326 ià(
­Ş_veùÜ_g‘_size
(
»s
->
™ems
))

330 
	gty³s_wo_®low_run_ç
:

331 
­Ş_veùÜ_de¡roy
(&
ty³_veùÜ
);

332 
­Ş_veùÜ_de¡roy
(&
avruË_veùÜ
);

333 
£chk_´oof_ä“
(
´oof
);

334 
£chk_™em_ä“
(
™em
);

335 
£chk_»suÉ_de¡roy
(&
»s
);

336 
	g”ºo
 = 
”rÜ
;

342 
ty³s_wo_®low_´št
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

344 
	goutfÜm©
 = 0x00;

345 
£chk_™em_t
 *
	g™em
 = 
NULL
;

346 
£chk_´oof_t
 *
	g´oof
 = 
NULL
;

347 
size_t
 
	gi
 = 0, 
	gj
 = 0, 
	gk
 = 0, 
	gl
 = 0, 
	gnum_™ems
;

348 cÚ¡ 
qpŞ_ty³_t
 *
	gty³
;

349 
qpŞ_pŞicy_t
 *
	gq
 = 
­Ş_pŞicy_g‘_qpŞ
(
pŞicy
);

350 cÚ¡ *
	gty³_Çme
;

352 ià(!
	gmod
 || !
	gpŞicy
) {

353 
ERR
(
pŞicy
, "%s", "Invalid…arameters");

354 
	g”ºo
 = 
EINVAL
;

357 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

358 
ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

359 
	g”ºo
 = 
EINVAL
;

363 
	goutfÜm©
 = 
mod
->
ouutfÜm©
;

364 
	gnum_™ems
 = 
­Ş_veùÜ_g‘_size
(
mod
->
»suÉ
->
™ems
);

366 ià(!
	gmod
->
	g»suÉ
) {

367 
ERR
(
pŞicy
, "%s", "Module has‚ot been„un");

368 
	g”ºo
 = 
EINVAL
;

372 ià(!
	goutfÜm©
 || (outfÜm© & 
	gSECHK_OUT_QUIET
))

376 ià(
	goutfÜm©
 & 
	gSECHK_OUT_STATS
) {

377 
´štf
("Found %˜ty³s.\n", 
num_™ems
);

379 ià(
	goutfÜm©
 & 
	gSECHK_OUT_PROOF
) {

380 
´štf
("\nThe followingypes do‚ot‡ppear in‡ny‡llow„ules.\n");

384 ià(
	goutfÜm©
 & (
	gSECHK_OUT_LIST
)) {

385 
´štf
("\n");

386 
	gi
 = 0; i < 
	gnum_™ems
; i++) {

387 
	gj
++;

388 
	g™em
 = 
­Ş_veùÜ_g‘_–em’t
(
mod
->
»suÉ
->
™ems
, 
i
);

389 
	gty³
 = 
™em
->item;

390 
qpŞ_ty³_g‘_Çme
(
q
, 
ty³
, &
ty³_Çme
);

391 
	gj
 %= 4;

392 
´štf
("%s%s", 
ty³_Çme
, (*)((
j
 && 
i
 !ğ
num_™ems
 - 1) ? ", " : "\n"));

394 
´štf
("\n");

397 ià(
	goutfÜm©
 & 
	gSECHK_OUT_PROOF
) {

398 
´štf
("\n");

399 
	gk
 = 0; k < 
	gnum_™ems
; k++) {

400 
	g™em
 = 
­Ş_veùÜ_g‘_–em’t
(
mod
->
»suÉ
->
™ems
, 
k
);

401 ià(
	g™em
) {

402 
	gty³
 = 
™em
->item;

403 
qpŞ_ty³_g‘_Çme
(
q
, 
ty³
, &
ty³_Çme
);

404 
´štf
("%s\n", 
ty³_Çme
);

405 
	gl
 = 0;† < 
­Ş_veùÜ_g‘_size
(
™em
->
´oof
);†++) {

406 
	g´oof
 = 
­Ş_veùÜ_g‘_–em’t
(
™em
->
´oof
, 
l
);

407 ià(
	g´oof
)

408 
´štf
("\t%s\n", 
´oof
->
‹xt
);

412 
´štf
("\n");

414 
	gty³
 = 
NULL
;

415 
	gty³_Çme
 = 
NULL
;

420 
ty³s_wo_®low_g‘_li¡
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
 
__©Œibu‹__
 ((
unu£d
)), *
¬g
)

422 
­Ş_veùÜ_t
 **
	gv
 = 
¬g
;

424 ià(!
	gmod
 || !
	g¬g
) {

425 
ERR
(
NULL
, "%s", "Invalid…arameters");

426 
	g”ºo
 = 
EINVAL
;

429 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

430 
ERR
(
NULL
, "WrÚg moduË (%s)", 
mod
->
Çme
);

431 
	g”ºo
 = 
EINVAL
;

434 ià(!
	gmod
->
	g»suÉ
) {

435 
ERR
(
NULL
, "%s", "Module has‚ot been„un");

436 
	g”ºo
 = 
EINVAL
;

440 
	gv
 = &
mod
->
»suÉ
->
™ems
;

	@sechecker/modules/types_wo_allow.h

26 #iâdeà
TYPES_WO_ALLOW


27 
	#TYPES_WO_ALLOW


	)

29 #ifdef 
__ılu¥lus


34 
	~"£check”.h
"

35 
	~<­Ş/pŞicy.h
>

36 
	~<­Ş/avruË-qu”y.h
>

37 
	~<­Ş/ty³-qu”y.h
>

39 
ty³s_wo_®low_»gi¡”
(
£chk_lib_t
 * 
lib
);

40 
ty³s_wo_®low_š™
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

41 
ty³s_wo_®low_run
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

42 
ty³s_wo_®low_´št
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

43 
ty³s_wo_®low_g‘_li¡
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

45 #ifdef 
__ılu¥lus


	@sechecker/modules/unreachable_doms.c

27 
	~<cÚfig.h
>

29 
	~"uÄ—chabË_doms.h
"

31 
	~<¡dio.h
>

32 
	~<¡ršg.h
>

33 
	~<ùy³.h
>

34 
	~<”ºo.h
>

35 
	~<as£¹.h
>

37 
boŞ
 
·r£_deçuÉ_cÚ‹xts
(cÚ¡ *
ùx_fe_·th
, 
­Ş_veùÜ_t
 * 
ùx_veùÜ
, 
­Ş_pŞicy_t
 * 
pŞicy
);

38 
boŞ
 
š_isid_ùx
(cÚ¡ *
ty³_Çme
, 
­Ş_pŞicy_t
 * 
pŞicy
);

39 
boŞ
 
š_def_ùx
(cÚ¡ *
ty³_Çme
, 
uÄ—chabË_doms_d©a_t
 * 
d©um
);

41 
ssize_t
 
g‘lše
(**
lš•Œ
, 
size_t
 * 
n
, 
FILE
 * 
¡»am
);

46 cÚ¡ *cÚ¡ 
	gmod_Çme
 = "unreachable_doms";

48 
	$uÄ—chabË_doms_»gi¡”
(
£chk_lib_t
 * 
lib
)

50 
£chk_moduË_t
 *
mod
 = 
NULL
;

51 
£chk_â_t
 *
â_¡ruù
 = 
NULL
;

53 ià(!
lib
) {

54 
	`ERR
(
NULL
, "%s", "No†ibrary");

55 
”ºo
 = 
EINVAL
;

62 
mod
 = 
	`£chk_lib_g‘_moduË
(
mod_Çme
, 
lib
);

63 ià(!
mod
) {

64 
	`ERR
(
NULL
, "%s", "Module unknown");

65 
”ºo
 = 
EINVAL
;

68 
mod
->
·»Á_lib
 = 
lib
;

71 
mod
->
br›f_desütiÚ
 = "unreachable domains";

72 
mod
->
d‘aed_desütiÚ
 =

81 
mod
->
İt_desütiÚ
 = " Module„equirements:\n" "‡ttribute‚ames\n"

82 #ifdeà
LIBSELINUX


86 
mod
->
£v”™y
 = 
SECHK_SEV_MED
;

89 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
»quœem’ts
, 
	`£chk_Çme_v®ue_Ãw
(
SECHK_REQ_POLICY_CAP
, 
SECHK_REQ_CAP_ATTRIB_NAMES
)) < 0) {

90 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

91 
”ºo
 = 
ENOMEM
;

94 #ifdeà
LIBSELINUX


95 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
»quœem’ts
, 
	`£chk_Çme_v®ue_Ãw
(
SECHK_REQ_DEFAULT_CONTEXTS
, 
NULL
)) < 0) {

96 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

97 
”ºo
 = 
ENOMEM
;

103 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
d•’d’c›s
, 
	`£chk_Çme_v®ue_Ãw
("module", "find_domains")) < 0) {

104 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

105 
”ºo
 = 
ENOMEM
;

110 
â_¡ruù
 = 
	`£chk_â_Ãw
();

111 ià(!
â_¡ruù
) {

112 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

113 
”ºo
 = 
ENOMEM
;

116 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_INIT
);

117 ià(!
â_¡ruù
->
Çme
) {

118 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

119 
”ºo
 = 
ENOMEM
;

122 
â_¡ruù
->
â
 = 
uÄ—chabË_doms_š™
;

123 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
) < 0) {

124 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

125 
”ºo
 = 
ENOMEM
;

129 
â_¡ruù
 = 
	`£chk_â_Ãw
();

130 ià(!
â_¡ruù
) {

131 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

132 
”ºo
 = 
ENOMEM
;

135 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_RUN
);

136 ià(!
â_¡ruù
->
Çme
) {

137 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

138 
”ºo
 = 
ENOMEM
;

141 
â_¡ruù
->
â
 = 
uÄ—chabË_doms_run
;

142 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
) < 0) {

143 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

144 
”ºo
 = 
ENOMEM
;

148 
mod
->
d©a_ä“
 = 
uÄ—chabË_doms_d©a_ä“
;

150 
â_¡ruù
 = 
	`£chk_â_Ãw
();

151 ià(!
â_¡ruù
) {

152 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

153 
”ºo
 = 
ENOMEM
;

156 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_PRINT
);

157 ià(!
â_¡ruù
->
Çme
) {

158 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

159 
”ºo
 = 
ENOMEM
;

162 
â_¡ruù
->
â
 = 
uÄ—chabË_doms_´št
;

163 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
) < 0) {

164 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

165 
”ºo
 = 
ENOMEM
;

170 
	}
}

175 
uÄ—chabË_doms_š™
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

177 
uÄ—chabË_doms_d©a_t
 *
	gd©um
 = 
NULL
;

178 cÚ¡ *
	gùx_fe_·th
 = 
NULL
;

180 ià(!
	gmod
 || !
	gpŞicy
) {

181 
ERR
(
pŞicy
, "%s", "Invalid…arameters");

182 
	g”ºo
 = 
EINVAL
;

185 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

186 
ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

187 
	g”ºo
 = 
EINVAL
;

191 
	gd©um
 = 
uÄ—chabË_doms_d©a_Ãw
();

192 ià(!
	gd©um
) {

193 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

194 
	g”ºo
 = 
ENOMEM
;

197 
	gmod
->
	gd©a
 = 
d©um
;

200 ià(!(
	gd©um
->
	gùx_veùÜ
 = 
­Ş_veùÜ_ü—‹
(
ä“
))) {

201 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

202 
	g”ºo
 = 
ENOMEM
;

205 #ifdeà
LIBSELINUX


206 
	gùx_fe_·th
 = 
£lšux_deçuÉ_cÚ‹xt_·th
();

207 ià(!
	gùx_fe_·th
) {

208 
ERR
(
pŞicy
, "%s", "Unableo find default contexts file");

209 
	g”ºo
 = 
ENOENT
;

212 
boŞ
 
	g»tv
 = 
·r£_deçuÉ_cÚ‹xts
(
ùx_fe_·th
, 
d©um
->
ùx_veùÜ
, 
pŞicy
);

213 ià(!
	g»tv
) {

214 
ERR
(
pŞicy
, "%s", "Unableo…arse default contexts file");

215 
	g”ºo
 = 
EIO
;

224 
	edom_Ãed


226 
	mKEEP_SEARCHING
 = 0,

227 
	mUSER
,

228 
	mCOMMON_USER
,

229 
	mROLE_TRANS
,

230 
	mROLE_ALLOW
,

231 
	mRBAC
,

232 
	mVALID_TRANS
,

233 
	mROLE
,

234 
	mTRANSITION
,

235 
	mDONE


236 } 
	tdom_Ãed_e
;

245 
	$exi¡s_commÚ_u£r
(
­Ş_pŞicy_t
 * 
pŞicy
, 
­Ş_veùÜ_t
 * 
¤c_rŞes
,‡pŞ_veùÜ_ˆ* 
tgt_rŞes
,

246 cÚ¡ 
qpŞ_rŞe_t
 ** 
which_¤
, cÚ¡ qpŞ_rŞe_ˆ** 
which_Œ
, cÚ¡ 
qpŞ_u£r_t
 ** 
which_u
)

248 
»tv
 = 0;

249 
­Ş_u£r_qu”y_t
 *
uq
;

250 cÚ¡ *
Çme
 = 
NULL
;

251 cÚ¡ 
qpŞ_rŞe_t
 *
rŞe
 = 
NULL
;

252 cÚ¡ 
qpŞ_u£r_t
 *
u£r
 = 
NULL
;

253 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

254 
­Ş_veùÜ_t
 *
u£r_v
 = 
NULL
;

255 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicy
);

256 
size_t
 
i
, 
j
, 
k
;

258 ià(!
pŞicy
 || !
¤c_rŞes
 || !
tgt_rŞes
)

261 ià(
which_¤
)

262 *
which_¤
 = 
NULL
;

263 ià(
which_Œ
)

264 *
which_Œ
 = 
NULL
;

265 ià(
which_u
)

266 *
which_u
 = 
NULL
;

268 ià(!(
uq
 = 
	`­Ş_u£r_qu”y_ü—‹
()))

271 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
¤c_rŞes
); i++) {

272 
rŞe
 = 
	`­Ş_veùÜ_g‘_–em’t
(
¤c_rŞes
, 
i
);

273 ià(
which_¤
)

274 *
which_¤
 = 
rŞe
;

275 
	`qpŞ_rŞe_g‘_Çme
(
q
, 
rŞe
, &
Çme
);

276 
	`­Ş_u£r_qu”y_£t_rŞe
(
pŞicy
, 
uq
, 
Çme
);

277 
	`­Ş_u£r_g‘_by_qu”y
(
pŞicy
, 
uq
, &
u£r_v
);

278 
j
 = 0; j < 
	`­Ş_veùÜ_g‘_size
(
u£r_v
); j++) {

279 
u£r
 = 
	`­Ş_veùÜ_g‘_–em’t
(
u£r_v
, 
j
);

280 
	`qpŞ_u£r_g‘_rŞe_™”
(
q
, 
u£r
, &
™”
);

281 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

282 
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
rŞe
);

283 ià(!
	`­Ş_veùÜ_g‘_šdex
(
tgt_rŞes
, 
rŞe
, 
NULL
, NULL, &
k
)) {

284 
»tv
 = 1;

285 ià(
which_Œ
)

286 *
which_Œ
 = 
rŞe
;

287 ià(
which_u
)

288 *
which_u
 = 
u£r
;

289 
exi¡s_dÚe
;

292 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

294 
	`­Ş_veùÜ_de¡roy
(&
u£r_v
);

297 
exi¡s_dÚe
:

298 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

299 
	`­Ş_veùÜ_de¡roy
(&
u£r_v
);

300 
	`­Ş_u£r_qu”y_de¡roy
(&
uq
);

301  
»tv
;

302 
	}
}

311 
uÄ—chabË_doms_run
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

313 
uÄ—chabË_doms_d©a_t
 *
	gd©um
;

314 
£chk_Çme_v®ue_t
 *
	gd•
 = 
NULL
;

315 
£chk_»suÉ_t
 *
	g»s
 = 
NULL
, *
	gfšd_domašs_»s
 = NULL;

316 
£chk_™em_t
 *
	g™em
 = 
NULL
;

317 
£chk_´oof_t
 *
	g´oof
 = 
NULL
;

318 
size_t
 
	gi
, 
	gj
, 
	gk
, 
	gl
;

319 
£chk_mod_â_t
 
	grun_â
 = 
NULL
;

320 
	g”rÜ
 = 0, 
	gŒªs_missšg
 = 0;

321 
­Ş_veùÜ_t
 *
	gdom_veùÜ
 = 
NULL
, *
	gdom_»suÉs
 = NULL, *
	gdom_rŞes
 = NULL;

322 
­Ş_veùÜ_t
 *
	gv®id_»v_Œªs
 = 
NULL
, *
	gšv®id_»v_Œªs
 = NULL;

323 
­Ş_veùÜ_t
 *
	g¡¬t_rŞes
 = 
NULL
, *
	gš‹r£ù_rŞes
 = NULL;

324 
­Ş_veùÜ_t
 *
	gtmp_u£rs
 = 
NULL
, *
	grŞe_u£rs
 = NULL;

325 
­Ş_veùÜ_t
 *
	grŞe_Œªs_veùÜ
 = 
NULL
, *
	grŞe_®low_veùÜ
 = NULL;

326 
­Ş_domaš_Œªs_ª®ysis_t
 *
	gd
 = 
NULL
;

327 
­Ş_domaš_Œªs_»suÉ_t
 *
	gdŒ
 = 
NULL
;

328 cÚ¡ *
	gtmp_Çme
 = 
NULL
, *
	gcur_dom_Çme
 = NULL;

329 cÚ¡ *
	gtmp2
 = 
NULL
, *
	gtmp3
 = NULL;

330 cÚ¡ 
qpŞ_ty³_t
 *
	gcur_dom
 = 
NULL
, *
	g•_ty³
 = NULL, *
	g¡¬t_ty³
 = NULL;

331 cÚ¡ 
qpŞ_ty³_t
 *
	gÏ¡_ty³
 = 
NULL
;

332 cÚ¡ 
qpŞ_rŞe_t
 *
	gÏ¡_rŞe
 = 
NULL
, *
	g¤c_rŞe
 = NULL, *
	gdæt_rŞe
 = NULL;

333 cÚ¡ 
qpŞ_rŞe_t
 *
	gÏ¡_dæt
 = 
NULL
;

334 cÚ¡ 
qpŞ_u£r_t
 *
	gÏ¡_u£r
 = 
NULL
;

335 
dom_Ãed_e
 
	gÃed
 = 
KEEP_SEARCHING
;

336 
­Ş_rŞe_qu”y_t
 *
	grŞe_q
 = 
NULL
;

337 
­Ş_u£r_qu”y_t
 *
	gu£r_q
 = 
NULL
;

338 
­Ş_rŞe_Œªs_qu”y_t
 *
	g¹q
 = 
NULL
;

339 
­Ş_rŞe_®low_qu”y_t
 *
	g¿q
 = 
NULL
;

340 cÚ¡ 
qpŞ_rŞe_Œªs_t
 *
	grŞe_Œªs
 = 
NULL
;

341 
qpŞ_pŞicy_t
 *
	gq
 = 
­Ş_pŞicy_g‘_qpŞ
(
pŞicy
);

343 ià(!
	gmod
 || !
	gpŞicy
) {

344 
ERR
(
pŞicy
, "%s", "Invalid…arameters");

345 
	g”ºo
 = 
EINVAL
;

348 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

349 
ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

350 
	g”ºo
 = 
EINVAL
;

355 ià(
	gmod
->
	g»suÉ
)

358 
	gd©um
 = (
uÄ—chabË_doms_d©a_t
 *è
mod
->
d©a
;

359 
	g»s
 = 
£chk_»suÉ_Ãw
();

360 ià(!
	g»s
) {

361 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

362 
	g”ºo
 = 
ENOMEM
;

365 
	g»s
->
	g‹¡_Çme
 = 
¡rdup
(
mod_Çme
);

366 ià(!
	g»s
->
	g‹¡_Çme
) {

367 
	g”rÜ
 = 
”ºo
;

368 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

369 
	guÄ—chabË_doms_run_ç
;

371 
	g»s
->
	g™em_ty³
 = 
SECHK_ITEM_TYPE
;

372 ià(!(
	g»s
->
	g™ems
 = 
­Ş_veùÜ_ü—‹
(
£chk_™em_ä“
))) {

373 
”rÜ
 = 
”ºo
;

374 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

375 
	guÄ—chabË_doms_run_ç
;

379 
	gi
 = 0; i < 
­Ş_veùÜ_g‘_size
(
mod
->
d•’d’c›s
); i++) {

380 
	gd•
 = 
­Ş_veùÜ_g‘_–em’t
(
mod
->
d•’d’c›s
, 
i
);

381 
	grun_â
 = 
£chk_lib_g‘_moduË_funùiÚ
(
d•
->
v®ue
, 
SECHK_MOD_FN_RUN
, 
mod
->
·»Á_lib
);

382 
run_â
(
£chk_lib_g‘_moduË
(
d•
->
v®ue
, 
mod
->
·»Á_lib
), 
pŞicy
, 
NULL
);

385 
	gfšd_domašs_»s
 = 
£chk_lib_g‘_moduË_»suÉ
("fšd_domašs", 
mod
->
·»Á_lib
);

386 
	gdom_»suÉs
 = 
fšd_domašs_»s
->
™ems
;

387 ià(!(
	gdom_veùÜ
 = 
­Ş_veùÜ_ü—‹
(
NULL
))) {

388 
”rÜ
 = 
”ºo
;

389 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

390 
	guÄ—chabË_doms_run_ç
;

392 
	gi
 = 0; i < 
­Ş_veùÜ_g‘_size
(
dom_»suÉs
); i++) {

393 
	g™em
 = 
­Ş_veùÜ_g‘_–em’t
(
dom_»suÉs
, 
i
);

394 ià(
­Ş_veùÜ_­³nd
(
dom_veùÜ
, (*)(
™em
->item))) {

395 
	g”rÜ
 = 
”ºo
;

396 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

397 
	guÄ—chabË_doms_run_ç
;

400 
	g™em
 = 
NULL
;

401 
	gdom_»suÉs
 = 
NULL
;

404 
	gd
 = 
­Ş_domaš_Œªs_ª®ysis_ü—‹
();

405 ià(!
	gd
) {

406 
	g”rÜ
 = 
”ºo
;

407 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

408 
	guÄ—chabË_doms_run_ç
;

410 
­Ş_domaš_Œªs_ª®ysis_£t_dœeùiÚ
(
pŞicy
, 
d
, 
APOL_DOMAIN_TRANS_DIRECTION_REVERSE
);

412 
	grŞe_q
 = 
­Ş_rŞe_qu”y_ü—‹
();

413 ià(!
	grŞe_q
) {

414 
	g”rÜ
 = 
”ºo
;

415 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

416 
	guÄ—chabË_doms_run_ç
;

419 
	gu£r_q
 = 
­Ş_u£r_qu”y_ü—‹
();

420 ià(!
	gu£r_q
) {

421 
	g”rÜ
 = 
”ºo
;

422 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

423 
	guÄ—chabË_doms_run_ç
;

426 
	g¹q
 = 
­Ş_rŞe_Œªs_qu”y_ü—‹
();

427 ià(!
	g¹q
) {

428 
	g”rÜ
 = 
”ºo
;

429 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

430 
	guÄ—chabË_doms_run_ç
;

433 
	g¿q
 = 
­Ş_rŞe_®low_qu”y_ü—‹
();

434 ià(!
	g¿q
) {

435 
	g”rÜ
 = 
”ºo
;

436 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

437 
	guÄ—chabË_doms_run_ç
;

441 
	gi
 = 0; i < 
­Ş_veùÜ_g‘_size
(
dom_veùÜ
); i++) {

442 
	gcur_dom
 = 
­Ş_veùÜ_g‘_–em’t
(
dom_veùÜ
, 
i
);

443 
qpŞ_ty³_g‘_Çme
(
q
, 
cur_dom
, &
cur_dom_Çme
);

444 
	gÃed
 = 
KEEP_SEARCHING
;

447 #ifdeà
LIBSELINUX


448 
š_def_ùx
(
cur_dom_Çme
, 
d©um
) ||

450 
š_isid_ùx
(
cur_dom_Çme
, 
pŞicy
))

454 
­Ş_rŞe_qu”y_£t_ty³
(
pŞicy
, 
rŞe_q
, 
cur_dom_Çme
);

455 
­Ş_rŞe_g‘_by_qu”y
(
pŞicy
, 
rŞe_q
, &
dom_rŞes
);

456 
­Ş_pŞicy_»£t_domaš_Œªs_bË
(
pŞicy
);

457 
­Ş_domaš_Œªs_ª®ysis_£t_¡¬t_ty³
(
pŞicy
, 
d
, 
cur_dom_Çme
);

458 
­Ş_domaš_Œªs_ª®ysis_£t_v®id
(
pŞicy
, 
d
, 
APOL_DOMAIN_TRANS_SEARCH_VALID
);

459 
­Ş_domaš_Œªs_ª®ysis_do
(
pŞicy
, 
d
, &
v®id_»v_Œªs
);

460 
­Ş_pŞicy_»£t_domaš_Œªs_bË
(
pŞicy
);

461 
­Ş_domaš_Œªs_ª®ysis_£t_v®id
(
pŞicy
, 
d
, 
APOL_DOMAIN_TRANS_SEARCH_INVALID
);

462 
­Ş_domaš_Œªs_ª®ysis_do
(
pŞicy
, 
d
, &
šv®id_»v_Œªs
);

465 
	gj
 = 0; j < 
­Ş_veùÜ_g‘_size
(
v®id_»v_Œªs
); j++) {

466 
	gdŒ
 = 
­Ş_veùÜ_g‘_–em’t
(
v®id_»v_Œªs
, 
j
);

467 
	g¡¬t_ty³
 = 
­Ş_domaš_Œªs_»suÉ_g‘_¡¬t_ty³
(
dŒ
);

468 
	g•_ty³
 = 
­Ş_domaš_Œªs_»suÉ_g‘_’Œypošt_ty³
(
dŒ
);

469 
qpŞ_ty³_g‘_Çme
(
q
, 
¡¬t_ty³
, &
tmp_Çme
);

470 
­Ş_rŞe_qu”y_£t_ty³
(
pŞicy
, 
rŞe_q
, 
tmp_Çme
);

471 
­Ş_rŞe_g‘_by_qu”y
(
pŞicy
, 
rŞe_q
, &
¡¬t_rŞes
);

472 
	gš‹r£ù_rŞes
 = 
­Ş_veùÜ_ü—‹_äom_š‹r£ùiÚ
(
dom_rŞes
, 
¡¬t_rŞes
, 
NULL
, NULL);

473 ià(
­Ş_veùÜ_g‘_size
(
š‹r£ù_rŞes
) > 0) {

475 
	grŞe_u£rs
 = 
­Ş_veùÜ_ü—‹
(
NULL
);

476 
	gk
 = 0; k < 
­Ş_veùÜ_g‘_size
(
š‹r£ù_rŞes
); k++) {

477 
	gÏ¡_rŞe
 = 
­Ş_veùÜ_g‘_–em’t
(
š‹r£ù_rŞes
, 
k
);

478 
qpŞ_rŞe_g‘_Çme
(
q
, 
Ï¡_rŞe
, &
tmp_Çme
);

479 
­Ş_u£r_qu”y_£t_rŞe
(
pŞicy
, 
u£r_q
, 
tmp_Çme
);

480 
­Ş_u£r_g‘_by_qu”y
(
pŞicy
, 
u£r_q
, &
tmp_u£rs
);

481 ià(
­Ş_veùÜ_ÿt
(
rŞe_u£rs
, 
tmp_u£rs
)) {

482 
	g”rÜ
 = 
”ºo
;

483 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

484 
	guÄ—chabË_doms_run_ç
;

486 
­Ş_veùÜ_de¡roy
(&
tmp_u£rs
);

488 ià(
­Ş_veùÜ_g‘_size
(
rŞe_u£rs
) > 0)

489 
	gÃed
 = 
DONE
;

491 
	gÃed
 = 
USER
;

492 
­Ş_veùÜ_de¡roy
(&
rŞe_u£rs
);

494 ià(
	gÃed
 =ğ
DONE
)

497 
qpŞ_ty³_g‘_Çme
(
q
, 
•_ty³
, &
tmp_Çme
);

498 
­Ş_rŞe_Œªs_qu”y_£t_rg‘
(
pŞicy
, 
¹q
, 
tmp_Çme
, 1);

499 
­Ş_rŞe_Œªs_g‘_by_qu”y
(
pŞicy
, 
¹q
, &
rŞe_Œªs_veùÜ
);

500 
	gk
 = 0; 
	gÃed
 !ğ
DONE
 && 
k
 < 
­Ş_veùÜ_g‘_size
(
rŞe_Œªs_veùÜ
); k++) {

501 
	grŞe_Œªs
 = 
­Ş_veùÜ_g‘_–em’t
(
rŞe_Œªs_veùÜ
, 
k
);

502 
qpŞ_rŞe_Œªs_g‘_sourû_rŞe
(
q
, 
rŞe_Œªs
, &
¤c_rŞe
);

503 
qpŞ_rŞe_Œªs_g‘_deçuÉ_rŞe
(
q
, 
rŞe_Œªs
, &
dæt_rŞe
);

504 ià(
­Ş_veùÜ_g‘_šdex
(
¡¬t_rŞes
, 
¤c_rŞe
, 
NULL
, NULL, &
l
)

505 || 
­Ş_veùÜ_g‘_šdex
(
dom_rŞes
, 
dæt_rŞe
, 
NULL
, NULL, &
l
))

507 ià(
exi¡s_commÚ_u£r
(
pŞicy
, 
¡¬t_rŞes
, 
dom_rŞes
, 
NULL
, NULL, NULL)) {

508 
qpŞ_rŞe_g‘_Çme
(
q
, 
¤c_rŞe
, &
tmp_Çme
);

509 
­Ş_rŞe_®low_qu”y_£t_sourû
(
pŞicy
, 
¿q
, 
tmp_Çme
);

510 
qpŞ_rŞe_g‘_Çme
(
q
, 
dæt_rŞe
, &
tmp_Çme
);

511 
­Ş_rŞe_®low_qu”y_£t_rg‘
(
pŞicy
, 
¿q
, 
tmp_Çme
);

512 
­Ş_rŞe_®low_g‘_by_qu”y
(
pŞicy
, 
¿q
, &
rŞe_®low_veùÜ
);

513 ià(
­Ş_veùÜ_g‘_size
(
rŞe_®low_veùÜ
) > 0) {

514 
	gÃed
 = 
DONE
;

516 
	gÃed
 = 
ROLE_ALLOW
;

517 
	gÏ¡_rŞe
 = 
¤c_rŞe
;

518 
	gÏ¡_dæt
 = 
dæt_rŞe
;

520 
­Ş_veùÜ_de¡roy
(&
rŞe_®low_veùÜ
);

522 
	gÃed
 = 
COMMON_USER
;

523 
	gÏ¡_rŞe
 = 
¤c_rŞe
;

524 
	gÏ¡_dæt
 = 
dæt_rŞe
;

528 ià(
­Ş_veùÜ_g‘_size
(
rŞe_Œªs_veùÜ
) == 0) {

529 ià(
exi¡s_commÚ_u£r
(
pŞicy
, 
¡¬t_rŞes
, 
dom_rŞes
, &
¤c_rŞe
, &
dæt_rŞe
, &
Ï¡_u£r
)) {

530 
Ãed
 = 
ROLE_TRANS
;

531 
	gÏ¡_rŞe
 = 
¤c_rŞe
;

532 
	gÏ¡_dæt
 = 
dæt_rŞe
;

533 
	gÏ¡_ty³
 = 
•_ty³
;

535 
	gÃed
 = 
RBAC
;

538 
­Ş_veùÜ_de¡roy
(&
rŞe_Œªs_veùÜ
);

539 ià(
	gÃed
 =ğ
DONE
)

543 ià(
	gÃed
 =ğ
KEEP_SEARCHING
) {

544 
j
 = 0; 
	gj
 < 
­Ş_veùÜ_g‘_size
(
šv®id_»v_Œªs
); j++) {

545 
	gdŒ
 = 
­Ş_veùÜ_g‘_–em’t
(
šv®id_»v_Œªs
, 
j
);

546 
	g¡¬t_ty³
 = 
­Ş_domaš_Œªs_»suÉ_g‘_¡¬t_ty³
(
dŒ
);

547 
	g•_ty³
 = 
­Ş_domaš_Œªs_»suÉ_g‘_’Œypošt_ty³
(
dŒ
);

548 
	gŒªs_missšg
 = 
­Ş_domaš_Œªs_bË_v”ify_Œªs
(
pŞicy
, 
¡¬t_ty³
, 
•_ty³
, 
cur_dom
);

549 
	gÃed
 = 
VALID_TRANS
;

552 ià(
	g¡¬t_ty³
 && 
	g•_ty³
)

557 ià(
	gÃed
 =ğ
KEEP_SEARCHING
) {

558 
rŞe_u£rs
 = 
­Ş_veùÜ_ü—‹
(
NULL
);

559 
	gj
 = 0; j < 
­Ş_veùÜ_g‘_size
(
dom_rŞes
); j++) {

560 
	gÏ¡_rŞe
 = 
­Ş_veùÜ_g‘_–em’t
(
dom_rŞes
, 
j
);

561 
qpŞ_rŞe_g‘_Çme
(
q
, 
Ï¡_rŞe
, &
tmp_Çme
);

562 
­Ş_u£r_qu”y_£t_rŞe
(
pŞicy
, 
u£r_q
, 
tmp_Çme
);

563 
­Ş_u£r_g‘_by_qu”y
(
pŞicy
, 
u£r_q
, &
tmp_u£rs
);

564 
­Ş_veùÜ_ÿt
(
rŞe_u£rs
, 
tmp_u£rs
);

565 
­Ş_veùÜ_de¡roy
(&
tmp_u£rs
);

567 ià(
­Ş_veùÜ_g‘_size
(
dom_rŞes
) == 0) {

568 
Ãed
 = 
ROLE
;

569 } ià(
­Ş_veùÜ_g‘_size
(
rŞe_u£rs
) == 0) {

570 
Ãed
 = 
USER
;

572 
	gÃed
 = 
TRANSITION
;

574 
­Ş_veùÜ_de¡roy
(&
rŞe_u£rs
);

577 ià(
	gÃed
 !ğ
DONE
) {

578 
as£¹
(
Ãed
 !ğ
KEEP_SEARCHING
);

579 
	g™em
 = 
£chk_™em_Ãw
(
NULL
);

580 ià(!
	g™em
) {

581 
	g”rÜ
 = 
”ºo
;

582 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

583 
	guÄ—chabË_doms_run_ç
;

585 
	g™em
->™em = (*)
cur_dom
;

586 
	g™em
->
	g‹¡_»suÉ
 = ()
Ãed
;

587 
	g™em
->
	g´oof
 = 
­Ş_veùÜ_ü—‹
(
£chk_´oof_ä“
);

588 ià(!
	g™em
->
	g´oof
) {

589 
	g”rÜ
 = 
”ºo
;

590 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

591 
	guÄ—chabË_doms_run_ç
;

593 
	g´oof
 = 
£chk_´oof_Ãw
(
NULL
);

594 ià(!
	g´oof
) {

595 
	g”rÜ
 = 
”ºo
;

596 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

597 
	guÄ—chabË_doms_run_ç
;

599 
	g´oof
->
	gty³
 = 
SECHK_ITEM_NONE
;

600 
	g´oof
->
	g–em
 = 
NULL
;

601 
	gÃed
) {

602 
	gUSER
:

604 
qpŞ_rŞe_g‘_Çme
(
q
, 
Ï¡_rŞe
, &
tmp_Çme
);

605 ià(
a¥rštf
(&
´oof
->
‹xt
, "NØu£¸assocŸ‹d w™h„Ş% fÜ %s", 
tmp_Çme
, 
cur_dom_Çme
) < 0) {

606 
	g”rÜ
 = 
”ºo
;

607 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

608 
	guÄ—chabË_doms_run_ç
;

612 
	gCOMMON_USER
:

614 
qpŞ_rŞe_g‘_Çme
(
q
, 
Ï¡_rŞe
, &
tmp_Çme
);

615 
qpŞ_rŞe_g‘_Çme
(
q
, 
Ï¡_dæt
, &
tmp2
);

616 ià(
	ga¥rštf


617 (&
	g´oof
->
	g‹xt
, "Roleransition„equired but‚o user‡ssociated with„ole %s‡nd %s",

618 
	gtmp_Çme
, 
	gtmp2
) < 0) {

619 
	g”rÜ
 = 
”ºo
;

620 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

621 
	guÄ—chabË_doms_run_ç
;

625 
	gROLE_TRANS
:

627 
qpŞ_rŞe_g‘_Çme
(
q
, 
Ï¡_rŞe
, &
tmp_Çme
);

628 
qpŞ_rŞe_g‘_Çme
(
q
, 
Ï¡_dæt
, &
tmp2
);

629 
qpŞ_ty³_g‘_Çme
(
q
, 
Ï¡_ty³
, &
tmp3
);

630 ià(
a¥rštf
(&
´oof
->
‹xt
, "Missšg:„Şe_Œªs™iÚ % % %s;", 
tmp_Çme
, 
tmp3
, 
tmp2
) < 0) {

631 
	g”rÜ
 = 
”ºo
;

632 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

633 
	guÄ—chabË_doms_run_ç
;

637 
	gROLE_ALLOW
:

639 
qpŞ_rŞe_g‘_Çme
(
q
, 
Ï¡_rŞe
, &
tmp_Çme
);

640 
qpŞ_rŞe_g‘_Çme
(
q
, 
Ï¡_dæt
, &
tmp2
);

641 ià(
	ga¥rštf


642 (&
	g´oof
->
	g‹xt
,

644 
	gtmp_Çme
, 
	gtmp2
) < 0) {

645 
	g”rÜ
 = 
”ºo
;

646 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

647 
	guÄ—chabË_doms_run_ç
;

651 
	gRBAC
:

653 ià(
a¥rštf


654 (&
´oof
->
‹xt
,

656 
	gcur_dom_Çme
) < 0) {

657 
	g”rÜ
 = 
”ºo
;

658 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

659 
	guÄ—chabË_doms_run_ç
;

663 
	gVALID_TRANS
:

665 ià(
¡¬t_ty³
)

666 
qpŞ_ty³_g‘_Çme
(
q
, 
¡¬t_ty³
, &
tmp2
);

668 
	gtmp2
 = "<start_type>";

669 ià(
	g•_ty³
)

670 
qpŞ_ty³_g‘_Çme
(
q
, 
•_ty³
, &
tmp3
);

672 
	gtmp3
 = "<entrypont>";

673 ià(
	ga¥rštf


674 (&
	g´oof
->
	g‹xt
,

676 
	gcur_dom_Çme
,

677 ((
	gŒªs_missšg
 & 
	gAPOL_DOMAIN_TRANS_RULE_PROC_TRANS
è? "Missšg" : "Has"), 
	gtmp2
,

678 
	gcur_dom_Çme
, ((
	gŒªs_missšg
 & 
	gAPOL_DOMAIN_TRANS_RULE_EXEC
) ? "Missing" : "Has"),

679 
	gtmp2
, 
	gtmp3
, ((
	gŒªs_missšg
 & 
	gAPOL_DOMAIN_TRANS_RULE_ENTRYPOINT
) ? "Missing" : "Has"),

680 
	gcur_dom_Çme
, 
	gtmp3
,

681 ((
	gŒªs_missšg
 & (
	gAPOL_DOMAIN_TRANS_RULE_TYPE_TRANS
 | 
	gAPOL_DOMAIN_TRANS_RULE_SETEXEC
))

682 ? "May‚“d" : "Has"), 
	gcur_dom_Çme
, 
	gtmp2
, 
	gtmp3
, cur_dom_name) < 0) {

683 
	g”rÜ
 = 
”ºo
;

684 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

685 
	guÄ—chabË_doms_run_ç
;

689 
	gROLE
:

691 ià(
a¥rštf
(&
´oof
->
‹xt
, "NØrŞassocŸ‹d w™h domaš %s", 
cur_dom_Çme
) < 0) {

692 
	g”rÜ
 = 
”ºo
;

693 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

694 
	guÄ—chabË_doms_run_ç
;

698 
	gTRANSITION
:

700 ià(
a¥rštf
(&
´oof
->
‹xt
, "Th”¬nØŒªs™iÚ tØdomaš %s", 
cur_dom_Çme
) < 0) {

701 
	g”rÜ
 = 
”ºo
;

702 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

703 
	guÄ—chabË_doms_run_ç
;

707 
	gDONE
:

708 
KEEP_SEARCHING
:

711 
as£¹
(0);

712 
	g”rÜ
 = 
EDOM
;

713 
	guÄ—chabË_doms_run_ç
;

716 ià(
­Ş_veùÜ_­³nd
(
™em
->
´oof
, (*)proof) < 0) {

717 
	g”rÜ
 = 
”ºo
;

718 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

719 
	guÄ—chabË_doms_run_ç
;

721 
	g´oof
 = 
NULL
;

722 ià(
­Ş_veùÜ_­³nd
(
»s
->
™ems
, (*)
™em
) < 0) {

723 
	g”rÜ
 = 
”ºo
;

724 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
”rÜ
));

725 
	guÄ—chabË_doms_run_ç
;

727 
	g™em
 = 
NULL
;

729 
­Ş_veùÜ_de¡roy
(&
dom_rŞes
);

730 
­Ş_veùÜ_de¡roy
(&
v®id_»v_Œªs
);

731 
­Ş_veùÜ_de¡roy
(&
šv®id_»v_Œªs
);

734 
­Ş_veùÜ_de¡roy
(&
dom_veùÜ
);

735 
­Ş_domaš_Œªs_ª®ysis_de¡roy
(&
d
);

736 
­Ş_rŞe_qu”y_de¡roy
(&
rŞe_q
);

737 
­Ş_u£r_qu”y_de¡roy
(&
u£r_q
);

738 
­Ş_rŞe_Œªs_qu”y_de¡roy
(&
¹q
);

739 
­Ş_rŞe_®low_qu”y_de¡roy
(&
¿q
);

740 
	gmod
->
	g»suÉ
 = 
»s
;

742 ià(
­Ş_veùÜ_g‘_size
(
»s
->
™ems
))

746 
	guÄ—chabË_doms_run_ç
:

747 
­Ş_veùÜ_de¡roy
(&
dom_veùÜ
);

748 
­Ş_domaš_Œªs_ª®ysis_de¡roy
(&
d
);

749 
­Ş_rŞe_qu”y_de¡roy
(&
rŞe_q
);

750 
­Ş_u£r_qu”y_de¡roy
(&
u£r_q
);

751 
­Ş_rŞe_Œªs_qu”y_de¡roy
(&
¹q
);

752 
­Ş_rŞe_®low_qu”y_de¡roy
(&
¿q
);

753 
­Ş_veùÜ_de¡roy
(&
dom_rŞes
);

754 
­Ş_veùÜ_de¡roy
(&
v®id_»v_Œªs
);

755 
­Ş_veùÜ_de¡roy
(&
šv®id_»v_Œªs
);

756 
­Ş_veùÜ_de¡roy
(&
tmp_u£rs
);

757 
­Ş_veùÜ_de¡roy
(&
rŞe_u£rs
);

758 
­Ş_veùÜ_de¡roy
(&
rŞe_Œªs_veùÜ
);

759 
£chk_´oof_ä“
(
´oof
);

760 
£chk_™em_ä“
(
™em
);

761 
£chk_»suÉ_de¡roy
(&
»s
);

762 
	g”ºo
 = 
”rÜ
;

767 
	$uÄ—chabË_doms_d©a_ä“
(*
d©a
)

769 
uÄ—chabË_doms_d©a_t
 *
d
 = 
d©a
;

770 ià(!
d©a
)

773 
	`ä“
(
d
->
ùx_fe_·th
);

774 
	`­Ş_veùÜ_de¡roy
(&
d
->
ùx_veùÜ
);

775 
	`ä“
(
d©a
);

776 
	}
}

779 
uÄ—chabË_doms_´št
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

781 
uÄ—chabË_doms_d©a_t
 *
	gd©um
 = 
NULL
;

782 
	goutfÜm©
 = 0x00;

783 
£chk_™em_t
 *
	g™em
 = 
NULL
;

784 
£chk_´oof_t
 *
	g´oof
 = 
NULL
;

785 
size_t
 
	gi
 = 0, 
	gj
 = 0, 
	gk
, 
	gl
, 
	gnum_™ems
;

786 cÚ¡ 
qpŞ_ty³_t
 *
	gty³
;

787 
qpŞ_pŞicy_t
 *
	gq
 = 
­Ş_pŞicy_g‘_qpŞ
(
pŞicy
);

788 cÚ¡ *
	gty³_Çme
;

790 ià(!
	gmod
 || !
	gpŞicy
) {

791 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
EINVAL
));

792 
	g”ºo
 = 
EINVAL
;

795 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

796 
ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

797 
	g”ºo
 = 
EINVAL
;

801 
	gd©um
 = (
uÄ—chabË_doms_d©a_t
 *è
mod
->
d©a
;

802 
	goutfÜm©
 = 
mod
->
ouutfÜm©
;

803 
	gnum_™ems
 = 
­Ş_veùÜ_g‘_size
(
mod
->
»suÉ
->
™ems
);

805 ià(!
	gmod
->
	g»suÉ
) {

806 
ERR
(
pŞicy
, "%s", "Module has‚ot been„un");

807 
	g”ºo
 = 
EINVAL
;

811 ià(!
	goutfÜm©
 || (outfÜm© & 
	gSECHK_OUT_QUIET
))

814 ià(
	goutfÜm©
 & 
	gSECHK_OUT_STATS
) {

815 
´štf
("Found %zd uÄ—chabË domašs.\n", 
num_™ems
);

818 ià(
	goutfÜm©
 & 
	gSECHK_OUT_LIST
) {

819 
´štf
("\n");

820 
	gi
 = 0; i < 
	gnum_™ems
; i++) {

821 
	gj
++;

822 
	gj
 %= 4;

823 
	g™em
 = 
­Ş_veùÜ_g‘_–em’t
(
mod
->
»suÉ
->
™ems
, 
i
);

824 
	gty³
 = (
qpŞ_ty³_t
 *è
™em
->item;

825 
qpŞ_ty³_g‘_Çme
(
q
, 
ty³
, &
ty³_Çme
);

826 
´štf
("%s%s", 
ty³_Çme
, (*)((
j
 && 
i
 !ğ
num_™ems
 - 1) ? ", " : "\n"));

828 
´štf
("\n");

831 ià(
	goutfÜm©
 & 
	gSECHK_OUT_PROOF
) {

832 ià(
­Ş_veùÜ_g‘_size
(
d©um
->
ùx_veùÜ
) > 0) {

833 
´štf
("Found %zd domaš š %s:\n", 
­Ş_veùÜ_g‘_size
(
d©um
->
ùx_veùÜ
),

834 
£lšux_deçuÉ_cÚ‹xt_·th
());

835 
	gj
 = 0; j < 
­Ş_veùÜ_g‘_size
(
d©um
->
ùx_veùÜ
); j++) {

836 
	gty³_Çme
 = 
­Ş_veùÜ_g‘_–em’t
(
d©um
->
ùx_veùÜ
, 
j
);

837 
´štf
("\t%s\n", 
ty³_Çme
);

841 
´štf
("\n");

842 
	gk
 = 0; k < 
	gnum_™ems
; k++) {

843 
	g™em
 = 
­Ş_veùÜ_g‘_–em’t
(
mod
->
»suÉ
->
™ems
, 
k
);

844 ià(
	g™em
) {

845 
	gty³
 = 
™em
->item;

846 
qpŞ_ty³_g‘_Çme
(
q
, 
ty³
, &
ty³_Çme
);

847 
´štf
("%s\n", (*)
ty³_Çme
);

848 
	gl
 = 0;† < 
­Ş_veùÜ_g‘_size
(
™em
->
´oof
);†++) {

849 
	g´oof
 = 
­Ş_veùÜ_g‘_–em’t
(
™em
->
´oof
, 
l
);

850 ià(
	g´oof
)

851 
´štf
("\t%s\n", 
´oof
->
‹xt
);

854 
´štf
("\n");

863 
uÄ—chabË_doms_d©a_t
 *
	$uÄ—chabË_doms_d©a_Ãw
()

865 
uÄ—chabË_doms_d©a_t
 *
d©um
 = 
NULL
;

867 
d©um
 = (
uÄ—chabË_doms_d©a_t
 *è
	`ÿÎoc
(1, (unreachable_doms_data_t));

869  
d©um
;

870 
	}
}

874 
boŞ
 
	$·r£_deçuÉ_cÚ‹xts
(cÚ¡ *
ùx_fe_·th
, 
­Ş_veùÜ_t
 * 
ùx_veùÜ
, 
­Ş_pŞicy_t
 * 
pŞicy
)

876 
¡r_sz
, 
i
, 
ch¬no
, 
”rÜ
 = 0, 
»tv
;

877 
FILE
 *
ùx_fe
;

878 *
lše
 = 
NULL
, *
¤c_rŞe
 = NULL, *
¤c_dom
 = NULL, *
d¡_rŞe
 = NULL, *
d¡_dom
 = NULL;

879 
size_t
 
lše_Ën
 = 0;

880 
boŞ
 
u£s_mls
 = 
çl£
;

882 
	`´štf
("Usšg deçuÉ cÚ‹xts: %s\n", 
ùx_fe_·th
);

883 
ùx_fe
 = 
	`fİ’
(
ùx_fe_·th
, "r");

884 ià(!
ùx_fe
) {

885 
”rÜ
 = 
”ºo
;

886 
	`ERR
(
pŞicy
, "O³nšg deçuÉ cÚ‹xt f%s", 
ùx_fe_·th
);

887 
·r£_deçuÉ_cÚ‹xts_ç
;

890 !
	`ãof
(
ùx_fe
)) {

891 
»tv
 = 
	`g‘lše
(&
lše
, &
lše_Ën
, 
ùx_fe
);

892 ià(
»tv
 == -1) {

893 ià(
	`ãof
(
ùx_fe
)) {

896 
”rÜ
 = 
”ºo
;

897 
	`ERR
(
pŞicy
, "%s", "Reading default contexts file");

898 
·r£_deçuÉ_cÚ‹xts_ç
;

902 
u£s_mls
 = 
çl£
;

903 
¡r_sz
 = 
APOL_STR_SZ
 + 128;

904 
i
 = 0;

907 
¤c_rŞe
 = 
	`m®loc
(
¡r_sz
);

908 ià(!
¤c_rŞe
) {

909 
”rÜ
 = 
”ºo
;

910 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

911 
·r£_deçuÉ_cÚ‹xts_ç
;

914 
	`mem£t
(
¤c_rŞe
, 0x0, 
¡r_sz
);

915 
ch¬no
 = 0;

916 
lše
[
i
] != ':') {

917 ià(!
	`is¥aû
(
lše
[
i
])) {

918 
¤c_rŞe
[
i
] = 
lše
[i];

919 
ch¬no
++;

921 
i
++;

923 
i
++;

926 
¤c_dom
 = 
	`m®loc
(
¡r_sz
);

927 ià(!
¤c_dom
) {

928 
”rÜ
 = 
”ºo
;

929 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

930 
·r£_deçuÉ_cÚ‹xts_ç
;

932 
	`mem£t
(
¤c_dom
, 0x0, 
¡r_sz
);

933 
ch¬no
 = 0;

935 ià(
	`is¥aû
(
lše
[
i
]))

938 ià(
lše
[
i
] == ':') {

939 
u£s_mls
 = 
Œue
;

940 
i
++;

941 !
	`is¥aû
(
lše
[
i
]))

942 
i
++;

944 ià(
u£s_mls
)

947 
¤c_dom
[
ch¬no
] = 
lše
[
i
];

948 
ch¬no
++;

949 
i
++;

953 
d¡_rŞe
 = 
	`m®loc
(
¡r_sz
);

954 ià(!
d¡_rŞe
) {

955 
”rÜ
 = 
”ºo
;

956 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

957 
·r£_deçuÉ_cÚ‹xts_ç
;

959 
	`mem£t
(
d¡_rŞe
, 0x0, 
¡r_sz
);

960 
ch¬no
 = 0;

961 
lše
[
i
] != ':') {

962 ià(!
	`is¥aû
(
lše
[
i
])) {

963 
d¡_rŞe
[
ch¬no
] = 
lše
[
i
];

964 
ch¬no
++;

967 
i
++;

969 
i
++;

972 
d¡_dom
 = 
	`m®loc
(
¡r_sz
);

973 ià(!
d¡_dom
) {

974 
”rÜ
 = 
”ºo
;

975 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

976 
·r£_deçuÉ_cÚ‹xts_ç
;

978 
	`mem£t
(
d¡_dom
, 0x0, 
¡r_sz
);

979 
ch¬no
 = 0;

980 
lše
[
i
]) {

981 ià(
u£s_mls
)

982 ià(
lše
[
i
] == ':')

985 ià(!
	`is¥aû
(
lše
[
i
]))

986 
d¡_dom
[
ch¬no
] = 
lše
[
i
];

988 
ch¬no
++;

989 
i
++;

992 ià(
	`­Ş_veùÜ_­³nd
(
ùx_veùÜ
, (*)
	`¡rdup
(
¤c_dom
)) < 0) {

993 
”rÜ
 = 
”ºo
;

994 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

995 
·r£_deçuÉ_cÚ‹xts_ç
;

997 
	`ä“
(
lše
);

998 
lše
 = 
NULL
;

999 
	`ä“
(
¤c_rŞe
);

1000 
	`ä“
(
¤c_dom
);

1001 
	`ä“
(
d¡_rŞe
);

1002 
	`ä“
(
d¡_dom
);

1004 
	`ä“
(
lše
);

1005 
	`fşo£
(
ùx_fe
);

1006  
Œue
;

1007 
·r£_deçuÉ_cÚ‹xts_ç
:

1008 ià(
ùx_fe
 !ğ
NULL
) {

1009 
	`fşo£
(
ùx_fe
);

1011 
	`ä“
(
lše
);

1012 
	`ä“
(
¤c_rŞe
);

1013 
	`ä“
(
¤c_dom
);

1014 
	`ä“
(
d¡_rŞe
);

1015 
	`ä“
(
d¡_dom
);

1016 
”ºo
 = 
”rÜ
;

1017  
çl£
;

1018 
	}
}

1021 
boŞ
 
	$š_def_ùx
(cÚ¡ *
ty³_Çme
, 
uÄ—chabË_doms_d©a_t
 * 
d©um
)

1023 
size_t
 
i
;

1024 ià(
	`­Ş_veùÜ_g‘_šdex
(
d©um
->
ùx_veùÜ
, 
ty³_Çme
, 
­Ş_¡r_¡rcmp
, 
NULL
, &
i
) < 0) {

1025  
çl£
;

1027  
Œue
;

1028 
	}
}

1031 
boŞ
 
	$š_isid_ùx
(cÚ¡ *
ty³_Çme
, 
­Ş_pŞicy_t
 * 
pŞicy
)

1033 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

1034 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicy
);

1035 
	`qpŞ_pŞicy_g‘_isid_™”
(
q
, &
™”
);

1036 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

1037 cÚ¡ 
qpŞ_isid_t
 *
isid
;

1038 cÚ¡ 
qpŞ_cÚ‹xt_t
 *
ocÚ
;

1039 cÚ¡ 
qpŞ_ty³_t
 *
cÚ‹xt_ty³
;

1040 cÚ¡ *
cÚ‹xt_ty³_Çme
;

1042 
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
isid
);

1043 
	`qpŞ_isid_g‘_cÚ‹xt
(
q
, 
isid
, &
ocÚ
);

1044 
	`qpŞ_cÚ‹xt_g‘_ty³
(
q
, 
ocÚ
, &
cÚ‹xt_ty³
);

1045 
	`qpŞ_ty³_g‘_Çme
(
q
, 
cÚ‹xt_ty³
, &
cÚ‹xt_ty³_Çme
);

1046 ià(!
	`¡rcmp
(
ty³_Çme
, 
cÚ‹xt_ty³_Çme
)) {

1047 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

1048  
Œue
;

1051 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

1052  
çl£
;

1053 
	}
}

	@sechecker/modules/unreachable_doms.h

27 #iâdeà
UNREACHABLE_DOMS


28 
	#UNREACHABLE_DOMS


	)

30 #ifdef 
__ılu¥lus


35 
	~"£check”.h
"

36 
	~<­Ş/pŞicy.h
>

37 
	~<­Ş/u£r-qu”y.h
>

38 
	~<­Ş/rŞe-qu”y.h
>

39 
	~<­Ş/isid-qu”y.h
>

40 
	~<­Ş/rbaüuË-qu”y.h
>

41 
	~<­Ş/domaš-Œªs-ª®ysis.h
>

42 
	~<£lšux/£lšux.h
>

44 
	#SECHK_INC_DOM_TRANS_HAS_TT
 0x08

	)

45 
	#SECHK_INC_DOM_TRANS_HAS_EXEC
 0x04

	)

46 
	#SECHK_INC_DOM_TRANS_HAS_TRANS
 0x02

	)

47 
	#SECHK_INC_DOM_TRANS_HAS_EP
 0x01

	)

48 
	#SECHK_INC_DOM_TRANS_COMPLETE
 (
SECHK_INC_DOM_TRANS_HAS_EP
|
SECHK_INC_DOM_TRANS_HAS_TRANS
|
SECHK_INC_DOM_TRANS_HAS_EXEC
)

	)

50 
	#APOL_STR_SZ
 128

	)

54 
	suÄ—chabË_doms_d©a


56 *
ùx_fe_·th
;

58 
­Ş_veùÜ_t
 *
ùx_veùÜ
;

59 } 
	tuÄ—chabË_doms_d©a_t
;

61 
uÄ—chabË_doms_d©a_t
 *
uÄ—chabË_doms_d©a_Ãw
();

62 
uÄ—chabË_doms_d©a_ä“
(*
d©a
);

64 
uÄ—chabË_doms_»gi¡”
(
£chk_lib_t
 * 
lib
);

65 
uÄ—chabË_doms_š™
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

66 
uÄ—chabË_doms_run
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

67 
uÄ—chabË_doms_´št
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

69 #ifdef 
__ılu¥lus


	@sechecker/modules/users_wo_roles.c

26 
	~"u£rs_wo_rŞes.h
"

28 
	~<¡dio.h
>

29 
	~<¡ršg.h
>

30 
	~<”ºo.h
>

35 cÚ¡ *cÚ¡ 
	gmod_Çme
 = "users_wo_roles";

39 
	$u£rs_wo_rŞes_»gi¡”
(
£chk_lib_t
 * 
lib
)

41 
£chk_moduË_t
 *
mod
 = 
NULL
;

42 
£chk_â_t
 *
â_¡ruù
 = 
NULL
;

44 ià(!
lib
) {

45 
	`ERR
(
NULL
, "%s", "No†ibrary");

46 
”ºo
 = 
EINVAL
;

53 
mod
 = 
	`£chk_lib_g‘_moduË
(
mod_Çme
, 
lib
);

54 ià(!
mod
) {

55 
	`ERR
(
NULL
, "%s", "Module unknown");

56 
”ºo
 = 
EINVAL
;

59 
mod
->
·»Á_lib
 = 
lib
;

62 
mod
->
br›f_desütiÚ
 = "users with‚o„oles";

63 
mod
->
d‘aed_desütiÚ
 =

70 
mod
->
İt_desütiÚ
 =

72 
mod
->
£v”™y
 = 
SECHK_SEV_LOW
;

74 
â_¡ruù
 = 
	`£chk_â_Ãw
();

75 ià(!
â_¡ruù
) {

76 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

77 
”ºo
 = 
ENOMEM
;

80 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_INIT
);

81 ià(!
â_¡ruù
->
Çme
) {

82 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

83 
”ºo
 = 
ENOMEM
;

86 
â_¡ruù
->
â
 = 
u£rs_wo_rŞes_š™
;

87 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
) < 0) {

88 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

89 
”ºo
 = 
ENOMEM
;

93 
â_¡ruù
 = 
	`£chk_â_Ãw
();

94 ià(!
â_¡ruù
) {

95 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

96 
”ºo
 = 
ENOMEM
;

99 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_RUN
);

100 ià(!
â_¡ruù
->
Çme
) {

101 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

102 
”ºo
 = 
ENOMEM
;

105 
â_¡ruù
->
â
 = 
u£rs_wo_rŞes_run
;

106 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
) < 0) {

107 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

108 
”ºo
 = 
ENOMEM
;

112 
mod
->
d©a_ä“
 = 
NULL
;

114 
â_¡ruù
 = 
	`£chk_â_Ãw
();

115 ià(!
â_¡ruù
) {

116 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

117 
”ºo
 = 
ENOMEM
;

120 
â_¡ruù
->
Çme
 = 
	`¡rdup
(
SECHK_MOD_FN_PRINT
);

121 ià(!
â_¡ruù
->
Çme
) {

122 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

123 
”ºo
 = 
ENOMEM
;

126 
â_¡ruù
->
â
 = 
u£rs_wo_rŞes_´št
;

127 ià(
	`­Ş_veùÜ_­³nd
(
mod
->
funùiÚs
, (*)
â_¡ruù
) < 0) {

128 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

129 
”ºo
 = 
ENOMEM
;

134 
	}
}

139 
u£rs_wo_rŞes_š™
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

141 ià(!
	gmod
 || !
	gpŞicy
) {

142 
ERR
(
pŞicy
, "%s", "Invalid…arameters");

143 
	g”ºo
 = 
EINVAL
;

146 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

147 
ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

148 
	g”ºo
 = 
EINVAL
;

152 
	gmod
->
	gd©a
 = 
NULL
;

161 
u£rs_wo_rŞes_run
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

163 
£chk_»suÉ_t
 *
	g»s
 = 
NULL
;

164 
£chk_™em_t
 *
	g™em
 = 
NULL
;

165 
£chk_´oof_t
 *
	g´oof
 = 
NULL
;

166 
size_t
 
	gi
;

167 
­Ş_veùÜ_t
 *
	gu£r_veùÜ
;

168 
	g”rÜ
 = 0;

170 ià(!
	gmod
 || !
	gpŞicy
) {

171 
ERR
(
pŞicy
, "%s", "Invalid…arameters");

172 
	g”ºo
 = 
EINVAL
;

175 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

176 
ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

177 
	g”ºo
 = 
EINVAL
;

182 ià(
	gmod
->
	g»suÉ
)

185 
	g»s
 = 
£chk_»suÉ_Ãw
();

186 ià(!
	g»s
) {

187 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

188 
	g”ºo
 = 
ENOMEM
;

191 
	g»s
->
	g‹¡_Çme
 = 
¡rdup
(
mod_Çme
);

192 ià(!
	g»s
->
	g‹¡_Çme
) {

193 
	g”rÜ
 = 
”ºo
;

194 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

195 
	gu£rs_wo_rŞes_run_ç
;

197 
	g»s
->
	g™em_ty³
 = 
SECHK_ITEM_USER
;

198 ià(!(
	g»s
->
	g™ems
 = 
­Ş_veùÜ_ü—‹
(
£chk_™em_ä“
))) {

199 
”rÜ
 = 
”ºo
;

200 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

201 
	gu£rs_wo_rŞes_run_ç
;

204 
­Ş_u£r_g‘_by_qu”y
(
pŞicy
, 
NULL
, &
u£r_veùÜ
);

205 
	gi
 = 0; i < 
­Ş_veùÜ_g‘_size
(
u£r_veùÜ
); i++) {

206 
qpŞ_u£r_t
 *
	gu£r
;

207 
qpŞ_™”©Ü_t
 *
	grŞe_™”
;

209 
	gu£r
 = 
­Ş_veùÜ_g‘_–em’t
(
u£r_veùÜ
, 
i
);

210 
qpŞ_u£r_g‘_rŞe_™”
(
­Ş_pŞicy_g‘_qpŞ
(
pŞicy
), 
u£r
, &
rŞe_™”
);

211 ià(!
qpŞ_™”©Ü_’d
(
rŞe_™”
)) {

212 
qpŞ_™”©Ü_de¡roy
(&
rŞe_™”
);

215 
qpŞ_™”©Ü_de¡roy
(&
rŞe_™”
);

217 
	g´oof
 = 
£chk_´oof_Ãw
(
NULL
);

218 ià(!
	g´oof
) {

219 
	g”rÜ
 = 
”ºo
;

220 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

221 
	gu£rs_wo_rŞes_run_ç
;

223 
	g´oof
->
	gty³
 = 
SECHK_ITEM_USER
;

224 
	g´oof
->
	g‹xt
 = "User has‚o„oles.\n";

225 
	g™em
 = 
£chk_™em_Ãw
(
NULL
);

226 ià(!
	g™em
) {

227 
	g”rÜ
 = 
”ºo
;

228 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

229 
	gu£rs_wo_rŞes_run_ç
;

231 
	g™em
->™em = (*)
u£r
;

232 ià(!
	g™em
->
	g´oof
) {

233 ià(!(
	g™em
->
	g´oof
 = 
­Ş_veùÜ_ü—‹
(
£chk_´oof_ä“
))) {

234 
”rÜ
 = 
”ºo
;

235 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

236 
	gu£rs_wo_rŞes_run_ç
;

239 ià(
­Ş_veùÜ_­³nd
(
™em
->
´oof
, (*)proof) < 0) {

240 
	g”rÜ
 = 
”ºo
;

241 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

242 
	gu£rs_wo_rŞes_run_ç
;

244 ià(
­Ş_veùÜ_­³nd
(
»s
->
™ems
, (*)
™em
) < 0) {

245 
	g”rÜ
 = 
”ºo
;

246 
ERR
(
pŞicy
, "%s", 
¡»¼Ü
(
ENOMEM
));

247 
	gu£rs_wo_rŞes_run_ç
;

250 
­Ş_veùÜ_de¡roy
(&
u£r_veùÜ
);

252 
	gmod
->
	g»suÉ
 = 
»s
;

254 ià(
­Ş_veùÜ_g‘_size
(
»s
->
™ems
))

258 
	gu£rs_wo_rŞes_run_ç
:

259 
£chk_´oof_ä“
(
´oof
);

260 
£chk_™em_ä“
(
™em
);

261 
£chk_»suÉ_de¡roy
(&
»s
);

262 
	g”ºo
 = 
”rÜ
;

268 
u£rs_wo_rŞes_´št
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

270 
	goutfÜm©
 = 0x00;

271 
£chk_™em_t
 *
	g™em
 = 
NULL
;

272 
size_t
 
	gi
 = 0, 
	gj
 = 0, 
	gnum_™ems
;

273 cÚ¡ 
qpŞ_u£r_t
 *
	gu£r
;

274 cÚ¡ *
	gu£r_Çme
;

276 ià(!
	gmod
 || !
	gpŞicy
) {

277 
ERR
(
pŞicy
, "%s", "Invalid…arameters");

278 
	g”ºo
 = 
EINVAL
;

281 ià(
¡rcmp
(
mod_Çme
, 
mod
->
Çme
)) {

282 
ERR
(
pŞicy
, "WrÚg moduË (%s)", 
mod
->
Çme
);

283 
	g”ºo
 = 
EINVAL
;

287 
	goutfÜm©
 = 
mod
->
ouutfÜm©
;

288 
	gnum_™ems
 = 
­Ş_veùÜ_g‘_size
(
mod
->
»suÉ
->
™ems
);

290 ià(!
	goutfÜm©
 || (outfÜm© & 
	gSECHK_OUT_QUIET
))

293 ià(!
	gmod
->
	g»suÉ
) {

294 
ERR
(
pŞicy
, "%s", "Module has‚ot been„un");

295 
	g”ºo
 = 
EINVAL
;

300 ià(
	goutfÜm©
 & 
	gSECHK_OUT_STATS
) {

301 
´štf
("Found %zd u£rs.\n", 
num_™ems
);

303 ià(
	goutfÜm©
 & 
	gSECHK_OUT_PROOF
) {

304 
´štf
("\nThe following users have‚o‡ssociated„oles.\n");

308 ià(
	goutfÜm©
 & (
	gSECHK_OUT_LIST
 | 
	gSECHK_OUT_PROOF
)) {

309 
´štf
("\n");

310 
	gi
 = 0; i < 
	gnum_™ems
; i++) {

311 
	gj
++;

312 
	gj
 %= 4;

313 
	g™em
 = 
­Ş_veùÜ_g‘_–em’t
(
mod
->
»suÉ
->
™ems
, 
i
);

314 
	gu£r
 = (
qpŞ_u£r_t
 *è
™em
->item;

315 
qpŞ_u£r_g‘_Çme
(
­Ş_pŞicy_g‘_qpŞ
(
pŞicy
), 
u£r
, &
u£r_Çme
);

316 
´štf
("%s%s", 
u£r_Çme
, (*)((
j
 && 
i
 !ğ
num_™ems
 - 1) ? ", " : "\n"));

318 
´štf
("\n");

	@sechecker/modules/users_wo_roles.h

26 #iâdeà
USERS_WO_ROLES


27 
	#USERS_WO_ROLES


	)

29 #ifdef 
__ılu¥lus


34 
	~"£check”.h
"

35 
	~<­Ş/pŞicy.h
>

36 
	~<­Ş/u£r-qu”y.h
>

38 
u£rs_wo_rŞes_»gi¡”
(
£chk_lib_t
 * 
lib
);

39 
u£rs_wo_rŞes_š™
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

40 
u£rs_wo_rŞes_run
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

41 
u£rs_wo_rŞes_´št
(
£chk_moduË_t
 * 
mod
, 
­Ş_pŞicy_t
 * 
pŞicy
, *
¬g
);

43 #ifdef 
__ılu¥lus


	@sechecker/register_list.c

24 
	~"»gi¡”_li¡.h
"

26 
size_t
 
	g£chk_»gi¡”_num_moduËs
 = 0;

27 
size_t
 
	g£chk_»gi¡”_num_´ofes
 = 0;

30 
£chk_moduË_Çme_»g_t
 
	g£chk_moduË_»gi¡”_li¡
[] = {

31 {"©Œibs_wo_ruËs", &
©Œibs_wo_ruËs_»gi¡”
},

32 {"©Œibs_wo_ty³s", &
©Œibs_wo_ty³s_»gi¡”
},

33 {"domaš_ªd_fe", &
domaš_ªd_fe_»gi¡”
},

34 {"domašs_wo_rŞes", &
domašs_wo_rŞes_»gi¡”
},

35 {"fšd_assoc_ty³s", &
fšd_assoc_ty³s_»gi¡”
},

36 {"fšd_domašs", &
fšd_domašs_»gi¡”
},

37 {"fšd_fe_ty³s", &
fšd_fe_ty³s_»gi¡”
},

38 {"fšd_Ãt_domašs", &
fšd_Ãt_domašs_»gi¡”
},

39 {"fšd_node_ty³s", &
fšd_node_ty³s_»gi¡”
},

40 {"fšd_Ãtif_ty³s", &
fšd_Ãtif_ty³s_»gi¡”
},

41 {"fšd_pÜt_ty³s", &
fšd_pÜt_ty³s_»gi¡”
},

42 {"imp_¿nge_Œªs", &
imp_¿nge_Œªs_»gi¡”
},

43 {"šc_dom_Œªs", &
šc_dom_Œªs_»gi¡”
},

44 {"šc_mouÁ", &
šc_mouÁ_»gi¡”
},

45 {"šc_Ãt_acûss", &
šc_Ãt_acûss_»gi¡”
},

46 {"rŞes_wo_®low", &
rŞes_wo_®low_»gi¡”
},

47 {"rŞes_wo_ty³s", &
rŞes_wo_ty³s_»gi¡”
},

48 {"rŞes_wo_u£rs", &
rŞes_wo_u£rs_»gi¡”
},

52 {"¥urious_aud™", &
¥urious_aud™_»gi¡”
},

53 {"ty³s_wo_®low", &
ty³s_wo_®low_»gi¡”
},

54 {"uÄ—chabË_doms", &
uÄ—chabË_doms_»gi¡”
},

55 {"u£rs_wo_rŞes", &
u£rs_wo_rŞes_»gi¡”
},

58 {
NULL
, NULL}

62 
£chk_´ofe_Çme_»g_t
 
	g£chk_´ofe_»gi¡”_li¡
[] = {

69 {
NULL
, NULL, NULL}

72 
size_t
 
	$£chk_»gi¡”_li¡_g‘_num_´ofes
()

74 
size_t
 
i
;

75 ià(
£chk_»gi¡”_num_´ofes
 != 0)

76  
£chk_»gi¡”_num_´ofes
;

77 
i
 = 0; 
£chk_´ofe_»gi¡”_li¡
[i].
Çme
 !ğ
NULL
; i++) ;

79 
£chk_»gi¡”_num_´ofes
 = 
i
;

80  
£chk_»gi¡”_num_´ofes
;

81 
	}
}

83 cÚ¡ 
£chk_´ofe_Çme_»g_t
 *
	$£chk_»gi¡”_li¡_g‘_´ofes
()

85  
£chk_´ofe_»gi¡”_li¡
;

86 
	}
}

88 
size_t
 
	$£chk_»gi¡”_li¡_g‘_num_moduËs
()

90 
size_t
 
i
;

91 ià(
£chk_»gi¡”_num_moduËs
 != 0)

92  
£chk_»gi¡”_num_moduËs
;

93 
i
 = 0; 
£chk_moduË_»gi¡”_li¡
[i].
Çme
 !ğ
NULL
; i++) ;

95 
£chk_»gi¡”_num_moduËs
 = 
i
;

96  
£chk_»gi¡”_num_moduËs
;

97 
	}
}

99 cÚ¡ 
£chk_moduË_Çme_»g_t
 *
	$£chk_»gi¡”_li¡_g‘_moduËs
()

101  
£chk_moduË_»gi¡”_li¡
;

102 
	}
}

	@sechecker/register_list.h

22 #iâdeà
SECHK_REGISTER_LIST_H


23 
	#SECHK_REGISTER_LIST_H


	)

25 
	~"£check”.h
"

33 
fšd_domašs_»gi¡”
(
£chk_lib_t
 * 
lib
);

34 
fšd_fe_ty³s_»gi¡”
(
£chk_lib_t
 * 
lib
);

35 
domaš_ªd_fe_»gi¡”
(
£chk_lib_t
 * 
lib
);

36 
©Œibs_wo_ty³s_»gi¡”
(
£chk_lib_t
 * 
lib
);

37 
rŞes_wo_ty³s_»gi¡”
(
£chk_lib_t
 * 
lib
);

38 
u£rs_wo_rŞes_»gi¡”
(
£chk_lib_t
 * 
lib
);

39 
rŞes_wo_®low_»gi¡”
(
£chk_lib_t
 * 
lib
);

40 
ty³s_wo_®low_»gi¡”
(
£chk_lib_t
 * 
lib
);

41 
¥urious_aud™_»gi¡”
(
£chk_lib_t
 * 
lib
);

42 
©Œibs_wo_ruËs_»gi¡”
(
£chk_lib_t
 * 
lib
);

43 
šc_mouÁ_»gi¡”
(
£chk_lib_t
 * 
lib
);

44 
rŞes_wo_u£rs_»gi¡”
(
£chk_lib_t
 * 
lib
);

48 
domašs_wo_rŞes_»gi¡”
(
£chk_lib_t
 * 
lib
);

49 
šc_dom_Œªs_»gi¡”
(
£chk_lib_t
 * 
lib
);

50 
fšd_pÜt_ty³s_»gi¡”
(
£chk_lib_t
 * 
lib
);

51 
fšd_node_ty³s_»gi¡”
(
£chk_lib_t
 * 
lib
);

52 
fšd_Ãtif_ty³s_»gi¡”
(
£chk_lib_t
 * 
lib
);

53 
fšd_assoc_ty³s_»gi¡”
(
£chk_lib_t
 * 
lib
);

54 
fšd_Ãt_domašs_»gi¡”
(
£chk_lib_t
 * 
lib
);

55 
šc_Ãt_acûss_»gi¡”
(
£chk_lib_t
 * 
lib
);

56 
uÄ—chabË_doms_»gi¡”
(
£chk_lib_t
 * 
lib
);

57 
imp_¿nge_Œªs_»gi¡”
(
£chk_lib_t
 * 
lib
);

60 
size_t
 
£chk_»gi¡”_li¡_g‘_num_moduËs
();

61 cÚ¡ 
£chk_moduË_Çme_»g_t
 *
£chk_»gi¡”_li¡_g‘_moduËs
();

62 
size_t
 
£chk_»gi¡”_li¡_g‘_num_´ofes
();

63 cÚ¡ 
£chk_´ofe_Çme_»g_t
 *
£chk_»gi¡”_li¡_g‘_´ofes
();

	@sechecker/sechecker.c

26 
	~"£check”.h
"

27 
	~"»gi¡”_li¡.h
"

28 
	~"£chk_·r£.h
"

29 
	~<as£¹.h
>

30 
	~<dœ’t.h
>

31 
	~<”ºo.h
>

32 
	~<¡dio.h
>

33 
	~<¡ršg.h
>

34 
	~<uni¡d.h
>

35 
	~<sys/ty³s.h
>

36 
	~<sys/¡©.h
>

37 
	~<­Ş/pŞicy.h
>

38 
	~<­Ş/ut.h
>

39 
	~<­Ş/veùÜ.h
>

41 
	~<£fs/ut.h
>

42 
	~<£fs/fcfe.hh
>

43 
	~<£fs/qu”y.hh
>

45 #ifdeà
LIBSELINUX


46 
	~<£lšux/£lšux.h
>

49 
	~<qpŞ/pŞicy.h
>

50 
	~<qpŞ/ut.h
>

52 
	$£chk_lib_com·»_£v
(cÚ¡ *
a
, cÚ¡ *
b
)

54 
av®
, 
bv®
;

56 ià(
a
 =ğ
NULL
 || 
b
 == NULL) {

57 
	`as£¹
(
çl£
);

58 
”ºo
 = 
EINVAL
;

62 ià(
	`¡rcmp
(
a
, 
SECHK_SEV_NONE
) == 0)

63 
av®
 = 0;

64 ià(
	`¡rcmp
(
a
, 
SECHK_SEV_LOW
) == 0)

65 
av®
 = 1;

66 ià(
	`¡rcmp
(
a
, 
SECHK_SEV_MED
) == 0)

67 
av®
 = 2;

68 ià(
	`¡rcmp
(
a
, 
SECHK_SEV_HIGH
) == 0)

69 
av®
 = 3;

71 
	`as£¹
(
çl£
);

72 
”ºo
 = 
EINVAL
;

76 ià(
	`¡rcmp
(
b
, 
SECHK_SEV_NONE
) == 0)

77 
bv®
 = 0;

78 ià(
	`¡rcmp
(
b
, 
SECHK_SEV_LOW
) == 0)

79 
bv®
 = 1;

80 ià(
	`¡rcmp
(
b
, 
SECHK_SEV_MED
) == 0)

81 
bv®
 = 2;

82 ià(
	`¡rcmp
(
b
, 
SECHK_SEV_HIGH
) == 0)

83 
bv®
 = 3;

85 
	`as£¹
(
çl£
);

86 
”ºo
 = 
EINVAL
;

90 ià(
av®
 =ğ
bv®
)

93  
av®
 < 
bv®
 ? -1 : 1;

94 
	}
}

96 
	$£chk_lib_£t_mš£v
(cÚ¡ *
mš£v
, 
£chk_lib_t
 * 
lib
)

98 ià(
lib
 =ğ
NULL
 ||†ib->
pŞicy
 =ğNULL || 
mš£v
 == NULL) {

99 
	`as£¹
(
çl£
);

100 
”ºo
 = 
EINVAL
;

104 ià(
	`¡rcmp
(
mš£v
, 
SECHK_SEV_LOW
) == 0)

105 
lib
->
mš£v
 = 
SECHK_SEV_LOW
;

106 ià(
	`¡rcmp
(
mš£v
, 
SECHK_SEV_MED
) == 0)

107 
lib
->
mš£v
 = 
SECHK_SEV_MED
;

108 ià(
	`¡rcmp
(
mš£v
, 
SECHK_SEV_HIGH
) == 0)

109 
lib
->
mš£v
 = 
SECHK_SEV_HIGH
;

111 
	`ERR
(
lib
->
pŞicy
, "%s", "Invalid severity.");

112 
”ºo
 = 
EINVAL
;

116 
	}
}

118 
£chk_moduË_t
 *
	$£chk_moduË_Ãw
()

120 
£chk_moduË_t
 *
mod
 = 
NULL
;

121 
”rÜ
 = 0;

123 
mod
 = 
	`ÿÎoc
(1, (
£chk_moduË_t
));

124 ià(!
mod
)

125  
NULL
;

128 ià(!(
mod
->
İtiÚs
 = 
	`­Ş_veùÜ_ü—‹
(
£chk_Çme_v®ue_ä“
)) ||

129 !(
mod
->
»quœem’ts
 = 
	`­Ş_veùÜ_ü—‹
(
£chk_Çme_v®ue_ä“
)) ||

130 !(
mod
->
d•’d’c›s
 = 
	`­Ş_veùÜ_ü—‹
(
£chk_Çme_v®ue_ä“
))

131 || !(
mod
->
funùiÚs
 = 
	`­Ş_veùÜ_ü—‹
(
£chk_â_ä“
))) {

132 
”rÜ
 = 
”ºo
;

133 
	`­Ş_veùÜ_de¡roy
(&
mod
->
İtiÚs
);

134 
	`­Ş_veùÜ_de¡roy
(&
mod
->
»quœem’ts
);

135 
	`­Ş_veùÜ_de¡roy
(&
mod
->
d•’d’c›s
);

136 
	`­Ş_veùÜ_de¡roy
(&
mod
->
funùiÚs
);

137 
	`ä“
(
mod
);

138 
”ºo
 = 
”rÜ
;

139  
NULL
;

142  
mod
;

143 
	}
}

145 
£chk_lib_t
 *
	$£chk_lib_Ãw
()

147 
£chk_lib_t
 *
lib
 = 
NULL
;

148 
»tv
, 
”rÜ
;

149 cÚ¡ 
£chk_moduË_Çme_»g_t
 *
»g_li¡
;

150 
size_t
 
num_known_moduËs
 = 0;

151 
size_t
 
i
 = 0;

152 
£chk_moduË_t
 *
tmp
 = 
NULL
;

155 
lib
 = (
£chk_lib_t
 *è
	`ÿÎoc
(1, (sechk_lib_t));

156 ià(!
lib
) {

157 
”rÜ
 = 
”ºo
;

158 
	`³¼Ü
("Error creating module†ibrary");

159 
ex™_”r
;

163 
num_known_moduËs
 = 
	`£chk_»gi¡”_li¡_g‘_num_moduËs
();

164 
»g_li¡
 = 
	`£chk_»gi¡”_li¡_g‘_moduËs
();

165 
lib
->
moduËs
 = 
	`­Ş_veùÜ_ü—‹
(
£chk_moduË_ä“
);

166 ià(!
lib
->
moduËs
) {

167 
”rÜ
 = 
”ºo
;

168 
	`³¼Ü
("Error‡dding modules");

169 
ex™_”r
;

172 
i
 = 0; i < 
num_known_moduËs
; i++) {

173 
tmp
 = 
	`£chk_moduË_Ãw
();

174 ià(!
tmp
) {

175 
”rÜ
 = 
”ºo
;

176 
	`³¼Ü
("Error‡dding modules");

177 
ex™_”r
;

179 
tmp
->
Çme
 = 
	`¡rdup
(
»g_li¡
[
i
].name);

180 ià(!
tmp
->
Çme
) {

181 
”rÜ
 = 
”ºo
;

182 
	`³¼Ü
("Error‡dding modules");

183 
ex™_”r
;

185 ià(
	`­Ş_veùÜ_­³nd
(
lib
->
moduËs
, 
tmp
)) {

186 
”rÜ
 = 
”ºo
;

187 
	`³¼Ü
("Error‡dding modules");

188 
ex™_”r
;

190 
tmp
 = 
NULL
;

194 
lib
->
ouutfÜm©
 = 
SECHK_OUT_SHORT
;

195 
lib
->
mš£v
 = 
SECHK_SEV_LOW
;

198 ià((
»tv
 = 
	`£chk_lib_»gi¡”_moduËs
(
»g_li¡
, 
lib
)) != 0) {

199 
”rÜ
 = 
”ºo
;

200 
	`³¼Ü
("Error„egistering modules");

201 
ex™_”r
;

203 
ex™
:

204  
lib
;

206 
ex™_”r
:

207 
	`£chk_lib_de¡roy
(&
lib
);

208 
	`£chk_moduË_ä“
(
tmp
);

209 
”ºo
 = 
”rÜ
;

210 
ex™
;

211 
	}
}

213 
	$£chk_lib_de¡roy
(
£chk_lib_t
 ** 
lib
)

215 ià(
lib
 =ğ
NULL
 || *lib == NULL)

218 
	`­Ş_veùÜ_de¡roy
(&((*
lib
)->
moduËs
));

219 
	`­Ş_pŞicy_de¡roy
(&((*
lib
)->
pŞicy
));

220 
	`­Ş_veùÜ_de¡roy
(&((*
lib
)->
fc_’Œ›s
));

221 
	`ä“
((*
lib
)->
fc_·th
);

222 
	`£fs_fşi¡_de¡roy
(&((*
lib
)->
fc_fe
));

223 
	`ä“
((*
lib
)->
£lšux_cÚfig_·th
);

224 
	`­Ş_pŞicy_·th_de¡roy
(&((*
lib
)->
pŞicy_·th
));

225 
	`ä“
(*
lib
);

226 *
lib
 = 
NULL
;

227 
	}
}

229 
	$£chk_moduË_ä“
(*
moduË
)

231 
£chk_moduË_t
 *
mod
 = (£chk_moduË_ˆ*è
moduË
;

233 ià(!
moduË
)

237 
	`£chk_»suÉ_de¡roy
(&
mod
->
»suÉ
);

238 
	`­Ş_veùÜ_de¡roy
(&
mod
->
İtiÚs
);

239 
	`­Ş_veùÜ_de¡roy
(&
mod
->
»quœem’ts
);

240 
	`­Ş_veùÜ_de¡roy
(&
mod
->
d•’d’c›s
);

242 ià(
mod
->
d©a
) {

243 
	`as£¹
(
mod
->
d©a_ä“
);

244 
mod
->
	`d©a_ä“
(mod->
d©a
);

246 
	`ä“
(
mod
->
Çme
);

247 
mod
->
Çme
 = 
NULL
;

248 
	`­Ş_veùÜ_de¡roy
(&
mod
->
funùiÚs
);

249 
	`ä“
(
mod
);

250 
	}
}

252 
	$£chk_â_ä“
(*
â_¡ruù
)

254 
£chk_â_t
 *
â
 = (£chk_â_ˆ*è
â_¡ruù
;

255 ià(!
â_¡ruù
)

258 
	`ä“
(
â
->
Çme
);

260 
	`ä“
(
â
);

261 
	}
}

263 
	$£chk_Çme_v®ue_ä“
(*
nv
)

265 
£chk_Çme_v®ue_t
 *
š
 = (£chk_Çme_v®ue_ˆ*è
nv
;

266 ià(!
nv
)

269 
	`ä“
(
š
->
Çme
);

270 
	`ä“
(
š
->
v®ue
);

271 
	`ä“
(
nv
);

272 
	}
}

274 
	$£chk_»suÉ_de¡roy
(
£chk_»suÉ_t
 ** 
»s
)

276 ià(!
»s
 || !(*res))

279 
	`ä“
((*
»s
)->
‹¡_Çme
);

280 
	`­Ş_veùÜ_de¡roy
(&((*
»s
)->
™ems
));

281 
	`ä“
(*
»s
);

282 *
»s
 = 
NULL
;

283 
	}
}

285 
	$£chk_™em_ä“
(*
™em
)

287 
£chk_™em_t
 *
™
 = (£chk_™em_ˆ*è
™em
;

289 ià(!
™em
)

292 
	`­Ş_veùÜ_de¡roy
(&
™
->
´oof
);

293 ià(
™
->
™em_ä“_â
)

294 
™
->
	`™em_ä“_â
(™->
™em
);

296 
	`ä“
(
™em
);

297 
	}
}

299 
	$£chk_´oof_ä“
(*
´oof
)

301 
£chk_´oof_t
 *
p
 = (£chk_´oof_ˆ*è
´oof
;

303 ià(!
´oof
)

306 
	`ä“
(
p
->
‹xt
);

307 
	`ä“
(
p
->
xml_out
);

309 ià(
p
->
–em_ä“_â
)

310 
p
->
	`–em_ä“_â
Õ->
–em
);

312 
	`ä“
(
´oof
);

313 
	}
}

315 
£chk_â_t
 *
	$£chk_â_Ãw
()

318  (
£chk_â_t
 *è
	`ÿÎoc
(1, (sechk_fn_t));

319 
	}
}

321 
£chk_Çme_v®ue_t
 *
	$£chk_Çme_v®ue_Ãw
(cÚ¡ *
Çme
, cÚ¡ *
v®ue
)

323 
£chk_Çme_v®ue_t
 *
nv
;

324 
”rÜ
;

326 
nv
 = (
£chk_Çme_v®ue_t
 *è
	`ÿÎoc
(1, (sechk_name_value_t));

327 ià(!
nv
)

328  
NULL
;

329 ià(
Çme
) {

330 
nv
->
Çme
 = 
	`¡rdup
(name);

331 ià(!
nv
->
Çme
) {

332 
”rÜ
 = 
”ºo
;

333 
”r
;

336 ià(
v®ue
) {

337 
nv
->
v®ue
 = 
	`¡rdup
(value);

338 ià(!
nv
->
v®ue
) {

339 
”rÜ
 = 
”ºo
;

340 
”r
;

344  
nv
;

346 
”r
:

347 
	`ä“
(
nv
->
Çme
);

348 
	`ä“
(
nv
);

349 
”ºo
 = 
”rÜ
;

350  
NULL
;

351 
	}
}

353 
£chk_»suÉ_t
 *
	$£chk_»suÉ_Ãw
()

356  (
£chk_»suÉ_t
 *è
	`ÿÎoc
(1, (sechk_result_t));

357 
	}
}

359 
£chk_™em_t
 *
	$£chk_™em_Ãw
(
ä“_â_t
 
â
)

361 
£chk_™em_t
 *
™
 = 
NULL
;

363 
™
 = (
£chk_™em_t
 *è
	`ÿÎoc
(1, (sechk_item_t));

364 ià(!
™
)

365  
NULL
;

366 
™
->
™em_ä“_â
 = 
â
;

368  
™
;

369 
	}
}

371 
£chk_´oof_t
 *
	$£chk_´oof_Ãw
(
ä“_â_t
 
â
)

373 
£chk_´oof_t
 *
´oof
 = 
NULL
;

374 
´oof
 = (
£chk_´oof_t
 *è
	`ÿÎoc
(1, (sechk_proof_t));

375 ià(!
´oof
)

376  
NULL
;

377 
´oof
->
ty³
 = 
SECHK_ITEM_NONE
;

378 
´oof
->
–em_ä“_â
 = 
â
;

379  
´oof
;

380 
	}
}

382 
	$£chk_lib_lßd_pŞicy
(
­Ş_pŞicy_·th_t
 * 
pŞicy_mods
, 
£chk_lib_t
 * 
lib
)

385 *
deçuÉ_pŞicy_·th
 = 
NULL
;

386 
»tv
 = -1;

388 ià(!
lib
)

392 ià(!
pŞicy_mods
) {

393 
»tv
 = 
	`qpŞ_deçuÉ_pŞicy_fšd
(&
deçuÉ_pŞicy_·th
);

394 ià(
»tv
 < 0) {

395 
	`årštf
(
¡d”r
, "DeçuÉ…Şicy s—rch faed: %s\n", 
	`¡»¼Ü
(
”ºo
));

397 } ià(
»tv
 != 0) {

398 
	`årštf
(
¡d”r
, "No default…olicy found.\n");

401 
pŞicy_mods
 = 
	`­Ş_pŞicy_·th_ü—‹
(
APOL_POLICY_PATH_TYPE_MONOLITHIC
, 
deçuÉ_pŞicy_·th
, 
NULL
);

402 
lib
->
pŞicy
 = 
	`­Ş_pŞicy_ü—‹_äom_pŞicy_·th
(
pŞicy_mods
, 
QPOL_POLICY_OPTION_MATCH_SYSTEM
, 
NULL
, NULL);

403 ià(
lib
->
pŞicy
 =ğ
NULL
) {

404 
	`årštf
(
¡d”r
, "Error: failed opening default…olicy\n");

407 
lib
->
pŞicy_·th
 = 
pŞicy_mods
;

408 ià(!(
lib
->
ouutfÜm©
 & 
SECHK_OUT_QUIET
)) {

409 
	`årštf
(
¡d”r
, "Usšg…Şicy: %s\n", 
	`­Ş_pŞicy_·th_g‘_´im¬y
(
lib
->
pŞicy_·th
));

412 
lib
->
pŞicy_·th
 = 
pŞicy_mods
;

413 
lib
->
pŞicy
 = 
	`­Ş_pŞicy_ü—‹_äom_pŞicy_·th
(
pŞicy_mods
, 0, 
NULL
, NULL);

414 ià(
lib
->
pŞicy
 =ğ
NULL
) {

415 
	`årštf
(
¡d”r
, "E¼Ü: faed o³nšg…Şicy %s\n", 
	`­Ş_pŞicy_·th_to_¡ršg
(
lib
->
pŞicy_·th
));

416 
”r
;

421 
”r
:

422 
	`­Ş_pŞicy_de¡roy
(&
lib
->
pŞicy
);

424 
	}
}

426 
	$£chk_lib_lßd_fc
(cÚ¡ *
fcf–oÿtiÚ
, 
£chk_lib_t
 * 
lib
)

428 
”rÜ
 = 0;

429 *
deçuÉ_fc_·th
 = 
NULL
;

430 
£fs_fşi¡_t
 *
fcfe
 = 
NULL
;

431 
£fs_qu”y_t
 *
q
 = 
NULL
;

434 ià(!
lib
 || !lib->
pŞicy
) {

435 
”ºo
 = 
EINVAL
;

440 ià(!
fcf–oÿtiÚ
) {

441 
deçuÉ_fc_·th
 = 
	`£fs_deçuÉ_fe_cÚ‹xts_g‘_·th
();

442 ià(
deçuÉ_fc_·th
 =ğ
NULL
) {

443 
”rÜ
 = 
”ºo
;

444 
	`WARN
(
lib
->
pŞicy
, "UÇbËØfšd deçuÉ fe_cÚ‹xt fe: %s", 
	`¡»¼Ü
(
”rÜ
));

445 
”ºo
 = 
”rÜ
;

448 ià(
	`¡rcmp
(
deçuÉ_fc_·th
, "") == 0) {

449 
	`WARN
(
lib
->
pŞicy
, "%s", "The system has‚o default file_contexts file.");

450 
	`ä“
(
deçuÉ_fc_·th
);

451 
”ºo
 = 
ENOSYS
;

454 
fcfe
 = 
	`£fs_fcfe_ü—‹_äom_fe
(
deçuÉ_fc_·th
, 
NULL
, NULL);

455 
q
 = 
	`£fs_qu”y_ü—‹
();

456 
lib
->
fc_’Œ›s
 = 
	`£fs_fşi¡_run_qu”y
(
fcfe
, 
q
);

457 ià(!(
lib
->
fc_’Œ›s
)) {

458 
”rÜ
 = 
”ºo
;

459 
	`WARN
(
lib
->
pŞicy
, "UÇbËØ´oûs fe_cÚ‹xt f%s.", 
deçuÉ_fc_·th
);

460 
	`ä“
(
deçuÉ_fc_·th
);

461 
”ºo
 = 
”rÜ
;

464 
lib
->
fc_·th
 = 
deçuÉ_fc_·th
;

465 
lib
->
fc_fe
 = 
fcfe
;

467 ià(
lib
->
ouutfÜm©
 & ~(
SECHK_OUT_QUIET
)) {

468 
	`årštf
(
¡d”r
, "Usšg fcÚ‹xts: %s\n", 
lib
->
fc_·th
);

471 
fcfe
 = 
	`£fs_fcfe_ü—‹_äom_fe
(
fcf–oÿtiÚ
, 
NULL
, NULL);

472 
q
 = 
	`£fs_qu”y_ü—‹
();

473 
lib
->
fc_’Œ›s
 = 
	`£fs_fşi¡_run_qu”y
(
fcfe
, 
q
);

474 ià(!(
lib
->
fc_’Œ›s
)) {

475 
”rÜ
 = 
”ºo
;

476 
	`WARN
(
lib
->
pŞicy
, "UÇbËØ´oûs fe_cÚ‹xt f%s.", 
fcf–oÿtiÚ
);

477 
”ºo
 = 
”rÜ
;

480 
lib
->
fc_·th
 = 
	`¡rdup
(
fcf–oÿtiÚ
);

481 
lib
->
fc_fe
 = 
fcfe
;

484 
	`£fs_qu”y_de¡roy
(&
q
);

487 
	}
}

489 
	$£chk_lib_»gi¡”_moduËs
(cÚ¡ 
£chk_moduË_Çme_»g_t
 * 
»gi¡”_âs
, 
£chk_lib_t
 * 
lib
)

491 
»tv
, 
”rÜ
 = 0;

492 
size_t
 
i
;

493 
£chk_»gi¡”_â_t
 
â
 = 
NULL
;

494 ià(!
»gi¡”_âs
 || !
lib
) {

495 
	`årštf
(
¡d”r
, "Error: could‚ot„egister modules\n");

496 
”ºo
 = 
EINVAL
;

499 ià(
	`­Ş_veùÜ_g‘_size
(
lib
->
moduËs
è!ğ
	`£chk_»gi¡”_li¡_g‘_num_moduËs
()) {

500 
	`årštf
(
¡d”r
,

502 
	`£chk_»gi¡”_li¡_g‘_num_moduËs
(), 
	`­Ş_veùÜ_g‘_size
(
lib
->
moduËs
));

503 
”ºo
 = 
EINVAL
;

506 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
lib
->
moduËs
); i++) {

507 
â
 = (
£chk_»gi¡”_â_t
è(
»gi¡”_âs
[
i
].fn);

508 
»tv
 = 
	`â
(
lib
);

509 ià(
»tv
) {

510 
”rÜ
 = 
”ºo
;

511 
	`årštf
(
¡d”r
, "E¼Ü: could‚Ù„egi¡” moduË #%zd\n", 
i
);

512 
”ºo
 = 
”rÜ
;

513  
»tv
;

518 
	}
}

520 
£chk_mod_â_t
 
	$£chk_lib_g‘_moduË_funùiÚ
(cÚ¡ *
moduË_Çme
, cÚ¡ *
funùiÚ_Çme
, cÚ¡ 
£chk_lib_t
 * 
lib
)

522 
£chk_moduË_t
 *
mod
 = 
NULL
;

523 
£chk_â_t
 *
â_¡ruù
 = 
NULL
;

524 
size_t
 
i
;

526 ià(!
moduË_Çme
 || !
funùiÚ_Çme
 || !
lib
) {

527 
	`årštf
(
¡d”r
, "Error: failedo get function from module\n");

528 
”ºo
 = 
EINVAL
;

529  
NULL
;

533 
mod
 = 
	`£chk_lib_g‘_moduË
(
moduË_Çme
, 
lib
);

534 ià(!
mod
) {

535 
	`årštf
(
¡d”r
, "E¼Ü: %s:‚Øsuch moduË\n", 
moduË_Çme
);

536 
”ºo
 = 
ENOENT
;

537  
NULL
;

541 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
mod
->
funùiÚs
); i++) {

542 
â_¡ruù
 = 
	`­Ş_veùÜ_g‘_–em’t
(
mod
->
funùiÚs
, 
i
);

543 ià(!
	`¡rcmp
(
â_¡ruù
->
Çme
, 
funùiÚ_Çme
))

546 
â_¡ruù
 = 
NULL
;

548 ià(!
â_¡ruù
) {

549 
	`årštf
(
¡d”r
, "E¼Ü: %s:‚Øsuch funùiÚ iÀmoduË %s\n", 
funùiÚ_Çme
, 
moduË_Çme
);

550 
”ºo
 = 
ENOENT
;

551  
NULL
;

554  
â_¡ruù
->
â
;

555 
	}
}

557 
£chk_moduË_t
 *
	$£chk_lib_g‘_moduË
(cÚ¡ *
moduË_Çme
, cÚ¡ 
£chk_lib_t
 * 
lib
)

559 
size_t
 
i
;

560 
£chk_moduË_t
 *
mod
 = 
NULL
;

562 ià(!
moduË_Çme
 || !
lib
) {

563 
	`årštf
(
¡d”r
, "Error: failedo get module\n");

564 
”ºo
 = 
EINVAL
;

565  
NULL
;

568 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
lib
->
moduËs
); i++) {

569 
mod
 = 
	`­Ş_veùÜ_g‘_–em’t
(
lib
->
moduËs
, 
i
);

570 ià(!(
mod
->
Çme
))

572 ià(!
	`¡rcmp
(
mod
->
Çme
, 
moduË_Çme
))

573  
mod
;

575 
	`årštf
(
¡d”r
, "E¼Ü: %s:‚Øsuch moduË\n", 
moduË_Çme
);

576 
”ºo
 = 
ENOENT
;

577  
NULL
;

578 
	}
}

580 
£chk_»suÉ_t
 *
	$£chk_lib_g‘_moduË_»suÉ
(cÚ¡ *
moduË_Çme
, cÚ¡ 
£chk_lib_t
 * 
lib
)

582 
size_t
 
i
;

583 
£chk_moduË_t
 *
mod
 = 
NULL
;

584 
£chk_mod_â_t
 
run
 = 
NULL
;

586 ià(!
moduË_Çme
 || !
lib
) {

587 
	`årštf
(
¡d”r
, "Error: failedo get module„esult\n");

588 
”ºo
 = 
EINVAL
;

589  
NULL
;

592 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
lib
->
moduËs
); i++) {

593 
mod
 = 
	`­Ş_veùÜ_g‘_–em’t
(
lib
->
moduËs
, 
i
);

594 ià(!(
mod
->
Çme
))

596 ià(
	`¡rcmp
(
mod
->
Çme
, 
moduË_Çme
))

598 ià(!(
mod
->
»suÉ
)) {

599 ià(!(
run
 = 
	`£chk_lib_g‘_moduË_funùiÚ
(
moduË_Çme
, 
SECHK_MOD_FN_RUN
, 
lib
)) ||

600 
	`run
(
mod
, 
lib
->
pŞicy
, 
NULL
) < 0) {

601  
NULL
;

604  
mod
->
»suÉ
;

606 
	`årštf
(
¡d”r
, "E¼Ü: %s:‚Øsuch moduË\n", 
moduË_Çme
);

607 
”ºo
 = 
ENOENT
;

608  
NULL
;

609 
	}
}

611 
	$£chk_lib_check_moduË_d•’d’c›s
(
£chk_lib_t
 * 
lib
)

613 
idx
 = 0;

614 
size_t
 
i
, 
j
;

615 
boŞ
 
‹¡
 = 
Œue
, 
dÚe
 = 
çl£
, *
´oûs£d
 = 
NULL
;

616 
£chk_Çme_v®ue_t
 *
nv
 = 
NULL
;

617 
£chk_moduË_t
 *
mod
 = 
NULL
, *
d•
 = NULL;

619 ià(!
lib
) {

620 
	`årštf
(
¡d”r
, "Error: invalid module†ibrary\n");

621 
”ºo
 = 
EINVAL
;

625 
´oûs£d
 = (
boŞ
 *è
	`ÿÎoc
(
	`­Ş_veùÜ_g‘_size
(
lib
->
moduËs
), (bool));

626 ià(!
´oûs£d
) {

627 
	`³¼Ü
(
NULL
);

632 !
dÚe
) {

633 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
lib
->
moduËs
); i++) {

634 ià(
´oûs£d
[
i
])

636 
mod
 = 
	`­Ş_veùÜ_g‘_–em’t
(
lib
->
moduËs
, 
i
);

637 ià(!
mod
->
£Ëùed
) {

638 
´oûs£d
[
i
] = 
Œue
;

641 
j
 = 0; j < 
	`­Ş_veùÜ_g‘_size
(
mod
->
d•’d’c›s
); j++) {

642 
nv
 = 
	`­Ş_veùÜ_g‘_–em’t
(
mod
->
d•’d’c›s
, 
j
);

643 
‹¡
 = 
çl£
;

644 
‹¡
 = 
	`£chk_lib_check_d•’d’cy
(
nv
, 
lib
);

645 ià(!
‹¡
) {

646 
	`ERR
(
lib
->
pŞicy
, "D•’d’cy % nÙ found fÜ %s.", 
nv
->
Çme
, 
mod
->name);

647 
	`ä“
(
´oûs£d
);

648 
”ºo
 = 
ENOENT
;

651 
idx
 = 
	`£chk_lib_g‘_moduË_idx
(
nv
->
v®ue
, 
lib
);

652 
d•
 = 
	`­Ş_veùÜ_g‘_–em’t
(
lib
->
moduËs
, 
idx
);

653 ià(!
d•
->
£Ëùed
) {

654 
´oûs£d
[
idx
] = 
çl£
;

655 
d•
->
£Ëùed
 = 
Œue
;

658 
´oûs£d
[
i
] = 
Œue
;

660 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
lib
->
moduËs
); i++) {

661 ià(!
´oûs£d
[
i
])

664 ià(
i
 =ğ
	`­Ş_veùÜ_g‘_size
(
lib
->
moduËs
))

665 
dÚe
 = 
Œue
;

667 
	`ä“
(
´oûs£d
);

670 
	}
}

672 
	$£chk_lib_check_moduË_»quœem’ts
(
£chk_lib_t
 * 
lib
)

674 
»tv
 = 0;

675 
size_t
 
i
, 
j
;

676 
boŞ
 
‹¡
 = 
Œue
;

677 
£chk_Çme_v®ue_t
 *
nv
 = 
NULL
;

678 
£chk_moduË_t
 *
mod
 = 
NULL
;

681 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
lib
->
moduËs
); i++) {

682 
mod
 = 
	`­Ş_veùÜ_g‘_–em’t
(
lib
->
moduËs
, 
i
);

683 ià(!
mod
->
£Ëùed
)

685 
j
 = 0; j < 
	`­Ş_veùÜ_g‘_size
(
mod
->
»quœem’ts
); j++) {

686 
nv
 = 
	`­Ş_veùÜ_g‘_–em’t
(
mod
->
»quœem’ts
, 
j
);

687 
‹¡
 = 
çl£
;

688 
‹¡
 = 
	`£chk_lib_check_»quœem’t
(
nv
, 
lib
);

689 ià(!
‹¡
) {

691 ià(
lib
->
ouutfÜm©
 & (
SECHK_OUT_QUIET
)) {

692 
”ºo
 = 
ENOTSUP
;

696 
	`ERR
(
lib
->
pŞicy
, "Requœem’t nÙ m‘ fÜ %s.", 
mod
->
Çme
);

697 
mod
->
£Ëùed
 = 
çl£
;

698 
»tv
 = -1;

704  
»tv
;

705 
	}
}

707 
	$£chk_lib_š™_moduËs
(
£chk_lib_t
 * 
lib
)

709 
»tv
, 
”rÜ
 = 0;

710 
size_t
 
i
;

711 
£chk_moduË_t
 *
mod
 = 
NULL
;

712 
£chk_mod_â_t
 
š™_â
 = 
NULL
;

714 ià(
lib
 =ğ
NULL
 ||†ib->
moduËs
 == NULL) {

715 
”ºo
 = 
EINVAL
;

718 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
lib
->
moduËs
); i++) {

719 
mod
 = 
	`­Ş_veùÜ_g‘_–em’t
(
lib
->
moduËs
, 
i
);

720 ià(!
mod
->
£Ëùed
)

722 
š™_â
 = 
	`£chk_lib_g‘_moduË_funùiÚ
(
mod
->
Çme
, 
SECHK_MOD_FN_INIT
, 
lib
);

723 ià(!
š™_â
) {

724 
”rÜ
 = 
”ºo
;

725 
	`årštf
(
¡d”r
, "E¼Ü: could‚Ù in™ŸlizmoduË %s\n", 
mod
->
Çme
);

726 
”ºo
 = 
”rÜ
;

729 
»tv
 = 
	`š™_â
(
mod
, 
lib
->
pŞicy
, 
NULL
);

730 ià(
»tv
)

731  
»tv
;

735 
	}
}

737 
	$£chk_lib_run_moduËs
(
£chk_lib_t
 * 
lib
)

739 
»tv
, 
num_£Ëùed
 = 0, 
rc
 = 0;

740 
size_t
 
i
;

741 
£chk_moduË_t
 *
mod
 = 
NULL
;

742 
£chk_mod_â_t
 
run_â
 = 
NULL
;

744 ià(!
lib
) {

745 
	`årštf
(
¡d”r
, "Error: invalid†ibrary\n");

746 
”ºo
 = 
EINVAL
;

749 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
lib
->
moduËs
); i++) {

750 
mod
 = 
	`­Ş_veùÜ_g‘_–em’t
(
lib
->
moduËs
, 
i
);

751 ià(
mod
->
£Ëùed
)

752 
num_£Ëùed
++;

754 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
lib
->
moduËs
); i++) {

755 
mod
 = 
	`­Ş_veùÜ_g‘_–em’t
(
lib
->
moduËs
, 
i
);

757 ià(!
mod
->
£Ëùed
)

760 ià(
lib
->
mš£v
 && 
	`£chk_lib_com·»_£v
(
mod
->
£v”™y
,†ib->mš£vè< 0 && 
num_£Ëùed
 != 1)

762 
	`as£¹
(
mod
->
Çme
);

763 
run_â
 = 
	`£chk_lib_g‘_moduË_funùiÚ
(
mod
->
Çme
, 
SECHK_MOD_FN_RUN
, 
lib
);

764 ià(!
run_â
) {

765 
	`ERR
(
lib
->
pŞicy
, "Could‚Ù„uÀmoduË %s.", 
mod
->
Çme
);

766 
”ºo
 = 
ENOTSUP
;

769 
»tv
 = 
	`run_â
(
mod
, 
lib
->
pŞicy
, 
NULL
);

771 ià(
»tv
 < 0) {

774 ià(
lib
->
ouutfÜm©
 & ~(
SECHK_OUT_QUIET
))

775 
	`ERR
(
lib
->
pŞicy
, "ModuË % çed.", 
mod
->
Çme
);

776 
rc
 = -1;

777 } ià(
»tv
 > 0) {

781 ià(
lib
->
ouutfÜm©
 & (
SECHK_OUT_QUIET
))

785  
rc
;

786 
	}
}

788 
	$£chk_lib_´št_moduËs_»pÜt
(
£chk_lib_t
 * 
lib
)

790 
»tv
, 
num_£Ëùed
 = 0, 
rc
 = 0;

791 
size_t
 
i
;

792 
£chk_moduË_t
 *
mod
 = 
NULL
;

793 
£chk_mod_â_t
 
´št_â
 = 
NULL
;

795 ià(!
lib
) {

796 
	`årštf
(
¡d”r
, "Error: invalid†ibrary\n");

797 
”ºo
 = 
EINVAL
;

800 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
lib
->
moduËs
); i++) {

801 
mod
 = 
	`­Ş_veùÜ_g‘_–em’t
(
lib
->
moduËs
, 
i
);

802 ià(
mod
->
£Ëùed
)

803 
num_£Ëùed
++;

805 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
lib
->
moduËs
); i++) {

806 
mod
 = 
	`­Ş_veùÜ_g‘_–em’t
(
lib
->
moduËs
, 
i
);

808 ià(!
mod
->
£Ëùed
 || mod->
ouutfÜm©
 & 
SECHK_OUT_QUIET
)

811 ià(
lib
->
mš£v
 && 
	`£chk_lib_com·»_£v
(
mod
->
£v”™y
,†ib->mš£vè< 0 && 
num_£Ëùed
 != 1)

814 ià(
mod
->
ouutfÜm©
 =ğ
SECHK_OUT_NONE
 && 
num_£Ëùed
 == 1)

815 
mod
->
ouutfÜm©
 = 
SECHK_OUT_SHORT
;

816 
	`as£¹
(
mod
->
Çme
);

817 
	`´štf
("\nModuË‚ame: %s\tSev”™y: %s\n%s\n", 
mod
->
Çme
, mod->
£v”™y
, mod->
d‘aed_desütiÚ
);

818 
´št_â
 = 
	`£chk_lib_g‘_moduË_funùiÚ
(
mod
->
Çme
, 
SECHK_MOD_FN_PRINT
, 
lib
);

819 ià(!
´št_â
) {

820 
	`ERR
(
lib
->
pŞicy
, "Could‚Ù g‘…ršˆfunùiÚ fÜ moduË %s.", 
mod
->
Çme
);

821 
”ºo
 = 
ENOTSUP
;

824 
»tv
 = 
	`´št_â
(
mod
, 
lib
->
pŞicy
, 
NULL
);

825 ià(
»tv
) {

826 
	`årštf
(
¡d”r
, "E¼Ü: uÇbËØ´šˆ»suÉ fÜ moduË % \n", 
mod
->
Çme
);

827 
rc
 = -1;

831  
rc
;

832 
	}
}

834 
boŞ
 
	$£chk_lib_check_»quœem’t
(
£chk_Çme_v®ue_t
 * 
»q
, 
£chk_lib_t
 * 
lib
)

836 
¡©
 
¡©_buf
;

838 ià(!
»q
) {

839 
	`årštf
(
¡d”r
, "Error: invalid„equirement\n");

840 
”ºo
 = 
EINVAL
;

841  
çl£
;

844 ià(!
lib
 || !lib->
pŞicy
) {

845 
	`årštf
(
¡d”r
, "Error: invalid†ibrary\n");

846 
”ºo
 = 
EINVAL
;

847  
çl£
;

850 ià(!
	`¡rcmp
(
»q
->
Çme
, 
SECHK_REQ_POLICY_CAP
)) {

851 ià(!
	`¡rcmp
(
»q
->
v®ue
, 
SECHK_REQ_CAP_ATTRIB_NAMES
)) {

852 ià(!
	`qpŞ_pŞicy_has_ÿ·b™y
(
	`­Ş_pŞicy_g‘_qpŞ
(
lib
->
pŞicy
), 
QPOL_CAP_ATTRIB_NAMES
)) {

853 ià(
lib
->
ouutfÜm©
 & ~(
SECHK_OUT_QUIET
)) {

854 
	`ERR
(
lib
->
pŞicy
, "Requœem’ˆ%s, % nÙ m‘.", 
»q
->
Çme
,„eq->
v®ue
);

856  
çl£
;

858 } ià(!
	`¡rcmp
(
»q
->
v®ue
, 
SECHK_REQ_CAP_MLS
)) {

859 ià(!
	`qpŞ_pŞicy_has_ÿ·b™y
(
	`­Ş_pŞicy_g‘_qpŞ
(
lib
->
pŞicy
), 
QPOL_CAP_MLS
)) {

860 ià(
lib
->
ouutfÜm©
 & ~(
SECHK_OUT_QUIET
)) {

861 
	`ERR
(
lib
->
pŞicy
, "Requœem’ˆ%s, % nÙ m‘.", 
»q
->
Çme
,„eq->
v®ue
);

863  
çl£
;

865 } ià(!
	`¡rcmp
(
»q
->
v®ue
, 
SECHK_REQ_CAP_SYN_RULES
)) {

866 ià(!
	`qpŞ_pŞicy_has_ÿ·b™y
(
	`­Ş_pŞicy_g‘_qpŞ
(
lib
->
pŞicy
), 
QPOL_CAP_SYN_RULES
)) {

867 ià(
lib
->
ouutfÜm©
 & ~(
SECHK_OUT_QUIET
)) {

868 
	`ERR
(
lib
->
pŞicy
, "Requœem’ˆ%s, % nÙ m‘.", 
»q
->
Çme
,„eq->
v®ue
);

870  
çl£
;

872 } ià(!
	`¡rcmp
(
»q
->
v®ue
, 
SECHK_REQ_CAP_RULES_LOADED
)) {

873 ià(!
	`qpŞ_pŞicy_has_ÿ·b™y
(
	`­Ş_pŞicy_g‘_qpŞ
(
lib
->
pŞicy
), 
QPOL_CAP_RULES_LOADED
)) {

874 ià(
lib
->
ouutfÜm©
 & ~(
SECHK_OUT_QUIET
)) {

875 
	`ERR
(
lib
->
pŞicy
, "Requœem’ˆ%s, % nÙ m‘.", 
»q
->
Çme
,„eq->
v®ue
);

877  
çl£
;

879 } ià(!
	`¡rcmp
(
»q
->
v®ue
, 
SECHK_REQ_CAP_LINE_NOS
)) {

880 ià(!
	`qpŞ_pŞicy_has_ÿ·b™y
(
	`­Ş_pŞicy_g‘_qpŞ
(
lib
->
pŞicy
), 
QPOL_CAP_LINE_NUMBERS
)) {

881 ià(
lib
->
ouutfÜm©
 & ~(
SECHK_OUT_QUIET
)) {

882 
	`ERR
(
lib
->
pŞicy
, "Requœem’ˆ%s, % nÙ m‘.", 
»q
->
Çme
,„eq->
v®ue
);

884  
çl£
;

886 } ià(!
	`¡rcmp
(
»q
->
v®ue
, 
SECHK_REQ_CAP_CONDITIONALS
)) {

887 ià(!
	`qpŞ_pŞicy_has_ÿ·b™y
(
	`­Ş_pŞicy_g‘_qpŞ
(
lib
->
pŞicy
), 
QPOL_CAP_CONDITIONALS
)) {

888 ià(
lib
->
ouutfÜm©
 & ~(
SECHK_OUT_QUIET
)) {

889 
	`ERR
(
lib
->
pŞicy
, "Requœem’ˆ%s, % nÙ m‘.", 
»q
->
Çme
,„eq->
v®ue
);

891  
çl£
;

893 } ià(!
	`¡rcmp
(
»q
->
v®ue
, 
SECHK_REQ_CAP_MODULES
)) {

894 ià(!
	`qpŞ_pŞicy_has_ÿ·b™y
(
	`­Ş_pŞicy_g‘_qpŞ
(
lib
->
pŞicy
), 
QPOL_CAP_MODULES
)) {

895 ià(
lib
->
ouutfÜm©
 & ~(
SECHK_OUT_QUIET
)) {

896 
	`ERR
(
lib
->
pŞicy
, "Requœem’ˆ%s, % nÙ m‘.", 
»q
->
Çme
,„eq->
v®ue
);

898  
çl£
;

901 
	`ERR
(
lib
->
pŞicy
, "UnknowÀ»quœem’t: %s, %s", 
»q
->
Çme
,„eq->
v®ue
);

902  
çl£
;

904 } ià(!
	`¡rcmp
(
»q
->
Çme
, 
SECHK_REQ_DEFAULT_CONTEXTS
)) {

905 #ifdeà
LIBSELINUX


906 ià(
	`¡©
(
	`£lšux_deçuÉ_cÚ‹xt_·th
(), &
¡©_buf
) < 0) {

907 ià(
lib
->
ouutfÜm©
 & ~(
SECHK_OUT_QUIET
)) {

908 
	`ERR
(
lib
->
pŞicy
, "Requœem’ˆ% nÙ m‘.", 
»q
->
Çme
);

910  
çl£
;

913 ià(
lib
->
ouutfÜm©
 & ~(
SECHK_OUT_QUIET
)) {

914 
	`ERR
(
lib
->
pŞicy
, "Checkšg„equœem’ˆ%s: %s", 
»q
->
Çme
, 
	`¡»¼Ü
(
ENOTSUP
));

916  
çl£
;

918 } ià(!
	`¡rcmp
(
»q
->
Çme
, 
SECHK_REQ_FILE_CONTEXTS
)) {

919 ià(!
lib
->
fc_’Œ›s
 || !
	`­Ş_veùÜ_g‘_size
(lib->fc_entries)) {

920 ià(
lib
->
ouutfÜm©
 & ~(
SECHK_OUT_QUIET
)) {

921 
	`ERR
(
lib
->
pŞicy
, "Requœem’ˆ% nÙ m‘.", 
»q
->
Çme
);

924 } ià(!
	`¡rcmp
(
»q
->
Çme
, 
SECHK_REQ_SYSTEM
)) {

925 ià(!
	`¡rcmp
(
»q
->
v®ue
, 
SECHK_REQ_SYS_SELINUX
)) {

926 #ifdeà
LIBSELINUX


927 ià(!
	`is_£lšux_mls_’abËd
(è|| !
	`is_£lšux_’abËd
()) {

928 ià(
lib
->
ouutfÜm©
 & ~(
SECHK_OUT_QUIET
))

929 
	`ERR
(
lib
->
pŞicy
, "Requœem’ˆ%s, % nÙ m‘.", 
»q
->
Çme
,„eq->
v®ue
);

930  
çl£
;

933 ià(
lib
->
ouutfÜm©
 & ~(
SECHK_OUT_QUIET
))

934 
	`ERR
(
lib
->
pŞicy
, "Checkšg„equœem’ˆ%s, %s: %s", 
»q
->
Çme
,„eq->
v®ue
, 
	`¡»¼Ü
(
ENOTSUP
));

935  
çl£
;

937 } ià(!
	`¡rcmp
(
»q
->
v®ue
, 
SECHK_REQ_SYS_MLS
)) {

938 #ifdeà
LIBSELINUX


939 ià(!
	`is_£lšux_mls_’abËd
(è|| !
	`is_£lšux_’abËd
()) {

940 ià(
lib
->
ouutfÜm©
 & ~(
SECHK_OUT_QUIET
))

941 
	`ERR
(
lib
->
pŞicy
, "Requœem’ˆ%s, % nÙ m‘.", 
»q
->
Çme
,„eq->
v®ue
);

942  
çl£
;

945 ià(
lib
->
ouutfÜm©
 & ~(
SECHK_OUT_QUIET
))

946 
	`ERR
(
lib
->
pŞicy
, "Checkšg„equœem’ˆ%s, %s: %s", 
»q
->
Çme
,„eq->
v®ue
, 
	`¡»¼Ü
(
ENOTSUP
));

947  
çl£
;

950 
	`ERR
(
lib
->
pŞicy
, "UnknowÀ»quœem’t: %s, %s", 
»q
->
Çme
,„eq->
v®ue
);

951  
çl£
;

954 
	`ERR
(
lib
->
pŞicy
, "UnknowÀ»quœem’t: %s, %s", 
»q
->
Çme
,„eq->
v®ue
);

955  
çl£
;

958  
Œue
;

959 
	}
}

961 
boŞ
 
	$£chk_lib_check_d•’d’cy
(
£chk_Çme_v®ue_t
 * 
d•
, 
£chk_lib_t
 * 
lib
)

963 
£chk_moduË_t
 *
mod
 = 
NULL
;

965 ià(!
d•
 || !d•->
v®ue
) {

966 
	`årštf
(
¡d”r
, "Error: invalid dependency\n");

967 
”ºo
 = 
EINVAL
;

968  
çl£
;

971 ià(!
lib
) {

972 
	`årštf
(
¡d”r
, "Error: invalid†ibrary\n");

973 
”ºo
 = 
EINVAL
;

974  
çl£
;

977 
mod
 = 
	`£chk_lib_g‘_moduË
(
d•
->
v®ue
, 
lib
);

978 ià(!
mod
) {

979 
	`årštf
(
¡d”r
, "E¼Ü: could‚Ù fšd d•’d’cy %s\n", 
d•
->
v®ue
);

980 
”ºo
 = 
ENOENT
;

981  
çl£
;

984  
Œue
;

985 
	}
}

987 
	$£chk_lib_£t_ouutfÜm©
(
out
, 
£chk_lib_t
 * 
lib
)

989 
size_t
 
i
;

990 
£chk_moduË_t
 *
mod
 = 
NULL
;

992 ià(!
lib
 || !
out
) {

993 
”ºo
 = 
EINVAL
;

997 
lib
->
ouutfÜm©
 = 
out
;

999 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
lib
->
moduËs
); i++) {

1000 
mod
 = 
	`­Ş_veùÜ_g‘_–em’t
(
lib
->
moduËs
, 
i
);

1001 
mod
->
ouutfÜm©
 = 
out
;

1005 
	}
}

1007 
£chk_´oof_t
 *
	$£chk_´oof_cİy
(
£chk_´oof_t
 * 
Üig
)

1009 
£chk_´oof_t
 *
cİy
 = 
NULL
;

1011 ià(!
Üig
)

1012  
NULL
;

1014 
cİy
 = 
	`£chk_´oof_Ãw
(
Üig
->
–em_ä“_â
);

1015 ià(!
cİy
) {

1016 
	`årštf
(
¡d”r
, "Error: out of memory\n");

1017 
”ºo
 = 
ENOMEM
;

1018  
NULL
;

1021 
cİy
->
–em
 = 
Üig
->elem;

1022 
cİy
->
ty³
 = 
Üig
->type;

1023 
cİy
->
‹xt
 = 
	`¡rdup
(
Üig
->text);

1024 ià(!
cİy
->
‹xt
) {

1025 
	`årštf
(
¡d”r
, "Error: out of memory\n");

1026 
”ºo
 = 
ENOMEM
;

1027  
NULL
;

1029 
cİy
->
xml_out
 = 
NULL
;

1031  
cİy
;

1032 
	}
}

1034 
	$£chk_lib_lßd_´ofe
(cÚ¡ *
´of_Çme
, 
£chk_lib_t
 * 
lib
)

1036 cÚ¡ 
£chk_´ofe_Çme_»g_t
 *
´ofes
;

1037 *
´oå©h
 = 
NULL
, *
´of_f’ame
 = NULL, *
·th
 = NULL;

1038 
»tv
 = -1, 
”rÜ
 = 0;

1039 
size_t
 
num_´ofes
, 
i
;

1040 
£chk_moduË_t
 *
mod
 = 
NULL
;

1042 ià(!
´of_Çme
 || !
lib
) {

1043 
	`årštf
(
¡d”r
, "Error: invalid…arameterso†oad…rofile\n");

1048 
´ofes
 = 
	`£chk_»gi¡”_li¡_g‘_´ofes
();

1049 
num_´ofes
 = 
	`£chk_»gi¡”_li¡_g‘_num_´ofes
();

1050 
i
 = 0; i < 
num_´ofes
; i++) {

1051 ià(
	`¡rcmp
(
´ofes
[
i
].
Çme
, 
´of_Çme
) == 0) {

1056 ià(
i
 < 
num_´ofes
) {

1058 
´of_f’ame
 = (*)
	`ÿÎoc
(
	`¡¾’
(
´ofes
[
i
].
fe
è+ 4 + sŒËn(
PROF_SUBDIR
), ());

1059 ià(!
´of_f’ame
) {

1060 
	`årštf
(
¡d”r
, "Error: out of memory\n");

1061 
”ºo
 = 
ENOMEM
;

1064 
	`¥rštf
(
´of_f’ame
, "%s/%s", 
PROF_SUBDIR
, 
´ofes
[
i
].
fe
);

1065 
·th
 = 
	`­Ş_fe_fšd
(
´of_f’ame
);

1066 ià(!
·th
) {

1067 
	`ä“
(
´of_f’ame
);

1068 
´of_f’ame
 = 
NULL
;

1069 
´of_f’ame
 = (*)
	`ÿÎoc
(
	`¡¾’
(
PROFILE_INSTALL_DIR
è+ sŒËn(
´ofes
[
i
].
fe
) + 4, ());

1070 ià(!
´of_f’ame
) {

1071 
	`årštf
(
¡d”r
, "Error: out of memory\n");

1072 
”ºo
 = 
ENOMEM
;

1075 
	`¥rštf
(
´of_f’ame
, "%s/%s", 
PROFILE_INSTALL_DIR
, 
´ofes
[
i
].
fe
);

1076 
·th
 = 
	`­Ş_fe_fšd
(
´of_f’ame
);

1077 ià(!
·th
) {

1078 
	`årštf
(
¡d”r
, "Error: Unableo find…ath\n");

1079 
”rÜ
 = 
ENOENT
;

1080 
£chk_lßd_´ofe_”rÜ
;

1085 
´oå©h
 = (*)
	`ÿÎoc
(3 + 
	`¡¾’
(
·th
è+ sŒËn(
´of_f’ame
), ());

1086 ià(!
´oå©h
) {

1087 
	`årštf
(
¡d”r
, "Error: out of memory\n");

1088 
”rÜ
 = 
ENOMEM
;

1089 
£chk_lßd_´ofe_”rÜ
;

1091 
	`¥rštf
(
´oå©h
, "%s/%s", 
·th
, 
´of_f’ame
);

1092 
	`ä“
(
·th
);

1093 
	`ä“
(
´of_f’ame
);

1094 
·th
 = 
NULL
;

1095 
´of_f’ame
 = 
NULL
;

1097 
´oå©h
 = 
	`¡rdup
(
´of_Çme
);

1101 
»tv
 = 
	`£chk_lib_·r£_´ofe
(
´oå©h
, 
lib
);

1102 ià(
»tv
) {

1103 
”rÜ
 = 
”ºo
;

1104 
	`årštf
(
¡d”r
, "Error: could‚ot…arse…rofile\n");

1105 
£chk_lßd_´ofe_”rÜ
;

1109 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
lib
->
moduËs
); i++) {

1110 
mod
 = 
	`­Ş_veùÜ_g‘_–em’t
(
lib
->
moduËs
, 
i
);

1111 ià(!
mod
->
£Ëùed
)

1112 
mod
->
ouutfÜm©
 = 
SECHK_OUT_NONE
;

1115 
	`ä“
(
´oå©h
);

1116 
	`ä“
(
´of_f’ame
);

1117 
	`ä“
(
·th
);

1120 
£chk_lßd_´ofe_”rÜ
:

1121 
	`ä“
(
´oå©h
);

1122 
	`ä“
(
´of_f’ame
);

1123 
	`ä“
(
·th
);

1124 
”ºo
 = 
”rÜ
;

1126 
	}
}

1128 
£chk_İtiÚ_Çme_com·»
(cÚ¡ *
a
, cÚ¡ *
b
, *
d©a
 
__©Œibu‹__
 ((
unu£d
)))

1130 
£chk_Çme_v®ue_t
 *
	gš_a
, *
	gš_b
;

1132 
	gš_a
 = (
£chk_Çme_v®ue_t
 *è
a
;

1133 
	gš_b
 = (
£chk_Çme_v®ue_t
 *è
b
;

1135  
¡rcmp
(
š_a
->
Çme
, 
š_b
->name);

1138 
	$£chk_lib_moduË_ş—r_İtiÚ
(
£chk_moduË_t
 * 
moduË
, *
İtiÚ
)

1140 
­Ş_veùÜ_t
 *
Ãw_İts
 = 
NULL
;

1141 
£chk_Çme_v®ue_t
 *
ÃedË
 = 
NULL
, *
nv
 = NULL, *
tmp
 = NULL;

1142 
”rÜ
 = 0;

1143 
size_t
 
i
 = 0;

1145 ià(!
moduË
 || !
İtiÚ
) {

1146 
”ºo
 = 
EINVAL
;

1150 ià(!(
ÃedË
 = 
	`£chk_Çme_v®ue_Ãw
(
İtiÚ
, 
NULL
))) {

1151 
”rÜ
 = 
”ºo
;

1152 
	`ERR
(
moduË
->
·»Á_lib
->
pŞicy
, "CË¬šg o±iÚ %s: %s.", 
İtiÚ
, 
	`¡»¼Ü
(
”rÜ
));

1153 
”ºo
 = 
”rÜ
;

1158 ià(
	`­Ş_veùÜ_g‘_šdex
(
moduË
->
İtiÚs
, 
ÃedË
, 
£chk_İtiÚ_Çme_com·»
, 
NULL
, &
i
) < 0) {

1159 
	`£chk_Çme_v®ue_ä“
(
ÃedË
);

1163 ià(!(
Ãw_İts
 = 
	`­Ş_veùÜ_ü—‹
(
£chk_Çme_v®ue_ä“
))) {

1164 
”rÜ
 = 
”ºo
;

1165 
	`ERR
(
moduË
->
·»Á_lib
->
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

1166 
”ºo
 = 
”rÜ
;

1171 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
moduË
->
İtiÚs
); i++) {

1172 
nv
 = 
	`­Ş_veùÜ_g‘_–em’t
(
moduË
->
İtiÚs
, 
i
);

1173 ià(
	`¡rcmp
(
nv
->
Çme
, 
ÃedË
->name)) {

1174 ià(!(
tmp
 = 
	`£chk_Çme_v®ue_Ãw
(
nv
->
Çme
,‚v->
v®ue
))) {

1175 
”rÜ
 = 
”ºo
;

1176 
	`WARN
(
moduË
->
·»Á_lib
->
pŞicy
, "CË¬šg o±iÚ %s: %s.", 
İtiÚ
, 
	`¡»¼Ü
(
”rÜ
));

1177 
”r
;

1179 ià(
	`­Ş_veùÜ_­³nd
(
Ãw_İts
, (*)
tmp
)) {

1180 
”rÜ
 = 
”ºo
;

1181 
	`WARN
(
moduË
->
·»Á_lib
->
pŞicy
, "CË¬šg o±iÚ %s: %s.", 
İtiÚ
, 
	`¡»¼Ü
(
”rÜ
));

1182 
”r
;

1184 
tmp
 = 
NULL
;

1188 
	`£chk_Çme_v®ue_ä“
(
ÃedË
);

1189 
	`­Ş_veùÜ_de¡roy
(&
moduË
->
İtiÚs
);

1190 
moduË
->
İtiÚs
 = 
Ãw_İts
;

1194 
”r
:

1195 
	`£chk_Çme_v®ue_ä“
(
tmp
);

1196 
	`£chk_Çme_v®ue_ä“
(
ÃedË
);

1197 
	`­Ş_veùÜ_de¡roy
(&
Ãw_İts
);

1198 
”ºo
 = 
”rÜ
;

1200 
	}
}

1203 
	$£chk_lib_g‘_moduË_idx
(cÚ¡ *
Çme
, 
£chk_lib_t
 * 
lib
)

1205 
size_t
 
i
;

1206 
£chk_moduË_t
 *
mod
 = 
NULL
;

1208 ià(!
Çme
 || !
lib
 || !lib->
moduËs
) {

1209 
”ºo
 = 
EINVAL
;

1212 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
lib
->
moduËs
); i++) {

1213 
mod
 = 
	`­Ş_veùÜ_g‘_–em’t
(
lib
->
moduËs
, 
i
);

1214 ià(
mod
->
Çme
 && !
	`¡rcmp
(name, mod->name))

1215  
i
;

1217 
”ºo
 = 
ENOENT
;

1219 
	}
}

1221 
£chk_´oof_w™h_–em’t_com·»
(cÚ¡ *
š_´oof
, cÚ¡ *
–em
, *
unu£d
 
__©Œibu‹__
 ((unused)))

1223 cÚ¡ 
£chk_´oof_t
 *
	g´oof
 = (cÚ¡ sechk_´oof_ˆ*)
š_´oof
;

1225 ià(!
	g´oof
)

1229  ()((*)
	g´oof
->
	g–em
 - (*)elem);

	@sechecker/sechecker.h

25 #iâdeà
SECHECKER_H


26 
	#SECHECKER_H


	)

28 #ifdef 
__ılu¥lus


33 
	~<cÚfig.h
>

35 
	~<¡dboŞ.h
>

37 
	~<­Ş/pŞicy.h
>

38 
	~<­Ş/pŞicy-·th.h
>

39 
	~<­Ş/pŞicy-qu”y.h
>

40 
	~<­Ş/veùÜ.h
>

41 
	~<­Ş/ut.h
>

43 
	~<£fs/fcfe.hh
>

44 
	~<libxml/xml¡ršg.h
>

47 #iâdeà
PROF_SUBDIR


48 
	#PROF_SUBDIR
 "/£check”-´ofes"

	)

50 #iâdeà
DEFAULT_PROFILE


51 
	#DEFAULT_PROFILE
 ""

	)

56 
	#SECHK_OUT_STATS
 0x01

	)

57 
	#SECHK_OUT_LIST
 0x02

	)

58 
	#SECHK_OUT_PROOF
 0x04

	)

61 
	#SECHK_OUT_NONE
 0x00

	)

62 
	#SECHK_OUT_QUIET
 0x20

	)

63 
	#SECHK_OUT_SHORT
 (
SECHK_OUT_STATS
|
SECHK_OUT_LIST
)

	)

64 
	#SECHK_OUT_VERBOSE
 (
SECHK_OUT_STATS
|
SECHK_OUT_PROOF
)

	)

66 (*
ä“_â_t
è(*
	tx
);

69 
	#SECHK_SEV_NONE
 "nÚe"

	)

70 
	#SECHK_SEV_LOW
 "low"

	)

71 
	#SECHK_SEV_MED
 "med"

	)

72 
	#SECHK_SEV_HIGH
 "high"

	)

77 
	#SECHK_REQ_POLICY_CAP
 "ÿ·b™y"

	)

80 
	#SECHK_REQ_SYSTEM
 "sy¡em"

	)

83 
	#SECHK_REQ_FILE_CONTEXTS
 "fe_cÚ‹xts"

	)

86 
	#SECHK_REQ_DEFAULT_CONTEXTS
 "deçuÉ_cÚ‹xts"

	)

90 
	#SECHK_REQ_CAP_ATTRIB_NAMES
 "©Œibu‹‚ames"

	)

92 
	#SECHK_REQ_CAP_SYN_RULES
 "syÁaùiøruËs"

	)

94 
	#SECHK_REQ_CAP_LINE_NOS
 "lšnumb”s"

	)

96 
	#SECHK_REQ_CAP_CONDITIONALS
 "cÚd™iÚ®s"

	)

98 
	#SECHK_REQ_CAP_MLS
 "mls"

	)

100 
	#SECHK_REQ_CAP_MODULES
 "moduË†ßdšg"

	)

102 
	#SECHK_REQ_CAP_RULES_LOADED
 "ruË lßded"

	)

106 
	#SECHK_REQ_SYS_SELINUX
 "£lšux"

	)

108 
	#SECHK_REQ_SYS_MLS
 "mls"

	)

111 
	e£chk_™em_ty³


113 
SECHK_ITEM_CLASS
,

114 
SECHK_ITEM_COMMON
,

115 
SECHK_ITEM_PERM
,

116 
SECHK_ITEM_CONSTR
,

117 
SECHK_ITEM_VTRANS
,

118 
SECHK_ITEM_QLEVEL
,

119 
SECHK_ITEM_CAT
,

120 
SECHK_ITEM_QMLSLEVEL
,

121 
SECHK_ITEM_QMLSRANGE
,

122 
SECHK_ITEM_AMLSLEVEL
,

123 
SECHK_ITEM_AMLSRANGE
,

124 
SECHK_ITEM_TYPE
,

125 
SECHK_ITEM_ATTRIB
,

126 
SECHK_ITEM_ROLE
,

127 
SECHK_ITEM_USER
,

128 
SECHK_ITEM_COND
,

129 
SECHK_ITEM_AVRULE
,

130 
SECHK_ITEM_TERULE
,

131 
SECHK_ITEM_RALLOW
,

132 
SECHK_ITEM_RTRAMS
,

133 
SECHK_ITEM_RANGETRANS
,

134 
SECHK_ITEM_BOOL
,

135 
SECHK_ITEM_FSUSE
,

136 
SECHK_ITEM_GENFSCON
,

137 
SECHK_ITEM_ISID
,

138 
SECHK_ITEM_NETIFCON
,

139 
SECHK_ITEM_NODECON
,

140 
SECHK_ITEM_PORTCON
,

141 
SECHK_ITEM_CONTEXT
,

143 
SECHK_ITEM_FCENT
,

144 
SECHK_ITEM_STR
,

145 
SECHK_ITEM_DTR
,

146 
SECHK_ITEM_OTHER
,

147 
SECHK_ITEM_NONE


148 } 
	t£chk_™em_ty³_e
;

152 
	s£chk_´oof


155 *
–em
;

157 
£chk_™em_ty³_e
 
ty³
;

159 *
‹xt
;

160 
xmlCh¬
 *
xml_out
;

162 
ä“_â_t
 
–em_ä“_â
;

163 } 
	t£chk_´oof_t
;

167 
	s£chk_™em


170 *
™em
;

173 
‹¡_»suÉ
;

176 
­Ş_veùÜ_t
 *
´oof
;

178 
ä“_â_t
 
™em_ä“_â
;

179 } 
	t£chk_™em_t
;

184 
	s£chk_»suÉ


187 *
‹¡_Çme
;

189 
£chk_™em_ty³_e
 
™em_ty³
;

191 
­Ş_veùÜ_t
 *
™ems
;

192 } 
	t£chk_»suÉ_t
;

196 
	s£chk_Çme_v®ue


198 *
Çme
;

199 *
v®ue
;

200 } 
	t£chk_Çme_v®ue_t
;

205 
	s£chk_lib


208 
­Ş_veùÜ_t
 *
moduËs
;

210 
­Ş_pŞicy_t
 *
pŞicy
;

212 
­Ş_veùÜ_t
 *
fc_’Œ›s
;

214 *
fc_·th
;

216 
£fs_fşi¡_t
 *
fc_fe
;

218 
ouutfÜm©
;

220 *
£lšux_cÚfig_·th
;

222 
­Ş_pŞicy_·th_t
 *
pŞicy_·th
;

224 cÚ¡ *
mš£v
;

225 } 
	t£chk_lib_t
;

227 
	s£chk_moduË


230 *
Çme
;

232 cÚ¡ *
br›f_desütiÚ
;

235 cÚ¡ *
d‘aed_desütiÚ
;

237 cÚ¡ *
İt_desütiÚ
;

239 
£chk_»suÉ_t
 *
»suÉ
;

242 
­Ş_veùÜ_t
 *
İtiÚs
;

246 
­Ş_veùÜ_t
 *
»quœem’ts
;

249 
­Ş_veùÜ_t
 *
d•’d’c›s
;

252 
­Ş_veùÜ_t
 *
funùiÚs
;

254 
ouutfÜm©
;

257 
boŞ
 
£Ëùed
;

259 cÚ¡ *
£v”™y
;

262 *
d©a
;

264 
ä“_â_t
 
d©a_ä“
;

266 cÚ¡ 
£chk_lib_t
 *
·»Á_lib
;

267 } 
	t£chk_moduË_t
;

278 (*
£chk_»gi¡”_â_t
è(
	t£chk_lib_t
 * 
	tlib
);

291 (*
£chk_mod_â_t
è(
	t£chk_moduË_t
 * 
	tmod
, 
	t­Ş_pŞicy_t
 * 
	tpŞicy
, *
	t¬g
);

294 
	#SECHK_MOD_FN_INIT
 "š™"

	)

295 
	#SECHK_MOD_FN_RUN
 "run"

	)

296 
	#SECHK_MOD_FN_PRINT
 "´št"

	)

300 
	s£chk_â


303 *
Çme
;

305 
£chk_mod_â_t
 
â
;

306 } 
	t£chk_â_t
;

310 
	s£chk_moduË_Çme_»g


313 *
Çme
;

315 
£chk_»gi¡”_â_t
 
â
;

316 } 
	t£chk_moduË_Çme_»g_t
;

320 
	s£chk_´ofe_Çme_»g


323 *
Çme
;

325 *
fe
;

327 *
desc
;

328 } 
	t£chk_´ofe_Çme_»g_t
;

339 
£chk_lib_t
 *
£chk_lib_Ãw
();

348 
£chk_moduË_t
 *
£chk_moduË_Ãw
();

357 
£chk_â_t
 *
£chk_â_Ãw
();

369 
£chk_Çme_v®ue_t
 *
£chk_Çme_v®ue_Ãw
(cÚ¡ *
Çme
, cÚ¡ *
v®ue
);

378 
£chk_»suÉ_t
 *
£chk_»suÉ_Ãw
();

389 
£chk_™em_t
 *
£chk_™em_Ãw
(
ä“_â_t
 
â
);

400 
£chk_´oof_t
 *
£chk_´oof_Ãw
(
ä“_â_t
 
â
);

409 
£chk_lib_de¡roy
(
£chk_lib_t
 ** 
lib
);

416 
£chk_â_ä“
(*
â_¡ruù
);

423 
£chk_»suÉ_de¡roy
(
£chk_»suÉ_t
 ** 
»s
);

430 
£chk_™em_ä“
(*
™em
);

437 
£chk_´oof_ä“
(*
´oof
);

444 
£chk_moduË_ä“
(*
moduË
);

451 
£chk_Çme_v®ue_ä“
(*
nv
);

463 
£chk_lib_»gi¡”_moduËs
(cÚ¡ 
£chk_moduË_Çme_»g_t
 * 
»gi¡”_âs
, 
£chk_lib_t
 * 
lib
);

475 
£chk_lib_check_moduË_d•’d’c›s
(
£chk_lib_t
 * 
lib
);

490 
£chk_lib_check_moduË_»quœem’ts
(
£chk_lib_t
 * 
lib
);

502 
£chk_lib_š™_moduËs
(
£chk_lib_t
 * 
lib
);

512 
£chk_lib_run_moduËs
(
£chk_lib_t
 * 
lib
);

522 
£chk_lib_´št_moduËs_»pÜt
(
£chk_lib_t
 * 
lib
);

534 
£chk_moduË_t
 *
£chk_lib_g‘_moduË
(cÚ¡ *
moduË_Çme
, cÚ¡ 
£chk_lib_t
 * 
lib
);

546 
£chk_mod_â_t
 
£chk_lib_g‘_moduË_funùiÚ
(cÚ¡ *
moduË_Çme
, cÚ¡ *
funùiÚ_Çme
, cÚ¡ 
£chk_lib_t
 * 
lib
);

559 
£chk_»suÉ_t
 *
£chk_lib_g‘_moduË_»suÉ
(cÚ¡ *
moduË_Çme
, cÚ¡ 
£chk_lib_t
 * 
lib
);

571 
£chk_lib_lßd_pŞicy
(
­Ş_pŞicy_·th_t
 * 
pŞicy_mods
, 
£chk_lib_t
 * 
lib
);

582 
£chk_lib_lßd_fc
(cÚ¡ *
fcf–oÿtiÚ
, 
£chk_lib_t
 * 
lib
);

594 
£chk_lib_lßd_´ofe
(cÚ¡ *
´of_Çme
, 
£chk_lib_t
 * 
lib
);

605 
£chk_lib_moduË_ş—r_İtiÚ
(
£chk_moduË_t
 * 
moduË
, *
İtiÚ
);

616 
boŞ
 
£chk_lib_check_»quœem’t
(
£chk_Çme_v®ue_t
 * 
»q
, 
£chk_lib_t
 * 
lib
);

627 
boŞ
 
£chk_lib_check_d•’d’cy
(
£chk_Çme_v®ue_t
 * 
d•
, 
£chk_lib_t
 * 
lib
);

638 
£chk_lib_£t_ouutfÜm©
(
out
, 
£chk_lib_t
 * 
lib
);

650 
£chk_lib_£t_mš£v
(cÚ¡ *
£v
, 
£chk_lib_t
 * 
lib
);

661 
£chk_lib_g‘_moduË_idx
(cÚ¡ *
Çme
, 
£chk_lib_t
 * 
lib
);

673 
£chk_´oof_t
 *
£chk_´oof_cİy
(£chk_´oof_ˆ* 
Üig
);

689 
£chk_´oof_w™h_–em’t_com·»
(cÚ¡ *
š_´oof
, cÚ¡ *
–em
, *
unu£d
);

691 #ifdef 
__ılu¥lus


	@sechecker/sechecker_cli.c

24 
	~<cÚfig.h
>

26 
	~"£check”.h
"

27 
	~"»gi¡”_li¡.h
"

28 
	~<­Ş/pŞicy.h
>

30 
	~<¡dio.h
>

31 
	~<¡ršg.h
>

32 
	~<g‘İt.h
>

33 
	~<”ºo.h
>

35 
	#COPYRIGHT_INFO
 "Cİyrighˆ(Cè2005-2007 T»sy TechnŞogy, LLC"

	)

37 
£chk_moduË_Çme_»g_t
 
£chk_»gi¡”_li¡
[];

39 
	eİt_v®ues


41 
	mOPT_FCFILE
 = 256, 
	mOPT_MIN_SEV


45 
İtiÚ
 cÚ¡ 
	glÚgİts
[] = {

46 {"li¡", 
no_¬gum’t
, 
NULL
, 'l'},

47 {"h–p", 
İtiÚ®_¬gum’t
, 
NULL
, 'h'},

48 {"v”siÚ", 
no_¬gum’t
, 
NULL
, 'V'},

49 {"qu›t", 
no_¬gum’t
, 
NULL
, 'q'},

50 {"shÜt", 
no_¬gum’t
, 
NULL
, 's'},

51 {"v”bo£", 
no_¬gum’t
, 
NULL
, 'v'},

52 {"´ofe", 
»quœed_¬gum’t
, 
NULL
, 'p'},

53 {"fcfe", 
»quœed_¬gum’t
, 
NULL
, 
OPT_FCFILE
},

54 {"moduË", 
»quœed_¬gum’t
, 
NULL
, 'm'},

55 {"mš-£v", 
»quœed_¬gum’t
, 
NULL
, 
OPT_MIN_SEV
},

56 {
NULL
, 0, NULL, 0}

60 
	$u§ge
(cÚ¡ *
¬g0
, 
boŞ
 
br›f
)

62 
	`´štf
("Usage: sechecker [OPTIONS] -p…rofile [POLICY ...]\n");

63 
	`´štf
(" sechecker [OPTIONS] -m module [POLICY ...]\n");

64 
	`´štf
(" sechecker [OPTIONS] -p…rofile -m module [POLICY ...]\n");

65 
	`´štf
("\n");

66 ià(
br›f
) {

67 
	`´štf
("\tTry % --h–°fÜ mÜh–p.\n\n", 
¬g0
);

69 
	`´štf
("Perform modular checks on‡ SELinux…olicy.\n");

70 
	`´štf
("\n");

71 
	`´štf
(" -p PROF, --profile=PROF‚ame or…ath of…rofileo†oad\n");

72 
	`´štf
(" if used without -m,„un‡ll modules in…rofile\n");

73 
	`´štf
(" -m MODULE, --module=MODULE MODULEo„un\n");

74 
	`´štf
(" --fcfile=FILE file_contexts fileo†oad\n");

75 
	`´štf
("\n");

76 
	`´štf
(" -q, --quiet suppress output\n");

77 
	`´štf
(" -s, --short…rint short output\n");

78 
	`´štf
(" -v, --verbose…rint verbose output\n");

79 
	`´štf
(" --min-sev={low|med|high} sethe minimum severityo„eport\n");

80 
	`´štf
("\n");

81 
	`´štf
(" -l, --list…rint‡†ist of…rofiles‡nd modules‡ndƒxit\n");

82 
	`´štf
(" -h[MODULE], --help[=MODULE]…rinthis helpext or help for MODULE\n");

83 
	`´štf
(" -V, --version…rint version information‡ndƒxit\n");

84 
	`´štf
("\n");

86 
	}
}

89 
	$£chk_´št_li¡
(
£chk_lib_t
 * 
lib
)

91 cÚ¡ 
£chk_´ofe_Çme_»g_t
 *
´ofes
;

92 
size_t
 
num_´ofes
, 
i
;

93 
£chk_moduË_t
 *
mod
 = 
NULL
;

95 
	`´štf
("\nProfiles:\n");

96 
´ofes
 = 
	`£chk_»gi¡”_li¡_g‘_´ofes
();

97 
num_´ofes
 = 
	`£chk_»gi¡”_li¡_g‘_num_´ofes
();

98 
i
 = 0; i < 
num_´ofes
; i++) {

99 
	`´štf
("%20s\t%s\n", 
´ofes
[
i
].
Çme
,…rofes[i].
desc
);

101 ià(
num_´ofes
 == 0)

102 
	`´štf
("<none>\n");

104 
	`´štf
("Modules:\n");

105 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
lib
->
moduËs
); i++) {

106 
mod
 = 
	`­Ş_veùÜ_g‘_–em’t
(
lib
->
moduËs
, 
i
);

107 
	`´štf
("%20s\t%s\n", 
mod
->
Çme
, mod->
br›f_desütiÚ
);

109 ià(
	`­Ş_veùÜ_g‘_size
(
lib
->
moduËs
) == 0)

110 
	`´štf
("<none>\n");

111 
	`´štf
("\n");

113 
	}
}

116 
	$maš
(
¬gc
, **
¬gv
)

118 
İtc
 = 0, 
»tv
 = 0;

119 
size_t
 
i
;

120 *
fı©h
 = 
NULL
;

121 *
modÇme
 = 
NULL
;

122 *
´of_Çme
 = 
NULL
;

123 *
ba£_·th
 = 
NULL
;

124 
­Ş_pŞicy_·th_t
 *
pŞ_·th
 = 
NULL
;

125 
­Ş_pŞicy_·th_ty³_e
 
·th_ty³
 = 
APOL_POLICY_PATH_TYPE_MONOLITHIC
;

126 *
mš£v
 = 
NULL
;

127 
ouut_ov”ride
 = 0;

128 
£chk_lib_t
 *
lib
;

129 
£chk_moduË_t
 *
mod
 = 
NULL
;

130 
boŞ
 
li¡_¡İ
 = 
çl£
;

131 
boŞ
 
moduË_h–p
 = 
çl£
;

132 
­Ş_veùÜ_t
 *
pŞicy_mods
 = 
NULL
;

134 (
İtc
 = 
	`g‘İt_lÚg
(
¬gc
, 
¬gv
, "p:m:qsvlh::V", 
lÚgİts
, 
NULL
)) != -1) {

135 
İtc
) {

137 
´of_Çme
 = 
	`¡rdup
(
İrg
);

140 ià(
mš£v
) {

141 
	`årštf
(
¡d”r
, "Error: --min-sev does‚ot work with --module.\n");

142 
	`ex™
(1);

144 
modÇme
 = 
	`¡rdup
(
İrg
);

146 
OPT_FCFILE
:

147 
fı©h
 = 
	`¡rdup
(
İrg
);

150 ià(
ouut_ov”ride
) {

151 
	`årštf
(
¡d”r
, "Error: multiple output formats specified.\n");

152 
	`u§ge
(
¬gv
[0], 1);

153 
	`ex™
(1);

155 
ouut_ov”ride
 = 
SECHK_OUT_QUIET
;

159 ià(
ouut_ov”ride
) {

160 
	`årštf
(
¡d”r
, "Error: multiple output formats specified.\n");

161 
	`u§ge
(
¬gv
[0], 1);

162 
	`ex™
(1);

164 
ouut_ov”ride
 = 
SECHK_OUT_SHORT
;

168 ià(
ouut_ov”ride
) {

169 
	`årštf
(
¡d”r
, "Error: multiple output formats specified.\n");

170 
	`u§ge
(
¬gv
[0], 1);

171 
	`ex™
(1);

173 
ouut_ov”ride
 = 
SECHK_OUT_VERBOSE
;

176 
OPT_MIN_SEV
:

177 ià(
modÇme
) {

178 
	`årštf
(
¡d”r
, "Error: --min-sev does‚ot work with --module.\n");

179 
	`ex™
(1);

181 
mš£v
 = 
	`¡rdup
(
İrg
);

184 
li¡_¡İ
 = 
Œue
;

187 ià(
İrg
 !ğ
NULL
) {

188 
modÇme
 = 
	`¡rdup
(
İrg
);

189 
moduË_h–p
 = 
Œue
;

192 
	`u§ge
(
¬gv
[0], 0);

193 
	`ex™
(0);

195 
	`´štf
("£check” %s\n%s\n", 
VERSION
, 
COPYRIGHT_INFO
);

196 
	`ex™
(0);

198 
	`u§ge
(
¬gv
[0], 1);

199 
	`ex™
(1);

203 ià(!
´of_Çme
 && !
modÇme
 && !
li¡_¡İ
) {

204 
	`årštf
(
¡d”r
, "Error:‚o module or…rofile specified\n\n");

205 
	`u§ge
(
¬gv
[0], 1);

206 
	`ex™
(1);

210 
lib
 = 
	`£chk_lib_Ãw
();

211 ià(!
lib
)

212 
ex™_”r
;

215 ià(
li¡_¡İ
 =ğ
Œue
) {

216 
	`£chk_´št_li¡
(
lib
);

217 
ex™
;

221 ià(
moduË_h–p
 =ğ
Œue
) {

222 
»tv
 = 
	`£chk_lib_g‘_moduË_idx
(
modÇme
, 
lib
);

223 ià(
»tv
 < 0) {

224 
	`årštf
(
¡d”r
, "E¼Ü: ModuË % dÛ nÙƒxi¡.\n", 
modÇme
);

225 
ex™_”r
;

227 
mod
 = 
	`­Ş_veùÜ_g‘_–em’t
(
lib
->
moduËs
, 
»tv
);

228 
	`´štf
("\nModuË‚ame: %s\n%s\n%s\n", 
mod
->
Çme
, mod->
d‘aed_desütiÚ
, mod->
İt_desütiÚ
);

229 
ex™
;

233 ià(
´of_Çme
) {

234 
»tv
 = 
	`£chk_lib_lßd_´ofe
(
´of_Çme
, 
lib
);

235 ià(
»tv
) {

236 
»tv
 = 
”ºo
;

237 ià(!
ouut_ov”ride
 || !(ouut_ov”rid& ~(
SECHK_OUT_QUIET
))) {

238 
	`årštf
(
¡d”r
, "E¼Ü: could‚Ù†ßd…rof%s\n", 
´of_Çme
);

239 
”ºo
 = 
»tv
;

240 
	`³¼Ü
("Error");

242 
ex™_”r
;

247 ià(
¬gc
 - 
İtšd
) {

248 
ba£_·th
 = 
¬gv
[
İtšd
];

249 
İtšd
++;

250 ià(
¬gc
 - 
İtšd
) {

251 ià(!(
pŞicy_mods
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)))

252 
ex™_”r
;

253 
¬gc
 - 
İtšd
) {

254 ià(
	`­Ş_veùÜ_­³nd
(
pŞicy_mods
, 
¬gv
[
İtšd
++]))

255 
ex™_”r
;

256 
·th_ty³
 = 
APOL_POLICY_PATH_TYPE_MODULAR
;

258 } ià(
	`­Ş_fe_is_pŞicy_·th_li¡
(
ba£_·th
) > 0) {

259 
pŞ_·th
 = 
	`­Ş_pŞicy_·th_ü—‹_äom_fe
(
ba£_·th
);

260 ià(!
pŞ_·th
) {

261 
	`årštf
(
¡d”r
, "Error: invalid…olicy†ist\n");

262 
ex™_”r
;

265 ià(!
pŞ_·th
)

266 
pŞ_·th
 = 
	`­Ş_pŞicy_·th_ü—‹
(
·th_ty³
, 
ba£_·th
, 
pŞicy_mods
);

267 ià(!
pŞ_·th
)

268 
ex™_”r
;

269 ià(
	`£chk_lib_lßd_pŞicy
(
pŞ_·th
, 
lib
)) {

270 
pŞ_·th
 = 
NULL
;

271 
ex™_”r
;

274 ià(
	`£chk_lib_lßd_pŞicy
(
NULL
, 
lib
))

275 
ex™_”r
;

278 
pŞ_·th
 = 
NULL
;

281 ià(
mš£v
 && 
	`£chk_lib_£t_mš£v
(mš£v, 
lib
) < 0)

282 
ex™_”r
;

285 ià(
	`£chk_lib_lßd_fc
(
fı©h
, 
lib
) < 0)

286 
ex™_”r
;

288 ià(
ouut_ov”ride
) {

289 ià(
	`£chk_lib_£t_ouutfÜm©
(
ouut_ov”ride
, 
lib
) < 0)

290 
ex™_”r
;

294 ià(
modÇme
) {

295 
»tv
 = 
	`£chk_lib_g‘_moduË_idx
(
modÇme
, 
lib
);

296 ià(
»tv
 =ğ-1 || (
size_t
è»tv >ğ
	`­Ş_veùÜ_g‘_size
(
lib
->
moduËs
)) {

297 
	`årštf
(
¡d”r
, "E¼Ü: moduË % nÙ found\n", 
modÇme
);

298 
ex™_”r
;

300 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
lib
->
moduËs
); i++) {

301 
mod
 = 
	`­Ş_veùÜ_g‘_–em’t
(
lib
->
moduËs
, 
i
);

302 
mod
->
£Ëùed
 = 
çl£
;

304 
mod
 = 
	`­Ş_veùÜ_g‘_–em’t
(
lib
->
moduËs
, 
»tv
);

305 
mod
->
£Ëùed
 = 
Œue
;

309 ià(
	`£chk_lib_check_moduË_d•’d’c›s
(
lib
) < 0)

310 
ex™_”r
;

313 ià(
	`£chk_lib_check_moduË_»quœem’ts
(
lib
) < 0)

314 
ex™_”r
;

317 ià(
	`£chk_lib_š™_moduËs
(
lib
))

318 
ex™_”r
;

321 ià(
	`£chk_lib_run_moduËs
(
lib
))

322 
ex™_”r
;

325 ià(
modÇme
) {

326 
»tv
 = 
	`£chk_lib_g‘_moduË_idx
(
modÇme
, 
lib
);

327 ià(
»tv
 =ğ-1 || (
size_t
è»tv >ğ
	`­Ş_veùÜ_g‘_size
(
lib
->
moduËs
)) {

328 
	`årštf
(
¡d”r
, "E¼Ü: moduË % nÙ found\n", 
modÇme
);

329 
ex™_”r
;

331 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
lib
->
moduËs
); i++) {

332 
mod
 = 
	`­Ş_veùÜ_g‘_–em’t
(
lib
->
moduËs
, 
i
);

333 
mod
->
£Ëùed
 = 
çl£
;

335 
mod
 = 
	`­Ş_veùÜ_g‘_–em’t
(
lib
->
moduËs
, 
»tv
);

336 
mod
->
£Ëùed
 = 
Œue
;

340 ià(
	`£chk_lib_´št_moduËs_»pÜt
(
lib
))

341 
ex™_”r
;

343 
ex™
:

344 
	`ä“
(
fı©h
);

345 
	`­Ş_veùÜ_de¡roy
(&
pŞicy_mods
);

346 
	`ä“
(
mš£v
);

347 
	`ä“
(
´of_Çme
);

348 
	`ä“
(
modÇme
);

349 
	`£chk_lib_de¡roy
(&
lib
);

352 
ex™_”r
:

353 
	`ä“
(
fı©h
);

354 
	`­Ş_veùÜ_de¡roy
(&
pŞicy_mods
);

355 
	`ä“
(
mš£v
);

356 
	`ä“
(
´of_Çme
);

357 
	`ä“
(
modÇme
);

358 
	`­Ş_pŞicy_·th_de¡roy
(&
pŞ_·th
);

359 
	`£chk_lib_de¡roy
(&
lib
);

361 
	}
}

	@sechecker/sechk_parse.c

22 
	~"£check”.h
"

23 
	~"£chk_·r£.h
"

24 
	~<­Ş/ut.h
>

25 
	~<libxml/xmÌ—d”.h
>

26 
	~<”ºo.h
>

27 
	~<¡ršg.h
>

30 
	#SECHK_PARSE_SECHECKER_TAG
 "£check”"

	)

31 
	#SECHK_PARSE_PROFILE_TAG
 "´ofe"

	)

32 
	#SECHK_PARSE_MODULE_TAG
 "moduË"

	)

33 
	#SECHK_PARSE_OPTION_TAG
 "İtiÚ"

	)

34 
	#SECHK_PARSE_ITEM_TAG
 "™em"

	)

35 
	#SECHK_PARSE_OUTPUT_TAG
 "ouut"

	)

36 
	#SECHK_PARSE_VALUE_ATTRIB
 "v®ue"

	)

37 
	#SECHK_PARSE_NAME_ATTRIB
 "Çme"

	)

38 
	#SECHK_PARSE_VERSION_ATTRIB
 "v”siÚ"

	)

39 
	#SECHK_PARSE_OUTPUT_NONE
 "nÚe"

	)

40 
	#SECHK_PARSE_OUTPUT_QUIET
 "qu›t"

	)

41 
	#SECHK_PARSE_OUTPUT_SHORT
 "shÜt"

	)

42 
	#SECHK_PARSE_OUTPUT_VERBOSE
 "v”bo£"

	)

44 *
	$bud_dtd_·th
()

46 *
·th
 = 
NULL
;

47 
size_t
 
·th_sz
 = 0;

49 #ifdeà
PROFILE_INSTALL_DIR


50 ià(
	`­Ş_¡r_­³nd
(&
·th
, &
·th_sz
, "file://localhost/") == -1)

51  
NULL
;

53 ià(
	`­Ş_¡r_­³nd
(&
·th
, &
·th_sz
, 
PROFILE_INSTALL_DIR
) == -1)

54  
NULL
;

56 ià(
	`­Ş_¡r_­³nd
(&
·th
, &
·th_sz
, "/sechecker.dtd") == -1)

57  
NULL
;

59  
·th
;

62  
NULL
;

63 
	}
}

68 
	$£chk_lib_·r£_xml_fe
(cÚ¡ *
f’ame
, 
£chk_lib_t
 * 
lib
)

70 
xmlTextR—d”PŒ
 
»ad”
 = 
NULL
;

71 
xmlDtdPŒ
 
dtd
 = 
NULL
;

72 
xmlDocPŒ
 
xml
 = 
NULL
;

73 
xmlV®idCtxtPŒ
 
ùxt
 = 
NULL
;

74 
tmp
, 
»t
 = 0;

75 *
dtd_·th
 = 
NULL
;

80 
LIBXML_TEST_VERSION
;

81 
»ad”
 = 
	`xmlR—d”FÜFe
(
f’ame
, 
NULL
, 0);

82 ià(!
»ad”
) {

83 
»t
 = 
”ºo
;

84 ià(
»t
 !ğ
ENOENT
)

85 
	`årštf
(
¡d”r
, "Error: Could‚ot create xmlReader.\n");

86 
ex™_”r
;

89 
dtd_·th
 = 
	`bud_dtd_·th
();

90 ià(!
dtd_·th
) {

91 
	`årštf
(
¡d”r
, "Error: getting DTD…ath\n");

92 
ex™_”r
;

94 
dtd
 = 
	`xmlP¬£DTD
(
NULL
, (cÚ¡ 
xmlCh¬
 *)
dtd_·th
);

95 
	`ä“
(
dtd_·th
);

97 ià(!
dtd
) {

98 
	`årštf
(
¡d”r
, "Error:…arsing DTD\n");

99 
ex™_”r
;

102 
xml
 = 
	`xmlP¬£Fe
(
f’ame
);

103 ià(!
xml
) {

104 
	`årštf
(
¡d”r
, "Error:…arsing sechecker…rofile\n");

105 
ex™_”r
;

108 
ùxt
 = 
	`xmlNewV®idCtxt
();

109 ià(!
ùxt
) {

110 
	`årštf
(
¡d”r
, "Error: out of memory\n");

111 
ex™_”r
;

114 ià(
	`xmlV®id©eDtd
(
ùxt
, 
xml
, 
dtd
) == 0) {

115 
	`årštf
(
¡d”r
, "Error: SEChecker…rofile contains invalid XML. Aborting.\n");

116 
ex™_”r
;

118 
	`xmlF»eV®idCtxt
(
ùxt
);

119 
	`xmlF»eDoc
(
xml
);

120 
	`xmlF»eDtd
(
dtd
);

123 
»t
 = 
	`xmlTextR—d”R—d
(
»ad”
);

124 ià(
»t
 == -1) {

125 
»t
 = 
”ºo
;

126 
	`årštf
(
¡d”r
, "Error: Error„eading xml.\n");

127 
ex™_”r
;

129 ià(
»t
 == 0)

132 
tmp
 = 
	`£chk_lib_´oûss_xml_node
(
»ad”
, 
lib
);

133 ià(
tmp
 == -1)

134 
ex™_”r
;

135 ià(
tmp
 == 1) {

136 
»t
 = 
	`xmlTextR—d”Next
(
»ad”
);

137 ià(
»t
 == 0)

139 ià(
»t
 == -1) {

140 
»t
 = 
”ºo
;

141 
	`årštf
(
¡d”r
, "Error in xmlTextReaderNext()\n");

142 
ex™_”r
;

148 
	`xmlCËªupP¬£r
();

149 
	`xmlF»eTextR—d”
(
»ad”
);

152 
ex™_”r
:

153 
	`xmlCËªupP¬£r
();

154 ià(
»ad”
)

155 
	`xmlF»eTextR—d”
(
»ad”
);

156 ià(
»t
)

157 
”ºo
 = 
»t
;

159 
	}
}

162 
	$£chk_lib_´oûss_xml_node
(
xmlTextR—d”PŒ
 
»ad”
, 
£chk_lib_t
 * 
lib
)

164 
xmlCh¬
 *
©Œib
 = 
NULL
;

165 
idx
;

166 
£chk_Çme_v®ue_t
 *
nv
 = 
NULL
;

167 
xmlCh¬
 *
İtiÚ
 = 
NULL
;

168 
xmlCh¬
 *
v®ue
 = 
NULL
;

169 
£chk_moduË_t
 *
cu¼’t_moduË
 = 
NULL
;

171 
	`xmlTextR—d”NodeTy³
(
»ad”
)) {

173 
XML_ELEMENT_DECL
:

174 ià(
	`xmlSŒEqu®
(
	`xmlTextR—d”CÚ¡Name
(
»ad”
), (
xmlCh¬
 *è
SECHK_PARSE_MODULE_TAG
) == 1) {

175 
cu¼’t_moduË
 = 
NULL
;

176 } ià(
	`xmlSŒEqu®
(
	`xmlTextR—d”CÚ¡Name
(
»ad”
), (
xmlCh¬
 *è
SECHK_PARSE_OPTION_TAG
) == 1) {

177 
	`ä“
(
İtiÚ
);

178 
İtiÚ
 = 
NULL
;

182 
XML_ELEMENT_NODE
:

184 ià(
	`xmlSŒEqu®
(
	`xmlTextR—d”CÚ¡Name
(
»ad”
), (
xmlCh¬
 *è
SECHK_PARSE_SECHECKER_TAG
) == 1) {

186 
©Œib
 = 
	`xmlTextR—d”G‘A‰ribu‹
(
»ad”
, (
xmlCh¬
 *è
SECHK_PARSE_VERSION_ATTRIB
);

187 ià(
©Œib
) {

188 #ifdeà
SECHECKER_VERSION


189 ià(
	`©of
((cÚ¡ *)
©Œib
è>‡tof(
SECHECKER_VERSION
)) {

190 
	`årštf
(
¡d”r
,

192 
	`©of
(
SECHECKER_VERSION
),‡tof((cÚ¡ *)
©Œib
));

193 
ex™_”r
;

197 
	`ä“
(
©Œib
);

198 
©Œib
 = 
NULL
;

200 
	`årštf
(
¡d”r
, "Warning: sechecker version is‚ot specified.\n");

202 } ià(
	`xmlSŒEqu®
(
	`xmlTextR—d”CÚ¡Name
(
»ad”
), (
xmlCh¬
 *è
SECHK_PARSE_MODULE_TAG
) == 1) {

204 
©Œib
 = 
	`xmlTextR—d”G‘A‰ribu‹
(
»ad”
, (
xmlCh¬
 *è
SECHK_PARSE_NAME_ATTRIB
);

205 ià(
©Œib
) {

206 ià((
idx
 = 
	`£chk_lib_g‘_moduË_idx
((cÚ¡ *)
©Œib
, 
lib
)) == -1) {

207 
	`årštf
(
¡d”r
, "W¬nšg: moduË % nÙ found.\n", (cÚ¡ *)
©Œib
);

211 
cu¼’t_moduË
 = 
	`­Ş_veùÜ_g‘_–em’t
(
lib
->
moduËs
, 
idx
);

212 
cu¼’t_moduË
->
£Ëùed
 = 
Œue
;

214 
	`ä“
(
©Œib
);

215 
©Œib
 = 
NULL
;

217 
	`årštf
(
¡d”r
, "Error: module‚ame is‚ot specified.\n");

218 
ex™_”r
;

220 } ià(
	`xmlSŒEqu®
(
	`xmlTextR—d”CÚ¡Name
(
»ad”
), (
xmlCh¬
 *è
SECHK_PARSE_OPTION_TAG
) == 1) {

222 ià(!
cu¼’t_moduË
) {

223 
	`årštf
(
¡d”r
, "Error: 'option' specified outsidehe scope of‡ module.\n");

224 
ex™_”r
;

227 
İtiÚ
 = 
	`xmlTextR—d”G‘A‰ribu‹
(
»ad”
, (
xmlCh¬
 *è
SECHK_PARSE_NAME_ATTRIB
);

228 ià(!
İtiÚ
) {

229 
	`årštf
(
¡d”r
, "Error: option‚ame is‚ot specified.\n");

230 
ex™_”r
;

233 
	`£chk_lib_moduË_ş—r_İtiÚ
(
cu¼’t_moduË
, (*)
İtiÚ
);

235 } ià(
	`xmlSŒEqu®
(
	`xmlTextR—d”CÚ¡Name
(
»ad”
), (
xmlCh¬
 *è
SECHK_PARSE_ITEM_TAG
) == 1) {

237 
	`as£¹
(
cu¼’t_moduË
);

238 
nv
 = 
	`£chk_Çme_v®ue_Ãw
((*)
İtiÚ
, 
NULL
);

240 
v®ue
 = 
	`xmlTextR—d”G‘A‰ribu‹
(
»ad”
, (
xmlCh¬
 *è
SECHK_PARSE_VALUE_ATTRIB
);

241 ià(!
v®ue
) {

242 
	`årštf
(
¡d”r
, "Error: item value is‚ot specified.\n");

243 
ex™_”r
;

245 
nv
->
v®ue
 = 
	`¡rdup
((*)value);

246 
	`ä“
(
v®ue
);

247 
v®ue
 = 
NULL
;

249 
	`­Ş_veùÜ_­³nd
(
cu¼’t_moduË
->
İtiÚs
, (*)
nv
);

250 
nv
 = 
NULL
;

251 } ià(
	`xmlSŒEqu®
(
	`xmlTextR—d”CÚ¡Name
(
»ad”
), (
xmlCh¬
 *è
SECHK_PARSE_OUTPUT_TAG
) == 1) {

252 ià(!
cu¼’t_moduË
) {

253 
	`årštf
(
¡d”r
, "Error: 'output' specified outsidehe scope of‡ module.\n");

254 
ex™_”r
;

256 
©Œib
 = 
	`xmlTextR—d”G‘A‰ribu‹
(
»ad”
, (
xmlCh¬
 *è
SECHK_PARSE_VALUE_ATTRIB
);

257 ià(
©Œib
) {

258 ià(
	`xmlSŒEqu®
(
©Œib
, (
xmlCh¬
 *è
SECHK_PARSE_OUTPUT_QUIET
) == 1) {

259 
cu¼’t_moduË
->
ouutfÜm©
 = 
SECHK_OUT_QUIET
;

260 } ià(
	`xmlSŒEqu®
(
©Œib
, (
xmlCh¬
 *è
SECHK_PARSE_OUTPUT_VERBOSE
) == 1) {

261 
cu¼’t_moduË
->
ouutfÜm©
 = 
SECHK_OUT_VERBOSE
;

262 } ià(
	`xmlSŒEqu®
(
©Œib
, (
xmlCh¬
 *è
SECHK_PARSE_OUTPUT_SHORT
) == 1) {

263 
cu¼’t_moduË
->
ouutfÜm©
 = 
SECHK_OUT_SHORT
;

264 } ià(
	`xmlSŒEqu®
(
©Œib
, (
xmlCh¬
 *è
SECHK_PARSE_OUTPUT_NONE
) == 1) {

265 
cu¼’t_moduË
->
ouutfÜm©
 = 
SECHK_OUT_NONE
;

267 
	`årštf
(
¡d”r
, "E¼Ü: inv®id ouuˆv®u%s.\n", 
©Œib
);

268 
ex™_”r
;

270 
	`ä“
(
©Œib
);

271 
©Œib
 = 
NULL
;

273 
	`årštf
(
¡d”r
, "Error: output value is‚ot specified.\n");

274 
ex™_”r
;

281 
ex™_”r
:

282 
	`£chk_Çme_v®ue_ä“
(
nv
);

283 
”ºo
 = 
EIO
;

285 
	}
}

	@sechecker/sechk_parse.h

22 #iâdeà
SECHK_PARSE_H


23 
	#SECHK_PARSE_H


	)

25 #ifdef 
__ılu¥lus


30 
	~"£check”.h
"

32 
	~<libxml/xmÌ—d”.h
>

33 
	~<as£¹.h
>

35 
	#£chk_lib_·r£_´ofe
(
·th
, 
lib
è
	`£chk_lib_·r£_xml_fe
Õ©h,†ib)

	)

37 
£chk_lib_·r£_xml_fe
(cÚ¡ *
f’ame
, 
£chk_lib_t
 * 
lib
);

38 
£chk_lib_´oûss_xml_node
(
xmlTextR—d”PŒ
 
»ad”
, 
£chk_lib_t
 * 
lib
);

40 #ifdef 
__ılu¥lus


	@secmds/findcon.cc

27 
	~<cÚfig.h
>

29 
	~<£fs/db.hh
>

30 
	~<£fs/fcfe.hh
>

31 
	~<£fs/fesy¡em.hh
>

32 
	~<£fs/’Œy.hh
>

33 
	~<£fs/qu”y.hh
>

35 
usšg
 
Çme¥aû
 
	g¡d
;

37 
	~<”ºo.h
>

38 
	~<g‘İt.h
>

39 
	~<io¡»am
>

40 
	~<¡ršg
>

41 
	~<sys/ty³s.h
>

42 
	~<sys/¡©.h
>

43 
	~<uni¡d.h
>

45 
	#COPYRIGHT_INFO
 "Cİyrighˆ(Cè2003-2007 T»sy TechnŞogy, LLC"

	)

47 
	eOPTIONS


49 
	mOPTION_CONTEXT
 = 256

52 
İtiÚ
 cÚ¡ 
	glÚgİts
[] = {

53 {"şass", 
»quœed_¬gum’t
, 
NULL
, 'c'},

54 {"ty³", 
»quœed_¬gum’t
, 
NULL
, 't'},

55 {"u£r", 
»quœed_¬gum’t
, 
NULL
, 'u'},

56 {"rŞe", 
»quœed_¬gum’t
, 
NULL
, 'r'},

57 {"mls-¿nge", 
»quœed_¬gum’t
, 
NULL
, 'm'},

58 {"·th", 
»quœed_¬gum’t
, 
NULL
, 'p'},

59 {"»gex", 
no_¬gum’t
, 
NULL
, 'R'},

60 {"cÚ‹xt", 
»quœed_¬gum’t
, 
NULL
, 
OPTION_CONTEXT
},

61 {"h–p", 
no_¬gum’t
, 
NULL
, 'h'},

62 {"v”siÚ", 
no_¬gum’t
, 
NULL
, 'V'},

63 {
NULL
, 0, NULL, 0}

66 
	$u§ge
(cÚ¡ *
´og¿m_Çme
, 
boŞ
 
br›f
)

68 
cout
 << "U§ge: " << 
´og¿m_Çme
 << " FCLIST [OPTIONS] [EXPRESSION]" << 
’dl
 <<ƒndl;

69 ià(
br›f
)

71 
cout
 << "\tTry " << 
´og¿m_Çme
 << " --h–°fÜ mÜh–p." << 
’dl
 <<ƒndl;

75 
cout
 << "Fšd fe m©chšghgiv’ SELšux cÚ‹xt." << 
’dl
 <<ƒndl;

77 
cout
 << "FCLIST i ¨dœeùÜy‚ame,‡ fe_cÚ‹xt fe, o¸¨d©aba£" << 
’dl
;

78 
cout
 << "ü—‹d by‡…»viou ruÀoàšdexcÚ." << 
’dl
;

79 
cout
 << 
’dl
;

81 
cout
 << "EXPRESSION:" << 
’dl
;

82 
cout
 << " -ˆTYPE, --ty³=TYPE fšd cÚ‹xt w™hy³ TYPE" << 
’dl
;

83 
cout
 << " -u USER, --u£r=USER fšd cÚ‹xt w™h u£¸USER" << 
’dl
;

84 
cout
 << " -¸ROLE, --rŞe=ROLE fšd cÚ‹xt w™h„ŞROLE" << 
’dl
;

85 
cout
 << " -m RANGE, --mls-¿nge=RANGE fšd cÚ‹xt w™h MLS„ªgRANGE" << 
’dl
;

86 
cout
 << " --cÚ‹xt=CONTEXT…¬tŸÈÜ fuÎ cÚ‹xˆtØfšd" << 
’dl
;

87 
cout
 << " (ov”ride ex´essiÚ o±iÚ above)" << 
’dl
;

88 
cout
 << " -°PATH, --·th=PATH fšd fe š PATH" << 
’dl
;

89 
cout
 << " -øCLASS, --şass=CLASS fšd fe oàobjeù cÏs CLASS" << 
’dl
;

90 
cout
 << 
’dl
;

92 
cout
 << "OPTIONS:" << 
’dl
;

93 
cout
 << " -R, --»gexƒÇbË„eguÏ¸ex´essiÚs" << 
’dl
;

94 
cout
 << " -h, --h–°…ršˆthi h–°‹xˆªdƒx™" << 
’dl
;

95 
cout
 << " -V, --v”siÚ…ršˆv”siÚ infÜm©iÚ‡ndƒx™" << 
’dl
;

96 
cout
 << 
’dl
;

97 
cout
 << "Iàthfşi¡ dÛ nÙ cÚš MLS„ªge ªd -m wa giv’," << 
’dl
;

98 
cout
 << "th’h£¬ch wÈ»tuº‚Ùhšg." << 
’dl
;

99 
	}
}

101 
´št_’Œy
(
£fs_fşi¡
 * 
fşi¡
, cÚ¡ 
£fs_’Œy
 * 
e
, *
¬g
 
__©Œibu‹__
 ((
unu£d
)))

103 *
	g¡r
 = 
e
->
toSŒšg
();

104 
	gcout
 << 
	g¡r
 << 
	g’dl
;

105 
ä“
(
¡r
);

109 
	$maš
(
¬gc
, *
¬gv
[])

111 
İtc
;

112 
£fs_qu”y
 *
qu”y
 = 
Ãw
 
	`£fs_qu”y
();

114 
­Ş_cÚ‹xt_t
 *
cÚ‹xt
 = 
NULL
;

115 
Œy


117 (
İtc
 = 
	`g‘İt_lÚg
(
¬gc
, 
¬gv
, "t:u:r:m:p:c:RhV", 
lÚgİts
, 
NULL
)) != -1)

119 
İtc
)

122 ià(
cÚ‹xt
 =ğ
NULL
)

124 
qu”y
->
	`ty³
(
İrg
, 
çl£
);

128 ià(
cÚ‹xt
 =ğ
NULL
)

130 
qu”y
->
	`u£r
(
İrg
);

134 ià(
cÚ‹xt
 =ğ
NULL
)

136 
qu”y
->
	`rŞe
(
İrg
);

140 ià(
cÚ‹xt
 =ğ
NULL
)

142 
qu”y
->
	`¿nge
(
İrg
, 
APOL_QUERY_EXACT
);

145 
OPTION_CONTEXT
:

146 ià((
cÚ‹xt
 = 
	`­Ş_cÚ‹xt_ü—‹_äom_l™”®
(
İrg
)è=ğ
NULL
)

148 
û¼
 << "Could‚Ù c»©¨cÚ‹xt." << 
’dl
;

149 
throw
 
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

153 
qu”y
->
	`·th
(
İrg
);

156 
qu”y
->
	`objeùCÏss
(
İrg
);

159 
qu”y
->
	`»gex
(
Œue
);

162 
	`u§ge
(
¬gv
[0], 
çl£
);

163 
	`ex™
(0);

165 
cout
 << "fšdcÚ " << 
VERSION
 << 
’dl
 << 
COPYRIGHT_INFO
 <<ƒndl;

166 
	`ex™
(0);

168 
	`u§ge
(
¬gv
[0], 
Œue
);

169 
	`ex™
(1);

172 ià(
cÚ‹xt
 !ğ
NULL
)

174 
qu”y
->
	`u£r
(
	`­Ş_cÚ‹xt_g‘_u£r
(
cÚ‹xt
));

175 
qu”y
->
	`rŞe
(
	`­Ş_cÚ‹xt_g‘_rŞe
(
cÚ‹xt
));

176 
qu”y
->
	`ty³
(
	`­Ş_cÚ‹xt_g‘_ty³
(
cÚ‹xt
), 
çl£
);

177 ià(
	`­Ş_cÚ‹xt_g‘_¿nge
(
cÚ‹xt
è!ğ
NULL
)

179 *
r
 = 
	`­Ş_mls_¿nge_»nd”
(
NULL
, 
	`­Ş_cÚ‹xt_g‘_¿nge
(
cÚ‹xt
));

180 
qu”y
->
	`¿nge
(
r
, 
APOL_QUERY_EXACT
);

181 
	`ä“
(
r
);

185 
qu”y
->
	`¿nge
(
NULL
, 
APOL_QUERY_EXACT
);

189 
	`ÿtch
(...)

191 
û¼
 << 
	`¡»¼Ü
(
”ºo
è<< 
’dl
;

192 
	`­Ş_cÚ‹xt_de¡roy
(&
cÚ‹xt
);

193 
d–‘e
 
qu”y
;

194 
	`ex™
(-1);

196 
	`­Ş_cÚ‹xt_de¡roy
(&
cÚ‹xt
);

198 ià(
İtšd
 + 1 !ğ
¬gc
)

200 
	`u§ge
(
¬gv
[0], 1);

201 
d–‘e
 
qu”y
;

202 
	`ex™
(-1);

206 
¡©
 
sb
;

207 ià(
	`¡©
(
¬gv
[
İtšd
], &
sb
) != 0)

209 
û¼
 << "Could‚Ù o³À" << 
¬gv
[
İtšd
] << ": " << 
	`¡»¼Ü
(
”ºo
è<< 
’dl
;

210 
d–‘e
 
qu”y
;

211 
	`ex™
(-1);

214 
£fs_fşi¡
 *
fşi¡
 = 
NULL
;

215 
Œy


217 ià(
	`S_ISDIR
(
sb
.
¡_mode
))

219 
fşi¡
 = 
Ãw
 
	`£fs_fesy¡em
(
¬gv
[
İtšd
], 
NULL
, NULL);

221 ià(
£fs_db
::
	`isDB
(
¬gv
[
İtšd
]))

223 
fşi¡
 = 
Ãw
 
	`£fs_db
(
¬gv
[
İtšd
], 
NULL
, NULL);

227 
fşi¡
 = 
Ãw
 
	`£fs_fcfe
(
¬gv
[
İtšd
], 
NULL
, NULL);

230 ià(
fşi¡
->
	`runQu”yM­
(
qu”y
, 
´št_’Œy
, 
NULL
) < 0)

232 
throw
 
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

235 
	`ÿtch
(...)

237 
d–‘e
 
qu”y
;

238 
d–‘e
 
fşi¡
;

239 
	`ex™
(-1);

242 
d–‘e
 
qu”y
;

243 
d–‘e
 
fşi¡
;

245 
	}
}

	@secmds/indexcon.cc

28 
	~<cÚfig.h
>

30 
	~<£fs/db.hh
>

31 
	~<£fs/fesy¡em.hh
>

33 
usšg
 
Çme¥aû
 
	g¡d
;

35 
	~<io¡»am
>

36 
	~<g‘İt.h
>

38 
	#COPYRIGHT_INFO
 "Cİyrighˆ(Cè2003-2007 T»sy TechnŞogy, LLC"

	)

40 
İtiÚ
 cÚ¡ 
	glÚgİts
[] = {

41 {"dœeùÜy", 
»quœed_¬gum’t
, 
NULL
, 'd'},

42 {"h–p", 
no_¬gum’t
, 
NULL
, 'h'},

43 {"v”siÚ", 
no_¬gum’t
, 
NULL
, 'V'},

44 {
NULL
, 0, NULL, 0}

47 
	$u§ge
(cÚ¡ *
´og¿m_Çme
, 
boŞ
 
br›f
)

49 
cout
 << "U§ge: " << 
´og¿m_Çme
 << " FILE [OPTIONS]" << 
’dl
 <<ƒndl;

50 ià(
br›f
)

52 
cout
 << "\tTry " << 
´og¿m_Çme
 << " --h–°fÜ mÜh–p." << 
’dl
 <<ƒndl;

55 
cout
 << "Index SELšux cÚ‹xt Úhfesy¡em." << 
’dl
;

56 
cout
 << 
’dl
;

57 
cout
 << " -d DIR, --dœeùÜy=DIR s¹ sÿÂšg‡ˆdœeùÜy DIR (deçuÉ \"/\")" << 
’dl
;

58 
cout
 << " -h, --h–°…ršˆthi h–°‹xˆªdƒx™" << 
’dl
;

59 
cout
 << " -V, --v”siÚ…ršˆv”siÚ infÜm©iÚ‡ndƒx™" << 
’dl
;

60 
	}
}

62 
	$maš
(
¬gc
, *
¬gv
[])

64 
İtc
;

66 *
outf’ame
 = 
NULL
, *
dœ
 = "/";

68 (
İtc
 = 
	`g‘İt_lÚg
(
¬gc
, 
¬gv
, "d:hV", 
lÚgİts
, 
NULL
)) != -1)

70 
İtc
)

73 
dœ
 = 
İrg
;

76 
	`u§ge
(
¬gv
[0], 
çl£
);

77 
	`ex™
(0);

79 
cout
 << "šdexcÚ " << 
VERSION
 << 
’dl
 << 
COPYRIGHT_INFO
 <<ƒndl;

80 
	`ex™
(0);

82 
	`u§ge
(
¬gv
[0], 
Œue
);

83 
	`ex™
(1);

86 ià(
¬gc
 - 
İtšd
 > 1 ||‡rgc - optind < 1)

88 
	`u§ge
(
¬gv
[0], 
Œue
);

89 
	`ex™
(1);

93 
outf’ame
 = 
¬gv
[
İtšd
];

96 ià(
outf’ame
 =ğ
NULL
)

98 
	`u§ge
(
¬gv
[0], 
Œue
);

99 
	`ex™
(1);

102 
£fs_fesy¡em
 *
fs
 = 
NULL
;

103 
£fs_db
 *
db
 = 
NULL
;

104 
Œy


106 
fs
 = 
Ãw
 
	`£fs_fesy¡em
(
dœ
, 
NULL
, NULL);

107 
db
 = 
Ãw
 
	`£fs_db
(
fs
, 
NULL
, NULL);

108 
db
->
	`§ve
(
outf’ame
);

110 
	`ÿtch
(...)

112 
d–‘e
 
fs
;

113 
d–‘e
 
db
;

114 
	`ex™
(2);

117 
d–‘e
 
fs
;

118 
d–‘e
 
db
;

121 
	}
}

	@secmds/replcon.cc

26 
	~<cÚfig.h
>

28 
	~<£fs/fesy¡em.hh
>

29 
	~<£fs/qu”y.hh
>

30 
	~<£lšux/£lšux.h
>

31 
	~<­Ş/ut.h
>

33 
usšg
 
Çme¥aû
 
	g¡d
;

35 
	~<as£¹.h
>

36 
	~<”ºo.h
>

37 
	~<g‘İt.h
>

38 
	~<io¡»am
>

39 
	~<¡dlib.h
>

41 
	#COPYRIGHT_INFO
 "Cİyrighˆ(Cè2003-2007 T»sy TechnŞogy, LLC"

	)

43 
	eOPTIONS


45 
	mOPTION_CONTEXT
 = 256

48 
İtiÚ
 cÚ¡ 
	glÚgİts
[] = {

49 {"şass", 
»quœed_¬gum’t
, 
NULL
, 'c'},

50 {"ty³", 
»quœed_¬gum’t
, 
NULL
, 't'},

51 {"u£r", 
»quœed_¬gum’t
, 
NULL
, 'u'},

52 {"rŞe", 
»quœed_¬gum’t
, 
NULL
, 'r'},

53 {"mls-¿nge", 
»quœed_¬gum’t
, 
NULL
, 'm'},

54 {"·th", 
»quœed_¬gum’t
, 
NULL
, 'p'},

55 {"»gex", 
no_¬gum’t
, 
NULL
, 'R'},

56 {"cÚ‹xt", 
»quœed_¬gum’t
, 
NULL
, 
OPTION_CONTEXT
},

57 {"v”bo£", 
no_¬gum’t
, 
NULL
, 'v'},

58 {"h–p", 
no_¬gum’t
, 
NULL
, 'h'},

59 {"v”siÚ", 
no_¬gum’t
, 
NULL
, 'V'},

60 {
NULL
, 0, NULL, 0}

63 
	$l£tfecÚ_¿w
(cÚ¡ *, cÚ¡ *è
	`__©Œibu‹__
 ((
w—k
));

71 
	$»¶cÚ_l£tfecÚ
(cÚ¡ *
·th
, 
£cur™y_cÚ‹xt_t
 
cÚ‹xt
)

73 ià(
l£tfecÚ_¿w
 !ğ
NULL
)

75  
	`l£tfecÚ_¿w
(
·th
, 
cÚ‹xt
);

79  
	`l£tfecÚ
(
·th
, 
cÚ‹xt
);

81 
	}
}

83 
	s»¶cÚ_šfo


85 
boŞ
 
	mv”bo£
, 
	mmls
;

86 
­Ş_cÚ‹xt_t
 *
	m»¶cÚ
;

89 
	$u§ge
(cÚ¡ *
´og¿m_Çme
, 
boŞ
 
br›f
)

91 
cout
 << "U§ge: " << 
´og¿m_Çme
 << " NEW_CONTEXT DIR [OPTIONS] [EXPRESSION]" << 
’dl
 <<ƒndl;

92 ià(
br›f
)

94 
cout
 << "\tTry " << 
´og¿m_Çme
 << " --h–°fÜ mÜh–p." << 
’dl
 <<ƒndl;

98 
cout
 << "R•Ïû SELšux fcÚ‹xt fÜ fe m©chšg‡ giv’ cÚ‹xt." << 
’dl
 <<ƒndl;

100 
cout
 << "REQUIRED ARGUMENTS :" << 
’dl
;

101 
cout
 << " NEW_CONTEXT…¬tŸÈÜ fuÎ cÚ‹xˆtØ»Ïb–" << 
’dl
;

102 
cout
 << " DIR s¹šg dœeùÜyØ»¶aû" << 
’dl
;

103 
cout
 << 
’dl
;

104 
cout
 << "EXPRESSION:" << 
’dl
;

105 
cout
 << " -ˆTYPE, --ty³=TYPE fšd cÚ‹xt w™hy³ TYPE" << 
’dl
;

106 
cout
 << " -u USER, --u£r=USER fšd cÚ‹xt w™h u£¸USER" << 
’dl
;

107 
cout
 << " -¸ROLE, --rŞe=ROLE fšd cÚ‹xt w™h„ŞROLE" << 
’dl
;

108 
cout
 << " -m RANGE, --mls-¿nge=RANGE fšd cÚ‹xt w™h MLS„ªgRANGE" << 
’dl
;

109 
cout
 << " --cÚ‹xt=CONTEXT…¬tŸÈÜ fuÎ cÚ‹xˆtØfšd" << 
’dl
;

110 
cout
 << " (ov”ride ex´essiÚ o±iÚ above)" << 
’dl
;

111 
cout
 << " -°PATH, --·th=PATH fšd fe š PATH" << 
’dl
;

112 
cout
 << " -øCLASS, --şass=CLASS fšd fe oàobjeù cÏs CLASS" << 
’dl
;

113 
cout
 << 
’dl
;

115 
cout
 << "OPTIONS:" << 
’dl
;

116 
cout
 << " -R, --»gexƒÇbË„eguÏ¸ex´essiÚs" << 
’dl
;

117 
cout
 << " -v, --v”bo£ show cÚ‹xˆoàm©chšg fes" << 
’dl
;

118 
cout
 << " -h, --h–°…ršˆthi h–°‹xˆªdƒx™" << 
’dl
;

119 
cout
 << " -V, --v”siÚ…ršˆv”siÚ infÜm©iÚ‡ndƒx™" << 
’dl
;

120 
cout
 << 
’dl
;

121 
cout
 << "Iàthfşi¡ dÛ nÙ cÚš MLS„ªge ªd -m wa giv’," << 
’dl
;

122 
cout
 << "th’h£¬ch wÈ»tuº‚Ùhšg." << 
’dl
;

123 
cout
 << 
’dl
;

124 
cout
 << "NEW_CONTEXT i a ¨cŞÚ s•¬©ed†i¡ oàu£r,„Şe,y³,‡nd MLS„ªge" << 
’dl
;

125 
cout
 << "such‡ fŞlows: u£r_u:objeù_r:u£r_t:s0. Ià¨f›ld i nÙ s³cif›d," << 
’dl
;

126 
cout
 << "th©…ÜtiÚ oàthcÚ‹xˆwÈnÙ b»¶aûd." << 
’dl
;

127 
cout
 << "Exam¶es:" << 
’dl
;

128 
cout
 << "„•lcÚ ::ty³_t: ." << 
’dl
;

129 
cout
 << " R•Ïû‡Î fe ªd subdœeùÜ› š cu¼’ˆdœeùÜy w™h" << 
’dl
;

130 
cout
 << "y³y³_t,„ecursšg w™hšhdœeùÜy." << 
’dl
;

131 
cout
 << "„•lcÚ -u u£r_u *:rŞe_r:* ." << 
’dl
;

132 
cout
 << " R•Ïû fe th© cÚš u£r_u w™h„ŞrŞe_r." << 
’dl
;

133 
cout
 << "„•lcÚ --cÚ‹xˆ::ty³_t:sØ:::s0:c0 /tmp" << 
’dl
;

134 
cout
 << " R•Ïû fe w™hy³y³_ˆªd†ev– s0 iÀ/tm°w™h MLS" << 
’dl
;

135 
cout
 << "„ªgs0:c0." << 
’dl
;

136 
	}
}

138 
	$»¶aû_’Œy
(
£fs_fşi¡
 * 
fşi¡
, cÚ¡ 
£fs_’Œy
 * 
e
, *
¬g
)

140 
»¶cÚ_šfo
 *
r
 = 
¡©ic_ÿ¡
 < »¶cÚ_šfØ*>(
¬g
);

141 cÚ¡ 
­Ş_cÚ‹xt_t
 *
scÚ
 = 
e
->
	`cÚ‹xt
();

142 cÚ¡ *
u£r
, *
rŞe
, *
ty³
;

143 *
cÚ_¡r
 = 
NULL
;

144 
size_t
 
Ën
 = 0;

147 ià((
u£r
 = 
	`­Ş_cÚ‹xt_g‘_u£r
(
r
->
»¶cÚ
)è=ğ
NULL
)

149 
u£r
 = 
	`­Ş_cÚ‹xt_g‘_u£r
(
scÚ
);

151 ià((
rŞe
 = 
	`­Ş_cÚ‹xt_g‘_rŞe
(
r
->
»¶cÚ
)è=ğ
NULL
)

153 
rŞe
 = 
	`­Ş_cÚ‹xt_g‘_rŞe
(
scÚ
);

155 ià((
ty³
 = 
	`­Ş_cÚ‹xt_g‘_ty³
(
r
->
»¶cÚ
)è=ğ
NULL
)

157 
ty³
 = 
	`­Ş_cÚ‹xt_g‘_ty³
(
scÚ
);

159 ià(
	`­Ş_¡r_­³ndf
(&
cÚ_¡r
, &
Ën
, "%s:%s:%s", 
u£r
, 
rŞe
, 
ty³
) < 0)

163 ià(
r
->
mls
)

165 cÚ¡ 
­Ş_mls_¿nge_t
 *
­Ş_¿nge
 = 
NULL
;

166 *
¿nge
 = 
NULL
;

167 ià((
­Ş_¿nge
 = 
	`­Ş_cÚ‹xt_g‘_¿nge
(
r
->
»¶cÚ
)è=ğ
NULL
)

169 
­Ş_¿nge
 = 
	`­Ş_cÚ‹xt_g‘_¿nge
(
scÚ
);

171 ià((
¿nge
 = 
	`­Ş_mls_¿nge_»nd”
(
NULL
, 
­Ş_¿nge
)è=ğNULL || 
	`­Ş_¡r_­³ndf
(&
cÚ_¡r
, &
Ën
, ":%s",„ange) < 0)

173 
	`ä“
(
¿nge
);

174 
	`ä“
(
cÚ_¡r
);

177 
	`ä“
(
¿nge
);

180 ià(
r
->
v”bo£
)

182 *
lcÚ
 = 
NULL
, *
rcÚ
 = NULL;

183 ià(
r
->
mls
)

185 
lcÚ
 = 
	`­Ş_cÚ‹xt_»nd”
(
NULL
, 
r
->
»¶cÚ
);

186 
rcÚ
 = 
	`­Ş_cÚ‹xt_»nd”
(
NULL
, 
scÚ
);

190 ià(
	`a¥rštf
(&
lcÚ
, "%s:%s:%s",

191 
	`­Ş_cÚ‹xt_g‘_u£r
(
r
->
»¶cÚ
),

192 
	`­Ş_cÚ‹xt_g‘_rŞe
(
r
->
»¶cÚ
), 
	`­Ş_cÚ‹xt_g‘_ty³
(r->replcon)) < 0)

194 
lcÚ
 = 
NULL
;

196 ià(
	`a¥rštf
(&
rcÚ
, "%s:%s:%s",

197 
	`­Ş_cÚ‹xt_g‘_u£r
(
scÚ
), 
	`­Ş_cÚ‹xt_g‘_rŞe
(scÚ), 
	`­Ş_cÚ‹xt_g‘_ty³
(scon)) < 0)

199 
rcÚ
 = 
NULL
;

202 ià(
lcÚ
 =ğ
NULL
 || 
rcÚ
 == NULL)

204 
	`ä“
(
lcÚ
);

205 
	`ä“
(
rcÚ
);

208 
	`´štf
("%s: % --> %s\n", 
e
->
	`·th
(), 
lcÚ
, 
rcÚ
);

209 
	`ä“
(
lcÚ
);

210 
	`ä“
(
rcÚ
);

215 ià(
	`»¶cÚ_l£tfecÚ
(
e
->
	`·th
(), 
cÚ_¡r
) != 0)

217 
û¼
 << "Could‚Ù s‘ cÚ‹xˆ" << 
cÚ_¡r
 << " fÜ f" << 
e
->
	`·th
(è<< "." << 
’dl
;

218 
	`ä“
(
cÚ_¡r
);

222 
	`ä“
(
cÚ_¡r
);

224 
	}
}

226 
	$maš
(
¬gc
, *
¬gv
[])

228 
İtc
;

229 
»¶cÚ_šfo
 
r
;

231 
r
.
v”bo£
 = 
çl£
;

232 
r
.
»¶cÚ
 = 
NULL
;

233 
£fs_qu”y
 *
qu”y
 = 
Ãw
 
	`£fs_qu”y
();

235 
­Ş_cÚ‹xt_t
 *
cÚ‹xt
 = 
NULL
;

236 
Œy


238 (
İtc
 = 
	`g‘İt_lÚg
(
¬gc
, 
¬gv
, "t:u:r:m:p:c:RvhV", 
lÚgİts
, 
NULL
)) != -1)

240 
İtc
)

243 ià(
cÚ‹xt
 =ğ
NULL
)

245 
qu”y
->
	`ty³
(
İrg
, 
çl£
);

249 ià(
cÚ‹xt
 =ğ
NULL
)

251 
qu”y
->
	`u£r
(
İrg
);

255 ià(
cÚ‹xt
 =ğ
NULL
)

257 
qu”y
->
	`rŞe
(
İrg
);

261 ià(
cÚ‹xt
 =ğ
NULL
)

263 
qu”y
->
	`¿nge
(
İrg
, 
APOL_QUERY_EXACT
);

266 
OPTION_CONTEXT
:

267 ià((
cÚ‹xt
 = 
	`­Ş_cÚ‹xt_ü—‹_äom_l™”®
(
İrg
)è=ğ
NULL
)

269 
û¼
 << "Could‚Ù c»©sourû cÚ‹xt." << 
’dl
;

270 
throw
 
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

274 
qu”y
->
	`·th
(
İrg
);

277 
qu”y
->
	`objeùCÏss
(
İrg
);

280 
qu”y
->
	`»gex
(
Œue
);

283 
r
.
v”bo£
 = 
Œue
;

286 
	`u§ge
(
¬gv
[0], 
çl£
);

287 
	`ex™
(0);

289 
cout
 << "»¶cÚ " << 
VERSION
 << 
’dl
 << 
COPYRIGHT_INFO
 <<ƒndl;

290 
	`ex™
(0);

292 
	`u§ge
(
¬gv
[0], 
Œue
);

293 
	`ex™
(1);

295 ià(
cÚ‹xt
 !ğ
NULL
)

297 
qu”y
->
	`u£r
(
	`­Ş_cÚ‹xt_g‘_u£r
(
cÚ‹xt
));

298 
qu”y
->
	`rŞe
(
	`­Ş_cÚ‹xt_g‘_rŞe
(
cÚ‹xt
));

299 
qu”y
->
	`ty³
(
	`­Ş_cÚ‹xt_g‘_ty³
(
cÚ‹xt
), 
çl£
);

300 ià(
	`­Ş_cÚ‹xt_g‘_¿nge
(
cÚ‹xt
è!ğ
NULL
)

302 *
ºg
 = 
	`­Ş_mls_¿nge_»nd”
(
NULL
, 
	`­Ş_cÚ‹xt_g‘_¿nge
(
cÚ‹xt
));

303 
qu”y
->
	`¿nge
(
ºg
, 
APOL_QUERY_EXACT
);

304 
	`ä“
(
ºg
);

308 
qu”y
->
	`¿nge
(
NULL
, 
APOL_QUERY_EXACT
);

313 
	`ÿtch
(
bad_®loc
)

315 
û¼
 << 
	`¡»¼Ü
(
”ºo
è<< 
’dl
;

316 
	`­Ş_cÚ‹xt_de¡roy
(&
cÚ‹xt
);

317 
d–‘e
 
qu”y
;

318 
	`ex™
(-1);

320 
	`­Ş_cÚ‹xt_de¡roy
(&
cÚ‹xt
);

322 ià(
İtšd
 + 2 !ğ
¬gc
)

324 
	`u§ge
(
¬gv
[0], 1);

325 
d–‘e
 
qu”y
;

326 
	`ex™
(-1);

329 
£fs_fşi¡
 *
fşi¡
 = 
NULL
;

330 
Œy


332 
fşi¡
 = 
Ãw
 
	`£fs_fesy¡em
(
¬gv
[
İtšd
 + 1], 
NULL
, NULL);

333 
r
.
mls
 = 
fşi¡
->
	`isMLS
();

335 ià((
r
.
»¶cÚ
 = 
	`­Ş_cÚ‹xt_ü—‹_äom_l™”®
(
¬gv
[
İtšd
])è=ğ
NULL
)

337 
û¼
 << "Could‚Ù c»©»¶aûm’ˆcÚ‹xt." << 
’dl
;

338 
throw
 
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

341 ià(
fşi¡
->
	`runQu”yM­
(
qu”y
, 
»¶aû_’Œy
, &
r
) < 0)

343 
throw
 
	`ruÁime_”rÜ
(
	`¡»¼Ü
(
”ºo
));

346 
	`ÿtch
(...)

348 
d–‘e
 
qu”y
;

349 
d–‘e
 
fşi¡
;

350 
	`­Ş_cÚ‹xt_de¡roy
(&(
r
.
»¶cÚ
));

351 
	`ex™
(-1);

354 
d–‘e
 
qu”y
;

355 
d–‘e
 
fşi¡
;

356 
	`­Ş_cÚ‹xt_de¡roy
(&(
r
.
»¶cÚ
));

358 
	}
}

	@secmds/seinfo.c

29 
	~<cÚfig.h
>

32 
	~<­Ş/pŞicy.h
>

33 
	~<­Ş/pŞicy-qu”y.h
>

34 
	~<­Ş/»nd”.h
>

35 
	~<­Ş/ut.h
>

36 
	~<­Ş/veùÜ.h
>

39 
	~<qpŞ/pŞicy.h
>

40 
	~<qpŞ/ut.h
>

43 
	~<”ºo.h
>

44 
	~<¡dlib.h
>

45 
	~<¡dio.h
>

46 
	~<¡ršg.h
>

47 
	~<as£¹.h
>

48 
	~<g‘İt.h
>

50 
	#COPYRIGHT_INFO
 "Cİyrighˆ(Cè2003-2007 T»sy TechnŞogy, LLC"

	)

53 
	#CONSTRAIN_NULL_SET
 "<em±y s‘>"

	)

55 *
	gpŞicy_fe
 = 
NULL
;

57 
´št_ty³_©Œs
(
FILE
 * 
å
, cÚ¡ 
qpŞ_ty³_t
 * 
ty³_d©um
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicydb
, cÚ¡ 
ex·nd
);

58 
´št_©Œ_ty³s
(
FILE
 * 
å
, cÚ¡ 
qpŞ_ty³_t
 * 
ty³_d©um
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicydb
, cÚ¡ 
ex·nd
);

59 
´št_u£r_rŞes
(
FILE
 * 
å
, cÚ¡ 
qpŞ_u£r_t
 * 
u£r_d©um
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicydb
, cÚ¡ 
ex·nd
);

60 
´št_rŞe_ty³s
(
FILE
 * 
å
, cÚ¡ 
qpŞ_rŞe_t
 * 
rŞe_d©um
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicydb
, cÚ¡ 
ex·nd
);

61 
´št_boŞ_¡©e
(
FILE
 * 
å
, cÚ¡ 
qpŞ_boŞ_t
 * 
boŞ_d©um
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicydb
, cÚ¡ 
ex·nd
);

62 
´št_şass_³rms
(
FILE
 * 
å
, cÚ¡ 
qpŞ_şass_t
 * 
şass_d©um
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicydb
, cÚ¡ 
ex·nd
);

63 
´št_ÿt_£ns
(
FILE
 * 
å
, cÚ¡ 
qpŞ_ÿt_t
 * 
ÿt_d©um
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicydb
, cÚ¡ 
ex·nd
);

64 
qpŞ_ÿt_d©um_com·»
(cÚ¡ *
d©um1
, cÚ¡ *
d©um2
, *
d©a
);

65 
qpŞ_Ëv–_d©um_com·»
(cÚ¡ *
d©um1
, cÚ¡ *
d©um2
, *
d©a
);

67 
	eİt_v®ues


69 
	mOPT_SENSITIVITY
 = 256, 
	mOPT_CATEGORY
,

70 
	mOPT_INITIALSID
, 
	mOPT_FS_USE
, 
	mOPT_GENFSCON
,

71 
	mOPT_NETIFCON
, 
	mOPT_NODECON
, 
	mOPT_PORTCON
, 
	mOPT_PROTOCOL
,

72 
	mOPT_PERMISSIVE
, 
	mOPT_POLCAP
,

73 
	mOPT_ALL
, 
	mOPT_STATS
, 
	mOPT_CONSTRAIN


76 
İtiÚ
 cÚ¡ 
	glÚgİts
[] = {

77 {"şass", 
İtiÚ®_¬gum’t
, 
NULL
, 'c'},

78 {"£ns™iv™y", 
İtiÚ®_¬gum’t
, 
NULL
, 
OPT_SENSITIVITY
},

79 {"ÿ‹gÜy", 
İtiÚ®_¬gum’t
, 
NULL
, 
OPT_CATEGORY
},

80 {"ty³", 
İtiÚ®_¬gum’t
, 
NULL
, 't'},

81 {"©Œibu‹", 
İtiÚ®_¬gum’t
, 
NULL
, 'a'},

82 {"rŞe", 
İtiÚ®_¬gum’t
, 
NULL
, 'r'},

83 {"u£r", 
İtiÚ®_¬gum’t
, 
NULL
, 'u'},

84 {"boŞ", 
İtiÚ®_¬gum’t
, 
NULL
, 'b'},

85 {"cÚ¡¿š", 
no_¬gum’t
, 
NULL
, 
OPT_CONSTRAIN
},

86 {"š™Ÿlsid", 
İtiÚ®_¬gum’t
, 
NULL
, 
OPT_INITIALSID
},

87 {"fs_u£", 
İtiÚ®_¬gum’t
, 
NULL
, 
OPT_FS_USE
},

88 {"g’fscÚ", 
İtiÚ®_¬gum’t
, 
NULL
, 
OPT_GENFSCON
},

89 {"ÃtifcÚ", 
İtiÚ®_¬gum’t
, 
NULL
, 
OPT_NETIFCON
},

90 {"nodecÚ", 
İtiÚ®_¬gum’t
, 
NULL
, 
OPT_NODECON
},

91 {"³rmissive", 
İtiÚ®_¬gum’t
, 
NULL
, 
OPT_PERMISSIVE
},

92 {"pŞÿp", 
İtiÚ®_¬gum’t
, 
NULL
, 
OPT_POLCAP
},

93 {"pÜtcÚ", 
İtiÚ®_¬gum’t
, 
NULL
, 
OPT_PORTCON
},

94 {"´ÙocŞ", 
»quœed_¬gum’t
, 
NULL
, 
OPT_PROTOCOL
},

95 {"¡©s", 
no_¬gum’t
, 
NULL
, 
OPT_STATS
},

96 {"®l", 
no_¬gum’t
, 
NULL
, 
OPT_ALL
},

97 {"lše-b»aks", 
no_¬gum’t
, 
NULL
, 'l'},

98 {"ex·nd", 
no_¬gum’t
, 
NULL
, 'x'},

99 {"h–p", 
no_¬gum’t
, 
NULL
, 'h'},

100 {"v”siÚ", 
no_¬gum’t
, 
NULL
, 'V'},

101 {
NULL
, 0, NULL, 0}

111 
	$u§ge
(cÚ¡ *
´og¿m_Çme
, 
br›f
)

113 
	`´štf
("U§ge: % [OPTIONS] [EXPRESSION] [POLICY ...]\n\n", 
´og¿m_Çme
);

114 ià(
br›f
) {

115 
	`´štf
("\tTry % --h–°fÜ mÜh–p.\n\n", 
´og¿m_Çme
);

118 
	`´štf
("Print information‡bouthe components of‡ SELinux…olicy.\n\n");

119 
	`´štf
("EXPRESSIONS:\n");

120 
	`´štf
(" -c[NAME], --class[=NAME]…rint object classes\n");

121 
	`´štf
(" --sensitivity[=NAME]…rint sensitivities\n");

122 
	`´štf
(" --category[=NAME]…rint categories\n");

123 
	`´štf
(" -t[NAME], --type[=NAME]…rintypes (no‡liases or‡ttributes)\n");

124 
	`´štf
(" -a[NAME], --attribute[=NAME]…rintype‡ttributes\n");

125 
	`´štf
(" -r[NAME], --role[=NAME]…rint„oles\n");

126 
	`´štf
(" -u[NAME], --user[=NAME]…rint users\n");

127 
	`´štf
(" -b[NAME], --bool[=NAME]…rint conditional booleans\n");

128 
	`´štf
(" --constrain…rint constrain statements\n");

129 
	`´štf
(" --initialsid[=NAME]…rint initial SIDs\n");

130 
	`´štf
(" --fs_use[=TYPE]…rint fs_use statements\n");

131 
	`´štf
(" --genfscon[=TYPE]…rint genfscon statements\n");

132 
	`´štf
(" --netifcon[=NAME]…rint‚etif contexts\n");

133 
	`´štf
(" --nodecon[=ADDR]…rint‚ode contexts\n");

134 
	`´štf
(" --permissive…rint…ermissiveypes\n");

135 
	`´štf
(" --polcap…rint…olicy capabilities\n");

136 
	`´štf
(" --portcon[=PORT]…rint…ort contexts\n");

137 
	`´štf
(" --protocol=PROTO specify‡…rotocol for…ortcons\n");

138 
	`´štf
(" --all…rint‡ll ofhe‡bove\n");

139 
	`´štf
("OPTIONS:\n");

140 
	`´štf
(" -x, --expand show more info for specified components\n");

141 
	`´štf
(" --stats…rint useful…olicy statistics\n");

142 
	`´štf
(" -l, --line-breaks…rint†ine breaks in constrain statements\n");

143 
	`´štf
(" -h, --help…rinthis helpext‡ndƒxit\n");

144 
	`´štf
(" -V, --version…rint version information‡ndƒxit\n");

145 
	`´štf
("\n");

146 
	`´štf
("For component options, if NAME is…rovided,hen only show info for\n");

147 
	`´štf
("NAME. Specifying‡‚ame is most useful when used withhe -x option.\n");

148 
	`´štf
("If‚o option is…rovided, display useful…olicy statistics (-s).\n");

149 
	`´štf
("\n");

150 
	`´štf
("The default source…olicy, or ifhat is unavailablehe default binary\n");

151 
	`´štf
("policy, will be opened if‚o…olicy is…rovided.\n\n");

152 
	}
}

163 
	$´št_¡©s
(
FILE
 * 
å
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicydb
)

165 
»tv®
 = -1;

166 
n_³rms
 = 0;

167 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

168 
­Ş_ty³_qu”y_t
 *
ty³_qu”y
 = 
NULL
;

169 
­Ş_©Œ_qu”y_t
 *
©Œ_qu”y
 = 
NULL
;

170 
­Ş_³rm_qu”y_t
 *
³rm_qu”y
 = 
NULL
;

171 
­Ş_veùÜ_t
 *
³rms
 = 
NULL
, *
v
 = NULL;

172 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicydb
);

173 *
¡r
 = 
NULL
;

174 
size_t
 
n_ty³s
 = 0, 
n_©Œs
 = 0;

175 
size_t
 
n_şas£s
 = 0, 
n_u£rs
 = 0, 
n_rŞes
 = 0, 
n_boŞs
 = 0, 
n_cÚds
 = 0, 
n_Ëv–s
 = 0,

176 
n_ÿts
 = 0, 
n_pÜtcÚs
 = 0, 
n_ÃtifcÚs
 = 0, 
n_nodecÚs
 = 0, 
n_fsu£s
 = 0,

177 
n_g’fscÚs
 = 0, 
n_®lows
 = 0, 
n_Ãv”®lows
 = 0, 
n_aud™®lows
 = 0, 
n_dÚud™s
 = 0,

178 
n_ty³Œªs
 = 0, 
n_ty³chªges
 = 0, 
n_ty³memb”s
 = 0, 
n_isids
 = 0, 
n_rŞ—Îows
 = 0,

179 
n_rŞ‘¿ns
 = 0, 
n_¿ng‘¿ns
 = 0, 
n_cÚ¡r
 = 0, 
n_vŒªs
 = 0, 
n_³rmissives
 = 0,

180 
n_pŞÿps
 = 0;

182 
	`as£¹
(
pŞicydb
 !ğ
NULL
);

184 
	`årštf
(
å
, "\nSti¡ic fÜ…Şicy fe: %s\n", 
pŞicy_fe
);

186 ià(!(
¡r
 = 
	`­Ş_pŞicy_g‘_v”siÚ_ty³_mls_¡r
(
pŞicydb
)))

187 
ş—nup
;

189 
	`årštf
(
å
, "Policy Version & Type: ");

190 
	`årštf
(
å
, "%s\n", 
¡r
);

191 
	`ä“
(
¡r
);

193 ià(
	`qpŞ_pŞicy_g‘_şass_™”
(
q
, &
™”
))

194 
ş—nup
;

195 ià(
	`qpŞ_™”©Ü_g‘_size
(
™”
, &
n_şas£s
))

196 
ş—nup
;

197 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

199 
³rm_qu”y
 = 
	`­Ş_³rm_qu”y_ü—‹
();

200 ià(!
³rm_qu”y
)

201 
ş—nup
;

204 ià(
	`­Ş_³rm_g‘_by_qu”y
(
pŞicydb
, 
³rm_qu”y
, &
³rms
))

205 
ş—nup
;

207 
n_³rms
 = 
	`­Ş_veùÜ_g‘_size
(
³rms
);

208 
	`­Ş_³rm_qu”y_de¡roy
(&
³rm_qu”y
);

209 
	`­Ş_veùÜ_de¡roy
(&
³rms
);

210 
	`årštf
(
å
, "\À CÏs£s: %7zd P”missiÚs: %7d\n", 
n_şas£s
, 
n_³rms
);

213 ià(
	`qpŞ_pŞicy_g‘_Ëv–_™”
(
q
, &
™”
))

214 
ş—nup
;

215 ià(
	`qpŞ_™”©Ü_g‘_size
(
™”
, &
n_Ëv–s
))

216 
ş—nup
;

218 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

219 ià(
	`qpŞ_pŞicy_g‘_ÿt_™”
(
q
, &
™”
))

220 
ş—nup
;

221 ià(
	`qpŞ_™”©Ü_g‘_size
(
™”
, &
n_ÿts
))

222 
ş—nup
;

223 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

224 
	`årštf
(
å
, " S’s™iv™›s: %7zd C©egÜ›s: %7zd\n", 
n_Ëv–s
, 
n_ÿts
);

227 
ty³_qu”y
 = 
	`­Ş_ty³_qu”y_ü—‹
();

228 ià(!
ty³_qu”y
)

229 
ş—nup
;

230 ià(
	`­Ş_ty³_g‘_by_qu”y
(
pŞicydb
, 
ty³_qu”y
, &
v
) < 0)

231 
ş—nup
;

233 
n_ty³s
 = 
	`­Ş_veùÜ_g‘_size
(
v
);

234 
	`­Ş_ty³_qu”y_de¡roy
(&
ty³_qu”y
);

235 
	`­Ş_veùÜ_de¡roy
(&
v
);

237 
©Œ_qu”y
 = 
	`­Ş_©Œ_qu”y_ü—‹
();

238 ià(!
©Œ_qu”y
)

239 
ş—nup
;

240 ià(
	`­Ş_©Œ_g‘_by_qu”y
(
pŞicydb
, 
©Œ_qu”y
, &
v
) < 0)

241 
ş—nup
;

243 
n_©Œs
 = 
	`­Ş_veùÜ_g‘_size
(
v
);

244 
	`­Ş_©Œ_qu”y_de¡roy
(&
©Œ_qu”y
);

245 
	`­Ş_veùÜ_de¡roy
(&
v
);

247 
	`årštf
(
å
, " Ty³s: %7zd A‰ribu‹s: %7zd\n", 
n_ty³s
, 
n_©Œs
);

248 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

251 ià(
	`qpŞ_pŞicy_g‘_u£r_™”
(
q
, &
™”
))

252 
ş—nup
;

253 ià(
	`qpŞ_™”©Ü_g‘_size
(
™”
, &
n_u£rs
))

254 
ş—nup
;

255 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

256 ià(
	`qpŞ_pŞicy_g‘_rŞe_™”
(
q
, &
™”
))

257 
ş—nup
;

258 ià(
	`qpŞ_™”©Ü_g‘_size
(
™”
, &
n_rŞes
))

259 
ş—nup
;

260 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

261 
	`årštf
(
å
, " U£rs: %7zd RŞes: %7zd\n", 
n_u£rs
, 
n_rŞes
);

264 ià(
	`qpŞ_pŞicy_g‘_boŞ_™”
(
q
, &
™”
))

265 
ş—nup
;

266 ià(
	`qpŞ_™”©Ü_g‘_size
(
™”
, &
n_boŞs
))

267 
ş—nup
;

268 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

269 ià(
	`qpŞ_pŞicy_g‘_cÚd_™”
(
q
, &
™”
))

270 
ş—nup
;

271 ià(
	`qpŞ_™”©Ü_g‘_size
(
™”
, &
n_cÚds
))

272 
ş—nup
;

273 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

274 
	`årštf
(
å
, " BoŞ—ns: %7zd CÚd. Ex´.: %7zd\n", 
n_boŞs
, 
n_cÚds
);

277 ià(
	`qpŞ_pŞicy_g‘_avruË_™”
(
q
, 
QPOL_RULE_ALLOW
, &
™”
))

278 
ş—nup
;

279 ià(
	`qpŞ_™”©Ü_g‘_size
(
™”
, &
n_®lows
))

280 
ş—nup
;

281 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

282 ià(
	`qpŞ_pŞicy_has_ÿ·b™y
(
q
, 
QPOL_CAP_NEVERALLOW
)) {

283 ià(
	`qpŞ_pŞicy_g‘_avruË_™”
(
q
, 
QPOL_RULE_NEVERALLOW
, &
™”
))

284 
ş—nup
;

285 ià(
	`qpŞ_™”©Ü_g‘_size
(
™”
, &
n_Ãv”®lows
))

286 
ş—nup
;

288 
n_Ãv”®lows
 = 0;

290 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

291 
	`årštf
(
å
, " AÎow: %7zd Nev”®low: %7zd\n", 
n_®lows
, 
n_Ãv”®lows
);

294 ià(
	`qpŞ_pŞicy_g‘_avruË_™”
(
q
, 
QPOL_RULE_AUDITALLOW
, &
™”
))

295 
ş—nup
;

296 ià(
	`qpŞ_™”©Ü_g‘_size
(
™”
, &
n_aud™®lows
))

297 
ş—nup
;

298 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

299 ià(
	`qpŞ_pŞicy_g‘_avruË_™”
(
q
, 
QPOL_RULE_DONTAUDIT
, &
™”
))

300 
ş—nup
;

301 ià(
	`qpŞ_™”©Ü_g‘_size
(
™”
, &
n_dÚud™s
))

302 
ş—nup
;

303 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

304 
	`årštf
(
å
, " Aud™®low: %7zd DÚud™: %7zd\n", 
n_aud™®lows
, 
n_dÚud™s
);

307 ià(
	`qpŞ_pŞicy_g‘_‹ruË_™”
(
q
, 
QPOL_RULE_TYPE_TRANS
, &
™”
))

308 
ş—nup
;

309 ià(
	`qpŞ_™”©Ü_g‘_size
(
™”
, &
n_ty³Œªs
))

310 
ş—nup
;

311 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

312 ià(
	`qpŞ_pŞicy_g‘_‹ruË_™”
(
q
, 
QPOL_RULE_TYPE_CHANGE
, &
™”
))

313 
ş—nup
;

314 ià(
	`qpŞ_™”©Ü_g‘_size
(
™”
, &
n_ty³chªges
))

315 
ş—nup
;

316 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

317 
	`årštf
(
å
, " Ty³_Œªs: %7zd Ty³_chªge: %7zd\n", 
n_ty³Œªs
, 
n_ty³chªges
);

320 ià(
	`qpŞ_pŞicy_g‘_‹ruË_™”
(
q
, 
QPOL_RULE_TYPE_MEMBER
, &
™”
))

321 
ş—nup
;

322 ià(
	`qpŞ_™”©Ü_g‘_size
(
™”
, &
n_ty³memb”s
))

323 
ş—nup
;

324 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

325 ià(
	`qpŞ_pŞicy_g‘_rŞe_®low_™”
(
q
, &
™”
))

326 
ş—nup
;

327 ià(
	`qpŞ_™”©Ü_g‘_size
(
™”
, &
n_rŞ—Îows
))

328 
ş—nup
;

329 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

330 
	`årštf
(
å
, " Ty³_memb”: %7zd RŞ®low: %7zd\n", 
n_ty³memb”s
, 
n_rŞ—Îows
);

333 ià(
	`qpŞ_pŞicy_g‘_rŞe_Œªs_™”
(
q
, &
™”
))

334 
ş—nup
;

335 ià(
	`qpŞ_™”©Ü_g‘_size
(
™”
, &
n_rŞ‘¿ns
))

336 
ş—nup
;

337 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

338 ià(
	`qpŞ_pŞicy_g‘_¿nge_Œªs_™”
(
q
, &
™”
))

339 
ş—nup
;

340 ià(
	`qpŞ_™”©Ü_g‘_size
(
™”
, &
n_¿ng‘¿ns
))

341 
ş—nup
;

342 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

343 
	`årštf
(
å
, " RŞe_Œªs: %7zd Rªge_Œªs: %7zd\n", 
n_rŞ‘¿ns
, 
n_¿ng‘¿ns
);

346 ià(
	`qpŞ_pŞicy_g‘_cÚ¡¿št_™”
(
q
, &
™”
))

347 
ş—nup
;

348 ià(
	`qpŞ_™”©Ü_g‘_size
(
™”
, &
n_cÚ¡r
))

349 
ş—nup
;

350 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

351 ià(
	`qpŞ_pŞicy_g‘_v®id©‘¿ns_™”
(
q
, &
™”
))

352 
ş—nup
;

353 ià(
	`qpŞ_™”©Ü_g‘_size
(
™”
, &
n_vŒªs
))

354 
ş—nup
;

355 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

356 
	`årštf
(
å
, " CÚ¡¿šts: %7zd V®id©‘¿ns: %7zd\n", 
n_cÚ¡r
, 
n_vŒªs
);

359 ià(
	`qpŞ_pŞicy_g‘_isid_™”
(
q
, &
™”
))

360 
ş—nup
;

361 ià(
	`qpŞ_™”©Ü_g‘_size
(
™”
, &
n_isids
))

362 
ş—nup
;

363 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

364 ià(
	`qpŞ_pŞicy_g‘_fs_u£_™”
(
q
, &
™”
))

365 
ş—nup
;

366 ià(
	`qpŞ_™”©Ü_g‘_size
(
™”
, &
n_fsu£s
))

367 
ş—nup
;

368 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

369 
	`årštf
(
å
, " In™ŸÈSIDs: %7zd Fs_u£: %7zd\n", 
n_isids
, 
n_fsu£s
);

372 ià(
	`qpŞ_pŞicy_g‘_g’fscÚ_™”
(
q
, &
™”
))

373 
ş—nup
;

374 ià(
	`qpŞ_™”©Ü_g‘_size
(
™”
, &
n_g’fscÚs
))

375 
ş—nup
;

376 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

377 ià(
	`qpŞ_pŞicy_g‘_pÜtcÚ_™”
(
q
, &
™”
))

378 
ş—nup
;

379 ià(
	`qpŞ_™”©Ü_g‘_size
(
™”
, &
n_pÜtcÚs
))

380 
ş—nup
;

381 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

382 
	`årštf
(
å
, " G’fscÚ: %7zd PÜtcÚ: %7zd\n", 
n_g’fscÚs
, 
n_pÜtcÚs
);

385 ià(
	`qpŞ_pŞicy_g‘_ÃtifcÚ_™”
(
q
, &
™”
))

386 
ş—nup
;

387 ià(
	`qpŞ_™”©Ü_g‘_size
(
™”
, &
n_ÃtifcÚs
))

388 
ş—nup
;

389 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

390 ià(
	`qpŞ_pŞicy_g‘_nodecÚ_™”
(
q
, &
™”
))

391 
ş—nup
;

392 ià(
	`qpŞ_™”©Ü_g‘_size
(
™”
, &
n_nodecÚs
))

393 
ş—nup
;

394 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

395 
	`årštf
(
å
, " N‘ifcÚ: %7zd NodecÚ: %7zd\n", 
n_ÃtifcÚs
, 
n_nodecÚs
);

398 ià(
	`qpŞ_pŞicy_g‘_³rmissive_™”
(
q
, &
™”
))

399 
ş—nup
;

400 ià(
	`qpŞ_™”©Ü_g‘_size
(
™”
, &
n_³rmissives
))

401 
ş—nup
;

402 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

403 ià(
	`qpŞ_pŞicy_g‘_pŞÿp_™”
(
q
, &
™”
))

404 
ş—nup
;

405 ià(
	`qpŞ_™”©Ü_g‘_size
(
™”
, &
n_pŞÿps
))

406 
ş—nup
;

407 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

408 
	`årštf
(
å
, " P”missives: %7zd PŞÿp: %7zd\n", 
n_³rmissives
, 
n_pŞÿps
);

410 
	`årštf
(
å
, "\n");

412 
»tv®
 = 0;

413 
ş—nup
:

414 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

415 
	`­Ş_ty³_qu”y_de¡roy
(&
ty³_qu”y
);

416 
	`­Ş_©Œ_qu”y_de¡roy
(&
©Œ_qu”y
);

417 
	`­Ş_³rm_qu”y_de¡roy
(&
³rm_qu”y
);

418 
	`­Ş_veùÜ_de¡roy
(&
v
);

419 
	`­Ş_veùÜ_de¡roy
(&
³rms
);

420  
»tv®
;

421 
	}
}

439 
	$´št_şas£s
(
FILE
 * 
å
, cÚ¡ *
Çme
, 
ex·nd
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicydb
)

441 
»tv®
 = -1;

442 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

443 
size_t
 
n_şas£s
 = 0;

444 cÚ¡ 
qpŞ_şass_t
 *
şass_d©um
 = 
NULL
;

445 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicydb
);

446 ià(
Çme
 !ğ
NULL
) {

447 ià(
	`qpŞ_pŞicy_g‘_şass_by_Çme
(
q
, 
Çme
, &
şass_d©um
))

448 
ş—nup
;

449 ià(
	`´št_şass_³rms
(
å
, 
şass_d©um
, 
pŞicydb
, 
ex·nd
))

450 
ş—nup
;

452 ià(
	`qpŞ_pŞicy_g‘_şass_™”
(
q
, &
™”
))

453 
ş—nup
;

454 ià(
	`qpŞ_™”©Ü_g‘_size
(
™”
, &
n_şas£s
))

455 
ş—nup
;

456 
	`årštf
(
å
, "Objeù cÏs£s: %d\n", ()
n_şas£s
);

458 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

459 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
şass_d©um
))

460 
ş—nup
;

461 ià(
	`´št_şass_³rms
(
å
, 
şass_d©um
, 
pŞicydb
, 
ex·nd
))

462 
ş—nup
;

464 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

467 
»tv®
 = 0;

468 
ş—nup
:

469 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

470  
»tv®
;

471 
	}
}

487 
	$´št_ty³s
(
FILE
 * 
å
, cÚ¡ *
Çme
, 
ex·nd
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicydb
)

489 
»tv®
 = -1;

490 cÚ¡ 
qpŞ_ty³_t
 *
ty³_d©um
 = 
NULL
;

491 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

492 
­Ş_veùÜ_t
 *
ty³_veùÜ
 = 
NULL
;

493 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicydb
);

494 
size_t
 
veùÜ_sz
;

496 ià(
Çme
 !ğ
NULL
) {

497 ià(
	`qpŞ_pŞicy_g‘_ty³_by_Çme
(
q
, 
Çme
, &
ty³_d©um
))

498 
ş—nup
;

502 ià(
	`­Ş_ty³_g‘_by_qu”y
(
pŞicydb
, 
NULL
, &
ty³_veùÜ
))

503 
ş—nup
;

504 
veùÜ_sz
 = 
	`­Ş_veùÜ_g‘_size
(
ty³_veùÜ
);

505 
	`­Ş_veùÜ_de¡roy
(&
ty³_veùÜ
);

507 ià(
Çme
 =ğ
NULL
) {

508 
	`årštf
(
å
, "\nTy³s: %zd\n", 
veùÜ_sz
);

512 ià(
Çme
 !ğ
NULL
) {

513 ià(
	`qpŞ_pŞicy_g‘_ty³_by_Çme
(
q
, 
Çme
, &
ty³_d©um
))

514 
ş—nup
;

515 ià(
	`´št_ty³_©Œs
(
å
, 
ty³_d©um
, 
pŞicydb
, 
ex·nd
))

516 
ş—nup
;

518 ià(
	`qpŞ_pŞicy_g‘_ty³_™”
(
q
, &
™”
))

519 
ş—nup
;

521 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

522 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
ty³_d©um
))

523 
ş—nup
;

524 ià(
	`´št_ty³_©Œs
(
å
, 
ty³_d©um
, 
pŞicydb
, 
ex·nd
))

525 
ş—nup
;

529 
»tv®
 = 0;

530 
ş—nup
:

531 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

532  
»tv®
;

533 
	}
}

551 
	$´št_©Œibs
(
FILE
 * 
å
, cÚ¡ *
Çme
, 
ex·nd
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicydb
)

553 
»tv®
 = -1;

554 
­Ş_©Œ_qu”y_t
 *
©Œ_qu”y
 = 
NULL
;

555 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

556 cÚ¡ 
qpŞ_ty³_t
 *
ty³_d©um
 = 
NULL
;

557 
size_t
 
n_©Œs
, 
i
;

560 ià(
Çme
 !ğ
NULL
) {

561 
©Œ_qu”y
 = 
	`­Ş_©Œ_qu”y_ü—‹
();

562 ià(!
©Œ_qu”y
)

563 
ş—nup
;

564 ià(
	`­Ş_©Œ_qu”y_£t_©Œ
(
pŞicydb
, 
©Œ_qu”y
, 
Çme
))

565 
ş—nup
;

566 ià(
	`­Ş_©Œ_g‘_by_qu”y
(
pŞicydb
, 
©Œ_qu”y
, &
v
))

567 
ş—nup
;

568 
	`­Ş_©Œ_qu”y_de¡roy
(&
©Œ_qu”y
);

569 ià(
	`­Ş_veùÜ_g‘_size
(
v
) == 0) {

570 
	`­Ş_veùÜ_de¡roy
(&
v
);

571 
	`ERR
(
pŞicydb
, "Provided‡‰ribu‹ (%sèi nÙ‡ v®id‡‰ribu‹‚ame.", 
Çme
);

572 
ş—nup
;

575 
ty³_d©um
 = 
	`­Ş_veùÜ_g‘_–em’t
(
v
, (
size_t
) 0);

576 ià(!
ty³_d©um
)

577 
ş—nup
;

578 ià(
	`´št_©Œ_ty³s
(
å
, 
ty³_d©um
, 
pŞicydb
, 
ex·nd
))

579 
ş—nup
;

581 
©Œ_qu”y
 = 
	`­Ş_©Œ_qu”y_ü—‹
();

582 ià(!
©Œ_qu”y
)

583 
ş—nup
;

584 ià(
	`­Ş_©Œ_g‘_by_qu”y
(
pŞicydb
, 
©Œ_qu”y
, &
v
))

585 
ş—nup
;

586 
	`­Ş_©Œ_qu”y_de¡roy
(&
©Œ_qu”y
);

587 
n_©Œs
 = 
	`­Ş_veùÜ_g‘_size
(
v
);

589 
	`årštf
(
å
, "\nA‰ribu‹s: %zd\n", 
n_©Œs
);

590 
i
 = 0; i < 
n_©Œs
; i++) {

592 
ty³_d©um
 = (
qpŞ_ty³_t
 *è
	`­Ş_veùÜ_g‘_–em’t
(
v
, (
size_t
è
i
);

593 ià(!
ty³_d©um
)

594 
ş—nup
;

595 ià(
	`´št_©Œ_ty³s
(
å
, 
ty³_d©um
, 
pŞicydb
, 
ex·nd
))

596 
ş—nup
;

599 
	`­Ş_veùÜ_de¡roy
(&
v
);

601 
»tv®
 = 0;

602 
ş—nup
:

603 
	`­Ş_©Œ_qu”y_de¡roy
(&
©Œ_qu”y
);

604 
	`­Ş_veùÜ_de¡roy
(&
v
);

605  
»tv®
;

606 
	}
}

623 
	$´št_rŞes
(
FILE
 * 
å
, cÚ¡ *
Çme
, 
ex·nd
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicydb
)

625 
»tv®
 = -1;

626 cÚ¡ 
qpŞ_rŞe_t
 *
rŞe_d©um
 = 
NULL
;

627 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

628 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicydb
);

629 
size_t
 
n_rŞes
 = 0;

631 ià(
Çme
 !ğ
NULL
) {

632 ià(
	`qpŞ_pŞicy_g‘_rŞe_by_Çme
(
q
, 
Çme
, &
rŞe_d©um
))

633 
ş—nup
;

634 ià(
	`´št_rŞe_ty³s
(
å
, 
rŞe_d©um
, 
pŞicydb
, 
ex·nd
))

635 
ş—nup
;

637 ià(
	`qpŞ_pŞicy_g‘_rŞe_™”
(
q
, &
™”
))

638 
ş—nup
;

639 ià(
	`qpŞ_™”©Ü_g‘_size
(
™”
, &
n_rŞes
))

640 
ş—nup
;

641 
	`årštf
(
å
, "\nRŞes: %d\n", ()
n_rŞes
);

643 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

644 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
rŞe_d©um
))

645 
ş—nup
;

646 ià(
	`´št_rŞe_ty³s
(
å
, 
rŞe_d©um
, 
pŞicydb
, 
ex·nd
))

647 
ş—nup
;

649 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

652 
»tv®
 = 0;

653 
ş—nup
:

654 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

655  
»tv®
;

656 
	}
}

673 
	$´št_boŞ—ns
(
FILE
 * 
å
, cÚ¡ *
Çme
, 
ex·nd
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicydb
)

675 
»tv®
 = -1;

676 
qpŞ_boŞ_t
 *
boŞ_d©um
 = 
NULL
;

677 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

678 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicydb
);

679 
size_t
 
n_boŞs
 = 0;

681 ià(
Çme
 !ğ
NULL
) {

682 ià(
	`qpŞ_pŞicy_g‘_boŞ_by_Çme
(
q
, 
Çme
, &
boŞ_d©um
))

683 
ş—nup
;

684 ià(
	`´št_boŞ_¡©e
(
å
, 
boŞ_d©um
, 
pŞicydb
, 
ex·nd
))

685 
ş—nup
;

687 ià(
	`qpŞ_pŞicy_g‘_boŞ_™”
(
q
, &
™”
))

688 
ş—nup
;

689 ià(
	`qpŞ_™”©Ü_g‘_size
(
™”
, &
n_boŞs
))

690 
ş—nup
;

691 
	`årštf
(
å
, "\nCÚd™iÚ® BoŞ—ns: %zd\n", 
n_boŞs
);

692 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

693 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
boŞ_d©um
))

694 
ş—nup
;

695 ià(
	`´št_boŞ_¡©e
(
å
, 
boŞ_d©um
, 
pŞicydb
, 
ex·nd
))

696 
ş—nup
;

698 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

701 
»tv®
 = 0;

702 
ş—nup
:

703 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

704  
»tv®
;

705 
	}
}

723 
	$´št_u£rs
(
FILE
 * 
å
, cÚ¡ *
Çme
, 
ex·nd
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicydb
)

725 
»tv®
 = -1;

726 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

727 cÚ¡ 
qpŞ_u£r_t
 *
u£r_d©um
 = 
NULL
;

728 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicydb
);

729 
size_t
 
n_u£rs
 = 0;

731 ià(
Çme
 !ğ
NULL
) {

732 ià(
	`qpŞ_pŞicy_g‘_u£r_by_Çme
(
q
, 
Çme
, &
u£r_d©um
))

733 
ş—nup
;

734 ià(
	`´št_u£r_rŞes
(
å
, 
u£r_d©um
, 
pŞicydb
, 
ex·nd
))

735 
ş—nup
;

737 ià(
	`qpŞ_pŞicy_g‘_u£r_™”
(
q
, &
™”
))

738 
ş—nup
;

739 ià(
	`qpŞ_™”©Ü_g‘_size
(
™”
, &
n_u£rs
))

740 
ş—nup
;

741 
	`årštf
(
å
, "\nU£rs: %d\n", ()
n_u£rs
);

743 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

744 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
u£r_d©um
))

745 
ş—nup
;

746 ià(
	`´št_u£r_rŞes
(
å
, 
u£r_d©um
, 
pŞicydb
, 
ex·nd
))

747 
ş—nup
;

749 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

752 
»tv®
 = 0;

753 
ş—nup
:

754 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

755  
»tv®
;

756 
	}
}

774 
	$´št_£ns
(
FILE
 * 
å
, cÚ¡ *
Çme
, 
ex·nd
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicydb
)

776 
»tv®
 = -1;

777 
size_t
 
i
;

778 *
tmp
 = 
NULL
;

779 cÚ¡ *
lvl_Çme
 = 
NULL
;

780 
­Ş_Ëv–_qu”y_t
 *
qu”y
 = 
NULL
;

781 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

782 cÚ¡ 
qpŞ_Ëv–_t
 *
Ëv–
 = 
NULL
;

783 
­Ş_mls_Ëv–_t
 *
­_mls_lvl
 = 
NULL
;

784 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicydb
);

786 
qu”y
 = 
	`­Ş_Ëv–_qu”y_ü—‹
();

787 ià(!
qu”y
) {

788 
	`ERR
(
pŞicydb
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

789 
ş—nup
;

791 ià(
	`­Ş_Ëv–_qu”y_£t_£ns
(
pŞicydb
, 
qu”y
, 
Çme
))

792 
ş—nup
;

793 ià(
	`­Ş_Ëv–_g‘_by_qu”y
(
pŞicydb
, 
qu”y
, &
v
))

794 
ş—nup
;

796 ià(!
Çme
)

797 
	`årštf
(
å
, "\nS’s™iv™›s: %zd\n", 
	`­Ş_veùÜ_g‘_size
(
v
));

798 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v
); i++) {

799 
Ëv–
 = 
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

800 ià(
	`qpŞ_Ëv–_g‘_Çme
(
q
, 
Ëv–
, &
lvl_Çme
))

801 
ş—nup
;

802 
	`årštf
(
å
, " %s\n", 
lvl_Çme
);

803 ià(
ex·nd
) {

804 
­_mls_lvl
 = (
­Ş_mls_Ëv–_t
 *è
	`­Ş_mls_Ëv–_ü—‹_äom_qpŞ_Ëv–_d©um
(
pŞicydb
, 
Ëv–
);

805 
tmp
 = 
	`­Ş_mls_Ëv–_»nd”
(
pŞicydb
, 
­_mls_lvl
);

806 
	`­Ş_mls_Ëv–_de¡roy
(&
­_mls_lvl
);

807 ià(!
tmp
)

808 
ş—nup
;

809 
	`årštf
(
å
, "†ev– %s\n", 
tmp
);

810 
	`ä“
(
tmp
);

814 ià(
Çme
 && !
	`­Ş_veùÜ_g‘_size
(
v
)) {

815 
	`ERR
(
pŞicydb
, "Provided s’s™iv™y (%sèi nÙ‡ v®id s’s™iv™y‚ame.", 
Çme
);

816 
ş—nup
;

819 
»tv®
 = 0;

820 
ş—nup
:

821 
	`­Ş_Ëv–_qu”y_de¡roy
(&
qu”y
);

822 
	`­Ş_veùÜ_de¡roy
(&
v
);

823  
»tv®
;

824 
	}
}

842 
	$´št_ÿts
(
FILE
 * 
å
, cÚ¡ *
Çme
, 
ex·nd
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicydb
)

844 
»tv®
 = -1;

845 
­Ş_ÿt_qu”y_t
 *
qu”y
 = 
NULL
;

846 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

847 cÚ¡ 
qpŞ_ÿt_t
 *
ÿt_d©um
 = 
NULL
;

848 
size_t
 
i
, 
n_ÿts
;

850 
qu”y
 = 
	`­Ş_ÿt_qu”y_ü—‹
();

851 ià(!
qu”y
) {

852 
	`ERR
(
pŞicydb
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

853 
ş—nup
;

855 ià(
	`­Ş_ÿt_qu”y_£t_ÿt
(
pŞicydb
, 
qu”y
, 
Çme
))

856 
ş—nup
;

857 ià(
	`­Ş_ÿt_g‘_by_qu”y
(
pŞicydb
, 
qu”y
, &
v
))

858 
ş—nup
;

859 
n_ÿts
 = 
	`­Ş_veùÜ_g‘_size
(
v
);

860 
	`­Ş_veùÜ_sÜt
(
v
, &
qpŞ_ÿt_d©um_com·»
, (*)
pŞicydb
);

862 ià(!
Çme
)

863 
	`årštf
(
å
, "C©egÜ›s: %zd\n", 
n_ÿts
);

864 
i
 = 0; i < 
n_ÿts
; i++) {

865 
ÿt_d©um
 = 
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

866 ià(!
ÿt_d©um
)

867 
ş—nup
;

868 ià(
	`´št_ÿt_£ns
(
å
, 
ÿt_d©um
, 
pŞicydb
, 
ex·nd
))

869 
ş—nup
;

873 ià(
Çme
 && !
n_ÿts
) {

874 
	`ERR
(
pŞicydb
, "Provided c©egÜy (%sèi nÙ‡ v®id c©egÜy‚ame.", 
Çme
);

875 
ş—nup
;

878 
»tv®
 = 0;

879 
ş—nup
:

880 
	`­Ş_ÿt_qu”y_de¡roy
(&
qu”y
);

881 
	`­Ş_veùÜ_de¡roy
(&
v
);

882  
»tv®
;

883 
	}
}

899 
	$´št_fsu£
(
FILE
 * 
å
, cÚ¡ *
ty³
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicydb
)

901 
»tv®
 = -1;

902 *
tmp
 = 
NULL
;

903 
­Ş_fs_u£_qu”y_t
 *
qu”y
 = 
NULL
;

904 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

905 cÚ¡ 
qpŞ_fs_u£_t
 *
fs_u£
 = 
NULL
;

906 
size_t
 
i
;

908 
qu”y
 = 
	`­Ş_fs_u£_qu”y_ü—‹
();

909 ià(!
qu”y
) {

910 
	`ERR
(
pŞicydb
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

911 
ş—nup
;

913 ià(
	`­Ş_fs_u£_qu”y_£t_fesy¡em
(
pŞicydb
, 
qu”y
, 
ty³
))

914 
ş—nup
;

915 ià(
	`­Ş_fs_u£_g‘_by_qu”y
(
pŞicydb
, 
qu”y
, &
v
))

916 
ş—nup
;

918 ià(!
ty³
)

919 
	`årštf
(
å
, "\nFs_u£: %zd\n", 
	`­Ş_veùÜ_g‘_size
(
v
));

921 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v
); i++) {

922 
fs_u£
 = 
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

923 
tmp
 = 
	`­Ş_fs_u£_»nd”
(
pŞicydb
, 
fs_u£
);

924 ià(!
tmp
)

925 
ş—nup
;

926 
	`årštf
(
å
, " %s\n", 
tmp
);

927 
	`ä“
(
tmp
);

929 ià(
ty³
 && !
	`­Ş_veùÜ_g‘_size
(
v
)) {

930 
	`ERR
(
pŞicydb
, "NØfs_u£ s‹m’ˆfÜ fesy¡em oàty³ %s.", 
ty³
);

931 
ş—nup
;

933 
»tv®
 = 0;

934 
ş—nup
:

935 
	`­Ş_fs_u£_qu”y_de¡roy
(&
qu”y
);

936 
	`­Ş_veùÜ_de¡roy
(&
v
);

937  
»tv®
;

938 
	}
}

954 
	$´št_g’fscÚ
(
FILE
 * 
å
, cÚ¡ *
ty³
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicydb
)

956 
»tv®
 = -1;

957 
size_t
 
i
;

958 *
tmp
 = 
NULL
;

959 
­Ş_g’fscÚ_qu”y_t
 *
qu”y
 = 
NULL
;

960 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

961 
qpŞ_g’fscÚ_t
 *
g’fscÚ
 = 
NULL
;

963 
qu”y
 = 
	`­Ş_g’fscÚ_qu”y_ü—‹
();

964 ià(!
qu”y
) {

965 
	`ERR
(
pŞicydb
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

966 
ş—nup
;

968 ià(
	`­Ş_g’fscÚ_qu”y_£t_fesy¡em
(
pŞicydb
, 
qu”y
, 
ty³
))

969 
ş—nup
;

970 ià(
	`­Ş_g’fscÚ_g‘_by_qu”y
(
pŞicydb
, 
qu”y
, &
v
))

971 
ş—nup
;

973 ià(!
ty³
)

974 
	`årštf
(
å
, "\nG’fscÚ: %zd\n", 
	`­Ş_veùÜ_g‘_size
(
v
));

976 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v
); i++) {

977 
g’fscÚ
 = (
qpŞ_g’fscÚ_t
 *è
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

978 
tmp
 = 
	`­Ş_g’fscÚ_»nd”
(
pŞicydb
, 
g’fscÚ
);

979 ià(!
tmp
)

980 
ş—nup
;

981 
	`årštf
(
å
, " %s\n", 
tmp
);

982 
	`ä“
(
tmp
);

985 ià(
ty³
 && !
	`­Ş_veùÜ_g‘_size
(
v
)) {

986 
	`ERR
(
pŞicydb
, "NØg’fscÚ s‹m’ˆfÜ fesy¡em oàty³ %s.", 
ty³
);

987 
ş—nup
;

990 
»tv®
 = 0;

991 
ş—nup
:

992 
	`­Ş_g’fscÚ_qu”y_de¡roy
(&
qu”y
);

993 
	`­Ş_veùÜ_de¡roy
(&
v
);

995  
»tv®
;

996 
	}
}

1012 
	$´št_ÃtifcÚ
(
FILE
 * 
å
, cÚ¡ *
Çme
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicydb
)

1014 
»tv®
 = -1;

1015 *
tmp
;

1016 cÚ¡ 
qpŞ_ÃtifcÚ_t
 *
ÃtifcÚ
 = 
NULL
;

1017 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

1018 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicydb
);

1019 
size_t
 
n_ÃtifcÚs
 = 0;

1021 ià(
Çme
 !ğ
NULL
) {

1022 ià(
	`qpŞ_pŞicy_g‘_ÃtifcÚ_by_Çme
(
q
, 
Çme
, &
ÃtifcÚ
))

1023 
ş—nup
;

1024 
tmp
 = 
	`­Ş_ÃtifcÚ_»nd”
(
pŞicydb
, 
ÃtifcÚ
);

1025 ià(!
tmp
)

1026 
ş—nup
;

1027 
	`årštf
(
å
, " %s\n", 
tmp
);

1028 
	`ä“
(
tmp
);

1030 ià(
	`qpŞ_pŞicy_g‘_ÃtifcÚ_™”
(
q
, &
™”
))

1031 
ş—nup
;

1032 ià(
	`qpŞ_™”©Ü_g‘_size
(
™”
, &
n_ÃtifcÚs
))

1033 
ş—nup
;

1034 
	`årštf
(
å
, "\nN‘ifcÚ: %zd\n", 
n_ÃtifcÚs
);

1036 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

1037 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
ÃtifcÚ
))

1038 
ş—nup
;

1039 
tmp
 = 
	`­Ş_ÃtifcÚ_»nd”
(
pŞicydb
, 
ÃtifcÚ
);

1040 ià(!
tmp
)

1041 
ş—nup
;

1042 
	`årštf
(
å
, " %s\n", 
tmp
);

1043 
	`ä“
(
tmp
);

1045 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

1048 
»tv®
 = 0;

1049 
ş—nup
:

1050 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

1051  
»tv®
;

1052 
	}
}

1068 
	$´št_nodecÚ
(
FILE
 * 
å
, cÚ¡ *
addr
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicydb
)

1070 
»tv®
 = -1, 
´ÙocŞ
;

1071 *
tmp
 = 
NULL
;

1072 
ušt32_t
 
add»ss
[4] = { 0, 0, 0, 0 };

1073 
­Ş_nodecÚ_qu”y_t
 *
qu”y
 = 
NULL
;

1074 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

1075 
qpŞ_nodecÚ_t
 *
nodecÚ
 = 
NULL
;

1076 
size_t
 
n_nodecÚs
 = 0, 
i
;

1078 
qu”y
 = 
	`­Ş_nodecÚ_qu”y_ü—‹
();

1079 ià(!
qu”y
) {

1080 
	`ERR
(
pŞicydb
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

1081 
ş—nup
;

1085 ià(
addr
) {

1086 
´ÙocŞ
 = 
	`­Ş_¡r_to_š‹º®_
(
addr
, 
add»ss
);

1087 ià(
´ÙocŞ
 < 0) {

1088 
	`ERR
(
pŞicydb
, "%s", "Unableo…arse IP‡ddress");

1089 
ş—nup
;

1091 ià(
	`­Ş_nodecÚ_qu”y_£t_addr
(
pŞicydb
, 
qu”y
, 
add»ss
, 
´ÙocŞ
))

1092 
ş—nup
;

1093 ià(
	`­Ş_nodecÚ_qu”y_£t_´ÙocŞ
(
pŞicydb
, 
qu”y
, 
´ÙocŞ
))

1094 
ş—nup
;

1097 ià(
	`­Ş_nodecÚ_g‘_by_qu”y
(
pŞicydb
, 
qu”y
, &
v
))

1098 
ş—nup
;

1100 
n_nodecÚs
 = 
	`­Ş_veùÜ_g‘_size
(
v
);

1102 ià(!
addr
) {

1103 
	`årštf
(
å
, "NodecÚ: %zd\n", 
n_nodecÚs
);

1104 } ià(!
n_nodecÚs
) {

1105 
	`ERR
(
pŞicydb
, "NØm©chšg‚odecÚ fÜ‡dd»s %s.", 
addr
);

1106 
»tv®
 = 1;

1107 
ş—nup
;

1110 
i
 = 0; i < 
n_nodecÚs
; i++) {

1111 
nodecÚ
 = 
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

1112 
tmp
 = 
	`­Ş_nodecÚ_»nd”
(
pŞicydb
, 
nodecÚ
);

1113 ià(!
tmp
)

1114 
ş—nup
;

1115 
	`årštf
(
å
, " %s\n", 
tmp
);

1116 
	`ä“
(
tmp
);

1119 
»tv®
 = 0;

1120 
ş—nup
:

1121 
	`­Ş_nodecÚ_qu”y_de¡roy
(&
qu”y
);

1122 
	`­Ş_veùÜ_de¡roy
(&
v
);

1123  
»tv®
;

1124 
	}
}

1142 
	$´št_pÜtcÚ
(
FILE
 * 
å
, cÚ¡ *
num
, cÚ¡ *
´ÙocŞ
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicydb
)

1144 
»tv®
 = -1;

1145 cÚ¡ 
qpŞ_pÜtcÚ_t
 *
pÜtcÚ
 = 
NULL
;

1146 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

1147 
ušt16_t
 
low_pÜt
, 
high_pÜt
;

1148 
ušt8_t
 
ocÚ_´Ùo
, 
´Ùo
 = 0;

1149 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicydb
);

1150 
size_t
 
n_pÜtcÚs
;

1151 *
tmp
 = 
NULL
;

1153 ià(
´ÙocŞ
) {

1154 ià(!
	`¡rcmp
(
´ÙocŞ
, "tcp"))

1155 
´Ùo
 = 
IPPROTO_TCP
;

1156 ià(!
	`¡rcmp
(
´ÙocŞ
, "udp"))

1157 
´Ùo
 = 
IPPROTO_UDP
;

1159 
	`ERR
(
pŞicydb
, "UÇbËØg‘…ÜtcÚ by…rÙocŞ: bad…rÙocŞ %s.", 
´ÙocŞ
);

1160 
ş—nup
;

1163 ià(
	`qpŞ_pŞicy_g‘_pÜtcÚ_™”
(
q
, &
™”
))

1164 
ş—nup
;

1165 ià(
	`qpŞ_™”©Ü_g‘_size
(
™”
, &
n_pÜtcÚs
))

1166 
ş—nup
;

1167 ià(!
num
)

1168 
	`årštf
(
å
, "\nPÜtcÚ: %zd\n", 
n_pÜtcÚs
);

1170 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

1171 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
pÜtcÚ
))

1172 
ş—nup
;

1173 ià(
	`qpŞ_pÜtcÚ_g‘_low_pÜt
(
q
, 
pÜtcÚ
, &
low_pÜt
))

1174 
ş—nup
;

1175 ià(
	`qpŞ_pÜtcÚ_g‘_high_pÜt
(
q
, 
pÜtcÚ
, &
high_pÜt
))

1176 
ş—nup
;

1177 ià(
	`qpŞ_pÜtcÚ_g‘_´ÙocŞ
(
q
, 
pÜtcÚ
, &
ocÚ_´Ùo
))

1178 
ş—nup
;

1179 ià(
num
) {

1180 ià(
	`©oi
(
num
è< 
low_pÜt
 ||‡toiÒumè> 
high_pÜt
)

1183 ià(
´ÙocŞ
) {

1184 ià(
ocÚ_´Ùo
 !ğ
´Ùo
)

1187 
	`årštf
(
å
, " %s\n", (
tmp
 = 
	`­Ş_pÜtcÚ_»nd”
(
pŞicydb
, 
pÜtcÚ
)));

1188 
	`ä“
(
tmp
);

1189 
tmp
 = 
NULL
;

1192 
»tv®
 = 0;

1193 
ş—nup
:

1194 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

1195  
»tv®
;

1196 
	}
}

1214 
	$´št_isids
(
FILE
 * 
å
, cÚ¡ *
Çme
, 
ex·nd
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicydb
)

1216 
»tv®
 = -1;

1217 
­Ş_isid_qu”y_t
 *
qu”y
 = 
NULL
;

1218 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

1219 cÚ¡ 
qpŞ_isid_t
 *
isid
 = 
NULL
;

1220 cÚ¡ 
qpŞ_cÚ‹xt_t
 *
ùxt
 = 
NULL
;

1221 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicydb
);

1222 
size_t
 
i
, 
n_isids
 = 0;

1223 *
tmp
 = 
NULL
;

1224 cÚ¡ *
isid_Çme
 = 
NULL
;

1226 
qu”y
 = 
	`­Ş_isid_qu”y_ü—‹
();

1227 ià(!
qu”y
) {

1228 
	`ERR
(
pŞicydb
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

1229 
ş—nup
;

1231 ià(
	`­Ş_isid_qu”y_£t_Çme
(
pŞicydb
, 
qu”y
, 
Çme
))

1232 
ş—nup
;

1233 ià(
	`­Ş_isid_g‘_by_qu”y
(
pŞicydb
, 
qu”y
, &
v
))

1234 
ş—nup
;

1235 
n_isids
 = 
	`­Ş_veùÜ_g‘_size
(
v
);

1237 ià(!
Çme
)

1238 
	`årštf
(
å
, "\nIn™ŸÈSID: %zd\n", 
n_isids
);

1240 
i
 = 0; i < 
n_isids
; i++) {

1241 
isid
 = 
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

1242 ià(
	`qpŞ_isid_g‘_Çme
(
q
, 
isid
, &
isid_Çme
))

1243 
ş—nup
;

1244 ià(!
ex·nd
) {

1245 
	`årštf
(
å
, " %s\n", 
isid_Çme
);

1247 ià(
	`qpŞ_isid_g‘_cÚ‹xt
(
q
, 
isid
, &
ùxt
))

1248 
ş—nup
;

1249 
tmp
 = 
	`­Ş_qpŞ_cÚ‹xt_»nd”
(
pŞicydb
, 
ùxt
);

1250 ià(!
tmp
)

1251 
ş—nup
;

1252 
	`årštf
(
å
, "%20s: %s\n", 
isid_Çme
, 
tmp
);

1253 
	`ä“
(
tmp
);

1257 ià(
Çme
 && !
n_isids
) {

1258 
	`ERR
(
pŞicydb
, "Provided in™ŸÈSID‚am(%sèi nÙ‡ v®id‚ame.", 
Çme
);

1259 
ş—nup
;

1262 
»tv®
 = 0;

1263 
ş—nup
:

1264 
	`­Ş_isid_qu”y_de¡roy
(&
qu”y
);

1265 
	`­Ş_veùÜ_de¡roy
(&
v
);

1266  
»tv®
;

1267 
	}
}

1283 
	$´št_³rmissives
(
FILE
 * 
å
, cÚ¡ *
Çme
, 
ex·nd
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicydb
)

1285 
»tv®
 = -1;

1286 cÚ¡ *
tmp
 = 
NULL
;

1287 cÚ¡ 
qpŞ_³rmissive_t
 *
³rmissive_d©um
 = 
NULL
;

1288 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

1289 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicydb
);

1290 
size_t
 
n_³rmissives
 = 0;

1292 ià(
	`qpŞ_pŞicy_g‘_³rmissive_™”
(
q
, &
™”
))

1293 
ş—nup
;

1294 ià(
	`qpŞ_™”©Ü_g‘_size
(
™”
, &
n_³rmissives
))

1295 
ş—nup
;

1296 
	`årštf
(
å
, "\nP”missivTy³s: %zd\n", 
n_³rmissives
);

1297 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

1298 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
³rmissive_d©um
))

1299 
ş—nup
;

1300 ià(
	`qpŞ_³rmissive_g‘_Çme
(
q
, 
³rmissive_d©um
, &
tmp
))

1301 
ş—nup
;

1302 ià(!
tmp
)

1303 
ş—nup
;

1304 
	`årštf
(
å
, " %s\n", 
tmp
);

1307 
»tv®
 = 0;

1308 
ş—nup
:

1309 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

1310  
»tv®
;

1311 
	}
}

1328 
	$´št_pŞÿps
(
FILE
 * 
å
, cÚ¡ *
Çme
, 
ex·nd
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicydb
)

1330 
»tv®
 = -1;

1331 cÚ¡ *
tmp
 = 
NULL
;

1332 
qpŞ_pŞÿp_t
 *
pŞÿp_d©um
 = 
NULL
;

1333 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

1334 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicydb
);

1335 
size_t
 
n_pŞÿps
 = 0;

1337 ià(
	`qpŞ_pŞicy_g‘_pŞÿp_™”
(
q
, &
™”
))

1338 
ş—nup
;

1339 ià(
	`qpŞ_™”©Ü_g‘_size
(
™”
, &
n_pŞÿps
))

1340 
ş—nup
;

1341 
	`årštf
(
å
, "\nPŞicy C­ab™›s: %zd\n", 
n_pŞÿps
);

1342 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

1343 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
pŞÿp_d©um
))

1344 
ş—nup
;

1345 ià(
	`qpŞ_pŞÿp_g‘_Çme
(
q
, 
pŞÿp_d©um
, &
tmp
))

1346 
ş—nup
;

1347 ià(!
tmp
)

1348 
ş—nup
;

1349 
	`årštf
(
å
, " %s\n", 
tmp
);

1352 
»tv®
 = 0;

1353 
ş—nup
:

1354 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

1355  
»tv®
;

1356 
	}
}

1358 cÚ¡ *
	$g‘_©Œ_¡ršg
(
©Œ
)

1360 cÚ¡ *
¡ršg
 = "";

1361 
©Œ
)

1363 
QPOL_CEXPR_SYM_USER
:

1364 
¡ršg
 = "u1";

1366 
QPOL_CEXPR_SYM_ROLE
:

1367 
¡ršg
 = "r1";

1369 
QPOL_CEXPR_SYM_TYPE
:

1370 
¡ršg
 = "t1";

1373 
QPOL_CEXPR_SYM_USER
+
QPOL_CEXPR_SYM_TARGET
:

1374 
¡ršg
 = "u2";

1376 
QPOL_CEXPR_SYM_ROLE
+
QPOL_CEXPR_SYM_TARGET
:

1377 
¡ršg
 = "r2";

1379 
QPOL_CEXPR_SYM_TYPE
+
QPOL_CEXPR_SYM_TARGET
:

1380 
¡ršg
 = "t2";

1383 
QPOL_CEXPR_SYM_USER
+
QPOL_CEXPR_SYM_XTARGET
:

1384 
¡ršg
 = "u3";

1386 
QPOL_CEXPR_SYM_ROLE
+
QPOL_CEXPR_SYM_XTARGET
:

1387 
¡ršg
 = "r3";

1389 
QPOL_CEXPR_SYM_TYPE
+
QPOL_CEXPR_SYM_XTARGET
:

1390 
¡ršg
 = "t3";

1393 
QPOL_CEXPR_SYM_L1L2
:

1394 
¡ršg
 = "l1†2";

1396 
QPOL_CEXPR_SYM_L1H2
:

1397 
¡ršg
 = "l1 h2";

1399 
QPOL_CEXPR_SYM_H1L2
:

1400 
¡ršg
 = "h1†2";

1402 
QPOL_CEXPR_SYM_H1H2
:

1403 
¡ršg
 = "h1 h2";

1405 
QPOL_CEXPR_SYM_L1H1
:

1406 
¡ršg
 = "l1 h1";

1408 
QPOL_CEXPR_SYM_L2H2
:

1409 
¡ršg
 = "l2 h2";

1413  
¡ršg
;

1414 
	}
}

1416 cÚ¡ *
	$g‘_İ_¡ršg
(
İ
)

1418 *
¡ršg
 = "";

1420 
İ
)

1422 
QPOL_CEXPR_OP_EQ
:

1423 
¡ršg
 = "==";

1425 
QPOL_CEXPR_OP_NEQ
:

1426 
¡ršg
 = "!=";

1428 
QPOL_CEXPR_OP_DOM
:

1429 
¡ršg
 = "dom";

1431 
QPOL_CEXPR_OP_DOMBY
:

1432 
¡ršg
 = "domby";

1434 
QPOL_CEXPR_OP_INCOMP
:

1435 
¡ršg
 = "incomp";

1439  
¡ršg
;

1440 
	}
}

1442 
	$´št_cÚ¡¿šts
(
FILE
 * 
å
, 
ex·nd
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicydb
, 
lšeb»aks
)

1444 
»tv®
 = -1;

1445 cÚ¡ *
şass_Çme
 = 
NULL
;

1446 *
cÚ¡¿š_ty³
;

1447 *
³rm_li¡
 = "No Perms Extracted";

1448 cÚ¡ 
qpŞ_cÚ¡¿št_ex´_node_t
 *
ex´
 = 
NULL
;

1449 
qpŞ_™”©Ü_t
 *
pŞicy_™”
 = 
NULL
;

1450 
qpŞ_™”©Ü_t
 *
³rm_™”
 = 
NULL
;

1451 
qpŞ_™”©Ü_t
 *
ex´_™”
 = 
NULL
;

1452 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicydb
);

1453 
qpŞ_cÚ¡¿št_t
 *
cÚ¡¿št
 = 
NULL
;

1454 cÚ¡ 
qpŞ_şass_t
 *
şass
;

1455 
size_t
 
n_cÚ¡¿šts
 = 0;

1456 
ex´_ty³
 = 0;

1457 
sym_ty³
 = 0;

1458 
İ
 = 0;

1460 ià(
	`qpŞ_pŞicy_g‘_cÚ¡¿št_™”
(
q
, &
pŞicy_™”
) != 0)

1462 
	`ERR
 (
pŞicydb
, "%s", "Policy constraint iterator‚ot‡ccessible");

1463  
»tv®
;

1465 ià(
	`qpŞ_™”©Ü_g‘_size
(
pŞicy_™”
, &
n_cÚ¡¿šts
) != 0)

1467 
	`ERR
(
pŞicydb
, "%s", "Policy size computation failed");

1468 
ş—nup
;

1471 
	`årštf
(
å
, "\nCÚ¡¿šts: %zd\n", 
n_cÚ¡¿šts
);

1474 ; 
	`qpŞ_™”©Ü_’d
(
pŞicy_™”
è=ğ0; 
	`qpŞ_™”©Ü_Ãxt
(policy_iter))

1476 
cÚ¡¿š_ty³
 = "";

1477 ià(
	`qpŞ_™”©Ü_g‘_™em
(
pŞicy_™”
, (**)&
cÚ¡¿št
) != 0)

1479 
	`ERR
(
pŞicydb
, "%s", "Can't get constraint from iterator\n");

1480 
ş—nup
;

1483 ià(
	`qpŞ_cÚ¡¿št_g‘_şass
(
q
, 
cÚ¡¿št
, &
şass
) != 0)

1485 
	`ERR
(
pŞicydb
, "%s", "Can't get class from constraint\n");

1486 
ş—nup
;

1489 ià(
	`qpŞ_şass_g‘_Çme
(
q
, 
şass
, &
şass_Çme
) != 0)

1491 
	`ERR
(
pŞicydb
, "%s", "Can't get class‚ame from constraint\n");

1492 
ş—nup
;

1496 ià(
	`qpŞ_cÚ¡¿št_g‘_ex´_™”
 (
q
, 
cÚ¡¿št
, &
ex´_™”
) != 0)

1498 
	`ERR
(
pŞicydb
, "%s", "Can't getƒxpression from constraint\n");

1499 
ş—nup
;

1502 ; 
	`qpŞ_™”©Ü_’d
(
ex´_™”
è=ğ0; 
	`qpŞ_™”©Ü_Ãxt
(expr_iter))

1504 ià(
	`qpŞ_™”©Ü_g‘_™em
(
ex´_™”
, (**)&
ex´
) != 0)

1506 
	`ERR
(
pŞicydb
, "%s", "Can't getƒxpression from iterator\n");

1507 
ş—nup
;

1510 ià(
	`qpŞ_cÚ¡¿št_ex´_node_g‘_sym_ty³
(
q
, 
ex´
, &
sym_ty³
) != 0)

1512 
	`ERR
(
pŞicydb
, "%s", "Can't get sym_type fromƒxpression\n");

1513 
ş—nup
;

1516 ià(
sym_ty³
 >ğ
QPOL_CEXPR_SYM_L1L2
)

1518 
cÚ¡¿š_ty³
 = "mls";

1524 
	`årštf
 (
å
, "%scÚ¡¿š { % } { ", 
cÚ¡¿š_ty³
, 
şass_Çme
);

1526 ià(
	`qpŞ_cÚ¡¿št_g‘_³rm_™”
 (
q
, 
cÚ¡¿št
, &
³rm_™”
) != 0)

1528 
	`ERR
(
pŞicydb
, "%s", "Can't get…ermissions from constraint\n");

1529 
ş—nup
;

1532 ; 
	`qpŞ_™”©Ü_’d
(
³rm_™”
è=ğ0; 
	`qpŞ_™”©Ü_Ãxt
(perm_iter))

1534 ià(
	`qpŞ_™”©Ü_g‘_™em
(
³rm_™”
, (**)&
³rm_li¡
) != 0)

1536 
	`ERR
(
pŞicydb
, "%s", "Can't get…ermissions from iterator\n");

1537 
ş—nup
;

1540 
	`årštf
 (
å
, "% ", 
³rm_li¡
);

1541 
	`ä“
 (
³rm_li¡
);

1543 
	`årštf
 (
å
, " } ");

1546 ià(
	`qpŞ_cÚ¡¿št_g‘_ex´_™”
 (
q
, 
cÚ¡¿št
, &
ex´_™”
) != 0)

1548 
	`ERR
(
pŞicydb
, "%s", "Can't getƒxpression from constraint\n");

1549 
ş—nup
;

1552 
	`årštf
 (
å
, "\n( ");

1553 ; 
	`qpŞ_™”©Ü_’d
(
ex´_™”
è=ğ0; 
	`qpŞ_™”©Ü_Ãxt
(expr_iter))

1555 
qpŞ_™”©Ü_t
 *
Çmes_™”
 = 
NULL
;

1557 ià(
	`qpŞ_™”©Ü_g‘_™em
(
ex´_™”
, (**)&
ex´
) != 0)

1559 
	`ERR
(
pŞicydb
, "%s", "Can't getƒxpression from iterator\n");

1560 
ş—nup
;

1563 ià(
	`qpŞ_cÚ¡¿št_ex´_node_g‘_İ
 (
q
, 
ex´
, &
İ
) != 0)

1565 
	`ERR
(
pŞicydb
, "%s", "Can't get op fromƒxpression\n");

1566 
ş—nup
;

1569 ià(
	`qpŞ_cÚ¡¿št_ex´_node_g‘_sym_ty³
(
q
, 
ex´
, &
sym_ty³
) != 0)

1571 
	`ERR
(
pŞicydb
, "%s", "Can't get sym_type fromƒxpression\n");

1572 
ş—nup
;

1575 ià(
	`qpŞ_cÚ¡¿št_ex´_node_g‘_ex´_ty³
(
q
, 
ex´
, &
ex´_ty³
) != 0)

1577 
	`ERR
(
pŞicydb
, "%s", "Can't getƒxpr_type fromƒxpression\n");

1578 
ş—nup
;

1581 ià(
lšeb»aks
)

1582 
	`årštf
 (
å
, "\n\t");

1584 ià(
ex´_ty³
 =ğ
QPOL_CEXPR_TYPE_NOT
)

1586 
	`årštf
 (
å
, " ! ");

1588 ià(
ex´_ty³
 =ğ
QPOL_CEXPR_TYPE_AND
)

1590 
	`årštf
 (
å
, " && ");

1592 ià(
ex´_ty³
 =ğ
QPOL_CEXPR_TYPE_OR
)

1594 
	`årštf
 (
å
, " || ");

1596 ià(
ex´_ty³
 =ğ
QPOL_CEXPR_TYPE_ATTR
)

1598 
	`årštf
 (
å
, " % ", 
	`g‘_©Œ_¡ršg
(
sym_ty³
));

1599 
	`årštf
 (
å
, "% ", 
	`g‘_©Œ_¡ršg
(
sym_ty³
 | 
QPOL_CEXPR_SYM_TARGET
));

1600 
	`årštf
 (
å
, "% ", 
	`g‘_İ_¡ršg
(
İ
));

1602 ià(
ex´_ty³
 =ğ
QPOL_CEXPR_TYPE_NAMES
)

1604 
size_t
 
Çme_size
=0;

1606 
	`årštf
 (
å
, " % ", 
	`g‘_©Œ_¡ršg
(
sym_ty³
));

1608 ià(
	`qpŞ_cÚ¡¿št_ex´_node_g‘_Çmes_™”
 (
q
, 
ex´
, &
Çmes_™”
) != 0)

1610 
	`ERR
(
pŞicydb
, "%s", "Can't get‚ames iterator fromƒxpression\n");

1611 
ş—nup
;

1614 ià(
	`qpŞ_™”©Ü_g‘_size
(
Çmes_™”
, &
Çme_size
) != 0)

1616 
	`ERR
(
pŞicydb
, "%s", "Can't get size from‚ames iterator\n");

1617 
ş—nup
;

1619 ià(
Çme_size
 > 0)

1621 ià(
Çme_size
 > 1)

1622 
	`årštf
 (
å
, "{ ");

1624 ; 
	`qpŞ_™”©Ü_’d
(
Çmes_™”
è=ğ0; 
	`qpŞ_™”©Ü_Ãxt
(names_iter))

1626 *
Êame
 = 
NULL
;

1628 ià(
	`qpŞ_™”©Ü_g‘_™em
 (
Çmes_™”
, (**)&
Êame
) != 0)

1630 
	`ERR
(
pŞicydb
, "%s", "Can't get‚ames from iterator\n");

1631 
ş—nup
;

1634 
	`årštf
 (
å
, "% ", 
Êame
);

1635 
	`ä“
 (
Êame
);

1638 ià(
Çme_size
 > 1)

1639 
	`årštf
 (
å
, "} ");

1641 
	`årštf
 (
å
, "% ", 
CONSTRAIN_NULL_SET
);

1644 
	`årštf
 (
å
, "% ", 
	`g‘_İ_¡ršg
(
İ
));

1647 ià(
lšeb»aks
)

1648 
	`årštf
 (
å
, "\n);\n\n");

1650 
	`årštf
 (
å
, ");\n\n");

1653 
»tv®
 = 0;

1655 
ş—nup
:

1656 ià(
pŞicy_™”
 !ğ
NULL
è
	`qpŞ_™”©Ü_de¡roy
(&policy_iter);

1657 ià(
³rm_™”
 !ğ
NULL
è
	`qpŞ_™”©Ü_de¡roy
(&perm_iter);

1658 ià(
ex´_™”
 !ğ
NULL
è
	`qpŞ_™”©Ü_de¡roy
(&expr_iter);

1660  
»tv®
;

1661 
	}
}

1664 
	$maš
(
¬gc
, **
¬gv
)

1666 
rc
 = 0;

1667 
şas£s
, 
ty³s
, 
©Œibs
, 
rŞes
, 
u£rs
, 
®l
, 
ex·nd
, 
¡©s
, 
¹
, 
İtc
, 
isids
, 
boŞs
, 
£ns
, 
ÿts
, 
fsu£
, 
g’fs
, 
Ãtif
,

1668 
node
, 
pÜt
, 
³rmissives
, 
pŞÿps
, 
cÚ¡¿š
, 
lšeb»aks
;

1669 
­Ş_pŞicy_t
 *
pŞicydb
 = 
NULL
;

1670 
­Ş_pŞicy_·th_t
 *
pŞ_·th
 = 
NULL
;

1671 
­Ş_veùÜ_t
 *
mod_·ths
 = 
NULL
;

1672 
­Ş_pŞicy_·th_ty³_e
 
·th_ty³
 = 
APOL_POLICY_PATH_TYPE_MONOLITHIC
;

1674 *
şass_Çme
, *
ty³_Çme
, *
©Œib_Çme
, *
rŞe_Çme
, *
u£r_Çme
, *
isid_Çme
, *
boŞ_Çme
, *
£ns_Çme
, *
ÿt_Çme
,

1675 *
fsu£_ty³
, *
g’fs_ty³
, *
Ãtif_Çme
, *
node_addr
, *
³rmissive_Çme
, *
pŞÿp_Çme
, *
pÜt_num
 = 
NULL
, *
´ÙocŞ
 = NULL;

1677 
şass_Çme
 = 
ty³_Çme
 = 
©Œib_Çme
 = 
rŞe_Çme
 = 
u£r_Çme
 = 
isid_Çme
 = 
boŞ_Çme
 = 
£ns_Çme
 = 
ÿt_Çme
 = 
fsu£_ty³
 =

1678 
g’fs_ty³
 = 
Ãtif_Çme
 = 
node_addr
 = 
pÜt_num
 = 
³rmissive_Çme
 = 
pŞÿp_Çme
 = 
NULL
;

1679 
şas£s
 = 
ty³s
 = 
©Œibs
 = 
rŞes
 = 
u£rs
 = 
®l
 = 
ex·nd
 = 
¡©s
 = 
isids
 = 
boŞs
 = 
£ns
 = 
ÿts
 = 
fsu£
 = 
g’fs
 = 
Ãtif
 =

1680 
node
 = 
pÜt
 = 
³rmissives
 = 
pŞÿps
 = 
cÚ¡¿š
 = 
lšeb»aks
 = 0;

1681 (
İtc
 = 
	`g‘İt_lÚg
(
¬gc
, 
¬gv
, "c::t::a::r::u::b::lxhV", 
lÚgİts
, 
NULL
)) != -1) {

1682 
İtc
) {

1686 
şas£s
 = 1;

1687 ià(
İrg
 != 0)

1688 
şass_Çme
 = 
İrg
;

1690 
OPT_SENSITIVITY
:

1691 
£ns
 = 1;

1692 ià(
İrg
 != 0)

1693 
£ns_Çme
 = 
İrg
;

1695 
OPT_CATEGORY
:

1696 
ÿts
 = 1;

1697 ià(
İrg
 != 0)

1698 
ÿt_Çme
 = 
İrg
;

1701 
ty³s
 = 1;

1702 ià(
İrg
 != 0)

1703 
ty³_Çme
 = 
İrg
;

1706 
©Œibs
 = 1;

1707 ià(
İrg
 != 0)

1708 
©Œib_Çme
 = 
İrg
;

1711 
rŞes
 = 1;

1712 ià(
İrg
 != 0)

1713 
rŞe_Çme
 = 
İrg
;

1716 
u£rs
 = 1;

1717 ià(
İrg
 != 0)

1718 
u£r_Çme
 = 
İrg
;

1721 
boŞs
 = 1;

1722 ià(
İrg
 != 0)

1723 
boŞ_Çme
 = 
İrg
;

1725 
OPT_INITIALSID
:

1726 
isids
 = 1;

1727 ià(
İrg
 != 0)

1728 
isid_Çme
 = 
İrg
;

1730 
OPT_FS_USE
:

1731 
fsu£
 = 1;

1732 ià(
İrg
 != 0)

1733 
fsu£_ty³
 = 
İrg
;

1735 
OPT_GENFSCON
:

1736 
g’fs
 = 1;

1737 ià(
İrg
 != 0)

1738 
g’fs_ty³
 = 
İrg
;

1740 
OPT_NETIFCON
:

1741 
Ãtif
 = 1;

1742 ià(
İrg
 != 0)

1743 
Ãtif_Çme
 = 
İrg
;

1745 
OPT_NODECON
:

1746 
node
 = 1;

1747 ià(
İrg
 != 0)

1748 
node_addr
 = 
İrg
;

1750 
OPT_PERMISSIVE
:

1751 
³rmissives
 = 1;

1752 ià(
İrg
 != 0)

1753 
³rmissive_Çme
 = 
İrg
;

1755 
OPT_POLCAP
:

1756 
pŞÿps
 = 1;

1757 ià(
İrg
 != 0)

1758 
pŞÿp_Çme
 = 
İrg
;

1760 
OPT_PORTCON
:

1761 
pÜt
 = 1;

1762 ià(
İrg
 != 0)

1763 
pÜt_num
 = 
İrg
;

1765 
OPT_PROTOCOL
:

1766 ià(
İrg
 != 0)

1767 
´ÙocŞ
 = 
İrg
;

1769 
OPT_ALL
:

1770 
®l
 = 1;

1773 
ex·nd
 = 1;

1776 
lšeb»aks
=1;

1778 
OPT_CONSTRAIN
:

1779 
cÚ¡¿š
=1;

1781 
OPT_STATS
:

1782 
¡©s
 = 1;

1785 
	`u§ge
(
¬gv
[0], 0);

1786 
	`ex™
(0);

1788 
	`´štf
("£šfØ%s\n%s\n", 
VERSION
, 
COPYRIGHT_INFO
);

1789 
	`ex™
(0);

1791 
	`u§ge
(
¬gv
[0], 1);

1792 
	`ex™
(1);

1797 ià(
´ÙocŞ
 && !(
pÜt
 || 
®l
)) {

1798 
	`årštf
(
¡d”r
, "The --protocol flag„equiresƒither --portcon or --ALL.\n");

1799 
	`ex™
(1);

1803 ià(
şas£s
 + 
ty³s
 + 
©Œibs
 + 
rŞes
 + 
u£rs
 + 
isids
 + 
boŞs
 + 
£ns
 + 
ÿts
 + 
fsu£
 + 
g’fs
 + 
Ãtif
 + 
node
 + 
pÜt
 + 
³rmissives
 + 
pŞÿps
 + 
cÚ¡¿š
 + 
®l
 < 1) {

1804 
¡©s
 = 1;

1807 
pŞicy_lßd_İtiÚs
 = ((
¡©s
 || 
®l
è? 0 : 
QPOL_POLICY_OPTION_NO_RULES
);

1809 ià(
¬gc
 - 
İtšd
 < 1) {

1810 
¹
 = 
	`qpŞ_deçuÉ_pŞicy_fšd
(&
pŞicy_fe
);

1811 ià(
¹
 < 0) {

1812 
	`årštf
(
¡d”r
, "DeçuÉ…Şicy s—rch faed: %s\n", 
	`¡»¼Ü
(
”ºo
));

1813 
	`ex™
(1);

1814 } ià(
¹
 != 0) {

1815 
	`årštf
(
¡d”r
, "No default…olicy found.\n");

1816 
	`ex™
(1);

1818 
pŞicy_lßd_İtiÚs
 |ğ
QPOL_POLICY_OPTION_MATCH_SYSTEM
;

1820 
pŞicy_fe
 = 
	`¡rdup
(
¬gv
[
İtšd
]);

1821 ià(!
pŞicy_fe
) {

1822 
	`årštf
(
¡d”r
, "Out of memory\n");

1823 
	`ex™
(1);

1825 
İtšd
++;

1828 ià(
¬gc
 - 
İtšd
 > 0) {

1829 
·th_ty³
 = 
APOL_POLICY_PATH_TYPE_MODULAR
;

1830 ià(!(
mod_·ths
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
))) {

1831 
	`ERR
(
pŞicydb
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

1832 
	`ä“
(
pŞicy_fe
);

1833 
	`ex™
(1);

1835 ; 
¬gc
 - 
İtšd
; optind++) {

1836 ià(
	`­Ş_veùÜ_­³nd
(
mod_·ths
, (*)
¬gv
[
İtšd
])) {

1837 
	`ERR
(
pŞicydb
, "E¼Ü†ßdšg moduË %s", 
¬gv
[
İtšd
]);

1838 
	`ä“
(
pŞicy_fe
);

1839 
	`­Ş_veùÜ_de¡roy
(&
mod_·ths
);

1840 
	`ex™
(1);

1843 } ià(
	`­Ş_fe_is_pŞicy_·th_li¡
(
pŞicy_fe
) > 0) {

1844 
pŞ_·th
 = 
	`­Ş_pŞicy_·th_ü—‹_äom_fe
(
pŞicy_fe
);

1845 ià(!
pŞ_·th
) {

1846 
	`ERR
(
pŞicydb
, "%s", "invalid…olicy†ist");

1847 
	`ä“
(
pŞicy_fe
);

1848 
	`ex™
(1);

1852 ià(!
pŞ_·th
)

1853 
pŞ_·th
 = 
	`­Ş_pŞicy_·th_ü—‹
(
·th_ty³
, 
pŞicy_fe
, 
mod_·ths
);

1854 ià(!
pŞ_·th
) {

1855 
	`ERR
(
pŞicydb
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

1856 
	`ä“
(
pŞicy_fe
);

1857 
	`­Ş_veùÜ_de¡roy
(&
mod_·ths
);

1858 
	`ex™
(1);

1860 
	`­Ş_veùÜ_de¡roy
(&
mod_·ths
);

1862 
pŞicydb
 = 
	`­Ş_pŞicy_ü—‹_äom_pŞicy_·th
(
pŞ_·th
, 
pŞicy_lßd_İtiÚs
, 
NULL
, NULL);

1863 ià(!
pŞicydb
) {

1864 
	`ERR
(
pŞicydb
, "%s", 
	`¡»¼Ü
(
”ºo
));

1865 
	`ä“
(
pŞicy_fe
);

1866 
	`­Ş_pŞicy_·th_de¡roy
(&
pŞ_·th
);

1867 
	`ex™
(1);

1871 ià(
¡©s
 || 
®l
)

1872 
rc
 = 
	`´št_¡©s
(
¡dout
, 
pŞicydb
);

1873 ià(
şas£s
 || 
®l
)

1874 
rc
 = 
	`´št_şas£s
(
¡dout
, 
şass_Çme
, 
ex·nd
, 
pŞicydb
);

1875 ià(
ty³s
 || 
®l
)

1876 
rc
 = 
	`´št_ty³s
(
¡dout
, 
ty³_Çme
, 
ex·nd
, 
pŞicydb
);

1877 ià(
©Œibs
 || 
®l
)

1878 
rc
 = 
	`´št_©Œibs
(
¡dout
, 
©Œib_Çme
, 
ex·nd
, 
pŞicydb
);

1879 ià(
rŞes
 || 
®l
)

1880 
rc
 = 
	`´št_rŞes
(
¡dout
, 
rŞe_Çme
, 
ex·nd
, 
pŞicydb
);

1881 ià(
u£rs
 || 
®l
)

1882 
rc
 = 
	`´št_u£rs
(
¡dout
, 
u£r_Çme
, 
ex·nd
, 
pŞicydb
);

1883 ià(
boŞs
 || 
®l
)

1884 
rc
 = 
	`´št_boŞ—ns
(
¡dout
, 
boŞ_Çme
, 
ex·nd
, 
pŞicydb
);

1885 ià(
£ns
 || 
®l
)

1886 
rc
 = 
	`´št_£ns
(
¡dout
, 
£ns_Çme
, 
ex·nd
, 
pŞicydb
);

1887 ià(
ÿts
 || 
®l
)

1888 
rc
 = 
	`´št_ÿts
(
¡dout
, 
ÿt_Çme
, 
ex·nd
, 
pŞicydb
);

1889 ià(
fsu£
 || 
®l
)

1890 
rc
 = 
	`´št_fsu£
(
¡dout
, 
fsu£_ty³
, 
pŞicydb
);

1891 ià(
g’fs
 || 
®l
)

1892 
rc
 = 
	`´št_g’fscÚ
(
¡dout
, 
g’fs_ty³
, 
pŞicydb
);

1893 ià(
Ãtif
 || 
®l
)

1894 
rc
 = 
	`´št_ÃtifcÚ
(
¡dout
, 
Ãtif_Çme
, 
pŞicydb
);

1895 ià(
node
 || 
®l
)

1896 
rc
 = 
	`´št_nodecÚ
(
¡dout
, 
node_addr
, 
pŞicydb
);

1897 ià(
pÜt
 || 
®l
)

1898 
rc
 = 
	`´št_pÜtcÚ
(
¡dout
, 
pÜt_num
, 
´ÙocŞ
, 
pŞicydb
);

1899 ià(
isids
 || 
®l
)

1900 
rc
 = 
	`´št_isids
(
¡dout
, 
isid_Çme
, 
ex·nd
, 
pŞicydb
);

1901 ià(
³rmissives
 || 
®l
)

1902 
rc
 = 
	`´št_³rmissives
(
¡dout
, 
³rmissive_Çme
, 
ex·nd
, 
pŞicydb
);

1903 ià(
pŞÿps
 || 
®l
)

1904 
rc
 = 
	`´št_pŞÿps
(
¡dout
, 
pŞÿp_Çme
, 
ex·nd
, 
pŞicydb
);

1905 ià(
cÚ¡¿š
 || 
®l
)

1906 
rc
 = 
	`´št_cÚ¡¿šts
(
¡dout
, 
ex·nd
, 
pŞicydb
, 
lšeb»aks
);

1908 
	`­Ş_pŞicy_de¡roy
(&
pŞicydb
);

1909 
	`­Ş_pŞicy_·th_de¡roy
(&
pŞ_·th
);

1910 
	`ä“
(
pŞicy_fe
);

1911 
	`ex™
(
rc
);

1912 
	}
}

1924 
	$´št_ty³_©Œs
(
FILE
 * 
å
, cÚ¡ 
qpŞ_ty³_t
 * 
ty³_d©um
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicydb
, cÚ¡ 
ex·nd
)

1926 
»tv®
 = -1;

1927 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

1928 
i§‰r
, 
i§lŸs
;

1929 cÚ¡ *
ty³_Çme
 = 
NULL
, *
©Œ_Çme
 = NULL;

1930 cÚ¡ 
qpŞ_ty³_t
 *
©Œ_d©um
 = 
NULL
;

1931 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicydb
);

1933 ià(
	`qpŞ_ty³_g‘_Çme
(
q
, 
ty³_d©um
, &
ty³_Çme
))

1934 
ş—nup
;

1935 ià(
	`qpŞ_ty³_g‘_i§‰r
(
q
, 
ty³_d©um
, &
i§‰r
))

1936 
ş—nup
;

1937 ià(
	`qpŞ_ty³_g‘_i§lŸs
(
q
, 
ty³_d©um
, &
i§lŸs
))

1938 
ş—nup
;

1940 ià(!
i§‰r
 && !
i§lŸs
) {

1941 
	`årštf
(
å
, " %s\n", 
ty³_Çme
);

1942 ià(
ex·nd
) {

1943 ià(
	`qpŞ_ty³_g‘_©Œ_™”
(
q
, 
ty³_d©um
, &
™”
))

1944 
ş—nup
;

1945 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

1946 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
©Œ_d©um
))

1947 
ş—nup
;

1948 ià(
	`qpŞ_ty³_g‘_Çme
(
q
, 
©Œ_d©um
, &
©Œ_Çme
))

1949 
ş—nup
;

1950 
	`årštf
(
å
, " %s\n", 
©Œ_Çme
);

1955 
»tv®
 = 0;

1956 
ş—nup
:

1957 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

1958  
»tv®
;

1959 
	}
}

1971 
	$´št_©Œ_ty³s
(
FILE
 * 
å
, cÚ¡ 
qpŞ_ty³_t
 * 
ty³_d©um
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicydb
, cÚ¡ 
ex·nd
)

1973 
»tv®
 = -1;

1974 cÚ¡ 
qpŞ_ty³_t
 *
©Œ_d©um
 = 
NULL
;

1975 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

1976 cÚ¡ *
©Œ_Çme
 = 
NULL
, *
ty³_Çme
 = NULL;

1977 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicydb
);

1978 
i§‰r
;

1980 ià(
	`qpŞ_ty³_g‘_Çme
(
q
, 
ty³_d©um
, &
©Œ_Çme
))

1981 
ş—nup
;

1982 
	`årštf
(
å
, " %s\n", 
©Œ_Çme
);

1984 ià(
ex·nd
) {

1986 ià(
	`qpŞ_ty³_g‘_i§‰r
(
q
, 
ty³_d©um
, &
i§‰r
))

1987 
ş—nup
;

1988 ià(
i§‰r
) {

1989 ià(
	`qpŞ_ty³_g‘_ty³_™”
(
q
, 
ty³_d©um
, &
™”
))

1990 
ş—nup
;

1991 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

1992 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
©Œ_d©um
))

1993 
ş—nup
;

1994 ià(
	`qpŞ_ty³_g‘_Çme
(
q
, 
©Œ_d©um
, &
ty³_Çme
))

1995 
ş—nup
;

1996 
	`årštf
(
å
, " %s\n", 
ty³_Çme
);

1998 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

2001 
ş—nup
;

2005 
»tv®
 = 0;

2006 
ş—nup
:

2007 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

2008  
»tv®
;

2009 
	}
}

2021 
	$´št_u£r_rŞes
(
FILE
 * 
å
, cÚ¡ 
qpŞ_u£r_t
 * 
u£r_d©um
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicydb
, cÚ¡ 
ex·nd
)

2023 
»tv®
 = -1;

2024 cÚ¡ 
qpŞ_rŞe_t
 *
rŞe_d©um
 = 
NULL
;

2025 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

2026 cÚ¡ 
qpŞ_mls_¿nge_t
 *
¿nge
 = 
NULL
;

2027 cÚ¡ 
qpŞ_mls_Ëv–_t
 *
dæt_Ëv–
 = 
NULL
;

2028 
­Ş_mls_Ëv–_t
 *
­_lvl
 = 
NULL
;

2029 
­Ş_mls_¿nge_t
 *
­_¿nge
 = 
NULL
;

2030 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicydb
);

2031 *
tmp
;

2032 cÚ¡ *
u£r_Çme
, *
rŞe_Çme
;

2034 ià(
	`qpŞ_u£r_g‘_Çme
(
q
, 
u£r_d©um
, &
u£r_Çme
))

2035 
ş—nup
;

2036 
	`årštf
(
å
, " %s\n", 
u£r_Çme
);

2038 ià(
ex·nd
) {

2039 ià(
	`qpŞ_pŞicy_has_ÿ·b™y
(
q
, 
QPOL_CAP_MLS
)) {

2041 ià(
	`qpŞ_u£r_g‘_dæev–
(
q
, 
u£r_d©um
, &
dæt_Ëv–
))

2042 
ş—nup
;

2043 
­_lvl
 = 
	`­Ş_mls_Ëv–_ü—‹_äom_qpŞ_mls_Ëv–
(
pŞicydb
, 
dæt_Ëv–
);

2044 
tmp
 = 
	`­Ş_mls_Ëv–_»nd”
(
pŞicydb
, 
­_lvl
);

2045 ià(!
tmp
)

2046 
ş—nup
;

2047 
	`årštf
(
å
, " deçuÉ†ev–: %s\n", 
tmp
);

2048 
	`ä“
(
tmp
);

2050 ià(
	`qpŞ_u£r_g‘_¿nge
(
q
, 
u£r_d©um
, &
¿nge
))

2051 
ş—nup
;

2052 
­_¿nge
 = 
	`­Ş_mls_¿nge_ü—‹_äom_qpŞ_mls_¿nge
(
pŞicydb
, 
¿nge
);

2053 
tmp
 = 
	`­Ş_mls_¿nge_»nd”
(
pŞicydb
, 
­_¿nge
);

2054 ià(!
tmp
)

2055 
ş—nup
;

2056 
	`årštf
(
å
, "„ªge: %s\n", 
tmp
);

2057 
	`ä“
(
tmp
);

2060 
	`årštf
(
å
, "„oles:\n");

2061 ià(
	`qpŞ_u£r_g‘_rŞe_™”
(
q
, 
u£r_d©um
, &
™”
))

2062 
ş—nup
;

2063 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

2064 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
rŞe_d©um
))

2065 
ş—nup
;

2066 ià(
	`qpŞ_rŞe_g‘_Çme
(
q
, 
rŞe_d©um
, &
rŞe_Çme
))

2067 
ş—nup
;

2068 
	`årštf
(
å
, " %s\n", 
rŞe_Çme
);

2072 
»tv®
 = 0;

2073 
ş—nup
:

2074 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

2075 
	`­Ş_mls_Ëv–_de¡roy
(&
­_lvl
);

2076 
	`­Ş_mls_¿nge_de¡roy
(&
­_¿nge
);

2077  
»tv®
;

2078 
	}
}

2090 
	$´št_rŞe_ty³s
(
FILE
 * 
å
, cÚ¡ 
qpŞ_rŞe_t
 * 
rŞe_d©um
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicydb
, cÚ¡ 
ex·nd
)

2092 
»tv®
 = -1;

2093 cÚ¡ *
rŞe_Çme
 = 
NULL
, *
ty³_Çme
 = NULL;

2094 cÚ¡ 
qpŞ_rŞe_t
 *
dom_d©um
 = 
NULL
;

2095 cÚ¡ 
qpŞ_ty³_t
 *
ty³_d©um
 = 
NULL
;

2096 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

2097 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicydb
);

2098 
size_t
 
n_dom
 = 0, 
n_ty³s
 = 0;

2100 ià(
	`qpŞ_rŞe_g‘_Çme
(
q
, 
rŞe_d©um
, &
rŞe_Çme
))

2101 
ş—nup
;

2102 
	`årštf
(
å
, " %s\n", 
rŞe_Çme
);

2104 ià(
ex·nd
) {

2105 ià(
	`qpŞ_rŞe_g‘_domš©e_™”
(
q
, 
rŞe_d©um
, &
™”
))

2106 
ş—nup
;

2107 ià(
	`qpŞ_™”©Ü_g‘_size
(
™”
, &
n_dom
))

2108 
ş—nup
;

2109 ià(()
n_dom
 > 0) {

2110 
	`årštf
(
å
, " Dominated Roles:\n");

2112 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

2113 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
dom_d©um
))

2114 
ş—nup
;

2115 ià(
	`qpŞ_rŞe_g‘_Çme
(
q
, 
dom_d©um
, &
rŞe_Çme
))

2116 
ş—nup
;

2117 
	`årštf
(
å
, " %s\n", 
rŞe_Çme
);

2120 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

2122 ià(
	`qpŞ_rŞe_g‘_ty³_™”
(
q
, 
rŞe_d©um
, &
™”
))

2123 
ş—nup
;

2124 ià(
	`qpŞ_™”©Ü_g‘_size
(
™”
, &
n_ty³s
))

2125 
ş—nup
;

2126 ià(()
n_ty³s
 > 0) {

2127 
	`årštf
(
å
, " Types:\n");

2129 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

2130 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
ty³_d©um
))

2131 
ş—nup
;

2132 ià(
	`qpŞ_ty³_g‘_Çme
(
q
, 
ty³_d©um
, &
ty³_Çme
))

2133 
ş—nup
;

2134 
	`årštf
(
å
, " %s\n", 
ty³_Çme
);

2139 
»tv®
 = 0;

2140 
ş—nup
:

2141 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

2142  
»tv®
;

2143 
	}
}

2155 
	$´št_boŞ_¡©e
(
FILE
 * 
å
, cÚ¡ 
qpŞ_boŞ_t
 * 
boŞ_d©um
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicydb
, cÚ¡ 
ex·nd
)

2157 
»tv®
 = -1;

2158 cÚ¡ *
boŞ_Çme
 = 
NULL
;

2159 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicydb
);

2160 
¡©e
;

2162 ià(
	`qpŞ_boŞ_g‘_Çme
(
q
, 
boŞ_d©um
, &
boŞ_Çme
))

2163 
ş—nup
;

2164 
	`årštf
(
å
, " %s", 
boŞ_Çme
);

2166 ià(
ex·nd
) {

2167 ià(
	`qpŞ_boŞ_g‘_¡©e
(
q
, 
boŞ_d©um
, &
¡©e
))

2168 
ş—nup
;

2169 
	`årštf
(
å
, ": %s", 
¡©e
 ? "TRUE" : "FALSE");

2171 
	`årštf
(
å
, "\n");

2173 
»tv®
 = 0;

2174 
ş—nup
:

2175  
»tv®
;

2176 
	}
}

2188 
	$´št_şass_³rms
(
FILE
 * 
å
, cÚ¡ 
qpŞ_şass_t
 * 
şass_d©um
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicydb
, cÚ¡ 
ex·nd
)

2190 
»tv®
 = -1;

2191 cÚ¡ *
şass_Çme
 = 
NULL
, *
³rm_Çme
 = NULL;

2192 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

2193 cÚ¡ 
qpŞ_commÚ_t
 *
commÚ_d©um
 = 
NULL
;

2194 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicydb
);

2196 ià(!
şass_d©um
)

2197 
ş—nup
;

2199 ià(
	`qpŞ_şass_g‘_Çme
(
q
, 
şass_d©um
, &
şass_Çme
))

2200 
ş—nup
;

2201 
	`årštf
(
å
, " %s\n", 
şass_Çme
);

2203 ià(
ex·nd
) {

2205 ià(
	`qpŞ_şass_g‘_commÚ
(
q
, 
şass_d©um
, &
commÚ_d©um
))

2206 
ş—nup
;

2207 ià(
commÚ_d©um
) {

2208 ià(
	`qpŞ_commÚ_g‘_³rm_™”
(
q
, 
commÚ_d©um
, &
™”
))

2209 
ş—nup
;

2211 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

2212 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
³rm_Çme
))

2213 
ş—nup
;

2214 
	`årštf
(
å
, " %s\n", 
³rm_Çme
);

2216 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

2219 ià(
	`qpŞ_şass_g‘_³rm_™”
(
q
, 
şass_d©um
, &
™”
))

2220 
ş—nup
;

2221 ; !
	`qpŞ_™”©Ü_’d
(
™”
); 
	`qpŞ_™”©Ü_Ãxt
(iter)) {

2222 ià(
	`qpŞ_™”©Ü_g‘_™em
(
™”
, (**)&
³rm_Çme
))

2223 
ş—nup
;

2224 
	`årštf
(
å
, " %s\n", 
³rm_Çme
);

2226 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

2229 
»tv®
 = 0;

2230 
ş—nup
:

2231 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

2232  
»tv®
;

2233 
	}
}

2245 
	$´št_ÿt_£ns
(
FILE
 * 
å
, cÚ¡ 
qpŞ_ÿt_t
 * 
ÿt_d©um
, cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicydb
, cÚ¡ 
ex·nd
)

2247 
»tv®
 = -1;

2248 cÚ¡ *
ÿt_Çme
, *
lvl_Çme
;

2249 
­Ş_Ëv–_qu”y_t
 *
qu”y
 = 
NULL
;

2250 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

2251 cÚ¡ 
qpŞ_Ëv–_t
 *
lvl_d©um
 = 
NULL
;

2252 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicydb
);

2253 
size_t
 
i
, 
n_£ns
 = 0;

2255 ià(!
å
 || !
ÿt_d©um
 || !
pŞicydb
)

2256 
ş—nup
;

2259 ià(
	`qpŞ_ÿt_g‘_Çme
(
q
, 
ÿt_d©um
, &
ÿt_Çme
))

2260 
ş—nup
;

2262 
qu”y
 = 
	`­Ş_Ëv–_qu”y_ü—‹
();

2263 ià(!
qu”y
) {

2264 
	`ERR
(
pŞicydb
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

2265 
ş—nup
;

2267 ià(
	`­Ş_Ëv–_qu”y_£t_ÿt
(
pŞicydb
, 
qu”y
, 
ÿt_Çme
))

2268 
ş—nup
;

2269 ià(
	`­Ş_Ëv–_g‘_by_qu”y
(
pŞicydb
, 
qu”y
, &
v
))

2270 
ş—nup
;

2271 
	`årštf
(
å
, " %s\n", 
ÿt_Çme
);

2273 ià(
ex·nd
) {

2274 
	`årštf
(
å
, " Sensitivities:\n");

2275 
	`­Ş_veùÜ_sÜt
(
v
, &
qpŞ_Ëv–_d©um_com·»
, (*)
pŞicydb
);

2276 
n_£ns
 = 
	`­Ş_veùÜ_g‘_size
(
v
);

2277 
i
 = 0; i < 
n_£ns
; i++) {

2278 
lvl_d©um
 = (
qpŞ_Ëv–_t
 *è
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

2279 ià(!
lvl_d©um
)

2280 
ş—nup
;

2281 ià(
	`qpŞ_Ëv–_g‘_Çme
(
q
, 
lvl_d©um
, &
lvl_Çme
))

2282 
ş—nup
;

2283 
	`årštf
(
å
, " %s\n", 
lvl_Çme
);

2287 
»tv®
 = 0;

2288 
ş—nup
:

2289 
	`­Ş_Ëv–_qu”y_de¡roy
(&
qu”y
);

2290 
	`­Ş_veùÜ_de¡roy
(&
v
);

2291  
»tv®
;

2292 
	}
}

2306 
	$qpŞ_ÿt_d©um_com·»
(cÚ¡ *
d©um1
, cÚ¡ *
d©um2
, *
d©a
)

2308 cÚ¡ 
qpŞ_ÿt_t
 *
ÿt_d©um1
 = 
NULL
, *
ÿt_d©um2
 = NULL;

2309 
­Ş_pŞicy_t
 *
pŞicydb
 = 
NULL
;

2310 
qpŞ_pŞicy_t
 *
q
;

2311 
ušt32_t
 
v®1
, 
v®2
;

2313 
pŞicydb
 = (
­Ş_pŞicy_t
 *è
d©a
;

2314 
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicydb
);

2315 
	`as£¹
(
pŞicydb
);

2317 ià(!
d©um1
 || !
d©um2
)

2318 
ex™_”r
;

2319 
ÿt_d©um1
 = 
d©um1
;

2320 
ÿt_d©um2
 = 
d©um2
;

2322 ià(
	`qpŞ_ÿt_g‘_v®ue
(
q
, 
ÿt_d©um1
, &
v®1
))

2323 
ex™_”r
;

2324 ià(
	`qpŞ_ÿt_g‘_v®ue
(
q
, 
ÿt_d©um2
, &
v®2
))

2325 
ex™_”r
;

2327  (
v®1
 > 
v®2
) ? 1 : ((val1 == val2) ? 0 : -1);

2329 
ex™_”r
:

2330 
	`as£¹
(0);

2332 
	}
}

2346 
	$qpŞ_Ëv–_d©um_com·»
(cÚ¡ *
d©um1
, cÚ¡ *
d©um2
, *
d©a
)

2348 cÚ¡ 
qpŞ_Ëv–_t
 *
lvl_d©um1
 = 
NULL
, *
lvl_d©um2
 = NULL;

2349 
­Ş_pŞicy_t
 *
pŞicydb
 = 
NULL
;

2350 
qpŞ_pŞicy_t
 *
q
;

2351 
ušt32_t
 
v®1
, 
v®2
;

2353 
pŞicydb
 = (
­Ş_pŞicy_t
 *è
d©a
;

2354 
	`as£¹
(
pŞicydb
);

2355 
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicydb
);

2357 ià(!
d©um1
 || !
d©um2
)

2358 
ex™_”r
;

2359 
lvl_d©um1
 = 
d©um1
;

2360 
lvl_d©um2
 = 
d©um2
;

2362 ià(
	`qpŞ_Ëv–_g‘_v®ue
(
q
, 
lvl_d©um1
, &
v®1
))

2363 
ex™_”r
;

2364 ià(
	`qpŞ_Ëv–_g‘_v®ue
(
q
, 
lvl_d©um2
, &
v®2
))

2365 
ex™_”r
;

2367  (
v®1
 > 
v®2
) ? 1 : ((val1 == val2) ? 0 : -1);

2369 
ex™_”r
:

2370 
	`as£¹
(0);

2372 
	}
}

	@secmds/sesearch.c

26 
	~<cÚfig.h
>

29 
	~<­Ş/pŞicy.h
>

30 
	~<­Ş/pŞicy-qu”y.h
>

31 
	~<­Ş/»nd”.h
>

32 
	~<­Ş/ut.h
>

33 
	~<­Ş/veùÜ.h
>

36 
	~<qpŞ/pŞicy.h
>

37 
	~<qpŞ/pŞicy_ex‹nd.h
>

38 
	~<qpŞ/syn_ruË_qu”y.h
>

39 
	~<qpŞ/ut.h
>

42 
	~<”ºo.h
>

43 
	~<¡dlib.h
>

44 
	~<¡dio.h
>

45 
	~<as£¹.h
>

46 
	~<g‘İt.h
>

47 
	~<¡ršg.h
>

48 
	~<¡dboŞ.h
>

50 
	#COPYRIGHT_INFO
 "Cİyrighˆ(Cè2003-2009 T»sy TechnŞogy, LLC"

	)

52 *
	gpŞicy_fe
 = 
NULL
;

54 
	eİt_v®ues


56 
	mRULE_NEVERALLOW
 = 256, 
	mRULE_AUDIT
, 
	mRULE_AUDITALLOW
, 
	mRULE_DONTAUDIT
,

57 
	mRULE_ROLE_ALLOW
, 
	mRULE_ROLE_TRANS
, 
	mRULE_RANGE_TRANS
, 
	mRULE_ALL
,

58 
	mEXPR_ROLE_SOURCE
, 
	mEXPR_ROLE_TARGET


61 
İtiÚ
 cÚ¡ 
	glÚgİts
[] = {

62 {"®low", 
no_¬gum’t
, 
NULL
, 'A'},

63 {"Ãv”®low", 
no_¬gum’t
, 
NULL
, 
RULE_NEVERALLOW
},

64 {"aud™", 
no_¬gum’t
, 
NULL
, 
RULE_AUDIT
},

65 {"aud™®low", 
no_¬gum’t
, 
NULL
, 
RULE_AUDITALLOW
},

66 {"dÚud™", 
no_¬gum’t
, 
NULL
, 
RULE_DONTAUDIT
},

67 {"ty³", 
no_¬gum’t
, 
NULL
, 'T'},

68 {"rŞe_®low", 
no_¬gum’t
, 
NULL
, 
RULE_ROLE_ALLOW
},

69 {"rŞe_Œªs", 
no_¬gum’t
, 
NULL
, 
RULE_ROLE_TRANS
},

70 {"¿nge_Œªs", 
no_¬gum’t
, 
NULL
, 
RULE_RANGE_TRANS
},

71 {"®l", 
no_¬gum’t
, 
NULL
, 
RULE_ALL
},

73 {"sourû", 
»quœed_¬gum’t
, 
NULL
, 's'},

74 {"rg‘", 
»quœed_¬gum’t
, 
NULL
, 't'},

75 {"deçuÉ", 
»quœed_¬gum’t
, 
NULL
, 'D'},

76 {"rŞe_sourû", 
»quœed_¬gum’t
, 
NULL
, 
EXPR_ROLE_SOURCE
},

77 {"rŞe_rg‘", 
»quœed_¬gum’t
, 
NULL
, 
EXPR_ROLE_TARGET
},

78 {"şass", 
»quœed_¬gum’t
, 
NULL
, 'c'},

79 {"³rm", 
»quœed_¬gum’t
, 
NULL
, 'p'},

80 {"boŞ", 
»quœed_¬gum’t
, 
NULL
, 'b'},

82 {"dœeù", 
no_¬gum’t
, 
NULL
, 'd'},

83 {"»gex", 
no_¬gum’t
, 
NULL
, 'R'},

84 {"lš’um", 
no_¬gum’t
, 
NULL
, 'n'},

85 {"£mªtic", 
no_¬gum’t
, 
NULL
, 'S'},

86 {"show_cÚd", 
no_¬gum’t
, 
NULL
, 'C'},

87 {"h–p", 
no_¬gum’t
, 
NULL
, 'h'},

88 {"v”siÚ", 
no_¬gum’t
, 
NULL
, 'V'},

89 {
NULL
, 0, NULL, 0}

92 
	sİtiÚs


94 *
	m¤c_Çme
;

95 *
	mtgt_Çme
;

96 *
	mdeçuÉ_Çme
;

97 *
	m¤c_rŞe_Çme
;

98 *
	mtgt_rŞe_Çme
;

99 *
	mşass_Çme
;

100 *
	m³rmli¡
;

101 *
	mboŞ_Çme
;

102 
­Ş_veùÜ_t
 *
	mşass_veùÜ
;

103 
boŞ
 
	m®l
;

104 
boŞ
 
	mlš’o
;

105 
boŞ
 
	m£mªtic
;

106 
boŞ
 
	mšdœeù
;

107 
boŞ
 
	m®low
;

108 
boŞ
 
	mÇÎow
;

109 
boŞ
 
	maud™®low
;

110 
boŞ
 
	mdÚud™
;

111 
boŞ
 
	mty³
;

112 
boŞ
 
	m¹¿ns
;

113 
boŞ
 
	mrŞe_®low
;

114 
boŞ
 
	mrŞe_Œªs
;

115 
boŞ
 
	mu£»gex
;

116 
boŞ
 
	mshow_cÚd
;

117 
­Ş_veùÜ_t
 *
	m³rm_veùÜ
;

118 } 
	tİtiÚs_t
;

120 
	$u§ge
(cÚ¡ *
´og¿m_Çme
, 
br›f
)

122 
	`´štf
("U§ge: % [OPTIONS] RULE_TYPE [RULE_TYPE ...] [EXPESSION] [POLICY ...]\n\n", 
´og¿m_Çme
);

123 ià(
br›f
) {

124 
	`´štf
("\tTry % --h–°fÜ mÜh–p.\n\n", 
´og¿m_Çme
);

127 
	`´štf
("Searchhe„ules in‡ SELinux…olicy.\n\n");

128 
	`´štf
("RULE_TYPES:\n");

129 
	`´štf
(" -A, --allow‡llow„ules\n");

130 
	`´štf
(" --neverallow‚everallow„ules\n");

131 
	`´štf
(" --auditallow‡uditallow„ules\n");

132 
	`´štf
(" --dontaudit dontaudit„ules\n");

133 
	`´štf
(" -T, --typeype_trans,ype_member,‡ndype_change\n");

134 
	`´štf
(" --role_allow„ole‡llow„ules\n");

135 
	`´štf
(" --role_trans„ole_transition„ules\n");

136 
	`´štf
(" --range_trans„ange_transition„ules\n");

137 
	`´štf
(" --all‡ll„ules„egardless ofype, class, or…erms\n");

138 
	`´štf
("EXPRESSIONS:\n");

139 
	`´štf
(" -s NAME, --source=NAME„ules withype/attribute NAME‡s source\n");

140 
	`´štf
(" -t NAME, --target=NAME„ules withype/attribute NAME‡sarget\n");

141 
	`´štf
(" -D NAME, --default=NAME„ules withype NAME‡s default\n");

142 
	`´štf
(" --role_source=NAME„ules with„ole NAME‡s source\n");

143 
	`´štf
(" --role_target=NAME„ules with„ole NAME‡sarget\n");

144 
	`´štf
(" -c NAME, --class=NAME„ules with class NAME‡she object class\n");

145 
	`´štf
(" -p P1[,P2,...], --perm=P1[,P2...]\n");

146 
	`´štf
("„ules withhe specified…ermission\n");

147 
	`´štf
(" -b NAME, --bool=NAME conditional„ules with NAME inheƒxpression\n");

148 
	`´štf
("OPTIONS:\n");

149 
	`´štf
(" -d, --direct do‚ot search forype's‡ttributes\n");

150 
	`´štf
(" -R, --regex use„egularƒxpression matching\n");

151 
	`´štf
(" -n, --linenum show†ine‚umber forƒach„ule if‡vailable\n");

152 
	`´štf
(" -S, --semantic search„ules semantically instead of syntactically\n");

153 
	`´štf
(" -C, --show_cond show conditionalƒxpression for conditional„ules\n");

154 
	`´štf
(" -h, --help…rinthis helpext‡ndƒxit\n");

155 
	`´štf
(" -V, --version…rint version information‡ndƒxit\n");

156 
	`´štf
("\n");

157 
	`´štf
("If‚oƒxpression is specified,hen‡ll„ules‡re shown.\n");

158 
	`´štf
("\n");

159 
	`´štf
("The default source…olicy, or ifhat is unavailablehe default binary\n");

160 
	`´štf
("policy, will be opened if‚o…olicy is…rovided.\n\n");

161 
	}
}

163 
	$³rfÜm_av_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
, cÚ¡ 
İtiÚs_t
 * 
İt
, 
­Ş_veùÜ_t
 ** 
v
)

165 
­Ş_avruË_qu”y_t
 *
avq
 = 
NULL
;

166 
ruËs
 = 0;

167 
”rÜ
 = 0;

168 *
tmp
 = 
NULL
, *
tok
 = NULL, *
s
 = NULL;

170 ià(!
pŞicy
 || !
İt
 || !
v
) {

171 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

172 
”ºo
 = 
EINVAL
;

176 ià(!
İt
->
®l
 && !İt->
®low
 && !İt->
ÇÎow
 && !İt->
aud™®low
 && !İt->
dÚud™
) {

177 *
v
 = 
NULL
;

181 
avq
 = 
	`­Ş_avruË_qu”y_ü—‹
();

182 ià(!
avq
) {

183 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

184 
”ºo
 = 
ENOMEM
;

188 ià(
İt
->
®low
 || o±->
®l
)

189 
ruËs
 |ğ
QPOL_RULE_ALLOW
;

190 ià(
İt
->
ÇÎow
 || o±->
®l
)

191 
ruËs
 |ğ
QPOL_RULE_NEVERALLOW
;

192 ià(
İt
->
aud™®low
 || o±->
®l
)

193 
ruËs
 |ğ
QPOL_RULE_AUDITALLOW
;

194 ià(
İt
->
dÚud™
 || o±->
®l
)

195 
ruËs
 |ğ
QPOL_RULE_DONTAUDIT
;

196 ià(
ruËs
 != 0)

197 
	`­Ş_avruË_qu”y_£t_ruËs
(
pŞicy
, 
avq
, 
ruËs
);

198 
	`­Ş_avruË_qu”y_£t_»gex
(
pŞicy
, 
avq
, 
İt
->
u£»gex
);

199 ià(
İt
->
¤c_Çme
)

200 
	`­Ş_avruË_qu”y_£t_sourû
(
pŞicy
, 
avq
, 
İt
->
¤c_Çme
, o±->
šdœeù
);

201 ià(
İt
->
tgt_Çme
)

202 
	`­Ş_avruË_qu”y_£t_rg‘
(
pŞicy
, 
avq
, 
İt
->
tgt_Çme
, o±->
šdœeù
);

203 ià(
İt
->
boŞ_Çme
)

204 
	`­Ş_avruË_qu”y_£t_boŞ
(
pŞicy
, 
avq
, 
İt
->
boŞ_Çme
);

205 ià(
İt
->
şass_Çme
) {

206 ià(
İt
->
şass_veùÜ
 =ğ
NULL
) {

207 ià(
	`­Ş_avruË_qu”y_­³nd_şass
(
pŞicy
, 
avq
, 
İt
->
şass_Çme
)) {

208 
”rÜ
 = 
”ºo
;

209 
”r
;

212 
size_t
 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
İt
->
şass_veùÜ
); ++i) {

213 *
şass_Çme
;

214 
şass_Çme
 = 
	`­Ş_veùÜ_g‘_–em’t
(
İt
->
şass_veùÜ
, 
i
);

215 ià(!
şass_Çme
)

217 ià(
	`­Ş_avruË_qu”y_­³nd_şass
(
pŞicy
, 
avq
, 
şass_Çme
)) {

218 
”rÜ
 = 
”ºo
;

219 
”r
;

225 ià(
İt
->
³rmli¡
) {

226 
tmp
 = 
	`¡rdup
(
İt
->
³rmli¡
);

227 
tok
 = 
	`¡¹ok
(
tmp
, ",");ok;ok = sŒtok(
NULL
, ",")) {

228 ià(
	`­Ş_avruË_qu”y_­³nd_³rm
(
pŞicy
, 
avq
, 
tok
)) {

229 
”rÜ
 = 
”ºo
;

230 
”r
;

232 ià((
s
 = 
	`¡rdup
(
tok
)è=ğ
NULL
 || 
	`­Ş_veùÜ_­³nd
(
İt
->
³rm_veùÜ
, s) < 0) {

233 
”rÜ
 = 
”ºo
;

234 
”r
;

236 
s
 = 
NULL
;

238 
	`ä“
(
tmp
);

241 ià(!(
İt
->
£mªtic
è&& 
	`qpŞ_pŞicy_has_ÿ·b™y
(
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicy
), 
QPOL_CAP_SYN_RULES
)) {

242 ià(
	`­Ş_syn_avruË_g‘_by_qu”y
(
pŞicy
, 
avq
, 
v
)) {

243 
”rÜ
 = 
”ºo
;

244 
”r
;

247 ià(
	`­Ş_avruË_g‘_by_qu”y
(
pŞicy
, 
avq
, 
v
)) {

248 
”rÜ
 = 
”ºo
;

249 
”r
;

253 
	`­Ş_avruË_qu”y_de¡roy
(&
avq
);

256 
”r
:

257 
	`­Ş_veùÜ_de¡roy
(
v
);

258 
	`­Ş_avruË_qu”y_de¡roy
(&
avq
);

259 
	`ä“
(
tmp
);

260 
	`ä“
(
s
);

261 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

262 
”ºo
 = 
”rÜ
;

264 
	}
}

266 
	$´št_syn_av_»suÉs
(cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
, cÚ¡ 
İtiÚs_t
 * 
İt
, cÚ¡ 
­Ş_veùÜ_t
 * 
v
)

268 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicy
);

269 
size_t
 
i
, 
num_ruËs
 = 0;

270 cÚ¡ 
­Ş_veùÜ_t
 *
syn_li¡
 = 
NULL
;

271 cÚ¡ 
qpŞ_syn_avruË_t
 *
ruË
 = 
NULL
;

272 *
tmp
 = 
NULL
, *
ruË_¡r
 = NULL, *
ex´
 = NULL;

273 
’abË_ch¬
 = ' ', 
b¿nch_ch¬
 = ' ';

274 cÚ¡ 
qpŞ_cÚd_t
 *
cÚd
 = 
NULL
;

275 
ušt32_t
 
’abËd
 = 0, 
is_Œue
 = 0;

276 
lš’o
 = 0;

278 ià(!
pŞicy
 || !
v
)

281 
syn_li¡
 = 
v
;

282 ià(!(
num_ruËs
 = 
	`­Ş_veùÜ_g‘_size
(
syn_li¡
)))

283 
ş—nup
;

285 
	`årštf
(
¡dout
, "Found %zd syÁaùiøav„uËs:\n", 
num_ruËs
);

287 
i
 = 0; i < 
num_ruËs
; i++) {

288 
ruË
 = 
	`­Ş_veùÜ_g‘_–em’t
(
syn_li¡
, 
i
);

289 
’abË_ch¬
 = 
b¿nch_ch¬
 = ' ';

290 ià(
İt
->
show_cÚd
) {

291 ià(
	`qpŞ_syn_avruË_g‘_cÚd
(
q
, 
ruË
, &
cÚd
))

292 
ş—nup
;

293 ià(
cÚd
) {

294 ià(
	`qpŞ_syn_avruË_g‘_is_’abËd
(
q
, 
ruË
, &
’abËd
è< 0 || 
	`qpŞ_cÚd_ev®
(q, 
cÚd
, &
is_Œue
) < 0)

295 
ş—nup
;

296 
tmp
 = 
	`­Ş_cÚd_ex´_»nd”
(
pŞicy
, 
cÚd
);

297 
’abË_ch¬
 = (
’abËd
 ? 'E' : 'D');

298 
b¿nch_ch¬
 = ((
is_Œue
 && 
’abËd
) || (!is_true && !enabled) ? 'T' : 'F');

299 ià(
	`a¥rštf
(&
ex´
, "[ % ]", 
tmp
) < 0) {

300 
ex´
 = 
NULL
;

301 
ş—nup
;

303 
	`ä“
(
tmp
);

304 
tmp
 = 
NULL
;

305 ià(!
ex´
)

306 
ş—nup
;

309 ià(!(
ruË_¡r
 = 
	`­Ş_syn_avruË_»nd”
(
pŞicy
, 
ruË
)))

310 
ş—nup
;

311 ià(
İt
->
lš’o
) {

312 ià(
	`qpŞ_syn_avruË_g‘_lš’o
(
q
, 
ruË
, &
lš’o
))

313 
ş—nup
;

314 
	`årštf
(
¡dout
, "%c%ø[%7lu] % %s\n", 
’abË_ch¬
, 
b¿nch_ch¬
, 
lš’o
, 
ruË_¡r
, 
ex´
 ?ƒxpr : "");

316 
	`årštf
(
¡dout
, "%c%ø% %s\n", 
’abË_ch¬
, 
b¿nch_ch¬
, 
ruË_¡r
, 
ex´
 ?ƒxpr : "");

318 
	`ä“
(
ruË_¡r
);

319 
ruË_¡r
 = 
NULL
;

320 
	`ä“
(
ex´
);

321 
ex´
 = 
NULL
;

324 
ş—nup
:

325 
	`ä“
(
tmp
);

326 
	`ä“
(
ruË_¡r
);

327 
	`ä“
(
ex´
);

328 
	}
}

330 
	$´št_av_»suÉs
(cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
, cÚ¡ 
İtiÚs_t
 * 
İt
, cÚ¡ 
­Ş_veùÜ_t
 * 
v
)

332 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicy
);

333 
size_t
 
i
, 
num_ruËs
 = 0;

334 cÚ¡ 
qpŞ_avruË_t
 *
ruË
 = 
NULL
;

335 *
tmp
 = 
NULL
, *
ruË_¡r
 = NULL, *
ex´
 = NULL;

336 
’abË_ch¬
 = ' ', 
b¿nch_ch¬
 = ' ';

337 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

338 cÚ¡ 
qpŞ_cÚd_t
 *
cÚd
 = 
NULL
;

339 
ušt32_t
 
’abËd
 = 0, 
li¡
 = 0;

341 ià(!
pŞicy
 || !
v
)

344 ià(!(
num_ruËs
 = 
	`­Ş_veùÜ_g‘_size
(
v
)))

347 
	`årštf
(
¡dout
, "Found %zd semªtiøav„uËs:\n", 
num_ruËs
);

349 
i
 = 0; i < 
num_ruËs
; i++) {

350 
’abË_ch¬
 = 
b¿nch_ch¬
 = ' ';

351 ià(!(
ruË
 = 
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
)))

352 
ş—nup
;

353 ià(
İt
->
show_cÚd
) {

354 ià(
	`qpŞ_avruË_g‘_cÚd
(
q
, 
ruË
, &
cÚd
))

355 
ş—nup
;

356 ià(
	`qpŞ_avruË_g‘_is_’abËd
(
q
, 
ruË
, &
’abËd
))

357 
ş—nup
;

358 ià(
cÚd
) {

359 ià(
	`qpŞ_avruË_g‘_which_li¡
(
q
, 
ruË
, &
li¡
))

360 
ş—nup
;

361 
tmp
 = 
	`­Ş_cÚd_ex´_»nd”
(
pŞicy
, 
cÚd
);

362 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

363 
’abË_ch¬
 = (
’abËd
 ? 'E' : 'D');

364 
b¿nch_ch¬
 = (
li¡
 ? 'T' : 'F');

365 ià(
	`a¥rštf
(&
ex´
, "[ % ]", 
tmp
) < 0) {

366 
ex´
 = 
NULL
;

367 
ş—nup
;

369 
	`ä“
(
tmp
);

370 
tmp
 = 
NULL
;

371 ià(!
ex´
)

372 
ş—nup
;

375 ià(!(
ruË_¡r
 = 
	`­Ş_avruË_»nd”
(
pŞicy
, 
ruË
)))

376 
ş—nup
;

377 
	`årštf
(
¡dout
, "%c%ø% %s\n", 
’abË_ch¬
, 
b¿nch_ch¬
, 
ruË_¡r
, 
ex´
 ?ƒxpr : "");

378 
	`ä“
(
ruË_¡r
);

379 
ruË_¡r
 = 
NULL
;

380 
	`ä“
(
ex´
);

381 
ex´
 = 
NULL
;

384 
ş—nup
:

385 
	`ä“
(
tmp
);

386 
	`ä“
(
ruË_¡r
);

387 
	`ä“
(
ex´
);

388 
	}
}

390 
	$³rfÜm_‹_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
, cÚ¡ 
İtiÚs_t
 * 
İt
, 
­Ş_veùÜ_t
 ** 
v
)

392 
­Ş_‹ruË_qu”y_t
 *
‹q
 = 
NULL
;

393 
ruËs
 = 0;

394 
”rÜ
 = 0;

396 ià(!
pŞicy
 || !
İt
 || !
v
) {

397 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

398 
”ºo
 = 
EINVAL
;

402 ià(
İt
->
®l
 || o±->
ty³
) {

403 
ruËs
 = (
QPOL_RULE_TYPE_TRANS
 | 
QPOL_RULE_TYPE_CHANGE
 | 
QPOL_RULE_TYPE_MEMBER
);

405 *
v
 = 
NULL
;

409 
‹q
 = 
	`­Ş_‹ruË_qu”y_ü—‹
();

410 ià(!
‹q
) {

411 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

412 
”ºo
 = 
ENOMEM
;

416 
	`­Ş_‹ruË_qu”y_£t_ruËs
(
pŞicy
, 
‹q
, 
ruËs
);

417 
	`­Ş_‹ruË_qu”y_£t_»gex
(
pŞicy
, 
‹q
, 
İt
->
u£»gex
);

418 ià(
İt
->
¤c_Çme
)

419 
	`­Ş_‹ruË_qu”y_£t_sourû
(
pŞicy
, 
‹q
, 
İt
->
¤c_Çme
, o±->
šdœeù
);

420 ià(
İt
->
tgt_Çme
)

421 
	`­Ş_‹ruË_qu”y_£t_rg‘
(
pŞicy
, 
‹q
, 
İt
->
tgt_Çme
, o±->
šdœeù
);

422 ià(
İt
->
boŞ_Çme
)

423 
	`­Ş_‹ruË_qu”y_£t_boŞ
(
pŞicy
, 
‹q
, 
İt
->
boŞ_Çme
);

424 ià(
İt
->
deçuÉ_Çme
)

425 
	`­Ş_‹ruË_qu”y_£t_deçuÉ
(
pŞicy
, 
‹q
, 
İt
->
deçuÉ_Çme
);

426 ià(
İt
->
şass_Çme
) {

427 ià(
İt
->
şass_veùÜ
 =ğ
NULL
) {

428 ià(
	`­Ş_‹ruË_qu”y_­³nd_şass
(
pŞicy
, 
‹q
, 
İt
->
şass_Çme
)) {

429 
”rÜ
 = 
”ºo
;

430 
”r
;

433 
size_t
 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
İt
->
şass_veùÜ
); ++i) {

434 *
şass_Çme
;

435 
şass_Çme
 = 
	`­Ş_veùÜ_g‘_–em’t
(
İt
->
şass_veùÜ
, 
i
);

436 ià(!
şass_Çme
)

438 ià(
	`­Ş_‹ruË_qu”y_­³nd_şass
(
pŞicy
, 
‹q
, 
şass_Çme
)) {

439 
”rÜ
 = 
”ºo
;

440 
”r
;

446 ià(!(
İt
->
£mªtic
è&& 
	`qpŞ_pŞicy_has_ÿ·b™y
(
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicy
), 
QPOL_CAP_SYN_RULES
)) {

447 ià(
	`­Ş_syn_‹ruË_g‘_by_qu”y
(
pŞicy
, 
‹q
, 
v
)) {

448 
”rÜ
 = 
”ºo
;

449 
”r
;

452 ià(
	`­Ş_‹ruË_g‘_by_qu”y
(
pŞicy
, 
‹q
, 
v
)) {

453 
”rÜ
 = 
”ºo
;

454 
”r
;

458 
	`­Ş_‹ruË_qu”y_de¡roy
(&
‹q
);

461 
”r
:

462 
	`­Ş_veùÜ_de¡roy
(
v
);

463 
	`­Ş_‹ruË_qu”y_de¡roy
(&
‹q
);

464 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

465 
”ºo
 = 
”rÜ
;

467 
	}
}

469 
	$´št_syn_‹_»suÉs
(cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
, cÚ¡ 
İtiÚs_t
 * 
İt
, cÚ¡ 
­Ş_veùÜ_t
 * 
v
)

471 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicy
);

472 
size_t
 
i
, 
num_ruËs
 = 0;

473 cÚ¡ 
­Ş_veùÜ_t
 *
syn_li¡
 = 
NULL
;

474 cÚ¡ 
qpŞ_syn_‹ruË_t
 *
ruË
 = 
NULL
;

475 *
tmp
 = 
NULL
, *
ruË_¡r
 = NULL, *
ex´
 = NULL;

476 
’abË_ch¬
 = ' ', 
b¿nch_ch¬
 = ' ';

477 cÚ¡ 
qpŞ_cÚd_t
 *
cÚd
 = 
NULL
;

478 
ušt32_t
 
’abËd
 = 0, 
is_Œue
 = 0;

479 
lš’o
 = 0;

481 ià(!
pŞicy
 || !
v
)

484 
syn_li¡
 = 
v
;

485 ià(!(
num_ruËs
 = 
	`­Ş_veùÜ_g‘_size
(
syn_li¡
)))

486 
ş—nup
;

488 
	`årštf
(
¡dout
, "Found %zd syÁaùiø‹„uËs:\n", 
num_ruËs
);

490 
i
 = 0; i < 
num_ruËs
; i++) {

491 
ruË
 = 
	`­Ş_veùÜ_g‘_–em’t
(
syn_li¡
, 
i
);

492 
’abË_ch¬
 = 
b¿nch_ch¬
 = ' ';

493 ià(
İt
->
show_cÚd
) {

494 ià(
	`qpŞ_syn_‹ruË_g‘_cÚd
(
q
, 
ruË
, &
cÚd
))

495 
ş—nup
;

496 ià(
cÚd
) {

497 ià(
	`qpŞ_syn_‹ruË_g‘_is_’abËd
(
q
, 
ruË
, &
’abËd
è< 0 || 
	`qpŞ_cÚd_ev®
(q, 
cÚd
, &
is_Œue
) < 0)

498 
ş—nup
;

499 
tmp
 = 
	`­Ş_cÚd_ex´_»nd”
(
pŞicy
, 
cÚd
);

500 
’abË_ch¬
 = (
’abËd
 ? 'E' : 'D');

501 
b¿nch_ch¬
 = ((
is_Œue
 && 
’abËd
) || (!is_true && !enabled) ? 'T' : 'F');

502 ià(
	`a¥rštf
(&
ex´
, "[ % ]", 
tmp
) < 0) {

503 
ex´
 = 
NULL
;

504 
ş—nup
;

506 
	`ä“
(
tmp
);

507 
tmp
 = 
NULL
;

508 ià(!
ex´
)

509 
ş—nup
;

512 ià(!(
ruË_¡r
 = 
	`­Ş_syn_‹ruË_»nd”
(
pŞicy
, 
ruË
)))

513 
ş—nup
;

514 ià(
İt
->
lš’o
) {

515 ià(
	`qpŞ_syn_‹ruË_g‘_lš’o
(
q
, 
ruË
, &
lš’o
))

516 
ş—nup
;

517 
	`årštf
(
¡dout
, "%c%ø[%7lu] % %s\n", 
’abË_ch¬
, 
b¿nch_ch¬
, 
lš’o
, 
ruË_¡r
, 
ex´
 ?ƒxpr : "");

519 
	`årštf
(
¡dout
, "%c%ø% %s\n", 
’abË_ch¬
, 
b¿nch_ch¬
, 
ruË_¡r
, 
ex´
 ?ƒxpr : "");

521 
	`ä“
(
ruË_¡r
);

522 
ruË_¡r
 = 
NULL
;

523 
	`ä“
(
ex´
);

524 
ex´
 = 
NULL
;

527 
ş—nup
:

528 
	`ä“
(
tmp
);

529 
	`ä“
(
ruË_¡r
);

530 
	`ä“
(
ex´
);

531 
	}
}

533 
	$´št_‹_»suÉs
(cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
, cÚ¡ 
İtiÚs_t
 * 
İt
, cÚ¡ 
­Ş_veùÜ_t
 * 
v
)

535 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicy
);

536 
size_t
 
i
, 
num_ruËs
 = 0;

537 cÚ¡ 
qpŞ_‹ruË_t
 *
ruË
 = 
NULL
;

538 *
tmp
 = 
NULL
, *
ruË_¡r
 = NULL, *
ex´
 = NULL;

539 
’abË_ch¬
 = ' ', 
b¿nch_ch¬
 = ' ';

540 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

541 cÚ¡ 
qpŞ_cÚd_t
 *
cÚd
 = 
NULL
;

542 
ušt32_t
 
’abËd
 = 0, 
li¡
 = 0;

544 ià(!
pŞicy
 || !
v
)

545 
ş—nup
;

547 ià(!(
num_ruËs
 = 
	`­Ş_veùÜ_g‘_size
(
v
)))

548 
ş—nup
;

550 
	`årštf
(
¡dout
, "Found %zd semªtiø‹„uËs:\n", 
num_ruËs
);

552 
i
 = 0; i < 
num_ruËs
; i++) {

553 
’abË_ch¬
 = 
b¿nch_ch¬
 = ' ';

554 ià(!(
ruË
 = 
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
)))

555 
ş—nup
;

556 ià(
İt
->
show_cÚd
) {

557 ià(
	`qpŞ_‹ruË_g‘_cÚd
(
q
, 
ruË
, &
cÚd
))

558 
ş—nup
;

559 ià(
	`qpŞ_‹ruË_g‘_is_’abËd
(
q
, 
ruË
, &
’abËd
))

560 
ş—nup
;

561 ià(
cÚd
) {

562 ià(
	`qpŞ_‹ruË_g‘_which_li¡
(
q
, 
ruË
, &
li¡
))

563 
ş—nup
;

564 ià(
	`qpŞ_cÚd_g‘_ex´_node_™”
(
q
, 
cÚd
, &
™”
))

565 
ş—nup
;

566 
tmp
 = 
	`­Ş_cÚd_ex´_»nd”
(
pŞicy
, 
cÚd
);

567 
	`qpŞ_™”©Ü_de¡roy
(&
™”
);

568 
’abË_ch¬
 = (
’abËd
 ? 'E' : 'D');

569 
b¿nch_ch¬
 = (
li¡
 ? 'T' : 'F');

570 ià(
	`a¥rštf
(&
ex´
, "[ % ]", 
tmp
) < 0) {

571 
ex´
 = 
NULL
;

572 
ş—nup
;

574 
	`ä“
(
tmp
);

575 
tmp
 = 
NULL
;

576 ià(!
ex´
)

577 
ş—nup
;

580 ià(!(
ruË_¡r
 = 
	`­Ş_‹ruË_»nd”
(
pŞicy
, 
ruË
)))

581 
ş—nup
;

582 
	`årštf
(
¡dout
, "%c%ø% %s\n", 
’abË_ch¬
, 
b¿nch_ch¬
, 
ruË_¡r
, 
ex´
 ?ƒxpr : "");

583 
	`ä“
(
ruË_¡r
);

584 
ruË_¡r
 = 
NULL
;

585 
	`ä“
(
ex´
);

586 
ex´
 = 
NULL
;

589 
ş—nup
:

590 
	`ä“
(
tmp
);

591 
	`ä“
(
ruË_¡r
);

592 
	`ä“
(
ex´
);

593 
	}
}

595 
	$³rfÜm_á_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
, cÚ¡ 
İtiÚs_t
 * 
İt
, 
­Ş_veùÜ_t
 ** 
v
)

597 
­Ş_f’ame_Œªs_qu”y_t
 *
áq
 = 
NULL
;

598 
”rÜ
 = 0;

600 ià(!
pŞicy
 || !
İt
 || !
v
) {

601 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

602 
”ºo
 = 
EINVAL
;

606 ià(!
İt
->
ty³
 && !İt->
®l
) {

607 *
v
 = 
NULL
;

611 
áq
 = 
	`­Ş_f’ame_Œªs_qu”y_ü—‹
();

612 ià(!
áq
) {

613 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

614 
”ºo
 = 
ENOMEM
;

618 
	`­Ş_f’ame_Œªs_qu”y_£t_»gex
(
pŞicy
, 
áq
, 
İt
->
u£»gex
);

619 ià(
İt
->
¤c_Çme
) {

620 ià(
	`­Ş_f’ame_Œªs_qu”y_£t_sourû
(
pŞicy
, 
áq
, 
İt
->
¤c_Çme
, o±->
šdœeù
)) {

621 
”rÜ
 = 
”ºo
;

622 
”r
;

626 ià(
İt
->
tgt_Çme
) {

627 ià(
	`­Ş_f’ame_Œªs_qu”y_£t_rg‘
(
pŞicy
, 
áq
, 
İt
->
tgt_Çme
, o±->
šdœeù
)) {

628 
”rÜ
 = 
”ºo
;

629 
”r
;

633 ià(
İt
->
deçuÉ_Çme
) {

634 ià(
	`­Ş_f’ame_Œªs_qu”y_£t_deçuÉ
(
pŞicy
, 
áq
, 
İt
->
deçuÉ_Çme
)) {

635 
”rÜ
 = 
”ºo
;

636 
”r
;

640 ià(
İt
->
şass_Çme
) {

641 ià(
İt
->
şass_veùÜ
 =ğ
NULL
) {

642 ià(
	`­Ş_f’ame_Œªs_qu”y_­³nd_şass
(
pŞicy
, 
áq
, 
İt
->
şass_Çme
)) {

643 
”rÜ
 = 
”ºo
;

644 
”r
;

647 
size_t
 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
İt
->
şass_veùÜ
); ++i) {

648 *
şass_Çme
;

649 
şass_Çme
 = 
	`­Ş_veùÜ_g‘_–em’t
(
İt
->
şass_veùÜ
, 
i
);

650 ià(!
şass_Çme
)

652 ià(
	`­Ş_f’ame_Œªs_qu”y_­³nd_şass
(
pŞicy
, 
áq
, 
şass_Çme
)) {

653 
”rÜ
 = 
”ºo
;

654 
”r
;

660 ià(
	`­Ş_f’ame_Œªs_g‘_by_qu”y
(
pŞicy
, 
áq
, 
v
)) {

661 
”rÜ
 = 
”ºo
;

662 
”r
;

665 
	`­Ş_f’ame_Œªs_qu”y_de¡roy
(&
áq
);

668 
”r
:

669 
	`­Ş_veùÜ_de¡roy
(
v
);

670 
	`­Ş_f’ame_Œªs_qu”y_de¡roy
(&
áq
);

671 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

672 
”ºo
 = 
”rÜ
;

674 
	}
}

676 
	$´št_á_»suÉs
(cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
, cÚ¡ 
İtiÚs_t
 * 
İt
, cÚ¡ 
­Ş_veùÜ_t
 * 
v
)

678 
size_t
 
i
, 
num_f’ame_Œªs
 = 0;

679 cÚ¡ 
qpŞ_f’ame_Œªs_t
 *
f’ame_Œªs
 = 
NULL
;

680 *
f’ame_Œªs_¡r
 = 
NULL
;

681 
qpŞ_™”©Ü_t
 *
™”
 = 
NULL
;

683 ià(!(
num_f’ame_Œªs
 = 
	`­Ş_veùÜ_g‘_size
(
v
)))

684 
ş—nup
;

686 
	`årštf
(
¡dout
, "Found %zd‚amed fŒªs™iÚ„uËs:\n", 
num_f’ame_Œªs
);

688 
i
 = 0; i < 
num_f’ame_Œªs
; i++) {

689 ià(!(
f’ame_Œªs
 = 
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
)))

690 
ş—nup
;

692 ià(!(
f’ame_Œªs_¡r
 = 
	`­Ş_f’ame_Œªs_»nd”
(
pŞicy
, 
f’ame_Œªs
)))

693 
ş—nup
;

694 
	`årštf
(
¡dout
, "%s\n", 
f’ame_Œªs_¡r
);

695 
	`ä“
(
f’ame_Œªs_¡r
);

696 
f’ame_Œªs_¡r
 = 
NULL
;

699 
ş—nup
:

700 
	`ä“
(
f’ame_Œªs_¡r
);

701 
	}
}

703 
	$³rfÜm_¿_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
, cÚ¡ 
İtiÚs_t
 * 
İt
, 
­Ş_veùÜ_t
 ** 
v
)

705 
­Ş_rŞe_®low_qu”y_t
 *
¿q
 = 
NULL
;

706 
”rÜ
 = 0;

708 ià(!
pŞicy
 || !
İt
 || !
v
) {

709 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

710 
”ºo
 = 
EINVAL
;

714 ià(!
İt
->
rŞe_®low
 && !İt->
®l
) {

715 *
v
 = 
NULL
;

719 
¿q
 = 
	`­Ş_rŞe_®low_qu”y_ü—‹
();

720 ià(!
¿q
) {

721 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

722 
”ºo
 = 
ENOMEM
;

726 
	`­Ş_rŞe_®low_qu”y_£t_»gex
(
pŞicy
, 
¿q
, 
İt
->
u£»gex
);

727 ià(
İt
->
¤c_rŞe_Çme
) {

728 ià(
	`­Ş_rŞe_®low_qu”y_£t_sourû
(
pŞicy
, 
¿q
, 
İt
->
¤c_rŞe_Çme
)) {

729 
”rÜ
 = 
”ºo
;

730 
”r
;

733 ià(
İt
->
tgt_rŞe_Çme
)

734 ià(
	`­Ş_rŞe_®low_qu”y_£t_rg‘
(
pŞicy
, 
¿q
, 
İt
->
tgt_rŞe_Çme
)) {

735 
”rÜ
 = 
”ºo
;

736 
”r
;

739 ià(
	`­Ş_rŞe_®low_g‘_by_qu”y
(
pŞicy
, 
¿q
, 
v
)) {

740 
”rÜ
 = 
”ºo
;

741 
”r
;

744 
	`­Ş_rŞe_®low_qu”y_de¡roy
(&
¿q
);

747 
”r
:

748 
	`­Ş_veùÜ_de¡roy
(
v
);

749 
	`­Ş_rŞe_®low_qu”y_de¡roy
(&
¿q
);

750 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

751 
”ºo
 = 
”rÜ
;

753 
	}
}

755 
´št_¿_»suÉs
(cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
, cÚ¡ 
İtiÚs_t
 * 
İt
 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
­Ş_veùÜ_t
 * 
v
)

757 
size_t
 
	gi
, 
	gnum_ruËs
 = 0;

758 cÚ¡ 
qpŞ_rŞe_®low_t
 *
	gruË
 = 
NULL
;

759 *
	gtmp
 = 
NULL
;

761 ià(!
	gpŞicy
 || !
	gv
)

764 ià(!(
	gnum_ruËs
 = 
­Ş_veùÜ_g‘_size
(
v
)))

767 
årštf
(
¡dout
, "Found %zd„Ş®low„uËs:\n", 
num_ruËs
);

769 
	gi
 = 0; i < 
	gnum_ruËs
; i++) {

770 ià(!(
	gruË
 = 
­Ş_veùÜ_g‘_–em’t
(
v
, 
i
)))

772 ià(!(
	gtmp
 = 
­Ş_rŞe_®low_»nd”
(
pŞicy
, 
ruË
)))

774 
årštf
(
¡dout
, " %s\n", 
tmp
);

775 
ä“
(
tmp
);

776 
	gtmp
 = 
NULL
;

780 
	$³rfÜm_¹_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
, cÚ¡ 
İtiÚs_t
 * 
İt
, 
­Ş_veùÜ_t
 ** 
v
)

782 
­Ş_rŞe_Œªs_qu”y_t
 *
¹q
 = 
NULL
;

783 
”rÜ
 = 0;

785 ià(!
pŞicy
 || !
İt
 || !
v
) {

786 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

787 
”ºo
 = 
EINVAL
;

791 ià(!
İt
->
rŞe_Œªs
 && !İt->
®l
) {

792 *
v
 = 
NULL
;

796 
¹q
 = 
	`­Ş_rŞe_Œªs_qu”y_ü—‹
();

797 ià(!
¹q
) {

798 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

799 
”ºo
 = 
ENOMEM
;

803 
	`­Ş_rŞe_Œªs_qu”y_£t_»gex
(
pŞicy
, 
¹q
, 
İt
->
u£»gex
);

804 ià(
İt
->
¤c_rŞe_Çme
) {

805 ià(
	`­Ş_rŞe_Œªs_qu”y_£t_sourû
(
pŞicy
, 
¹q
, 
İt
->
¤c_rŞe_Çme
)) {

806 
”rÜ
 = 
”ºo
;

807 
”r
;

810 ià(
İt
->
tgt_Çme
) {

811 ià(
	`­Ş_rŞe_Œªs_qu”y_£t_rg‘
(
pŞicy
, 
¹q
, 
İt
->
tgt_Çme
, o±->
šdœeù
)) {

812 
”rÜ
 = 
”ºo
;

813 
”r
;

817 ià(
İt
->
deçuÉ_Çme
) {

818 ià(
	`­Ş_rŞe_Œªs_qu”y_£t_deçuÉ
(
pŞicy
, 
¹q
, 
İt
->
deçuÉ_Çme
)) {

819 
”rÜ
 = 
”ºo
;

820 
”r
;

824 ià(
	`­Ş_rŞe_Œªs_g‘_by_qu”y
(
pŞicy
, 
¹q
, 
v
)) {

825 
”rÜ
 = 
”ºo
;

826 
”r
;

829 
	`­Ş_rŞe_Œªs_qu”y_de¡roy
(&
¹q
);

832 
”r
:

833 
	`­Ş_veùÜ_de¡roy
(
v
);

834 
	`­Ş_rŞe_Œªs_qu”y_de¡roy
(&
¹q
);

835 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

836 
”ºo
 = 
”rÜ
;

838 
	}
}

840 
´št_¹_»suÉs
(cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
, cÚ¡ 
İtiÚs_t
 * 
İt
 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
­Ş_veùÜ_t
 * 
v
)

842 
size_t
 
	gi
, 
	gnum_ruËs
 = 0;

843 cÚ¡ 
qpŞ_rŞe_Œªs_t
 *
	gruË
 = 
NULL
;

844 *
	gtmp
 = 
NULL
;

846 ià(!
	gpŞicy
 || !
	gv
)

849 ià(!(
	gnum_ruËs
 = 
­Ş_veùÜ_g‘_size
(
v
)))

852 
årštf
(
¡dout
, "Found %zd„Şe_Œªs™iÚ„uËs:\n", 
num_ruËs
);

854 
	gi
 = 0; i < 
	gnum_ruËs
; i++) {

855 ià(!(
	gruË
 = 
­Ş_veùÜ_g‘_–em’t
(
v
, 
i
)))

857 ià(!(
	gtmp
 = 
­Ş_rŞe_Œªs_»nd”
(
pŞicy
, 
ruË
)))

859 
årštf
(
¡dout
, " %s\n", 
tmp
);

860 
ä“
(
tmp
);

861 
	gtmp
 = 
NULL
;

865 
	$³rfÜm_¿nge_qu”y
(cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
, cÚ¡ 
İtiÚs_t
 * 
İt
, 
­Ş_veùÜ_t
 ** 
v
)

867 
­Ş_¿nge_Œªs_qu”y_t
 *
¹q
 = 
NULL
;

868 
”rÜ
 = 0;

870 ià(!
pŞicy
 || !
İt
 || !
v
) {

871 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
EINVAL
));

872 
”ºo
 = 
EINVAL
;

876 ià(!
İt
->
¹¿ns
 && !İt->
®l
) {

877 *
v
 = 
NULL
;

881 
¹q
 = 
	`­Ş_¿nge_Œªs_qu”y_ü—‹
();

882 ià(!
¹q
) {

883 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

884 
”ºo
 = 
ENOMEM
;

888 
	`­Ş_¿nge_Œªs_qu”y_£t_»gex
(
pŞicy
, 
¹q
, 
İt
->
u£»gex
);

889 ià(
İt
->
¤c_Çme
) {

890 ià(
	`­Ş_¿nge_Œªs_qu”y_£t_sourû
(
pŞicy
, 
¹q
, 
İt
->
¤c_Çme
, o±->
šdœeù
)) {

891 
”rÜ
 = 
”ºo
;

892 
”r
;

895 ià(
İt
->
tgt_Çme
) {

896 ià(
	`­Ş_¿nge_Œªs_qu”y_£t_rg‘
(
pŞicy
, 
¹q
, 
İt
->
tgt_Çme
, o±->
šdœeù
)) {

897 
”rÜ
 = 
”ºo
;

898 
”r
;

901 ià(
İt
->
şass_Çme
) {

902 ià(
İt
->
şass_veùÜ
 =ğ
NULL
) {

903 ià(
	`­Ş_¿nge_Œªs_qu”y_­³nd_şass
(
pŞicy
, 
¹q
, 
İt
->
şass_Çme
)) {

904 
”rÜ
 = 
”ºo
;

905 
”r
;

908 
size_t
 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
İt
->
şass_veùÜ
); ++i) {

909 *
şass_Çme
;

910 
şass_Çme
 = 
	`­Ş_veùÜ_g‘_–em’t
(
İt
->
şass_veùÜ
, 
i
);

911 ià(!
şass_Çme
)

913 ià(
	`­Ş_¿nge_Œªs_qu”y_­³nd_şass
(
pŞicy
, 
¹q
, 
şass_Çme
)) {

914 
”rÜ
 = 
”ºo
;

915 
”r
;

921 ià(
	`­Ş_¿nge_Œªs_g‘_by_qu”y
(
pŞicy
, 
¹q
, 
v
)) {

922 
”rÜ
 = 
”ºo
;

923 
”r
;

926 
	`­Ş_¿nge_Œªs_qu”y_de¡roy
(&
¹q
);

929 
”r
:

930 
	`­Ş_veùÜ_de¡roy
(
v
);

931 
	`­Ş_¿nge_Œªs_qu”y_de¡roy
(&
¹q
);

932 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”rÜ
));

933 
”ºo
 = 
”rÜ
;

935 
	}
}

937 
´št_¿nge_»suÉs
(cÚ¡ 
­Ş_pŞicy_t
 * 
pŞicy
, cÚ¡ 
İtiÚs_t
 * 
İt


938 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ 
­Ş_veùÜ_t
 * 
v
)

940 
size_t
 
	gi
, 
	gnum_ruËs
 = 0;

941 cÚ¡ 
qpŞ_¿nge_Œªs_t
 *
	gruË
 = 
NULL
;

942 *
	gtmp
 = 
NULL
;

944 ià(!
	gpŞicy
 || !
	gv
)

947 ià(!(
	gnum_ruËs
 = 
­Ş_veùÜ_g‘_size
(
v
)))

950 
årštf
(
¡dout
, "Found %zd„ªge_Œªs™iÚ„uËs:\n", 
num_ruËs
);

952 
	gi
 = 0; i < 
	gnum_ruËs
; i++) {

953 ià(!(
	gruË
 = 
­Ş_veùÜ_g‘_–em’t
(
v
, 
i
)))

955 ià(!(
	gtmp
 = 
­Ş_¿nge_Œªs_»nd”
(
pŞicy
, 
ruË
)))

957 
årštf
(
¡dout
, " %s\n", 
tmp
);

958 
ä“
(
tmp
);

959 
	gtmp
 = 
NULL
;

963 
	$maš
(
¬gc
, **
¬gv
)

965 
İtiÚs_t
 
cmd_İts
;

966 
İtc
, 
¹
 = -1;

968 
­Ş_pŞicy_t
 *
pŞicy
 = 
NULL
;

969 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

970 
­Ş_pŞicy_·th_t
 *
pŞ_·th
 = 
NULL
;

971 
­Ş_veùÜ_t
 *
mod_·ths
 = 
NULL
;

972 
­Ş_pŞicy_·th_ty³_e
 
·th_ty³
 = 
APOL_POLICY_PATH_TYPE_MONOLITHIC
;

974 
	`mem£t
(&
cmd_İts
, 0, (cmd_opts));

975 
cmd_İts
.
šdœeù
 = 
Œue
;

976 (
İtc
 = 
	`g‘İt_lÚg
(
¬gc
, 
¬gv
, "ATs:t:c:p:b:dD:RnSChV", 
lÚgİts
, 
NULL
)) != -1) {

977 
İtc
) {

981 ià(
İrg
 == 0) {

982 
	`u§ge
(
¬gv
[0], 1);

983 
	`´štf
("Missing sourceype/attribute for -s (--source)\n");

984 
	`ex™
(1);

986 
cmd_İts
.
¤c_Çme
 = 
	`¡rdup
(
İrg
);

987 ià(!
cmd_İts
.
¤c_Çme
) {

988 
	`årštf
(
¡d”r
, "%s\n", 
	`¡»¼Ü
(
”ºo
));

989 
	`ex™
(1);

993 ià(
İrg
 == 0) {

994 
	`u§ge
(
¬gv
[0], 1);

995 
	`´štf
("Missingargetype/attribute for -t (--target)\n");

996 
	`ex™
(1);

998 
cmd_İts
.
tgt_Çme
 = 
	`¡rdup
(
İrg
);

999 ià(!
cmd_İts
.
tgt_Çme
) {

1000 
	`årštf
(
¡d”r
, "%s\n", 
	`¡»¼Ü
(
”ºo
));

1001 
	`ex™
(1);

1005 ià(
İrg
 == 0) {

1006 
	`u§ge
(
¬gv
[0], 1);

1007 
	`´štf
("Missing defaultype for -D (--default)\n");

1008 
	`ex™
(1);

1010 
cmd_İts
.
deçuÉ_Çme
 = 
	`¡rdup
(
İrg
);

1011 ià(!
cmd_İts
.
deçuÉ_Çme
) {

1013 
	`ex™
(1);

1016 
EXPR_ROLE_SOURCE
:

1017 ià(
İrg
 == 0) {

1018 
	`u§ge
(
¬gv
[0], 1);

1019 
	`´štf
("Missing source„ole for --role_source\n");

1020 
	`ex™
(1);

1022 
cmd_İts
.
¤c_rŞe_Çme
 = 
	`¡rdup
(
İrg
);

1023 ià(!
cmd_İts
.
¤c_rŞe_Çme
) {

1024 
	`årštf
(
¡d”r
, "%s\n", 
	`¡»¼Ü
(
”ºo
));

1025 
	`ex™
(1);

1028 
EXPR_ROLE_TARGET
:

1029 ià(
İrg
 == 0) {

1030 
	`u§ge
(
¬gv
[0], 1);

1031 
	`´štf
("Missingarget„ole for --role_target\n");

1032 
	`ex™
(1);

1034 
cmd_İts
.
tgt_rŞe_Çme
 = 
	`¡rdup
(
İrg
);

1035 ià(!
cmd_İts
.
tgt_rŞe_Çme
) {

1036 
	`årštf
(
¡d”r
, "%s\n", 
	`¡»¼Ü
(
”ºo
));

1037 
	`ex™
(1);

1041 ià(
İrg
 == 0) {

1042 
	`u§ge
(
¬gv
[0], 1);

1043 
	`´štf
("Missing object class for -c (--class)\n");

1044 
	`ex™
(1);

1046 
cmd_İts
.
şass_Çme
 = 
	`¡rdup
(
İrg
);

1047 ià(!
cmd_İts
.
şass_Çme
) {

1048 
	`årštf
(
¡d”r
, "%s\n", 
	`¡»¼Ü
(
”ºo
));

1049 
	`ex™
(1);

1053 ià(
İrg
 == 0) {

1054 
	`u§ge
(
¬gv
[0], 1);

1055 
	`´štf
("Missing…ermissions for -p (--perm)\n");

1056 
	`ex™
(1);

1058 ià((
cmd_İts
.
³rmli¡
 = 
	`¡rdup
(
İrg
)è=ğ
NULL


1059 || (
cmd_İts
.
³rm_veùÜ
 = 
	`­Ş_veùÜ_ü—‹
(
ä“
)è=ğ
NULL
) {

1060 
	`årštf
(
¡d”r
, "%s\n", 
	`¡»¼Ü
(
”ºo
));

1061 
	`ex™
(1);

1065 ià(
İrg
 == 0) {

1066 
	`u§ge
(
¬gv
[0], 1);

1067 
	`´štf
("Missing boolean for -b (--bool)\n");

1068 
	`ex™
(1);

1070 
cmd_İts
.
boŞ_Çme
 = 
	`¡rdup
(
İrg
);

1071 ià(!
cmd_İts
.
boŞ_Çme
) {

1072 
	`årštf
(
¡d”r
, "%s\n", 
	`¡»¼Ü
(
”ºo
));

1073 
	`ex™
(1);

1077 
cmd_İts
.
šdœeù
 = 
çl£
;

1080 
cmd_İts
.
u£»gex
 = 
Œue
;

1083 
cmd_İts
.
®low
 = 
Œue
;

1085 
RULE_NEVERALLOW
:

1086 
cmd_İts
.
ÇÎow
 = 
Œue
;

1088 
RULE_AUDIT
:

1089 
cmd_İts
.
aud™®low
 = 
Œue
;

1090 
cmd_İts
.
dÚud™
 = 
Œue
;

1091 
	`årštf
(
¡d”r
, "Use of --audit is deprecated; use --auditallow‡nd --dontaudit instead.\n");

1093 
RULE_AUDITALLOW
:

1094 
cmd_İts
.
aud™®low
 = 
Œue
;

1096 
RULE_DONTAUDIT
:

1097 
cmd_İts
.
dÚud™
 = 
Œue
;

1100 
cmd_İts
.
ty³
 = 
Œue
;

1102 
RULE_ROLE_ALLOW
:

1103 
cmd_İts
.
rŞe_®low
 = 
Œue
;

1105 
RULE_ROLE_TRANS
:

1106 
cmd_İts
.
rŞe_Œªs
 = 
Œue
;

1108 
RULE_RANGE_TRANS
:

1109 
cmd_İts
.
¹¿ns
 = 
Œue
;

1111 
RULE_ALL
:

1112 
cmd_İts
.
®l
 = 
Œue
;

1115 
cmd_İts
.
lš’o
 = 
Œue
;

1118 
cmd_İts
.
£mªtic
 = 
Œue
;

1121 
cmd_İts
.
show_cÚd
 = 
Œue
;

1124 
	`u§ge
(
¬gv
[0], 0);

1125 
	`ex™
(0);

1127 
	`´štf
("££¬ch %s\n%s\n", 
VERSION
, 
COPYRIGHT_INFO
);

1128 
	`ex™
(0);

1130 
	`u§ge
(
¬gv
[0], 1);

1131 
	`ex™
(1);

1135 ià(!(
cmd_İts
.
®low
 || cmd_İts.
ÇÎow
 || cmd_İts.
aud™®low
 || cmd_İts.
dÚud™
 || cmd_İts.
rŞe_®low
 ||

1136 
cmd_İts
.
ty³
 || cmd_İts.
¹¿ns
 || cmd_İts.
rŞe_Œªs
 || cmd_İts.
®l
)) {

1137 
	`u§ge
(
¬gv
[0], 1);

1138 
	`årštf
(
¡d”r
, "One of --all, --allow, --neverallow, --auditallow, --dontaudit,\n"

1140 
	`ex™
(1);

1143 
pŞ_İt
 = 0;

1144 ià(!(
cmd_İts
.
ÇÎow
 || cmd_İts.
®l
))

1145 
pŞ_İt
 |ğ
QPOL_POLICY_OPTION_NO_NEVERALLOWS
;

1147 ià(
¬gc
 - 
İtšd
 < 1) {

1148 
¹
 = 
	`qpŞ_deçuÉ_pŞicy_fšd
(&
pŞicy_fe
);

1149 ià(
¹
 < 0) {

1150 
	`årštf
(
¡d”r
, "DeçuÉ…Şicy s—rch faed: %s\n", 
	`¡»¼Ü
(
”ºo
));

1151 
	`ex™
(1);

1152 } ià(
¹
 != 0) {

1153 
	`årštf
(
¡d”r
, "No default…olicy found.\n");

1154 
	`ex™
(1);

1156 
pŞ_İt
 |ğ
QPOL_POLICY_OPTION_MATCH_SYSTEM
;

1158 ià((
pŞicy_fe
 = 
	`¡rdup
(
¬gv
[
İtšd
])è=ğ
NULL
) {

1159 
	`årštf
(
¡d”r
, "%s\n", 
	`¡»¼Ü
(
”ºo
));

1160 
	`ex™
(1);

1162 
İtšd
++;

1165 ià(
¬gc
 - 
İtšd
 > 0) {

1166 
·th_ty³
 = 
APOL_POLICY_PATH_TYPE_MODULAR
;

1167 ià(!(
mod_·ths
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
))) {

1168 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

1169 
	`ex™
(1);

1171 ; 
¬gc
 - 
İtšd
; optind++) {

1172 ià(
	`­Ş_veùÜ_­³nd
(
mod_·ths
, (*)
¬gv
[
İtšd
])) {

1173 
	`ERR
(
pŞicy
, "E¼Ü†ßdšg moduË %s", 
¬gv
[
İtšd
]);

1174 
	`­Ş_veùÜ_de¡roy
(&
mod_·ths
);

1175 
	`ä“
(
pŞicy_fe
);

1176 
	`ex™
(1);

1179 } ià(
	`­Ş_fe_is_pŞicy_·th_li¡
(
pŞicy_fe
) > 0) {

1180 
pŞ_·th
 = 
	`­Ş_pŞicy_·th_ü—‹_äom_fe
(
pŞicy_fe
);

1181 ià(!
pŞ_·th
) {

1182 
	`ERR
(
pŞicy
, "%s", "invalid…olicy†ist");

1183 
	`ä“
(
pŞicy_fe
);

1184 
	`ex™
(1);

1188 ià(!
pŞ_·th
)

1189 
pŞ_·th
 = 
	`­Ş_pŞicy_·th_ü—‹
(
·th_ty³
, 
pŞicy_fe
, 
mod_·ths
);

1190 ià(!
pŞ_·th
) {

1191 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
ENOMEM
));

1192 
	`ä“
(
pŞicy_fe
);

1193 
	`­Ş_veùÜ_de¡roy
(&
mod_·ths
);

1194 
	`ex™
(1);

1196 
	`ä“
(
pŞicy_fe
);

1197 
	`­Ş_veùÜ_de¡roy
(&
mod_·ths
);

1199 
pŞicy
 = 
	`­Ş_pŞicy_ü—‹_äom_pŞicy_·th
(
pŞ_·th
, 
pŞ_İt
, 
NULL
, NULL);

1200 ià(!
pŞicy
) {

1201 
	`ERR
(
pŞicy
, "%s", 
	`¡»¼Ü
(
”ºo
));

1202 
	`­Ş_pŞicy_·th_de¡roy
(&
pŞ_·th
);

1203 
	`ex™
(1);

1206 ià(
cmd_İts
.
u£»gex
 && cmd_İts.
şass_Çme
 !ğ
NULL
) {

1207 
cmd_İts
.
şass_veùÜ
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
);

1208 
­Ş_veùÜ_t
 *
qpŞ_m©chšg_şas£s
 = 
NULL
;

1209 
­Ş_şass_qu”y_t
 *
»gex_m©ch_qu”y
 = 
	`­Ş_şass_qu”y_ü—‹
();

1210 
	`­Ş_şass_qu”y_£t_»gex
(
pŞicy
, 
»gex_m©ch_qu”y
, 1);

1211 
	`­Ş_şass_qu”y_£t_şass
(
pŞicy
, 
»gex_m©ch_qu”y
, 
cmd_İts
.
şass_Çme
);

1212 ià(
	`­Ş_şass_g‘_by_qu”y
(
pŞicy
, 
»gex_m©ch_qu”y
, &
qpŞ_m©chšg_şas£s
)) {

1213 
	`­Ş_şass_qu”y_de¡roy
(&
»gex_m©ch_qu”y
);

1214 
ş—nup
;

1216 cÚ¡ 
qpŞ_şass_t
 *
şass
 = 
NULL
;

1217 
size_t
 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
qpŞ_m©chšg_şas£s
); ++i) {

1218 cÚ¡ *
şass_Çme
;

1219 
şass
 = 
	`­Ş_veùÜ_g‘_–em’t
(
qpŞ_m©chšg_şas£s
, 
i
);

1220 ià(!
şass
)

1222 
	`qpŞ_şass_g‘_Çme
(
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicy
), 
şass
, &
şass_Çme
);

1223 
	`­Ş_veùÜ_­³nd
(
cmd_İts
.
şass_veùÜ
, (*)
şass_Çme
);

1225 ià(!
	`­Ş_veùÜ_g‘_size
(
qpŞ_m©chšg_şas£s
)) {

1226 
	`­Ş_veùÜ_de¡roy
(&
qpŞ_m©chšg_şas£s
);

1227 
	`­Ş_şass_qu”y_de¡roy
(&
»gex_m©ch_qu”y
);

1228 
	`ERR
(
pŞicy
, "NØşas£ m©chƒx´essiÚ %s", 
cmd_İts
.
şass_Çme
);

1229 
ş—nup
;

1231 
	`­Ş_veùÜ_de¡roy
(&
qpŞ_m©chšg_şas£s
);

1232 
	`­Ş_şass_qu”y_de¡roy
(&
»gex_m©ch_qu”y
);

1235 ià(!
cmd_İts
.
£mªtic
 && 
	`qpŞ_pŞicy_has_ÿ·b™y
(
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicy
), 
QPOL_CAP_SYN_RULES
)) {

1236 ià(
	`qpŞ_pŞicy_bud_syn_ruË_bË
(
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicy
))) {

1237 
	`­Ş_pŞicy_de¡roy
(&
pŞicy
);

1238 
	`ex™
(1);

1243 ià(!
	`qpŞ_pŞicy_has_ÿ·b™y
(
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicy
), 
QPOL_CAP_SYN_RULES
)) {

1244 
cmd_İts
.
£mªtic
 = 1;

1248 ià(
cmd_İts
.
£mªtic
 || !
	`qpŞ_pŞicy_has_ÿ·b™y
(
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicy
), 
QPOL_CAP_LINE_NUMBERS
)) {

1249 
cmd_İts
.
lš’o
 = 0;

1252 ià(
	`³rfÜm_av_qu”y
(
pŞicy
, &
cmd_İts
, &
v
)) {

1253 
¹
 = 1;

1254 
ş—nup
;

1256 ià(
v
) {

1257 ià(!
cmd_İts
.
£mªtic
 && 
	`qpŞ_pŞicy_has_ÿ·b™y
(
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicy
), 
QPOL_CAP_SYN_RULES
))

1258 
	`´št_syn_av_»suÉs
(
pŞicy
, &
cmd_İts
, 
v
);

1260 
	`´št_av_»suÉs
(
pŞicy
, &
cmd_İts
, 
v
);

1261 
	`årštf
(
¡dout
, "\n");

1263 
	`­Ş_veùÜ_de¡roy
(&
v
);

1264 ià(
	`³rfÜm_‹_qu”y
(
pŞicy
, &
cmd_İts
, &
v
)) {

1265 
¹
 = 1;

1266 
ş—nup
;

1268 ià(
v
) {

1269 ià(!
cmd_İts
.
£mªtic
 && 
	`qpŞ_pŞicy_has_ÿ·b™y
(
	`­Ş_pŞicy_g‘_qpŞ
(
pŞicy
), 
QPOL_CAP_SYN_RULES
))

1270 
	`´št_syn_‹_»suÉs
(
pŞicy
, &
cmd_İts
, 
v
);

1272 
	`´št_‹_»suÉs
(
pŞicy
, &
cmd_İts
, 
v
);

1273 
	`årštf
(
¡dout
, "\n");

1276 
	`­Ş_veùÜ_de¡roy
(&
v
);

1277 ià(
	`³rfÜm_á_qu”y
(
pŞicy
, &
cmd_İts
, &
v
)) {

1278 
¹
 = 1;

1279 
ş—nup
;

1281 ià(
v
) {

1282 
	`´št_á_»suÉs
(
pŞicy
, &
cmd_İts
, 
v
);

1283 
	`årštf
(
¡dout
, "\n");

1286 
	`­Ş_veùÜ_de¡roy
(&
v
);

1287 ià(
	`³rfÜm_¿_qu”y
(
pŞicy
, &
cmd_İts
, &
v
)) {

1288 
¹
 = 1;

1289 
ş—nup
;

1291 ià(
v
) {

1292 
	`´št_¿_»suÉs
(
pŞicy
, &
cmd_İts
, 
v
);

1293 
	`årštf
(
¡dout
, "\n");

1295 
	`­Ş_veùÜ_de¡roy
(&
v
);

1296 ià(
	`³rfÜm_¹_qu”y
(
pŞicy
, &
cmd_İts
, &
v
)) {

1297 
¹
 = 1;

1298 
ş—nup
;

1300 ià(
v
) {

1301 
	`´št_¹_»suÉs
(
pŞicy
, &
cmd_İts
, 
v
);

1302 
	`årštf
(
¡dout
, "\n");

1304 
	`­Ş_veùÜ_de¡roy
(&
v
);

1305 ià(
	`³rfÜm_¿nge_qu”y
(
pŞicy
, &
cmd_İts
, &
v
)) {

1306 
¹
 = 1;

1307 
ş—nup
;

1309 ià(
v
) {

1310 
	`´št_¿nge_»suÉs
(
pŞicy
, &
cmd_İts
, 
v
);

1311 
	`årštf
(
¡dout
, "\n");

1313 
	`­Ş_veùÜ_de¡roy
(&
v
);

1314 
¹
 = 0;

1315 
ş—nup
:

1316 
	`­Ş_pŞicy_de¡roy
(&
pŞicy
);

1317 
	`­Ş_pŞicy_·th_de¡roy
(&
pŞ_·th
);

1318 
	`ä“
(
cmd_İts
.
¤c_Çme
);

1319 
	`ä“
(
cmd_İts
.
tgt_Çme
);

1320 
	`ä“
(
cmd_İts
.
deçuÉ_Çme
);

1321 
	`ä“
(
cmd_İts
.
şass_Çme
);

1322 
	`ä“
(
cmd_İts
.
³rmli¡
);

1323 
	`ä“
(
cmd_İts
.
boŞ_Çme
);

1324 
	`ä“
(
cmd_İts
.
¤c_rŞe_Çme
);

1325 
	`ä“
(
cmd_İts
.
tgt_rŞe_Çme
);

1326 
	`­Ş_veùÜ_de¡roy
(&
cmd_İts
.
³rm_veùÜ
);

1327 
	`­Ş_veùÜ_de¡roy
(&
cmd_İts
.
şass_veùÜ
);

1328 
	`ex™
(
¹
);

1329 
	}
}

	@sediff/find_dialog.c

27 
	~<cÚfig.h
>

29 
	~"fšd_dŸlog.h
"

30 
	~"utgui.h
"

32 
	~<as£¹.h
>

33 
	~<”ºo.h
>

34 
	~<¡dlib.h
>

35 
	~<gdk/gdkkeysyms.h
>

36 
	~<gÏde/gÏde.h
>

38 
	sfšd_dŸlog


40 
tİËv–_t
 *
	mtİ
;

41 
GÏdeXML
 *
	mxml
;

44 
gšt
 
	m¡¬t_off£t
;

47 
gšt
 
	m’d_off£t
;

49 
GtkDŸlog
 *
	mw
;

50 
GtkEÁry
 *
	m’Œy
;

51 
GtkRadioBu‰Ú
 *
	mfÜw¬d
, *
	m»v”£
;

54 
	$fšd_dŸlog_£¬ch
(
fšd_dŸlog_t
 * 
f
)

56 
GtkTextV›w
 *
v›w
 = 
	`tİËv–_g‘_‹xt_v›w
(
f
->
tİ
);

57 
GtkTextBufãr
 *
tb
 = 
	`gtk_‹xt_v›w_g‘_bufãr
(
v›w
);

58 
GtkTextM¬k
 *
m¬k
 = 
	`gtk_‹xt_bufãr_g‘_š£¹
(
tb
);

59 
GtkTextI‹r
 
™”
, 
¡¬t
, 
’d
;

60 cÚ¡ 
gch¬
 *
£¬ch_‹xt
 = 
	`gtk_’Œy_g‘_‹xt
(
f
->
’Œy
);

61 
gboŞ—n
 
‹xt_found
;

66 ià(!
	`gtk_‹xt_bufãr_g‘_£ËùiÚ_bounds
(
tb
, &
¡¬t
, &
’d
)) {

67 
	`gtk_‹xt_bufãr_g‘_™”_©_m¬k
(
tb
, &
™”
, 
m¬k
);

69 ià(
	`gtk_toggË_bu‰Ú_g‘_aùive
(
	`GTK_TOGGLE_BUTTON
(
f
->
fÜw¬d
))) {

70 
™”
 = 
’d
;

72 
™”
 = 
¡¬t
;

75 ià(
	`gtk_toggË_bu‰Ú_g‘_aùive
(
	`GTK_TOGGLE_BUTTON
(
f
->
fÜw¬d
))) {

76 
‹xt_found
 = 
	`gtk_‹xt_™”_fÜw¬d_£¬ch
(&
™”
, 
£¬ch_‹xt
, 
GTK_TEXT_SEARCH_VISIBLE_ONLY
, &
¡¬t
, &
’d
, 
NULL
);

77 ià(!
‹xt_found
) {

79 
	`gtk_‹xt_bufãr_g‘_¡¬t_™”
(
tb
, &
™”
);

80 
‹xt_found
 =

81 
	`gtk_‹xt_™”_fÜw¬d_£¬ch
(&
™”
, 
£¬ch_‹xt
, 
GTK_TEXT_SEARCH_VISIBLE_ONLY
, &
¡¬t
, &
’d
, 
NULL
);

84 
‹xt_found
 = 
	`gtk_‹xt_™”_backw¬d_£¬ch
(&
™”
, 
£¬ch_‹xt
, 
GTK_TEXT_SEARCH_VISIBLE_ONLY
, &
¡¬t
, &
’d
, 
NULL
);

85 ià(!
‹xt_found
) {

87 
	`gtk_‹xt_bufãr_g‘_’d_™”
(
tb
, &
™”
);

88 
‹xt_found
 =

89 
	`gtk_‹xt_™”_backw¬d_£¬ch
(&
™”
, 
£¬ch_‹xt
, 
GTK_TEXT_SEARCH_VISIBLE_ONLY
, &
¡¬t
, &
’d
, 
NULL
);

92 ià(!
‹xt_found
) {

93 
GSŒšg
 *
¡ršg
 = 
	`g_¡ršg_Ãw
("");

94 
	`g_¡ršg_´štf
(
¡ršg
, "Texˆ\"%s\"‚Ù found.", 
£¬ch_‹xt
);

95 
	`ut_mes§ge
(
	`GTK_WINDOW
(
f
->
w
), 
GTK_MESSAGE_INFO
, 
¡ršg
->
¡r
);

96 
	`g_¡ršg_ä“
(
¡ršg
, 
TRUE
);

98 
	`gtk_‹xt_v›w_süŞl_to_™”
(
v›w
, &
¡¬t
, 0.0, 
FALSE
, 0.0, 0.5);

99 ià(
	`gtk_toggË_bu‰Ú_g‘_aùive
(
	`GTK_TOGGLE_BUTTON
(
f
->
fÜw¬d
))) {

100 
	`gtk_‹xt_bufãr_£Ëù_¿nge
(
tb
, &
’d
, &
¡¬t
);

102 
	`gtk_‹xt_bufãr_£Ëù_¿nge
(
tb
, &
¡¬t
, &
’d
);

105 
	}
}

107 
fšd_dŸlog_Ú_»¥Ú£
(
GtkDŸlog
 * 
dŸlog
 
__©Œibu‹__
 ((
unu£d
)), 
gšt
 
»¥Ú£
, 
gpoš‹r
 
u£r_d©a
)

109 
fšd_dŸlog_t
 *
	gf
 = (fšd_dŸlog_ˆ*è
u£r_d©a
;

110 ià(
	g»¥Ú£
 =ğ
GTK_RESPONSE_CLOSE
) {

111 
gtk_widg‘_hide
(
GTK_WIDGET
(
f
->
w
));

112 } ià(
	g»¥Ú£
 =ğ
GTK_RESPONSE_OK
) {

113 
fšd_dŸlog_£¬ch
(
f
);

117 
gboŞ—n
 
fšd_dŸlog_Ú_key_´ess_ev’t
(
GtkWidg‘
 * 
widg‘
 
__©Œibu‹__
 ((
unu£d
)), 
GdkEv’tKey
 * 
ev’t
, 
gpoš‹r
 
u£r_d©a
)

119 
fšd_dŸlog_t
 *
	gf
 = (fšd_dŸlog_ˆ*è
u£r_d©a
;

120 ià(
	gev’t
->
	gkeyv®
 =ğ
GDK_Esÿ³
) {

121 
gtk_widg‘_hide
(
GTK_WIDGET
(
f
->
w
));

122  
	gTRUE
;

124  
	gFALSE
;

127 
fšd_dŸlog_Ú_’Œy_aùiv©e
(
GtkEÁry
 * 
’Œy
 
__©Œibu‹__
 ((
unu£d
)), 
gpoš‹r
 
u£r_d©a
)

129 
fšd_dŸlog_t
 *
	gf
 = (fšd_dŸlog_ˆ*è
u£r_d©a
;

130 
fšd_dŸlog_£¬ch
(
f
);

133 
fšd_dŸlog_t
 *
	$fšd_dŸlog_ü—‹
(
tİËv–_t
 * 
tİ
)

135 
fšd_dŸlog_t
 *
f
;

136 
”rÜ
 = 0;

138 ià((
f
 = 
	`ÿÎoc
(1, (*f))è=ğ
NULL
) {

139 
”rÜ
 = 
”ºo
;

140 
ş—nup
;

142 
f
->
tİ
 =op;

143 
f
->
xml
 = 
	`gÏde_xml_Ãw
(
	`tİËv–_g‘_gÏde_xml
(f->
tİ
), "fšd_dŸlog", 
NULL
);

145 
f
->
w
 = 
	`GTK_DIALOG
(
	`gÏde_xml_g‘_widg‘
(f->
xml
, "find_dialog"));

146 
	`as£¹
(
f
->
w
 !ğ
NULL
);

147 
	`gtk_wšdow_£t_Œªs›Á_fÜ
(
	`GTK_WINDOW
(
f
->
w
), 
	`tİËv–_g‘_wšdow
(f->
tİ
));

148 
	`g_sigÇl_cÚÃù_sw­³d
(
	`G_OBJECT
(
f
->
w
), "d–‘e-ev’t", 
	`G_CALLBACK
(
gtk_widg‘_hide_Ú_d–‘e
), f->w);

149 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
(
f
->
w
), "»¥Ú£", 
	`G_CALLBACK
(
fšd_dŸlog_Ú_»¥Ú£
), f);

150 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
(
f
->
w
), "key-´ess-ev’t", 
	`G_CALLBACK
(
fšd_dŸlog_Ú_key_´ess_ev’t
), f);

152 
f
->
’Œy
 = 
	`GTK_ENTRY
(
	`gÏde_xml_g‘_widg‘
(f->
xml
, "findƒntry"));

153 
f
->
fÜw¬d
 = 
	`GTK_RADIO_BUTTON
(
	`gÏde_xml_g‘_widg‘
(f->
xml
, "find forward„adio"));

154 
f
->
»v”£
 = 
	`GTK_RADIO_BUTTON
(
	`gÏde_xml_g‘_widg‘
(f->
xml
, "find„everse„adio"));

155 
	`as£¹
(
f
->
’Œy
 !ğ
NULL
 && f->
fÜw¬d
 !ğNULL && f->
»v”£
 != NULL);

158 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
(
f
->
’Œy
), "aùiv©e", 
	`G_CALLBACK
(
fšd_dŸlog_Ú_’Œy_aùiv©e
), f);

160 
ş—nup
:

161 ià(
”rÜ
 != 0) {

162 
	`fšd_dŸlog_de¡roy
(&
f
);

163 
”ºo
 = 
”rÜ
;

164  
NULL
;

166  
f
;

167 
	}
}

169 
	$fšd_dŸlog_de¡roy
(
fšd_dŸlog_t
 ** 
f
)

171 ià(
f
 !ğ
NULL
 && *f != NULL) {

172 
	`ä“
(*
f
);

173 *
f
 = 
NULL
;

175 
	}
}

177 
	$fšd_dŸlog_show
(
fšd_dŸlog_t
 * 
f
)

179 
	`gtk_widg‘_show
(
	`GTK_WIDGET
(
f
->
w
));

180 
	`gtk_widg‘_g¿b_focus
(
	`GTK_WIDGET
(
f
->
’Œy
));

181 
	`gtk_ed™abË_£t_pos™iÚ
(
	`GTK_EDITABLE
(
f
->
’Œy
), -1);

182 
	`gtk_ed™abË_£Ëù_»giÚ
(
	`GTK_EDITABLE
(
f
->
’Œy
), 0, -1);

183 
	`gtk_wšdow_´e£Á
(
	`GTK_WINDOW
(
f
->
w
));

184 
	}
}

	@sediff/find_dialog.h

27 #iâdeà
FIND_DIALOG_H


28 
	#FIND_DIALOG_H


	)

30 
fšd_dŸlog
 
	tfšd_dŸlog_t
;

32 
	~"tİËv–.h
"

45 
fšd_dŸlog_t
 *
fšd_dŸlog_ü—‹
(
tİËv–_t
 * 
tİ
);

54 
fšd_dŸlog_de¡roy
(
fšd_dŸlog_t
 ** 
f
);

61 
fšd_dŸlog_show
(
fšd_dŸlog_t
 * 
f
);

	@sediff/open_policies_dialog.c

25 
	~<cÚfig.h
>

27 
	~"İ’_pŞic›s_dŸlog.h
"

28 
	~"utgui.h
"

30 
	~<as£¹.h
>

31 
	~<”ºo.h
>

32 
	~<¡ršg.h
>

33 
	~<­Ş/ut.h
>

34 
	~<gÏde/gÏde.h
>

36 
	sİ’_pŞicy_·Ã


38 
İ’_pŞicy
 *
	mİ
;

39 
GtkRadioBu‰Ú
 *
	mmÚŞ™hic_¿dio
, *
	mmoduÏr_¿dio
;

40 
GtkLab–
 *
	mmaš_Ïb–
;

42 
GtkHBox
 *
	mbÙtom_hbox
;

43 
GtkLi¡StÜe
 *
	mmoduË_¡Üe
;

45 
GtkEÁry
 *
	mba£_’Œy
;

46 
GtkBu‰Ú
 *
	mba£_brow£_bu‰Ú
;

48 
GtkT»eV›w
 *
	mmoduË_v›w
;

49 
GtkBu‰Ú
 *
	madd_bu‰Ú
, *
	m»move_bu‰Ú
, *
	mimpÜt_bu‰Ú
, *
	mexpÜt_bu‰Ú
;

50 *
	mÏ¡_moduË_·th
;

53 
	sİ’_pŞicy


55 
GÏdeXML
 *
	mxml
;

56 
tİËv–_t
 *
	mtİ
;

57 
GtkDŸlog
 *
	mdŸlog
;

58 
GtkBu‰Ú
 *
	mok_bu‰Ú
, *
	mrundiff_bu‰Ú
;

59 
İ’_pŞicy_·Ã
 
	m·Ã
[
SEDIFFX_POLICY_NUM
];

62 
	emoduË_cŞumns


64 
	mPATH_COLUMN
 = 0, 
	mNAME_COLUMN
, 
	mVERSION_COLUMN
, 
	mNUM_COLUMNS


70 
gšt
 
	$İ’_pŞicy_sÜt
(
GtkT»eMod–
 * 
mod–
, 
GtkT»eI‹r
 * 
a
, GtkT»eI‹¸* 
b
, 
gpoš‹r
 
u£r_d©a
)

72 
GV®ue
 
v®ue_a
 = { 0 }, 
v®ue_b
 = {

74 cÚ¡ *
Çme_a
, *
Çme_b
;

75 
»tv®
, 
cŞumn_id
 = 
	`GPOINTER_TO_INT
(
u£r_d©a
);

77 
	`gtk_Œ“_mod–_g‘_v®ue
(
mod–
, 
a
, 
cŞumn_id
, &
v®ue_a
);

78 
	`gtk_Œ“_mod–_g‘_v®ue
(
mod–
, 
b
, 
cŞumn_id
, &
v®ue_b
);

79 
Çme_a
 = 
	`g_v®ue_g‘_¡ršg
(&
v®ue_a
);

80 
Çme_b
 = 
	`g_v®ue_g‘_¡ršg
(&
v®ue_b
);

81 
»tv®
 = 
	`¡rcmp
(
Çme_a
, 
Çme_b
);

82 
	`g_v®ue_un£t
(&
v®ue_a
);

83 
	`g_v®ue_un£t
(&
v®ue_b
);

84  
»tv®
;

85 
	}
}

87 
	$İ’_pŞicy_š™_·Ã
(
İ’_pŞicy
 *
İ
, 
£diffx_pŞicy_e
 
which
, cÚ¡ *
suffix
)

89 
İ’_pŞicy_·Ã
 *
·Ã
 = 
İ
->·Ã + 
which
;

90 
GSŒšg
 *
s
 = 
	`g_¡ršg_Ãw
(
NULL
);

91 
GtkC–lR’d””
 *
»nd””
 = 
	`gtk_ûÎ_»nd””_‹xt_Ãw
();

92 
GtkT»eV›wCŞumn
 *
cŞumn
;

93 
GtkT»eS–eùiÚ
 *
£ËùiÚ
;

95 
	`g_¡ršg_´štf
(
s
, "mÚŞ™hiø¿dio%s", 
suffix
);

96 
·Ã
->
mÚŞ™hic_¿dio
 = 
	`GTK_RADIO_BUTTON
(
	`gÏde_xml_g‘_widg‘
(
İ
->
xml
, 
s
->
¡r
));

97 
	`g_¡ršg_´štf
(
s
, "moduÏ¸¿dio%s", 
suffix
);

98 
·Ã
->
moduÏr_¿dio
 = 
	`GTK_RADIO_BUTTON
(
	`gÏde_xml_g‘_widg‘
(
İ
->
xml
, 
s
->
¡r
));

99 
	`g_¡ršg_´štf
(
s
, "maš f’amÏb–%s", 
suffix
);

100 
·Ã
->
maš_Ïb–
 = 
	`GTK_LABEL
(
	`gÏde_xml_g‘_widg‘
(
İ
->
xml
, 
s
->
¡r
));

101 
	`as£¹
(
·Ã
->
mÚŞ™hic_¿dio
 !ğ
NULL
 &&…ªe->
moduÏr_¿dio
 !ğNULL &&…ªe->
maš_Ïb–
 != NULL);

103 
	`g_¡ršg_´štf
(
s
, "ba£ƒÁry%s", 
suffix
);

104 
·Ã
->
ba£_’Œy
 = 
	`GTK_ENTRY
(
	`gÏde_xml_g‘_widg‘
(
İ
->
xml
, 
s
->
¡r
));

105 
	`g_¡ršg_´štf
(
s
, "ba£ brow£%s", 
suffix
);

106 
·Ã
->
ba£_brow£_bu‰Ú
 = 
	`GTK_BUTTON
(
	`gÏde_xml_g‘_widg‘
(
İ
->
xml
, 
s
->
¡r
));

107 
	`as£¹
(
·Ã
->
ba£_’Œy
 !ğ
NULL
 &&…ªe->
ba£_brow£_bu‰Ú
 != NULL);

109 
	`g_¡ršg_´štf
(
s
, "hbox.3%s", 
suffix
);

110 
·Ã
->
bÙtom_hbox
 = 
	`GTK_HBOX
(
	`gÏde_xml_g‘_widg‘
(
İ
->
xml
, 
s
->
¡r
));

111 
	`as£¹
(
·Ã
->
bÙtom_hbox
 !ğ
NULL
);

113 
	`g_¡ršg_´štf
(
s
, "moduË v›w%s", 
suffix
);

114 
·Ã
->
moduË_v›w
 = 
	`GTK_TREE_VIEW
(
	`gÏde_xml_g‘_widg‘
(
İ
->
xml
, 
s
->
¡r
));

115 
	`as£¹
(
·Ã
->
moduË_v›w
 !ğ
NULL
);

116 
·Ã
->
moduË_¡Üe
 = 
	`gtk_li¡_¡Üe_Ãw
(
NUM_COLUMNS
, 
G_TYPE_STRING
, G_TYPE_STRING, G_TYPE_STRING);

117 
	`gtk_Œ“_v›w_£t_mod–
(
·Ã
->
moduË_v›w
, 
	`GTK_TREE_MODEL
Õªe->
moduË_¡Üe
));

119 
	`g_¡ršg_´štf
(
s
, "moduË‡dd bu‰Ú%s", 
suffix
);

120 
·Ã
->
add_bu‰Ú
 = 
	`GTK_BUTTON
(
	`gÏde_xml_g‘_widg‘
(
İ
->
xml
, 
s
->
¡r
));

121 
	`g_¡ršg_´štf
(
s
, "moduË„emovbu‰Ú%s", 
suffix
);

122 
·Ã
->
»move_bu‰Ú
 = 
	`GTK_BUTTON
(
	`gÏde_xml_g‘_widg‘
(
İ
->
xml
, 
s
->
¡r
));

123 
	`g_¡ršg_´štf
(
s
, "moduË†i¡ impÜˆbu‰Ú%s", 
suffix
);

124 
·Ã
->
impÜt_bu‰Ú
 = 
	`GTK_BUTTON
(
	`gÏde_xml_g‘_widg‘
(
İ
->
xml
, 
s
->
¡r
));

125 
	`g_¡ršg_´štf
(
s
, "moduË†i¡ƒxpÜˆbu‰Ú%s", 
suffix
);

126 
·Ã
->
expÜt_bu‰Ú
 = 
	`GTK_BUTTON
(
	`gÏde_xml_g‘_widg‘
(
İ
->
xml
, 
s
->
¡r
));

127 
	`as£¹
(
·Ã
->
add_bu‰Ú
 !ğ
NULL
 &&…ªe->
»move_bu‰Ú
 != NULL &&

128 
·Ã
->
impÜt_bu‰Ú
 !ğ
NULL
 &&…ªe->
expÜt_bu‰Ú
 != NULL);

130 
	`g_¡ršg_ä“
(
s
, 
TRUE
);

132 
£ËùiÚ
 = 
	`gtk_Œ“_v›w_g‘_£ËùiÚ
(
·Ã
->
moduË_v›w
);

133 
	`gtk_Œ“_£ËùiÚ_£t_mode
(
£ËùiÚ
, 
GTK_SELECTION_BROWSE
);

135 
cŞumn
 = 
	`gtk_Œ“_v›w_cŞumn_Ãw_w™h_©Œibu‹s
("ModuË", 
»nd””
, "‹xt", 
NAME_COLUMN
, 
NULL
);

136 
	`gtk_Œ“_v›w_cŞumn_£t_sÜt_cŞumn_id
(
cŞumn
, 
NAME_COLUMN
);

137 
	`gtk_Œ“_v›w_cŞumn_£t_»sizabË
(
cŞumn
, 
TRUE
);

138 
	`gtk_Œ“_v›w_­³nd_cŞumn
(
·Ã
->
moduË_v›w
, 
cŞumn
);

139 
	`gtk_Œ“_sÜbË_£t_sÜt_func
(
	`GTK_TREE_SORTABLE
(
·Ã
->
moduË_¡Üe
), 
NAME_COLUMN
, 
İ’_pŞicy_sÜt
,

140 (
gpoš‹r
è
NAME_COLUMN
, 
NULL
);

142 
cŞumn
 = 
	`gtk_Œ“_v›w_cŞumn_Ãw_w™h_©Œibu‹s
("V”siÚ", 
»nd””
, "‹xt", 
VERSION_COLUMN
, 
NULL
);

143 
	`gtk_Œ“_v›w_cŞumn_£t_sÜt_cŞumn_id
(
cŞumn
, 
VERSION_COLUMN
);

144 
	`gtk_Œ“_v›w_cŞumn_£t_»sizabË
(
cŞumn
, 
TRUE
);

145 
	`gtk_Œ“_v›w_­³nd_cŞumn
(
·Ã
->
moduË_v›w
, 
cŞumn
);

146 
	`gtk_Œ“_sÜbË_£t_sÜt_func
(
	`GTK_TREE_SORTABLE
(
·Ã
->
moduË_¡Üe
), 
VERSION_COLUMN
, 
İ’_pŞicy_sÜt
,

147 (
gpoš‹r
è
VERSION_COLUMN
, 
NULL
);

149 
cŞumn
 = 
	`gtk_Œ“_v›w_cŞumn_Ãw_w™h_©Œibu‹s
("P©h", 
»nd””
, "‹xt", 
PATH_COLUMN
, 
NULL
);

150 
	`gtk_Œ“_v›w_cŞumn_£t_sÜt_cŞumn_id
(
cŞumn
, 
PATH_COLUMN
);

151 
	`gtk_Œ“_v›w_cŞumn_£t_»sizabË
(
cŞumn
, 
TRUE
);

152 
	`gtk_Œ“_v›w_­³nd_cŞumn
(
·Ã
->
moduË_v›w
, 
cŞumn
);

153 
	`gtk_Œ“_sÜbË_£t_sÜt_func
(
	`GTK_TREE_SORTABLE
(
·Ã
->
moduË_¡Üe
), 
PATH_COLUMN
, 
İ’_pŞicy_sÜt
,

154 (
gpoš‹r
è
PATH_COLUMN
, 
NULL
);

156 
	`gtk_Œ“_sÜbË_£t_sÜt_cŞumn_id
(
	`GTK_TREE_SORTABLE
(
·Ã
->
moduË_¡Üe
), 
NAME_COLUMN
, 
GTK_SORT_ASCENDING
);

157 
	}
}

159 
	$İ’_pŞicy_š™_widg‘s
(
İ’_pŞicy
 *
İ
)

161 
İ
->
dŸlog
 = 
	`GTK_DIALOG
(
	`gÏde_xml_g‘_widg‘
(İ->
xml
, "PoliciesOpenWindow"));

162 
	`as£¹
(
İ
->
dŸlog
 !ğ
NULL
);

163 
	`gtk_wšdow_£t_Œªs›Á_fÜ
(
	`GTK_WINDOW
(
İ
->
dŸlog
), 
	`tİËv–_g‘_wšdow
(İ->
tİ
));

164 
İ
->
ok_bu‰Ú
 = 
	`GTK_BUTTON
(
	`gÏde_xml_g‘_widg‘
(İ->
xml
, "ok button"));

165 
İ
->
rundiff_bu‰Ú
 = 
	`GTK_BUTTON
(
	`gÏde_xml_g‘_widg‘
(İ->
xml
, "rundiff button"));

166 
	`as£¹
(
İ
->
ok_bu‰Ú
 !ğ
NULL
 && op->
rundiff_bu‰Ú
 != NULL);

168 
	`İ’_pŞicy_š™_·Ã
(
İ
, 
SEDIFFX_POLICY_ORIG
, "");

169 
	`İ’_pŞicy_š™_·Ã
(
İ
, 
SEDIFFX_POLICY_MOD
, " 1");

170 
	}
}

172 
	$İ’_pŞicy_Ú_pŞicy_ty³_toggË
(
GtkToggËBu‰Ú
 * 
widg‘
, 
gpoš‹r
 
u£r_d©a
)

174 
İ’_pŞicy_·Ã
 *
·Ã
 = (İ’_pŞicy_·Ã *)
u£r_d©a
;

178 ià(!
	`gtk_toggË_bu‰Ú_g‘_aùive
(
widg‘
)) {

181 *
´efix
;

182 
GSŒšg
 *
s
 = 
	`g_¡ršg_Ãw
(
NULL
);

183 ià(
·Ã
 =ğ&Õªe->
İ
->·Ã[
SEDIFFX_POLICY_ORIG
])) {

184 
´efix
 = "Original";

186 
´efix
 = "Modified";

188 ià(
	`gtk_toggË_bu‰Ú_g‘_aùive
(
	`GTK_TOGGLE_BUTTON
(
·Ã
->
mÚŞ™hic_¿dio
))) {

189 
	`gtk_widg‘_£t_£ns™ive
(
	`GTK_WIDGET
(
·Ã
->
bÙtom_hbox
), 
FALSE
);

190 
	`g_¡ršg_´štf
(
s
, "<b>% PŞicy F’ame:</b>", 
´efix
);

191 
	`gtk_Ïb–_£t_m¬kup
(
·Ã
->
maš_Ïb–
, 
s
->
¡r
);

193 
	`gtk_widg‘_£t_£ns™ive
(
	`GTK_WIDGET
(
·Ã
->
bÙtom_hbox
), 
TRUE
);

194 
	`g_¡ršg_´štf
(
s
, "<b>% Ba£ F’ame:</b>", 
´efix
);

195 
	`gtk_Ïb–_£t_m¬kup
(
·Ã
->
maš_Ïb–
, 
s
->
¡r
);

197 
	`g_¡ršg_ä“
(
s
, 
TRUE
);

198 
	}
}

200 
İ’_pŞicy_Ú_’Œy_ev’t_aá”
(
GtkWidg‘
 * 
widg‘
 
__©Œibu‹__
 ((
unu£d
)), 
GdkEv’t
 * 
ev’t


201 
__©Œibu‹__
 ((
unu£d
)), 
gpoš‹r
 
u£r_d©a
)

203 
İ’_pŞicy
 *
	gİ
 = (İ’_pŞicy *)
u£r_d©a
;

204 
gboŞ—n
 
	g£ns_Üig
 = 
FALSE
, 
	g£ns_mod
 = FALSE;

205 ià(
¡rcmp
(
gtk_’Œy_g‘_‹xt
(
İ
->
·Ã
[
SEDIFFX_POLICY_ORIG
].
ba£_’Œy
), "") != 0) {

206 
£ns_Üig
 = 
TRUE
;

208 ià(
¡rcmp
(
gtk_’Œy_g‘_‹xt
(
İ
->
·Ã
[
SEDIFFX_POLICY_MOD
].
ba£_’Œy
), "") != 0) {

209 
£ns_mod
 = 
TRUE
;

211 
gboŞ—n
 
	g£ns
 = 
£ns_Üig
 && 
£ns_mod
;

212 
gtk_widg‘_£t_£ns™ive
(
GTK_WIDGET
(
İ
->
·Ã
[
SEDIFFX_POLICY_ORIG
].
expÜt_bu‰Ú
), 
£ns_Üig
);

213 
gtk_widg‘_£t_£ns™ive
(
GTK_WIDGET
(
İ
->
·Ã
[
SEDIFFX_POLICY_MOD
].
expÜt_bu‰Ú
), 
£ns_mod
);

214 
gtk_widg‘_£t_£ns™ive
(
GTK_WIDGET
(
İ
->
ok_bu‰Ú
), 
£ns
);

215 
gtk_widg‘_£t_£ns™ive
(
GTK_WIDGET
(
İ
->
rundiff_bu‰Ú
), 
£ns
);

218 
İ’_pŞicy_Ú_ba£_brow£_şick
(
GtkBu‰Ú
 * 
bu‰Ú
 
__©Œibu‹__
 ((
unu£d
)), 
gpoš‹r
 
u£r_d©a
)

220 
İ’_pŞicy_·Ã
 *
	g·Ã
 = (İ’_pŞicy_·Ã *)
u£r_d©a
;

221 cÚ¡ *
	gcu¼’t_·th
 = 
gtk_’Œy_g‘_‹xt
(
·Ã
->
ba£_’Œy
);

222 *
	gt™Ë
;

223 
­Ş_veùÜ_t
 *
	g·ths
;

224 ià(
gtk_toggË_bu‰Ú_g‘_aùive
(
GTK_TOGGLE_BUTTON
(
·Ã
->
mÚŞ™hic_¿dio
))) {

225 
	gt™Ë
 = "Open Monolithic Policy";

227 
	gt™Ë
 = "Open Modular Policy";

229 ià(
¡rcmp
(
cu¼’t_·th
, "") == 0) {

230 
cu¼’t_·th
 = 
NULL
;

232 ià((
	g·ths
 = 
ut_İ’_fe
(
GTK_WINDOW
(
·Ã
->
İ
->
dŸlog
), 
t™Ë
, 
cu¼’t_·th
, 0)è=ğ
NULL
) {

235 
gtk_’Œy_£t_‹xt
(
·Ã
->
ba£_’Œy
, 
­Ş_veùÜ_g‘_–em’t
(
·ths
, 0));

236 
­Ş_veùÜ_de¡roy
(&
·ths
);

245 
	$İ’_pŞicy_lßd_moduË
(
İ’_pŞicy
 *
İ
, 
İ’_pŞicy_·Ã
 *
·Ã
, cÚ¡ *
·th
)

247 cÚ¡ *
moduË_Çme
, *
v”siÚ_¡ršg
;

248 
moduË_ty³
;

249 
qpŞ_moduË_t
 *
moduË
 = 
NULL
;

250 
GtkT»eI‹r
 
™”
;

253 
gboŞ—n
 
™”_v®id
 = 
	`gtk_Œ“_mod–_g‘_™”_fœ¡
(
	`GTK_TREE_MODEL
(
·Ã
->
moduË_¡Üe
), &
™”
);

254 
™”_v®id
) {

255 *
s
;

256 
	`gtk_Œ“_mod–_g‘
(
	`GTK_TREE_MODEL
(
·Ã
->
moduË_¡Üe
), &
™”
, 
PATH_COLUMN
, &
s
, -1);

257 ià(
	`¡rcmp
(
s
, 
·th
) == 0) {

258 
	`tİËv–_ERR
(
İ
->
tİ
, "ModuË % wa ®»ady‡dded.", 
·th
);

261 
™”_v®id
 = 
	`gtk_Œ“_mod–_™”_Ãxt
(
	`GTK_TREE_MODEL
(
·Ã
->
moduË_¡Üe
), &
™”
);

263 ià((
	`qpŞ_moduË_ü—‹_äom_fe
(
·th
, &
moduË
)) < 0) {

264 
	`tİËv–_ERR
(
İ
->
tİ
, "E¼Ü o³nšg moduË %s: %s", 
·th
, 
	`¡»¼Ü
(
”ºo
));

267 ià(
	`qpŞ_moduË_g‘_Çme
(
moduË
, &
moduË_Çme
) < 0 ||

268 
	`qpŞ_moduË_g‘_v”siÚ
(
moduË
, &
v”siÚ_¡ršg
è< 0 || 
	`qpŞ_moduË_g‘_ty³
(moduË, &
moduË_ty³
) < 0) {

269 
	`tİËv–_ERR
(
İ
->
tİ
, "E¼Ü„—dšg moduË %s: %s", 
·th
, 
	`¡»¼Ü
(
”ºo
));

270 
	`qpŞ_moduË_de¡roy
(&
moduË
);

273 ià(
moduË_ty³
 !ğ
QPOL_MODULE_OTHER
) {

274 
	`tİËv–_ERR
(
İ
->
tİ
, "% i nÙ‡†ßdabË moduË.", 
·th
);

275 
	`qpŞ_moduË_de¡roy
(&
moduË
);

278 
	`gtk_li¡_¡Üe_­³nd
(
·Ã
->
moduË_¡Üe
, &
™”
);

279 
	`gtk_li¡_¡Üe_£t
(
·Ã
->
moduË_¡Üe
, &
™”
, 
PATH_COLUMN
, 
·th
, 
NAME_COLUMN
, 
moduË_Çme
, 
VERSION_COLUMN
, 
v”siÚ_¡ršg
,

281 
	`qpŞ_moduË_de¡roy
(&
moduË
);

283 
	}
}

285 
İ’_pŞicy_Ú_add_şick
(
GtkBu‰Ú
 * 
bu‰Ú
 
__©Œibu‹__
 ((
unu£d
)), 
gpoš‹r
 
u£r_d©a
)

287 
İ’_pŞicy_·Ã
 *
	g·Ã
 = (İ’_pŞicy_·Ã *)
u£r_d©a
;

288 
­Ş_veùÜ_t
 *
	g·ths
;

289 cÚ¡ *
	g·th
 = 
NULL
, *
	g´ev_·th
;

290 
size_t
 
	gi
;

291 ià((
	g´ev_·th
 = 
·Ã
->
Ï¡_moduË_·th
è=ğ
NULL
) {

292 
´ev_·th
 = 
gtk_’Œy_g‘_‹xt
(
·Ã
->
ba£_’Œy
);

293 ià(
¡rcmp
(
´ev_·th
, "") == 0) {

294 
´ev_·th
 = 
NULL
;

297 
	g·ths
 = 
ut_İ’_fe
(
GTK_WINDOW
(
·Ã
->
İ
->
dŸlog
), "O³ÀModuË", 
´ev_·th
, 1);

298 ià(
	g·ths
 =ğ
NULL
) {

301 
	g®l_sucûed
 = 1;

302 
	gi
 = 0; i < 
­Ş_veùÜ_g‘_size
(
·ths
); i++) {

303 
	g·th
 = 
­Ş_veùÜ_g‘_–em’t
(
·ths
, 
i
);

304 ià(
İ’_pŞicy_lßd_moduË
(
·Ã
->
İ
,…ªe, 
·th
) < 0) {

305 
	g®l_sucûed
 = 0;

308 ià(
	g®l_sucûed
) {

309 
as£¹
(
·th
 !ğ
NULL
);

310 
ä“
(
·Ã
->
Ï¡_moduË_·th
);

311 
	g·Ã
->
	gÏ¡_moduË_·th
 = 
¡rdup
(
·th
);

313 
­Ş_veùÜ_de¡roy
(&
·ths
);

316 
İ’_pŞicy_Ú_»move_şick
(
GtkBu‰Ú
 * 
bu‰Ú
 
__©Œibu‹__
 ((
unu£d
)), 
gpoš‹r
 
u£r_d©a
)

318 
İ’_pŞicy_·Ã
 *
	g·Ã
 = (İ’_pŞicy_·Ã *)
u£r_d©a
;

319 
GtkT»eS–eùiÚ
 *
	g£ËùiÚ
 = 
gtk_Œ“_v›w_g‘_£ËùiÚ
(
·Ã
->
moduË_v›w
);

320 
GtkT»eI‹r
 
	g™”
;

321 *
	g·th
;

322 ià(!
gtk_Œ“_£ËùiÚ_g‘_£Ëùed
(
£ËùiÚ
, 
NULL
, &
™”
)) {

325 
gtk_Œ“_mod–_g‘
(
GTK_TREE_MODEL
(
·Ã
->
moduË_¡Üe
), &
™”
, 0, &
·th
, -1);

326 
gtk_li¡_¡Üe_»move
(
·Ã
->
moduË_¡Üe
, &
™”
);

329 
İ’_pŞicy_Ú_impÜt_şick
(
GtkBu‰Ú
 * 
bu‰Ú
 
__©Œibu‹__
 ((
unu£d
)), 
gpoš‹r
 
u£r_d©a
);

330 
İ’_pŞicy_Ú_expÜt_şick
(
GtkBu‰Ú
 * 
bu‰Ú
 
__©Œibu‹__
 ((
unu£d
)), 
gpoš‹r
 
u£r_d©a
);

332 
	$İ’_pŞicy_Ú_£ËùiÚ_chªge
(
GtkT»eS–eùiÚ
 * 
£ËùiÚ
, 
gpoš‹r
 
u£r_d©a
)

334 
İ’_pŞicy_·Ã
 *
·Ã
 = (İ’_pŞicy_·Ã *)
u£r_d©a
;

335 
gboŞ—n
 
£ns
 = 
	`gtk_Œ“_£ËùiÚ_g‘_£Ëùed
(
£ËùiÚ
, 
NULL
, NULL);

336 
	`gtk_widg‘_£t_£ns™ive
(
	`GTK_WIDGET
(
·Ã
->
»move_bu‰Ú
), 
£ns
);

337 
	}
}

339 
	$İ’_pŞicy_š™_sigÇls
(
İ’_pŞicy
 *
İ
)

341 
£diffx_pŞicy_e
 
i
;

342 
i
 = 
SEDIFFX_POLICY_ORIG
; i < 
SEDIFFX_POLICY_NUM
; i++) {

343 
İ’_pŞicy_·Ã
 *
·Ã
 = 
İ
->·Ã + 
i
;

344 
GtkT»eS–eùiÚ
 *
£ËùiÚ
 = 
	`gtk_Œ“_v›w_g‘_£ËùiÚ
(
·Ã
->
moduË_v›w
);

345 
	`g_sigÇl_cÚÃù
(
·Ã
->
mÚŞ™hic_¿dio
, "toggËd", 
	`G_CALLBACK
(
İ’_pŞicy_Ú_pŞicy_ty³_toggË
),…ane);

346 
	`g_sigÇl_cÚÃù
(
·Ã
->
moduÏr_¿dio
, "toggËd", 
	`G_CALLBACK
(
İ’_pŞicy_Ú_pŞicy_ty³_toggË
),…ane);

347 
	`g_sigÇl_cÚÃù
(
·Ã
->
ba£_’Œy
, "ev’t-aá”", 
	`G_CALLBACK
(
İ’_pŞicy_Ú_’Œy_ev’t_aá”
), 
İ
);

348 
	`g_sigÇl_cÚÃù
(
·Ã
->
ba£_brow£_bu‰Ú
, "şicked", 
	`G_CALLBACK
(
İ’_pŞicy_Ú_ba£_brow£_şick
),…ane);

349 
	`g_sigÇl_cÚÃù
(
£ËùiÚ
, "chªged", 
	`G_CALLBACK
(
İ’_pŞicy_Ú_£ËùiÚ_chªge
), 
·Ã
);

350 
	`g_sigÇl_cÚÃù
(
·Ã
->
add_bu‰Ú
, "şicked", 
	`G_CALLBACK
(
İ’_pŞicy_Ú_add_şick
),…ane);

351 
	`g_sigÇl_cÚÃù
(
·Ã
->
»move_bu‰Ú
, "şicked", 
	`G_CALLBACK
(
İ’_pŞicy_Ú_»move_şick
),…ane);

352 
	`g_sigÇl_cÚÃù
(
·Ã
->
impÜt_bu‰Ú
, "şicked", 
	`G_CALLBACK
(
İ’_pŞicy_Ú_impÜt_şick
),…ane);

353 
	`g_sigÇl_cÚÃù
(
·Ã
->
expÜt_bu‰Ú
, "şicked", 
	`G_CALLBACK
(
İ’_pŞicy_Ú_expÜt_şick
),…ane);

355 
	}
}

357 
	$İ’_pŞicy_š™_v®ue
(
İ’_pŞicy
 *
İ
, cÚ¡ 
­Ş_pŞicy_·th_t
 * 
·th
, 
İ’_pŞicy_·Ã
 *
·Ã
)

359 
­Ş_pŞicy_·th_ty³_e
 
·th_ty³
 = 
	`­Ş_pŞicy_·th_g‘_ty³
(
·th
);

360 cÚ¡ *
´im¬y_·th
 = 
	`­Ş_pŞicy_·th_g‘_´im¬y
(
·th
);

361 
	`gtk_’Œy_£t_‹xt
(
·Ã
->
ba£_’Œy
, 
´im¬y_·th
);

362 
	`gtk_li¡_¡Üe_ş—r
(
·Ã
->
moduË_¡Üe
);

363 ià(
·th_ty³
 =ğ
APOL_POLICY_PATH_TYPE_MONOLITHIC
) {

364 
	`gtk_toggË_bu‰Ú_£t_aùive
(
	`GTK_TOGGLE_BUTTON
(
·Ã
->
mÚŞ™hic_¿dio
), 
TRUE
);

365 } ià(
·th_ty³
 =ğ
APOL_POLICY_PATH_TYPE_MODULAR
) {

366 cÚ¡ 
­Ş_veùÜ_t
 *
moduËs
 = 
	`­Ş_pŞicy_·th_g‘_moduËs
(
·th
);

367 
size_t
 
i
;

368 
	`gtk_toggË_bu‰Ú_£t_aùive
(
	`GTK_TOGGLE_BUTTON
(
·Ã
->
moduÏr_¿dio
), 
TRUE
);

369 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
moduËs
); i++) {

370 *
moduË_·th
 = 
	`­Ş_veùÜ_g‘_–em’t
(
moduËs
, 
i
);

371 ià(
	`İ’_pŞicy_lßd_moduË
(
İ
, 
·Ã
, 
moduË_·th
) < 0) {

377 
	`tİËv–_ERR
(
·Ã
->
İ
->
tİ
, "UnknowÀpŞicy…©hy³ %d.", 
·th_ty³
);

379 
	}
}

381 
	$İ’_pŞicy_š™_v®ues
(
İ’_pŞicy
 *
İ
, cÚ¡ 
­Ş_pŞicy_·th_t
 * 
Üig_·th
,

382 cÚ¡ 
­Ş_pŞicy_·th_t
 * 
mod_·th
)

384 ià(
Üig_·th
 !ğ
NULL
) {

385 
	`İ’_pŞicy_š™_v®ue
(
İ
, 
Üig_·th
, op->
·Ã
 + 
SEDIFFX_POLICY_ORIG
);

387 ià(
mod_·th
 !ğ
NULL
) {

388 
	`İ’_pŞicy_š™_v®ue
(
İ
, 
mod_·th
, op->
·Ã
 + 
SEDIFFX_POLICY_MOD
);

390 
	}
}

399 
­Ş_pŞicy_·th_t
 *
	$İ’_pŞicy_bud_·th
(
İ’_pŞicy_·Ã
 *
·Ã
)

401 cÚ¡ *
´im¬y_·th
 = 
	`gtk_’Œy_g‘_‹xt
(
·Ã
->
ba£_’Œy
);

402 
­Ş_pŞicy_·th_ty³_e
 
·th_ty³
 = 
APOL_POLICY_PATH_TYPE_MONOLITHIC
;

403 
­Ş_veùÜ_t
 *
moduËs
 = 
NULL
;

404 
­Ş_pŞicy_·th_t
 *
·th
 = 
NULL
;

405 ià(
	`gtk_toggË_bu‰Ú_g‘_aùive
(
	`GTK_TOGGLE_BUTTON
(
·Ã
->
moduÏr_¿dio
))) {

406 
·th_ty³
 = 
APOL_POLICY_PATH_TYPE_MODULAR
;

407 
GtkT»eI‹r
 
™”
;

408 ià((
moduËs
 = 
	`­Ş_veùÜ_ü—‹
(
ä“
)è=ğ
NULL
) {

409 
	`tİËv–_ERR
(
·Ã
->
İ
->
tİ
, "%s", 
	`¡»¼Ü
(
”ºo
));

410  
NULL
;

412 ià(
	`gtk_Œ“_mod–_g‘_™”_fœ¡
(
	`GTK_TREE_MODEL
(
·Ã
->
moduË_¡Üe
), &
™”
)) {

414 
GV®ue
 
v®ue
 = { 0 };

415 *
moduË_·th
;

416 
	`gtk_Œ“_mod–_g‘_v®ue
(
	`GTK_TREE_MODEL
(
·Ã
->
moduË_¡Üe
), &
™”
, 
PATH_COLUMN
, &
v®ue
);

417 
moduË_·th
 = 
	`g_v®ue_dup_¡ršg
(&
v®ue
);

418 
	`g_v®ue_un£t
(&
v®ue
);

419 ià(
	`­Ş_veùÜ_­³nd
(
moduËs
, 
moduË_·th
) < 0) {

420 
	`tİËv–_ERR
(
·Ã
->
İ
->
tİ
, "%s", 
	`¡»¼Ü
(
”ºo
));

421 
	`ä“
(
moduË_·th
);

422 
	`­Ş_veùÜ_de¡roy
(&
moduËs
);

423  
NULL
;

425 } 
	`gtk_Œ“_mod–_™”_Ãxt
(
	`GTK_TREE_MODEL
(
·Ã
->
moduË_¡Üe
), &
™”
));

428 
·th
 = 
	`­Ş_pŞicy_·th_ü—‹
(
·th_ty³
, 
´im¬y_·th
, 
moduËs
);

429 
	`­Ş_veùÜ_de¡roy
(&
moduËs
);

430 ià(
·th
 =ğ
NULL
) {

431 
	`tİËv–_ERR
(
·Ã
->
İ
->
tİ
, "%s", 
	`¡»¼Ü
(
”ºo
));

432  
NULL
;

434  
·th
;

435 
	}
}

437 
İ’_pŞicy_Ú_impÜt_şick
(
GtkBu‰Ú
 * 
bu‰Ú
 
__©Œibu‹__
 ((
unu£d
)), 
gpoš‹r
 
u£r_d©a
)

439 
İ’_pŞicy_·Ã
 *
	g·Ã
 = (İ’_pŞicy_·Ã *)
u£r_d©a
;

440 
­Ş_veùÜ_t
 *
	g·ths
 = 
NULL
;

441 
­Ş_pŞicy_·th_t
 *
	gµ©h
 = 
NULL
;

442 cÚ¡ *
	g·th
 = 
NULL
, *
	g´ev_·th
;

443 ià((
	g´ev_·th
 = 
·Ã
->
Ï¡_moduË_·th
è=ğ
NULL
) {

444 
´ev_·th
 = 
gtk_’Œy_g‘_‹xt
(
·Ã
->
ba£_’Œy
);

445 ià(
¡rcmp
(
´ev_·th
, "") == 0) {

446 
´ev_·th
 = 
NULL
;

449 
	g·ths
 = 
ut_İ’_fe
(
GTK_WINDOW
(
·Ã
->
İ
->
dŸlog
), "ImpÜˆPŞicy Li¡", 
´ev_·th
, 1);

450 ià(
	g·ths
 =ğ
NULL
) {

453 
	g·th
 = 
­Ş_veùÜ_g‘_–em’t
(
·ths
, 0);

454 
	gµ©h
 = 
­Ş_pŞicy_·th_ü—‹_äom_fe
(
·th
);

455 ià(
	gµ©h
 =ğ
NULL
) {

456 
tİËv–_ERR
(
·Ã
->
İ
->
tİ
, "E¼Ü impÜtšg…Şicy†i¡ %s: %s", 
·th
, 
¡»¼Ü
(
”ºo
));

457 
	gş—nup
;

459 
İ’_pŞicy_š™_v®ue
(
·Ã
->
İ
, 
µ©h
,…ane);

460 
ä“
(
·Ã
->
Ï¡_moduË_·th
);

461 
	g·Ã
->
	gÏ¡_moduË_·th
 = 
¡rdup
(
·th
);

462 
	gş—nup
:

463 
­Ş_veùÜ_de¡roy
(&
·ths
);

464 
­Ş_pŞicy_·th_de¡roy
(&
µ©h
);

467 
İ’_pŞicy_Ú_expÜt_şick
(
GtkBu‰Ú
 * 
bu‰Ú
 
__©Œibu‹__
 ((
unu£d
)), 
gpoš‹r
 
u£r_d©a
)

469 
İ’_pŞicy_·Ã
 *
	g·Ã
 = (İ’_pŞicy_·Ã *)
u£r_d©a
;

470 *
	g·th
 = 
ut_§ve_fe
(
GTK_WINDOW
(
·Ã
->
İ
->
dŸlog
), "ExpÜˆPŞicy Li¡", 
NULL
);

471 
­Ş_pŞicy_·th_t
 *
	gµ©h
 = 
NULL
;

472 ià(
	g·th
 =ğ
NULL
) {

475 
	gµ©h
 = 
İ’_pŞicy_bud_·th
(
·Ã
);

476 ià(
	gµ©h
 =ğ
NULL
) {

477 
ş—nup
;

479 ià(
­Ş_pŞicy_·th_to_fe
(
µ©h
, 
·th
) < 0) {

480 
tİËv–_ERR
(
·Ã
->
İ
->
tİ
, "E¼ÜƒxpÜtšg…Şicy†i¡ %s: %s", 
·th
, 
¡»¼Ü
(
”ºo
));

482 
	gş—nup
:

483 
g_ä“
(
·th
);

484 
­Ş_pŞicy_·th_de¡roy
(&
µ©h
);

487 
	$İ’_pŞic›s_dŸlog_run
(
tİËv–_t
 * 
tİ
, cÚ¡ 
­Ş_pŞicy_·th_t
 * 
Üig_·th
, cÚ¡‡pŞ_pŞicy_·th_ˆ* 
mod_·th
)

489 
İ’_pŞicy
 
İ
;

490 
gšt
 
»¥Ú£
;

491 
­Ş_pŞicy_·th_t
 *
šput
[
SEDIFFX_POLICY_NUM
];

493 
	`mem£t
(&
İ
, 0, (op));

494 
İ
.
tİ
 =op;

495 
İ
.
xml
 = 
	`gÏde_xml_Ãw
(
	`tİËv–_g‘_gÏde_xml
(
tİ
), "PŞic›sO³nWšdow", 
NULL
);

496 
İ
.
·Ã
[
SEDIFFX_POLICY_ORIG
].op = &op;

497 
İ
.
·Ã
[
SEDIFFX_POLICY_MOD
].op = &op;

499 
	`İ’_pŞicy_š™_widg‘s
(&
İ
);

500 
	`İ’_pŞicy_š™_sigÇls
(&
İ
);

501 
	`İ’_pŞicy_š™_v®ues
(&
İ
, 
Üig_·th
, 
mod_·th
);

502 
	`İ’_pŞicy_Ú_’Œy_ev’t_aá”
(
NULL
, NULL, &
İ
);

505 
»¥Ú£
 = 
	`gtk_dŸlog_run
(
İ
.
dŸlog
);

506 ià(
»¥Ú£
 =ğ
GTK_RESPONSE_CANCEL
 ||„e¥Ú£ =ğ
GTK_RESPONSE_DELETE_EVENT
) {

509 ià((
šput
[
SEDIFFX_POLICY_ORIG
] = 
	`İ’_pŞicy_bud_·th
(&
İ
.
·Ã
[SEDIFFX_POLICY_ORIG])è=ğ
NULL
 ||

510 (
šput
[
SEDIFFX_POLICY_MOD
] = 
	`İ’_pŞicy_bud_·th
(&
İ
.
·Ã
[SEDIFFX_POLICY_MOD])è=ğ
NULL
) {

513 ià(
	`tİËv–_İ’_pŞic›s
(
İ
.
tİ
, 
šput
[
SEDIFFX_POLICY_ORIG
], iÅut[
SEDIFFX_POLICY_MOD
]) == 0) {

517 
	`gtk_widg‘_de¡roy
(
	`GTK_WIDGET
(
İ
.
dŸlog
));

518 
	`ä“
(
İ
.
·Ã
[
SEDIFFX_POLICY_ORIG
].
Ï¡_moduË_·th
);

519 
	`ä“
(
İ
.
·Ã
[
SEDIFFX_POLICY_MOD
].
Ï¡_moduË_·th
);

520 
	`g_objeù_uÄef
(
İ
.
·Ã
[
SEDIFFX_POLICY_ORIG
].
moduË_¡Üe
);

521 
	`g_objeù_uÄef
(
İ
.
·Ã
[
SEDIFFX_POLICY_MOD
].
moduË_¡Üe
);

523 ià(
»¥Ú£
 == 0) {

525 
	`tİËv–_run_diff
(
İ
.
tİ
);

527 
	}
}

	@sediff/open_policies_dialog.h

27 #iâdeà
OPEN_POLICIES_DIALOG_H


28 
	#OPEN_POLICIES_DIALOG_H


	)

30 
	~"tİËv–.h
"

31 
	~<­Ş/pŞicy-·th.h
>

43 
İ’_pŞic›s_dŸlog_run
(
tİËv–_t
 * 
tİ
, cÚ¡ 
­Ş_pŞicy_·th_t
 * 
Üig_·th
, cÚ¡‡pŞ_pŞicy_·th_ˆ* 
mod_·th
);

	@sediff/policy_view.c

27 
	~<cÚfig.h
>

29 
	~"pŞicy_v›w.h
"

30 
	~"utgui.h
"

32 
	~<as£¹.h
>

33 
	~<”ºo.h
>

34 
	~<fú.h
>

35 
	~<¡dlib.h
>

36 
	~<¡ršg.h
>

37 
	~<uni¡d.h
>

38 
	~<sys/mmª.h
>

39 
	~<sys/¡©.h
>

40 
	~<sys/ty³s.h
>

41 
	~<gÏde/gÏde.h
>

43 
	spŞicy_v›w


45 
tİËv–_t
 *
	mtİ
;

46 
£diffx_pŞicy_e
 
	mwhich
;

47 
GÏdeXML
 *
	mxml
;

48 
GtkTextBufãr
 *
	m¡©s
, *
	msourû
;

49 
GtkTextV›w
 *
	m¡©s_v›w
, *
	msourû_v›w
;

50 
GtkNÙebook
 *
	mnÙebook
;

51 
GtkLab–
 *
	mlše_numb”
;

52 *
	mmm­_¡¬t
;

53 
size_t
 
	mmm­_Ëngth
;

56 cÚ¡ *
	gpŞicy_v›w_widg‘_Çmes
[
SEDIFFX_POLICY_NUM
][3] = {

68 
pŞicy_v›w_nÙebook_Ú_ev’t_aá”
(
GtkWidg‘
 * 
widg‘
 
__©Œibu‹__
 ((
unu£d
)), 
GdkEv’t
 * 
ev’t


69 
__©Œibu‹__
 ((
unu£d
)), 
gpoš‹r
 
u£r_d©a
)

71 
pŞicy_v›w_t
 *
	gv›w
 = (pŞicy_v›w_ˆ*è
u£r_d©a
;

72 
gušt
 
	gmaš_·g’um
, 
	gv›w_·g’um
;

73 
GtkTextM¬k
 *
	gm¬k
 = 
NULL
;

74 
GtkTextI‹r
 
	g™”
;

76 
	gmaš_·g’um
 = 
tİËv–_g‘_nÙebook_·ge
(
v›w
->
tİ
);

77 
	gv›w_·g’um
 = 
gtk_nÙebook_g‘_cu¼’t_·ge
(
v›w
->
nÙebook
);

78 ià(
	gmaš_·g’um
 =ğ1 + 
v›w
->
which
 && 
v›w_·g’um
 == 1) {

79 
m¬k
 = 
gtk_‹xt_bufãr_g‘_š£¹
(
v›w
->
sourû
);

80 ià(
	gm¬k
 !ğ
NULL
) {

81 
GSŒšg
 *
¡ršg
 = 
g_¡ršg_Ãw
("");

82 
gtk_‹xt_bufãr_g‘_™”_©_m¬k
(
v›w
->
sourû
, &
™”
, 
m¬k
);

83 
g_¡ršg_´štf
(
¡ršg
, "Lše: %d", 
gtk_‹xt_™”_g‘_lše
(&
™”
) + 1);

84 
gtk_Ïb–_£t_‹xt
(
v›w
->
lše_numb”
, 
¡ršg
->
¡r
);

85 
g_¡ršg_ä“
(
¡ršg
, 
TRUE
);

88 
gtk_Ïb–_£t_‹xt
(
v›w
->
lše_numb”
, "");

92 
pŞicy_v›w_t
 *
	$pŞicy_v›w_ü—‹
(
tİËv–_t
 * 
tİ
, 
£diffx_pŞicy_e
 
which
)

94 
pŞicy_v›w_t
 *
v›w
;

95 
GtkTextTag
 *
mÚo_g
;

96 
”rÜ
 = 0;

98 ià((
v›w
 = 
	`ÿÎoc
(1, (*v›w))è=ğ
NULL
) {

99 
”rÜ
 = 
”ºo
;

100 
ş—nup
;

102 
v›w
->
tİ
 =op;

103 
v›w
->
which
 = which;

105 
v›w
->
xml
 = 
	`gÏde_g‘_widg‘_Œ“
(
	`GTK_WIDGET
(
	`tİËv–_g‘_wšdow
(v›w->
tİ
)));

106 
v›w
->
¡©s
 = 
	`gtk_‹xt_bufãr_Ãw
(
NULL
);

107 
v›w
->
sourû
 = 
	`gtk_‹xt_bufãr_Ãw
(
NULL
);

108 
mÚo_g
 = 
	`gtk_‹xt_bufãr_ü—‹_g
(
v›w
->
sourû
, "mono-tag",

109 "¡yË", 
PANGO_STYLE_NORMAL
,

110 "weight", 
PANGO_WEIGHT_NORMAL
, "çmy", "mÚo¥aû", 
NULL
);

112 
v›w
->
¡©s_v›w
 = 
	`GTK_TEXT_VIEW
(
	`gÏde_xml_g‘_widg‘
(v›w->
xml
, 
pŞicy_v›w_widg‘_Çmes
[v›w->
which
][0]));

113 
v›w
->
sourû_v›w
 = 
	`GTK_TEXT_VIEW
(
	`gÏde_xml_g‘_widg‘
(v›w->
xml
, 
pŞicy_v›w_widg‘_Çmes
[v›w->
which
][1]));

114 
	`as£¹
(
v›w
->
¡©s_v›w
 !ğ
NULL
 && v›w->
sourû_v›w
 != NULL);

115 
	`gtk_‹xt_v›w_£t_bufãr
(
v›w
->
¡©s_v›w
, v›w->
¡©s
);

116 
	`gtk_‹xt_v›w_£t_bufãr
(
v›w
->
sourû_v›w
, v›w->
sourû
);

118 
v›w
->
nÙebook
 = 
	`GTK_NOTEBOOK
(
	`gÏde_xml_g‘_widg‘
(v›w->
xml
, 
pŞicy_v›w_widg‘_Çmes
[v›w->
which
][2]));

119 
v›w
->
lše_numb”
 = 
	`GTK_LABEL
(
	`gÏde_xml_g‘_widg‘
(v›w->
xml
, "toplevel†ine†abel"));

120 
	`as£¹
(
v›w
->
nÙebook
 !ğ
NULL
 && v›w->
lše_numb”
 != NULL);

121 
	`g_sigÇl_cÚÃù_aá”
(
	`G_OBJECT
(
v›w
->
nÙebook
), "ev’t-aá”", 
	`G_CALLBACK
(
pŞicy_v›w_nÙebook_Ú_ev’t_aá”
), view);

123 
ş—nup
:

124 ià(
”rÜ
 != 0) {

125 
	`pŞicy_v›w_de¡roy
(&
v›w
);

126 
”ºo
 = 
”rÜ
;

127  
NULL
;

129  
v›w
;

130 
	}
}

132 
	$pŞicy_v›w_de¡roy
(
pŞicy_v›w_t
 ** 
v›w
)

134 ià(
v›w
 !ğ
NULL
 && *view != NULL) {

135 
	`ä“
(*
v›w
);

136 *
v›w
 = 
NULL
;

138 
	}
}

148 
	$pŞicy_v›w_¡©s_upd©e
(
pŞicy_v›w_t
 * 
v›w
, 
­Ş_pŞicy_t
 * 
p
, 
­Ş_pŞicy_·th_t
 * 
·th
)

150 
GtkTextI‹r
 
™”
;

151 
gch¬
 *
cÚ‹Ás
 = 
NULL
;

152 *
·th_desc
, *
tmp
 = 
NULL
;

153 
size_t
 
num_şas£s
 = 0,

154 
num_commÚs
 = 0,

155 
num_³rms
 = 0,

156 
num_ty³s
 = 0,

157 
num_©Œibs
 = 0,

158 
num_®low
 = 0, 
num_aud™®low
 = 0, 
num_dÚud™
 = 0,

159 
num_ty³_chªge
 = 0, 
num_ty³_memb”
, 
num_ty³_Œªs
 = 0,

160 
num_rŞes
 = 0, 
num_rŞ—Îow
 = 0, 
num_rŞe_Œªs
 = 0, 
num_u£rs
 = 0, 
num_boŞs
 = 0;

161 
­Ş_veùÜ_t
 *
vec
 = 
NULL
;

162 
qpŞ_™”©Ü_t
 *
i
 = 
NULL
;

163 
qpŞ_pŞicy_t
 *
q
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
p
);

165 
	`ut_‹xt_bufãr_ş—r
(
v›w
->
¡©s
);

167 ià((
·th_desc
 = 
	`ut_pŞicy_·th_to_fuÎ_¡ršg
(
·th
)è=ğ
NULL
) {

168 
	`tİËv–_ERR
(
v›w
->
tİ
, "%s", 
	`¡»¼Ü
(
”ºo
));

171 
tmp
 = 
	`­Ş_pŞicy_g‘_v”siÚ_ty³_mls_¡r
(
p
);

172 
cÚ‹Ás
 = 
	`g_¡rdup_´štf
("PŞicy: %s\n" "PŞicy V”siÚ & Ty³: %s\n", 
·th_desc
, 
tmp
);

173 
	`ä“
(
·th_desc
);

174 
	`ä“
(
tmp
);

175 
tmp
 = 
NULL
;

176 
	`gtk_‹xt_bufãr_g‘_’d_™”
(
v›w
->
¡©s
, &
™”
);

177 
	`gtk_‹xt_bufãr_š£¹
(
v›w
->
¡©s
, &
™”
, 
cÚ‹Ás
, -1);

178 
	`g_ä“
(
cÚ‹Ás
);

180 
	`­Ş_şass_g‘_by_qu”y
(
p
, 
NULL
, &
vec
);

181 
num_şas£s
 = 
	`­Ş_veùÜ_g‘_size
(
vec
);

182 
	`­Ş_veùÜ_de¡roy
(&
vec
);

184 
	`­Ş_commÚ_g‘_by_qu”y
(
p
, 
NULL
, &
vec
);

185 
num_commÚs
 = 
	`­Ş_veùÜ_g‘_size
(
vec
);

186 
	`­Ş_veùÜ_de¡roy
(&
vec
);

188 
	`­Ş_³rm_g‘_by_qu”y
(
p
, 
NULL
, &
vec
);

189 
num_³rms
 = 
	`­Ş_veùÜ_g‘_size
(
vec
);

190 
	`­Ş_veùÜ_de¡roy
(&
vec
);

192 
cÚ‹Ás
 = 
	`g_¡rdup_´štf
("\nNumber of Classes‡nd Permissions:\n"

194 "\tCommÚ CÏs£s: %zd\n" "\tP”missiÚs: %zd\n", 
num_şas£s
, 
num_commÚs
, 
num_³rms
);

195 
	`gtk_‹xt_bufãr_š£¹
(
v›w
->
¡©s
, &
™”
, 
cÚ‹Ás
, -1);

196 
	`g_ä“
(
cÚ‹Ás
);

198 
	`­Ş_ty³_g‘_by_qu”y
(
p
, 
NULL
, &
vec
);

199 
num_ty³s
 = 
	`­Ş_veùÜ_g‘_size
(
vec
);

200 
	`­Ş_veùÜ_de¡roy
(&
vec
);

202 
	`­Ş_©Œ_g‘_by_qu”y
(
p
, 
NULL
, &
vec
);

203 
num_©Œibs
 = 
	`­Ş_veùÜ_g‘_size
(
vec
);

204 
	`­Ş_veùÜ_de¡roy
(&
vec
);

206 
cÚ‹Ás
 = 
	`g_¡rdup_´štf
("\nNumber of Types‡nd Attributes:\n"

207 "\tTy³s: %zd\n" "\tA‰ribu‹s: %zd\n", 
num_ty³s
, 
num_©Œibs
);

208 
	`gtk_‹xt_bufãr_š£¹
(
v›w
->
¡©s
, &
™”
, 
cÚ‹Ás
, -1);

209 
	`g_ä“
(
cÚ‹Ás
);

211 
	`qpŞ_pŞicy_g‘_avruË_™”
(
q
, 
QPOL_RULE_ALLOW
, &
i
);

212 
	`qpŞ_™”©Ü_g‘_size
(
i
, &
num_®low
);

213 
	`qpŞ_™”©Ü_de¡roy
(&
i
);

215 
	`qpŞ_pŞicy_g‘_avruË_™”
(
q
, 
QPOL_RULE_AUDITALLOW
, &
i
);

216 
	`qpŞ_™”©Ü_g‘_size
(
i
, &
num_aud™®low
);

217 
	`qpŞ_™”©Ü_de¡roy
(&
i
);

219 
	`qpŞ_pŞicy_g‘_avruË_™”
(
q
, 
QPOL_RULE_DONTAUDIT
, &
i
);

220 
	`qpŞ_™”©Ü_g‘_size
(
i
, &
num_dÚud™
);

221 
	`qpŞ_™”©Ü_de¡roy
(&
i
);

223 
	`qpŞ_pŞicy_g‘_‹ruË_™”
(
q
, 
QPOL_RULE_TYPE_CHANGE
, &
i
);

224 
	`qpŞ_™”©Ü_g‘_size
(
i
, &
num_ty³_chªge
);

225 
	`qpŞ_™”©Ü_de¡roy
(&
i
);

227 
	`qpŞ_pŞicy_g‘_‹ruË_™”
(
q
, 
QPOL_RULE_TYPE_MEMBER
, &
i
);

228 
	`qpŞ_™”©Ü_g‘_size
(
i
, &
num_ty³_memb”
);

229 
	`qpŞ_™”©Ü_de¡roy
(&
i
);

231 
	`qpŞ_pŞicy_g‘_‹ruË_™”
(
q
, 
QPOL_RULE_TYPE_TRANS
, &
i
);

232 
	`qpŞ_™”©Ü_g‘_size
(
i
, &
num_ty³_Œªs
);

233 
	`qpŞ_™”©Ü_de¡roy
(&
i
);

235 
cÚ‹Ás
 = 
	`g_¡rdup_´štf
("\nNumber of Rules:\n"

243 
num_®low
, 
num_aud™®low
, 
num_dÚud™
, 
num_ty³_chªge
, 
num_ty³_memb”
, 
num_ty³_Œªs
);

244 
	`gtk_‹xt_bufãr_š£¹
(
v›w
->
¡©s
, &
™”
, 
cÚ‹Ás
, -1);

245 
	`g_ä“
(
cÚ‹Ás
);

247 
	`­Ş_rŞe_g‘_by_qu”y
(
p
, 
NULL
, &
vec
);

248 
num_rŞes
 = 
	`­Ş_veùÜ_g‘_size
(
vec
);

249 
	`­Ş_veùÜ_de¡roy
(&
vec
);

251 
	`qpŞ_pŞicy_g‘_rŞe_®low_™”
(
q
, &
i
);

252 
	`qpŞ_™”©Ü_g‘_size
(
i
, &
num_rŞ—Îow
);

253 
	`qpŞ_™”©Ü_de¡roy
(&
i
);

255 
	`qpŞ_pŞicy_g‘_rŞe_Œªs_™”
(
q
, &
i
);

256 
	`qpŞ_™”©Ü_g‘_size
(
i
, &
num_rŞ—Îow
);

257 
	`qpŞ_™”©Ü_de¡roy
(&
i
);

259 
cÚ‹Ás
 = 
	`g_¡rdup_´štf
("\nNumber of Roles: %zd\n"

261 "\Îow: %zd\n" "\ŒŞe_Œªs™iÚ %zd\n", 
num_rŞes
, 
num_rŞ—Îow
, 
num_rŞe_Œªs
);

262 
	`gtk_‹xt_bufãr_š£¹
(
v›w
->
¡©s
, &
™”
, 
cÚ‹Ás
, -1);

263 
	`g_ä“
(
cÚ‹Ás
);

265 
	`­Ş_u£r_g‘_by_qu”y
(
p
, 
NULL
, &
vec
);

266 
num_u£rs
 = 
	`­Ş_veùÜ_g‘_size
(
vec
);

267 
	`­Ş_veùÜ_de¡roy
(&
vec
);

269 
	`­Ş_boŞ_g‘_by_qu”y
(
p
, 
NULL
, &
vec
);

270 
num_boŞs
 = 
	`­Ş_veùÜ_g‘_size
(
vec
);

271 
	`­Ş_veùÜ_de¡roy
(&
vec
);

273 
cÚ‹Ás
 = 
	`g_¡rdup_´štf
("\nNumb” oàU£rs: %zd\n" "\nNumb” oàBoŞ—ns: %zd\n", 
num_u£rs
, 
num_boŞs
);

274 
	`gtk_‹xt_bufãr_š£¹
(
v›w
->
¡©s
, &
™”
, 
cÚ‹Ás
, -1);

275 
	`g_ä“
(
cÚ‹Ás
);

276 
	}
}

288 
	$pŞicy_v›w_sourû_upd©e
(
pŞicy_v›w_t
 * 
v›w
, 
­Ş_pŞicy_t
 * 
p
, 
­Ş_pŞicy_·th_t
 * 
·th
)

290 cÚ¡ *
´im¬y_·th
;

291 
	`ut_‹xt_bufãr_ş—r
(
v›w
->
sourû
);

294 ià(
v›w
->
mm­_¡¬t
 !ğ
NULL
) {

295 
	`munm­
(
v›w
->
mm­_¡¬t
, v›w->
mm­_Ëngth
);

296 
v›w
->
mm­_¡¬t
 = 
NULL
;

297 
v›w
->
mm­_Ëngth
 = 0;

299 ià(
p
 =ğ
NULL
) {

300 
	`gtk_‹xt_bufãr_£t_‹xt
(
v›w
->
sourû
, "No…olicy has been†oaded.", -1);

303 
´im¬y_·th
 = 
	`­Ş_pŞicy_·th_g‘_´im¬y
(
·th
);

304 ià(!
	`qpŞ_pŞicy_has_ÿ·b™y
(
	`­Ş_pŞicy_g‘_qpŞ
(
p
), 
QPOL_CAP_SOURCE
)) {

305 
GSŒšg
 *
¡ršg
 = 
	`g_¡ršg_Ãw
("");

306 
	`g_¡ršg_´štf
(
¡ršg
, "PŞicy f% i nÙ‡ sourû…Şicy.", 
´im¬y_·th
);

307 
	`gtk_‹xt_bufãr_£t_‹xt
(
v›w
->
sourû
, 
¡ršg
->
¡r
, -1);

308 
	`g_¡ršg_ä“
(
¡ršg
, 
TRUE
);

311 
¡©
 
¡©buf
;

312 
fd
;

314 ià((
fd
 = 
	`İ’
(
´im¬y_·th
, 
O_RDONLY
)) < 0) {

315 
	`tİËv–_ERR
(
v›w
->
tİ
, "Could‚Ù o³À% fÜ„—dšg: %s", 
´im¬y_·th
, 
	`¡»¼Ü
(
”ºo
));

318 ià(
	`f¡©
(
fd
, &
¡©buf
) < 0) {

319 
	`tİËv–_ERR
(
v›w
->
tİ
, "Could‚Ù sˆ%s: %s", 
´im¬y_·th
, 
	`¡»¼Ü
(
”ºo
));

320 
	`şo£
(
fd
);

324 
v›w
->
mm­_Ëngth
 = 
¡©buf
.
¡_size
;

325 ià((
v›w
->
mm­_¡¬t
 = 
	`mm­
(0, 
¡©buf
.
¡_size
, 
PROT_READ
, 
MAP_PRIVATE
, 
fd
, 0)è=ğ
MAP_FAILED
) {

326 
	`tİËv–_ERR
(
v›w
->
tİ
, "Could‚Ù mm­ %s: %s", 
´im¬y_·th
, 
	`¡»¼Ü
(
”ºo
));

327 
	`şo£
(
fd
);

328 
v›w
->
mm­_¡¬t
 = 
NULL
;

331 
	`şo£
(
fd
);

332 
	`gtk_‹xt_bufãr_£t_‹xt
(
v›w
->
sourû
, v›w->
mm­_¡¬t
, v›w->
mm­_Ëngth
);

334 
	}
}

336 
	$pŞicy_v›w_upd©e
(
pŞicy_v›w_t
 * 
v›w
, 
­Ş_pŞicy_t
 * 
pŞicy
, 
­Ş_pŞicy_·th_t
 * 
·th
)

338 
	`pŞicy_v›w_¡©s_upd©e
(
v›w
, 
pŞicy
, 
·th
);

339 
	`pŞicy_v›w_sourû_upd©e
(
v›w
, 
pŞicy
, 
·th
);

340 
	}
}

342 
	$pŞicy_v›w_show_pŞicy_lše
(
pŞicy_v›w_t
 * 
v›w
, 
lše
)

344 
GtkTextTagTabË
 *
bË
 = 
NULL
;

345 
GtkTextI‹r
 
™”
, 
’d_™”
;

346 
GtkTextM¬k
 *
m¬k
 = 
NULL
;

347 
GSŒšg
 *
¡ršg
 = 
	`g_¡ršg_Ãw
("");

349 
	`gtk_nÙebook_£t_cu¼’t_·ge
(
v›w
->
nÙebook
, 1);

355 
bË
 = 
	`gtk_‹xt_bufãr_g‘_g_bË
(
v›w
->
sourû
);

356 
	`gtk_‹xt_bufãr_g‘_¡¬t_™”
(
v›w
->
sourû
, &
™”
);

357 
	`gtk_‹xt_™”_£t_lše
(&
™”
, 
lše
);

358 
	`gtk_‹xt_bufãr_g‘_¡¬t_™”
(
v›w
->
sourû
, &
’d_™”
);

359 
	`gtk_‹xt_™”_£t_lše
(&
’d_™”
, 
lše
);

360 !
	`gtk_‹xt_™”_’ds_lše
(&
’d_™”
)) {

361 
	`gtk_‹xt_™”_fÜw¬d_ch¬
(&
’d_™”
);

364 
m¬k
 = 
	`gtk_‹xt_bufãr_ü—‹_m¬k
(
v›w
->
sourû
, "lše-pos™iÚ", &
™”
, 
TRUE
);

365 
	`as£¹
(
m¬k
);

366 
	`gtk_‹xt_v›w_süŞl_to_m¬k
(
v›w
->
sourû_v›w
, 
m¬k
, 0.0, 
TRUE
, 0.0, 0.5);

371 
	`gtk_‹xt_bufãr_d–‘e_m¬k
(
v›w
->
sourû
, 
m¬k
);

372 
	`gtk_‹xt_v›w_£t_cursÜ_visibË
(
v›w
->
sourû_v›w
, 
TRUE
);

373 
	`gtk_‹xt_bufãr_¶aû_cursÜ
(
v›w
->
sourû
, &
™”
);

374 
	`gtk_‹xt_bufãr_£Ëù_¿nge
(
v›w
->
sourû
, &
™”
, &
’d_™”
);

376 
	`gtk_cÚš”_£t_focus_chd
(
	`GTK_CONTAINER
(
v›w
->
nÙebook
), 
	`GTK_WIDGET
(v›w->
sourû_v›w
));

378 
	`g_¡ršg_´štf
(
¡ršg
, "Lše: %d", 
	`gtk_‹xt_™”_g‘_lše
(&
™”
) + 1);

379 
	`gtk_Ïb–_£t_‹xt
(
v›w
->
lše_numb”
, 
¡ršg
->
¡r
);

380 
	`g_¡ršg_ä“
(
¡ršg
, 
TRUE
);

381 
	}
}

383 
GtkTextV›w
 *
	$pŞicy_v›w_g‘_‹xt_v›w
(
pŞicy_v›w_t
 * 
v›w
)

385 
gšt
 
·g’um
 = 
	`gtk_nÙebook_g‘_cu¼’t_·ge
(
v›w
->
nÙebook
);

386 ià(
·g’um
 == 0) {

387  
v›w
->
¡©s_v›w
;

389  
v›w
->
sourû_v›w
;

391 
	}
}

	@sediff/policy_view.h

26 #iâdeà
POLICY_VIEW_H


27 
	#POLICY_VIEW_H


	)

29 
	~"£diffx.h
"

30 
	~"tİËv–.h
"

32 
pŞicy_v›w
 
	tpŞicy_v›w_t
;

45 
pŞicy_v›w_t
 *
pŞicy_v›w_ü—‹
(
tİËv–_t
 * 
tİ
, 
£diffx_pŞicy_e
 
which
);

54 
pŞicy_v›w_de¡roy
(
pŞicy_v›w_t
 ** 
v›w
);

64 
pŞicy_v›w_upd©e
(
pŞicy_v›w_t
 * 
v›w
, 
­Ş_pŞicy_t
 * 
pŞicy
, 
­Ş_pŞicy_·th_t
 * 
·th
);

73 
pŞicy_v›w_show_pŞicy_lše
(
pŞicy_v›w_t
 * 
v›w
, 
lše
);

82 
GtkTextV›w
 *
pŞicy_v›w_g‘_‹xt_v›w
(
pŞicy_v›w_t
 * 
v›w
);

	@sediff/progress.c

26 
	~<cÚfig.h
>

28 
	~"´og»ss.h
"

29 
	~"utgui.h
"

31 
	~<gtk/gtk.h
>

32 
	~<glib.h
>

33 
	~<glib/g´štf.h
>

35 
	s´og»ss


37 
tİËv–_t
 *
	mtİ
;

38 
GtkWidg‘
 *
	m´og»ss
;

39 
GtkWidg‘
 *
	mÏb–1
, *
	mÏb–2
;

40 *
	ms
;

41 
	mdÚe
;

42 
GCÚd
 *
	mcÚd
;

43 
GMu‹x
 *
	mmu‹x
;

46 
´og»ss_t
 *
	$´og»ss_ü—‹
(
tİËv–_t
 * 
tİ
)

48 
´og»ss_t
 *
p
;

49 
GtkWidg‘
 *
vbox
;

51 ià((
p
 = 
	`ÿÎoc
(1, (*p))è=ğ
NULL
) {

52  
NULL
;

54 
p
->
tİ
 =op;

55 
p
->
´og»ss
 = 
	`gtk_wšdow_Ãw
(
GTK_WINDOW_TOPLEVEL
);

56 
	`gtk_wšdow_£t_mod®
(
	`GTK_WINDOW
(
p
->
´og»ss
), 
TRUE
);

57 
	`gtk_wšdow_£t_Œªs›Á_fÜ
(
	`GTK_WINDOW
(
p
->
´og»ss
), 
	`tİËv–_g‘_wšdow
(
tİ
));

58 
	`gtk_wšdow_£t_deçuÉ_size
(
	`GTK_WINDOW
(
p
->
´og»ss
), 300, 100);

59 
vbox
 = 
	`gtk_vbox_Ãw
(
FALSE
, 2);

60 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
p
->
´og»ss
), 
vbox
);

61 
p
->
Ïb–1
 = 
	`gtk_Ïb–_Ãw
(
NULL
);

62 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
vbox
), 
p
->
Ïb–1
);

63 
p
->
Ïb–2
 = 
	`gtk_Ïb–_Ãw
(
NULL
);

64 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
vbox
), 
p
->
Ïb–2
);

65 
	`gtk_widg‘_show
(
p
->
Ïb–1
);

66 
	`gtk_widg‘_show
(
p
->
Ïb–2
);

67 
	`gtk_widg‘_show
(
vbox
);

68 
	`ut_cursÜ_wa™
(
p
->
´og»ss
);

69 
p
->
cÚd
 = 
	`g_cÚd_Ãw
();

70 
p
->
mu‹x
 = 
	`g_mu‹x_Ãw
();

71  
p
;

72 
	}
}

74 
	$´og»ss_de¡roy
(
´og»ss_t
 ** 
´og»ss
)

76 ià(
´og»ss
 !ğ
NULL
 && *progress != NULL) {

77 
	`ä“
((*
´og»ss
)->
s
);

78 
	`g_cÚd_ä“
((*
´og»ss
)->
cÚd
);

79 
	`g_mu‹x_ä“
((*
´og»ss
)->
mu‹x
);

80 
	`ä“
(*
´og»ss
);

81 *
´og»ss
 = 
NULL
;

83 
	}
}

85 
	$´og»ss_show
(
´og»ss_t
 * 
´og»ss
, cÚ¡ *
t™Ë
)

87 
	`gtk_Ïb–_£t_‹xt
(
	`GTK_LABEL
(
´og»ss
->
Ïb–1
), 
t™Ë
);

88 
	`gtk_Ïb–_£t_‹xt
(
	`GTK_LABEL
(
´og»ss
->
Ïb–2
), "");

89 
	`gtk_widg‘_show
(
´og»ss
->progress);

90 
	`gtk_wšdow_deicÚify
(
	`GTK_WINDOW
(
´og»ss
->progress));

91 
	`gtk_wšdow_£t_t™Ë
(
	`GTK_WINDOW
(
´og»ss
->´og»ss), 
t™Ë
);

92 
´og»ss
->
dÚe
 = 0;

93 
	}
}

95 
	$´og»ss_hide
(
´og»ss_t
 * 
´og»ss
)

97 
	`gtk_widg‘_hide
(
´og»ss
->progress);

98 
	}
}

100 
	$´og»ss_wa™
(
´og»ss_t
 * 
´og»ss
)

102 
gšt64
 
wa™_time
;

103 
	`g_mu‹x_lock
(
´og»ss
->
mu‹x
);

104 !
´og»ss
->
dÚe
) {

105 ià(
´og»ss
->
s
 !ğ
NULL
) {

106 
	`gtk_Ïb–_£t_‹xt
(
	`GTK_LABEL
(
´og»ss
->
Ïb–2
),…rog»ss->
s
);

107 
	`ä“
(
´og»ss
->
s
);

108 
´og»ss
->
s
 = 
NULL
;

113 
	`gtk_maš_™”©iÚ_do
(
FALSE
);

114 
wa™_time
 = 
	`g_g‘_mÚÙÚic_time
 () + 50000;

115 
	`g_cÚd_wa™_uÁ
(
´og»ss
->
cÚd
,…rog»ss->
mu‹x
, 
wa™_time
);

117 
	`g_mu‹x_uÆock
(
´og»ss
->
mu‹x
);

118 ià(
´og»ss
->
dÚe
 < 0) {

119 
	`tİËv–_ERR
(
´og»ss
->
tİ
, 
	`GTK_LABEL
Õrog»ss->
Ïb–2
)->
Ïb–
);

120  
´og»ss
->
dÚe
;

121 } ià(
´og»ss
->
dÚe
 > 1) {

122 
	`tİËv–_WARN
(
´og»ss
->
tİ
, 
	`GTK_LABEL
Õrog»ss->
Ïb–2
)->
Ïb–
);

123  
´og»ss
->
dÚe
 - 1;

125 
´og»ss
->
dÚe
 = 0;

128 
	}
}

130 
	$´og»ss_dÚe
(
´og»ss_t
 * 
´og»ss
)

132 
	`g_mu‹x_lock
(
´og»ss
->
mu‹x
);

133 
´og»ss
->
dÚe
 = 1;

134 
	`g_cÚd_sigÇl
(
´og»ss
->
cÚd
);

135 
	`g_mu‹x_uÆock
(
´og»ss
->
mu‹x
);

136 
	}
}

138 
	$´og»ss_w¬n
(
´og»ss_t
 * 
´og»ss
, *
»asÚ
, ...)

140 
gch¬
 *
s
;

141 
va_li¡
 
­
;

142 
	`g_mu‹x_lock
(
´og»ss
->
mu‹x
);

143 ià(
»asÚ
 !ğ
NULL
) {

144 
	`va_¡¬t
(
­
, 
»asÚ
);

145 
	`g_va¥rštf
(&
s
, 
»asÚ
, 
­
);

146 
	`ä“
(
´og»ss
->
s
);

147 
´og»ss
->
s
 = s;

148 
	`va_’d
(
­
);

150 
´og»ss
->
dÚe
 = 2;

151 
	`g_cÚd_sigÇl
(
´og»ss
->
cÚd
);

152 
	`g_mu‹x_uÆock
(
´og»ss
->
mu‹x
);

153 
	}
}

155 
	$´og»ss_abÜt
(
´og»ss_t
 * 
´og»ss
, *
»asÚ
, ...)

157 
gch¬
 *
s
;

158 
va_li¡
 
­
;

159 
	`g_mu‹x_lock
(
´og»ss
->
mu‹x
);

160 ià(
»asÚ
 !ğ
NULL
) {

161 
	`va_¡¬t
(
­
, 
»asÚ
);

162 
	`g_va¥rštf
(&
s
, 
»asÚ
, 
­
);

163 
	`ä“
(
´og»ss
->
s
);

164 
´og»ss
->
s
 = s;

165 
	`va_’d
(
­
);

167 
´og»ss
->
dÚe
 = -1;

168 
	`g_cÚd_sigÇl
(
´og»ss
->
cÚd
);

169 
	`g_mu‹x_uÆock
(
´og»ss
->
mu‹x
);

170 
	}
}

172 
	$´og»ss_upd©e_Ïb–
(
´og»ss_t
 * 
´og»ss
, cÚ¡ *
fmt
, 
va_li¡
 
va_¬gs
)

174 
gch¬
 *
s
 = 
NULL
;

175 
	`g_va¥rštf
(&
s
, 
fmt
, 
va_¬gs
);

176 
	`g_mu‹x_lock
(
´og»ss
->
mu‹x
);

177 
	`ä“
(
´og»ss
->
s
);

178 
´og»ss
->
s
 = s;

179 
	`g_cÚd_sigÇl
(
´og»ss
->
cÚd
);

180 
	`g_mu‹x_uÆock
(
´og»ss
->
mu‹x
);

181 
	}
}

183 
	$´og»ss_upd©e
(
´og»ss_t
 * 
´og»ss
, *
fmt
, ...)

185 
va_li¡
 
­
;

186 
	`va_¡¬t
(
­
, 
fmt
);

187 
	`´og»ss_upd©e_Ïb–
(
´og»ss
, 
fmt
, 
­
);

188 
	`va_’d
(
­
);

189 
	}
}

191 
´og»ss_pŞdiff_hªdË_func
(*
¬g
, cÚ¡ 
pŞdiff_t
 * 
diff
 
__©Œibu‹__
 ((
unu£d
)), 
Ëv–


192 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ *
fmt
, 
va_li¡
 
va_¬gs
)

194 
´og»ss_t
 *
	g´og»ss
 = 
¬g
;

195 
´og»ss_upd©e_Ïb–
(
´og»ss
, 
fmt
, 
va_¬gs
);

198 
´og»ss_­Ş_hªdË_func
(*
v¬g
, cÚ¡ 
­Ş_pŞicy_t
 * 
p
 
__©Œibu‹__
 ((
unu£d
)), 
Ëv–


199 
__©Œibu‹__
 ((
unu£d
)), cÚ¡ *
fmt
, 
va_li¡
 
¬gp
)

201 
´og»ss_t
 *
	g´og»ss
 = 
v¬g
;

202 
´og»ss_upd©e_Ïb–
(
´og»ss
, 
fmt
, 
¬gp
);

	@sediff/progress.h

24 #iâdeà
PROGRESS_H


25 
	#PROGRESS_H


	)

27 
´og»ss
 
	t´og»ss_t
;

29 
	~"tİËv–.h
"

31 
	~<­Ş/pŞicy.h
>

32 
	~<pŞdiff/pŞdiff.h
>

42 
´og»ss_t
 *
´og»ss_ü—‹
(
tİËv–_t
 * 
tİ
);

51 
´og»ss_de¡roy
(
´og»ss_t
 ** 
´og»ss
);

59 
´og»ss_show
(
´og»ss_t
 * 
´og»ss
, cÚ¡ *
t™Ë
);

67 
´og»ss_hide
(
´og»ss_t
 * 
´og»ss
);

82 
´og»ss_wa™
(
´og»ss_t
 * 
´og»ss
);

91 
´og»ss_dÚe
(
´og»ss_t
 * 
´og»ss
);

102 
	$´og»ss_w¬n
(
´og»ss_t
 * 
´og»ss
, *
»asÚ
, ...è
	`__©Œibu‹__
 ((
	`fÜm©
(
´štf
, 2, 3)));

113 
	$´og»ss_abÜt
(
´og»ss_t
 * 
´og»ss
, *
»asÚ
, ...è
	`__©Œibu‹__
 ((
	`fÜm©
(
´štf
, 2, 3)));

121 
	$´og»ss_upd©e
(
´og»ss_t
 * 
´og»ss
, *
fmt
, ...è
	`__©Œibu‹__
 ((
	`fÜm©
(
´štf
, 2, 3)));

129 
	`´og»ss_pŞdiff_hªdË_func
(*
¬g
, cÚ¡ 
pŞdiff_t
 * 
diff
, 
Ëv–
, cÚ¡ *
fmt
, 
va_li¡
 
va_¬gs
);

137 
	`´og»ss_­Ş_hªdË_func
(*
v¬g
, cÚ¡ 
­Ş_pŞicy_t
 * 
p
, 
Ëv–
, cÚ¡ *
fmt
, 
va_li¡
 
¬gp
);

	@sediff/remap_types_dialog.c

27 
	~<cÚfig.h
>

29 
	~"»m­_ty³s_dŸlog.h
"

30 
	~"utgui.h
"

32 
	~<as£¹.h
>

33 
	~<”ºo.h
>

34 
	~<¡dlib.h
>

35 
	~<­Ş/ty³-qu”y.h
>

36 
	~<­Ş/ut.h
>

37 
	~<gÏde/gÏde.h
>

38 
	~<pŞdiff/ty³_m­.h
>

40 
	s»m­_ty³s


42 
tİËv–_t
 *
	mtİ
;

43 
GÏdeXML
 *
	mxml
;

44 
pŞdiff_t
 *
	mdiff
;

46 
GtkDŸlog
 *
	mdŸlog
;

47 
GtkT»eV›w
 *
	mv›w
;

48 
GtkCheckBu‰Ú
 *
	mshow_šã¼ed
;

50 
GtkComboBoxEÁry
 *
	mcombo
[
SEDIFFX_POLICY_NUM
];

51 
GtkCheckBu‰Ú
 *
	mshow_unm­³d_ty³s
;

52 
GtkBu‰Ú
 *
	madd
, *
	m»move
;

53 
GtkLi¡StÜe
 *
	m»m­s
;

54 
GtkT»eMod–F‹r
 *
	mf‹r
;

55 
GtkT»eMod–SÜt
 *
	msÜt
;

57 
	mchªged
;

62 
	mORIG_NAME_COL
 = 0, 
	mMOD_NAME_COL
, 
	mORIG_HIGHLIGHT_VALUE_COL
, 
	mMOD_HIGHLIGHT_VALUE_COL
, 
	mENTRY_COL
, 
	mNUM_COLUMNS


65 
GtkT»eMod–F‹r
 *
	gty³s_f‹r
[
SEDIFFX_POLICY_NUM
] = { 
NULL
, NULL };

66 
GtkLi¡StÜe
 *
	gty³s
[
SEDIFFX_POLICY_NUM
] = { 
NULL
, NULL };

67 
gboŞ—n
 
	gshow_Úly_unm­³d
 = 
TRUE
;

73 
	$»m­_ty³s_highlight_’Œ›s
(
»m­_ty³s
 *
¹
)

75 cÚ¡ 
gch¬
 *
Üig_‹xt
 = 
	`ut_combo_box_g‘_aùive_‹xt
(
	`GTK_COMBO_BOX
(
¹
->
combo
[
SEDIFFX_POLICY_ORIG
]));

76 cÚ¡ 
gch¬
 *
mod_‹xt
 = 
	`ut_combo_box_g‘_aùive_‹xt
(
	`GTK_COMBO_BOX
(
¹
->
combo
[
SEDIFFX_POLICY_MOD
]));

77 
num_Üig_m©ches
 = 0, 
num_mod_m©ches
 = 0;

78 
gboŞ—n
 
™”_v®id
;

79 
GtkT»eI‹r
 
™”
;

80 
pŞdiff_ty³_»m­_’Œy_t
 *
’Œy
;

81 
­Ş_veùÜ_t
 *
v
;

82 
size_t
 
idx
;

83 
™”_v®id
 = 
	`gtk_Œ“_mod–_g‘_™”_fœ¡
(
	`GTK_TREE_MODEL
(
¹
->
»m­s
), &
™”
);

84 
™”_v®id
) {

85 
	`gtk_Œ“_mod–_g‘
(
	`GTK_TREE_MODEL
(
¹
->
»m­s
), &
™”
, 
ENTRY_COL
, &
’Œy
, -1);

86 ià(
Üig_‹xt
 !ğ
NULL
 && 
	`¡rcmp
(orig_text, "") != 0) {

87 
v
 = 
	`pŞdiff_ty³_»m­_’Œy_g‘_Üigš®_ty³s
(
¹
->
diff
, 
’Œy
);

88 ià(
	`­Ş_veùÜ_g‘_šdex
(
v
, 
Üig_‹xt
, 
­Ş_¡r_¡rcmp
, 
NULL
, &
idx
) == 0) {

89 
	`gtk_li¡_¡Üe_£t
(
¹
->
»m­s
, &
™”
, 
ORIG_HIGHLIGHT_VALUE_COL
, 
PANGO_WEIGHT_BOLD
, -1);

90 
num_Üig_m©ches
++;

91 ià(
	`­Ş_veùÜ_g‘_size
(
v
) > 1) {

95 
num_Üig_m©ches
++;

98 
	`gtk_li¡_¡Üe_£t
(
¹
->
»m­s
, &
™”
, 
ORIG_HIGHLIGHT_VALUE_COL
, 
PANGO_WEIGHT_NORMAL
, -1);

100 
	`­Ş_veùÜ_de¡roy
(&
v
);

102 ià(
mod_‹xt
 !ğ
NULL
 && 
	`¡rcmp
(mod_text, "") != 0) {

103 
v
 = 
	`pŞdiff_ty³_»m­_’Œy_g‘_modif›d_ty³s
(
¹
->
diff
, 
’Œy
);

104 ià(
	`­Ş_veùÜ_g‘_šdex
(
v
, 
mod_‹xt
, 
­Ş_¡r_¡rcmp
, 
NULL
, &
idx
) == 0) {

105 
	`gtk_li¡_¡Üe_£t
(
¹
->
»m­s
, &
™”
, 
MOD_HIGHLIGHT_VALUE_COL
, 
PANGO_WEIGHT_BOLD
, -1);

106 
num_mod_m©ches
++;

107 ià(
	`­Ş_veùÜ_g‘_size
(
v
) > 1) {

111 
num_mod_m©ches
++;

114 
	`gtk_li¡_¡Üe_£t
(
¹
->
»m­s
, &
™”
, 
MOD_HIGHLIGHT_VALUE_COL
, 
PANGO_WEIGHT_NORMAL
, -1);

116 
	`­Ş_veùÜ_de¡roy
(&
v
);

118 
™”_v®id
 = 
	`gtk_Œ“_mod–_™”_Ãxt
(
	`GTK_TREE_MODEL
(
¹
->
»m­s
), &
™”
);

120 
	`gtk_widg‘_£t_£ns™ive
(
	`GTK_WIDGET
(
¹
->
add
), 
FALSE
);

121 ià(
Üig_‹xt
 !ğ
NULL
 && 
	`¡rcmp
(Üig_‹xt, ""è!ğ0 && 
mod_‹xt
 != NULL && strcmp(mod_text, "") != 0) {

125 ià((
num_Üig_m©ches
 =ğ0 && 
num_mod_m©ches
 == 0) ||

126 (
num_Üig_m©ches
 =ğ1 && 
num_mod_m©ches
 == 0) || (num_orig_matches == 0 &&‚um_mod_matches == 1)) {

127 
	`gtk_widg‘_£t_£ns™ive
(
	`GTK_WIDGET
(
¹
->
add
), 
TRUE
);

130 
	}
}

136 
	$»m­_ty³s_upd©e_v›w
(
»m­_ty³s
 *
¹
)

138 
­Ş_veùÜ_t
 *
’Œ›s
 = 
	`pŞdiff_ty³_»m­_g‘_’Œ›s
(
¹
->
diff
);

139 
­Ş_veùÜ_t
 *
Üigs
 = 
NULL
, *
mods
 = NULL;

140 
­Ş_veùÜ_t
 *
u£d_Üigs
 = 
NULL
, *
u£d_mods
 = NULL;

141 *
Üig_¡ršg
 = 
NULL
, *
mod_¡ršg
 = NULL, *
s
, *
t
;

142 
size_t
 
i
, 
j
;

143 
GtkT»eI‹r
 
™”
;

144 ià((
u£d_Üigs
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)è=ğNULL || (
u£d_mods
 =‡pol_vector_create(NULL)) == NULL) {

145 
	`tİËv–_ERR
(
¹
->
tİ
, "%s", 
	`¡»¼Ü
(
”ºo
));

146 
ş—nup
;

148 
	`gtk_li¡_¡Üe_ş—r
(
¹
->
»m­s
);

149 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
’Œ›s
); i++) {

150 
pŞdiff_ty³_»m­_’Œy_t
 *
e
 = 
	`­Ş_veùÜ_g‘_–em’t
(
’Œ›s
, 
i
);

151 ià((
Üigs
 = 
	`pŞdiff_ty³_»m­_’Œy_g‘_Üigš®_ty³s
(
¹
->
diff
, 
e
)è=ğ
NULL
 ||

152 (
mods
 = 
	`pŞdiff_ty³_»m­_’Œy_g‘_modif›d_ty³s
(
¹
->
diff
, 
e
)è=ğ
NULL
 ||

153 (
Üig_¡ršg
 = 
	`­Ş_¡r_još
(
Üigs
, ", ")è=ğ
NULL
 || (
mod_¡ršg
 =‡pŞ_¡r_još(
mods
, ", ")) == NULL) {

154 
	`tİËv–_ERR
(
¹
->
tİ
, "%s", 
	`¡»¼Ü
(
”ºo
));

155 
ş—nup
;

157 
j
 = 0; j < 
	`­Ş_veùÜ_g‘_size
(
Üigs
); j++) {

158 
s
 = 
	`­Ş_veùÜ_g‘_–em’t
(
Üigs
, 
j
);

159 ià(
	`­Ş_veùÜ_­³nd
(
u£d_Üigs
, 
s
) < 0) {

160 
	`tİËv–_ERR
(
¹
->
tİ
, "%s", 
	`¡»¼Ü
(
”ºo
));

161 
ş—nup
;

164 
j
 = 0; j < 
	`­Ş_veùÜ_g‘_size
(
mods
); j++) {

165 
s
 = 
	`­Ş_veùÜ_g‘_–em’t
(
mods
, 
j
);

166 ià(
	`­Ş_veùÜ_­³nd
(
u£d_mods
, 
s
) < 0) {

167 
	`tİËv–_ERR
(
¹
->
tİ
, "%s", 
	`¡»¼Ü
(
”ºo
));

168 
ş—nup
;

171 
	`gtk_li¡_¡Üe_­³nd
(
¹
->
»m­s
, &
™”
);

172 
	`gtk_li¡_¡Üe_£t
(
¹
->
»m­s
, &
™”
, 
ORIG_NAME_COL
, 
Üig_¡ršg
, 
MOD_NAME_COL
, 
mod_¡ršg
, 
ENTRY_COL
, 
e
, -1);

173 
	`­Ş_veùÜ_de¡roy
(&
Üigs
);

174 
	`­Ş_veùÜ_de¡roy
(&
mods
);

175 
	`ä“
(
Üig_¡ršg
);

176 
	`ä“
(
mod_¡ršg
);

177 
Üig_¡ršg
 = 
NULL
;

178 
mod_¡ršg
 = 
NULL
;

184 
	`­Ş_veùÜ_sÜt_uniquify
(
u£d_Üigs
, 
­Ş_¡r_¡rcmp
, 
NULL
);

185 
	`­Ş_veùÜ_sÜt_uniquify
(
u£d_mods
, 
­Ş_¡r_¡rcmp
, 
NULL
);

186 
i
 = 0;

187 
s
 = 
	`­Ş_veùÜ_g‘_–em’t
(
u£d_Üigs
, 
i
);

188 
gboŞ—n
 
™”_v®id
 = 
	`gtk_Œ“_mod–_g‘_™”_fœ¡
(
	`GTK_TREE_MODEL
(
ty³s
[
SEDIFFX_POLICY_ORIG
]), &
™”
);

189 
™”_v®id
 && 
s
 !ğ
NULL
) {

190 
	`gtk_Œ“_mod–_g‘
(
	`GTK_TREE_MODEL
(
ty³s
[
SEDIFFX_POLICY_ORIG
]), &
™”
, 0, &
t
, -1);

191 ià(
	`¡rcmp
(
s
, 
t
) == 0) {

192 
	`gtk_li¡_¡Üe_£t
(
ty³s
[
SEDIFFX_POLICY_ORIG
], &
™”
, 1, 
TRUE
, -1);

193 
i
++;

194 
s
 = 
	`­Ş_veùÜ_g‘_–em’t
(
u£d_Üigs
, 
i
);

196 
	`gtk_li¡_¡Üe_£t
(
ty³s
[
SEDIFFX_POLICY_ORIG
], &
™”
, 1, 
FALSE
, -1);

198 
™”_v®id
 = 
	`gtk_Œ“_mod–_™”_Ãxt
(
	`GTK_TREE_MODEL
(
ty³s
[
SEDIFFX_POLICY_ORIG
]), &
™”
);

200 
	`as£¹
(
i
 >ğ
	`­Ş_veùÜ_g‘_size
(
u£d_Üigs
));

202 
i
 = 0;

203 
s
 = 
	`­Ş_veùÜ_g‘_–em’t
(
u£d_mods
, 
i
);

204 
™”_v®id
 = 
	`gtk_Œ“_mod–_g‘_™”_fœ¡
(
	`GTK_TREE_MODEL
(
ty³s
[
SEDIFFX_POLICY_MOD
]), &
™”
);

205 
™”_v®id
 && 
s
 !ğ
NULL
) {

206 
	`gtk_Œ“_mod–_g‘
(
	`GTK_TREE_MODEL
(
ty³s
[
SEDIFFX_POLICY_MOD
]), &
™”
, 0, &
t
, -1);

207 ià(
	`¡rcmp
(
s
, 
t
) == 0) {

208 
	`gtk_li¡_¡Üe_£t
(
ty³s
[
SEDIFFX_POLICY_MOD
], &
™”
, 1, 
TRUE
, -1);

209 
i
++;

210 
s
 = 
	`­Ş_veùÜ_g‘_–em’t
(
u£d_mods
, 
i
);

212 
	`gtk_li¡_¡Üe_£t
(
ty³s
[
SEDIFFX_POLICY_MOD
], &
™”
, 1, 
FALSE
, -1);

214 
™”_v®id
 = 
	`gtk_Œ“_mod–_™”_Ãxt
(
	`GTK_TREE_MODEL
(
ty³s
[
SEDIFFX_POLICY_MOD
]), &
™”
);

216 
	`as£¹
(
i
 >ğ
	`­Ş_veùÜ_g‘_size
(
u£d_mods
));

218 
	`»m­_ty³s_highlight_’Œ›s
(
¹
);

219 
	`gtk_Œ“_mod–_f‹r_»f‹r
(
ty³s_f‹r
[
SEDIFFX_POLICY_ORIG
]);

220 
	`gtk_Œ“_mod–_f‹r_»f‹r
(
ty³s_f‹r
[
SEDIFFX_POLICY_MOD
]);

221 
ş—nup
:

222 
	`­Ş_veùÜ_de¡roy
(&
u£d_Üigs
);

223 
	`­Ş_veùÜ_de¡roy
(&
u£d_mods
);

224 
	`­Ş_veùÜ_de¡roy
(&
Üigs
);

225 
	`­Ş_veùÜ_de¡roy
(&
mods
);

226 
	`ä“
(
Üig_¡ršg
);

227 
	`ä“
(
mod_¡ršg
);

228 
	}
}

230 
»m­_ty³s_Ú_show_šã¼ed_toggË
(
GtkToggËBu‰Ú
 * 
toggË
 
__©Œibu‹__
 ((
unu£d
)), 
gpoš‹r
 
u£r_d©a
)

232 
»m­_ty³s
 *
	g¹
 = (»m­_ty³ *)
u£r_d©a
;

233 
gtk_Œ“_mod–_f‹r_»f‹r
(
¹
->
f‹r
);

236 
»m­_ty³s_Ú_show_unm­³d_ty³s_toggË
(
GtkToggËBu‰Ú
 * 
toggË
, 
gpoš‹r
 
u£r_d©a
 
__©Œibu‹__
 ((
unu£d
)))

238 
	gshow_Úly_unm­³d
 = 
gtk_toggË_bu‰Ú_g‘_aùive
(
toggË
);

239 
gtk_Œ“_mod–_f‹r_»f‹r
(
ty³s_f‹r
[
SEDIFFX_POLICY_ORIG
]);

240 
gtk_Œ“_mod–_f‹r_»f‹r
(
ty³s_f‹r
[
SEDIFFX_POLICY_MOD
]);

243 
	$»m­_ty³s_Ú_£ËùiÚ_chªge
(
GtkT»eS–eùiÚ
 * 
£ËùiÚ
, 
gpoš‹r
 
u£r_d©a
)

245 
»m­_ty³s
 *
¹
 = (»m­_ty³ *)
u£r_d©a
;

246 
gboŞ—n
 
£ns
 = 
	`gtk_Œ“_£ËùiÚ_g‘_£Ëùed
(
£ËùiÚ
, 
NULL
, NULL);

247 
	`gtk_widg‘_£t_£ns™ive
(
	`GTK_WIDGET
(
¹
->
»move
), 
£ns
);

248 
	}
}

250 
»m­_ty³s_Ú_combo_chªge
(
GtkComboBox
 * 
widg‘
 
__©Œibu‹__
 ((
unu£d
)), 
gpoš‹r
 
u£r_d©a
)

252 
»m­_ty³s
 *
	g¹
 = (»m­_ty³ *)
u£r_d©a
;

253 
»m­_ty³s_highlight_’Œ›s
(
¹
);

256 
»m­_ty³s_Ú_add_şick
(
GtkBu‰Ú
 * 
bu‰Ú
 
__©Œibu‹__
 ((
unu£d
)), 
gpoš‹r
 
u£r_d©a
)

258 
»m­_ty³s
 *
	g¹
 = (»m­_ty³ *)
u£r_d©a
;

259 
­Ş_veùÜ_t
 *
	gÜig
 = 
NULL
, *
	gmod
 = NULL;

260 
­Ş_veùÜ_t
 *
	gŞd_Üig
 = 
NULL
, *
	gŞd_mod
 = NULL;

261 cÚ¡ 
gch¬
 *
	gÜig_ty³
 = 
ut_combo_box_g‘_aùive_‹xt
(
GTK_COMBO_BOX
(
¹
->
combo
[
SEDIFFX_POLICY_ORIG
]));

262 cÚ¡ 
gch¬
 *
	gmod_ty³
 = 
ut_combo_box_g‘_aùive_‹xt
(
GTK_COMBO_BOX
(
¹
->
combo
[
SEDIFFX_POLICY_MOD
]));

264 ià((
	gÜig
 = 
­Ş_¡r_¥l™
(
Üig_ty³
, " ")è=ğ
NULL
 || (
mod
 =‡pŞ_¡r_¥l™(
mod_ty³
, " ")) == NULL) {

265 
tİËv–_ERR
(
¹
->
tİ
, "%s", 
¡»¼Ü
(
”ºo
));

267 ià(
­Ş_veùÜ_g‘_size
(
Üig
è> 1 &&‡pŞ_veùÜ_g‘_size(
mod
) > 1) {

268 
tİËv–_ERR
(
¹
->
tİ
, "%s", "Remappings may be 1o many or manyo 1, but‚ot manyo many.");

269 
	gş—nup
;

274 
GtkT»eI‹r
 
	g™”
;

275 
gboŞ—n
 
	g™”_v®id
 = 
gtk_Œ“_mod–_g‘_™”_fœ¡
(
GTK_TREE_MODEL
(
¹
->
»m­s
), &
™”
);

276 
pŞdiff_ty³_»m­_’Œy_t
 *
	g’Œy
 = 
NULL
, *
	ge
;

279 
	g™”_v®id
) {

280 
gšt
 
	gÜig_m¬ked
, 
	gmod_m¬ked
;

281 
gtk_Œ“_mod–_g‘
(
GTK_TREE_MODEL
(
¹
->
»m­s
), &
™”
, 
ORIG_HIGHLIGHT_VALUE_COL
, &
Üig_m¬ked
,

282 
MOD_HIGHLIGHT_VALUE_COL
, &
mod_m¬ked
, 
ENTRY_COL
, &
e
, -1);

283 
as£¹
(
Üig_m¬ked
 !ğ
PANGO_WEIGHT_BOLD
 || 
mod_m¬ked
 != PANGO_WEIGHT_BOLD);

284 ià(
	gÜig_m¬ked
 =ğ
PANGO_WEIGHT_BOLD
) {

285 
as£¹
(
’Œy
 =ğ
NULL
);

286 
	g’Œy
 = 
e
;

287 } ià(
	gmod_m¬ked
 =ğ
PANGO_WEIGHT_BOLD
) {

288 
as£¹
(
’Œy
 =ğ
NULL
);

289 
	g’Œy
 = 
e
;

291 
	g™”_v®id
 = 
gtk_Œ“_mod–_™”_Ãxt
(
GTK_TREE_MODEL
(
¹
->
»m­s
), &
™”
);

293 ià(
	g’Œy
 !ğ
NULL
) {

294 
size_t
 
i
;

295 *
	gs
;

296 
	gŞd_Üig
 = 
pŞdiff_ty³_»m­_’Œy_g‘_Üigš®_ty³s
(
¹
->
diff
, 
’Œy
);

297 
	gŞd_mod
 = 
pŞdiff_ty³_»m­_’Œy_g‘_modif›d_ty³s
(
¹
->
diff
, 
’Œy
);

298 
as£¹
(
Şd_Üig
 !ğ
NULL
 && 
Şd_mod
 != NULL);

299 
	gi
 = 0; i < 
­Ş_veùÜ_g‘_size
(
Şd_Üig
); i++) {

300 
	gs
 = 
¡rdup
(
­Ş_veùÜ_g‘_–em’t
(
Şd_Üig
, 
i
));

301 ià(
­Ş_veùÜ_­³nd_unique
(
Üig
, 
s
, 
­Ş_¡r_¡rcmp
, 
NULL
) > 0) {

302 
ä“
(
s
);

305 
	gi
 = 0; i < 
­Ş_veùÜ_g‘_size
(
Şd_mod
); i++) {

306 
	gs
 = 
¡rdup
(
­Ş_veùÜ_g‘_–em’t
(
Şd_mod
, 
i
));

307 ià(
­Ş_veùÜ_­³nd_unique
(
mod
, 
s
, 
­Ş_¡r_¡rcmp
, 
NULL
) > 0) {

308 
ä“
(
s
);

311 
pŞdiff_ty³_»m­_’Œy_»move
(
¹
->
diff
, 
’Œy
);

314 ià(
pŞdiff_ty³_»m­_ü—‹
(
¹
->
diff
, 
Üig
, 
mod
) < 0) {

315 
tİËv–_ERR
(
¹
->
tİ
, "%s", "This was‚ot‡ validype„emap.");

316 
	gş—nup
;

318 
»m­_ty³s_upd©e_v›w
(
¹
);

319 
	g¹
->
	gchªged
 = 1;

321 
	gş—nup
:

322 
­Ş_veùÜ_de¡roy
(&
Üig
);

323 
­Ş_veùÜ_de¡roy
(&
mod
);

324 
­Ş_veùÜ_de¡roy
(&
Şd_Üig
);

325 
­Ş_veùÜ_de¡roy
(&
Şd_mod
);

328 
»m­_ty³s_Ú_»move_şick
(
GtkBu‰Ú
 * 
bu‰Ú
 
__©Œibu‹__
 ((
unu£d
)), 
gpoš‹r
 
u£r_d©a
)

330 
»m­_ty³s
 *
	g¹
 = (»m­_ty³ *)
u£r_d©a
;

331 
GtkT»eS–eùiÚ
 *
	g£ËùiÚ
 = 
gtk_Œ“_v›w_g‘_£ËùiÚ
(
¹
->
v›w
);

332 
GtkT»eI‹r
 
	g™”
;

333 ià(
gtk_Œ“_£ËùiÚ_g‘_£Ëùed
(
£ËùiÚ
, 
NULL
, &
™”
)) {

334 
pŞdiff_ty³_»m­_’Œy_t
 *
	g’Œy
;

335 
gtk_Œ“_mod–_g‘
(
GTK_TREE_MODEL
(
¹
->
sÜt
), &
™”
, 
ENTRY_COL
, &
’Œy
, -1);

336 
pŞdiff_ty³_»m­_’Œy_»move
(
¹
->
diff
, 
’Œy
);

337 
»m­_ty³s_upd©e_v›w
(
¹
);

338 
	g¹
->
	gchªged
 = 1;

342 
gšt
 
	$»m­_ty³s_sÜt_com·»
(
GtkT»eMod–
 * 
mod–
, 
GtkT»eI‹r
 * 
a
, GtkT»eI‹¸* 
b
, 
gpoš‹r
 
u£r_d©a
)

344 
gšt
 
cŞumn
 = 
	`GPOINTER_TO_INT
(
u£r_d©a
);

345 *
s
, *
t
;

346 
	`gtk_Œ“_mod–_g‘
(
mod–
, 
a
, 
cŞumn
, &
s
, -1);

347 
	`gtk_Œ“_mod–_g‘
(
mod–
, 
b
, 
cŞumn
, &
t
, -1);

351 ià(
s
 =ğ
NULL
) {

352 
s
 = "";

354 ià(
t
 =ğ
NULL
) {

355 
t
 = "";

357  
	`¡rcmp
(
s
, 
t
);

358 
	}
}

360 
gboŞ—n
 
	$»m­_ty³s_f‹r_visibË
(
GtkT»eMod–
 * 
mod–
, 
GtkT»eI‹r
 * 
™”
, 
gpoš‹r
 
u£r_d©a
)

362 
»m­_ty³s
 *
¹
 = (»m­_ty³ *)
u£r_d©a
;

363 
pŞdiff_ty³_»m­_’Œy_t
 *
’Œy
;

364 
	`gtk_Œ“_mod–_g‘
(
mod–
, 
™”
, 
ENTRY_COL
, &
’Œy
, -1);

365 ià(
	`pŞdiff_ty³_»m­_’Œy_g‘_is_šã¼ed
(
’Œy
)) {

366 ià(
	`gtk_toggË_bu‰Ú_g‘_aùive
(
	`GTK_TOGGLE_BUTTON
(
¹
->
show_šã¼ed
))) {

367  
TRUE
;

369  
FALSE
;

372  
TRUE
;

374 
	}
}

376 
	$»m­_ty³s_š™_widg‘s
(
»m­_ty³s
 *
¹
)

378 
GtkT»eS–eùiÚ
 *
£ËùiÚ
;

379 
GtkC–lR’d””
 *
Üig_»nd””
, *
mod_»nd””
;

380 
GtkT»eV›wCŞumn
 *
cŞumn
;

382 
¹
->
dŸlog
 = 
	`GTK_DIALOG
(
	`gÏde_xml_g‘_widg‘
Ôt->
xml
, "remap_types"));

383 
	`as£¹
(
¹
->
dŸlog
 !ğ
NULL
);

384 
	`gtk_wšdow_£t_Œªs›Á_fÜ
(
	`GTK_WINDOW
(
¹
->
dŸlog
), 
	`tİËv–_g‘_wšdow
Ôt->
tİ
));

385 
¹
->
v›w
 = 
	`GTK_TREE_VIEW
(
	`gÏde_xml_g‘_widg‘
Ôt->
xml
, "remap_typesreeview"));

386 
¹
->
show_šã¼ed
 = 
	`GTK_CHECK_BUTTON
(
	`gÏde_xml_g‘_widg‘
Ôt->
xml
, "remap_types inferred checkbutton"));

387 
¹
->
combo
[
SEDIFFX_POLICY_ORIG
] = 
	`GTK_COMBO_BOX_ENTRY
(
	`gÏde_xml_g‘_widg‘
Ôt->
xml
, "remap_types orig combo"));

388 
¹
->
combo
[
SEDIFFX_POLICY_MOD
] = 
	`GTK_COMBO_BOX_ENTRY
(
	`gÏde_xml_g‘_widg‘
Ôt->
xml
, "remap_types mod combo"));

389 
¹
->
show_unm­³d_ty³s
 = 
	`GTK_CHECK_BUTTON
(
	`gÏde_xml_g‘_widg‘
Ôt->
xml
, "remap_types only unmapped checkbutton"));

390 
	`as£¹
(
¹
->
v›w
 !ğ
NULL
 &&„t->
show_šã¼ed
 &&„t->
combo
[
SEDIFFX_POLICY_ORIG
] != NULL

391 && 
¹
->
combo
[
SEDIFFX_POLICY_MOD
] !ğ
NULL
 &&„t->
show_unm­³d_ty³s
 != NULL);

392 
	`g_sigÇl_cÚÃù
(
¹
->
show_šã¼ed
, "toggËd", 
	`G_CALLBACK
(
»m­_ty³s_Ú_show_šã¼ed_toggË
),„t);

393 
	`g_sigÇl_cÚÃù
(
¹
->
show_unm­³d_ty³s
, "toggËd", 
	`G_CALLBACK
(
»m­_ty³s_Ú_show_unm­³d_ty³s_toggË
),„t);

394 
show_Úly_unm­³d
 = 
	`gtk_toggË_bu‰Ú_g‘_aùive
(
	`GTK_TOGGLE_BUTTON
(
¹
->
show_unm­³d_ty³s
));

396 
¹
->
add
 = 
	`GTK_BUTTON
(
	`gÏde_xml_g‘_widg‘
Ôt->
xml
, "remap_types‡dd button"));

397 
¹
->
»move
 = 
	`GTK_BUTTON
(
	`gÏde_xml_g‘_widg‘
Ôt->
xml
, "remap_types„emove button"));

398 
	`as£¹
(
¹
->
add
 !ğ
NULL
 &&„t->
»move
 != NULL);

399 
	`g_sigÇl_cÚÃù
(
¹
->
add
, "şicked", 
	`G_CALLBACK
(
»m­_ty³s_Ú_add_şick
),„t);

400 
	`g_sigÇl_cÚÃù
(
¹
->
»move
, "şicked", 
	`G_CALLBACK
(
»m­_ty³s_Ú_»move_şick
),„t);

402 
¹
->
»m­s
 = 
	`gtk_li¡_¡Üe_Ãw
(
NUM_COLUMNS
, 
G_TYPE_STRING
, G_TYPE_STRING, 
G_TYPE_INT
, G_TYPE_INT, 
G_TYPE_POINTER
);

403 
¹
->
f‹r
 = 
	`GTK_TREE_MODEL_FILTER
(
	`gtk_Œ“_mod–_f‹r_Ãw
(
	`GTK_TREE_MODEL
Ôt->
»m­s
), 
NULL
));

404 
	`gtk_Œ“_mod–_f‹r_£t_visibË_func
(
¹
->
f‹r
, 
»m­_ty³s_f‹r_visibË
,„t, 
NULL
);

405 
¹
->
sÜt
 = 
	`GTK_TREE_MODEL_SORT
(
	`gtk_Œ“_mod–_sÜt_Ãw_w™h_mod–
(
	`GTK_TREE_MODEL
Ôt->
f‹r
)));

406 
	`gtk_Œ“_sÜbË_£t_sÜt_func
(
	`GTK_TREE_SORTABLE
(
¹
->
sÜt
), 
ORIG_NAME_COL
, 
»m­_ty³s_sÜt_com·»
,

407 
	`GINT_TO_POINTER
(
ORIG_NAME_COL
), 
NULL
);

408 
	`gtk_Œ“_sÜbË_£t_sÜt_func
(
	`GTK_TREE_SORTABLE
(
¹
->
sÜt
), 
MOD_NAME_COL
, 
»m­_ty³s_sÜt_com·»
,

409 
	`GINT_TO_POINTER
(
MOD_NAME_COL
), 
NULL
);

410 
	`gtk_Œ“_sÜbË_£t_deçuÉ_sÜt_func
(
	`GTK_TREE_SORTABLE
(
¹
->
sÜt
), 
»m­_ty³s_sÜt_com·»
,

411 
	`GINT_TO_POINTER
(
ORIG_NAME_COL
), 
NULL
);

412 
	`gtk_Œ“_v›w_£t_mod–
(
¹
->
v›w
, 
	`GTK_TREE_MODEL
Ôt->
sÜt
));

414 
£ËùiÚ
 = 
	`gtk_Œ“_v›w_g‘_£ËùiÚ
(
¹
->
v›w
);

415 
	`gtk_Œ“_£ËùiÚ_£t_mode
(
£ËùiÚ
, 
GTK_SELECTION_BROWSE
);

416 
	`g_sigÇl_cÚÃù
(
£ËùiÚ
, "chªged", 
	`G_CALLBACK
(
»m­_ty³s_Ú_£ËùiÚ_chªge
), 
¹
);

418 
Üig_»nd””
 = 
	`gtk_ûÎ_»nd””_‹xt_Ãw
();

419 
mod_»nd””
 = 
	`gtk_ûÎ_»nd””_‹xt_Ãw
();

420 
	`g_objeù_£t
(
Üig_»nd””
, "weight", 
PANGO_WEIGHT_BOLD
, 
NULL
);

421 
	`g_objeù_£t
(
mod_»nd””
, "weight", 
PANGO_WEIGHT_BOLD
, 
NULL
);

422 
cŞumn
 = 
	`gtk_Œ“_v›w_cŞumn_Ãw_w™h_©Œibu‹s
("Origš® PŞicy", 
Üig_»nd””
, "‹xt", 
ORIG_NAME_COL
, "weight",

423 
ORIG_HIGHLIGHT_VALUE_COL
, 
NULL
);

424 
	`gtk_Œ“_v›w_cŞumn_£t_ex·nd
(
cŞumn
, 
TRUE
);

425 
	`gtk_Œ“_v›w_cŞumn_£t_sÜt_cŞumn_id
(
cŞumn
, 
ORIG_NAME_COL
);

426 
	`gtk_Œ“_v›w_cŞumn_£t_sÜt_šdiÿtÜ
(
cŞumn
, 
TRUE
);

427 
	`gtk_Œ“_v›w_­³nd_cŞumn
(
	`GTK_TREE_VIEW
(
¹
->
v›w
), 
cŞumn
);

428 
	`gtk_Œ“_v›w_cŞumn_şicked
(
cŞumn
);

430 
cŞumn
 = 
	`gtk_Œ“_v›w_cŞumn_Ãw_w™h_©Œibu‹s
("Modif›d PŞicy", 
mod_»nd””
, "‹xt", 
MOD_NAME_COL
, "weight",

431 
MOD_HIGHLIGHT_VALUE_COL
, 
NULL
);

432 
	`gtk_Œ“_v›w_cŞumn_£t_ex·nd
(
cŞumn
, 
TRUE
);

433 
	`gtk_Œ“_v›w_cŞumn_£t_sÜt_cŞumn_id
(
cŞumn
, 
MOD_NAME_COL
);

434 
	`gtk_Œ“_v›w_cŞumn_£t_sÜt_šdiÿtÜ
(
cŞumn
, 
TRUE
);

435 
	`gtk_Œ“_v›w_­³nd_cŞumn
(
	`GTK_TREE_VIEW
(
¹
->
v›w
), 
cŞumn
);

436 
	}
}

438 
gboŞ—n
 
»m­_ty³s_ty³s_f‹r_visibË
(
GtkT»eMod–
 * 
mod–
, 
GtkT»eI‹r
 * 
™”
, 
gpoš‹r
 
u£r_d©a
);

444 
	$»m­_ty³s_š™_combos
(
»m­_ty³s
 *
¹
)

446 
£diffx_pŞicy_e
 
i
;

447 
i
 = 
SEDIFFX_POLICY_ORIG
; i < 
SEDIFFX_POLICY_NUM
; i++) {

448 
	`gtk_combo_box_£t_mod–
(
	`GTK_COMBO_BOX
(
¹
->
combo
[
i
]), 
	`GTK_TREE_MODEL
(
ty³s_f‹r
[i]));

449 
	`gtk_combo_box_’Œy_£t_‹xt_cŞumn
(
¹
->
combo
[
i
], 0);

450 
	`g_sigÇl_cÚÃù
(
¹
->
combo
[
i
], "chªged", 
	`G_CALLBACK
(
»m­_ty³s_Ú_combo_chªge
),„t);

452 
	}
}

454 
	$»m­_ty³s_run
(
tİËv–_t
 * 
tİ
)

456 
»m­_ty³s
 
¹
;

457 
gšt
 
»¥Ú£
;

458 
gboŞ—n
 
´ev_show_šã¼ed
 = 
FALSE
;

459 
gboŞ—n
 
´ev_show_unm­³d
 = 
TRUE
;

461 
	`mem£t
(&
¹
, 0, (rt));

462 
¹
.
tİ
 =op;

463 
¹
.
xml
 = 
	`gÏde_xml_Ãw
(
	`tİËv–_g‘_gÏde_xml
Ôt.
tİ
), "»m­_ty³s", 
NULL
);

464 
¹
.
diff
 = 
	`tİËv–_g‘_pŞdiff
Ôt.
tİ
);

466 
	`»m­_ty³s_š™_widg‘s
(&
¹
);

467 
	`»m­_ty³s_š™_combos
(&
¹
);

468 
	`»m­_ty³s_upd©e_v›w
(&
¹
);

470 
	`gtk_toggË_bu‰Ú_£t_aùive
(
	`GTK_TOGGLE_BUTTON
(
¹
.
show_šã¼ed
), 
´ev_show_šã¼ed
);

471 
	`gtk_toggË_bu‰Ú_£t_aùive
(
	`GTK_TOGGLE_BUTTON
(
¹
.
show_unm­³d_ty³s
), 
´ev_show_unm­³d
);

473 
»¥Ú£
 = 
	`gtk_dŸlog_run
(
¹
.
dŸlog
);

475 
´ev_show_šã¼ed
 = 
	`gtk_toggË_bu‰Ú_g‘_aùive
(
	`GTK_TOGGLE_BUTTON
(
¹
.
show_šã¼ed
));

476 
´ev_show_unm­³d
 = 
	`gtk_toggË_bu‰Ú_g‘_aùive
(
	`GTK_TOGGLE_BUTTON
(
¹
.
show_unm­³d_ty³s
));

477 
	`gtk_widg‘_de¡roy
(
	`GTK_WIDGET
(
¹
.
dŸlog
));

478 
	`g_objeù_uÄef
(
¹
.
sÜt
);

479 
	`g_objeù_uÄef
(
¹
.
f‹r
);

480 
	`g_objeù_uÄef
(
¹
.
»m­s
);

481  
¹
.
chªged
;

482 
	}
}

484 
gboŞ—n
 
»m­_ty³s_ty³s_f‹r_visibË
(
GtkT»eMod–
 * 
mod–
, 
GtkT»eI‹r
 * 
™”
, 
gpoš‹r
 
u£r_d©a


485 
__©Œibu‹__
 ((
unu£d
)))

487 
gboŞ—n
 
	gš_u£
;

488 ià(!
	gshow_Úly_unm­³d
) {

489  
	gTRUE
;

492 
gtk_Œ“_mod–_g‘
(
mod–
, 
™”
, 1, &
š_u£
, -1);

493  !
	gš_u£
;

499 
	$»m­_ty³s_qpŞ_ty³_cmp
(cÚ¡ *
a
, cÚ¡ *
b
, *
d©a
)

501 cÚ¡ 
qpŞ_ty³_t
 *
x
 = 
a
;

502 cÚ¡ 
qpŞ_ty³_t
 *
y
 = 
b
;

503 
qpŞ_pŞicy_t
 *
q
 = (qpŞ_pŞicy_ˆ*è
d©a
;

504 cÚ¡ *
s
, *
t
;

505 
	`qpŞ_ty³_g‘_Çme
(
q
, 
x
, &
s
);

506 
	`qpŞ_ty³_g‘_Çme
(
q
, 
y
, &
t
);

507  
	`¡rcmp
(
s
, 
t
);

508 
	}
}

510 
	$»m­_ty³s_upd©e
(
­Ş_pŞicy_t
 * 
Üig_pŞicy
,‡pŞ_pŞicy_ˆ* 
mod_pŞicy
)

512 
qpŞ_pŞicy_t
 *
oq
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
Üig_pŞicy
);

513 
qpŞ_pŞicy_t
 *
mq
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
mod_pŞicy
);

514 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

515 
£diffx_pŞicy_e
 
which
;

516 
size_t
 
i
;

517 cÚ¡ 
qpŞ_ty³_t
 *
t
;

518 cÚ¡ *
ty³_Çme
;

519 
GtkT»eI‹r
 
™”
;

520 
”rÜ
 = 0, 
»tv®
 = -1;

522 
which
 = 
SEDIFFX_POLICY_ORIG
; which < 
SEDIFFX_POLICY_NUM
; which++) {

523 ià(
ty³s
[
which
] =ğ
NULL
) {

524 
ty³s
[
which
] = 
	`gtk_li¡_¡Üe_Ãw
(2, 
G_TYPE_STRING
, 
G_TYPE_BOOLEAN
);

525 
ty³s_f‹r
[
which
] = 
	`GTK_TREE_MODEL_FILTER
(
	`gtk_Œ“_mod–_f‹r_Ãw
(
	`GTK_TREE_MODEL
(
ty³s
[which]), 
NULL
));

526 
	`gtk_Œ“_mod–_f‹r_£t_visibË_func
(
ty³s_f‹r
[
which
], 
»m­_ty³s_ty³s_f‹r_visibË
, 
NULL
, NULL);

528 
	`gtk_li¡_¡Üe_ş—r
(
ty³s
[
which
]);

532 ià(
	`­Ş_ty³_g‘_by_qu”y
(
Üig_pŞicy
, 
NULL
, &
v
) < 0) {

533 
”rÜ
 = 
”ºo
;

534 
ş—nup
;

536 
	`­Ş_veùÜ_sÜt
(
v
, 
»m­_ty³s_qpŞ_ty³_cmp
, 
oq
);

537 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v
); i++) {

538 
t
 = 
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

539 
	`qpŞ_ty³_g‘_Çme
(
oq
, 
t
, &
ty³_Çme
);

540 
	`gtk_li¡_¡Üe_­³nd
(
ty³s
[
SEDIFFX_POLICY_ORIG
], &
™”
);

541 
	`gtk_li¡_¡Üe_£t
(
ty³s
[
SEDIFFX_POLICY_ORIG
], &
™”
, 0, 
ty³_Çme
, -1);

543 
	`­Ş_veùÜ_de¡roy
(&
v
);

545 ià(
	`­Ş_ty³_g‘_by_qu”y
(
mod_pŞicy
, 
NULL
, &
v
) < 0) {

546 
”rÜ
 = 
”ºo
;

547 
ş—nup
;

549 
	`­Ş_veùÜ_sÜt
(
v
, 
»m­_ty³s_qpŞ_ty³_cmp
, 
mq
);

550 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v
); i++) {

551 
t
 = 
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

552 
	`qpŞ_ty³_g‘_Çme
(
mq
, 
t
, &
ty³_Çme
);

553 
	`gtk_li¡_¡Üe_­³nd
(
ty³s
[
SEDIFFX_POLICY_MOD
], &
™”
);

554 
	`gtk_li¡_¡Üe_£t
(
ty³s
[
SEDIFFX_POLICY_MOD
], &
™”
, 0, 
ty³_Çme
, -1);

556 
»tv®
 = 0;

557 
ş—nup
:

558 
	`­Ş_veùÜ_de¡roy
(&
v
);

559 ià(
»tv®
 != 0) {

560 
”ºo
 = 
”rÜ
;

561  
»tv®
;

563  
»tv®
;

564 
	}
}

	@sediff/remap_types_dialog.h

27 #iâdeà
REMAP_TYPES_DIALOG_H


28 
	#REMAP_TYPES_DIALOG_H


	)

30 
	~"tİËv–.h
"

41 
»m­_ty³s_run
(
tİËv–_t
 * 
tİ
);

54 
»m­_ty³s_upd©e
(
­Ş_pŞicy_t
 * 
Üig_pŞicy
,‡pŞ_pŞicy_ˆ* 
mod_pŞicy
);

	@sediff/result_item.c

25 
	~<cÚfig.h
>

27 
	~"»suÉ_™em.h
"

28 
	~"»suÉ_™em_»nd”.h
"

29 
	~"utgui.h
"

31 
	~<as£¹.h
>

33 (*
	tde¡ruùÜ_â_t
è(
	t»suÉ_™em_t
 * 
	t™em
);

34 (*
	tpŞicy_chªged_â_t
è(
	t»suÉ_™em_t
 * 
	t™em
, 
	t­Ş_pŞicy_t
 * 
	tÜig_pŞ
,‡pŞ_pŞicy_ˆ* 
	tmod_pŞ
);

35 (*
	tpŞdiff_run_â_t
è(
	t»suÉ_™em_t
 * 
	t™em
, 
	tpŞdiff_t
 * 
	tdiff
, 
	tšüem’l
);

36 
GtkTextBufãr
 *(*
	tg‘_bufãr_â_t
è(
	t»suÉ_™em_t
 * 
	t™em
, 
	tpŞdiff_fÜm_e
 
	tfÜm
);

37 (*
	tis_»nd”_¦ow_â_t
è(
	t»suÉ_™em_t
 * 
	t™em
, 
	tpŞdiff_fÜm_e
 
	tfÜm
);

38 (*
	tg‘_fÜms_â_t
è(
	t»suÉ_™em_t
 * 
	t™em
, 
	tfÜms
[5]);

39 (*
	t£t_cu¼’t_sÜt_â_t
è(
	t»suÉ_™em_t
 * 
	t™em
, 
	tpŞdiff_fÜm_e
 
	tfÜm
, 
	t»suÉs_sÜt_e
 
	tsÜt
, 
	t»suÉs_sÜt_dœ_e
 
	tdœ
);

40 (*
	t´št_diff_â_t
è(
	t»suÉ_™em_t
 * 
	t™em
, 
	tGtkTextBufãr
 * 
	ttb
, 
	tpŞdiff_fÜm_e
 
	tfÜm
);

42 
	s»suÉ_™em


44 cÚ¡ *
Ïb–
;

46 
ušt32_t
 
b™_pos
;

49 
suµÜ‹d
;

51 
pŞdiff_t
 *
diff
;

52 
size_t
 
¡©s
[5];

53 
gšt
 
off£ts
[5];

54 
»suÉs_sÜt_e
 
sÜts
[5];

55 
»suÉs_sÜt_dœ_e
 
sÜt_dœs
[5];

57 cÚ¡ 
­Ş_veùÜ_t
 *(*
g‘_veùÜ
è(cÚ¡ 
pŞdiff_t
 *);

58 
	`pŞdiff_fÜm_e
(*
g‘_fÜm
) (const *);

59 *(*
g‘_¡ršg
è(cÚ¡ 
pŞdiff_t
 *, const *);

61 
de¡ruùÜ_â_t
 
de¡ruùÜ
;

64 
pŞicy_chªged_â_t
 
pŞicy_chªged
;

65 
pŞdiff_run_â_t
 
pŞdiff_run
;

66 
g‘_bufãr_â_t
 
g‘_bufãr
;

67 
is_»nd”_¦ow_â_t
 
is_»nd”_¦ow
;

68 
g‘_fÜms_â_t
 
g‘_fÜms
;

71 
£t_cu¼’t_sÜt_â_t
 
£t_cu¼’t_sÜt
;

75 
ty³_ÿn_modify
;

78 
has_lše_numb”s
[
SEDIFFX_POLICY_NUM
];

79 
ÿched
[5];

80 
GtkTextBufãr
 *
bufãrs
[5];

81 
­Ş_veùÜ_t
 *
™ems
[5];

82 
´št_diff_â_t
 
´št_diff
;

83 } 
muÉi
;

84 } 
d©a
;

88 cÚ¡ 
pŞdiff_fÜm_e
 
fÜm_»v”£_m­
[] = {

90 
	}
};

97 
GtkTextBufãr
 *
	gsšgË_bufãr
 = 
NULL
;

103 
»suÉ_™em_sšgË_pŞdiff_run
(
»suÉ_™em_t
 * 
™em
, 
pŞdiff_t
 * 
diff
, 
šüem’l
 
__©Œibu‹__
 ((
unu£d
)))

105 
	g™em
->
	gdiff
 = 
diff
;

106 
mem£t
(
™em
->
¡©s
, 0, (item->stats));

112 
GtkTextBufãr
 *
	$»suÉ_™em_sšgË_g‘_bufãr
(
»suÉ_™em_t
 * 
™em
, 
pŞdiff_fÜm_e
 
fÜm
)

114 
	`ut_‹xt_bufãr_ş—r
(
sšgË_bufãr
);

115 ià(
fÜm
 =ğ
POLDIFF_FORM_NONE
) {

116 
	`»suÉ_™em_´št_summ¬y
(
™em
, 
sšgË_bufãr
);

118 
	`»suÉ_™em_´št_h—d”
(
™em
, 
sšgË_bufãr
, 
fÜm
);

119 
	`»suÉ_™em_´št_diff
(
™em
, 
sšgË_bufãr
, 
fÜm
);

121  
sšgË_bufãr
;

122 
	}
}

127 
»suÉ_™em_sšgË_is_»nd”_¦ow
(
»suÉ_™em_t
 * 
™em
 
__©Œibu‹__
 ((
unu£d
)), 
pŞdiff_fÜm_e
 
fÜm


128 
__©Œibu‹__
 ((
unu£d
)))

138 
GtkTextBufãr
 *
	$»suÉ_™em_sšgË_g‘_ruË_bufãr
(
»suÉ_™em_t
 * 
™em
, 
pŞdiff_fÜm_e
 
fÜm
)

140 
	`ut_‹xt_bufãr_ş—r
(
sšgË_bufãr
);

141 ià(
fÜm
 =ğ
POLDIFF_FORM_NONE
) {

142 
	`»suÉ_™em_´št_summ¬y
(
™em
, 
sšgË_bufãr
);

144 
	`»suÉ_™em_´št_h—d”
(
™em
, 
sšgË_bufãr
, 
fÜm
);

145 
	`»suÉ_™em_´št_ruË_diff
(
™em
, 
sšgË_bufãr
, 
fÜm
);

147  
sšgË_bufãr
;

148 
	}
}

150 
	$»suÉ_™em_sšgË_g‘_fÜms
(
»suÉ_™em_t
 * 
™em
, 
fÜms
[5])

152 
i
, 
was_run
 = 
	`pŞdiff_is_run
(
™em
->
diff
, i‹m->
b™_pos
);

153 ià(
was_run
) {

154 
	`pŞdiff_g‘_¡©s
(
™em
->
diff
, i‹m->
b™_pos
, i‹m->
¡©s
);

156 
i
 = 0; i < 5; i++) {

157 ià(!
	`»suÉ_™em_is_suµÜ‹d
(
™em
è|| 
i
 =ğ
fÜm_»v”£_m­
[
POLDIFF_FORM_ADD_TYPE
]

158 || 
i
 =ğ
fÜm_»v”£_m­
[
POLDIFF_FORM_REMOVE_TYPE
]) {

161 
fÜms
[
i
] = -1;

163 
fÜms
[
i
] = 
was_run
;

166 
	}
}

171 
»suÉ_™em_t
 *
	$»suÉ_™em_sšgË_ü—‹
(
GtkTextTagTabË
 * 
bË
)

173 
»suÉ_™em_t
 *
™em
 = 
	`ÿÎoc
(1, (*item));

174 ià(
™em
 =ğ
NULL
) {

175  
™em
;

177 ià(
sšgË_bufãr
 =ğ
NULL
) {

178 
sšgË_bufãr
 = 
	`gtk_‹xt_bufãr_Ãw
(
bË
);

180 
™em
->
suµÜ‹d
 = 1;

181 
™em
->
pŞicy_chªged
 = 
NULL
;

182 
™em
->
pŞdiff_run
 = 
»suÉ_™em_sšgË_pŞdiff_run
;

183 
™em
->
g‘_bufãr
 = 
»suÉ_™em_sšgË_g‘_bufãr
;

184 
™em
->
is_»nd”_¦ow
 = 
»suÉ_™em_sšgË_is_»nd”_¦ow
;

185 
™em
->
g‘_fÜms
 = 
»suÉ_™em_sšgË_g‘_fÜms
;

186  
™em
;

187 
	}
}

191 
»suÉ_™em_t
 *
	$»suÉ_™em_ü—‹_şas£s
(
GtkTextTagTabË
 * 
bË
)

193 
»suÉ_™em_t
 *
™em
 = 
	`»suÉ_™em_sšgË_ü—‹
(
bË
);

194 ià(
™em
 =ğ
NULL
) {

195  
™em
;

197 
™em
->
Ïb–
 = "Classes";

198 
™em
->
b™_pos
 = 
POLDIFF_DIFF_CLASSES
;

199 
™em
->
g‘_veùÜ
 = 
pŞdiff_g‘_şass_veùÜ
;

200 
™em
->
g‘_fÜm
 = 
pŞdiff_şass_g‘_fÜm
;

201 
™em
->
g‘_¡ršg
 = 
pŞdiff_şass_to_¡ršg
;

202  
™em
;

203 
	}
}

205 
»suÉ_™em_t
 *
	$»suÉ_™em_ü—‹_commÚs
(
GtkTextTagTabË
 * 
bË
)

207 
»suÉ_™em_t
 *
™em
 = 
	`»suÉ_™em_sšgË_ü—‹
(
bË
);

208 ià(
™em
 =ğ
NULL
) {

209  
™em
;

211 
™em
->
Ïb–
 = "Commons";

212 
™em
->
b™_pos
 = 
POLDIFF_DIFF_COMMONS
;

213 
™em
->
g‘_veùÜ
 = 
pŞdiff_g‘_commÚ_veùÜ
;

214 
™em
->
g‘_fÜm
 = 
pŞdiff_commÚ_g‘_fÜm
;

215 
™em
->
g‘_¡ršg
 = 
pŞdiff_commÚ_to_¡ršg
;

216  
™em
;

217 
	}
}

222 
GtkTextBufãr
 *
	$»suÉ_™em_Ëv–_g‘_bufãr
(
»suÉ_™em_t
 * 
™em
, 
pŞdiff_fÜm_e
 
fÜm
)

224 ià(!
	`»suÉ_™em_is_suµÜ‹d
(
™em
)) {

225 
	`gtk_‹xt_bufãr_£t_‹xt
(
sšgË_bufãr
,

227  
sšgË_bufãr
;

229  
	`»suÉ_™em_sšgË_g‘_bufãr
(
™em
, 
fÜm
);

231 
	}
}

237 
	$»suÉ_™em_Ëv–_pŞicy_chªged
(
»suÉ_™em_t
 * 
™em
, 
­Ş_pŞicy_t
 * 
Üig_pŞ
,‡pŞ_pŞicy_ˆ* 
mod_pŞ
)

239 
qpŞ_pŞicy_t
 *
oq
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
Üig_pŞ
);

240 
qpŞ_pŞicy_t
 *
mq
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
mod_pŞ
);

241 ià(!
	`qpŞ_pŞicy_has_ÿ·b™y
(
oq
, 
QPOL_CAP_MLS
è&& !qpŞ_pŞicy_has_ÿ·b™y(
mq
, QPOL_CAP_MLS)) {

242 
™em
->
suµÜ‹d
 = 0;

244 
™em
->
suµÜ‹d
 = 1;

246 
	}
}

249 
»suÉ_™em_t
 *
	$»suÉ_™em_ü—‹_Ëv–s
(
GtkTextTagTabË
 * 
bË
)

251 
»suÉ_™em_t
 *
™em
 = 
	`»suÉ_™em_sšgË_ü—‹
(
bË
);

252 ià(
™em
 =ğ
NULL
) {

253  
™em
;

255 
™em
->
Ïb–
 = "Levels";

256 
™em
->
b™_pos
 = 
POLDIFF_DIFF_LEVELS
;

257 
™em
->
g‘_veùÜ
 = 
pŞdiff_g‘_Ëv–_veùÜ
;

258 
™em
->
g‘_fÜm
 = 
pŞdiff_Ëv–_g‘_fÜm
;

259 
™em
->
g‘_¡ršg
 = 
pŞdiff_Ëv–_to_¡ršg
;

260 
™em
->
g‘_bufãr
 = 
»suÉ_™em_Ëv–_g‘_bufãr
;

261 
™em
->
pŞicy_chªged
 = 
»suÉ_™em_Ëv–_pŞicy_chªged
;

262  
™em
;

263 
	}
}

268 
GtkTextBufãr
 *
	$»suÉ_™em_ÿ‹gÜy_g‘_bufãr
(
»suÉ_™em_t
 * 
™em
, 
pŞdiff_fÜm_e
 
fÜm
)

270 ià(!
	`»suÉ_™em_is_suµÜ‹d
(
™em
)) {

271 
	`gtk_‹xt_bufãr_£t_‹xt
(
sšgË_bufãr
,

273  
sšgË_bufãr
;

275  
	`»suÉ_™em_sšgË_g‘_bufãr
(
™em
, 
fÜm
);

277 
	}
}

282 
	$»suÉ_™em_ÿ‹gÜy_g‘_fÜms
(
»suÉ_™em_t
 * 
™em
, 
fÜms
[5])

284 
	`»suÉ_™em_sšgË_g‘_fÜms
(
™em
, 
fÜms
);

285 
fÜms
[4] = -1;

286 
	}
}

290 
»suÉ_™em_t
 *
	$»suÉ_™em_ü—‹_ÿ‹gÜ›s
(
GtkTextTagTabË
 * 
bË
)

292 
»suÉ_™em_t
 *
™em
 = 
	`»suÉ_™em_sšgË_ü—‹
(
bË
);

293 ià(
™em
 =ğ
NULL
) {

294  
™em
;

296 
™em
->
Ïb–
 = "Categories";

297 
™em
->
b™_pos
 = 
POLDIFF_DIFF_CATS
;

298 
™em
->
g‘_veùÜ
 = 
pŞdiff_g‘_ÿt_veùÜ
;

299 
™em
->
g‘_fÜm
 = 
pŞdiff_ÿt_g‘_fÜm
;

300 
™em
->
g‘_¡ršg
 = 
pŞdiff_ÿt_to_¡ršg
;

301 
™em
->
g‘_bufãr
 = 
»suÉ_™em_ÿ‹gÜy_g‘_bufãr
;

302 
™em
->
pŞicy_chªged
 = 
»suÉ_™em_Ëv–_pŞicy_chªged
;

303 
™em
->
g‘_fÜms
 = 
»suÉ_™em_ÿ‹gÜy_g‘_fÜms
;

304  
™em
;

305 
	}
}

311 
	$»suÉ_™em_ty³_pŞicy_chªged
(
»suÉ_™em_t
 * 
™em
, 
­Ş_pŞicy_t
 * 
Üig_pŞ
,‡pŞ_pŞicy_ˆ* 
mod_pŞ
)

313 
qpŞ_pŞicy_t
 *
oq
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
Üig_pŞ
);

314 
qpŞ_pŞicy_t
 *
mq
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
mod_pŞ
);

315 ià(!
	`qpŞ_pŞicy_has_ÿ·b™y
(
oq
, 
QPOL_CAP_ATTRIB_NAMES
è|| !qpŞ_pŞicy_has_ÿ·b™y(
mq
, QPOL_CAP_ATTRIB_NAMES)) {

316 
™em
->
d©a
.
ty³_ÿn_modify
 = 0;

318 
™em
->
d©a
.
ty³_ÿn_modify
 = 1;

320 
	}
}

322 
	$»suÉ_™em_ty³_g‘_fÜms
(
»suÉ_™em_t
 * 
™em
, 
fÜms
[5])

324 
	`»suÉ_™em_sšgË_g‘_fÜms
(
™em
, 
fÜms
);

325 ià(!
™em
->
d©a
.
ty³_ÿn_modify
) {

326 
fÜms
[4] = -1;

328 
	}
}

332 
»suÉ_™em_t
 *
	$»suÉ_™em_ü—‹_ty³s
(
GtkTextTagTabË
 * 
bË
)

334 
»suÉ_™em_t
 *
™em
 = 
	`»suÉ_™em_sšgË_ü—‹
(
bË
);

335 ià(
™em
 =ğ
NULL
) {

336  
™em
;

338 
™em
->
Ïb–
 = "Types";

339 
™em
->
b™_pos
 = 
POLDIFF_DIFF_TYPES
;

340 
™em
->
g‘_veùÜ
 = 
pŞdiff_g‘_ty³_veùÜ
;

341 
™em
->
g‘_fÜm
 = 
pŞdiff_ty³_g‘_fÜm
;

342 
™em
->
g‘_¡ršg
 = 
pŞdiff_ty³_to_¡ršg
;

343 
™em
->
pŞicy_chªged
 = 
»suÉ_™em_ty³_pŞicy_chªged
;

344 
™em
->
g‘_fÜms
 = 
»suÉ_™em_ty³_g‘_fÜms
;

345  
™em
;

346 
	}
}

351 
	$»suÉ_™em_©Œibu‹_pŞicy_chªged
(
»suÉ_™em_t
 * 
™em
, 
­Ş_pŞicy_t
 * 
Üig_pŞ
,‡pŞ_pŞicy_ˆ* 
mod_pŞ
)

353 
qpŞ_pŞicy_t
 *
oq
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
Üig_pŞ
);

354 
qpŞ_pŞicy_t
 *
mq
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
mod_pŞ
);

355 ià(!
	`qpŞ_pŞicy_has_ÿ·b™y
(
oq
, 
QPOL_CAP_ATTRIB_NAMES
è|| !qpŞ_pŞicy_has_ÿ·b™y(
mq
, QPOL_CAP_ATTRIB_NAMES)) {

356 
™em
->
suµÜ‹d
 = 0;

358 
™em
->
suµÜ‹d
 = 1;

360 
	}
}

365 
GtkTextBufãr
 *
	$»suÉ_™em_©Œibu‹_g‘_bufãr
(
»suÉ_™em_t
 * 
™em
, 
pŞdiff_fÜm_e
 
fÜm
)

367 ià(!
	`»suÉ_™em_is_suµÜ‹d
(
™em
)) {

368 
	`gtk_‹xt_bufãr_£t_‹xt
(
sšgË_bufãr
,

371  
sšgË_bufãr
;

373  
	`»suÉ_™em_sšgË_g‘_bufãr
(
™em
, 
fÜm
);

375 
	}
}

380 
»suÉ_™em_t
 *
	$»suÉ_™em_ü—‹_©Œibu‹s
(
GtkTextTagTabË
 * 
bË
)

382 
»suÉ_™em_t
 *
™em
 = 
	`»suÉ_™em_sšgË_ü—‹
(
bË
);

383 ià(
™em
 =ğ
NULL
) {

384  
™em
;

386 
™em
->
Ïb–
 = "Attributes";

387 
™em
->
b™_pos
 = 
POLDIFF_DIFF_ATTRIBS
;

388 
™em
->
g‘_veùÜ
 = 
pŞdiff_g‘_©Œib_veùÜ
;

389 
™em
->
g‘_fÜm
 = 
pŞdiff_©Œib_g‘_fÜm
;

390 
™em
->
g‘_¡ršg
 = 
pŞdiff_©Œib_to_¡ršg
;

391 
™em
->
g‘_bufãr
 = 
»suÉ_™em_©Œibu‹_g‘_bufãr
;

392 
™em
->
pŞicy_chªged
 = 
»suÉ_™em_©Œibu‹_pŞicy_chªged
;

393  
™em
;

394 
	}
}

396 
»suÉ_™em_t
 *
	$»suÉ_™em_ü—‹_rŞes
(
GtkTextTagTabË
 * 
bË
)

398 
»suÉ_™em_t
 *
™em
 = 
	`»suÉ_™em_sšgË_ü—‹
(
bË
);

399 ià(
™em
 =ğ
NULL
) {

400  
™em
;

402 
™em
->
Ïb–
 = "Roles";

403 
™em
->
b™_pos
 = 
POLDIFF_DIFF_ROLES
;

404 
™em
->
g‘_veùÜ
 = 
pŞdiff_g‘_rŞe_veùÜ
;

405 
™em
->
g‘_fÜm
 = 
pŞdiff_rŞe_g‘_fÜm
;

406 
™em
->
g‘_¡ršg
 = 
pŞdiff_rŞe_to_¡ršg
;

407  
™em
;

408 
	}
}

414 
	$»suÉ_™em_u£r_´št_modif›d
(
»suÉ_™em_t
 * 
™em
, 
pŞdiff_u£r_t
 * 
u£r
, 
GtkTextBufãr
 * 
tb
, 
GtkTextI‹r
 * 
™”
)

416 
GSŒšg
 *
¡ršg
 = 
	`g_¡ršg_Ãw
("");

417 
	`g_¡ršg_´štf
(
¡ršg
, "* %s\n", 
	`pŞdiff_u£r_g‘_Çme
(
u£r
));

418 
	`»suÉ_™em_´št_¡ršg
(
tb
, 
™”
, 
¡ršg
->
¡r
, 1);

420 cÚ¡ 
­Ş_veùÜ_t
 *
added
 = 
	`pŞdiff_u£r_g‘_added_rŞes
(
u£r
);

421 cÚ¡ 
­Ş_veùÜ_t
 *
»moved
 = 
	`pŞdiff_u£r_g‘_»moved_rŞes
(
u£r
);

422 cÚ¡ 
­Ş_veùÜ_t
 *
unmodif›d
 = 
	`pŞdiff_u£r_g‘_unmodif›d_rŞes
(
u£r
);

423 
size_t
 
i
;

424 *
s
;

425 ià(
	`­Ş_veùÜ_g‘_size
(
added
è> 0 ||‡pŞ_veùÜ_g‘_size(
»moved
) > 0) {

426 
	`g_¡ršg_assign
(
¡ršg
, "„oles {");

427 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
unmodif›d
); i++) {

428 
s
 = (*)
	`­Ş_veùÜ_g‘_–em’t
(
unmodif›d
, 
i
);

429 
	`g_¡ršg_­³nd_´štf
(
¡ršg
, " %s", 
s
);

431 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
added
); i++) {

432 
s
 = (*)
	`­Ş_veùÜ_g‘_–em’t
(
added
, 
i
);

433 
	`g_¡ršg_­³nd_´štf
(
¡ršg
, " +%s", 
s
);

435 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
»moved
); i++) {

436 
s
 = (*)
	`­Ş_veùÜ_g‘_–em’t
(
»moved
, 
i
);

437 
	`g_¡ršg_­³nd_´štf
(
¡ršg
, " -%s", 
s
);

439 
	`g_¡ršg_­³nd
(
¡ršg
, " }\n");

440 
	`»suÉ_™em_´št_¡ršg_šlše
(
tb
, 
™”
, 
¡ršg
->
¡r
, 1);

443 cÚ¡ 
pŞdiff_Ëv–_t
 *
Üig
 = 
	`pŞdiff_u£r_g‘_Üigš®_dæev–
(
u£r
);

444 cÚ¡ 
pŞdiff_Ëv–_t
 *
mod
 = 
	`pŞdiff_u£r_g‘_modif›d_dæev–
(
u£r
);

445 ià(
Üig
 !ğ
NULL
) {

446 
	`»suÉ_™em_´št_¡ršg_šlše
(
tb
, 
™”
, "†evel:\n", 1);

447 
s
 = 
	`pŞdiff_Ëv–_to_¡ršg_br›f
(
™em
->
diff
, 
Üig
);

448 
	`g_¡ršg_´štf
(
¡ršg
, " %s", 
s
);

449 ià(
	`pŞdiff_Ëv–_g‘_fÜm
(
Üig
è!ğ
POLDIFF_FORM_MODIFIED
) {

450 
	`»suÉ_™em_´št_¡ršg
(
tb
, 
™”
, 
¡ršg
->
¡r
, 1);

452 
	`»suÉ_™em_´št_¡ršg_šlše
(
tb
, 
™”
, 
¡ršg
->
¡r
, 1);

454 
	`ä“
(
s
);

455 ià(
mod
 !ğ
NULL
) {

456 
s
 = 
	`pŞdiff_Ëv–_to_¡ršg_br›f
(
™em
->
diff
, 
mod
);

457 
	`g_¡ršg_´štf
(
¡ršg
, " %s", 
s
);

458 ià(
	`pŞdiff_Ëv–_g‘_fÜm
(
mod
è!ğ
POLDIFF_FORM_MODIFIED
) {

459 
	`»suÉ_™em_´št_¡ršg
(
tb
, 
™”
, 
¡ršg
->
¡r
, 1);

461 
	`»suÉ_™em_´št_¡ršg_šlše
(
tb
, 
™”
, 
¡ršg
->
¡r
, 1);

463 
	`ä“
(
s
);

467 cÚ¡ 
pŞdiff_¿nge_t
 *
¿nge
 = 
	`pŞdiff_u£r_g‘_¿nge
(
u£r
);

468 ià(
¿nge
 !ğ
NULL
) {

469 
	`»suÉ_™em_´št_modif›d_¿nge
(
™em
, 
¿nge
, 
tb
, 
™”
);

471 
	`»suÉ_™em_´št_¡ršg
(
tb
, 
™”
, "\n", 0);

472 
	`g_¡ršg_ä“
(
¡ršg
, 
TRUE
);

473 
	}
}

479 
GtkTextBufãr
 *
	$»suÉ_™em_u£r_g‘_bufãr
(
»suÉ_™em_t
 * 
™em
, 
pŞdiff_fÜm_e
 
fÜm
)

481 ià(
fÜm
 !ğ
POLDIFF_FORM_MODIFIED
) {

482  
	`»suÉ_™em_sšgË_g‘_bufãr
(
™em
, 
fÜm
);

484 
	`ut_‹xt_bufãr_ş—r
(
sšgË_bufãr
);

485 
	`»suÉ_™em_´št_h—d”
(
™em
, 
sšgË_bufãr
, 
fÜm
);

486 
GtkTextI‹r
 
™”
;

487 cÚ¡ 
­Ş_veùÜ_t
 *
v
;

488 
size_t
 
i
;

489 
pŞdiff_u£r_t
 *
u£r
;

491 
	`gtk_‹xt_bufãr_g‘_’d_™”
(
sšgË_bufãr
, &
™”
);

492 
v
 = 
™em
->
	`g‘_veùÜ
(™em->
diff
);

493 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v
); i++) {

494 
u£r
 = (
pŞdiff_u£r_t
 *è
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

495 ià(
™em
->
	`g‘_fÜm
(
u£r
è=ğ
fÜm
) {

496 
	`»suÉ_™em_u£r_´št_modif›d
(
™em
, 
u£r
, 
sšgË_bufãr
, &
™”
);

499  
sšgË_bufãr
;

501 
	}
}

504 
»suÉ_™em_t
 *
	$»suÉ_™em_ü—‹_u£rs
(
GtkTextTagTabË
 * 
bË
)

506 
»suÉ_™em_t
 *
™em
 = 
	`»suÉ_™em_sšgË_ü—‹
(
bË
);

507 ià(
™em
 =ğ
NULL
) {

508  
™em
;

510 
™em
->
Ïb–
 = "Users";

511 
™em
->
b™_pos
 = 
POLDIFF_DIFF_USERS
;

512 
™em
->
g‘_veùÜ
 = 
pŞdiff_g‘_u£r_veùÜ
;

513 
™em
->
g‘_fÜm
 = 
pŞdiff_u£r_g‘_fÜm
;

514 
™em
->
g‘_¡ršg
 = 
pŞdiff_u£r_to_¡ršg
;

515 
™em
->
g‘_bufãr
 = 
»suÉ_™em_u£r_g‘_bufãr
;

516  
™em
;

517 
	}
}

522 
	$»suÉ_™em_boŞ—n_pŞicy_chªged
(
»suÉ_™em_t
 * 
™em
, 
­Ş_pŞicy_t
 * 
Üig_pŞ
,‡pŞ_pŞicy_ˆ* 
mod_pŞ
)

524 
qpŞ_pŞicy_t
 *
oq
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
Üig_pŞ
);

525 
qpŞ_pŞicy_t
 *
mq
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
mod_pŞ
);

526 ià(!
	`qpŞ_pŞicy_has_ÿ·b™y
(
oq
, 
QPOL_CAP_CONDITIONALS
è&& !qpŞ_pŞicy_has_ÿ·b™y(
mq
, QPOL_CAP_CONDITIONALS)) {

527 
™em
->
suµÜ‹d
 = 0;

529 
™em
->
suµÜ‹d
 = 1;

531 
	}
}

533 
»suÉ_™em_t
 *
	$»suÉ_™em_ü—‹_boŞ—ns
(
GtkTextTagTabË
 * 
bË
)

535 
»suÉ_™em_t
 *
™em
 = 
	`»suÉ_™em_sšgË_ü—‹
(
bË
);

536 ià(
™em
 =ğ
NULL
) {

537  
™em
;

539 
™em
->
Ïb–
 = "Booleans";

540 
™em
->
b™_pos
 = 
POLDIFF_DIFF_BOOLS
;

541 
™em
->
g‘_veùÜ
 = 
pŞdiff_g‘_boŞ_veùÜ
;

542 
™em
->
g‘_fÜm
 = 
pŞdiff_boŞ_g‘_fÜm
;

543 
™em
->
g‘_¡ršg
 = 
pŞdiff_boŞ_to_¡ršg
;

544 
™em
->
pŞicy_chªged
 = 
»suÉ_™em_boŞ—n_pŞicy_chªged
;

545  
™em
;

546 
	}
}

550 
»suÉ_™em_t
 *
	$»suÉ_™em_ü—‹_rŞe_®lows
(
GtkTextTagTabË
 * 
bË
)

552 
»suÉ_™em_t
 *
™em
 = 
	`»suÉ_™em_sšgË_ü—‹
(
bË
);

553 ià(
™em
 =ğ
NULL
) {

554  
™em
;

556 
™em
->
Ïb–
 = "Role Allows";

557 
™em
->
b™_pos
 = 
POLDIFF_DIFF_ROLE_ALLOWS
;

558 
™em
->
g‘_veùÜ
 = 
pŞdiff_g‘_rŞe_®low_veùÜ
;

559 
™em
->
g‘_fÜm
 = 
pŞdiff_rŞe_®low_g‘_fÜm
;

560 
™em
->
g‘_¡ršg
 = 
pŞdiff_rŞe_®low_to_¡ršg
;

561 
™em
->
g‘_bufãr
 = 
»suÉ_™em_sšgË_g‘_ruË_bufãr
;

562  
™em
;

563 
	}
}

565 
	$»suÉ_™em_rŞe_Œªs_g‘_fÜms
(
»suÉ_™em_t
 * 
™em
, 
fÜms
[5])

567 
i
, 
was_run
 = 
	`pŞdiff_is_run
(
™em
->
diff
, i‹m->
b™_pos
);

568 ià(
was_run
) {

569 
	`pŞdiff_g‘_¡©s
(
™em
->
diff
, i‹m->
b™_pos
, i‹m->
¡©s
);

571 
i
 = 0; i < 5; i++) {

572 ià(!
	`»suÉ_™em_is_suµÜ‹d
(
™em
)) {

573 
fÜms
[
i
] = -1;

575 
fÜms
[
i
] = 
was_run
;

578 
	}
}

583 
»suÉ_™em_t
 *
	$»suÉ_™em_ü—‹_rŞe_Œªs
(
GtkTextTagTabË
 * 
bË
)

585 
»suÉ_™em_t
 *
™em
 = 
	`»suÉ_™em_sšgË_ü—‹
(
bË
);

586 ià(
™em
 =ğ
NULL
) {

587  
™em
;

589 
™em
->
Ïb–
 = "Role Transitions";

590 
™em
->
b™_pos
 = 
POLDIFF_DIFF_ROLE_TRANS
;

591 
™em
->
g‘_veùÜ
 = 
pŞdiff_g‘_rŞe_Œªs_veùÜ
;

592 
™em
->
g‘_fÜm
 = 
pŞdiff_rŞe_Œªs_g‘_fÜm
;

593 
™em
->
g‘_¡ršg
 = 
pŞdiff_rŞe_Œªs_to_¡ršg
;

594 
™em
->
g‘_fÜms
 = 
»suÉ_™em_rŞe_Œªs_g‘_fÜms
;

595 
™em
->
g‘_bufãr
 = 
»suÉ_™em_sšgË_g‘_ruË_bufãr
;

596  
™em
;

597 
	}
}

603 
	$»suÉ_™em_¿nge_Œªs_´št_modif›d
(
»suÉ_™em_t
 * 
™em
, cÚ¡ 
pŞdiff_¿nge_Œªs_t
 * 
¹
, 
GtkTextBufãr
 * 
tb
,

604 
GtkTextI‹r
 * 
™”
)

606 
GSŒšg
 *
¡ršg
 = 
	`g_¡ršg_Ãw
("");

607 *
Üig_s
 = 
	`pŞdiff_¿nge_Œªs_to_¡ršg
(
™em
->
diff
, 
¹
);

608 *
Ãxt_s
 = 
Üig_s
;

609 cÚ¡ 
pŞdiff_¿nge_t
 *
¿nge
 = 
	`pŞdiff_¿nge_Œªs_g‘_¿nge
(
¹
);

612 *
s
 = 
	`¡r£p
(&
Ãxt_s
, "\n");

613 
	`g_¡ršg_´štf
(
¡ršg
, "%s\n", 
s
);

614 
	`»suÉ_™em_´št_¡ršg
(
tb
, 
™”
, 
¡ršg
->
¡r
, 1);

618 
	`ä“
(
Üig_s
);

619 
	`»suÉ_™em_´št_modif›d_¿nge
(
™em
, 
¿nge
, 
tb
, 
™”
);

620 
	}
}

626 
GtkTextBufãr
 *
	$»suÉ_™em_¿nge_Œªs_g‘_bufãr
(
»suÉ_™em_t
 * 
™em
, 
pŞdiff_fÜm_e
 
fÜm
)

628 ià(
fÜm
 !ğ
POLDIFF_FORM_MODIFIED
) {

629  
	`»suÉ_™em_sšgË_g‘_bufãr
(
™em
, 
fÜm
);

631 
	`ut_‹xt_bufãr_ş—r
(
sšgË_bufãr
);

632 
	`»suÉ_™em_´št_h—d”
(
™em
, 
sšgË_bufãr
, 
fÜm
);

633 
GtkTextI‹r
 
™”
;

634 cÚ¡ 
­Ş_veùÜ_t
 *
v
;

635 
size_t
 
i
;

636 
pŞdiff_¿nge_Œªs_t
 *
¹
;

638 
	`gtk_‹xt_bufãr_g‘_’d_™”
(
sšgË_bufãr
, &
™”
);

639 
v
 = 
™em
->
	`g‘_veùÜ
(™em->
diff
);

640 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v
); i++) {

641 
¹
 = (
pŞdiff_¿nge_Œªs_t
 *è
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

642 ià(
™em
->
	`g‘_fÜm
(
¹
è=ğ
fÜm
) {

643 
	`»suÉ_™em_¿nge_Œªs_´št_modif›d
(
™em
, 
¹
, 
sšgË_bufãr
, &
™”
);

646  
sšgË_bufãr
;

648 
	}
}

653 
»suÉ_™em_t
 *
	$»suÉ_™em_ü—‹_¿nge_Œªs
(
GtkTextTagTabË
 * 
bË
)

655 
»suÉ_™em_t
 *
™em
 = 
	`»suÉ_™em_sšgË_ü—‹
(
bË
);

656 ià(
™em
 =ğ
NULL
) {

657  
™em
;

659 
™em
->
Ïb–
 = "Range Transitions";

660 
™em
->
b™_pos
 = 
POLDIFF_DIFF_RANGE_TRANS
;

661 
™em
->
g‘_veùÜ
 = 
pŞdiff_g‘_¿nge_Œªs_veùÜ
;

662 
™em
->
g‘_fÜm
 = 
pŞdiff_¿nge_Œªs_g‘_fÜm
;

663 
™em
->
g‘_¡ršg
 = 
pŞdiff_¿nge_Œªs_to_¡ršg
;

664 
™em
->
g‘_fÜms
 = 
»suÉ_™em_rŞe_Œªs_g‘_fÜms
;

665 
™em
->
g‘_bufãr
 = 
»suÉ_™em_¿nge_Œªs_g‘_bufãr
;

666 
™em
->
pŞicy_chªged
 = 
»suÉ_™em_Ëv–_pŞicy_chªged
;

667  
™em
;

668 
	}
}

675 
	$»suÉ_™em_muÉi_pŞicy_chªged
(
»suÉ_™em_t
 * 
™em
, 
­Ş_pŞicy_t
 * 
Üig_pŞ
,‡pŞ_pŞicy_ˆ* 
mod_pŞ
)

677 
qpŞ_pŞicy_t
 *
oq
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
Üig_pŞ
);

678 
qpŞ_pŞicy_t
 *
mq
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
mod_pŞ
);

679 
™em
->
d©a
.
muÉi
.
has_lše_numb”s
[
SEDIFFX_POLICY_ORIG
] = 
	`qpŞ_pŞicy_has_ÿ·b™y
(
oq
, 
QPOL_CAP_LINE_NUMBERS
);

680 
™em
->
d©a
.
muÉi
.
has_lše_numb”s
[
SEDIFFX_POLICY_MOD
] = 
	`qpŞ_pŞicy_has_ÿ·b™y
(
mq
, 
QPOL_CAP_LINE_NUMBERS
);

681 
	}
}

686 
»suÉ_™em_muÉi_pŞdiff_run
(
»suÉ_™em_t
 * 
™em
, 
pŞdiff_t
 * 
diff
, 
šüem’l
 
__©Œibu‹__
 ((
unu£d
)))

688 
	g™em
->
	gdiff
 = 
diff
;

689 
mem£t
(
™em
->
¡©s
, 0, (item->stats));

690 
	gi
;

691 
	gi
 = 0; i < 5; i++) {

692 
	g™em
->
	gd©a
.
	gmuÉi
.
	gÿched
[
i
] = 0;

693 
ut_‹xt_bufãr_ş—r
(
™em
->
d©a
.
muÉi
.
bufãrs
[
i
]);

700 
GtkTextBufãr
 *
	$»suÉ_™em_muÉi_g‘_bufãr
(
»suÉ_™em_t
 * 
™em
, 
pŞdiff_fÜm_e
 
fÜm
)

702 
GtkTextBufãr
 *
tb
;

703 ià(
fÜm
 =ğ
POLDIFF_FORM_NONE
) {

706 
	`ut_‹xt_bufãr_ş—r
(
sšgË_bufãr
);

707 
	`»suÉ_™em_´št_summ¬y
(
™em
, 
sšgË_bufãr
);

708 
tb
 = 
sšgË_bufãr
;

710 
tb
 = 
™em
->
d©a
.
muÉi
.
bufãrs
[
fÜm_»v”£_m­
[
fÜm
]];

711 ià(!
™em
->
d©a
.
muÉi
.
ÿched
[
fÜm_»v”£_m­
[
fÜm
]]) {

712 
	`ut_‹xt_bufãr_ş—r
(
tb
);

713 
	`»suÉ_™em_´št_h—d”
(
™em
, 
tb
, 
fÜm
);

714 
™em
->
d©a
.
muÉi
.
	`´št_diff
(™em, 
tb
, 
fÜm
);

715 
™em
->
d©a
.
muÉi
.
ÿched
[
fÜm_»v”£_m­
[
fÜm
]] = 1;

718  
tb
;

719 
	}
}

725 
	$»suÉ_™em_muÉi_is_»nd”_¦ow
(
»suÉ_™em_t
 * 
™em
, 
pŞdiff_fÜm_e
 
fÜm
)

727 ià(
fÜm
 =ğ
POLDIFF_FORM_NONE
 || 
™em
->
d©a
.
muÉi
.
ÿched
[
fÜm_»v”£_m­
[form]]

728 || 
	`»suÉ_™em_g‘_num_difã»nûs
(
™em
, 
fÜm
) < 50) {

732 
	}
}

734 
	$»suÉ_™em_muÉi_£t_cu¼’t_sÜt
(
»suÉ_™em_t
 * 
™em
, 
pŞdiff_fÜm_e
 
fÜm
, 
»suÉs_sÜt_e
 
sÜt
,

735 
»suÉs_sÜt_dœ_e
 
dœ
)

737 ià(
™em
->
sÜts
[
fÜm_»v”£_m­
[
fÜm
]] !ğ
sÜt
 || i‹m->
sÜt_dœs
[fÜm_»v”£_m­[fÜm]] !ğ
dœ
) {

738 
™em
->
sÜts
[
fÜm_»v”£_m­
[
fÜm
]] = 
sÜt
;

739 
™em
->
sÜt_dœs
[
fÜm_»v”£_m­
[
fÜm
]] = 
dœ
;

740 
™em
->
d©a
.
muÉi
.
ÿched
[
fÜm_»v”£_m­
[
fÜm
]] = 0;

742 
	}
}

744 
	$»suÉ_™em_muÉi_de¡ruùÜ
(
»suÉ_™em_t
 * 
™em
)

746 
size_t
 
i
;

747 
i
 = 0; i < 5; i++) {

748 
	`­Ş_veùÜ_de¡roy
(&
™em
->
d©a
.
muÉi
.
™ems
[
i
]);

750 
	}
}

757 
»suÉ_™em_t
 *
	$»suÉ_™em_muÉi_ü—‹
(
GtkTextTagTabË
 * 
bË
)

759 
»suÉ_™em_t
 *
™em
 = 
	`ÿÎoc
(1, (*item));

760 ià(
™em
 =ğ
NULL
) {

761  
™em
;

763 ià(
sšgË_bufãr
 =ğ
NULL
) {

764 
sšgË_bufãr
 = 
	`gtk_‹xt_bufãr_Ãw
(
bË
);

766 
™em
->
suµÜ‹d
 = 1;

767 
™em
->
de¡ruùÜ
 = 
»suÉ_™em_muÉi_de¡ruùÜ
;

768 
™em
->
pŞicy_chªged
 = 
»suÉ_™em_muÉi_pŞicy_chªged
;

769 
™em
->
pŞdiff_run
 = 
»suÉ_™em_muÉi_pŞdiff_run
;

770 
™em
->
g‘_bufãr
 = 
»suÉ_™em_muÉi_g‘_bufãr
;

771 
™em
->
is_»nd”_¦ow
 = 
»suÉ_™em_muÉi_is_»nd”_¦ow
;

772 
™em
->
g‘_fÜms
 = 
»suÉ_™em_rŞe_Œªs_g‘_fÜms
;

773 
™em
->
£t_cu¼’t_sÜt
 = 
»suÉ_™em_muÉi_£t_cu¼’t_sÜt
;

774 
i
;

775 
i
 = 0; i < 5; i++) {

776 
™em
->
d©a
.
muÉi
.
bufãrs
[
i
] = 
	`gtk_‹xt_bufãr_Ãw
(
bË
);

777 
™em
->
sÜts
[
i
] = 
RESULTS_SORT_DEFAULT
;

778 
™em
->
sÜt_dœs
[
i
] = 
RESULTS_SORT_ASCEND
;

780  
™em
;

781 
	}
}

783 
	ssÜt_İts


785 
pŞdiff_t
 *
	mdiff
;

786 
»suÉs_sÜt_e
 
	mf›ld
;

787 
»suÉs_sÜt_dœ_e
 
	mdœeùiÚ
;

790 
	$»suÉ_™em_avruË_comp
(cÚ¡ *
a
, cÚ¡ *
b
, *
d©a
)

792 cÚ¡ 
pŞdiff_avruË_t
 *
a1
 = 
a
;

793 cÚ¡ 
pŞdiff_avruË_t
 *
a2
 = 
b
;

794 
sÜt_İts
 *
İts
 = 
d©a
;

795 cÚ¡ *
s1
, *
s2
;

796 
İts
->
f›ld
) {

797 
RESULTS_SORT_SOURCE
:

799 
s1
 = 
	`pŞdiff_avruË_g‘_sourû_ty³
(
a1
);

800 
s2
 = 
	`pŞdiff_avruË_g‘_sourû_ty³
(
a2
);

803 
RESULTS_SORT_TARGET
:

805 
s1
 = 
	`pŞdiff_avruË_g‘_rg‘_ty³
(
a1
);

806 
s2
 = 
	`pŞdiff_avruË_g‘_rg‘_ty³
(
a2
);

809 
RESULTS_SORT_CLASS
:

811 
s1
 = 
	`pŞdiff_avruË_g‘_objeù_şass
(
a1
);

812 
s2
 = 
	`pŞdiff_avruË_g‘_objeù_şass
(
a2
);

815 
RESULTS_SORT_COND
:

817 cÚ¡ 
qpŞ_cÚd_t
 *
q1
, *
q2
;

818 cÚ¡ 
­Ş_pŞicy_t
 *
p1
, *
p2
;

819 
ušt32_t
 
w1
, 
w2
;

820 
	`pŞdiff_avruË_g‘_cÚd
(
İts
->
diff
, 
a1
, &
q1
, &
w1
, &
p1
);

821 
	`pŞdiff_avruË_g‘_cÚd
(
İts
->
diff
, 
a2
, &
q2
, &
w2
, &
p2
);

822 ià(
q1
 !ğ
q2
) {

823  
İts
->
dœeùiÚ
 * ((*)
q1
 - (*)
q2
);

825  
İts
->
dœeùiÚ
 * (
w1
 - 
w2
);

831 
	`as£¹
(0);

835  
İts
->
dœeùiÚ
 * 
	`¡rcmp
(
s1
, 
s2
);

836 
	}
}

838 
­Ş_veùÜ_t
 *
	$»suÉ_™em_avruË_sÜt
(
»suÉ_™em_t
 * 
™em
, 
pŞdiff_fÜm_e
 
fÜm
)

840 cÚ¡ 
­Ş_veùÜ_t
 *
Üig_v
;

841 
­Ş_veùÜ_t
 *
v
;

842 
size_t
 
i
;

843 *
–em
;

844 
sÜt_İts
 
İts
 = { 
™em
->
diff
, i‹m->
sÜts
[
fÜm_»v”£_m­
[
fÜm
]], i‹m->
sÜt_dœs
[form_reverse_map[form]] };

846 
Üig_v
 = 
™em
->
	`g‘_veùÜ
(™em->
diff
);

847 ià((
v
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)) == NULL) {

848  
NULL
;

850 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
Üig_v
); i++) {

851 
–em
 = 
	`­Ş_veùÜ_g‘_–em’t
(
Üig_v
, 
i
);

852 ià(
	`pŞdiff_avruË_g‘_fÜm
(
–em
è=ğ
fÜm
 && 
	`­Ş_veùÜ_­³nd
(
v
,ƒlem) < 0) {

853 
	`­Ş_veùÜ_de¡roy
(&
v
);

854  
NULL
;

857 ià(
İts
.
f›ld
 !ğ
RESULTS_SORT_DEFAULT
) {

858 
	`­Ş_veùÜ_sÜt
(
v
, 
»suÉ_™em_avruË_comp
, &
İts
);

860  
v
;

861 
	}
}

863 
	$»suÉ_™em_avruË_´št_diff
(
»suÉ_™em_t
 * 
™em
, 
GtkTextBufãr
 * 
tb
, 
pŞdiff_fÜm_e
 
fÜm
)

865 
GtkTextI‹r
 
™”
;

866 
size_t
 
i
;

867 *
–em
;

868 *
s
;

869 
GSŒšg
 *
¡ršg
 = 
	`g_¡ršg_Ãw
("");

870 cÚ¡ 
­Ş_veùÜ_t
 *
syn_lš’os
;

871 
­Ş_veùÜ_t
 *
ruËs
 = 
	`»suÉ_™em_avruË_sÜt
(
™em
, 
fÜm
);

872 *
Üig_´efix
;

873 *
mod_´efix
;

875 
	`­Ş_veùÜ_de¡roy
(&
™em
->
d©a
.
muÉi
.
™ems
[
fÜm_»v”£_m­
[
fÜm
]]);

876 
™em
->
d©a
.
muÉi
.
™ems
[
fÜm_»v”£_m­
[
fÜm
]] = 
ruËs
;

877 
	`gtk_‹xt_bufãr_g‘_’d_™”
(
tb
, &
™”
);

878 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
ruËs
); i++) {

879 
–em
 = 
	`­Ş_veùÜ_g‘_–em’t
(
ruËs
, 
i
);

880 ià((
s
 = 
	`pŞdiff_avruË_to_¡ršg
(
™em
->
diff
, 
–em
)è=ğ
NULL
) {

881 
ş—nup
;

883 
	`»suÉ_™em_´št_¡ršg_avruË
(
tb
, &
™”
, 
s
, 1);

884 ià(
fÜm
 !ğ
POLDIFF_FORM_MODIFIED
) {

885 
Üig_´efix
 = 
NULL
;

886 
mod_´efix
 = 
NULL
;

888 
Üig_´efix
 = "op: ";

889 
mod_´efix
 = "mp: ";

891 ià(
™em
->
d©a
.
muÉi
.
has_lše_numb”s
[
SEDIFFX_POLICY_ORIG
] &&

892 (
syn_lš’os
 = 
	`pŞdiff_avruË_g‘_Üig_lše_numb”s
((
pŞdiff_avruË_t
 *è
–em
)è!ğ
NULL
) {

893 
	`»suÉ_™em_´št_lš’os
(
tb
, &
™”
, 
Üig_´efix
, 
syn_lš’os
, "lše-pŞ_Üig", 
¡ršg
);

895 ià(
™em
->
d©a
.
muÉi
.
has_lše_numb”s
[
SEDIFFX_POLICY_MOD
] &&

896 (
syn_lš’os
 = 
	`pŞdiff_avruË_g‘_mod_lše_numb”s
((
pŞdiff_avruË_t
 *è
–em
)è!ğ
NULL
) {

897 
	`»suÉ_™em_´št_lš’os
(
tb
, &
™”
, 
mod_´efix
, 
syn_lš’os
, "lše-pŞ_mod", 
¡ršg
);

899 
	`ä“
(
s
);

900 
	`gtk_‹xt_bufãr_š£¹
(
tb
, &
™”
, "\n", -1);

902 
ş—nup
:

903 
	`g_¡ršg_ä“
(
¡ršg
, 
TRUE
);

904 
	}
}

909 
	$»suÉ_™em_avruË_pŞicy_chªged
(
»suÉ_™em_t
 * 
™em
, 
­Ş_pŞicy_t
 * 
Üig_pŞ
,‡pŞ_pŞicy_ˆ* 
mod_pŞ
)

911 
™em
->
suµÜ‹d
 = 1;

912 ià(
™em
->
b™_pos
 =ğ
POLDIFF_DIFF_AVNEVERALLOW
) {

913 
qpŞ_pŞicy_t
 *
oq
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
Üig_pŞ
);

914 
qpŞ_pŞicy_t
 *
mq
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
mod_pŞ
);

915 
Üig_ty³
 = -1, 
mod_ty³
 = -1;

922 
	`qpŞ_pŞicy_g‘_ty³
(
oq
, &
Üig_ty³
);

923 
	`qpŞ_pŞicy_g‘_ty³
(
mq
, &
mod_ty³
);

924 ià(
Üig_ty³
 =ğ
QPOL_POLICY_KERNEL_BINARY
 && 
mod_ty³
 == QPOL_POLICY_KERNEL_BINARY) {

925 
™em
->
suµÜ‹d
 = 0;

928 
	`»suÉ_™em_muÉi_pŞicy_chªged
(
™em
, 
Üig_pŞ
, 
mod_pŞ
);

929 
	}
}

934 
GtkTextBufãr
 *
	$»suÉ_™em_avruË_g‘_bufãr
(
»suÉ_™em_t
 * 
™em
, 
pŞdiff_fÜm_e
 
fÜm
)

936 ià(!
	`»suÉ_™em_is_suµÜ‹d
(
™em
)) {

937 
	`gtk_‹xt_bufãr_£t_‹xt
(
sšgË_bufãr
,

939  
sšgË_bufãr
;

941  
	`»suÉ_™em_muÉi_g‘_bufãr
(
™em
, 
fÜm
);

943 
	}
}

945 
»suÉ_™em_t
 *
	$»suÉ_™em_ü—‹_äom_æag
(
GtkTextTagTabË
 * 
bË
, 
ušt32_t
 
æag
)

947 
»suÉ_™em_t
 *
™em
 = 
	`»suÉ_™em_muÉi_ü—‹
(
bË
);

948 ià(
™em
 =ğ
NULL
) {

949  
™em
;

951 cÚ¡ 
pŞdiff_compÚ’t_»cÜd_t
 *
»c
 = 
	`pŞdiff_g‘_compÚ’t_»cÜd
(
æag
);

952 
™em
->
Ïb–
 = 
	`pŞdiff_compÚ’t_»cÜd_g‘_Ïb–
(
»c
);

953 
™em
->
b™_pos
 = 
æag
;

954 
™em
->
g‘_veùÜ
 = 
	`pŞdiff_compÚ’t_»cÜd_g‘_»suÉs_â
(
»c
);

955 
™em
->
g‘_fÜm
 = 
	`pŞdiff_compÚ’t_»cÜd_g‘_fÜm_â
(
»c
);

956 
™em
->
g‘_¡ršg
 = 
	`pŞdiff_compÚ’t_»cÜd_g‘_to_¡ršg_â
(
»c
);

957 
™em
->
g‘_bufãr
 = 
»suÉ_™em_avruË_g‘_bufãr
;

958 
™em
->
d©a
.
muÉi
.
´št_diff
 = 
»suÉ_™em_avruË_´št_diff
;

959 
™em
->
pŞicy_chªged
 = 
»suÉ_™em_avruË_pŞicy_chªged
;

960  
™em
;

961 
	}
}

963 
»suÉ_™em_t
 *
	$»suÉ_™em_ü—‹_avruËs_®low
(
GtkTextTagTabË
 * 
bË
)

965  
	`»suÉ_™em_ü—‹_äom_æag
(
bË
, 
POLDIFF_DIFF_AVALLOW
);

966 
	}
}

968 
»suÉ_™em_t
 *
	$»suÉ_™em_ü—‹_avruËs_aud™®low
(
GtkTextTagTabË
 * 
bË
)

970  
	`»suÉ_™em_ü—‹_äom_æag
(
bË
, 
POLDIFF_DIFF_AVAUDITALLOW
);

971 
	}
}

973 
»suÉ_™em_t
 *
	$»suÉ_™em_ü—‹_avruËs_dÚud™
(
GtkTextTagTabË
 * 
bË
)

975  
	`»suÉ_™em_ü—‹_äom_æag
(
bË
, 
POLDIFF_DIFF_AVDONTAUDIT
);

976 
	}
}

978 
»suÉ_™em_t
 *
	$»suÉ_™em_ü—‹_avruËs_Ãv”®low
(
GtkTextTagTabË
 * 
bË
)

980  
	`»suÉ_™em_ü—‹_äom_æag
(
bË
, 
POLDIFF_DIFF_AVNEVERALLOW
);

981 
	}
}

983 
	$»suÉ_™em_‹ruË_comp
(cÚ¡ *
a
, cÚ¡ *
b
, *
d©a
)

985 cÚ¡ 
pŞdiff_‹ruË_t
 *
a1
 = 
a
;

986 cÚ¡ 
pŞdiff_‹ruË_t
 *
a2
 = 
b
;

987 
sÜt_İts
 *
İts
 = 
d©a
;

988 cÚ¡ *
s1
, *
s2
;

989 
İts
->
f›ld
) {

990 
RESULTS_SORT_SOURCE
:

992 
s1
 = 
	`pŞdiff_‹ruË_g‘_sourû_ty³
(
a1
);

993 
s2
 = 
	`pŞdiff_‹ruË_g‘_sourû_ty³
(
a2
);

996 
RESULTS_SORT_TARGET
:

998 
s1
 = 
	`pŞdiff_‹ruË_g‘_rg‘_ty³
(
a1
);

999 
s2
 = 
	`pŞdiff_‹ruË_g‘_rg‘_ty³
(
a2
);

1002 
RESULTS_SORT_CLASS
:

1004 
s1
 = 
	`pŞdiff_‹ruË_g‘_objeù_şass
(
a1
);

1005 
s2
 = 
	`pŞdiff_‹ruË_g‘_objeù_şass
(
a2
);

1008 
RESULTS_SORT_COND
:

1010 cÚ¡ 
qpŞ_cÚd_t
 *
q1
, *
q2
;

1011 cÚ¡ 
­Ş_pŞicy_t
 *
p1
, *
p2
;

1012 
ušt32_t
 
w1
, 
w2
;

1013 
	`pŞdiff_‹ruË_g‘_cÚd
(
İts
->
diff
, 
a1
, &
q1
, &
w1
, &
p1
);

1014 
	`pŞdiff_‹ruË_g‘_cÚd
(
İts
->
diff
, 
a2
, &
q2
, &
w2
, &
p2
);

1015 ià(
q1
 !ğ
q2
) {

1016  
İts
->
dœeùiÚ
 * ((*)
q1
 - (*)
q2
);

1018  
İts
->
dœeùiÚ
 * (
w1
 - 
w2
);

1024 
	`as£¹
(0);

1028  
İts
->
dœeùiÚ
 * 
	`¡rcmp
(
s1
, 
s2
);

1029 
	}
}

1031 
­Ş_veùÜ_t
 *
	$»suÉ_™em_‹ruË_sÜt
(
»suÉ_™em_t
 * 
™em
, 
pŞdiff_fÜm_e
 
fÜm
)

1033 cÚ¡ 
­Ş_veùÜ_t
 *
Üig_v
;

1034 
­Ş_veùÜ_t
 *
v
;

1035 
size_t
 
i
;

1036 *
–em
;

1037 
sÜt_İts
 
İts
 = { 
™em
->
diff
, i‹m->
sÜts
[
fÜm_»v”£_m­
[
fÜm
]], i‹m->
sÜt_dœs
[form_reverse_map[form]] };

1038 
Üig_v
 = 
™em
->
	`g‘_veùÜ
(™em->
diff
);

1039 ià((
v
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
)) == NULL) {

1040  
NULL
;

1042 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
Üig_v
); i++) {

1043 
–em
 = 
	`­Ş_veùÜ_g‘_–em’t
(
Üig_v
, 
i
);

1044 ià(
	`pŞdiff_‹ruË_g‘_fÜm
(
–em
è=ğ
fÜm
 && 
	`­Ş_veùÜ_­³nd
(
v
,ƒlem) < 0) {

1045 
	`­Ş_veùÜ_de¡roy
(&
v
);

1046  
NULL
;

1049 ià(
İts
.
f›ld
 !ğ
RESULTS_SORT_DEFAULT
) {

1050 
	`­Ş_veùÜ_sÜt
(
v
, 
»suÉ_™em_‹ruË_comp
, &
İts
);

1052  
v
;

1053 
	}
}

1055 
	$»suÉ_™em_‹ruË_´št_diff
(
»suÉ_™em_t
 * 
™em
, 
GtkTextBufãr
 * 
tb
, 
pŞdiff_fÜm_e
 
fÜm
)

1057 
GtkTextI‹r
 
™”
;

1058 
size_t
 
i
;

1059 *
–em
;

1060 *
s
;

1061 
GSŒšg
 *
¡ršg
 = 
	`g_¡ršg_Ãw
("");

1062 
­Ş_veùÜ_t
 *
syn_lš’os
;

1063 
­Ş_veùÜ_t
 *
ruËs
 = 
	`»suÉ_™em_‹ruË_sÜt
(
™em
, 
fÜm
);

1064 *
Üig_´efix
;

1065 *
mod_´efix
;

1067 
	`gtk_‹xt_bufãr_g‘_’d_™”
(
tb
, &
™”
);

1068 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
ruËs
); i++) {

1069 
–em
 = 
	`­Ş_veùÜ_g‘_–em’t
(
ruËs
, 
i
);

1070 ià((
s
 = 
	`pŞdiff_‹ruË_to_¡ršg
(
™em
->
diff
, 
–em
)è=ğ
NULL
) {

1071 
ş—nup
;

1073 ià(
fÜm
 !ğ
POLDIFF_FORM_MODIFIED
) {

1074 
Üig_´efix
 = 
NULL
;

1075 
mod_´efix
 = 
NULL
;

1076 
	`»suÉ_™em_´št_¡ršg
(
tb
, &
™”
, 
s
, 1);

1078 
Üig_´efix
 = "op: ";

1079 
mod_´efix
 = "mp: ";

1080 
	`»suÉ_™em_´št_¡ršg_šlše
(
tb
, &
™”
, 
s
, 1);

1082 ià(
™em
->
d©a
.
muÉi
.
has_lše_numb”s
[
SEDIFFX_POLICY_ORIG
] &&

1083 (
syn_lš’os
 = 
	`pŞdiff_‹ruË_g‘_Üig_lše_numb”s
((
pŞdiff_‹ruË_t
 *è
–em
)è!ğ
NULL
) {

1084 
	`»suÉ_™em_´št_lš’os
(
tb
, &
™”
, 
Üig_´efix
, 
syn_lš’os
, "lše-pŞ_Üig", 
¡ršg
);

1086 ià(
™em
->
d©a
.
muÉi
.
has_lše_numb”s
[
SEDIFFX_POLICY_MOD
] &&

1087 (
syn_lš’os
 = 
	`pŞdiff_‹ruË_g‘_mod_lše_numb”s
((
pŞdiff_‹ruË_t
 *è
–em
)è!ğ
NULL
) {

1088 
	`»suÉ_™em_´št_lš’os
(
tb
, &
™”
, 
mod_´efix
, 
syn_lš’os
, "lše-pŞ_mod", 
¡ršg
);

1090 
	`ä“
(
s
);

1091 
	`gtk_‹xt_bufãr_š£¹
(
tb
, &
™”
, "\n", -1);

1093 
ş—nup
:

1094 
	`­Ş_veùÜ_de¡roy
(&
ruËs
);

1095 
	`g_¡ršg_ä“
(
¡ršg
, 
TRUE
);

1096 
	}
}

1098 
»suÉ_™em_t
 *
	$»suÉ_™em_ü—‹_‹ruËs_äom_æag
(
GtkTextTagTabË
 * 
bË
, 
ušt32_t
 
æag
)

1100 
»suÉ_™em_t
 *
™em
 = 
	`»suÉ_™em_muÉi_ü—‹
(
bË
);

1101 ià(
™em
 =ğ
NULL
) {

1102  
™em
;

1104 cÚ¡ 
pŞdiff_compÚ’t_»cÜd_t
 *
»c
 = 
	`pŞdiff_g‘_compÚ’t_»cÜd
(
æag
);

1105 
™em
->
Ïb–
 = 
	`pŞdiff_compÚ’t_»cÜd_g‘_Ïb–
(
»c
);

1106 
™em
->
b™_pos
 = 
æag
;

1107 
™em
->
g‘_veùÜ
 = 
	`pŞdiff_compÚ’t_»cÜd_g‘_»suÉs_â
(
»c
);

1108 
™em
->
g‘_fÜm
 = 
	`pŞdiff_compÚ’t_»cÜd_g‘_fÜm_â
(
»c
);

1109 
™em
->
g‘_¡ršg
 = 
	`pŞdiff_compÚ’t_»cÜd_g‘_to_¡ršg_â
(
»c
);

1110 
™em
->
d©a
.
muÉi
.
´št_diff
 = 
»suÉ_™em_‹ruË_´št_diff
;

1111  
™em
;

1112 
	}
}

1114 
»suÉ_™em_t
 *
	$»suÉ_™em_ü—‹_‹ruËs_chªge
(
GtkTextTagTabË
 * 
bË
)

1116  
	`»suÉ_™em_ü—‹_‹ruËs_äom_æag
(
bË
, 
POLDIFF_DIFF_TECHANGE
);

1117 
	}
}

1119 
»suÉ_™em_t
 *
	$»suÉ_™em_ü—‹_‹ruËs_memb”
(
GtkTextTagTabË
 * 
bË
)

1121  
	`»suÉ_™em_ü—‹_‹ruËs_äom_æag
(
bË
, 
POLDIFF_DIFF_TEMEMBER
);

1122 
	}
}

1124 
»suÉ_™em_t
 *
	$»suÉ_™em_ü—‹_‹ruËs_Œªs
(
GtkTextTagTabË
 * 
bË
)

1126  
	`»suÉ_™em_ü—‹_‹ruËs_äom_æag
(
bË
, 
POLDIFF_DIFF_TETRANS
);

1127 
	}
}

1131 
	$»suÉ_™em_de¡roy
(
»suÉ_™em_t
 ** 
™em
)

1133 ià(
™em
 !ğ
NULL
 && *item != NULL) {

1134 ià((*
™em
)->
de¡ruùÜ
 !ğ
NULL
) {

1135 (*
™em
)->
	`de¡ruùÜ
(*item);

1137 
	`ä“
(*
™em
);

1139 *
™em
 = 
NULL
;

1141 
	}
}

1143 cÚ¡ *
	$»suÉ_™em_g‘_Ïb–
(cÚ¡ 
»suÉ_™em_t
 * 
™em
)

1145  
™em
->
Ïb–
;

1146 
	}
}

1148 
	$»suÉ_™em_pŞicy_chªged
(
»suÉ_™em_t
 * 
™em
, 
­Ş_pŞicy_t
 * 
Üig_pŞ
,‡pŞ_pŞicy_ˆ* 
mod_pŞ
)

1150 ià(
™em
->
pŞicy_chªged
 !ğ
NULL
) {

1151 
™em
->
	`pŞicy_chªged
(™em, 
Üig_pŞ
, 
mod_pŞ
);

1153 
	}
}

1155 
GtkTextBufãr
 *
	$»suÉ_™em_g‘_bufãr
(
»suÉ_™em_t
 * 
™em
, 
pŞdiff_fÜm_e
 
fÜm
)

1157  
™em
->
	`g‘_bufãr
(™em, 
fÜm
);

1158 
	}
}

1160 
	$»suÉ_™em_is_»nd”_¦ow
(
»suÉ_™em_t
 * 
™em
, 
pŞdiff_fÜm_e
 
fÜm
)

1162  
™em
->
	`is_»nd”_¦ow
(™em, 
fÜm
);

1163 
	}
}

1165 
	$»suÉ_™em_pŞdiff_run
(
»suÉ_™em_t
 * 
™em
, 
pŞdiff_t
 * 
diff
, 
šüem’l
)

1167 
™em
->
	`pŞdiff_run
(™em, 
diff
, 
šüem’l
);

1168 
	}
}

1170 
	$»suÉ_™em_is_suµÜ‹d
(cÚ¡ 
»suÉ_™em_t
 * 
™em
)

1172  
™em
->
suµÜ‹d
;

1173 
	}
}

1175 
	$»suÉ_™em_g‘_fÜms
(
»suÉ_™em_t
 * 
™em
, 
fÜms
[5])

1177 
™em
->
	`g‘_fÜms
(™em, 
fÜms
);

1178 
	}
}

1180 
size_t
 
	$»suÉ_™em_g‘_num_difã»nûs
(
»suÉ_™em_t
 * 
™em
, 
pŞdiff_fÜm_e
 
fÜm
)

1182 
fÜm
) {

1183 
POLDIFF_FORM_ADDED
:

1184  
™em
->
¡©s
[0];

1185 
POLDIFF_FORM_REMOVED
:

1186  
™em
->
¡©s
[1];

1187 
POLDIFF_FORM_MODIFIED
:

1188  
™em
->
¡©s
[2];

1189 
POLDIFF_FORM_ADD_TYPE
:

1190  
™em
->
¡©s
[3];

1191 
POLDIFF_FORM_REMOVE_TYPE
:

1192  
™em
->
¡©s
[4];

1194 
	`as£¹
(0);

1197 
	}
}

1199 
	$»suÉ_™em_g‘_cu¼’t_sÜt
(
»suÉ_™em_t
 * 
™em
, 
pŞdiff_fÜm_e
 
fÜm
, 
»suÉs_sÜt_e
 * 
sÜt
, 
»suÉs_sÜt_dœ_e
 * 
dœ
)

1201 ià(
™em
->
£t_cu¼’t_sÜt
 =ğ
NULL
 || 
fÜm
 =ğ
POLDIFF_FORM_NONE
) {

1204 *
sÜt
 = 
™em
->
sÜts
[
fÜm_»v”£_m­
[
fÜm
]];

1205 *
dœ
 = 
™em
->
sÜt_dœs
[
fÜm_»v”£_m­
[
fÜm
]];

1207 
	}
}

1209 
	$»suÉ_™em_£t_cu¼’t_sÜt
(
»suÉ_™em_t
 * 
™em
, 
pŞdiff_fÜm_e
 
fÜm
, 
»suÉs_sÜt_e
 
sÜt
, 
»suÉs_sÜt_dœ_e
 
dœ
)

1211 ià(
™em
->
£t_cu¼’t_sÜt
 !ğ
NULL
 && 
fÜm
 !ğ
POLDIFF_FORM_NONE
) {

1212 
™em
->
	`£t_cu¼’t_sÜt
(™em, 
fÜm
, 
sÜt
, 
dœ
);

1214 
	}
}

1216 
	$»suÉ_™em_§ve_cu¼’t_lše
(
»suÉ_™em_t
 * 
™em
, 
pŞdiff_fÜm_e
 
fÜm
, 
gšt
 
off£t
)

1219 ià(
fÜm
 !ğ
POLDIFF_FORM_NONE
) {

1220 
™em
->
off£ts
[
fÜm_»v”£_m­
[
fÜm
]] = 
off£t
;

1222 
	}
}

1224 
gšt
 
	$»suÉ_™em_g‘_cu¼’t_lše
(
»suÉ_™em_t
 * 
™em
, 
pŞdiff_fÜm_e
 
fÜm
)

1227 ià(
fÜm
 =ğ
POLDIFF_FORM_NONE
) {

1230  
™em
->
off£ts
[
fÜm_»v”£_m­
[
fÜm
]];

1231 
	}
}

1233 
	$»suÉ_™em_Ú_Üig_aùiv©e
(
GtkM’uI‹m
 * 
m’u™em
, 
gpoš‹r
 
u£r_d©a
)

1235 
tİËv–_t
 *
tİ
 = (tİËv–_ˆ*è
u£r_d©a
;

1236 
GtkWidg‘
 *
Ïb–
 = 
	`gtk_bš_g‘_chd
(
	`GTK_BIN
(
m’u™em
));

1237 
lše
 = 
	`©oi
(
	`gtk_Ïb–_g‘_Ïb–
(
	`GTK_LABEL
(
Ïb–
))) - 1;

1238 
	`tİËv–_show_pŞicy_lše
(
tİ
, 
SEDIFFX_POLICY_ORIG
, 
lše
);

1239 
	}
}

1241 
	$»suÉ_™em_Ú_mod_aùiv©e
(
GtkM’uI‹m
 * 
m’u™em
, 
gpoš‹r
 
u£r_d©a
)

1243 
tİËv–_t
 *
tİ
 = (tİËv–_ˆ*è
u£r_d©a
;

1244 
GtkWidg‘
 *
Ïb–
 = 
	`gtk_bš_g‘_chd
(
	`GTK_BIN
(
m’u™em
));

1245 
lše
 = 
	`©oi
(
	`gtk_Ïb–_g‘_Ïb–
(
	`GTK_LABEL
(
Ïb–
))) - 1;

1246 
	`tİËv–_show_pŞicy_lše
(
tİ
, 
SEDIFFX_POLICY_MOD
, 
lše
);

1247 
	}
}

1249 
	$»suÉ_™em_šlše_lšk_ev’t
(
»suÉ_™em_t
 * 
™em
, 
tİËv–_t
 * 
tİ
, 
GtkWidg‘
 * 
cÚš”
, 
GdkEv’tBu‰Ú
 * 
ev’t
,

1250 
pŞdiff_fÜm_e
 
fÜm
, 
lše_num
, cÚ¡ *
s
)

1253 
	`as£¹
(
™em
->
b™_pos
 & 
POLDIFF_DIFF_AVRULES
);

1254 cÚ¡ *
³rm
;

1255 
pŞdiff_fÜm_e
 
³rm_fÜm
 = 
fÜm
;

1256 ià(*
s
 == '+' || *s == '-' || *s == '*') {

1257 ià(*
s
 == '+') {

1258 
³rm_fÜm
 = 
POLDIFF_FORM_ADDED
;

1259 } ià(*
s
 == '-') {

1260 
³rm_fÜm
 = 
POLDIFF_FORM_REMOVED
;

1262 
³rm
 = 
s
 + 1;

1264 
³rm
 = 
s
;

1266 
­Ş_veùÜ_t
 *
ruËs
 = 
™em
->
d©a
.
muÉi
.
™ems
[
fÜm_»v”£_m­
[
fÜm
]];

1267 
size_t
 
i
 = 
lše_num
 - 3;

1269 
pŞdiff_avruË_t
 *
ruË
 = 
	`­Ş_veùÜ_g‘_–em’t
(
ruËs
, 
i
);

1270 
	`as£¹
(
ruË
 !ğ
NULL
);

1272 
GtkM’u
 *
m’u
 = 
	`GTK_MENU
(
	`gtk_m’u_Ãw
());

1273 
GtkWidg‘
 *
m’u™em
;

1274 
GSŒšg
 *
¡ršg
 = 
	`g_¡ršg_Ãw
("");

1275 
bu‰Ú
, 
ev’t_time
;

1276 
	`gtk_m’u_£t_t™Ë
(
m’u
, 
³rm
);

1277 
m’u™em
 = 
	`gtk_m’u_™em_Ãw_w™h_Ïb–
(
³rm
);

1278 
	`gtk_widg‘_£t_£ns™ive
(
m’u™em
, 
FALSE
);

1279 
	`gtk_m’u_sh–l_­³nd
(
	`GTK_MENU_SHELL
(
m’u
), 
m’u™em
);

1281 
m’u™em
 = 
	`gtk_£·¿tÜ_m’u_™em_Ãw
();

1282 
	`gtk_m’u_sh–l_­³nd
(
	`GTK_MENU_SHELL
(
m’u
), 
m’u™em
);

1283 
m’u™em
 = 
	`gtk_m’u_™em_Ãw_w™h_Ïb–
("Original Policy");

1284 
	`gtk_widg‘_£t_£ns™ive
(
m’u™em
, 
FALSE
);

1285 
	`gtk_m’u_sh–l_­³nd
(
	`GTK_MENU_SHELL
(
m’u
), 
m’u™em
);

1286 ià(
³rm_fÜm
 =ğ
POLDIFF_FORM_REMOVED
 ||…”m_fÜm =ğ
POLDIFF_FORM_REMOVE_TYPE
 ||…”m_fÜm =ğ
POLDIFF_FORM_MODIFIED
) {

1287 ià(
™em
->
d©a
.
muÉi
.
has_lše_numb”s
[
SEDIFFX_POLICY_ORIG
]) {

1288 
­Ş_veùÜ_t
 *
v
 = 
	`pŞdiff_avruË_g‘_Üig_lše_numb”s_fÜ_³rm
(
™em
->
diff
, 
ruË
, 
³rm
);

1289 ià(
v
 !ğ
NULL
 && 
	`­Ş_veùÜ_g‘_size
(v) > 0) {

1290 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v
); i++) {

1291 
lše
 = ()
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

1292 
	`g_¡ršg_´štf
(
¡ršg
, " %lu", 
lše
);

1293 
m’u™em
 = 
	`gtk_m’u_™em_Ãw_w™h_Ïb–
(
¡ršg
->
¡r
);

1294 
	`g_sigÇl_cÚÃù
(
m’u™em
, "aùiv©e", 
	`G_CALLBACK
(
»suÉ_™em_Ú_Üig_aùiv©e
), 
tİ
);

1295 
	`gtk_m’u_sh–l_­³nd
(
	`GTK_MENU_SHELL
(
m’u
), 
m’u™em
);

1299 
m’u™em
 = 
	`gtk_m’u_™em_Ãw_w™h_Ïb–
("†ine‚umbers‚ot‡vailable");

1300 
	`gtk_widg‘_£t_£ns™ive
(
m’u™em
, 
FALSE
);

1301 
	`gtk_m’u_sh–l_­³nd
(
	`GTK_MENU_SHELL
(
m’u
), 
m’u™em
);

1305 
m’u™em
 = 
	`gtk_£·¿tÜ_m’u_™em_Ãw
();

1306 
	`gtk_m’u_sh–l_­³nd
(
	`GTK_MENU_SHELL
(
m’u
), 
m’u™em
);

1307 
m’u™em
 = 
	`gtk_m’u_™em_Ãw_w™h_Ïb–
("Modified Policy");

1308 
	`gtk_widg‘_£t_£ns™ive
(
m’u™em
, 
FALSE
);

1309 
	`gtk_m’u_sh–l_­³nd
(
	`GTK_MENU_SHELL
(
m’u
), 
m’u™em
);

1310 ià(
³rm_fÜm
 =ğ
POLDIFF_FORM_ADDED
 ||…”m_fÜm =ğ
POLDIFF_FORM_ADD_TYPE
 ||…”m_fÜm =ğ
POLDIFF_FORM_MODIFIED
) {

1311 ià(
™em
->
d©a
.
muÉi
.
has_lše_numb”s
[
SEDIFFX_POLICY_MOD
]) {

1312 
­Ş_veùÜ_t
 *
v
 = 
	`pŞdiff_avruË_g‘_mod_lše_numb”s_fÜ_³rm
(
™em
->
diff
, 
ruË
, 
³rm
);

1313 ià(
v
 !ğ
NULL
 && 
	`­Ş_veùÜ_g‘_size
(v) > 0) {

1314 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v
); i++) {

1315 
lše
 = ()
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

1316 
	`g_¡ršg_´štf
(
¡ršg
, " %lu", 
lše
);

1317 
m’u™em
 = 
	`gtk_m’u_™em_Ãw_w™h_Ïb–
(
¡ršg
->
¡r
);

1318 
	`g_sigÇl_cÚÃù
(
m’u™em
, "aùiv©e", 
	`G_CALLBACK
(
»suÉ_™em_Ú_mod_aùiv©e
), 
tİ
);

1319 
	`gtk_m’u_sh–l_­³nd
(
	`GTK_MENU_SHELL
(
m’u
), 
m’u™em
);

1323 
m’u™em
 = 
	`gtk_m’u_™em_Ãw_w™h_Ïb–
("†ine‚umbers‚ot‡vailable");

1324 
	`gtk_widg‘_£t_£ns™ive
(
m’u™em
, 
FALSE
);

1325 
	`gtk_m’u_sh–l_­³nd
(
	`GTK_MENU_SHELL
(
m’u
), 
m’u™em
);

1328 
	`g_¡ršg_ä“
(
¡ršg
, 
TRUE
);

1329 ià(
ev’t
 !ğ
NULL
) {

1330 
bu‰Ú
 = 
ev’t
->button;

1331 
ev’t_time
 = 
ev’t
->
time
;

1333 
bu‰Ú
 = 0;

1334 
ev’t_time
 = 
	`gtk_g‘_cu¼’t_ev’t_time
();

1336 
	`gtk_m’u_©ch_to_widg‘
(
m’u
, 
cÚš”
, 
NULL
);

1337 
	`gtk_widg‘_show_®l
(
	`GTK_WIDGET
(
m’u
));

1338 
	`gtk_m’u_pİup
(
m’u
, 
NULL
, NULL, NULL, NULL, 
bu‰Ú
, 
ev’t_time
);

1339 
	}
}

1343 
pŞdiff_t
 *
	$»suÉ_™em_g‘_diff
(
»suÉ_™em_t
 * 
™em
)

1345  
™em
->
diff
;

1346 
	}
}

1348 cÚ¡ 
­Ş_veùÜ_t
 *
	$»suÉ_™em_g‘_veùÜ
(
»suÉ_™em_t
 * 
™em
)

1350  
™em
->
	`g‘_veùÜ
(™em->
diff
);

1351 
	}
}

1353 
pŞdiff_fÜm_e
 
	$»suÉ_™em_g‘_fÜm
(
»suÉ_™em_t
 * 
™em
, *
–em
)

1355  
™em
->
	`g‘_fÜm
(
–em
);

1356 
	}
}

1358 *
	$»suÉ_™em_g‘_¡ršg
(
»suÉ_™em_t
 * 
™em
, *
–em
)

1360  
™em
->
	`g‘_¡ršg
(™em->
diff
, 
–em
);

1361 
	}
}

	@sediff/result_item.h

24 #iâdeà
RESULT_ITEM_H


25 
	#RESULT_ITEM_H


	)

27 
»suÉ_™em
 
	t»suÉ_™em_t
;

29 
	~"»suÉs.h
"

31 
	~<gtk/gtk.h
>

32 
	~<pŞdiff/pŞdiff.h
>

33 
	~<pŞdiff/compÚ’t_»cÜd.h
>

37 
»suÉ_™em_t
 *
»suÉ_™em_ü—‹_şas£s
(
GtkTextTagTabË
 * 
bË
);

38 
»suÉ_™em_t
 *
»suÉ_™em_ü—‹_commÚs
(
GtkTextTagTabË
 * 
bË
);

39 
»suÉ_™em_t
 *
»suÉ_™em_ü—‹_Ëv–s
(
GtkTextTagTabË
 * 
bË
);

40 
»suÉ_™em_t
 *
»suÉ_™em_ü—‹_ÿ‹gÜ›s
(
GtkTextTagTabË
 * 
bË
);

41 
»suÉ_™em_t
 *
»suÉ_™em_ü—‹_ty³s
(
GtkTextTagTabË
 * 
bË
);

42 
»suÉ_™em_t
 *
»suÉ_™em_ü—‹_©Œibu‹s
(
GtkTextTagTabË
 * 
bË
);

43 
»suÉ_™em_t
 *
»suÉ_™em_ü—‹_rŞes
(
GtkTextTagTabË
 * 
bË
);

44 
»suÉ_™em_t
 *
»suÉ_™em_ü—‹_u£rs
(
GtkTextTagTabË
 * 
bË
);

45 
»suÉ_™em_t
 *
»suÉ_™em_ü—‹_boŞ—ns
(
GtkTextTagTabË
 * 
bË
);

47 
»suÉ_™em_t
 *
»suÉ_™em_ü—‹_avruËs_®low
(
GtkTextTagTabË
 * 
bË
);

48 
»suÉ_™em_t
 *
»suÉ_™em_ü—‹_avruËs_aud™®low
(
GtkTextTagTabË
 * 
bË
);

49 
»suÉ_™em_t
 *
»suÉ_™em_ü—‹_avruËs_dÚud™
(
GtkTextTagTabË
 * 
bË
);

50 
»suÉ_™em_t
 *
»suÉ_™em_ü—‹_avruËs_Ãv”®low
(
GtkTextTagTabË
 * 
bË
);

52 
»suÉ_™em_t
 *
»suÉ_™em_ü—‹_‹ruËs_chªge
(
GtkTextTagTabË
 * 
bË
);

53 
»suÉ_™em_t
 *
»suÉ_™em_ü—‹_‹ruËs_memb”
(
GtkTextTagTabË
 * 
bË
);

54 
»suÉ_™em_t
 *
»suÉ_™em_ü—‹_‹ruËs_Œªs
(
GtkTextTagTabË
 * 
bË
);

56 
»suÉ_™em_t
 *
»suÉ_™em_ü—‹_rŞe_®lows
(
GtkTextTagTabË
 * 
bË
);

57 
»suÉ_™em_t
 *
»suÉ_™em_ü—‹_rŞe_Œªs
(
GtkTextTagTabË
 * 
bË
);

58 
»suÉ_™em_t
 *
»suÉ_™em_ü—‹_¿nge_Œªs
(
GtkTextTagTabË
 * 
bË
);

67 
»suÉ_™em_de¡roy
(
»suÉ_™em_t
 ** 
™em
);

77 cÚ¡ *
»suÉ_™em_g‘_Ïb–
(cÚ¡ 
»suÉ_™em_t
 * 
™em
);

87 
»suÉ_™em_pŞicy_chªged
(
»suÉ_™em_t
 * 
™em
, 
­Ş_pŞicy_t
 * 
Üig_pŞ
,‡pŞ_pŞicy_ˆ* 
mod_pŞ
);

98 
»suÉ_™em_pŞdiff_run
(
»suÉ_™em_t
 * 
™em
, 
pŞdiff_t
 * 
diff
, 
šüem’l
);

111 
GtkTextBufãr
 *
»suÉ_™em_g‘_bufãr
(
»suÉ_™em_t
 * 
™em
, 
pŞdiff_fÜm_e
 
fÜm
);

127 
»suÉ_™em_is_»nd”_¦ow
(
»suÉ_™em_t
 * 
™em
, 
pŞdiff_fÜm_e
 
fÜm
);

142 
»suÉ_™em_is_suµÜ‹d
(cÚ¡ 
»suÉ_™em_t
 * 
™em
);

163 
»suÉ_™em_g‘_fÜms
(
»suÉ_™em_t
 * 
™em
, 
fÜms
[5]);

174 
size_t
 
»suÉ_™em_g‘_num_difã»nûs
(
»suÉ_™em_t
 * 
™em
, 
pŞdiff_fÜm_e
 
fÜm
);

188 
»suÉ_™em_g‘_cu¼’t_sÜt
(
»suÉ_™em_t
 * 
™em
, 
pŞdiff_fÜm_e
 
fÜm
, 
»suÉs_sÜt_e
 * 
sÜt
, 
»suÉs_sÜt_dœ_e
 * 
dœ
);

201 
»suÉ_™em_£t_cu¼’t_sÜt
(
»suÉ_™em_t
 * 
™em
, 
pŞdiff_fÜm_e
 
fÜm
, 
»suÉs_sÜt_e
 
sÜt
, 
»suÉs_sÜt_dœ_e
 
dœ
);

211 
»suÉ_™em_§ve_cu¼’t_lše
(
»suÉ_™em_t
 * 
™em
, 
pŞdiff_fÜm_e
 
fÜm
, 
gšt
 
off£t
);

222 
gšt
 
»suÉ_™em_g‘_cu¼’t_lše
(
»suÉ_™em_t
 * 
™em
, 
pŞdiff_fÜm_e
 
fÜm
);

240 
»suÉ_™em_šlše_lšk_ev’t
(
»suÉ_™em_t
 * 
™em
, 
tİËv–_t
 * 
tİ
, 
GtkWidg‘
 * 
cÚš”
, 
GdkEv’tBu‰Ú
 * 
ev’t
,

241 
pŞdiff_fÜm_e
 
fÜm
, 
lše_num
, cÚ¡ *
s
);

246 
pŞdiff_t
 *
»suÉ_™em_g‘_diff
(
»suÉ_™em_t
 * 
™em
);

247 cÚ¡ 
­Ş_veùÜ_t
 *
»suÉ_™em_g‘_veùÜ
(
»suÉ_™em_t
 * 
™em
);

248 
pŞdiff_fÜm_e
 
»suÉ_™em_g‘_fÜm
(
»suÉ_™em_t
 * 
™em
, *
–em
);

249 *
»suÉ_™em_g‘_¡ršg
(
»suÉ_™em_t
 * 
™em
, *
–em
);

	@sediff/result_item_render.c

25 
	~<cÚfig.h
>

27 
	~"»suÉ_™em_»nd”.h
"

29 
	~<as£¹.h
>

31 cÚ¡ *
	gfÜm_Çme_m­
[] = {

34 cÚ¡ *
	gfÜm_Çme_lÚg_m­
[] = {

37 cÚ¡ *
	gg_m­
[] = {

40 cÚ¡ 
pŞdiff_fÜm_e
 
	gfÜm_m­
[] = {

41 
POLDIFF_FORM_ADDED
, 
POLDIFF_FORM_ADD_TYPE
,

42 
POLDIFF_FORM_REMOVED
, 
POLDIFF_FORM_REMOVE_TYPE
,

43 
POLDIFF_FORM_MODIFIED


50 
	$»suÉ_™em_´št_¡ršg
(
GtkTextBufãr
 * 
tb
, 
GtkTextI‹r
 * 
™”
, cÚ¡ *
s
, 
šd’t_Ëv–
)

52 cÚ¡ *
c
;

53 
i
;

54 
size_t
 
¡¬t
 = 0, 
’d
 = 0;

55 cÚ¡ *
šd’t
 = "\t";

56 cÚ¡ 
gch¬
 *
g
 = 
NULL
;

57 
i
 = 0; i < 
šd’t_Ëv–
; i++) {

58 
	`gtk_‹xt_bufãr_š£¹
(
tb
, 
™”
, 
šd’t
, -1);

60 
c
 = 
s
; *ø&& 
g
 =ğ
NULL
; c++) {

61 *
c
) {

64 
g
 = "added";

69 
g
 = "removed";

80 
g
 = "modified";

85 
c
 = 
s
; *c; c++, 
’d
++) {

86 ià(*
c
 == '\n' && *(c + 1) != '\0') {

87 
	`gtk_‹xt_bufãr_š£¹_w™h_gs_by_Çme
(
tb
, 
™”
, 
s
 + 
¡¬t
, 
’d
 - s¹ + 1, 
g
, 
NULL
);

88 
i
 = 0; i < 
šd’t_Ëv–
; i++) {

89 
	`gtk_‹xt_bufãr_š£¹
(
tb
, 
™”
, 
šd’t
, -1);

91 
¡¬t
 = 
’d
 + 1;

94 ià(
¡¬t
 < 
’d
) {

95 
	`gtk_‹xt_bufãr_š£¹_w™h_gs_by_Çme
(
tb
, 
™”
, 
s
 + 
¡¬t
, 
’d
 - s¹, 
g
, 
NULL
);

97 
	}
}

99 
	$»suÉ_™em_´št_¡ršg_šlše
(
GtkTextBufãr
 * 
tb
, 
GtkTextI‹r
 * 
™”
, cÚ¡ *
s
, 
šd’t_Ëv–
)

101 cÚ¡ *
c
 = 
s
;

102 
i
;

103 
size_t
 
¡¬t
 = 0, 
’d
 = 0;

104 cÚ¡ *
šd’t
 = "\t";

105 cÚ¡ 
gch¬
 *
cu¼’t_g
 = "modified";

106 
i
 = 0; i < 
šd’t_Ëv–
; i++) {

107 
	`gtk_‹xt_bufãr_š£¹
(
tb
, 
™”
, 
šd’t
, -1);

109 ; *
c
; c++, 
’d
++) {

110 *
c
) {

113 ià(
’d
 > 0) {

114 
	`gtk_‹xt_bufãr_š£¹_w™h_gs_by_Çme
(
tb
, 
™”
, 
s
 + 
¡¬t
, 
’d
 - s¹, 
cu¼’t_g
, 
NULL
);

116 
¡¬t
 = 
’d
;

117 
cu¼’t_g
 = "added";

122 ià(
’d
 > 0) {

123 
	`gtk_‹xt_bufãr_š£¹_w™h_gs_by_Çme
(
tb
, 
™”
, 
s
 + 
¡¬t
, 
’d
 - s¹, 
cu¼’t_g
, 
NULL
);

125 
¡¬t
 = 
’d
;

126 
cu¼’t_g
 = "removed";

131 ià(*(
c
 + 1) != '\0') {

132 
	`gtk_‹xt_bufãr_š£¹_w™h_gs_by_Çme
(
tb
, 
™”
, 
s
 + 
¡¬t
, 
’d
 - s¹ + 1, 
cu¼’t_g
, 
NULL
);

133 
i
 = 0; i < 
šd’t_Ëv–
; i++) {

134 
	`gtk_‹xt_bufãr_š£¹
(
tb
, 
™”
, 
šd’t
, -1);

136 
¡¬t
 = 
’d
 + 1;

142 ià(
cu¼’t_g
 != "modified") {

143 
	`gtk_‹xt_bufãr_š£¹_w™h_gs_by_Çme
(
tb
, 
™”
, 
s
 + 
¡¬t
, 
’d
 - s¹ + 1, 
cu¼’t_g
, 
NULL
);

144 
¡¬t
 = 
’d
 + 1;

145 
cu¼’t_g
 = "modified";

151 ià(
¡¬t
 < 
’d
) {

152 
	`gtk_‹xt_bufãr_š£¹_w™h_gs_by_Çme
(
tb
, 
™”
, 
s
 + 
¡¬t
, 
’d
 - s¹, 
cu¼’t_g
, 
NULL
);

154 
	}
}

156 
	$»suÉ_™em_´št_¡ršg_avruË
(
GtkTextBufãr
 * 
tb
, 
GtkTextI‹r
 * 
™”
, cÚ¡ *
s
, 
šd’t_Ëv–
)

158 cÚ¡ *
c
, *
Ãxt_c
;

159 cÚ¡ *
g
 = 
NULL
, *
š™_g
;

160 
i
;

161 cÚ¡ *
šd’t
 = "\t";

162 
i
 = 0; i < 
šd’t_Ëv–
; i++) {

163 
	`gtk_‹xt_bufãr_š£¹
(
tb
, 
™”
, 
šd’t
, -1);

165 
c
 = 
s
; *ø&& 
g
 =ğ
NULL
; c++) {

166 *
c
) {

169 
g
 = "added";

174 
g
 = "removed";

185 
g
 = "modified";

190 
š™_g
 = 
g
;

191 
c
 = 
	`¡rchr
(
s
, '{');

192 
	`as£¹
(
c
 !ğ
NULL
);

195 
c
 += 2;

196 
	`gtk_‹xt_bufãr_š£¹_w™h_gs_by_Çme
(
tb
, 
™”
, 
s
, 
c
 - s, 
š™_g
, 
NULL
);

197 *
c
 != '}') {

198 
	`as£¹
(*
c
 != '\0');

199 
Ãxt_c
 = 
	`¡rchr
(
c
, ' ');

200 
	`as£¹
(
Ãxt_c
 !ğ
NULL
);

201 *
c
) {

204 
g
 = "added";

209 
g
 = "removed";

214 
g
 = 
š™_g
;

217 
	`gtk_‹xt_bufãr_š£¹_w™h_gs_by_Çme
(
tb
, 
™”
, 
c
, 
Ãxt_c
 - c, 
g
, "šlše-lšk", 
NULL
);

218 
	`gtk_‹xt_bufãr_š£¹_w™h_gs_by_Çme
(
tb
, 
™”
, " ", 1, 
š™_g
, 
NULL
);

220 
c
 = 
Ãxt_c
 + 1;

222 
	`gtk_‹xt_bufãr_š£¹_w™h_gs_by_Çme
(
tb
, 
™”
, 
c
, -1, 
š™_g
, 
NULL
);

223 
	}
}

225 
	$»suÉ_™em_´št_diff
(
»suÉ_™em_t
 * 
™em
, 
GtkTextBufãr
 * 
tb
, 
pŞdiff_fÜm_e
 
fÜm
)

227 
GtkTextI‹r
 
™”
;

228 cÚ¡ 
­Ş_veùÜ_t
 *
v
;

229 
size_t
 
i
;

230 *
–em
;

231 *
s
 = 
NULL
;

233 
	`gtk_‹xt_bufãr_g‘_’d_™”
(
tb
, &
™”
);

234 
v
 = 
	`»suÉ_™em_g‘_veùÜ
(
™em
);

235 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v
); i++) {

236 
–em
 = 
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

237 ià(
	`»suÉ_™em_g‘_fÜm
(
™em
, 
–em
è=ğ
fÜm
) {

238 
s
 = 
	`»suÉ_™em_g‘_¡ršg
(
™em
, 
–em
);

239 
	`»suÉ_™em_´št_¡ršg
(
tb
, &
™”
, 
s
, 1);

240 
	`ä“
(
s
);

241 
	`gtk_‹xt_bufãr_š£¹
(
tb
, &
™”
, "\n", -1);

244 
	}
}

246 
	$»suÉ_™em_´št_ruË_diff
(
»suÉ_™em_t
 * 
™em
, 
GtkTextBufãr
 * 
tb
, 
pŞdiff_fÜm_e
 
fÜm
)

248 
GtkTextI‹r
 
™”
;

249 cÚ¡ 
­Ş_veùÜ_t
 *
v
;

250 
size_t
 
i
;

251 *
–em
;

252 *
s
 = 
NULL
;

254 
	`gtk_‹xt_bufãr_g‘_’d_™”
(
tb
, &
™”
);

255 
v
 = 
	`»suÉ_™em_g‘_veùÜ
(
™em
);

256 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v
); i++) {

257 
–em
 = 
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

258 ià(
	`»suÉ_™em_g‘_fÜm
(
™em
, 
–em
è=ğ
fÜm
) {

259 
s
 = 
	`»suÉ_™em_g‘_¡ršg
(
™em
, 
–em
);

260 ià(
fÜm
 !ğ
POLDIFF_FORM_MODIFIED
) {

261 
	`»suÉ_™em_´št_¡ršg
(
tb
, &
™”
, 
s
, 1);

263 
	`»suÉ_™em_´št_¡ršg_šlše
(
tb
, &
™”
, 
s
, 1);

265 
	`ä“
(
s
);

266 
	`gtk_‹xt_bufãr_š£¹
(
tb
, &
™”
, "\n", -1);

269 
	}
}

271 
	$»suÉ_™em_´št_summ¬y
(
»suÉ_™em_t
 * 
™em
, 
GtkTextBufãr
 * 
tb
)

273 
GtkTextI‹r
 
™”
;

274 
i
, 
fÜms
[5];

275 
GSŒšg
 *
¡ršg
 = 
	`g_¡ršg_Ãw
("");

277 
	`gtk_‹xt_bufãr_g‘_’d_™”
(
tb
, &
™”
);

278 
	`g_¡ršg_´štf
(
¡ršg
, "%s:\n", 
	`»suÉ_™em_g‘_Ïb–
(
™em
));

279 
	`gtk_‹xt_bufãr_š£¹_w™h_gs_by_Çme
(
tb
, &
™”
, 
¡ršg
->
¡r
, -1, "subh—d”", 
NULL
);

281 
was_run
 = 0;

282 
	`»suÉ_™em_g‘_fÜms
(
™em
, 
fÜms
);

283 
i
 = 0; i < 5; i++) {

284 ià(
fÜms
[
i
] > 0) {

285 
	`g_¡ršg_´štf
(
¡ršg
, "\t%s: %zd\n",

286 
fÜm_Çme_lÚg_m­
[
i
], 
	`»suÉ_™em_g‘_num_difã»nûs
(
™em
, 
fÜm_m­
[i]));

287 
	`gtk_‹xt_bufãr_š£¹_w™h_gs_by_Çme
(
tb
, &
™”
, 
¡ršg
->
¡r
, -1, 
g_m­
[
i
], 
NULL
);

288 
was_run
 = 1;

291 ià(!
was_run
 && 
	`»suÉ_™em_is_suµÜ‹d
(
™em
)) {

292 
	`gtk_‹xt_bufãr_£t_‹xt
(
tb
, "This component has‚ot yet been diffed.", -1);

294 
	`g_¡ršg_ä“
(
¡ršg
, 
TRUE
);

295 
	}
}

300 
	$»suÉ_™em_´št_h—d”
(
»suÉ_™em_t
 * 
™em
, 
GtkTextBufãr
 * 
tb
, 
pŞdiff_fÜm_e
 
fÜm
)

302 
GtkTextI‹r
 
™”
;

303 
i
, 
fÜms
[5];

304 
GSŒšg
 *
¡ršg
 = 
	`g_¡ršg_Ãw
("");

305 *
g
 = 
NULL
;

306 cÚ¡ *
Ïb–
 = 
	`»suÉ_™em_g‘_Ïb–
(
™em
);

307 
add_£·¿tÜ
 = 0;

309 
	`gtk_‹xt_bufãr_g‘_’d_™”
(
tb
, &
™”
);

310 
	`»suÉ_™em_g‘_fÜms
(
™em
, 
fÜms
);

311 
	`g_¡ršg_´štf
(
¡ršg
, "% (", 
Ïb–
);

312 
i
 = 0; i < 5; i++) {

313 ià(
fÜms
[
i
] > 0) {

314 
	`g_¡ršg_­³nd_´štf
(
¡ršg
, "%s%zd %s",

315 (
add_£·¿tÜ
 ? ", " : ""),

316 
	`»suÉ_™em_g‘_num_difã»nûs
(
™em
, 
fÜm_m­
[
i
]), 
fÜm_Çme_m­
[i]);

317 
add_£·¿tÜ
 = 1;

320 
	`g_¡ršg_­³nd_´štf
(
¡ršg
, ")\n\n");

321 
	`gtk_‹xt_bufãr_š£¹_w™h_gs_by_Çme
(
tb
, &
™”
, 
¡ršg
->
¡r
, -1, "h—d”", 
NULL
);

323 
fÜm
) {

324 
POLDIFF_FORM_ADDED
:

326 
	`g_¡ršg_´štf
(
¡ršg
, "Added %s:", 
Ïb–
);

327 
g
 = "added-header";

330 
POLDIFF_FORM_ADD_TYPE
:

332 
	`g_¡ršg_´štf
(
¡ršg
, "Added % beÿu£ oàÃwy³:", 
Ïb–
);

333 
g
 = "added-header";

336 
POLDIFF_FORM_REMOVED
:

338 
	`g_¡ršg_´štf
(
¡ršg
, "Removed %s:", 
Ïb–
);

339 
g
 = "removed-header";

342 
POLDIFF_FORM_REMOVE_TYPE
:

344 
	`g_¡ršg_´štf
(
¡ršg
, "Removed % beÿu£ oàmissšgy³:", 
Ïb–
);

345 
g
 = "removed-header";

348 
POLDIFF_FORM_MODIFIED
:

350 
	`g_¡ršg_´štf
(
¡ršg
, "Modif›d %s:", 
Ïb–
);

351 
g
 = "modified-header";

356 
	`as£¹
(0);

357 
g
 = 
NULL
;

360 
	`g_¡ršg_­³nd_´štf
(
¡ršg
, " %zd\n", 
	`»suÉ_™em_g‘_num_difã»nûs
(
™em
, 
fÜm
));

361 
	`gtk_‹xt_bufãr_š£¹_w™h_gs_by_Çme
(
tb
, &
™”
, 
¡ršg
->
¡r
, -1, 
g
, 
NULL
);

362 
	`g_¡ršg_ä“
(
¡ršg
, 
TRUE
);

363 
	}
}

365 
	$»suÉ_™em_´št_lš’os
(
GtkTextBufãr
 * 
tb
, 
GtkTextI‹r
 * 
™”
,

366 cÚ¡ 
gch¬
 * 
´efix
, cÚ¡ 
­Ş_veùÜ_t
 * 
lš’os
, cÚ¡ gch¬ * 
g
, 
GSŒšg
 * 
¡ršg
)

368 
size_t
 
i
;

369 
lš’o
;

370 
	`gtk_‹xt_bufãr_š£¹
(
tb
, 
™”
, " [", -1);

371 ià(
´efix
 !ğ
NULL
) {

372 
	`gtk_‹xt_bufãr_š£¹
(
tb
, 
™”
, 
´efix
, -1);

374 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
lš’os
); i++) {

375 
lš’o
 = ()
	`­Ş_veùÜ_g‘_–em’t
(
lš’os
, 
i
);

376 ià(
i
 > 0) {

377 
	`gtk_‹xt_bufãr_š£¹
(
tb
, 
™”
, ", ", -1);

379 
	`g_¡ršg_´štf
(
¡ršg
, "%lu", 
lš’o
);

380 
	`gtk_‹xt_bufãr_š£¹_w™h_gs_by_Çme
(
tb
, 
™”
, 
¡ršg
->
¡r
, -1, 
g
, 
NULL
);

382 
	`gtk_‹xt_bufãr_š£¹
(
tb
, 
™”
, "]", -1);

383 
	}
}

385 
	$»suÉ_™em_´št_modif›d_¿nge
(
»suÉ_™em_t
 * 
™em
, cÚ¡ 
pŞdiff_¿nge_t
 * 
¿nge
, 
GtkTextBufãr
 * 
tb
, 
GtkTextI‹r
 * 
™”
)

387 
pŞdiff_t
 *
diff
 = 
	`»suÉ_™em_g‘_diff
(
™em
);

388 *
Üig_s
 = 
	`pŞdiff_¿nge_to_¡ršg_br›f
(
diff
, 
¿nge
);

389 *
Ãxt_s
 = 
Üig_s
;

390 
GSŒšg
 *
¡ršg
 = 
	`g_¡ršg_Ãw
("");

393 *
s
 = 
	`¡r£p
(&
Ãxt_s
, "\n");

394 
	`»suÉ_™em_´št_¡ršg
(
tb
, 
™”
, 
s
, 1);

395 
	`gtk_‹xt_bufãr_š£¹
(
tb
, 
™”
, "\n", -1);

399 ià(
	`¡ºcmp
(
Ãxt_s
, " mšimum c©egÜ›s:", 
	`¡¾’
(" minimum categories:")) == 0) {

400 
s
 = 
	`¡r£p
(&
Ãxt_s
, "\n");

401 
	`»suÉ_™em_´št_¡ršg_šlše
(
tb
, 
™”
, 
s
, 1);

402 
	`gtk_‹xt_bufãr_š£¹
(
tb
, 
™”
, "\n", -1);

406 
	`ä“
(
Üig_s
);

407 
­Ş_veùÜ_t
 *
Ëv–s
 = 
	`pŞdiff_¿nge_g‘_Ëv–s
(
¿nge
);

408 
size_t
 
i
;

409 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
Ëv–s
); i++) {

410 
pŞdiff_Ëv–_t
 *
l
 = 
	`­Ş_veùÜ_g‘_–em’t
(
Ëv–s
, 
i
);

411 
s
 = 
	`pŞdiff_Ëv–_to_¡ršg_br›f
(
diff
, 
l
);

412 
	`g_¡ršg_´štf
(
¡ršg
, " %s", 
s
);

413 ià(
	`pŞdiff_Ëv–_g‘_fÜm
(
l
è!ğ
POLDIFF_FORM_MODIFIED
) {

414 
	`»suÉ_™em_´št_¡ršg
(
tb
, 
™”
, 
¡ršg
->
¡r
, 1);

416 
	`»suÉ_™em_´št_¡ršg_šlše
(
tb
, 
™”
, 
¡ršg
->
¡r
, 1);

418 
	`ä“
(
s
);

420 
	`g_¡ršg_ä“
(
¡ršg
, 
TRUE
);

421 
	}
}

	@sediff/result_item_render.h

24 #iâdeà
RESULT_ITEM_RENDER_H


25 
	#RESULT_ITEM_RENDER_H


	)

27 
	~"»suÉ_™em.h
"

33 
»suÉ_™em_´št_¡ršg
(
GtkTextBufãr
 * 
tb
, 
GtkTextI‹r
 * 
™”
, cÚ¡ *
s
, 
šd’t_Ëv–
);

40 
»suÉ_™em_´št_¡ršg_šlše
(
GtkTextBufãr
 * 
tb
, 
GtkTextI‹r
 * 
™”
, cÚ¡ *
s
, 
šd’t_Ëv–
);

45 
»suÉ_™em_´št_¡ršg_avruË
(
GtkTextBufãr
 * 
tb
, 
GtkTextI‹r
 * 
™”
, cÚ¡ *
s
, 
šd’t_Ëv–
);

50 
»suÉ_™em_´št_diff
(
»suÉ_™em_t
 * 
™em
, 
GtkTextBufãr
 * 
tb
, 
pŞdiff_fÜm_e
 
fÜm
);

55 
»suÉ_™em_´št_ruË_diff
(
»suÉ_™em_t
 * 
™em
, 
GtkTextBufãr
 * 
tb
, 
pŞdiff_fÜm_e
 
fÜm
);

60 
»suÉ_™em_´št_summ¬y
(
»suÉ_™em_t
 * 
™em
, 
GtkTextBufãr
 * 
tb
);

65 
»suÉ_™em_´št_h—d”
(
»suÉ_™em_t
 * 
™em
, 
GtkTextBufãr
 * 
tb
, 
pŞdiff_fÜm_e
 
fÜm
);

71 
»suÉ_™em_´št_lš’os
(
GtkTextBufãr
 * 
tb
, 
GtkTextI‹r
 * 
™”
,

72 cÚ¡ 
gch¬
 * 
´efix
, cÚ¡ 
­Ş_veùÜ_t
 * 
lš’os
, cÚ¡ gch¬ * 
g
, 
GSŒšg
 * 
¡ršg
);

77 
»suÉ_™em_´št_modif›d_¿nge
(
»suÉ_™em_t
 * 
™em
, cÚ¡ 
pŞdiff_¿nge_t
 * 
¿nge
, 
GtkTextBufãr
 * 
tb
, 
GtkTextI‹r
 * 
™”
);

	@sediff/results.c

27 
	~<cÚfig.h
>

29 
	~"»suÉ_™em.h
"

30 
	~"»suÉs.h
"

31 
	~"utgui.h
"

33 
	~<as£¹.h
>

34 
	~<”ºo.h
>

35 
	~<¡ršg.h
>

36 
	~<gÏde/gÏde.h
>

37 
	~<qpŞ/cÚd_qu”y.h
>

41 
	mRESULTS_SUMMARY_COLUMN_LABEL
 = 0,

42 
	mRESULTS_SUMMARY_COLUMN_FORM
,

43 
	mRESULTS_SUMMARY_COLUMN_ITEM
,

44 
	mRESULTS_SUMMARY_COLUMN_STYLE
,

45 
	mRESULTS_SUMMARY_COLUMN_NUM


48 
	#NUM_RESULT_ITEMS
 19

	)

50 
	s»suÉs


52 
tİËv–_t
 *
	mtİ
;

53 
GÏdeXML
 *
	mxml
;

54 
GtkT»eStÜe
 *
	msumm¬y_Œ“
;

55 
GtkT»eV›w
 *
	msumm¬y_v›w
;

56 
GtkTextBufãr
 *
	mmaš_bufãr
, *
	mkey_bufãr
;

57 
GtkTextV›w
 *
	mv›w
;

58 
GtkTextTag
 *
	mpŞicy_Üig_g
, *
	mpŞicy_mod_g
;

59 
GtkLab–
 *
	m¡©s
;

62 
»suÉ_™em_t
 *
	mcu¼’t_™em
;

65 
pŞdiff_fÜm_e
 
	mcu¼’t_fÜm
;

67 
gšt
 
	msumm¬y_off£t
;

68 
»suÉ_™em_t
 *
	m™ems
[
NUM_RESULT_ITEMS
];

71 cÚ¡ 
pŞdiff_fÜm_e
 
	gfÜm_m­
[] = {

72 
POLDIFF_FORM_ADDED
, 
POLDIFF_FORM_ADD_TYPE
,

73 
POLDIFF_FORM_REMOVED
, 
POLDIFF_FORM_REMOVE_TYPE
,

74 
POLDIFF_FORM_MODIFIED


82 
	g»suÉ_™em_t
 *(*
	g»suÉ_™em_cÚ¡ruùÜs
[
NUM_RESULT_ITEMS
]è(
	gGtkTextTagTabË
 *) = {

83 
»suÉ_™em_ü—‹_commÚs
, 
»suÉ_™em_ü—‹_şas£s
,

84 
»suÉ_™em_ü—‹_Ëv–s
, 
»suÉ_™em_ü—‹_ÿ‹gÜ›s
,

85 
»suÉ_™em_ü—‹_ty³s
, 
»suÉ_™em_ü—‹_©Œibu‹s
,

86 
»suÉ_™em_ü—‹_rŞes
, 
»suÉ_™em_ü—‹_u£rs
,

87 
»suÉ_™em_ü—‹_boŞ—ns
,

88 
»suÉ_™em_ü—‹_avruËs_®low
,

89 
»suÉ_™em_ü—‹_avruËs_aud™®low
,

90 
»suÉ_™em_ü—‹_avruËs_dÚud™
,

91 
»suÉ_™em_ü—‹_avruËs_Ãv”®low
,

92 
»suÉ_™em_ü—‹_‹ruËs_chªge
,

93 
»suÉ_™em_ü—‹_‹ruËs_memb”
,

94 
»suÉ_™em_ü—‹_‹ruËs_Œªs
,

95 
»suÉ_™em_ü—‹_rŞe_®lows
, 
»suÉ_™em_ü—‹_rŞe_Œªs
, 
»suÉ_™em_ü—‹_¿nge_Œªs
};

97 
»suÉs_summ¬y_Ú_chªge
(
GtkT»eS–eùiÚ
 * 
£ËùiÚ
, 
gpoš‹r
 
u£r_d©a
);

99 
gboŞ—n
 
»suÉs_Ú_šlše_lšk_ev’t
(
GtkTextTag
 * 
g
, 
GObjeù
 * 
ev’t_objeù
,

100 
GdkEv’t
 * 
ev’t
, cÚ¡ 
GtkTextI‹r
 * 
™”
, 
gpoš‹r
 
u£r_d©a
);

101 
gboŞ—n
 
»suÉs_Ú_lše_ev’t
(
GtkTextTag
 * 
g
, 
GObjeù
 * 
ev’t_objeù
,

102 
GdkEv’t
 * 
ev’t
, cÚ¡ 
GtkTextI‹r
 * 
™”
, 
gpoš‹r
 
u£r_d©a
);

103 
gboŞ—n
 
»suÉs_Ú_pİup_m’u
(
GtkWidg‘
 * 
widg‘
, 
gpoš‹r
 
u£r_d©a
);

104 
gboŞ—n
 
»suÉs_Ú_‹xt_v›w_mÙiÚ
(
GtkWidg‘
 * 
widg‘
, 
GdkEv’tMÙiÚ
 * 
ev’t
, 
gpoš‹r
 
u£r_d©a
);

108 
»suÉs_summ¬y_Ú_row_aùiv©e
(
GtkT»eV›w
 * 
Œ“_v›w
, 
GtkT»eP©h
 * 
·th
, 
GtkT»eV›wCŞumn
 * 
cŞumn
,

109 
gpoš‹r
 
u£r_d©a
);

115 
	$»suÉs_ü—‹_summ¬y
(
»suÉs_t
 * 
r
)

117 
GtkT»eV›wCŞumn
 *
cŞ
;

118 
GtkC–lR’d””
 *
»nd””
;

119 
GtkT»eS–eùiÚ
 *
£ËùiÚ
;

121 
r
->
summ¬y_Œ“
 = 
	`gtk_Œ“_¡Üe_Ãw
(
RESULTS_SUMMARY_COLUMN_NUM
, 
G_TYPE_STRING
, 
G_TYPE_INT
, 
G_TYPE_POINTER
, 
G_TYPE_BOOLEAN
);

122 
r
->
summ¬y_v›w
 = 
	`GTK_TREE_VIEW
(
	`gÏde_xml_g‘_widg‘
Ô->
xml
, "toplevel summary view"));

123 
	`as£¹
(
r
->
summ¬y_v›w
 !ğ
NULL
);

124 
cŞ
 = 
	`gtk_Œ“_v›w_cŞumn_Ãw
();

125 
	`gtk_Œ“_v›w_cŞumn_£t_sizšg
(
cŞ
, 
GTK_TREE_VIEW_COLUMN_GROW_ONLY
);

126 
	`gtk_Œ“_v›w_cŞumn_£t_t™Ë
(
cŞ
, "Differences");

127 
	`gtk_Œ“_v›w_­³nd_cŞumn
(
r
->
summ¬y_v›w
, 
cŞ
);

128 
»nd””
 = 
	`gtk_ûÎ_»nd””_‹xt_Ãw
();

129 
	`gtk_Œ“_v›w_cŞumn_·ck_¡¬t
(
cŞ
, 
»nd””
, 
TRUE
);

130 
	`gtk_Œ“_v›w_cŞumn_£t_©Œibu‹s
(
cŞ
, 
»nd””
,

131 "‹xt", 
RESULTS_SUMMARY_COLUMN_LABEL
,

132 "¡rik‘hrough", 
RESULTS_SUMMARY_COLUMN_STYLE
, 
NULL
);;

133 
	`gtk_Œ“_v›w_£t_mod–
(
r
->
summ¬y_v›w
, 
	`GTK_TREE_MODEL
Ô->
summ¬y_Œ“
));

135 
£ËùiÚ
 = 
	`gtk_Œ“_v›w_g‘_£ËùiÚ
(
r
->
summ¬y_v›w
);

136 
	`gtk_Œ“_£ËùiÚ_£t_mode
(
£ËùiÚ
, 
GTK_SELECTION_BROWSE
);

137 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
(
£ËùiÚ
), "chªged", 
	`G_CALLBACK
(
»suÉs_summ¬y_Ú_chªge
), 
r
);

138 
	`g_sigÇl_cÚÃù
(
r
->
summ¬y_v›w
, "row-aùiv©ed", 
	`G_CALLBACK
(
»suÉs_summ¬y_Ú_row_aùiv©e
),„);

139 
	}
}

141 
»suÉs_t
 *
	$»suÉs_ü—‹
(
tİËv–_t
 * 
tİ
)

143 
»suÉs_t
 *
r
;

144 
i
;

145 
GtkTextTagTabË
 *
g_bË
;

146 
GtkTextA‰ribu‹s
 *
©Œ
;

147 
GtkTextV›w
 *
‹xt_v›w
;

148 
gšt
 
size
;

149 
PªgoTabA¼ay
 *
bs
;

151 ià((
r
 = 
	`ÿÎoc
(1, (*r))è=ğ
NULL
) {

152  
NULL
;

154 
r
->
tİ
 =op;

155 
r
->
xml
 = 
	`gÏde_g‘_widg‘_Œ“
(
	`GTK_WIDGET
(
	`tİËv–_g‘_wšdow
Ô->
tİ
)));

156 
	`»suÉs_ü—‹_summ¬y
(
r
);

158 
g_bË
 = 
	`gtk_‹xt_g_bË_Ãw
();

159 
r
->
maš_bufãr
 = 
	`gtk_‹xt_bufãr_Ãw
(
g_bË
);

160 
	`gtk_‹xt_bufãr_ü—‹_g
(
r
->
maš_bufãr
, "h—d”", "¡yË", 
PANGO_STYLE_ITALIC
, "weight", 
PANGO_WEIGHT_BOLD
, "family",

161 
NULL
, NULL);

162 
	`gtk_‹xt_bufãr_ü—‹_g
(
r
->
maš_bufãr
, "subh—d”", "weight", 
PANGO_WEIGHT_BOLD
, "und”lše", 
PANGO_UNDERLINE_SINGLE
,

163 "çmy", 
NULL
, NULL);

164 
	`gtk_‹xt_bufãr_ü—‹_g
(
r
->
maš_bufãr
, "»moved-h—d”", "fÜeground", "»d", "weight", 
PANGO_WEIGHT_BOLD
, 
NULL
);

165 
	`gtk_‹xt_bufãr_ü—‹_g
(
r
->
maš_bufãr
, "added-h—d”", "fÜeground", "d¬k g»’", "weight", 
PANGO_WEIGHT_BOLD
, 
NULL
);

166 
	`gtk_‹xt_bufãr_ü—‹_g
(
r
->
maš_bufãr
, "modif›d-h—d”", "fÜeground", "d¬k blue", "weight", 
PANGO_WEIGHT_BOLD
, 
NULL
);

167 
	`gtk_‹xt_bufãr_ü—‹_g
(
r
->
maš_bufãr
, "»moved", "fÜeground", "»d", 
NULL
);

168 
	`gtk_‹xt_bufãr_ü—‹_g
(
r
->
maš_bufãr
, "added", "fÜeground", "d¬k g»’", 
NULL
);

169 
	`gtk_‹xt_bufãr_ü—‹_g
(
r
->
maš_bufãr
, "modif›d", "fÜeground", "d¬k blue", 
NULL
);

170 
GtkTextTag
 *
šlše_g
 = 
	`gtk_‹xt_bufãr_ü—‹_g
(
r
->
maš_bufãr
, "šlše-lšk", 
NULL
);

171 
	`g_sigÇl_cÚÃù_aá”
(
	`G_OBJECT
(
šlše_g
), "ev’t", 
	`G_CALLBACK
(
»suÉs_Ú_šlše_lšk_ev’t
), 
r
);

172 
r
->
pŞicy_Üig_g
 = 
	`gtk_‹xt_bufãr_ü—‹_g
Ô->
maš_bufãr
, "line-pol_orig",

173 "fÜeground", "blue", "und”lše", 
PANGO_UNDERLINE_SINGLE
, 
NULL
);

174 
	`g_sigÇl_cÚÃù_aá”
(
	`G_OBJECT
(
r
->
pŞicy_Üig_g
), "ev’t", 
	`G_CALLBACK
(
»suÉs_Ú_lše_ev’t
),„);

175 
r
->
pŞicy_mod_g
 = 
	`gtk_‹xt_bufãr_ü—‹_g
Ô->
maš_bufãr
, "line-pol_mod",

176 "fÜeground", "blue", "und”lše", 
PANGO_UNDERLINE_SINGLE
, 
NULL
);

177 
	`g_sigÇl_cÚÃù_aá”
(
	`G_OBJECT
(
r
->
pŞicy_mod_g
), "ev’t", 
	`G_CALLBACK
(
»suÉs_Ú_lše_ev’t
),„);

179 
r
->
v›w
 = 
	`GTK_TEXT_VIEW
(
	`gÏde_xml_g‘_widg‘
Ô->
xml
, "toplevel„esults view"));

180 
	`as£¹
(
r
->
v›w
 !ğ
NULL
);

181 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
(
r
->
v›w
), "pİup-m’u", 
	`G_CALLBACK
(
»suÉs_Ú_pİup_m’u
),„);

182 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
(
r
->
v›w
), "mÙiÚ-nÙify-ev’t", 
	`G_CALLBACK
(
»suÉs_Ú_‹xt_v›w_mÙiÚ
),„);

183 
©Œ
 = 
	`gtk_‹xt_v›w_g‘_deçuÉ_©Œibu‹s
(
r
->
v›w
);

184 
size
 = 
	`·ngo_fÚt_desütiÚ_g‘_size
(
©Œ
->
fÚt
);

185 
bs
 = 
	`·ngo_b_¬¿y_Ãw_w™h_pos™iÚs
(4,

186 
FALSE
,

187 
PANGO_TAB_LEFT
, 3 * 
size
,

188 
PANGO_TAB_LEFT
, 6 * 
size
, PANGO_TAB_LEFT, 9 * size, PANGO_TAB_LEFT, 12 * size);

189 
	`gtk_‹xt_v›w_£t_bs
(
r
->
v›w
, 
bs
);

190 
	`gtk_‹xt_v›w_£t_bufãr
(
r
->
v›w
,„->
maš_bufãr
);

192 
r
->
key_bufãr
 = 
	`gtk_‹xt_bufãr_Ãw
(
g_bË
);

193 
‹xt_v›w
 = 
	`GTK_TEXT_VIEW
(
	`gÏde_xml_g‘_widg‘
(
r
->
xml
, "toplevel key view"));

194 
	`as£¹
(
‹xt_v›w
 !ğ
NULL
);

195 
	`gtk_‹xt_v›w_£t_bufãr
(
‹xt_v›w
, 
r
->
key_bufãr
);

197 
PªgoFÚtDesütiÚ
 *
fÚt_desc
 = 
	`·ngo_fÚt_desütiÚ_Ãw
();

198 
	`·ngo_fÚt_desütiÚ_£t_çmy_¡©ic
(
fÚt_desc
, "monospace");

199 
	`gtk_widg‘_modify_fÚt
(
	`GTK_WIDGET
(
r
->
v›w
), 
fÚt_desc
);

200 
	`gtk_widg‘_modify_fÚt
(
	`GTK_WIDGET
(
‹xt_v›w
), 
fÚt_desc
);

201 
	`·ngo_fÚt_desütiÚ_ä“
(
fÚt_desc
);

203 
r
->
¡©s
 = 
	`GTK_LABEL
((
	`gÏde_xml_g‘_widg‘
Ô->
xml
, "toplevel stats†abel")));

204 
	`as£¹
(
r
->
¡©s
 !ğ
NULL
);

205 
	`gtk_Ïb–_£t_‹xt
(
r
->
¡©s
, "");

207 
i
 = 0; i < 
NUM_RESULT_ITEMS
; i++) {

208 ià((
r
->
™ems
[
i
] = 
»suÉ_™em_cÚ¡ruùÜs
[i] (
g_bË
)è=ğ
NULL
) {

209 
	`»suÉs_de¡roy
(&
r
);

210  
NULL
;

213  
r
;

214 
	}
}

216 
	$»suÉs_de¡roy
(
»suÉs_t
 ** 
r
)

218 ià(
r
 !ğ
NULL
 && *r != NULL) {

219 
i
;

220 
i
 = 0; i < 
NUM_RESULT_ITEMS
; i++) {

221 
	`»suÉ_™em_de¡roy
(&((*
r
)->
™ems
[
i
]));

223 
	`ä“
(*
r
);

224 *
r
 = 
NULL
;

226 
	}
}

228 
	$»suÉs_İ’_pŞic›s
(
»suÉs_t
 * 
r
, 
­Ş_pŞicy_t
 * 
Üig
,‡pŞ_pŞicy_ˆ* 
mod
)

230 
i
;

231 
i
 = 0; i < 
NUM_RESULT_ITEMS
; i++) {

232 
	`»suÉ_™em_pŞicy_chªged
(
r
->
™ems
[
i
], 
Üig
, 
mod
);

234 
	}
}

236 
	$»suÉs_ş—r
(
»suÉs_t
 * 
r
)

238 
	`gtk_Œ“_¡Üe_ş—r
(
r
->
summ¬y_Œ“
);

239 
	`gtk_‹xt_v›w_£t_bufãr
(
r
->
v›w
,„->
maš_bufãr
);

240 
	`ut_‹xt_bufãr_ş—r
(
r
->
maš_bufãr
);

241 
	`ut_‹xt_bufãr_ş—r
(
r
->
key_bufãr
);

242 
	`gtk_Ïb–_£t_‹xt
(
r
->
¡©s
, "");

243 
r
->
cu¼’t_™em
 = 
NULL
;

244 
r
->
cu¼’t_fÜm
 = 
POLDIFF_FORM_NONE
;

245 
r
->
summ¬y_off£t
 = 0;

246 
	}
}

252 
	$»suÉs_upd©e_summ¬y
(
»suÉs_t
 * 
r
)

254 
GtkT»eI‹r
 
tİ™”
, 
chd™”
;

255 
GtkTextI‹r
 
™”
;

256 
size_t
 
sum_diffs
;

257 
i
, 
j
, 
fÜms
[5];

258 
GSŒšg
 *
s
 = 
	`g_¡ršg_Ãw
("");

260 
	`gtk_Œ“_¡Üe_­³nd
(
r
->
summ¬y_Œ“
, &
tİ™”
, 
NULL
);

261 
	`gtk_Œ“_¡Üe_£t
(
r
->
summ¬y_Œ“
, &
tİ™”
,

262 
RESULTS_SUMMARY_COLUMN_LABEL
, "Summary",

263 
RESULTS_SUMMARY_COLUMN_FORM
, 
POLDIFF_FORM_NONE
, 
RESULTS_SUMMARY_COLUMN_ITEM
, 
NULL
, -1);

264 
	`gtk_‹xt_bufãr_g‘_¡¬t_™”
(
r
->
maš_bufãr
, &
™”
);

265 
	`gtk_‹xt_bufãr_š£¹_w™h_gs_by_Çme
(
r
->
maš_bufãr
, &
™”
, "PŞicy Difã»nû Sti¡ics\n", -1, "h—d”", 
NULL
);

266 cÚ¡ *
fÜm_Çme_shÜt_m­
[] = {

269 cÚ¡ *
fÜm_Çme_lÚg_m­
[] = {

272 cÚ¡ *
g_m­
[] = {

275 
i
 = 0; i < 
NUM_RESULT_ITEMS
; i++) {

276 cÚ¡ *
Ïb–
 = 
	`»suÉ_™em_g‘_Ïb–
(
r
->
™ems
[
i
]);

277 
	`gtk_Œ“_¡Üe_­³nd
(
r
->
summ¬y_Œ“
, &
tİ™”
, 
NULL
);

278 
	`gtk_Œ“_¡Üe_£t
(
r
->
summ¬y_Œ“
, &
tİ™”
,

279 
RESULTS_SUMMARY_COLUMN_FORM
, 
POLDIFF_FORM_NONE
, 
RESULTS_SUMMARY_COLUMN_ITEM
, 
r
->
™ems
[
i
], -1);

280 ià(
	`»suÉ_™em_is_suµÜ‹d
(
r
->
™ems
[
i
])) {

281 
	`»suÉ_™em_g‘_fÜms
(
r
->
™ems
[
i
], 
fÜms
);

282 
sum_diffs
 = 0;

283 
	`g_¡ršg_´štf
(
s
, "\n%s:\n", 
Ïb–
);

284 
	`gtk_‹xt_bufãr_š£¹_w™h_gs_by_Çme
(
r
->
maš_bufãr
, &
™”
, 
s
->
¡r
, -1, "subh—d”", 
NULL
);

285 
was_run
 = 0;

286 
j
 = 0; j < 5; j++) {

287 ià(
fÜms
[
j
] > 0) {

288 
size_t
 
num_diffs
;

289 
num_diffs
 = 
	`»suÉ_™em_g‘_num_difã»nûs
(
r
->
™ems
[
i
], 
fÜm_m­
[
j
]);

290 
	`g_¡ršg_´štf
(
s
, "\t%s: %zd\n", 
fÜm_Çme_lÚg_m­
[
j
], 
num_diffs
);

291 
	`gtk_‹xt_bufãr_š£¹_w™h_gs_by_Çme
(
r
->
maš_bufãr
, &
™”
, 
s
->
¡r
, -1, 
g_m­
[
j
],

292 
NULL
);

293 
sum_diffs
 +ğ
num_diffs
;

294 
	`gtk_Œ“_¡Üe_­³nd
(
r
->
summ¬y_Œ“
, &
chd™”
, &
tİ™”
);

295 
	`g_¡ršg_´štf
(
s
, "% (%zd)", 
fÜm_Çme_shÜt_m­
[
j
], 
num_diffs
);

296 
	`gtk_Œ“_¡Üe_£t
(
r
->
summ¬y_Œ“
, &
chd™”
,

297 
RESULTS_SUMMARY_COLUMN_LABEL
, 
s
->
¡r
,

298 
RESULTS_SUMMARY_COLUMN_FORM
, 
fÜm_m­
[
j
],

299 
RESULTS_SUMMARY_COLUMN_ITEM
, 
r
->
™ems
[
i
], -1);

300 
was_run
 = 1;

303 ià(!
was_run
) {

304 
	`g_¡ršg_´štf
(
s
, "% (\?\?\?)", 
Ïb–
);

306 
	`g_¡ršg_´štf
(
s
, "% (%zd)", 
Ïb–
, 
sum_diffs
);

308 
	`gtk_Œ“_¡Üe_£t
(
r
->
summ¬y_Œ“
, &
tİ™”
,

309 
RESULTS_SUMMARY_COLUMN_LABEL
, 
s
->
¡r
, 
RESULTS_SUMMARY_COLUMN_STYLE
, 
FALSE
, -1);

312 
	`g_¡ršg_´štf
(
s
, "% (N/A)", 
Ïb–
);

313 
	`gtk_Œ“_¡Üe_£t
(
r
->
summ¬y_Œ“
, &
tİ™”
,

314 
RESULTS_SUMMARY_COLUMN_LABEL
, 
s
->
¡r
, 
RESULTS_SUMMARY_COLUMN_STYLE
, 
FALSE
, -1);

318 
	`g_¡ršg_ä“
(
s
, 
TRUE
);

319 
	}
}

324 
	$»suÉs_pİuÏ‹_key_bufãr
(
»suÉs_t
 * 
r
)

326 
GSŒšg
 *
¡ršg
 = 
	`g_¡ršg_Ãw
("");

327 
GtkTextI‹r
 
™”
;

329 
	`gtk_‹xt_bufãr_g‘_’d_™”
(
r
->
key_bufãr
, &
™”
);

331 
	`g_¡ršg_´štf
(
¡ršg
, " Added(+):\n Items‡dded in\n modified…olicy.\n\n");

332 
	`gtk_‹xt_bufãr_š£¹_w™h_gs_by_Çme
(
r
->
key_bufãr
, &
™”
, 
¡ršg
->
¡r
, -1, "added", 
NULL
);

333 
	`g_¡ršg_´štf
(
¡ršg
, " Removed(-):\n Items„emoved\n from original\n…olicy.\n\n");

334 
	`gtk_‹xt_bufãr_š£¹_w™h_gs_by_Çme
(
r
->
key_bufãr
, &
™”
, 
¡ršg
->
¡r
, -1, "»moved", 
NULL
);

335 
	`g_¡ršg_´štf
(
¡ršg
, " Modified(*):\n Items modified\n from original\n…olicyo\n modified…olicy.");

336 
	`gtk_‹xt_bufãr_š£¹_w™h_gs_by_Çme
(
r
->
key_bufãr
, &
™”
, 
¡ršg
->
¡r
, -1, "modif›d", 
NULL
);

337 
	`g_¡ršg_ä“
(
¡ršg
, 
TRUE
);

338 
	}
}

343 
	$»suÉs_upd©e_¡©s
(
»suÉs_t
 * 
r
)

345 
GSŒšg
 *
¡ršg
 = 
	`g_¡ršg_Ãw
("");

346 
i
, 
j
, 
fÜms
[5];

347 
size_t
 
diffs
[5] = { 0, 0, 0, 0, 0 };

348 
i
 = 0; i < 
NUM_RESULT_ITEMS
; i++) {

349 ià(
	`»suÉ_™em_is_suµÜ‹d
(
r
->
™ems
[
i
])) {

350 cÚ¡ *
Ïb–
;

351 
	`»suÉ_™em_g‘_fÜms
(
r
->
™ems
[
i
], 
fÜms
);

352 
Ïb–
 = 
	`»suÉ_™em_g‘_Ïb–
(
r
->
™ems
[
i
]);

353 
j
 = 0; j < 5; j++) {

354 ià(
fÜms
[
j
] > 0) {

355 
diffs
[
j
] +ğ
	`»suÉ_™em_g‘_num_difã»nûs
(
r
->
™ems
[
i
], 
fÜm_m­
[j]);

360 
	`g_¡ršg_´štf
(
¡ršg
, "TÙ® Difã»nûs: %zd", 
diffs
[0] + diffs[1] + diffs[2] + diffs[3] + diffs[4]);

361 
	`gtk_Ïb–_£t_‹xt
(
r
->
¡©s
, 
¡ršg
->
¡r
);

362 
	`g_¡ršg_ä“
(
¡ršg
, 
TRUE
);

363 
	}
}

365 
	$»suÉs_upd©e
(
»suÉs_t
 * 
r
)

367 
i
, 
j
, 
fÜms
[5], 
was_diff_run
 = 0;

368 
pŞdiff_t
 *
diff
 = 
	`tİËv–_g‘_pŞdiff
(
r
->
tİ
);

370 
	`»suÉs_ş—r
(
r
);

372 
i
 = 0; i < 
NUM_RESULT_ITEMS
; i++) {

373 
	`»suÉ_™em_pŞdiff_run
(
r
->
™ems
[
i
], 
diff
, 0);

376 
i
 = 0; i < 
NUM_RESULT_ITEMS
; i++) {

377 ià(
	`»suÉ_™em_is_suµÜ‹d
(
r
->
™ems
[
i
])) {

378 
	`»suÉ_™em_g‘_fÜms
(
r
->
™ems
[
i
], 
fÜms
);

379 
j
 = 0; j < 5; j++) {

380 ià(
fÜms
[
j
] > 0) {

381 
was_diff_run
 = 1;

387 ià(
was_diff_run
) {

388 
	`»suÉs_upd©e_summ¬y
(
r
);

389 
	`»suÉs_pİuÏ‹_key_bufãr
(
r
);

390 
	`»suÉs_upd©e_¡©s
(
r
);

393 
GtkT»eS–eùiÚ
 *
£ËùiÚ
 = 
	`gtk_Œ“_v›w_g‘_£ËùiÚ
(
r
->
summ¬y_v›w
);

394 
GtkT»eI‹r
 
™”
;

395 
	`gtk_Œ“_mod–_g‘_™”_fœ¡
(
	`GTK_TREE_MODEL
(
r
->
summ¬y_Œ“
), &
™”
);

396 
	`gtk_Œ“_£ËùiÚ_£Ëù_™”
(
£ËùiÚ
, &
™”
);

398 
	}
}

400 
	$»suÉs_sw™ch_to_·ge
(
»suÉs_t
 * 
r
)

402 
GtkT»eS–eùiÚ
 *
£ËùiÚ
 = 
	`gtk_Œ“_v›w_g‘_£ËùiÚ
(
r
->
summ¬y_v›w
);

403 
GtkT»eI‹r
 
™”
;

404 
gboŞ—n
 
£ns
 = 
FALSE
;

405 ià(
	`gtk_Œ“_£ËùiÚ_g‘_£Ëùed
(
£ËùiÚ
, 
NULL
, &
™”
)) {

406 
f
;

407 
»suÉ_™em_t
 *
™em
;

408 
»suÉs_sÜt_e
 
sÜt
;

409 
»suÉs_sÜt_dœ_e
 
dœ
;

410 
	`gtk_Œ“_mod–_g‘
(
	`GTK_TREE_MODEL
(
r
->
summ¬y_Œ“
), &
™”
, 
RESULTS_SUMMARY_COLUMN_FORM
, &
f
,

411 
RESULTS_SUMMARY_COLUMN_ITEM
, &
™em
, -1);

412 
pŞdiff_fÜm_e
 
fÜm
 = (pŞdiff_fÜm_eè
f
;

413 ià(
™em
 !ğ
NULL
 && 
	`»suÉ_™em_g‘_cu¼’t_sÜt
(™em, 
fÜm
, &
sÜt
, &
dœ
)) {

414 
£ns
 = 
TRUE
;

417 
	`tİËv–_£t_sÜt_m’u_£ns™iv™y
(
r
->
tİ
, 
£ns
);

418 
	}
}

420 
	srun_d©um


422 
»suÉs_t
 *
	mr
;

423 
´og»ss_t
 *
	m´og»ss
;

424 
GtkTextBufãr
 *
	mtb
;

427 
gpoš‹r
 
	$»suÉs_g‘_¦ow_bufãr_ruÂ”
(
gpoš‹r
 
d©a
)

429 
run_d©um
 *
run
 = (run_d©um *)
d©a
;

430 
»suÉs_t
 *
r
 = 
run
->r;

431 
run
->
tb
 = 
	`»suÉ_™em_g‘_bufãr
(
r
->
cu¼’t_™em
,„->
cu¼’t_fÜm
);

432 
	`´og»ss_dÚe
(
run
->
´og»ss
);

433  
NULL
;

434 
	}
}

441 
GtkTextBufãr
 *
	$»suÉs_g‘_¦ow_bufãr
(
»suÉs_t
 * 
r
, cÚ¡ *
aùiÚ
)

443 
run_d©um
 
run
;

444 
run
.
r
 =„;

445 
run
.
´og»ss
 = 
	`tİËv–_g‘_´og»ss
(
r
->
tİ
);

446 
	`ut_cursÜ_wa™
(
	`GTK_WIDGET
(
	`tİËv–_g‘_wšdow
(
r
->
tİ
)));

447 
GSŒšg
 *
s
 = 
	`g_¡ršg_Ãw
("");

448 
	`g_¡ršg_´štf
(
s
, "R’d”šg %s", 
	`»suÉ_™em_g‘_Ïb–
(
r
->
cu¼’t_™em
));

449 
	`´og»ss_show
(
run
.
´og»ss
, 
s
->
¡r
);

450 
	`g_¡ršg_ä“
(
s
, 
TRUE
);

451 
	`´og»ss_upd©e
(
run
.
´og»ss
, "%s", 
aùiÚ
);

452 
	`g_th»ad_ü—‹
(
»suÉs_g‘_¦ow_bufãr_ruÂ”
, &
run
, 
FALSE
, 
NULL
);

453 
	`´og»ss_wa™
(
run
.
´og»ss
);

454 
	`ut_cursÜ_ş—r
(
	`GTK_WIDGET
(
	`tİËv–_g‘_wšdow
(
r
->
tİ
)));

455 
	`´og»ss_hide
(
run
.
´og»ss
);

456  
run
.
tb
;

457 
	}
}

463 
	$»suÉs_summ¬y_Ú_chªge
(
GtkT»eS–eùiÚ
 * 
£ËùiÚ
, 
gpoš‹r
 
u£r_d©a
)

465 
»suÉs_t
 *
r
 = (»suÉs_ˆ*è
u£r_d©a
;

466 
GtkT»eI‹r
 
™”
;

467 ià(
	`gtk_Œ“_£ËùiÚ_g‘_£Ëùed
(
£ËùiÚ
, 
NULL
, &
™”
)) {

468 
fÜm
;

469 
GdkReùªgË
 
»ù
;

470 
GtkTextI‹r
 
‹xt™”
;

471 
GtkTextM¬k
 *
m¬k
;

472 
gšt
 
off£t
;

473 
GtkTextBufãr
 *
tb
;

474 
»suÉs_sÜt_e
 
sÜt
;

475 
»suÉs_sÜt_dœ_e
 
dœ
;

476 
gboŞ—n
 
£ns
 = 
FALSE
;

478 
	`gtk_‹xt_v›w_g‘_visibË_»ù
(
r
->
v›w
, &
»ù
);

479 
	`gtk_‹xt_v›w_g‘_™”_©_loÿtiÚ
(
r
->
v›w
, &
‹xt™”
, 
»ù
.
x
,„eù.
y
);

480 
off£t
 = 
	`gtk_‹xt_™”_g‘_off£t
(&
‹xt™”
);

481 ià(
r
->
cu¼’t_™em
 =ğ
NULL
) {

482 
r
->
summ¬y_off£t
 = 
off£t
;

484 
	`»suÉ_™em_§ve_cu¼’t_lše
(
r
->
cu¼’t_™em
,„->
cu¼’t_fÜm
, 
off£t
);

486 
	`gtk_Œ“_mod–_g‘
(
	`GTK_TREE_MODEL
(
r
->
summ¬y_Œ“
), &
™”
, 
RESULTS_SUMMARY_COLUMN_FORM
, &
fÜm
,

487 
RESULTS_SUMMARY_COLUMN_ITEM
, &
r
->
cu¼’t_™em
, -1);

488 
r
->
cu¼’t_fÜm
 = (
pŞdiff_fÜm_e
è
fÜm
;

489 ià(
r
->
cu¼’t_™em
 =ğ
NULL
) {

490 
tb
 = 
r
->
maš_bufãr
;

491 
off£t
 = 
r
->
summ¬y_off£t
;

493 
»nd”_is_¦ow
 = 
	`»suÉ_™em_is_»nd”_¦ow
(
r
->
cu¼’t_™em
,„->
cu¼’t_fÜm
);

494 ià(
	`»suÉ_™em_g‘_cu¼’t_sÜt
(
r
->
cu¼’t_™em
,„->
cu¼’t_fÜm
, &
sÜt
, &
dœ
)) {

495 
£ns
 = 
TRUE
;

496 
	`tİËv–_£t_sÜt_m’u_£ËùiÚ
(
r
->
tİ
, 
sÜt
, 
dœ
);

498 ià(
»nd”_is_¦ow
) {

499 
tb
 = 
	`»suÉs_g‘_¦ow_bufãr
(
r
, "Displaying Items");

501 
tb
 = 
	`»suÉ_™em_g‘_bufãr
(
r
->
cu¼’t_™em
,„->
cu¼’t_fÜm
);

503 
off£t
 = 
	`»suÉ_™em_g‘_cu¼’t_lše
(
r
->
cu¼’t_™em
,„->
cu¼’t_fÜm
);

506 
	`gtk_‹xt_v›w_£t_bufãr
(
r
->
v›w
, 
tb
);

511 
	`gtk_‹xt_bufãr_g‘_¡¬t_™”
(
tb
, &
‹xt™”
);

512 
	`gtk_‹xt_™”_£t_off£t
(&
‹xt™”
, 
off£t
);

513 
m¬k
 = 
	`gtk_‹xt_bufãr_ü—‹_m¬k
(
tb
, "loÿtiÚ-m¬k", &
‹xt™”
, 
FALSE
);

514 
	`gtk_‹xt_v›w_süŞl_to_m¬k
(
r
->
v›w
, 
m¬k
, 0.0, 
TRUE
, 0.0, 0.0);

515 
	`gtk_‹xt_bufãr_d–‘e_m¬k
(
tb
, 
m¬k
);

517 
	`tİËv–_£t_sÜt_m’u_£ns™iv™y
(
r
->
tİ
, 
£ns
);

519 
	}
}

521 
»suÉs_summ¬y_Ú_row_aùiv©e
(
GtkT»eV›w
 * 
Œ“_v›w
, 
GtkT»eP©h
 * 
·th
, 
GtkT»eV›wCŞumn
 * 
cŞumn


522 
__©Œibu‹__
 ((
unu£d
)), 
gpoš‹r
 
u£r_d©a
 __attribute__ ((unused)))

524 
gboŞ—n
 
	gex·nded
 = 
gtk_Œ“_v›w_row_ex·nded
(
Œ“_v›w
, 
·th
);

525 ià(!
	gex·nded
) {

526 
gtk_Œ“_v›w_ex·nd_row
(
Œ“_v›w
, 
·th
, 1);

528 
gtk_Œ“_v›w_cŞÏp£_row
(
Œ“_v›w
, 
·th
);

537 
gboŞ—n
 
»suÉs_Ú_šlše_lšk_ev’t
(
GtkTextTag
 * 
g
, 
GObjeù
 * 
ev’t_objeù


538 
__©Œibu‹__
 ((
unu£d
)), 
GdkEv’t
 * 
ev’t
, cÚ¡ 
GtkTextI‹r
 * 
™”
,

539 
gpoš‹r
 
u£r_d©a
)

541 
»suÉs_t
 *
	gr
 = (»suÉs_ˆ*è
u£r_d©a
;

542 ià(
	gev’t
->
	gty³
 =ğ
GDK_BUTTON_PRESS
) {

543 
GtkTextI‹r
 *
¡¬t
 = 
gtk_‹xt_™”_cİy
(
™”
);

544 !
gtk_‹xt_™”_begšs_g
(
¡¬t
, 
g
))

545 
gtk_‹xt_™”_backw¬d_ch¬
(
¡¬t
);

546 
GtkTextI‹r
 *
	g’d
 = 
gtk_‹xt_™”_cİy
(
¡¬t
);

547 !
gtk_‹xt_™”_’ds_g
(
’d
, 
g
))

548 
gtk_‹xt_™”_fÜw¬d_ch¬
(
’d
);

549 
gšt
 
	glše
 = 
gtk_‹xt_™”_g‘_lše
(
¡¬t
);

550 *
	gs
 = 
gtk_‹xt_™”_g‘_¦iû
(
¡¬t
, 
’d
);

551 
»suÉ_™em_šlše_lšk_ev’t
(
r
->
cu¼’t_™em
,„->
tİ
, 
GTK_WIDGET
Ô->
v›w
), (
GdkEv’tBu‰Ú
 *è
ev’t
,

552 
r
->
cu¼’t_fÜm
, 
lše
, 
s
);

553  
	gTRUE
;

555  
	gFALSE
;

563 
gboŞ—n
 
»suÉs_Ú_lše_ev’t
(
GtkTextTag
 * 
g
, 
GObjeù
 * 
ev’t_objeù
 
__©Œibu‹__
 ((
unu£d
)),

564 
GdkEv’t
 * 
ev’t
, cÚ¡ 
GtkTextI‹r
 * 
™”
, 
gpoš‹r
 
u£r_d©a
)

566 
»suÉs_t
 *
	gr
 = (»suÉs_ˆ*è
u£r_d©a
;

567 
£diffx_pŞicy_e
 
	gwhich_pŞ
 = -1;

568 
	glše
;

569 
GtkTextI‹r
 *
	g¡¬t
, *
	g’d
;

570 ià(
	gev’t
->
	gty³
 =ğ
GDK_BUTTON_PRESS
) {

571 
¡¬t
 = 
gtk_‹xt_™”_cİy
(
™”
);

573 !
gtk_‹xt_™”_¡¬ts_wÜd
(
¡¬t
))

574 
gtk_‹xt_™”_backw¬d_ch¬
(
¡¬t
);

575 
	g’d
 = 
gtk_‹xt_™”_cİy
(
¡¬t
);

576 !
gtk_‹xt_™”_’ds_wÜd
(
’d
))

577 
gtk_‹xt_™”_fÜw¬d_ch¬
(
’d
);

581 
	glše
 = 
©oi
(
gtk_‹xt_™”_g‘_¦iû
(
¡¬t
, 
’d
)) - 1;

582 ià(
	gg
 =ğ
r
->
pŞicy_Üig_g
) {

583 
which_pŞ
 = 
SEDIFFX_POLICY_ORIG
;

584 } ià(
	gg
 =ğ
r
->
pŞicy_mod_g
) {

585 
which_pŞ
 = 
SEDIFFX_POLICY_MOD
;

588 
as£¹
(0);

590 
tİËv–_show_pŞicy_lše
(
r
->
tİ
, 
which_pŞ
, 
lše
);

591  
	gTRUE
;

593  
	gFALSE
;

596 
gboŞ—n
 
	$»suÉs_Ú_pİup_m’u
(
GtkWidg‘
 * 
widg‘
, 
gpoš‹r
 
u£r_d©a
)

598 
»suÉs_t
 *
r
 = (»suÉs_ˆ*è
u£r_d©a
;

599 
GtkTextV›w
 *
‹xtv›w
 = 
	`GTK_TEXT_VIEW
(
widg‘
);

600 
gšt
 
ex
, 
ey
, 
x
, 
y
;

601 
GtkTextBufãr
 *
bufãr
;

602 
GtkTextI‹r
 
™”
;

603 
GSLi¡
 *
gs
, *
gp
;

604 
gboŞ—n
 
hov”šg
 = 
FALSE
;

605 
	`gdk_wšdow_©_poš‹r
(&
ex
, &
ey
);

606 
	`gtk_‹xt_v›w_wšdow_to_bufãr_coÜds
(
‹xtv›w
, 
GTK_TEXT_WINDOW_WIDGET
, 
ex
, 
ey
, &
x
, &
y
);

607 
bufãr
 = 
	`gtk_‹xt_v›w_g‘_bufãr
(
‹xtv›w
);

608 
	`gtk_‹xt_v›w_g‘_™”_©_loÿtiÚ
(
‹xtv›w
, &
™”
, 
x
, 
y
);

609 
gs
 = 
	`gtk_‹xt_™”_g‘_gs
(&
™”
);

610 
gp
 = 
gs
;ag°!ğ
NULL
;ag°ğgp->
Ãxt
) {

611 ià(
	`¡rcmp
(
	`GTK_TEXT_TAG
(
gp
->
d©a
)->
Çme
, "inline-link") == 0) {

612 
hov”šg
 = 
TRUE
;

616 ià(
hov”šg
) {

617 
GtkTextI‹r
 *
¡¬t
 = 
	`gtk_‹xt_™”_cİy
(&
™”
);

618 !
	`gtk_‹xt_™”_begšs_g
(
¡¬t
, 
	`GTK_TEXT_TAG
(
gp
->
d©a
)))

619 
	`gtk_‹xt_™”_backw¬d_ch¬
(
¡¬t
);

620 
GtkTextI‹r
 *
’d
 = 
	`gtk_‹xt_™”_cİy
(
¡¬t
);

621 !
	`gtk_‹xt_™”_’ds_g
(
’d
, 
	`GTK_TEXT_TAG
(
gp
->
d©a
)))

622 
	`gtk_‹xt_™”_fÜw¬d_ch¬
(
’d
);

623 
gšt
 
lše
 = 
	`gtk_‹xt_™”_g‘_lše
(
¡¬t
);

624 *
s
 = 
	`gtk_‹xt_™”_g‘_¦iû
(
¡¬t
, 
’d
);

625 
	`g_¦i¡_ä“
(
gs
);

626 
	`»suÉ_™em_šlše_lšk_ev’t
(
r
->
cu¼’t_™em
,„->
tİ
, 
widg‘
, 
NULL
,„->
cu¼’t_fÜm
, 
lše
, 
s
);

627  
TRUE
;

629 
	`g_¦i¡_ä“
(
gs
);

630  
FALSE
;

631 
	}
}

637 
gboŞ—n
 
»suÉs_Ú_‹xt_v›w_mÙiÚ
(
GtkWidg‘
 * 
widg‘
, 
GdkEv’tMÙiÚ
 * 
ev’t
, 
gpoš‹r
 
u£r_d©a
 
__©Œibu‹__
 ((
unu£d
)))

639 
GtkTextBufãr
 *
	gbufãr
;

640 
GtkTextV›w
 *
	g‹xtv›w
;

641 
GdkCursÜ
 *
	gcursÜ
;

642 
GtkTextI‹r
 
	g™”
;

643 
GSLi¡
 *
	ggs
, *
	ggp
;

644 
gšt
 
	gx
, 
	gex
, 
	gey
, 
	gy
;

645 
	ghov”šg
 = 0;

647 
	g‹xtv›w
 = 
GTK_TEXT_VIEW
(
widg‘
);

649 ià(
	gev’t
->
	gis_hšt
) {

650 
gdk_wšdow_g‘_poš‹r
(
ev’t
->
wšdow
, &
ex
, &
ey
, 
NULL
);

652 
	gex
 = 
ev’t
->
x
;

653 
	gey
 = 
ev’t
->
y
;

656 
gtk_‹xt_v›w_wšdow_to_bufãr_coÜds
(
‹xtv›w
, 
GTK_TEXT_WINDOW_WIDGET
, 
ex
, 
ey
, &
x
, &
y
);

657 
	gbufãr
 = 
gtk_‹xt_v›w_g‘_bufãr
(
‹xtv›w
);

658 
gtk_‹xt_v›w_g‘_™”_©_loÿtiÚ
(
‹xtv›w
, &
™”
, 
x
, 
y
);

659 
	ggs
 = 
gtk_‹xt_™”_g‘_gs
(&
™”
);

660 
	ggp
 = 
gs
;ag°!ğ
NULL
;ag°ğ
gp
->
Ãxt
) {

661 ià(
¡ºcmp
(
GTK_TEXT_TAG
(
gp
->
d©a
)->
Çme
, "line", 4) == 0 ||

662 
¡rcmp
(
GTK_TEXT_TAG
(
gp
->
d©a
)->
Çme
, "inline-link") == 0) {

663 
hov”šg
 = 
TRUE
;

667 ià(
	ghov”šg
) {

668 
	gcursÜ
 = 
gdk_cursÜ_Ãw
(
GDK_HAND2
);

669 
gdk_wšdow_£t_cursÜ
(
ev’t
->
wšdow
, 
cursÜ
);

670 
gdk_cursÜ_uÄef
(
cursÜ
);

671 
gdk_æush
();

673 
gdk_wšdow_£t_cursÜ
(
ev’t
->
wšdow
, 
NULL
);

675 
g_¦i¡_ä“
(
gs
);

676  
	gFALSE
;

679 
	$»suÉs_sÜt
(
»suÉs_t
 * 
r
, 
»suÉs_sÜt_e
 
f›ld
, 
»suÉs_sÜt_dœ_e
 
dœeùiÚ
)

681 
GtkT»eS–eùiÚ
 *
£ËùiÚ
 = 
	`gtk_Œ“_v›w_g‘_£ËùiÚ
(
r
->
summ¬y_v›w
);

682 
GtkT»eI‹r
 
™”
;

683 
f
;

684 
»suÉ_™em_t
 *
™em
;

685 #iâdeà
NDEBUG


686 
»suÉs_sÜt_e
 
sÜt
;

687 
»suÉs_sÜt_dœ_e
 
dœ
;

689 ià(!
	`gtk_Œ“_£ËùiÚ_g‘_£Ëùed
(
£ËùiÚ
, 
NULL
, &
™”
)) {

692 
	`gtk_Œ“_mod–_g‘
(
	`GTK_TREE_MODEL
(
r
->
summ¬y_Œ“
), &
™”
, 
RESULTS_SUMMARY_COLUMN_FORM
, &
f
,

693 
RESULTS_SUMMARY_COLUMN_ITEM
, &
™em
, -1);

694 
pŞdiff_fÜm_e
 
fÜm
 = (pŞdiff_fÜm_eè
f
;

695 
	`as£¹
(
™em
 !ğ
NULL
 && i‹m =ğ
r
->
cu¼’t_™em
 && 
fÜm
 =ğr->
cu¼’t_fÜm


696 && 
	`»suÉ_™em_g‘_cu¼’t_sÜt
(
™em
, 
fÜm
, &
sÜt
, &
dœ
) != 0);

697 
	`»suÉ_™em_£t_cu¼’t_sÜt
(
™em
, 
fÜm
, 
f›ld
, 
dœeùiÚ
);

698 ià(
	`»suÉ_™em_is_»nd”_¦ow
(
r
->
cu¼’t_™em
, 
fÜm
)) {

699 
	`»suÉs_g‘_¦ow_bufãr
(
r
, "Sorting Items");

701 
	`»suÉ_™em_g‘_bufãr
(
™em
, 
fÜm
);

703 
	}
}

705 
GtkTextV›w
 *
	$»suÉs_g‘_‹xt_v›w
(
»suÉs_t
 * 
r
)

707  
r
->
v›w
;

708 
	}
}

	@sediff/results.h

26 #iâdeà
RESULTS_H


27 
	#RESULTS_H


	)

29 
	e»suÉs_sÜt


31 
	mRESULTS_SORT_DEFAULT
 = 0,

32 
	mRESULTS_SORT_SOURCE
, 
	mRESULTS_SORT_TARGET
,

33 
	mRESULTS_SORT_CLASS
, 
	mRESULTS_SORT_COND


34 } 
	t»suÉs_sÜt_e
;

36 
	e»suÉs_sÜt_dœ


38 
	mRESULTS_SORT_DESCEND
 = -1, 
	mRESULTS_SORT_ASCEND
 = 1

39 } 
	t»suÉs_sÜt_dœ_e
;

41 
	~"tİËv–.h
"

43 
	~<gtk/gtk.h
>

44 
	~<pŞdiff/pŞdiff.h
>

46 
»suÉs
 
	t»suÉs_t
;

58 
»suÉs_t
 *
»suÉs_ü—‹
(
tİËv–_t
 * 
tİ
);

67 
»suÉs_de¡roy
(
»suÉs_t
 ** 
r
);

76 
»suÉs_İ’_pŞic›s
(
»suÉs_t
 * 
r
, 
­Ş_pŞicy_t
 * 
Üig
,‡pŞ_pŞicy_ˆ* 
mod
);

84 
»suÉs_ş—r
(
»suÉs_t
 * 
r
);

91 
»suÉs_upd©e
(
»suÉs_t
 * 
r
);

99 
»suÉs_sw™ch_to_·ge
(
»suÉs_t
 * 
r
);

110 
»suÉs_sÜt
(
»suÉs_t
 * 
r
, 
»suÉs_sÜt_e
 
f›ld
, 
»suÉs_sÜt_dœ_e
 
dœeùiÚ
);

119 
GtkTextV›w
 *
»suÉs_g‘_‹xt_v›w
(
»suÉs_t
 * 
r
);

	@sediff/sediff.c

25 
	~<cÚfig.h
>

27 
	~<pŞdiff/pŞdiff.h
>

28 
	~<pŞdiff/compÚ’t_»cÜd.h
>

29 
	~<­Ş/pŞicy.h
>

30 
	~<­Ş/veùÜ.h
>

31 
	~<¡dio.h
>

32 
	~<”ºo.h
>

33 
	~<g‘İt.h
>

34 
	~<¡dšt.h
>

35 
	~<¡dlib.h
>

36 
	~<¡ršg.h
>

38 
	#COPYRIGHT_INFO
 "Cİyrighˆ(Cè2004-2007 T»sy TechnŞogy, LLC"

	)

40 
	eİt_v®ues


42 
	mDIFF_LEVEL
 = 256, 
	mDIFF_CATEGORY
,

43 
	mDIFF_AUDITALLOW
, 
	mDIFF_DONTAUDIT
, 
	mDIFF_NEVERALLOW
,

44 
	mDIFF_TYPE_CHANGE
, 
	mDIFF_TYPE_MEMBER
, 
	mDIFF_TYPE_TRANS
,

45 
	mDIFF_ROLE_TRANS
, 
	mDIFF_ROLE_ALLOW
, 
	mDIFF_RANGE_TRANS
,

46 
	mOPT_STATS


50 
İtiÚ
 cÚ¡ 
	glÚgİts
[] = {

51 {"şass", 
no_¬gum’t
, 
NULL
, 'c'},

52 {"Ëv–", 
no_¬gum’t
, 
NULL
, 
DIFF_LEVEL
},

53 {"ÿ‹gÜy", 
no_¬gum’t
, 
NULL
, 
DIFF_CATEGORY
},

54 {"ty³", 
no_¬gum’t
, 
NULL
, 't'},

55 {"©Œibu‹", 
no_¬gum’t
, 
NULL
, 'a'},

56 {"rŞe", 
no_¬gum’t
, 
NULL
, 'r'},

57 {"u£r", 
no_¬gum’t
, 
NULL
, 'u'},

58 {"boŞ", 
no_¬gum’t
, 
NULL
, 'b'},

59 {"®low", 
no_¬gum’t
, 
NULL
, 'A'},

60 {"aud™®low", 
no_¬gum’t
, 
NULL
, 
DIFF_AUDITALLOW
},

61 {"dÚud™", 
no_¬gum’t
, 
NULL
, 
DIFF_DONTAUDIT
},

62 {"Ãv”®low", 
no_¬gum’t
, 
NULL
, 
DIFF_NEVERALLOW
},

63 {"ty³_chªge", 
no_¬gum’t
, 
NULL
, 
DIFF_TYPE_CHANGE
},

64 {"ty³_Œªs", 
no_¬gum’t
, 
NULL
, 
DIFF_TYPE_TRANS
},

65 {"ty³_memb”", 
no_¬gum’t
, 
NULL
, 
DIFF_TYPE_MEMBER
},

66 {"rŞe_Œªs", 
no_¬gum’t
, 
NULL
, 
DIFF_ROLE_TRANS
},

67 {"rŞe_®low", 
no_¬gum’t
, 
NULL
, 
DIFF_ROLE_ALLOW
},

68 {"¿nge_Œªs", 
no_¬gum’t
, 
NULL
, 
DIFF_RANGE_TRANS
},

69 {"¡©s", 
no_¬gum’t
, 
NULL
, 
OPT_STATS
},

70 {"qu›t", 
no_¬gum’t
, 
NULL
, 'q'},

71 {"h–p", 
no_¬gum’t
, 
NULL
, 'h'},

72 {"v”siÚ", 
no_¬gum’t
, 
NULL
, 'V'},

73 {
NULL
, 0, NULL, 0}

76 
	$u§ge
(cÚ¡ *
´og_Çme
, 
br›f
)

78 
	`´štf
("U§ge: % [OPTIONS] ORIGINAL_POLICY ; MODIFIED_POLICY\n\n", 
´og_Çme
);

79 ià(
br›f
) {

80 
	`´štf
("\tTry % --h–°fÜ mÜh–p.\n\n", 
´og_Çme
);

83 
	`´štf
("Semantically differentiatewo…olicies. By default,‡ll supported\n");

84 
	`´štf
("policyƒlements sans‚everallows‡reƒxamined. The following options\n");

85 
	`´štf
("are‡vailable:\n\n");

86 
	`´štf
(" -c, --class object class‡nd common…ermission definitions\n");

87 
	`´štf
(" --level MLS†evel definitions\n");

88 
	`´štf
(" --category MLS category definitions\n");

89 
	`´štf
(" -t, --typeype definitions\n");

90 
	`´štf
(" -a, --attribute‡ttribute definitions\n");

91 
	`´štf
(" -r, --role„ole definitions\n");

92 
	`´štf
(" -u, --user user definitions\n");

93 
	`´štf
(" -b, --bool boolean definitions‡nd default values\n");

94 
	`´štf
(" -A, --allow‡llow„ules\n");

95 
	`´štf
(" --auditallow‡uditallow„ules\n");

96 
	`´štf
(" --dontaudit dontaudit„ules\n");

97 
	`´štf
(" --neverallow‚everallow„ules\n");

98 
	`´štf
(" --type_changeype_change„ules\n");

99 
	`´štf
(" --type_memberype_member„ules\n");

100 
	`´štf
(" --type_transype_transition„ules\n");

101 
	`´štf
(" --role_trans„ole_transition„ules\n");

102 
	`´štf
(" --role_allow„ole‡llow„ules\n");

103 
	`´štf
(" --range_trans„ange_transition„ules\n");

104 
	`´štf
("\n");

105 
	`´štf
(" -q, --quiet suppress status output forƒlements with‚o differences\n");

106 
	`´štf
(" --stats…rint only statistics\n");

107 
	`´štf
(" -h, --help…rinthis helpext‡ndƒxit\n");

108 
	`´štf
(" -V, --version…rint version information‡ndƒxit\n\n");

109 
	}
}

111 
	$´št_diff_¡ršg
(cÚ¡ *
¡r
, 
šd’t_Ëv–
)

113 cÚ¡ *
c
 = 
¡r
;

114 
i
;

115 cÚ¡ *
šd’t
 = " ";

117 
i
 = 0; i < 
šd’t_Ëv–
; i++)

118 
	`´štf
("%s", 
šd’t
);

119 ; *
c
; c++) {

120 ià(*
c
 == '\n') {

121 ià(*(
c
 + 1) == '\0')

123 
	`´štf
("%c", *
c
);

124 
i
 = 0; i < 
šd’t_Ëv–
; i++)

125 
	`´štf
("%s", 
šd’t
);

126 } ià(*
c
 == '\t') {

127 
	`´štf
("%s", 
šd’t
);

129 
	`´štf
("%c", *
c
);

132 
	}
}

134 
	$´št_ruË_£ùiÚ
(cÚ¡ 
pŞdiff_t
 * 
diff
, cÚ¡ 
pŞdiff_compÚ’t_»cÜd_t
 * 
»c
, cÚ¡ 
­Ş_veùÜ_t
 * 
v
,

135 
pŞdiff_fÜm_e
 
fÜm
)

137 
i
;

138 *
¡r
 = 
NULL
;

139 cÚ¡ *
™em1
;

141 
i
 = 0; i < 
	`­Ş_veùÜ_g‘_size
(
v
); i++) {

142 
™em1
 = 
	`­Ş_veùÜ_g‘_–em’t
(
v
, 
i
);

143 ià(
	`pŞdiff_compÚ’t_»cÜd_g‘_fÜm_â
(
»c
è(
™em1
è=ğ
fÜm
) {

144 ià((
¡r
 = 
	`pŞdiff_compÚ’t_»cÜd_g‘_to_¡ršg_â
(
»c
è(
diff
, 
™em1
)è=ğ
NULL
) {

147 
	`´št_diff_¡ršg
(
¡r
, 1);

148 
	`´štf
("\n");

149 
	`ä“
(
¡r
);

150 
¡r
 = 
NULL
;

153 
	}
}

155 
	#PRINT_ADDED_REMOVED
 1

	)

156 
	#PRINT_MODIFIED
 2

	)

157 
	#PRINT_ALL
 4

	)

159 
	$´št_ruË_diffs
(cÚ¡ 
pŞdiff_t
 * 
diff
, cÚ¡ 
pŞdiff_compÚ’t_»cÜd_t
 * 
»c
, 
¡©s_Úly
, cÚ¡ *
Çme
,

160 
ušt32_t
 
æags
, 
­Ş_veùÜ_comp_func
 
sÜt_by
)

162 cÚ¡ 
­Ş_veùÜ_t
 *
š‹º®_v
 = 
NULL
;

163 
­Ş_veùÜ_t
 *
v
 = 
NULL
;

164 
size_t
 
¡©s
[5] = { 0, 0, 0, 0, 0 };

166 ià(!
»c
 || !
diff
)

169 
	`pŞdiff_compÚ’t_»cÜd_g‘_¡©s_â
(
»c
è(
diff
, 
¡©s
);

170 ià(
æags
 =ğ
PRINT_ADDED_REMOVED
) {

171 
	`´štf
("% (Added %zd, Removed %zd)\n", 
Çme
, 
¡©s
[0], stats[1]);

172 } ià(
æags
 =ğ
PRINT_MODIFIED
) {

173 
	`´štf
("% (Added %zd, Removed %zd, Modif›d %zd)\n", 
Çme
, 
¡©s
[0], stats[1], stats[2]);

174 } ià(
æags
 =ğ
PRINT_ALL
) {

175 
	`´štf
("% (Added %zd, Added New Ty³ %zd, Removed %zd, Removed Missšg Ty³ %zd, Modif›d %zd)\n", 
Çme
, 
¡©s
[0],

176 
¡©s
[3], stats[1], stats[4], stats[2]);

178 
	`årštf
(
¡d”r
, "Error, unhandled flagype\n");

181 ià(
¡©s_Úly
)

183 ià((
š‹º®_v
 = 
	`pŞdiff_compÚ’t_»cÜd_g‘_»suÉs_â
(
»c
è(
diff
)è=ğ
NULL
) {

186 ià(!(
v
 = 
	`­Ş_veùÜ_ü—‹_äom_veùÜ
(
š‹º®_v
, 
NULL
, NULL, NULL))) {

187 
	`³¼Ü
("Error…rintig„esults");

191 ià(
sÜt_by
) {

192 
	`­Ş_veùÜ_sÜt
(
v
, 
sÜt_by
, 
NULL
);

195 
	`´štf
(" Added %s: %zd\n", 
Çme
, 
¡©s
[0]);

196 
	`´št_ruË_£ùiÚ
(
diff
, 
»c
, 
v
, 
POLDIFF_FORM_ADDED
);

198 ià(
æags
 =ğ
PRINT_ALL
) {

199 
	`´štf
(" Added % beÿu£ oàÃwy³: %zd\n", 
Çme
, 
¡©s
[3]);

200 
	`´št_ruË_£ùiÚ
(
diff
, 
»c
, 
v
, 
POLDIFF_FORM_ADD_TYPE
);

203 
	`´štf
(" Removed %s: %zd\n", 
Çme
, 
¡©s
[1]);

204 
	`´št_ruË_£ùiÚ
(
diff
, 
»c
, 
v
, 
POLDIFF_FORM_REMOVED
);

206 ià(
æags
 =ğ
PRINT_ALL
) {

207 
	`´štf
(" Removed % beÿu£ oàmissšgy³: %zd\n", 
Çme
, 
¡©s
[4]);

208 
	`´št_ruË_£ùiÚ
(
diff
, 
»c
, 
v
, 
POLDIFF_FORM_REMOVE_TYPE
);

210 ià(
æags
 =ğ
PRINT_MODIFIED
 || fÏg =ğ
PRINT_ALL
) {

211 
	`´štf
(" Modif›d %s: %zd\n", 
Çme
, 
¡©s
[2]);

212 
	`´št_ruË_£ùiÚ
(
diff
, 
»c
, 
v
, 
POLDIFF_FORM_MODIFIED
);

214 
	`´štf
("\n");

215 
	`­Ş_veùÜ_de¡roy
(&
v
);

217 
	}
}

219 
	$´št_şass_diffs
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
¡©s_Úly
)

221 
	`´št_ruË_diffs
(
diff
, 
	`pŞdiff_g‘_compÚ’t_»cÜd
(
POLDIFF_DIFF_CLASSES
), 
¡©s_Úly
, "CÏs£s", 
PRINT_MODIFIED
, 
NULL
);

223 
	}
}

225 
	$´št_boŞ_diffs
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
¡©s_Úly
)

227 
	`´št_ruË_diffs
(
diff
, 
	`pŞdiff_g‘_compÚ’t_»cÜd
(
POLDIFF_DIFF_BOOLS
), 
¡©s_Úly
, "BoŞ—ns", 
PRINT_MODIFIED
, 
NULL
);

229 
	}
}

231 
	$´št_commÚ_diffs
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
¡©s_Úly
)

233 
	`´št_ruË_diffs
(
diff
, 
	`pŞdiff_g‘_compÚ’t_»cÜd
(
POLDIFF_DIFF_COMMONS
), 
¡©s_Úly
, "CommÚs", 
PRINT_MODIFIED
, 
NULL
);

235 
	}
}

237 
	$´št_Ëv–_diffs
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
¡©s_Úly
)

239 
	`´št_ruË_diffs
(
diff
, 
	`pŞdiff_g‘_compÚ’t_»cÜd
(
POLDIFF_DIFF_LEVELS
), 
¡©s_Úly
, "Lev–s", 
PRINT_MODIFIED
, 
NULL
);

241 
	}
}

243 
	$´št_ÿt_diffs
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
¡©s_Úly
)

245 
	`´št_ruË_diffs
(
diff
, 
	`pŞdiff_g‘_compÚ’t_»cÜd
(
POLDIFF_DIFF_CATS
), 
¡©s_Úly
, "C©egÜ›s", 
PRINT_MODIFIED
, 
NULL
);

247 
	}
}

249 
	$´št_rŞe_diffs
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
¡©s_Úly
)

251 
	`´št_ruË_diffs
(
diff
, 
	`pŞdiff_g‘_compÚ’t_»cÜd
(
POLDIFF_DIFF_ROLES
), 
¡©s_Úly
, "RŞes", 
PRINT_MODIFIED
, 
NULL
);

253 
	}
}

255 
	$´št_u£r_diffs
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
¡©s_Úly
)

257 
	`´št_ruË_diffs
(
diff
, 
	`pŞdiff_g‘_compÚ’t_»cÜd
(
POLDIFF_DIFF_USERS
), 
¡©s_Úly
, "U£rs", 
PRINT_MODIFIED
, 
NULL
);

259 
	}
}

261 
	$´št_av®low_diffs
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
¡©s_Úly
)

263 
	`´št_ruË_diffs
(
diff
, 
	`pŞdiff_g‘_compÚ’t_»cÜd
(
POLDIFF_DIFF_AVALLOW
), 
¡©s_Úly
, "AV-AÎow RuËs", 
PRINT_ALL
, 
NULL
);

264 
	}
}

266 
	$´št_avaud™®low_diffs
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
¡©s_Úly
)

268 
	`´št_ruË_diffs
(
diff
, 
	`pŞdiff_g‘_compÚ’t_»cÜd
(
POLDIFF_DIFF_AVAUDITALLOW
), 
¡©s_Úly
, "AV-Audit Allow Rules",

269 
PRINT_ALL
, 
NULL
);

270 
	}
}

272 
	$´št_avdÚud™_diffs
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
¡©s_Úly
)

274 
	`´št_ruË_diffs
(
diff
, 
	`pŞdiff_g‘_compÚ’t_»cÜd
(
POLDIFF_DIFF_AVDONTAUDIT
), 
¡©s_Úly
, "AV-Don't Audit Rules",

275 
PRINT_ALL
, 
NULL
);

276 
	}
}

278 
	$´št_avÃv”®low_diffs
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
¡©s_Úly
)

280 
	`´št_ruË_diffs
(
diff
, 
	`pŞdiff_g‘_compÚ’t_»cÜd
(
POLDIFF_DIFF_AVNEVERALLOW
), 
¡©s_Úly
, "AV-Never Allow Rules",

281 
PRINT_ALL
, 
NULL
);

282 
	}
}

284 
	$´št_rŞe_®low_diffs
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
¡©s_Úly
)

286 
	`´št_ruË_diffs
(
diff
, 
	`pŞdiff_g‘_compÚ’t_»cÜd
(
POLDIFF_DIFF_ROLE_ALLOWS
), 
¡©s_Úly
, "Role Allow Rules",

287 
PRINT_MODIFIED
, 
NULL
);

288 
	}
}

290 
	$´št_rŞe_Œªs_diffs
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
¡©s_Úly
)

292 
	`´št_ruË_diffs
(
diff
, 
	`pŞdiff_g‘_compÚ’t_»cÜd
(
POLDIFF_DIFF_ROLE_TRANS
), 
¡©s_Úly
, "RŞT¿ns™iÚs", 
PRINT_ALL
,

293 
NULL
);

294 
	}
}

296 
	$´št_¿nge_Œªs_diffs
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
¡©s_Úly
)

298 
	`´št_ruË_diffs
(
diff
, 
	`pŞdiff_g‘_compÚ’t_»cÜd
(
POLDIFF_DIFF_RANGE_TRANS
), 
¡©s_Úly
, "Range Transitions",

299 
PRINT_MODIFIED
, 
NULL
);

300 
	}
}

304 
ty³_Çme_cmp
(cÚ¡ *
a
, cÚ¡ *
b
, *
u£r_d©a
 
__©Œibu‹__
 ((
unu£d
)))

306 
pŞdiff_ty³_t
 *
	g
 = (pŞdiff_ty³_ˆ*è
a
;

307 
pŞdiff_ty³_t
 *
	gtb
 = (pŞdiff_ty³_ˆ*è
b
;

308 ià(
	g
 =ğ
NULL
 || 
tb
 == NULL)

310  
¡rcmp
(
pŞdiff_ty³_g‘_Çme
(

),…Şdiff_ty³_g‘_Çme(
tb
));

313 
	$´št_ty³_diffs
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
¡©s_Úly
)

315 
	`´št_ruË_diffs
(
diff
, 
	`pŞdiff_g‘_compÚ’t_»cÜd
(
POLDIFF_DIFF_TYPES
), 
¡©s_Úly
, "Ty³s", 
PRINT_MODIFIED
,

316 
ty³_Çme_cmp
);

317 
	}
}

319 
	$´št_©Œib_diffs
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
¡©s_Úly
)

321 
	`´št_ruË_diffs
(
diff
, 
	`pŞdiff_g‘_compÚ’t_»cÜd
(
POLDIFF_DIFF_ATTRIBS
), 
¡©s_Úly
, "A‰ribu‹s", 
PRINT_MODIFIED
, 
NULL
);

322 
	}
}

324 
size_t
 
	$g‘_diff_tÙ®
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
ušt32_t
 
æags
)

326 
size_t
 
tÙ®
 = 0;

327 
ušt32_t
 
i
;

328 
size_t
 
¡©s
[5] = { 0, 0, 0, 0, 0 };

330 ià(!
diff
 || !
æags
)

334 
i
 = 0x80000000; i; i = i >> 1) {

335 ià(
æags
 & 
i
) {

336 
	`pŞdiff_g‘_¡©s
(
diff
, 
i
, 
¡©s
);

337 
tÙ®
 +ğ(
¡©s
[0] + stats[1] + stats[2] + stats[3] + stats[4]);

341  
tÙ®
;

342 
	}
}

344 
	$´št_diff
(cÚ¡ 
pŞdiff_t
 * 
diff
, 
ušt32_t
 
æags
, 
¡©s
, 
qu›t
)

346 ià(
æags
 & 
POLDIFF_DIFF_CLASSES
 && !(
qu›t
 && !
	`g‘_diff_tÙ®
(
diff
, POLDIFF_DIFF_CLASSES))) {

347 
	`´št_şass_diffs
(
diff
, 
¡©s
);

349 ià(
æags
 & 
POLDIFF_DIFF_COMMONS
 && !(
qu›t
 && !
	`g‘_diff_tÙ®
(
diff
, POLDIFF_DIFF_COMMONS))) {

350 
	`´št_commÚ_diffs
(
diff
, 
¡©s
);

352 ià(
æags
 & 
POLDIFF_DIFF_LEVELS
 && !(
qu›t
 && !
	`g‘_diff_tÙ®
(
diff
, POLDIFF_DIFF_LEVELS))) {

353 
	`´št_Ëv–_diffs
(
diff
, 
¡©s
);

355 ià(
æags
 & 
POLDIFF_DIFF_CATS
 && !(
qu›t
 && !
	`g‘_diff_tÙ®
(
diff
, POLDIFF_DIFF_CATS))) {

356 
	`´št_ÿt_diffs
(
diff
, 
¡©s
);

358 ià(
æags
 & 
POLDIFF_DIFF_TYPES
 && !(
qu›t
 && !
	`g‘_diff_tÙ®
(
diff
, POLDIFF_DIFF_TYPES))) {

359 
	`´št_ty³_diffs
(
diff
, 
¡©s
);

361 ià(
æags
 & 
POLDIFF_DIFF_ATTRIBS
 && !(
qu›t
 && !
	`g‘_diff_tÙ®
(
diff
, POLDIFF_DIFF_ATTRIBS))) {

362 
	`´št_©Œib_diffs
(
diff
, 
¡©s
);

364 ià(
æags
 & 
POLDIFF_DIFF_ROLES
 && !(
qu›t
 && !
	`g‘_diff_tÙ®
(
diff
, POLDIFF_DIFF_ROLES))) {

365 
	`´št_rŞe_diffs
(
diff
, 
¡©s
);

367 ià(
æags
 & 
POLDIFF_DIFF_USERS
 && !(
qu›t
 && !
	`g‘_diff_tÙ®
(
diff
, POLDIFF_DIFF_USERS))) {

368 
	`´št_u£r_diffs
(
diff
, 
¡©s
);

370 ià(
æags
 & 
POLDIFF_DIFF_BOOLS
 && !(
qu›t
 && !
	`g‘_diff_tÙ®
(
diff
, POLDIFF_DIFF_BOOLS))) {

371 
	`´št_boŞ_diffs
(
diff
, 
¡©s
);

373 ià(
æags
 & 
POLDIFF_DIFF_AVALLOW
 && !(
qu›t
 && !
	`g‘_diff_tÙ®
(
diff
, POLDIFF_DIFF_AVALLOW))) {

374 
	`´št_av®low_diffs
(
diff
, 
¡©s
);

376 ià(
æags
 & 
POLDIFF_DIFF_AVAUDITALLOW
 && !(
qu›t
 && !
	`g‘_diff_tÙ®
(
diff
, POLDIFF_DIFF_AVAUDITALLOW))) {

377 
	`´št_avaud™®low_diffs
(
diff
, 
¡©s
);

379 ià(
æags
 & 
POLDIFF_DIFF_AVDONTAUDIT
 && !(
qu›t
 && !
	`g‘_diff_tÙ®
(
diff
, POLDIFF_DIFF_AVDONTAUDIT))) {

380 
	`´št_avdÚud™_diffs
(
diff
, 
¡©s
);

382 ià(
æags
 & 
POLDIFF_DIFF_AVNEVERALLOW
 && !(
qu›t
 && !
	`g‘_diff_tÙ®
(
diff
, POLDIFF_DIFF_AVNEVERALLOW))) {

383 
	`´št_avÃv”®low_diffs
(
diff
, 
¡©s
);

385 ià(
æags
 & 
POLDIFF_DIFF_TECHANGE
 && !(
qu›t
 && !
	`g‘_diff_tÙ®
(
diff
, POLDIFF_DIFF_TECHANGE))) {

386 
	`´št_ruË_diffs
(
diff
, 
	`pŞdiff_g‘_compÚ’t_»cÜd
(
POLDIFF_DIFF_TECHANGE
), 
¡©s
, "TEy³_chªge", 
PRINT_ALL
,

387 
NULL
);

389 ià(
æags
 & 
POLDIFF_DIFF_TEMEMBER
 && !(
qu›t
 && !
	`g‘_diff_tÙ®
(
diff
, POLDIFF_DIFF_TEMEMBER))) {

390 
	`´št_ruË_diffs
(
diff
, 
	`pŞdiff_g‘_compÚ’t_»cÜd
(
POLDIFF_DIFF_TEMEMBER
), 
¡©s
, "TEy³_memb”", 
PRINT_ALL
,

391 
NULL
);

393 ià(
æags
 & 
POLDIFF_DIFF_TETRANS
 && !(
qu›t
 && !
	`g‘_diff_tÙ®
(
diff
, POLDIFF_DIFF_TETRANS))) {

394 
	`´št_ruË_diffs
(
diff
, 
	`pŞdiff_g‘_compÚ’t_»cÜd
(
POLDIFF_DIFF_TETRANS
), 
¡©s
, "TEy³_Œªs", 
PRINT_ALL
, 
NULL
);

396 ià(
æags
 & 
POLDIFF_DIFF_ROLE_ALLOWS
 && !(
qu›t
 && !
	`g‘_diff_tÙ®
(
diff
, POLDIFF_DIFF_ROLE_ALLOWS))) {

397 
	`´št_rŞe_®low_diffs
(
diff
, 
¡©s
);

399 ià(
æags
 & 
POLDIFF_DIFF_ROLE_TRANS
 && !(
qu›t
 && !
	`g‘_diff_tÙ®
(
diff
, POLDIFF_DIFF_ROLE_TRANS))) {

400 
	`´št_rŞe_Œªs_diffs
(
diff
, 
¡©s
);

402 ià(
æags
 & 
POLDIFF_DIFF_RANGE_TRANS
 && !(
qu›t
 && !
	`g‘_diff_tÙ®
(
diff
, POLDIFF_DIFF_RANGE_TRANS))) {

403 
	`´št_¿nge_Œªs_diffs
(
diff
, 
¡©s
);

405 
	}
}

407 
	$maš
(
¬gc
, **
¬gv
)

409 
İtc
 = 0, 
qu›t
 = 0, 
¡©s
 = 0, 
deçuÉ_®l
 = 0;

410 
ušt32_t
 
æags
 = 0;

411 
­Ş_pŞicy_t
 *
Üig_pŞicy
 = 
NULL
, *
mod_pŞicy
 = NULL;

412 
­Ş_pŞicy_·th_ty³_e
 
Üig_·th_ty³
 = 
APOL_POLICY_PATH_TYPE_MONOLITHIC
;

413 *
Üig_ba£_·th
 = 
NULL
;

414 
­Ş_veùÜ_t
 *
Üig_moduË_·ths
 = 
NULL
;

415 
­Ş_pŞicy_·th_t
 *
Üig_pŞ_·th
 = 
NULL
;

416 
­Ş_pŞicy_·th_ty³_e
 
mod_·th_ty³
 = 
APOL_POLICY_PATH_TYPE_MONOLITHIC
;

417 *
mod_ba£_·th
 = 
NULL
;

418 
­Ş_veùÜ_t
 *
mod_moduË_·ths
 = 
NULL
;

419 
­Ş_pŞicy_·th_t
 *
mod_pŞ_·th
 = 
NULL
;

420 
pŞdiff_t
 *
diff
 = 
NULL
;

421 
size_t
 
tÙ®
 = 0;

423 (
İtc
 = 
	`g‘İt_lÚg
(
¬gc
, 
¬gv
, "ù¬ubAqhV", 
lÚgİts
, 
NULL
)) != -1) {

424 
İtc
) {

428 
æags
 |ğ(
POLDIFF_DIFF_CLASSES
 | 
POLDIFF_DIFF_COMMONS
);

430 
DIFF_LEVEL
:

431 
æags
 |ğ
POLDIFF_DIFF_LEVELS
;

433 
DIFF_CATEGORY
:

434 
æags
 |ğ
POLDIFF_DIFF_CATS
;

437 
æags
 |ğ
POLDIFF_DIFF_TYPES
;

440 
æags
 |ğ
POLDIFF_DIFF_ATTRIBS
;

443 
æags
 |ğ
POLDIFF_DIFF_ROLES
;

446 
æags
 |ğ
POLDIFF_DIFF_USERS
;

449 
æags
 |ğ
POLDIFF_DIFF_BOOLS
;

452 
æags
 |ğ
POLDIFF_DIFF_AVALLOW
;

454 
DIFF_AUDITALLOW
:

455 
æags
 |ğ
POLDIFF_DIFF_AVAUDITALLOW
;

457 
DIFF_DONTAUDIT
:

458 
æags
 |ğ
POLDIFF_DIFF_AVDONTAUDIT
;

460 
DIFF_NEVERALLOW
:

461 
æags
 |ğ
POLDIFF_DIFF_AVNEVERALLOW
;

463 
DIFF_TYPE_CHANGE
:

464 
æags
 |ğ
POLDIFF_DIFF_TECHANGE
;

466 
DIFF_TYPE_MEMBER
:

467 
æags
 |ğ
POLDIFF_DIFF_TEMEMBER
;

469 
DIFF_TYPE_TRANS
:

470 
æags
 |ğ
POLDIFF_DIFF_TETRANS
;

472 
DIFF_ROLE_ALLOW
:

473 
æags
 |ğ
POLDIFF_DIFF_ROLE_ALLOWS
;

475 
DIFF_ROLE_TRANS
:

476 
æags
 |ğ
POLDIFF_DIFF_ROLE_TRANS
;

478 
DIFF_RANGE_TRANS
:

479 
æags
 |ğ
POLDIFF_DIFF_RANGE_TRANS
;

481 
OPT_STATS
:

482 
¡©s
 = 1;

485 
qu›t
 = 1;

488 
	`u§ge
(
¬gv
[0], 0);

489 
	`ex™
(0);

491 
	`´štf
("£difà%s\n%s\n", 
VERSION
, 
COPYRIGHT_INFO
);

492 
	`ex™
(0);

494 
	`u§ge
(
¬gv
[0], 1);

495 
	`ex™
(1);

499 ià(!
æags
) {

500 
æags
 = 
POLDIFF_DIFF_ALL
 & ~
POLDIFF_DIFF_AVNEVERALLOW
;

501 
deçuÉ_®l
 = 1;

504 ià(
¬gc
 - 
İtšd
 < 2) {

505 
	`u§ge
(
¬gv
[0], 1);

506 
	`ex™
(1);

509 ià(!
	`¡rcmp
(";", 
¬gv
[
İtšd
])) {

510 
	`ERR
(
NULL
, "%s", "Missing…atho original…olicy.");

511 
”r
;

513 
Üig_ba£_·th
 = 
¬gv
[
İtšd
++];

514 
Üig_·th_ty³
 = 
APOL_POLICY_PATH_TYPE_MONOLITHIC
;

515 ià(!(
Üig_moduË_·ths
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
))) {

516 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
”ºo
));

517 
”r
;

519 ; 
¬gc
 - 
İtšd
; optind++) {

520 ià(!
	`¡rcmp
(";", 
¬gv
[
İtšd
])) {

521 
İtšd
++;

524 ià(
	`­Ş_veùÜ_­³nd
(
Üig_moduË_·ths
, (*)
¬gv
[
İtšd
])) {

525 
	`ERR
(
NULL
, "E¼Ü†ßdšg moduË %s", 
¬gv
[
İtšd
]);

526 
”r
;

528 
Üig_·th_ty³
 = 
APOL_POLICY_PATH_TYPE_MODULAR
;

530 ià(
	`­Ş_fe_is_pŞicy_·th_li¡
(
Üig_ba£_·th
) > 0) {

531 
Üig_pŞ_·th
 = 
	`­Ş_pŞicy_·th_ü—‹_äom_fe
(
Üig_ba£_·th
);

532 ià(!
Üig_pŞ_·th
) {

533 
	`ERR
(
NULL
, "%s", "invalid…olicy†ist");

534 
”r
;

537 
Üig_pŞ_·th
 = 
	`­Ş_pŞicy_·th_ü—‹
(
Üig_·th_ty³
, 
Üig_ba£_·th
, 
Üig_moduË_·ths
);

538 ià(!
Üig_pŞ_·th
) {

539 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
”ºo
));

540 
”r
;

543 
	`­Ş_veùÜ_de¡roy
(&
Üig_moduË_·ths
);

545 ià(
¬gc
 - 
İtšd
 == 0) {

546 
	`ERR
(
NULL
, "%s", "Missing…atho modified…olicy.");

547 
”r
;

550 
mod_ba£_·th
 = 
¬gv
[
İtšd
++];

551 
mod_·th_ty³
 = 
APOL_POLICY_PATH_TYPE_MONOLITHIC
;

552 ià(!(
mod_moduË_·ths
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
))) {

553 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
”ºo
));

554 
”r
;

556 ; 
¬gc
 - 
İtšd
; optind++) {

557 ià(
	`­Ş_veùÜ_­³nd
(
mod_moduË_·ths
, (*)
¬gv
[
İtšd
])) {

558 
	`ERR
(
NULL
, "E¼Ü†ßdšg moduË %s", 
¬gv
[
İtšd
]);

559 
”r
;

561 
mod_·th_ty³
 = 
APOL_POLICY_PATH_TYPE_MODULAR
;

563 ià(
	`­Ş_fe_is_pŞicy_·th_li¡
(
mod_ba£_·th
) > 0) {

564 
mod_pŞ_·th
 = 
	`­Ş_pŞicy_·th_ü—‹_äom_fe
(
mod_ba£_·th
);

565 ià(!
mod_pŞ_·th
) {

566 
	`ERR
(
NULL
, "%s", "invalid…olicy†ist");

567 
”r
;

570 
mod_pŞ_·th
 = 
	`­Ş_pŞicy_·th_ü—‹
(
mod_·th_ty³
, 
mod_ba£_·th
, 
mod_moduË_·ths
);

571 ià(!
mod_pŞ_·th
) {

572 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
”ºo
));

573 
”r
;

576 
	`­Ş_veùÜ_de¡roy
(&
mod_moduË_·ths
);

578 
pŞicy_İt
 = 0;

579 ià(!(
æags
 & 
POLDIFF_DIFF_AVNEVERALLOW
)) {

580 
pŞicy_İt
 |ğ
QPOL_POLICY_OPTION_NO_NEVERALLOWS
;

582 ià(!(
æags
 & 
POLDIFF_DIFF_RULES
)) {

583 
pŞicy_İt
 |ğ
QPOL_POLICY_OPTION_NO_RULES
;

585 
Üig_pŞicy
 = 
	`­Ş_pŞicy_ü—‹_äom_pŞicy_·th
(
Üig_pŞ_·th
, 
pŞicy_İt
, 
NULL
, NULL);

586 ià(!
Üig_pŞicy
) {

587 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
”ºo
));

588 
”r
;

590 
mod_pŞicy
 = 
	`­Ş_pŞicy_ü—‹_äom_pŞicy_·th
(
mod_pŞ_·th
, 
pŞicy_İt
, 
NULL
, NULL);

591 ià(!
mod_pŞicy
) {

592 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
”ºo
));

593 
”r
;

596 
qpŞ_pŞicy_t
 *
Üig_qpŞ
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
Üig_pŞicy
);

597 
qpŞ_pŞicy_t
 *
mod_qpŞ
 = 
	`­Ş_pŞicy_g‘_qpŞ
(
mod_pŞicy
);

601 ià((
æags
 & 
POLDIFF_DIFF_ATTRIBS
)

602 && (!(
	`qpŞ_pŞicy_has_ÿ·b™y
(
Üig_qpŞ
, 
QPOL_CAP_ATTRIB_NAMES
))

603 || !(
	`qpŞ_pŞicy_has_ÿ·b™y
(
mod_qpŞ
, 
QPOL_CAP_ATTRIB_NAMES
)))) {

604 
æags
 &ğ~
POLDIFF_DIFF_ATTRIBS
;

605 
	`WARN
(
NULL
, "%s", "Attribute diffs‡re‚ot supported for current…olicies.");

611 ià((
æags
 & 
POLDIFF_DIFF_MLS
)

612 && (!(
	`qpŞ_pŞicy_has_ÿ·b™y
(
Üig_qpŞ
, 
QPOL_CAP_MLS
)è&& !(qpŞ_pŞicy_has_ÿ·b™y(
mod_qpŞ
, QPOL_CAP_MLS)))) {

613 
æags
 &ğ~(
POLDIFF_DIFF_MLS
);

614 ià(!
deçuÉ_®l
) {

615 
	`WARN
(
NULL
, "%s", "MLS diffs‡re‚ot supported for current…olicies.");

620 ià(!(
diff
 = 
	`pŞdiff_ü—‹
(
Üig_pŞicy
, 
mod_pŞicy
, 
NULL
, NULL))) {

621 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
”ºo
));

622 
”r
;

625 
Üig_pŞicy
 = 
mod_pŞicy
 = 
NULL
;

627 ià(
	`pŞdiff_run
(
diff
, 
æags
)) {

628 
”r
;

631 
	`´št_diff
(
diff
, 
æags
, 
¡©s
, 
qu›t
);

633 
tÙ®
 = 
	`g‘_diff_tÙ®
(
diff
, 
æags
);

635 
	`­Ş_pŞicy_·th_de¡roy
(&
Üig_pŞ_·th
);

636 
	`­Ş_pŞicy_·th_de¡roy
(&
mod_pŞ_·th
);

637 
	`pŞdiff_de¡roy
(&
diff
);

639 ià(
tÙ®
)

644 
”r
:

645 
	`­Ş_pŞicy_de¡roy
(&
Üig_pŞicy
);

646 
	`­Ş_pŞicy_de¡roy
(&
mod_pŞicy
);

647 
	`­Ş_pŞicy_·th_de¡roy
(&
Üig_pŞ_·th
);

648 
	`­Ş_pŞicy_·th_de¡roy
(&
mod_pŞ_·th
);

649 
	`­Ş_veùÜ_de¡roy
(&
Üig_moduË_·ths
);

650 
	`­Ş_veùÜ_de¡roy
(&
mod_moduË_·ths
);

651 
	`pŞdiff_de¡roy
(&
diff
);

653 
	}
}

	@sediff/sediffx.c

27 
	~<cÚfig.h
>

29 
	~"£diffx.h
"

30 
	~"tİËv–.h
"

32 
	~<”ºo.h
>

33 
	~<g‘İt.h
>

34 
	~<¡dio.h
>

35 
	~<¡dlib.h
>

36 
	~<gÏde/gÏde.h
>

37 
	~<gtk/gtk.h
>

39 
	s£diffx


41 
­Ş_pŞicy_·th_t
 *
	m·ths
[
SEDIFFX_POLICY_NUM
];

42 
­Ş_pŞicy_t
 *
	mpŞic›s
[
SEDIFFX_POLICY_NUM
];

43 
tİËv–_t
 *
	mtİ
;

44 
pŞdiff_t
 *
	mpŞdiff
;

45 
ušt32_t
 
	mæags
;

48 
İtiÚ
 cÚ¡ 
	glÚgİts
[] = {

49 {"run-diff", 
no_¬gum’t
, 
NULL
, 'd'},

50 {"h–p", 
no_¬gum’t
, 
NULL
, 'h'},

51 {"v”siÚ", 
no_¬gum’t
, 
NULL
, 'V'},

52 {
NULL
, 0, NULL, 0}

55 
	$£diffx_£t_pŞicy
(
£diffx_t
 * 
s
, 
£diffx_pŞicy_e
 
which
, 
­Ş_pŞicy_t
 * 
pŞicy
, 
­Ş_pŞicy_·th_t
 * 
·th
)

57 
	`pŞdiff_de¡roy
(&
s
->
pŞdiff
);

58 ià(
pŞicy
 !ğ
NULL
) {

59 
	`­Ş_pŞicy_de¡roy
(&
s
->
pŞic›s
[
which
]);

60 
s
->
pŞic›s
[
which
] = 
pŞicy
;

61 ià(
·th
 !ğ
s
->
·ths
[
which
]) {

62 
	`­Ş_pŞicy_·th_de¡roy
(&
s
->
·ths
[
which
]);

64 
s
->
·ths
[
which
] = 
·th
;

66 
	`­Ş_pŞicy_de¡roy
(&
s
->
pŞic›s
[
which
]);

67 
	`­Ş_pŞicy_·th_de¡roy
(&
s
->
·ths
[
which
]);

69 
	}
}

71 cÚ¡ 
­Ş_pŞicy_·th_t
 *
	$£diffx_g‘_pŞicy_·th
(
£diffx_t
 * 
£diffx
, cÚ¡ 
£diffx_pŞicy_e
 
which
)

73  
£diffx
->
·ths
[
which
];

74 
	}
}

76 
pŞdiff_t
 *
	$£diffx_g‘_pŞdiff
(
£diffx_t
 * 
s
, 
pŞdiff_hªdË_â_t
 
â
, *
¬g
)

78 ià(
s
->
pŞdiff
 !ğ
NULL
) {

79  
s
->
pŞdiff
;

81 ià(
s
->
pŞic›s
[
SEDIFFX_POLICY_ORIG
] =ğ
NULL
 || s->pŞic›s[
SEDIFFX_POLICY_MOD
] == NULL) {

82  
NULL
;

84 
s
->
pŞdiff
 = 
	`pŞdiff_ü—‹
(s->
pŞic›s
[
SEDIFFX_POLICY_ORIG
], s->pŞic›s[
SEDIFFX_POLICY_MOD
], 
â
, 
¬g
);

85 ià(
s
->
pŞdiff
 !ğ
NULL
) {

87 
s
->
pŞic›s
[
SEDIFFX_POLICY_ORIG
] = 
NULL
;

88 
s
->
pŞic›s
[
SEDIFFX_POLICY_MOD
] = 
NULL
;

90  
s
->
pŞdiff
;

91 
	}
}

93 
	$£diffx_£t_pŞdiff_run_æags
(
£diffx_t
 * 
s
, 
ušt32_t
 
æags
)

95 
s
->
æags
 = flags;

96 
	}
}

98 
ušt32_t
 
	$£diffx_g‘_pŞdiff_run_æags
(
£diffx_t
 * 
s
)

100  
s
->
æags
;

101 
	}
}

103 
	$´št_v”siÚ_šfo
()

105 
	`´štf
("£diffx %s\n%s\n", 
VERSION
, 
COPYRIGHT_INFO
);

106 
	}
}

108 
	$u§ge
(cÚ¡ *
´og¿m_Çme
, 
br›f
)

110 
	`´štf
("U§ge: % [-d] [ORIGINAL_POLICY ; MODIFIED_POLICY]\n\n", 
´og¿m_Çme
);

111 ià(
br›f
) {

112 
	`´štf
("\tTry % --h–°fÜ mÜh–p.\n\n", 
´og¿m_Çme
);

115 
	`´štf
("Semantically differentiatewo…olicies. All supported…olicyƒlements\n");

116 
	`´štf
("areƒxamined. The following options‡re‡vailable:\n");

117 
	`´štf
("\n");

118 
	`´štf
(" -d, --diff-now†oad…olicies‡nd diff immediately\n");

119 
	`´štf
(" -h, --help…rinthis helpext‡ndƒxit\n");

120 
	`´štf
(" -V, --version…rint version information‡ndƒxit\n\n");

121 
	}
}

123 
	sd–ayed_maš_d©a


125 
­Ş_pŞicy_·th_t
 *
	mÜig_·th
, *
	mmod_·th
;

126 
	mrun_diff
;

127 
tİËv–_t
 *
	mtİ
;

136 
gboŞ—n
 
	$d–ayed_maš
(
gpoš‹r
 
d©a
)

138 
d–ayed_maš_d©a
 *
dmd
 = (d–ayed_maš_d©¨*)
d©a
;

139 ià(
	`tİËv–_İ’_pŞic›s
(
dmd
->
tİ
, dmd->
Üig_·th
, dmd->
mod_·th
è=ğ0 && dmd->
run_diff
) {

140 
	`tİËv–_run_diff
(
dmd
->
tİ
);

142  
FALSE
;

143 
	}
}

145 
	$£diffx_de¡roy
(
£diffx_t
 ** 
£diffx
)

147 ià(
£diffx
 !ğ
NULL
 && *sediffx != NULL) {

148 
i
;

149 
i
 = 
SEDIFFX_POLICY_ORIG
; i < 
SEDIFFX_POLICY_NUM
; i++) {

150 
	`­Ş_pŞicy_·th_de¡roy
(&((*
£diffx
)->
·ths
[
i
]));

151 
	`­Ş_pŞicy_de¡roy
(&((*
£diffx
)->
pŞic›s
[
i
]));

153 
	`pŞdiff_de¡roy
(&((*
£diffx
)->
pŞdiff
));

154 
	`ä“
(*
£diffx
);

155 *
£diffx
 = 
NULL
;

157 
	}
}

159 
	$£diffx_·r£_commªd_lše
(
¬gc
, **
¬gv
, 
­Ş_pŞicy_·th_t
 ** 
Üig_·th
,‡pŞ_pŞicy_·th_ˆ** 
mod_·th
,

160 *
run_diff
)

162 
İtc
;

163 *
Üig_·th
 = 
NULL
;

164 *
mod_·th
 = 
NULL
;

165 *
run_diff
 = 0;

166 (
İtc
 = 
	`g‘İt_lÚg
(
¬gc
, 
¬gv
, "dhV", 
lÚgİts
, 
NULL
)) != -1) {

167 
İtc
) {

171 *
run_diff
 = 1;

174 
	`u§ge
(
¬gv
[0], 0);

175 
	`ex™
(
EXIT_SUCCESS
);

177 
	`´št_v”siÚ_šfo
();

178 
	`ex™
(
EXIT_SUCCESS
);

180 
	`u§ge
(
¬gv
[0], 1);

181 
	`ex™
(
EXIT_FAILURE
);

185 ià(
¬gc
 - 
İtšd
 == 0) {

188 ià(*
run_diff
) {

189 
	`u§ge
(
¬gv
[0], 0);

190 
	`ex™
(
EXIT_FAILURE
);

193 } ià(
¬gc
 - 
İtšd
 == 1) {

194 
	`u§ge
(
¬gv
[0], 1);

195 
	`ex™
(
EXIT_FAILURE
);

197 ià(
¬gc
 - 
İtšd
 == 2) {

199 ià(
	`¡rcmp
(
¬gv
[
İtšd
], ";") == 0 || strcmp(argv[optind + 1], ";") == 0) {

200 
	`u§ge
(
¬gv
[0], 1);

201 
	`ex™
(
EXIT_FAILURE
);

203 *
Üig_·th
 = 
	`­Ş_pŞicy_·th_ü—‹
(
APOL_POLICY_PATH_TYPE_MONOLITHIC
, 
¬gv
[
İtšd
], 
NULL
);

204 *
mod_·th
 = 
	`­Ş_pŞicy_·th_ü—‹
(
APOL_POLICY_PATH_TYPE_MONOLITHIC
, 
¬gv
[
İtšd
 + 1], 
NULL
);

205 ià(*
Üig_·th
 =ğ
NULL
 || *
mod_·th
 == NULL) {

206 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
”ºo
));

207 
	`ex™
(
EXIT_FAILURE
);

213 *
Üig_ba£_·th
 = 
NULL
;

214 
­Ş_veùÜ_t
 *
Üig_moduË_·ths
 = 
NULL
;

215 *
mod_ba£_·th
 = 
NULL
;

216 
­Ş_veùÜ_t
 *
mod_moduË_·ths
 = 
NULL
;

217 
­Ş_pŞicy_·th_ty³_e
 
Üig_·th_ty³
 = 
APOL_POLICY_PATH_TYPE_MONOLITHIC
;

218 
­Ş_pŞicy_·th_ty³_e
 
mod_·th_ty³
 = 
APOL_POLICY_PATH_TYPE_MONOLITHIC
;

220 
Üig_ba£_·th
 = 
¬gv
[
İtšd
++];

221 ià(!(
Üig_moduË_·ths
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
))) {

222 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
”ºo
));

223 
”r
;

225 ; 
¬gc
 - 
İtšd
; optind++) {

226 ià(!
	`¡rcmp
(";", 
¬gv
[
İtšd
])) {

227 
İtšd
++;

230 ià(
	`­Ş_veùÜ_­³nd
(
Üig_moduË_·ths
, (*)
¬gv
[
İtšd
])) {

231 
	`ERR
(
NULL
, "E¼Ü†ßdšg moduË %s", 
¬gv
[
İtšd
]);

232 
”r
;

234 
Üig_·th_ty³
 = 
APOL_POLICY_PATH_TYPE_MODULAR
;

236 ià(
	`­Ş_fe_is_pŞicy_·th_li¡
(
Üig_ba£_·th
) > 0) {

237 *
Üig_·th
 = 
	`­Ş_pŞicy_·th_ü—‹_äom_fe
(
Üig_ba£_·th
);

238 ià(*
Üig_·th
 =ğ
NULL
) {

239 
	`ERR
(
NULL
, "%s", "invalid…olicy†ist");

240 
”r
;

243 *
Üig_·th
 = 
	`­Ş_pŞicy_·th_ü—‹
(
Üig_·th_ty³
, 
Üig_ba£_·th
, 
Üig_moduË_·ths
);

244 ià(*
Üig_·th
 =ğ
NULL
) {

245 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
”ºo
));

246 
”r
;

249 
	`­Ş_veùÜ_de¡roy
(&
Üig_moduË_·ths
);

251 ià(
¬gc
 - 
İtšd
 == 0) {

252 
	`ERR
(
NULL
, "%s", "Missing…atho modified…olicy.");

253 
”r
;

256 
mod_ba£_·th
 = 
¬gv
[
İtšd
++];

257 ià(!(
mod_moduË_·ths
 = 
	`­Ş_veùÜ_ü—‹
(
NULL
))) {

258 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
”ºo
));

259 
”r
;

261 ; 
¬gc
 - 
İtšd
; optind++) {

262 ià(
	`­Ş_veùÜ_­³nd
(
mod_moduË_·ths
, (*)
¬gv
[
İtšd
])) {

263 
	`ERR
(
NULL
, "E¼Ü†ßdšg moduË %s", 
¬gv
[
İtšd
]);

264 
”r
;

266 
mod_·th_ty³
 = 
APOL_POLICY_PATH_TYPE_MODULAR
;

268 ià(
	`­Ş_fe_is_pŞicy_·th_li¡
(
mod_ba£_·th
) > 0) {

269 *
mod_·th
 = 
	`­Ş_pŞicy_·th_ü—‹_äom_fe
(
mod_ba£_·th
);

270 ià(*
mod_·th
 =ğ
NULL
) {

271 
	`ERR
(
NULL
, "%s", "invalid…olicy†ist");

272 
”r
;

275 *
mod_·th
 = 
	`­Ş_pŞicy_·th_ü—‹
(
mod_·th_ty³
, 
mod_ba£_·th
, 
mod_moduË_·ths
);

276 ià(*
mod_·th
 =ğ
NULL
) {

277 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
”ºo
));

278 
”r
;

281 
	`­Ş_veùÜ_de¡roy
(&
mod_moduË_·ths
);

283 
”r
:

284 
	`­Ş_pŞicy_·th_de¡roy
(
Üig_·th
);

285 
	`­Ş_pŞicy_·th_de¡roy
(
mod_·th
);

286 
	`­Ş_veùÜ_de¡roy
(&
Üig_moduË_·ths
);

287 
	`­Ş_veùÜ_de¡roy
(&
mod_moduË_·ths
);

288 
	}
}

290 
	$maš
(
¬gc
, **
¬gv
)

292 
£diffx_t
 *
­p
;

293 
­Ş_pŞicy_·th_t
 *
Üig_·th
, *
mod_·th
;

294 
run_diff
;

296 ià(!
	`g_th»ad_suµÜ‹d
())

297 
	`g_th»ad_š™
(
NULL
);

299 
	`gtk_š™
(&
¬gc
, &
¬gv
);

300 
	`£diffx_·r£_commªd_lše
(
¬gc
, 
¬gv
, &
Üig_·th
, &
mod_·th
, &
run_diff
);

301 
	`gÏde_š™
();

302 ià(!
	`g_th»ad_suµÜ‹d
())

303 
	`g_th»ad_š™
(
NULL
);

304 ià((
­p
 = 
	`ÿÎoc
(1, (*­p))è=ğ
NULL
 || (­p->
tİ
 = 
	`tİËv–_ü—‹
(app)) == NULL) {

305 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
”ºo
));

306 
	`£diffx_de¡roy
(&
­p
);

307 
	`ex™
(
EXIT_FAILURE
);

309 ià(
Üig_·th
 !ğ
NULL
 && 
mod_·th
 != NULL) {

310 
d–ayed_maš_d©a
 
dmd
 = { 
Üig_·th
, 
mod_·th
, 
run_diff
, 
­p
->
tİ
 };

311 
	`g_idË_add
(&
d–ayed_maš
, &
dmd
);

313 
	`gtk_maš
();

315 
	`£diffx_de¡roy
(&
­p
);

316 
	`ex™
(
EXIT_SUCCESS
);

317 
	}
}

	@sediff/sediffx.h

27 #iâdeà
SEDIFFX_H


28 
	#SEDIFFX_H


	)

30 
	~<­Ş/pŞicy.h
>

31 
	~<­Ş/pŞicy-·th.h
>

32 
	~<pŞdiff/pŞdiff.h
>

34 
£diffx
 
	t£diffx_t
;

38 
	e£diffx_pŞicy


40 
	mSEDIFFX_POLICY_ORIG
 = 0, 
	mSEDIFFX_POLICY_MOD
, 
	mSEDIFFX_POLICY_NUM


41 } 
	t£diffx_pŞicy_e
;

43 
	#COPYRIGHT_INFO
 "Cİyrighˆ(Cè2004-2007 T»sy TechnŞogy, LLC"

	)

56 
£diffx_£t_pŞicy
(
£diffx_t
 * 
s
, 
£diffx_pŞicy_e
 
which
, 
­Ş_pŞicy_t
 * 
pŞicy
, 
­Ş_pŞicy_·th_t
 * 
·th
);

67 cÚ¡ 
­Ş_pŞicy_·th_t
 *
£diffx_g‘_pŞicy_·th
(
£diffx_t
 * 
s
, cÚ¡ 
£diffx_pŞicy_e
 
which
);

84 
pŞdiff_t
 *
£diffx_g‘_pŞdiff
(
£diffx_t
 * 
s
, 
pŞdiff_hªdË_â_t
 
â
, *
¬g
);

95 
£diffx_£t_pŞdiff_run_æags
(
£diffx_t
 * 
s
, 
ušt32_t
 
æags
);

106 
ušt32_t
 
£diffx_g‘_pŞdiff_run_æags
(
£diffx_t
 * 
s
);

	@sediff/select_diff_dialog.c

25 
	~<cÚfig.h
>

27 
	~"£Ëù_diff_dŸlog.h
"

29 
	~<as£¹.h
>

30 
	~<gÏde/gÏde.h
>

32 
	scompÚ’t


34 cÚ¡ *
	mÇme
;

35 cÚ¡ 
ušt32_t
 
	mb™
;

38 cÚ¡ 
compÚ’t
 
	gcomps
[] = {

39 {"©Œib checkbu‰Ú", 
POLDIFF_DIFF_ATTRIBS
},

40 {"®low checkbu‰Ú", 
POLDIFF_DIFF_AVALLOW
},

41 {"aud™®low checkbu‰Ú", 
POLDIFF_DIFF_AVAUDITALLOW
},

42 {"dÚud™ checkbu‰Ú", 
POLDIFF_DIFF_AVDONTAUDIT
},

43 {"Ãv”®low checkbu‰Ú", 
POLDIFF_DIFF_AVNEVERALLOW
},

44 {"boŞ checkbu‰Ú", 
POLDIFF_DIFF_BOOLS
},

45 {"ÿt checkbu‰Ú", 
POLDIFF_DIFF_CATS
},

46 {"şas£ checkbu‰Ú", 
POLDIFF_DIFF_CLASSES
},

47 {"commÚ checkbu‰Ú", 
POLDIFF_DIFF_COMMONS
},

48 {"Ëv– checkbu‰Ú", 
POLDIFF_DIFF_LEVELS
},

49 {"¿ng‘¿n checkbu‰Ú", 
POLDIFF_DIFF_RANGE_TRANS
},

50 {"rŞe checkbu‰Ú", 
POLDIFF_DIFF_ROLES
},

51 {"rŞ—Îow checkbu‰Ú", 
POLDIFF_DIFF_ROLE_ALLOWS
},

52 {"rŞ‘¿n checkbu‰Ú", 
POLDIFF_DIFF_ROLE_TRANS
},

53 {"u£r checkbu‰Ú", 
POLDIFF_DIFF_USERS
},

54 {"ty³_chªgcheckbu‰Ú", 
POLDIFF_DIFF_TECHANGE
},

55 {"ty³_memb” checkbu‰Ú", 
POLDIFF_DIFF_TEMEMBER
},

56 {"ty³_Œªs™iÚ checkbu‰Ú", 
POLDIFF_DIFF_TETRANS
},

57 {"ty³ checkbu‰Ú", 
POLDIFF_DIFF_TYPES
},

58 {
NULL
, 0}

61 
ušt32_t
 
	g´ev_£ËùiÚ
 = 
POLDIFF_DIFF_ALL
 & ~
POLDIFF_DIFF_AVNEVERALLOW
;

63 
£Ëù_diff_Ú_£Ëù_®l_şick
(
GtkBu‰Ú
 * 
bu‰Ú
 
__©Œibu‹__
 ((
unu£d
)), 
gpoš‹r
 
u£r_d©a
)

65 
GÏdeXML
 *
	gxml
 = (GÏdeXML *è
u£r_d©a
;

66 
size_t
 
	gi
;

67 cÚ¡ 
compÚ’t
 *
	gc
;

68 
	gi
 = 0; 
	gcomps
[
i
].
	gÇme
 !ğ
NULL
; i++) {

69 
	gc
 = 
comps
 + 
i
;

70 
GtkToggËBu‰Ú
 *
	gcb
 = 
GTK_TOGGLE_BUTTON
(
gÏde_xml_g‘_widg‘
(
xml
, 
c
->
Çme
));

71 
gtk_toggË_bu‰Ú_£t_aùive
(
cb
, 
TRUE
);

75 
£Ëù_diff_Ú_£Ëù_nÚe_şick
(
GtkBu‰Ú
 * 
bu‰Ú
 
__©Œibu‹__
 ((
unu£d
)), 
gpoš‹r
 
u£r_d©a
)

77 
GÏdeXML
 *
	gxml
 = (GÏdeXML *è
u£r_d©a
;

78 
size_t
 
	gi
;

79 cÚ¡ 
compÚ’t
 *
	gc
;

80 
	gi
 = 0; 
	gcomps
[
i
].
	gÇme
 !ğ
NULL
; i++) {

81 
	gc
 = 
comps
 + 
i
;

82 
GtkToggËBu‰Ú
 *
	gcb
 = 
GTK_TOGGLE_BUTTON
(
gÏde_xml_g‘_widg‘
(
xml
, 
c
->
Çme
));

83 
gtk_toggË_bu‰Ú_£t_aùive
(
cb
, 
FALSE
);

87 
	$£Ëù_diff_dŸlog_run
(
tİËv–_t
 * 
tİ
)

89 
GÏdeXML
 *
xml
 = 
	`gÏde_xml_Ãw
(
	`tİËv–_g‘_gÏde_xml
(
tİ
), "£Ëù_compÚ’ts", 
NULL
);

90 
GtkDŸlog
 *
dŸlog
 = 
	`GTK_DIALOG
(
	`gÏde_xml_g‘_widg‘
(
xml
, "select_components"));

91 
	`as£¹
(
dŸlog
 !ğ
NULL
);

92 
	`gtk_wšdow_£t_Œªs›Á_fÜ
(
	`GTK_WINDOW
(
dŸlog
), 
	`tİËv–_g‘_wšdow
(
tİ
));

94 
size_t
 
i
;

95 cÚ¡ 
compÚ’t
 *
c
;

96 
i
 = 0; 
comps
[i].
Çme
 !ğ
NULL
; i++) {

97 
c
 = 
comps
 + 
i
;

98 
GtkToggËBu‰Ú
 *
cb
 = 
	`GTK_TOGGLE_BUTTON
(
	`gÏde_xml_g‘_widg‘
(
xml
, 
c
->
Çme
));

99 
	`as£¹
(
cb
 !ğ
NULL
);

100 
	`gtk_toggË_bu‰Ú_£t_aùive
(
cb
, 
c
->
b™
 & 
´ev_£ËùiÚ
 ? 
TRUE
 : 
FALSE
);

103 
GtkBu‰Ú
 *
b
 = 
	`GTK_BUTTON
(
	`gÏde_xml_g‘_widg‘
(
xml
, "select‡ll button"));

104 
	`as£¹
(
b
 !ğ
NULL
);

105 
	`g_sigÇl_cÚÃù
(
b
, "şicked", 
	`G_CALLBACK
(
£Ëù_diff_Ú_£Ëù_®l_şick
), 
xml
);

106 
b
 = 
	`GTK_BUTTON
(
	`gÏde_xml_g‘_widg‘
(
xml
, "select‚one button"));

107 
	`as£¹
(
b
 !ğ
NULL
);

108 
	`g_sigÇl_cÚÃù
(
b
, "şicked", 
	`G_CALLBACK
(
£Ëù_diff_Ú_£Ëù_nÚe_şick
), 
xml
);

110 
ušt32_t
 
»suÉ
 = 0;

111 
»suÉ
 == 0) {

112 
»suÉ
 = 0;

113 ià(
	`gtk_dŸlog_run
(
dŸlog
è!ğ
GTK_RESPONSE_OK
) {

114 
	`gtk_widg‘_de¡roy
(
	`GTK_WIDGET
(
dŸlog
));

118 
i
 = 0; 
comps
[i].
Çme
 !ğ
NULL
; i++) {

119 
c
 = 
comps
 + 
i
;

120 
GtkToggËBu‰Ú
 *
cb
 = 
	`GTK_TOGGLE_BUTTON
(
	`gÏde_xml_g‘_widg‘
(
xml
, 
c
->
Çme
));

121 ià(
	`gtk_toggË_bu‰Ú_g‘_aùive
(
cb
)) {

122 
»suÉ
 |ğ
c
->
b™
;

126 ià(
»suÉ
 == 0) {

127 
	`tİËv–_ERR
(
tİ
, "%s", "At†east one component must be selected.");

131 
	`gtk_widg‘_de¡roy
(
	`GTK_WIDGET
(
dŸlog
));

132 
´ev_£ËùiÚ
 = 
»suÉ
;

133  
»suÉ
;

134 
	}
}

	@sediff/select_diff_dialog.h

26 #iâdeà
SELECT_DIFF_DIALOG_H


27 
	#SELECT_DIFF_DIALOG_H


	)

29 
	~"tİËv–.h
"

40 
£Ëù_diff_dŸlog_run
(
tİËv–_t
 * 
tİ
);

	@sediff/toplevel.c

27 
	~<cÚfig.h
>

29 
	~"fšd_dŸlog.h
"

30 
	~"İ’_pŞic›s_dŸlog.h
"

31 
	~"pŞicy_v›w.h
"

32 
	~"»m­_ty³s_dŸlog.h
"

33 
	~"£diffx.h
"

34 
	~"£Ëù_diff_dŸlog.h
"

35 
	~"tİËv–.h
"

36 
	~"utgui.h
"

38 
	~<as£¹.h
>

39 
	~<”ºo.h
>

40 
	~<¡dlib.h
>

41 
	~<­Ş/ut.h
>

42 
	~<gtk/gtk.h
>

43 
	~<gÏde/gÏde.h
>

45 
	stİËv–


47 
£diffx_t
 *
	ms
;

48 
´og»ss_t
 *
	m´og»ss
;

49 
fšd_dŸlog_t
 *
	mfšd
;

50 
»suÉs_t
 *
	m»suÉs
;

51 
pŞicy_v›w_t
 *
	mv›ws
[
SEDIFFX_POLICY_NUM
];

52 
GÏdeXML
 *
	mxml
;

54 *
	mxml_f’ame
;

56 
GtkWšdow
 *
	mw
;

58 
GtkNÙebook
 *
	mnÙebook
;

68 
	$tİËv–_’abË_pŞicy_™ems
(
tİËv–_t
 * 
tİ
, 
gboŞ—n
 
£ns
)

70 cÚ¡ *
™ems
[] = {

74 
NULL


76 
size_t
 
i
;

77 cÚ¡ *
s
;

78 
i
 = 0, 
s
 = 
™ems
[0]; s !ğ
NULL
; s = items[++i]) {

79 
GtkWidg‘
 *
w
 = 
	`gÏde_xml_g‘_widg‘
(
tİ
->
xml
, 
s
);

80 
	`as£¹
(
w
 !ğ
NULL
);

81 
	`gtk_widg‘_£t_£ns™ive
(
w
, 
£ns
);

83 
	}
}

91 
	$tİËv–_upd©e_t™Ë_b¬
(
tİËv–_t
 * 
tİ
)

93 cÚ¡ 
­Ş_pŞicy_·th_t
 *
·ths
[
SEDIFFX_POLICY_NUM
];

94 *
ty³s
[
SEDIFFX_POLICY_NUM
] = { "PŞicy", "PŞicy" }, *
s
;

95 cÚ¡ *
´im¬›s
[
SEDIFFX_POLICY_NUM
] = { 
NULL
, NULL };

96 
£diffx_pŞicy_e
 
i
;

98 
·ths
[
SEDIFFX_POLICY_ORIG
] = 
	`£diffx_g‘_pŞicy_·th
(
tİ
->
s
, SEDIFFX_POLICY_ORIG);

99 
·ths
[
SEDIFFX_POLICY_MOD
] = 
	`£diffx_g‘_pŞicy_·th
(
tİ
->
s
, SEDIFFX_POLICY_MOD);

101 
i
 = 
SEDIFFX_POLICY_ORIG
; i < 
SEDIFFX_POLICY_NUM
; i++) {

102 ià(
·ths
[
i
] =ğ
NULL
) {

103 
´im¬›s
[
i
] = "No Policy";

105 ià(
	`­Ş_pŞicy_·th_g‘_ty³
(
·ths
[
i
]è=ğ
APOL_POLICY_PATH_TYPE_MODULAR
) {

106 
ty³s
[
i
] = "Base";

108 
´im¬›s
[
i
] = 
	`­Ş_pŞicy_·th_g‘_´im¬y
(
·ths
[i]);

111 ià(
	`a¥rštf
(&
s
, "sediffx - [%s file: %s] [%s file: %s]",

112 
ty³s
[
SEDIFFX_POLICY_ORIG
], 
´im¬›s
[SEDIFFX_POLICY_ORIG],

113 
ty³s
[
SEDIFFX_POLICY_MOD
], 
´im¬›s
[SEDIFFX_POLICY_MOD]) < 0) {

114 
	`tİËv–_ERR
(
tİ
, "%s", 
	`¡»¼Ü
(
”ºo
));

117 
	`gtk_wšdow_£t_t™Ë
(
tİ
->
w
, 
s
);

118 
	`ä“
(
s
);

119 
	}
}

130 
	$š™_icÚs
(
tİËv–_t
 * 
tİ
)

132 cÚ¡ *
icÚ_Çmes
[] = { "sediffx-small.png", "sediffx.png" };

133 
GdkPixbuf
 *
icÚ
;

134 *
·th
;

135 
GLi¡
 *
icÚ_li¡
 = 
NULL
;

136 
size_t
 
i
;

137 
i
 = 0; i < (
icÚ_Çmes
) / (icon_names[0]); i++) {

138 ià((
·th
 = 
	`­Ş_fe_fšd_·th
(
icÚ_Çmes
[
i
])è=ğ
NULL
) {

141 
icÚ
 = 
	`gdk_pixbuf_Ãw_äom_fe
(
·th
, 
NULL
);

142 
	`ä“
(
·th
);

143 ià(
icÚ
 =ğ
NULL
) {

146 
icÚ_li¡
 = 
	`g_li¡_­³nd
(icÚ_li¡, 
icÚ
);

148 
	`gtk_wšdow_£t_deçuÉ_icÚ_li¡
(
icÚ_li¡
);

149 
	`gtk_wšdow_£t_icÚ_li¡
(
tİ
->
w
, 
icÚ_li¡
);

150 
	}
}

152 
tİËv–_Ú_sw™ch_·ge
(
GtkNÙebook
 * 
nÙebook
 
__©Œibu‹__
 ((
unu£d
)), 
GtkNÙebookPage
 * 
·ge


153 
__©Œibu‹__
 ((
unu£d
)), 
gušt
 
·ge_num
, 
gpoš‹r
 
u£r_d©a
)

155 
tİËv–_t
 *
	gtİ
 = (tİËv–_ˆ*è
u£r_d©a
;

156 ià(
	g·ge_num
 != 0) {

157 
tİËv–_£t_sÜt_m’u_£ns™iv™y
(
tİ
, 
FALSE
);

159 
»suÉs_sw™ch_to_·ge
(
tİ
->
»suÉs
);

163 
tİËv–_t
 *
	$tİËv–_ü—‹
(
£diffx_t
 * 
s
)

165 
tİËv–_t
 *
tİ
;

166 
”rÜ
 = 0;

167 
£diffx_pŞicy_e
 
i
;

168 ià((
tİ
 = 
	`ÿÎoc
(1, (*tİ))è=ğ
NULL
) {

169 
”rÜ
 = 
”ºo
;

170 
ş—nup
;

172 
tİ
->
s
 = s;

173 ià((
tİ
->
xml_f’ame
 = 
	`­Ş_fe_fšd_·th
("£diffx.gÏde")è=ğ
NULL
 ||

174 (
tİ
->
xml
 = 
	`gÏde_xml_Ãw
Ñİ->
xml_f’ame
, "tİËv–", 
NULL
)) == NULL) {

175 
	`årštf
(
¡d”r
, "Could‚ot open sediffx.glade.\n");

176 
”rÜ
 = 
EIO
;

177 
ş—nup
;

179 
tİ
->
w
 = 
	`GTK_WINDOW
(
	`gÏde_xml_g‘_widg‘
Ñİ->
xml
, "toplevel"));

180 
tİ
->
nÙebook
 = 
	`GTK_NOTEBOOK
(
	`gÏde_xml_g‘_widg‘
Ñİ->
xml
, "toplevel main‚otebook"));

181 
	`as£¹
(
tİ
->
w
 !ğ
NULL
 &&İ->
nÙebook
 != NULL);

182 
	`š™_icÚs
(
tİ
);

183 
	`g_objeù_£t_d©a
(
	`G_OBJECT
(
tİ
->
w
), "toplevel",op);

184 
	`gtk_widg‘_show
(
	`GTK_WIDGET
(
tİ
->
w
));

185 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
(
tİ
->
nÙebook
), "sw™ch-·ge", 
	`G_CALLBACK
(
tİËv–_Ú_sw™ch_·ge
),op);

189 ià((
tİ
->
fšd
 = 
	`fšd_dŸlog_ü—‹
Ñİ)è=ğ
NULL
 ||

190 (
tİ
->
´og»ss
 = 
	`´og»ss_ü—‹
Ñİ)è=ğ
NULL
 || (tİ->
»suÉs
 = 
	`»suÉs_ü—‹
(top)) == NULL) {

191 
”rÜ
 = 
”ºo
;

192 
ş—nup
;

194 
i
 = 
SEDIFFX_POLICY_ORIG
; i < 
SEDIFFX_POLICY_NUM
; i++) {

195 ià((
tİ
->
v›ws
[
i
] = 
	`pŞicy_v›w_ü—‹
Ñİ, i)è=ğ
NULL
) {

196 
	`årštf
(
¡d”r
, "%s\n", 
	`¡»¼Ü
(
”ºo
));

197 
”rÜ
 = 
”ºo
;

198 
ş—nup
;

202 
	`gÏde_xml_sigÇl_autocÚÃù
(
tİ
->
xml
);

204 
ş—nup
:

205 ià(
”rÜ
 != 0) {

206 
	`tİËv–_de¡roy
(&
tİ
);

207 
”ºo
 = 
”rÜ
;

208  
NULL
;

210  
tİ
;

211 
	}
}

213 
	$tİËv–_de¡roy
(
tİËv–_t
 ** 
tİ
)

215 ià(
tİ
 !ğ
NULL
 && *top != NULL) {

216 
£diffx_pŞicy_e
 
i
;

217 
	`fšd_dŸlog_de¡roy
(&(*
tİ
)->
fšd
);

218 
	`´og»ss_de¡roy
(&(*
tİ
)->
´og»ss
);

219 
	`»suÉs_de¡roy
(&(*
tİ
)->
»suÉs
);

220 
i
 = 
SEDIFFX_POLICY_ORIG
; i < 
SEDIFFX_POLICY_NUM
; i++) {

221 
	`pŞicy_v›w_de¡roy
(&(*
tİ
)->
v›ws
[
i
]);

223 
	`ä“
((*
tİ
)->
xml_f’ame
);

224 
	`ä“
(*
tİ
);

225 *
tİ
 = 
NULL
;

227 
	}
}

229 
	spŞicy_run_d©um


231 
tİËv–_t
 *
	mtİ
;

232 
­Ş_pŞicy_·th_t
 *
	m·ths
[2];

233 
­Ş_pŞicy_t
 *
	mpŞic›s
[2];

234 
	m»suÉ
;

244 
gpoš‹r
 
	$tİËv–_İ’_pŞicy_ruÂ”
(
gpoš‹r
 
d©a
)

246 
pŞicy_run_d©um
 *
run
 = (pŞicy_run_d©um *)
d©a
;

247 
£diffx_pŞicy_e
 
i
;

248 
i
 = 
SEDIFFX_POLICY_ORIG
; i < 
SEDIFFX_POLICY_NUM
; i++) {

249 
­Ş_pŞicy_·th_t
 *
·th
 = 
run
->
·ths
[
i
];

250 *
t™Ë
 = 
	`ut_pŞicy_·th_to_¡ršg
(
·th
);

251 ià(
t™Ë
 =ğ
NULL
) {

252 
run
->
»suÉ
 = -1;

253 
	`´og»ss_abÜt
(
run
->
tİ
->
´og»ss
, "%s", 
	`¡»¼Ü
(
”ºo
));

254  
NULL
;

256 
	`´og»ss_upd©e
(
run
->
tİ
->
´og»ss
, "O³nšg %s", 
t™Ë
);

257 
	`ä“
(
t™Ë
);

258 
run
->
pŞic›s
[
i
] =

259 
	`­Ş_pŞicy_ü—‹_äom_pŞicy_·th
(
·th
, 
QPOL_POLICY_OPTION_NO_RULES
, 
´og»ss_­Ş_hªdË_func
,

260 
run
->
tİ
->
´og»ss
);

262 ià(
run
->
pŞic›s
[
i
] =ğ
NULL
) {

263 
run
->
»suÉ
 = -1;

264 
	`´og»ss_abÜt
(
run
->
tİ
->
´og»ss
, 
NULL
);

265  
NULL
;

268 
run
->
»suÉ
 = 0;

269 
	`´og»ss_dÚe
(
run
->
tİ
->
´og»ss
);

270  
NULL
;

271 
	}
}

273 
	$tİËv–_İ’_pŞic›s
(
tİËv–_t
 * 
tİ
, 
­Ş_pŞicy_·th_t
 * 
Üig_·th
,‡pŞ_pŞicy_·th_ˆ* 
mod_·th
)

275 
pŞicy_run_d©um
 
run
;

276 
	`mem£t
(&
run
, 0, (run));

277 
run
.
tİ
 =op;

278 
run
.
·ths
[0] = 
Üig_·th
;

279 
run
.
·ths
[1] = 
mod_·th
;

280 
£diffx_pŞicy_e
 
i
;

282 
	`ut_cursÜ_wa™
(
	`GTK_WIDGET
(
tİ
->
w
));

283 
	`´og»ss_show
(
tİ
->
´og»ss
, "Loading Policies");

284 
	`g_th»ad_ü—‹
(
tİËv–_İ’_pŞicy_ruÂ”
, &
run
, 
FALSE
, 
NULL
);

285 
	`´og»ss_wa™
(
tİ
->
´og»ss
);

286 
	`´og»ss_hide
(
tİ
->
´og»ss
);

287 
	`ut_cursÜ_ş—r
(
	`GTK_WIDGET
(
tİ
->
w
));

288 ià(
run
.
»suÉ
 < 0) {

289 
	`­Ş_pŞicy_·th_de¡roy
(&
run
.
·ths
[0]);

290 
	`­Ş_pŞicy_·th_de¡roy
(&
run
.
·ths
[1]);

291  
run
.
»suÉ
;

293 ià(
	`»m­_ty³s_upd©e
(
run
.
pŞic›s
[
SEDIFFX_POLICY_ORIG
],„un.pŞic›s[
SEDIFFX_POLICY_MOD
]) < 0) {

294 
	`tİËv–_ERR
(
tİ
, "%s", 
	`¡»¼Ü
(
”ºo
));

295 
	`­Ş_pŞicy_·th_de¡roy
(&
run
.
·ths
[0]);

296 
	`­Ş_pŞicy_·th_de¡roy
(&
run
.
·ths
[1]);

299 
	`»suÉs_İ’_pŞic›s
(
tİ
->
»suÉs
, 
run
.
pŞic›s
[
SEDIFFX_POLICY_ORIG
],„un.pŞic›s[
SEDIFFX_POLICY_MOD
]);

300 
i
 = 
SEDIFFX_POLICY_ORIG
; i < 
SEDIFFX_POLICY_NUM
; i++) {

301 
	`pŞicy_v›w_upd©e
(
tİ
->
v›ws
[
i
], 
run
.
pŞic›s
[i],„un.
·ths
[i]);

302 
	`£diffx_£t_pŞicy
(
tİ
->
s
, 
i
, 
run
.
pŞic›s
[i],„un.
·ths
[i]);

304 
	`»suÉs_upd©e
(
tİ
->
»suÉs
);

305 
	`tİËv–_’abË_pŞicy_™ems
(
tİ
, 
TRUE
);

306 
	`tİËv–_upd©e_t™Ë_b¬
(
tİ
);

308 
	}
}

310 
	srun_d©um


312 
tİËv–_t
 *
	mtİ
;

313 
ušt32_t
 
	mrun_æags
;

314 
	m»suÉ
;

317 
gpoš‹r
 
	$tİËv–_run_diff_ruÂ”
(
gpoš‹r
 
d©a
)

319 
run_d©um
 *
run
 = 
d©a
;

320 
pŞdiff_t
 *
diff
 = 
	`£diffx_g‘_pŞdiff
(
run
->
tİ
->
s
, 
´og»ss_pŞdiff_hªdË_func
,„un->tİ->
´og»ss
);

321 ià(
diff
 =ğ
NULL
) {

322 
run
->
»suÉ
 = -1;

323 
	`´og»ss_abÜt
(
run
->
tİ
->
´og»ss
, "Could‚Ù g‘‡…Şdifàobjeù: %s", 
	`¡»¼Ü
(
”ºo
));

324  
NULL
;

326 
run
->
»suÉ
 = 
	`pŞdiff_run
(
diff
,„un->
run_æags
);

327 
	`£diffx_£t_pŞdiff_run_æags
(
run
->
tİ
->
s
,„un->
run_æags
);

328 ià(
run
->
run_æags
 & (
POLDIFF_DIFF_AVRULES
 | 
POLDIFF_DIFF_TERULES
)) {

329 
	`pŞdiff_’abË_lše_numb”s
(
diff
);

331 ià(
run
->
»suÉ
 < 0) {

332 
	`´og»ss_abÜt
(
run
->
tİ
->
´og»ss
, 
NULL
);

334 
	`´og»ss_dÚe
(
run
->
tİ
->
´og»ss
);

336  
NULL
;

337 
	}
}

339 
	$tİËv–_run_diff
(
tİËv–_t
 * 
tİ
)

341 
run_d©um
 
r
;

343 
r
.
run_æags
 = 
	`£Ëù_diff_dŸlog_run
(
tİ
);

344 ià(
r
.
run_æags
 == 0) {

347 
r
.
tİ
 =op;

348 
r
.
»suÉ
 = 0;

350 
	`»suÉs_ş—r
(
tİ
->
»suÉs
);

351 
	`ut_cursÜ_wa™
(
	`GTK_WIDGET
(
tİ
->
w
));

352 
	`´og»ss_show
(
tİ
->
´og»ss
, "Running Diff");

353 
	`g_th»ad_ü—‹
(
tİËv–_run_diff_ruÂ”
, &
r
, 
FALSE
, 
NULL
);

354 
	`´og»ss_wa™
(
tİ
->
´og»ss
);

355 
	`´og»ss_hide
(
tİ
->
´og»ss
);

356 
	`ut_cursÜ_ş—r
(
	`GTK_WIDGET
(
tİ
->
w
));

357 ià(
r
.
»suÉ
 == 0) {

358 
	`»suÉs_upd©e
(
tİ
->
»suÉs
);

360 
	}
}

362 
	$tİËv–_show_pŞicy_lše
(
tİËv–_t
 * 
tİ
, 
£diffx_pŞicy_e
 
which
, 
lše
)

364 
	`gtk_nÙebook_£t_cu¼’t_·ge
(
tİ
->
nÙebook
, 1 + 
which
);

365 
	`pŞicy_v›w_show_pŞicy_lše
(
tİ
->
v›ws
[
which
], 
lše
);

366 
	}
}

368 
	$tİËv–_£t_sÜt_m’u_£ns™iv™y
(
tİËv–_t
 * 
tİ
, 
gboŞ—n
 
£ns
)

370 
GtkWidg‘
 *
w
 = 
	`gÏde_xml_g‘_widg‘
(
tİ
->
xml
, "sort menu item");

371 
	`as£¹
(
w
 !ğ
NULL
);

372 
	`gtk_widg‘_£t_£ns™ive
(
w
, 
£ns
);

373 
	}
}

375 
	$tİËv–_£t_sÜt_m’u_£ËùiÚ
(
tİËv–_t
 * 
tİ
, 
»suÉs_sÜt_e
 
f›ld
, 
»suÉs_sÜt_dœ_e
 
dœ
)

377 cÚ¡ *
m’u_™ems
[][2] = {

384 
dœeùiÚ
 = 1;

385 ià(
dœ
 =ğ
RESULTS_SORT_ASCEND
) {

386 
dœeùiÚ
 = 0;

388 
GtkWidg‘
 *
w
 = 
	`gÏde_xml_g‘_widg‘
(
tİ
->
xml
, 
m’u_™ems
[
f›ld
][
dœeùiÚ
]);

389 
	`as£¹
(
w
 !ğ
NULL
);

390 
	`gtk_check_m’u_™em_£t_aùive
(
	`GTK_CHECK_MENU_ITEM
(
w
), 
TRUE
);

391 
	}
}

393 *
	$tİËv–_g‘_gÏde_xml
(
tİËv–_t
 * 
tİ
)

395  
tİ
->
xml_f’ame
;

396 
	}
}

398 
gšt
 
	$tİËv–_g‘_nÙebook_·ge
(
tİËv–_t
 * 
tİ
)

400  
	`gtk_nÙebook_g‘_cu¼’t_·ge
(
tİ
->
nÙebook
);

401 
	}
}

403 
´og»ss_t
 *
	$tİËv–_g‘_´og»ss
(
tİËv–_t
 * 
tİ
)

405  
tİ
->
´og»ss
;

406 
	}
}

408 
GtkWšdow
 *
	$tİËv–_g‘_wšdow
(
tİËv–_t
 * 
tİ
)

410  
tİ
->
w
;

411 
	}
}

413 
GtkTextV›w
 *
	$tİËv–_g‘_‹xt_v›w
(
tİËv–_t
 * 
tİ
)

415 
gšt
 
·g’um
 = 
	`gtk_nÙebook_g‘_cu¼’t_·ge
(
tİ
->
nÙebook
);

416 
·g’um
) {

418  
	`»suÉs_g‘_‹xt_v›w
(
tİ
->
»suÉs
);

420  
	`pŞicy_v›w_g‘_‹xt_v›w
(
tİ
->
v›ws
[
SEDIFFX_POLICY_ORIG
]);

422  
	`pŞicy_v›w_g‘_‹xt_v›w
(
tİ
->
v›ws
[
SEDIFFX_POLICY_MOD
]);

425 
	`as£¹
(0);

426  
NULL
;

427 
	}
}

429 
pŞdiff_t
 *
	$tİËv–_g‘_pŞdiff
(
tİËv–_t
 * 
tİ
)

431  
	`£diffx_g‘_pŞdiff
(
tİ
->
s
, 
´og»ss_pŞdiff_hªdË_func
,İ->
´og»ss
);

432 
	}
}

434 
ušt32_t
 
	$tİËv–_g‘_pŞdiff_run_æags
(
tİËv–_t
 * 
tİ
)

436  
	`£diffx_g‘_pŞdiff_run_æags
(
tİ
->
s
);

437 
	}
}

448 
	$tİËv–_mes§ge
(
tİËv–_t
 * 
tİ
, 
GtkMes§geTy³
 
msg_ty³
, cÚ¡ *
fmt
, 
va_li¡
 
­
)

450 
GtkWidg‘
 *
dŸlog
;

451 *
msg
;

452 ià(
	`va¥rštf
(&
msg
, 
fmt
, 
­
) < 0) {

453 
	`ERR
(
NULL
, "%s", 
	`¡»¼Ü
(
”ºo
));

456 
dŸlog
 = 
	`gtk_mes§ge_dŸlog_Ãw
(
tİ
->
w
, 
GTK_DIALOG_DESTROY_WITH_PARENT
, 
msg_ty³
, 
GTK_BUTTONS_CLOSE
, 
msg
);

457 
	`ä“
(
msg
);

458 
	`gtk_dŸlog_run
(
	`GTK_DIALOG
(
dŸlog
));

459 
	`gtk_widg‘_de¡roy
(
dŸlog
);

460 
	}
}

462 
	$tİËv–_ERR
(
tİËv–_t
 * 
tİ
, cÚ¡ *
fÜm©
, ...)

464 
	`va_li¡
(
­
);

465 
	`va_¡¬t
(
­
, 
fÜm©
);

466 
	`tİËv–_mes§ge
(
tİ
, 
GTK_MESSAGE_ERROR
, 
fÜm©
, 
­
);

467 
	`va_’d
(
­
);

468 
	}
}

470 
	$tİËv–_WARN
(
tİËv–_t
 * 
tİ
, cÚ¡ *
fÜm©
, ...)

472 
	`va_li¡
(
­
);

473 
	`va_¡¬t
(
­
, 
fÜm©
);

474 
	`tİËv–_mes§ge
(
tİ
, 
GTK_MESSAGE_WARNING
, 
fÜm©
, 
­
);

475 
	`va_’d
(
­
);

476 
	}
}

480 
tİËv–_Ú_İ’_aùiv©e
(
gpoš‹r
 
u£r_d©a
, 
GtkM’uI‹m
 * 
widg‘
 
__©Œibu‹__
 ((
unu£d
)))

482 
tİËv–_t
 *
	gtİ
 = 
g_objeù_g‘_d©a
(
G_OBJECT
(
u£r_d©a
), "toplevel");

483 cÚ¡ 
­Ş_pŞicy_·th_t
 *
	gÜig_·th
 = 
£diffx_g‘_pŞicy_·th
(
tİ
->
s
, 
SEDIFFX_POLICY_ORIG
);

484 cÚ¡ 
­Ş_pŞicy_·th_t
 *
	gmod_·th
 = 
£diffx_g‘_pŞicy_·th
(
tİ
->
s
, 
SEDIFFX_POLICY_MOD
);

485 
İ’_pŞic›s_dŸlog_run
(
tİ
, 
Üig_·th
, 
mod_·th
);

488 
tİËv–_Ú_qu™_aùiv©e
(
gpoš‹r
 
u£r_d©a
, 
GtkM’uI‹m
 * 
widg‘
 
__©Œibu‹__
 ((
unu£d
)))

490 
tİËv–_t
 *
	gtİ
 = 
g_objeù_g‘_d©a
(
G_OBJECT
(
u£r_d©a
), "toplevel");

491 
	gtİ
->
	gw
 = 
NULL
;

492 
gtk_maš_qu™
();

495 
tİËv–_Ú_ed™_m’u_aùiv©e
(
gpoš‹r
 
u£r_d©a
, 
GtkM’uI‹m
 * 
widg‘
 
__©Œibu‹__
 ((
unu£d
)))

497 
tİËv–_t
 *
	gtİ
 = 
g_objeù_g‘_d©a
(
G_OBJECT
(
u£r_d©a
), "toplevel");

498 
GtkTextV›w
 *
	gv›w
 = 
tİËv–_g‘_‹xt_v›w
(
tİ
);

499 
GtkTextBufãr
 *
	gtxt
 = 
gtk_‹xt_v›w_g‘_bufãr
(
v›w
);

500 
GtkWidg‘
 *
	gcİy
 = 
gÏde_xml_g‘_widg‘
(
tİ
->
xml
, "Copy");

501 
GtkWidg‘
 *
	g£Ëù_®l
 = 
gÏde_xml_g‘_widg‘
(
tİ
->
xml
, "Select All");

502 
GtkTextI‹r
 
	g¡¬t
, 
	g’d
;

503 
as£¹
(
cİy
 !ğ
NULL
 && 
£Ëù_®l
 != NULL);

507 ià(
gtk_‹xt_bufãr_g‘_£ËùiÚ_bounds
(
txt
, &
¡¬t
, &
’d
)) {

508 
gtk_widg‘_£t_£ns™ive
(
cİy
, 
TRUE
);

510 
gtk_widg‘_£t_£ns™ive
(
cİy
, 
FALSE
);

514 
gtk_‹xt_bufãr_g‘_¡¬t_™”
(
txt
, &
¡¬t
);

515 
gtk_‹xt_bufãr_g‘_’d_™”
(
txt
, &
’d
);

516 ià(
gtk_‹xt_™”_g‘_off£t
(&
¡¬t
è=ğgtk_‹xt_™”_g‘_off£t(&
’d
)) {

517 
gtk_widg‘_£t_£ns™ive
(
£Ëù_®l
, 
FALSE
);

519 
gtk_widg‘_£t_£ns™ive
(
£Ëù_®l
, 
TRUE
);

523 
tİËv–_Ú_cİy_aùiv©e
(
gpoš‹r
 
u£r_d©a
, 
GtkM’uI‹m
 * 
widg‘
 
__©Œibu‹__
 ((
unu£d
)))

525 
tİËv–_t
 *
	gtİ
 = 
g_objeù_g‘_d©a
(
G_OBJECT
(
u£r_d©a
), "toplevel");

526 
GtkClbßrd
 *
	gşbßrd
 = 
gtk_şbßrd_g‘
(
NULL
);

527 
GtkTextV›w
 *
	gv›w
 = 
tİËv–_g‘_‹xt_v›w
(
tİ
);

528 
GtkTextBufãr
 *
	gtxt
 = 
gtk_‹xt_v›w_g‘_bufãr
(
v›w
);

529 ià(
gtk_‹xt_bufãr_g‘_£ËùiÚ_bounds
(
txt
, 
NULL
, NULL)) {

530 
gtk_‹xt_bufãr_cİy_şbßrd
(
txt
, 
şbßrd
);

534 
tİËv–_Ú_£Ëù_®l_aùiv©e
(
gpoš‹r
 
u£r_d©a
, 
GtkM’uI‹m
 * 
widg‘
 
__©Œibu‹__
 ((
unu£d
)))

536 
tİËv–_t
 *
	gtİ
 = 
g_objeù_g‘_d©a
(
G_OBJECT
(
u£r_d©a
), "toplevel");

537 
GtkTextV›w
 *
	gv›w
 = 
tİËv–_g‘_‹xt_v›w
(
tİ
);

538 
GtkTextBufãr
 *
	gtxt
 = 
gtk_‹xt_v›w_g‘_bufãr
(
v›w
);

539 
GtkTextI‹r
 
	g¡¬t
, 
	g’d
;

540 
gtk_‹xt_bufãr_g‘_¡¬t_™”
(
txt
, &
¡¬t
);

541 
gtk_‹xt_bufãr_g‘_’d_™”
(
txt
, &
’d
);

542 
gtk_‹xt_bufãr_£Ëù_¿nge
(
txt
, &
¡¬t
, &
’d
);

545 
tİËv–_Ú_fšd_aùiv©e
(
gpoš‹r
 
u£r_d©a
, 
GtkM’uI‹m
 * 
widg‘
 
__©Œibu‹__
 ((
unu£d
)))

547 
tİËv–_t
 *
	gtİ
 = 
g_objeù_g‘_d©a
(
G_OBJECT
(
u£r_d©a
), "toplevel");

548 
fšd_dŸlog_show
(
tİ
->
fšd
);

551 
tİËv–_Ú_run_diff_aùiv©e
(
gpoš‹r
 
u£r_d©a
, 
GtkM’uI‹m
 * 
widg‘
 
__©Œibu‹__
 ((
unu£d
)))

553 
tİËv–_t
 *
	gtİ
 = 
g_objeù_g‘_d©a
(
G_OBJECT
(
u£r_d©a
), "toplevel");

554 
tİËv–_run_diff
(
tİ
);

557 
tİËv–_Ú_»m­_ty³s_aùiv©e
(
gpoš‹r
 
u£r_d©a
, 
GtkM’uI‹m
 * 
widg‘
 
__©Œibu‹__
 ((
unu£d
)))

559 
tİËv–_t
 *
	gtİ
 = 
g_objeù_g‘_d©a
(
G_OBJECT
(
u£r_d©a
), "toplevel");

560 
»m­_ty³s_run
(
tİ
);

563 
	$tİËv–_Ú_deçuÉ_sÜt_aùiv©e
(
gpoš‹r
 
u£r_d©a
, 
GtkM’uI‹m
 * 
m’u™em
)

565 
tİËv–_t
 *
tİ
 = 
	`g_objeù_g‘_d©a
(
	`G_OBJECT
(
u£r_d©a
), "toplevel");

566 ià(
	`gtk_check_m’u_™em_g‘_aùive
(
	`GTK_CHECK_MENU_ITEM
(
m’u™em
))) {

567 
	`»suÉs_sÜt
(
tİ
->
»suÉs
, 
RESULTS_SORT_DEFAULT
, 
RESULTS_SORT_ASCEND
);

569 
	}
}

571 
	$tİËv–_Ú_sourû_ty³_asc_aùiv©e
(
gpoš‹r
 
u£r_d©a
, 
GtkM’uI‹m
 * 
m’u™em
)

573 
tİËv–_t
 *
tİ
 = 
	`g_objeù_g‘_d©a
(
	`G_OBJECT
(
u£r_d©a
), "toplevel");

574 ià(
	`gtk_check_m’u_™em_g‘_aùive
(
	`GTK_CHECK_MENU_ITEM
(
m’u™em
))) {

575 
	`»suÉs_sÜt
(
tİ
->
»suÉs
, 
RESULTS_SORT_SOURCE
, 
RESULTS_SORT_ASCEND
);

577 
	}
}

579 
	$tİËv–_Ú_sourû_ty³_des_aùiv©e
(
gpoš‹r
 
u£r_d©a
, 
GtkM’uI‹m
 * 
m’u™em
)

581 
tİËv–_t
 *
tİ
 = 
	`g_objeù_g‘_d©a
(
	`G_OBJECT
(
u£r_d©a
), "toplevel");

582 ià(
	`gtk_check_m’u_™em_g‘_aùive
(
	`GTK_CHECK_MENU_ITEM
(
m’u™em
))) {

583 
	`»suÉs_sÜt
(
tİ
->
»suÉs
, 
RESULTS_SORT_SOURCE
, 
RESULTS_SORT_DESCEND
);

585 
	}
}

587 
	$tİËv–_Ú_rg‘_ty³_asc_aùiv©e
(
gpoš‹r
 
u£r_d©a
, 
GtkM’uI‹m
 * 
m’u™em
)

589 
tİËv–_t
 *
tİ
 = 
	`g_objeù_g‘_d©a
(
	`G_OBJECT
(
u£r_d©a
), "toplevel");

590 ià(
	`gtk_check_m’u_™em_g‘_aùive
(
	`GTK_CHECK_MENU_ITEM
(
m’u™em
))) {

591 
	`»suÉs_sÜt
(
tİ
->
»suÉs
, 
RESULTS_SORT_TARGET
, 
RESULTS_SORT_ASCEND
);

593 
	}
}

595 
	$tİËv–_Ú_rg‘_ty³_des_aùiv©e
(
gpoš‹r
 
u£r_d©a
, 
GtkM’uI‹m
 * 
m’u™em
)

597 
tİËv–_t
 *
tİ
 = 
	`g_objeù_g‘_d©a
(
	`G_OBJECT
(
u£r_d©a
), "toplevel");

598 ià(
	`gtk_check_m’u_™em_g‘_aùive
(
	`GTK_CHECK_MENU_ITEM
(
m’u™em
))) {

599 
	`»suÉs_sÜt
(
tİ
->
»suÉs
, 
RESULTS_SORT_TARGET
, 
RESULTS_SORT_DESCEND
);

601 
	}
}

603 
	$tİËv–_Ú_şass_asc_aùiv©e
(
gpoš‹r
 
u£r_d©a
, 
GtkM’uI‹m
 * 
m’u™em
)

605 
tİËv–_t
 *
tİ
 = 
	`g_objeù_g‘_d©a
(
	`G_OBJECT
(
u£r_d©a
), "toplevel");

606 ià(
	`gtk_check_m’u_™em_g‘_aùive
(
	`GTK_CHECK_MENU_ITEM
(
m’u™em
))) {

607 
	`»suÉs_sÜt
(
tİ
->
»suÉs
, 
RESULTS_SORT_CLASS
, 
RESULTS_SORT_ASCEND
);

609 
	}
}

611 
	$tİËv–_Ú_şass_des_aùiv©e
(
gpoš‹r
 
u£r_d©a
, 
GtkM’uI‹m
 * 
m’u™em
)

613 
tİËv–_t
 *
tİ
 = 
	`g_objeù_g‘_d©a
(
	`G_OBJECT
(
u£r_d©a
), "toplevel");

614 ià(
	`gtk_check_m’u_™em_g‘_aùive
(
	`GTK_CHECK_MENU_ITEM
(
m’u™em
))) {

615 
	`»suÉs_sÜt
(
tİ
->
»suÉs
, 
RESULTS_SORT_CLASS
, 
RESULTS_SORT_DESCEND
);

617 
	}
}

619 
	$tİËv–_Ú_cÚd™iÚ®_asc_aùiv©e
(
gpoš‹r
 
u£r_d©a
, 
GtkM’uI‹m
 * 
m’u™em
)

621 
tİËv–_t
 *
tİ
 = 
	`g_objeù_g‘_d©a
(
	`G_OBJECT
(
u£r_d©a
), "toplevel");

622 ià(
	`gtk_check_m’u_™em_g‘_aùive
(
	`GTK_CHECK_MENU_ITEM
(
m’u™em
))) {

623 
	`»suÉs_sÜt
(
tİ
->
»suÉs
, 
RESULTS_SORT_COND
, 
RESULTS_SORT_ASCEND
);

625 
	}
}

627 
	$tİËv–_Ú_cÚd™iÚ®_des_aùiv©e
(
gpoš‹r
 
u£r_d©a
, 
GtkM’uI‹m
 * 
m’u™em
)

629 
tİËv–_t
 *
tİ
 = 
	`g_objeù_g‘_d©a
(
	`G_OBJECT
(
u£r_d©a
), "toplevel");

630 ià(
	`gtk_check_m’u_™em_g‘_aùive
(
	`GTK_CHECK_MENU_ITEM
(
m’u™em
))) {

631 
	`»suÉs_sÜt
(
tİ
->
»suÉs
, 
RESULTS_SORT_COND
, 
RESULTS_SORT_DESCEND
);

633 
	}
}

635 
tİËv–_Ú_h–p_aùiv©e
(
gpoš‹r
 
u£r_d©a
, 
GtkM’uI‹m
 * 
widg‘
 
__©Œibu‹__
 ((
unu£d
)))

637 
tİËv–_t
 *
	gtİ
 = 
g_objeù_g‘_d©a
(
G_OBJECT
(
u£r_d©a
), "toplevel");

638 
GtkWidg‘
 *
	gwšdow
;

639 
GtkWidg‘
 *
	gsüŞl
;

640 
GtkWidg‘
 *
	g‹xt_v›w
;

641 
GtkTextBufãr
 *
	gbufãr
;

642 *
	gh–p_‹xt
 = 
NULL
;

643 
size_t
 
	gËn
;

644 
	g¹
;

645 *
	gdœ
;

647 
	gwšdow
 = 
gtk_dŸlog_Ãw_w™h_bu‰Ús
("sediffx Help",

648 
GTK_WINDOW
(
tİ
->
w
),

649 
GTK_DIALOG_DESTROY_WITH_PARENT
, 
GTK_STOCK_CLOSE
, 
GTK_RESPONSE_CLOSE
, 
NULL
);

650 
gtk_dŸlog_£t_deçuÉ_»¥Ú£
(
GTK_DIALOG
(
wšdow
), 
GTK_RESPONSE_CLOSE
);

651 
g_sigÇl_cÚÃù_sw­³d
(
wšdow
, "»¥Ú£", 
G_CALLBACK
(
gtk_widg‘_de¡roy
), window);

652 
	gsüŞl
 = 
gtk_süŞËd_wšdow_Ãw
(
NULL
, NULL);

653 
	g‹xt_v›w
 = 
gtk_‹xt_v›w_Ãw
();

654 
gtk_wšdow_£t_deçuÉ_size
(
GTK_WINDOW
(
wšdow
), 520, 300);

655 
gtk_cÚš”_add
(
GTK_CONTAINER
(
GTK_DIALOG
(
wšdow
)->
vbox
), 
süŞl
);

656 
gtk_cÚš”_add
(
GTK_CONTAINER
(
süŞl
), 
‹xt_v›w
);

657 
gtk_‹xt_v›w_£t_w¿p_mode
(
GTK_TEXT_VIEW
(
‹xt_v›w
), 
GTK_WRAP_NONE
);

658 
	gbufãr
 = 
gtk_‹xt_v›w_g‘_bufãr
(
GTK_TEXT_VIEW
(
‹xt_v›w
));

659 ià((
	gdœ
 = 
­Ş_fe_fšd_·th
("£diff_h–p.txt")è=ğ
NULL
) {

660 
tİËv–_ERR
(
tİ
, "Cannot find help file.");

663 
	g¹
 = 
­Ş_fe_»ad_to_bufãr
(
dœ
, &
h–p_‹xt
, &
Ën
);

664 
ä“
(
dœ
);

665 ià(
	g¹
 != 0) {

666 
ä“
(
h–p_‹xt
);

669 
gtk_‹xt_bufãr_£t_‹xt
(
bufãr
, 
h–p_‹xt
, 
Ën
);

670 
gtk_‹xt_v›w_£t_ed™abË
(
GTK_TEXT_VIEW
(
‹xt_v›w
), 
FALSE
);

671 
gtk_wšdow_£t_pos™iÚ
(
GTK_WINDOW
(
wšdow
), 
GTK_WIN_POS_CENTER_ON_PARENT
);

672 
gtk_widg‘_show
(
‹xt_v›w
);

673 
gtk_widg‘_show
(
süŞl
);

674 
gtk_widg‘_show
(
wšdow
);

677 
tİËv–_Ú_about_£diffx_aùiv©e
(
gpoš‹r
 
u£r_d©a
, 
GtkM’uI‹m
 * 
widg‘
 
__©Œibu‹__
 ((
unu£d
)))

679 
tİËv–_t
 *
	gtİ
 = 
g_objeù_g‘_d©a
(
G_OBJECT
(
u£r_d©a
), "toplevel");

680 #ifdeà
GTK_2_8


681 
gtk_show_about_dŸlog
(
tİ
->
w
,

683 "cİyright", 
COPYRIGHT_INFO
,

684 "Çme", "£diffx", "v”siÚ", 
VERSION
, "webs™e", "h‰p://oss.Œesys.com/´ojeùs/£toŞs", 
NULL
);

686 
GtkWidg‘
 *
	gw
 = 
gtk_mes§ge_dŸlog_Ãw
(
tİ
->
w
,

687 
GTK_DIALOG_DESTROY_WITH_PARENT
,

688 
GTK_MESSAGE_INFO
,

689 
GTK_BUTTONS_CLOSE
,

691 "£diffx", 
VERSION
,

693 
COPYRIGHT_INFO
,

695 
gtk_dŸlog_run
(
GTK_DIALOG
(
w
));

696 
gtk_widg‘_de¡roy
(
w
);

700 
tİËv–_Ú_İ’_pŞic›s_bu‰Ú_şick
(
gpoš‹r
 
u£r_d©a
, 
GtkWidg‘
 * 
widg‘
 
__©Œibu‹__
 ((
unu£d
)), 
GdkEv’t
 * 
ev’t


701 
__©Œibu‹__
 ((
unu£d
)))

703 
tİËv–_t
 *
	gtİ
 = 
g_objeù_g‘_d©a
(
G_OBJECT
(
u£r_d©a
), "toplevel");

704 cÚ¡ 
­Ş_pŞicy_·th_t
 *
	gÜig_·th
 = 
£diffx_g‘_pŞicy_·th
(
tİ
->
s
, 
SEDIFFX_POLICY_ORIG
);

705 cÚ¡ 
­Ş_pŞicy_·th_t
 *
	gmod_·th
 = 
£diffx_g‘_pŞicy_·th
(
tİ
->
s
, 
SEDIFFX_POLICY_MOD
);

706 
İ’_pŞic›s_dŸlog_run
(
tİ
, 
Üig_·th
, 
mod_·th
);

709 
tİËv–_Ú_run_diff_bu‰Ú_şick
(
gpoš‹r
 
u£r_d©a
, 
GtkWidg‘
 * 
widg‘
 
__©Œibu‹__
 ((
unu£d
)), 
GdkEv’t
 * 
ev’t


710 
__©Œibu‹__
 ((
unu£d
)))

712 
tİËv–_t
 *
	gtİ
 = 
g_objeù_g‘_d©a
(
G_OBJECT
(
u£r_d©a
), "toplevel");

713 
tİËv–_run_diff
(
tİ
);

716 
tİËv–_Ú_»m­_ty³s_bu‰Ú_şick
(
gpoš‹r
 
u£r_d©a
, 
GtkWidg‘
 * 
widg‘
 
__©Œibu‹__
 ((
unu£d
)), 
GdkEv’t
 * 
ev’t


717 
__©Œibu‹__
 ((
unu£d
)))

719 
tİËv–_t
 *
	gtİ
 = 
g_objeù_g‘_d©a
(
G_OBJECT
(
u£r_d©a
), "toplevel");

720 
»m­_ty³s_run
(
tİ
);

723 
tİËv–_Ú_de¡roy
(
gpoš‹r
 
u£r_d©a
, 
GtkObjeù
 * 
objeù
 
__©Œibu‹__
 ((
unu£d
)))

725 
tİËv–_t
 *
	gtİ
 = 
g_objeù_g‘_d©a
(
G_OBJECT
(
u£r_d©a
), "toplevel");

726 
	gtİ
->
	gw
 = 
NULL
;

727 
gtk_maš_qu™
();

	@sediff/toplevel.h

27 #iâdeà
TOPLEVEL_H


28 
	#TOPLEVEL_H


	)

30 
tİËv–
 
	ttİËv–_t
;

32 
	~"´og»ss.h
"

33 
	~"»suÉs.h
"

34 
	~"£diffx.h
"

35 
	~<­Ş/pŞicy-·th.h
>

36 
	~<gtk/gtk.h
>

37 
	~<pŞdiff/pŞdiff.h
>

49 
tİËv–_t
 *
tİËv–_ü—‹
(
£diffx_t
 * 
s
);

59 
tİËv–_de¡roy
(
tİËv–_t
 ** 
tİ
);

73 
tİËv–_İ’_pŞic›s
(
tİËv–_t
 * 
tİ
, 
­Ş_pŞicy_·th_t
 * 
Üig_·th
,‡pŞ_pŞicy_·th_ˆ* 
mod_·th
);

81 
tİËv–_run_diff
(
tİËv–_t
 * 
tİ
);

92 
tİËv–_show_pŞicy_lše
(
tİËv–_t
 * 
tİ
, 
£diffx_pŞicy_e
 
which
, 
lše
);

102 
tİËv–_£t_sÜt_m’u_£ns™iv™y
(
tİËv–_t
 * 
tİ
, 
gboŞ—n
 
£ns
);

112 
tİËv–_£t_sÜt_m’u_£ËùiÚ
(
tİËv–_t
 * 
tİ
, 
»suÉs_sÜt_e
 
f›ld
, 
»suÉs_sÜt_dœ_e
 
dœ
);

121 *
tİËv–_g‘_gÏde_xml
(
tİËv–_t
 * 
tİ
);

130 
gšt
 
tİËv–_g‘_nÙebook_·ge
(
tİËv–_t
 * 
tİ
);

140 
´og»ss_t
 *
tİËv–_g‘_´og»ss
(
tİËv–_t
 * 
tİ
);

150 
GtkWšdow
 *
tİËv–_g‘_wšdow
(
tİËv–_t
 * 
tİ
);

160 
GtkTextV›w
 *
tİËv–_g‘_‹xt_v›w
(
tİËv–_t
 * 
tİ
);

171 
pŞdiff_t
 *
tİËv–_g‘_pŞdiff
(
tİËv–_t
 * 
tİ
);

180 
ušt32_t
 
tİËv–_g‘_pŞdiff_run_æags
(
tİËv–_t
 * 
tİ
);

190 
	$tİËv–_ERR
(
tİËv–_t
 * 
tİ
, cÚ¡ *
fÜm©
, ...è
	`__©Œibu‹__
 ((
	`fÜm©
(
´štf
, 2, 3)));

200 
	$tİËv–_WARN
(
tİËv–_t
 * 
tİ
, cÚ¡ *
fÜm©
, ...è
	`__©Œibu‹__
 ((
	`fÜm©
(
´štf
, 2, 3)));

	@sediff/utilgui.c

25 
	~<cÚfig.h
>

27 
	~"utgui.h
"

28 
	~<¡ršg.h
>

29 
	~<­Ş/ut.h
>

31 
	$ut_mes§ge
(
GtkWšdow
 * 
·»Á
, 
GtkMes§geTy³
 
msg_ty³
, cÚ¡ *
msg
)

33 
GtkWidg‘
 *
dŸlog
;

34 
dŸlog
 = 
	`gtk_mes§ge_dŸlog_Ãw
(
·»Á
, 
GTK_DIALOG_DESTROY_WITH_PARENT
, 
msg_ty³
, 
GTK_BUTTONS_CLOSE
, 
msg
);

35 
	`gtk_dŸlog_run
(
	`GTK_DIALOG
(
dŸlog
));

36 
	`gtk_widg‘_de¡roy
(
dŸlog
);

37 
	}
}

39 
	$ut_cursÜ_wa™
(
GtkWidg‘
 * 
widg‘
)

41 
GdkCursÜ
 *
cursÜ
;

42 ià(
widg‘
->
wšdow
 !ğ
NULL
) {

43 
cursÜ
 = 
	`gdk_cursÜ_Ãw
(
GDK_WATCH
);

44 
	`gdk_wšdow_£t_cursÜ
(
widg‘
->
wšdow
, 
cursÜ
);

45 
	`gdk_cursÜ_uÄef
(
cursÜ
);

47 
	}
}

57 
gboŞ—n
 
	$poš‹r_»£t
(
gpoš‹r
 
d©a
)

59 
	`gdk_wšdow_£t_cursÜ
(
	`GTK_WIDGET
(
d©a
)->
wšdow
, 
NULL
);

60  
FALSE
;

61 
	}
}

63 
	$ut_cursÜ_ş—r
(
GtkWidg‘
 * 
widg‘
)

65 
	`g_idË_add
(&
poš‹r_»£t
, 
widg‘
);

66 
	}
}

68 
	$ut_‹xt_bufãr_ş—r
(
GtkTextBufãr
 * 
txt
)

70 
GtkTextI‹r
 
¡¬t
, 
’d
;

71 
	`gtk_‹xt_bufãr_g‘_¡¬t_™”
(
txt
, &
¡¬t
);

72 
	`gtk_‹xt_bufãr_g‘_’d_™”
(
txt
, &
’d
);

73 
	`gtk_‹xt_bufãr_»move_®l_gs
(
txt
, &
¡¬t
, &
’d
);

74 
	`gtk_‹xt_bufãr_d–‘e
(
txt
, &
¡¬t
, &
’d
);

75 
	}
}

77 
­Ş_veùÜ_t
 *
	$ut_İ’_fe
(
GtkWšdow
 * 
·»Á
, cÚ¡ *
t™Ë
, cÚ¡ *
š™_·th
, 
gboŞ—n
 
muÉË
)

79 
GtkWidg‘
 *
dŸlog
 = 
	`gtk_fe_choo£r_dŸlog_Ãw
(
t™Ë
, 
·»Á
, 
GTK_FILE_CHOOSER_ACTION_OPEN
, 
GTK_STOCK_CANCEL
,

80 
GTK_RESPONSE_CANCEL
,

81 
GTK_STOCK_OPEN
, 
GTK_RESPONSE_ACCEPT
, 
NULL
);

82 
­Ş_veùÜ_t
 *
·ths
 = 
NULL
;

83 ià(
š™_·th
 !ğ
NULL
) {

84 
	`gtk_fe_choo£r_£t_f’ame
(
	`GTK_FILE_CHOOSER
(
dŸlog
), 
š™_·th
);

86 
	`gtk_fe_choo£r_£t_£Ëù_muÉË
(
	`GTK_FILE_CHOOSER
(
dŸlog
), 
muÉË
);

87 ià(
	`gtk_dŸlog_run
(
	`GTK_DIALOG
(
dŸlog
)è=ğ
GTK_RESPONSE_ACCEPT
) {

88 
GSLi¡
 *
fes
 = 
	`gtk_fe_choo£r_g‘_f’ames
(
	`GTK_FILE_CHOOSER
(
dŸlog
));

89 
GSLi¡
 *
f
;

90 
·ths
 = 
	`­Ş_veùÜ_ü—‹
(
g_ä“
);

91 
f
 = 
fes
; f !ğ
NULL
; f = f->
Ãxt
) {

92 
	`­Ş_veùÜ_­³nd
(
·ths
, 
f
->
d©a
);

94 
	`g_¦i¡_ä“
(
fes
);

96 
	`gtk_widg‘_de¡roy
(
dŸlog
);

97  
·ths
;

98 
	}
}

100 *
	$ut_§ve_fe
(
GtkWšdow
 * 
·»Á
, cÚ¡ *
t™Ë
, cÚ¡ *
š™_·th
)

102 
GtkWidg‘
 *
dŸlog
 = 
	`gtk_fe_choo£r_dŸlog_Ãw
(
t™Ë
, 
·»Á
, 
GTK_FILE_CHOOSER_ACTION_SAVE
, 
GTK_STOCK_CANCEL
,

103 
GTK_RESPONSE_CANCEL
,

104 
GTK_STOCK_SAVE
, 
GTK_RESPONSE_ACCEPT
, 
NULL
);

105 *
·th
 = 
NULL
;

106 #ifdeà
GTK_2_8


107 
	`gtk_fe_choo£r_£t_do_ov”wr™e_cÚfœm©iÚ
(
	`GTK_FILE_CHOOSER
(
dŸlog
), 
TRUE
);

109 ià(
š™_·th
 !ğ
NULL
) {

110 
	`gtk_fe_choo£r_£t_f’ame
(
	`GTK_FILE_CHOOSER
(
dŸlog
), 
š™_·th
);

112 
	`gtk_fe_choo£r_£t_cu¼’t_Çme
(
	`GTK_FILE_CHOOSER
(
dŸlog
), "Untitled");

114 ià(
	`gtk_dŸlog_run
(
	`GTK_DIALOG
(
dŸlog
)è=ğ
GTK_RESPONSE_ACCEPT
) {

115 
·th
 = 
	`gtk_fe_choo£r_g‘_f’ame
(
	`GTK_FILE_CHOOSER
(
dŸlog
));

117 
	`gtk_widg‘_de¡roy
(
dŸlog
);

118  
·th
;

119 
	}
}

121 *
	$ut_pŞicy_·th_to_¡ršg
(cÚ¡ 
­Ş_pŞicy_·th_t
 * 
·th
)

123 *
s
;

124 cÚ¡ *
´im¬y_·th
 = 
	`­Ş_pŞicy_·th_g‘_´im¬y
(
·th
);

125 ià(
	`­Ş_pŞicy_·th_g‘_ty³
(
·th
è=ğ
APOL_POLICY_PATH_TYPE_MONOLITHIC
) {

126  
	`¡rdup
(
´im¬y_·th
);

128 cÚ¡ 
­Ş_veùÜ_t
 *
moduËs
 = 
	`­Ş_pŞicy_·th_g‘_moduËs
(
·th
);

129 
size_t
 
num_moduËs
 = 
	`­Ş_veùÜ_g‘_size
(
moduËs
);

130 ià(
	`a¥rštf
(&
s
, "% + %zd moduË%s", 
´im¬y_·th
, 
num_moduËs
,‚um_modules == 1 ? "" : "s") < 0) {

131  
NULL
;

133  
s
;

135 
	}
}

137 *
	$ut_pŞicy_·th_to_fuÎ_¡ršg
(cÚ¡ 
­Ş_pŞicy_·th_t
 * 
·th
)

139 cÚ¡ *
´im¬y_·th
 = 
	`­Ş_pŞicy_·th_g‘_´im¬y
(
·th
);

140 ià(
	`­Ş_pŞicy_·th_g‘_ty³
(
·th
è=ğ
APOL_POLICY_PATH_TYPE_MONOLITHIC
) {

141  
	`¡rdup
(
´im¬y_·th
);

143 *
s
 = 
NULL
, *
t
 = NULL;

144 
size_t
 
Ën
 = 0;

145 cÚ¡ 
­Ş_veùÜ_t
 *
moduËs
 = 
	`­Ş_pŞicy_·th_g‘_moduËs
(
·th
);

146 
size_t
 
num_moduËs
 = 
	`­Ş_veùÜ_g‘_size
(
moduËs
);

147 ià(
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "% + %zd moduË%s", 
´im¬y_·th
, 
num_moduËs
,‚um_modules == 1 ? "" : "s") < 0) {

148  
NULL
;

150 ià(
num_moduËs
 > 0) {

151 ià((
t
 = 
	`­Ş_¡r_još
(
moduËs
, "\n\t")è=ğ
NULL
 || 
	`­Ş_¡r_­³ndf
(&
s
, &
Ën
, "\n\t%s",) < 0) {

152 
	`ä“
(
t
);

153 
	`ä“
(
s
);

154  
NULL
;

157  
s
;

159 
	}
}

161 cÚ¡ 
gch¬
 *
	$ut_combo_box_g‘_aùive_‹xt
(
GtkComboBox
 * 
w
)

163 #ifdeà
GTK_2_8


164  
	`gtk_combo_box_g‘_aùive_‹xt
(
w
);

166  
	`gtk_’Œy_g‘_‹xt
(
	`GTK_ENTRY
(
	`GTK_BIN
(
w
)->
chd
));

168 
	}
}

	@sediff/utilgui.h

25 #iâdeà
UTILGUI_H


26 
	#UTILGUI_H


	)

28 
	~<­Ş/pŞicy-·th.h
>

29 
	~<gtk/gtk.h
>

40 
ut_mes§ge
(
GtkWšdow
 * 
·»Á
, 
GtkMes§geTy³
 
msg_ty³
, cÚ¡ *
msg
);

46 
ut_cursÜ_wa™
(
GtkWidg‘
 * 
widg‘
);

53 
ut_cursÜ_ş—r
(
GtkWidg‘
 * 
widg‘
);

61 
ut_‹xt_bufãr_ş—r
(
GtkTextBufãr
 * 
txt
);

77 
­Ş_veùÜ_t
 *
ut_İ’_fe
(
GtkWšdow
 * 
·»Á
, cÚ¡ *
t™Ë
, cÚ¡ *
š™_·th
, 
gboŞ—n
 
muÉË
);

91 *
ut_§ve_fe
(
GtkWšdow
 * 
·»Á
, cÚ¡ *
t™Ë
, cÚ¡ *
š™_·th
);

103 *
ut_pŞicy_·th_to_¡ršg
(cÚ¡ 
­Ş_pŞicy_·th_t
 * 
·th
);

115 *
ut_pŞicy_·th_to_fuÎ_¡ršg
(cÚ¡ 
­Ş_pŞicy_·th_t
 * 
·th
);

123 cÚ¡ 
gch¬
 *
ut_combo_box_g‘_aùive_‹xt
(
GtkComboBox
 * 
w
);

	@
1
.
0
396
11917
apol/apol_tcl.cc
libapol/include/apol/avrule-query.h
libapol/include/apol/bool-query.h
libapol/include/apol/bounds-query.h
libapol/include/apol/bst.h
libapol/include/apol/class-perm-query.h
libapol/include/apol/condrule-query.h
libapol/include/apol/constraint-query.h
libapol/include/apol/context-query.h
libapol/include/apol/default-object-query.h
libapol/include/apol/domain-trans-analysis.h
libapol/include/apol/fscon-query.h
libapol/include/apol/ftrule-query.h
libapol/include/apol/infoflow-analysis.h
libapol/include/apol/isid-query.h
libapol/include/apol/mls-query.h
libapol/include/apol/mls_level.h
libapol/include/apol/mls_range.h
libapol/include/apol/netcon-query.h
libapol/include/apol/perm-map.h
libapol/include/apol/permissive-query.h
libapol/include/apol/polcap-query.h
libapol/include/apol/policy-path.h
libapol/include/apol/policy-query.h
libapol/include/apol/policy.h
libapol/include/apol/range_trans-query.h
libapol/include/apol/rbacrule-query.h
libapol/include/apol/relabel-analysis.h
libapol/include/apol/render.h
libapol/include/apol/role-query.h
libapol/include/apol/terule-query.h
libapol/include/apol/type-query.h
libapol/include/apol/types-relation-analysis.h
libapol/include/apol/user-query.h
libapol/include/apol/util.h
libapol/include/apol/vector.h
libapol/src/avrule-query.c
libapol/src/bool-query.c
libapol/src/bounds-query.c
libapol/src/bst.c
libapol/src/class-perm-query.c
libapol/src/condrule-query.c
libapol/src/constraint-query.c
libapol/src/context-query.c
libapol/src/default-object-query.c
libapol/src/domain-trans-analysis-internal.h
libapol/src/domain-trans-analysis.c
libapol/src/fscon-query.c
libapol/src/ftrule-query.c
libapol/src/infoflow-analysis-internal.h
libapol/src/infoflow-analysis.c
libapol/src/isid-query.c
libapol/src/mls-query.c
libapol/src/mls_level.c
libapol/src/mls_range.c
libapol/src/netcon-query.c
libapol/src/perm-map.c
libapol/src/permissive-query.c
libapol/src/polcap-query.c
libapol/src/policy-path.c
libapol/src/policy-query-internal.h
libapol/src/policy-query.c
libapol/src/policy.c
libapol/src/queue.c
libapol/src/queue.h
libapol/src/range_trans-query.c
libapol/src/rbacrule-query.c
libapol/src/relabel-analysis.c
libapol/src/render.c
libapol/src/role-query.c
libapol/src/terule-query.c
libapol/src/type-query.c
libapol/src/types-relation-analysis.c
libapol/src/user-query.c
libapol/src/util.c
libapol/src/vector-internal.h
libapol/src/vector.c
libapol/tests/avrule-tests.c
libapol/tests/avrule-tests.h
libapol/tests/constrain-tests.c
libapol/tests/constrain-tests.h
libapol/tests/dta-tests.c
libapol/tests/dta-tests.h
libapol/tests/infoflow-tests.c
libapol/tests/infoflow-tests.h
libapol/tests/libapol-tests.c
libapol/tests/policy-21-tests.c
libapol/tests/policy-21-tests.h
libapol/tests/role-tests.c
libapol/tests/role-tests.h
libapol/tests/terule-tests.c
libapol/tests/terule-tests.h
libapol/tests/user-tests.c
libapol/tests/user-tests.h
libpoldiff/include/poldiff/attrib_diff.h
libpoldiff/include/poldiff/avrule_diff.h
libpoldiff/include/poldiff/bool_diff.h
libpoldiff/include/poldiff/cat_diff.h
libpoldiff/include/poldiff/class_diff.h
libpoldiff/include/poldiff/component_record.h
libpoldiff/include/poldiff/level_diff.h
libpoldiff/include/poldiff/poldiff.h
libpoldiff/include/poldiff/range_diff.h
libpoldiff/include/poldiff/range_trans_diff.h
libpoldiff/include/poldiff/rbac_diff.h
libpoldiff/include/poldiff/role_diff.h
libpoldiff/include/poldiff/terule_diff.h
libpoldiff/include/poldiff/type_diff.h
libpoldiff/include/poldiff/type_map.h
libpoldiff/include/poldiff/user_diff.h
libpoldiff/include/poldiff/util.h
libpoldiff/src/attrib_diff.c
libpoldiff/src/attrib_internal.h
libpoldiff/src/avrule_diff.c
libpoldiff/src/avrule_internal.h
libpoldiff/src/bool_diff.c
libpoldiff/src/bool_internal.h
libpoldiff/src/cat_diff.c
libpoldiff/src/cat_internal.h
libpoldiff/src/class_diff.c
libpoldiff/src/class_internal.h
libpoldiff/src/level_diff.c
libpoldiff/src/level_internal.h
libpoldiff/src/poldiff.c
libpoldiff/src/poldiff_internal.h
libpoldiff/src/range_diff.c
libpoldiff/src/range_internal.h
libpoldiff/src/range_trans_diff.c
libpoldiff/src/range_trans_internal.h
libpoldiff/src/rbac_diff.c
libpoldiff/src/rbac_internal.h
libpoldiff/src/role_diff.c
libpoldiff/src/role_internal.h
libpoldiff/src/terule_diff.c
libpoldiff/src/terule_internal.h
libpoldiff/src/type_diff.c
libpoldiff/src/type_internal.h
libpoldiff/src/type_map.c
libpoldiff/src/type_map_internal.h
libpoldiff/src/user_diff.c
libpoldiff/src/user_internal.h
libpoldiff/src/util.c
libpoldiff/tests/components-tests.c
libpoldiff/tests/components-tests.h
libpoldiff/tests/libpoldiff-tests.c
libpoldiff/tests/libpoldiff-tests.h
libpoldiff/tests/mls-tests.c
libpoldiff/tests/mls-tests.h
libpoldiff/tests/nomls-tests.c
libpoldiff/tests/nomls-tests.h
libpoldiff/tests/policy-defs.h
libpoldiff/tests/rules-tests.c
libpoldiff/tests/rules-tests.h
libqpol/include/qpol/avrule_query.h
libqpol/include/qpol/bool_query.h
libqpol/include/qpol/bounds_query.h
libqpol/include/qpol/class_perm_query.h
libqpol/include/qpol/cond_query.h
libqpol/include/qpol/constraint_query.h
libqpol/include/qpol/context_query.h
libqpol/include/qpol/default_object_query.h
libqpol/include/qpol/fs_use_query.h
libqpol/include/qpol/ftrule_query.h
libqpol/include/qpol/genfscon_query.h
libqpol/include/qpol/isid_query.h
libqpol/include/qpol/iterator.h
libqpol/include/qpol/mls_query.h
libqpol/include/qpol/mlsrule_query.h
libqpol/include/qpol/module.h
libqpol/include/qpol/netifcon_query.h
libqpol/include/qpol/nodecon_query.h
libqpol/include/qpol/permissive_query.h
libqpol/include/qpol/polcap_query.h
libqpol/include/qpol/policy.h
libqpol/include/qpol/policy_extend.h
libqpol/include/qpol/portcon_query.h
libqpol/include/qpol/rbacrule_query.h
libqpol/include/qpol/role_query.h
libqpol/include/qpol/syn_rule_query.h
libqpol/include/qpol/terule_query.h
libqpol/include/qpol/type_query.h
libqpol/include/qpol/user_query.h
libqpol/include/qpol/util.h
libqpol/src/avrule_query.c
libqpol/src/bool_query.c
libqpol/src/bounds_query.c
libqpol/src/class_perm_query.c
libqpol/src/cond_query.c
libqpol/src/constraint_query.c
libqpol/src/context_query.c
libqpol/src/default_object_query.c
libqpol/src/expand.c
libqpol/src/expand.h
libqpol/src/fs_use_query.c
libqpol/src/ftrule_query.c
libqpol/src/genfscon_query.c
libqpol/src/isid_query.c
libqpol/src/iterator.c
libqpol/src/iterator_internal.h
libqpol/src/mls_query.c
libqpol/src/mlsrule_query.c
libqpol/src/module.c
libqpol/src/module_compiler.c
libqpol/src/module_compiler.h
libqpol/src/netifcon_query.c
libqpol/src/nodecon_query.c
libqpol/src/permissive_query.c
libqpol/src/polcap_query.c
libqpol/src/policy.c
libqpol/src/policy_define.c
libqpol/src/policy_define.h
libqpol/src/policy_extend.c
libqpol/src/policy_parse.y
libqpol/src/policy_scan.l
libqpol/src/portcon_query.c
libqpol/src/qpol_internal.h
libqpol/src/queue.c
libqpol/src/queue.h
libqpol/src/rbacrule_query.c
libqpol/src/role_query.c
libqpol/src/syn_rule_internal.h
libqpol/src/syn_rule_query.c
libqpol/src/terule_query.c
libqpol/src/type_query.c
libqpol/src/user_query.c
libqpol/src/util.c
libqpol/tests/capabilities-tests.c
libqpol/tests/capabilities-tests.h
libqpol/tests/iterators-tests.c
libqpol/tests/iterators-tests.h
libqpol/tests/libqpol-tests.c
libqpol/tests/policy-features-tests.c
libqpol/tests/policy-features-tests.h
libseaudit/include/seaudit/avc_message.h
libseaudit/include/seaudit/bool_message.h
libseaudit/include/seaudit/filter.h
libseaudit/include/seaudit/load_message.h
libseaudit/include/seaudit/log.h
libseaudit/include/seaudit/message.h
libseaudit/include/seaudit/model.h
libseaudit/include/seaudit/parse.h
libseaudit/include/seaudit/report.h
libseaudit/include/seaudit/sort.h
libseaudit/include/seaudit/util.h
libseaudit/src/avc_message.c
libseaudit/src/bool_message.c
libseaudit/src/filter-internal.c
libseaudit/src/filter-internal.h
libseaudit/src/filter.c
libseaudit/src/load_message.c
libseaudit/src/log.c
libseaudit/src/message.c
libseaudit/src/model.c
libseaudit/src/parse.c
libseaudit/src/report.c
libseaudit/src/seaudit_internal.h
libseaudit/src/sort.c
libseaudit/src/util.c
libseaudit/tests/filters.c
libseaudit/tests/filters.h
libseaudit/tests/libseaudit-tests.c
libseaudit/tests/parse_file.c
libseaudit/tests/parse_file.h
libsefs/include/sefs/db.hh
libsefs/include/sefs/entry.hh
libsefs/include/sefs/fcfile.hh
libsefs/include/sefs/fclist.hh
libsefs/include/sefs/filesystem.hh
libsefs/include/sefs/query.hh
libsefs/include/sefs/util.h
libsefs/src/db.cc
libsefs/src/entry.cc
libsefs/src/fcfile.cc
libsefs/src/fclist.cc
libsefs/src/filesystem.cc
libsefs/src/new_ftw.c
libsefs/src/new_ftw.h
libsefs/src/query.cc
libsefs/src/sefs_internal.hh
libsefs/src/util.c
libsefs/tests/attic/fuse_non_mls.c
libsefs/tests/fcfile-tests.cc
libsefs/tests/fcfile-tests.hh
libsefs/tests/libsefs-tests.cc
python/setools/seinfo.c
python/setools/sesearch.c
seaudit/filter_view.c
seaudit/filter_view.h
seaudit/message_view.c
seaudit/message_view.h
seaudit/modify_view.c
seaudit/modify_view.h
seaudit/open_policy_window.c
seaudit/open_policy_window.h
seaudit/policy_components_view.c
seaudit/policy_components_view.h
seaudit/policy_view.c
seaudit/policy_view.h
seaudit/preferences.c
seaudit/preferences.h
seaudit/preferences_view.c
seaudit/preferences_view.h
seaudit/progress.c
seaudit/progress.h
seaudit/report_window.c
seaudit/report_window.h
seaudit/seaudit-report.c
seaudit/seaudit.c
seaudit/seaudit.h
seaudit/toplevel.c
seaudit/toplevel.h
seaudit/utilgui.c
seaudit/utilgui.h
sechecker/modules/attribs_wo_rules.c
sechecker/modules/attribs_wo_rules.h
sechecker/modules/attribs_wo_types.c
sechecker/modules/attribs_wo_types.h
sechecker/modules/domain_and_file.c
sechecker/modules/domain_and_file.h
sechecker/modules/domains_wo_roles.c
sechecker/modules/domains_wo_roles.h
sechecker/modules/find_assoc_types.c
sechecker/modules/find_assoc_types.h
sechecker/modules/find_domains.c
sechecker/modules/find_domains.h
sechecker/modules/find_file_types.c
sechecker/modules/find_file_types.h
sechecker/modules/find_net_domains.c
sechecker/modules/find_net_domains.h
sechecker/modules/find_netif_types.c
sechecker/modules/find_netif_types.h
sechecker/modules/find_node_types.c
sechecker/modules/find_node_types.h
sechecker/modules/find_port_types.c
sechecker/modules/find_port_types.h
sechecker/modules/imp_range_trans.c
sechecker/modules/imp_range_trans.h
sechecker/modules/inc_dom_trans.c
sechecker/modules/inc_dom_trans.h
sechecker/modules/inc_mount.c
sechecker/modules/inc_mount.h
sechecker/modules/inc_net_access.c
sechecker/modules/inc_net_access.h
sechecker/modules/roles_wo_allow.c
sechecker/modules/roles_wo_allow.h
sechecker/modules/roles_wo_types.c
sechecker/modules/roles_wo_types.h
sechecker/modules/roles_wo_users.c
sechecker/modules/roles_wo_users.h
sechecker/modules/spurious_audit.c
sechecker/modules/spurious_audit.h
sechecker/modules/template/xx.c
sechecker/modules/template/xx.h
sechecker/modules/types_wo_allow.c
sechecker/modules/types_wo_allow.h
sechecker/modules/unreachable_doms.c
sechecker/modules/unreachable_doms.h
sechecker/modules/users_wo_roles.c
sechecker/modules/users_wo_roles.h
sechecker/register_list.c
sechecker/register_list.h
sechecker/sechecker.c
sechecker/sechecker.h
sechecker/sechecker_cli.c
sechecker/sechk_parse.c
sechecker/sechk_parse.h
secmds/findcon.cc
secmds/indexcon.cc
secmds/replcon.cc
secmds/seinfo.c
secmds/sesearch.c
sediff/find_dialog.c
sediff/find_dialog.h
sediff/open_policies_dialog.c
sediff/open_policies_dialog.h
sediff/policy_view.c
sediff/policy_view.h
sediff/progress.c
sediff/progress.h
sediff/remap_types_dialog.c
sediff/remap_types_dialog.h
sediff/result_item.c
sediff/result_item.h
sediff/result_item_render.c
sediff/result_item_render.h
sediff/results.c
sediff/results.h
sediff/sediff.c
sediff/sediffx.c
sediff/sediffx.h
sediff/select_diff_dialog.c
sediff/select_diff_dialog.h
sediff/toplevel.c
sediff/toplevel.h
sediff/utilgui.c
sediff/utilgui.h
